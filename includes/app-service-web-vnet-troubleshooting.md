---
author: ccompy
ms.service: app-service-web
ms.topic: include
ms.date: 02/27/2020
ms.author: ccompy
ms.openlocfilehash: cec44bbabdb7d528c30a8d3396b819f2eb3c5386
ms.sourcegitcommit: 910a1a38711966cb171050db245fc3b22abc8c5f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "95999463"
---
Эту функцию легко настроить, но это не означает, что ваша работа будет бесплатной. При возникновении проблем с доступом к нужной конечной точке существует несколько служебных программ, которые можно использовать для проверки подключения из консоли приложения. Вы можете использовать две консоли: Одна из них — консоль KUDU, а другая — консоль в портал Azure. Чтобы открыть консоль KUDU из приложения, перейдите в раздел **инструменты**  >  **KUDU**. Можно также обратиться к консоли Кудо по адресу [sitename]. SCM. azurewebsites. NET. После загрузки веб-сайта перейдите на вкладку **консоль отладки** . Чтобы перейти к консоли, размещенной портал Azure, из приложения, перейдите в   >  **консоль** инструментов.

#### <a name="tools"></a>Инструменты
В собственных приложениях Windows средства **проверки связи**, **nslookup** и **tracert** не будут работать через консоль из-за ограничений безопасности (они работают в [пользовательских контейнерах Windows](../articles/app-service/quickstart-custom-container.md)). Чтобы заполнить void, добавляются два отдельных средства. Чтобы проверить функциональность DNS, мы добавили средство с именем **nameresolver.exe**. Синтаксис выглядит следующим образом.

```console
nameresolver.exe hostname [optional: DNS Server]
```

Nameresolver можно использовать для проверки имен узлов, которые использует ваше приложение. Таким образом вы можете проверить, неправильно ли настроена служба DNS или нет доступа к DNS-серверу. DNS-сервер, используемый приложением, можно увидеть в консоли, просмотрев переменные среды WEBSITE_DNS_SERVER и WEBSITE_DNS_ALT_SERVER.

> [!NOTE]
> nameresolver.exe в настоящее время не работает в пользовательских контейнерах Windows.
>

Можно использовать следующее средство для проверки подключения TCP к сочетанию узла и порта. Этот инструмент называется **tcpping.exe** и использует следующий синтаксис.

```console
tcpping.exe hostname [optional: port]
```

Служебная программа **tcpping** сообщает, есть ли доступ к определенному узлу и порту. Он может показывать успешность только в том случае, если приложение прослушивает сочетание узла и порта, а к указанному узлу и порту подключен доступ к сети из приложения.

#### <a name="debug-access-to-virtual-network-hosted-resources"></a>Доступ для отладки к ресурсам, размещенным в виртуальной сети
Ряд действий может помешать приложению достичь определенного узла и порта. В большинстве случаев это одно из следующих действий:

* **Брандмауэр блокирует доступ.** При наличии брандмауэра вы достигли времени ожидания TCP. В нашем случае это 21 секунда. Проверьте подключение с помощью средства **tcpping**. Время ожидания TCP может быть вызвано многими причинами, которые выходят за пределы брандмауэра, но начать с него.
* **Служба DNS недоступна.** Время ожидания DNS составляет 3 секунды на DNS-сервер. Если у вас два DNS-сервера, то время ожидания составляет 6 секунд. Используйте средство nameresolver для проверки работы DNS. Нельзя использовать nslookup, так как не использует DNS-сервер, для которого настроена виртуальная сеть. Если он недоступен, возможно, брандмауэр или NSG блокирует доступ к DNS.

Если эти элементы не отвечают на ваши проблемы, сначала изучите такие вещи, как:

**Интеграция с региональной виртуальной сетью**
* Не не АДРЕСНЫЕ пространства RFC1918 адрес назначения, и у вас нет WEBSITE_VNET_ROUTE_ALL в качестве значения 1?
* Существует ли NSG блокировка исходящего трафика из вашей подсети интеграции?
* Если вы работаете в Azure ExpressRoute или VPN, это ваш локальный шлюз, настроенный на маршрутизацию трафика в Azure? Если вы можете получить доступ к конечным точкам в виртуальной сети, но не в локальной среде, проверьте маршруты.
* У вас есть достаточные разрешения для настройки делегирования в подсети интеграции? Во время настройки интеграции с региональной виртуальной сетью ваша подсеть интеграции делегируется Microsoft. Web/serverFarms. Пользовательский интерфейс интеграции с виртуальной сетью делегирует подсеть к Microsoft. Web/serverFarms автоматически. Если у вашей учетной записи нет достаточных сетевых разрешений для настройки делегирования, вам потребуется пользователь, который может задать атрибуты в подсети интеграции для делегирования подсети. Чтобы вручную делегировать подсеть интеграции, перейдите в пользовательский интерфейс подсети виртуальной сети Azure и задайте делегирование для Microsoft. Web/serverFarms.

**Интеграция виртуальной сети с требуемым шлюзом**
* Диапазон адресов "точка — сеть" в диапазонах RFC 1918 (10.0.0.0-10.255.255.255/172.16.0.0-172.31.255.255/192.168.0.0-192.168.255.255)?
* Отображается ли шлюз как на портале? Если шлюз не работает, восстановите его работоспособность.
* Отображаются ли сертификаты как синхронизированные или вы считаете, что конфигурация сети была изменена?  Если сертификаты не синхронизированы или вы подозреваете, что в конфигурацию виртуальной сети было внесено изменение, которое не было синхронизировано с планах ASP, выберите **синхронизировать сеть**.
* Если вы находитесь через VPN, то — это локальный шлюз, настроенный для маршрутизации трафика в Azure? Если вы можете получить доступ к конечным точкам в виртуальной сети, но не в локальной среде, проверьте маршруты.
* Вы пытаетесь использовать шлюз сосуществования, поддерживающий обе точки с сайтом и ExpressRoute? Шлюзы сосуществования не поддерживаются при интеграции с виртуальной сетью.

Отладка сетевых проблем является сложной задачей, так как вы не можете увидеть, что блокирует доступ к определенной комбинации "узел: порт". Некоторые причины включают:

* На узле имеется брандмауэр, который блокирует доступ к порту приложения из диапазона IP-адресов "точка — сеть". Пересечение подсетей часто требует общего доступа.
* Целевой узел не работает.
* Ваше приложение не работает.
* У вас неправильный IP-адрес или имя узла.
* Приложение прослушивает порт, отличный от ожидаемого. Вы можете сопоставить ИД процесса с портом прослушивания при помощи команды "netstat -aon" в узле конечной точки.
* Группы безопасности сети настроены таким образом, чтобы предотвратить доступ к узлу приложения и порту из диапазона IP-адресов "точка — сеть".

Вы не узнаете, какой адрес в действительности используется приложением. Это может быть любой адрес в подсети интеграции или диапазон адресов "точка — сеть", поэтому необходимо разрешить доступ из всего диапазона адресов.

Можно выполнить дополнительные действия по отладке.

* Подключитесь к виртуальной машине в виртуальной сети и попытайтесь связаться с узлом ресурсов: через порт. Чтобы проверить доступ TCP, используйте команду PowerShell **test-netconnection**. Синтаксис выглядит следующим образом.

```powershell
test-netconnection hostname [optional: -Port]
```

* Выведите приложение на виртуальной машине и протестируйте доступ к этому узлу и порту из консоли приложения с помощью **tcpping**.

#### <a name="on-premises-resources"></a>Локальные ресурсы ####

Если приложение не может подключиться к локальному ресурсу, проверьте, есть ли у вас доступ к ресурсу из виртуальной сети. Чтобы проверить доступ по протоколу TCP, используйте команду PowerShell **test-netconnection**. Если виртуальная машина не может подключиться к локальному ресурсу, возможно, подключение VPN или ExpressRoute настроено неправильно.

Если виртуальная машина, размещенная в виртуальной сети, может подключиться к локальной системе, но приложение не может, причина может быть одной из следующих причин.

* Для ваших маршрутов не настроена подсеть или диапазоны адресов "точка — сеть" в локальном шлюзе.
* Группы безопасности сети блокируют доступ к диапазону IP-адресов "точка — сеть".
* Локальные брандмауэры блокируют трафик из диапазона IP-адресов "точка — сеть".
* Вы пытаетесь обратиться к адресу, отличному от RFC 1918, с помощью функции интеграции с региональной виртуальной сетью.
