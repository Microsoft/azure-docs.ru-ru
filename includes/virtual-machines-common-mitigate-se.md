---
title: включить файл
description: включить файл
services: virtual-machines
author: cynthn
ms.service: virtual-machines
ms.topic: include
ms.date: 11/12/2019
ms.author: cynthn;kareni
ms.custom: include file
ms.openlocfilehash: a9146099951aba223a7b201c1613e1ec0ba617d4
ms.sourcegitcommit: 910a1a38711966cb171050db245fc3b22abc8c5f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "96509244"
---
**Последнее обновление документа**: 12 ноября 2019 10:00 по тихоокеанскому времени.

В результате обнаружения [нового класса уязвимостей ЦП](https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/ADV180002), известного как атаки спекулятивного выполнения команд с предсказанием ветвлений, у пользователей возникли вопросы, требующие разъяснения.  

Корпорация Майкрософт развернула по всем облачным службам средства устранения уязвимостей. Инфраструктура с изолированными друг от друга нагрузками, которая работает в Azure, является защищенной. Это означает, что потенциальному злоумышленнику с помощью той же инфраструктуры, используя эти уязвимости, не удастся осуществить атаку на ваше приложение.

Чтобы свести к минимуму последствия для пользователей и устранить необходимость перезагрузки, Azure всякий раз при возможности использует [обслуживание с сохранением памяти](../articles/virtual-machines/maintenance-and-updates.md?bc=%2fazure%2fvirtual-machines%2fwindows%2fbreadcrumb%2ftoc.json%252c%2fazure%2fvirtual-machines%2fwindows%2fbreadcrumb%2ftoc.json&toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json%253ftoc%253d%2fazure%2fvirtual-machines%2fwindows%2ftoc.json#maintenance-that-doesnt-require-a-reboot). Azure продолжит использовать эти методы при выполнении системных обновлений на узле и для защиты своих клиентов.

Дополнительные сведения о том, как вопросы безопасности учитываются в каждом аспекте создания Azure, доступны на веб-сайте [Документация по системе безопасности Azure](../articles/security/index.yml). 

> [!NOTE] 
> С тех пор как этот документ был впервые опубликован, было обнаружено несколько вариантов этого класса уязвимостей. Корпорация Майкрософт продолжает активно вкладывать средства в защиту своих клиентов и предоставлять поддержку. Эта страница будет обновляться по мере выпуска дальнейших исправлений. 
> 
> 12 ноября 2019 [Корпорация Intel опубликовала](https://software.intel.com/security-software-guidance/insights/deep-dive-intel-transactional-synchronization-extensions-intel-tsx-asynchronous-abort) технические рекомендации по технологии Intel® транзакционными модулями синхронизации (Intel® Целевая) транзакция асинхронного прерывания (ТАА), которой назначена [CVE-2019-11135](https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/CVE-2019-11135). Эта уязвимость затрагивает процессоры Intel® Core® и Intel® Xeon®.  Microsoft Azure выпустила обновления операционной системы и развертывает новый Микропрограммный код, так как он предоставляется корпорацией Intel на протяжении всего нашего парка для защиты наших клиентов от этих новых уязвимостей.   Azure тесно работает с корпорацией Intel для тестирования и проверки нового микрокода до его официального выпуска на платформе. 
>
> **Клиенты, которые работают с ненадежным кодом на своих виртуальных машинах,** должны предпринять меры для защиты от этих уязвимостей, прочитав приведенные ниже сведения для получения дополнительных рекомендаций по всем уязвимостям, связанным с практическим выполнением канала (Microsoft Advisors, [180002](https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/ADV180002), [180018](https://portal.msrc.microsoft.com/en-us/security-guidance/advisory/adv180018)и [190013](https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/ADV190013)).
>
> Другие клиенты должны оценить эти уязвимости с точки зрения глубокой защиты и оценить влияние их выбранной конфигурации на безопасность и производительность.
> 



## <a name="keeping-your-operating-systems-up-to-date"></a>Обновление операционных систем в актуальном состоянии

Хотя обновление ОС не является обязательным требованием для изоляции приложений, запускаемых в Azure, от других клиентов Azure, настоятельно рекомендуется поддерживать актуальное состояние системы. Последние накопительные пакеты обновлений безопасности для Windows оснащены средствами устранения рисков, связанных с несколькими уязвимостями спекулятивного выполнения команд с предсказанием ветвлений. Аналогичным образом дистрибутивы Linux выпустили несколько обновлений для устранения этих уязвимостей. Ниже приведены рекомендуемые действия по обновлению операционной системы.

| Предложение | Рекомендуемое действие  |
|----------|---------------------|
| Oблачныe службы Azure  | Включите [Автоматическое обновление](../articles/cloud-services/cloud-services-how-to-configure-portal.md) или убедитесь, что вы используете самую новую гостевую ОС. |
| Виртуальные машины Linux в Azure | Устанавливайте обновления, предоставляемые поставщиками операционной системы. Дополнительные сведения см. в пункте [Linux](#linux) далее в этом документе. |
| Виртуальные машины Windows в Azure  | Установка последнего накопительного пакета обновлений безопасности.
| Прочие службы Azure PaaS | Для клиентов, использующих эти службы, дополнительные действия не требуются. Azure автоматически выполняет обновление версий операционной системы. |

## <a name="additional-guidance-if-you-are-running-untrusted-code"></a>Дополнительные рекомендации при выполнении кода без доверия 

Клиентам, позволяющим ненадежным пользователям выполнение произвольного кода, может потребоваться использование дополнительных компонентов безопасности внутри своих виртуальных машин Azure или облачных служб. Эти компоненты защищают от внутрипроцессных векторов обнаружения, описываемых несколькими уязвимостями спекулятивного выполнения команд.

Примеры сценариев, где рекомендуется использовать дополнительные компоненты безопасности.

- Вы допускаете запуск кода, которому не доверяете, на своей виртуальной машине.  
    - *Например, вы разрешаете одному из клиентов загрузить двоичный файл или сценарий, который затем будет выполнен в приложении*. 
- Вы разрешаете пользователям, которым не доверяете, входить в виртуальную машину через учетные записи с низкими разрешениями.   
    - *Например, вы разрешаете низкопривилегированному пользователю войти в одну из виртуальных машин с помощью удаленного рабочего стола или SSH*.  
- Вы разрешаете ненадежным пользователям доступ к виртуальным машинам с помощью встроенной виртуализации.  
    - *Например, вы управляете узлом Hyper-V, но выделяете виртуальные машины для ненадежных пользователей*. 

Клиентам, которые не используют сценарии с ненадежным кодом, не обязательно включать эти дополнительные компоненты безопасности. 

## <a name="enabling-additional-security"></a>Включение дополнительной защиты 

Если вы используете ненадежный код, вы можете включить дополнительные функции безопасности в виртуальной машине или в облачной службе. В параллельном режиме убедитесь, что операционная система обновлена, чтобы включить функции безопасности в виртуальной машине или в облачной службе.

### <a name="windows"></a>Windows 

Чтобы включить эти дополнительные компоненты безопасности, нужно использовать последнюю версию целевой операционной системы. Несмотря на то что по умолчанию задействованы многочисленные предупреждения о спекулятивном выполнении команд с предсказанием ветвлений, дополнительные функции, описанные здесь, должны быть активированы вручную и могут отрицательно сказаться на производительности. 


**Шаг 1. Отключите технологию Hyper-Threading на виртуальной машине** . клиенты, выполняющие недоверенный код на виртуальной машине с технологией Hyper-Threading, должны отключить технологию Hyper-Threading или перейти на размер виртуальной машины, отличной от Hyper-Threading. В [этом документе приведен](../articles/virtual-machines/acu.md) список размеров виртуальных машин под управлением Hyper-Threading (где отношение виртуальных ЦП к ядру — 2:1). Чтобы проверить, включена ли технология Hyper-Threading на виртуальной машине, обратитесь к приведенному ниже сценарию, используя командную строку Windows в виртуальной машине.

Введите текст `wmic` для входа в интерактивный интерфейс. Затем введите ниже, чтобы просмотреть объем физических и логических процессоров на виртуальной машине.

```console
CPU Get NumberOfCores,NumberOfLogicalProcessors /Format:List
```

Если число логических процессоров превышает количество физических процессоров (ядер), то технология Hyper-Threading включена.  Если вы используете виртуальную машину с Hyper-Threading, [обратитесь в службу поддержки Azure](https://aka.ms/MicrocodeEnablementRequest-SupportTechnical) , чтобы получить отключенную технологию Hyper-Threading.  Если технология Hyper-Threading отключена, **для поддержки потребуется полная перезагрузка ВИРТУАЛЬНОЙ машины**. Сведения о том, почему количество ядер виртуальной машины уменьшилось, см. в разделе [число ядер](#core-count) .


**Шаг 2**. параллельно с шагом 1 выполните инструкции в [KB4072698](https://support.microsoft.com/help/4072698/windows-server-guidance-to-protect-against-the-speculative-execution) , чтобы убедиться, что защита включена с помощью модуля PowerShell [спекулатионконтрол](https://aka.ms/SpeculationControlPS) .

> [!NOTE]
> Если этот модуль ранее уже был загружен, необходимо установить его последнюю версию.
>


Выходные данные скрипта PowerShell должны иметь следующие значения для проверки включенной защиты для этих уязвимостей:

```
Windows OS support for branch target injection mitigation is enabled: True
Windows OS support for kernel VA shadow is enabled: True
Windows OS support for speculative store bypass disable is enabled system-wide: False
Windows OS support for L1 terminal fault mitigation is enabled: True
Windows OS support for MDS mitigation is enabled: True
Windows OS support for TAA mitigation is enabled: True
```

Если выходные данные показаны `MDS mitigation is enabled: False` , [обратитесь в службу поддержки Azure](https://aka.ms/MicrocodeEnablementRequest-SupportTechnical) для получения доступных вариантов устранения рисков.



**Шаг 3**. чтобы включить поддержку теневого копирования виртуальных адресов ядра (квас) и поддержки операционной системы ВЕТВЛЕНИЯ (BTI), следуйте инструкциям в [KB4072698](https://support.microsoft.com/help/4072698/windows-server-guidance-to-protect-against-the-speculative-execution) , чтобы включить защиту с помощью `Session Manager` разделов реестра. Потребуется перезагрузка.


**Шаг 4**. для развертываний, использующих [вложенную виртуализацию](../articles/virtual-machines/windows/nested-virtualization.md) (только D3 и E3), эти инструкции применяются в виртуальной машине, используемой в качестве узла Hyper-V.

1.  Следуйте инструкциям в [KB4072698](https://support.microsoft.com/help/4072698/windows-server-guidance-to-protect-against-the-speculative-execution) , чтобы включить защиту с помощью `MinVmVersionForCpuBasedMitigations` разделов реестра.
2.  Задайте тип планировщика низкоуровневой оболочки, выполнив приведенные `Core` [здесь](/windows-server/virtualization/hyper-v/manage/manage-hyper-v-scheduler-types)инструкции.


### <a name="linux"></a>Linux

<a name="linux"></a>Для включения внутреннего набора дополнительных компонентов безопасности требуется, чтобы целевая операционная система была обновлена до последней версии. Некоторые методы устранения рисков будут включены по умолчанию. В приведенном ниже разделе описаны компоненты, которые по умолчанию отключены и/или зависят от аппаратной поддержки (микрокод). Включение этих компонентов может отрицательно сказаться на производительности. Дополнительные сведения см. в справочной документации поставщика операционной системы.


**Шаг 1. Отключите технологию Hyper-Threading на виртуальной машине** . клиенты, на которых выполняется ненадежный код на виртуальной машине с Hyper-Threading, должны отключить технологию Hyper-Threading или перейти на виртуальную машину, не связанную с Hyper-Threading.  В [этом документе приведен](../articles/virtual-machines/acu.md) список размеров виртуальных машин под управлением Hyper-Threading (где отношение виртуальных ЦП к ядру — 2:1). Чтобы проверить, выполняется ли виртуальная машина с Hyper-Threading, выполните `lscpu` команду на виртуальной машине Linux. 

Если значение `Thread(s) per core = 2` равно, то технология Hyper-Threading включена. 

Если значение `Thread(s) per core = 1` равно, то технология Hyper-Threading была отключена. 

 
Пример выходных данных для виртуальной машины с включенной технологией Hyper-Threading: 

```console
CPU Architecture:      x86_64
CPU op-mode(s):        32-bit, 64-bit
Byte Order:            Little Endian
CPU(s):                8
On-line CPU(s) list:   0-7
Thread(s) per core:    2
Core(s) per socket:    4
Socket(s):             1
NUMA node(s):          1

```

Если вы используете виртуальную машину с Hyper-Threading, [обратитесь в службу поддержки Azure](https://aka.ms/MicrocodeEnablementRequest-SupportTechnical) , чтобы получить отключенную технологию Hyper-Threading.  Если технология Hyper-Threading отключена, **для поддержки потребуется полная перезагрузка ВИРТУАЛЬНОЙ машины**. Сведения о том, почему количество ядер виртуальной машины уменьшилось, см. в разделе [число ядер](#core-count) .



**Шаг 2**. чтобы устранить проблемы с любым из приведенных ниже уязвимостей, см. документацию поставщика операционной системы.   
 
- [RedHat и CentOS](https://access.redhat.com/security/vulnerabilities) 
- [SUSE](https://www.suse.com/support/kb/?doctype%5B%5D=DT_SUSESDB_PSDB_1_1&startIndex=1&maxIndex=0) 
- [Ubuntu](https://wiki.ubuntu.com/SecurityTeam/KnowledgeBase/) 


### <a name="core-count"></a>Число ядер

При создании виртуальной машины, созданной с помощью технологии Hyper-Threading, Azure выделяет 2 потока на ядро — они называются виртуальных ЦП. Если технология Hyper-Threading отключена, Azure удаляет поток и отображает единые потоковые ядра (физические ядра). Отношение виртуальных ЦП к ЦП равно 2:1, поэтому после отключения технологии Hyper-Threading количество ЦП на виртуальной машине будет уменьшено на половину. Например, D8_v3 виртуальная машина — это ВИРТУАЛЬная машина с технологией Hyper-Threading, работающая на 8 виртуальных ЦП (2 потока на ядро x 4 ядер).  Если технология Hyper-Threading отключена, процессоры будут сбрасываться на 4 физических ядра с 1 потоком на ядро. 

## <a name="next-steps"></a>Следующие шаги

В этой статье приводятся рекомендации по приведенным ниже рекомендациям по побочным каналам выполнения, влияющим на многие современные процессоры.

[Устранением рисков Spectre Meltdown](https://portal.msrc.microsoft.com/en-us/security-guidance/advisory/ADV180002):
- CVE-2017-5715 — внедрение целевого объекта Branch (BTI)  
- CVE-2017-5754 — изоляция таблицы страниц ядра (КПТИ)
- CVE-2018-3639 – обход гипотетических магазинов (КПТИ) 
- [CVE-2019-1125](https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/CVE-2019-1125) — сведения о ядре Windows — вариант устранением рисков Spectre варианта 1
 
[Сбой терминала L1 (L1TF)](https://portal.msrc.microsoft.com/en-us/security-guidance/advisory/ADV180018):
- CVE-2018-3615 — расширения Intel Software Guard (Intel SGX)
- CVE-2018-3620 — операционные системы (ОС) и режим управления системой (SMM)
- CVE-2018-3646 — влияет на диспетчер виртуальных машин (VMM)

[Выборка данных на микроархитектуре](https://portal.msrc.microsoft.com/en-us/security-guidance/advisory/ADV190013): 
- CVE-2019-11091 — некэшированная память на основе микроархитектурной выборки данных (МДСУМ)
- CVE-2018-12126 — выборка данных буфера в микроархитектурном хранилище (МСБДС)
- CVE-2018-12127 — выборка данных для порта загрузки микроархитектуры (МЛПДС)
- CVE-2018-12130 — выборка данных из буфера микроархитектурного заполнения (МФБДС)

Асинхронное прерывание транзакций по модулям синхронизации транзакций (Intel® целевого сервера):  
- [CVE-2019-11135](https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/CVE-2019-11135) — асинхронное прерывание транзакций целевого сервера (ТАА)