---
title: включить файл
description: включить файл
services: virtual-machines
author: albecker1
ms.service: virtual-machines
ms.topic: include
ms.date: 10/12/2020
ms.author: albecker1
ms.custom: include file
ms.openlocfilehash: 3c4ab8362b2a717a348a59c0baf829b61e1a8006
ms.sourcegitcommit: 8245325f9170371e08bbc66da7a6c292bbbd94cc
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/07/2021
ms.locfileid: "99808484"
---
![Диаграмма, показывающая спецификации D s версии 3.](media/vm-disk-performance/dsv3-documentation.jpg)

- Максимальная пропускная способность *некэшированного* диска по умолчанию является максимальным предельным числом, которое может быть обработано виртуальной машиной.
- Максимальный объем *кэшированной* пропускной способности хранилища — это отдельный предел при включении кэширования узла.

Кэширование узла работает, добавляя хранилище ближе к виртуальной машине, которую можно быстро записать или прочитать. Объем хранилища, доступный виртуальной машине для кэширования узла, приведен в документации. Например, можно увидеть, Standard_D8s_v3 поставляется с 200 гиб хранилища кэша.

Вы можете включить кэширование узла при создании виртуальной машины и присоединении дисков. Также можно включить и отключить кэширование узлов на дисках на существующей виртуальной машине.

![Снимок экрана, на котором показано кэширование узла.](media/vm-disk-performance/host-caching.jpg)

Можно настроить кэширование узла в соответствии с требованиями к рабочей нагрузке для каждого диска. Вы можете задать для кэширования узла следующее:

- **Только для чтения**: для рабочих нагрузок, которые выполняют операции чтения.
- **Чтение и запись**: для рабочих нагрузок, которые выполняют баланс операций чтения и записи.

Если ваша рабочая нагрузка не соответствует ни одному из этих шаблонов, мы не рекомендуем использовать кэширование узла.

Давайте рассмотрим несколько примеров различных параметров кэша узла, чтобы увидеть, как он влияет на поток данных и производительность. В этом первом примере мы рассмотрим, что происходит с запросами ввода-вывода, если параметр кэширования узла имеет значение **только для чтения**.

**Установки**

- Standard_D8s_v3
  - Кэшированные операции ввода-вывода: 16 000
  - Некэшированные операции ввода-вывода: 12 800
- Диск данных P30
  - ОПЕРАЦИЙ ВВОДА-ВЫВОДА: 5 000
  - Кэширование узла: **только для чтения**

Когда выполняется чтение и нужные данные доступны в кэше, кэш возвращает запрошенные данные. Чтение с диска не требуется. Это чтение учитывается в отношении кэшированных ограничений виртуальной машины.

![Диаграмма, показывающая попадание в кэш кэширования узла чтения.](media/vm-disk-performance/host-caching-read-hit.jpg)

Когда выполняется чтение и требуемые *данные недоступны в* кэше, запрос на чтение передается на диск. Затем диск отображает его как для кэша, так и для виртуальной машины. Это чтение учитывается в отношении некэшированного ограничения виртуальной машины и кэшированного ограничения виртуальной машины.

![Схема, демонстрирующая промахи чтения кэширования узла чтения.](media/vm-disk-performance/host-caching-read-miss.jpg)

При выполнении записи запись должна быть записана как в кэш, так и на диск, прежде чем она считается завершенной. Эта запись учитывается в отношении некэшированного ограничения виртуальной машины и кэшированного ограничения виртуальной машины.

![Схема, на которой показано кэширование записи для чтения узла.](media/vm-disk-performance/host-caching-write.jpg)

Далее давайте посмотрим, что происходит с запросами ввода-вывода, если для параметра кэширования узла задано значение **чтение/запись**.

**Установки**

- Standard_D8s_v3
  - Кэшированные операции ввода-вывода: 16 000
  - Некэшированные операции ввода-вывода: 12 800
- Диск данных P30
  - ОПЕРАЦИЙ ВВОДА-ВЫВОДА: 5 000
  - Кэширование узла: **чтение и запись**

Чтение обрабатывается таким же образом, как и доступное только для чтения. Операции записи — это единственная вещь, которая отличается от кэширования чтения и записи. Если запись с кэшированием узла настроена на **чтение и запись**, запись должна быть записана в кэш узла, чтобы считаться завершенной. Затем запись отложенно записывается на диск в качестве фонового процесса. Это означает, что запись учитывается в отношении кэшированных операций ввода-вывода при записи в кэш. При отложенной запись на диск он подсчитывается к некэшированным операциям ввода-вывода.

![Схема, демонстрирующая запись кэширования узла для чтения и записи.](media/vm-disk-performance/host-caching-read-write.jpg)

Давайте продолжим работу с нашей Standard_D8s_v3 виртуальной машиной. За исключением этого времени, на дисках будет включено кэширование узла. Кроме того, теперь предельным числом операций ввода-вывода для виртуальной машины является 16 000. К виртуальной машине подключены три базовых диска P30, которые могут поддерживать 5 000 операций ввода-вывода в секунду.

**Установки**

- Standard_D8s_v3
  - Кэшированные операции ввода-вывода: 16 000
  - Некэшированные операции ввода-вывода: 12 800
- Диск ОС P30
  - ОПЕРАЦИЙ ВВОДА-ВЫВОДА: 5 000
  - Кэширование узла: **чтение и запись**
- Два диска данных P30 × 2
  - ОПЕРАЦИЙ ВВОДА-ВЫВОДА: 5 000
  - Кэширование узла: **чтение и запись**

![Схема, на которой показан пример кэширования узла.](media/vm-disk-performance/host-caching-example-without-remote.jpg)

Приложение использует Standard_D8s_v3 виртуальную машину с включенным кэшированием. Он выполняет запрос на 15 000 операций ввода-вывода в секунду. Запросы разбиваются как 5 000 операций ввода-вывода для каждого подключенного диска. Не происходит выделения производительности.

## <a name="combined-uncached-and-cached-limits"></a>Объединенные некэшированные и кэшированные ограничения

Кэшированные ограничения виртуальной машины отделены от некэшированных ограничений. Это означает, что можно включить кэширование узлов на дисках, подключенных к виртуальной машине, не разрешая кэширование узлов на других дисках. Эта конфигурация позволяет виртуальным машинам получить общий объем операций ввода-вывода хранилища для кэшированного ограничения и некэшированного ограничения.

Давайте рассмотрим пример, который поможет понять, как эти ограничения работают вместе. Мы будем продолжать работу с подключенной конфигурацией Standard_D8s_v3 виртуальной машины и уровня "Премиум".

**Установки**

- Standard_D8s_v3
  - Кэшированные операции ввода-вывода: 16 000
  - Некэшированные операции ввода-вывода: 12 800
- Диск ОС P30
  - ОПЕРАЦИЙ ВВОДА-ВЫВОДА: 5 000
  - Кэширование узла: **чтение и запись**
- Два диска данных P30 × 2
  - ОПЕРАЦИЙ ВВОДА-ВЫВОДА: 5 000
  - Кэширование узла: **чтение и запись**
- Два диска данных P30 × 2
  - ОПЕРАЦИЙ ВВОДА-ВЫВОДА: 5 000
  - Кэширование узла: **отключено**

![Схема, на которой показан пример кэширования узла с удаленным хранилищем.](media/vm-disk-performance/host-caching-example-with-remote.jpg)

В этом случае приложение, работающее на Standard_D8s_v3 виртуальной машине, выполняет запрос на 25 000 операций ввода-вывода в секунду. Запрос разбивается на все подключенные диски как 5 000 операций ввода-вывода в секунду. На трех дисках используется кэширование узлов, и два диска не используют кэширование узла.

- Так как три диска, использующие кэширование узла, находятся в пределах кэшированных данных 16 000, эти запросы успешно завершены. Не происходит выделения производительности хранилища.
- Так как два диска, которые не используют кэширование узлов, находятся в пределах некэшированных пределов 12 800, эти запросы также успешно завершены. Не происходит выделения.

## <a name="disk-performance-metrics"></a>Метрики производительности диска

У нас есть метрики в Azure, которые позволяют понять, как работают виртуальные машины и диски. Эти метрики можно просмотреть с помощью портал Azure. Их также можно получить с помощью вызова API. Метрики рассчитываются с интервалом в одну минуту. Доступны следующие метрики для получения сведений о виртуальных машинах и дисковых операциях ввода-вывода, а также о производительности пропускной способности.

- **Длина очереди диска ОС**: количество текущих необработанных запросов ввода-вывода, ожидающих чтения или запись на диск ОС.
- **Скорость чтения с диска ОС (байт/с**): количество байтов, считываемых с диска ОС в секунду.
- **Операций чтения с диска ОС/с**: количество операций ввода, считываемых в секунду с диска операционной системы.
- **Скорость записи на диск ОС (байт/с**): количество байтов, записанных в секунду с диска операционной системы.
- **Операций записи на диск ОС/с**: количество операций вывода, записанных в секунду с диска операционной системы.
- **Глубина диска данных**: количество текущих необработанных запросов ввода-вывода, ожидающих чтения или запись на диск (ы) данных.
- **Скорость чтения с диска данных (байт/с**): количество байтов, считываемых с дисков данных в секунду.
- **Операций чтения с диска данных/с**: количество операций ввода, считываемых в секунду с дисков данных.
- **Скорость записи на диск данных (байт/с**): количество байтов, записываемых в секунду с дисков данных.
- **Операций записи на диск данных/с**: количество операций вывода, записанных в секунду с дисков данных.
- **Скорость чтения с диска (байт/с**): общее количество байтов, считываемых в секунду со всех дисков, подключенных к виртуальной машине.
- **Операций чтения с диска/с**: количество операций ввода, считываемых в секунду со всех дисков, подключенных к виртуальной машине.
- **Скорость записи на диск (байт/с**): количество байтов, записанных в секунду со всех дисков, подключенных к виртуальной машине.
- **Операций записи на диск/с**: количество операций вывода, записанных в секунду со всех дисков, подключенных к виртуальной машине.

## <a name="storage-io-utilization-metrics"></a>Метрики использования операций ввода-вывода хранилища
Следующие метрики помогают диагностировать узкие места в сочетании виртуальной машины и диска. Эти метрики доступны только при использовании виртуальной машины с включенным Premium. Эти метрики доступны для всех типов дисков, за исключением Ultra. 

Метрики, помогающие диагностировать ограничения дискового ввода-вывода:

- **Процент использования дискового пространства операций ввода-вывода**: процент, вычисляемый диском данных операций ввода-вывода в секунду для подготовленного диска данных. Если это значение равно 100%, ваше приложение работает под пределами операций ввода-вывода, установленным на диске данных.
- **Процент использования пропускной способности диска данных**: процент, вычисленный пропускной способностью диска данных, завершенный по пропускной способности подготовленного диска данных. Если это значение равно 100%, то ваше приложение работает под пределами операций ввода-вывода с ограничением пропускной способности диска данных.
- **Процент использования диска операционной системы (операций ввода**-вывода): процент, вычисленный ДИСКом ОС число операций ввода-вывода в секунду для подготовленного диска операционной системы. Если это значение равно 100%, то запущенное приложение будет превышено на число операций ввода-вывода для диска ОС.
- **Процент использования пропускной способности диска ОС**: процентное значение, вычисленное пропускной СПОСОБНОСТЬЮ диска ОС, выполнено по пропускной способности диска подготовленной ОС. Если это значение равно 100%, то ваше приложение, для которого работает операция ввода-вывода, ограничено пропускной способностью диска ОС.

Метрики, помогающие выполнить диагностику операций ввода-вывода виртуальной машины:

- Объем **кэшированных операций ввода-вывода в кэше виртуальной машины**: процент, вычисленный по общему количеству операций ввода-вывода, выполненных по максимальному пределу кэшированных операций Если это значение равно 100%, то ваше приложение работает под пределами операций ввода-вывода с ограничением в кэшированной виртуальной машине.
- Объем **использованной пропускной способности кэшированной виртуальной машины**: процентное значение, вычисленное по общей пропускной способности диска, завершенное по максимальной пропускной способности виртуальной машины Если это значение равно 100%, то ваше приложение, для которого работает операция ввода-вывода, ограничено объемом кэшированной пропускной способности виртуальной машины.
- **Процент использования некэшированных операций ввода**-вывода виртуальной машины: процентное значение, вычисленное по общему числу операций ввода-вывода на виртуальной машине, завершенных по максимальному ограничению операций ввода-вывода виртуальной машины. Если это значение равно 100%, то запущенное приложение будет превышено на число операций ввода-вывода в кэше виртуальной машины.
- **Процент использования некэшированной пропускной способности виртуальной машины**: процентное значение, вычисленное по общей пропускной способности диска на виртуальной машине, завершилось по максимальной пропускной способности подготовленной виртуальной машины. Если это значение равно 100%, то ваше приложение, для которого работает операция ввода-вывода, ограничено ограничением пропускной способности виртуальной машины.

## <a name="storage-io-utilization-metrics-example"></a>Пример метрик использования операций ввода-вывода хранилища

Давайте проверим, как использовать эти новые метрики использования операций ввода-вывода хранилища для отладки, когда в системе есть узкое место. Настройка системы такая же, как в предыдущем примере, за исключением того, что подключенный диск ОС *не* кэшируется.

**Установки**

- Standard_D8s_v3
  - Кэшированные операции ввода-вывода: 16 000
  - Некэшированные операции ввода-вывода: 12 800
- Диск ОС P30
  - ОПЕРАЦИЙ ВВОДА-ВЫВОДА: 5 000
  - Кэширование узла: **отключено**
- Два диска данных P30 × 2
  - ОПЕРАЦИЙ ВВОДА-ВЫВОДА: 5 000
  - Кэширование узла: **чтение и запись**
- Два диска данных P30 × 2
  - ОПЕРАЦИЙ ВВОДА-ВЫВОДА: 5 000
  - Кэширование узла: **отключено**
