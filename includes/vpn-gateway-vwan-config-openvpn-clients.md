---
title: включить файл
description: включить файл
services: vpn-gateway
author: cherylmc
ms.service: vpn-gateway
ms.topic: include
ms.date: 03/17/2020
ms.author: cherylmc
ms.custom: include file
ms.openlocfilehash: 55fa01d100c60c6411774373428ff4bbd9a56822
ms.sourcegitcommit: 867cb1b7a1f3a1f0b427282c648d411d0ca4f81f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "80986650"
---
## <a name="windows-clients"></a><a name="windows"></a>Клиенты Windows

1. Скачайте и установите клиент Опенвпн (версии 2,4 или более поздней) на официальном [веб-сайте опенвпн](https://openvpn.net/index.php/open-source/downloads.html).
2. Загрузите профиль VPN для шлюза. Это можно сделать со вкладки конфигурации "точка — сеть" на портале Azure или с "New-AzVpnClientConfiguration" в PowerShell.
3. Распакуйте профиль. Затем откройте файл конфигурации *vpnconfig.ovpn* из папки OpenVPN в Блокноте.
4. Экспортируйте сертификат клиента "точка — сеть", созданный и отправленный в конфигурацию P2S на шлюзе. Используйте ссылки на следующие статьи:

   * Инструкции по [VPN-шлюзу](../articles/vpn-gateway/vpn-gateway-certificates-point-to-site.md#clientexport)
   
   * Инструкции для [виртуальной глобальной сети](../articles/virtual-wan/certificates-point-to-site.md#clientexport)
5. Извлеките закрытый ключ и отпечаток base64 из *PFX-файла*. Это можно сделать несколькими способами. Это можно сделать с помощью OpenSSL на компьютере. Файл *profileinfo.txt* содержит закрытый ключ, отпечаток для ЦС и сертификат клиента. Не забудьте использовать отпечаток сертификата клиента.

   ```
   openssl pkcs12 -in "filename.pfx" -nodes -out "profileinfo.txt"
   ```
6. Откройте *profileinfo.txt* в Блокноте. Чтобы получить отпечаток сертификата клиента (дочерний), выделите текст между "-----BEGIN CERTIFICATE-----" и "-----END CERTIFICATE-----" (включая эти строки) для дочернего сертификата и скопируйте его. Дочерний сертификат можно определить, просмотрев строку subject=/.
7. Переключитесь на файл *vpnconfig.ovpn*, который вы открыли в Блокноте на шаге 3. Найдите раздел, указанный ниже, и замените весь код между cert и /cert.

   ```
   # P2S client certificate
   # please fill this field with a PEM formatted cert
   <cert>
   $CLIENTCERTIFICATE
   </cert>
   ```
8. Откройте файл *profileinfo.txt* в Блокноте. Чтобы получить закрытый ключ, выберите текст (включая и между ними)-----начать закрытый ключ-----"и"-----конечный закрытый ключ-----"и скопируйте его.
9. Вернитесь к файлу vpnconfig.ovpn в Блокноте и найдите этот раздел. Вставьте закрытый ключ, заменив все между и key и /key.

   ```
   # P2S client root certificate private key
   # please fill this field with a PEM formatted key
   <key>
   $PRIVATEKEY
   </key>
   ```
10. Не изменяйте остальные поля. Для подключения к VPN используйте заполненную конфигурацию на входе клиента.
11. Скопируйте файл vpnconfig.ovpn в папку C:\Program Files\OpenVPN\config.
12. Щелкните правой кнопкой мыши значок OpenVPN в области уведомлений и щелкните "Подключить".

## <a name="mac-clients"></a><a name="mac"></a>Клиенты Mac

1. Скачайте и установите клиент Опенвпн, например [туннелбликк](https://tunnelblick.net/downloads.html). 
2. Загрузите профиль VPN для шлюза. Это можно сделать со вкладки конфигурации "точка — сеть" на портале Azure или с помощью "New-AzVpnClientConfiguration" в PowerShell.
3. Распакуйте профиль. Откройте файл конфигурации впнконфиг. ОВПН из папки Опенвпн в текстовом редакторе.
4. Заполните раздел сертификата клиента подключения "точка — сеть" открытым ключом сертификата клиента P2S в формате base64. В сертификате с форматированием PEM вы можете просто открыть файл CER и скопировать ключ в формате base64, находящийся между заголовками сертификата. В следующих статьях приведены ссылки на сведения о том, как экспортировать сертификат для получения закодированного открытого ключа:

   * Инструкции по [VPN-шлюзу](../articles/vpn-gateway/vpn-gateway-certificates-point-to-site.md#cer) 
   
   * Инструкции для [виртуальной глобальной сети](../articles/virtual-wan/certificates-point-to-site.md#cer)
5. Заполните раздел секретного ключа закрытым ключом сертификата клиента P2S в base64. Сведения о том, как извлечь закрытый ключ, см. в разделе [Экспорт закрытого ключа](https://openvpn.net/community-resources/how-to/#pki) на сайте опенвпн.
6. Не изменяйте остальные поля. Для подключения к VPN используйте заполненную конфигурацию на входе клиента.
7. Дважды щелкните файл профиля, чтобы создать профиль в Туннелбликк.
8. Запустите Туннелбликк из папки приложения.
9. Щелкните значок Туннелбликк в области уведомлений и выберите Подключить.

> [!IMPORTANT]
>Протокол OpenVPN поддерживают только iOS 11.0 и MacOS 10.13 и их более поздние версии.
>
## <a name="ios-clients"></a><a name="iOS"></a>Клиенты iOS

1. Установите клиент Опенвпн (версии 2,4 или более поздней) из App Store.
2. Загрузите профиль VPN для шлюза. Это можно сделать со вкладки конфигурации "точка — сеть" на портале Azure или с помощью "New-AzVpnClientConfiguration" в PowerShell.
3. Распакуйте профиль. Откройте файл конфигурации впнконфиг. ОВПН из папки Опенвпн в текстовом редакторе.
4. Заполните раздел сертификата клиента подключения "точка — сеть" открытым ключом сертификата клиента P2S в формате base64. В сертификате с форматированием PEM вы можете просто открыть файл CER и скопировать ключ в формате base64, находящийся между заголовками сертификата. В следующих статьях приведены ссылки на сведения о том, как экспортировать сертификат для получения закодированного открытого ключа:

   * Инструкции по [VPN-шлюзу](../articles/vpn-gateway/vpn-gateway-certificates-point-to-site.md#cer) 
   
   * Инструкции для [виртуальной глобальной сети](../articles/virtual-wan/certificates-point-to-site.md#cer)
5. Заполните раздел секретного ключа закрытым ключом сертификата клиента P2S в base64. Сведения о том, как извлечь закрытый ключ, см. в разделе [Экспорт закрытого ключа](https://openvpn.net/community-resources/how-to/#pki) на сайте опенвпн.
6. Не изменяйте остальные поля.
7. Отправьте файл профиля по электронной почте (. ОВПН) в учетную запись электронной почты, настроенную в приложении "почта" на устройстве iPhone. 
8. Откройте сообщение электронной почты в приложении "почта" на устройстве iPhone и коснитесь присоединенного файла.

    ![Открыть электронную почту](./media/vpn-gateway-vwan-config-openvpn-clients/ios2.png)

9. Коснитесь кнопки **больше** , если параметр **Копировать в опенвпн** не отображается.

    ![Подробнее](./media/vpn-gateway-vwan-config-openvpn-clients/ios3.png)

10. Коснитесь пункта " **Копировать в опенвпн** " 

    ![Копировать в Опенвпн](./media/vpn-gateway-vwan-config-openvpn-clients/ios4.png)

11. Коснитесь кнопки " **Добавить** " на странице " **Импорт профиля** "

    ![Добавить](./media/vpn-gateway-vwan-config-openvpn-clients/ios5.png)

12. Коснитесь кнопки **Добавить** на странице **импортированного профиля**

    ![Нажмите кнопку Добавить.](./media/vpn-gateway-vwan-config-openvpn-clients/ios6.png)

13. Запустите приложение Опенвпн и задвиньте переключатель на странице **профиля** вправо, чтобы подключиться.

    ![Подключение](./media/vpn-gateway-vwan-config-openvpn-clients/ios8.png)


## <a name="linux-clients"></a><a name="linux"></a>Клиенты Linux

1. Запустите новый сеанс терминала. Новый сеанс можно начать, нажав CTRL+ALT+Т.
2. Для установки необходимых компонентов введите следующую команду.

   ```
   sudo apt-get install openvpn
   sudo apt-get -y install network-manager-openvpn
   sudo service network-manager restart
   ```
3. Загрузите профиль VPN для шлюза. Это можно сделать со вкладки конфигурации "точка — сеть" на портале Azure.
4. Экспортируйте сертификат клиента P2S, который вы создали и отправили в конфигурацию P2S на шлюзе. Используйте ссылки на следующие статьи:

   * Инструкции по [VPN-шлюзу](../articles/vpn-gateway/vpn-gateway-certificates-point-to-site.md#clientexport) 
   
   * Инструкции для [виртуальной глобальной сети](../articles/virtual-wan/certificates-point-to-site.md#clientexport)
5. Извлеките закрытый ключ и отпечаток base64 из PFX-файла. Это можно сделать несколькими способами. Это можно сделать с помощью OpenSSL на компьютере.

    ```
    openssl pkcs12 -in "filename.pfx" -nodes -out "profileinfo.txt"
    ```
   Файл *profileinfo.txt* содержит закрытый ключ, отпечаток для ЦС и сертификат клиента. Не забудьте использовать отпечаток сертификата клиента.

6. Откройте файл *profileinfo.txt* в текстовом редакторе. Чтобы получить отпечаток сертификата клиента (дочерний), выделите текст между "-----BEGIN CERTIFICATE-----" и "-----END CERTIFICATE-----", включая эти строки, для дочернего сертификата и скопируйте его. Дочерний сертификат можно определить, просмотрев строку subject=/.

7. Откройте файл *vpnconfig.ovpn* и найдите раздел, показанный ниже. Замените весь код между cert и /cert.

   ```
   # P2S client certificate
   # please fill this field with a PEM formatted cert
   <cert>
   $CLIENTCERTIFICATE
   </cert>
   ```
8. Откройте файл profileinfo.txt в текстовом редакторе. Чтобы получить закрытый ключ, выберите текст, включая и между "-----начать закрытый ключ-----" и "-----конечный закрытый ключ-----", и скопируйте его.

9. Откройте файл vpnconfig.ovpn в текстовом редакторе и найдите этот раздел. Вставьте закрытый ключ, заменив все между и key и /key.

   ```
   # P2S client root certificate private key
   # please fill this field with a PEM formatted key
   <key>
   $PRIVATEKEY
   </key>
   ```

10. Не изменяйте остальные поля. Для подключения к VPN используйте заполненную конфигурацию на входе клиента.
11. Чтобы подключиться с помощью командной строки, введите следующую команду:
  
    ```
    sudo openvpn --config <name and path of your VPN profile file>&
    ```
12. Чтобы подключиться с помощью графического пользовательского интерфейса, перейдите в параметры системы.
13. Щелкните **+** , чтобы добавить новое VPN-подключение.
14. В разделе **Добавить VPN** выберите **Импорт из файла...**
15. Просмотрите файл профиля и дважды щелкните или выберите **Открыть**.
16. Щелкните **Добавить** в окне **Добавить VPN**.
  
    ![Импорт из файла](./media/vpn-gateway-vwan-config-openvpn-clients/import.png)
17. Вы можете подключиться, выбрав для VPN **Вкл.** на странице **Параметры сети** или под значком сети на панели задач.
