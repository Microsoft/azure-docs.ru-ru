---
author: dominicbetts
ms.author: dobett
ms.service: iot-pnp
ms.topic: include
ms.date: 11/20/2020
ms.openlocfilehash: 607c83bd97f8e371896a5a8ac0c9aa05ab34fa2c
ms.sourcegitcommit: f28ebb95ae9aaaff3f87d8388a09b41e0b3445b5
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/29/2021
ms.locfileid: "95511685"
---
В этом кратком руководстве показано, как создать пример приложения устройства IoT Plug and Play, подключить его к Центру Интернета вещей и с помощью обозревателя Интернета вещей Azure просмотреть данные телеметрии, которые он отправляет. Пример приложения написан на языке Python и включен в пакет SDK для устройств Центра Интернета вещей Azure для Python. Разработчик решения может использовать обозреватель Интернета вещей Azure, чтобы ознакомиться с возможностями устройства IoT Plug and Play, не просматривая код устройства.

## <a name="prerequisites"></a>Предварительные требования

[!INCLUDE [iot-pnp-prerequisites](iot-pnp-prerequisites.md)]

Для выполнения инструкций, приведенных в этом кратком руководстве, на компьютере для разработки необходимо установить Python 3.7. Вы можете скачать последнюю рекомендуемую версию для нескольких платформ на сайте [python.org](https://www.python.org/). Проверить версию Python можно с помощью следующей команды:  

```cmd/sh
python --version
```

В локальной среде Python установите пакет следующим образом:

```cmd/sh
pip install azure-iot-device
```

Клонируйте репозиторий пакета SDK центра Интернета вещей для Python и извлеките **образец**:

```cmd/sh
git clone https://github.com/Azure/azure-iot-sdk-python
```

## <a name="run-the-sample-device"></a>Запуск примера устройства

В папке *azure-iot-sdk-python\azure-iot-device\samples\pnp* содержится пример кода для устройства IoT Plug and Play. В этом кратком руководстве используется файл *simple_thermostat.py*. Этот пример кода реализует устройство, совместимое с IoT Plug and Play, и использует клиентскую библиотеку устройства Python для Интернета вещей Azure.

Откройте файл **simple_thermostat.py** в текстовом редакторе. Обратите внимание на следующее:

1. Определяет один идентификатор модели двойника устройства (DTMI), который является уникальным идентификатором [термостата](https://github.com/Azure/opendigitaltwins-dtdl/blob/master/DTDL/v2/samples/Thermostat.json). DTMI должен быть известным пользователю и изменяться в зависимости от сценария реализации устройства. Для текущего примера модель представляет термостат с данными телеметрии, свойствами и командами, связанными с температурой мониторинга.

1. Содержит функции для определения реализаций обработчика команд. Эти обработчики создаются, чтобы определить, как устройство отвечает на запросы команд.

1. Содержит функцию для определения ответа команды. Функции ответа команды создаются для отправки ответа обратно в центр Интернета вещей.

1. Определяет функцию прослушивателя клавиатуры ввода, которая позволяет выйти из приложения.

1. Имеет функцию **main**. Функция **main**:

    1. Использует пакет SDK для устройств для создания клиента устройства и подключения к центру Интернета вещей.

    1. Обновляет свойства. Используемая модель, **Thermostat**, определяет в качестве свойств Thermostat `targetTemperature` и `maxTempSinceLastReboot`, поэтому мы будем использовать их. Свойства обновляются с помощью метода `patch_twin_reported_properties`, определенного в `device_client`.

    1. Начинает прослушивание запросов команд с помощью функции **execute_command_listener**. Функция настраивает прослушиватель на ожидание передачи данных от команд службы. При настройке прослушивателя вы предоставляете параметры `method_name`, `user_command_handler`, а также `create_user_response_handler`.
        - Функция `user_command_handler` определяет действия устройства при получении команды. Например, если будильник отключается, результатом получения этой команды будут сведения о том, что вы проснулись. Считайте это "эффектом" вызываемой команды.
        - Функция `create_user_response_handler` создает ответ, который будет отправлен в центр Интернета вещей при успешном выполнении команды. Например, если вы отключаете будильник или откладываете сигнал, что является отзывом о службе. Это можно рассматривать как ответ, предоставленный службе. Этот ответ можно просмотреть на портале.

    1. Начинает отправку телеметрии. Метод **pnp_send_telemetry** определен в файле pnp_methods.py. В примере кода используется цикл, который вызывает эту функцию каждые восемь секунд.

    1. Отключает все прослушиватели и задачи и выходит из цикла при нажатии кнопки **Q** или **q**.

[!INCLUDE [iot-pnp-environment](iot-pnp-environment.md)]

Дополнительные сведения о примере конфигурации см. в [образце файла сведений](https://github.com/Azure/azure-iot-sdk-python/blob/master/azure-iot-device/samples/pnp/README.md).

Теперь, когда вы просмотрели код, выполните следующую команду, чтобы запустить пример:

```cmd/sh
python simple_thermostat.py
```

Вы увидите приведенный ниже результат, который указывает на то, что устройство отправляет телеметрию в центр и готово к получению команд и обновлений свойств.

```cmd/sh
Listening for command requests and property updates
Press Q to quit
Sending telemetry for temperature
Sent message
```

Продолжите работу примера, после того как выполните следующие действия.

## <a name="use-azure-iot-explorer-to-validate-the-code"></a>Проверка кода с помощью обозревателя Интернета вещей Azure

После запуска примера клиента устройства используйте обозреватель Интернета вещей Azure, чтобы убедиться, что он работает.

[!INCLUDE [iot-pnp-iot-explorer.md](iot-pnp-iot-explorer.md)]
