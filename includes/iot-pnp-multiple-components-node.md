---
author: dominicbetts
ms.author: dobett
ms.service: iot-pnp
ms.topic: include
ms.date: 11/20/2020
ms.openlocfilehash: 1d54429d901ca6caeadabfa7580e7270ceabcf45
ms.sourcegitcommit: f28ebb95ae9aaaff3f87d8388a09b41e0b3445b5
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/30/2021
ms.locfileid: "104612830"
---
В этом руководстве показано, как создать пример приложения устройства IoT Plug and Play с компонентами, подключить его к центру Интернета вещей и с помощью обозревателя Интернета вещей Azure просмотреть сведения, отправляемые в центр. Пример приложения написан для Node.js и включен в пакет SDK для устройств Центра Интернета вещей Azure для Node.js. Разработчик решения может использовать обозреватель Интернета вещей Azure, чтобы ознакомиться с возможностями устройства IoT Plug and Play, не просматривая код устройства.

Изучив это руководство, вы:

> [!div class="checklist"]
> * Скачайте пример кода.
> * Запустите пример приложения устройства и проверьте, подключается ли оно к вашему центру Интернета вещей.
> * Просмотрите исходный код.

## <a name="prerequisites"></a>Предварительные требования

[!INCLUDE [iot-pnp-prerequisites](iot-pnp-prerequisites.md)]

Для выполнения инструкций, приведенных в этом учебнике, на компьютере для разработки необходимо установить платформу Node.js. Вы можете скачать последнюю рекомендуемую версию для нескольких платформ на сайте [nodejs.org](https://nodejs.org).

Текущую версию Node.js на компьютере, на котором ведется разработка, можно проверить, используя следующую команду:

```cmd/sh
node --version
```

## <a name="download-the-code"></a>Загрузка кода

Если вы ознакомились с [Кратким руководством по подключению примера приложения устройства IoT Plug and Play в Windows к Центру Интернета вещей (Node)](../articles/iot-pnp/quickstart-connect-device.md), значит вы уже клонировали репозиторий.

Откройте командную строку в выбранном каталоге. Выполните следующую команду для клонирования репозитория [пакетов SDK для Интернета вещей Microsoft Azure для Node.js](https://github.com/Azure/azure-iot-sdk-node) с GitHub в это расположение:

```cmd/sh
git clone https://github.com/Azure/azure-iot-sdk-node
```

## <a name="install-required-libraries"></a>Установка обязательных библиотек

Используйте пакет SDK для устройств, чтобы выполнить сборку прилагаемого примера кода. Создаваемое приложение имитирует многокомпонентное устройство Plug and Play, которое подключается к центру Интернета вещей. Оно отправляет данные телеметрии и свойства, а также получает команды.

1. В окне локального терминала перейдите в папку клонированного репозитория, а затем в папку */azure-iot-sdk-node/device/samples/pnp*. Затем выполните следующую команду, чтобы установить обязательные библиотеки:

```cmd/sh
npm install
```

При этом будут установлены соответствующие NPM-файлы, необходимые для выполнения примеров в папке.

## <a name="review-the-code"></a>Просмотр кода

Перейдите в папку *azure-iot-sdk-node\device\samples\pnp*.

В папке *azure-iot-sdk-node\device\samples\pnp* содержится пример кода для устройства контроллера температуры IoT Plug and Play.

Код в файле *pnpTemperatureController.js* реализует устройство контроллера температуры IoT Plug and Play. Модель, которую реализует этот пример, использует [несколько компонентов](../articles/iot-pnp/concepts-modeling-guide.md). [Файл модели языка определения Digital Twins (DTDL) для устройства определения температуры](https://github.com/Azure/opendigitaltwins-dtdl/blob/master/DTDL/v2/samples/TemperatureController.json) определяет телеметрию, свойства и команды, реализуемые устройством.

Откройте файл *pnpTemperatureController.js* в предпочитаемом редакторе кода. В примере кода показано, как:

- Определяет идентификатор `modelId`, который является DTMI для реализуемого устройства. Этот DTMI определяется пользователем и должен соответствовать DTMI [модели DTDL контроллера температуры](https://github.com/Azure/opendigitaltwins-dtdl/blob/master/DTDL/v2/samples/TemperatureController.json).

- Реализуйте компоненты, определенные в модели DTDL контроллера температуры. Компоненты в реальном контроллере температуры должны реализовывать эти два интерфейса. Эти два интерфейса уже опубликованы в центральном репозитории. В этом примере этими двумя интерфейсами являются:

  - Терморегулятор
  - Сведения об устройстве, разработанном Azure.

- Определить имена компонентов. В этом примере содержится два терморегулятора и один информационный компонент устройства.

- Определить имя команды. Это команды, на которые отвечает устройство.

- Определить `serialNumber` константы. `serialNumber` закрепляется за каждым заданным устройством.

- Определить обработчики команд.

- Определить функции, предназначенные для отправки ответов команд.

- Определить вспомогательные функции, предназначенные для регистрации запросов команд.

- Определить вспомогательную функцию для создания свойств.

- Определить прослушиватель обновлений свойств.

- Определить функцию для отправки данных телеметрии с этого устройства. Данные телеметрии отправляются с помощью терморегуляторов и компонента по умолчанию. Эта функция получает имя компонента в качестве параметра.

- Определить функцию `main`, которая:

  - Использует пакет SDK для устройств для создания клиента устройства и подключения к центру Интернета вещей. Устройство предоставляет `modelId`, чтобы Центр Интернета вещей мог определить устройство IoT Plug and Play.

  - Начинает прослушивание запросов команд с помощью функции `onDeviceMethod`. Функция настраивает прослушиватель для запросов команд от службы.

    - DTDL устройства определяют команды `reboot` и `getMaxMinReport`.
    - Функция `commandHandler` определяет способ реагирования устройства на команду.

  - Начинает отправку данных телеметрии с помощью `setInterval` и `sendTelemetry`.

  - Использует функцию `helperCreateReportedPropertiesPatch`, чтобы создавать свойства, а `updateComponentReportedProperties` — чтобы их обновлять.

  - Использует `desiredPropertyPatchListener` для прослушивания обновлений свойств.

  - Отключает все прослушиватели и задачи и выходит из цикла при нажатии кнопки **Q** или **q**.

[!INCLUDE [iot-pnp-environment](iot-pnp-environment.md)]

Дополнительные сведения о примере конфигурации см. в [образце файла сведений](https://github.com/Azure/azure-iot-sdk-node/blob/master/device/samples/pnp/readme.md).

Теперь, когда вы просмотрели код, выполните следующую команду, чтобы запустить пример:

```cmd\sh
node pnpTemperatureController.js
```

Вы увидите приведенный ниже результат, который указывает на то, что устройство начало отправлять данные телеметрии в центр и готово к получению команд и обновлений свойств.

![Сообщения о подтверждении устройства](media/iot-pnp-multiple-components-node/multiple-component.png)

Продолжите работу примера, после того как выполните следующие действия.

## <a name="use-azure-iot-explorer-to-validate-the-code"></a>Проверка кода с помощью обозревателя Интернета вещей Azure

После запуска примера клиента устройства используйте обозреватель Интернета вещей Azure, чтобы убедиться, что он работает.

[!INCLUDE [iot-pnp-iot-explorer.md](iot-pnp-iot-explorer.md)]
