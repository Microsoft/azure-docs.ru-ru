---
title: включить файл
description: включить файл
services: storage
author: fauhse
ms.service: storage
ms.topic: include
ms.date: 2/20/2020
ms.author: fauhse
ms.custom: include file
ms.openlocfilehash: a142de62f1ab7046d47c29753863b16864d97536
ms.sourcegitcommit: 3ee3045f6106175e59d1bd279130f4933456d5ff
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/31/2021
ms.locfileid: "106075625"
---
Ключи шифрования данных службы используются для шифрования конфиденциальных данных клиентов, например учетных данных учетной записи, которые отправляются из службы StorSimple Manager к устройству StorSimple. Необходимо будет периодически менять эти ключи, если у ИТ-организации есть политика ротации ключей на устройствах хранения. Процесс изменения ключа может немного отличаться в зависимости от того, имеется ли одно или несколько устройств, управляемых службой StorSimple Manager. Дополнительные сведения см. в статье [Защита устройства StorSimple и данных](../articles/storsimple/storsimple-8000-security.md).

Процесс изменения ключа шифрования данных службы включает 3 шага.

1. С помощью скриптов Windows PowerShell для Azure Resource Manager авторизуйте устройство, чтобы изменить ключ шифрования данных службы.
2. С помощью Windows PowerShell для StorSimple инициируйте изменение ключа шифрования данных службы.
3. Если у вас более одного устройства StorSimple, обновите ключ шифрования данных службы на других устройствах.

### <a name="step-1-use-windows-powershell-script-to-authorize-a-device-to-change-the-service-data-encryption-key"></a>Шаг 1. Использование скрипта Windows PowerShell для авторизации изменения ключа шифрования данных службы на устройстве
Как правило, администратор устройства отправляет администратору службы запрос на авторизацию устройство, чтобы изменить ключи шифрования данных службы. Администратор службы авторизует устройство для изменения ключа.

Этот шаг выполняется с помощью скрипта на основе Azure Resource Manager. Администратор служб может выбрать устройство для авторизации. Устройство авторизуется для начала изменения ключа шифрования данных службы. 

Дополнительные сведения об использовании скрипта см. в статье [Authorize-ServiceEncryptionRollover.ps1](https://github.com/anoobbacker/storsimpledevicemgmttools/blob/master/Authorize-ServiceEncryptionRollover.ps1)

#### <a name="which-devices-can-be-authorized-to-change-service-data-encryption-keys"></a>Какие устройства можно авторизовать для изменения ключей шифрования данных службы?
Чтобы устройству можно было разрешить инициировать изменение ключа шифрования данных службы, оно должно удовлетворять следующим условиям.

* Устройство должно быть подключено к сети для авторизации изменения ключа шифрования данных службы.
* Одно устройство можно авторизовать еще раз через 30 минут, если изменение ключа не было запрошено.
* Можно авторизовать другое устройство, если изменение ключа не было инициировано ранее авторизованным устройством. После авторизации нового устройства старое не сможет инициировать изменение.
* Невозможно авторизовать устройство во время смены ключа шифрования данных службы.
* Можно авторизовать устройство, если некоторые из зарегистрированных в службе устройств изменили шифрование, а другие — нет. 

### <a name="step-2-use-windows-powershell-for-storsimple-to-initiate-the-service-data-encryption-key-change"></a>Шаге 2. Использование Windows PowerShell для StorSimple для изменения ключа шифрования данных службы
Этот шаг выполняется в интерфейсе Windows PowerShell для StorSimple на авторизованном устройстве StorSimple.

> [!NOTE]
> До завершения смены ключей на портале Azure службы StorSimple Manager не могут выполняться никакие операции.


Если вы используете последовательную консоль устройства выполните следующие действия для подключения к интерфейсу Windows PowerShell.

#### <a name="to-initiate-the-service-data-encryption-key-change"></a>Запуск изменения ключа шифрования данных службы
1. Выберите вариант 1, чтобы войти на устройство с правами на полный доступ.
2. В командной строке введите:
   
     `Invoke-HcsmServiceDataEncryptionKeyChange`
3. После успешного завершения работы командлета вы получите новый ключ шифрования данных службы. Скопируйте и сохраните этот ключ для использования на шаге 3. Этот ключ будет использоваться для обновления всех остальных устройств, зарегистрированных в службе StorSimple Manager.
   
   > [!NOTE]
   > Этот процесс должен быть запущен в течение четырех часов авторизации устройства StorSimple.
   > 
   > 
   
   Затем новый ключ отправляется службе для распространения на всех зарегистрированных устройствах. На панели мониторинга службы появится предупреждение. Служба отключит все операция на зарегистрированных устройствах, а администратору устройств потребуется обновить ключ шифрования данных службы на других устройствах. Однако операции ввода-вывода (компьютеры, отправляющие данные в облако) не будет прерваны.
   
   Если в службе зарегистрировано одно устройство, процесс замены завершен, а следующий шаг можно пропустить. Если в службе зарегистрировано несколько устройств, перейдите к шагу 3.

### <a name="step-3-update-the-service-data-encryption-key-on-other-storsimple-devices"></a>Шаг 3. Обновление ключа шифрования данных службы на других устройствах StorSimple
Эти действия необходимо выполнить в интерфейсе Windows PowerShell устройства StorSimple при наличии нескольких устройств, зарегистрированных в службе StorSimple Manager. Ключ, полученный на шаге 2, следует использовать для обновления остальных устройств StorSimple, зарегистрированных в службе StorSimple Manager.

Выполните следующие действия для обновления шифрования данных службы на устройстве.

#### <a name="to-update-the-service-data-encryption-key-on-physical-devices"></a>Обновление ключа шифрования данных службы на физических устройствах
1. Используйте Windows PowerShell для StorSimple, чтобы подключиться к консоли. Выберите вариант 1, чтобы войти на устройство с правами на полный доступ.
2. В командной строке введите следующий текст: `Invoke-HcsmServiceDataEncryptionKeyChange – ServiceDataEncryptionKey`.
3. Укажите ключ шифрования данных службы, полученный на [Шаге 2. Использование Windows PowerShell для StorSimple для изменения ключа шифрования данных службы](#to-initiate-the-service-data-encryption-key-change).

#### <a name="to-update-the-service-data-encryption-key-on-all-the-80108020-cloud-appliances"></a>Обновление ключа шифрования данных службы на всех облачных устройствах 8010/8020
1. Скачайте и установите сценарий PowerShell [Update-CloudApplianceServiceEncryptionKey.ps1](https://github.com/anoobbacker/storsimpledevicemgmttools/blob/master/Update-CloudApplianceServiceEncryptionKey.ps1). 
2. Откройте PowerShell и введите следующую команду в командной строке: `Update-CloudApplianceServiceEncryptionKey.ps1 -SubscriptionId [subscription] -TenantId [tenantid] -ResourceGroupName [resource group] -ManagerName [device manager]`

Этот сценарий гарантирует, что ключ шифрования служебных данных будет установлен на всех облачных устройствах 8010/8020 в диспетчере устройств.