---
title: включить файл
description: включить файл
services: notification-hubs
author: sethmanheim
ms.service: notification-hubs
ms.topic: include
ms.date: 02/10/2020
ms.author: sethm
ms.custom: include file
ms.openlocfilehash: 7b5034f2163e8478d7ddb7b9271402b094a809d7
ms.sourcegitcommit: f28ebb95ae9aaaff3f87d8388a09b41e0b3445b5
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/29/2021
ms.locfileid: "95564020"
---
## <a name="generate-the-certificate-signing-request-file"></a>Создание файла запроса на подписывание сертификата

Служба push-уведомлений Apple (APNs) использует сертификаты для аутентификации push-уведомлений. Следуйте приведенным указаниям, чтобы создать сертификата push-уведомлений, необходимый для отправки и получения уведомлений. Дополнительные сведения об этих понятиях см. в официальной документации по [Службе push-уведомлений Apple](https://developer.apple.com/library/archive/documentation/NetworkingInternet/Conceptual/RemoteNotificationsPG/APNSOverview.html).

Создайте файл запроса на подписывание сертификата (CSR), используемый Apple для создания подписанного сертификата push-уведомлений.

1. На компьютере Mac запустите средство Keychain Access. Его можно запустить из папки **Служебные программы** или **Другое** на панели запуска.

1. Нажмите **Связка ключей**, разверните **Помощник по сертификатам**, а затем выберите **Запросить сертификат в центре сертификации**.

    ![Использование Keychain Access для запрашивания нового сертификата](./media/notification-hubs-enable-apple-push-notifications/notification-hubs-request-cert-from-ca.png)

   > [!NOTE]
   > По умолчанию при осуществлении доступа к цепочке ключей выбирается первый элемент списка. Это может вызвать проблемы, если у вас открыта категория **сертификатов** и **центр сертификации Apple Worldwide Developer Relations** не указан в списке первым. Прежде чем создавать CSR (запрос на подписывание сертификата), убедитесь, что выбран элемент, не являющийся ключом, или ключ **центра сертификации Apple Worldwide Developer Relations**.

1. Заполните поля **Адрес электронной почты пользователя** и **Личное имя**, выберите **Сохранено на диск**, а затем — **Продолжить**. Оставьте поле **Адрес электронной почты ЦС** пустым, так как оно является необязательным.

    ![Требуемые сведения о сертификате](./media/notification-hubs-enable-apple-push-notifications/notification-hubs-csr-info.png)

1. Задайте имя CSR-файлу в поле **Сохранить как**, выберите расположение в поле **Где** и нажмите кнопку **Сохранить**.

    ![Выбор имени файла для сертификата](./media/notification-hubs-enable-apple-push-notifications/notification-hubs-save-csr.png)

    При этом CSR-файл сохраняется в выбранном месте. Расположением по умолчанию является **рабочий стол**. Запомните расположение, выбранное для файла.

Теперь вам нужно зарегистрировать приложение в Apple, включить push-уведомления и передать экспортированный CSR-файл для создания сертификата push-уведомлений.

## <a name="register-your-app-for-push-notifications"></a>Регистрация приложения для работы с push-уведомлениями

Чтобы отправлять push-уведомления в приложение iOS, зарегистрируйте приложение в системе Apple, а также зарегистрируйте его для получения push-уведомлений.  

1. Если вы еще не зарегистрировали свое приложение, перейдите на [портал подготовки iOS](https://go.microsoft.com/fwlink/p/?LinkId=272456) в центре разработчиков Apple. Войдите на портал с помощью идентификатора Apple ID и выберите **Identifiers** (Идентификаторы). Затем выберите **+** , чтобы зарегистрировать новое приложение.

    ![Страница с идентификаторами приложения на портале подготовки iOS](./media/notification-hubs-enable-apple-push-notifications/notification-hubs-ios-appids.png)

2. На экране **Register a New Identifier** (Зарегистрировать новый идентификатор) выберите переключатель **App IDs** (Идентификаторы приложений). Затем выберите **Continue** (Продолжить).

    ![Страница регистрации нового идентификатора на портале подготовки iOS](./media/notification-hubs-enable-apple-push-notifications/notification-hubs-ios-appids-new.png)

3. Обновите следующие три значения для нового приложения и нажмите кнопку **Continue** (Продолжить).

   * **Описание**: Введите описательное имя для приложения.

   * **Bundle ID** (Идентификатор пакета). Введите идентификатор пакета в форму **Organization Identifier.Product Name** (Идентификатор организации.Имя продукта), как описано в [руководстве по распространению приложения](https://help.apple.com/xcode/mac/current/#/dev91fe7130a). Значения *Organization Identifier* (Идентификатор организации) и *Product Name* (Имя продукта) должны соответствовать идентификатору организации и имени продукта, указанным при создании проекта Xcode. На следующем снимке экрана значение **NotificationHubs** используется как идентификатор организации, а значение **GetStarted** — как название продукта. Убедитесь, что значение **Bundle Identifier** (Идентификатор пакета) совпадает со значением из проекта Xcode, чтобы в Xcode использовался правильный профиль публикации.

      ![Страница регистрации идентификатора приложения на портале подготовки iOS](./media/notification-hubs-enable-apple-push-notifications/notification-hubs-new-appid-bundle.png)

   * **Push-уведомления**. Проверьте опцию **Push Notifications** (Push-уведомления) в разделе **Capabilities** (Возможности).

      ![Форма для регистрации нового идентификатора приложения](./media/notification-hubs-enable-apple-push-notifications/notification-hubs-new-appid-push.png)

      При этом будет создан идентификатор вашего приложения, а также запрошено подтверждение информации. Выберите **Continue** (Продолжить), а затем нажмите **Register** (Зарегистрировать), чтобы подтвердить новый идентификатор приложения.

      ![Подтверждение нового идентификатора приложения](./media/notification-hubs-enable-apple-push-notifications/notification-hubs-new-appid-register.png)

      После выбора **Register** (Зарегистрировать) вы увидите новый идентификатор приложения в виде элемента строки на странице **Certificates, Identifiers & Profiles** (Сертификаты, идентификаторы и профили).

4. На странице **Certificates, Identifiers & Profiles** (Сертификаты, идентификаторы и профили) в разделе **Identifiers** (Идентификаторы) перейдите к только что созданному элементу строки идентификатора приложения и выберите соответствующую строку, чтобы отобразить окно **Edit your App ID Configuration** (Изменить конфигурацию идентификатора приложения).

## <a name="creating-a-certificate-for-notification-hubs"></a>Создание сертификата для Центров уведомлений
Сертификат нужен для того, чтобы центр уведомлений мог работать с **APNs**. Создать его можно двумя способами:

1. Создайте сертификат **.p12**, который можно отправить прямо в концентратор уведомлений.  
2. Создайте сертификат **.p8**, который можно использовать для [проверки подлинности на основе токена](../articles/notification-hubs/notification-hubs-push-notification-http2-token-authentication.md) (*новый подход*).

Новый подход имеет ряд преимуществ по сравнению с подходом на основе сертификатов (см. сведения о [проверке подлинности на основе токена (HTTP/2) для APNs](../articles/notification-hubs/notification-hubs-push-notification-http2-token-authentication.md)). В этой статье приводятся инструкции, применимые в рамках обоих подходов. 

### <a name="option-1-creating-a-p12-push-certificate-that-can-be-uploaded-directly-to-notification-hub"></a>Вариант 1. Создание сертификата .p12 службы push-уведомлений, который можно отправить прямо в концентратор уведомлений

1. Прокрутите вниз до отмеченной опции **Push Notifications** (Push-уведомления), а затем выберите **Configure** (Настроить), чтобы создать сертификат.

    ![Страница изменения идентификатора приложения](./media/notification-hubs-enable-apple-push-notifications/notification-hubs-edit-appid.png)

2. Откроется окно **Apple Push Notification service SSL Certificates** (SSL-сертификаты службы push-уведомлений Apple). Нажмите кнопку **Create Certificate** (Создать сертификат) в разделе **Development SSL Certificate** (SSL-сертификат разработки).

    ![Кнопка создания сертификата для идентификатора приложения](./media/notification-hubs-enable-apple-push-notifications/notification-hubs-appid-create-cert.png)

    Появится экран **Create a new Certificate** (Создать новый сертификат).

    > [!NOTE]
    > В этом руководстве применяется сертификат разработки, который приложение будет использовать для создания уникального маркера устройства. Тот же процесс используется при регистрации сертификата производства. Только убедитесь, что при отправке уведомлений используется тот же тип сертификата.

3. Нажмите **Choose File** (Выбрать файл), перейдите к папке, в которой сохранен CSR-файл, созданный в первом задании, и дважды щелкните по имени сертификата, чтобы загрузить его. Затем выберите **Continue** (Продолжить).

4. После того как сертификат будет создан на портале, нажмите кнопку **Download** (Скачать). Сохраните сертификат и запомните расположение, в котором он сохранен.

    ![Страница скачивания созданного сертификата](./media/notification-hubs-enable-apple-push-notifications/notification-hubs-appid-download-cert.png)

    При этом сертификат будет скачан и сохранен на вашем компьютере в папке **Загрузки**.

    ![Поиск файла сертификата в папке "Загрузки"](./media/notification-hubs-enable-apple-push-notifications/notification-hubs-cert-downloaded.png)

    > [!NOTE]
    > Скачанному сертификату разработки по умолчанию задано имя **aps_development.cer**.

5. Дважды щелкните скачанный сертификат push-уведомлений **aps_development.cer**. При этом новый сертификат устанавливается в Keychain, как на следующем изображении.

    ![Список сертификатов Keychain Access с новым сертификатом](./media/notification-hubs-enable-apple-push-notifications/notification-hubs-cert-in-keychain.png)

    > [!NOTE]
    > Имя вашего сертификата может отличаться, но оно будет начинаться с префикса **Apple Development iOS Push Services**.

6. В программе Keychain Access щелкните правой кнопкой мыши новый сертификат push-уведомлений, созданный в категории **Certificates** (Сертификаты). Щелкните **Export** (Экспорт), укажите имя файла, выберите формат **P12** и нажмите кнопку **Save** (Сохранить).

    ![Экспорт сертификата в формате р12](./media/notification-hubs-enable-apple-push-notifications/notification-hubs-export-cert-p12.png)

    Вы можете выбрать защиту сертификата с помощью пароля, но это необязательно. Нажмите кнопку **ОК**, если хотите обойти создание пароля. Запишите имя файла и расположение экспортируемого сертификата в формате P12. Они нужны для аутентификации с помощью APNs.

    > [!NOTE]
    > Имя файла в формате P12 и его расположение могут отличаться от изображенных в этом учебнике.

### <a name="option-2-creating-a-p8-certificate-that-can-be-used-for-token-based-authentication"></a>Вариант 2. Создание сертификата .p8, который можно использовать для проверки подлинности на основе токена

1. Запишите следующие значения:

    - значение **App ID Prefix** (Префикс идентификатора приложения) — это **Team ID** (Идентификатор команды);
    - значение **Bundle ID** (Идентификатор пакета).
    
2. Вернитесь на страницу **Certificates, Identifiers & Profiles** (Сертификаты, идентификаторы и профили), щелкните **Keys** (Ключи).

   > [!NOTE]
   > Если вы уже настроили ключ для **APNs**, можете повторно использовать сертификат .p8, который вы скачали после его создания. В таком случае можно пропустить шаги **3**–**5**.

3. Чтобы создать ключ, нажмите кнопку **+** (кнопка **Create a key** (Создать ключ)).
4. Укажите подходящее значение в поле **Key Name** (Имя ключа), установите флажок **Apple Push Notifications service (APNs)** (Служба push-уведомлений Apple (APNs)), щелкните **Continue** (Продолжить) и на следующем экране нажмите кнопку **Register** (Зарегистрировать).
5. Щелкните **Download** (Скачать), переместите файл с расширением **.p8** (с префиксом *AuthKey_* ) в защищенный локальный каталог и нажмите кнопку **Готово**.

   > [!NOTE] 
   > Обязательно сохраните файл с расширением .p8 в безопасном месте и сохраните его резервную копию. Скачав ключ один раз, вы не сможете скачать его повторно, так как копия ключа удаляется с сервера.
  
6. В разделе **Ключи** щелкните имя ключа, который вы только что создали, или имя существующего ключа, если вы решили использовать его.
7. Запишите значение **Key ID** (Идентификатор ключа).
8. Откройте файл сертификата с расширением .p8 в подходящем приложении, например [**Visual Studio Code**](https://code.visualstudio.com), и запишите значение ключа. Это значение находится между строками **-----BEGIN PRIVATE KEY-----** и **-----END PRIVATE KEY-----** .

    ```
    -----BEGIN PRIVATE KEY-----
    <key_value>
    -----END PRIVATE KEY-----
    ```

    > [!NOTE]
    > Это **значение токена**, которое понадобится позже для настройки **концентратора уведомлений**. 

По завершении этих шагов у вас должны быть следующие сведения, которые вы будете использовать для [настройки концентратора уведомлений на основе сведений APNs](#configure-your-notification-hub-with-apns-information):

- **идентификатор команды** (см. шаг 1);
- **идентификатор пакета** (см. шаг 1);
- **идентификатор ключа** (см. шаг 7);
- **значение токена**, то есть значение ключа из файла с расширением .p8 (см. шаг 8).

## <a name="create-a-provisioning-profile-for-the-app"></a>Создание профиля подготовки для приложения

1. Вернитесь на [портал подготовки iOS](https://go.microsoft.com/fwlink/p/?LinkId=272456), выберите **Certificates, Identifiers & Profiles** (Сертификаты, идентификаторы и профили), нажмите **Profiles** (Профили) в меню слева, а затем выберите **+** , чтобы создать новый профиль. Откроется окно **Register a New Provisioning Profile** (Зарегистрировать новый профиль подготовки).

1. Выберите **iOS App Development** (Разработка приложений для iOS) в разделе **Development** (Разработка) в качестве типа профиля подготовки и нажмите кнопку **Continue** (Продолжить).

    ![Список с профилем подготовки](./media/notification-hubs-enable-apple-push-notifications/notification-hubs-new-provisioning-profile.png)

1. Затем в раскрывающемся списке **App ID** (Идентификатор приложения) выберите созданный идентификатор приложения и нажмите кнопку **Continue** (Продолжить).

    ![Выбор идентификатора приложения](./media/notification-hubs-enable-apple-push-notifications/notification-hubs-select-appid-for-provisioning.png)

1. В окне **Select certificates** (Выбор сертификатов) выберите сертификат для разработки, используемый для подписывания кода, и нажмите кнопку **Continue** (Продолжить). Это не созданный сертификат push-уведомлений. Если он не существует, создайте его. Если сертификат существует, перейдите к следующему шагу. Выполните приведенные ниже действия, чтобы создать сертификат разработки, если он не существует.

    1. Если вы видите **No Certificates are available** (Нет доступных сертификатов), выберите **Create Certificate** (Создать сертификат).
    2. В разделе **Software** (Программное обеспечение) выберите **Apple Development** (Разработка Apple). Затем выберите **Continue** (Продолжить).
    3. Перейдите к экрану **Create a new Certificate** (Создать новый сертификат) и нажмите **Choose File** (Выбрать файл).
    4. Перейдите к сертификату **Certificate Signing Request** (Запрос на подпись сертификата), который вы создали ранее, выберите его, а затем нажмите **Open** (Открыть).
    5. Выберите **Continue** (Продолжить).
    6. Скачайте сертификат разработки и запомните расположение, в котором он сохранен.

1. Вернитесь на страницу **Certificates, Identifiers & Profiles** (Сертификаты, идентификаторы и профили), нажмите **Profiles** (Профили) в меню слева, а затем **+** , чтобы создать новый профиль. Откроется окно **Register a New Provisioning Profile** (Зарегистрировать новый профиль подготовки).

1. В окне **Select certificates** (Выбор сертификатов) выберите сертификат разработки, который вы только что создали. Затем выберите **Continue** (Продолжить).

1. Затем выберите устройства для тестирования и нажмите кнопку **Continue** (Продолжить).

1. Наконец, выберите имя профиля в поле **Provisioning Profile Name** (Имя профиля подготовки) и нажмите кнопку **Generate** (Создать).

    ![Выбор имени профиля подготовки](./media/notification-hubs-enable-apple-push-notifications/notification-hubs-provisioning-name-profile.png)

1. После создания нового профиля подготовки выберите **Download** (Скачать). Запомните расположение, в котором он сохранен.

1. Перейдите в расположение профиля подготовки и дважды щелкните его, чтобы установить его на компьютере разработки Xcode.

## <a name="create-a-notification-hub"></a>Создание концентратора уведомлений

В этом разделе показано, как создать концентратор уведомлений и настроить проверку подлинности с помощью APNs, используя ранее созданный сертификат push-уведомлений (файл .p12) или проверку подлинности на основе токена. Если вы хотите использовать уже созданный центр уведомлений, перейдите к шагу 5.

[!INCLUDE [notification-hubs-portal-create-new-hub](notification-hubs-portal-create-new-hub.md)]

## <a name="configure-your-notification-hub-with-apns-information"></a>Добавление данных об APNs в центр уведомлений

В разделе **Notification Services** выберите **Apple (APNS)** , а затем выполните действия в зависимости от способа, выбранного ранее на этапе [создания сертификата для Центров уведомлений](#creating-a-certificate-for-notification-hubs).  

> [!NOTE]
> Если вы создаете приложение с помощью App Store или специального профиля распространения, укажите для параметра **Режим приложения** значение **Производство**. Это позволит устройству отправлять push-уведомления пользователям, которые приобрели приложение в магазине.

### <a name="option-1-using-a-p12-push-certificate"></a>Вариант 1. Использование сертификата .p12 для службы push-уведомлений

1. Выберите **Сертификат**.

1. Щелкните значок файла.

1. Выберите экспортированный ранее файл с расширением .p12, а затем нажмите **Open** (Открыть).

1. При необходимости укажите пароль.

1. Выберите режим **Песочница**.

    ![Настройка сертификации APNs на портале Azure](./media/notification-hubs-enable-apple-push-notifications/notification-hubs-apple-config-cert.png)

1. Щелкните **Сохранить**.

### <a name="option-2-using-token-based-authentication"></a>Вариант 2. Использование проверки подлинности на основе токена

1. Выберите **Токен**.
1. Введите следующие значения, которые вы получили ранее:

    - **идентификатор ключа**;
    - **идентификатор пакета**;
    - **идентификатор команды**;
    - **токен**. 

1. Выберите **Песочница**.
1. Щелкните **Сохранить**. 

Вы добавили данные об APNs в центр уведомлений. У вас также есть строки подключения для регистрации приложения и отправки push-уведомлений.