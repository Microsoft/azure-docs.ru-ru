---
title: включить файл
description: включить файл
services: virtual-machines
author: cynthn
ms.service: virtual-machines
ms.topic: include
ms.date: 04/25/2019
ms.author: cynthn
ms.custom: include file
ms.openlocfilehash: f74d4cbc17e49345534a37e9e6612a36e19be295
ms.sourcegitcommit: 772eb9c6684dd4864e0ba507945a83e48b8c16f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "73903707"
---
Но если вы хотите предоставить общий доступ к образам за пределами клиента Azure, необходимо создать регистрацию приложения, чтобы упростить совместное использование.  С помощью регистрации приложения можно реализовать более сложные сценарии общего доступа, например: 

* Управление общими образами, когда одна компания получает другой, а инфраструктура Azure распределяется между отдельными клиентами. 
* Партнеры Azure управляют инфраструктурой Azure от имени своих клиентов. Настройка образов выполняется в клиенте партнеров, но развертывание инфраструктуры происходит в клиенте клиента. 


## <a name="create-the-app-registration"></a>Создание регистрации приложения

Создайте регистрацию приложения, которая будет использоваться обоими клиентами для совместного использования ресурсов коллекции образов.
1. Откройте [Регистрация приложений (Предварительная версия) в портал Azure](https://ms.portal.azure.com/#blade/Microsoft_AAD_RegisteredApps/ApplicationsListBlade/quickStartType//sourceType/).    
1. Выберите **Новая регистрация** в меню в верхней части страницы.
1. В списке **имя** введите *мигаллеряпп*.
1. В списке **Поддерживаемые типы учетных записей** выберите **учетные записи в любом организационном каталоге и личных учетных записях Майкрософт**.
1. В окне **URI перенаправления** введите *https://www.microsoft.com* и выберите **Register**. После создания регистрации приложения откроется страница обзора.
1. На странице Обзор скопируйте **идентификатор приложения (клиента)** и сохраните его для последующего использования.   
1. Выберите **сертификаты & секреты**, а затем выберите **новый секрет клиента**.
1. В окне **Описание** введите в *коллекции общих образов секрет приложения для разных клиентов*.
1. В поле **истекает срок действия** оставьте значение по умолчанию **в 1 год** , а затем нажмите кнопку **добавить**.
1. Скопируйте значение секрета и сохраните его в надежном месте. Его нельзя получить после выхода из страницы.


Предоставьте приложению разрешение регистрация для использования коллекции общих образов.
1. В портал Azure выберите коллекцию общих образов, к которой вы хотите предоставить общий доступ другим клиентам.
1. Выберите **выбрать Управление доступом (IAM)** и в разделе **Добавление назначения ролей** выберите *добавить*. 
1. В разделе **роль** выберите **читатель**.
1. В разделе **назначение доступа к:** оставьте это значение **пользователем, группой или субъектом-службой Azure AD**.
1. В разделе **выбрать** введите *мигаллеряпп* и выберите его, когда появится в списке. По завершении нажмите кнопку **Сохранить**.


## <a name="give-tenant-2-access"></a>Предоставление доступа к клиенту 2

Предоставьте клиенту 2 доступ к приложению, запросив вход с помощью браузера. Замените *\<Tenant2 ID>* идентификатором клиента, с которым вы хотите поделиться коллекцией образов. Замените *\<Application (client) ID>* идентификатором созданной регистрации приложения. Завершив замену, вставьте URL-адрес в браузер и следуйте инструкциям на экране входа, чтобы войти в клиент 2.

```
https://login.microsoftonline.com/<Tenant 2 ID>/oauth2/authorize?client_id=<Application (client) ID>&response_type=code&redirect_uri=https%3A%2F%2Fwww.microsoft.com%2F 
```

В [портал Azure](https://portal.azure.com) Войдите в систему как клиент 2 и предоставьте доступ к регистрации приложения группе ресурсов, в которой вы хотите создать виртуальную машину.

1. Выберите группу ресурсов, а затем щелкните **Управление доступом (IAM)**. В разделе **Добавление назначения ролей** выберите **Добавить**. 
1. В разделе **роль** введите **участник**.
1. В разделе **назначение доступа к:** оставьте это значение **пользователем, группой или субъектом-службой Azure AD**.
1. В разделе **выберите** тип *мигаллеряпп* выберите его, когда появится в списке. По завершении нажмите кнопку **Сохранить**.

> [!NOTE]
> Прежде чем использовать тот же управляемый образ для создания другой версии образа, необходимо дождаться завершения сборки и репликации версии образа.

