---
title: включить файл
description: включить файл
services: virtual-machines
author: roygara
ms.service: virtual-machines
ms.topic: include
ms.date: 01/29/2021
ms.author: rogarana
ms.custom: include file
ms.openlocfilehash: 25404837d5bc66ff415be8d8670eb6650475c30f
ms.sourcegitcommit: 867cb1b7a1f3a1f0b427282c648d411d0ca4f81f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "99094668"
---
## <a name="warm-up-the-cache"></a>Прогрев кэша

Диск с кэшированием узлов с доступом только для чтения может предоставлять большие объемы операций ввода-вывода, чем ограничение на количество дисков. Чтобы добиться максимальной производительности при чтении для кэша узла, сначала необходимо подготовить кэш диска. Это гарантирует, что операции ввода-вывода при чтении, которые инструмент тестирования производительности выполнит в томе CacheReads, на самом деле попадут в кэш, а не прямо на диск. Попадания в кэш приводит к большему числу операций ввода-вывода на диск с поддержкой одного кэша.

> [!IMPORTANT]
> Необходимо подготовить кэш перед запуском тестов при каждом перезагрузке виртуальной машины.

## <a name="diskspd"></a>DISKSPD

[Скачайте средство дисксп](https://github.com/Microsoft/diskspd) на виртуальной машине. DISKSPD — это средство, которое можно настроить для создания собственных искусственных рабочих нагрузок. Для выполнения тестов производительности будет использоваться та же Настройка, описанная выше. Вы можете изменить спецификации для тестирования различных рабочих нагрузок.

В этом примере мы используем следующий набор базовых параметров:

- -c200G: создает (или повторно создает) образец файла, используемый в тесте. Его можно задать в байтах, КИБ, MiB, гиб или блоках. В этом случае для минимального кэширования памяти используется большой файл целевого файла 200-гиб.
- -W100: указывает процент операций, которые являются запросами записи (-W0 эквивалентен 100% Read).
- -b4K: указывает размер блока в байтах, КИБ, MiB или гиб. В этом случае для имитации произвольного теста ввода-вывода используется размер блока 4 КБ.
- -F4: задает всего четыре потока.
- -r: указывает на случайный тест ввода-вывода (переопределяет параметр-s).
- -o128: указывает количество необработанных запросов ввода-вывода на один объект для каждого потока. Это также называется глубиной очереди. В этом случае для нагрузки ЦП используется 128.
- -W7200: Указывает длительность периода прогрева до начала измерения.
- -D30: определяет длительность теста, не включая прогрев.
- -SH: отключение кэширования записи программного обеспечения и оборудования (эквивалентно-СУВ).

Полный список параметров см. в [репозитории GitHub](https://github.com/Microsoft/diskspd/wiki/Command-line-and-parameters).

### <a name="maximum-write-iops"></a>Максимальное количество операций ввода-вывода в секунду при записи
Мы используем высокую глубину очереди 128, небольшой размер блока — 8 КБ и четыре рабочих потока для выполнения операций записи. Работники записи проводят трафик на томе "NoCacheWrites", который имеет три диска с кэшем со значением "нет".

Выполните следующую команду в течение 30 секунд после прогрева и 30 секунд измерения:

`diskspd -c200G -w100 -b8K -F4 -r -o128 -W30 -d30 -Sh testfile.dat`

Результаты показывают, что Standard_D8ds_v4 виртуальная машина доставляет максимальный предел операций записи в секунду в 12 800.

:::image type="content" source="../articles/virtual-machines/linux/media/premium-storage-performance/disks-benchmarks-diskspd-max-write-io-per-second.png" alt-text="Для 3208642560 всего байт, максимальное число операций ввода-вывода 391680, всего 101,97 MiB/с и всего 13052,65 операций ввода-вывода в секунду.":::

### <a name="maximum-read-iops"></a>Максимальное количество операций ввода-вывода при чтении

Мы используем высокую глубину очереди 128, небольшой размер блока — четыре КБ и четыре рабочих потока для выполнения операций чтения. Рабочие роли чтения проводят трафик на томе "CacheReads", который имеет один диск с кэшем со значением "ReadOnly".

Выполните следующую команду в течение двух часов после прогрева и 30 секунд измерения:

`diskspd -c200G -b4K -F4 -r -o128 -W7200 -d30 -Sh testfile.dat`

Результаты показывают, что Standard_D8ds_v4 виртуальная машина доставляет максимальную длину операций чтения в 77 000.

:::image type="content" source="../articles/virtual-machines/linux/media/premium-storage-performance/disks-benchmarks-diskspd-max-read-io-per-second.png" alt-text="Для 9652785152 всего байт получено 2356637 всего операций ввода-вывода, в 306,72 всего MiB/с и всего 78521,23 операций ввода-вывода в секунду.":::

### <a name="maximum-throughput"></a>Максимальная пропускная способность

Чтобы получить максимальную пропускную способность чтения и записи, можно увеличить размер блока до 64 КБ.
## <a name="fio"></a>FIO

FIO — это популярный инструмент для тестирования производительности хранилища виртуальных машин под управлением Linux. Благодаря своей гибкости он позволяет выбрать различные объемы ввода-вывода, а также порядок выполнения операций чтения и записи — последовательный или случайный. Он порождает рабочие потоки или процессы для выполнения указанных операций ввода-вывода. Можно указать тип операций ввода-вывода, которые должен выполнять каждый рабочий поток, используя файлы заданий. В примерах ниже продемонстрирован один файл задания для каждого сценария. Можно менять спецификации в этих файлах заданий, чтобы тестировать производительность при различных рабочих нагрузках хранилища класса "Премиум". В примерах мы используем Standard_D8ds_v4 под управлением **Ubuntu**. Используйте ту же программу установки, описанную в начале раздела "Тестирование производительности", и запрогревайте кэш перед выполнением тестов производительности.

Прежде чем начать, [скачайте FIO](https://github.com/axboe/fio) и установите его на виртуальной машине.

В ОС Ubuntu выполните следующую команду:

```
apt-get install fio
```

Используется четыре рабочих потока для выполнения операций записи и еще четыре для операций чтения на дисках. Работники записи проводят трафик на томе "без кэша", который имеет три диска с кэшем со значением "нет". Рабочие роли чтения проводят трафик на томе "ReadCache", который имеет один диск с кэшем со значением "ReadOnly".

### <a name="maximum-write-iops"></a>Максимальное количество операций ввода-вывода в секунду при записи

 Чтобы добиться максимального количества операций ввода-вывода в секунду при записи, создайте файл задания со следующими спецификациями. Назовите файл fiowrite.ini.

```ini
[global]
size=30g
direct=1
iodepth=256
ioengine=libaio
bs=4k
numjobs=4

[writer1]
rw=randwrite
directory=/mnt/nocache
```

Обратите внимание на следующие ключевые аспекты, которые согласованы с рекомендациями по разработке, описанными в предыдущих разделах. Эти спецификации необходимы для выполнения максимального количества операций ввода-вывода в секунду:  

* высокое значение длины очереди: 256;  
* Небольшой блок, размером 4 КБ.  
* несколько потоков, выполняющих случайные операции записи.

Выполните следующую команду, чтобы запустить тест FIO на 30 секунд:  

```
sudo fio --runtime 30 fiowrite.ini
```

Во время тестирования вы можете узнать количество операций ввода-вывода в секунду при записи, предоставляемое виртуальной машине и дискам категории "Премиум". Как показано в примере ниже, Standard_D8ds_v4 виртуальная машина доставляет максимальный предел операций записи в секунду в 12 800 операций ввода-вывода в секунду.  
    :::image type="content" source="../articles/virtual-machines/linux/media/premium-storage-performance/fio-uncached-writes-1.jpg" alt-text="Количество операций записи в секунду и ВИРТУАЛЬНЫХ твердотельных накопителей, которые доставляются, показывают, что операции записи — 13.1 КБ.":::

### <a name="maximum-read-iops"></a>Максимальное количество операций ввода-вывода при чтении

 Чтобы добиться максимального значения операций ввода-вывода при чтении, создайте файл задания со следующими спецификациями. Назовите файл fioread.ini.

```ini
[global]
size=30g
direct=1
iodepth=256
ioengine=libaio
bs=4k
numjobs=4

[reader1]
rw=randread
directory=/mnt/readcache
```

Обратите внимание на следующие ключевые аспекты, которые согласованы с рекомендациями по разработке, описанными в предыдущих разделах. Эти спецификации необходимы для выполнения максимального количества операций ввода-вывода в секунду:

* высокое значение длины очереди: 256;  
* Небольшой блок, размером 4 КБ.  
* несколько потоков, выполняющих случайные операции записи.

Выполните следующую команду, чтобы запустить тест FIO на 30 секунд:

```
sudo fio --runtime 30 fioread.ini
```

Во время тестирования вы можете узнать количество операций ввода-вывода в секунду при чтении, предоставляемое виртуальной машине и дискам категории "Премиум". Как показано в примере ниже, Standard_D8ds_v4 виртуальная машина доставляет более 77 000 операций ввода-вывода в секунду. Это количество представляет собой сочетание производительности диска и кэша.  
    :::image type="content" source="../articles/virtual-machines/linux/media/premium-storage-performance/fio-cached-reads-1.jpg" alt-text="Снимок экрана: число операций записи в секунду и количество твердотельных накопителей, которые доставляются, показывают, что операции чтения 78.6 k.":::

### <a name="maximum-read-and-write-iops"></a>Максимальное количество операций ввода-вывода в секунду при чтении и записи

 Чтобы добиться максимального количества операций ввода-вывода в секунду при объединенных операциях чтения и записи, создайте файл задания со следующими спецификациями. Назовите файл fioreadwrite.ini.

```ini
[global]
size=30g
direct=1
iodepth=128
ioengine=libaio
bs=4k
numjobs=4

[reader1]
rw=randread
directory=/mnt/readcache

[writer1]
rw=randwrite
directory=/mnt/nocache
rate_iops=3200
```

Обратите внимание на следующие ключевые аспекты, которые согласованы с рекомендациями по разработке, описанными в предыдущих разделах. Эти спецификации необходимы для выполнения максимального количества операций ввода-вывода в секунду:

* высокое значение длины очереди: 128;  
* Небольшой блок, размером 4 КБ.  
* несколько потоков, выполняющих случайные операции чтения и записи.

Выполните следующую команду, чтобы запустить тест FIO на 30 секунд:

```
sudo fio --runtime 30 fioreadwrite.ini
```

Во время тестирования вы можете узнать количество операций ввода-вывода в секунду при объединенных операциях чтения и записи, предоставляемое виртуальной машине и дискам категории "Премиум". Как показано в примере ниже, Standard_D8ds_v4 виртуальная машина доставляет более 90 000 Объединенных операций чтения и записи в секунду. Это количество представляет собой сочетание производительности диска и кэша.  
    :::image type="content" source="../articles/virtual-machines/linux/media/premium-storage-performance/fio-both-1.jpg" alt-text="Совместное чтение и запись операций ввода-вывода, показывает, что READS 78.3 k, а writes — 12,6 k операций ввода-вывода.":::

### <a name="maximum-combined-throughput"></a>Максимальное значение объединенной пропускной способности

 Чтобы добиться максимальной пропускной способности объединенных операций чтения и записи, используйте больший размер блока и длинную очередь с несколькими потоками, выполняющими операции чтения и записи. Вы можете использовать блоки размером 64 КБ и длину очереди 128.