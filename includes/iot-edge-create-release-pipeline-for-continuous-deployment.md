---
author: v-tcassi
ms.service: iot-edge
ms.topic: include
ms.date: 08/26/2020
ms.author: v-tcassi
ms.openlocfilehash: 9572f4c663c820c76a57cdbdcecff082b150b577
ms.sourcegitcommit: e6de1702d3958a3bea275645eb46e4f2e0f011af
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/20/2021
ms.locfileid: "104761153"
---
## <a name="create-a-release-pipeline-for-continuous-deployment"></a>Создание конвейера выпуска для непрерывного развертывания

В этом разделе описано, как создать конвейер выпуска, настроенный для автоматического запуска при получении артефакта от конвейера сборки и отображения журналов сборки в Azure Pipelines.

Создайте новый конвейер и добавьте новый этап.

1. На вкладке **выпуски** в разделе **конвейеры** выберите **+ Новый конвейер**. Если у вас уже есть конвейеры выпуска, нажмите кнопку **+ Создать** и щелкните **+ Создать конвейер выпуска**.  

    ![Добавление конвейера выпуска с помощью кнопки + New конвейер](./media/iot-edge-create-release-pipeline-for-continuous-deployment/add-release-pipeline.png)

2. Когда будет предложено выбрать шаблон, выберите с **пустым заданием**.

    ![Начните с пустого задания для конвейера выпуска](./media/iot-edge-create-release-pipeline-for-continuous-deployment/start-with-empty-release-job.png)

3. Ваш новый конвейер выпуска инициализируется с одним этапом, который называется **Этап 1**. Переименование этапа 1 в **dev** и его обработка в качестве конвейера непрерывного развертывания для среды разработки. Обычно конвейеры непрерывного развертывания имеют несколько этапов, включая **разработку**, **промежуточную** среду и рабочую **среду.** Вы можете использовать разные имена и создать больше, основываясь на DevOps практике. Закройте окно сведений об этапе после его переименования.

   Вы также можете переименовать конвейер выпуска, выбрав текст "Новый конвейер выпуска" вверху.

4. Свяжите выпуск с артефактами сборки, опубликованными конвейером сборки. Щелкните **Add** (Добавить) в области артефактов.

   ![Нажмите кнопку Добавить в области артефакты интерфейса.](./media/iot-edge-create-release-pipeline-for-continuous-deployment/add-artifacts.png)

5. На **странице Добавление артефакта** выберите **Сборка** в качестве **типа источника**. Выберите проект и созданный конвейер сборки. При желании **Псевдоним источника** можно изменить на более описательный. Затем выберите **Добавить**.

   ![На странице Добавление артефакта выберите Добавить, чтобы создать артефакт.](./media/iot-edge-create-release-pipeline-for-continuous-deployment/add-artifact.png)

6. Откройте триггеры артефакта и выберите переключатель для включения триггера непрерывного развертывания. Теперь новый выпуск будет создаваться каждый раз, когда новая сборка становится доступной.

   ![Откройте триггеры артефактов и переключитесь, чтобы включить триггер непрерывного развертывания.](./media/iot-edge-create-release-pipeline-for-continuous-deployment/add-trigger.png)

7. Этап **разработки** предварительно настроен с одним заданием и нулевыми задачами. В меню конвейера выберите **задачи** , а затем выберите этап **разработки** . Выберите **Задание агента** и измените его **Отображаемое имя** на **QA**. Можно настроить сведения о задании агента, но задача развертывания не зависит от платформы, поэтому вы можете использовать любую **спецификацию агента** в выбранном **пуле агентов**.

   ![Просмотр задач для этапа разработки на вкладке "задачи"](./media/iot-edge-create-release-pipeline-for-continuous-deployment/view-stage-tasks.png)

8. В задании контроля качества выберите знак "плюс" ( **+** ), чтобы добавить две задачи. Выполните поиск и добавьте **Azure IOT Edge** дважды.

9. Выберите первую задачу **Azure IOT Edge** и настройте ее со следующими значениями:

    | Параметр | Описание |
    | --- | --- |
    | Отображаемое имя | Отображаемое имя автоматически обновляется при изменении поля действия. |
    | Действие | Выберите `Generate deployment manifest`. |
    | .template.jsв файле | Укажите путь: `$(System.DefaultWorkingDirectory)/Drop/drop/deployment.template.json` . Путь публикуется из конвейера сборки. |
    | Платформа по умолчанию | Выберите соответствующую операционную систему для модулей на основе целевого устройства IoT Edge. |
    | Путь вывода| Вставьте путь `$(System.DefaultWorkingDirectory)/Drop/drop/configs/deployment.json` . Этот путь является окончательным файлом манифеста развертывания IoT Edge. |

    Эти конфигурации помогают заменить URL-адреса образа модуля в `deployment.template.json` файле. **Манифест создания развертывания** также помогает заменить переменные на точное значение, определенное в `deployment.template.json` файле. В VS/VS Code Вы указываете фактическое значение в `.env` файле. В Azure Pipelines значение задается на вкладке **переменные конвейера выпуска** . Перейдите на вкладку **переменные** и настройте имя и значение следующим образом:

    * **ACR_ADDRESS**: значение **сервера входа** в реестр контейнеров Azure. Вы можете узнать сервер входа на странице "Обзор" реестра контейнеров на портале Azure.
    * **ACR_PASSWORD**: пароль реестра контейнеров Azure.
    * **ACR_USER**: имя пользователя реестра контейнеров Azure.

    Если в проекте имеются другие переменные, можно указать имя и значение на этой вкладке. **Манифест создания развертывания** может распознать только те переменные, которые имеют `${VARIABLE}` флаг. Убедитесь, что вы используете эту версию в `*.template.json` файлах.
    
    ```json-interactive
    "registryCredentials": {
      "<ACR name>": { // Your Azure Container Registry **Registry name** value
        "username": "${ACR_USER}",
        "password": "${ACR_PASSWORD}",
        "address": "${ACR_ADDRESS}"
      }
    }
    ```
    
    ![Настройка переменных для конвейера выпуска на вкладке "переменные"](./media/iot-edge-create-release-pipeline-for-continuous-deployment/configure-variables.png)

10. Выберите вторую задачу **Azure IOT Edge** и настройте ее со следующими значениями:

    | Параметр | Описание |
    | --- | --- |
    | Отображаемое имя | Отображаемое имя автоматически обновляется при изменении поля действия. |
    | Действие | Выберите `Deploy to IoT Edge devices`. |
    | Файл развертывания | Вставьте путь `$(System.DefaultWorkingDirectory)/Drop/drop/configs/deployment.json` . Это путь к файлу манифеста развертывания файла IoT Edge. |
    | Подписка Azure. | Выберите подписку, которая содержит Центр Интернета вещей.|
    | Имя Центра Интернета вещей | Выберите нужный Центр Интернета вещей.|
    | Выбрать одно или несколько устройств | Выберите, следует ли выполнять развертывание конвейера выпуска на одном или нескольких устройствах. При развертывании на одно устройство введите **идентификатор устройства IoT Edge**. При развертывании на нескольких устройствах следует указать **целевое условие** устройства. Условие назначения — это фильтр, который соответствует набору IoT Edge устройств в центре Интернета вещей. Если вы хотите использовать в качестве условия Теги устройств, необходимо обновить теги соответствующих устройств с помощью двойникаов устройств центра Интернета вещей. Обновите **идентификатор развертывания** и **приоритет развертывания IoT Edge** в разделе дополнительных параметров. Дополнительные сведения о создании развертывания для нескольких устройств см. в статье [Общие сведения об автоматических развертываниях IoT Edge для отдельных устройств или в требуемом масштабе](../articles/iot-edge/module-deployment-monitoring.md). |
    | Идентификатор или целевое условие устройства | В зависимости от ранее выбранного варианта укажите идентификатор устройства или [целевое условие](../articles/iot-edge/module-deployment-monitoring.md#target-condition) для развертывания на нескольких устройствах. |
    | Продвинутый уровень | Для идентификатора развертывания IoT Edge укажите `$(System.TeamProject)-$(Release.EnvironmentName)` . Эта переменная сопоставляет проект и имя выпуска с ИДЕНТИФИКАТОРом развертывания IoT Edge. |

    ![Добавление задач Azure IoT Edge на этапе разработки](./media/iot-edge-create-release-pipeline-for-continuous-deployment/add-quality-assurance-task.png)

11. Выберите **Сохранить**, чтобы сохранить изменения в новом конвейере выпуска. Вернитесь в представление конвейера, выбрав вкладку **конвейер** из меню.
