---
title: Понятия, связанные с чатами в Службах коммуникации Azure
titleSuffix: An Azure Communication Services concept document
description: Узнайте о понятиях, связанных с чатами в Службах коммуникации.
author: mikben
manager: jken
services: azure-communication-services
ms.author: mikben
ms.date: 09/30/2020
ms.topic: overview
ms.service: azure-communication-services
ms.openlocfilehash: e71917d917491037100b4ee666cbeb030b0a4786
ms.sourcegitcommit: 867cb1b7a1f3a1f0b427282c648d411d0ca4f81f
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "104656147"
---
# <a name="chat-concepts"></a>Понятия, связанные с чатами 

[!INCLUDE [Public Preview Notice](../../includes/public-preview-include.md)]    

Клиентские библиотеки чатов Служб коммуникации Azure позволяют добавлять в приложения текстовые чаты в реальном времени. На этой странице перечислены основные понятия и возможности,с вязанные с чатами.    

Дополнительные сведения о языках и возможностях конкретной клиентской библиотеки можно найти в [описании клиентской библиотеки чатов Служб коммуникации](./sdk-features.md).    

## <a name="chat-overview"></a>Общие сведения о чатах    

Беседы в чате организованы в отдельные цепочки. Такие цепочки могут содержать много сообщений от многих пользователей. Каждое сообщение принадлежит одной цепочке, при этом пользователь может отправлять сообщения в одну или несколько цепочках. Каждый пользователь в потоке чата называется участником. Только участники потока могут отправлять и получать сообщения, а также добавлять и удалять других пользователей в потоке чата. Службы коммуникации сохраняют журнал чата, пока вы не удалите поток чата или сообщения либо пока в потоке чата не останется ни одного участника, после чего такой поток считается потерянным и включается в очередь для удаления. 
    
## <a name="service-limits"></a>Ограничения службы   

- Максимальное число участников, разрешенное в потоке разговора, — 250.   
- Максимально допустимый размер сообщения составляет примерно 28 КБ.  
- В потоках более чем с 20 участниками уведомления о прочтении и индикатор ввода обычно не поддерживаются.    
- 
## <a name="chat-architecture"></a>Архитектура чата    

Архитектура чата включает две основные части: 1) доверенная служба; 2) клиентское приложение.    

:::image type="content" source="../../media/chat-architecture.png" alt-text="Схема архитектуры чата в Службах коммуникации."::: 

 - **Доверенная служба.** Для правильного управления сеансом чата требуется служба, которая помогает подключаться к Службам коммуникации с использованием строки подключения к ресурсу. Эта служба отвечает за создание потоков чата, управление списками участников потока и предоставление маркеров доступа пользователям. Дополнительные сведения о маркерах доступа можно найти в [этом](../../quickstarts/access-tokens.md) кратком руководстве.   
 - **Клиентское приложение.**  Клиентское приложение подключается к доверенной службе и получает маркеры доступа, которые используются для подключения непосредственно к Службам коммуникации. После создания такого подключения клиентское приложение может отправлять и получать сообщения.   
Мы рекомендуем создавать маркеры доступа с помощью уровня доверенных служб. В этом сценарии серверная часть отвечает за создание пользователей и управление ими, а также выдачу их маркеров.   
        
## <a name="message-types"></a>Типы сообщений    

Чат Служб коммуникации передает сообщения, созданные пользователями, и специальные системные сообщения, которые называются **действиями цепочек**. Действия цепочек создаются при обновлении беседы чата. Вызов `List Messages` или `Get Messages` для цепочки чата возвращает все созданные пользователями текстовые сообщения и системные сообщения в хронологическом порядке. Это позволяет понять, когда был добавлен или удален определенный участник, а также когда была обновлена тема потока чата. Поддерживаются следующие типы сообщений:  
    
 - `Text`. Сообщение в виде обычного текста, составленное и отправленное пользователем в рамках беседы в чате. 
 - `RichText/HTML`. Форматированное текстовое сообщение. Обратите внимание, что сейчас пользователи Служб коммуникации не могут отправить сообщения с форматированным текстом. Этот тип сообщений поддерживается в сообщениях, отправленных от пользователей Teams пользователям Служб коммуникации в сценариях взаимодействия с Teams.   
 - `ThreadActivity/ParticipantAdded`. Системное сообщение о том, что один или несколько участников были добавлены в беседу в чате. Пример. 


``` 
{   
            "id": "1613589626560",  
            "type": "participantAdded", 
            "sequenceId": "7",  
            "version": "1613589626560", 
            "content":  
            {   
                "participants": 
                [   
                    {   
                        "id": "8:acs:d2a829bc-8523-4404-b727-022345e48ca6_00000008-511c-4df6-f40f-343a0d003226",    
                        "displayName": "Jane",  
                        "shareHistoryTime": "1970-01-01T00:00:00Z"  
                    }   
                ],  
                "initiator": "8:acs:d2a829bc-8523-4404-b727-022345e48ca6_00000008-511c-4ce0-f40f-343a0d003224"  
            },  
            "createdOn": "2021-02-17T19:20:26Z" 
        }   
``` 

- `ThreadActivity/ParticipantRemoved`. Системное сообщение о том, что участник был удален из потока чата. Пример.  

``` 
{   
            "id": "1613589627603",  
            "type": "participantRemoved",   
            "sequenceId": "8",  
            "version": "1613589627603", 
            "content":  
            {   
                "participants": 
                [   
                    {   
                        "id": "8:acs:d2a829bc-8523-4404-b727-022345e48ca6_00000008-511c-4df6-f40f-343a0d003226",    
                        "displayName": "Jane",  
                        "shareHistoryTime": "1970-01-01T00:00:00Z"  
                    }   
                ],  
                "initiator": "8:acs:d2a829bc-8523-4404-b727-022345e48ca6_00000008-511c-4ce0-f40f-343a0d003224"  
            },  
            "createdOn": "2021-02-17T19:20:27Z" 
        }   
``` 

- `ThreadActivity/TopicUpdate`. Системное сообщение, указывающее на изменение темы беседы. Пример:   
``` 
{   
            "id": "1613589623037",  
            "type": "topicUpdated", 
            "sequenceId": "2",  
            "version": "1613589623037", 
            "content":  
            {   
                "topic": "New topic",   
                "initiator": "8:acs:d2a829bc-8523-4404-b727-022345e48ca6_00000008-511c-4ce0-f40f-343a0d003224"  
            },  
            "createdOn": "2021-02-17T19:20:23Z" 
        }   
``` 

## <a name="real-time-signaling"></a>Сигнализация в реальном времени  

Клиентская библиотека чатов для JavaScript предоставляет механизм сигнализации в реальном времени. Этот механизм позволяет клиентам прослушивать в реальном времени обновления и входящие сообщения цепочки чата без необходимости опрашивать API. Поддерживаются следующие события:

 - `ChatMessageReceived` — отправка нового сообщения в поток чата. Это событие не отправляется для автоматически созданных системных сообщений, которые описаны в предыдущем разделе.   
 - `ChatMessageEdited` — изменение сообщения в потоке чата. 
 - `ChatMessageDeleted` — удаление сообщения в потоке чата.   
 - `TypingIndicatorReceived` — ввод сообщения в потоке чата другим участником.   
 - `ReadReceiptReceived` — прочтение сообщения, отправленного пользователем в поток чата, другим участником.     
 - `ChatThreadCreated` — создание потока чата пользователем. 
 - `ChatThreadDeleted` — удаление потока чата пользователем. 
 - `ChatThreadPropertiesUpdated` — обновление свойств потока чата; сейчас поддерживается только обновление темы для потока.   
 - `ParticipantsAdded` — добавление пользователя как участника в поток чата.  
 - `ParticipantsRemoved` — удаление существующего участника из потока чата.


## <a name="chat-events"></a>События чата  

Сигнализация в реальном времени помогает пользователям общаться в реальном времени. Ваши службы могут использовать Сетку событий Azure для подписки на события, связанные с чатом. Дополнительные сведения см. в статье [Концептуальная модель обработки событий](https://docs.microsoft.com/azure/event-grid/event-schema-communication-services?tabs=event-grid-event-schema).


## <a name="using-cognitive-services-with-chat-client-library-to-enable-intelligent-features"></a>Использование Cognitive Services и клиентской библиотеки чатов для создания интеллектуальных возможностей 

Для добавления интеллектуальных возможностей в приложения можно объединить [API Azure Cognitive Services](../../../cognitive-services/index.yml) с клиентской библиотекой чатов. Например, администратор может сделать следующее:  

- разрешить пользователям общаться на разных языках;  
- помочь службе поддержки приоритизировать обращения, выявляя отрицательные тональности в сообщении клиента о проблеме;   
- анализировать входящие сообщения для обнаружения ключей и распознавания сущностей и передавать пользователю приложения важную информацию с учетом содержимого сообщения.

Один из способов реализации этих возможностей — создать доверенную службу, которая выступает в качестве участника потока чата. Предположим, вы хотите включить перевод на несколько языков. Эта служба будет прослушивать сообщения, которыми обмениваются другие участники [1], вызывать API Cognitive Services для перевода содержимого на нужный язык [2, 3] и отправлять переведенный текст в виде сообщения в поток чата [4].

Это означает, что в журнале сообщений будут содержаться как исходные, так и переведенные сообщения. В клиентском приложении можно добавить логику для отображения исходных или переведенных сообщений. В [этом кратком руководстве](../../../cognitive-services/translator/quickstart-translator.md) показано, как использовать API Cognitive Services для перевода текста на разные языки. 
    
:::image type="content" source="../media/chat/cognitive-services.png" alt-text="Схема взаимодействия Cognitive Services со Службами коммуникации."::: 

## <a name="next-steps"></a>Дальнейшие действия   

> [!div class="nextstepaction"] 
> [Начало работы с чатом](../../quickstarts/chat/get-started.md)    

Вас могут заинтересовать следующие документы:  
- Ознакомьтесь с [клиентской библиотекой чатов](sdk-features.md).