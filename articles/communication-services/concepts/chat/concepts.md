---
title: Понятия, связанные с чатами в Службах коммуникации Azure
titleSuffix: An Azure Communication Services concept document
description: Узнайте о понятиях, связанных с чатами в Службах коммуникации.
author: mikben
manager: jken
services: azure-communication-services
ms.author: mikben
ms.date: 09/30/2020
ms.topic: overview
ms.service: azure-communication-services
ms.openlocfilehash: 077500e0188d1cc20864d436a2e2fd711b180702
ms.sourcegitcommit: 77ab078e255034bd1a8db499eec6fe9b093a8e4f
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/16/2020
ms.locfileid: "97560242"
---
# <a name="chat-concepts"></a>Понятия, связанные с чатами

[!INCLUDE [Public Preview Notice](../../includes/public-preview-include.md)]

Клиентские библиотеки чатов Служб коммуникации Azure позволяют добавлять в приложения текстовые чаты в реальном времени. На этой странице перечислены основные понятия и возможности,с вязанные с чатами.

Дополнительные сведения о языках и возможностях конкретной клиентской библиотеки можно найти в [описании клиентской библиотеки чатов Служб коммуникации](./sdk-features.md).

## <a name="chat-overview"></a>Общие сведения о чатах 

Беседы в чате организованы в отдельные цепочки. Такие цепочки могут содержать много сообщений от многих пользователей. Каждое сообщение принадлежит одной цепочке, при этом пользователь может отправлять сообщения в одну или несколько цепочках. 

Каждый пользователь в цепочке чата называется участником. В цепочке может находиться до 250 участников. Только участники цепочки могут отправлять в нее сообщения и получать их, а также добавлять или удалять других участников. Максимально допустимый размер сообщения составляет примерно 28 КБ. Все сообщения в определенной цепочке чата можно получить с помощью операции `List/Get Messages`. Службы коммуникации сохраняют журнал чата, пока вы не выполните операцию удаления для потока чата или сообщения либо пока в потоке чата не останется ни одного участника, после чего поток считается потерянным и помечается для удаления.   

В цепочках более чем с 20 участниками обычно отключаются уведомления о получении и индикатор ввода. 

## <a name="chat-architecture"></a>Архитектура чата

Архитектура чата включает две основные части: 1) доверенная служба; 2) клиентское приложение.

:::image type="content" source="../../media/chat-architecture.png" alt-text="Схема архитектуры чата в Службах коммуникации.":::

 - **Доверенная служба.** Для правильного управления сеансом чата требуется служба, которая помогает подключаться к Службам коммуникации с использованием строки подключения к ресурсу. Эта служба отвечает за создание цепочек чата, управление членством в цепочках и предоставление пользователям маркеров доступа. Дополнительные сведения о маркерах доступа можно найти в [этом](../../quickstarts/access-tokens.md) кратком руководстве.

 - **Клиентское приложение.**  Клиентское приложение подключается к доверенной службе и получает маркеры доступа, которые используются для подключения непосредственно к Службам коммуникации. После создания такого подключения клиентское приложение может отправлять и получать сообщения.
    
## <a name="message-types"></a>Типы сообщений

Чат Служб коммуникации передает сообщения, созданные пользователями, и специальные системные сообщения, которые называются **действиями цепочек**. Действия цепочек создаются при обновлении беседы чата. Вызов `List Messages` или `Get Messages` для цепочки чата возвращает все созданные пользователями текстовые сообщения и системные сообщения в хронологическом порядке. Это позволяет понять, когда был добавлен или удален конкретный участник, а также когда была обновлена тема цепочки чата. Поддерживаются следующие типы сообщений:  

 - `Text`. Сообщение в виде обычного текста, составленное и отправленное пользователем в рамках беседы в чате. 
 - `RichText/HTML`. Форматированное текстовое сообщение. Обратите внимание, что сейчас пользователи Служб коммуникации не могут отправить сообщения с форматированным текстом. Этот тип сообщений поддерживается в сообщениях, отправленных от пользователей Teams пользователям Служб коммуникации в сценариях взаимодействия с Teams.
 - `ThreadActivity/AddMember`. Системное сообщение о том, что один или несколько участников были добавлены в цепочку чата. Пример:

```xml

<addmember>
    <eventtime>1598478187549</eventtime>
    <initiator>8:acs:57b9bac9-df6c-4d39-a73b-26e944adf6ea_0e59221d-0c1d-46ae-9544-c963ce56c10b</initiator>
    <detailedinitiatorinfo>
        <friendlyName>User 1</friendlyName>
    </detailedinitiatorinfo>
    <rosterVersion>1598478184564</rosterVersion>
    <target>8:acs:57b9bac9-df6c-4d39-a73b-26e944adf6ea_0e59221d-0c1d-46ae-9544-c963ce56c10b</target>
    <detailedtargetinfo>
        <id>8:acs:57b9bac9-df6c-4d39-a73b-26e944adf6ea_0e59221d-0c1d-46ae-9544-c963ce56c10b</id>
        <friendlyName>User 1</friendlyName>
    </detailedtargetinfo>
    <target>8:acs:57b9bac9-df6c-4d39-a73b-26e944adf6ea_8540c0de-899f-5cce-acb5-3ec493af3800</target>
    <detailedtargetinfo>
        <id>8:acs:57b9bac9-df6c-4d39-a73b-26e944adf6ea_8540c0de-899f-5cce-acb5-3ec493af3800</id>
        <friendlyName>User 2</friendlyName>
    </detailedtargetinfo>
</addmember>

```  

- `ThreadActivity/DeleteMember`: системное сообщение о том, что участник был удален из цепочки чата. Пример:

```xml

<deletemember>
    <eventtime>1598478187642</eventtime>
    <initiator>8:acs:57b9bac9-df6c-4d39-a73b-26e944adf6ea_0e59221d-0c1d-46ae-9544-c963ce56c10b</initiator>
    <detailedinitiatorinfo>
        <friendlyName>User 1</friendlyName>
    </detailedinitiatorinfo>
    <rosterVersion>1598478184564</rosterVersion>
    <target>8:acs:57b9bac9-df6c-4d39-a73b-26e944adf6ea_8540c0de-899f-5cce-acb5-3ec493af3800</target>
    <detailedtargetinfo>
        <id>8:acs:57b9bac9-df6c-4d39-a73b-26e944adf6ea_8540c0de-899f-5cce-acb5-3ec493af3800</id>
        <friendlyName>User 2</friendlyName>
    </detailedtargetinfo>
</deletemember>

```

- `ThreadActivity/MemberJoined`. Системное сообщение, которое создается, когда гостевой пользователь присоединяется к чату собрания в Teams. Пользователи Служб коммуникации могут присоединяться в качестве гостя чатов собраний в Teams. Пример.  
```xml
{ 
  "id": "1606351443605", 
  "type": "ThreadActivity/MemberJoined", 
  "version": "1606347753409", 
  "priority": "normal", 
  "content": "{\"eventtime\":1606351443080,\"initiator\":\"8:orgid:8a53fd2b5ef150bau8442ad732a6ac6b_0e8deebe7527544aa2e7bdf3ce1b8733\",\"members\":[{\"id\":\"8:acs:9b665d83-8164-4923-ad5d-5e983b07d2d7_00000006-7ef9-3bbe-b274-5a3a0d0002b1\",\"friendlyname\":\"\"}]}", 
  "senderId": " 19:meeting_curGQFTQ8tifs3EK9aTusiszGpkZULzNTTy2dbfI4dCJEaik@thread.v2", 
  "createdOn": "2020-11-29T00:44:03.6950000Z" 
} 
```
- `ThreadActivity/MemberLeft`. Системное сообщение, которое создается, когда гостевой пользователь покидает чат собрания. Пользователи Служб коммуникации могут присоединяться в качестве гостя чатов собраний в Teams. Пример: 
```xml
{ 
  "id": "1606347703429", 
  "type": "ThreadActivity/MemberLeft", 
  "version": "1606340753429", 
  "priority": "normal", 
  "content": "{\"eventtime\":1606340755385,\"initiator\":\"8:orgid:8a53fd2b5u8150ba81442ad732a6ac6b_0e8deebe7527544aa2e7bdf3ce1b8733\",\"members\":[{\"id\":\"8:acs:9b665753-8164-4923-ad5d-5e983b07d2d7_00000006-7ef9-3bbe-b274-5a3a0d0002b1\",\"friendlyname\":\"\"}]}", 
  "senderId": "19:meeting_9u7hBcYiADudn41Djm0n9DTVyAHuMZuh7p0bDsx1rLVGpnMk@thread.v2", 
  "createdOn": "2020-11-29T23:42:33.4290000Z" 
} 
```
- `ThreadActivity/TopicUpdate`: системное сообщение, указывающее на изменение темы. Пример:

```xml

<topicupdate>
    <eventtime>1598477591811</eventtime>
    <initiator>8:acs:57b9bac9-df6c-4d39-a73b-26e944adf6ea_0e59221d-0c1d-46ae-9544-c963ce56c10b</initiator>
    <value>New topic</value>
</topicupdate>

```

## <a name="real-time-signaling"></a>Сигнализация в реальном времени 

Клиентская библиотека чатов для JavaScript предоставляет механизм сигнализации в реальном времени. Этот механизм позволяет клиентам прослушивать в реальном времени обновления и входящие сообщения цепочки чата без необходимости опрашивать API. Поддерживаются следующие события:

 - `ChatMessageReceived` — отправка нового сообщения в цепочку чата, участником которой является пользователь. Это событие не отправляется для автоматически созданных системных сообщений, которые описаны в предыдущем разделе.  
 - `ChatMessageEdited` — изменение сообщения в цепочке чата, участником которой является пользователь. 
 - `ChatMessageDeleted` — удаление сообщения из цепочки чата, участником которой является пользователь. 
 - `TypingIndicatorReceived` — один из участников вводит сообщение в цепочке чата, участником которой является пользователь. 
 - `ReadReceiptReceived` — один из участников прочитал сообщение, отправленное пользователем в цепочку чата. 

## <a name="chat-events"></a>События чата 

Сигнализация в реальном времени помогает пользователям общаться в реальном времени. Ваши службы могут использовать Сетку событий Azure для подписки на события, связанные с чатом. Дополнительные сведения см. в статье [Концептуальная модель обработки событий](../event-handling.md).

## <a name="using-cognitive-services-with-chat-client-library-to-enable-intelligent-features"></a>Использование Cognitive Services и клиентской библиотеки чатов для создания интеллектуальных возможностей

Для добавления интеллектуальных возможностей в приложения можно объединить [API Azure Cognitive Services](../../../cognitive-services/index.yml) с клиентской библиотекой чатов. Например, администратор может сделать следующее:

- разрешить пользователям общаться на разных языках; 
- помочь службе поддержки приоритизировать обращения, выявляя отрицательные тональности в сообщении клиента о проблеме;
- анализировать входящие сообщения для обнаружения ключей и распознавания сущностей и передавать пользователю приложения важную информацию с учетом содержимого сообщения.

Одним из способов реализации этих возможностей является создание доверенной службы, которая выступает в качестве участника цепочки чата. Предположим, вы хотите включить перевод на несколько языков. Эта служба будет прослушивать сообщения, которыми обмениваются другие участники [1], вызывать API Cognitive Services для перевода содержимого на нужный язык [2, 3] и отправлять переведенный текст в виде сообщения в цепочку чата [4]. 

Это означает, что в журнале сообщений будут содержаться как исходные, так и переведенные сообщения. В клиентском приложении можно добавить логику для отображения исходных или переведенных сообщений. В [этом кратком руководстве](../../../cognitive-services/translator/quickstart-translator.md) показано, как использовать API Cognitive Services для перевода текста на разные языки. 

:::image type="content" source="../media/chat/cognitive-services.png" alt-text="Схема взаимодействия Cognitive Services со Службами коммуникации.":::

## <a name="next-steps"></a>Дальнейшие действия

> [!div class="nextstepaction"]
> [Начало работы с чатом](../../quickstarts/chat/get-started.md)

Вас могут заинтересовать следующие документы:

- Ознакомьтесь с [клиентской библиотекой чатов](sdk-features.md).
