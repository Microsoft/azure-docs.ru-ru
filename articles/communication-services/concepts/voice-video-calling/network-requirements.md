---
title: Подготовка сети организации для Служб коммуникации Azure
titleSuffix: An Azure Communication Services concept document
description: Сведения о требованиях к сети для голосовых и видеовызовах в Службах коммуникации Azure
author: nmurav
manager: jken
services: azure-communication-services
ms.author: nmurav
ms.date: 3/23/2021
ms.topic: overview
ms.service: azure-communication-services
ms.openlocfilehash: 22bf8af89771e57621a0d8851ca31bb750b7cda2
ms.sourcegitcommit: 32e0fedb80b5a5ed0d2336cea18c3ec3b5015ca1
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/30/2021
ms.locfileid: "105108355"
---
# <a name="ensure-high-quality-media-in-azure-communication-services"></a>Обеспечение высокого качества мультимедиа в Службах коммуникации Azure

В этом документе приведен обзор факторов и рекомендаций, которые следует учитывать при обеспечении высококачественной мультимедийной связи с помощью Служб коммуникации Azure.

## <a name="factors-that-affect-media-quality-and-reliability"></a>Факторы, влияющие на качество и надежность мультимедиа

Существует много разных факторов, которые влияют на качество мультимедиа в режиме реального времени Служб коммуникации Azure (аудио, видео и совместное использование приложений). К таким факторам относятся качество сети, пропускная способность, конфигурация брандмауэра, узла и устройства.


### <a name="network-quality"></a>Качество сети

Качество мультимедиа по IP в режиме реального времени сильно зависит от качества работы сети и, прежде всего, от следующих параметров:
* **Задержка**. Это время, необходимое IP-пакету, чтобы из точки A попасть в точку B в сети. Задержка распространения сигнала по сети определяется физическим расстоянием между двумя точками и дополнительной задержкой, вносимой устройствами, через которые проходит трафик. Задержка выражается в виде одностороннего времени кругового пути (RTT).
* **Потеря пакетов**. Это процент пакетов, которые теряются в заданном интервале времени. Потеря пакетов непосредственным образом влияет на качество звука. Потеря отдельных небольших пакетов практически не оказывает негативное влияния, а потеря большого числа пакетов в обоих направлениях будет приводить к полному пропаданию звука.
* **Дрожание при поступлении между пакетами или просто дрожание**. Это эффект среднего изменения задержки между последовательными пакетами. Службы коммуникации Azure могут адаптироваться к некоторым уровням дрожания благодаря применению буферизации. Участник разговора заметит ухудшение качества связи только в том случае, если уровень дрожания превысит возможности буферизации.

### <a name="network-bandwidth"></a>Пропускная способность сети

Убедитесь, что сеть поддерживает пропускную способность, необходимую для одновременных сеансов мультимедиа Служб коммуникации Azure и других бизнес-приложений. Для успешного развертывания мультимедийного решения с помощью Служб коммуникации необходимо обязательно проверить сквозной сетевой путь на наличие проблем, ухудшающих пропускную способность.

Ниже приведены требования по пропускной способности для пакетов SDK для JavaScript:

|Пропускная способность|Сценарии|
|:--|:--|
|40 Кбит/с|Одноранговый голосовой вызов|
|500 Кбит/с|Одноранговый голосовой вызов и общий доступ к экрану|
|500 Кбит/с|Одноранговый видеовызов, с высоким качеством, с разрешением 360 пикселей, с частотой 30 кадров/с|
|1,2 Мбит/с|Одноранговый видеовызов, высокой четкости (HD), с разрешением 720 пикселей, с частотой 30 кадров/с|
|500 Кбит/с|Групповой видеовызов, с разрешением 360 пикселей, с частотой 30 кадров/с|
|1,2 Мбит/с|Групповой видеовызов, высокой четкости, с разрешением 720 пикселей, с частотой 30 кадров/с| 

Ниже приведены требования по пропускной способности для собственных пакетов SDK для Android и iOS:

|Пропускная способность|Сценарии|
|:--|:--|
|30 Кбит/с|Одноранговый голосовой вызов |
|130 Кбит/с|Одноранговый голосовой вызов и общий доступ к экрану|
|500 Кбит/с|Одноранговый видеовызов, с высоким качеством, с разрешением 360 пикселей, с частотой 30 кадров/с|
|1,2 Мбит/с|Одноранговый видеовызов, высокой четкости (HD), с разрешением 720 пикселей, с частотой 30 кадров/с|
|1,5 Мбит/с|Одноранговый видеовызов, высокой четкости (HD), с разрешением 1080 пикселей, с частотой 30 кадров/с |
|500 Кбит/с или 1 Мбит/с|Групповой видеовызов|
|1 Мбит/с или 2 Мбит/с|Групповой видеовызов высокой четкости (видео 540 пикселей на экране 1080 пикселей)|

### <a name="firewalls-configuration"></a>Конфигурация брандмауэров

Для подключений к Службам коммуникации Azure требуется подключение к Интернету для конкретных портов и IP-адресов, чтобы обеспечить возможности высококачественного мультимедиа. Если доступа к этим портам и IP-адресам нет, Службы коммуникации Azure по-прежнему могут работать. Однако оптимальное качество работы обеспечивается в случае, если открыты рекомендуемые порты и диапазоны IP-адресов.

| Категория | Диапазоны IP-адресов или полное доменное имя | порты; | 
| :-- | :-- | :-- |
| Мультимедийный трафик | [Диапазон IP-адресов общедоступного облака Azure](https://www.microsoft.com/download/confirmation.aspx?id=56519) | UDP 3478 – 3481, TCP-порты 443 |
| Сигнализация, телеметрия, регистрация| *.skype.com, *.microsoft.com, *.azure.net, *.azureedge.net, *.office.com, *.trouter.io | TCP 443, 80 |

### <a name="network-optimization"></a>Оптимизация сети

Следующие задачи являются вспомогательными и не являются обязательными для развертывания Служб коммуникации Azure. Используйте данное руководство для оптимизации сети и производительности Служб коммуникации Azure либо если вы знаете, что в вашей сети существуют ограничения.
Дальнейшая оптимизация может потребоваться в следующих случаях:
* Службы коммуникации Azure работают медленно (возможно, у вас низкая пропускная способность)
* Соединения разъединяются (возможно, из-за блокировки в брандмауэре или на прокси-сервере)
* Для вызовов существуют статические ограничения, и они прерываются, или голоса имеют механический оттенок (возможно, вследствие дрожания или потери пакетов)

| Задача по оптимизации сети | Сведения |
| :-- | :-- |
| Планирование конфигурации сети | В этом документе приведены минимальные требования к сети применительно к вызовам. См. статью [Пример Teams для планирования сети](https://docs.microsoft.com/microsoftteams/tutorial-network-planner-example) |
| Внешнее разрешение имен | Убедитесь, что все компьютеры, на которых выполняются пакеты SDK для Служб коммуникации Azure, могут разрешать внешние запросы DNS для обнаружения услуг, предоставляемых Службами коммуникации Azure, а брандмауэры не блокируют доступ. Убедитесь, что пакеты SDK могут разрешать адреса *.skype.com, *.microsoft.com, *.azure.net, *.azureedge.net, *.office.com, *.trouter.io  |
| Обеспечение сохранения сеансов | Убедитесь, что брандмауэр не изменяет сопоставленные адреса или порты NAT для UDP
Проверка размера пула NAT | Проверьте размер пула преобразования сетевых адресов (NAT), необходимый для обеспечения связи для пользователей. Если несколько пользователей и устройств получают доступ к Службам коммуникации Azure с помощью [преобразования сетевых адресов (NAT) или преобразования адресов портов (PAT)](https://docs.microsoft.com/office365/enterprise/nat-support-with-office-365), убедитесь, что количество устройств, скрытых за каждым общедоступным маршрутизируемым IP-адресом, не превышает поддерживаемое значение. Убедитесь, что пулам NAT назначены соответствующие общедоступные IP-адреса для предотвращения нехватки портов. Нехватка портов будет негативно влиять на внутренних пользователей и устройства, и они не смогут подключиться к Службам коммуникации Azure |
| Руководство по обнаружению и предотвращению вторжений | Если в вашей среде имеется система [обнаружения вторжений](https://docs.microsoft.com/azure/network-watcher/network-watcher-intrusion-detection-open-source-tools) или их предотвращения (IDS/IPS), развернутая для обеспечения дополнительного уровня безопасности исходящих подключений, разрешите все URL-адреса Служб коммуникации Azure |
| Настройка сети VPN с разделенным туннелем | Рекомендуем создать альтернативный путь для трафика Teams, который обходит виртуальную частную сеть (VPN), обычно называемую [VPN-подключением с разделенным туннелем](https://docs.microsoft.com/windows/security/identity-protection/vpn/vpn-routing). Разделенное туннелирование означает, что трафик для Служб коммуникации Azure не проходит через VPN, а вместо этого передается непосредственно в Azure. Обход VPN будет оказывать положительное воздействие на качество мультимедиа и сокращать нагрузку, поступающую из VPN-устройств и из сети организации. Чтобы реализовать VPN-подключение с разделенным туннелем, обратитесь к своему поставщику VPN. Ниже перечислены другие причины, по которым мы рекомендуем применять обход VPN. <ul><li> Обычно сети VPN не предназначены и не настроены для поддержки мультимедиа в режиме реального времени.</li><li> Сети VPN также могут не поддерживать протокол UDP (который необходим для Служб коммуникации Azure)</li><li>В сетях VPN также обеспечивается дополнительное шифрование мультимедийного трафика, который уже зашифрован.</li><li>Связь со Службами коммуникации Azure может оказаться неэффективной из-за разворота трафика через VPN-устройство.</li></ul>|
| Реализация QoS | [Используйте качество обслуживания (QoS)](https://docs.microsoft.com/microsoftteams/qos-in-teams) для настройки приоритета пакетов. Это улучшит качество вызовов и позволит отслеживать его, а также устранять проблемы с качеством. QoS должно быть реализовано во всех сегментах управляемой сети. Даже если сеть была хорошо подготовлена для поддержки пропускной способности, QoS обеспечивает устранение рисков в случае непредвиденных сетевых событий. Благодаря применению QoS более высокий приоритет получает голосовой трафик, чтобы такие непредвиденные события не ухудшали качество. | 
| Оптимизация WiFi | Как и VPN, сети Wi-Fi не предназначены специально или не настраиваются для поддержки мультимедиа в режиме реального времени. Планирование и оптимизация сети Wi-Fi для поддержки Служб коммуникации Azure имеет большое значение для высококачественного развертывания. Учитывайте следующие факторы: <ul><li>Реализуйте технологию QoS или Wi-Fi (WMM), чтобы обеспечить оптимальное определение приоритета мультимедийного трафика в сетях WiFi.</li><li>Планируйте и оптимизируйте диапазоны Wi-Fi и размещение точек доступа. Диапазон 2,4 ГГц может обеспечить хорошие условия работы в зависимости от размещения точек доступа, но точки доступа часто зависят от других потребительских устройств, которые также работают в этом диапазоне. Диапазон из 5 ГГц лучше подходит для мультимедиа в режиме реального времени благодаря своему плотному диапазону, но для обеспечения хорошего покрытия требуется больше точек доступа. Конечные точки также должны поддерживать этот диапазон и быть настроены таким образом, чтобы использовать поддерживаемые полосы частот.</li><li>Если вы используете двухдиапазонные сети Wi-Fi, принимайте во внимание реализацию функции наведения на полосу частот. Наведение на полосу частот представляет собой специальный метод, реализуемый поставщиками WiFi, с помощью которого двухдиапазонные клиентские устройства принудительно используют диапазон 5 ГГц.</li><li>Если точки доступа одного канала находятся слишком близко друг к другу, это может привести к наложению сигналов и к непреднамеренным состязаниям, в результате чего качество связи для пользователя будет ухудшаться. Убедитесь, что точки доступа, расположенные рядом друг с другом, находятся на непересекающихся каналах.</li></ul> У каждого поставщика беспроводной связи есть собственные рекомендации по развертыванию беспроводных решений. Для получения конкретных инструкций обратитесь к своему поставщику WiFi.|



### <a name="operating-system-and-browsers-for-javascript-sdks"></a>Операционная система и браузеры (для пакетов SDK для JavaScript)

Пакеты SDK для голосовых и видеовызовов для Служб коммуникации Azure поддерживают определенные операционные системы и браузеры.
Дополнительные сведения об операционных системах и браузерах, поддерживаемых пакетами SDK для вызовов, см. в [основной документации по обеспечению связи](https://docs.microsoft.com/azure/communication-services/concepts/voice-video-calling/calling-sdk-features).

## <a name="next-steps"></a>Дальнейшие действия

Вас могут заинтересовать следующие документы:

- Сведения о [вызове библиотек](https://docs.microsoft.com/azure/communication-services/concepts/voice-video-calling/calling-sdk-features)
- Сведения об [архитектуре "клиент — сервер"](https://docs.microsoft.com/azure/communication-services/concepts/client-and-server-architecture)
- См. дополнительные сведения о [топологиях потока вызовов](https://docs.microsoft.com/azure/communication-services/concepts/call-flows).
