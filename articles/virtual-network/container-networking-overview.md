---
title: Сетевая работа контейнера в виртуальной сети Azure | Документация Майкрософт
description: Узнайте о подключаемом модуле сетевого интерфейса контейнера (CNI) виртуальной сети Azure и о том, как разрешить контейнерам использовать виртуальную сеть Azure.
services: virtual-network
documentationcenter: na
author: aanandr
manager: NarayanAnnamalai
editor: ''
tags: azure-resource-manager
ms.assetid: ''
ms.service: virtual-network
ms.devlang: na
ms.topic: conceptual
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 9/18/2018
ms.author: aanandr
ms.custom: ''
ms.openlocfilehash: 727e79cede9319cb7aae701082d5842ad895a61d
ms.sourcegitcommit: 910a1a38711966cb171050db245fc3b22abc8c5f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "98223522"
---
# <a name="enable-containers-to-use-azure-virtual-network-capabilities"></a>Включение контейнеров для использования возможностей виртуальной сети Azure

Внесите широкий набор возможностей сети Azure в контейнеры, используя тот же программный сетевой стек, который обеспечивает работу виртуальных машин. Подключаемый модуль сетевого интерфейса контейнера (CNI) виртуальной сети Azure устанавливается на виртуальной машине Azure. Подключаемый модуль назначает IP-адреса из виртуальной сети к контейнерам, созданным на виртуальной машине, присоединяя их к виртуальной сети и напрямую подключая к другим контейнерам и виртуальным сетевым ресурсам. Подключаемый модуль не использует оверлейные сети или маршруты для подключения и обеспечивает ту же производительность, что и виртуальные машины. Подключаемый модуль предоставляет на высоком уровне такие возможности:

- IP-адрес виртуальной сети присваивается каждому Pod, который может состоять из одного или нескольких контейнеров.
- Контейнеры Pod могут подключаться к пиринговым виртуальным сетям и к локальным сетям через ExpressRoute или VPN-подключение типа "сеть — сеть". Они также доступны из пиринговых и локальных сетей.
- Контейнеры Pod могут получить доступ к таким службам, как служба хранилища Azure и База данных SQL Azure, которые защищены конечными точками служб для виртуальной сети.
- Группы безопасности сети и маршруты могут быть применены непосредственно к контейнерам Pod.
- Контейнеры Pod можно поместить непосредственно за внутренним или общедоступным Azure Load Balancer, подобно виртуальным машинам.
- Контейнерам Pod может быть назначен общедоступный IP-адрес, который делает их напрямую доступными из Интернета. Контейнеры Pod также могут получить доступ в Интернет самостоятельно.
- Они хорошо работают с ресурсами Kubernetes, такими как службы, контроллеры входящего трафика и Kube DNS. Служба Kubernetes также предоставляется на внешнем или внутреннем уровне через Azure Load Balancer.

На следующем рисунке показано, как подключаемый модуль предоставляет возможности виртуальной сети Azure для контейнеров Pod.

![Обзор работы контейнера в сети](./media/container-networking/container-networking-overview.png)

Подключаемый модуль поддерживает платформы Windows и Linux.

## <a name="connecting-pods-to-a-virtual-network"></a>Подключение контейнеров Pod к виртуальной сети

Контейнеры Pod внесены в виртуальную машину, которая является частью виртуальной сети. Пул IP-адресов для контейнеров Pod настроен как дополнительные адреса в сетевом интерфейсе виртуальной машины. Azure CNI устанавливает базовое сетевое подключение контейнеров Pod и управляет использованием IP-адресов в пуле. Когда на виртуальной машине появляется Pod, Azure CNI назначает доступный IP-адрес из пула и подключает Pod к программному мосту на виртуальной машине. При завершении работы контейнера Pod IP-адрес добавляется обратно в пул. На следующем рисунке показано, как контейнеры Pod подключаются к виртуальной сети.

![Сведения о работе с контейнерами в сети](./media/container-networking/container-networking-detail.png)

## <a name="internet-access"></a>Доступ к Интернету

Чтобы включить контейнерам Pod доступ в Интернет, подключаемый модуль настраивает правила *iptables* для преобразования сетевых адресов (NAT) границ трафика Интернета от контейнеров Pods. IP-адрес источника пакета будет преобразован в основной IP-адрес для сетевого интерфейса виртуальной машины. Виртуальные машины Windows автоматически отправляют трафик источника преобразования сетевых адресов (SNAT), предназначенный для IP-адресов за пределами подсети, к которой принадлежит виртуальная машина. Как правило, весь трафик, предназначенный для IP-адреса за пределами диапазона IP-адресов виртуальной сети, будет преобразован.

## <a name="limits"></a>Ограничения

Подключаемый модуль поддерживает до 250 контейнеров Pod на каждую виртуальную машину и до 16 000 контейнеров Pod в виртуальной сети. Эти ограничения отличаются от ограничений для [Службы Azure Kubernetes](../azure-resource-manager/management/azure-subscription-service-limits.md?toc=%2fazure%2fvirtual-network%2ftoc.json#azure-kubernetes-service-limits).

## <a name="using-the-plug-in"></a>Использование подключаемого модуля

Подключаемый модуль можно использовать одним из следующих способов для обеспечения базового подключения виртуальной сети контейнеров Pod или Docker:

- **Служба Azure Kubernetes**. Подключаемый модуль интегрируется в службу Azure Kubernetes (AKS) и может использоваться при выборе параметра *Расширенная сеть*. Расширенная сеть позволяет развернуть кластер Kubernetes в существующей или новой виртуальной сети. Дополнительные сведения о расширенной сети и ее настройке см. в разделе [Конфигурация сети в Службе Azure Kubernetes (AKS)](../aks/configure-azure-cni.md?toc=%2fazure%2fvirtual-network%2ftoc.json).
- **Обработчик AKS**: является средством, которое создает шаблон Azure Resource Manager для развертывания кластера Kubernetes в Azure. Подробные инструкции см. в разделе [Развертывание подключаемого модуля для кластера Kubernetes с обработчиком AKS](deploy-container-networking.md#deploy-the-azure-virtual-network-container-network-interface-plug-in).
- **Создание кластера Kubernetes в Azure** Подключаемый модуль можно использовать для предоставления основных сетей для контейнеров Pod в кластерах Kubernetes, которые вы развертываете самостоятельно, не полагаясь на AKS и такие средства, как обработчик AKS. В этом случае подключаемый модуль установлен и включен на каждой виртуальной машине в кластере. Подробные инструкции см. в разделе [Развертывание подключаемого модуля для кластера Kubernetes](deploy-container-networking.md#deploy-plug-in-for-a-kubernetes-cluster).
- **Подключение виртуальной сети к контейнерам Docker в Azure**. Подключаемый модуль может использоваться в тех случаях, когда вы не хотите создавать кластер Kubernetes, а хотите создать контейнеры Docker с подключением виртуальной сети в виртуальных машинах. Подробные инструкции см. в разделе [Развертывание подключаемого модуля для контейнеров Docker](deploy-container-networking.md#deploy-plug-in-for-docker-containers).

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения см. в разделе о [развертывании подключаемого модуля](deploy-container-networking.md) для кластеров Kubernetes и контейнеров Docker.