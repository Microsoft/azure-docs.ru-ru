---
title: Руководство. Подключение виртуальных сетей с помощью Пиринга виртуальных сетей — портал Azure
description: Из этой статьи вы узнаете, как подключить виртуальные сети с помощью пиринга и портала Azure.
services: virtual-network
documentationcenter: virtual-network
author: KumudD
ms.service: virtual-network
ms.devlang: azurecli
ms.topic: tutorial
ms.tgt_pltfrm: virtual-network
ms.workload: infrastructure
ms.date: 01/22/2020
ms.author: kumud
ms.custom: ''
ms.openlocfilehash: b7fcf7f60b18d0d44ded67cb5b22bcdcdcd56a77
ms.sourcegitcommit: 73fb48074c4c91c3511d5bcdffd6e40854fb46e5
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/31/2021
ms.locfileid: "106059332"
---
# <a name="tutorial-connect-virtual-networks-with-virtual-network-peering-using-the-azure-portal"></a>Руководство. Подключение виртуальных сетей с помощью пиринга и портала Azure

Виртуальные сети можно подключить друг к другу с помощью пиринговой связи. Эти виртуальные сети могут быть расположены как в одном регионе, так и в разных. Установка пиринговой связи между виртуальными сетями в разных регионах называется глобальным пирингом виртуальных сетей. После установки пиринговой связи ресурсы в обеих виртуальных сетях могут взаимодействовать друг с другом с такой же задержкой и пропускной способностью, как если бы эти ресурсы находились в одной виртуальной сети. В этом руководстве описано следующее:

> [!div class="checklist"]
> * создание двух виртуальных сетей;
> * соединение двух виртуальных сетей с помощью пиринговой связи;
> * развертывание виртуальной машины в каждой из виртуальных сетей;
> * Взаимодействие между виртуальными машинами

При необходимости инструкции из этого руководства можно выполнить с помощью [Azure CLI](tutorial-connect-virtual-networks-cli.md) или [Azure PowerShell](tutorial-connect-virtual-networks-powershell.md).

## <a name="prerequisites"></a>Предварительные требования

Для начала работы вам потребуется учетная запись Azure с активной подпиской. Если ее нет, можно создать [учетную запись бесплатно](https://azure.microsoft.com/free/?WT.mc_id=A261C142F).

## <a name="log-in-to-azure"></a>Вход в Azure

Войдите на портал Azure по адресу https://portal.azure.com.

## <a name="create-virtual-networks"></a>Создание виртуальных сетей

1. На портале Azure выберите **Создать ресурс**.
2. Щелкните **Сеть** и выберите **Виртуальная сеть**.
3. На вкладке **Основные сведения** введите или выберите следующие значения и примите значения по умолчанию для остальных параметров.

    |Параметр|Значение|
    |---|---|
    |Подписка| Выберите свою подписку.|
    |Группа ресурсов| Выберите **Создать новую**, а затем введите *myResourceGroup*.|
    |Регион| Выберите **Восточная часть США**.|
    |Имя|myVirtualNetwork1|

4. На вкладке **IP-адреса** в поле **Адресное пространство** введите 10.0.0.0/16. Ниже нажмите кнопку **Добавить подсеть** и введите *Subnet1* в поле **Имя подсети** и 10.0.0.0/24 в поле **Диапазон адресов подсети**.
5. Выберите **Review + Create** (Просмотр и создание), а затем выберите **Создать**.
   
5. Повторите шаги 1–5 со следующими изменениями.

    |Параметр|Значение|
    |---|---|
    |Имя|myVirtualNetwork2|
    |Пространство адресов|10.1.0.0/16|
    |Группа ресурсов| Щелкните **Use existing** (Использовать существующую), а затем выберите **myResourceGroup**.|
    |Имя подсети | Подсеть 2|
    |Диапазон адресов подсети|10.1.0.0/24|

## <a name="peer-virtual-networks"></a>Установка пиринговой связи между виртуальными сетями

1. В поле "Поиск" в верхней части портала Azure начните вводить *MyVirtualNetwork1*. Когда в результатах поиска появится пункт **myVirtualNetwork1**, выберите его.
2. В разделе **Параметры** выберите **Пиринги**, а затем щелкните **Добавить**, как показано на следующем рисунке.

    ![Создание пиринга](./media/tutorial-connect-virtual-networks-portal/create-peering.png)

3. Введите или выберите следующие значения, примите значения по умолчанию для остальных параметров и нажмите кнопку **ОК**.

    |Параметр|Значение|
    |---|---|
    |Имя пиринга между myVirtualNetwork1 и удаленной виртуальной сетью|myVirtualNetwork1-myVirtualNetwork2. При первой загрузке страницы вы увидите фразу "Удаленная виртуальная сеть". После выбора удаленной виртуальной сети фраза "Удаленная виртуальная сеть" будет заменена именем этой сети.|
    |Подписка| Выберите свою подписку.|
    |Виртуальная сеть|myVirtualNetwork2. Чтобы выбрать виртуальную сеть *myVirtualNetwork2*, щелкните **Виртуальная сеть**, а затем — **myVirtualNetwork2 (myResourceGroup)**. Вы можете выбрать виртуальную сеть в том же или другом регионе.|
    |Имя пиринга между myVirtualNetwork2 и myVirtualNetwork1|myVirtualNetwork2-myVirtualNetwork1|

    ![Параметры пиринга](./media/tutorial-connect-virtual-networks-portal/peering-settings-bidirectional.png)

    Параметр **Состояние пиринга** имеет значение *Подключено*, как показано на следующем рисунке:

    ![Состояние пиринга](./media/tutorial-connect-virtual-networks-portal/peering-status-connected.png)

    Если состояние не отображается, обновите страницу в браузере.

## <a name="create-virtual-machines"></a>Создание виртуальных машин

Создайте виртуальную машину в каждой виртуальной сети, чтобы на следующем шаге организовать взаимодействие между такими машинами.

### <a name="create-the-first-vm"></a>Создание первой виртуальной машины

1. На портале Azure выберите **Создать ресурс**.
2. Выберите **Вычисления**, а затем — **Windows Server 2016 Datacenter**. Вы можете выбрать другую ОС, однако в оставшейся части этого руководства предполагается, что выбрано **Windows Server 2016 Datacenter**. 
3. Введите или выберите следующие значения в разделе **Основные сведения**, примите значения по умолчанию для остальных параметров и нажмите кнопку **Создать**.

    |Параметр|Значение|
    |---|---|
    |Группа ресурсов| Щелкните **Use existing** (Использовать существующую), а затем выберите **myResourceGroup**.|
    |Имя|myVm1|
    |Расположение| Выберите **Восточная часть США**.|
    |Имя пользователя| Введите выбранное имя пользователя.|
    |Пароль| Введите выбранный пароль. Пароль должен включать минимум 12 символов и соответствовать [определенным требованиям к сложности](../virtual-machines/windows/faq.md?toc=%2fazure%2fvirtual-network%2ftoc.json#what-are-the-password-requirements-when-creating-a-vm).|
   
4. Выберите размер виртуальной машины для параметра **Размер**.
5. В разделе **Сеть** выберите следующие значения:

    |Параметр|Значение|
    |---|---|
    |Виртуальная сеть| myVirtualNetwork1. Если она еще не выбрана, щелкните **Виртуальная сеть**, а затем выберите **myVirtualNetwork1**.|
    |Подсеть| Subnet1. Если она еще не выбрана, щелкните **Подсеть**, а затем выберите **Subnet1**.|
   
6. Выберите **Сети**. Для параметра **Общедоступные входящие порты** выберите **Разрешить выбранные порты**. Укажите **RDP** для параметра **Выбрать входящие порты**. 

7. Нажмите кнопку **Просмотр и создание** в нижнем левом углу, чтобы запустить развертывание виртуальной машины.

### <a name="create-the-second-vm"></a>Создание второй виртуальной машины

Повторите шаги 1–6 со следующими изменениями.

|Параметр|Значение|
|---|---|
|Имя | myVm2|
|Виртуальная сеть | myVirtualNetwork2|

Создание виртуальных машин может занять несколько минут. Прежде чем выполнять оставшиеся шаги, обязательно дождитесь создания обеих виртуальных машин.

## <a name="communicate-between-vms"></a>Взаимодействие между виртуальными машинами

1. В поле *Поиск* в верхней части портала начните вводить *myVm1*. Когда виртуальная машина **myVm1** появится в результатах поиска, выберите ее.
2. Подключите удаленный рабочий стол к виртуальной машине *myVm1*, выбрав **Подключиться**, как показано на следующем рисунке:

    ![Подключение к виртуальной машине](./media/tutorial-connect-virtual-networks-portal/connect-to-virtual-machine.png)  

3. Чтобы подключиться к виртуальной машине, откройте скачанный RDP-файл. При появлении запроса выберите **Подключиться**.
4. Введите имя пользователя и пароль, которые вы указали при создании виртуальной машины (возможно, для этого придется выбрать **Дополнительные варианты** и **Использовать другую учетную запись**). Затем нажмите кнопку **ОК**.
5. При входе в систему может появиться предупреждение о сертификате. Чтобы продолжить процесс подключения, выберите **Да**.
6. На следующем шаге будет использоваться проверка связи для обращения к виртуальной машине *myVm2* с виртуальной машины *myVm1*. Для проверки связи используется протокол ICMP, который по умолчанию запрещен в брандмауэре Windows. На виртуальной машине *myVm1* с помощью PowerShell разрешите протокол ICMP в брандмауэре Windows, чтобы на последующем шаге можно было проверить связь с виртуальной машины *myVm2*.

    ```powershell
    New-NetFirewallRule –DisplayName "Allow ICMPv4-In" –Protocol ICMPv4
    ```
    
    Хотя проверка связи в этом руководстве используется для обмена данными между виртуальными машинами, мы не рекомендуем разрешать протокол ICMP в брандмауэре Windows в рабочей среде.

7. Для подключения к виртуальной машине *myVm2* введите следующую команду в командной строке на виртуальной машине *myVm1*:

    ```
    mstsc /v:10.1.0.4
    ```
    
8. Так как на виртуальной машине *myVm1* включена проверка связи, теперь можно проверить связь по IP-адресу:

    ```
    ping 10.0.0.4
    ```
    
9. Отключите RDP-сеансы с *myVm1* и *myVm2*.

## <a name="clean-up-resources"></a>Очистка ресурсов

Удалите группу ресурсов и все содержащиеся в ней ресурсы, когда она станет не нужна. 

1. В поле **Поиск** в верхней части портала введите *myResourceGroup*. Когда группа ресурсов **myResourceGroup** появится в результатах поиска, выберите ее.
2. Выберите **Удалить группу ресурсов**.
3. Введите *myResourceGroup* в поле **TYPE THE RESOURCE GROUP NAME:** (Введите имя группы ресурсов:) и нажмите кнопку **Удалить**.

## <a name="next-steps"></a>Дальнейшие действия

> [!div class="nextstepaction"]
> См. дополнительные сведения о [пиринге между виртуальными сетями](virtual-network-peering-overview.md).


