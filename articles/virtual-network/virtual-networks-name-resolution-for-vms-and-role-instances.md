---
title: Разрешение имен ресурсов в виртуальных сетях Azure | Документация Майкрософт
titlesuffix: Azure Virtual Network
description: Сценарии разрешения имен для Azure IaaS, гибридных решений, между различными облачными службами, Active Directory и с помощью DNS-сервера.
services: virtual-network
documentationcenter: na
author: rohinkoul
ms.service: virtual-network
ms.devlang: na
ms.topic: how-to
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 3/2/2020
ms.author: rohink
ms.custom: fasttrack-edit
ms.openlocfilehash: bbaf2fb99f1268a752fab4322078b0566a054d30
ms.sourcegitcommit: 910a1a38711966cb171050db245fc3b22abc8c5f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "98222859"
---
# <a name="name-resolution-for-resources-in-azure-virtual-networks"></a>Разрешение имен ресурсов в виртуальных сетях Azure | Документация Майкрософт

В зависимости от того, как вы используете Azure для размещения решений IaaS, PaaS и гибридных решений, вам может понадобиться разрешить виртуальным машинам и другим ресурсам, развернутым в виртуальной сети, взаимодействовать друг с другом. Хотя это взаимодействие может осуществляться с помощью IP-адресов, гораздо проще использовать имена узлов, которые легко запоминаются и не меняются. 

Когда ресурсы, развернутые в виртуальных сетях, должны разрешать доменные имена внутренним IP-адресам, они могут использовать один из трех методов:

* [Azure DNS частные зоны](../dns/private-dns-overview.md)
* [разрешение имен Azure;](#azure-provided-name-resolution)
* [разрешение имен с помощью собственного DNS-сервера](#name-resolution-that-uses-your-own-dns-server) (при этом запросы могут перенаправляться на DNS-серверы, предоставляемые Azure).

Тип разрешения имен зависит от способа взаимодействия ресурсов друг с другом. В приведенной ниже таблице представлены сценарии и соответствующие решения для разрешения имен.

> [!NOTE]
> Azure DNS частные зоны — это предпочтительное решение, обеспечивающее гибкость управления зонами и записями DNS. Дополнительные сведения см. в статье [Использование Azure DNS для частных доменов](../dns/private-dns-overview.md).

> [!NOTE]
> Если вы используете DNS, предоставленную Azure, соответствующий DNS-суффикс будет автоматически применен к виртуальным машинам. Для всех остальных параметров необходимо либо использовать полные доменные имена (FQDN), либо вручную применить соответствующий DNS-суффикс к виртуальным машинам.

| **Сценарий** | **Решение** | **DNS-суффикс** |
| --- | --- | --- |
| Разрешение имен между виртуальными машинами, расположенными в одной виртуальной сети, или между экземплярами роли облачных служб, расположенными в одной облачной службе. | [Azure DNS частные зоны](../dns/private-dns-overview.md) или [разрешение имен, предоставленное Azure](#azure-provided-name-resolution) |Имя узла или полное доменное имя |
| Разрешение имен между виртуальными машинами, расположенными в разных виртуальных сетях, или экземплярами ролей, расположенными в разных облачных службах. |[Azure DNS частные зоны](../dns/private-dns-overview.md) или управляемые клиентом DNS-серверы пересылает запросы между виртуальными сетями для разрешения с помощью Azure (DNS-прокси). См. раздел [разрешение имен с помощью собственного DNS-сервера](#name-resolution-that-uses-your-own-dns-server). |только полное доменное имя |
| Разрешение имен из службы приложений Azure (веб-приложение, функция или бот) с использованием интеграции виртуальной сети для экземпляров ролей или виртуальных машин, расположенных в одной виртуальной сети. |Управляемые клиентами DNS-серверы, перенаправляющие запросы между виртуальными сетями для разрешения в Azure (DNS-прокси). См. раздел [разрешение имен с помощью собственного DNS-сервера](#name-resolution-that-uses-your-own-dns-server). |только полное доменное имя |
| Разрешение имен из веб-приложений службы приложений для виртуальных машин, расположенных в одной виртуальной сети. |Управляемые клиентами DNS-серверы, перенаправляющие запросы между виртуальными сетями для разрешения в Azure (DNS-прокси). См. раздел [разрешение имен с помощью собственного DNS-сервера](#name-resolution-that-uses-your-own-dns-server). |только полное доменное имя |
| Разрешение имен из веб-приложений службы приложений для виртуальных машин, расположенных в разных виртуальных сетях. |Управляемые клиентами DNS-серверы, перенаправляющие запросы между виртуальными сетями для разрешения в Azure (DNS-прокси). См. раздел [разрешение имен с помощью собственного DNS-сервера](#name-resolution-that-uses-your-own-dns-server). |только полное доменное имя |
| Разрешение имен локального компьютера и службы из экземпляров роли или виртуальных машин в Azure. |Управляемые клиентами DNS-серверы (например, локальный контроллер домена, локальный контроллер домена только для чтения или DNS-сервер, вторично синхронизированный с помощью передач зоны). См. раздел [разрешение имен с помощью собственного DNS-сервера](#name-resolution-that-uses-your-own-dns-server). |только полное доменное имя |
| Разрешение имен узлов Azure с локальных компьютеров. |Перенаправление запросов на управляемый клиентом DNS прокси-сервер в соответствующей виртуальной сети, прокси-сервер перенаправляет запросы в Azure для разрешения. См. раздел [разрешение имен с помощью собственного DNS-сервера](#name-resolution-that-uses-your-own-dns-server). |только полное доменное имя |
| Обратный поиск DNS для внутренних IP-адресов. |[Azure DNS частные зоны](../dns/private-dns-overview.md) или разрешение [имен, предоставляемых Azure](#azure-provided-name-resolution) , [с помощью собственного DNS-сервера](#name-resolution-that-uses-your-own-dns-server). |Неприменимо |
| Разрешение имен между виртуальными машинами или экземплярами ролей, расположенными не в виртуальной сети, а в различных облачных службах. |Не применяется Подключение между виртуальными машинами и экземплярами ролей в разных облачных службах не поддерживается за пределами виртуальной сети. |Неприменимо|

## <a name="azure-provided-name-resolution"></a>разрешение имен Azure;

Разрешение имен, предоставленное Azure, предоставляет только основные заслуживающие доверия возможности DNS. При использовании этого параметра имена и записи зон DNS будут автоматически управляться Azure, и вы не сможете управлять именами зон DNS или жизненным циклом записей DNS. Если вам требуется полнофункциональное решение DNS для виртуальных сетей, необходимо использовать [Azure DNS частные зоны](../dns/private-dns-overview.md) или DNS- [серверы, управляемые клиентами](#name-resolution-that-uses-your-own-dns-server).

Вместе с разрешением общедоступных DNS-имен Azure предоставляет разрешение внутренних имен для виртуальных машин и экземпляров ролей, которые находятся в той же виртуальной сети или облачной службе. Виртуальные машины и экземпляры в облачной службе используют одинаковый DNS-суффикс (поэтому имени узла достаточно). Но в виртуальных сетях, использующих классическую модель развертывания, разные облачные службы используют разные DNS-суффиксы. В этом случае для разрешения имен между разными облачными службами требуется полное доменное имя. В виртуальных сетях, развернутых с помощью модели развертывания Azure Resource Manager, DNS-суффикс согласован по всем виртуальным машинам в виртуальной сети, поэтому полное доменное имя не требуется. DNS-имена могут назначаться виртуальным машинам и сетевым интерфейсам. Несмотря на то, что разрешение имен Azure не требует настройки, как указано в предыдущей таблице, это не самый лучший выбор для всех сценариев развертывания.

> [!NOTE]
> Используя веб-роли и рабочие роли облачных служб, вы можете также получать доступ ко внутренним IP-адресам экземпляров ролей с помощью REST API управления службами Azure. Дополнительные сведения см. в [справочнике по REST API управления службами](/previous-versions/azure/ee460799(v=azure.100)). Адрес основан на имени роли и номере экземпляра. 
>

### <a name="features"></a>Компоненты

Разрешение имен Azure предоставляет следующие возможности.
* Простота использования. Настройка не требуется.
* обеспечение высокой доступности; Каждый набор масштабирования помещает свои виртуальные машины в группу доступности с 5 доменами сбоя (FD) и 5 доменами обновления (UD) для обеспечения доступности (дополнительные сведения о доменах сбоя и обновления см. Вам не нужно создавать кластеры DNS-серверов и управлять ими.
* Служба может использоваться в сочетании с DNS-серверами для разрешения имен узлов в локальной среде и Azure.
* Можно использовать разрешение имен между виртуальными машинами или экземплярами ролей, расположенными в одной облачной службе, без необходимости указывать полное доменное имя.
* Можно использовать разрешение имен между виртуальными машинами в виртуальных сетях, использующих модель развертывания с помощью Azure Resource Manager, без необходимости указывать полное доменное имя. В виртуальных сетях с классической моделью развертывания полное доменное имя требуется при разрешении имен в разных облачных службах. 
* Вместо использования автоматически создаваемых имен узлов вы можете создавать имена, которые наиболее точно описывают ваши развертывания.

### <a name="considerations"></a>Рекомендации

Ниже приведены рекомендации по использованию разрешения имен Azure.
* Созданный Azure DNS-суффикс нельзя изменить.
* Поиск DNS ограничивается виртуальной сетью. DNS-имена, созданные для одной виртуальной сети, не могут быть разрешены из других виртуальных сетей.
* Собственные записи нельзя регистрировать вручную.
* WINS и NetBIOS не поддерживаются. В проводнике Windows виртуальные машины не отображаются.
* Имена узлов должны быть совместимыми с DNS. Имена могут содержать только 0–9, a–z, "-" и не могут начинаться или заканчиваться на "-".
* Трафик запросов DNS регулируется для каждой виртуальной машины. Регулирование не должно влиять на большинство приложений. Если наблюдается регулирование запросов, проверьте, включено ли кэширование на стороне клиента. Для получения дополнительных сведений ознакомьтесь с разделом [Настройка клиента DNS](#dns-client-configuration).
* Для всех классических виртуальных сетей, использующих классическую модель развертывания, зарегистрированы только те виртуальные машины, которые находятся в первых 180 облачных службах. Это ограничение не относится к виртуальным сетям в Azure Resource Manager.
* Azure DNS IP-адрес — 168.63.129.16. Это статический IP-адрес, который не изменится.

### <a name="reverse-dns-considerations"></a>Рекомендации по обратным DNS
Обратная DNS поддерживается во всех виртуальных сетях на основе ARM. Обратные запросы DNS (PTR-запросы) можно выполнять, чтобы сопоставлять IP-адреса виртуальных машин с полным доменным числом виртуальных машин.
* Все запросы PTR для IP-адресов виртуальных машин будут возвращать полные доменные имена формы \[ vmname \] . internal.cloudapp.NET
* Прямой просмотр на полных доменных именах формы \[ vmname \] . internal.cloudapp.NET будет разрешаться в IP-адрес, назначенный виртуальной машине.
* Если виртуальная сеть связана с [Azure DNS частными зонами](../dns/private-dns-overview.md) в качестве виртуальной сети регистрации, обратные запросы DNS будут возвращать две записи. Одна запись будет иметь вид \[ vmname \] . [ приватеднсзоненаме], а другой будет иметь форму \[ vmname \] . internal.cloudapp.NET
* Обратный поиск DNS ограничивается заданной виртуальной сетью, даже если она соединена с другими виртуальными сетями. Обратные запросы DNS (запросы PTR) для IP-адресов виртуальных машин, расположенных в одноранговых виртуальных сетях, будут возвращать NXDOMAIN.
* Если вы хотите отключить обратную функцию DNS в виртуальной сети, это можно сделать, создав зону обратного просмотра с помощью [Azure DNS частных зон](../dns/private-dns-overview.md) и привязать эту зону к виртуальной сети. Например, если пространство IP-адресов виртуальной сети — 10.20.0.0/16, можно создать пустую закрытую зону DNS 20.10.in-addr. arpa и связать ее с виртуальной сетью. При связывании зоны с виртуальной сетью следует отключить автоматическую регистрацию по ссылке. Эта зона переопределит зоны обратного просмотра по умолчанию для виртуальной сети, и так как эта зона пуста, вы получите NXDOMAIN для запросов обратного DNS. Сведения о том, как создать частную зону DNS и связать ее с виртуальной сетью, см. в нашем [кратком руководстве](../dns/private-dns-getstarted-portal.md) .

> [!NOTE]
> Если требуется обратный поиск DNS для нескольких виртуальных сетей, можно создать зону обратного просмотра (in-addr. arpa) [Azure DNS частные зоны](../dns/private-dns-overview.md) и связать ее с несколькими виртуальными сетями. Однако вам придется вручную управлять обратными записями DNS для виртуальных машин.
>


## <a name="dns-client-configuration"></a>Настройка клиента DNS

В этом разделе рассматривается кэширование на стороне клиента и повторение операций на стороне клиента.

### <a name="client-side-caching"></a>Кэширование на стороне клиента

Не каждый запрос DNS должен отправляться по сети. Кэширование на стороне клиента помогает уменьшить задержку и повысить устойчивость к нестабильной работе сети, разрешая повторяющиеся запросы DNS из локального кэша. Записи DNS содержат механизм управления сроком жизни. Это позволяет кэшу хранить записи максимально долго, не влияя на их актуальность. Следовательно, кэширование на стороне клиента подходит для большинства ситуаций.

По умолчанию DNS-клиент Windows имеет встроенный кэш DNS. В некоторых дистрибутивах Linux возможность кэширования не включена по умолчанию. Если локальный кэш отсутствует, включите кэш DNS на каждой виртуальной машине Linux.

Существует несколько различных пакетов кэширования DNS (например, dnsmasq). Ниже описаны шаги по установке пакета dnsmasq на наиболее распространенные дистрибутивы.

* **Ubuntu (использует пакет resolvconf)**:
  * Установите пакет dnsmasq с помощью команды `sudo apt-get install dnsmasq`.
* **SUSE (использует пакет netconf)**:
  * Установите пакет dnsmasq с помощью команды `sudo zypper install dnsmasq`.
  * Включите службу dnsmasq с помощью команды `systemctl enable dnsmasq.service`. 
  * Запустите службу dnsmasq с помощью команды `systemctl start dnsmasq.service`. 
  * Измените путь **/etc/sysconfig/network/config** и замените блок *NETCONFIG_DNS_FORWARDER=""* текстом *dnsmasq*.
  * Укажите в файле resolv.conf кэш в качестве локального сопоставителя DNS, используя `netconfig update`.
* **CentOS (использует NetworkManager)**:
  * Установите пакет dnsmasq с помощью команды `sudo yum install dnsmasq`.
  * Включите службу dnsmasq с помощью команды `systemctl enable dnsmasq.service`.
  * Запустите службу dnsmasq с помощью команды `systemctl start dnsmasq.service`.
  * Добавьте в **/etc/dhclient-eth0.conf** *Начало имени домена-сервера 127.0.0.1;* .
  * Перезапустите сетевую службу с помощью команды `service network restart`, чтобы указать кэш в качестве локального сопоставителя DNS.

> [!NOTE]
> Пакет dnsmasq — один из многих доступных пакетов кэша DNS для Linux. Перед его использованием проверьте, соответствует ли он вашим потребностям, а также не установлен ли у вас другой кэш.

    
### <a name="client-side-retries"></a>Повторные попытки на стороне клиента

DNS использует преимущественно протокол UDP. Так как протокол UDP не гарантирует доставку сообщений, логика повторных попыток обрабатывается в самом протоколе DNS. Каждый DNS-клиент (ОС) может реализовывать разную логику повторных попыток в зависимости от предпочтений создателя.

* Операционные системы Windows выполняют повторную попытку через одну секунду, затем через две и четыре, а затем еще через четыре секунды. 
* Повторные попытки в ОС Linux по умолчанию выполняются через пять секунд. Рекомендуется изменить параметры повторных попыток, указав пять попыток с интервалами в одну секунду.

Проверьте текущие параметры на виртуальной машине Linux в файле `cat /etc/resolv.conf`. Например, просмотрите строку *options*.

```bash
options timeout:1 attempts:5
```

Файл resolv.conf обычно создается автоматически, его не следует изменять. Шаги по добавлению строки *options* отличаются в разных дистрибутивах.

* **Ubuntu** (использует пакет resolvconf):
  1. Добавьте строку *options* в **/etc/resolveconf/resolv.conf.d/tail**.
  2. Запустите `resolvconf -u`, чтобы выполнить обновление.
* **SUSE** (использует пакет netconf):
  1. Добавление *времени ожидания: 1 попытка: от 5* до параметра **NETCONFIG_DNS_RESOLVER_OPTIONS = ""** в **/etc/sysconfig/Network/config**.
  2. Запустите `netconfig update`, чтобы выполнить обновление.
* **CentOS** (использует NetworkManager):
  1. Добавление *эха "время ожидания параметров: 1 попытка: 5"* в **/etc/NetworkManager/Dispatcher.d/11-dhclient**.
  2. Выполните обновление с помощью команды `service network restart`.

## <a name="name-resolution-that-uses-your-own-dns-server"></a>Разрешение имен с помощью собственного DNS-сервера

В этом разделе рассматриваются виртуальные машины, экземпляры ролей и веб-приложения.

### <a name="vms-and-role-instances"></a>Виртуальные машины и экземпляры роли

Ваши требования к разрешению имен могут выйти за рамки возможностей Azure. Например, может потребоваться использовать домены Active Directory Microsoft Windows Server или разрешение DNS-имен между виртуальными сетями. Для этих сценариев Azure предоставляет возможность использовать ваши собственные DNS-серверы.

DNS-серверы в виртуальной сети могут перенаправлять запросы DNS на рекурсивные сопоставители в Azure. Это обеспечивает разрешение имен узлов в этой виртуальной сети. Например, контроллер домена, запущенный в Azure, может отвечать на запросы DNS для своих доменов и перенаправлять все остальные запросы в Azure. Перенаправление запросов позволяет виртуальным машинам видеть локальные ресурсы (с помощью контроллера домена) и имена узлов, предоставленные Azure (с помощью сервера перенаправления). Доступ к рекурсивным сопоставителям Azure предоставляется через виртуальный IP-адрес 168.63.129.16.

Перенаправление запросов DNS также позволяет выполнять разрешение DNS внутри виртуальных сетей, а также позволяет вашим локальным компьютерам выполнять разрешение имен узлов, предоставляемых Azure. Чтобы разрешить имя узла виртуальной машины, DNS-сервер виртуальной машины должен находиться в той же виртуальной сети и быть настроен для перенаправления запросов имен узлов в Azure. Так как DNS-суффиксы в разных виртуальных сетях различаются, можно использовать правила условного перенаправления для отправки запросов DNS в правильную виртуальную сеть для разрешения. На приведенном ниже рисунке показаны две виртуальные сети и локальная сеть, выполняющая разрешение DNS между виртуальными сетями с помощью этого метода. Пример DNS-сервера пересылки доступен в [коллекции шаблонов быстрого запуска Azure](https://azure.microsoft.com/documentation/templates/301-dns-forwarder/) и на сайте [GitHub](https://github.com/Azure/azure-quickstart-templates/tree/master/301-dns-forwarder).

> [!NOTE]
> Экземпляр роли может выполнять разрешение имен виртуальных машин в пределах той же виртуальной сети. Для этого он использует полное доменное имя, состоящее из имени узла виртуальной машины и DNS-суффикса **internal.cloudapp.net**. Однако в этом случае разрешение имен выполняется успешно, только если для экземпляра роли указано имя виртуальной машины, определенное в [схеме роли (CSCFG-файл)](/previous-versions/azure/reference/jj156212(v=azure.100)).
> `<Role name="<role-name>" vmName="<vm-name>">`
>
> Экземплярам ролей, которым необходимо выполнять разрешение имен виртуальных машин в другой виртуальной сети (с помощью полных доменных имен с суффиксом **internal.cloudapp.net**), требуется использовать метод, описанный в этом разделе (пользовательские DNS-серверы, перенаправляющие запросы между двумя виртуальными сетями).
>

![Схема разрешения DNS между виртуальными сетями](./media/virtual-networks-name-resolution-for-vms-and-role-instances/inter-vnet-dns.png)

При использовании разрешения имен Azure протокол Azure DHCP предоставляет внутренний DNS-суффикс (**.internal.cloudapp.net**) каждой виртуальной машине. Этот суффикс обеспечивает разрешение имен узлов как записей имени узла в зоне **internal.cloudapp.net**. При использовании собственного решения для разрешения имен этот суффикс не передается на виртуальные машины, так как это влияет на другие архитектуры DNS (например, на схему присоединения к доменам). Вместо этого в Azure предоставляется фиктивный заполнитель (*reddog.microsoft.com*).

При необходимости внутренний DNS-суффикс можно определить с помощью PowerShell или API.

* Для виртуальных сетей в Azure Resource Manager моделях развертывания суффикс доступен через [сетевой интерфейс REST API](/rest/api/virtualnetwork/networkinterfaces), командлет PowerShell [Get-азнетворкинтерфаце](/powershell/module/az.network/get-aznetworkinterface) и команду [AZ Network NIC демонстрация](/cli/azure/network/nic#az-network-nic-show) Azure CLI.
* В классических моделях развертывания суффикс можно определить, вызвав [API получения развертывания](/previous-versions/azure/reference/ee460804(v=azure.100)) или выполнив командлет [Get-AzureVM -Debug](/powershell/module/servicemanagement/azure.service/get-azurevm).

Если перенаправление запросов в Azure не соответствует вашим требованиям, необходимо предоставить собственное решение DNS. Ваше решение DNS должно:

* Предоставлять корректное разрешение имен узла, например с помощью [DDNS](virtual-networks-name-resolution-ddns.md). При использовании DDNS может потребоваться отключить очистку записей DNS. Время аренды Azure DHCP долгое, и очистка может преждевременно удалить записи DNS. 
* Предоставлять корректное рекурсивное разрешение для разрешения внешних доменных имен.
* Быть доступным (по протоколам TCP и UDP через порт 53) для клиентов, которых оно обслуживает, и иметь доступ к Интернету.
* Быть защищенным от доступа из Интернета для снижения угроз, исходящих от внешних агентов.

> [!NOTE]
> Для обеспечения наилучшей производительности при использовании виртуальных машин Azure в качестве DNS-серверов протокол IPv6 должен быть отключен.

### <a name="web-apps"></a>Веб-приложения
Предположим, вам необходимо выполнять разрешение имен из веб-приложения, созданного с помощью службы приложений, которое связано с виртуальной сетью, в виртуальные машины в той же виртуальной сети. В дополнение к настройке пользовательского DNS-сервера, выполняющего функции DNS-сервера пересылки и перенаправляющего запросы в Azure (виртуальный IP-адрес 168.63.129.16), выполните следующие действия.
1. Если вы еще не сделали этого, включите интеграцию с виртуальной сетью для веб-приложения, как описано в разделе [Интеграция приложения с виртуальной сетью Azure](../app-service/web-sites-integrate-with-vnet.md?toc=%2fazure%2fvirtual-network%2ftoc.json).
2. На портале Azure для плана служб приложений, в котором размещается веб-приложение, в разделе **Сети** > **Интеграция виртуальной сети** выберите **Синхронизировать сеть**.

    ![Снимок экрана: разрешение имен виртуальной сети](./media/virtual-networks-name-resolution-for-vms-and-role-instances/webapps-dns.png)

Если требуется разрешение имен из веб-приложения службы приложений, связанного с виртуальной сетью, для виртуальных машин, расположенных в другой виртуальной сети, необходимо применять пользовательские DNS-серверы в обеих виртуальных сетях, как показано ниже.

* Настройте DNS-сервер в целевой виртуальной сети на виртуальной машине, которая может перенаправлять запросы в рекурсивный сопоставитель Azure (виртуальный IP-адрес: 168.63.129.16). Пример DNS-сервера пересылки доступен в [коллекции шаблонов быстрого запуска Azure](https://azure.microsoft.com/documentation/templates/301-dns-forwarder) и на сайте [GitHub](https://github.com/Azure/azure-quickstart-templates/tree/master/301-dns-forwarder). 
* Настройте DNS-сервер пересылки в исходной виртуальной сети на виртуальной машине. Настройте этот DNS-сервер пересылки для перенаправления запросов на DNS-сервер в целевой виртуальной сети.
* Настройте исходный DNS-сервер в параметрах исходной виртуальной сети.
* Включите интеграцию виртуальной сети, чтобы связать веб-приложение с исходной виртуальной сетью, следуя инструкциям в разделе [Интеграция приложения с виртуальной сетью Azure](../app-service/web-sites-integrate-with-vnet.md?toc=%2fazure%2fvirtual-network%2ftoc.json).
* На портале Azure для плана служб приложений, в котором размещается веб-приложение, в разделе **Сети** > **Интеграция виртуальной сети** выберите **Синхронизировать сеть**.

## <a name="specify-dns-servers"></a>Указание DNS-серверов
При использовании ваших DNS-серверов Azure предоставляет возможность указать несколько серверов для каждой виртуальной сети. Можно также указать несколько DNS-серверов для каждого сетевого интерфейса (для Azure Resource Manager) или каждой облачной службы (для классической модели развертывания). DNS-серверы, указанные для облачной службы или сетевого интерфейса, имеют более высокий приоритет по сравнению с DNS-серверами, указанными для виртуальной сети.

> [!NOTE]
> Свойства сетевого подключения, такие как IP-адреса серверов DNS, не следует изменять непосредственно в виртуальных машинах. Дело в том, что они могут быть удалены во время восстановление службы при замене виртуального сетевого адаптера. Это относится как к виртуальным машинам Windows, так и к виртуальной машине Linux.

При использовании модели развертывания с помощью Azure Resource Manager можно указать DNS-серверы для виртуальной сети и сетевого интерфейса. Дополнительные сведения см. в разделах [Создание, изменение или удаление виртуальной сети](manage-virtual-network.md) и [Создание, изменение или удаление сетевых интерфейсов](virtual-network-network-interface.md).

> [!NOTE]
> Если вы выбрали пользовательский DNS-сервер для виртуальной сети, необходимо указать по крайней мере один адрес IP-адрес DNS-сервера, иначе виртуальная сеть будет игнорировать конфигурацию и вместо этого использовать DNS, предоставленный Azure.

При использовании классической модели развертывания DNS-серверы для виртуальной сети можно указать на портале Azure или в [файле конфигурации сети](/previous-versions/azure/reference/jj157100(v=azure.100)). Для облачных служб DNS-серверы можно указать с помощью [файла конфигурации службы](/previous-versions/azure/reference/ee758710(v=azure.100)) или в PowerShell с помощью командлета [New-AzureVM](/powershell/module/servicemanagement/azure.service/new-azurevm).

> [!NOTE]
> Если изменить параметры DNS для уже развернутой виртуальной сети или виртуальной машины, чтобы новые параметры DNS вступили в силу, необходимо выполнить продление аренды DHCP на всех затронутых виртуальных машинах в виртуальной сети. Для виртуальных машин под управлением ОС Windows это можно сделать, введя `ipconfig /renew` непосредственно на виртуальной машине. Действия зависят от операционной системы. См. соответствующую документацию по типу ОС.

## <a name="next-steps"></a>Дальнейшие действия

Модель развертывания с помощью Azure Resource Manager:

* [Управление виртуальной сетью](manage-virtual-network.md)
* [Управление сетевым интерфейсом](virtual-network-network-interface.md)

Классическая модель развертывания:

* [Схема конфигурации службы Azure](/previous-versions/azure/reference/ee758710(v=azure.100))
* [Схема конфигурации виртуальной сети](/previous-versions/azure/reference/jj157100(v=azure.100))
* [Настройка виртуальной сети с помощью файла конфигурации сети](/previous-versions/azure/virtual-network/virtual-networks-using-network-configuration-file)