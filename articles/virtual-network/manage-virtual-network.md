---
title: Создание, изменение или удаление виртуальной сети Azure
titlesuffix: Azure Virtual Network
description: Создание и удаление виртуальной сети и изменение параметров, таких как DNS-серверы и пространства IP-адресов, для существующей виртуальной сети.
services: virtual-network
documentationcenter: na
author: KumudD
ms.service: virtual-network
ms.devlang: na
ms.topic: how-to
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 01/10/2019
ms.author: kumud
ms.openlocfilehash: 61ca4dc8cd7048df69c827e7ca657b9882900819
ms.sourcegitcommit: d59abc5bfad604909a107d05c5dc1b9a193214a8
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/14/2021
ms.locfileid: "98218915"
---
# <a name="create-change-or-delete-a-virtual-network"></a>Создание, изменение или удаление виртуальной сети

[!INCLUDE [updated-for-az](../../includes/updated-for-az.md)]

Узнайте, как создать и удалить виртуальную сеть, а также как изменить такие параметры существующей виртуальной сети, как DNS-серверы и пространства IP-адресов. Если у вас нет опыта работы с виртуальными сетями, вы можете получить дополнительные сведения в [обзорной статье](virtual-networks-overview.md) или пройти [учебник](quick-create-portal.md). Виртуальная сеть содержит подсети. Чтобы узнать, как создавать, изменять и удалять подсети, прочитайте статью [Создание, изменение или удаление виртуальной сети](virtual-network-manage-subnet.md).

## <a name="before-you-begin"></a>Перед началом

Перед выполнением действий, описанных в любом разделе этой статьи, выполните следующие задачи.

- Если у вас нет учетной записи Azure, зарегистрируйтесь для получения [бесплатной пробной учетной записи](https://azure.microsoft.com/free).
- При использовании портала перейдите по адресу https://portal.azure.com и войдите с использованием своей учетной записи Azure.
- При использовании команд PowerShell для работы с этой статьей выполняйте их в [Azure Cloud Shell](https://shell.azure.com/powershell) или в PowerShell на своем компьютере. Azure Cloud Shell — это бесплатная интерактивная оболочка, с помощью которой можно выполнять действия, описанные в этой статье. Она включает предварительно установленные общие инструменты Azure и настроена для использования с вашей учетной записью. Для работы с этим руководством требуется модуль Azure PowerShell версии 1.0.0 и выше. Выполните командлет `Get-Module -ListAvailable Az`, чтобы узнать установленную версию. Если вам необходимо выполнить обновление, ознакомьтесь со статьей, посвященной [установке модуля Azure PowerShell](/powershell/azure/install-az-ps). Если модуль PowerShell запущен локально, необходимо также выполнить командлет `Connect-AzAccount`, чтобы создать подключение к Azure.
- При использовании команд интерфейса командной строки Azure (CLI) для работы с этой статьей выполняйте их в [Azure Cloud Shell](https://shell.azure.com/bash) или в интерфейсе командной строки на своем компьютере. Для этого руководства требуется Azure CLI 2.0.31 или более поздней версии. Выполните командлет `az --version`, чтобы узнать установленную версию. Если вам необходимо выполнить установку или обновление, см. статью [Установка Azure CLI 2.0](/cli/azure/install-azure-cli). Если Azure CLI запущен локально, необходимо также выполнить командлет `az login`, чтобы создать подключение к Azure.
- Учетная запись, с которой выполняется вход или подключение к Azure с помощью, должна быть назначена роли " [участник сети](../role-based-access-control/built-in-roles.md?toc=%2fazure%2fvirtual-network%2ftoc.json#network-contributor) " или [настраиваемой роли](../role-based-access-control/custom-roles.md?toc=%2fazure%2fvirtual-network%2ftoc.json) , которой назначены соответствующие действия, перечисленные в разделе [разрешения](#permissions).

## <a name="create-a-virtual-network"></a>Создание виртуальной сети

1. Выберите **+ создать ресурс**  >  **Сетевые подключения**  >  **Виртуальная сеть**.
2. Введите или выберите значения для следующих параметров, а затем щелкните **создать**:
   - **Имя.** Имя должно быть уникальным в пределах [группы ресурсов](../azure-glossary-cloud-terminology.md?toc=%2fazure%2fvirtual-network%2ftoc.json#resource-group), выбранной для создания виртуальной сети. Имя невозможно изменить после создания виртуальной сети. Со временем вы сможете создать несколько виртуальных сетей. Рекомендации по именованию см. в статье, посвященной [соглашениям об именовании](/azure/cloud-adoption-framework/ready/azure-best-practices/naming-and-tagging#naming-and-tagging-resources). Придерживаясь соглашений об именовании, вы сможете упростить управление несколькими виртуальными сетями.
   - **Адресное пространство**. Адресное пространство виртуальной сети состоит из одного или нескольких неперекрывающихся диапазонов адресов, указанных в нотации CIDR. Определяемый диапазон адресов может быть общедоступным или частным (RFC 1918). Независимо от того, какой диапазон адресов вы укажете (общедоступный или частный), он будет доступен только внутри виртуальной сети, из взаимосвязанных виртуальных сетей и из всех локальных сетей, подключенных к виртуальной сети. Невозможно добавить следующий диапазон адресов:
     - 224.0.0.0/4 (многоадресная рассылка)
     - 255.255.255.255/32 (широковещательный адрес)
     - 127.0.0.0/8 (петлевой адрес);
     - 169.254.0.0/16 (локальный адрес канала);
     - 168.63.129.16/32 ([проба работоспособности](../load-balancer/load-balancer-custom-probe-overview.md#probesource) внутренней DNS, DHCP и Azure Load Balancer).

     Хотя вы можете определить только один диапазон адресов при создании виртуальной сети на портале, можно добавить дополнительные диапазоны адресов в адресное пространство после создания виртуальной сети. Чтобы узнать, как добавить или удалить диапазон адресов в имеющейся виртуальной сети, см. [этот раздел](#add-or-remove-an-address-range).

     > [!WARNING]
     > Если в виртуальной сети есть диапазоны адресов, которые перекрывают другую виртуальную сеть или локальную сеть, две сети не могут быть подключены. Прежде чем определить диапазон адресов, решите, будет ли виртуальная сеть подключаться к другим виртуальным или локальным сетям. Корпорация Майкрософт рекомендует настраивать диапазоны адресов виртуальной сети с помощью частного адресного пространства или общедоступного адресного пространства, принадлежащего вашей организации.
     >

     - **Имя подсети** должно быть уникальным в пределах виртуальной сети. После создания подсети ее имя невозможно изменить. При создании виртуальной сети на портале необходимо определить одну подсеть, хотя в ней не обязательно должны быть подсети. При создании виртуальной сети на портале можно определить только одну подсеть. После создания виртуальной сети можно будет добавить больше подсетей. Чтобы добавить подсеть в виртуальную сеть, см. раздел [Создание, изменение или удаление виртуальной сети](virtual-network-manage-subnet.md). Создать виртуальную сеть с несколькими подсетями можно с помощью Azure CLI или PowerShell.

       >[!TIP]
       >В некоторых случаях администраторы создают разные подсети, чтобы фильтровать трафик между ними или управлять маршрутизацией. Прежде чем определить подсети, рассмотрите возможность фильтрации и маршрутизации трафика между ними. Дополнительные сведения о фильтрации трафика между подсетями см. в статье [Фильтрация сетевого трафика с помощью групп безопасности сети](./network-security-groups-overview.md). Azure направляет трафик между подсетями автоматически, но можно переопределить маршруты, используемые в Azure по умолчанию. Дополнительные сведения о маршрутизации трафика подсетей Azure по умолчанию см. в статье [Маршрутизация трафика в виртуальной сети](virtual-networks-udr-overview.md).
       >

     - **Диапазон адресов подсети** должен находиться в пределах адресного пространства, указанного для виртуальной сети. Наименьший допустимый диапазон — /29. Он обеспечивает восемь IP-адресов для подсети. Azure резервирует первый и последний адреса в каждой подсети для соответствия требованиям протоколов. Еще три адреса резервируются для служб Azure. В результате виртуальная сеть с диапазоном адресов подсети /29 содержит только три доступных IP-адреса. Если вы планируете подключать виртуальную сеть к VPN-шлюзу, необходимо создать подсеть шлюза. Узнайте больше о [рекомендациях по диапазонам адресов для подсетей шлюза](../vpn-gateway/vpn-gateway-about-vpn-gateway-settings.md?toc=%2fazure%2fvirtual-network%2ftoc.json#gwsub). При определенных условиях диапазон адресов после создания подсети можно изменить. Сведения об изменении диапазона адресов подсети см. в статье [Создание, изменение или удаление виртуальной сети](virtual-network-manage-subnet.md).
     - **Подписка**. Выберите [подписку](../azure-glossary-cloud-terminology.md?toc=%2fazure%2fvirtual-network%2ftoc.json#subscription). Одну виртуальную сеть нельзя использовать в нескольких подписках Azure. Но вы можете подключить виртуальную сеть из одной подписки к виртуальным сетям в других подписках с помощью [пиринга между виртуальными сетями](virtual-network-peering-overview.md). Все ресурсы Azure, подключаемые к виртуальной сети, должны быть в той же подписке, что и виртуальная сеть.
     - **Группа ресурсов**. Выберите существующую [группу ресурсов](../azure-resource-manager/management/overview.md?toc=%2fazure%2fvirtual-network%2ftoc.json#resource-groups) или создайте новую. Ресурс Azure, подключаемый к виртуальной сети, может быть в той же группе ресурсов, что и виртуальная сеть, или в другой группе ресурсов.
     - **Расположение.** Выберите [расположение](https://azure.microsoft.com/regions/) Azure (также называется регионом). Виртуальная сеть может быть только в одном расположении Azure. Но вы можете подключить виртуальную сеть из одного расположения к виртуальной сети в другом, используя VPN-шлюз. Все ресурсы Azure, подключаемые к виртуальной сети, должны находиться в том же расположении, что и виртуальная сеть.

**Команды**

- Azure CLI: [az network vnet create](/cli/azure/network/vnet)
- PowerShell: [New-азвиртуалнетворк](/powershell/module/az.network/new-azvirtualnetwork)

## <a name="view-virtual-networks-and-settings"></a>Просмотр виртуальных сетей и параметров

1. В поле поиска в верхней части портала введите *виртуальные сети*. Когда в результатах поиска появится пункт **Виртуальные сети**, выберите его.
2. Из списка виртуальных сетей выберите виртуальную сеть, параметры которой требуется просмотреть.
3. Ниже приведены параметры, отображаемые для выбранной виртуальной сети.
   - **Обзор.** Содержит сведения о виртуальной сети, такие как адресное пространство и DNS-серверы. На следующем снимке экрана показаны общие параметры виртуальной сети **MyVNet**.

     ![Обзор сетевого интерфейса](./media/manage-virtual-network/vnet-overview.png)

     Виртуальную сеть можно переместить в другую подписку или группу ресурсов, выбрав **Изменить** рядом с элементом **Группа ресурсов** или с элементом **Название подписки**. Чтобы узнать, как переместить виртуальную сеть, см. статью [Перемещение ресурсов в новую группу ресурсов или подписку](../azure-resource-manager/management/move-resource-group-and-subscription.md?toc=%2fazure%2fvirtual-network%2ftoc.json). В ней указаны необходимые компоненты для перемещения, а также описана процедура перемещения с помощью портала Azure, PowerShell и Azure CLI. Виртуальную сеть необходимо перемещать со всеми ресурсами, подключенными к ней.
   - **Адресное пространство.** Отображаются адресные пространства, назначенные виртуальной сети. Чтобы узнать, как добавлять и удалять диапазоны адресов, выполните инструкции, приведенные в [этом разделе](#add-or-remove-an-address-range).
   - **Подключенные устройства.** Перечислены все ресурсы, подключенные к виртуальной сети. На снимке экрана выше показано, что к виртуальной сети подключены три сетевых интерфейса и одна подсистема балансировки нагрузки. В списке отображаются все создаваемые и подключаемые к виртуальной сети ресурсы. Если удалить ресурс, подключенный к виртуальной сети, он не будет отображаться в списке.
   - **Подсети.** Отображается список подсетей в виртуальной сети. Сведения о добавлении или удалении подсети см. в статье [Создание, изменение или удаление виртуальной сети](virtual-network-manage-subnet.md).
   - **DNS-серверы.** Для разрешения имен устройств, подключаемых к виртуальной сети, можно указать внутренний DNS-сервер Azure или пользовательский DNS-сервер. Если виртуальная сеть создана с помощью портала Azure, для разрешения имен в виртуальной сети по умолчанию используются DNS-серверы Azure. Чтобы изменить DNS-серверы, выполните инструкции, приведенные в [этом разделе](#change-dns-servers).
   - **Пиринги.** Если в подписке есть пиринговые подключения, они перечислены в этом разделе. Можно просматривать параметры существующих пирингов, а также создавать, изменять или удалять пиринги. Дополнительные сведения о пиринговых подключениях см. в статье [Пиринг между виртуальными сетями](virtual-network-peering-overview.md).
   - **Свойства.** Здесь отображаются параметры виртуальной сети, включая ИД ресурса и подписку Azure, к которой относится виртуальная сеть.
   - **Схема**. Схема дает наглядное представление всех устройств, подключенных к виртуальной сети. В схеме содержатся некоторые важные сведения об устройствах. Чтобы управлять устройствами в этом представлении, выберите устройство на схеме.
   - **Common Azure settings** (Общие параметры Azure). Дополнительные сведения об общих параметрах Azure см. по следующим ссылкам:
     - [Журнал действий](../azure-monitor/platform/platform-logs-overview.md)
     - [Управление доступом (IAM)](../role-based-access-control/overview.md)
     - [Теги](../azure-resource-manager/management/tag-resources.md?toc=%2fazure%2fvirtual-network%2ftoc.json)
     - [Блокировки](../azure-resource-manager/management/lock-resources.md?toc=%2fazure%2fvirtual-network%2ftoc.json)
     - [Скрипт автоматизации](../azure-resource-manager/management/manage-resource-groups-portal.md#export-resource-groups-to-templates)

**Команды**

- Azure CLI: [az network vnet show](/cli/azure/network/vnet)
- PowerShell: [Get-азвиртуалнетворк](/powershell/module/az.network/get-azvirtualnetwork)

## <a name="add-or-remove-an-address-range"></a>Добавление и удаление диапазона адресов

Вы можете добавлять и удалять диапазон адресов виртуальной сети. Диапазон адресов должен быть указан в нотации CIDR. Он не должен перекрываться с другими адресными пространствами в пределах одной виртуальной сети. Определяемый диапазон адресов может быть общедоступным или частным (RFC 1918). Независимо от того, какой диапазон адресов вы укажете (общедоступный или частный), он будет доступен только внутри виртуальной сети, из взаимосвязанных виртуальных сетей и из всех локальных сетей, подключенных к виртуальной сети. 

Можно уменьшить диапазон адресов для виртуальной сети, если он по-прежнему включает диапазоны всех связанных подсетей. Кроме того, можно расширить диапазон адресов, например, изменив значение/16 на/8. 

<!-- the above statement has been edited to reflect the most recent comments on the reopened issue: https://github.com/MicrosoftDocs/azure-docs/issues/20572 -->

Невозможно добавить следующий диапазон адресов:

- 224.0.0.0/4 (многоадресная рассылка)
- 255.255.255.255/32 (широковещательный адрес)
- 127.0.0.0/8 (петлевой адрес);
- 169.254.0.0/16 (локальный адрес канала);
- 168.63.129.16/32 ([проба работоспособности](../load-balancer/load-balancer-custom-probe-overview.md#probesource) внутренней DNS, DHCP и Azure Load Balancer).

Чтобы добавить или удалить диапазон адресов, сделайте следующее:

1. В поле поиска в верхней части портала введите *виртуальные сети*. Когда в результатах поиска появится пункт **Виртуальные сети**, выберите его.
2. Из списка виртуальных сетей выберите виртуальную сеть, для которой требуется добавить или удалить диапазон адресов.
3. Выберите **Диапазон адресов** в разделе **Параметры**.
4. Выберите один из следующих вариантов:
    - **Add an address space** (Добавить диапазон адресов). Введите новый диапазон адресов. Диапазон адресов не может перекрываться с имеющимся диапазоном, определенным для виртуальной сети.
    - **Remove an address range** (Удалить диапазон адресов). Справа от диапазона адресов, который требуется удалить, выберите **...**, а затем **Удалить**. Если в диапазоне адресов существует подсеть, его невозможно удалить. Чтобы удалить диапазон адресов, сначала удалите все подсети, которые в нем содержатся (и все ресурсы в этих подсетях).
5. Выберите **Сохранить**.

**Команды**

- Azure CLI: [az network vnet update](/cli/azure/network/vnet)
- PowerShell: [Set-азвиртуалнетворк](/powershell/module/az.network/set-azvirtualnetwork)

## <a name="change-dns-servers"></a>Изменение DNS-серверов

Все виртуальные машины, подключенные к виртуальной сети, регистрируются с DNS-серверами, указанными для этой сети. Кроме того, они используют указанный DNS-сервер для разрешения имен. У каждого сетевого интерфейса (сетевой карты) на виртуальной машине могут быть собственные параметры DNS-сервера. Если для сетевого адаптера указаны отдельные параметры DNS-сервера, они переопределяют параметры DNS-сервера для виртуальной сети. Дополнительные сведения о параметрах DNS для сетевых адаптеров см. в статье [Создание, изменение или удаление сетевых интерфейсов](virtual-network-network-interface.md#change-dns-servers). Дополнительные сведения о разрешении имен для виртуальных машин и экземпляров ролей в облачных службах Azure см. в статье [Разрешение имен для ВМ и экземпляров ролей](virtual-networks-name-resolution-for-vms-and-role-instances.md). Чтобы добавить, изменить или удалить DNS-сервер, сделайте следующее:

1. В поле поиска в верхней части портала введите *виртуальные сети*. Когда в результатах поиска появится пункт **Виртуальные сети**, выберите его.
2. Из списка виртуальных сетей выберите виртуальную сеть, для которой требуется изменить DNS-серверы.
3. В разделе **Параметры** выберите **DNS-серверы**.
4. Выберите один из следующих параметров:
   - **По умолчанию (предоставлено Azure)**. все имена ресурсов и частные IP-адреса автоматически регистрируются на серверах Azure DNS. Этот параметр позволяет разрешать имена между всеми ресурсами, подключенными к одной виртуальной сети. Но вы не сможете использовать этот параметр для разрешения имен между виртуальными сетями. Разрешать имена между виртуальными сетями можно с помощью пользовательского DNS-сервера.
   - **Пользовательский.** Вы можете добавить один или несколько серверов в пределах лимита Azure, установленного для виртуальной сети. Дополнительные сведения о лимите DNS-серверов см. в статье [Подписка Azure, границы, квоты и ограничения службы](../azure-resource-manager/management/azure-subscription-service-limits.md?toc=%2fazure%2fvirtual-network%2ftoc.json#virtual-networking-limits-classic). Можно выбрать один из следующих параметров.
   - **Add an address** (Добавить адрес). Позволяет добавить сервер в список DNS-серверов для виртуальной сети. Этот параметр также позволяет зарегистрировать DNS-сервер в Azure. Если вы уже зарегистрировали DNS-сервер в Azure, его можно будет выбрать в списке DNS-серверов.
   - **Remove an address** (Удалить адрес). Рядом с именем сервера, который требуется удалить, выберите **...**, а затем **Удалить**. В этом случае сервер будет удален только из списка этой виртуальной сети. DNS-сервер остается зарегистрированным в Azure и может использоваться в других виртуальных сетях.
   - **Reorder DNS server addresses** (Упорядочить адреса DNS-серверов). При указании DNS-серверов важно убедиться, что они размещены в списке в правильном порядке для вашей среды. Списки DNS-серверов используются в том порядке, в котором они указаны. Они не используются по принципу циклического перебора. Если первый DNS-сервер в списке доступен, клиент будет использовать его вне зависимости от того, правильно ли работает этот DNS-сервер. Удалите все DNS-серверы в списке, а затем добавьте их обратно в требуемом порядке.
   - **Change an address** (Изменить адрес). Выделите DNS-сервер в списке и введите новый адрес.
5. Выберите **Сохранить**.
6. Перезапустите виртуальные машины, подключенные к виртуальной сети, чтобы назначить им новые параметры DNS-сервера. Виртуальные машины продолжают использовать свои текущие параметры DNS, пока они не будут перезагружены.

**Команды**

- Azure CLI: [az network vnet update](/cli/azure/network/vnet)
- PowerShell: [Set-азвиртуалнетворк](/powershell/module/az.network/set-azvirtualnetwork)

## <a name="delete-a-virtual-network"></a>Удаление виртуальной сети

Виртуальную сеть можно удалить только в том случае, если к ней не подключены ресурсы. Если к подсети в виртуальной сети подключены ресурсы, необходимо сначала удалить все ресурсы, подключенные к подсетям в этой виртуальной сети. Конкретная процедура удаления ресурса зависит от его типа. Чтобы узнать, как удалить ресурсы, подключенные к подсетям, ознакомьтесь с документацией по типам ресурсов, которые требуется удалить. Чтобы удалить виртуальную сеть, сделайте следующее:

1. В поле поиска в верхней части портала введите *виртуальные сети*. Когда в результатах поиска появится пункт **Виртуальные сети**, выберите его.
2. Из списка виртуальных сетей выберите виртуальную сеть, которую требуется удалить.
3. Убедитесь, что к виртуальной сети не подключены устройства, выбрав **Подключенные устройства** в разделе **Параметры**. Если подключенные устройства отображаются, необходимо сначала удалить их, прежде чем удалять виртуальную сеть. Если подключенных устройств нет, выберите **Обзор**.
4. Нажмите кнопку **Удалить**.
5. Чтобы подтвердить удаление виртуальной сети, выберите **Да**.

**Команды**

- Azure CLI: [azure network vnet delete](/cli/azure/network/vnet)
- PowerShell: [Remove-азвиртуалнетворк](/powershell/module/az.network/remove-azvirtualnetwork)

## <a name="permissions"></a>Разрешения

Для выполнения задач в виртуальных сетях учетной записи должна быть назначена роль [Участник сети](../role-based-access-control/built-in-roles.md?toc=%2fazure%2fvirtual-network%2ftoc.json#network-contributor) или [пользовательская](../role-based-access-control/custom-roles.md?toc=%2fazure%2fvirtual-network%2ftoc.json) роль, которой назначены соответствующие действия, перечисленные в следующей таблице.

| Действие                                  |   Имя                                |
|---------------------------------------- |   --------------------------------    |
|Microsoft.Network/virtualNetworks/read   |   Чтение виртуальной сети.              |
|Microsoft.Network/virtualNetworks/write  |   Создание или обновление виртуальной сети.  |
|Microsoft.Network/virtualNetworks/delete |   Удаление виртуальной сети            |

## <a name="next-steps"></a>Дальнейшие действия

- Создайте виртуальную сеть с помощью примеров сценариев [PowerShell](powershell-samples.md) или [Azure CLI](cli-samples.md) либо на основе [шаблонов Azure Resource Manager](template-samples.md).
- Создание и назначение [определений политик Azure](./policy-reference.md) для виртуальных сетей