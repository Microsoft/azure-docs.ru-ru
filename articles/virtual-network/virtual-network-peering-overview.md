---
title: Пиринг между виртуальными сетями Azure
titlesuffix: Azure Virtual Network
description: Узнайте о пиринге виртуальных сетей в Azure, в том числе о том, как он позволяет подключать сети в виртуальной сети Azure.
services: virtual-network
documentationcenter: na
author: altambaw
ms.service: virtual-network
ms.devlang: na
ms.topic: conceptual
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 11/15/2019
ms.author: kumud
ms.openlocfilehash: feea2d54edd8a93e6e0effbef03389ef895d5ffb
ms.sourcegitcommit: d59abc5bfad604909a107d05c5dc1b9a193214a8
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/14/2021
ms.locfileid: "98216756"
---
# <a name="virtual-network-peering"></a>Пиринг между виртуальными сетями

Пиринг виртуальных сетей позволяет легко подключать в Azure две или больше [виртуальных сетей](virtual-networks-overview.md) . Виртуальные сети отображаются в качестве одной для подключения. Трафик между виртуальными машинами в одноранговых виртуальных сетях использует магистральную инфраструктуру Майкрософт. Как и трафик между виртуальными машинами в одной сети, трафик направляется только через *частную* сеть корпорации Майкрософт.

Azure поддерживает следующие типы пиринга:

* Пиринг виртуальных сетей. Подключите виртуальные сети в одном регионе Azure.
* Пиринг глобальной виртуальной сети: подключение виртуальных сетей между регионами Azure.

Преимущества пиринговой связи между виртуальными сетями (как локальной, так и глобальной):

* подключение между ресурсами в разных виртуальных сетях, характеризующееся низкой задержкой и высокой пропускной способностью;
* Возможность взаимодействия ресурсов в одной виртуальной сети с ресурсами в другой виртуальной сети.
* Возможность передавать данные между виртуальными сетями между подписками Azure, клиентами Azure Active Directory, моделями развертывания и регионами Azure.
* Возможность пиринга между виртуальными сетями, созданными с помощью Azure Resource Manager.
* Возможность одноранговой виртуальной сети, созданной с помощью диспетчер ресурсов, на одну, созданную с помощью классической модели развертывания. Дополнительные сведения о моделях развертывания Azure см. в статье [Развертывание с помощью Azure Resource Manager и классическое развертывание: сведения о моделях развертывания и состоянии ресурсов](../azure-resource-manager/management/deployment-models.md?toc=%2fazure%2fvirtual-network%2ftoc.json).
* Отсутствие задержки при доступе к ресурсам в любой виртуальной сети при создании пиринга или после его создания.

Сетевой трафик между одноранговыми виртуальными сетями является закрытым. Трафик между виртуальными сетями хранится в магистральной сети Майкрософт. При обмене данными между виртуальными сетями не требуется общий доступ к Интернету, шлюзы или шифрование.

## <a name="connectivity"></a>Подключение

Для одноранговых виртуальных сетей ресурсы в любой виртуальной сети могут напрямую подключаться к ресурсам в одноранговой виртуальной сети.

Задержки в сети между виртуальными машинами в пиринговых виртуальных сетях такие же, как и в пределах одной виртуальной сети. Пропускная способность сети зависит от пропускной способности виртуальной машины, которая пропорциональна ее размеру. Дополнительные ограничения пропускной способности при пиринге не применяются.

Трафик между виртуальными машинами в пиринговых виртуальных сетях передается напрямую через магистральную инфраструктуру Майкрософт, а не через шлюз или Интернет.

Группы безопасности сети можно применять в любой виртуальной сети для блокировки доступа к другим виртуальным сетям или подсетям.
При настройке пиринга с виртуальной сетью либо откройте или закройте правила группы безопасности сети между виртуальными сетями. Если вы откроете полное подключение между одноранговыми виртуальными сетями, можно применить группы безопасности сети, чтобы заблокировать или запретить конкретный доступ. По умолчанию используется полное подключение. Дополнительные сведения о группах безопасности сети см. в разделе [группы безопасности](./network-security-groups-overview.md).

## <a name="service-chaining"></a>Цепочка служб

Цепочка служб позволяет перенаправлять трафик из одной виртуальной сети в виртуальное устройство или шлюз в одноранговой сети с помощью определяемых пользователем маршрутов.

Чтобы включить цепочки служб, настройте определяемые пользователем маршруты, указывающие на виртуальные машины в одноранговых виртуальных сетях, как IP-адрес *следующего прыжка* . Определяемые пользователем маршруты также могут указывать на шлюзы виртуальной сети для включения цепочки служб.

Вы можете развертывать сети на основе концентраторов, где в виртуальной сети центра размещаются компоненты инфраструктуры, например сетевые виртуальные устройства или VPN-шлюзы. Все остальные виртуальные сети ("лучи") могут подключаться по пиринговой связи к центральной виртуальной сети. Трафик проходит через виртуальные сетевые устройства или VPN-шлюзы в виртуальной сети концентратора.

В определяемой пользователем таблице маршрутизации можно указать для следующего прыжка IP-адрес виртуальной машины, входящей в пиринговую виртуальную сеть, или VPN-шлюз. Нельзя маршрутизироваться между виртуальными сетями с помощью определяемого пользователем маршрута, который указывает шлюз Azure ExpressRoute в качестве типа следующего прыжка. Дополнительные сведения об определяемых пользователем маршрутах см. в статье [Определяемые пользователем маршруты и IP-пересылка](virtual-networks-udr-overview.md#user-defined). Сведения о создании топологии концентратора и периферийной сети см. [в статье топология сети Hub в Azure](/azure/architecture/reference-architectures/hybrid-networking/hub-spoke?toc=%2fazure%2fvirtual-network%2ftoc.json).

## <a name="gateways-and-on-premises-connectivity"></a>Использование шлюзов для локального подключения

Каждая виртуальная сеть, включая одноранговую виртуальную сеть, может иметь собственный шлюз. Виртуальная сеть может использовать свой шлюз для подключения к локальной сети. Можно также настроить [подключение между](../vpn-gateway/vpn-gateway-vnet-vnet-rm-ps.md?toc=%2fazure%2fvirtual-network%2ftoc.json) виртуальными сетями с помощью шлюзов, даже для виртуальных сетей.

При настройке обоих параметров взаимодействия виртуальной сети трафик между виртуальными сетями проходит через конфигурацию пиринга. Трафик использует магистральную службу Azure.

Вы также можете настроить шлюз в одноранговой виртуальной сети в качестве транзитного места для локальной сети. В этом случае виртуальная сеть, использующая удаленный шлюз, не может иметь собственный шлюз. Виртуальная сеть имеет только один шлюз. Шлюз может быть локальным или удаленным шлюзом в одноранговой виртуальной сети, как показано на следующей схеме:

![Транзит в пиринговой виртуальной сети](./media/virtual-networks-peering-overview/local-or-remote-gateway-in-peered-virual-network.png)

Как пиринг виртуальной сети, так и пиринг глобальной виртуальной сети поддерживают транзитный шлюз.

Поддерживается транзитный шлюз между виртуальными сетями, созданными с помощью различных моделей развертывания. Шлюз должен находиться в виртуальной сети в модели диспетчер ресурсов. Дополнительные сведения об использовании шлюза для передачи см. [в статье Настройка VPN-шлюза для передачи в пиринге виртуальной сети](../vpn-gateway/vpn-gateway-peering-gateway-transit.md?toc=%2fazure%2fvirtual-network%2ftoc.json).

При использовании одноранговых виртуальных сетей, совместно использующих одно подключение Azure ExpressRoute, трафик между ними проходит через отношение пиринга. Этот трафик использует магистральную сеть Azure. Вы по-прежнему можете использовать в каждой виртуальной сети локальные шлюзы для подключения к локальному каналу. В противном случае можно использовать общий шлюз и настроить транзит для локального подключения.

## <a name="troubleshoot"></a>Устранение неполадок

Чтобы убедиться в том, что виртуальные сети являются равноправными, можно проверить действующие маршруты. Проверьте маршруты для сетевого интерфейса в любой подсети в виртуальной сети. Если пиринг между виртуальными сетями настроен, все подсети виртуальной сети будут иметь маршруты со следующим прыжком типа *Пиринг виртуальных сетей* для каждого адресного пространства в каждой пиринговой виртуальной сети. Дополнительные сведения см. [в статье Диагностика проблем с маршрутизацией виртуальных машин](diagnose-network-routing-problem.md).

Вы также можете устранить неполадки подключения к виртуальной машине в одноранговой виртуальной сети с помощью наблюдателя за сетями Azure. Проверка подключения позволяет увидеть, как трафик направляется из сетевого интерфейса исходной виртуальной машины в сетевой интерфейс целевой виртуальной машины. Дополнительные сведения см. [в разделе Устранение неполадок подключений с помощью наблюдателя за сетями Azure с использованием портал Azure](../network-watcher/network-watcher-connectivity-portal.md#check-connectivity-to-a-virtual-machine).

Можно также попробовать устранить неполадки [пиринга виртуальной сети](virtual-network-troubleshoot-peering-issues.md).

## <a name="constraints-for-peered-virtual-networks"></a>Ограничения для одноранговых виртуальных сетей<a name="requirements-and-constraints"></a>

Когда создается глобальный пиринг виртуальных сетей, действуют следующие ограничения:

* Ресурсы в одной виртуальной сети не могут взаимодействовать с интерфейсным IP-адресом базового внутреннего Load Balancer (ILB) в глобально-одноранговой виртуальной сети.
* Некоторые службы, использующие базовый балансировщик нагрузки, не работают через пиринг глобальной виртуальной сети. Дополнительные сведения см. [в разделе что такое ограничения, связанные с пирингом глобальных виртуальных сетей и подсистемами балансировки нагрузки?](virtual-networks-faq.md#what-are-the-constraints-related-to-global-vnet-peering-and-load-balancers).

Дополнительные сведения см. в разделе [Требования и ограничения](virtual-network-manage-peering.md#requirements-and-constraints). Дополнительные сведения о поддерживаемом числе пиринга см. в разделе [ограничения сети](../azure-resource-manager/management/azure-subscription-service-limits.md?toc=%2fazure%2fvirtual-network%2ftoc.json#azure-resource-manager-virtual-networking-limits).

## <a name="permissions"></a>Разрешения

Дополнительные сведения о разрешениях, необходимых для создания пиринга виртуальной сети, см. в разделе [разрешения](virtual-network-manage-peering.md#permissions).

## <a name="pricing"></a>Цены

Существует номинальная плата за входящий и исходящий трафик, использующий одноранговое подключение к виртуальной сети. Дополнительные сведения см. в статье [цены на виртуальную сеть](https://azure.microsoft.com/pricing/details/virtual-network).

Транзитный шлюз — это свойство пиринга, которое позволяет виртуальной сети использовать шлюз VPN или ExpressRoute в одноранговой виртуальной сети. Транзитный шлюз работает как для между локальными, так и с подключением между сетями. Трафик к шлюзу (входящим или исходящим) в одноранговой виртуальной сети приводит к поплатам за пиринг виртуальных сетей в периферийной виртуальной сети (или в виртуальной сети без шлюза). Дополнительные сведения см. в статье [цены на VPN-](https://azure.microsoft.com/pricing/details/vpn-gateway/) шлюз для оплаты VPN-шлюза и цены на шлюз expressroute для оплаты за шлюз expressroute.

>[!NOTE]
> В предыдущей версии этого документа было указано, что плата за пиринг виртуальных сетей не была применена в периферийной виртуальной сети (или виртуальной сети без шлюза) с транзитом шлюза. Теперь она отражает точную цену на страницу цен.

## <a name="next-steps"></a>Дальнейшие действия

* Можно создать пиринг между двумя виртуальными сетями. Сети могут принадлежать к одной и той же подписке, различным моделям развертывания в одной подписке или к разным подпискам. Изучите руководство одного из следующих сценариев:

    |Модель развертывания Azure             | Подписка  |
    |---------                          |---------|
    |Обе — диспетчер ресурсов              |[Аналогично](tutorial-connect-virtual-networks-portal.md)|
    |                                   |[Разные](create-peering-different-subscriptions.md)|
    |Одна — диспетчер ресурсов, вторая — классическая  |[Аналогично](create-peering-different-deployment-models.md)|
    |                                   |[Разные](create-peering-different-deployment-models-subscriptions.md)|

* Сведения о создании топологии концентратора и периферийной сети см. [в статье топология сети Hub в Azure](/azure/architecture/reference-architectures/hybrid-networking/hub-spoke?toc=%2fazure%2fvirtual-network%2ftoc.json).
* Дополнительные сведения о всех параметрах пиринга виртуальной сети см. в статье [Создание, изменение или удаление пиринга виртуальной сети](virtual-network-manage-peering.md).
* Ответы на распространенные вопросы пиринга виртуальных сетей и пиринга с глобальными виртуальными сетями см. в разделе [пиринг](virtual-networks-faq.md#vnet-peering)виртуальных сетей.