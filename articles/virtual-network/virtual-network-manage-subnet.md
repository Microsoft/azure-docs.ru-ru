---
title: Создание, изменение или удаление подсети виртуальной сети Azure
titlesuffix: Azure Virtual Network
description: Узнайте, где найти сведения о виртуальных сетях и как добавить, изменить или удалить подсеть виртуальной сети в Azure.
services: virtual-network
documentationcenter: na
author: KumudD
manager: mtillman
ms.service: virtual-network
ms.devlang: na
ms.topic: how-to
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 03/20/2020
ms.author: kumud
ms.openlocfilehash: 54228ac0aa582d15509fbf967728364841e52453
ms.sourcegitcommit: d59abc5bfad604909a107d05c5dc1b9a193214a8
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/14/2021
ms.locfileid: "98220581"
---
# <a name="add-change-or-delete-a-virtual-network-subnet"></a>Создание, изменение или удаление виртуальной сети

Сведения о создании, изменении и удалении подсетей виртуальной сети. Все ресурсы Azure, развернутые в виртуальной сети, также развертываются в подсети виртуальной сети. Если вы не знакомы с виртуальными сетями, см. Дополнительные сведения о них в [обзоре виртуальной сети](virtual-networks-overview.md) или в ходе [краткого руководства](quick-create-portal.md). Дополнительные сведения об управлении виртуальной сетью см. в статье [Создание, изменение или удаление виртуальной сети](manage-virtual-network.md).

## <a name="before-you-begin"></a>Перед началом

Если у вас ее нет, настройте учетную запись Azure с активной подпиской. [Создайте учетную запись](https://azure.microsoft.com/free/?ref=microsoft.com&utm_source=microsoft.com&utm_medium=docs&utm_campaign=visualstudio) бесплатно. Затем выполните одну из этих задач, прежде чем запускать шаги в любом разделе этой статьи. 

- **Пользователи портала**. войдите в [портал Azure](https://portal.azure.com) с помощью учетной записи Azure.

- **Пользователи PowerShell**. выполните команды в [Azure Cloud Shell](https://shell.azure.com/powershell)или запустите PowerShell с компьютера. Azure Cloud Shell — это бесплатная интерактивная оболочка, с помощью которой можно выполнять действия, описанные в этой статье. Она включает предварительно установленные общие инструменты Azure и настроена для использования с вашей учетной записью. На вкладке Обозреватель Azure Cloud Shell найдите раскрывающийся список **выбрать среду** , а затем выберите **PowerShell** , если он еще не выбран.

    Если вы используете PowerShell локально, используйте Azure PowerShell Module версии 1.0.0 или более поздней. Выполните командлет `Get-Module -ListAvailable Az.Network`, чтобы узнать установленную версию. Если вам необходимо выполнить обновление, ознакомьтесь со статьей, посвященной [установке модуля Azure PowerShell](/powershell/azure/install-az-ps). Также выполните команду `Connect-AzAccount` , чтобы создать подключение к Azure.

- **Пользователи интерфейса командной строки Azure (CLI)**. выполните команды в [Azure Cloud Shell](https://shell.azure.com/bash)или запустите CLI с компьютера. Если вы используете Azure CLI локально, используйте Azure CLI версии 2.0.31 или более поздней. Выполните командлет `az --version`, чтобы узнать установленную версию. Если вам необходимо выполнить установку или обновление, см. статью [Установка Azure CLI 2.0](/cli/azure/install-azure-cli). Также выполните команду `az login` , чтобы создать подключение к Azure.

Учетная запись, к которой вы входите или подключается к Azure с помощью, должна быть назначена роли [роли "участник сети](../role-based-access-control/built-in-roles.md?toc=%2fazure%2fvirtual-network%2ftoc.json#network-contributor) " или [настраиваемой роли](../role-based-access-control/custom-roles.md?toc=%2fazure%2fvirtual-network%2ftoc.json) , которой назначены соответствующие действия, перечисленные в списке [разрешения](#permissions).

## <a name="add-a-subnet"></a>Добавление подсети

1. Перейдите в [портал Azure](https://portal.azure.com) , чтобы просмотреть виртуальные сети. Найдите и щелкните **Виртуальные сети**.

2. Выберите имя виртуальной сети, в которую необходимо добавить подсеть.

3. В **параметрах** выберите **подсети**  >  **подсеть**.

4. В диалоговом окне **Добавление подсети** введите значения для следующих параметров.

    | Параметр | Описание |
    | --- | --- |
    | **имя**; | Имя должно быть уникальным в пределах виртуальной сети. Для обеспечения максимальной совместимости с другими службами Azure рекомендуется использовать в качестве первого символа имени букву. Например, шлюз приложений Azure не удастся развернуть в подсети с именем, которое начинается с цифры. |
    | **Диапазон адресов** | <p>Диапазон должен быть уникальным в пределах адресного пространства виртуальной сети. Диапазон не может перекрываться с другими диапазонами адресов подсети в виртуальной сети. Адресное пространство должно быть указано с помощью нотации CIDR.</p><p>Например, в виртуальной сети с адресным пространством *10.0.0.0/16* вы можете определить адресное пространство подсети *10.0.0.0/22*. Наименьший диапазон, который можно указать, — */29*, который предоставляет восемь IP-адресов для подсети. Azure резервирует первый и последний адреса в каждой подсети для соответствия требованиям протоколов. Еще три адреса резервируются для служб Azure. В результате, определение подсети с диапазоном адресов */29* приводит к использованию трех IP-адресов в подсети.</p><p>Если вы планируете подключать виртуальную сеть к VPN-шлюзу, необходимо создать подсеть шлюза. Узнайте больше о [рекомендациях по диапазонам адресов для подсетей шлюза](../vpn-gateway/vpn-gateway-about-vpn-gateway-settings.md?toc=%2fazure%2fvirtual-network%2ftoc.json#gwsub). При определенных условиях после создания подсети можно изменить диапазон адресов. Сведения об изменении диапазона адресов подсети см. в разделе [Изменение параметров подсети](#change-subnet-settings).</p> |
    | **Группа безопасности сети** | Чтобы отфильтровать входящий и исходящий сетевой трафик для подсети, можно связать существующую группу безопасности сети с подсетью. Группа безопасности сети должна существовать в той же подписке и расположении, что и виртуальная сеть. Подробнее о [группах безопасности сети](./network-security-groups-overview.md) и [их создании](tutorial-filter-network-traffic.md). |
    | **Таблица маршрутов** | Чтобы управлять маршрутизацией сетевого трафика в другие сети, при необходимости можно связать существующую таблицу маршрутов с подсетью. Таблица маршрутов должна существовать в той же подписке и расположении, что и виртуальная сеть. Дополнительные сведения о [маршрутизации Azure](virtual-networks-udr-overview.md) и [создании таблицы маршрутов](tutorial-create-route-table-portal.md). |
    | **Конечные точки службы** | <p>При необходимости для подсети может быть включено одна или несколько конечных точек службы. Чтобы включить конечную точку службы, выберите одну или несколько служб, для которых необходимо включить конечные точки, из списка **Services** (Службы). Azure автоматически настраивает расположение для конечной точки. По умолчанию Azure настраивает конечные точки службы для региона виртуальной сети. Для поддержки сценариев региональной отработки отказа Azure автоматически настраивает конечные точки в [парных регионах Azure](../best-practices-availability-paired-regions.md?toc=%2fazure%2fvirtual-network%2ftoc.json#what-are-paired-regions) для службы хранилища Azure.</p><p>Чтобы удалить конечную точку службы, снимите флажки для тех служб, для которых необходимо удалить конечную точку. Дополнительные сведения о конечных точках службы и службах, для которых они могут быть включены, см. в разделе [конечные точки службы виртуальной сети](virtual-network-service-endpoints-overview.md). После включения конечной точки службы необходимо предоставить подсети сетевой доступ к ресурсам, созданным с помощью этой службы. Например, если включить конечную точку службы для **Microsoft.Storage**, необходимо также включить сетевой доступ для всех учетных записей хранения Azure, которым нужно предоставить доступ к сети. Чтобы включить сетевой доступ к подсетям, для которых включена конечная точка службы, см. документацию по отдельной службе, для которой включена конечная точка службы.</p><p>Чтобы проверить, включена ли конечная точка службы для подсети, просмотрите [фактические маршруты](diagnose-network-routing-problem.md) для любого сетевого интерфейса в подсети. При настройке конечной точки отображается маршрут *по умолчанию* с префиксами адресов службы и типом следующего прыжка **VirtualNetworkServiceEndpoint**. Дополнительные сведения о маршрутизации см. в разделе [Маршрутизация трафика виртуальной сети](virtual-networks-udr-overview.md).</p> |
    | **Делегирование подсети** | В подсети может быть включено одно или несколько делегирований. Делегирование подсети предоставляет службе явные разрешения на создание в подсети ресурсов, зависящих от службы, с помощью уникального идентификатора во время развертывания службы. Чтобы делегировать подсеть службе, выберите службу, которой вы хотите ее делегировать, в списке **Службы**. |

5. Чтобы добавить подсеть в выбранную виртуальную сеть, щелкните **ОК**.

### <a name="commands"></a>Команды

| Средство | Команда |
| ---- | ------- |
| Azure CLI | [az network vnet subnet create](/cli/azure/network/vnet/subnet#az-network-vnet-subnet-create) |
| PowerShell | [Add-AzVirtualNetworkSubnetConfig](/powershell/module/az.network/add-azvirtualnetworksubnetconfig) |

## <a name="change-subnet-settings"></a>Изменение параметров подсети

1. Перейдите в [портал Azure](https://portal.azure.com) , чтобы просмотреть виртуальные сети. Найдите и щелкните **Виртуальные сети**.

2. Выберите имя виртуальной сети, содержащей подсеть, которую необходимо изменить.

3. В **параметре** выберите **подсети**.

4. В списке подсетей выберите подсеть, для которой нужно изменить параметры.

5. На странице подсеть измените любые из следующих параметров.

    | Параметр | Описание |
    | --- | --- |
    | **Диапазон адресов** | Если в подсети не развернуты ресурсы, вы можете изменить диапазон адресов. Если в подсети имеются какие-либо ресурсы, необходимо удалить их или переместить в другую подсеть. Процедура удаления или перемещения ресурса зависит от его типа. Чтобы узнать, как перемещать или удалять ресурсы в подсетях, ознакомьтесь с документацией по каждому из этих типов ресурсов. См. ограничения для **диапазона адресов** на шаге 4 в разделе [Добавление подсети](#add-a-subnet). |
    | **Пользователи** | Вы можете управлять доступом к подсети, используя встроенные роли или собственные настраиваемые роли. Дополнительные сведения о назначении ролей и пользователей для доступа к подсети см. в разделе [Добавление назначения ролей](../role-based-access-control/role-assignments-portal.md?toc=%2fazure%2fvirtual-network%2ftoc.json#add-a-role-assignment). |
    | **Группа безопасности сети** и **Таблица маршрутов** | См. шаг 4 в разделе [Добавление подсети](#add-a-subnet). |
    | **Конечные точки службы** | <p>Дополнительные сведения о [добавлении подсети](#add-a-subnet)см. в разделе конечные точки службы в шаге 4. При включении конечной точки службы для существующей подсети убедитесь в том, что в ресурсах этой подсети не выполняются критически важные задачи. Конечные точки службы переключают маршруты на каждый сетевой интерфейс в подсети. Конечные точки службы отправляются с использованием маршрута по умолчанию с префиксом адреса *0.0.0.0/0* и типом следующего прыжка *Интернет*, чтобы использовать новый маршрут с префиксами адресов службы и типом следующего прыжка *VirtualNetworkServiceEndpoint*.</p><p>Во время переключения все открытые TCP-соединения могут быть завершены. Конечная точка службы не включена, пока трафик не будет передан в службу для всех сетевых интерфейсов, будет обновлен с новым маршрутом. Дополнительные сведения о маршрутизации см. в разделе [Маршрутизация трафика виртуальной сети](virtual-networks-udr-overview.md).</p> |
    | **Делегирование подсети** | Дополнительные сведения о [добавлении подсети](#add-a-subnet)см. в разделе конечные точки службы в шаге 4. Делегирование можно изменить, включив для подсети несколько делегирований. Если ресурс для службы уже развернут в подсети, делегирование подсети невозможно добавить или удалить до тех пор, пока не будут удалены все ресурсы для службы. Чтобы делегировать подсеть другой службе, выберите службу, которой вы хотите ее делегировать, в списке **Службы**. |

6. Выберите **Сохранить**.

### <a name="commands"></a>Команды

| Средство | Команда |
| ---- | ------- |
| Azure CLI | [az network vnet subnet update](/cli/azure/network/vnet/subnet#az-network-vnet-subnet-update) |
| PowerShell | [Set-AzVirtualNetworkSubnetConfig](/powershell/module/az.network/set-azvirtualnetworksubnetconfig) |

## <a name="delete-a-subnet"></a>Удаление подсети

Подсеть можно удалить только если, к ней не подключены какие-либо ресурсы. Если ресурсы находятся в подсети, необходимо удалить эти ресурсы перед удалением подсети. Конкретная процедура удаления ресурса зависит от его типа. Чтобы узнать, как удалить ресурсы в подсетях, ознакомьтесь с документацией по каждому из этих типов ресурсов.

1. Перейдите в [портал Azure](https://portal.azure.com) , чтобы просмотреть виртуальные сети. Найдите и щелкните **Виртуальные сети**.

2. Выберите имя виртуальной сети, содержащей подсеть, которую необходимо удалить.

3. В **параметре** выберите **подсети**.

4. В списке подсетей выберите подсеть, которую необходимо удалить.

5. Выберите **Удалить**, а затем в диалоговом окне подтверждения нажмите кнопку **Да** .

### <a name="commands"></a>Команды

| Средство | Команда |
| ---- | ------- |
| Azure CLI | [AZ сетевая подсеть vnet удаление](/cli/azure/network/vnet/subnet#az-network-vnet-subnet-delete) |
| PowerShell | [Remove-Азвиртуалнетворксубнетконфиг](/powershell/module/az.network/remove-azvirtualnetworksubnetconfig?toc=%2fazure%2fvirtual-network%2ftoc.json) |

## <a name="permissions"></a>Разрешения

Чтобы выполнять задачи в подсетях, учетной записи должна быть назначена [роль "участник сети](../role-based-access-control/built-in-roles.md?toc=%2fazure%2fvirtual-network%2ftoc.json#network-contributor) " или [пользовательская роль](../role-based-access-control/custom-roles.md?toc=%2fazure%2fvirtual-network%2ftoc.json) , которой назначены соответствующие действия в следующей таблице:

|Действие                                                                   |   Имя                                       |
|-----------------------------------------------------------------------  |   -----------------------------------------  |
|Microsoft.Network/virtualNetworks/subnets/read                           |   Чтение подсети виртуальной сети              |
|Microsoft.Network/virtualNetworks/subnets/write                          |   Создание или обновление подсети виртуальной сети  |
|Microsoft.Network/virtualNetworks/subnets/delete                         |   Удаление подсети виртуальной сети            |
|Microsoft.Network/virtualNetworks/subnets/join/action                    |   Присоединение виртуальной сети                     |
|Microsoft.Network/virtualNetworks/subnets/joinViaServiceEndpoint/action  |   Включение конечной точки службы для подсети     |
|Microsoft.Network/virtualNetworks/subnets/virtualMachines/read           |   Получение виртуальных машин в подсети       |

## <a name="next-steps"></a>Дальнейшие действия

- Создание виртуальной сети и подсетей с помощью образцов скриптов [PowerShell](powershell-samples.md) или [Azure CLI](cli-samples.md) либо на основе [шаблонов Azure Resource Manager](template-samples.md)
- Создание и назначение [определений политик Azure](./policy-reference.md) для виртуальных сетей