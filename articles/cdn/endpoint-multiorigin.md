---
title: Azure CDN с несколькими источниками для конечной точки (Предварительная версия)
description: Приступая к работе с Azure CDN конечной точкой несколько источников.
services: cdn
author: asudbring
manager: KumudD
ms.service: azure-cdn
ms.topic: how-to
ms.date: 9/06/2020
ms.author: allensu
ms.openlocfilehash: 6e433950c04c4494201b090063b17a10e54a4822
ms.sourcegitcommit: b39cf769ce8e2eb7ea74cfdac6759a17a048b331
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/22/2021
ms.locfileid: "98685777"
---
# <a name="azure-cdn-endpoint-multi-origin"></a>Azure CDN с несколькими источниками для конечной точки

Поддержка нескольких источников позволяет сократить время простоя и установить глобальную избыточность. 

Выбрав несколько источников в конечной точке Azure CDN, предоставляемая избыточность распределяет риск путем проверки работоспособности каждого источника и отработки отказа при необходимости.

Настройте одну или несколько исходных групп и выберите группу источника по умолчанию. Каждая исходная группа — это коллекция из одного или нескольких источников, которые могут принимать аналогичные рабочие нагрузки.

> [!NOTE]
> Сейчас эта функция доступна только в Azure CDN от Майкрософт. 

## <a name="create-the-origin-group"></a>Создание группы происхождения

1. Войдите на [портал Azure](https://portal.azure.com)

2. Выберите профиль Azure CDN, а затем конечную точку, для которой будет настроено несколько источников.

3. Выберите **источник** в разделе **Параметры** в конфигурации конечной точки.

    :::image type="content" source="./media/endpoint-multiorigin/endpoint-multiorigin-1.png" alt-text="Конечная точка сети CDN" border="true":::

4. Чтобы включить несколько источников, требуется по крайней мере одна группа-источник. Выберите **создать группу происхождения**:

    :::image type="content" source="./media/endpoint-multiorigin/endpoint-multiorigin-2.png" alt-text="Параметры источника" border="true":::

5. В конфигурации **Добавить исходную группу** введите или выберите следующие сведения.

   | Параметр           | Значение                                                                 |
   |-------------------|-----------------------------------------------------------------------|
   | Имя исходной группы | Введите имя для исходной группы.                                   |
   | Состояние зонда      | Щелкните **Включено**. </br> Azure CDN запустит зонды работоспособности из разных точек земного шара, чтобы определить работоспособность источника. Не включайте, если текущая группа происхождения не активна, чтобы избежать дополнительных затрат.
   | Путь пробы        | Путь в источнике, используемый для определения работоспособности. |
   | Интервал пробы    | Выберите интервал проверки 1, 2 или 4 минуты.                        |
   | Протокол пробы    | Выберите **http** или **HTTPS**.                                         |
   | Метод проверки      | Выберите **head** или **Get**.                                           |
   | Группа происхождения по умолчанию | Выберите поле для установки в качестве группы происхождения по умолчанию.
    
   :::image type="content" source="./media/endpoint-multiorigin/endpoint-multiorigin-3.png" alt-text="Добавить исходную группу" border="true":::

6. Выберите **Добавить**.

## <a name="add-multiple-origins"></a>Добавление нескольких источников

1. В параметрах источника для конечной точки выберите **+ источник создания**:

    :::image type="content" source="./media/endpoint-multiorigin/endpoint-multiorigin-5.png" alt-text="Создать источник" border="true":::

2. Введите или выберите следующие сведения в конфигурации **Добавить источник** :

   | Параметр           | Значение                                                                 |
   |-------------------|-----------------------------------------------------------------------|
   | Имя        | Введите имя источника.        |
   | Тип источника | Выберите **хранилище**, **облачная служба**, **веб-приложение** или **Пользовательский источник**.                                   |
   | Имя узла источника        | Выберите или введите имя узла источника.  Раскрывающийся список содержит все доступные источники типа, указанного в предыдущем параметре. Если в качестве типа источника выбрано значение **настраиваемый источник** , введите домен сервера источника клиента. |
   | Заголовок узла источника    | Введите заголовок узла, который нужно Azure CDN отправить с каждым запросом, или оставьте значение по умолчанию.                        |
   | Порт HTTP   | Введите HTTP-порт.                                         |
   | Порт HTTPS     | Введите HTTPS порт.                                           |
   | Приоритет    | Введите число от 1 до 5.       |
   | Вес      | Введите число от 1 до 1000.   |

    > [!NOTE]
    > Если источник создается в группе происхождения, он должен быть связан с приоритетом и весом. Если в исходной группе есть только один источник, приоритет и вес по умолчанию задаются как 1. Трафик направляется к источникам с наивысшим приоритетом, если источник является работоспособным. Если источник определен как неработоспособный, то подключения перенаправляются в другой источник в порядке приоритета. Если два источника имеют одинаковый приоритет, трафик распределяется по весу, указанному для источника. 

    :::image type="content" source="./media/endpoint-multiorigin/endpoint-multiorigin-6.png" alt-text="Добавить дополнительный источник" border="true":::

3. Выберите **Добавить**.

4. Выберите **настроить источник** , чтобы задать путь к источнику для всех источников:

    :::image type="content" source="./media/endpoint-multiorigin/endpoint-multiorigin-7.png" alt-text="Настройка пути к источнику" border="true":::

5. Щелкните **ОК**.

## <a name="configure-origins-and-origin-group-settings"></a>Настройка источников и параметров исходной группы

После получения нескольких источников и исходной группы можно добавить или удалить источники в разных группах. Источники в одной группе должны обслуживать аналогичные рабочие нагрузки. Трафик будет распределяться по этим источникам в зависимости от их состояния работоспособности, приоритета и веса. 

1. В параметрах источника конечной точки Azure CDN выберите имя исходной группы, которую вы хотите настроить.

    :::image type="content" source="./media/endpoint-multiorigin/endpoint-multiorigin-8.png" alt-text="Настройка источников и параметров исходной группы" border="true":::

2. В **группе Источник обновления** выберите **+ Выбор источника**:

    :::image type="content" source="./media/endpoint-multiorigin/endpoint-multiorigin-9.png" alt-text="Обновить группу происхождения" border="true":::

4. Выберите источник для добавления в группу в раскрывающемся списке и нажмите кнопку **ОК**.

5. Убедитесь, что источник добавлен в группу, а затем выберите **сохранить**:

    :::image type="content" source="./media/endpoint-multiorigin/endpoint-multiorigin-10.png" alt-text="Проверка добавления дополнительного источника в группу" border="true":::

## <a name="remove-origin-from-origin-group"></a>Удалить источник из группы происхождения

1. В параметрах источника конечной точки Azure CDN выберите имя исходной группы:

    :::image type="content" source="./media/endpoint-multiorigin/endpoint-multiorigin-8.png" alt-text="Удалить источник из группы" border="true":::

2. Чтобы удалить источник из группы источника, щелкните значок корзины рядом с источником и выберите **сохранить**:

    :::image type="content" source="./media/endpoint-multiorigin/endpoint-multiorigin-11.png" alt-text="Обновление источника удаления исходной группы" border="true":::

## <a name="override-origin-group-with-rules-engine"></a>Переопределение исходной группы с помощью обработчика правил

Настройте способ распространения трафика в разные группы происхождения с помощью стандартного обработчика правил.

Распределите трафик в другую группу на основе URL-адреса запроса.

1. В конечной точке CDN в разделе **Параметры** выберите **обработчик правил** :

:::image type="content" source="./media/endpoint-multiorigin/endpoint-multiorigin-12.png" alt-text="Обработчик правил" border="true":::

2. Выберите **+ Добавить правило**.

3. Введите имя правила в поле **имя**.

4. Выберите **+ условие**, а затем щелкните **URL-путь**.

5. В раскрывающемся списке **оператор** выберите **Contains**.

6. В списке **значение** введите **/Images**.

7. Выберите **+ Добавить действие**, а затем выберите **Переопределение исходной группы**.

8. В поле « **Исходная группа**» выберите группу «Origin» в раскрывающемся списке.

:::image type="content" source="./media/endpoint-multiorigin/endpoint-multiorigin-13.png" alt-text="Условия обработчика правил" border="true":::

Для всех входящих запросов, если URL-путь содержит **/Images**, запрос будет назначен группе источника в разделе действия **(мйоригинграуп)**. 

## <a name="next-steps"></a>Дальнейшие шаги
В этой статье вы включили Azure CDNную конечную точку с несколькими источниками.

Дополнительные сведения о Azure CDN и других службах Azure, упомянутых в этой статье, см. в следующих статьях:

* [Azure CDN](./cdn-overview.md)
* [Сравнение функции продукта Azure CDN](./cdn-features.md)
