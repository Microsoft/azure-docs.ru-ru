---
title: Оптимизация потоковой передачи мультимедиа с помощью Azure CDN
description: Сведения о том, как оптимизировать потоковую передачу мультимедиа в сети доставки содержимого Azure, например, время ожидания для частичного и недоступного заполнения кэша.
services: cdn
documentationcenter: ''
author: asudbring
manager: danielgi
editor: ''
ms.assetid: ''
ms.service: azure-cdn
ms.workload: tbd
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: how-to
ms.date: 05/01/2018
ms.author: allensu
ms.openlocfilehash: c3ab722f182e32cf2f3aca6bb2f3d5a9598264af
ms.sourcegitcommit: 772eb9c6684dd4864e0ba507945a83e48b8c16f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "88192603"
---
# <a name="media-streaming-optimization-with-azure-cdn"></a>Оптимизация потоковой передачи мультимедиа с помощью Azure CDN 
 
Пользователи Интернета все чаще отдают предпочтение видео высокого разрешения, что создает трудности для эффективной доставки больших файлов. Пользователи ожидают плавного воспроизведения видео по запросу или потокового видео в разных сетях и клиентах по всему миру. Чтобы обеспечить комфорт пользователей, крайне важно обеспечить быстрый и эффективный механизм потоковой передачи файлов мультимедиа.  

Потоковую передачу мультимедиа обеспечить особенно трудно из-за большого размера файлов и количества параллельных зрителей. Пользователи не захотят мириться с длинными задержками. Так как потоковые трансляции в прямом эфире не могут кэшироваться заранее, а большие задержки не устраивают зрителей, то фрагменты видео должны передаваться своевременно. 

Шаблоны запросов потоковой передачи также создают некоторые сложности. Во время популярных потоковых трансляций или выхода новых сериалов для видео по запросу количество зрителей, которые одновременно запрашивают поток, составляет от нескольких тысяч до нескольких миллионов. В таких случаях правильная консолидация запросов является ключевой для исключения перегрузки серверов-источников, если ресурсы еще не кэшированы.
 

## <a name="media-streaming-optimizations-for-azure-cdn-from-microsoft"></a>Оптимизация потоковой передачи мультимедиа для Azure CDN от Майкрософт

В **Azure CDN уровня "Стандартный" от Майкрософт** конечные точки выполняют прямую потоковую передачу файлов мультимедиа, используя оптимизацию общей веб-доставки. 

Оптимизация потоковой передачи в **Azure CDN уровня "Стандартный" от Майкрософт** эффективна для прямых трансляций и потоковой передачи видео по запросу, при которых передаются отдельные фрагменты мультимедиа. Этот процесс отличается от передачи одного большого ресурса с помощью последовательной загрузки или с помощью запросов на диапазоны байт. Дополнительные сведения о таком типе доставки мультимедиа см. в статье [об оптимизации больших файлов в Azure CDN](cdn-large-file-optimization.md).

При оптимизации общей передачи мультимедиа и оптимизации передачи видео по запросу используется сеть доставки содержимого (CDN) с серверной оптимизацией, чтобы ускорить доставку ресурсов мультимедиа. В них также используются конфигурации для ресурсов мультимедиа на основе общих рекомендаций, выработанных с течением времени.

### <a name="partial-cache-sharing"></a>Совместное использование частичного кэширования
Совместное использование частичного кэширования позволяет сети доставки содержимого отправлять частично кэшированное содержимое в ответ на новые запросы. Например, если первый запрос к результатам сети доставки содержимого завершился промахом кэша, то запрос отправляется к источнику. Хотя это неполное содержимое загружается в кэш сети доставки содержимого, другие запросы к сети доставки содержимого начнут получать эти данные. 


## <a name="media-streaming-optimizations-for-azure-cdn-from-verizon"></a>Оптимизация потоковой передачи мультимедиа для Azure CDN от Verizon

В **Azure CDN уровня "Стандартный" от Verizon** и **Azure CDN уровня "Премиум" от Verizon** конечные точки выполняют прямую потоковую передачу файлов мультимедиа, используя оптимизацию общей веб-доставки. Некоторые функции сети доставки содержимого по умолчанию напрямую влияют на доставку ресурсов мультимедиа.

### <a name="partial-cache-sharing"></a>Совместное использование частичного кэширования

Совместное использование частичного кэширования позволяет сети доставки содержимого отправлять частично кэшированное содержимое в ответ на новые запросы. Например, если первый запрос к результатам сети доставки содержимого завершился промахом кэша, то запрос отправляется к источнику. Хотя это неполное содержимое загружается в кэш сети доставки содержимого, другие запросы к сети доставки содержимого начнут получать эти данные. 

### <a name="cache-fill-wait-time"></a>Время ожидания заполнения кэша

 Функция времени ожидания заполнения кэша вынуждает пограничный сервер удерживать последующие запросы к тому же ресурсу, пока с сервера-источника не будут возвращены заголовки HTTP-ответа. Если заголовки HTTP-ответа с сервера-источника поступают до истечения времени ожидания, то все удерживаемые запросы возвращаются из растущего кэша. В это же время кэш заполняется данными из источника. Время ожидания заполнения кэша по умолчанию равно 3,000 мс. 

 
## <a name="media-streaming-optimizations-for-azure-cdn-from-akamai"></a>Оптимизация потоковой передачи мультимедиа для Azure CDN от Akamai
 
**Azure CDN уровня "Стандартный" от Akamai** обеспечивает эффективную потоковую передачу файлов мультимедиа для пользователей по всему миру. Эта функция сокращает задержки, так как снижает нагрузку на серверы-источники. Эта функция доступна в ценовой категории Akamai "Стандартный". 

Оптимизация потоковой передачи для **Azure CDN уровня "Стандартный" от Akamai** эффективна для прямых трансляций и потоковой передачи видео по запросу, при которых передаются отдельные фрагменты мультимедиа. Этот процесс отличается от передачи одного большого ресурса с помощью последовательной загрузки или с помощью запросов на диапазоны байт. Дополнительные сведения о таком типе доставки мультимедиа см. в статье [Оптимизация больших файлов](cdn-large-file-optimization.md).

При оптимизации общей передачи мультимедиа и оптимизации передачи видео по запросу используется сеть доставки содержимого с серверной оптимизацией для ускорения доставки ресурсов мультимедиа. В них также используются конфигурации для ресурсов мультимедиа на основе общих рекомендаций, выработанных с течением времени.

### <a name="configure-an-akamai-cdn-endpoint-to-optimize-media-streaming"></a>Настройка конечной точки CDN от Akamai для оптимизации потоковой передачи мультимедиа
 
Вы можете настроить конечную точку сети доставки содержимого для оптимизации доставки больших файлов с помощью портала Azure. Для этого можно также использовать интерфейсы REST API или любые клиентские пакеты SDK. Ниже описана процедура настройки на портале Azure для **Azure CDN уровня "Стандартный" от Akamai**.

1. Чтобы добавить новую конечную точку, на странице **профиля CDN** для Akamai выберите **Конечная точка**.
  
    ![Новая конечная точка](./media/cdn-media-streaming-optimization/cdn-new-akamai-endpoint.png)

2. В раскрывающемся списке **Оптимизировано для** выберите **Потоковая передача видео по запросу** для ресурсов видео по запросу. Если используется сочетание потоковой передачи видео в реальном времени и потоковой передачи видео по запросу, выберите **Общая потоковая передача мультимедиа**.

    ![Выбранная потоковая передача](./media/cdn-media-streaming-optimization/02_Creating.png) 
 
После создания конечной точки будет применена оптимизация для всех файлов, соответствующих определенным условиям. Этот процесс описан в следующем разделе. 

### <a name="caching"></a>Кэширование

Если **Azure CDN уровня "Стандартный" от Akamai** определяет ресурс как манифест или фрагмент потоковой передачи, для этого ресурса используется другой срок кэширования, отличный от срока для общей веб-доставки. (См. полный список в следующей таблице.) Как всегда, учитываются заголовки Cache-Control или Expires, отправленные из источника. Если ресурс не является ресурсом мультимедиа, он кэшируется с использованием времени истечения срока действия для обычной веб-доставки.

Короткое время отрицательного кэширования удобно для разгрузки источника, когда множество пользователей запрашивают фрагмент, которого еще не существует. Такое происходит, например, в потоках реального времени, в которых пакеты не доступны от источника в ту же секунду. Более долгий интервал кэширования также помогает разгрузить запросы от источника, так как содержимое видео обычно не изменяется.

| Кэширование  | Общая веб-доставка | Общая потоковая передача мультимедиа | Потоковая передача видео по запросу  
|--- | --- | --- | ---
| Кэширование: положительное <br> HTTP 200, 203, 300, <br> 301, 302 и 410 | 7 дней |365 дней | 365 дней   
| Кэширование: отрицательное <br> HTTP 204, 305, 404 <br> и 405 | Нет | 1 с | 1 с
 
### <a name="deal-with-origin-failure"></a>Устранение сбоев источника  

При общей передаче мультимедиа и передаче видео по запросу также используются время ожидания источника и журнал повторных попыток в соответствии с рекомендациями для шаблонов типичных запросов. Например, так как общая передача мультимедиа предназначена для передачи в режиме реального времени и передачи видео по запросу, используется меньшее время ожидания подключения. Причина в том, что при потоковой передаче в режиме реального времени необходимо строго соблюдать временные интервалы.

После истечения времени ожидания подключения сеть доставки содержимого повторит попытку подключения несколько раз, после чего клиенту будет отправлена ошибка 504 ("Время ожидания шлюза истекло"). 

Если файл соответствует типу файла и списку условий для размера файла, сеть доставки содержимого использует параметры для потоковой передачи мультимедиа. В противном случае используется общая веб-доставка.
   
### <a name="conditions-for-media-streaming-optimization"></a>Условия для оптимизации потоковой передачи мультимедиа 

В следующей таблице перечислен набор критериев, которые должны быть выполнены для оптимизации потоковой передачи: 
 
Поддерживаемые типы потоковой передачи | Расширения файлов  
--- | ---  
Apple HLS | m3u8, m3u, m3ub, key, ts, aac
Adobe HDS | f4m, f4x, drmmeta, bootstrap, f4f,<br>Структура URL Seg-Frag <br> (сопоставления регулярного выражения: ^(/.*)Seq(\d+)-Frag(\d+)
DASH | mpd, тире, divx, ismv, m4s, m4v, mp4, mp4v, <br> sidx, webm, mp4a, m4a, isma
Потоковая передача Smooth Streaming | /manifest/, /QualityLevels/Fragments/
  
 
