---
title: Руководство по добавлению сети доставки содержимого Azure в веб-приложение службы приложений Azure | Документация Майкрософт
description: В этом руководстве показано, как добавить сеть доставки содержимого (CDN) в веб-приложение службы приложений Azure для кэширования и доставки статических файлов с ближайших к вашим клиентам серверов по всему миру.
services: cdn
documentationcenter: ''
author: asudbring
manager: danielgi
editor: ''
ms.assetid: ''
ms.service: azure-cdn
ms.workload: tbd
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: tutorial
ms.date: 05/14/2018
ms.author: allensu
ms.custom: mvc
ms.openlocfilehash: 3f1dacb57931913edfb181f023bdf98717777d50
ms.sourcegitcommit: 772eb9c6684dd4864e0ba507945a83e48b8c16f0
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "97562248"
---
# <a name="tutorial-add-azure-cdn-to-an-azure-app-service-web-app"></a>Руководство по Добавление сети доставки содержимого Azure в веб-приложение Службы приложений Azure

В этом руководстве показано, как добавить [сеть доставки содержимого Azure (CDN)](cdn-overview.md) в [веб-приложение службы приложений Azure](../app-service/overview.md). Веб-приложения — это служба для размещения веб-приложений, интерфейсов REST API и серверной части мобильных решений. 

Это домашняя страница примера статического HTML-сайта, с которым вы будете работать:

![Домашняя страница примера приложения](media/cdn-add-to-web-app/sample-app-home-page.png)

Из этого руководства вы узнаете, как выполнять такие задачи:

> [!div class="checklist"]
> * создание конечной точки CDN;
> * обновление кэшированных ресурсов;
> * использование строк запросов для управления кэшированными версиями;


## <a name="prerequisites"></a>Предварительные требования

Для работы с этим руководством сделайте следующее:

- [установите Git](https://git-scm.com/);
- [Установка Azure CLI](/cli/azure/install-azure-cli)

[!INCLUDE [quickstarts-free-trial-note](../../includes/quickstarts-free-trial-note.md)]

## <a name="create-the-web-app"></a>Создание веб-приложения

Чтобы создать веб-приложение, с которым вы будете работать, следуйте инструкциям в разделе **Переход в приложение** статьи [Создание статического веб-приложения HTML в Azure](../app-service/quickstart-html.md).

## <a name="log-in-to-the-azure-portal"></a>Войдите на портал Azure.

Откройте браузер и перейдите на [портал Azure](https://portal.azure.com).

### <a name="dynamic-site-acceleration-optimization"></a>Оптимизация динамического ускорения сайтов
Если необходимо оптимизировать конечную точку CDN для динамического ускорения сайтов (DSA), для создания конечной точки и профиля используйте [портал CDN](cdn-create-new-endpoint.md). [Оптимизация DSA](cdn-dynamic-site-acceleration.md) значительно улучшает производительность веб-страниц с динамическим содержимым. Инструкции по оптимизации конечной точки CDN для DSA на портале CDN см. в разделе [Настройка конечной точки CDN для ускорения доставки динамических файлов](cdn-dynamic-site-acceleration.md#cdn-endpoint-configuration-to-accelerate-delivery-of-dynamic-files). Если же нет необходимости оптимизировать новую конечную точку, можно использовать портал веб-приложений для ее создания, выполнив шаги из следующего раздела. Обратите внимание, что для профилей **Azure CDN от Verizon** возможность изменения оптимизации конечной точки CDN после ее создания недоступна.

## <a name="create-a-cdn-profile-and-endpoint"></a>Создание профиля CDN и конечной точки

В области навигации слева выберите раздел **Службы приложений**, а затем и выберите приложение, созданное в соответствии с инструкциями по [созданию статического веб-приложения HTML](../app-service/quickstart-html.md).

![Выбор службы приложений на портале](media/cdn-add-to-web-app/portal-select-app-services.png)

На странице **Служба приложений** в разделе **Параметры** выберите **Сеть > Настроить сеть доставки содержимого Azure для приложения**.

![Выбор CDN на портале](media/cdn-add-to-web-app/portal-select-cdn.png)

На странице **Сеть доставки содержимого Azure** выберите параметры **новой конечной точки** параметры, как указано в таблице.

![Создание профиля и конечной точки на портале](media/cdn-add-to-web-app/portal-new-endpoint.png)

| Параметр | Рекомендуемое значение | Описание |
| ------- | --------------- | ----------- |
| **Профиль CDN** | myCDNProfile | Профиль CDN представляет собой коллекцию конечных точек сети CDN из одной ценовой категории. |
| **Ценовая категория** | Akamai уровня "Стандартный" | От [ценовой категории](cdn-features.md) зависят поставщик и доступные возможности. В этом руководстве используется *Akamai уровня "Стандартный"* . |
| **Имя конечной точки CDN** | Любое имя, которое является уникальным в домене azureedge.net | Вы можете обращаться к кэшированным ресурсам в домене *&lt;имя_конечной_точки&gt;* .azureedge.net.

Выберите **Создать**, чтобы создать профиль CDN.

Azure создаст профиль и конечную точку. Новая конечная точка появится в списке **Конечные точки**. Когда она будет готова, ее состояние изменится на **Выполняется**.

![Новая конечная точка в списке](media/cdn-add-to-web-app/portal-new-endpoint-in-list.png)

### <a name="test-the-cdn-endpoint"></a>Тестирование конечной точки сети CDN

 Конечная точка станет доступна не сразу. Распространение регистрационных сведений может занять некоторое время. 
   - Для профилей **Azure CDN категории "Стандартный" от Майкрософт** распространение обычно выполняется в течение 10 минут. 
   - Для профилей **Azure CDN уровня "Стандартный" от Akamai** распространение обычно завершается в течение одной минуты. 
   - Для профилей **Azure CDN уровня "Стандартный" от Verizon** и **Azure CDN уровня "Премиум" от Verizon** распространение обычно выполняется в течение 90 минут. 

Пример приложения содержит файл *index.html* и папки *css*, *img* и *js*, в которых находятся другие статические ресурсы. Пути содержимого для всех этих файлов совпадают с путями конечной точки CDN. Например, оба URL-адреса в примерах ниже обращаются к файлу *bootstrap.css* в папке *css*:

```
http://<appname>.azurewebsites.net/css/bootstrap.css
```

```
http://<endpointname>.azureedge.net/css/bootstrap.css
```

Откройте браузер и перейдите по следующему URL-адресу:

```
http://<endpointname>.azureedge.net/index.html
```

![Домашняя страница примера приложения, которая передается из CDN](media/cdn-add-to-web-app/sample-app-home-page-cdn.png)

 Вы увидите ту же страницу, которая отображалась раньше в веб-приложении. Сеть доставки содержимого Azure извлекла ресурсы исходного веб-приложения и передает их из конечной точки CDN.

Чтобы убедиться, что эта страница кэшируется в CDN, обновите страницу. Иногда для кэширования запрошенного содержимого в CDN необходимо два запроса к одному и тому же ресурсу.

Дополнительные сведения о создании профилей и конечных точек Azure CDN см. в статье [Начало работы с Azure CDN](cdn-create-new-endpoint.md).

## <a name="purge-the-cdn"></a>Очистка CDN

CDN периодически обновляет свои ресурсы из исходного веб-приложения на основе конфигурации срока жизни (TTL). По умолчанию срок жизни составляет 7 дней.

Иногда может потребоваться обновить CDN до истечения срока жизни, например при развертывании обновленного содержимого веб-приложения. Чтобы активировать обновление, можно вручную очистить ресурсы CDN. 

В этом разделе руководства вы можете развернуть изменение в веб-приложении и очистить CDN, чтобы активировать обновление кэша CDN.

### <a name="deploy-a-change-to-the-web-app"></a>Развертывание изменений в веб-приложении

Откройте файл *index.html* и добавьте *-V2* в заголовок H1, как показано в следующем примере: 

```
<h1>Azure App Service - Sample Static HTML Site - V2</h1>
```

Зафиксируйте изменение и разверните его в веб-приложении.

```bash
git commit -am "version 2"
git push azure main
```

После завершения развертывания откройте URL-адрес веб-приложения, и вы увидите изменения.

```
http://<appname>.azurewebsites.net/index.html
```

![Элемент "V2" в заголовке веб-приложения](media/cdn-add-to-web-app/v2-in-web-app-title.png)

Если перейти по URL-адресу конечной точки CDN, чтобы открыть домашнюю страницу, вы не увидите изменения, так как срок действия кэшированной версии CDN еще не истек. 

```
http://<endpointname>.azureedge.net/index.html
```

![В заголовке в CDN нет элемента "V2"](media/cdn-add-to-web-app/no-v2-in-cdn-title.png)

### <a name="purge-the-cdn-in-the-portal"></a>Очистка CDN на портале

Чтобы активировать обновление кэшированной версии в CDN, нужно очистить CDN.

На портале в области навигации слева выберите раздел **Группы ресурсов**, а затем выберите группу ресурсов, созданную для веб-приложения (myResourceGroup).

![Выбор группы ресурсов](media/cdn-add-to-web-app/portal-select-group.png)

В списке ресурсов выберите конечную точку CDN.

![Выбор конечной точки](media/cdn-add-to-web-app/portal-select-endpoint.png)

В верхней части страницы **Конечная точка** выберите **Очистить**.

![Нажатие кнопки "Очистить"](media/cdn-add-to-web-app/portal-select-purge.png)

Введите пути к содержимому, которые необходимо очистить. Вы можете передать полный путь к файлу, чтобы очистить отдельный файл, или сегмент пути, чтобы очистить и обновить все содержимое папки. Так как файл *index.html* был изменен, убедитесь, что он расположен по одному из путей.

В нижней части страницы нажмите кнопку **Очистить**.

![Страница очистки](media/cdn-add-to-web-app/app-service-web-purge-cdn.png)

### <a name="verify-that-the-cdn-is-updated"></a>Проверка обновления CDN

Подождите, пока запрос очистки завершит обработку. Обычно это длится несколько минут. Чтобы просмотреть текущее состояние, выберите значок колокольчика в верхней части страницы. 

![Уведомление об очистке](media/cdn-add-to-web-app/portal-purge-notification.png)

Когда вы перейдете по URL-адресу конечной точки сети доставки содержимого для *index.html*, вы увидите надпись *V2*, добавленную в заголовок на домашней странице, который указывает на обновление кэша CDN.

```
http://<endpointname>.azureedge.net/index.html
```

!["V2" в заголовке в CDN](media/cdn-add-to-web-app/v2-in-cdn-title.png)

Дополнительные сведения см. в статье [Очистка конечной точки сети CDN Azure](../cdn/cdn-purge-endpoint.md). 

## <a name="use-query-strings-to-version-content"></a>Использование строк запросов для управления версиями содержимого

В Azure CDN доступны следующие варианты режима кэширования:

* игнорировать строки запросов;
* обходить кэширование для строк запросов;
* кэшировать все уникальные URL-адреса. 

Первый вариант используется по умолчанию. Это означает, что существует только одна кэшированная версия ресурса, независимо от строки запроса в URL-адресе. 

В этом разделе руководства можно изменить режим кэширования, чтобы кэшировать каждый уникальный URL-адрес.

### <a name="change-the-cache-behavior"></a>Изменение поведения кэширования

На портале Azure на странице **Конечная точка CDN** выберите раздел **Кэш**.

Для параметра **Режим кэширования строк запросов** выберите в раскрывающемся списке **Кэшировать каждый уникальный URL-адрес**.

Щелкните **Сохранить**.

![Выбор режима кэширования строки запроса](media/cdn-add-to-web-app/portal-select-caching-behavior.png)

### <a name="verify-that-unique-urls-are-cached-separately"></a>Проверка кэширования уникальных URL-адресов по отдельности

В браузере перейдите на домашнюю страницу по адресу конечной точки CDN и включите строку запроса: 

```
http://<endpointname>.azureedge.net/index.html?q=1
```

Azure CDN возвращает текущее содержимое веб-приложения, которое включает *V2* в заголовке. 

Чтобы убедиться, что эта страница кэшируется в CDN, обновите страницу. 

Откройте файл *index.html*, измените *V2* на *V3*, а затем разверните изменения. 

```bash
git commit -am "version 3"
git push azure main
```

В браузере откройте URL-адрес конечной точки CDN с новой строкой запроса, например `q=2`. Azure CDN получает текущий файл *index.html* и отображает значение *V3*. Однако при переходе к конечной точке CDN со строкой запроса `q=1` отображается значение *V2*.

```
http://<endpointname>.azureedge.net/index.html?q=2
```

!["V3" в заголовке CDN, строка запроса 2](media/cdn-add-to-web-app/v3-in-cdn-title-qs2.png)

```
http://<endpointname>.azureedge.net/index.html?q=1
```

!["V2" в заголовке CDN, строка запроса 1](media/cdn-add-to-web-app/v2-in-cdn-title-qs1.png)

Этот результат показывает, что каждая строка запроса обрабатывается по-разному:

* строка "q=1" использовалась ранее, поэтому возвращается кэшированное содержимое (V2);
* строка "q=2" используется впервые, поэтому извлекается и возвращается последнее содержимое веб-приложения (V3).

Дополнительные сведения см. в статье [Управление режимом кэширования Azure CDN с помощью строк запросов](../cdn/cdn-query-string.md).

[!INCLUDE [cli-samples-clean-up](../../includes/cli-samples-clean-up.md)]

## <a name="next-steps"></a>Дальнейшие действия

Вы научились выполнять следующие задачи:

> [!div class="checklist"]
> * создание конечной точки CDN;
> * обновление кэшированных ресурсов;
> * использование строк запросов для управления кэшированными версиями;

Чтобы узнать, как оптимизировать производительность CDN, см. следующие статьи:

> [!div class="nextstepaction"]
> [Руководство. Добавление личного домена к конечной точке Azure CDN](cdn-map-content-to-custom-domain.md)