---
title: Управление режимом кэширования Azure CDN с помощью правил кэширования | Документация Майкрософт
description: Вы можете использовать правила кэширования сети доставки содержимого (CDN) или изменять истечение срока действия кэша по умолчанию как глобально, так и с условиями (например, URL-путь и расширения файла).
services: cdn
documentationcenter: ''
author: asudbring
manager: danielgi
editor: ''
ms.service: azure-cdn
ms.workload: tbd
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: how-to
ms.date: 03/19/2019
ms.author: allensu
ms.openlocfilehash: a5f4f6a6e72b57638688069111071a6e0a035c49
ms.sourcegitcommit: 910a1a38711966cb171050db245fc3b22abc8c5f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "96018670"
---
# <a name="control-azure-cdn-caching-behavior-with-caching-rules"></a>Управление режимом кэширования Azure CDN с помощью правил кэширования

> [!NOTE] 
> Правила кэширования доступны только для профилей **Azure CDN уровня "Стандартный" от Verizon** и **Azure CDN уровня "Стандартный" от Akamai**. Для профилей **Azure CDN от корпорации Майкрософт** необходимо использовать [стандартный обработчик правил](cdn-standard-rules-engine-reference.md). Для профилей **Azure CDN (цен. категории "Премиум") от Verizon** необходимо использовать [обработчик правил Verizon (цен. категории "Премиум")](./cdn-verizon-premium-rules-engine.md) на **портале управления** для аналогичных функций.
 
Сеть доставки содержимого Azure (CDN) предлагает два способа управления кэшированием файлов. 

- Правила кэширования. В этой статье описывается, как использовать правила кэширования сети доставки содержимого (CDN) или изменять истечение срока действия кэша по умолчанию как глобально, так и с настраиваемыми условиями (например, URL-путь и расширения файла). Azure CDN предоставляет два типа правил кэширования.

   - Глобальные правила кэширования: вы можете задать в своем профиле одно глобальное правило кэширования для каждой конечной точки, которое влияет на все запросы к конечной точке. Глобальное правило кэширования переопределяет все заголовки директив кэша HTTP (если они заданы).

   - Настраиваемые правила кэширования: вы можете задать одно или несколько настраиваемых правил кэширования для каждой конечной точки в профиле. Настраиваемые правила кэширования соответствуют конкретным путям и расширениям файлов, обрабатываются по порядку и переопределяют глобальное правило кэширования (если оно задано). 

- Кэширование строки запроса. Вы можете настроить обработку кэширования Azure CDN для запросов со строками запроса. Дополнительные сведения см. в статье [Управление режимом кэширования в сети доставки содержимого Azure с помощью строк запросов](cdn-query-string.md). Если файл невозможно кэшировать, параметр кэширования строки запроса не оказывает влияния, исходя из правил кэширования и поведения по умолчанию CDN.

Сведения о поведении кэширования по умолчанию и заголовках директив кэширования см. в статье [Как выполняется кэширование](cdn-how-caching-works.md). 


## <a name="accessing-azure-cdn-caching-rules"></a>Доступ к правилам кэширования Azure CDN

1. Откройте портал Azure, выберите профиль CDN, а затем конечную точку.

2. В области слева в разделе "Параметры" выберите **Правила кэширования**.

   ![Кнопка "Правила кэширования" CDN](./media/cdn-caching-rules/cdn-caching-rules-btn.png)

   Появится страница **Правила кэширования**.

   ![Страница правил кэширования CDN](./media/cdn-caching-rules/cdn-caching-rules-page.png)


## <a name="caching-behavior-settings"></a>Параметры поведения кэширования
Для глобальных и настраиваемых правил кэширования можно задать следующие параметры **поведения кэширования**.

- **Отключение кэша.** Не кэшировать и игнорировать предоставляемые системой заголовки директив кэша.

- **Переопределение**: пропускать срок хранения кэша, предоставленный источником; Вместо этого используйте указанную продолжительность кэша. Это не приведет к переопределению Cache-Control: un-Cache.

- **Установить, если отсутствует.** Учитывать предоставленные системой заголовки директив кэша, если таковые имеются. В противном случае использовать продолжительность хранения в кэше.

![Глобальные правила кэширования](./media/cdn-caching-rules/cdn-global-caching-rules.png)

![Настраиваемые правила кэширования](./media/cdn-caching-rules/cdn-custom-caching-rules.png)

## <a name="cache-expiration-duration"></a>Срок действия кэша
Для глобальных и настраиваемых правил кэширования можно указать срок действия кэша в днях, часах, минутах и секундах.

- Для **переопределения** и **установки, если отсутствуют** параметры **поведения кэширования** , допустимые значения длительности кэша находятся в диапазоне от 0 секунд до 366 дней. При значении 0 секунд CDN кэширует содержимое, но необходимо повторять проверку каждого запроса на сервере-источнике.

- Для параметра **Отключение кэша** в качестве продолжительности хранения в кэше автоматически устанавливается значение 0 секунд и его нельзя изменить.

## <a name="custom-caching-rules-match-conditions"></a>Условия соответствия настраиваемых правил кэширования

Для настраиваемых правил кэширования доступно два условия соответствия.
 
- **Путь.** Это условие соответствует пути URL-адреса, за исключением доменного имени, и в нем поддерживается подстановочный символ (\*). Например, _/myfile.html_, _/my/folder/*_ и _/my/images/*.jpg_. Максимальная длина составляет 260 символов.

- **Расширение.** Это условие соответствует расширению запрашиваемого файла. Вы можете предоставить список расширений файлов для соответствия (разделенных запятыми). Например, _.jpg_, _.mp3_ или _.png_. Максимальное количество расширений — 50, а максимальное количество символов на одно расширение — 16. 

## <a name="global-and-custom-rule-processing-order"></a>Порядок обработки глобального и настраиваемого правил
Глобальные и настраиваемые правила кэширования обрабатываются в следующем порядке.

- Глобальные правила кэширования имеют приоритет над поведением кэширования CDN по умолчанию (параметры заголовка директив кэша HTTP). 

- Настраиваемые правила кэширования имеют приоритет над глобальными правилами кэширования, где они применяются. Настраиваемые правила кэширования обрабатываются в порядке сверху вниз. То есть если запрос соответствует обоим условиям, правила в нижней части списка имеют приоритет над правилами в верхней части списка. Поэтому вы должны размещать конкретные правила ниже в списке.

**Пример**:
- Глобальное правило кэширования. 
   - Поведение кэширования: **Переопределить**
   - Срок действия кэша: 1 день

- Первое настраиваемое правило кэширования:
   - Условие соответствия: **путь**
   - Значение соответствия: _/home/*_.
   - Поведение кэширования: **Переопределить**
   - Срок действия кэша: 2 дня

- Второе настраиваемое правило кэширования:
   - Условие соответствия: **Расширение**
   - Значение соответствия: _.html_.
   - Поведение кэширования: **Установить, если отсутствует**
   - Срок действия кэша: 3 дня

Когда эти правила заданы, запрос для _&lt; конечной точки hostname &gt;_. azureedge.net/Home/index.html активирует настраиваемое правило кэширования #2, для которого задано значение: **Set, если он отсутствует** , и 3 дня. Поэтому если в файле *index.html* есть заголовки HTTP `Cache-Control` или `Expires`, они учитываются. Если эти заголовки не заданы, файл кэшируется 3 дня.

> [!NOTE] 
> Файлы, которые сохраняются в кэше до изменения правила, поддерживают исходный параметр сроки кэширования. Чтобы сбросить продолжительность хранения в кэше, нужно [очистить файл](cdn-purge-endpoint.md). 
>
> Применение изменений конфигурации Azure CDN по сети может занять некоторое время. 
> - Для профилей **Azure CDN уровня "Стандартный" от Akamai** распространение обычно завершается в течение одной минуты. 
> - Для профилей **Azure CDN уровня "Стандартный" от Verizon** распространение обычно завершается в течение 10 минут.  
>

## <a name="see-also"></a>См. также раздел

- [Как выполняется кэширование](cdn-how-caching-works.md)
- [Руководство. Настройка правил кэширования Azure CDN](cdn-caching-rules-tutorial.md)