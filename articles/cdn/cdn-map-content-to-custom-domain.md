---
title: Руководство по добавлению личного домена к конечной точке
titleSuffix: Azure Content Delivery Network
description: В руководстве показано, как добавить личный домен к конечной точке сети доставки содержимого Azure, чтобы его доменное имя присутствовало в URL-адресе.
services: cdn
author: asudbring
manager: KumudD
ms.service: azure-cdn
ms.topic: tutorial
ms.date: 02/04/2020
ms.author: allensu
ms.custom: mvc
ms.openlocfilehash: 9bca81e7d0eb68d43c21065f5104fc423115be25
ms.sourcegitcommit: 73fb48074c4c91c3511d5bcdffd6e40854fb46e5
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/31/2021
ms.locfileid: "106065197"
---
# <a name="tutorial-add-a-custom-domain-to-your-endpoint"></a>Руководство по добавлению личного домена к конечной точке

Из этого руководства вы узнаете, как добавить личный домен к конечной точке сети доставки содержимого (CDN) Azure. 

Имя конечной точки в профиле CDN является поддоменом azureedge.net. По умолчанию при доставке содержимого домен профиля CDN добавляется в URL-адрес.

Например, **https://contoso.azureedge.net/photo.png** .

Azure CDN предоставляет возможность связать личный домен с конечной точкой CDN. Эта возможность позволяет доставлять содержимое с личным доменом в URL-адресе, а не доменом по умолчанию.

В этом руководстве описано следующее:
> [!div class="checklist"]
> - создание записи CNAME DNS;
> - связывание личного домена с конечной точкой CDN;
> - проверка личного домена.

[!INCLUDE [quickstarts-free-trial-note](../../includes/quickstarts-free-trial-note.md)]

## <a name="prerequisites"></a>Предварительные требования

* Прежде чем перейти к выполнению шагов из этого учебника, создайте профиль и как минимум одну конечную точку CDN. 
    * Дополнительные сведения см. в [кратком руководстве по созданию профиля и конечной точки Azure CDN](cdn-create-new-endpoint.md).

* Если у вас еще нет личного домена, нужно приобрести его у поставщика доменов. 
    * Дополнительные сведения см. в статье [Приобретение имени личного домена](../app-service/manage-custom-dns-buy-domain.md).

* Если вы используете Azure для размещения [доменов DNS](../dns/dns-overview.md), делегируйте личный домен в Azure DNS. 
    * Дополнительные сведения см. в статье [Делегирование домена в Azure DNS](../dns/dns-delegate-domain-azure-dns.md).

* При использовании поставщика доменов для обработки домена DNS перейдите в раздел [создания записей CNAME DNS](#create-a-cname-dns-record).


## <a name="create-a-cname-dns-record"></a>Создание записи CNAME DNS

Прежде чем использовать личный домен с конечной точкой Azure CDN, сначала необходимо создать запись канонического имени (CNAME) поставщика Azure DNS или DNS для указания конечной точки CDN. 

Запись CNAME — это запись DNS, которая позволяет сопоставить исходное имя домена с именем конечного домена. 

Для Azure CDN исходное доменное имя является именем вашего личного домена, а имя домена назначения представляет собой имя узла конечной точки CDN. 

После проверки записи CNAME Azure CDN направляет трафик, адресованный исходному личному домену, к указанному имени узла конечной точки CDN назначения.

Личный домен и его поддомен можно связать с одной конечной точкой за раз. 

Используйте несколько записей CNAME для разных поддоменов одного и того же личного домена для разных служб Azure.

Вы можете сопоставить личный домен с разными поддоменами с одной конечной точкой CDN.

> [!NOTE]
> При работе с этим учебником используется тип записи CNAME. Если вы используете записи типа A или AAAA, просто выполните шаги ниже и замените тип CNAME нужным вам типом записи.

---
# <a name="azure-dns"></a>[**Azure DNS**](#tab/azure-dns)

Azure DNS использует записи псевдонимов для ресурсов Azure в той же подписке.

Чтобы добавить запись псевдонима для конечной точки Azure CDN, выполните указанные ниже действия.

1. Войдите на [портале Azure](https://portal.azure.com).

2. В меню слева выберите **Все ресурсы**, а затем — зону Azure DNS для личного домена.

3. В зоне DNS для личного домена выберите **+ Набор записей**.

4. В разделе **Добавление набора записей** введите или выберите следующие сведения:

    | Параметр | Значение |
    | ------- | ----- |
    | Имя  | Введите псевдоним, который вы хотите использовать для конечной точки CDN. Например, **www**. |
    | Тип  | Выберите **CNAME**. |
    | Набор записей псевдонима | Выберите ответ **Да**. |
    | Тип псевдонима | Выберите **Ресурс Azure**. |
    | Выберите подписку. | Выберите свою подписку. |
    | Ресурс Azure | Выберите конечную точку Azure CDN. |

5. Задайте для параметра **Срок жизни** записи собственное значение.

6. Нажмите кнопку **ОК**.

# <a name="dns-provider"></a>[**Поставщик DNS**](#tab/dns-provider)

## <a name="map-the-temporary-cdnverify-subdomain"></a>Сопоставление промежуточного поддомена cdnverify

При сопоставлении имеющегося в рабочей среде домена стоит обратить внимание на следующее. 

При регистрации личного домена на портале Azure может возникнуть короткий период простоя домена.

Чтобы избежать прерывания веб-трафика, сопоставьте личный домен с именем узла конечной точки CDN с поддоменом Azure **cdnverify**. Этот процесс создает временное сопоставление CNAME. 

С помощью этого метода пользователи могут беспрепятственно получить доступ к вашему домену во время сопоставления DNS. 

Если проблема простоя рабочей среды отсутствует, вы можете напрямую сопоставить личный домен с конечной точкой CDN. Ознакомьтесь с разделом о [сопоставлении постоянного личного домена](#map-the-permanent-custom-domain).

Чтобы создать запись CNAME с поддоменом cdnverify, сделайте следующее.

1. Войдите на веб-сайт поставщика DNS для личного домена.

2. Создайте запись CNAME для своего личного домена и заполните поля, как показано в таблице ниже (имена полей могут отличаться):

    | Источник                    | Тип  | Назначение                     |
    |---------------------------|-------|---------------------------------|
    | cdnverify. www.contoso.com | CNAME | cdnverify.contoso.azureedge.net |

    - Источник: введите имя своего личного домена, включая поддомен cdnverify, в следующем формате: **cdnverify.\<custom-domain-name>**
        - Например, **cdnverify. www.contoso.com**.

    - Тип: Введите или выберите **CNAME**.

    - Назначение: введите имя узла конечной точки CDN, включая поддомен cdnverify, в следующем формате: **cdnverify.\<endpoint-name>.azureedge.net**. 
        - Например, **cdnverify.contoso.azureedge.net**.

3. Сохраните изменения.

## <a name="map-the-permanent-custom-domain"></a>Сопоставление постоянного личного домена

В этом разделе описано, как сопоставить постоянный личный домен с конечной точкой CDN. 

Чтобы создать запись CNAME для личного домена, сделайте следующее.

1. Войдите на веб-сайт поставщика своего личного домена.

2. Создайте запись CNAME для своего личного домена и заполните поля, как показано в таблице ниже (имена полей могут отличаться):

    | Источник          | Тип  | Назначение           |
    |-----------------|-------|-----------------------|
    | www.contoso.com | CNAME | contoso.azureedge.net |

    - Источник: введите имя личного домена.
        - Например, **www.contoso.com**.

    - Тип: Введите или выберите **CNAME**.

    - Назначение: введите имя узла конечной точки CDN в следующем формате: **\<endpoint-name>.azureedge.net**. 
        - Например, **contoso.azureedge.net**.

3. Сохраните изменения.

4. Если вы ранее создали временную запись CNAME поддомена cdnverify, удалите ее. 

5. Если вы используете этот личный домен в рабочей среде впервые, выполните действия для [связывания личного домена с конечной точкой CDN](#associate-the-custom-domain-with-your-cdn-endpoint) и [проверки этого личного домена](#verify-the-custom-domain).

---
## <a name="associate-the-custom-domain-with-your-cdn-endpoint"></a>Связывание личного домена с конечной точкой CDN

После регистрации личного домена его можно добавить в конечную точку CDN. 


---
# <a name="azure-portal"></a>[**Портал Azure**](#tab/azure-portal)

1. Войдите на [портал Azure](https://portal.azure.com/) и перейдите в профиль CDN, содержащий конечную точку, которую нужно сопоставить с личным доменом.
    
2. На странице **профиля CDN** выберите конечную точку CDN, чтобы связать ее с личным доменом.

    :::image type="content" source="media/cdn-map-content-to-custom-domain/cdn-endpoint-selection.png" alt-text="Выбор конечной точки CDN" border="true":::
    
3. Выберите **+ Личный домен**. 

   :::image type="content" source="media/cdn-map-content-to-custom-domain/cdn-custom-domain-button.png" alt-text="Кнопка добавления личного домена" border="true":::

4. В разделе **Добавить личный домен** значение для параметра **Имя узла конечной точки** заполняется автоматически и выводится из URL-адреса конечной точки CDN: **\<endpoint-hostname>** .azureedge.net. Их невозможно изменить.

5. Для параметра **Пользовательское имя узла** укажите личный домен (включая дочерний домен), который будет использоваться в качестве исходного домена записи CNAME. 
    1. Например, **www.contoso.com** или **cdn.contoso.com**. **Не используйте имя поддомена cdnverify**.

    :::image type="content" source="media/cdn-map-content-to-custom-domain/cdn-add-custom-domain.png" alt-text="Добавление личного домена" border="true":::

6. Выберите **Добавить**.

   Azure проверит наличие записи CNAME для введенного имени личного домена. Если запись CNAME правильна, пользовательский домен пройдет проверку. 

   Для применения новых параметров личного домена на всех граничных узлах CDN может потребоваться некоторое время: 
    - Для профилей **Azure CDN категории "Стандартный" от Майкрософт** распространение обычно выполняется в течение 10 минут. 
    - Для профилей **Azure CDN уровня "Стандартный" от Akamai** распространение обычно завершается в течение одной минуты. 
    - Для профилей **Azure CDN уровня "Стандартный" от Verizon** и **Azure CDN уровня "Премиум" от Verizon** распространение обычно выполняется в течение 10 минут.   

# <a name="powershell"></a>[**PowerShell**](#tab/azure-powershell)

1. Войдите в Azure PowerShell.

```azurepowershell-interactive
    Connect-AzAccount

```
2. С помощью [New-AzCdnCustomDomain](/powershell/module/az.cdn/new-azcdncustomdomain) сопоставьте личный домен с конечной точкой CDN. 

    * Вместо **myendpoint8675.azureedge.net** укажите URL-адрес своей конечной точки.
    * Замените **myendpoint8675** именем конечной точки CDN.
    * Вместо **www.contoso.com** укажите имя личного домена.
    * Замените **myCDN** именем профиля CDN.
    * Замените **myResourceGroupCDN** именем группы ресурсов.

```azurepowershell-interactive
    $parameters = @{
        Hostname = 'myendpoint8675.azureedge.net'
        EndPointName = 'myendpoint8675'
        CustomDomainName = 'www.contoso.com'
        ProfileName = 'myCDN'
        ResourceGroupName = 'myResourceGroupCDN'
    }
    New-AzCdnCustomDomain @parameters
```

Azure проверит наличие записи CNAME для введенного имени личного домена. Если запись CNAME правильна, пользовательский домен пройдет проверку. 

   Для применения новых параметров личного домена на всех граничных узлах CDN может потребоваться некоторое время: 

- Для профилей **Azure CDN категории "Стандартный" от Майкрософт** распространение обычно выполняется в течение 10 минут. 
- Для профилей **Azure CDN уровня "Стандартный" от Akamai** распространение обычно завершается в течение одной минуты. 
- Для профилей **Azure CDN уровня "Стандартный" от Verizon** и **Azure CDN уровня "Премиум" от Verizon** распространение обычно выполняется в течение 10 минут.   


---
## <a name="verify-the-custom-domain"></a>Проверка личного домена.

После завершения регистрации личного домена убедитесь, что он ссылается на конечную точку CDN.
 
1. Убедитесь, что общедоступное содержимое кэшируется в конечной точке. Например, если конечная точка CDN связана с учетной записью хранения, Azure CDN кэширует содержимое в общедоступном контейнере. Чтобы проверить личный домен, убедитесь, что контейнер допускает открытый доступ и содержит не менее одного файла.

2. В браузере перейдите по адресу файла с помощью личного домена. Например, если ваш личный домен — `www.contoso.com`, URL-адрес кэшированного большого файла должен быть аналогичен следующему URL-адресу: `http://www.contoso.com/my-public-container/my-file.jpg`. Убедитесь, что результат такой же, как и при доступе непосредственно к конечной точке CDN **\<endpoint-hostname>** .azureedge.net.

## <a name="clean-up-resources"></a>Очистка ресурсов

---
# <a name="azure-portal"></a>[**Портал Azure**](#tab/azure-portal-cleanup)

Если вы больше не хотите связывать свою конечную точку с личным доменом, этот домен можно удалить, выполнив указанные ниже действия.
 
1. В профиле CDN выберите конечную точку с личным доменом, который нужно удалить.

2. На странице **Конечная точка** в разделе личных доменов щелкните личный домен, который нужно удалить, правой кнопкой мыши, а затем в контекстном меню выберите **Удалить**. Выберите ответ **Да**.

   Личный домен отсоединится от конечной точки.

# <a name="powershell"></a>[**PowerShell**](#tab/azure-powershell-cleanup)

Если вы больше не хотите связывать свою конечную точку с личным доменом, этот домен можно удалить, выполнив указанные ниже действия.

1. Чтобы удалить личный домен из конечной точки, используйте [Remove-AzCdnCustomDomain](/powershell/module/az.cdn/remove-azcdncustomdomain):

    * Замените **myendpoint8675** именем конечной точки CDN.
    * Вместо **www.contoso.com** укажите имя личного домена.
    * Замените **myCDN** именем профиля CDN.
    * Замените **myResourceGroupCDN** именем группы ресурсов.


```azurepowershell-interactive
    $parameters = @{
        CustomDomainName = 'www.contoso.com'
        EndPointName = 'myendpoint8675'
        ProfileName = 'myCDN'
        ResourceGroupName = 'myResourceGroupCDN'
    }
    Remove-AzCdnCustomDomain @parameters
```

---
## <a name="next-steps"></a>Следующие шаги

В этом руководстве вы узнали, как выполнять следующие задачи:

> [!div class="checklist"]
> - создание записи CNAME DNS;
> - связывание личного домена с конечной точкой CDN;
> - проверка личного домена.

Перейдите к следующему руководству, чтобы научиться настраивать протокол HTTPS в личном домене Azure CDN.

> [!div class="nextstepaction"]
> [Руководство. по настройке протокола HTTPS для личного домена в сети доставки содержимого Azure](cdn-custom-ssl.md)