---
title: Отработка отказа между несколькими конечными точками с помощью диспетчера трафика
titleSuffix: Azure Content Delivery Network
description: Узнайте, как настроить отработку отказа в нескольких конечных точках сети доставки содержимого Azure с помощью диспетчера трафика Azure.
services: cdn
author: asudbring
ms.service: azure-cdn
ms.topic: how-to
ms.date: 10/08/2020
ms.author: allensu
ms.custom: ''
ms.openlocfilehash: d2d3bd43a0f17167e855d7e678a96cd79fe42237
ms.sourcegitcommit: 910a1a38711966cb171050db245fc3b22abc8c5f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "92777747"
---
# <a name="failover-across-multiple-endpoints-with-azure-traffic-manager"></a>Отработка отказа между несколькими конечными точками с помощью диспетчера трафика Azure

В ходе настройки сети доставки содержимого Azure (Azure CDN) есть возможность выбора оптимального поставщика и ценовой категории, в соответствии с вашими потребностями. 

Azure CDN имеет глобально распределенную инфраструктуру, что позволяет по умолчанию создавать локальную и географическую избыточность и глобальную балансировку нагрузки с целью повышения доступности и производительности служб. 

Если расположение недоступно для обслуживания содержимого, запросы автоматически перенаправляются в другое расположение. Для обслуживания каждого клиентского запроса используется оптимальная точка присутствия (POP). Автоматическая маршрутизация зависит от факторов в качестве расположения запроса и нагрузки на сервер.
 
Наличие нескольких профилей CDN создает возможность дальнейшего улучшения доступности и производительности с помощью диспетчера трафика Azure. 

Используйте диспетчер трафика Azure с Azure CDN для балансировки нагрузки между несколькими конечными точками CDN для:
 
* Отработка отказа
* Географическая балансировка нагрузки 

В типичном сценарии отработки отказа все клиентские запросы направляются в основной профиль CDN. 

Если профиль недоступен, запросы направляются в дополнительный профиль.  Запросы возобновляются до основного профиля, когда он снова возвращается в сеть.

В этом случае использование диспетчера трафика Azure позволяет гарантировать постоянную доступность вашего веб-приложения. 

В этой статье приводятся рекомендации и пример настройки отработки отказа с профилями из: 

* **Azure CDN уровня "Стандартный" от Verizon**;
* **Azure CDN уровня "Стандартный" от Akamai**;

Также поддерживается **Azure CDN от Майкрософт** .

## <a name="create-azure-cdn-profiles"></a>Создание профилей Azure CDN
Создайте два или более профиля и конечных точек Azure CDN через разных поставщиков.

1. Создайте два профиля CDN:
    * **Azure CDN уровня "Стандартный" от Verizon**;
    * **Azure CDN уровня "Стандартный" от Akamai**; 

    Создайте профили, выполнив действия, описанные в разделе [Создание нового профиля CDN](cdn-create-new-endpoint.md#create-a-new-cdn-profile).
 
   ![Несколько профилей CDN](./media/cdn-traffic-manager/cdn-multiple-profiles.png)

2. В каждом профиле создайте по крайней мере одну конечную точку, следуя пошаговому руководству в разделе [Создание конечной точки CDN](cdn-create-new-endpoint.md#create-a-new-cdn-endpoint).

## <a name="create-traffic-manager-profile"></a>Создание профиля диспетчера трафика
Создайте профиль диспетчера трафика Azure и настройте балансировку нагрузки для конечных точек CDN. 

1. Создайте профиль диспетчера трафика Azure, следуя пошаговому руководству в разделе [Создание профиля диспетчера трафика Azure](../traffic-manager/quickstart-create-traffic-manager-profile.md). 

    * **Метод маршрутизации** выберите **приоритет**.

2. Добавьте в профиль диспетчера трафика конечные точки CDN, следуя пошаговому руководству в разделе [Добавление конечных точек диспетчера трафика Azure](../traffic-manager/quickstart-create-traffic-manager-profile.md#add-traffic-manager-endpoints)

    * **Введите**, выберите **Внешние конечные точки**.
    * **Приоритет** введите число.

    Например, создайте конечные точки **cdndemo101akamai.azureedge.net** с приоритетом **1** и **cdndemo101verizon.azureedge.net** с приоритетом **2**.

   ![Добавление конечных точек диспетчера трафика Azure](./media/cdn-traffic-manager/cdn-traffic-manager-endpoints.png)


## <a name="configure-custom-domain-on-azure-cdn-and-azure-traffic-manager"></a>Настройка личного домена на Azure CDN и диспетчере трафика Azure
После настройки профилей CDN и диспетчера трафика выполните следующие действия, чтобы добавить сопоставление DNS и зарегистрировать личный домен в конечных точках CDN. В данном примере имя пользовательского домена **cdndemo101.dustydogpetcare.online**.

1. Перейдите на веб-сайт поставщика домена для своего пользовательского домена, например GoDaddy, и создайте две записи DNS CNAME. 

    а. Для первой записи CNAME подключите к конечной точке CDN пользовательский домен с поддоменом cdnverify. Эта запись нужна для регистрации пользовательского домена в конечной точке CDN, которая была добавлена в диспетчер трафика Azure в шаге 2.

      Пример. 

      `cdnverify.cdndemo101.dustydogpetcare.online  CNAME  cdnverify.cdndemo101akamai.azureedge.net`  

    b. Для второй записи CNAME подключите к конечной точке CDN пользовательский домен без поддомена cdnverify. Эта запись подключает пользовательский домен к диспетчеру трафика Azure. 

      Пример: 
      
      `cdndemo101.dustydogpetcare.online  CNAME  cdndemo101.trafficmanager.net`   

    > [!NOTE]
    > Если соединение с доменом активно и не может быть прервано, выполните этот шаг в последнюю очередь. Убедитесь, что конечные точки CDN и домены диспетчера трафика Azure активны, прежде чем обновить пользовательский домен DNS в диспетчере трафика Azure.
    >


2.  В своем профиле Azure CDN выберите первую конечную точку CDN (Akamai). Выберите **Добавить личный домен** и введите **cdndemo101.dustydogpetcare.Online**. Убедитесь, что флажок, подтверждающий допустимость пользовательского домена, отображается зеленым цветом. 

    Для завершения процесса регистрации Azure CDN использует поддомен **cdnverify** с целью проверки сопоставления DNS. Дополнительные сведения см. в разделе [Создание записи CNAME DNS](cdn-map-content-to-custom-domain.md#create-a-cname-dns-record). Этот шаг позволяет Azure CDN распознавать пользовательский домен, чтобы отвечать на его запросы.
    
    > [!NOTE]
    > Чтобы включить TLS для **Azure CDN из профилей Akamai** , необходимо напрямую зарегистрировать личный домен в конечной точке. cdnverify для включения TLS еще не поддерживается. 
    >

3.  Вернитесь на веб-сайт поставщика домена вашего личного домена. Обновите Первое созданное сопоставление DNS. Сопоставьте личный домен со второй конечной точкой CDN.
                             
    Пример: 

    `cdnverify.cdndemo101.dustydogpetcare.online  CNAME  cdnverify.cdndemo101verizon.azureedge.net`  

4. В своем профиле Azure CDN выберите вторую конечную точку CDN (Verizon) и повторите шаг 2. Выберите **Добавить личный домен** и введите **cdndemo101.dustydogpetcare.Online**.
 
После выполнения этих действий служба поддержки нескольких CDN с возможностью отработки отказа будет настроена с помощью диспетчера трафика Azure. 

Вы можете получить доступ к тестовым URL-адресам из личного домена. 

Чтобы проверить функции, отключите основную конечную точку CDN и убедитесь, что запрос правильно перенесен на вспомогательную конечную точку CDN. 

## <a name="next-steps"></a>Дальнейшие действия
Можно настроить другие методы маршрутизации, такие как географические, для балансировки нагрузки между разными конечными точками CDN. 

Дополнительные сведения см. в разделе [Настройка метода маршрутизации трафика по географическому расположению с помощью диспетчера трафика Azure](../traffic-manager/traffic-manager-configure-geographic-routing-method.md).