---
title: Учебник по созданию приложения аналитики в магазине в Azure IoT Central
description: В этом учебнике показано, как создать приложение для розничной торговли в магазине в IoT Central. Вы создадите его, настроите и добавите устройства-датчики.
services: iot-central
ms.service: iot-central
ms.subservice: iot-central-retail
ms.topic: tutorial
ms.custom:
- iot-storeAnalytics-checkout
- iot-p0-scenario
ms.author: timlt
author: timlt
ms.date: 11/12/2019
ms.openlocfilehash: fc8928c9f64e323aafb29c9b1e717cc5c2ab6691
ms.sourcegitcommit: fa807e40d729bf066b9b81c76a0e8c5b1c03b536
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/11/2020
ms.locfileid: "97346713"
---
# <a name="tutorial-create-an-in-store-analytics-application-in-azure-iot-central"></a>Руководство по Создание приложения аналитики в магазине в Azure IoT Central



В этом руководстве показаны построители решений; с их помощью мы создадим в Azure IoT Central приложение аналитики в магазине. Пример приложения предназначен для розничного магазина. Это решение для распространенной бизнес-потребности — нужды вести отслеживание и адаптироваться в соответствии с условиями заполнения магазина и окружения в нем.

Создаваемый пример приложения включает три реальных устройства: шлюз Rigado Cascade 500 и два датчика RuuviTag. В этом учебнике также показано, как использовать датчик заполнения, входящий в шаблон приложения, для тестирования. Шлюз Rigado C500 выступает в качестве центра обмена данными в приложении. Он взаимодействует с датчиками на складе и управляет подключениями к облаку. RuuviTag — это датчик окружающей среды, предоставляющий данные телеметрии, в том числе температуру, влажность и давление. Датчик заполнения позволяет контролировать движение и присутствие покупателей в зоне оформления заказов магазина. 

В этом учебнике содержатся указания по подключению Rigado и RuuviTag к приложению. В случае наличия другого шлюза и датчиков вы по-прежнему можете выполнить те же действия для создания приложения. В этом учебнике также показано, как создать имитацию датчиков RuuviTag. Имитированные датчики позволяют создавать приложения, если у вас нет реальных устройств. 

Решение для отслеживания оформления заказов и условий среды разрабатывается в три этапа.

* Создание приложения и подключение устройств для отслеживания условий.
* Настройка панели мониторинга, позволяющая операторам наблюдать за устройствами и управлять ими.
* Настройка экспорта данных, позволяющая менеджерам магазина запускать аналитику и визуализировать аналитические данные.

В этом руководстве описано следующее:
> [!div class="checklist"]
> * Создание приложения розничного магазина с помощью шаблона **Аналитика в магазине — оформление заказов** Azure IoT Central
> * Настройка параметров приложения
> * Создание и настройка шаблонов устройств IoT
> * Подключение устройств к приложению
> * Добавление правил и действий для отслеживания условий

## <a name="prerequisites"></a>Предварительные требования

Для работы с этой серией учебников вам потребуется следующее:
* подписка Azure (рекомендуется). При необходимости можно использовать бесплатную пробную версию в течение семи дней. Если у вас еще нет подписки, создайте ее на [странице регистрации в Azure](https://aka.ms/createazuresubscription);
* доступ к устройству шлюза и двум датчикам окружающей среды (при необходимости можно использовать имитированные устройства, как описано в руководстве);
* шаблоны устройств для используемых устройств (шаблоны предоставляются для всех устройств, используемых в этом руководстве).

## <a name="create-an-application"></a>Создание приложения
В этом разделе вы создадите новое приложение Azure IoT Central на основе шаблона. Это приложение будет использоваться на всем протяжении серии учебников для создания полного решения.

Чтобы создать приложение Azure IoT Central, сделайте следующее:

1. Перейдите на веб-сайт [диспетчера приложений в Azure IoT Central](https://aka.ms/iotcentral).

1. Если у вас есть подписка Azure, выполните вход с учетными данными для доступа к ней. Если ее нет, используйте учетную запись Майкрософт:

    ![Ввод учетной записи организации](./media/tutorial-in-store-analytics-create-app/sign-in.png)

1. Чтобы начать создание приложения Azure IoT Central, выберите **Новое приложение**.

1. Выберите **Розничная торговля**.  На странице "Розничная торговля" отображается несколько шаблонов розничных приложений.

Чтобы создать приложение аналитики в магазине для оформления заказов:  

1. Выберите шаблон приложения **Аналитика в магазине — оформление заказов**. Этот шаблон включает шаблоны устройств для всех устройств, используемых в руководстве, за исключением датчиков RuuviTag. Шаблон также предоставляет операторам панель мониторинга для наблюдения за оформлением заказов, условиями среды и состоянием устройств. 

1. Выберите **понятное имя** для приложения. Это приложение основано на вымышленном розничном магазине с именем Contoso. В этом руководстве используется **имя приложения** *Contoso checkout*. Шаблон приложения основан на вымышленной компании Northwind. В этом руководстве вы узнаете, как настроить приложение для Contoso.

    > [!NOTE]
    > Если вы используете понятное **имя приложения**, все равно необходимо использовать уникальное значение для **URL-адреса** приложения.

1. Если у вас есть подписка Azure, укажите *каталог, подписку Azure и регион*. Если у вас нет подписки, вы можете включить **семидневную бесплатную пробную версию** и указать необходимые контактные данные.  

    Дополнительные сведения о каталогах и подписках см. в статье [Создание приложения Azure IoT Central](../core/quick-deploy-iot-central.md).

1. Нажмите кнопку **создания**.

    ![Страница создания приложения Azure IoT Central](./media/tutorial-in-store-analytics-create-app/preview-application-template.png)

    ![Сведения о выставлении счетов при создании приложения Azure IoT Central](./media/tutorial-in-store-analytics-create-app/preview-application-template-billinginfo.png)

## <a name="customize-application-settings"></a>Настройка параметров приложения

Создатель приложения может изменить несколько параметров, чтобы настроить взаимодействие с пользователем в приложении. В этом разделе вы выберете предопределенную тему приложения. При необходимости вы сможете создать пользовательскую тему и обновить изображение для приложения. Пользовательская тема позволяет задать цвета браузера приложения, значок браузера и эмблему приложения, которая отображается в заголовке.

Чтобы выбрать предопределенную тему приложения, выполните следующие действия.

1. В заголовке щелкните **Параметры**.

    ![Параметры приложения Azure IoT Central](./media/tutorial-in-store-analytics-create-app/settings-icon.png)

2. Выберите новую **тему**.

3. Щелкните **Сохранить**.

Вместо использования предопределенной темы можно создать собственную тему. Если вы хотите использовать примеры изображений для настройки приложения и завершения этого руководства, скачайте [примеры изображений](https://github.com/Azure-Samples/iot-central-docs-samples/tree/master/retail) Contoso.

Чтобы создать настраиваемую тему, используйте следующую процедуру.

1. Разверните панель слева, если она еще не развернута.

    ![Левая панель Azure IoT Central](./media/tutorial-in-store-analytics-create-app/dashboard-expand.png)

1. Выберите **Администрирование > Настройка приложения**.

1. Используйте кнопку **Изменить**, чтобы выбрать изображение для отправки в качестве **логотипа приложения**. При необходимости укажите **альтернативный текст логотипа**. 

1. Используйте кнопку **Изменить**, чтобы выбрать изображение как **значок браузера**, который будет отображаться на вкладках браузера.

1. При необходимости замените цвета **браузера по умолчанию**, добавив шестнадцатеричные коды цветов HTML. Для **заголовка** добавьте *#008575*.  Для **цвета элементов** добавьте *#A1F3EA*. 

1. Щелкните **Сохранить**. 

    ![Настроенный логотип Azure IoT Central](./media/tutorial-in-store-analytics-create-app/select-application-logo.png)

    После сохранения приложение обновляет цвета браузера, логотип в заголовке и значок браузера. 

    ![Обновленные параметры приложения Azure IoT Central](./media/tutorial-in-store-analytics-create-app/saved-application-settings.png)

Чтобы обновить изображение для приложения, выполните следующие действия.

1. Выберите **Администрирование > Параметры приложения**.

1. Используйте кнопку **Выбрать изображение**, чтобы выбрать изображение для отправки в качестве логотипа приложения. Это изображение отображается на плитке приложения на странице **Мои приложения** диспетчера приложений IoT Central.

1. Щелкните **Сохранить**.

1. При необходимости перейдите в представление **Мои приложения** на [веб-сайте диспетчера приложений в Azure IoT Central](https://aka.ms/iotcentral). На плитке приложения отображается обновленное изображение приложения.

    ![Настроенное изображение приложения в Azure IoT Central](./media/tutorial-in-store-analytics-create-app/customize-application-image.png)

## <a name="create-device-templates"></a>Создание шаблонов устройств
Создатель приложения может создавать шаблоны устройств, позволяющие ему и операторам приложений настраивать устройства и управлять ими. Шаблон формируется путем создания пользовательского шаблона, импорта существующего файла шаблона или импорта шаблона из каталога устройств Azure IoT. После создания и настройки шаблона устройства используйте его для подключения реальных устройств к приложению. При необходимости используйте шаблон устройства для создания имитированных устройств для тестирования.

В шаблоне приложения **Аналитика в магазине — оформление заказов** есть шаблоны устройств для нескольких устройств.  Существуют шаблоны устройств для двух из трех устройств, используемых в приложении. Шаблон устройства RuuviTag не входит в шаблон приложения **Аналитика в магазине — оформление заказов**. В этом разделе вы добавите шаблон устройства для датчиков RuuviTag в приложение.

Чтобы добавить шаблон устройства RuuviTag в приложение, выполните следующие действия.

1. В левой панели выберите **Шаблоны устройств**.

1. Выберите **+ Создать**, чтобы создать шаблон устройства.

1. Найдите и выберите шаблон устройства-датчика **RuuviTag** в каталоге устройств Azure IoT. 

1. По завершении выберите **Next: Настройка**.

    ![Снимок экрана, на котором выделена кнопка "Next: Customize" (Далее: настройка).](./media/tutorial-in-store-analytics-create-app/ruuvitag-device-template.png)

1. Нажмите кнопку **создания**. Приложение добавляет шаблон устройства RuuviTag.

1. В левой панели выберите **Шаблоны устройств**. На странице отображаются все шаблоны устройств, включенные в шаблон приложения, и только что добавленный шаблон устройства RuuviTag.

    ![Шаблон устройства-датчика RuuviTag в Azure IoT Central](./media/tutorial-in-store-analytics-create-app/device-templates-list.png)

## <a name="customize-device-templates"></a>Настройка шаблонов устройств
Вы можете настроить шаблоны устройств в приложении тремя способами. Во-первых, можно настроить собственные встроенные интерфейсы на устройствах, изменяя возможности устройства. Например, в случае датчика температуры можно изменить такие сведения, как отображаемое имя интерфейса температуры, тип данных, единицы измерения, а также минимальный и максимальный пределы рабочего диапазона. 

Во-вторых, можно настроить шаблоны устройств, добавив свойства облака. Они не являются частью встроенных возможностей устройства. Свойства облака — это пользовательские данные, которые приложение Azure IoT Central создает, хранит и связывает с вашими устройствами. Примером такого свойства может быть вычисляемое значение или метаданные, такие как расположение, которое необходимо связать с набором устройств. 

В-третьих, можно настраивать шаблоны устройств, создавая пользовательские представления. Они позволяют операторам визуализировать данные телеметрии и метаданные устройств, такие как метрики и работоспособность устройств.

Здесь мы используем два первых способа настроить шаблон устройства для датчиков RuuviTag. Сведения о создании представлений для датчиков см. в кратком руководстве [Добавление имитированного устройства в приложение IoT Central](../core/quick-create-simulated-device.md).

Чтобы настроить встроенные интерфейсы шаблона устройства RuuviTag, выполните следующие действия.

1. В левой панели выберите **Шаблоны устройств**. 

1. Выберите шаблон для датчиков RuuviTag. 

1. Скройте левую панель. В представлении "Сводка" шаблона отображаются возможности устройства.

    ![Сводка шаблона устройства RuuviTag в Azure IoT Central](./media/tutorial-in-store-analytics-create-app/ruuvitag-device-summary-view.png)

1. Выберите **Настроить** в меню шаблона устройства RuuviTag. 

1. Прокрутите список возможностей и найдите тип телеметрии `humidity`. Это элемент строки с редактируемым **отображаемым именем** *humidity*.

На следующих шагах мы настроим тип телеметрии `humidity` для датчиков RuuviTag. При необходимости можно настроить некоторые другие типы телеметрии.

Для типа телеметрии `humidity` внесите следующие изменения.

1. Выберите элемент управления **Развернуть**, чтобы развернуть сведения о схеме для строки.

1. Смените **Отображаемое имя** с *humidity* на пользовательское значение, например *Относительная влажность*.

1. Измените значение параметра **Семантический тип** с *Нет* на *Влажность*.  При необходимости задайте значения схемы для типа телеметрии "Влажность" в расширенном представлении схемы. Параметры схемы позволяют создавать подробные требования для проверки данных, отслеживаемых вашими датчиками. Например, можно задать минимальное и максимальное значения рабочего диапазона для заданного интерфейса.

1. Выберите **Сохранить**, чтобы сохранить изменения.

    ![Снимок экрана настройки, где выделена кнопка "Сохранить".](./media/tutorial-in-store-analytics-create-app/ruuvitag-device-template-customize.png)

Чтобы добавить свойство облака в шаблон устройства в приложении, выполните следующие действия.

1. Выберите **Свойства облака** в меню шаблона устройства RuuviTag.

1. Выберите команду **Добавить облачное свойство**. 

Укажите следующие значения, чтобы создать пользовательское свойство для хранения расположения каждого устройства.

1. Введите значение *Расположение* в поле **Отображаемое имя**. Это значение автоматически копируется в поле **Имя**, которое является понятным именем свойства. Можно использовать скопированное значение или изменить его.

1. Выберите *Строка* в раскрывающемся списке **Схема**. Строковый тип позволяет связать строку имени расположения с любым устройством, основанным на шаблоне. Например, можно связать область на складе с каждым устройством. При необходимости можно задать **Семантический тип** свойства как *Расположение*, и это автоматически задаст **схему** как *географическую*. Это позволяет связывать координаты GPS с устройством. 

1. Задайте **минимальную длину** как *2*. 

1. Задайте для параметра **Обрезать пробел** значение **Вкл**.

1. Выберите команду **Сохранить**, чтобы сохранить настраиваемое свойство облака.

    ![Настройка шаблона устройства RuuviTag в Azure IoT Central](./media/tutorial-in-store-analytics-create-app/ruuvitag-device-template-cloud-property.png)

1. Нажмите кнопку **Опубликовать**. 

    Публикация шаблона устройства делает его видимым для операторов приложения. После публикации шаблона используйте его при создании имитированных устройств для тестирования или подключения реальных устройств к приложению. Если у вас уже есть устройства, подключенные к приложению, публикация настроенного шаблона принудительно публикует изменения на устройствах.

## <a name="add-devices"></a>Добавление устройств
После создания и настройки шаблонов устройств пора добавить устройства. 

В этом учебнике для сборки приложения используется следующий набор реальных и имитированных устройств:
- настоящий шлюз Rigado C500;
- два настоящих датчика RuuviTag;
- имитированный датчик **заполнения**. Имитированный датчик включен в шаблон приложения, поэтому его не нужно создавать. 

> [!NOTE]
> Если у вас нет реальных устройств, вы все же сможете продолжить работу с этим руководством, создав имитированные датчики RuuviTag. Ниже приведены инструкции по созданию имитации RuuviTag. Вам не требуется создавать имитированный шлюз.

Выполните действия, описанные в следующих двух статьях, чтобы подключить настоящие шлюз Rigado и датчики RuuviTag. Закончив, вернитесь к этому руководству. Так как вы уже создали шаблоны устройств в рамках этого руководства, их не нужно создавать повторно в следующем наборе инструкций.

- Сведения о подключении шлюза Rigado см. в статье [Подключение Rigado Cascade 500 к приложению Azure IoT Central](../core/howto-connect-rigado-cascade-500.md?toc=/azure/iot-central/retail/toc.json&bc=/azure/iot-central/retail/breadcrumb/toc.json).
- Сведения о подключении датчиков RuuviTag см. в статье [Подключение RuuviTag к приложению Azure IoT Central](../core/howto-connect-ruuvi.md?toc=/azure/iot-central/retail/toc.json&bc=/azure/iot-central/retail/breadcrumb/toc.json). Эти инструкции также можно использовать для создания двух имитированных датчиков, если это необходимо.

## <a name="add-rules-and-actions"></a>Добавление правил и действий
В рамках использования датчиков в приложении Azure IoT Central для мониторинга условий можно создать правила для запуска действий при выполнении определенных условий. Правило связывается с шаблоном устройства и одним устройством или несколькими, а также содержит условия, которые должны быть выполнены на основе данных телеметрии или событий устройства. Правило также имеет одно связанное действие или несколько. Действия могут включать отправку уведомлений по электронной почте или активацию действия веб-перехватчика для отправки данных в другие службы. Шаблон приложения **Аналитика в магазине — оформление заказов** содержит ряд предопределенных правил для устройств в приложении.

В этом разделе мы создадим новое правило, которое проверяет максимальный уровень влажности на основе данных телеметрии с датчика RuuviTag. Мы добавим к правилу действие, чтобы при превышении максимального значения влажности приложение отправляло сообщение электронной почты. 

Чтобы создать правило, выполните следующие действия. 

1. Разверните левую панель.

1. Щелкните **Правила**.

1. Выберите **+ Создать**.

1. Введите *Уровень влажности* в качестве имени правила. 

1. Выберите шаблон устройства RuuviTag в разделе **Области**. Определяемое правило будет применяться ко всем датчикам, основанным на этом шаблоне. При необходимости можно создать фильтр, который будет применять правило только к определенному подмножеству датчиков. 

1. Выберите `Relative humidity` в качестве **телеметрии**. Это возможность устройства, настроенная на предыдущем шаге.

1. Выберите `Is greater than` как **оператор**. 

1. Введите типичный верхний уровень влажности для вашей среды в качестве **значения**. Например, введите *65*. Вы установили условие для правила, которое срабатывает, когда относительная влажность на любом датчике RuuviTag (настоящем или имитированном) превышает это значение. Может потребоваться изменить значение в зависимости от нормального диапазона влажности в вашей среде.  

   ![Добавление условий правила в Azure IoT Central](./media/tutorial-in-store-analytics-create-app/rules-add-conditions.png)

Чтобы добавить действие к правилу, выполните следующие действия.

1. Нажмите **+ Электронная почта**. 

1. Укажите *Уведомления о высокой влажности* в качестве понятного **отображаемого имени** для действия. 

1. Введите адрес электронной почты, связанный с вашей учетной записью, в поле **Кому**. Если вы укажете другой адрес электронной почты, он должен принадлежать пользователю, который был добавлен в приложение. Пользователю также необходимо выполнить вход и выход по меньшей мере единожды.

1. При необходимости введите заметку, которая будет включена в текст сообщения электронной почты.

1. Нажмите кнопку **Готово**, чтобы завершить создание действия.

   ![Добавление действий в правила в Azure IoT Central](./media/tutorial-in-store-analytics-create-app/rules-add-action.png)

1. Выберите **Сохранить**, чтобы сохранить и активировать новое правило. 

    В течение нескольких минут указанная учетная запись электронной почты должна начать получать электронные сообщения. Приложение отправляет сообщение электронной почты каждый раз, когда датчик указывает, что уровень влажности превысил значение, заданное в вашем условии.

## <a name="next-steps"></a>Дальнейшие действия
В этом руководстве вы узнали, как выполнять следующие задачи:

* Создание приложения розничного магазина с помощью шаблона **Аналитика в магазине — оформление заказов** Azure IoT Central
* Настройка параметров приложения
* Создание и настройка шаблонов устройств IoT
* Подключение устройств к приложению
* Добавление правил и действий для отслеживания условий

Итак, вы создали приложение для мониторинга условий в Azure IoT Central и можете перейти к следующему этапу:

> [!div class="nextstepaction"]
> [Настройка панели мониторинга оператора](./tutorial-in-store-analytics-customize-dashboard.md)
