---
title: Руководство. Создание панели мониторинга для анализа данных о здоровье в Azure IoT Central | Документация Майкрософт
description: Руководство. Сведения о создании панели мониторинга для анализа данных о здоровье с помощью шаблонов приложений Azure IoT Central.
author: philmea
ms.author: philmea
ms.date: 12/11/2020
ms.topic: tutorial
ms.service: iot-central
services: iot-central
manager: eliotgra
ms.openlocfilehash: d227d934eedd31342ce419576fffe7cea17efb1d
ms.sourcegitcommit: c27a20b278f2ac758447418ea4c8c61e27927d6a
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/03/2021
ms.locfileid: "101742915"
---
# <a name="tutorial-build-a-power-bi-provider-dashboard"></a>Руководство. Создание панели мониторинга для поставщика Power BI

При создании решения для непрерывного мониторинга состояния пациентов можно также создать для сотрудников больницы панель мониторинга с визуализацией данных о пациентах. Из этого руководства вы узнаете, как создать панель мониторинга Power BI для данных, передаваемых в реальном времени на основе шаблона приложения IoT Central для непрерывного мониторинга состояния пациентов. Если в вашем варианте использования не требуется доступ к данным в реальном времени, можете использовать [панель мониторинга Power BI для IoT Central ](../core/howto-connect-powerbi.md), на которой показан упрощенный процесс развертывания. 

:::image type="content" source="media/dashboard-gif-3.gif" alt-text="Изображение панели мониторинга":::

Базовая архитектура соответствует такой схеме:

:::image type="content" source="media/dashboard-architecture.png" alt-text="Панель мониторинга для поставщика":::

В этом руководстве описано следующее:

> [!div class="checklist"]
> * экспорт данных из Azure IoT Central в Центры событий Azure;
> * настройка набора данных для потоковой передачи в Power BI;
> * Подключение приложения логики к Центрам событий Azure
> * Потоковая передача данных в Power BI из приложения логики
> * создание панели мониторинга для получения данных о жизненно важных показателях пациента в реальном времени.


## <a name="prerequisites"></a>Предварительные требования

* Подписка Azure. Если у вас еще нет подписки Azure, [зарегистрируйтесь для получения бесплатной учетной записи Azure](https://azure.microsoft.com/free/).

* Шаблон приложения Azure IoT Central для непрерывного мониторинга состояния пациентов. Если у вас его еще нет, вы можно выполнить [процедуру развертывания шаблона приложения](overview-iot-central-healthcare.md).

* [Пространство имен Центров событий и Центр событий](../../event-hubs/event-hubs-create.md) в Azure.

* Приложение логики, из которого нужен доступ к Центру событий. Чтобы запускать приложение логики с помощью триггера Центров событий Azure, требуется [пустое приложение логики](../../logic-apps/quickstart-create-first-logic-app-workflow.md).

* Учетная запись службы Power BI. Если у вас ее еще нет, можно [создать бесплатную пробную учетную запись для службы Power BI](https://app.powerbi.com/). Если вы еще не работали с Power BI, вам может пригодиться руководство [Начало работы с Power BI](/power-bi/service-get-started).


## <a name="set-up-a-continuous-data-export-to-azure-event-hubs"></a>Настройка непрерывного экспорта данных в Центры событий Azure
Для начала необходимо настроить непрерывный экспорт данных из шаблона приложения Azure IoT Central в Центр событий Azure, размещенный в вашей подписке. Для этого можно выполнить действия, описанные в руководстве по [экспорту в Центры событий](../core/howto-export-data.md) для Azure IoT Central. Экспортировать придется только те данные телеметрии, которые нужны для работы с этим руководством.


## <a name="create-a-power-bi-streaming-dataset"></a>Создание набора данных для потоковой передачи в Power BI

1. Выполните вход в учетную запись Power BI.

1. В любой рабочей области создайте набор данных для потоковой передачи, нажав кнопку **+ Создать** в правом верхнем углу панели инструментов. Вам потребуется создать отдельный набор данных для каждого пациента, показатели которого вы хотите отслеживать на панели мониторинга.

   :::image type="content" source="media/create-streaming-dataset.png" alt-text="Создание набора данных для потоковой передачи":::


1. Выберите **API** в качестве источника для набора данных.

1. Введите **имя** для набора данных (например, имя пациента) и заполните сведения о нужном потоке данных. Представленный ниже пример основан на значениях, которые поступают от имитированных устройств в шаблоне приложения для непрерывного мониторинга состояния пациентов. В этом примере есть два пациента:

   * Teddy Silvers, для которого предоставляются данные из Smart Knee Brace;
   * Yesenia Sanford, для которой предоставляются данные из Smart Vitals Patch.

   :::image type="content" source="media/enter-dataset-values.png" alt-text="Ввод значений для набора данных":::

Дополнительные сведения о наборах данных для потоковой передачи в Power BI см. в документе [о потоковой передаче в реальном времени в Power BI](/power-bi/service-real-time-streaming).


## <a name="connect-your-logic-app-to-azure-event-hubs"></a>Подключение приложения логики к Центрам событий Azure

Чтобы подключить приложение логики к Центрам событий Azure, выполните инструкции из документа [об отправке событий с помощью Центров событий Azure и Azure Logic Apps](../../connectors/connectors-create-api-azure-event-hubs.md#add-event-hubs-action). Ниже перечислены некоторые рекомендуемые параметры.

|Параметр|Значение|
|---|---|
|Тип содержимого|приложение/json|
|Интервал|3|
|Частота|Секунда|

После завершения этого шага запрос в конструкторе приложений логики должен выглядеть следующим образом:

>[!div class="mx-imgBorder"] 
>![Подключение Logic Apps к Центрам событий](media/eh-logic-app.png)

:::image type="content" source="media/enter-dataset-values.png" alt-text="Ввод значений для набора данных":::


## <a name="stream-data-to-power-bi-from-your-logic-app"></a>Потоковая передача данных в Power BI из приложения логики

Следующим шагом будет анализ данных, поступающих из Центра событий, для последующей потоковой передачи в созданные ранее наборы данных Power BI.

Чтобы это выполнить, вам нужно разобраться в формате полезных данных JSON, которые передаются с устройства в Центр событий. Для этого изучите [этот пример схемы](../core/howto-export-data.md#telemetry-format) и измените его в соответствии со своем схемой или изучите сообщения с помощью [обозревателя служебной шины](https://github.com/paolosalvatori/ServiceBusExplorer). Если вы используете приложения для непрерывного мониторинга состояния пациентов, сообщения будут выглядеть следующим образом:

**Данные телеметрии Smart Vitals Patch**

```json
{
  "HeartRate": 80,
  "RespiratoryRate": 12,
  "HeartRateVariability": 64,
  "BodyTemperature": 99.08839032397609,
  "BloodPressure": {
    "Systolic": 23,
    "Diastolic": 34
  },
  "Activity": "walking"
}
```

**Данные телеметрии Smart Knee Brace**

```json
{
  "Acceleration": {
    "x": 72.73510947763711,
    "y": 72.73510947763711,
    "z": 72.73510947763711
  },
  "RangeOfMotion": 123,
  "KneeBend": 3
}
```

**Свойства**

```json
{
  "iothub-connection-device-id": "1qsi9p8t5l2",
  "iothub-connection-auth-method": "{\"scope\":\"device\",\"type\":\"sas\",  \"issuer\":\"iothub\",\"acceptingIpFilterRule\":null}",
  "iothub-connection-auth-generation-id": "637063718586331040",
  "iothub-enqueuedtime": 1571681440990,
  "iothub-message-source": "Telemetry",
  "iothub-interface-name": "Patient_health_data_3bk",
  "x-opt-sequence-number": 7,
  "x-opt-offset": "3672",
  "x-opt-enqueued-time": 1571681441317
}
```

1. Теперь, когда вы проверили полезные данные JSON, вернитесь в конструктор приложений логики и щелкните **+ Новый шаг**. Найдите действие **Инициализировать переменную** и добавьте его в качестве следующего шага со следующими параметрами:

   |Параметр|Значение|
   |---|---|
   |Имя|Имя_интерфейса|
   |Тип|Строка|

   Щелкните **Сохранить**. 

1. Добавьте еще одну переменную с именем **Body** и типом **Строка**. Теперь в приложении логики добавлены следующие действия:

   :::image type="content" source="media/initialize-string-variables.png" alt-text="Инициализация переменных":::
    
1. Выберите **+ Новый шаг** и добавьте действие **Анализ JSON**. Присвойте этому шагу имя **Анализ свойств**. В области "Содержимое" выберите **Свойства**, которые поступают из Центра событий. Щелкните **Использовать пример полезной нагрузки, чтобы создать схему** в нижней части страницы и вставьте пример полезных данных из расположенного выше раздела "Свойства".

1. Затем выберите действие **Задать переменную** и обновите переменную **Имя_интерфейса**, указав значение **iothub-interface-name** из проанализированных свойств JSON.

1. Добавьте элемент управления **Разделить** в качестве следующего действия и выберите разделение по переменной **Имя_интерфейса**. Этот элемент будет использоваться для фильтрации нужного набора данных.

1. В приложении Azure IoT Central найдите переменную "Имя_интерфейса" для данных о здоровье от поставщиков Smart Vitals Patch и Smart Knee Brace в представлении **Шаблоны устройств**. Создайте два разных варианта в элементе управления **Переключение**, по одному для каждой переменной "Имя_интерфейса", и переименуйте элемент управления соответствующим образом. Можно задать вариант по умолчанию, который будет использовать элемент управления **Завершение**, и выбрать отображаемое состояние.

   :::image type="content" source="media/split-by-interface.png" alt-text="Элемент управления &quot;Разделение&quot;":::

1. Для варианта **Smart Vitals Patch** добавьте действие **Анализ JSON**. В области **Содержимое** выберите содержимое, которое поступает из Центра событий. Скопируйте и вставьте предложенный выше образец полезных данных для Smart Vitals Patch, чтобы создать схему.

1. Добавьте действие **Задать переменную**, чтобы обновить переменную **Body** значением **Body** из проанализированного на шаге 7 объекта JSON.

1. Добавьте элемент управления **Условие** в качестве следующего действия и задайте для него условие **Body**, **contains**, **HeartRate**. Это действие позволит убедиться, что от Smart Vitals Patch поступает правильный набор данных, прежде чем использовать его для заполнения набора данных Power BI. Теперь шаги 7–9 будут выглядеть так:

   :::image type="content" source="media/smart-vitals-pbi.png" alt-text="Добавление условия для Smart Vitals":::

1. В варианте **True** для этого условия добавьте действие, которое вызывает функцию Power BI **Добавление строк в набор данных**. Для этого потребуется выполнить вход в Power BI. В варианте **False** можно снова использовать элемент управления **Завершение**.

1. Выберите нужные значения для параметров **Рабочая область**, **Набор данных** и **Таблица**. Сопоставьте параметры, которые вы указали при создании набора данных для потоковой передачи в Power BI, со значениями из проанализированного объекта JSON, который поступает из Центра событий. Готовые действия должны выглядеть следующим образом.
 
   :::image type="content" source="media/add-rows-yesenia.png" alt-text="Добавление строк в Power BI":::

1. Для варианта переключения **Smart Knee Brace** добавьте действие **Анализ JSON**, чтобы проанализировать содержимое, как и на шаге 7. После этого укажите действие **Добавить строки в набор данных**, чтобы обновить набор данных Teddy Silvers в Power BI.

   :::image type="content" source="media/knee-brace-pbi.png" alt-text="Снимок экрана, на котором показано, как добавить строки в наборы данных.":::

1. Щелкните **Сохранить** и запустите приложение логики.


## <a name="build-a-real-time-dashboard-for-patient-vitals"></a>создание панели мониторинга для получения данных о жизненно важных показателях пациента в реальном времени.

Теперь вернитесь в Power BI и выберите команду **+ Создать **, чтобы создать новую** Панель мониторинга**. Присвойте панели мониторинга имя и щелкните **Создать**.

На панели навигации вверху щелкните символ многоточия и выберите действие **+ Добавить плитку**.

:::image type="content" source="media/add-tile.png" alt-text="Добавление плитки на панели мониторинга":::

Выберите тип плитки, которую вы хотите добавить, и настройте приложение в соответствии с вашими задачами.


## <a name="clean-up-resources"></a>Очистка ресурсов

Если вы не собираетесь использовать это приложение в дальнейшем, удалите все его ресурсы, выполнив следующие действия.

1. На портале Azure удалите созданные ресурсы Центра событий и Logic Apps.

1. Перейдите на вкладку администрирования для приложения IoT Central и щелкните **Удалить**.


## <a name="next-steps"></a>Дальнейшие действия

> [!div class="nextstepaction"]
> [Рекомендации по созданию архитектуры приложения для непрерывного мониторинга состояния пациентов](concept-continuous-patient-monitoring-architecture.md)