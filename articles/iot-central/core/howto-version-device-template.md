---
title: Основные сведения об управлении версиями шаблона устройства для приложений Azure IoT Central | Документация Майкрософт
description: Выполнение итерации шаблонов устройств путем создания версий без воздействия на активные подключенные устройства
author: dominicbetts
ms.author: dobett
ms.date: 11/06/2020
ms.topic: how-to
ms.service: iot-central
services: iot-central
ms.custom: device-developer
ms.openlocfilehash: 93545c63013c95e3db498b079061da3d9b189efd
ms.sourcegitcommit: 910a1a38711966cb171050db245fc3b22abc8c5f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "95995766"
---
# <a name="create-a-new-device-template-version"></a>Создание версии шаблона нового устройства

*Эта статья предназначена для создателей решений и разработчиков устройств.*

Шаблон устройства включает схему, которая описывает, как устройство взаимодействует с IoT Central. Эти взаимодействия включают данные телеметрии, свойства и команды. Как устройство, так и приложение IoT Central полагаются на общее понимание этой схемы для обмена информацией. В схему можно внести только ограниченные изменения, не нарушая контракт, поэтому для большинства изменений схемы требуется новая версия шаблона устройства. Управление версиями шаблона устройства позволяет старым устройствам продолжать работу с версией схемы, в то время как новые или обновленные устройства используют более позднюю версию схемы.

Схема в шаблоне устройства определяется в модели устройства и ее интерфейсах. К шаблонам устройств относятся другие сведения, такие как свойства облака, настройки отображения и представления. Если вы вносите изменения в эти части шаблона устройства, которые не определяют, как устройство обменивается данными с IoT Central, вам не нужно задавать версию шаблона.

Необходимо всегда публиковать обновленный шаблон устройства, прежде чем оператор сможет его использовать. IoT Central прекращает публикацию критических изменений в шаблоне устройства без предварительной версии шаблона.

> [!NOTE]
> Дополнительные сведения о создании шаблона устройства см. в статье [Настройка шаблона устройства и управление им](howto-set-up-template.md) .

## <a name="versioning-rules"></a>Правила управления версиями

В этом разделе перечислены правила управления версиями, применяемые к шаблонам устройств. Модели и интерфейсы устройства имеют номера версий. В следующем фрагменте кода показана модель устройства для устройства термостата. Модель устройства имеет один интерфейс. Номер версии можно увидеть в конце `@id` поля.

```json
{
  "@context": "dtmi:dtdl:context;2",
  "@id": "dtmi:com:example:Thermostat;1",
  "@type": "Interface",
  "displayName": "Thermostat",
  "description": "Reports current temperature and provides desired temperature control.",
  "contents": [
    // ...
  ]
}
```

Чтобы просмотреть эти сведения в пользовательском интерфейсе IoT Central, выберите **просмотреть удостоверение** в редакторе шаблонов устройств:

:::image type="content" source="media/howto-version-device-template/view-identity.png" alt-text="Просмотр удостоверения интерфейса для просмотра номера версии":::

В следующем списке приведены правила, которые определяют, когда необходимо создать новую версию.

* После публикации модели устройства вы не сможете удалить какие-либо интерфейсы даже в новой версии шаблона устройства.
* После публикации модели устройства можно добавить интерфейс при создании новой версии шаблона устройства.
* После публикации модели устройства можно заменить интерфейс новой версией, если вы создаете новую версию шаблона устройства. Например, если в шаблоне устройства датчика v1 используется интерфейс термостата v1, можно создать шаблон устройства датчика v2, использующий интерфейс термостата v2.
* После публикации интерфейса вы не сможете удалить содержимое интерфейса даже в новой версии шаблона устройства.
* После публикации интерфейса можно добавлять элементы в содержимое интерфейса при создании новой версии интерфейса и шаблона устройства. Элементы, которые можно добавить в интерфейс, включают данные телеметрии, свойства и команды.
* После публикации интерфейса можно вносить изменения, не связанные с схемой, в существующие элементы в интерфейсе при создании новой версии интерфейса и шаблона устройства. Элементы интерфейса, не относящиеся к схеме, включают отображаемое имя и семантический тип. Части схемы элемента интерфейса, которые нельзя изменить, — это имя, тип возможности и схема.

В следующих разделах описаны некоторые примеры изменения шаблонов устройств в IoT Central.

## <a name="customize-the-device-template-without-versioning"></a>Настройка шаблона устройства без управления версиями

Некоторые элементы возможностей устройства можно изменять без необходимости использования версии шаблона и интерфейсов устройства. Например, некоторые из этих полей включают отображаемое имя, семантический тип, минимальное значение, максимальное значение, десятичные разряды, цвет, единица, единица показа, комментарий и описание. Чтобы добавить одну из следующих настроек:

1. Перейдите на страницу **шаблонов устройств** .
1. Выберите шаблон устройства, который вы хотите настроить.
1. Перейдите на вкладку **Настройка** .
1. Здесь перечислены все возможности, определенные в модели устройства. Вы можете изменять, сохранять и использовать все эти поля без необходимости использовать версию шаблона устройства. Если есть поля, которые вы хотите изменить, которые доступны только для чтения, необходимо изменить версию шаблона устройства. Выберите поле, которое вы хотите изменить, и введите новые значения.
1. Щелкните **Сохранить**. Теперь эти значения переопределяют все, что было первоначально сохранено в шаблоне устройства и используются в приложении.

## <a name="version-a-device-template"></a>Версия шаблона устройства

При создании новой версии шаблона устройства создается черновая версия шаблона, в котором модель устройства может быть изменена. Все опубликованные интерфейсы остаются опубликованными до тех пор, пока не будет выполнена их версия. Чтобы изменить опубликованный интерфейс, сначала создайте новую версию шаблона устройства.

При редактировании части модели устройства, которая не может быть изменена в разделе "настройки", используется только версия шаблона устройства.

Для версии шаблона устройства:

1. Перейдите на страницу **шаблонов устройств** .
1. Выберите шаблон устройства, для которого вы пытаетесь установить версию.
1. Нажмите кнопку **версия** в верхней части страницы и присвойте шаблону новое имя. IoT Central предлагает новое имя, которое можно изменить.
1. Нажмите кнопку **создания**.
1. Теперь шаблон устройства находится в черновом режиме. Вы видите, что интерфейсы все еще заблокированы. Версия всех интерфейсов, которые требуется изменить.

## <a name="version-an-interface"></a>Версия интерфейса

Управление версиями интерфейс позволяет добавлять, обновлять и удалять возможности внутри уже созданного интерфейса.

Чтобы получить версию интерфейса, выполните следующие действия.

1. Перейдите на страницу **шаблонов устройств** .
1. Выберите шаблон устройства в режиме черновика.
1. Выберите интерфейс, который находится в опубликованном режиме, который требуется изменить и версию.
1. Нажмите кнопку **версия** в верхней части страницы интерфейса.
1. Нажмите кнопку **создания**.
1. Теперь интерфейс находится в черновом режиме. Вы можете добавлять или изменять возможности интерфейса, не нарушая существующие настройки и представления.

## <a name="migrate-a-device-across-versions"></a>Миграция устройства между версиями

Вы можете создать несколько версий шаблона устройства. Со временем у вас будет несколько подключенных устройств, использующих эти шаблоны устройств. Вы можете перенести устройства из одной версии шаблона устройства в другую. Ниже описано, как перенести устройство в другую версию.

1. Перейдите на страницу **Устройства**.
1. Выберите устройство, которое нужно переместить в другую версию.
1. Выберите **Миграция**: :::image type="content" source="media/howto-version-device-template/migrate-device.png" alt-text="выберите параметр, чтобы начать миграцию устройства"::: .
1. Выберите шаблон устройства с номером версии, на который требуется перенести устройство, и нажмите кнопку **перенести**.

## <a name="next-steps"></a>Дальнейшие действия

Если вы являетесь оператором или построителем решений, предлагаем следующий шаг: Узнайте, [как управлять устройствами](./howto-manage-devices.md).

Если вы являетесь разработчиком устройств, рекомендуем следующий шаг — прочитать сведения об [Azure IOT Edge устройствах и Azure IOT Central](./concepts-iot-edge.md).
