---
title: Настройка подключенного кэша Майкрософт для обновления устройства для центра Интернета вещей Azure | Документация Майкрософт
titleSuffix: Device Update for Azure IoT Hub
description: Обзор подключенного кэша Майкрософт для обновления устройства для центра Интернета вещей Azure
author: andyriv
ms.author: andyriv
ms.date: 2/16/2021
ms.topic: conceptual
ms.service: iot-hub-device-update
ms.openlocfilehash: 2903407f88b57a7be948cdeb0610e6d65df975b0
ms.sourcegitcommit: b4647f06c0953435af3cb24baaf6d15a5a761a9c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/02/2021
ms.locfileid: "101663159"
---
# <a name="configure-microsoft-connected-cache-for-device-update-for-azure-iot-hub"></a>Настройка подключенного кэша Майкрософт для обновления устройства для центра Интернета вещей Azure

Подключенный кэш Майкрософт развертывается на шлюзах Azure IoT Edge как модуль Azure IoT Edge. Как и другие модули Azure IoT Edge, переменные среды развертывания модулей MCC и параметры создания контейнера используются для настройки модулей кэша, подключенных к Microsoft.  В этом разделе определяются переменные среды и параметры создания контейнера, необходимые для успешного развертывания модуля подключенного кэша Майкрософт для использования при обновлении устройства для центра Интернета вещей Azure.

## <a name="microsoft-connected-cache-azure-iot-edge-module-deployment-details"></a>Сведения о развертывании модуля Azure IoT Edge подключенного кэша Майкрософт

Именование модуля подключенного кэша Майкрософт по усмотрению администратора. Нет других взаимодействий модулей или служб, зависящих от имени модуля для обмена данными. Кроме того, родительские дочерние отношения серверов кэша, подключенного к Microsoft, не зависят от этого имени модуля, а вместо полного доменного имени или IP-адреса шлюза Azure IoT Edge, который был настроен, как обсуждалось ранее.

Переменные среды модуля "подключенный кэш Майкрософт Azure IoT Edge" используются для передачи базовой информации об удостоверениях модуля и функциональных параметров модуля в контейнер.

| Имя переменной                 | Формат значения                           | Обязательный/необязательный | Функциональность                                    |
| ----------------------------- | ---------------------------------------| ----------------- | ------------------------------------------------ |
| CUSTOMER_ID                   | Идентификатор GUID подписки Azure             | Обязательно          | Это ключ клиента, который обеспечивает безопасность<br>Проверка подлинности узла кэша для оптимизации доставки<br>утверждения. Требуется для того, чтобы модуль мог функционировать. |
| CACHE_NODE_ID                 | Идентификатор GUID узла кэша                     | Обязательно          | Уникально идентифицирует подключенный кэш Майкрософт<br>с узла на службы оптимизации доставки. Требуется по порядку<br> для функционирования модуля. |
| CUSTOMER_KEY                  | GUID ключа клиента                     | Обязательно          | Это ключ клиента, который обеспечивает безопасность<br>Проверка подлинности узла кэша для служб оптимизации доставки.<br>Требуется для того, чтобы модуль мог функционировать.|
| STORAGE_ *N* _SIZE_GB           | Где N — требуемое количество ГБ   | Обязательно          | Укажите до девяти дисков для кэширования содержимого и укажите<br>максимальное пространство в гигабайтах, выделяемое для содержимого на каждом диске кэша. Примеры:<br>STORAGE_1_SIZE_GB = 150<br>STORAGE_2_SIZE_GB = 50<br>Номер диска должен соответствовать указанным значениям привязки к диску кэша<br>в параметре создания контейнера Микрософтконнектедкаче *N* значение|
| UPSTREAM_HOST                 | ПОЛНОЕ ДОМЕННОЕ ИМЯ/IP-АДРЕС                                | Необязательно          | Это значение может указывать вышестоящее подключение к Microsoft<br>Узел кэша, который выступает в качестве прокси-сервера, если подключенный узел кэша<br> отключен от Интернета. Этот параметр используется для поддержки<br> Вложенный сценарий Интернета вещей.<br>**Примечание.** Подключенный кэш Майкрософт прослушивает HTTP-порт 80 по умолчанию.|
| UPSTREAM_PROXY                | FQDN/IP: ПОРТ                           | Необязательно          | Исходящий интернет-прокси.<br>Это также может быть прокси-сервер ДЕМИЛИТАРИЗОВАНной зоны, если сеть ISA 95. |
| CACHEABLE_CUSTOM_ *N* _HOST     | УЗЕЛ ИЛИ IP-АДРЕС<br>Полное доменное имя.                        | Необязательно          | Требуется для поддержки репозиториев пользовательских пакетов.<br>Репозитории можно размещать локально или в Интернете.<br>Количество настраиваемых узлов, которые можно настроить, не ограничено.<br><br>Примеры:<br>Имя = CACHEABLE_CUSTOM_1_HOST значение = packages.foo.com<br> Имя = CACHEABLE_CUSTOM_2_HOST значение = packages.bar.com    |
| CACHEABLE_CUSTOM_ *N* _CANONICAL| Псевдоним                                  | Необязательно          | Требуется для поддержки репозиториев пользовательских пакетов.<br>Это значение можно использовать в качестве псевдонима и будет использоваться сервером кэша для ссылки<br>различные DNS-имена. Например, имя узла содержимого репозитория может быть packages.foo.com,<br>но для разных регионов может существовать дополнительный префикс, добавляемый к имени узла.<br>Например, westuscdn.packages.foo.com и eastuscdn.packages.foo.com.<br>Устанавливая каноническое значение псевдонима, вы гарантируете, что содержимое не повторяется.<br>для содержимого, поступающего с того же узла, но с разными источниками CDN.<br>Формат канонического значения не имеет значения, но он должен быть уникальным для узла.<br>Может быть проще установить значение, соответствующее значению узла.<br><br>Примеры на основе пользовательских примеров основного приложения:<br>Имя = CACHEABLE_CUSTOM_1_CANONICAL значение = фупаккажес<br> Имя = CACHEABLE_CUSTOM_2_CANONICAL значение = packages.bar.com  |
| IS_SUMMARY_PUBLIC             | Значение true или false                          | Необязательно          | Позволяет просматривать сводный отчет в локальной сети или Интернете.<br>Для просмотра сводного отчета, если задано значение true, требуется использование ключа API (см. ниже). |
| IS_SUMMARY_ACCESS_UNRESTRICTED| Значение true или false                          | Необязательно          | Позволяет просматривать сводный отчет в локальной сети или Интернете без<br>Использование ключа API с любого устройства в сети. Используйте, если вы не хотите блокировать доступ<br>для просмотра сводных данных сервера кэша через браузер. |
            
## <a name="microsoft-connected-cache-azure-iot-edge-module-container-create-options"></a>Параметры создания контейнера модуля Azure IoT Edge подключенного кэша Майкрософт

Параметры создания контейнера для развертывания модуля MCC обеспечивают контроль параметров, связанных с хранилищем и портами, используемыми модулем MCC. Это список обязательных переменных, созданных контейнерами, которые используются для развертывания MCC.

### <a name="container-to-host-os-drive-mappings"></a>Сопоставление контейнеров для размещения дисков ОС

Требуется для преобразования расположения хранилища контейнера в место хранения на диске. можно указать < до девяти расположений.

>[!Note]
>Номер диска должен соответствовать значениям привязки диска кэша, указанным в переменной среды STORAGE_ *N* _SIZE_GB значение ```/MicrosoftConnectedCache*N*/:/nginx/cache*N*/```

### <a name="container-to-host-tcp-port-mappings"></a>Сопоставление контейнеров с TCP-портами

Этот параметр указывает HTTP-порт внешнего компьютера, на котором MCC прослушивает запросы содержимого. По умолчанию Хостпорт — порт 80, а другие порты в настоящее время не поддерживаются, так как клиент аду выполняет запросы через порт 80. TCP-порт 8081 — это внутренний порт контейнера, который прослушивается MCC и не может быть изменен.

```markdown
8081/tcp": [
   {
       "HostPort": "80"
   }
]
```

### <a name="container-service-tcp-port-mappings"></a>Сопоставления TCP-портов службы контейнеров

Модуль подключенного кэша Microsoft имеет службу .NET Core, которая используется ядром кэширования для различных функций.

>[!Note]
>Для поддержки вложенного пограничной службы Интернета вещей Azure Хостпорт не должно быть установлено в значение 5000, так как модуль прокси-сервера реестра уже прослушивает порт узла 5000.

```markdown
5000/tcp": [
   {
       "HostPort": "5001"
   }
]
```

## <a name="microsoft-connected-cache-summary-report"></a>Сводный отчет о подключенном кэше Майкрософт

В настоящее время сводный отчет является единственным способом просмотра кэшированных данных для экземпляров подключенного кэша Майкрософт, развернутых на шлюзах Azure IoT Edge. Отчет создается с интервалом в 15 секунд и включает среднюю статистику за период, а также агрегированную статистику за время существования модуля. Ключевая статистика, в которой будут заинтересны клиенты:

* **хитбитес** — сумма доставленных байт, которые поступили непосредственно из кэша.
* недопустимые **SByte** — это сумма байтов, доставленных подключенному кэшу Майкрософт из CDN для просмотра кэша.
* **еггрессбитес** — это сумма значений хитбитес и ненулевой SByte, а — общее число байтов, доставленных клиентам.
* **хитратиобитес** — это отношение между Хитбитес и егрессбитес.  Если 100% Еггрессбитес доставлен за период, равный Хитбитес, например, 1.

Сводный отчет доступен по адресу `http://<FQDN/IP of Azure IoT Edge Gateway hosting MCC>:5001/summary` (Дополнительные сведения о видимости этого отчета см. в разделе переменная среды ниже).
