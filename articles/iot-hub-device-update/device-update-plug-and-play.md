---
title: Сведения о том, как обновление устройства для центра Интернета вещей использует самонастраивающийся IoT | Документация Майкрософт
description: Обновление устройства для центра Интернета вещей используется для обнаружения и управления устройствами, для которых поддерживается обновление через Air.
author: ValOlson
ms.author: valls
ms.date: 2/14/2021
ms.topic: conceptual
ms.service: iot-hub-device-update
ms.openlocfilehash: 227488f165aaad2f204c647eed17467a4ef561a1
ms.sourcegitcommit: 910a1a38711966cb171050db245fc3b22abc8c5f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "101663402"
---
# <a name="device-update-for-iot-hub-and-iot-plug-and-play"></a>Обновление устройства для центра Интернета вещей и самонастраивающийся IoT

Обновление устройства для центра Интернета вещей использует [центр Интернета вещей Самонастраивающийся](https://docs.microsoft.com/azure/iot-pnp/) для обнаружения и управления устройствами, для которых поддерживается обновление через Air. Служба обновления устройства будет отправлять и получать свойства и сообщения с устройств с помощью интерфейсов PnP. Обновление устройства для центра Интернета вещей требует, чтобы устройства IoT реализовали следующие интерфейсы и идентификатор модели, как описано ниже.

## <a name="adu-core-interface"></a>Интерфейс аду Core

Интерфейс "Адукореинтерфаце" используется для отправки действий обновления и метаданных на устройства и получения состояния обновления с устройств. Интерфейс "аду Core" разбивается на два свойства объекта.

При реализации этого интерфейса ожидаемое имя компонента в модели — **"азуредевицеупдатеажент"** . [Дополнительные сведения о компонентах Azure IoT PnP](https://docs.microsoft.com/azure/iot-pnp/concepts-components)

### <a name="agent-metadata"></a>Метаданные агента

Метаданные агента содержат поля, используемые агентом обновления устройства или устройства для отправки информации и состояния службам обновления устройств.

|Имя|схема|Направление|Описание|Пример|
|----|------|---------|-----------|-----------|
|resultCode|Целое число|с устройства в облако|Код, содержащий сведения о результате последнего действия обновления. Может быть заполнен как успешный или неудачный и должен соответствовать [спецификации кода состояния HTTP](https://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html).|500|
|екстендедресулткоде|Целое число|с устройства в облако|Код, содержащий дополнительные сведения о результате. Может быть заполнен как успешный, так и неудачный.|0x80004005|
|Состояние|Целое число|с устройства в облако|Это целое число, указывающее текущее состояние агента обновления устройства. Дополнительные сведения см. ниже. |Бездействие|
|инсталледупдатеид|строка|с устройства в облако|Идентификатор текущего установленного обновления (через обновление устройства). Это значение будет равно null для устройства, которое никогда не выполняло обновление через обновление устройства.|NULL|
|`deviceProperties`|Схема|с устройства в облако|Набор свойств, содержащих изготовитель и модель.|Дополнительные сведения см. ниже.

#### <a name="state"></a>Состояние

Это состояние, сообщаемое агентом обновления устройства после получения действия из службы обновления устройства. `State` в ответ на сообщение `Action` (см `Actions` . ниже), отправляемое агенту обновления устройства из службы обновления устройства. См. [обзорный рабочий процесс](understand-device-update.md#device-update-agent) для запросов, которые передаются между службой обновления устройств и агентом обновления устройства.

|Имя|Значение|Описание|
|---------|-----|-----------|
|Бездействие|0|Устройство готово к получению действия от службы обновления устройства. После успешного обновления состояние возвращается в `Idle` состояние.|
|довнлоадсукцеедед|2|Успешное скачивание.|
|инсталлсукцеедед|4|Установка выполнена успешно.|
|Сбой|255|Во время обновления произошла ошибка.|

#### <a name="device-properties"></a>Свойства устройства

Это набор свойств, содержащих изготовитель и модель.

|Имя|схема|Направление|Описание|
|----|------|---------|-----------|
|manufacturer|строка|с устройства в облако|Производитель устройства, сообщаемый через `deviceProperties` . Это свойство считывается из одного из двух мест: интерфейс "Азуредевицеупдатекоре" сначала пытается считать значение "aduc_manufacturer" из файла [конфигурации](device-update-configuration-file.md) .  Если значение не заполнено в файле конфигурации, по умолчанию будет сообщать об определении времени компиляции для ADUC_DEVICEPROPERTIES_MANUFACTURER. Это свойство будет выводиться только во время загрузки.|
|model|строка|с устройства в облако|Модель устройства устройства, о которой сообщается `deviceProperties` . Это свойство считывается из одного из двух мест. интерфейс Азуредевицеупдатекоре сначала попытается прочитать значение "aduc_model" из файла [конфигурации](device-update-configuration-file.md) .  Если значение не заполнено в файле конфигурации, по умолчанию будет сообщать об определении времени компиляции для ADUC_DEVICEPROPERTIES_MODEL. Это свойство будет выводиться только во время загрузки.|
|адувер|строка|с устройства в облако|Версия агента обновления устройства, выполняющегося на устройстве. Это значение считывается из сборки только в том случае, если во время компиляции ENABLE_ADU_TELEMETRY_REPORTING имеет значение 1 (true). Клиенты могут отказаться от составления отчетов о версии, задав значение 0 (false). [Настройка свойств агента обновления устройств](https://github.com/Azure/iot-hub-device-update/blob/main/docs/agent-reference/how-to-build-agent-code.md).|
|довер|строка|с устройства в облако|Версия агента оптимизации доставки, выполняющегося на устройстве. Значение считывается из сборки только в том случае, если во время компиляции ENABLE_ADU_TELEMETRY_REPORTING имеет значение 1 (true). Клиенты могут отказаться от отправки отчетов о версии, задав значение 0 (false). [Настройка свойств агента оптимизации доставки](https://github.com/microsoft/do-client/blob/main/README.md#building-do-client-components).|

### <a name="service-metadata"></a>Метаданные службы

Метаданные службы содержат поля, используемые службами обновления устройств для обмена данными между действиями и данными с агентом обновления устройства.

|Имя|схема|Направление|Описание|
|----|------|---------|-----------|
|action|Целое число|из облака на устройство|Это целое число, соответствующее действию, которое должен выполнить агент. Значения, перечисленные ниже.|
|Задача UpdateManifest|строка|из облака на устройство|Используется для описания содержимого обновления. Создано из [манифеста импорта](import-update.md#create-device-update-import-manifest)|
|упдатеманифестсигнатуре|Объект JSON|из облака на устройство|Веб-подпись JSON (ЖВС) с веб-ключами JSON, используемыми для проверки источника.|
|филеурлс|Схема|из облака на устройство|Сопоставьте `FileHash` с `DownloadUri` . Сообщает агенту, какие файлы загружать, и хэш, используемый для проверки правильности загрузки файлов.|

#### <a name="action"></a>Действие

`Actions` Ниже представлены действия, предпринятые агентом обновления устройства в соответствии с указаниями в службе обновления устройства. Агент обновления устройства сообщит `State` (см `State` . раздел выше) об обработке `Action` полученного сообщения. См. [обзорный рабочий процесс](understand-device-update.md#device-update-agent) для запросов, которые передаются между службой обновления устройств и агентом обновления устройства.

|Имя|Значение|Описание|
|---------|-----|-----------|
|Скачать|0|Скачивание опубликованного содержимого или обновления и любых других необходимых материалов|
|Установка|1|Установите содержимое или обновите. Обычно это означает вызов установщика для содержимого или обновления.|
|Применить|2|Завершите обновление. При необходимости система сообщает о перезагрузке системы.|
|Отменить|255|Прерывать обработку текущего действия и вернуться к `Idle` . Также будет использоваться, чтобы сообщить агенту о состоянии вернуться к `Failed` `Idle` .|

## <a name="device-information-interface"></a>Интерфейс сведений об устройстве

Интерфейс сведений об устройстве является концепцией, используемой в [архитектуре IoT Самонастраивающийся](https://docs.microsoft.com/azure/iot-pnp/overview-iot-plug-and-play). Он содержит параметры устройства в облаке, предоставляющие сведения об оборудовании и операционной системе устройства. Обновление устройства для центра Интернета вещей использует свойства Девицеинформатион. Manufacturer и Девицеинформатион. Model для телеметрии и диагностики. Дополнительные сведения об интерфейсе сведений об устройстве см. в этом [примере](https://devicemodels.azure.com/dtmi/azure/devicemanagement/deviceinformation-1.json).

При реализации этого интерфейса ожидаемое имя компонента в модели — **девицеинформатион** . [Сведения о компонентах Azure IoT PnP](https://docs.microsoft.com/azure/iot-pnp/concepts-components)

|Имя|Type|схема|Направление|Описание|Пример|
|----|----|------|---------|-----------|-----------|
|manufacturer|Свойство.|строка|с устройства в облако|Название компании изготовителя устройства. Это может совпадать с названием изготовителя оборудования (OEM).|Contoso|
|model|Свойство.|строка|с устройства в облако|Имя или идентификатор модели устройства.|Устройство IoT Edge|
|свверсион|Свойство.|строка|с устройства в облако|Версия программного обеспечения на вашем устройстве. Свверсион может быть версией встроенного по.|4.15.0-122|
|osName|Свойство.|строка|с устройства в облако|Имя операционной системы на устройстве.|Ubuntu Server 18.04|
|processorArchitecture|Свойство.|строка|с устройства в облако|Архитектура процессора на устройстве.|ARM64|
|процессормануфактурер|Свойство.|строка|с устройства в облако|Имя производителя процессора на устройстве.|Microsoft|
|тоталстораже|Свойство.|строка|с устройства в облако|Общий объем доступного хранилища на устройстве в килобайтах.|2048|
|тоталмемори|Свойство.|строка|с устройства в облако|Общая объем доступной памяти на устройстве в килобайтах.|256|

## <a name="model-id"></a>Идентификатор модели 

Идентификатор модели — это то, как интеллектуальные устройства объявляют свои возможности в приложениях Интернета вещей Azure с помощью IoT Plug and Play.To. Дополнительные сведения о создании смарт-устройств для объявления их возможностей в приложениях Azure IoT см. в статье [Руководство разработчика для iot Самонастраивающийся](https://docs.microsoft.com/azure/iot-pnp/concepts-developer-guide-device-c).

Обновление устройства для центра Интернета вещей требует, чтобы смарт-устройство IoT самонастраивающийся было уведомлено идентификатор модели со значением **"дтми: азуредевицеупдате; 1"** в рамках подключения устройства. [Сведения о том, как объявить идентификатор модели](https://docs.microsoft.com/azure/iot-pnp/concepts-developer-guide-device-c#model-id-announcement).
