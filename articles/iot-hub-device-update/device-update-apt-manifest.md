---
title: Общие сведения об обновлении устройства для манифеста APT центра Интернета вещей Azure | Документация Майкрософт
description: Узнайте, как обновление устройства для центра Интернета вещей использует манифест APT для обновления на основе пакета.
author: vimeht
ms.author: vimeht
ms.date: 2/17/2021
ms.topic: conceptual
ms.service: iot-hub-device-update
ms.openlocfilehash: 0b68b78499aa3bf0d84d8bd0fa5ab55d1f969113
ms.sourcegitcommit: 910a1a38711966cb171050db245fc3b22abc8c5f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/20/2021
ms.locfileid: "101680094"
---
# <a name="device-update-apt-manifest"></a>Манифест APT обновления устройства

Манифест APT — это JSON-файл, описывающий сведения об обновлении, необходимые обработчику обновления APT. Этот файл можно импортировать в обновление устройства для центра Интернета вещей, как и любое другое обновление.

Дополнительные [сведения](import-update.md) об импорте обновлений в обновление устройства.

## <a name="overview"></a>Обзор

При доставке манифеста APT агенту обновления устройства в качестве обновления агент будет обрабатывать манифест и выполнять необходимые операции. Эти операции включают загрузку и установку пакетов, указанных в файле манифеста APT и их зависимостях.

Обновление устройства поддерживает обработчик обновлений APT UpdateType и APT. Эта поддержка позволяет агенту обновления устройства оценивать установленные пакеты Debian и обновлять необходимые пакеты. 

## <a name="schema"></a>схема

Файл манифеста APT — это JSON-файл со схемой с управлением версиями.

```json
{
    "name": "<name>",
    "version": "<version>",
    "packages": [
        {
            "name": "<package name>",
            "version": "<version specifier>"
        }
    ]
}
```

Пример

```json
{
    "name": "contoso-iot-edge",
    "version": "1.0.0.0",
    "packages": [
        {
            "name" : "thermocontrol",
            "version" : "1.0.1"
        },
        {
            "name" : "tempreport",
            "version" : "2.0.0"
        }
    ]
}
```

### <a name="name"></a>name

Имя для этого манифеста APT. Это может быть любое имя или идентификатор, пригодное для ваших сценариев. Например, `contoso-iot-edge`.

### <a name="version"></a>version

Номер версии для этого манифеста APT. Например, `1.0.0.0`.


### <a name="packages"></a>Пакеты

Список объектов, содержащих свойства конкретного пакета.

#### <a name="name"></a>name

Имя или идентификатор пакета. Например, `iotedge`.

#### <a name="version"></a>version

Критерии требуемой версии для пакета. Например, `1.0.8-2`.

В настоящее время поддерживается только точный номер версии. Номер версии — это требуемая версия пакета Debian в формате [Эпоха:] upstream_version [-debian_revision].

**эпоха** — это целое число без знака.

**upstream_version** может содержать буквы и цифры, например ".", "+", "-" и "~". Оно должно начинаться с цифры.
> [!NOTE]
> "1.0.8" равно "1.0.8-0"

Например, **`"name":"iotedge" and "version":"1.0.8-2"`** эквивалентна установке пакета с помощью команды. `apt-get install iotedge=1.0.8-2`

> [!NOTE]
> Значение версии не содержит знака равенства

Если версия не указана, будет установлена последняя доступная версия указанного пакета.

[Узнайте больше](https://www.debian.org/doc/debian-policy/ch-controlfields.html#s-f-version) о том, как устанавливаются версии пакетов Debian.

> [!NOTE]
> Диспетчер пакетов APT игнорирует требования к системе управления версиями, предоставляемые пакетом, если зависимые пакеты для установки разрешаются автоматически. Если явно не заданы версии зависимых пакетов, они будут использовать последнюю версию, даже несмотря на то, что сам пакет может указать в данной версии определенное требование (=). Это автоматическое разрешение может привести к ошибкам в отношении зависимости неудовлетворенных. [Подробнее](https://unix.stackexchange.com/questions/350192/apt-get-not-properly-resolving-a-dependency-on-a-fixed-version-in-a-debian-ubunt)

Если вы обновляете определенную версию управляющей программы Azure IoT Edge безопасности, необходимо включить требуемую версию `iotedge` пакета и зависимый `libiothsm-std` пакет в манифест APT.
[Подробнее](https://docs.microsoft.com/azure/iot-edge/how-to-update-iot-edge#update-the-security-daemon)

> [!NOTE]
> Манифест APT можно использовать для обновления агента обновления устройства и его зависимостей. Укажите имя агента обновления устройства и требуемую версию в манифесте APT, как и для любого другого пакета. Затем этот манифест APT можно импортировать и развернуть с помощью обновления устройства для конвейера центра Интернета вещей. 

## <a name="removing-packages"></a>Удаление пакетов

Вы также можете использовать манифест APT для удаления установленных пакетов с устройства. Для удаления, добавления и обновления нескольких пакетов можно использовать один манифест APT. Чтобы удалить пакет, добавьте знак минус "-" после имени пакета. Не следует включать номер версии удаляемых пакетов. Удаление пакетов через манифест apt не приводит к удалению его зависимостей и конфигураций.

Пример

```json
{
    "name": "contoso-video",
    "version": "2.0.0.1",
    "packages": [
        {
            "name" : "foo-"
        }
    ]
}
```
Этот манифест APT удалит пакет "foo" с устройств, на которых оно развернуто. 

## <a name="recommended-value-for-installed-criteria"></a>Рекомендуемое значение для установленных критериев

Установленные критерии для манифеста APT — это `<name>-<version>` `<name>` имя манифеста APT и `<version>` Версия манифеста APT. Например, `contoso-iot-edge-1.0.0.0`. 

## <a name="guidelines-on-creating-an-apt-manifest"></a>Рекомендации по созданию манифеста APT

При создании манифеста APT необходимо помнить о следующих рекомендациях.

- Всегда проследите, чтобы манифест APT был правильно сформированным файлом JSON.
- Каждый манифест APT должен иметь уникальную версию. Попробуйте создать стандартизированную методологию, чтобы увеличить версию манифеста APT, чтобы иметь смысл в сценариях и можно было легко следовать
- Когда речь идет о требуемом состоянии каждого отдельного пакета, укажите точное имя и версию пакета, который необходимо установить на устройстве. Всегда проверяйте значения в репозитории пакетов, который предполагается использовать в качестве источника для пакета.
- Убедитесь, что пакеты в манифесте APT перечислены в том порядке, в котором они должны быть установлены или удалены.
- Всегда проверяйте установку пакетов на тестовом устройстве, чтобы убедиться в том, что результат нужен.
- При установке определенной версии пакета (например, `iotedge 1.0.9-1` ) рекомендуется также использовать манифест APT для установки явных версий зависимых пакетов (например, `libiothsm 1.0.9-1` ).
- Хотя это не обязательно, всегда убедитесь, что манифест APT является кумулятивным, чтобы избежать неизвестного состояния устройства. Накопительное обновление обеспечит наличие у устройств нужной версии каждого интересующего вас пакета, даже если устройство пропустило развертывание обновления APT из-за сбоя установки или отключения.

Пример:

**Базовый манифест APT**

```JSON
{
    "name": "contoso-iot-edge",
    "version": "1.0",
    "packages": [
        {
            "name": "foo",
            "version": "1.0.1"
        }
    ]
}
```

**НЕВЕРНОЕ ОБНОВЛЕНИЕ**

Это обновление включает пакет Bar, но не пакет foo.

```JSON
{
    "name": "contoso-iot-edge",
    "version": "2.0",
    "packages": [
        {
            "name": "bar",
            "version": "3.0.2"
        }
    ]
}
```

**ХОРОШЕЕ ОБНОВЛЕНИЕ**

Это обновление включает в себя пакет foo, а также линейный пакет.

```JSON
{
    "name": "contoso-iot-edge",
    "version": "2.0",
    "packages": [
        {
            "name": "foo",
            "version": "1.0.1"
        },
        {
            "name": "bar",
            "version": "3.0.2"
        }
    ]
}
```

## <a name="next-steps"></a>Дальнейшие действия

> [!div class="nextstepaction"]
> [Импорт нового обновления](import-update.md)

