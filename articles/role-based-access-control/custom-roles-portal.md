---
title: Создание или обновление пользовательских ролей Azure с помощью портал Azure Azure RBAC
description: Узнайте, как создавать пользовательские роли Azure с помощью портал Azure и управления доступом на основе ролей Azure (Azure RBAC). Здесь приводится описание процедур получения списка, создания, обновления и удаления пользовательских ролей.
services: active-directory
documentationcenter: ''
author: rolyon
manager: mtillman
ms.service: role-based-access-control
ms.topic: how-to
ms.workload: identity
ms.date: 12/11/2020
ms.author: rolyon
ms.openlocfilehash: ecda0edcd34999e8cbb6c7ab9039953d17c119e5
ms.sourcegitcommit: 867cb1b7a1f3a1f0b427282c648d411d0ca4f81f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "97369232"
---
# <a name="create-or-update-azure-custom-roles-using-the-azure-portal"></a>Создание или обновление пользовательских ролей Azure с помощью портала Azure

Если [встроенные роли Azure](built-in-roles.md) не соответствуют конкретным потребностям Организации, можно создать собственные пользовательские роли Azure. Так же, как и встроенные роли, можно назначать пользовательские роли пользователям, группам и субъектам-службам в областях подписок и групп ресурсов. Настраиваемые роли хранятся в каталоге Azure Active Directory (Azure AD) и могут использоваться несколькими подписками. Каждый каталог может иметь до 5000 пользовательских ролей. Пользовательские роли можно создавать с помощью портал Azure, Azure PowerShell, Azure CLI или REST API. В этой статье описывается создание пользовательских ролей с помощью портал Azure.

## <a name="prerequisites"></a>Предварительные условия

Для создания пользовательских ролей в Azure требуются:

- разрешения на создание пользовательских ролей, такие как [Владелец](built-in-roles.md#owner) или [Администратор доступа пользователя](built-in-roles.md#user-access-administrator);

## <a name="step-1-determine-the-permissions-you-need"></a>Шаг 1. Определение необходимых разрешений

В Azure есть тысячи разрешений, которые потенциально можно включить в пользовательскую роль. Ниже приведены некоторые методы, которые могут помочь определить разрешения, которые нужно добавить в пользовательскую роль.

- Просмотрите существующие [встроенные роли](built-in-roles.md).
- Перечислите службы Azure, к которым вы хотите предоставить доступ.
- Определите [поставщиков ресурсов, которые сопоставляются со службами Azure](../azure-resource-manager/management/azure-services-resource-providers.md). Метод поиска описан далее в разделе [Шаг 4. разрешения](#step-4-permissions).
- Выполните поиск [доступных разрешений](resource-provider-operations.md) , чтобы найти разрешения, которые нужно включить. Метод поиска описан далее в разделе [Шаг 4. разрешения](#step-4-permissions).

## <a name="step-2-choose-how-to-start"></a>Шаг 2. Выбор способа запуска

Существует три способа, с помощью которых можно приступить к созданию пользовательской роли. Можно клонировать существующую роль, начать с нуля или начать с JSON-файла. Самый простой способ — найти существующую роль, имеющую большинство необходимых разрешений, а затем клонировать и изменить ее для вашего сценария. 

### <a name="clone-a-role"></a>Клонирование роли

Если у существующей роли нет необходимых разрешений, ее можно клонировать, а затем изменить разрешения. Чтобы приступить к клонированию роли, выполните следующие действия.

1. В портал Azure откройте подписку или группу ресурсов, в которой необходимо назначить настраиваемую роль, а затем откройте **Управление доступом (IAM)**.

    На следующем снимке экрана показана страница управления доступом (IAM), открытая для подписки.

    ![Страница управления доступом (IAM) для подписки](./media/custom-roles-portal/access-control-subscription.png)

1. Чтобы просмотреть список всех встроенных и пользовательских ролей, щелкните вкладку **Роли**.

1. Найдите роль, которую необходимо клонировать, например роль читателя выставления счетов.

1. В конце строки нажмите кнопку с многоточием (**...**) и выберите **клонировать**.

    ![Контекстное меню клонирования](./media/custom-roles-portal/clone-menu.png)

    Откроется редактор пользовательских ролей с выбранным параметром **клонировать роль роли** .

1. Перейдите к [шагу 3: основные сведения](#step-3-basics).

### <a name="start-from-scratch"></a>Создание клиента с нуля

При желании можно выполнить следующие действия, чтобы запустить пользовательскую роль с нуля.

1. В портал Azure откройте подписку или группу ресурсов, в которой необходимо назначить настраиваемую роль, а затем откройте **Управление доступом (IAM)**.

1. Нажмите кнопку **Добавить** , а затем — **добавить настраиваемую роль**.

    ![Меню добавления настраиваемой роли](./media/custom-roles-portal/add-custom-role-menu.png)

    Откроется редактор пользовательских ролей с выбранным параметром **начать с нуля** .

1. Перейдите к [шагу 3: основные сведения](#step-3-basics).

### <a name="start-from-json"></a>Запуск из JSON

При желании можно указать большую часть значений пользовательских ролей в JSON-файле. Можно открыть файл в редакторе пользовательских ролей, внести дополнительные изменения, а затем создать настраиваемую роль. Выполните следующие действия, чтобы начать с JSON-файла.

1. Создайте JSON-файл в следующем формате:

    ```json
    {
        "properties": {
            "roleName": "",
            "description": "",
            "assignableScopes": [],
            "permissions": [
                {
                    "actions": [],
                    "notActions": [],
                    "dataActions": [],
                    "notDataActions": []
                }
            ]
        }
    }
    ```

1. В файле JSON укажите значения для различных свойств. Ниже приведен пример с добавлением некоторых значений. Дополнительные сведения о различных свойствах см. в разделе сведения о [определениях ролей Azure](role-definitions.md).

    ```json
    {
        "properties": {
            "roleName": "Billing Reader Plus",
            "description": "Read billing data and download invoices",
            "assignableScopes": [
                "/subscriptions/11111111-1111-1111-1111-111111111111"
            ],
            "permissions": [
                {
                    "actions": [
                        "Microsoft.Authorization/*/read",
                        "Microsoft.Billing/*/read",
                        "Microsoft.Commerce/*/read",
                        "Microsoft.Consumption/*/read",
                        "Microsoft.Management/managementGroups/read",
                        "Microsoft.CostManagement/*/read",
                        "Microsoft.Support/*"
                    ],
                    "notActions": [],
                    "dataActions": [],
                    "notDataActions": []
                }
            ]
        }
    }
    ```
    
1. На портал Azure откройте страницу **управления доступом (IAM)** .

1. Нажмите кнопку **Добавить** , а затем — **добавить настраиваемую роль**.

    ![Меню добавления настраиваемой роли](./media/custom-roles-portal/add-custom-role-menu.png)

    Откроется редактор пользовательских ролей.

1. На вкладке основы в области **разрешения по базовому плану** выберите **Запуск из JSON**.

1. Нажмите кнопку Папка рядом с полем Выбор файла, чтобы открыть диалоговое окно Открыть.

1. Выберите файл JSON и нажмите кнопку **Открыть**.

1. Перейдите к [шагу 3: основные сведения](#step-3-basics).

## <a name="step-3-basics"></a>Шаг 3. Основные сведения

На вкладке **Основные сведения** укажите имя, описание и разрешения базового уровня для пользовательской роли.

1. В поле **имя пользовательской роли** укажите имя настраиваемой роли. Имя должно быть уникальным для каталога Azure AD. Имя может содержать буквы, цифры, пробелы и специальные символы.

1. В поле **Описание** укажите необязательное описание настраиваемой роли. Это станет подсказкой для пользовательской роли.

    Параметр **базовых разрешений** уже должен быть установлен на основе предыдущего шага, но его можно изменить.

    ![Вкладка "основные" с указанными значениями](./media/custom-roles-portal/basics-values.png)

## <a name="step-4-permissions"></a>Шаг 4. разрешения

На вкладке **разрешения** укажите разрешения для пользовательской роли. В зависимости от того, клонирована ли роль или если вы начали работу с JSON, на вкладке разрешения могут быть уже перечислены некоторые разрешения.

![Вкладка "разрешения" для создания настраиваемой роли](./media/custom-roles-portal/permissions.png)

### <a name="add-or-remove-permissions"></a>Добавление или удаление разрешений

Выполните следующие действия, чтобы добавить или удалить разрешения для пользовательской роли.

1. Чтобы добавить разрешения, нажмите кнопку **Добавить разрешения** , чтобы открыть панель Добавление разрешений.

    В этой области перечислены все доступные разрешения, сгруппированные по различным категориям в формате карты. Каждая категория представляет *поставщик ресурсов*, который является службой, предоставляющей ресурсы Azure.

1. В поле **Поиск разрешения** введите строку для поиска разрешений. Например, выполните поиск по *счету* , чтобы найти разрешения, связанные с накладной.

    Список карточек поставщика ресурсов будет отображаться на основе строки поиска. Список поставщиков ресурсов, сопоставляемых со службами Azure, см. в статье [поставщики ресурсов для служб Azure](../azure-resource-manager/management/azure-services-resource-providers.md).

    ![Панель "Добавление разрешений" с поставщиком ресурсов](./media/custom-roles-portal/add-permissions-provider.png)

1. Выберите карточку поставщика ресурсов, у которой могут быть разрешения, которые вы хотите добавить в настраиваемую роль, например, **выставление счетов Майкрософт**.

    Список разрешений управления для этого поставщика ресурсов отображается на основе строки поиска.

    ![Добавить список разрешений](./media/custom-roles-portal/add-permissions-list.png)

1. Если вы ищете разрешения, которые применяются к плоскости данных, щелкните **действия с данными**. В противном случае оставьте для переключателя действия значение **действия** , чтобы получить список разрешений, относящихся к плоскости управления. Дополнительные сведения о различиях между плоскостью управления и плоскостью данных см. в разделе [операции управления и работы с данными](role-definitions.md#management-and-data-operations).

1. При необходимости обновите строку поиска, чтобы уточнить поиск.

1. Найдя одно или несколько разрешений, которые нужно добавить в настраиваемую роль, добавьте флажок рядом с разрешениями. Например, установите флажок рядом с пунктом **другие: скачивание счета** , чтобы добавить разрешение на скачивание счетов.

1. Нажмите кнопку **Добавить** , чтобы добавить разрешение в список разрешений.

    Разрешение добавляется как `Actions` или `DataActions` .

    ![Добавлено разрешение](./media/custom-roles-portal/permissions-list-add.png)

1. Чтобы удалить разрешения, щелкните значок Удалить в конце строки. В этом примере, поскольку пользователю не требуется возможность создавать билеты поддержки, `Microsoft.Support/*` разрешение можно удалить.

### <a name="add-wildcard-permissions"></a>Добавление разрешений с подстановочными знаками

В зависимости от того, как вы решили начать работу, у вас могут быть разрешения с подстановочными знаками ( `*` ) в списке разрешений. Подстановочный знак ( `*` ) расширяет разрешение на все, что соответствует предоставленной строке действий. Например, следующая строка с подстановочными знаками добавляет все разрешения, связанные с управлением затратами Azure и экспортами. Сюда также входят все будущие разрешения экспорта, которые могут быть добавлены.

```
Microsoft.CostManagement/exports/*
```

Если вы хотите добавить новое разрешение с подстановочными знаками, вы не сможете добавить его с помощью панели **Добавление разрешений** . Чтобы добавить разрешение с подстановочными знаками, необходимо добавить его вручную с помощью вкладки **JSON** . Дополнительные сведения см. в разделе [Шаг 6. JSON](#step-6-json).

### <a name="exclude-permissions"></a>Исключить разрешения

Если у вашей роли есть разрешение с подстановочным знаком ( `*` ) и вы хотите исключить или вычесть определенные разрешения из этого разрешения, можно исключить их. Например, предположим, что у вас есть следующее разрешение с подстановочными знаками:

```
Microsoft.CostManagement/exports/*
```

Если вы не хотите разрешать удаление экспорта, можно исключить следующее разрешение Delete:

```
Microsoft.CostManagement/exports/delete
```

При исключении разрешения оно добавляется как `NotActions` или `NotDataActions` . Действующие разрешения на управление вычисляются путем добавления всех, `Actions` а затем вычитания всех значений `NotActions` . Эффективные разрешения на доступ к данным вычисляются путем добавления всех, `DataActions` а затем вычитания всех значений `NotDataActions` .

> [!NOTE]
> Исключение разрешения не совпадает с разрешением Deny. Исключение разрешений — это просто удобный способ вычитания разрешений из разрешения на использование подстановочных знаков.

1. Чтобы исключить или вычесть разрешение из разрешенного подстановочного знака, нажмите кнопку **исключить разрешения** , чтобы открыть панель разрешения исключения.

    На этой панели можно указать разрешения на управление или данные, которые исключены или вычитаются.

1. Найдя одно или несколько разрешений, которые необходимо исключить, добавьте флажок рядом с разрешениями и нажмите кнопку **Добавить** .

    ![Область "исключить разрешения" — выбрано разрешение](./media/custom-roles-portal/exclude-permissions-select.png)

    Разрешение добавляется как `NotActions` или `NotDataActions` .

    ![Исключенное разрешение](./media/custom-roles-portal/exclude-permissions-list-add.png)

## <a name="step-5-assignable-scopes"></a>Шаг 5. назначаемые области

На вкладке **назначаемые области** укажите, где пользовательская роль доступна для назначения, например подписка или группа ресурсов. В зависимости от того, как вы решили начать работу, на этой вкладке может отображаться область, в которой была открыта страница управления доступом (IAM). Установка назначаемой области в корневую область ("/") не поддерживается. В настоящее время группу управления нельзя добавить в качестве назначаемой области.

1. Щелкните **Добавить назначаемые области** , чтобы открыть область добавить назначаемые области.

    ![Вкладка «назначаемые области»](./media/custom-roles-portal/assignable-scopes.png)

1. Щелкните одну или несколько областей, которые вы хотите использовать, как правило, для подписки.

    ![Добавить назначаемые области](./media/custom-roles-portal/add-assignable-scopes.png)

1. Нажмите кнопку **Добавить** , чтобы добавить назначаемую область.

## <a name="step-6-json"></a>Шаг 6. JSON

На вкладке **JSON** вы видите пользовательскую роль в формате JSON. При необходимости можно напрямую изменить JSON. Если вы хотите добавить разрешение с подстановочным знаком ( `*` ), необходимо использовать эту вкладку.

1. Чтобы изменить JSON, нажмите кнопку **изменить**.

    ![Вкладка JSON с пользовательской ролью](./media/custom-roles-portal/json.png)

1. Внесите изменения в JSON.

    Если формат JSON не отформатирован должным образом, вы увидите красную зубчатую линию и индикатор в вертикальном расположении.

1. По завершении редактирования нажмите кнопку **сохранить**.

## <a name="step-7-review--create"></a>Шаг 7. Проверка и создание

На вкладке " **Проверка и создание** " можно проверить параметры настраиваемой роли.

1. Проверьте параметры пользовательской роли.

    ![Вкладка "Просмотр и создание"](./media/custom-roles-portal/review-create.png)

1. Нажмите кнопку **создать** , чтобы создать настраиваемую роль.

    Через несколько секунд появится окно сообщения с сообщением о том, что пользовательская роль была успешно создана.

    ![Создание настраиваемого сообщения роли](./media/custom-roles-portal/custom-role-success.png)

    Если обнаружены какие-либо ошибки, появится сообщение.

    ![Проверка и создание ошибки](./media/custom-roles-portal/review-create-error.png)

1. Просмотрите новую настраиваемую роль в списке **ролей** . Если пользовательская роль не отображается, нажмите кнопку **Обновить**.

     Для того чтобы пользовательская роль отображалась везде, может потребоваться несколько минут.

## <a name="list-custom-roles"></a>Вывод списка настраиваемых ролей

Выполните следующие действия, чтобы просмотреть пользовательские роли.

1. Откройте подписку или группу ресурсов и откройте **Управление доступом (IAM)**.

1. Чтобы просмотреть список всех встроенных и пользовательских ролей, щелкните вкладку **Роли**.

1. В списке **тип** выберите **кустомроле** , чтобы открыть только свои пользовательские роли.

    Если вы только что создали пользовательскую роль и вы не видите ее в списке, нажмите кнопку **Обновить**.

    ![Список настраиваемых ролей](./media/custom-roles-portal/custom-role-list.png)

## <a name="update-a-custom-role"></a>Обновление пользовательской роли

1. Как описано ранее в этой статье, откройте список пользовательских ролей.

1. Нажмите кнопку с многоточием (**...**) для настраиваемой роли, которую необходимо обновить, а затем нажмите кнопку **изменить**. Обратите внимание, что нельзя обновлять встроенные роли.

    Пользовательская роль открывается в редакторе.

    ![Меню настраиваемой роли](./media/custom-roles-portal/edit-menu.png)

1. Используйте разные вкладки для обновления пользовательской роли.

1. Завершив внесение изменений, щелкните вкладку **Проверка и создание** , чтобы проверить изменения.

1. Нажмите кнопку **Обновить** , чтобы обновить пользовательскую роль.

## <a name="delete-a-custom-role"></a>Удаление настраиваемой роли

1. Как описано ранее в этой статье, откройте список пользовательских ролей.

1. Удалите все назначения ролей, использующие настраиваемую роль.

1. Нажмите кнопку с многоточием (**...**) для настраиваемой роли, которую необходимо удалить, и нажмите кнопку **Удалить**.

    ![Снимок экрана, на котором показан список пользовательских ролей, которые можно выбрать для удаления.](./media/custom-roles-portal/delete-menu.png)

    Для полного удаления пользовательской роли может потребоваться несколько минут.

## <a name="next-steps"></a>Дальнейшие действия

- [Руководство по Создание настраиваемой роли Azure с помощью Azure PowerShell](tutorial-custom-role-powershell.md)
- [Настраиваемые роли Azure](custom-roles.md)
- [Операции с поставщиками ресурсов Azure](resource-provider-operations.md)
