---
title: Общие сведения о высокой доступности с избыточностью зоны с помощью базы данных Azure для гибкого сервера MySQL
description: Сведения о принципах обеспечения высокой доступности с избыточностью зоны с помощью базы данных Azure для гибкого сервера MySQL
author: savjani
ms.author: pariks
ms.service: mysql
ms.topic: conceptual
ms.date: 01/29/2021
ms.openlocfilehash: 6629beacb5c3edc6fe1d21509051b915c0894479
ms.sourcegitcommit: bed20f85722deec33050e0d8881e465f94c79ac2
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/25/2021
ms.locfileid: "105109698"
---
# <a name="high-availability-concepts-in-azure-database-for-mysql-flexible-server-preview"></a>Основные понятия высокой доступности в базе данных Azure для гибкого сервера MySQL (Предварительная версия)

> [!IMPORTANT] 
> Сейчас предоставляется общедоступная предварительная версия Гибкого сервера Базы данных Azure для MySQL.

База данных Azure для гибкого сервера MySQL (Предварительная версия) позволяет настроить высокий уровень доступности при автоматическом переходе на другой ресурс с помощью параметра высокой доступности **зоны с избыточностью** . При развертывании в избыточной между зонами конфигурации гибкий сервер автоматически подготавливает ожидающую реплику в другой зоне доступности и управляет ею. При использовании репликации на уровне хранилища данные **синхронно реплицируются** на резервный сервер во вторичной зоне, чтобы обеспечить нулевую потери данных после отработки отказа. Отработка отказа полностью прозрачна для клиентского приложения и не требует каких-либо действий пользователя. Резервный сервер недоступен для операций чтения или записи, но является пассивным резервом для включения быстрой отработки отказа. Время отработки отказа обычно составляет от 60-120 секунд.

Конфигурация высокой доступности с избыточностью в зонах позволяет автоматически отработку отказа во время запланированных событий, например инициированных пользователем операций масштабирования, и незапланированных событий, таких как ошибки оборудования и программного обеспечения, сбои сети и даже сбои зоны доступности.

:::image type="content" source="./media/concepts-high-availability/1-flexible-server-overview-zone-redundant-ha.png" alt-text="представление высокой доступности с избыточностью зоны":::

## <a name="zone-redundancy-architecture"></a>Архитектура избыточности зоны

Сервер-источник развертывается в регионе и в определенной зоне доступности. При выборе высокого уровня доступности автоматически развертывается резервный сервер реплики с той же конфигурацией, что и у сервера-источника, включая уровень вычислений, размер вычислений, размер хранилища и конфигурацию сети. Данные журнала синхронно реплицируются на резервную реплику, чтобы гарантировать отсутствие потерь данных в любой ситуации сбоя. Автоматическое резервное копирование, моментальные снимки и резервные копии журналов выполняются с сервера базы данных — источника. 

Работоспособность высокой доступности постоянно отслеживается и сообщается на странице обзора.

Ниже перечислены различные состояния репликации.

| **Состояние** | **Описание** |
| :----- | :------ |
| <b>нотенаблед | Избыточность в зоне доступности не включена |
| <b>креатингстандби | В процессе создания нового режима ожидания |
| <b>репликатингдата | После создания резервного сервера он будет перехватываться с сервером-источником. |
| <b>фаилинговер | Сервер базы данных находится в процессе отработки отказа с основного сервера на резервный. |
| <b>Работоспособно | Избыточность в зоне доступности находится в стабильном состоянии и работоспособности. |
| <b>ремовингстандби | В зависимости от действия пользователя резервная реплика находится в процессе удаления.| 

## <a name="advantages"></a>Преимущества

Ниже приведены некоторые преимущества использования функции обеспечения доступности избыточности зоны. 

- Резервная реплика развертывается в точной конфигурации виртуальной машины, как в основном, например виртуальных ядер, хранилище, сетевые параметры (VNET, Firewall) и т. д.
- Возможность удаления резервной реплики путем отключения высокого уровня доступности.
- Автоматическое резервное копирование основано на моментальном снимке, выполняется с сервера базы данных-источника и хранится в хранилище, избыточном в виде зоны.
- В случае отработки отказа гибкий сервер базы данных Azure для MySQL автоматически переходит на резервную реплику, если включена высокая доступность. Настройка высокой доступности наблюдает за сервером-источником и переводит его в режим «в сети».
- Клиенты всегда подключаются к основному серверу базы данных.
- В случае сбоя в работе базы данных или узла сначала выполняется попытка перезапуска на том же узле. Если это не удается, запускается автоматический переход на другой ресурс.
- Возможность перезапуска сервера для сбора любых изменений статических параметров сервера.

## <a name="steady-state-operations"></a>Операции с постоянным состоянием

Приложения подключаются к основному серверу с использованием имени сервера базы данных. Сведения о резервной реплике не предоставляются для прямого доступа. Фиксации и записи подтверждаются в приложении только после того, как файлы журнала сохраняются на диске сервера-источника и в резервной реплике синхронно. В связи с этим дополнительным требованием приема-передачи приложения могут задействовать повышенную задержку для операций записи и фиксаций. Вы можете отслеживать работоспособность высокого уровня доступности на портале.

## <a name="failover-process"></a>Процесс отработки отказа 
Для обеспечения непрерывности бизнес-процессов требуется процесс отработки отказа для запланированных и незапланированных событий. 

### <a name="planned-events"></a>Запланированные события

Запланированные события простоя включают в себя действия, запланированные Azure, такие как периодические обновления программного обеспечения, обновления дополнительных версий или инициированные клиентами, такие как масштабирование вычислений и масштабирование операций хранения. Все эти изменения сначала применяются к резервной реплике. В течение этого времени приложения продолжат получать доступ к основному серверу. После обновления резервной реплики происходит сток подключений к первичному серверу, после чего активируется отработка отказа, при которой резервная реплика становится первичной с тем же именем сервера базы данных путем обновления записи DNS. Клиентские подключения отключаются, и им требуется повторное подключение и возобновление их работы. Новый резервный сервер устанавливается в той же зоне, что и старая база данных-источник. Общее время отработки отказа должно составлять 60-120 с. 

>[!NOTE]
> В случае операции масштабирования вычислений выполняется масштабирование сервера вторичной реплики, за которым следует сервер-источник. Отработка отказа не задействована.

### <a name="failover-process---unplanned-events"></a>Процесс отработки отказа — незапланированные события
Незапланированные простои служб включают ошибки программного обеспечения, связанные с ошибками инфраструктуры, такие как вычисление, сеть, сбои хранилища или перебои электроэнергии, которые влияют на доступность базы данных. В случае недоступности базы данных репликация в резервную реплику является критической, а резервная реплика активируется в качестве базы данных-источника. DNS обновляется, а затем клиенты повторно подключаются к серверу базы данных и возобновляют свои операции. Общее время отработки отказа должно занять 60-120 с. Однако в зависимости от активности на сервере базы данных — в момент отработки отказа, например больших транзакций и времени восстановления, отработка отказа может занять больше длительности.

## <a name="schedule-maintenance-window"></a>Расписание периода обслуживания 

Гибкие серверы предлагают возможность планирования обслуживания, когда вы можете выбрать 30-минутное окно в день своего предпочтения, в течение которого будет выполняться обслуживание Azure, например обновление или обновление вспомогательных версий. Для гибких серверов, настроенных с высокой доступностью, эти действия по обслуживанию выполняются сначала на резервной реплике. 

## <a name="point-in-time-restore"></a>Восстановление на момент времени 
Так как гибкий сервер настроен в режиме высокой доступности, синхронно реплицирует данные, резервный сервер в основном обновляется. Любые ошибки пользователей на основном уровне, например случайное удаление таблицы или неправильных обновлений, точно реплицируются в ждущий режим. Таким образом, нельзя использовать режим standby для восстановления после таких логических сбоев. Для восстановления после этих логических ошибок необходимо выполнить восстановление на момент времени до возникновения ошибки. При использовании гибкой функции восстановления на момент времени при восстановлении базы данных, настроенной с высоким уровнем доступности, новый сервер базы данных восстанавливается в качестве нового гибкого сервера с именем, предоставленным пользователем. Затем можно экспортировать объект с сервера базы данных и импортировать его на сервер рабочей базы данных. Аналогично, если вы хотите клонировать сервер базы данных для тестирования и разработки или хотите выполнить восстановление для любых других целей, можно выбрать последнюю точку восстановления или пользовательскую точку восстановления. Операция восстановления создает гибкий сервер с одной зоной.

## <a name="mitigate-downtime"></a>Снижение времени простоя 
Если вы не используете функцию избыточности зоны, необходимо по-прежнему иметь возможность снизить время простоя приложения. Планирование простоев служб, таких как запланированные исправления, обновления дополнительных версий или операции, инициированные пользователем, могут выполняться как часть запланированных периодов обслуживания. Запланированные простои служб, такие как запланированные исправления, обновления дополнительных версий или операции, инициированные пользователем, такие как масштабируемое вычисление, возобновляют время простоя. Чтобы уменьшить воздействие приложения на задачи обслуживания, инициированные Azure, вы можете запланировать их в течение дня недели и времени, которое по крайней мере влияет на приложение. 

Во время незапланированных событий простоя, таких как сбой базы данных или сбой сервера, затронутый сервер перезапускается в той же зоне. Несмотря на редкие случаи, если на всю зону влияет вся зона, базу данных можно восстановить в другой зоне в пределах региона. 

## <a name="things-to-know-with-zone-redundancy"></a>Сведения о избыточности зоны 

Ниже приведены некоторые соображения, которые следует учитывать при использовании обеспечения высокой доступности для избыточности зоны. 

- Высокий уровень доступности можно задать **только** во время создания гибкого сервера.
- Высокий уровень доступности не поддерживается на уровне пакетного вычислений.
- Из-за синхронной репликации в другую зону доступности основной сервер базы данных может столкнуться с повышенной задержкой записи и фиксации.
- Резервную реплику нельзя использовать для запросов только для чтения.
- В зависимости от активности на сервере источника во время отработки отказа выполнение отработки отказа может занять до 60-120 секунд или дольше.
- Перезапуск сервера базы данных источника для получения изменений статических параметров также перезапускает резервную реплику.
- Настройка реплик чтения для серверов с высоким уровнем доступности, избыточных в зонах, не поддерживается.
- Настройка задач управления, инициированных клиентом, не может быть автоматизирована во время управляемого окна обслуживания.
- Запланированные события, такие как обновление масштабных и промежуточных версий, происходят одновременно в основном и в резервном состоянии. 


## <a name="next-steps"></a>Следующие шаги

- Сведения о [непрерывности бизнес-процессов](./concepts-business-continuity.md)
- Сведения о [высокой доступности с избыточностью зоны](./concepts-high-availability.md)
- Сведения о [резервном копировании и восстановлении](./concepts-backup-restore.md)
