---
title: Резервное копирование и восстановление в базе данных Azure для гибкого сервера MySQL
description: Сведения о концепциях резервного копирования и восстановления с помощью базы данных Azure для гибкого сервера MySQL
author: mksuni
ms.author: sumuth
ms.service: mysql
ms.topic: conceptual
ms.date: 09/21/2020
ms.openlocfilehash: 2d69427f9f11a47cedeccb4b1da38b770952f029
ms.sourcegitcommit: 910a1a38711966cb171050db245fc3b22abc8c5f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "93240772"
---
# <a name="backup-and-restore-in-azure-database-for-mysql-flexible-server-preview"></a>Резервное копирование и восстановление в базе данных Azure для гибкого сервера MySQL (Предварительная версия)

> [!IMPORTANT] 
> Сейчас предоставляется общедоступная предварительная версия Гибкого сервера Базы данных Azure для MySQL.

База данных Azure для гибкого сервера MySQL автоматически создает резервные копии сервера и безопасно сохраняет их в локальном избыточном хранилище в пределах региона. Резервные копии можно использовать для восстановления сервера до точки во времени. Резервное копирование и восстановление данных являются важной частью любой стратегии непрерывности бизнес-процессов. Таким образом данные защищаются от случайного повреждения или удаления.

## <a name="backup-overview"></a>Обзор службы Azure Backup

Гибкий сервер выполняет резервное копирование моментальных снимков файлов данных и сохраняет их в локальном избыточном хранилище. Сервер также выполняет резервное копирование журналов транзакций, а также сохраняет их в локальном избыточном хранилище. При помощи этих резервных копий вы можете восстановить сервер до любой точки во времени в пределах заданного срока хранения резервных копий. По умолчанию срок хранения резервных копий составляет 7 дней. При необходимости можно настроить резервное копирование базы данных от 1 до 35 дней. Все резервные копии шифруются с использованием шифрования AES 256-bit для неактивных данных.

Эти файлы резервных копий не могут быть экспортированы. Резервные копии можно использовать только для операций восстановления на гибком сервере. Для копирования базы данных можно также использовать [mysqldump](../concepts-migrate-dump-restore.md#dump-and-restore-using-mysqldump-utility) из клиента MySQL.

## <a name="backup-frequency"></a>Частота резервного копирования

Резервное копирование на гибких серверах основано на моментальных снимках. Первая полная резервная копия моментального снимка планируется сразу же после создания сервера. Первая полная резервная копия моментальных снимков сохраняется как базовая резервная копия сервера. Последующие резервные копии моментальных снимков — это только разностные резервные копии.

Разностные резервные копии моментальных снимков создаются по крайней мере один раз в день. Разностные резервные копии моментальных снимков не создаются по фиксированному расписанию. Разностное резервное копирование моментальных снимков выполняется каждые 24 часа, если только размер двоичных журналов в MySQL не превышает 50 ГБ с момента создания последней разностной резервной копии. В день разрешено создание не более шести разностных моментальных снимков. Создание резервных копий журналов транзакций происходит каждые 5 минут.

## <a name="backup-retention"></a>Хранение архивных копий

Резервные копии баз данных хранятся в локальном избыточном хранилище (LRS), которое хранится в трех копиях в пределах одного региона. Резервные копии сохраняются на основе параметра срок хранения резервной копии на сервере. Можно выбрать срок хранения от 1 до 35 дней с периодом хранения по умолчанию 7 дней. Период хранения можно задать во время создания сервера или позже, обновив конфигурацию резервного копирования с помощью портал Azure.

Срок хранения резервной копии зависит от того, насколько далеко назад можно выполнить операцию восстановления на определенный момент времени, так как она основана на доступных резервных копиях. Срок хранения резервной копии можно также рассматривать как окно восстановления с точки зрения восстановления. Все резервные копии, необходимые для выполнения восстановления на определенный момент времени в течение срока хранения резервной копии, сохраняются в хранилище резервных копий. Например, если срок хранения резервной копии равен семи дням, окно восстановления считается за последние семь дней. В этом сценарии сохраняются все резервные копии, необходимые для восстановления сервера за последние семь дней. Если период хранения резервных копий составляет семь дней, моментальные снимки базы данных и резервные копии журналов транзакций хранятся за последние восемь дней (1 день до окна).

## <a name="backup-storage-cost"></a>Стоимость хранилищ резервных копий

Гибкий сервер предоставляет до 100% подготовленного хранилища сервера в качестве хранилища резервных копий без дополнительных затрат. За любое дополнительное используемое хранилище резервных копий начислено за ГБ в месяц. Например, если вы подготовили сервер с 250 ГБ хранилища, для резервных копий сервера доступно 250 ГБ хранилища без дополнительной платы. Если используется ежедневное резервное копирование 25 ГБ, вы можете использовать бесплатную резервную копию в течение 10 дней. Плата за использование хранилища для резервных копий превышает 250 ГБ в соответствии с [моделью ценообразования](https://azure.microsoft.com/pricing/details/mysql/).

Для отслеживания хранилища резервных копий, используемого сервером, можно использовать [хранилище резервных копий, используемое](../concepts-monitoring.md) в Azure Monitor, доступное в портал Azure. Используемая метрика **хранилища резервных копий** представляет собой сумму хранилища, потребляемую всеми резервными копиями и резервными копиями журналов, которые хранятся на основе срока хранения резервной копии, заданного для сервера. Высокая активность транзакций на сервере может привести к увеличению использования хранилища резервных копий, независимо от общего размера базы данных.

Основным способом управления стоимостью хранилища резервных копий является установка соответствующего срока хранения резервной копии. Можно выбрать период хранения от 1 до 35 дней.

> [!IMPORTANT]
> Резервные копии с сервера базы данных, настроенного в конфигурации высокой доступности с избыточностью зоны, происходят с сервера базы данных-источника, так как затраты минимальны при резервном копировании моментальных снимков.

> [!IMPORTANT]
> Геоизбыточные резервные копии в настоящее время не поддерживаются гибким сервером.

## <a name="point-in-time-restore"></a>Восстановление на момент времени

В базе данных Azure для гибкого сервера MySQL выполнение восстановления на момент времени создает новый сервер из резервных копий гибкого сервера в том же регионе, что и исходный сервер. Он создается с конфигурацией исходного сервера для уровня вычислений, количеством виртуальных ядер, размером хранилища, сроком хранения резервной копии и параметром избыточности резервного копирования. Кроме того, теги и параметры, такие как виртуальная сеть и брандмауэр, наследуются от исходного сервера. После завершения восстановления можно изменить конфигурацию и уровень хранилища для восстановленного сервера.

> [!NOTE]
> Существуют два параметра сервера, которые сбрасываются в значения по умолчанию (и не копируются с сервера-источника) после операции восстановления.
> *   time_zone — это значение, которое будет иметь значение система по УМОЛЧАНИю
> *   event_scheduler — event_scheduler на восстановленном сервере имеет значение OFF.

Восстановление до точки во времени подходит для большинства сценариев. Некоторые из типичных вариантов использования:
-   Когда пользователь случайно удаляет данные из базы данных
-   Пользователь удаляет важную таблицу или базу данных
-   Пользовательское приложение случайно перезаписывает хорошие данные с неправильными данными из-за дефекта приложения.

С помощью [портал Azure](how-to-restore-server-portal.md)можно выбрать последнюю точку восстановления и настраиваемую точку восстановления.

-   **Последняя точка восстановления**. Последняя точка восстановления позволяет восстановить сервер до последней резервной копии, выполненной на исходном сервере. Метка времени для восстановления также будет отображаться на портале. Этот параметр полезен для быстрого восстановления сервера до наиболее обновленного состояния.
-   **Пользовательская точка восстановления**. Это позволит выбрать любой момент времени в течение срока хранения, определенного для этого гибкого сервера. Этот параметр полезен для восстановления сервера на определенный момент времени для восстановления после ошибки пользователя.

Расчетное время восстановления зависит от нескольких факторов, включая размеры баз данных, размер резервной копии журнала транзакций, размер SKU, а также время восстановления. Восстановление журнала транзакций — это наиболее продолжительная часть процесса восстановления. Если время восстановления выбрано ближе к полному или разностному расписанию резервного копирования моментальных снимков, восстановление выполняется быстрее, так как приложение журнала транзакций является минимальным. Чтобы оценить точное время восстановления для сервера, мы настоятельно рекомендуем протестировать его в своей среде, так как в нем слишком много переменных, зависящих от среды.

> [!IMPORTANT]
> При восстановлении гибкого сервера, для которого настроена высокая доступность в пределах зоны, восстановленный сервер будет настроен в том же регионе и в зоне, что и сервер-источник, и развертываться как один гибкий сервер в режиме без высокой доступности. Для гибкого сервера см. сведения о [высокой доступности в зонах](concepts-high-availability.md) .

> [!IMPORTANT]
> Удаленные серверы **нельзя** восстановить. Если вы удалите сервер, все связанные с ним базы данных также будут удалены без возможности восстановления. Чтобы защитить ресурсы сервера после развертывания от случайного удаления или внесения непредвиденных изменений, администраторы могут использовать [блокировки управления](../../azure-resource-manager/management/lock-resources.md).

## <a name="perform-post-restore-tasks"></a>Задачи после восстановления

После восстановления из **последней точки восстановления** или механизма восстановления с помощью **настраиваемой точки восстановления** необходимо выполнить следующие задачи, чтобы сделать резервную копию и запуск пользователей и приложений:

-   Если новый сервер предназначен для замены исходного сервера, перенаправьте клиенты и клиентские приложения на новый сервер.
-   Убедитесь, что для подключения пользователей необходимо установить соответствующие правила брандмауэра на уровне сервера и виртуальной сети.
-   Убедитесь, что имеются соответствующие имена входа и разрешения уровня базы данных.
-   Настройте оповещения соответствующим образом.

## <a name="next-steps"></a>Дальнейшие действия

-   Сведения о [непрерывности бизнес-процессов](./concepts-business-continuity.md)
-   Сведения о [высокой доступности с избыточностью зоны](./concepts-high-availability.md)
-   Сведения о [резервном копировании и восстановлении](./concepts-backup-restore.md)
