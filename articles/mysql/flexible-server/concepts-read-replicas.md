---
title: Чтение реплик с базой данных Azure для MySQL — гибкий сервер
description: 'Сведения о репликах чтения в базе данных Azure для гибкого сервера MySQL: создание реплик, подключение к репликам, мониторинг репликации и остановка репликации.'
author: ambhatna
ms.author: ambhatna
ms.service: mysql
ms.topic: conceptual
ms.date: 01/14/2021
ms.openlocfilehash: fa7cc9b9a09bfd2bc503640272b5e7ac3a0a7b58
ms.sourcegitcommit: 910a1a38711966cb171050db245fc3b22abc8c5f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "98251307"
---
# <a name="read-replicas-in-azure-database-for-mysql---flexible-server"></a>Чтение реплик в базе данных Azure для MySQL — гибкого сервера

> [!IMPORTANT]
> Чтение реплик в базе данных Azure для MySQL — гибкий сервер находится на этапе предварительной версии.

MySQL является популярным ядром базы данных для поддержки мобильных и веб-приложений в Интернете. Многие наши клиенты используют его для образовательных веб-служб, служб потоковой передачи видео, решений для цифровых платежей, платформ торговли по Интернету, игр, порталов новостей, а также веб-сайтов государственных учреждений и здравоохранения. Эти службы нужны для обслуживания и масштабирования по мере роста трафика в мобильных и веб-приложениях.

На стороне приложений приложение обычно разрабатывается на Java или PHP и переносится для запуска в масштабируемых наборах виртуальных машин Azure или служб приложений Azure или контейнеры для запуска в службе Kubernetes Azure (AKS). Использование масштабируемого набора виртуальных машин, Службы приложений или AKS в качестве базовой инфраструктуры упрощает масштабирование приложений за счет мгновенной подготовки новых виртуальных машин и репликации компонентов приложений без отслеживания состояния обеспечения работы запросов. Однако в таком случае база данных становится централизованным компонентом отслеживания состояния, что часто делает ее узким местом.

Функция реплики чтения позволяет реплицировать данные с гибкого сервера Базы данных Azure для MySQL на сервер, предназначенный только для чтения. Репликацию можно выполнять с исходного сервера до **10** реплик. Реплики чтения асинхронно обновляются с помощью технологии репликации на основе позиции файла собственного двоичного журнала (binlog) ядра MySQL. Дополнительные сведения о репликации binlog MySQL см. в [этой статье](https://dev.mysql.com/doc/refman/5.7/en/binlog-replication-configuration-overview.html).

Реплики — это новые серверы, которыми вы управляете, как и в исходной базе данных Azure для гибких серверов MySQL. Плата взимается за каждую реплику чтения на основе подготовленных вычислений в виртуальных ядер и хранилище в ГБ/месяц. Дополнительные сведения см. в разделе [цены](./concepts-compute-storage.md#pricing).

Дополнительные сведения о функциях и проблемах репликации MySQL см. в [документации по репликации MySQL](https://dev.mysql.com/doc/refman/5.7/en/replication-features.html).

> [!NOTE]
> Эта статья содержит ссылки на термин « _Ведомый_» термин, который корпорация Майкрософт больше не использует. Когда этот термин будет удален из программного обеспечения, мы удалим его из статьи.
>

## <a name="common-use-cases-for-read-replica"></a>Распространенные варианты использования для чтения реплики

Компонент "Реплика чтения" помогает повысить производительность и масштабируемость рабочих нагрузок с высокой интенсивностью чтения. Рабочие нагрузки чтения могут быть изолированы от реплик, тогда как рабочие нагрузки записи могут направляться в источник.

Распространенные сценарии:

* Масштабирование рабочих нагрузок чтения из приложения с помощью прокси-сервера упрощенного подключения, например [проксискл](https://aka.ms/ProxySQLLoadBalanceReplica) , или с помощью шаблона на основе микрослужб для масштабирования запросов чтения, поступающих от приложения, на чтение реплик.
* Рабочие нагрузки бизнес-аналитики или аналитических отчетов могут использовать реплики чтения в качестве источника данных для отчетов
* Для продукта IoT или производственной ситуации, когда данные телеметрии принимаются в ядро СУБД MySQL, в то время как несколько реплик чтения используются для создания отчетов о данных.

Так как реплики доступны только для чтения, они не снижают нагрузку на ресурсы напрямую. Этот компонент не предназначен для рабочих нагрузок с интенсивной записью.

В реплике чтения используется асинхронная репликация MySQL. Этот компонент также не предназначен для сценариев синхронной репликации. Между источником и репликой возникает измеряемая задержка. Данные в реплике в конечном итоге согласовываются с данными в источнике. Используйте этот компонент только для таких рабочих нагрузок, которым не страшна такая задержка.

## <a name="create-a-replica"></a>Создание реплики

Если на исходном сервере нет серверов реплики, источник сначала перезапускается для подготовки к репликации.

При запуске рабочего процесса создания реплики создается пустой сервер службы "База данных Azure для MySQL". Новый сервер заполняется данными, которые были на исходном сервере. Время создания зависит от объема данных в источнике и времени, прошедших с момента создания последней еженедельной полной архивации. Время может варьироваться от нескольких минут до нескольких часов.

> [!NOTE]
> Реплики чтения создаются с той же конфигурацией сервера, что и источник. Вы можете изменить созданную конфигурацию сервера-реплики. Сервер реплики всегда создается в той же группе ресурсов, что и исходный сервер, и ту же самую подписку. Если вы хотите создать сервер реплики в другой группе ресурсов или другой подписке, можно [переместить сервер реплики](../../azure-resource-manager/management/move-resource-group-and-subscription.md) после его создания. Рекомендуется, чтобы конфигурация сервера реплики хранилась в значениях, равных или превышающих источник, чтобы гарантировать, что реплика сможет справиться с источником.

Дополнительные сведения о создании реплики чтения на портале Azure см. [здесь](how-to-read-replicas-portal.md).

## <a name="connect-to-a-replica"></a>Подключение к реплике

При создании реплика наследует метод подключения исходного сервера. Невозможно изменить метод подключения реплики. Например, если исходный сервер имеет **частный доступ (интеграция с виртуальной сетью)** , реплика не может быть общедоступной **(разрешенные IP-адреса)**.

Реплика наследует учетную запись администратора от исходного сервера. Все учетные записи пользователей на исходном сервере реплицируются на реплики чтения. Подключиться к реплике чтения можно только с помощью учетных записей пользователей, доступных на исходном сервере.

Вы можете подключиться к реплике, используя ее имя узла и допустимую учетную запись пользователя, как и на обычной базе данных Azure для гибкого сервера MySQL. Например, для сервера с именем **myreplica** и именем пользователя с правами администратора **myadmin** подключение будет выполняться с помощью CLI mysql:

```bash
mysql -h myreplica.mysql.database.azure.com -u myadmin -p
```

При появлении запроса введите пароль для учетной записи пользователя.

## <a name="monitor-replication"></a>Мониторинг репликации

База данных Azure для гибкого сервера MySQL обеспечивает **задержку репликации в секундах** в Azure Monitor. Эта метрика доступна только для реплик. Эта метрика вычисляется на основе метрики `seconds_behind_master`, которую можно получить с помощью команды MySQL `SHOW SLAVE STATUS`. Настройте оповещение, чтобы сообщить вам, когда задержка репликации достигнет значения, неприемлемого для вашей рабочей нагрузки.

Если вы видите увеличенную задержку репликации, см. статью [Устранение неполадок репликации](./../howto-troubleshoot-replication-latency.md) для устранения неполадок и выявления возможных причин.

## <a name="stop-replication"></a>Остановка репликации

Можно отключить репликацию между источником и репликой. После остановки репликации между исходным сервером и репликой чтения реплика становится автономным сервером. На отдельном сервере сохраняются все данные, которые существовали на нем на момент запуска команды "Остановить репликацию". Изолированный сервер не перехватывается с исходным сервером.

Если вы решили отключить репликацию в реплике, она теряет все ссылки на предыдущие исходные и другие реплики. Автоматическая отработка отказа между источником и его репликой отсутствует.

> [!IMPORTANT]
> Это сервер нельзя снова преобразовать в реплику.
> Прежде, чем останавливать репликацию в реплике чтения убедитесь, что реплика содержит все необходимые данные.

Процесс остановки репликации описан в [этой статье](how-to-read-replicas-portal.md).

## <a name="failover"></a>Отработка отказа

Автоматическая отработка отказа между серверами источника и реплики отсутствует.

Реплики чтения предназначены для масштабирования рабочих нагрузок с интенсивным чтением и не предназначены для удовлетворения требований к высокой доступности сервера. Автоматическая отработка отказа между серверами источника и реплики отсутствует. Остановка репликации на реплике чтения для перевода ее в оперативный режим в режиме чтения и записи — это средства, с помощью которых выполняется переход на другой ресурс вручную.

Так как репликация является асинхронной, между источником и репликой возникает задержка. На задержку может влиять множество факторов, таких как интенсивность выполнения рабочей нагрузки на исходном сервере и задержка между центрами обработки данных. В большинстве случаев задержка реплики составляет от нескольких секунд до пары минут. Вы можете отвести фактическую задержку репликации с помощью *задержки реплики* метрики, доступной для каждой реплики. Эта метрика показывает время, прошедшее с момента последнего воспроизведения транзакции. Рекомендуется определить среднюю задержку, просматривая запаздывание реплики в течение определенного периода времени. Вы можете настроить оповещение о задержке реплики, чтобы, если она выходит за пределы ожидаемого диапазона, можно предпринять действия.

> [!Tip]
> Если выполняется отработка отказа в реплике, задержка во время десвязи реплики с источником будет указывать на количество потерянных данных.

После того как вы решили выполнить отработку отказа в реплику, выполните следующие действия.

1. Останавливает репликацию в реплику<br/>
   Этот шаг необходим для того, чтобы сервер реплики мог принимать операции записи. В рамках этого процесса сервер реплики будет десвязываться с источником. После запуска процесса «останавливает репликацию» серверный процесс обычно занимает около 2 минут. Сведения о влиянии этого действия см. в разделе " [Завершение репликации](#stop-replication) " этой статьи.

2. Наведите приложение на реплику (бывшая)<br/>
   Каждый сервер имеет уникальную строку подключения. Обновите приложение так, чтобы оно указывало на (бывшая) реплику, а не на источник.

После успешной обработки операций чтения и записи приложение отработки отказа завершено. Время простоя, которое будет зависеть от работы приложения, зависит от того, обнаруживается ошибка и выполняются шаги 1 и 2, описанные выше.

## <a name="considerations-and-limitations"></a>Рекомендации и ограничения

| Сценарий | Ограничения и соображения |
|:-|:-|
| Реплика на сервере с включенной избыточностью зоны доступности | Не поддерживается |
| Репликация чтения между регионами | Не поддерживается |
| Цены | Стоимость работы сервера реплики зависит от региона, в котором работает сервер реплики. |
| Исходный сервер перезапуска | При создании реплики для источника, не имеющего существующих реплик, источник сначала перезапускается для подготовки к репликации. Примите это в виду и выполните эти операции в течение непикового периода. |
| Новые реплики | Реплика чтения создается как новая база данных Azure для гибкого сервера MySQL. Существующий сервер нельзя снова преобразовать в реплику. Невозможно создать реплику другой реплики чтения |
| Конфигурация реплики | Реплика создается с использованием той же конфигурации сервера, что и источник. После создания реплики некоторые параметры могут быть изменены независимо от исходного сервера: поколение вычислений, виртуальных ядер, хранилище и срок хранения резервных копий. Уровень вычислений также можно изменить независимо.<br> <br> **ВАЖНО**  <br> — Перед обновлением конфигурации исходного сервера до новых значений измените конфигурацию реплики на равные или более большие значения. Это позволит реплике справляться с нагрузкой, соответствующей новым параметрам исходного сервера. <br/> При создании реплики метод подключения и настройки параметров наследуются от исходного сервера к реплике. После этого правила реплики будут независимыми. |
| Остановленные реплики | Если остановить репликацию между исходным сервером и репликой чтения, то остановленная реплика станет автономным сервером, принимающим операции чтения и записи. Это сервер нельзя снова преобразовать в реплику. |
| Удаленные исходные и автономные серверы | При удалении исходного сервера репликация будет остановлена для всех реплик чтения. Реплики чтения автоматически становятся автономными серверами и могут выполнять операции чтения и записи. Сам исходный сервер удаляется. |
| Учетные записи пользователей | Пользователи на исходном сервере реплицируются на реплики чтения. Подключиться к реплике чтения можно только с помощью учетных записей пользователей, доступных на исходном сервере. |
| Параметры сервера | Чтобы предотвратить синхронизацию данных и избежать их возможной потери, при использовании реплики чтения некоторые параметры сервера блокируются. <br> Следующие параметры сервера заблокированы на серверах источника и реплики:<br> - [`innodb_file_per_table`](https://dev.mysql.com/doc/refman/8.0/en/innodb-file-per-table-tablespaces.html) <br> - [`log_bin_trust_function_creators`](https://dev.mysql.com/doc/refman/5.7/en/replication-options-binary-log.html#sysvar_log_bin_trust_function_creators) <br> Параметр [`event_scheduler`](https://dev.mysql.com/doc/refman/5.7/en/server-system-variables.html#sysvar_event_scheduler) заблокирован на серверах реплик. <br> Чтобы обновить один из указанных выше параметров на исходном сервере, удалите серверы реплик, обновите значение параметра в источнике и повторно создайте реплики. |
| Другое | -Создание реплики реплики не поддерживается. <br> — Таблицы в памяти могут привести к тому, что реплики не будут синхронизированы. Это ограничение технологии репликации MySQL. Дополнительные сведения см. в [справочной документации по MySQL](https://dev.mysql.com/doc/refman/5.7/en/replication-features-memory.html). <br>— Убедитесь, что таблицы исходного сервера имеют первичные ключи. Отсутствие первичных ключей может привести к задержке репликации между источником и репликами.<br>— Ознакомьтесь с полным списком ограничений репликации MySQL в [документации по MySQL](https://dev.mysql.com/doc/refman/5.7/en/replication-features.html) . |

## <a name="next-steps"></a>Дальнейшие действия

* Узнайте, как [создавать реплики чтения и управлять ими с помощью портала Azure](how-to-read-replicas-portal.md).
* Узнайте, как [создавать реплики чтения и управлять ими с помощью Azure CLI](how-to-read-replicas-cli.md).