---
title: Руководство по созданию гибкого сервера Базы данных Azure для MySQL (предварительная версия) и веб-приложения Службы приложений Azure в одной виртуальной сети
description: Краткое руководство по созданию гибкого сервера Базы данных Azure для MySQL (предварительная версия) с веб-приложением в той же виртуальной сети
author: mksuni
ms.author: sumuth
ms.service: mysql
ms.devlang: azurecli
ms.topic: tutorial
ms.date: 03/18/2021
ms.custom: mvc, devx-track-azurecli
ms.openlocfilehash: 3e334eda46e5e67a0fc0755f5e02a0724d34a4b4
ms.sourcegitcommit: 867cb1b7a1f3a1f0b427282c648d411d0ca4f81f
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "104657643"
---
# <a name="tutorial-create-an-azure-database-for-mysql---flexible-server-preview-with-app-services-web-app-in-virtual-network"></a>Руководство по созданию гибкого сервера Базы данных Azure для MySQL (предварительная версия) с веб-приложением Службы приложений в той же виртуальной сети

> [!IMPORTANT]
> Сейчас предоставляется общедоступная предварительная версия Гибкого сервера Базы данных Azure для MySQL.

В этом учебнике показано, как создать веб-приложение Службы приложений Azure и гибкий сервер Базы данных Azure для MySQL (предварительная версия) в [виртуальной сети](../../virtual-network/virtual-networks-overview.md).

Из этого учебного курса вы узнаете следующее:
>[!div class="checklist"]
> * создание гибкого сервера MySQL в виртуальной сети;
> * создание подсети для ее делегирования Службе приложений;
> * Создание веб-приложения
> * добавление веб-приложения в виртуальную сеть;
> * подключение к Postgres из веб-приложения. 

## <a name="prerequisites"></a>Предварительные требования

Если у вас еще нет подписки Azure, создайте [бесплатную](https://azure.microsoft.com/free/) учетную запись Azure, прежде чем начинать работу.

Для этой статьи требуется запустить локально Azure CLI версии 2.0 или более поздней. Чтобы узнать, какая установлена версия, выполните команду `az --version`. Если вам необходимо выполнить установку или обновление, см. статью [Установка Azure CLI 2.0](/cli/azure/install-azure-cli).

Вам потребуется выполнить вход в учетную запись с помощью команды [az login](/cli/azure/reference-index#az-login). Запишите свойство **id** из выходных данных команды для соответствующего имени подписки.

```azurecli
az login
```

Если вы используете несколько подписок, выберите соответствующую, в которой за ресурс будет взиматься плата. Выберите конкретный идентификатор подписки вашей учетной записи, выполнив команду [az account set](/cli/azure/account). Подставьте свойство **subscription ID** из выходных данных **az login** для своей подписки в заполнитель для идентификатора подписки.

```azurecli
az account set --subscription <subscription ID>
```

## <a name="create-an-azure-database-for-mysql-flexible-server"></a>Создание сервера для Базы данных Azure для MySQL (Гибкий сервер)

Создайте гибкий сервер с частным доступом в виртуальной сети с помощью следующей команды:
```azurecli
az mysql flexible-server create --resource-group myresourcegroup --location westus2
```
Скопируйте строку подключения и имя только что созданной виртуальной сети. С помощью этой команды выполняются следующие действия (может занять несколько минут):

- Создайте группу ресурсов, если она еще не существует.
- Создается имя сервера, если оно не предоставлено.
- Создайте виртуальную сеть для нового сервера MySQL. Запишите имя виртуальной сети и имя подсети, которые созданы для этого сервера, так как веб-приложение нужно будет добавить в ту же виртуальную сеть.
- Создается имя пользователя и пароль администратора для этого сервера, если они не предоставлены.
- Создается пустая база данных с именем **flexibleserverdb**.

> [!NOTE]
> Если вы не указали пароль, запишите тот, который будет создан автоматически. Если вы забудете пароль, вам придется сбросить его с помощью команды ``` az mysql flexible-server update```.

## <a name="create-subnet-for-app-service-endpoint"></a>Создание подсети для конечной точки Службы приложений
Теперь нам нужно создать подсеть, которая делегируется конечной точке веб-приложения Службы приложений. Выполните следующую команду, чтобы создать подсеть в той же виртуальной сети, в которой был создан сервер базы данных. 

```azurecli
az network vnet subnet create -g myresourcegroup --vnet-name VNETName --name webappsubnetName  --address-prefixes 10.0.1.0/24  --delegations Microsoft.Web/serverFarms --service-endpoints Microsoft.Web
```
После выполнения этой команды запишите имя виртуальной сети и имя подсети. Они понадобятся, чтобы добавить правило интеграции с виртуальной сетью для веб-приложения после его создания. 

## <a name="create-a-web-app"></a>Создание веб-приложения

В этом разделе вы создадите узел приложений в приложении Службы приложений и подключите это приложение к базе данных MySQL. Убедитесь, что в окне терминала вы находитесь в корне репозитория с кодом вашего приложения.

Создайте приложение Службы приложений (хост-процесс) с помощью команды az webapp up.

```azurecli
az webapp up --resource-group myresourcegroup --location westus2 --plan testappserviceplan --sku P2V2 --name mywebapp
```

> [!NOTE]
> - Для аргумента --location укажите то же расположение, что и для базы данных в предыдущем разделе.
> - Замените _&lt;app-name>_ уникальным в пределах платформы Azure именем (конечная точка сервера имеет адрес https://\<app-name>.azurewebsites.net). В значении <app-name> допускаются символы A-Z, 0–9 и "-". Рекомендуется использовать сочетание названия компании и идентификатора приложения.
> - Уровень "Базовый" службы приложений не поддерживает интеграцию с виртуальной сетью. Используйте уровень "Стандартный" или "Премиум". 

С помощью этой команды выполняются следующие действия (может занять несколько минут):

- Создайте группу ресурсов, если она еще не существует. (В этой команде используется та же группа ресурсов, в которой ранее была создана база данных.)
- Будет создан план службы приложений ```testappserviceplan``` с ценовой категорией "Базовый" (B1), если он еще не существует. Аргументы --plan и --sku необязательны.
- Создается приложение Службы приложений, если оно еще не существует.
- Для приложения включается ведение журнала по умолчанию, если оно еще не включено.
- Передается репозиторий через развертывание на основе ZIP-файла с включенной автоматизацией сборки.

## <a name="add-the-web-app-to-the-virtual-network"></a>Добавление веб-приложения в виртуальную сеть

Используйте команду **az webapp vnet-integration**, чтобы добавить в веб-приложение региональную интеграцию с виртуальной сетью. Замените _&lt;vnet-name>_ и _&lt;subnet-name_ именем виртуальной сети и подсети, которые использует гибкий сервер.

```azurecli
az webapp vnet-integration add -g myresourcegroup -n  mywebapp --vnet VNETName --subnet webappsubnetName
```

## <a name="configure-environment-variables-to-connect-the-database"></a>Настройка переменных среды для подключения к базе данных

Теперь, когда код развернут в Службе приложений, следует подключить приложение к гибкому серверу в Azure. Код приложения должен находить сведения о базе данных в переменных среды. Чтобы задать в Службе приложений переменные среды, создайте параметры приложения с помощью команды ```az webapp config appsettings``` set.

```azurecli
az webapp config appsettings set --settings DBHOST="<mysql-server-name>.mysql.database.azure.com" DBNAME="flexibleserverdb" DBUSER="<username>" DBPASS="<password>"
```

- Замените значения _&lt;mysql-server-name>_ , _&lt;username>_ и _&lt;password>_ для вновь созданной команды гибкого сервера.
- Замените _&lt;username>_ и _&lt;password>_ учетными данными, которые также создаются командой.
- Имена группы ресурсов и приложения извлекаются из кэшированных значений в файле .azure/config.
- Команда создает параметры с именами DBHOST, DBNAME, DBUSER и DBPASS. Если в коде приложения для сведений о базе данных используется другое имя, укажите здесь имена параметров приложения, которые используются в коде.

## <a name="clean-up-resources"></a>Очистка ресурсов

Очистите все ресурсы, созданные при работе с этим руководством, с помощью приведенной ниже команды. Эта команда позволяет удалить все ресурсы в группе ресурсов.

```azurecli
az group delete -n myresourcegroup
```

## <a name="next-steps"></a>Следующие шаги

> [!div class="nextstepaction"]
> [Сопоставление существующего настраиваемого DNS-имени со Службой приложений Azure](../../app-service/app-service-web-tutorial-custom-domain.md)
