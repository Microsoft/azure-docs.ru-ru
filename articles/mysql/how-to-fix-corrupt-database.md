---
title: Устранение повреждений базы данных с базой данных Azure для MySQL
description: В этой статье вы узнаете, как устранить проблемы с повреждением базы данных Azure для MySQL.
author: mksuni
ms.author: sumuth
ms.service: mysql
ms.topic: how-to
ms.date: 09/21/2020
ms.openlocfilehash: 21e4189e56f704129710da5b1d39613c4e1b1df5
ms.sourcegitcommit: 772eb9c6684dd4864e0ba507945a83e48b8c16f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "91766899"
---
# <a name="troubleshoot-database-corruption-in-azure-database-for-mysql"></a>Устранение неполадок с повреждением базы данных в службе "База данных Azure для MySQL"
[!INCLUDE[applies-to-single-flexible-server](includes/applies-to-single-flexible-server.md)]

Повреждение базы данных может привести к простою приложения. Также важно устранить проблемы повреждения во времени, чтобы избежать потери данных. При возникновении повреждения базы данных в журналах сервера появится сообщение об ошибке: `InnoDB: Database page corruption on disk or a failed.`

В этой статье вы узнаете, как устранять проблемы с повреждением базы данных или таблицы. База данных Azure для MySQL использует подсистему InnoDB. В нем реализована автоматическая проверка повреждений и операции исправления. InnoDB проверяет наличие поврежденных страниц, выполняя контрольные суммы на каждой прочитанной странице. Если обнаруживается несоответствие контрольной суммы, сервер MySQL автоматически останавливается.

Попробуйте выполнить следующие действия, чтобы быстро устранить проблемы, связанные с повреждением базы данных.

## <a name="restart-your-mysql-server"></a>Перезапуск сервера MySQL

Как правило, при доступе приложения к таблице или базе данных повреждена база данных или таблица. InnoDB включает механизм восстановления после сбоя, который может решить большинство проблем при перезапуске сервера. Поэтому перезапуск сервера может помочь серверу восстановиться после сбоя, из-за которого база данных находится в неисправном состоянии.

## <a name="use-the-dump-and-restore-method"></a>Использование метода dump и RESTORE

Рекомендуется устранить проблемы с повреждением с помощью метода *дампа и восстановления* . Этот метод включает в себя следующее:
1. Доступ к поврежденной таблице.
1. Использование служебной программы mysqldump для создания логической резервной копии таблицы. В резервной копии будет храниться структура таблицы и данные внутри нее.
1. Перезагрузка таблицы в базу данных.

### <a name="back-up-your-database-or-tables"></a>Резервное копирование базы данных или таблиц

> [!Important]
> - Убедитесь, что настроено правило брандмауэра для доступа к серверу с клиентского компьютера. Дополнительные сведения см. в статьях [Настройка правила брандмауэра на одном сервере](howto-manage-firewall-using-portal.md) и [Настройка правила брандмауэра на гибком сервере](flexible-server/how-to-connect-tls-ssl.md).
> - `--ssl-cert`Если включен протокол SSL, используйте параметр SSL для mysqldump.

Создайте файл резервной копии из командной строки с помощью mysqldump. Используйте следующую команду:

```
$ mysqldump [--ssl-cert=/path/to/pem] -h [host] -u [uname] -p[pass] [dbname] > [backupfile.sql]
```

Описания параметров:
- `[ssl-cert=/path/to/pem]`— Путь к SSL-сертификату. Скачайте SSL-сертификат на клиентский компьютер и укажите в команде путь к нему. Не используйте этот параметр, если протокол SSL отключен.
- `[host]`: Сервер базы данных Azure для MySQL.
- `[uname]`: Имя пользователя администратора сервера.
- `[pass]`— Пароль пользователя администратора.
- `[dbname]`— Имя базы данных.
- `[backupfile.sql]`— Имя файла резервной копии базы данных.

> [!Important]
> - Для одного сервера используйте формат `admin-user@servername` для замены `myserveradmin` в следующих командах.
> - Для гибкого сервера используйте формат `admin-user` для замены `myserveradmin` в следующих командах.

Если определенная таблица повреждена, выберите для резервного копирования определенные таблицы в базе данных.
```
$ mysqldump --ssl-cert=</path/to/pem> -h mydemoserver.mysql.database.azure.com -u myserveradmin -p testdb table1 table2 > testdb_tables_backup.sql
```

Чтобы создать резервную копию одной или нескольких баз данных, используйте `--database` параметр и перечислите имена баз данных, разделяя их пробелами:

```
$ mysqldump --ssl-cert=</path/to/pem>  -h mydemoserver.mysql.database.azure.com -u myserveradmin -p --databases testdb1 testdb3 testdb5 > testdb135_backup.sql
```

### <a name="restore-your-database-or-tables"></a>Восстановление базы данных или таблиц

Ниже описано, как восстановить базу данных или таблицы. После создания файла резервной копии можно восстановить таблицы или базы данных с помощью служебной программы MySQL. Выполните следующую команду:

```
mysql  --ssl-cert=</path/to/pem> -h [hostname] -u [uname] -p[pass] [db_to_restore] < [backupfile.sql]
```
Ниже приведен пример восстановления `testdb` из файла резервной копии, созданного с помощью mysqldump: 

> [!Important]
> - Для одного сервера используйте формат `admin-user@servername` для замены `myserveradmin` в следующей команде.
> - Для гибкого сервера используйте формат ```admin-user``` для замены `myserveradmin` в следующей команде. 

```
$ mysql --ssl-cert=</path/to/pem> -h mydemoserver.mysql.database.azure.com -u myserveradmin -p testdb < testdb_backup.sql
```

## <a name="next-steps"></a>Дальнейшие действия
Если описанные выше действия не помогли устранить проблему, всегда можно восстановить весь сервер:
- [Восстановление сервера в базе данных Azure для MySQL — одиночный сервер](howto-restore-server-portal.md)
- [Восстановление сервера в базе данных Azure для MySQL — гибкого сервера](flexible-server/how-to-restore-server-portal.md)



