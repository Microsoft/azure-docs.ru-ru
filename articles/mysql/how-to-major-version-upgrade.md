---
title: Обновление основной версии в базе данных Azure для MySQL — одиночный сервер
description: В этой статье описывается, как можно обновить основную версию базы данных Azure для MySQL — одиночный сервер.
author: Bashar-MSFT
ms.author: bahusse
ms.service: mysql
ms.topic: how-to
ms.date: 1/28/2021
ms.openlocfilehash: 62faaed3672f721b26587d1bca3ddb0947f733e7
ms.sourcegitcommit: 54e1d4cdff28c2fd88eca949c2190da1b09dca91
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/31/2021
ms.locfileid: "99220842"
---
# <a name="major-version-upgrade-in-azure-database-for-mysql-single-server"></a>Обновление основной версии в базе данных Azure для MySQL с одним сервером

> [!NOTE]
> Эта статья содержит ссылки на термин « _Ведомый_» термин, который корпорация Майкрософт больше не использует. При удалении термина из программного обеспечения мы удалим его из этой статьи.
>

> [!IMPORTANT]
> Обновление основной версии для одного сервера базы данных Azure для MySQL доступно в общедоступной предварительной версии.

В этой статье описывается, как можно обновить основную версию MySQL на месте в базе данных Azure для MySQL Single Server.

Эта функция позволит клиентам выполнять обновление на месте серверов MySQL 5,6 до MySQL 5,7 с помощью кнопки без перемещения данных или изменения строки подключения приложения.

> [!Note]
> * Обновление основной версии доступно только для обновления основной версии с MySQL 5,6 до MySQL 5,7.
> * Сервер будет недоступен во время операции обновления. Поэтому рекомендуется выполнять обновления во время планового периода обслуживания. Вы можете [выполнить минимальное обновление основной версии времени простоя с mysql 5,6 до mysql 5,7 с помощью Read реплики.](#perform-minimal-downtime-major-version-upgrade-from-mysql-56-to-mysql-57-using-read-replicas)

## <a name="perform-major-version-upgrade-from-mysql-56-to-mysql-57-using-azure-portal"></a>Выполнение обновления основной версии с MySQL 5,6 до MySQL 5,7 с помощью портал Azure

Выполните следующие действия, чтобы выполнить обновление основной версии для базы данных Azure сервера MySQL 5,6 с помощью портал Azure

> [!IMPORTANT]
> Рекомендуется сначала выполнить обновление на восстановленной копии сервера, а не напрямую обновлять рабочую среду. См. раздел [как выполнить восстановление до точки во времени](howto-restore-server-portal.md#point-in-time-restore).

1. В [портал Azure](https://portal.azure.com/)выберите существующий сервер базы данных Azure для MySQL 5,6.

2. На странице **Обзор** нажмите кнопку **Обновить** на панели инструментов.

3. В разделе **Обновление** нажмите кнопку **ОК** , чтобы обновить сервер базы данных Azure для MySQL 5,6 на сервер 5,7.

   :::image type="content" source="./media/how-to-major-version-upgrade-portal/upgrade.png" alt-text="Обзор базы данных Azure для MySQL — обновление":::

4. В уведомлении будет подтверждено, что обновление прошло успешно.


## <a name="perform-major-version-upgrade-from-mysql-56-to-mysql-57-using-azure-cli"></a>Выполнение обновления основной версии с MySQL 5,6 до MySQL 5,7 с помощью Azure CLI

Выполните следующие действия, чтобы выполнить обновление основной версии для базы данных Azure сервера MySQL 5,6 с помощью Azure CLI

> [!IMPORTANT]
> Рекомендуется сначала выполнить обновление на восстановленной копии сервера, а не напрямую обновлять рабочую среду. См. раздел [как выполнить восстановление до точки во времени](howto-restore-server-cli.md#server-point-in-time-restore).

1. Установите [Azure CLI для Windows](/cli/azure/install-azure-cli) или используйте Azure CLI в [Azure Cloud Shell](../cloud-shell/overview.md) для запуска команд обновления. 
 
   Для этого обновления требуется версия 2.16.0 или более поздняя Azure CLI. Если вы используете Azure Cloud Shell, последняя версия уже установлена. Выполните команду az version, чтобы узнать установленную версию и зависимые библиотеки. Чтобы обновиться до последней версии, выполните команду az upgrade.

2. После входа выполните команду [AZ MySQL Server Upgrade](https://docs.microsoft.com/cli/azure/mysql/server?view=azure-cli-latest#az_mysql_server_upgrade&preserve-view=true) :

   ```azurecli
   az mysql server upgrade --name testsvr --resource-group testgroup --subscription MySubscription --target-server-version 5.7"
   ```
   
   В командной строке отображается сообщение "-выполняющемуся". После того как сообщение больше не будет отображаться, обновление версии будет завершено.

## <a name="perform-major-version-upgrade-from-mysql-56-to-mysql-57-on-read-replica-using-azure-portal"></a>Выполнение обновления основной версии из MySQL 5,6 в MySQL 5,7 на реплике чтения с помощью портал Azure

1. В [портал Azure](https://portal.azure.com/)выберите существующую базу данных Azure для MySQL 5,6 чтение сервера реплики.

2. На странице **Обзор** нажмите кнопку **Обновить** на панели инструментов.

3. В разделе **Обновление** нажмите кнопку **ОК** , чтобы обновить базу данных Azure для MySQL 5,6 чтение с сервера реплики на сервер 5,7.

   :::image type="content" source="./media/how-to-major-version-upgrade-portal/upgrade.png" alt-text="Обзор базы данных Azure для MySQL — обновление":::

4. В уведомлении будет подтверждено, что обновление прошло успешно.

5. На странице **Обзор** убедитесь, что база данных Azure для считывания сервера реплики MySQL имеет версию 5,7.

6. Теперь перейдите к основному серверу и [выполните обновление основной версии](#perform-major-version-upgrade-from-mysql-56-to-mysql-57-using-azure-portal) .

## <a name="perform-minimal-downtime-major-version-upgrade-from-mysql-56-to-mysql-57-using-read-replicas"></a>Выполнение минимального времени простоя при обновлении с MySQL 5,6 до MySQL 5,7 с использованием реплик чтения

Вы можете выполнить минимальное обновление основной версии с MySQL 5,6 до MySQL 5,7, используя реплики чтения. Идея состоит в том, чтобы обновить реплику чтения сервера до 5,7, а затем отработка отказа приложения, чтобы она указывала на считывание реплики и стала новой базой данных-источником.

1. В [портал Azure](https://portal.azure.com/)выберите существующую базу данных Azure для MySQL 5,6.

2. Создайте [реплику чтения](https://docs.microsoft.com/azure/mysql/concepts-read-replicas#create-a-replica) с сервера-источника.

3. [Обновите реплику чтения](#perform-major-version-upgrade-from-mysql-56-to-mysql-57-on-read-replica-using-azure-portal) до версии 5,7.

4. Убедившись, что сервер реплики работает под управлением версии 5,7, завершите подключение приложения к серверу-источнику.
 
5. Проверьте состояние репликации и убедитесь, что реплика все работает с основным, поэтому все данные синхронизированы и убедитесь, что в первичных операциях не выполняются новые операции.

   Вызовите [`show slave status`](https://dev.mysql.com/doc/refman/5.7/en/show-slave-status.html) команду на сервере реплики, чтобы просмотреть состояние репликации.

   ```sql
   SHOW SLAVE STATUS\G
   ```

   Если для параметра и задано `Slave_IO_Running` `Slave_SQL_Running` значение "Yes", а для параметра `Seconds_Behind_Master` равно "0", репликация работает правильно. `Seconds_Behind_Master` указывает величину задержки на реплике. Если значение не равно "0", это означает, что реплика обрабатывает обновления. После подтверждения `Seconds_Behind_Master` "0" вы можете отключить репликацию.

6. Передвигайте реплику чтения до первичной, [останавливая репликацию](https://docs.microsoft.com/azure/mysql/howto-read-replicas-portal#stop-replication-to-a-replica-server).

7. Наведите приложение на новую основную (бывшую реплику), на которой работает сервер 5,7. Каждый сервер имеет уникальную строку подключения. Обновите приложение так, чтобы оно указывало на (бывшая) реплику, а не на источник.

> [!Note]
> Этот сценарий будет иметь простой во время выполнения шагов 4, 5 и 6.


## <a name="frequently-asked-questions"></a>Часто задаваемые вопросы

### <a name="when-will-this-upgrade-feature-be-ga-as-we-have-mysql-v56-in-our-production-environment-that-we-need-to-upgrade"></a>Когда эта функция обновления будет общедоступна, так как у нас есть MySQL v 5.6 в производственной среде, которую нужно обновить?

Общедоступная версия этой функции планируется до выхода из MySQL v 5.6. Однако эта функция готова к работе и полностью поддерживается Azure, поэтому ее следует использовать в вашей среде с уверенностью. Рекомендуется сначала выполнить и протестировать его на восстановленной копии сервера, чтобы оценить время простоя и выполнить проверку совместимости приложений перед запуском в рабочей среде. Дополнительные сведения см. в статье [как выполнить восстановление](howto-restore-server-portal.md#point-in-time-restore) на момент времени, чтобы создать копию сервера на момент времени. 

### <a name="will-this-cause-downtime-of-the-server-and-if-so-how-long"></a>Это приведет к простою сервера и, если да, сколько времени?

Да, сервер будет недоступен в процессе обновления, поэтому мы рекомендуем выполнить эту операцию во время планового периода обслуживания. Предполагаемое время простоя зависит от размера базы данных, подготовленного объема хранилища (количество операций ввода-вывода в секунду) и количества таблиц в базе данных. Время обновления прямо пропорционально количеству таблиц на сервере. Обновление основных серверов SKU должно занять больше времени, чем на стандартной платформе хранения. Чтобы оценить время простоя для серверной среды, рекомендуется сначала выполнить обновление для восстановленной копии сервера.  

### <a name="it-is-noted-that-it-is-not-supported-on-replica-server-yet-what-does-that-mean-concrete"></a>Отмечено, что он еще не поддерживается на сервере реплики. Что означает конкретное?

В настоящее время обновление основной версии не поддерживается для сервера реплики. Это означает, что не следует запускать его для серверов, участвующих в репликации (на исходном или сервере-реплике). Если вы хотите протестировать обновление серверов, участвующих в репликации, прежде чем добавить поддержку реплики для обновления, рекомендуется выполнить следующие действия:

1. Во время запланированного обслуживания следует [отключить репликацию и удалить сервер реплики](howto-read-replicas-portal.md) после записи его имени и всех сведений о конфигурации (параметры брандмауэра, конфигурации параметров сервера, если они отличаются от исходного сервера).
2. Выполните обновление исходного сервера.
3. Подготавливает новый сервер реплики чтения с тем же именем и параметрами конфигурации, которые были сохранены на шаге 1. Новый сервер реплики будет на v 5.7 автоматически после обновления исходного сервера до версии 5.7.

### <a name="what-will-happen-if-we-do-not-choose-to-upgrade-our-mysql-v56-server-before-february-5-2021"></a>Что произойдет, если не обновить сервер MySQL v 5.6 до 5 февраля 2021?

Вы по-прежнему можете продолжить работу сервера MySQL v 5.6, как и раньше. Azure **никогда не будет** выполнять принудительное обновление на сервере. Однако будут применены ограничения, описанные в статье [Политика управления версиями базы данных Azure для MySQL](concepts-version-policy.md) .

## <a name="next-steps"></a>Дальнейшие действия

Сведения о [политике управления версиями базы данных Azure для MySQL](concepts-version-policy.md).
