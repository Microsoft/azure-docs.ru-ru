---
title: Параметры сервера — база данных Azure для MySQL
description: В этом разделе приводятся рекомендации по настройке параметров сервера в базе данных Azure для MySQL.
author: Bashar-MSFT
ms.author: bahusse
ms.service: mysql
ms.topic: conceptual
ms.date: 1/26/2021
ms.openlocfilehash: 9485d346384344bd7c35d0577245419ca1f56574
ms.sourcegitcommit: 4e70fd4028ff44a676f698229cb6a3d555439014
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/28/2021
ms.locfileid: "98951316"
---
# <a name="server-parameters-in-azure-database-for-mysql"></a>Параметры сервера в базе данных Azure для MySQL

В этой статье приводятся рекомендации и рекомендации по настройке параметров сервера в базе данных Azure для MySQL.

## <a name="what-are-server-parameters"></a>Что такое параметры сервера? 

Модуль MySQL предоставляет множество различных переменных и параметров сервера, которые можно использовать для настройки и настройки поведения обработчика. Некоторые параметры могут быть заданы динамически во время выполнения, а другие — статическими, для применения которых требуется перезагрузка сервера.

База данных Azure для MySQL предоставляет возможность изменять значения различных параметров сервера MySQL с помощью [портал Azure](./howto-server-parameters.md), [Azure CLI](./howto-configure-server-parameters-using-cli.md)и [PowerShell](./howto-configure-server-parameters-using-powershell.md) в соответствии с потребностями вашей рабочей нагрузки.

## <a name="configurable-server-parameters"></a>Настраиваемые параметры сервера

Список поддерживаемых параметров постоянно растет. Используйте вкладку Параметры сервера в портал Azure, чтобы просмотреть полный список и настроить значения параметров сервера.

Дополнительные сведения об ограничениях для нескольких часто обновляемых параметров сервера см. в следующих разделах ниже. Ограничения определяются ценовой категорией и виртуальных ядер сервера.

### <a name="thread-pools"></a>Пулы потоков

MySQL традиционно назначает поток для каждого клиентского соединения. По мере роста числа одновременно работающих пользователей возникает соответствующее перетаскивание. Многие активные потоки могут значительно влиять на производительность из-за увеличенного переключения контекста, состязаний за потоки и неправильной локализации для кэшей ЦП.

Пулы потоков, которые являются компонентом на стороне сервера и отличаются от пулов соединений, позволяют максимально повысить производительность, представляя динамический пул рабочих потоков, который можно использовать для ограничения количества активных потоков, выполняемых на сервере, и уменьшения объема обрабатываемых потоков. Это позволяет гарантировать, что нагрузка на сервер не будет закрывать ресурсы или завершаться сбоем из-за ошибки нехватки памяти. Пулы потоков наиболее эффективны для коротких запросов и рабочих нагрузок с интенсивным использованием ЦП, например для рабочих нагрузок OLTP.

Дополнительные сведения о пулах потоков см. в статье [Введение в пулы потоков в базе данных Azure для MySQL](https://techcommunity.microsoft.com/t5/azure-database-for-mysql/introducing-thread-pools-in-azure-database-for-mysql-service/ba-p/1504173) .

> [!NOTE]
> Функция пула потоков не поддерживается для версии MySQL 5,6. 

### <a name="configuring-the-thread-pool"></a>Настройка пула потоков
Чтобы включить пул потоков, измените `thread_handling` параметр сервера на "poold-Threads". По умолчанию для этого параметра задано значение, означающее `one-thread-per-connection` , что MySQL создает новый поток для каждого нового соединения. Обратите внимание, что это статический параметр, для применения которого требуется перезагрузка сервера.

Кроме того, можно настроить максимальное и минимальное количество потоков в пуле, задав следующие параметры сервера: 
- `thread_pool_max_threads`: Это значение гарантирует, что в пуле не будет больше этого числа потоков.
- `thread_pool_min_threads`: Это значение задает количество потоков, которые будут зарезервированы даже после закрытия соединений.

Чтобы повысить производительность коротких запросов в пуле потоков, база данных Azure для MySQL позволяет включить пакетное выполнение вместо возвращения в пул потоков сразу после выполнения запроса. потоки будут оставаться активными в течение короткого времени, чтобы ожидать следующего запроса через это соединение. Затем поток выполняет запрос быстро, и после завершения он ждет следующего, пока общее время его использования не превысит пороговое значение. Поведение выполнения пакета определяется с помощью следующих параметров сервера:  

-  `thread_pool_batch_wait_timeout`: Это значение указывает время, в течение которого поток ожидает обработки другого запроса.
- `thread_pool_batch_max_time`: Это значение определяет максимальное время, в течение которого поток будет повторять цикл выполнения запроса и ожидает следующего запроса.

> [!IMPORTANT]
> Проверьте пул потоков перед его включением в рабочей среде. 

### <a name="log_bin_trust_function_creators"></a>log_bin_trust_function_creators

В базе данных Azure для MySQL Двоичные журналы всегда включены (т. е. параметр включен `log_bin` ). Если вы хотите использовать триггеры, появится сообщение об ошибке, похожее на отсутствие *привилегий суперпользователя и ведение журнала в двоичном формате (возможно, вы захотите использовать менее надежную `log_bin_trust_function_creators` переменную)*. 

Двоичный формат ведения журнала всегда имеет значение **Row** , а все соединения с сервером **всегда** используют двоичное ведение журнала на основе строк. При ведении журнала в двоичном формате на основе строк проблемы безопасности не возникают, и регистрация в двоичном журнале не может быть нарушена, поэтому можно безопасно установить значение [`log_bin_trust_function_creators`](https://dev.mysql.com/doc/refman/5.7/en/replication-options-binary-log.html#sysvar_log_bin_trust_function_creators) **true**.

### <a name="innodb_buffer_pool_size"></a>innodb_buffer_pool_size

Чтобы узнать больше об этом параметре, ознакомьтесь с документацией по [MySQL](https://dev.mysql.com/doc/refman/5.7/en/innodb-parameters.html#sysvar_innodb_buffer_pool_size).

#### <a name="servers-supporting-up-to-4-tb-storage"></a>Серверы, поддерживающие до 4 ТБ хранилища

|**Ценовая категория**|**Виртуальные ядра**|**Значение по умолчанию (в байтах)**|**Минимальное значение (байт)**|**Максимальное значение (байт)**|
|---|---|---|---|---|
|Basic|1|872415232|134217728|872415232|
|Basic|2|2684354560|134217728|2684354560|
|Общее назначение|2|3758096384|134217728|3758096384|
|Общее назначение|4|8053063680|134217728|8053063680|
|Общее назначение|8|16106127360|134217728|16106127360|
|Общее назначение|16|32749125632|134217728|32749125632|
|Общее назначение|32|66035122176|134217728|66035122176|
|Общее назначение|64|132070244352|134217728|132070244352|
|С оптимизацией для операций в памяти|2|7516192768|134217728|7516192768|
|С оптимизацией для операций в памяти|4|16106127360|134217728|16106127360|
|С оптимизацией для операций в памяти|8|32212254720|134217728|32212254720|
|С оптимизацией для операций в памяти|16|65498251264|134217728|65498251264|
|С оптимизацией для операций в памяти|32|132070244352|134217728|132070244352|

#### <a name="servers-support-up-to-16-tb-storage"></a>Серверы поддерживают до 16 ТБ хранилища

|**Ценовая категория**|**Виртуальные ядра**|**Значение по умолчанию (в байтах)**|**Минимальное значение (байт)**|**Максимальное значение (байт)**|
|---|---|---|---|---|
|Basic|1|872415232|134217728|872415232|
|Basic|2|2684354560|134217728|2684354560|
|Общее назначение|2|7516192768|134217728|7516192768|
|Общее назначение|4|16106127360|134217728|16106127360|
|Общее назначение|8|32212254720|134217728|32212254720|
|Общее назначение|16|65498251264|134217728|65498251264|
|Общее назначение|32|132070244352|134217728|132070244352|
|Общее назначение|64|264140488704|134217728|264140488704|
|С оптимизацией для операций в памяти|2|15032385536|134217728|15032385536|
|С оптимизацией для операций в памяти|4|32212254720|134217728|32212254720|
|С оптимизацией для операций в памяти|8|64424509440|134217728|64424509440|
|С оптимизацией для операций в памяти|16|130996502528|134217728|130996502528|
|С оптимизацией для операций в памяти|32|264140488704|134217728|264140488704|

### <a name="innodb_file_per_table"></a>innodb_file_per_table

> [!NOTE]
> `innodb_file_per_table` можно обновить только в общего назначения и ценовой категории, оптимизированные для памяти.

MySQL хранит таблицу InnoDB в разных табличных пространствах в зависимости от конфигурации, указанной при создании таблицы. [Табличное пространство системы](https://dev.mysql.com/doc/refman/5.7/en/innodb-system-tablespace.html) — это область хранения для словаря данных InnoDB. [Табличное пространство file-per-table](https://dev.mysql.com/doc/refman/5.7/en/innodb-file-per-table-tablespaces.html) содержит данные и индексы для одной таблицы InnoDB и хранится в файловой системе в собственном файле данных. Это поведение контролируется серверным параметром `innodb_file_per_table`. Если задать для `innodb_file_per_table` значение `OFF`, InnoDB создаст таблицы в системном табличном пространстве. В противном случае InnoDB создает таблицы в табличных пространствах file-per-table.

База данных Azure для MySQL поддерживает максимум **4 ТБ** в одном файле данных. Если размер базы данных превышает 4 ТБ, следует создать таблицу в [innodb_file_per_table](https://dev.mysql.com/doc/refman/5.7/en/innodb-parameters.html#sysvar_innodb_file_per_table) табличном пространстве. Если размер одной таблицы превышает 4 ТБ, следует использовать таблицу секционирования.

### <a name="join_buffer_size"></a>join_buffer_size

Чтобы узнать больше об этом параметре, ознакомьтесь с документацией по [MySQL](https://dev.mysql.com/doc/refman/5.7/en/server-system-variables.html#sysvar_join_buffer_size).

|**Ценовая категория**|**Виртуальные ядра**|**Значение по умолчанию (в байтах)**|**Минимальное значение (байт)**|**Максимальное значение (байт)**|
|---|---|---|---|---|
|Basic|1|Не настраивается на уровне "Базовый"|Недоступно|Недоступно|
|Basic|2|Не настраивается на уровне "Базовый"|Недоступно|Недоступно|
|Общее назначение|2|262144|128|268435455|
|Общее назначение|4|262144|128|536 870 912|
|Общее назначение|8|262144|128|1073741824|
|Общее назначение|16|262144|128|2147483648|
|Общее назначение|32|262144|128|4294967295|
|Общее назначение|64|262144|128|4294967295|
|С оптимизацией для операций в памяти|2|262144|128|536 870 912|
|С оптимизацией для операций в памяти|4|262144|128|1073741824|
|С оптимизацией для операций в памяти|8|262144|128|2147483648|
|С оптимизацией для операций в памяти|16|262144|128|4294967295|
|С оптимизацией для операций в памяти|32|262144|128|4294967295|

### <a name="max_connections"></a>max_connections

|**Ценовая категория**|**Виртуальные ядра**|**Значение по умолчанию**|**Минимальное значение**|**Максимальное значение**|
|---|---|---|---|---|
|Basic|1|50|10|50|
|Basic|2|100|10|100|
|Общее назначение|2|300|10|600|
|Общее назначение|4|625|10|1250|
|Общее назначение|8|1250|10|2500|
|Общее назначение|16|2500|10|5000|
|Общее назначение|32|5000|10|10000|
|Общее назначение|64|10000|10|20 000|
|С оптимизацией для операций в памяти|2|625|10|1250|
|С оптимизацией для операций в памяти|4|1250|10|2500|
|С оптимизацией для операций в памяти|8|2500|10|5000|
|С оптимизацией для операций в памяти|16|5000|10|10000|
|С оптимизацией для операций в памяти|32|10000|10|20 000|

При превышении предельного количества подключений может появиться следующая ошибка:
> ОШИБКА 1040 (08004): Слишком много подключений

> [!IMPORTANT]
> Для обеспечения оптимальной работы рекомендуется использовать пул подключений, например ProxySQL, чтобы эффективно управлять подключениями.

Создание клиентских подключений к MySQL занимает некоторое время, и после установки эти подключения занимают ресурсы базы данных даже при простое. Большинство приложений запрашивают много кратковременных соединений, из-за которых и возникает такая ситуация. В результате для реальной рабочей нагрузки будет меньше доступных ресурсов, что приведет к снижению производительности. Предотвратить такую ситуацию поможет использование пула подключений, который сокращает количество бездействующих подключений и повторно использует существующие подключения. Дополнительные сведения о настройке ProxySQL см. в [этой записи блога](https://techcommunity.microsoft.com/t5/azure-database-for-mysql/load-balance-read-replicas-using-proxysql-in-azure-database-for/ba-p/880042).

>[!Note]
>Проксискл — это инструмент сообщества с открытым исходным кодом. Это решение поддерживается корпорацией Майкрософт. Чтобы получить техническую поддержку с помощью полномочного руководства, вы можете оценить и обратиться в [службу поддержки продуктов проксискл](https://proxysql.com/services/support/).

### <a name="max_heap_table_size"></a>max_heap_table_size

Чтобы узнать больше об этом параметре, ознакомьтесь с документацией по [MySQL](https://dev.mysql.com/doc/refman/5.7/en/server-system-variables.html#sysvar_max_heap_table_size).

|**Ценовая категория**|**Виртуальные ядра**|**Значение по умолчанию (в байтах)**|**Минимальное значение (байт)**|**Максимальное значение (байт)**|
|---|---|---|---|---|
|Basic|1|Не настраивается на уровне "Базовый"|Недоступно|Недоступно|
|Basic|2|Не настраивается на уровне "Базовый"|Недоступно|Недоступно|
|Общее назначение|2|16777216|16384|268435455|
|Общее назначение|4|16777216|16384|536 870 912|
|Общее назначение|8|16777216|16384|1073741824|
|Общее назначение|16|16777216|16384|2147483648|
|Общее назначение|32|16777216|16384|4294967295|
|Общее назначение|64|16777216|16384|4294967295|
|С оптимизацией для операций в памяти|2|16777216|16384|536 870 912|
|С оптимизацией для операций в памяти|4|16777216|16384|1073741824|
|С оптимизацией для операций в памяти|8|16777216|16384|2147483648|
|С оптимизацией для операций в памяти|16|16777216|16384|4294967295|
|С оптимизацией для операций в памяти|32|16777216|16384|4294967295|

### <a name="query_cache_size"></a>query_cache_size

По умолчанию кэш запросов отключен. Чтобы включить кэш запросов, настройте параметр `query_cache_type`. 

Чтобы узнать больше об этом параметре, ознакомьтесь с документацией по [MySQL](https://dev.mysql.com/doc/refman/5.7/en/server-system-variables.html#sysvar_query_cache_size).

> [!NOTE]
> Кэш запросов устарел в MySQL 5.7.20 и был удален в MySQL 8.0

|**Ценовая категория**|**Виртуальные ядра**|**Значение по умолчанию (в байтах)**|**Минимальное значение (байт)**|* * Максимальное значение * *|
|---|---|---|---|---|
|Basic|1|Не настраивается на уровне "Базовый"|Недоступно|Недоступно|
|Basic|2|Не настраивается на уровне "Базовый"|Недоступно|Недоступно|
|Общее назначение|2|0|0|16777216|
|Общее назначение|4|0|0|33554432|
|Общее назначение|8|0|0|67108864|
|Общее назначение|16|0|0|134217728|
|Общее назначение|32|0|0|134217728|
|Общее назначение|64|0|0|134217728|
|С оптимизацией для операций в памяти|2|0|0|33554432|
|С оптимизацией для операций в памяти|4|0|0|67108864|
|С оптимизацией для операций в памяти|8|0|0|134217728|
|С оптимизацией для операций в памяти|16|0|0|134217728|
|С оптимизацией для операций в памяти|32|0|0|134217728|

### <a name="lower_case_table_names"></a>lower_case_table_names

Lower_case_table_name по умолчанию имеет значение 1, и вы можете обновить этот параметр в MySQL 5,6 и MySQL 5,7.

Чтобы узнать больше об этом параметре, ознакомьтесь с документацией по [MySQL](https://dev.mysql.com/doc/refman/5.7/en/server-system-variables.html#sysvar_lower_case_table_names).

> [!NOTE]
> В MySQL 8,0 по умолчанию для lower_case_table_name установлено значение 1, и его нельзя изменить.

### <a name="innodb_strict_mode"></a>innodb_strict_mode

Если появляется сообщение об ошибке, похожее на "слишком большой размер строки (> 8126)", может потребоваться отключить параметр **innodb_strict_mode**. Параметр сервера **innodb_strict_mode** не может быть изменен глобально на уровне сервера, так как если размер данных строки превышает 8 КБ, данные будут обрезаны без ошибок, приводящих к возможной потере данных. Рекомендуется изменить схему в соответствии с предельным размером страницы. 

Этот параметр можно задать на уровне сеанса с помощью `init_connect` . Чтобы задать **innodb_strict_mode** на уровне сеанса, см. [параметр](./howto-server-parameters.md#setting-parameters-not-listed)параметра, которого нет в списке.

> [!NOTE]
> При наличии сервера реплики чтения установка **INNODB_STRICT_MODE** Off на уровне сеанса на исходном сервере приведет к нарушению репликации. Мы рекомендуем оставить параметру значение OFF, если у вас есть реплики Read.

### <a name="sort_buffer_size"></a>sort_buffer_size

Чтобы узнать больше об этом параметре, ознакомьтесь с документацией по [MySQL](https://dev.mysql.com/doc/refman/5.7/en/server-system-variables.html#sysvar_sort_buffer_size).

|**Ценовая категория**|**Виртуальные ядра**|**Значение по умолчанию (в байтах)**|**Минимальное значение (байт)**|**Максимальное значение (байт)**|
|---|---|---|---|---|
|Basic|1|Не настраивается на уровне "Базовый"|Недоступно|Недоступно|
|Basic|2|Не настраивается на уровне "Базовый"|Недоступно|Недоступно|
|Общее назначение|2|524288|32768|4194304|
|Общее назначение|4|524288|32768|8388608|
|Общее назначение|8|524288|32768|16777216|
|Общее назначение|16|524288|32768|33554432|
|Общее назначение|32|524288|32768|33554432|
|Общее назначение|64|524288|32768|33554432|
|С оптимизацией для операций в памяти|2|524288|32768|8388608|
|С оптимизацией для операций в памяти|4|524288|32768|16777216|
|С оптимизацией для операций в памяти|8|524288|32768|33554432|
|С оптимизацией для операций в памяти|16|524288|32768|33554432|
|С оптимизацией для операций в памяти|32|524288|32768|33554432|

### <a name="tmp_table_size"></a>tmp_table_size

Чтобы узнать больше об этом параметре, ознакомьтесь с документацией по [MySQL](https://dev.mysql.com/doc/refman/5.7/en/server-system-variables.html#sysvar_tmp_table_size).

|**Ценовая категория**|**Виртуальные ядра**|**Значение по умолчанию (в байтах)**|**Минимальное значение (байт)**|**Максимальное значение (байт)**|
|---|---|---|---|---|
|Basic|1|Не настраивается на уровне "Базовый"|Недоступно|Недоступно|
|Basic|2|Не настраивается на уровне "Базовый"|Недоступно|Недоступно|
|Общее назначение|2|16777216|1024|67108864|
|Общее назначение|4|16777216|1024|134217728|
|Общее назначение|8|16777216|1024|268435456|
|Общее назначение|16|16777216|1024|536 870 912|
|Общее назначение|32|16777216|1024|1073741824|
|Общее назначение|64|16777216|1024|1073741824|
|С оптимизацией для операций в памяти|2|16777216|1024|134217728|
|С оптимизацией для операций в памяти|4|16777216|1024|268435456|
|С оптимизацией для операций в памяти|8|16777216|1024|536 870 912|
|С оптимизацией для операций в памяти|16|16777216|1024|1073741824|
|С оптимизацией для операций в памяти|32|16777216|1024|1073741824|

### <a name="innodb-buffer-pool-warmup"></a>Прогрев буферного пула InnoDB
После перезапуска сервера базы данных Azure для MySQL страницы данных, размещенные на диске, загружаются по мере запроса таблиц. Это приводит к увеличению задержки и снижению производительности при первом выполнении запросов. Это может быть неприемлемым для рабочих нагрузок с учетом задержки. Использование буферного пула InnoDB позволяет сократить период прогрева, перезагружая страницы диска, которые были в буферном пуле до перезапуска, а не ожидая операций DML или SELECT для доступа к соответствующим строкам.

Вы можете уменьшить период прогрева после перезапуска сервера базы данных Azure для MySQL, который представляет собой преимущество производительности путем настройки [параметров сервера буферного пула InnoDB](https://dev.mysql.com/doc/refman/8.0/en/innodb-preload-buffer-pool.html). InnoDB сохраняет процент последних использованных страниц для каждого буферного пула при завершении работы сервера и восстанавливает эти страницы при запуске сервера.

Также важно отметить, что повышение производительности достигается за счет более длительного времени запуска сервера. Если этот параметр включен, ожидается увеличение времени запуска и перезапуска сервера в зависимости от количества операций ввода-вывода, подготовленных на сервере. Рекомендуется протестировать и отслеживать время перезапуска, чтобы обеспечить приемлемую производительность при запуске и перезапуске, так как сервер в это время недоступен. Не рекомендуется использовать этот параметр, если подготовленная операция ввода-вывода имеет значение менее 1000 операций ввода-вывода (или иными словами, когда подготовленное хранилище меньше 335GB.

Чтобы сохранить состояние буферного пула при завершении работы сервера, установите для параметра сервера значение `innodb_buffer_pool_dump_at_shutdown` `ON` . Аналогичным образом задайте для параметра сервера значение, `innodb_buffer_pool_load_at_startup` `ON` чтобы восстановить состояние буферного пула при запуске сервера. Вы можете управлять влиянием запуска или перезапуска с помощью понижения и точной настройки значения параметра сервера `innodb_buffer_pool_dump_pct` . по умолчанию этот параметр имеет значение `25` .

> [!Note]
> Параметры прогрева буферного пула InnoDB поддерживаются только на серверах хранилища общего назначения с хранилищем объемом до 16 ТБ. Дополнительные сведения о [параметрах хранилища базы данных Azure для MySQL](https://docs.microsoft.com/azure/mysql/concepts-pricing-tiers#storage)см. здесь.

### <a name="time_zone"></a>time_zone

После первоначального развертывания сервер Azure для MySQL включает в себя таблицы систем для сведений о часовом поясе, но эти таблицы не заполнены. Таблицы часовых поясов можно заполнить, вызвав хранимую процедуру `mysql.az_load_timezone` с помощью такого инструмента, как командная строка MySQL или MySQL Workbench. Инструкции по вызову хранимой процедуры и настройке часовых поясов глобального времени или уровня сеанса см. в статьях [Портал Azure](howto-server-parameters.md#working-with-the-time-zone-parameter) и [Интерфейс командной строки Azure](howto-configure-server-parameters-using-cli.md#working-with-the-time-zone-parameter).

## <a name="non-configurable-server-parameters"></a>Ненастраиваемые параметры сервера

Указанные ниже параметры сервера нельзя настроить в службе.

|**Параметр**|**Фиксированное значение**|
| :------------------------ | :-------- |
|innodb_file_per_table для уровня "Базовый"|OFF|
|innodb_flush_log_at_trx_commit|1|
|sync_binlog|1|
|innodb_log_file_size|МБ|
|innodb_log_files_in_group|2|

Другие переменные, не указанные здесь, устанавливаются в значения по умолчанию для стандартных значений MySQL. Значения по умолчанию см. в документации по MySQL для версий [8,0](https://dev.mysql.com/doc/refman/8.0/en/server-system-variables.html), [5,7](https://dev.mysql.com/doc/refman/5.7/en/server-system-variables.html)и [5,6](https://dev.mysql.com/doc/refman/5.6/en/server-system-variables.html) . 

## <a name="next-steps"></a>Дальнейшие действия

- Узнайте, как [настроить параметры сервера с помощью портал Azure](./howto-server-parameters.md)
- Узнайте, как [настроить параметры сервера с помощью Azure CLI](./howto-configure-server-parameters-using-cli.md)
- Узнайте, как [настроить параметры сервера с помощью PowerShell](./howto-configure-server-parameters-using-powershell.md) .
