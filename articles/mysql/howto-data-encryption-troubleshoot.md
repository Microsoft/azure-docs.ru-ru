---
title: Устранение неполадок шифрования данных в базе данных Azure для MySQL
description: Сведения об устранении неполадок шифрования данных в базе данных Azure для MySQL
author: mksuni
ms.author: sumuth
ms.service: mysql
ms.topic: how-to
ms.date: 02/13/2020
ms.openlocfilehash: 95b5a7650e0990f13149daeed87da8e261ec37e4
ms.sourcegitcommit: 910a1a38711966cb171050db245fc3b22abc8c5f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "93241129"
---
# <a name="troubleshoot-data-encryption-in-azure-database-for-mysql"></a>Устранение неполадок шифрования данных в базе данных Azure для MySQL

В этой статье описывается, как определить и устранить распространенные проблемы, которые могут возникнуть в базе данных Azure для MySQL при настройке шифрования данных с помощью ключа, управляемого клиентом.

## <a name="introduction"></a>Введение

При настройке шифрования данных для использования управляемого клиентом ключа в Azure Key Vault серверы должны иметь постоянный доступ к ключу. Если сервер теряет доступ к ключу, управляемому клиентом, в Azure Key Vault, он блокирует все подключения, возвращает соответствующее сообщение об ошибке и изменяет его состояние на ***недоступное*** в портал Azure.

Если сервер базы данных Azure для MySQL больше не нужен, его можно удалить для прекращения расходов. Никакие другие действия на сервере не разрешены, пока доступ к хранилищу ключей не будет восстановлен и сервер будет доступен. Также невозможно изменить параметр шифрования данных с (управляемый `Yes` клиентом) на `No` недоступный сервер, если он зашифрован с помощью управляемого клиентом ключа. Необходимо будет повторно проверить ключ вручную, прежде чем снова получить доступ к серверу. Это действие необходимо для защиты данных от несанкционированного доступа во время отзыва разрешений для управляемого клиентом ключа.

## <a name="common-errors-that-cause-the-server-to-become-inaccessible"></a>Распространенные ошибки, приводящие к недоступности сервера

Следующие нетипичные настройки приводят к возникновению большинства проблем с шифрованием данных, в которых используются ключи Azure Key Vault:

- Хранилище ключей недоступно или не существует:
  - Хранилище ключей случайно удалено.
  - Временная ошибка сети, которая приводит к недоступности хранилища ключей.

- У вас нет разрешений на доступ к хранилищу ключей, или ключ не существует:
  - Срок действия ключа истек или он был случайно удален или отключен.
  - Управляемое удостоверение экземпляра базы данных Azure для MySQL было случайно удалено.
  - Управляемое удостоверение экземпляра базы данных Azure для MySQL имеет недостаточные разрешения. Например, разрешения не включают получение, перенос и распаковку.
  - Разрешения управляемого удостоверения для экземпляра базы данных Azure для MySQL были отозваны или удалены.

## <a name="identify-and-resolve-common-errors"></a>Определение и исправление распространенных ошибок

### <a name="errors-on-the-key-vault"></a>Ошибки в хранилище ключей

#### <a name="disabled-key-vault"></a>Отключенное хранилище ключей

- `AzureKeyVaultKeyDisabledMessage`
- **Объяснение**: не удалось выполнить операцию на сервере, так как ключ Azure Key Vault отключен.

#### <a name="missing-key-vault-permissions"></a>Отсутствуют разрешения хранилища ключей

- `AzureKeyVaultMissingPermissionsMessage`
- **Объяснение**. у сервера нет необходимых разрешений на получение, перенос и распаковку для Azure Key Vault. Предоставьте всем отсутствующим разрешениям субъекта-службы с ИДЕНТИФИКАТОРом.

### <a name="mitigation"></a>Меры по снижению риска

- Убедитесь, что ключ, управляемый клиентом, имеется в хранилище ключей.
- Определите хранилище ключей и перейдите к нему на портале Azure.
- Убедитесь, что URI ключа определяет имеющийся ключ.

## <a name="next-steps"></a>Дальнейшие действия

[Использование портал Azure для настройки шифрования данных с помощью управляемого клиентом ключа в базе данных Azure для MySQL](howto-data-encryption-portal.md)
