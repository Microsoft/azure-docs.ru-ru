---
title: Устранение неполадок конфигурации передней дверцы Azure
description: В этом руководстве вы узнаете, как самостоятельно устранять некоторые распространенные проблемы, которые могут возникнуть при работе с экземпляром передней дверцы Azure.
services: frontdoor
documentationcenter: ''
author: duongau
editor: ''
ms.service: frontdoor
ms.workload: infrastructure-services
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: troubleshooting
ms.date: 09/30/2020
ms.author: duau
ms.openlocfilehash: 15cdcefe628a392704e650b560243e2f6a134ec2
ms.sourcegitcommit: 867cb1b7a1f3a1f0b427282c648d411d0ca4f81f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "94629994"
---
# <a name="troubleshooting-common-routing-problems"></a>Устранение распространенных проблем маршрутизации

В этой статье описывается, как устранять распространенные проблемы маршрутизации, которые могут возникнуть при настройке передней дверцы Azure.

## <a name="503-response-from-azure-front-door-after-a-few-seconds"></a>503. ответ от передней дверцы Azure через несколько секунд

### <a name="symptom"></a>Симптом

* Обычные запросы, отправляемые на серверную часть, не проходят через переднюю дверцу Azure. При переходе через переднюю дверцу Azure выводятся сообщения об ошибках 503.
* Сбой передней дверцы Azure обычно отображается через 30 секунд.

### <a name="cause"></a>Причина

Причиной этой проблемы может быть одно из двух действий:
 
* Серверная часть занимает больше времени, чем настроенное время ожидания (по умолчанию 30 секунд), чтобы получить запрос от передней дверцы Azure.
* Время, необходимое для отправки ответа на запрос от передней дверцы Azure, занимает больше времени, чем время ожидания. 

### <a name="troubleshooting-steps"></a>Действия по устранению неполадок

* Отправьте запрос непосредственно в серверную часть (без перехода на переднюю дверцу Azure). Узнайте, как долго будет реагировать Серверная часть.
* Отправьте запрос через переднюю дверцу Azure и посмотрите, получаете ли вы ответы 503. В противном случае проблема может не быть проблемой времени ожидания. Обратитесь в службу поддержки.
* При переходе на переднюю дверцу Azure в коде ответа ошибки 503 настройте `sendReceiveTimeout` поле для передней дверцы Azure. Время ожидания по умолчанию можно продлить до 4 минут (240 секунд). Параметр находится в разделе `backendPoolSettings` и называется `sendRecvTimeoutSeconds` . 

## <a name="requests-sent-to-the-custom-domain-return-a-400-status-code"></a>Запросы, отправленные в пользовательский домен, возвращают код состояния 400

### <a name="symptom"></a>Симптом

* Вы создали экземпляр передней дверцы Azure, но запрос к домену или ведущему узлу возвращает код состояния HTTP 400.
* Вы создали сопоставление DNS для пользовательского домена с настроенным интерфейсным узлом. Однако при отправке запроса в имя узла пользовательского домена возвращается код состояния HTTP 400. Он не направляется в настроенную серверную часть.

### <a name="cause"></a>Причина

Проблема возникает, если вы не настроили правило маршрутизации для пользовательского домена, добавленного в качестве внешнего узла. Для этого внешнего узла необходимо явно добавить правило маршрутизации. Это справедливо даже в том случае, если правило маршрутизации уже настроено для внешнего узла в поддомена передней дверцы Azure (*. azurefd.net).

### <a name="troubleshooting-steps"></a>Действия по устранению неполадок

Добавьте правило маршрутизации для пользовательского домена, чтобы направить трафик в выбранный внутренний пул.

## <a name="azure-front-door-doesnt-redirect-http-to-https"></a>Передняя дверца Azure не перенаправляет HTTP на HTTPS

### <a name="symptom"></a>Симптом

Передняя дверца Azure имеет правило маршрутизации, которое перенаправляет HTTP-HTTPS, но доступ к домену по-прежнему поддерживает протокол HTTP в качестве протокола.

### <a name="cause"></a>Причина

Это может произойти, если вы неправильно настроили правила маршрутизации для передней дверцы Azure. По сути, текущая конфигурация не зависит и может иметь конфликтующие правила.

### <a name="troubleshooting-steps"></a>Действия по устранению неполадок

## <a name="request-to-a-frontend-host-name-returns-a-404-status-code"></a>Запрос имени внешнего узла возвращает код состояния 404.

### <a name="symptom"></a>Симптом

Вы создали экземпляр передней дверцы Azure, настроив интерфейсный узел, внутренний пул, содержащий по крайней мере одну серверную часть в нем, и правило маршрутизации, которое подключает интерфейсный узел к внутреннему пулу. Содержимое недоступно при выполнении запроса к настроенному интерфейсному узлу. В результате запрос возвращает код состояния HTTP 404.

### <a name="cause"></a>Причина

Данный симптом мог возникнуть по нескольким причинам.

* Серверная часть не является общедоступной серверной частью и невидима для передней дверцы Azure.
* Серверная часть настроена неправильно, в результате чего внешняя дверца Azure отправляет неправильный запрос. Иными словами, серверная часть принимает только протокол HTTP и вы не разрешаете HTTPS. Так что передняя дверца Azure пытается перенаправлять HTTPS-запросы.
* Внутренний сервер отклоняет заголовок узла, который был переслан вместе с запросом на внутренний сервер.
* Конфигурация серверной части еще не полностью развернута.

### <a name="troubleshooting-steps"></a>Действия по устранению неполадок

* Проверьте время развертывания:
   * Убедитесь, что вы ожидали минимум 10 минут для развертывания конфигурации.

* Проверьте параметры серверной части:
    * Перейдите к внутреннему пулу, к которому должен быть назначен запрос. (Это зависит от того, как настроено правило маршрутизации.) Убедитесь в правильности типа внутреннего узла и имени узла внутреннего сервера. Если серверная часть является пользовательским узлом, убедитесь, что она правильно написана. 

    * Проверьте порты HTTP и HTTPS. В большинстве случаев 80 и 443 (соответственно) являются правильными, и никаких изменений не требуется. Однако существует вероятность, что серверная часть не настроена таким образом и прослушивает другой порт.

    * Проверьте заголовок внутреннего узла, настроенный для серверной части, которой должен быть назначен сервер переднего плана. В большинстве случаев этот заголовок должен совпадать с именем внутреннего узла. Тем не менее неправильное значение может привести к отображению различных кодов состояния HTTP 4xx, если внутренний сервер ожидает другое значение. При вводе IP-адреса серверной части может потребоваться указать в заголовке внутреннего узла имя узла серверной части.

* Проверьте параметры правила маршрутизации.
    * Перейдите к правилу маршрутизации, которое должно направляться из имени внешнего узла в вопрос во внутренний пул. Убедитесь, что принятые протоколы правильно настроены при переадресации запроса. Поле **принятые протоколы** определяет, какие запросы должна принимать Передняя дверца Azure. Протокол переадресации определяет, какой протокол должна использовать Передняя дверца Azure для пересылки запроса в серверную часть.
      
      Например, если серверная часть принимает только HTTP-запросы, следующие конфигурации будут допустимыми:
            
      * Accepted protocols (Принимаемые протоколы): HTTP и HTTPS. Протокол пересылки — HTTP. Запрос на сопоставление не будет работать, так как разрешен протокол HTTPS. Если запрос был получен как HTTPS, то передняя дверца Azure попытается переслать ее с помощью протокола HTTPS.

      * Принятым протоколом является HTTP. Протокол пересылки является либо запросом сопоставления, либо HTTP.
    - По умолчанию **переопределение URL-адреса** отключено. Это поле используется только в том случае, если необходимо ограничить область ресурсов, размещенных на внутреннем сервере, которые необходимо сделать доступными. Если это поле отключено, то передняя дверца Azure будет перенаправлять тот же путь запроса, который он получает. Это поле можно неправильно настроить. Поэтому, когда передняя дверца Azure запрашивает ресурс из серверной части, который недоступен, он возвращает код состояния HTTP 404.

## <a name="request-to-the-frontend-host-name-returns-a-411-status-code"></a>Запрос имени внешнего узла возвращает код состояния 411.

### <a name="symptom"></a>Симптом

Вы создали экземпляр передней дверцы Azure и настроили интерфейсный узел, внутренний пул, содержащий по крайней мере одну серверную часть в нем, и правило маршрутизации, которое подключает интерфейсный узел к внутреннему пулу. Содержимое не будет доступно, когда запрос переходит на настроенный интерфейсный узел, так как возвращается код состояния HTTP 411.

Ответы на эти запросы могут также содержать HTML-страницу ошибок в тексте ответа, который содержит пояснительную инструкцию. Например, `HTTP Error 411. The request must be chunked or have a content length`.

### <a name="cause"></a>Причина

Существует несколько возможных причин этого симптома. Общая причина заключается в том, что HTTP-запрос не полностью совместим с RFC. 

Примером несоответствия является запрос, который `POST` отправляется без `Content-Length` заголовка или (например `Transfer-Encoding` , с помощью `curl -X POST https://example-front-door.domain.com` ). Этот запрос не соответствует требованиям, заданным в [RFC 7230](https://tools.ietf.org/html/rfc7230#section-3.3.2). Передняя дверца Azure заблокировала его с ответом HTTP 411.

Это поведение отличается от функции брандмауэра веб-приложения (WAF) в передней дверце Azure. В настоящее время отключить это поведение невозможно. Все HTTP-запросы должны соответствовать требованиям, даже если функция WAF не используется.

### <a name="troubleshooting-steps"></a>Действия по устранению неполадок

- Убедитесь, что ваши запросы соответствуют требованиям, заданным в соответствующих документах RFC.

- Запишите текст сообщения в формате HTML, возвращаемый в ответ на запрос. Текст сообщения часто объясняет, *как* запрос не соответствует требованиям.
