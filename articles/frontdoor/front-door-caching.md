---
title: Внешняя дверца Azure — кэширование | Документация Майкрософт
description: Эта статья поможет вам понять поведение передней дверцы с помощью правил маршрутизации с включенным кэшированием.
services: frontdoor
documentationcenter: ''
author: duongau
ms.service: frontdoor
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 09/29/2020
ms.author: duau
ms.openlocfilehash: d001a7a24d44c46a19bde08051e21d3ae3c5acb8
ms.sourcegitcommit: 867cb1b7a1f3a1f0b427282c648d411d0ca4f81f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "99538057"
---
# <a name="caching-with-azure-front-door"></a>Кэширование с помощью передней дверцы Azure
В следующем документе указывается поведение для передней дверцы с правилами маршрутизации, для которых включено кэширование. Передняя дверца — это современная сеть доставки содержимого (CDN) с динамическим ускорением сайтов и балансировкой нагрузки, которая также поддерживает поведение кэширования так же, как и любые другие сети CDN.

## <a name="delivery-of-large-files"></a>Доставка больших файлов
Передняя дверца Azure предоставляет большие файлы без ограничения на размер файла. Front Door использует метод фрагментирования объекта. При запросе большого файла Front Door получает небольшие фрагменты этого файла из серверной части. После получения полного или байтового запроса файла среда передней дверцы запрашивает файл из серверной части в виде фрагментов по 8 МБ.

После того как блок поступает в среду передней дверцы, он кэшируется и немедленно отправляется пользователю. Одновременно Front Door предварительно загружает следующий фрагмент. Эта предварительная загрузка гарантирует, что всегда будет загружен следующий фрагмент содержимого (по сравнению с тем фрагментом, который просматривает пользователь), что позволяет снизить задержку. Этот процесс продолжится до тех пор, пока не будет загружен весь файл (при запросе) или Клиент закроет соединение.

Дополнительные сведения о запросе диапазона байтов см. в разделе [RFC 7233](https://web.archive.org/web/20171009165003/http://www.rfc-base.org/rfc-7233.html).
Передняя дверца кэширует все фрагменты по мере их получения, чтобы весь файл не пришлось кэшировать в кэше передней дверцы. Запросы на файл или диапазоны байтов обслуживаются из кэша. Если фрагменты не кэшируются, для запроса блоков из серверной части используется предварительная выборка. Эта оптимизация основана на способности серверной части поддерживать запросы диапазона байтов. Если серверная часть не поддерживает запросы диапазона байтов, эта оптимизация неэффективна.

## <a name="file-compression"></a>Сжатие файлов
Передняя дверца может динамически сжимать содержимое на границе, что обеспечивает меньшее и быстрое время ответа клиентам. Чтобы файл можно было использовать для сжатия, необходимо включить кэширование, а файл должен иметь тип MIME, пригодный для сжатия. В настоящее время Передняя дверца не позволяет изменять этот список. Текущий список приведен ниже.
- "application/eot"
- "application/font"
- "application/font-sfnt"
- "application/javascript"
- "application/json"
- "application/opentype"
- "application/otf"
- "application/pkcs7-mime"
- "application/truetype"
- "application/ttf",
- "application/vnd.ms-fontobject"
- "application/xhtml+xml"
- "application/xml"
- "application/xml+rss"
- "application/x-font-opentype"
- "application/x-font-truetype"
- "application/x-font-ttf"
- "application/x-httpd-cgi"
- "application/x-mpegurl"
- "application/x-opentype"
- "application/x-otf"
- "application/x-perl"
- "application/x-ttf"
- "application/x-javascript"
- "font/eot"
- "font/ttf"
- "font/otf"
- "font/opentype"
- "image/svg+xml"
- "text/css"
- "text/csv"
- "text/html"
- "text/javascript"
- "text/js", "text/plain"
- "text/richtext"
- "text/tab-separated-values"
- "text/xml"
- "text/x-script"
- "text/x-component"
- "text/x-java-source"

Кроме того, размер файла должен составлять от 1 КБ до 8 МБ включительно.

Эти профили поддерживают следующие алгоритмы сжатия:
- [Gzip (GNU Zip)](https://en.wikipedia.org/wiki/Gzip)
- [Brotli](https://en.wikipedia.org/wiki/Brotli)

Если запрос поддерживает сжатие gzip и Brotli, предпочтение отдается Brotli.</br>
Если запрос ресурса задает сжатие, а запрос приводит к промаху кэша, то передняя дверца выполняет сжатие ресурса непосредственно на сервере POP. После этого сжатый файл используется из кэша. Полученный элемент возвращается со значением transfer-encoding: chunked.

## <a name="query-string-behavior"></a>Поведение строк запросов
С помощью Front Door можно управлять способом кэширования файлов для веб-запроса, который содержит строку запроса. В веб-запросе строка запроса — это часть запроса, которая следует после вопросительного знака (?). Строка запроса может содержать одну или несколько пар "ключ-значение", в которых имя поля и его значение разделяются знаком равенства (=). Каждая пара "ключ-значение" разделяется знаком амперсанда (&). Например, `http://www.contoso.com/content.mov?field1=value1&field2=value2`. Если в строке запроса есть несколько пар "ключ-значение", их порядок не имеет значения.
- **Пропускать строки запроса**. в этом режиме Передняя дверца передает строки запроса от запрашивающей стороны в серверный первый запрос и кэширует ресурс. Все запросы к ресурсу, обслуживаемые из среды передней дверцы, игнорируют строки запроса, пока не истечет срок действия кэшированного ресурса.

- **Кэширование каждого уникального URL-адреса**. В этом режиме каждый запрос с уникальным URL-адресом, включая строку запроса, считается уникальным ресурсом с собственным кэшем. Например, ответ от серверной части запроса `www.example.ashx?q=test1` кэшируется в среде передней дверцы и возвращается для получения кэшей с той же строкой запроса. Запрос к `www.example.ashx?q=test2` будет кэшироваться как отдельный ресурс с собственным сроком существования.

## <a name="cache-purge"></a>Очистка кэша

Передняя дверца кэширует ресурсы, пока не истечет срок жизни (TTL) ресурса. Всякий раз, когда клиент запрашивает ресурс с истекшим сроком жизни, среда передней дверцы получает новую обновленную копию ресурса для обслуживания запроса, а затем сохраняет обновленный кэш.

Лучший способ убедиться, что пользователи всегда получают последнюю версию ресурсов — изменять версию ресурсов при каждом обновлении и публиковать их в виде нового URL-адреса. Front Door будет незамедлительно получать ресурсы для следующих клиентских запросов. Иногда может потребоваться очистить кэшированное содержимое со всех пограничных узлов и сделать так, чтобы узлы получили новые обновленные ресурсы. Причиной может быть обновление веб-приложения или быстрое обновление ресурсов, содержащих неверную информацию.

Выберите ресурсы, которые необходимо удалить из граничных узлов. Чтобы очистить все ресурсы, выберите **Очистить все**. В противном случае в поле **путь** введите путь к каждому ресурсу, который требуется очистить.

Эти форматы поддерживаются в списках путей для очистки:

- **Очистка одного пути**. Очистите отдельные активы, указав полный путь к ресурсу (без протокола и домена) с расширением файла, например/pictures/strasbourg.png;
- **Очистка по подстановочным знакам.** В качестве подстановочного знака можно использовать звездочку (\*). Очистите все папки, вложенные папки и файлы в конечной точке с помощью \* пути или удалите все вложенные папки и файлы в указанной папке, указав папку, а затем/ \* , например,/pictures/ \* .
- **Очистка корневого домена.** Очищает содержимое в корне конечной точки, в пути которой есть знак "/".

> [!NOTE]
> **Очистка доменов с подстановочными знаками**. Указание кэшированных путей для очистки, как описано в этом разделе, не применяется к доменам с подстановочными знаками, связанным с передней дверцей. Сейчас мы не поддерживаем напрямую очищать домены с подстановочными знаками. Можно удалить пути из конкретных поддоменов, указав Этот поддомен указанной и путь очистки. Например, если у моей передней дверцы есть `*.contoso.com` , можно очистить активы своего поддомена `foo.contoso.com` , введя `foo.contoso.com/path/*` . В настоящее время указание имен узлов в пути очистки содержимого — это имитед поддомены доменов с подстановочными знаками, если это применимо.
>

При очистке кэша во Front Door не учитывается регистр. Кроме того, они не зависят от строки запроса. Это означает, что очистка URL-адреса приведет к очистке всех его вариантов в строке запроса. 

## <a name="cache-expiration"></a>Срок действия кэша
Следующий порядок заголовков используется для определения того, как долго будет храниться элемент в кэше:</br>
1. Cache-Control: s-maxage=\<seconds>
2. Cache-Control: max-age =\<seconds>
3. Истекает \<http-date>

Cache-Control заголовки ответа, указывающие, что ответ не будет кэшироваться, например Cache-Control: Private, Cache-Control: un-Cache и Cache-Control: No-Store, не учитывается.  Если Cache-Control отсутствует, то по умолчанию на передней дверце будет кэшироваться ресурс на X-й период, где X возвращается случайным образом в диапазоне от 1 до 3 дней.

## <a name="request-headers"></a>Заголовки запросов

Следующие заголовки запросов не будут перенаправляться в серверную часть при использовании кэширования.
- Content-Length
- Transfer-Encoding

## <a name="cache-duration"></a>Длительность кэширования

Длительность кэширования может быть настроена как в конструкторе передней дверцы, так и в обработчике правил. В конструкторе передней дверцы задана минимальная продолжительность кэша. Это переопределение не будет работать, если заголовок управления кэшем из источника имеет больший срок жизни, чем значение переопределения. 

Продолжительность кэша, заданная с помощью обработчика правил, является истинным переопределением кэша, то есть будет использовать значение переопределения независимо от того, какой заголовок ответа источника является.

## <a name="next-steps"></a>Дальнейшие действия

- Дополнительные сведения о [создании Front Door](quickstart-create-front-door.md).
- Дополнительные сведения о том, [как работает Front Door](front-door-routing-architecture.md).
