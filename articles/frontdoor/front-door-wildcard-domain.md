---
title: Передняя дверца Azure — поддержка доменов с подстановочными знаками
description: Эта статья поможет вам понять, как передняя дверца Azure поддерживает сопоставление доменов с подстановочными знаками и управление ими в списке пользовательских доменов.
services: frontdoor
author: duongau
ms.service: frontdoor
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 09/29/2020
ms.author: duau
ms.openlocfilehash: 18504f1ed4200889b20c9608c9c0ad2c13c9aaa5
ms.sourcegitcommit: 867cb1b7a1f3a1f0b427282c648d411d0ca4f81f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "94425768"
---
# <a name="wildcard-domains"></a>Домены с подстановочными знаками

Помимо доменов вершине и поддоменов, можно также сопоставлять домен с подстановочными знаками с интерфейсными узлами или пользовательскими доменами для профиля передней дверцы Azure. Использование доменов с подстановочными знаками в конфигурации передней дверцы Azure упрощает маршрутизацию трафика для нескольких поддоменов для API, приложения или веб-сайта из одного правила маршрутизации. Вам не нужно изменять конфигурацию, чтобы добавить или указать каждый поддомен отдельно. В качестве примера можно определить маршрутизацию для `customer1.contoso.com` , и с `customer2.contoso.com` помощью того `customerN.contoso.com` же правила маршрутизации и добавив домен с подстановочными знаками `*.contoso.com` .

Ниже приведены основные сценарии, которые усовершенствованы с поддержкой доменов с подстановочными знаками.

- Вам не нужно подключать каждый поддомен в профиле передней дверцы Azure, а затем включить протокол HTTPS, чтобы привязать сертификат для каждого поддомена.
- Вам больше не нужно изменять конфигурацию рабочей дверцы Azure, если приложение добавляет новый поддомен. Ранее требовалось добавить поддомен, привязать к нему сертификат, подключить политику брандмауэра веб-приложения (WAF), а затем добавить домен к различным правилам маршрутизации.

> [!NOTE]
> В настоящее время Добавление доменов с подстановочными знаками через Azure DNS поддерживается только через API, PowerShell и Azure CLI. Поддержка добавления и управления доменами-шаблонами в портал Azure недоступна.

## <a name="adding-wildcard-domains"></a>Добавление доменов с подстановочными знаками

Вы можете добавить домен с подстановочными знаками в раздел для интерфейсных узлов или доменов. Как и поддомены, передняя дверца Azure проверяет наличие сопоставления записи CNAME для домена с подстановочными знаками. Это сопоставление DNS может быть прямым сопоставлением записи CNAME, как `*.contoso.com` сопоставлено с `contoso.azurefd.net` . Также можно использовать временное сопоставление афдверифи. Например, `afdverify.contoso.com` сопоставляется с `afdverify.contoso.azurefd.net` проверкой СОПОСТАВЛЕНИЯ записи CNAME для подстановочного знака.

> [!NOTE]
> Azure DNS поддерживает записи с подстановочными знаками.

Можно добавить любое количество поддоменов одноуровневого домена с подстановочными знаками на клиентских узлах, вплоть до предельного количества узлов переднего плана. Эта функция может потребоваться для:

- Определение другого маршрута для поддомена, чем остальные домены (из домена с подстановочными знаками).

- Наличие другой политики WAF для конкретного поддомена. Например, `*.contoso.com` допускает добавление `foo.contoso.com` без повторного подтверждения владения доменом. Но это не разрешено, `foo.bar.contoso.com` поскольку не является поддоменом одного уровня `*.contoso.com` . Чтобы добавить `foo.bar.contoso.com` без дополнительной проверки владения доменом, необходимо `*.bar.contosonews.com` Добавить.

Вы можете добавить домены с подстановочными знаками и их поддомены с определенными ограничениями:

- Если домен с подстановочными знаками добавляется в профиль передней дверцы Azure:
  - Домен с подстановочными знаками нельзя добавить в любой другой профиль передней дверцы Azure.
  - Поддомены первого уровня домена с подстановочными знаками невозможно добавить в другой профиль передней дверцы Azure или в профиль сети доставки содержимого Azure.
- Если поддомен домена с подстановочными знаками уже добавлен в профиль передней дверцы Azure или в профиль сети доставки содержимого Azure, домен с подстановочными знаками нельзя использовать для других профилей передней дверцы Azure.
- Если два профиля (Передняя дверца Azure или сеть доставки содержимого Azure) имеют различные поддомены корневого домена, то домены с подстановочными знаками нельзя добавить ни в один из профилей.

## <a name="certificate-binding"></a>Привязка сертификата

Для приема HTTPS-трафика в домене с подстановочными знаками необходимо включить протокол HTTPS в домене с подстановочными знаками. Для привязки сертификата для домена с подстановочными знаками требуется сертификат с подстановочными знаками. То есть имя субъекта сертификата должно также иметь домен с подстановочными знаками.

> [!NOTE]
> Сейчас для включения HTTPS для доменов с подстановочными знаками доступен только собственный параметр SSL-сертификата. Управляемые сертификаты передней дверце Azure нельзя использовать для доменов с подстановочными знаками.

Вы можете использовать один и тот же шаблонный сертификат из Azure Key Vault или из управляемых сертификатов передней дверцы Azure для поддоменов.

Если дочерний домен добавлен для домена с подстановочными знаками, с которым уже связан сертификат, то отключить HTTPS для этого поддомена невозможно. Поддомен использует привязку к сертификату для домена с подстановочными знаками, если другой Key Vault или управляемый сертификат внешней дверцы Azure не переопределяет его.

## <a name="waf-policies"></a>Политики WAF

Политики WAF могут быть подключены к доменам с подстановочными знаками, как и в других доменах. К поддомену домена с подстановочными знаками можно применить другую политику WAF. Для поддоменов необходимо указать политику WAF, которая будет использоваться, даже если она является той же политикой, что и домен с подстановочными знаками. Поддомены *не* наследуют политику WAF автоматически от домена с подстановочными знаками.

Если вы не хотите, чтобы политика WAF была выполнена для поддомена, можно создать пустую политику WAF без управляемых или пользовательских наборов правил.

## <a name="routing-rules"></a>Правила маршрутизации

При настройке правила маршрутизации можно выбрать домен с подстановочными знаками в качестве внешнего узла. Можно также использовать различные действия маршрута для доменов с подстановочными знаками и поддоменов. Как описано в статье [о том, как передняя дверца Azure выполняет сопоставление маршрутов](front-door-route-matching.md), в среде выполнения выбирается наиболее конкретное соответствие для домена в разных правилах маршрутизации.

> [!IMPORTANT]
> Необходимо иметь соответствующие шаблоны путей в правилах маршрутизации, иначе клиенты будут видеть ошибки. Например, у вас есть два правила маршрутизации, например маршрут 1 ( `*.foo.com/*` сопоставленный с внутренним пулом A) и маршрут 2 ( `/bar.foo.com/somePath/*` сопоставленный с пулом серверной части б). Затем поступит запрос на `bar.foo.com/anotherPath/*` . Передняя дверца Azure выбирает маршрут 2 на основе более конкретного доменного соответствия, чтобы не находить совпадающие шаблоны путей для всех маршрутов.

## <a name="next-steps"></a>Дальнейшие действия

- Узнайте, как [создать профиль передней дверцы Azure](quickstart-create-front-door.md).
- Узнайте, как [Добавить личный домен в переднюю дверцу Azure](front-door-custom-domain.md).
- Узнайте, как [включить протокол HTTPS в пользовательском домене](front-door-custom-domain-https.md).
