---
title: 'Передняя дверца Azure: кэширование'
description: Эта статья поможет вам разобраться с поведением интерфейсов передней дверцы Azure уровня "Стандартный" или "Премиум" с правилами маршрутизации с включенным кэшированием.
services: front-door
author: duongau
manager: KumudD
ms.service: frontdoor
ms.topic: conceptual
ms.date: 02/18/2021
ms.author: duau
ms.openlocfilehash: 73b2e8e59774e12ddb9aa684382510d1f2c151b8
ms.sourcegitcommit: 97c48e630ec22edc12a0f8e4e592d1676323d7b0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/18/2021
ms.locfileid: "101100155"
---
# <a name="caching-with-azure-front-door-standardpremium-preview"></a>Кэширование с помощью передней дверцы Azure Standard/Premium (Предварительная версия)

> [!Note]
> Эта документация предназначена для передней дверцы Azure уровня "Стандартный" или "Премиум" (Предварительная версия). Ищете информацию о передней дверце Azure? Просмотреть [здесь](../front-door-overview.md).

В этой статье вы узнаете, как направляются маршруты и правила уровня "Стандартный" (Предварительная версия) и набор правил, если включено кэширование. Передняя дверца Azure — это современная сеть доставки содержимого (CDN) с динамическим ускорением сайтов и балансировкой нагрузки.

> [!IMPORTANT]
> Передняя дверца Azure Standard/Premium (Предварительная версия) в настоящее время доступна в общедоступной предварительной версии.
> Эта предварительная версия предоставляется без соглашения об уровне обслуживания и не рекомендована для использования рабочей среде. Некоторые функции могут не поддерживаться или их возможности могут быть ограничены.
> Дополнительные сведения см. в статье [Дополнительные условия использования предварительных выпусков Microsoft Azure](https://azure.microsoft.com/support/legal/preview-supplemental-terms/).

## <a name="delivery-of-large-files"></a>Доставка больших файлов

Передняя дверь Standard/Premium (Предварительная версия) предоставляет большие файлы без ограничения на размер файла. Front Door использует метод фрагментирования объекта. Когда запрашивается большой файл, передняя дверь получает небольшие фрагменты файла из источника. После получения полного или байтового запроса файла среда передней дверцы запрашивает файл из источников в виде блоков размером 8 МБ.

После того как блок поступает в среду передней дверцы, он кэшируется и немедленно отправляется пользователю. Одновременно Front Door предварительно загружает следующий фрагмент. Эта предварительная загрузка гарантирует, что всегда будет загружен следующий фрагмент содержимого (по сравнению с тем фрагментом, который просматривает пользователь), что позволяет снизить задержку. Этот процесс продолжится до тех пор, пока не будет загружен весь файл (при запросе) или Клиент закроет соединение.

Дополнительные сведения о запросе диапазона байтов см. в разделе [RFC 7233](https://web.archive.org/web/20171009165003/http://www.rfc-base.org/rfc-7233.html).
Передняя дверца кэширует все фрагменты по мере их получения, чтобы весь файл не пришлось кэшировать в кэше передней дверцы. Запросы на файл или диапазоны байтов обслуживаются из кэша. Если фрагменты не кэшируются, для запроса блоков из серверной части используется предварительная выборка. Эта оптимизация основана на способности источника поддерживать запросы диапазона байтов. Если источник не поддерживает запросы диапазона байтов, эта оптимизация не действует.

## <a name="file-compression"></a>Сжатие файлов

Дополнительные сведения см. в статье повышение производительности за счет сжатия файлов в передней дверце Azure.

## <a name="query-string-behavior"></a>Поведение строк запросов

С помощью Front Door можно управлять способом кэширования файлов для веб-запроса, который содержит строку запроса. В веб-запросе строка запроса — это часть запроса, которая следует после вопросительного знака (?). Строка запроса может содержать одну или несколько пар "ключ-значение", в которых имя поля и его значение разделяются знаком равенства (=). Каждая пара "ключ-значение" разделяется знаком амперсанда (&). Например, `http://www.contoso.com/content.mov?field1=value1&field2=value2`. Если в строке запроса есть несколько пар "ключ-значение", их порядок не имеет значения.

* **Пропускать строки запроса**. в этом режиме Передняя дверца передает строки запроса от запрашивающей стороны в источник первого запроса и кэширует ресурс. Все запросы к ресурсу, обслуживаемые из среды передней дверцы, игнорируют строки запроса, пока не истечет срок действия кэшированного ресурса.

* **Кэширование каждого уникального URL-адреса**. В этом режиме каждый запрос с уникальным URL-адресом, включая строку запроса, считается уникальным ресурсом с собственным кэшем. Например, ответ от источника запроса на запрос `www.example.ashx?q=test1` кэшируется в среде передней дверцы и возвращается для получения кэшей с той же строкой запроса. Запрос к `www.example.ashx?q=test2` будет кэшироваться как отдельный ресурс с собственным сроком существования.
* Вы также можете использовать набор правил, чтобы указать поведение **строки запроса ключа кэша** , включить или исключить указанные параметры при создании ключа кэша. Например, ключ кэша по умолчанию:/Фу/имаже/asset.html, а пример запроса — `https://contoso.com//foo/image/asset.html?language=EN&userid=100&sessionid=200` . Для исключения строки запроса "userid" существует правило набора правил. Затем ключ кэша строки запроса будет иметь значение `/foo/image/asset.html?language=EN&sessionid=200` .

## <a name="cache-purge"></a>Очистка кэша

См. статью очистка кэша.

## <a name="cache-expiration"></a>Срок действия кэша
Следующий порядок заголовков используется для определения того, как долго будет храниться элемент в кэше:</br>
1. Cache-Control: s-maxage=\<seconds>
2. Cache-Control: max-age =\<seconds>
3. Истекает \<http-date>

Cache-Control заголовки ответа, указывающие, что ответ не будет кэшироваться, например Cache-Control: Private, Cache-Control: un-Cache и Cache-Control: No-Store, не учитывается.  Если Cache-Control отсутствует, то по умолчанию на передней дверце будет кэшироваться ресурс на X-интервал времени. Где X возвращается случайным образом в диапазоне от 1 до 3 дней.

## <a name="request-headers"></a>Заголовки запроса

Следующие заголовки запросов не будут перенаправляться в источник при использовании кэширования.
* Content-Length
* Transfer-Encoding

## <a name="cache-duration"></a>Длительность кэширования

Длительность кэширования может быть настроена в наборе правил. Продолжительность кэша, заданная через набор правил, является истинным переопределением кэша. Это означает, что он будет использовать значение переопределения независимо от того, какой заголовок ответа источника является.

## <a name="next-steps"></a>Следующие шаги

* Дополнительные сведения о [условиях соответствия наборов правил](concept-rule-set-match-conditions.md)
* Дополнительные сведения о [действиях набора правил](concept-rule-set-actions.md)