---
title: Настройка действий набора правил передней дверцы Azure уровня "Стандартный" или "Премиум"
description: В этой статье представлен список различных действий, которые можно выполнить с помощью набора правил "Передняя дверь" Azure.
services: frontdoor
author: duongau
ms.service: frontdoor
ms.topic: conceptual
ms.date: 02/18/2021
ms.author: yuajia
ms.openlocfilehash: c9995df0f292c5e528156a3280df5484db017fca
ms.sourcegitcommit: 97c48e630ec22edc12a0f8e4e592d1676323d7b0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/18/2021
ms.locfileid: "101100044"
---
# <a name="azure-front-door-standardpremium-rule-set-actions"></a>Действия набора правил "Стандартный" и "Премиум" передней дверцы Azure

> [!Note]
> Эта документация предназначена для передней дверцы Azure уровня "Стандартный" или "Премиум" (Предварительная версия). Ищете информацию о передней дверце Azure? Просмотреть [здесь](../front-door-overview.md).

[Набор правил](concept-rule-set.md) для передней дверцы Azure состоит из правил с сочетанием условий соответствия и действий. В этой статье содержится подробное описание действий, которые можно использовать в наборе правил. Действие определяет поведение, которое применяется к типу запроса, определяемому условием соответствия. В наборе правил для передней дверцы Azure правило может содержать до пяти действий. Серверная переменная поддерживается во всех действиях.

> [!IMPORTANT]
> Передняя дверца Azure Standard/Premium (Предварительная версия) в настоящее время доступна в общедоступной предварительной версии.
> Эта предварительная версия предоставляется без соглашения об уровне обслуживания и не рекомендована для использования рабочей среде. Некоторые функции могут не поддерживаться или их возможности могут быть ограничены.
> Дополнительные сведения см. в статье [Дополнительные условия использования предварительных выпусков Microsoft Azure](https://azure.microsoft.com/support/legal/preview-supplemental-terms/).

Для использования в наборе правил "Передняя дверь" Azure доступны следующие действия.  

## <a name="cache-expiration"></a>Срок действия кэша

Используйте это действие, чтобы перезаписать значение срока жизни (TTL) конечной точки для запросов, для которых указаны условия соответствия правил.

### <a name="required-fields"></a>Обязательные поля

Следующее описание применяется при выборе этих вариантов поведения кэша и правила соответствия.

Поведение кэша |  Описание              
---------------|----------------
Обход кэша | Содержимое не кэшируется.
Переопределение | Значение TTL, возвращенное из источника, перезаписывается значением, указанным в действии. Это поведение будет применено только в том случае, если ответ доступен для кэширования. Для заголовка ответа управления кэшем со значениями "без кэша", "Private" и "No-Store" действие будет неприменимо.
Задать, если отсутствует | Если значение TTL не возвращается из источника, правило устанавливает для TTL значение, указанное в действии. Это поведение будет применено только в том случае, если ответ доступен для кэширования. Для заголовка ответа управления кэшем со значениями "без кэша", "Private" и "No-Store" действие будет неприменимо.

### <a name="additional-fields"></a>Дополнительные поля

Дни | Часы | Минуты | Секунды
-----|-------|---------|--------
Int | Int | Int | Int 

## <a name="cache-key-query-string"></a>Строка запроса ключа кэша

Это действие используется для изменения ключа кэша на основе строк запроса.

### <a name="required-fields"></a>Обязательные поля

Следующее описание применяется при выборе этих вариантов поведения и правиле соответствия.

Поведение | Описание
---------|------------
Включение | Строки запроса, указанные в параметрах, включаются при создании ключа кэша. 
Кэшировать каждый уникальный URL-адрес. | Каждый уникальный URL-адрес имеет собственный ключ кэша. 
Исключить | Строки запроса, указанные в параметрах, исключаются при создании ключа кэша.
Пропускать строки запросов. | Строки запроса не учитываются при создании ключа кэша. 

## <a name="modify-request-header"></a>Изменение заголовка запроса

Это действие используется для изменения заголовков, которые включены в полученные вашим источником запросы.

### <a name="required-fields"></a>Обязательные поля

Следующее описание применяется при выборе этих действий и соответствии правила.

Действие | Имя заголовка HTTP | Значение
-------|------------------|------
Append | Заголовок, указанный в поле **имя заголовка** , добавляется в запрос с указанным значением. Если такой заголовок уже существует, новое значение добавляется к существующему. | Строка
Overwrite | Заголовок, указанный в поле **имя заголовка** , добавляется в запрос с указанным значением. Если такой заголовок уже существует, новое значение переопределяет существующее. | Строка
DELETE | Если заголовок, указанный в правиле, имеется, заголовок удаляется из запроса. | Строка

## <a name="modify-response-header"></a>Изменение заголовка ответа

Это действие используется для изменения заголовков, которые включены в возвращаемые клиентам ответы.

### <a name="required-fields"></a>Обязательные поля

Следующее описание применяется при выборе этих действий и соответствии правила.

Действие | Имя заголовка HTTP | Значение
-------|------------------|------
Append | Заголовок, указанный в поле **имя заголовка** , добавляется в ответ с использованием указанного **значения**. Если такой заголовок уже существует, новое **значение** добавляется к существующему. | Строка
Overwrite | Заголовок, указанный в поле **имя заголовка** , добавляется в ответ с использованием указанного **значения**. Если такой заголовок уже существует, новое **значение** переопределяет существующее. | Строка
DELETE | Если заголовок, указанный в правиле, имеется, заголовок удаляется из ответа. | Строка

## <a name="url-redirect"></a>Перенаправление URL-адресов

Используйте это действие для перенаправления клиентов на новый URL-адрес. 

### <a name="required-fields"></a>Обязательные поля

Поле | Описание 
------|------------
Тип перенаправления | Выберите тип ответа, который будет возвращаться запрашивающему: "Найдено (302)", "Перемещено (301)", "Временное перенаправление (307)" или "Постоянное перенаправление (308)".
Перенаправление протокола | Сопоставляется с запросом, HTTP, HTTPS.
Узел назначения | Выберите имя узла, на который будет перенаправлен запрос. Оставьте поле пустым, чтобы сохранить входящий узел.
Конечный путь | Определите путь для использования при перенаправлении. Оставьте поле пустым, чтобы сохранить входящий путь.  
Строка запроса | Определите строку запроса для использования при перенаправлении. Оставьте поле пустым, чтобы сохранить входящую строку запроса. 
Фрагмент места назначения | Определите фрагмент для использования при перенаправлении. Оставьте поле пустым, чтобы сохранить входящий фрагмент. 

## <a name="url-rewrite"></a>Переопределение URL-адреса

Используйте это действие, чтобы перезаписать путь в запросе, который поступает на ваш источник.

### <a name="required-fields"></a>Обязательные поля

Поле | Описание 
------|------------
Исходный шаблон | Определите исходный шаблон в URL-пути для замены. В настоящее время исходный шаблон использует сопоставление на основе префикса. Чтобы сопоставить все URL-пути, используйте косую черту ( **/** ) в качестве исходного значения шаблона.
Назначение | Определите целевой путь, который будет использоваться в перезаписи. Целевой путь перезаписывает исходный шаблон.
Сохранить непарный путь | Если задано значение **Да**, оставшийся путь после исходного шаблона добавляется к новому целевому пути. 

## <a name="server-variable"></a>Переменная сервера

### <a name="supported-variables"></a>Поддерживаемые переменные

| Имя переменной | Описание                                                  |
| -------------------------- | :----------------------------------------------------------- |
| socket_ip                  | IP-адрес прямого подключения к границе передней дверцы Azure. Если клиент использовал прокси-сервер HTTP или подсистему балансировки нагрузки для отправки запроса, значение Соккетип — это IP-адрес прокси-сервера или балансировщика нагрузки. |
| client_ip                  | IP-адрес клиента, который сделал исходный запрос. Если в запросе был указан заголовок X-Forwardd-for, то IP-адрес клиента выбирается из этого же. |
| client_port                | IP-порт клиента, который сделал запрос. |
| hostname                      | Имя узла в запросе от клиента. |
| geo_country                     | Указывает страну или регион происхождения инициатора запроса с помощью кода страны или региона. |
| http_method                | Метод, используемый для выполнения запроса URL-адреса. Например, GET или POST. |
| http_version               | Протокол запроса. Обычно HTTP/1.0, HTTP/1.1 или HTTP/2.0. |
| query_string               | Список пар "переменная-значение", следующий за "?" в запрошенном URL-адресе. Пример. в запросе *http://contoso.com:8080/article.aspx?id=123&title=fabrikam* QUERY_STRING значение будет *ID = 123&Title = Fabrikam* . |
| request_scheme             | Схема запроса: HTTP или HTTPS. |
| request_uri                | Полный URI исходного запроса (с аргументами). Пример. в запросе *http://contoso.com:8080/article.aspx?id=123&title=fabrikam* REQUEST_URI значение будет */артикле.аспкс? ID = 123&Title = Fabrikam* |
| server_port                | Порт сервера, который принял запрос. |
| ssl_protocol    | Протокол установленного подключения TLS. |
| url_path                   | Определяет конкретный ресурс на узле, к которому требуется доступ веб-клиент. Это часть URI запроса без аргументов. Пример. в запросе *http://contoso.com:8080/article.aspx?id=123&title=fabrikam* uri_path значение будет равно */артикле.аспкс* . |

### <a name="server-variable-format"></a>Формат переменных сервера    

**Формат:** {переменная: offset}, {переменная: смещение: длина}, {переменная}

### <a name="supported-server-variable-actions"></a>Поддерживаемые действия с переменными сервера

* Заголовок запроса
* Заголовок ответа
* Строка запроса ключа кэша
* Переопределение URL-адреса
* Перенаправление URL-адреса

## <a name="next-steps"></a>Следующие шаги

* Дополнительные сведения о [наборе правил Станард/Premium для передней дверцы Azure](concept-rule-set.md).
* Дополнительные сведения о [условиях соответствия наборов правил](concept-rule-set-match-conditions.md).
