---
title: Устранение неполадок сжатия файлов в интерфейсе передней дверцы Azure Standard/Premium
description: Узнайте, как устранять неполадки, связанные с сжатием файлов в передней дверце Azure. В этой статье рассматривается несколько возможных причин.
services: frontdoor
author: duongau
ms.service: frontdoor
ms.topic: how-to
ms.date: 02/18/2020
ms.author: qixwang
ms.openlocfilehash: c912ebde5499ec2f9f68e5f5762af60823faefe1
ms.sourcegitcommit: 97c48e630ec22edc12a0f8e4e592d1676323d7b0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/18/2021
ms.locfileid: "101100230"
---
# <a name="troubleshooting-azure-front-door-standardpremium-file-compression"></a>Устранение неполадок сжатия файлов уровня "Стандартный" и "Премиум" передней дверцы Azure

> [!Note]
> Эта документация предназначена для передней дверцы Azure уровня "Стандартный" или "Премиум" (Предварительная версия). Ищете информацию о передней дверце Azure? Просмотреть [здесь](../front-door-overview.md).

Эта статья поможет вам устранить неполадки, связанные с сжатием файлов на передней дверце Azure.

> [!IMPORTANT]
> Передняя дверца Azure Standard/Premium (Предварительная версия) в настоящее время доступна в общедоступной предварительной версии.
> Эта предварительная версия предоставляется без соглашения об уровне обслуживания и не рекомендована для использования рабочей среде. Некоторые функции могут не поддерживаться или их возможности могут быть ограничены.
> Дополнительные сведения см. в статье [Дополнительные условия использования предварительных выпусков Microsoft Azure](https://azure.microsoft.com/support/legal/preview-supplemental-terms/).

## <a name="symptom"></a>Симптом

Сжатие для маршрута включено, но файлы возвращаются в несжатом виде.

> [!TIP]
> Чтобы проверить, сжаты ли возвращаемые файлы, используйте такой инструмент, как [Fiddler](https://www.telerik.com/fiddler), или [инструменты разработчика](https://developer.microsoft.com/microsoft-edge/platform/documentation/f12-devtools-guide/) в браузере.  Проверьте заголовки HTTP-ответа, возвращаемые с кэшированным содержимым CDN.  Если есть заголовок с именем `Content-Encoding` со значением **gzip**, **bzip2** или **deflate**, то содержимое сжато.
> 
> ![Заголовок Content-Encoding](../media/troubleshoot-compression/content-header.png)
> 

## <a name="cause"></a>Причина

Возможно несколько причин, включая указанные ниже.

* Запрошенное содержимое не подходит для сжатия.
* Для запрошенного типа файла сжатие не включено.
* HTTP-запрос не включал заголовок, запрашивающий допустимый тип сжатия.
* Источник отправляет поблочное содержимое.

## <a name="troubleshooting-steps"></a>Действия по устранению неполадок

> [!TIP]
> Как и при развертывании новых конечных точек, изменение конфигурации АФД занимает некоторое время для распространения по сети.  Как правило, изменения применяются в течение 90 минут.  Если сжатие для конечной точки CDN задается впервые, следует подождать один-два часа, чтобы настройки сжатия гарантированно распространились на серверы POP. 
> 

### <a name="verify-the-request"></a>Проверка запроса

Сначала необходимо дважды проверить запрос. Для просмотра выполняемых запросов можно использовать **[средства разработчика](https://developer.microsoft.com/microsoft-edge/platform/documentation/f12-devtools-guide/)** браузера.

* Убедитесь, что запрос отправляется по URL-адресу конечной точки, `<endpointname>.z01.azurefd.net` а не к источнику.
* Запрос должен содержать заголовок **Accept-Encoding** со значением **gzip**, **deflate** или **bzip2**.

![Заголовки запроса CDN](../media/troubleshoot-compression/request-headers.png)

### <a name="verify-compression-settings"></a>Проверка параметров сжатия

Перейдите к конечной точке в [портал Azure](https://portal.azure.com) и нажмите кнопку **настроить** на панели маршруты. Убедитесь, что сжатие **включено**.

![Параметры сжатия CDN](../media/troubleshoot-compression/compression-settings.png)

### <a name="check-the-request-at-the-origin-server-for-a-via-header"></a>Проверьте, есть ли в запросе на сервере-источнике заголовок **Via** .

HTTP-заголовок **Via** указывает веб-серверу, что запрос передается через прокси-сервер.  Веб-серверы Microsoft IIS по умолчанию не сжимают ответы, если запрос содержит заголовок **Via** .  Чтобы переопределить это поведение, выполните следующие действия.

* **IIS 6**: Set хкнокомпрессионфорпроксиес = "false" в свойствах метабазы IIS. Дополнительные сведения см. в разделе [IIS 6 Compression](/previous-versions/iis/6.0-sdk/ms525390(v=vs.90)).
* **IIS 7 и выше**: задайте для параметров **NoCompressionForHttp10** и **нокомпрессионфорпроксиес** *значение false* в конфигурации сервера. Дополнительные сведения см. в разделе [Сжатие HTTP](https://www.iis.net/configreference/system.webserver/httpcompression).
