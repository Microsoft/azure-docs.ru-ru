---
title: Автомасштабирование масштабируемых наборов виртуальных машин на портале Azure
description: Узнайте, как создать правила автомасштабирования для масштабируемых наборов виртуальных машин с помощью портала Azure.
author: ju-shim
ms.author: jushiman
ms.topic: how-to
ms:service: virtual-machine-scale-sets
ms.subservice: autoscale
ms.date: 05/29/2018
ms.reviewer: avverma
ms.custom: avverma
ms.openlocfilehash: 4bb4084a7ee0d9d719a88c077fa8c63803aa6934
ms.sourcegitcommit: 910a1a38711966cb171050db245fc3b22abc8c5f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "100591362"
---
# <a name="automatically-scale-a-virtual-machine-scale-set-in-the-azure-portal"></a>Автоматическое масштабирование масштабируемых наборов виртуальных машин на портале Azure
При создании масштабируемого набора вы определяете количество экземпляров виртуальных машин для запуска. По мере изменения потребностей приложения можно автоматически увеличивать или уменьшать это количество. Возможность автоматического масштабирования позволяет удовлетворить пользовательский спрос или среагировать на изменения производительности приложения на протяжении его жизненного цикла.

В этой статье описывается, как создать правила автомасштабирования с помощью портала Azure, которые отслеживают производительность экземпляров виртуальных машин в масштабируемом наборе. С помощью этих правил можно увеличить или уменьшить количество экземпляров виртуальных машин в ответ на метрики производительности. Эти действия также можно выполнить с помощью [Azure PowerShell](tutorial-autoscale-powershell.md) или [Azure CLI](tutorial-autoscale-cli.md).


## <a name="prerequisites"></a>Предварительные требования
Чтобы создать правила автомасштабирования, вам понадобится имеющийся масштабируемый набор виртуальных машин. Его можно создать с помощью [портала Microsoft Azure](quick-create-portal.md), [Azure PowerShell](quick-create-powershell.md) или [Azure CLI](quick-create-cli.md).


## <a name="create-a-rule-to-automatically-scale-out"></a>Создание правила для автоматического горизонтального увеличения масштаба
При увеличении потребностей приложения в масштабируемом наборе увеличивается нагрузка на экземпляры виртуальной машины. Если такая увеличенная нагрузка представляет собой не просто краткий спрос, а является согласованной, можно настроить правила автомасштабирования, чтобы увеличить число экземпляров виртуальной машины в масштабируемом наборе. После создания этих экземпляров виртуальных машин и развертывания приложений масштабируемые наборы запускают распределение трафика между ними через подсистему балансировки нагрузки. Вы можете контролировать, какие метрики отслеживать, например ЦП или диск, продолжительность соответствия нагрузки приложения заданному пороговому значению, а также количество экземпляров виртуальной машины для добавления в масштабируемый набор.

1. Откройте Azure портала и выберите **Группы ресурсов** в меню слева на панели мониторинга.
2. Выберите группу ресурсов, которая содержит ваш масштабируемый набор, а затем выберите его из списка ресурсов.
3. Выберите **Масштабирование** в меню в левой части окна масштабируемого набора. Нажмите кнопку **Включить автомасштабирование**.

    ![Включение автомасштабирования на портале Azure](media/virtual-machine-scale-sets-autoscale-portal/enable-autoscale.png)

4. Введите имя для параметров, например *autoscale*, затем выберите параметр, чтобы **добавить правило**.

5. Давайте создадим правило, в соответствии с которым количество экземпляров виртуальных машин в масштабируемом наборе увеличивается, когда средняя загрузка ЦП превышает 70 % в течение 10 минут. При активации правила количество экземпляров виртуальной машины увеличивается на 20 %. В масштабируемых наборах с небольшим числом экземпляров виртуальных машин можно задать для параметра **Операция** значение *Увеличить счетчик на* и указать значение *1* или *2* для параметра *Число экземпляров*. В этих же наборах с большим числом экземпляров виртуальных машин более оптимальным является увеличение на 10 или 20 % экземпляров.

    Укажите следующие параметры для правила.
    
    | Параметр              | Объяснение                                                                                                         | Значение          |
    |------------------------|---------------------------------------------------------------------------------------------------------------------|----------------|
    | *Агрегат времени*     | Определяет способ вычисления собранных метрик для анализа.                                                | Среднее        |
    | *Имя метрики*          | Метрика производительности для мониторинга и применения действий в масштабируемом наборе.                                                   | Percentage CPU |
    | *Статистика интервала времени* | Определяет способ вычисления собранных метрик для анализа на каждом интервале времени.                             | Среднее        |
    | *Оператор*             | Оператор для сравнения данных метрики с пороговым значением.                                                     | Больше   |
    | *Пороговое значение*.            | Процентное значение, при достижении которого правило автомасштабирования запускает действие.                                                 | 70             |
    | *Длительность*             | Количество времени, в течение которого выполняется отслеживание перед сравнением значений метрик и пороговых значений. Не включает в себя период охлаждения.                                   | 10 минут.     |
    | *Операция*            | Определяет, будет ли масштабируемый набор увеличиваться или уменьшаться при применении правила и на каком инкременте.                        | Увеличить процент на |
    | *Число экземпляров*       | При активации правила должен измениться процент экземпляров виртуальных машин.                                            | 20             |
    | *Охлаждение (в минутах)*  | Время ожидания перед повторным применением правила, чтобы обеспечить время для активации действий автомасштабирования. | 5 мин      |

    Ниже приведены примеры правил, созданных на портале Azure, которые сопоставляют эти параметры.

    ![Создание правила автомасштабирования для увеличения числа экземпляров виртуальных машин](media/virtual-machine-scale-sets-autoscale-portal/rule-increase.png)

6. Чтобы создать правило, выберите **Добавить**.


## <a name="create-a-rule-to-automatically-scale-in"></a>Создание правила для автоматического горизонтального уменьшения масштаба
В вечерние часы или выходные дни потребность в приложении может снизиться. Если такая сниженная нагрузка является согласованной в течение некоторого периода времени, можно настроить правила автомасштабирования, чтобы уменьшить число экземпляров виртуальных машин в масштабируемом наборе. Это действие снижает стоимость запуска масштабируемого набора, так как вы запускаете только то количество экземпляров, которое необходимо для удовлетворения текущего спроса.

1. Еще раз выберите для **Добавить правило**.
2. Создайте правило, в соответствии с которым количество экземпляров виртуальной машины в масштабируемом наборе уменьшается, когда средняя загрузка ЦП не превышает 30 % в течение 10 минут. При активации правила количество экземпляров виртуальной машины уменьшается на 20 %.

    Используйте тот же подход, что и для предыдущего правила. Настройте приведенные ниже параметры для правила.
    
    | Параметр              | Объяснение                                                                                                          | Значение          |
    |------------------------|----------------------------------------------------------------------------------------------------------------------|----------------|
    | *Оператор*             | Оператор для сравнения данных метрики с пороговым значением.                                                      | Меньше чем   |
    | *Пороговое значение*.            | Процентное значение, при достижении которого правило автомасштабирования запускает действие.                                                 | 30             |
    | *Операция*            | Определяет действие, применяемое к масштабируемому набору при выполнении условий правила (увеличение или уменьшение числа экземпляров), а также шаг приращения.                         | Уменьшить процент на |
    | *Число экземпляров*       | При активации правила должен измениться процент экземпляров виртуальных машин.                                             | 20             |

3. Чтобы создать правило, выберите **Добавить**.


## <a name="define-autoscale-instance-limits"></a>Определение ограничений автомасштабирования экземпляров
В профиле автомасштабирования необходимо определить минимальное, максимальное и используемое по умолчанию количество экземпляров виртуальных машин. При применении правил автомасштабирования эти ограничения экземпляров гарантируют, что горизонтальное увеличение масштаба не выйдет за рамки максимального или минимального числа экземпляров.

1. Установите следующие ограничения экземпляров.

    | Минимальные | Максимальная | По умолчанию|
    |---------|---------|--------|
    | 2       | 10      | 2      |

2. Чтобы применить правила автомасштабирования и ограничения экземпляров, щелкните **Сохранить**.


## <a name="monitor-number-of-instances-in-a-scale-set"></a>Мониторинг количества экземпляров в масштабируемом наборе
Чтобы просмотреть количество и состояние экземпляров виртуальных машин, выберите **Экземпляры** в меню, расположенном в левой части окна масштабируемого набора. Состояние указывает на *создание* экземпляра виртуальной машины по мере автоматического увеличения развертывания масштабируемого набора или на их *удаление* по мере автоматического свертывания набора.

![Просмотр списка экземпляров виртуальных машин масштабируемого набора](media/virtual-machine-scale-sets-autoscale-portal/view-instances.png)


## <a name="autoscale-based-on-a-schedule"></a>Автомасштабирование на основе расписания
В примерах выше мы рассмотрели автоматическое масштабирование масштабируемого набора на основе основных метрик узла, например использования ЦП. Можно также создать правила автомасштабирования на основе расписания. Эти правила на основе расписания позволяют автоматически горизонтально увеличивать масштаб экземпляров виртуальных машин перед ожидаемым увеличением потребностей приложения, например основными рабочими часами, а затем автоматически горизонтально уменьшить масштаб экземпляров, когда потребность в использовании приложения снижается, например на выходных.

1. Выберите **Масштабирование** в меню в левой части окна масштабируемого набора. Чтобы удалить существующие правила автомасштабирования, созданные в предыдущих примерах, выберите значок урны.

    ![Удаление существующих правил автомасштабирования](media/virtual-machine-scale-sets-autoscale-portal/delete-rules.png)

2. Щелкните **Add a scale condition** (Добавить условие масштабирования). Щелкните значок карандаша рядом с именем правила и укажите имя, например *Горизонтальное увеличение масштаба по рабочим дням*.

    ![Переименование правила автомасштабирования по умолчанию](media/virtual-machine-scale-sets-autoscale-portal/rename-rule.png)

3. Выберите переключатель **Масштабировать до указанного числа экземпляров**.
4. Чтобы увеличить число экземпляров, введите значение *10* для количества экземпляров.
5. Для параметра **Расписание** выберите значение **Повторять в определенные дни**.
6. Выберите все рабочие дни, с понедельника по пятницу.
7. Выберите соответствующий часовой пояс, а затем укажите **время начала** — *9:00*.
8. Еще раз щелкните **Add a scale condition** (Добавить условие масштабирования). Повторите процедуру, чтобы создать расписание *Свертывание вечером*, которое масштабирует число экземпляров до *3*, повторяется каждый рабочий день и запускается в *18:00*.
9. Чтобы применить правила автомасштабирования на основе расписания, выберите **Сохранить**.

    ![Создание правил автомасштабирования для масштабирования по расписанию](media/virtual-machine-scale-sets-autoscale-portal/schedule-autoscale.PNG)

Чтобы увидеть, как применяются правила автомасштабирования, выберите **Журнал выполнения** в верхней части окна **Масштабирование**. График и список событий соответствуют активации правил автомасштабирования и количеству экземпляров виртуальных машин в масштабируемом наборе при изменении масштаба.


## <a name="next-steps"></a>Дальнейшие действия
Из этой статьи вы узнали, как использовать правила автомасштабирования для горизонтального масштабирования, а также как увеличивать или уменьшать *число* экземпляров виртуальных машин в масштабируемом наборе. Чтобы увеличить или уменьшить *размер* экземпляров виртуальных машин, вы также можете выполнить вертикальное масштабирование. Дополнительные сведения см. в статье [Вертикальное автомасштабирование масштабируемых наборов виртуальных машин](virtual-machine-scale-sets-vertical-scale-reprovision.md).

Сведения об управлении экземплярами виртуальных машин см. в статье [Управление масштабируемым набором виртуальных машин с помощью Azure PowerShell](./virtual-machine-scale-sets-manage-powershell.md).

Сведения о том, как создать оповещения при активации правил автомасштабирования, см. в статье [Использование действий автомасштабирования для отправки электронной почты и уведомлений об оповещениях веб-перехватчика в Azure Monitor](../azure-monitor/autoscale/autoscale-webhook-email.md). Вы также можете [использовать журналы аудита для отправки электронной почты и уведомлений об оповещениях веб-перехватчика в Azure Monitor](../azure-monitor/alerts/alerts-log-webhook.md).
