---
title: Управление масштабируемыми наборами виртуальных машин с помощью Azure CLI
description: Стандартные команды Azure CLI для управления масштабируемыми наборами виртуальных машин, в том числе команды для запуска и остановки экземпляра, а также для изменения емкости масштабируемого набора.
author: ju-shim
ms.author: jushiman
ms.topic: how-to
ms.service: virtual-machine-scale-sets
ms.subservice: management
ms.date: 05/29/2018
ms.reviewer: mimckitt
ms.custom: mimckitt, devx-track-azurecli
ms.openlocfilehash: d954f7cdda4cae65f822489828226e0364d0fc29
ms.sourcegitcommit: 772eb9c6684dd4864e0ba507945a83e48b8c16f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "91570530"
---
# <a name="manage-a-virtual-machine-scale-set-with-the-azure-cli"></a>Управление масштабируемым набором виртуальных машин с помощью Azure CLI
На протяжении жизненного цикла масштабируемого набора виртуальных машин может возникнуть необходимость выполнить одну или несколько задач управления. Кроме того, можно создавать сценарии для автоматизации различных задач жизненного цикла. В этой статье подробно рассматриваются некоторые стандартные команды Azure CLI, которые позволяют выполнять эти задачи.

Для выполнения этих задач управления требуется последняя версия Azure CLI. Сведения см. в статье [Установка Azure CLI](/cli/azure/install-azure-cli). Если необходимо создать масштабируемый набор виртуальных машин, это можно [сделать с помощью Azure CLI](quick-create-cli.md).


## <a name="view-information-about-a-scale-set"></a>Просмотр информации о масштабируемом наборе
Чтобы просмотреть общие сведения о масштабируемом наборе, введите команду [az vmss show](/cli/azure/vmss). Следующий пример возвращает сведения о масштабируемом наборе *myScaleSet* в группе ресурсов *myResourceGroup*. Введите свои имена следующим образом.

```azurecli
az vmss show --resource-group myResourceGroup --name myScaleSet
```


## <a name="view-vms-in-a-scale-set"></a>Просмотр виртуальных машин в масштабируемом наборе
Чтобы просмотреть список экземпляров виртуальных машин в масштабируемом наборе, введите команду [az vmss list-instances](/cli/azure/vmss). Следующий пример выводит списки всех экземпляров виртуальных машин в масштабируемом наборе *myScaleSet* в группе ресурсов *myResourceGroup*. Введите собственные значения для имен.

```azurecli
az vmss list-instances \
    --resource-group myResourceGroup \
    --name myScaleSet \
    --output table
```

Чтобы просмотреть дополнительные сведения о конкретном экземпляре виртуальной машины, добавьте параметр `--instance-id` в команду [az vmss get-instance-view](/cli/azure/vmss) и укажите экземпляр для просмотра. Следующий пример возвращает сведения об экземпляре виртуальной машины *0* в масштабируемом наборе *myScaleSet* в группе ресурсов *myResourceGroup*. Введите свои имена следующим образом.

```azurecli
az vmss get-instance-view \
    --resource-group myResourceGroup \
    --name myScaleSet \
    --instance-id 0
```

Вы также можете получить подробные сведения о *instanceView* для всех экземпляров в одном вызове API, что поможет избежать регулирования API для больших установок. Укажите собственные значения для `--resource-group` , `--subscription` и `--name` .

```azurecli
az vmss list-instances \
    --expand instanceView \
    --select instanceView \
    --resource-group <resourceGroupName> \
    --subscription <subID> \
    --name <vmssName>
```

```rest
GET "https://management.azure.com/subscriptions/<sub-id>/resourceGroups/<resourceGroupName>/providers/Microsoft.Compute/virtualMachineScaleSets/<VMSSName>/virtualMachines?api-version=2019-03-01&%24expand=instanceView"
```

## <a name="list-connection-information-for-vms"></a>Вывод сведений о подключении виртуальных машин
Чтобы подключиться к виртуальным машинам в масштабируемом наборе, необходимо установить подключение по протоколу SSH или RDP по назначенному общедоступному IP адресу и номеру порта. По умолчанию правила преобразования сетевых адресов (NAT) добавляются в подсистему балансировки нагрузки Azure для переадресации трафика удаленного подключения на каждую виртуальную машину. Чтобы получить список адресов и портов для подключения к экземплярам виртуальных машин в масштабируемом наборе, введите команду [az vmss list-instance-connection-info](/cli/azure/vmss). Следующий пример выводит сведения о подключении экземпляров виртуальных машин в масштабируемом наборе *myScaleSet* в группе ресурсов *myResourceGroup*. Введите собственные значения для имен.

```azurecli
az vmss list-instance-connection-info \
    --resource-group myResourceGroup \
    --name myScaleSet
```


## <a name="change-the-capacity-of-a-scale-set"></a>Изменение емкости масштабируемого набора
Указанные выше команды показывали сведения о масштабируемом наборе и экземплярах виртуальных машин. Чтобы увеличить или уменьшить число экземпляров в масштабируемом наборе, можно изменить его емкость. Масштабируемый набор создает или удаляет необходимое количество виртуальных машин, а затем настраивает виртуальные машины для приема трафика приложения.

Чтобы просмотреть количество экземпляров, присутствующих в масштабируемом наборе, используйте команду [az vmss show](/cli/azure/vmss) и отправьте запрос для *sku.capacity*.

```azurecli
az vmss show \
    --resource-group myResourceGroup \
    --name myScaleSet \
    --query [sku.capacity] \
    --output table
```

После этого можно вручную увеличить или уменьшить число виртуальных машин в масштабируемом наборе, выполнив команду [az vmss scale](/cli/azure/vmss). Приведенный ниже пример задает число виртуальных машин в масштабируемом наборе, равное *5*.

```azurecli
az vmss scale \
    --resource-group myResourceGroup \
    --name myScaleSet \
    --new-capacity 5
```

На обновление емкости масштабируемого набора требуется несколько минут. При уменьшении емкости масштабируемого набора первыми удаляются виртуальные машины с наибольшим значением идентификатора экземпляра.


## <a name="stop-and-start-vms-in-a-scale-set"></a>Остановка и запуск виртуальных машин в масштабируемом наборе
Чтобы остановить одну или несколько виртуальных машин в масштабируемом наборе, используйте команду [az vmss stop](/cli/azure/vmss#az-vmss-stop). С помощью параметра `--instance-ids` можно указать одну или несколько виртуальных машин, которые нужно остановить. Если не указать идентификатор экземпляра, останавливаются все виртуальные машины в масштабируемом наборе. Чтобы остановить несколько виртуальных машин, разделите идентификаторы экземпляров пробелами.

Следующий пример останавливает экземпляр *0* в масштабируемом наборе *myScaleSet* в группе ресурсов *myResourceGroup*. Укажите свои значения следующим образом.

```azurecli
az vmss stop --resource-group myResourceGroup --name myScaleSet --instance-ids 0
```

Остановленные виртуальные машины остаются выделенными, и за них по-прежнему взимается плата за вычислительные операции. Если вместо этого требуется освободить виртуальные машины, чтобы плата взималась только за хранение данных, используйте команду [az vmss deallocate](/cli/azure/vmss). Чтобы освободить несколько виртуальных машин, разделите идентификаторы экземпляров пробелами. Следующий пример освобождает экземпляр *0* в масштабируемом наборе *myScaleSet* в группе ресурсов *myResourceGroup*. Укажите свои значения следующим образом.

```azurecli
az vmss deallocate --resource-group myResourceGroup --name myScaleSet --instance-ids 0
```


### <a name="start-vms-in-a-scale-set"></a>Запуск виртуальных машин в масштабируемом наборе
Чтобы запустить одну или несколько виртуальных машин в масштабируемом наборе, используйте команду [az vmss start](/cli/azure/vmss). С помощью параметра `--instance-ids` можно указать одну или несколько виртуальных машин, которые нужно запустить. Если не указать идентификатор экземпляра, запускаются все виртуальные машины в масштабируемом наборе. Чтобы запустить несколько виртуальных машин, разделите идентификаторы экземпляров пробелами.

Следующий пример запускает экземпляр *0* в масштабируемом наборе *myScaleSet* в группе ресурсов *myResourceGroup*. Укажите свои значения следующим образом.

```azurecli
az vmss start --resource-group myResourceGroup --name myScaleSet --instance-ids 0
```


## <a name="restart-vms-in-a-scale-set"></a>Перезапуск виртуальных машин в масштабируемом наборе
Чтобы перезапустить одну или несколько виртуальных машин в масштабируемом наборе, используйте команду [az vmss restart](/cli/azure/vmss). С помощью параметра `--instance-ids` можно указать одну или несколько виртуальных машин, которые нужно перезапустить. Если не указать идентификатор экземпляра, перезапускаются все виртуальные машины в масштабируемом наборе. Чтобы перезапустить несколько виртуальных машин, разделите идентификаторы экземпляров пробелами.

Следующий пример перезапускает экземпляр *0* в масштабируемом наборе *myScaleSet* в группе ресурсов *myResourceGroup*. Укажите свои значения следующим образом.

```azurecli
az vmss restart --resource-group myResourceGroup --name myScaleSet --instance-ids 0
```


## <a name="remove-vms-from-a-scale-set"></a>Удаление виртуальных машин из масштабируемого набора
Чтобы удалить одну или несколько виртуальных машин из масштабируемого набора, используйте команду [az vmss delete-instances](/cli/azure/vmss). С помощью параметра `--instance-ids` можно указать одну или несколько виртуальных машин, которые нужно удалить. Если указать * вместо идентификатора экземпляра, удаляются все виртуальные машины в масштабируемом наборе. Чтобы удалить несколько виртуальных машин, разделите идентификаторы экземпляров пробелами.

Следующий пример удаляет экземпляр *0* в масштабируемом наборе *myScaleSet* в группе ресурсов *myResourceGroup*. Укажите свои значения следующим образом.

```azurecli
az vmss delete-instances --resource-group myResourceGroup --name myScaleSet --instance-ids 0
```


## <a name="next-steps"></a>Дальнейшие действия
К другим типичным задачам управления масштабируемым набором относятся [развертывание приложения](virtual-machine-scale-sets-deploy-app.md) и [обновление экземпляров виртуальных машин](virtual-machine-scale-sets-upgrade-scale-set.md). Можно также использовать Azure CLI для [настройки правил автомасштабирования](virtual-machine-scale-sets-autoscale-overview.md).
