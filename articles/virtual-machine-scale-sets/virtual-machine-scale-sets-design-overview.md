---
title: Рекомендации по проектированию для масштабируемых наборов виртуальных машин Azure
description: Узнайте о вопросах проектирования для масштабируемых наборов виртуальных машин Azure. Сравните функции масштабируемых наборов с функциями виртуальных машин.
keywords: Виртуальная машина Linux, наборы масштабирования виртуальных машин
author: mimckitt
ms.author: mimckitt
ms.topic: conceptual
ms.service: virtual-machine-scale-sets
ms.subservice: management
ms.date: 06/25/2020
ms.reviewer: jushiman
ms.custom: mimckitt
ms.openlocfilehash: 04446243ed827cca4972a4b606c4930e74a2c704
ms.sourcegitcommit: 2c1b93301174fccea00798df08e08872f53f669c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/22/2021
ms.locfileid: "104774972"
---
# <a name="design-considerations-for-scale-sets"></a>Рекомендации по проектированию масштабируемых наборов
В этой статье рассматриваются вопросы проектирования масштабируемых наборов виртуальных машин. Сведения о том, что такое масштабируемые наборы виртуальных машин, см. в статье [Обзор масштабируемых наборов виртуальных машин](./overview.md).

## <a name="when-to-use-scale-sets-instead-of-virtual-machines"></a>Когда следует использовать масштабируемые наборы вместо виртуальных машин
Как правило, масштабируемые наборы полезны при развертывании инфраструктуры высокой доступности с набором виртуальных машин одинаковой конфигурации. Тем не менее некоторые возможности доступны только в масштабируемых наборах, а другие — только в виртуальных машинах. Чтобы принять взвешенное решение о том, какую технологию использовать в том или ином случае, нужно сначала рассмотреть часто используемые возможности, доступные в масштабируемых наборах, но не на виртуальных машинах:

### <a name="scale-set-specific-features"></a>Возможности масштабируемого набора

- После указания конфигурации масштабируемого набора можно обновить свойство *Capacity* для параллельного развертывания дополнительных виртуальных машин. Этот процесс гораздо проще, чем написание сценария для оркестрации развертывания множества отдельных виртуальных машин в параллельном режиме.
- [Автоматическое масштабирование Azure можно использовать для масштабируемого набора](./virtual-machine-scale-sets-autoscale-overview.md), но не для отдельных виртуальных машин.
- Вы можете [пересоздать образ виртуальных машин масштабируемого набора](/rest/api/compute/virtualmachinescalesets/reimage), но [не отдельных виртуальных машин](/rest/api/compute/virtualmachines).
- Виртуальные машины масштабируемого набора можно [избыточно подготовить](#overprovisioning), чтобы улучшить надежность и сократить время развертывания. С отдельными виртуальными машинами избыточную подготовку можно сделать только написав пользовательский код.
- Чтобы упростить развертывание обновлений в виртуальных машинах масштабируемого набора, можно указать [политику обновления](./virtual-machine-scale-sets-upgrade-scale-set.md). Обновления для отдельных виртуальных машин необходимо оркестрировать самостоятельно.

### <a name="vm-specific-features"></a>Возможности отдельных виртуальных машин

Некоторые возможности сейчас доступны только на виртуальных машинах:

- Вы можете записать образ отдельной виртуальной машины, но не машины в масштабируемом наборе.
- Отдельную виртуальную машину можно перенести из собственных дисков в управляемые. Для экземпляров виртуальных машин в масштабируемом наборе это невозможно.
- Виртуальным сетевым адаптерам отдельных виртуальных машин можно присвоить общедоступные IP-адреса IPv6, но этого нельзя сделать для экземпляров виртуальных машин в масштабируемом наборе. Общедоступные IP-адреса IPv6 можно назначать подсистемам балансировки нагрузки как для отдельных виртуальных машин, так и для виртуальных машин масштабируемого набора.

## <a name="storage"></a>Память

### <a name="scale-sets-with-azure-managed-disks"></a>Масштабируемые наборы с компонентом "Управляемые диски" Azure
Вместо обычных учетных записей хранения Azure для создания масштабируемых наборов можно использовать [компонент "Управляемые диски" Azure](../virtual-machines/managed-disks-overview.md). Компонент "Управляемые диски" обеспечивает следующие преимущества:
- Вам не нужно заранее создавать набор учетных записей хранения Azure для виртуальных машин из масштабируемого набора.
- Вы можете определить [подключенные диски данных](virtual-machine-scale-sets-attached-disks.md) для виртуальных машин в масштабируемом наборе.
- Масштабируемые наборы можно настроить для [поддержки до 1000 виртуальных машин в наборе](virtual-machine-scale-sets-placement-groups.md). 

При наличии имеющегося шаблона можно также [обновить шаблон для использования компонента "Управляемые диски"](virtual-machine-scale-sets-convert-template-to-md.md).

### <a name="user-managed-storage"></a>Управляемое пользователем хранилище
Масштабируемый набор без компонента "Управляемые диски" Azure сохраняет диски операционной системы виртуальных машин в наборе в учетных записях хранения пользователей. Чтобы достичь максимального числа операций ввода-вывода и воспользоваться преимуществами _избыточной подготовки_ (см. ниже), мы рекомендуем использовать не более 20 виртуальных машин на одну учетную запись хранения. Мы также рекомендуем, чтобы имена учетных записей хранения начинались с разных букв. Это поможет распределить нагрузку между разными внутренними системами. 


## <a name="overprovisioning"></a>Избыточная подготовка
В настоящее время масштабируемый набор по умолчанию избыточно подготавливает виртуальные машины. Если избыточная подготовка включена, то масштабируемый набор фактически запускает больше виртуальных машин, чем указано, а затем удаляет лишние виртуальные машины после успешной подготовки запрошенного количества виртуальных машин. Избыточная подготовка повышает процент успешной подготовки к работе и сокращает процесс развертывания. Счета за дополнительные виртуальные машины не выставляются, и они не учитываются в квоте.

Хотя избыточная подготовка повышает процент успешной подготовки, он может вызывать проблемы, если в приложении не предусмотрена обработка ситуаций, когда виртуальные машины появляются и удаляются. Чтобы отключить избыточную подготовку, включите в шаблон следующую строку: `"overprovision": "false"`. Дополнительные сведения об этом можно найти в [документации по REST API для масштабируемого набора](/rest/api/virtualmachinescalesets/create-or-update-a-set).

Если выключить избыточную подготовку для масштабируемого набора, использующего учетную запись хранения пользователя, для учетной записи хранения может использоваться более 20 виртуальных машин. Из соображений производительности операций ввода-вывода мы не рекомендуем использовать более 40 виртуальных машин. 

## <a name="limits"></a>Ограничения
Масштабируемый набор, созданный на основе образа Marketplace (также известный как образ платформы) и настроенный для использования компонента "Управляемые диски" Azure, может содержать до 1000 виртуальных машин. Если настроить для масштабируемого набора поддержку более 100 виртуальных машин, не все сценарии будут выполняться одинаково (например, балансировка нагрузки). Дополнительные сведения см. в статье [Работа с крупными масштабируемыми наборами виртуальных машин](virtual-machine-scale-sets-placement-groups.md). 

В настоящее время масштабируемый набор, настроенный с помощью учетных записей хранения пользователей, ограничен 100 виртуальными машинами (и 5 учетными записями хранения для такого масштаба).

Масштабируемый набор, созданный на основе пользовательского образа и настроенный с использованием службы "Управляемые диски" Azure, может содержать до 600 виртуальных машин. Если масштабируемый набор настроен с учетными записями хранения пользователя, он должен создавать все VHD операционной системы в рамках одной учетной записи хранения. Поэтому рекомендуемое максимальное число виртуальных машин в наборе масштабирования на основе пользовательского образа и пользовательского хранилища равно 20. Если отключить избыточную подготовку, этот предел можно повысить до 40.

Для дополнительных виртуальных машин сверх этого значения необходимо развернуть несколько наборов масштабирования, как показано в [этом шаблоне](https://azure.microsoft.com/resources/templates/301-custom-images-at-scale/).
