---
title: Создание масштабируемого набора, использующего точки Azure для машинного уровня
description: Узнайте, как создавать масштабируемые наборы виртуальных машин Azure, использующие плашечные виртуальные машины, чтобы сэкономить на затратах.
author: JagVeerappan
ms.author: jagaveer
ms.topic: how-to
ms.service: virtual-machine-scale-sets
ms.subservice: spot
ms.date: 03/25/2020
ms.reviewer: cynthn
ms.custom: jagaveer, devx-track-azurecli, devx-track-azurepowershell
ms.openlocfilehash: 03bf5e0ef7e6268e68139b6d73685f67d88f6231
ms.sourcegitcommit: d4734bc680ea221ea80fdea67859d6d32241aefc
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/14/2021
ms.locfileid: "100385937"
---
# <a name="azure-spot-vms-for-virtual-machine-scale-sets"></a>Виртуальные машины с Точкию Azure для масштабируемых наборов виртуальных машин 

Использование точки Azure в масштабируемых наборах позволяет использовать преимущества нашей неиспользуемой емкости с значительной экономией затрат. В любой момент, когда Azure нужна емкость, инфраструктура Azure будет выключать экземпляры смесевых цветов. Таким образом, плашечные экземпляры отлично подходят для рабочих нагрузок, которые могут обрабатывать прерывания, такие как задания пакетной обработки, среды разработки и тестирования, большие вычислительные рабочие нагрузки и многое другое.

Объем доступной емкости может варьироваться в зависимости от размера, региона, времени суток и других параметров. При развертывании смесевых экземпляров в масштабируемых наборах Azure выделит экземпляр только при наличии доступной емкости, но соглашение об уровне обслуживания для этих экземпляров отсутствует. Масштабируемый набор развертывается в одном домене сбоя и не предоставляет гарантии высокого уровня доступности.


## <a name="pricing"></a>Цены

Цены на экземпляры смесевых переменных основаны на регионе и номере SKU. Дополнительные сведения см. в статье цены на [Linux](https://azure.microsoft.com/pricing/details/virtual-machine-scale-sets/linux/) и [Windows](https://azure.microsoft.com/pricing/details/virtual-machine-scale-sets/windows/). 


Переменное ценообразование позволяет вам указать максимальную цену в долларах США с точностью до 5 знаков после запятой. Например, значение `0.98765` определяет максимальную цену 0,98765 долларов США в час. Если для параметра Максимальная цена задано значение `-1` , то экземпляр не будет удален на основе цены. Цена для экземпляра будет представлять собой текущую цену на точку или цену для стандартного экземпляра, который когда-либо будет меньше, пока есть доступная емкость и квота.


## <a name="limitations"></a>Ограничения

Для точки Azure не поддерживаются следующие размеры:
 - Серия B
 - Рекламные версии любого размера (например, рекламные размеры Dv2, NV, NC и H)

Службу "разноситься в Azure" можно развернуть в любом регионе, кроме Microsoft Azure Китая 21Vianet.

<a name="channel"></a>

В настоящее время поддерживаются следующие [типы предложений](https://azure.microsoft.com/support/legal/offer-details/) :

-   Соглашение Enterprise
-   Код предложения с оплатой по мере использования 003P
-   Спонсорские
- Для поставщика облачных служб (CSP) обратитесь к своему партнеру.

## <a name="eviction-policy"></a>Политика вытеснения

При создании наборов точечных масштабирования можно задать политику вытеснения для отмены *распределения* (по умолчанию) или *Удалить*. 

Политика *освобождения* перемещает вытесненные экземпляры в остановленное состояние, что позволяет повторно развертывать исключенные экземпляры. Однако нет гарантии, что распределение будет выполнено успешно. Виртуальные машины, распределение которых отменено, будут учитываться в квоте экземпляра масштабируемого набора, и вам будет выставлен счет за базовые диски. 

Если вы хотите, чтобы экземпляры в плашечном наборе были удалены при удалении, можно задать политику вытеснения для *удаления*. Если установлена политика вытеснения с действием удаления, то можно создавать новые виртуальные машины, увеличивая свойство количества экземпляров масштабируемого набора. Вытесненные виртуальные машины удаляются вместе с их базовыми дисками, и поэтому вы не будете платить за хранение. Также можно использовать функцию автомасштабирования масштабируемых наборов, чтобы автоматически попытаться компенсировать вытесненные виртуальные машины, однако нет гарантии, что распределение будет успешным. Рекомендуется использовать функцию автомасштабирования только в плашечных наборах, если вы установили политику вытеснений для удаления во избежание затрат на диски и попадания в квоты. 

Пользователи могут настроить получение уведомлений в виртуальной машине через механизм [Запланированных событий Azure](../virtual-machines/linux/scheduled-events.md). Вы получите информацию о предстоящем вытеснении виртуальных машин, и у вас будет 30 секунд до вытеснения для завершения всех заданий и корректной остановки работы. 

## <a name="placement-groups"></a>Группы размещения
Группа размещения — это конструкция, аналогичная группе доступности Azure с собственными доменами сбоя и доменами обновления. По умолчанию масштабируемый набор содержит одну группу размещения максимум со 100 виртуальными машинами. Если свойство масштабируемого набора `singlePlacementGroup` имеет значение *false*, масштабируемый набор может состоять из нескольких групп размещения и иметь диапазон от 0 до 1000 виртуальных машин. 

> [!IMPORTANT]
> Если вы не используете InfiniBand с HPC, настоятельно рекомендуется установить свойство масштабируемого набора `singlePlacementGroup` в *значение false* , чтобы включить несколько групп размещения для более эффективного масштабирования по регионам или зонам. 

## <a name="deploying-spot-vms-in-scale-sets"></a>Развертывание точечных виртуальных машин в масштабируемых наборах

Чтобы развернуть плашечные виртуальные машины в масштабируемых наборах, можно установить для нового флага *приоритета* значение « *плашечный*». Все виртуальные машины в масштабируемом наборе будут иметь значение "точечная". Чтобы создать масштабируемый набор с точечными виртуальными машинами, используйте один из следующих методов.
- [Портал Azure](#portal)
- [Azure CLI](#azure-cli)
- [Azure PowerShell](#powershell)
- [Шаблоны диспетчера ресурсов Azure](#resource-manager-templates)

## <a name="portal"></a>Портал

Процесс создания масштабируемого набора, использующего плашечные виртуальные машины, аналогичен описанному в [статье Приступая к работе](quick-create-portal.md). При развертывании масштабируемого набора можно задать параметр точки и политику вытеснения: ![ Создание масштабируемого набора с помощью плашечных виртуальных машин.](media/virtual-machine-scale-sets-use-spot/vmss-spot-portal-max-price.png)


## <a name="azure-cli"></a>Azure CLI

Процесс создания масштабируемого набора с плашечными виртуальными машинами аналогичен описанному в [статье Приступая к работе](quick-create-cli.md). Просто добавьте точку с приоритетом "--Priority" и добавьте `--max-price` . В этом примере мы используем `-1` для, `--max-price` чтобы экземпляр не был исключен на основе цены.

```azurecli
az vmss create \
    --resource-group myResourceGroup \
    --name myScaleSet \
    --image UbuntuLTS \
    --upgrade-policy-mode automatic \
    --single-placement-group false \
    --admin-username azureuser \
    --generate-ssh-keys \
    --priority Spot \
    --max-price -1 
```

## <a name="powershell"></a>PowerShell

Процесс создания масштабируемого набора с плашечными виртуальными машинами аналогичен описанному в [статье Приступая к работе](quick-create-powershell.md).
Просто добавьте точку с приоритетом и укажите `-max-price` для [New-азвмссконфиг](/powershell/module/az.compute/new-azvmssconfig).

```powershell
$vmssConfig = New-AzVmssConfig `
    -Location "East US 2" `
    -SkuCapacity 2 `
    -SkuName "Standard_DS2" `
    -UpgradePolicyMode Automatic `
    -Priority "Spot" `
    --max-price -1
```

## <a name="resource-manager-templates"></a>Шаблоны Resource Manager

Процесс создания масштабируемого набора, использующего плашечные виртуальные машины, аналогичен описанному в статье Приступая к работе для [Linux](quick-create-template-linux.md) или [Windows](quick-create-template-windows.md). 

Для развертываний в плашечных шаблонах используйте `"apiVersion": "2019-03-01"` или более поздней версии. 

Добавьте `priority` `evictionPolicy` `billingProfile` Свойства и в `"virtualMachineProfile":` раздел и `"singlePlacementGroup": false,` свойство в `"Microsoft.Compute/virtualMachineScaleSets"` раздел шаблона.

```json

{
  "type": "Microsoft.Compute/virtualMachineScaleSets",
  },
  "properties": {
    "singlePlacementGroup": false,
    }

        "virtualMachineProfile": {
              "priority": "Spot",
                "evictionPolicy": "Deallocate",
                "billingProfile": {
                    "maxPrice": -1
                }
            },
```

Чтобы удалить экземпляр после его исключения, измените значение `evictionPolicy` параметра на `Delete` .

## <a name="faq"></a>ВОПРОСЫ И ОТВЕТЫ

**Вопрос.** После создания экземпляр будет таким же, как и стандартный экземпляр?

**Ответ.** Да, за исключением того, что для точечных виртуальных машин отсутствует соглашение об уровне обслуживания и они могут быть вытеснены в любое время.


**Вопрос.** Что делать, если вытеснена виртуальная машина, а емкость по-прежнему нужна?

**Ответ.** Если емкость вам нужна без промедлений, используйте стандартные виртуальные машины вместо точечных.


**Вопрос.** Как осуществляется управление квотами для точки?

Ответ **.** Экземпляры смесевых и стандартные экземпляры будут иметь отдельные пулы квот. Эти квоты совместно используются всеми точечными виртуальными машинами и экземплярами масштабируемых наборов. Дополнительные сведения см. в статье [Подписка Azure, границы, квоты и ограничения службы](../azure-resource-manager/management/azure-subscription-service-limits.md).


**Вопрос.** Могу ли я запросить увеличение квоты на точечные экземпляры?

**Ответ.** Да, вы можете отправить запрос на увеличение квоты для точечных виртуальных машин, используя [стандартный процесс запроса квот](../azure-portal/supportability/per-vm-quota-requests.md).


**Вопрос.** Можно ли преобразовать существующие масштабируемые наборы в наборы смесевых красок?

Ответ **.** Нет, установка `Spot` флага поддерживается только во время создания.


**Вопрос.** Если я использовался `low` для масштабируемых наборов с низким приоритетом, мне нужно начать использовать `Spot` вместо этого?

Ответ **.** Пока `low` и, и `Spot` будет работать, но следует начать переход на использование `Spot` .


**Вопрос.** Можно ли создать масштабируемый набор с обычными виртуальными машинами и плашечными виртуальными машинами?

Ответ **.** Нет, масштабируемый набор не поддерживает более одного типа приоритета.


**Вопрос.**  Можно ли использовать Автомасштабирование с наборами плашечных масштабируемых наборов?

Ответ **.** Да, можно задать правила автоматического масштабирования для плашечного набора. При удалении виртуальных машин Автомасштабирование может попытаться создать новые плашечные виртуальные машины. Однако помните, что получение этой емкости не гарантируется. 


**Вопрос.**  Работает ли автомасштабирование с обеими политиками вытеснения (освобождение и удаление)?

Ответ **.** Да, но при использовании автомасштабирования рекомендуется задать удаление политики вытеснения. Причина этого состоит в том, что экземпляры, распределение которых отменено, учитываются в емкости масштабируемого набора. При использовании автомасштабирования, скорее всего, вы быстро достигнете целевого количества из-за вытесненных экземпляров, распределение которых отменено. Кроме того, операции масштабирования могут повлиять на выполнение точечных вытеснений. Например, экземпляры масштабируемого набора виртуальных машин могут попадать под число минут, заданное в результате нескольких расвытеснений во время операций масштабирования. 


**Вопрос.** Где можно задать вопрос?

**Ответ.** Разместите вопрос с тегом `azure-spot` в разделе [вопросов и ответов](/answers/topics/azure-spot.html). 

## <a name="next-steps"></a>Следующие шаги

Ознакомьтесь со сведениями о ценах на [странице для определения тарифа масштабируемых наборов виртуальных машин](https://azure.microsoft.com/pricing/details/virtual-machine-scale-sets/linux/).
