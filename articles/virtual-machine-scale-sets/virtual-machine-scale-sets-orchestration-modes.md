---
title: Режимы оркестрации для масштабируемых наборов виртуальных машин в Azure
description: Узнайте, как использовать гибкие и универсальные режимы оркестрации для масштабируемых наборов виртуальных машин в Azure.
author: fitzgeraldsteele
ms.author: fisteele
ms.topic: how-to
ms.service: virtual-machine-scale-sets
ms.subservice: extensions
ms.date: 02/12/2021
ms.reviewer: jushiman
ms.custom: mimckitt
ms.openlocfilehash: d1290b1dcc1e97d63dd41d5be8ca19b81e32f838
ms.sourcegitcommit: 94c3c1be6bc17403adbb2bab6bbaf4a717a66009
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/12/2021
ms.locfileid: "103225036"
---
# <a name="preview-orchestration-modes-for-virtual-machine-scale-sets-in-azure"></a>Предварительная версия: режимы оркестрации для масштабируемых наборов виртуальных машин в Azure 

Масштабируемые наборы виртуальных машин обеспечивают логическую группировку виртуальных машин, управляемых платформой. С помощью масштабируемых наборов вы создадите модель конфигурации виртуальной машины, автоматически добавите или удалите дополнительные экземпляры на основе загрузки ЦП или памяти и автоматически обновите до последней версии ОС. В большинстве случаев масштабируемые наборы позволяют создавать виртуальные машины с помощью модели конфигурации виртуальной машины, предоставленной во время создания масштабируемого набора, а масштабируемый набор может управлять только виртуальными машинами, которые неявно создаются на основе модели конфигурации. 

Режимы оркестрации масштабируемых наборов позволяют лучше контролировать управление экземплярами виртуальных машин с помощью масштабируемого набора. 

> [!IMPORTANT]
> Режим оркестрации определяется при создании масштабируемого набора и не может быть изменен или обновлен позже.


## <a name="scale-sets-with-uniform-orchestration"></a>Масштабируемые наборы с равномерным согласованием
Оптимизировано для крупномасштабных рабочих нагрузок без отслеживания состояния с идентичными экземплярами.

Масштабируемые наборы виртуальных машин с единым оркестрации используют профиль или шаблон виртуальной машины для масштабирования до требуемой емкости. Хотя существует возможность управления и настройки отдельных экземпляров виртуальных машин, единообразно использует идентичные экземпляры ВИРТУАЛЬНОЙ машины. Отдельные однородные экземпляры виртуальных машин предоставляются с помощью команд API ВИРТУАЛЬНОЙ машины масштабируемого набора виртуальных машин. Отдельные экземпляры несовместимы со стандартными командами API виртуальной машины IaaS Azure, такими функциями управления Azure, как Azure Resource Manager разметки ресурсов RBAC, Azure Backup или Azure Site Recovery. Унифицированное согласование обеспечивает гарантии высокого уровня доступности домена сбоя при настройке с числом экземпляров менее 100. Единообразное согласование является общедоступным и поддерживает полный спектр управления масштабируемыми наборами, включая автомасштабирование на основе метрик, защиту экземпляра и автоматическое обновление ОС. 


## <a name="scale-sets-with-flexible-orchestration"></a>Масштабируемые наборы с гибким согласованием 
Высокая доступность при масштабировании с одинаковыми или несколькими типами виртуальных машин.

Благодаря гибкой координации Azure предоставляет унифицированный интерфейс для экосистемы виртуальных машин Azure. Гибкое согласование предлагает гарантии высокого уровня доступности (до 1000 виртуальных машин), распределяя виртуальные машины между доменами сбоя в регионе или в зоне доступности. Это позволяет масштабировать приложение, сохраняя изоляцию доменов сбоя, которая необходима для выполнения рабочих нагрузок на основе кворума или с отслеживанием состояния, в том числе:
- Рабочие нагрузки на основе кворума
- Базы данных Open-Source
- Приложения с отслеживанием состояния
- Службы, требующие высокой доступности и крупномасштабного масштабирования
- Службы, которые хотят смешивать типы виртуальных машин или использовать смешанные виртуальные машины и ВМ по запросу
- Существующие приложения группы доступности  

> [!IMPORTANT]
> Масштабируемые наборы виртуальных машин в гибком режиме оркестрации в настоящее время находятся в общедоступной предварительной версии. Для использования функции общедоступной предварительной версии, описанной ниже, требуется процедура согласия.
> Эта предварительная версия предоставляется без соглашения об уровне обслуживания и не рекомендуется для рабочих нагрузок в рабочей среде. Некоторые функции могут не поддерживаться или их возможности могут быть ограничены.
> Дополнительные сведения см. в статье [Дополнительные условия использования предварительных выпусков Microsoft Azure](https://azure.microsoft.com/support/legal/preview-supplemental-terms/).


## <a name="what-has-changed-with-flexible-orchestration-mode"></a>Что изменилось с помощью гибкого режима оркестрации?
Одно из основных преимуществ гибкой оркестрации заключается в том, что оно предоставляет функции оркестрации по сравнению со стандартными виртуальными машинами Azure IaaS вместо масштабирования дочерних виртуальных машин. Это означает, что вы можете использовать все стандартные API-интерфейсы виртуальных машин для управления гибкими экземплярами оркестрации вместо API-интерфейсов ВИРТУАЛЬНОЙ машины масштабируемого набора виртуальных машин, используемых с единообразным согласованием. В течение периода действия предварительной версии существует несколько различий между управлением экземплярами в гибком оркестрации и единым оркестрации. В общем случае мы рекомендуем использовать стандартные API виртуальных машин IaaS Azure, когда это возможно. В этом разделе мы выделим примеры рекомендаций по управлению экземплярами виртуальных машин с гибким согласованием.  

### <a name="assign-fault-domain-during-vm-creation"></a>Назначение домена сбоя во время создания виртуальной машины
Можно выбрать число доменов сбоя для гибкого масштабируемого набора оркестрации. По умолчанию при добавлении виртуальной машины в гибкий масштабируемый набор Azure равномерно распределяет экземпляры между доменами сбоя. Хотя рекомендуется разрешить Azure назначать домен сбоя, для расширенных сценариев или для устранения неполадок можно переопределить это поведение по умолчанию и указать домен сбоя, в котором будет направляться экземпляр.

```azurecli-interactive 
az vm create –vmss "myVMSS"  –-platform_fault_domain 1
```

### <a name="instance-naming"></a>Именование экземпляров 
При создании виртуальной машины и добавлении ее в гибкий масштабируемый набор вы имеете полный контроль над именами экземпляров в правилах соглашения об именовании Azure. Когда виртуальные машины автоматически добавляются в масштабируемый набор через Автомасштабирование, вы предоставляете префикс, и Azure добавляет уникальный номер в конец имени.

### <a name="query-instances-for-power-state"></a>Экземпляры запросов для состояния электропитания
Предпочтительный способ — использовать граф ресурсов Azure для запроса всех виртуальных машин в масштабируемом наборе виртуальных машин. Граф ресурсов Azure предоставляет эффективные возможности запросов для ресурсов Azure в масштабе по подпискам. 

``` 
| where type =~ 'Microsoft.Compute/virtualMachines' 
| where properties.virtualMachineScaleSet contains "demo" 
| extend powerState = properties.extended.instanceView.powerState.code 
| project name, resourceGroup, location, powerState 
| order by resourceGroup desc, name desc 
```

Запрос ресурсов с помощью [графа ресурсов Azure](../governance/resource-graph/overview.md) — это удобный и эффективный способ запроса ресурсов Azure и СВОРАЧИВАНИЯ вызовов API к поставщику ресурсов. Граф ресурсов Azure — это в конечном итоге кэш, в котором новые или обновленные ресурсы могут не отражаться до 60 секунд. Вы можете:
- Выводит список виртуальных машин в группе ресурсов или подписке.
- Используйте параметр expand, чтобы получить представление экземпляров (Назначение домена сбоя, состояния питания и подготовки) для всех виртуальных машин в подписке.
- Используйте API получения виртуальной машины и команды, чтобы получить представление модели и экземпляра для одного экземпляра.

### <a name="scale-sets-vm-batch-operations"></a>Пакетные операции виртуальных машин с масштабируемыми наборами
Используйте стандартные команды виртуальной машины для запуска, завершения, перезапуска и удаления экземпляров вместо интерфейсов API ВИРТУАЛЬНЫХ машин масштабируемого набора. Пакетные операции ВИРТУАЛЬНОЙ машины масштабируемого набора виртуальных машин (запуск всех, завершение всех, повторное создание образа и т. д.) не используются в гибком режиме оркестрации. 

### <a name="monitor-application-health"></a>Мониторинг работоспособности приложений 
Мониторинг работоспособности приложений позволяет приложению предоставлять Azure с пульсом, чтобы определить, является ли приложение работоспособным или неработоспособным. Azure может автоматически заменять неработоспособные экземпляры виртуальных машин. Для гибких экземпляров масштабируемых наборов необходимо установить и настроить расширение работоспособности приложения на виртуальной машине. Для экземпляров однородных масштабируемых наборов можно использовать расширение работоспособности приложения или оценить работоспособность с помощью Azure Load Balancer пользовательской проверки работоспособности. 

### <a name="list-scale-sets-vm-api-changes"></a>Изменение списка масштабируемых наборов API виртуальных машин 
Масштабируемые наборы виртуальных машин позволяют перечислить экземпляры, принадлежащие к масштабируемому набору. С помощью гибкой согласованности команда list VM масштабируемые наборы виртуальных машин предоставляет список идентификаторов виртуальных машин для масштабируемых наборов. Затем можно вызвать команды получить масштабируемые наборы виртуальных машин, чтобы получить дополнительные сведения о работе масштабируемого набора с экземпляром виртуальной машины. Чтобы получить полные сведения о виртуальной машине, используйте стандартные команды получить виртуальную машину или [граф ресурсов Azure](https://docs.microsoft.com/azure/governance/resource-graph/overview). 

### <a name="retrieve-boot-diagnostics-data"></a>Получение данных диагностики загрузки 
Используйте стандартные интерфейсы API и команды виртуальной машины для получения данных диагностики загрузки экземпляра и снимков экрана. Масштабируемые наборы виртуальных машин. API и команды диагностики загрузки ВИРТУАЛЬНОЙ машины не используются с гибкими экземплярами режима оркестрации.

### <a name="vm-extensions"></a>Расширения виртуальных машин 
Используйте расширения, предназначенные для стандартных виртуальных машин, а не расширения, предназначенные для однородных экземпляров режима оркестрации.


## <a name="a-comparison-of-flexible-uniform-and-availability-sets"></a>Сравнение гибких, единообразных и групп доступности 
В следующей таблице приводится сравнение гибкого режима оркестрации, универсального режима оркестрации и групп доступности по их функциям.

| Функция | Поддерживается гибким согласованием (Предварительная версия) | Поддерживается универсальным согласованием (общедоступная доступность) | Поддерживается службой Авсетс (общая доступность) |
|-|-|-|-|
|         Тип виртуальной машины  | Стандартная виртуальная машина Azure IaaS (Microsoft. COMPUTE/виртуалмачинес)  | Виртуальные машины, относящиеся к масштабируемому набору (Microsoft. COMPUTE/виртуалмачинескалесетс/виртуалмачинес)  | Стандартная виртуальная машина Azure IaaS (Microsoft. COMPUTE/виртуалмачинес)  |
|         Поддерживаемые номера SKU  |            Серии D, серия E серии, серия F серии, серия B, Intel, AMD  |            Все номера SKU  |            Все номера SKU  |
|         зоны доступности;  |            При необходимости укажите все экземпляры, наземныйсь в одной зоне доступности |            Укажите экземпляры, которые распределяются между 1, 2 или 3 зонами доступности  |            Не поддерживается  |
|         Полный контроль над виртуальными машинами, сетевыми адаптерами, дисками  |            Да  |            Ограниченный контроль с помощью API виртуальных машин с масштабируемыми наборами виртуальной машины  |            Да  |
|         Автоматическое масштабирование  |            Нет  |            Да  |            Нет  |
|         Назначение виртуальной машины конкретному домену сбоя  |            Да  |             Нет   |            Нет  |
|         Удаление сетевых карт и дисков при удалении экземпляров виртуальных машин  |            Нет  |            Да  |            Нет  |
|         Политика обновления (масштабируемые наборы виртуальных машин) |            Нет  |            Автоматический, последовательный, ручной  |            Недоступно  |
|         Автоматическое обновление ОС (масштабируемые наборы ВМ) |            Нет  |            Да  |            Н/Д  |
|         Исправление безопасности гостевой системы  |            Да  |            Нет  |            Да  |
|         Завершение уведомлений (масштабируемые наборы ВМ) |            Нет  |            Да  |            Н/Д  |
|         Восстановление экземпляра (масштабируемые наборы ВМ) |            Нет  |            Да   |            Н/Д  |
|         Ускорение работы в сети  |            Да  |            Да  |            Да  |
|         Плашечные экземпляры и цены   |            Да, можно использовать экземпляры как с плашечными, так и с обычными приоритетами  |            Да, экземпляры должны быть либо полностью плашечными, либо обычными  |            Нет, только экземпляры обычного приоритета  |
|         Смешать операционные системы  |            Да, Linux и Windows могут находиться в одном гибком масштабируемом наборе |            Нет, экземпляры являются одной и той же операционной системой  |               Да, Linux и Windows могут находиться в одном гибком масштабируемом наборе |
|         Мониторинг работоспособности приложений  |            Расширение работоспособности приложения  |            Модуль проверки работоспособности приложений или проверка балансировщика нагрузки Azure  |            Расширение работоспособности приложения  |
|         Диски Ултрассд   |            Да  |            Да, только для развертываний зональные  |            Нет  |
|         Infiniband;   |            Нет  |            Да, только одна группа размещения  |            Да  |
|         Ускоритель записи   |            Нет  |            Да  |            Да  |
|         Группы размещения с учетом расположения   |            Да  |            Да  |            Да  |
|         Выделенные узлы Azure   |            Нет  |            Да  |            Да  |
|         Базовое SLB   |            Нет  |            Да  |            Да  |
|         SKU "Стандартный" Azure Load Balancer |            Да  |            Да  |            Да  |
|         Шлюз приложений  |            Нет  |            Да  |            Да  |
|         Управление обслуживанием   |            Нет  |            Да  |            Да  |
|         Вывод списка виртуальных машин в наборе  |            Да  |            Да  |            Да, вывести список виртуальных машин в AvSet  |
|         Оповещения Azure  |            Нет  |            Да  |            Да  |
|         Аналитика виртуальных машин  |            Нет  |            Да  |            Да  |
|         Azure Backup  |            Да  |            Да  |            Да  |
|         Azure Site Recovery  |     Нет  |            Нет  |            Да  |
|         Добавление или удаление существующей виртуальной машины в группе  |            Нет  |            Нет  |            Нет  | 


## <a name="register-for-flexible-orchestration-mode"></a>Регистрация для гибкого режима оркестрации
Перед развертыванием масштабируемых наборов виртуальных машин в гибком режиме оркестрации необходимо сначала зарегистрировать подписку для предварительной версии функции. Для завершения регистрации может потребоваться несколько минут. Для регистрации можно использовать следующие Azure PowerShell или Azure CLI команды.

### <a name="azure-portal"></a>Портал Azure
Перейдите на страницу сведений о подписке, для которой вы хотите создать масштабируемый набор, в гибком режиме оркестрации и выберите в меню пункт предварительные версии компонентов. Выберите две функции Orchestrator для включения: _вморчестраторсинглефд_ и _вморчестратормултифд_ и нажмите кнопку Register (зарегистрировать). Регистрация компонентов может занять до 15 минут.

![Регистрация компонентов.](https://user-images.githubusercontent.com/157768/110361543-04d95880-7ff5-11eb-91a7-2e98f4112ae0.png)

После регистрации компонентов для подписки завершите процесс согласия, добавив изменения в поставщик ресурсов вычислений. Перейдите на вкладку поставщики ресурсов для своей подписки, выберите Microsoft. COMPUTE и нажмите кнопку Повторная регистрация.

![Повторная регистрация](https://user-images.githubusercontent.com/157768/110362176-cd1ee080-7ff5-11eb-8cc8-36aa967e267a.png)


### <a name="azure-powershell"></a>Azure PowerShell 
Используйте командлет [Register-азпровидерфеатуре](/powershell/module/az.resources/register-azproviderfeature) , чтобы включить предварительную версию для подписки. 

```azurepowershell-interactive
Register-AzProviderFeature -FeatureName VMOrchestratorMultiFD -ProviderNamespace Microsoft.Compute `
Register-AzProviderFeature -FeatureName VMOrchestratorSingleFD -ProviderNamespace Microsoft.Compute  
```

Регистрация компонентов может занять до 15 минут. Чтобы проверить состояние регистрации, сделайте следующее: 

```azurepowershell-interactive
Get-AzProviderFeature -FeatureName VMOrchestratorMultiFD -ProviderNamespace Microsoft.Compute 
```

После регистрации функции для подписки завершите процесс согласия, добавив изменения в поставщик ресурсов вычислений. 

```azurepowershell-interactive
Register-AzResourceProvider -ProviderNamespace Microsoft.Compute 
```

### <a name="azure-cli-20"></a>Azure CLI 2.0 
Чтобы включить предварительную версию подписки, используйте команду [AZ Feature Register](/cli/azure/feature#az-feature-register) . 

```azurecli-interactive
az feature register --namespace Microsoft.Compute --name VMOrchestratorMultiFD
az feature register --namespace microsoft.compute --name VMOrchestratorSingleFD 
```

Регистрация компонентов может занять до 15 минут. Чтобы проверить состояние регистрации, сделайте следующее: 

```azurecli-interactive
az feature show --namespace Microsoft.Compute --name VMOrchestratorMultiFD 
```

После регистрации функции для подписки завершите процесс согласия, добавив изменения в поставщик ресурсов вычислений. 

```azurecli-interactive
az provider register --namespace Microsoft.Compute 
```


## <a name="get-started-with-flexible-orchestration-mode"></a>Начало работы с гибким режимом оркестрации

Приступите к работе с гибким режимом оркестрации для масштабируемых наборов с помощью портал Azure, Azure CLI, terraform или REST API.

### <a name="azure-portal"></a>Портал Azure

Создайте масштабируемый набор виртуальных машин в гибком режиме оркестрации с помощью портал Azure.

1. Войдите на [портал Azure](https://portal.azure.com).
1. В строке поиска найдите и выберите **масштабируемые наборы виртуальных машин**. 
1. На странице **масштабируемые наборы виртуальных машин** выберите **создать** .
1. На странице **Создание масштабируемого набора виртуальных машин** просмотрите раздел **orchestration** .
1. В качестве **режима оркестрации** выберите **гибкий** вариант.
1. Задайте **количество доменов сбоя**.
1. Завершите создание масштабируемого набора. Дополнительные сведения о создании масштабируемого набора см. в разделе [Создание масштабируемого набора в портал Azure](quick-create-portal.md#create-virtual-machine-scale-set) .

:::image type="content" source="./media/virtual-machine-scale-sets-orchestration-modes/portal-create-orchestration-mode-flexible.png" alt-text="Режим оркестрации на портале при создании масштабируемого набора":::

Затем добавьте виртуальную машину в масштабируемый набор в гибком режиме оркестрации.

1. В строке поиска найдите и выберите **виртуальные машины**.
1. На странице **виртуальные машины** нажмите кнопку **Добавить** .
1. На вкладке **основы** просмотрите раздел **сведения об экземпляре** .
1. Добавьте виртуальную машину в масштабируемый набор в гибком режиме оркестрации, выбрав масштабируемый набор в **параметрах доступности**. Виртуальную машину можно добавить в масштабируемый набор в том же регионе, в зоне и группе ресурсов.
1. Завершите создание виртуальной машины. 

:::image type="content" source="./media/virtual-machine-scale-sets-orchestration-modes/vm-portal-orchestration-mode-flexible.png" alt-text="Добавление виртуальной машины в масштабируемый набор с гибким режимом оркестрации":::


### <a name="azure-cli-20"></a>Azure CLI 2.0
Создайте гибкий масштабируемый набор виртуальных машин с Azure CLI. В следующем примере показано создание гибкого масштабируемого набора, для которого число доменов сбоя равно 3, создается виртуальная машина, а затем добавляется в гибкий масштабируемый набор. 

```azurecli-interactive
vmssflexname="my-vmss-vmssflex"  
vmname="myVM"  
rg="my-resource-group"  

az group create -n "$rg" -l $location  
az vmss create -n "$vmssflexname" -g "$rg" -l $location --orchestration-mode flexible --platform-fault-domain-count 3  
az vm create -n "$vmname" -g "$rg" -l $location --vmss $vmssflexname --image UbuntuLTS 
```

### <a name="terraform"></a>Terraform
Создайте гибкий масштабируемый набор виртуальных машин с помощью terraform. Для этого процесса требуется **terraform Azurerm Provider v 2.15.0** или более поздней версии. Обратите внимание на следующие параметры:
- Если зона не указана, `platform_fault_domain_count` может принимать значения 1, 2 или 3 в зависимости от региона.
- Если указана зона, `the fault domain count` может иметь значение 1.
- `single_placement_group` параметр должен быть `false` для гибких масштабируемых наборов виртуальных машин.
- При выполнении региональных развертываний не нужно указывать `zones` .

```terraform
resource "azurerm orchestrated_virtual_machine_scale_set" "tf_vmssflex" {
name = "tf_vmssflex"
location = azurerm_resource_group.myterraformgroup.location
resource_group_name = azurerm_resource_group.myterraformgroup.name
platform_fault_domain_count = 1
single_placement_group = false
zones = ["1"]
}
```


### <a name="rest-api"></a>REST API

1. Создайте пустой масштабируемый набор. Требуются следующие параметры.
    - API версии 2019-12-01 (или более поздней) 
    - `false`При создании гибкого масштабируемого набора должна быть одна группа размещения

    ```json
    {
    "type": "Microsoft.Compute/virtualMachineScaleSets",
    "name": "[parameters('virtualMachineScaleSetName')]",
    "apiVersion": "2019-12-01",
    "location": "[parameters('location')]",
    "properties": {
        "singlePlacementGroup": false,
        "platformFaultDomainCount": "[parameters('virtualMachineScaleSetPlatformFaultDomainCount')]"
        },
    "zones": "[variables('selectedZone')]"
    }
    ```

2. Добавьте виртуальные машины в масштабируемый набор.
    1. Назначьте `virtualMachineScaleSet` свойство ранее созданному масштабируемому набору. `virtualMachineScaleSet`Во время создания виртуальной машины необходимо указать свойство. 
    1. Для одновременного создания нескольких виртуальных машин можно использовать функцию шаблона **Copy ()** Azure Resource Manager. См. статью [Итерация ресурсов](https://docs.microsoft.com/azure/azure-resource-manager/templates/copy-resources#iteration-for-a-child-resource) в Azure Resource Manager шаблонах. 

    ```json
    {
    "type": "Microsoft.Compute/virtualMachines",
    "name": "[concat(parameters('virtualMachineNamePrefix'), copyIndex(1))]",
    "apiVersion": "2019-12-01",
    "location": "[parameters('location')]",
    "copy": {
        "name": "VMcopy",
        "count": "[parameters('virtualMachineCount')]"
        },
    "dependsOn": [
        "
        [resourceID('Microsoft.Compute/virtualMachineScaleSets', parameters('virtualMachineScaleSetName'))]",
        "
        [resourceID('Microsoft.Storage/storageAccounts', variables('diagnosticsStorageAccountName'))]",
        "
        [resourceID('Microsoft.Network/networkInterfaces', concat(parameters('virtualMachineNamePrefix'), copyIndex(1), '-NIC1'))]"
        ],
    "properties": {
        "virtualMachineScaleSet": {
            "id": "[resourceID('Microsoft.Compute/virtualMachineScaleSets', parameters('virtualMachineScaleSetName'))]"
        }
    }
    ```

Полный пример см. в [кратком руководстве Azure](https://github.com/Azure/azure-quickstart-templates/tree/master/201-vm-vmss-flexible-orchestration-mode) .


## <a name="frequently-asked-questions"></a>Часто задаваемые вопросы

**Какой масштаб поддерживает гибкое управление согласованием?**

Вы можете добавить до 1000 виртуальных машин в масштабируемый набор в гибком режиме оркестрации.

**Как уровень доступности с гибким взаимодействием сравнивает группы доступности или единое оркестрации?**

|   | Гибкое согласование  | Единое согласование  | Группы доступности  |
|-|-|-|-|
| Развертывание в зонах доступности  | Нет  | Да  | Нет  |
| Гарантии доступности домена сбоя в пределах региона  | Да, до 1000 экземпляров можно распределять в пределах до 3 доменов сбоя в регионе. Максимальное число доменов сбоя зависит от региона  | Да, до 100 экземпляров  | Да, до 200 экземпляров  |
| Группы размещения  | В гибком режиме всегда используется несколько групп размещения (singlePlacementGroup = false)  | Можно выбрать одну группу размещения или несколько групп размещения. | Недоступно  |
| Домены обновления  | Нет, обновления обслуживания или узла завершили домен сбоя по домену сбоя  | До 5 доменов обновления  | До 20 доменов обновления  |


## <a name="troubleshoot-scale-sets-with-flexible-orchestration"></a>Устранение неполадок масштабируемых наборов с помощью гибкой оркестрации
Найдите нужное решение в сценарии устранения неполадок. 

```
InvalidParameter. The value 'False' of parameter 'singlePlacementGroup' is not allowed. Allowed values are: True
```

**Причина:** Подписка не зарегистрирована для общедоступной предварительной версии гибкого режима оркестрации. 

**Решение:** Следуйте приведенным выше инструкциям, чтобы зарегистрироваться в общедоступной предварительной версии гибкого режима оркестрации. 

```
InvalidParameter. The specified fault domain count 2 must fall in the range 1 to 1.
```

**Причина:** `platformFaultDomainCount` Недопустимый параметр для выбранного региона или зоны. 

**Решение:** Необходимо выбрать допустимое `platformFaultDomainCount` значение. Для развертываний зональные максимальное `platformFaultDomainCount` значение равно 1. Для региональных развертываний, в которых не указана зона, максимальное значение `platformFaultDomainCount` зависит от региона. См. раздел [Управление доступностью виртуальных машин для сценариев](../virtual-machines/availability.md) , чтобы определить максимальное число доменов сбоя для каждого региона. 

```
OperationNotAllowed. Deletion of Virtual Machine Scale Set is not allowed as it contains one or more VMs. Please delete or detach the VM(s) before deleting the Virtual Machine Scale Set.
```

**Причина:** Попытка удалить масштабируемый набор в гибком режиме оркестрации, связанном с одной или несколькими виртуальными машинами. 

**Решение:** Удалите все виртуальные машины, связанные с масштабируемым набором, в гибком режиме оркестрации, после чего можно удалить масштабируемый набор.

```
InvalidParameter. The value 'True' of parameter 'singlePlacementGroup' is not allowed. Allowed values are: False.
```
**Причина:** Подписка зарегистрирована для предварительного просмотра гибкого режима оркестрации; Однако `singlePlacementGroup` параметр имеет значение *true*. 

**Решение:** `singlePlacementGroup` Необходимо задать значение *false*. 


## <a name="next-steps"></a>Дальнейшие действия
> [!div class="nextstepaction"]
> [Узнайте, как развернуть приложение в масштабируемом наборе.](virtual-machine-scale-sets-deploy-app.md)
