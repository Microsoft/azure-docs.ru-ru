---
title: Решение VMware для Azure от Клаудсимпле — оптимизация частного облака Клаудсимпле для Oracle RAC
description: Описывается, как развернуть новый кластер и оптимизировать виртуальную машину для установки и настройки кластеров реальных приложений Oracle (RAC).
author: Ajayan1008
ms.author: v-hborys
ms.date: 08/06/2019
ms.topic: article
ms.service: azure-vmware-cloudsimple
ms.reviewer: cynthn
manager: dikamath
ms.openlocfilehash: 3959aae5f490af10c6747cfa67d9960e0c4a203f
ms.sourcegitcommit: d7d5f0da1dda786bda0260cf43bd4716e5bda08b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/05/2021
ms.locfileid: "97899275"
---
# <a name="optimize-your-cloudsimple-private-cloud-for-installing-oracle-rac"></a>Оптимизируйте частное облако Клаудсимпле для установки Oracle RAC

Вы можете развернуть в среде частного облака Клаудсимпле кластеры реальных приложений Oracle (RAC). В этом руководство описано, как развернуть новый кластер и оптимизировать виртуальную машину для решения Oracle RAC. После выполнения действий, описанных в этом разделе, можно установить и настроить Oracle RAC.

## <a name="storage-policy"></a>Политика хранилища

Для успешной реализации Oracle RAC требуется достаточное количество узлов в кластере.  В политике хранилища vSAN к дискам данных, используемым для хранения дисков базы данных, журналов и повторов, применяются сбои (ФТТ).  Количество узлов, которые должны эффективно допускать сбои, равно 2N + 1, где N — значение ФТТ.

Пример. Если требуемый ФТТ равен 2, общее число узлов в кластере должно быть 2 * 2 + 1 = 5.

## <a name="overview-of-deployment"></a>Общие сведения о развертывании

В следующих разделах описывается настройка среды частного облака Клаудсимпле для Oracle RAC.

1. Рекомендации по настройке диска
2. Развертывание кластера vSphere частного облака Клаудсимпле
3. Настройка сетей для сертификата RAC Oracle
4. Настройка политик хранилища vSAN
5. Создание виртуальных машин Oracle и создание общих дисков виртуальной машины
6. Настройка правил сопоставления виртуальных машин и узлов

## <a name="best-practices-for-disk-configuration"></a>Рекомендации по настройке диска

Виртуальные машины Oracle RAC имеют несколько дисков, которые используются для определенной функции.  Общие диски монтируются на всех виртуальных машинах, используемых кластером RAC Oracle.  Установочные диски операционной системы и программного обеспечения монтируются только на отдельных виртуальных машинах.  

![Обзор дисков виртуальной машины Oracle RAC](media/oracle-vm-disks-overview.png)

В следующем примере используются диски, определенные в таблице ниже.

| Диск                                      | Назначение                                       | Общий диск |
|-------------------------------------------|-----------------------------------------------|-------------|
| OS                                        | Диск операционной системы                         | Нет          |
| СЕТКИ                                      | Расположение установки для программного обеспечения сетки Oracle     | Нет          |
| DATABASE                                  | Расположение установки по для базы данных Oracle | Нет          |
| орахоме                                   | Базовое расположение для двоичных файлов базы данных Oracle    | Нет          |
| ФАЙЛ1, ФАЙЛ2, DATA3, DATA4                | Диск, на котором хранятся файлы базы данных Oracle   | Да         |
| REDO1, REDO2, REDO3, REDO4, REDO5, REDO6  | Повторные диски журналов                                | Да         |
| OCR1, OCR2, OCR3, OCR4, OCR5              | Голосование дисков                                  | Да         |
| FRA1, FRA2                                | Диски с областями быстрого восстановления                      | Да         |

![Конфигурация диска виртуальной машины Oracle](media/oracle-vmdk.png)

### <a name="virtual-machine-configuration"></a>Конфигурация виртуальной машины

* Для каждой виртуальной машины настраивается четыре SCSI-контроллера.
* Для типа контроллера SCSI задано значение виртуального параметра VMware.
* Создается несколько виртуальных дисков (VMDK).
* Диски монтируются на разных SCSI-контроллерах.
* Для общих дисков кластера задан тип совместного доступа с несколькими модулями записи.
* Политика хранилища vSAN определяется для обеспечения высокой доступности дисков.

### <a name="operating-system-and-software-disk-configuration"></a>Конфигурация диска операционной системы и программного обеспечения

Каждая виртуальная машина Oracle настроена с несколькими дисками для операционной системы узла, переключения, установки программного обеспечения и других функций ОС.  Эти диски не являются общими для виртуальных машин.  

* Три диска для каждой виртуальной машины настраиваются как виртуальные диски и подключены к виртуальным машинам Oracle RAC.
    * Диск ОС
    * Диск для хранения установки файлов в сетке Oracle
    * Диск для хранения файлов установки базы данных Oracle
* Диски можно настроить как **тонкую подготовку**.
* Каждый диск монтируется на первом контроллере SCSI (SCSI0).  
* Для общего доступа задано **отсутствие общего доступа**.
* Избыточность определяется в хранилище с помощью политик vSAN.  

![Схема, на которой показана физическая конфигурация диска ОС Oracle RAC.](media/oracle-vm-os-disks.png)

### <a name="data-disk-configuration"></a>Конфигурация диска данных

Диски данных в основном используются для хранения файлов базы данных.  

* Четыре диска настроены в качестве виртуальных дисков и подключены ко всем виртуальным машинам Oracle RAC.
* Каждый диск монтируется на другом SCSI-контроллере.
* Каждый виртуальный диск настраивается как толстая неготовая **Инициализация**.  
* Для общего доступа задано **несколько модулей записи**.  
* Диски должны быть настроены в качестве группы дисков автоматического управления хранилищами (ASM).  
* Избыточность определяется в хранилище с помощью политик vSAN.  
* Для избыточности ASM задана **внешняя** избыточность.

![Конфигурация группы дисков данных RAC Oracle](media/oracle-vm-data-disks.png)

### <a name="redo-log-disk-configuration"></a>Конфигурация диска журнала повтора

Файлы журнала повторов используются для хранения копии изменений, внесенных в базу данных.  Файлы журнала используются, когда данные необходимо восстановить после любых сбоев.

* Диски журнала повтора должны быть настроены как несколько групп дисков.  
* На всех виртуальных машинах Oracle RAC создаются и монтируются шесть дисков.
* Диски подключены к разным контроллерам SCSI
* Каждый виртуальный диск настраивается как толстая неготовая **Инициализация**.
* Для общего доступа задано **несколько модулей записи**.  
* Диски должны быть настроены как две группы дисков ASM.
* Каждая группа дисков ASM содержит три диска, которые находятся на разных SCSI-контроллерах.  
* Для избыточности ASM задана **нормальная** избыточность.
* Пять файлов журнала повторов создаются в обеих группах журналов повторов ASM

```
SQL > alter database add logfile thread 1 ('+ORCLRAC_REDO1','+ORCLRAC_REDO2') size 1G;
SQL > alter database add logfile thread 1 ('+ORCLRAC_REDO1','+ORCLRAC_REDO2') size 1G;
SQL > alter database add logfile thread 1 ('+ORCLRAC_REDO1','+ORCLRAC_REDO2') size 1G;
SQL > alter database add logfile thread 1 ('+ORCLRAC_REDO1','+ORCLRAC_REDO2') size 1G;
SQL > alter database add logfile thread 1 ('+ORCLRAC_REDO1','+ORCLRAC_REDO2') size 1G;
SQL > alter database add logfile thread 2 ('+ORCLRAC_REDO1','+ORCLRAC_REDO2') size 1G;
SQL > alter database add logfile thread 2 ('+ORCLRAC_REDO1','+ORCLRAC_REDO2') size 1G;
SQL > alter database add logfile thread 2 ('+ORCLRAC_REDO1','+ORCLRAC_REDO2') size 1G;
SQL > alter database add logfile thread 2 ('+ORCLRAC_REDO1','+ORCLRAC_REDO2') size 1G;
SQL > alter database add logfile thread 2 ('+ORCLRAC_REDO1','+ORCLRAC_REDO2') size 1G;
```

![Конфигурация группы дисков для повтора сертификата RAC Oracle](media/oracle-vm-redo-log-disks.png)

### <a name="oracle-voting-disk-configuration"></a>Конфигурация диска голосования Oracle

Голосование дисков предоставляют функциональные возможности диска кворума в качестве дополнительного коммуникационного канала во избежание каких-либо ситуаций с разделением.

* На всех виртуальных машинах Oracle RAC создаются и монтируются пять дисков.
* Диски подключены к одному контроллеру SCSI
* Каждый виртуальный диск настраивается как толстая неготовая **Инициализация**.
* Для общего доступа задано **несколько модулей записи**.  
* Диски должны быть настроены как Группа дисков ASM.  
* Для избыточности ASM задана **Высокая** избыточность.

![Конфигурация группы дисков для голосования RAC Oracle](media/oracle-vm-voting-disks.png)

### <a name="oracle-fast-recovery-area-disk-configuration-optional"></a>Конфигурация диска с областью быстрого восстановления Oracle (необязательно)

Область быстрого восстановления — это файловая система, управляемая группой дисков Oracle ASM.  Параметр «недоступность» предоставляет общую папку для хранения файлов резервных копий и восстановления. Oracle создает архивные журналы и журналы воспоминаний в области быстрого восстановления. Диспетчер восстановления Oracle (RMAN) может дополнительно хранить свои резервные наборы данных и копии образов в области быстрого восстановления и использовать его при восстановлении файлов во время восстановления носителя.

* На всех виртуальных машинах Oracle RAC создаются и монтируются два диска.
* Диски подключены к другому SCSI-контроллеру
* Каждый виртуальный диск настраивается как толстая неготовая **Инициализация**.
* Для общего доступа задано **несколько модулей записи**.  
* Диски должны быть настроены как Группа дисков ASM.  
* Для избыточности ASM задана **внешняя** избыточность.

![Схема, на которой показана конфигурация группы дисков для голосования в RAC Oracle.](media/oracle-vm-fra-disks.png)

## <a name="deploy-cloudsimple-private-cloud-vsphere-cluster"></a>Развертывание кластера vSphere частного облака Клаудсимпле

Чтобы развернуть кластер vSphere в частном облаке, выполните следующую процедуру:

1. На портале Клаудсимпле [Создайте частное облако](create-private-cloud.md). Клаудсимпле создает пользователя vCenter по умолчанию с именем "клаудовнер" в созданном частном облаке. Дополнительные сведения о модели пользователя и разрешения частного облака по умолчанию см. в разделе [Изучение модели разрешений частного облака](learn-private-cloud-permissions.md).  На этом шаге создается основной кластер управления для частного облака.

2. На портале Клаудсимпле [разверните частное облако](expand-private-cloud.md) с новым кластером.  Этот кластер будет использоваться для развертывания RAC Oracle.  Выберите количество узлов в зависимости от требуемой отказоустойчивости (не менее трех узлов).

## <a name="set-up-networking-for-oracle-rac"></a>Настройка сетей для сертификата RAC Oracle

1. В частном облаке [Создайте две виртуальные ЛС](create-vlan-subnet.md), одну для общедоступной сети Oracle и одну для частной сети Oracle, и назначьте подходящую подсеть Цидрс.
2. После создания виртуальных ЛС создайте [группы распределенных портов в частном облаке vCenter](create-vlan-subnet.md#use-vlan-information-to-set-up-a-distributed-port-group-in-vsphere).
3. Настройте [виртуальную машину DHCP и DNS-сервера](dns-dhcp-setup.md) в кластере управления для среды Oracle.
4. [Настройте пересылку DNS на DNS-сервере](on-premises-dns-setup.md#create-a-conditional-forwarder) , установленном в частном облаке.

## <a name="set-up-vsan-storage-policies"></a>Настройка политик хранилища vSAN

политики vSAN определяют сбои, которые следует пропускать, и чередование дисков для данных, хранящихся на дисках виртуальной машины.  Созданная политика хранилища должна быть применена к дискам виртуальной машины при создании виртуальной машины.

1. [Войдите в клиент vSphere](./vcenter-access.md) частного облака.
2. В верхнем меню выберите **политики и профили**.
3. В меню слева выберите пункт **политики хранилища виртуальной машины** , а затем выберите **создать политику хранилища виртуальной машины**.
4. Введите понятное имя для политики и нажмите кнопку **Далее**.
5. В разделе **Структура политики** выберите **включить правила для хранилища vSAN** и нажмите кнопку **Далее**.
6. В разделе   >  **доступность** vSAN выберите **нет** для обеспечения отказоустойчивости сайта. Чтобы ошибки не допускать, выберите параметр **RAID-зеркальное отображение** для нужных ФТТ.
    ![Параметры vSAN ](media/oracle-rac-storage-wizard-vsan.png) .
7. В разделе **Дополнительно** выберите количество дисковых полос на объект. В поле резервирование пространства объектов выберите параметр **плотная подготовка**. Выберите **Отключить контрольную сумму объекта**. Нажмите кнопку **Далее**.
8. Следуйте инструкциям на экране, чтобы просмотреть список совместимых хранилищ данных vSAN, просмотрите параметры и завершите установку.

## <a name="create-oracle-vms-and-create-shared-vm-disks-for-oracle"></a>Создание виртуальных машин Oracle и создание общих дисков виртуальной машины для Oracle

Чтобы создать виртуальную машину для Oracle, клонировать существующую виртуальную машину или создать новую.  В этом разделе описывается, как создать новую виртуальную машину, а затем клонировать ее, чтобы создать вторую, после установки базовой операционной системы.  После создания виртуальных машин можно создать для них диски.  Кластер Oracle использует общие диски для хранения, данных, журналов и журналов повторов.

### <a name="create-vms"></a>Создание виртуальных машин

1. В vCenter щелкните значок **узлы и кластеры** . Выберите кластер, созданный для Oracle.
2. Щелкните кластер правой кнопкой мыши и выберите пункт **создать виртуальную машину**.
3. Выберите **создать виртуальную машину** и нажмите кнопку **Далее**.
4. Присвойте компьютеру имя, выберите расположение виртуальной машины Oracle и нажмите кнопку **Далее**.
5. Выберите ресурс кластера и нажмите кнопку **Далее**.
6. Выберите хранилище данных vSAN для кластера и нажмите кнопку **Далее**.
7. Выберите вариант совместимость ESXi 6,5 по умолчанию и нажмите кнопку **Далее**.
8. Выберите гостевую ОС ISO для создаваемой виртуальной машины и нажмите кнопку **Далее**.
9. Выберите размер жесткого диска, необходимый для установки ОС.
10. Чтобы установить приложение на другое устройство, нажмите кнопку **Добавить новое устройство**.
11. Выберите параметры сети и назначьте группу распределенных портов, созданную для общедоступной сети.
12. Чтобы добавить дополнительные сетевые интерфейсы, щелкните **Добавить новое устройство** и выберите группу распределенных портов, созданную для частной сети.
13. Для нового диска DC/DVD выберите ISO-файл хранилища данных, содержащий ISO для предпочитаемой установки операционной системы. Выберите файл, который вы ранее перегрузили в папку ISO и Templates, и нажмите кнопку **ОК**.
14. Проверьте параметры и нажмите кнопку **ОК** , чтобы создать новую виртуальную машину.
15. Включите виртуальную машину. Установка операционной системы и всех необходимых обновлений

После установки операционной системы можно клонировать вторую виртуальную машину. Щелкните правой кнопкой мыши запись виртуальной машины и выберите параметр и клон.

### <a name="create-shared-disks-for-vms"></a>Создание общих дисков для виртуальных машин

Oracle использует общий диск для хранения файлов журнала данных, журнала и повторяемости.  Вы можете создать общий диск в vCenter и подключить его на обеих виртуальных машинах.  Чтобы повысить производительность, разместите диски данных на разных SCSI-контроллерах. ниже показано, как создать общий диск в vCenter, а затем подключить его к виртуальной машине. Клиент vCenter Flash используется для изменения свойств виртуальной машины.

#### <a name="create-disks-on-the-first-vm"></a>Создание дисков на первой виртуальной машине

1. В vCenter щелкните правой кнопкой мыши одну из виртуальных машин Oracle и выберите **изменить параметры**.
2. В разделе новое устройство выберите **контроллер SCSI** и нажмите кнопку **Добавить**.
3. В разделе новое устройство выберите **новый жесткий диск** и нажмите кнопку **Добавить**.
4. Разверните свойства нового жесткого диска.
5. Укажите размер жесткого диска.
6. Укажите политику хранилища виртуальной машины в качестве политики хранилища vSAN, которая была определена ранее.
7. Выберите расположение в качестве папки в хранилище данных vSAN. Расположение помогает при просмотре и подключении дисков к второй виртуальной машине.
8. Для подготовки диска установите флажок **плотная подготовка без возможности обнуления**.
9. Для общего доступа укажите **несколько модулей записи**.
10. В узле виртуальное устройство выберите новый контроллер SCSI, созданный на шаге 2.

    ![Снимок экрана, на котором показаны поля, необходимые для создания дисков на первой виртуальной машине.](media/oracle-rac-new-hard-disk.png)

Повторите шаги 2 – 10 для всех новых дисков, необходимых для данных Oracle, журналов и файлов журнала повторов.

#### <a name="attach-disks-to-second-vm"></a>Присоединение дисков к второй виртуальной машине

1. В vCenter щелкните правой кнопкой мыши одну из виртуальных машин Oracle и выберите **изменить параметры**.
2. В разделе новое устройство выберите **контроллер SCSI** и нажмите кнопку **Добавить**.
3. В разделе новое устройство выберите **существующий жесткий диск** и нажмите кнопку **Добавить**.
4. Перейдите в папку, в которой был создан диск для первой виртуальной машины, и выберите VMDK файл.
5. Укажите политику хранилища виртуальной машины в качестве политики хранилища vSAN, которая была определена ранее.
6. Для подготовки диска установите флажок **плотная подготовка без возможности обнуления**.
7. Для общего доступа укажите **несколько модулей записи**.
8. В узле виртуальное устройство выберите новый контроллер SCSI, созданный на шаге 2.

    ![Создание дисков на первой виртуальной машине](media/oracle-rac-existing-hard-disk.png)

Повторите шаги 2 – 7 для всех новых дисков, необходимых для данных Oracle, журналов и файлов журнала повторов.

## <a name="set-up-vm-host-affinity-rules"></a>Настройка правил сходства узлов виртуальных машин

Правила сопоставления виртуальных машин и узлов гарантируют, что виртуальная машина выполняется на нужном узле.  Вы можете определить правила в vCenter, чтобы виртуальная машина Oracle выполнялась на узле с соответствующими ресурсами и соответствовать определенным требованиям к лицензированию.

1. На портале Клаудсимпле [эскалировать права](escalate-private-cloud-privileges.md) пользователя клаудовнер.
2. Войдите в клиент vSphere частного облака.
3. В клиенте vSphere выберите кластер, в котором развернуты виртуальные машины Oracle, и нажмите кнопку **настроить**.
4. В разделе Настройка выберите **виртуальные машины/группы узлов**.
5. Щелкните **+** .
6. Добавьте группу виртуальных машин. Выберите **группу виртуальных машин** в качестве типа. Введите имя группы. Выберите виртуальные машины и нажмите кнопку **ОК** , чтобы создать группу.
6. Добавление группы узлов. Выберите **группу узлов** в качестве типа. Введите имя группы. Выберите узлы, на которых будут выполняться виртуальные машины, и нажмите кнопку **ОК** , чтобы создать группу.
7. Чтобы создать правило, щелкните **правила виртуальной машины или узла**.
8. Щелкните **+** .
9. Введите имя правила и установите флажок **включить**.
10. В поле Тип правила выберите **виртуальные машины для размещения**.
11. Выберите группу виртуальных машин, содержащую виртуальные машины Oracle.
12. SELECT **должен выполняться на узлах в этой группе**.
13. Выберите созданную группу узлов.
14. Нажмите кнопку **ОК** , чтобы создать правило.

## <a name="references"></a>Ссылки

* [О политиках vSAN](https://docs.vmware.com/en/VMware-vSphere/6.7/com.vmware.vsphere.virtualsan.doc/GUID-08911FD3-2462-4C1C-AE81-0D4DBC8F7990.html)
* [Атрибут с несколькими модулями записи VMware для общих VMDK-устройств](https://docs.vmware.com/en/VMware-Cloud-on-AWS/solutions/VMware-Cloud-on-AWS.df6735f8b729fee463802083d46fdc75/GUID-A7642A82B3D6C5F7806DB40A3F2766D9.html)
