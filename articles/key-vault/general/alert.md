---
title: Azure Key Vault мониторинг и оповещения | Документация Майкрософт
description: Создайте панель мониторинга для отслеживания работоспособности хранилища ключей и настройки оповещений.
services: key-vault
author: ShaneBala-keyvault
manager: ravijan
tags: azure-resource-manager
ms.service: key-vault
ms.subservice: general
ms.topic: how-to
ms.date: 04/06/2020
ms.author: sudbalas
Customer intent: As a key vault administrator, I want to learn the options available to monitor the health of my vaults
ms.openlocfilehash: 7ff3daded48612fd308396420dca65cd81d9fafc
ms.sourcegitcommit: a4533b9d3d4cd6bb6faf92dd91c2c3e1f98ab86a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/22/2020
ms.locfileid: "97724703"
---
# <a name="monitoring-and-alerting-for-azure-key-vault"></a>Мониторинг и оповещения для Azure Key Vault

## <a name="overview"></a>Обзор

Когда вы начнете использовать хранилище ключей для хранения рабочих секретов, важно отслеживать работоспособность хранилища ключей, чтобы убедиться, что служба работает должным образом. После начала масштабирования службы количество запросов, отправленных в хранилище ключей, будет возрастать. Это может увеличить задержку запросов и в крайних случаях привести к их регулированию, что повлияет на производительность службы. Кроме того, необходимо получать оповещения, если хранилище ключей отправляет необычное количество кодов ошибок, что позволяет быстро получать уведомления о любых проблемах, связанных с настройкой политики доступа или брандмауэра. В этом документе рассматриваются следующие темы:

+ Основные метрики Key Vault для мониторинга
+ Настройка метрик и создание панели мониторинга 
+ Создание предупреждений с указанными пороговыми значениями 

## <a name="basic-key-vault-metrics-to-monitor"></a>Основные метрики Key Vault для мониторинга

+ Доступность хранилища  
+ Насыщенность хранилища 
+ Задержка API службы 
+ Всего попаданий в API службы (фильтрация по типу действия) 
+ Коды ошибок (фильтрация по коду состояния) 

**Доступность хранилища** . Эта метрика всегда должна составлять от 100%. это важный показатель, который следует отслеживать, так как он может быстро отобразить вас в случае сбоя в вашем хранилище ключей. 

**Насыщенность хранилища** — количество запросов в секунду, которое может обслуживаться хранилищем ключей, зависит от типа выполняемой операции. Некоторые операции с хранилищем имеют более низкие пороговые значения запросов в секунду. Эта метрика объединяет общее использование хранилища ключей по всем типам операций, чтобы получить процентное значение, указывающее текущее использование хранилища ключей. Полный список ограничений службы хранилища ключей см. в следующем документе. [Ограничения службы для хранилища ключей Azure](service-limits.md)

**Задержка API службы** — эта метрика показывает среднюю задержку вызовов к хранилищу ключей, измеряемую в службе. Он не включает время, потребляемое клиентом или сетью между клиентом и службой.

**Всего попаданий в API** — эта метрика показывает все вызовы, выполненные в хранилище ключей. Это поможет определить, какие приложения вызывают хранилище ключей. 

**Коды ошибок** — эта метрика показывает, что в вашем хранилище ключей возникает необычный объем ошибок. Полный список кодов ошибок и руководство по устранению неполадок см. в следующем документе. [Коды ошибок Azure Key Vault REST API](rest-error-codes.md)

## <a name="how-to-configure-metrics-and-create-a-dashboard"></a>Настройка метрик и создание панели мониторинга

1. Войдите на портал Azure.
2. Перейдите к Key Vault
3. Выбор **метрик** в разделе " **мониторинг** " 

> [!div class="mx-imgBorder"]
> ![Снимок экрана, посвященный параметру метрик в разделе "Мониторинг".](../media/alert-1.png)

4. Обновите заголовок диаграммы, чтобы узнать, что вы хотите увидеть на панели мониторинга. 
5. Выберите область. В этом примере будет выбрано одно хранилище ключей. 
6. Выберите метрику **общий доступ к хранилищу** и **Среднее** значение агрегирования 
7. Обновите диапазон времени до последних 24 часов и обновите время детализации до 1 минуты. 

> [!div class="mx-imgBorder"]
> ![Снимок экрана, на котором показана общая метрика ущерба хранилища.](../media/alert-2.png)

8. Повторите описанные выше действия для метрик задержек в хранилище и в API службы. Выберите **закрепить на панели мониторинга** , чтобы сохранить метрики на панели мониторинга. 

> [!IMPORTANT]
> Выберите "закрепить на панели мониторинга" и сохраните все настроенные метрики. Если покинуть страницу и вернуться к ней без сохранения, изменения конфигурации будут потеряны. 

9. Чтобы отслеживать все типы операций в хранилище ключей, используйте метрику **общего числа попаданий в API службы** и выберите **Применить разделение по типу действия** .

> [!div class="mx-imgBorder"]
> ![Снимок экрана, на котором показана кнопка "применить разделение".](../media/alert-3.png)

10. Чтобы отслеживать коды ошибок в хранилище ключей, используйте метрику **Общий результат API службы** и выберите **Применить разделение по типу действия** .

> [!div class="mx-imgBorder"]
> ![Снимок экрана, на котором показана выбранная совокупная метрика результатов API службы.](../media/alert-4.png)

Теперь у вас будет панель мониторинга, которая выглядит следующим образом. Можно щелкнуть 3 точки в правом верхнем углу каждой плитки, и вы сможете изменить расположение и размер плиток по мере необходимости. 

После сохранения и публикации панели мониторинга в подписке Azure будет создан новый ресурс. Вы сможете просмотреть его в любое время, выполнив поиск по фразе "Общая панель мониторинга". 

> [!div class="mx-imgBorder"]
> ![Снимок экрана, на котором показана опубликованная панель мониторинга.](../media/alert-5.png)

## <a name="how-to-configure-alerts-on-your-key-vault"></a>Настройка оповещений на Key Vault 

В этом разделе вы узнаете, как настроить оповещения в хранилище ключей, чтобы вы могли оповестить команду о необходимости немедленно предпринять действия, если хранилище ключей находится в неработоспособном состоянии. Вы можете настроить оповещения, которые отправляют сообщение электронной почты, желательно для группы рассылки, запускают уведомления в сетке событий или обзвонт или текст номера телефонов. Можно также выбрать статические оповещения на основе фиксированного значения или динамическое оповещение, которое предупреждает о том, что отслеживаемая метрика превышает среднее ограничение в течение определенного интервала времени в пределах хранилища ключей. 

> [!IMPORTANT]
> Обратите внимание, что для новых настроенных оповещений может потребоваться до 10 минут, чтобы начать отправку уведомлений. 

### <a name="configure-an-action-group"></a>Настройка группы действий 

Группа действий — это настраиваемый список уведомлений и свойств.

1. Войдите на портал Azure.
2. Поиск **оповещений** в поле поиска
3. Выбор **управления действиями**

> [!div class="mx-imgBorder"]
> ![Снимок экрана, на котором выделена кнопка "Управление действиями".](../media/alert-6.png)

4. Выберите **+ Добавить группу действий**

> [!div class="mx-imgBorder"]
> ![Снимок экрана, на котором выделяется кнопка + Добавить группу действий.](../media/alert-7.png)

5. Выберите **тип действия** для группы действий. В этом примере мы создадим оповещение по электронной почте.

> [!div class="mx-imgBorder"]
> ![Снимок экрана, на котором показаны поля, необходимые для добавления группы действий.](../media/alert-8.png)

> [!div class="mx-imgBorder"]
> ![Снимок экрана, показывающий, что необходимо для добавления сообщения электронной почты или оповещения SMS.](../media/alert-9.png)

6. В нижней части страницы щелкните **ОК**. Вы успешно создали группу действий. 

Теперь, когда группа действий настроена, будут настроены пороговые значения оповещений хранилища ключей. 

### <a name="configure-alert-thresholds"></a>Настройка пороговых значений оповещений 

1. Выберите ресурс хранилища ключей в портал Azure и выберите **оповещения** в разделе **мониторинг** .

> [!div class="mx-imgBorder"]
> ![Снимок экрана, показывающий пункт меню "оповещения" в разделе "Мониторинг".](../media/alert-10.png)

2. Выберите **новое правило генерации оповещений**

> [!div class="mx-imgBorder"]
> ![Снимок экрана, на котором отображается кнопка + новое правило генерации оповещений.](../media/alert-11.png)

3. Выберите область действия правила оповещения. Можно выбрать одно или несколько хранилищ. 

> [!IMPORTANT]
> Обратите внимание, что при выборе нескольких хранилищ для области оповещений все выбранные хранилища должны находиться в одном регионе. Вам потребуется настроить отдельные правила генерации оповещений для хранилищ в разных регионах. 

> [!div class="mx-imgBorder"]
> ![Снимок экрана, показывающий, как можно выбрать хранилище.](../media/alert-12.png)

4. Выберите условия для оповещений. Можно выбрать любой из следующих сигналов и определить логику для оповещений. Команда Key Vault рекомендует настроить следующие пороговые значения предупреждений. 

    + Доступность Key Vault падает ниже 100% (статическое пороговое значение)
    + Задержка Key Vault больше 500 мс (статическое пороговое значение) 
    + Общая насыщенность хранилища превышает 75% (статическое пороговое значение) 
    + Общее насыщенность хранилища превышает среднюю (динамическое пороговое значение)
    + Всего кодов ошибок выше среднего (динамическое пороговое значение) 

> [!div class="mx-imgBorder"]
> ![Снимок экрана, на котором показано, где выбираются условия для оповещений.](../media/alert-13.png)

### <a name="example-1-configuring-a-static-alert-threshold-for-latency"></a>Пример 1. Настройка статического порогового значения предупреждения для задержки

Выберите **общую задержку API службы** в качестве имени сигнала
> [!div class="mx-imgBorder"]
> ![Снимок экрана, показывающий общее имя сигнала задержки API службы.](../media/alert-14.png)

Ознакомьтесь со следующими параметрами конфигурации.

+ Установка порогового значения **static** 
+ Задайте оператору значение **больше**
+ Установка **среднего** значения для типа агрегирования
+ Установите пороговое значение **500** .
+ Задать период агрегирования до **5 минут**
+ Установите частоту оценки равную **1 минуте** .
+ Щелкните **Готово**.  

> [!div class="mx-imgBorder"]
> ![Снимок экрана, на котором выделена настроенная логика оповещений.](../media/alert-15.png)

### <a name="example-2-configuring-a-dynamic-alert-threshold-for-vault-saturation"></a>Пример 2. Настройка порогового значения динамического предупреждения для насыщенности хранилища 

При использовании динамического оповещения вы сможете просматривать исторические данные выбранного хранилища ключей. Синяя область представляет среднее использование хранилища ключей. Красная область показывает пиковые пики, которые вызвали срабатывание предупреждения, при условии, что в конфигурации предупреждения выполнены другие условия. Красные точки показывают экземпляры нарушений, в которых в агрегированном временном окне было выполнено условие для предупреждения. Можно настроить срабатывание предупреждения после определенного числа нарушений в течение заданного времени. Если вы не хотите включать данные за последние, в дополнительных параметрах можно исключить старые данные ниже. 

> [!div class="mx-imgBorder"]
> ![Снимок экрана, на котором показан график общего насыщенности хранилища.](../media/alert-16.png)

Ознакомьтесь со следующими параметрами конфигурации.

+ Установите пороговое значение **dynamic** . 
+ Задайте оператору значение **больше**
+ Установка **среднего** значения для типа агрегирования
+ Установите для порогового значения значение **средний** .
+ Задать период агрегирования до **5 минут**
+ Установите частоту оценки равную **1 минуте** .
+ **Необязательно** Настройка дополнительных параметров 
+ Щелкните **Готово**.

> [!div class="mx-imgBorder"]
> ![Снимок экрана портал Azure](../media/alert-17.png)

5. Добавление настроенной группы действий

> [!div class="mx-imgBorder"]
> ![Снимок экрана, показывающий, как добавить группу действий.](../media/alert-18.png)

6. Включение оповещения и назначение серьезности

> [!div class="mx-imgBorder"]
> ![Снимок экрана, на котором показано, где можно включить оповещение и присвоить серьезность.](../media/alert-19.png)

7. Создание оповещения 


## <a name="next-steps"></a>Дальнейшие действия

Поздравляем! теперь вы успешно создали панель мониторинга и настроили оповещения для хранилища ключей! После выполнения всех описанных выше действий вы должны получать оповещения по электронной почте, когда хранилище ключей соответствует настроенным условиям оповещения. Ниже приведен соответствующий пример. Используйте средства, настроенные в этой статье, чтобы активно отслеживать работоспособность хранилища ключей. 

### <a name="example-email-alert"></a>Пример оповещения по электронной почте 

> [!div class="mx-imgBorder"]
> ![Снимок экрана, на котором выделены сведения, необходимые для настройки оповещения по электронной почте.](../media/alert-20.png)
