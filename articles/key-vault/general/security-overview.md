---
title: Обзор системы безопасности Azure Key Vault
description: Общие сведения о функциях безопасности и рекомендации для Azure Key Vault.
services: key-vault
author: msmbaldwin
tags: azure-resource-manager
ms.service: key-vault
ms.subservice: general
ms.topic: conceptual
ms.date: 01/05/2021
ms.author: mbaldwin
ms.openlocfilehash: c7635fdc2012ab404709733d8f5849465c2ee82f
ms.sourcegitcommit: dd24c3f35e286c5b7f6c3467a256ff85343826ad
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/29/2021
ms.locfileid: "99071577"
---
# <a name="azure-key-vault-security"></a>Безопасность Azure Key Vault

Azure Key Vault используется для защиты ключей шифрования и секретов, таких как сертификаты, строки подключения и пароли в облаке. При хранении конфиденциальных и критически важных данных необходимо предпринять шаги по повышению безопасности хранилищ и хранящихся в них данных.

В этой статье приводятся общие сведения о функциях безопасности и рекомендациях по Azure Key Vault. 

> [!NOTE]
> Полный список рекомендаций по безопасности Azure Key Vault см. в разделе [основы безопасности для Azure Key Vault](security-baseline.md).

## <a name="network-security"></a>Безопасность сети

Вы можете снизить уязвимость хранилищ, указав IP-адреса, к которым они имеют доступ. Конечные точки служб для виртуальной сети для Azure Key Vault позволяют ограничить доступ к определенной виртуальной сети. Также эти конечные точки позволяют ограничить доступ определенным набором диапазонов адресов IPv4 (протокол IP версии 4). Для любого пользователя при попытке подключения к хранилищу ключей из любых других расположений доступ будет отклонен.  Полные сведения см. в разделе [конечные точки службы виртуальной сети для Azure Key Vault](overview-vnet-service-endpoints.md)

После того как правила брандмауэра вступают в действие, пользователи могут считывать данные только из Key Vault, если их запросы исходят из разрешенных виртуальных сетей или диапазонов IPv4-адресов. Это относится и к получению доступа к Key Vault с портала Azure. Пользователь сможет перейти в хранилище ключей с портала Azure, но не сможет получить список ключей, секретов и сертификатов, если клиентский компьютер не включен в список разрешенных. Это также влияет на выбор хранилища ключей другими службами Azure. Пользователи смогут просматривать список хранилищ ключей, но не список ключей, если правила брандмауэра запрещают доступ их клиентским компьютерам.  Инструкции по реализации см. в разделе [Настройка брандмауэров Azure Key Vault и виртуальных сетей](network-security.md) .

Приватный канал Azure обеспечивает доступ к Azure Key Vault и к размещенным в Azure службам клиентов или партнеров через частную конечную точку виртуальной сети. Частная конечная точка Azure — это сетевой интерфейс, который защищенно и надежно подключается к службе через Приватный канал Azure. Частная конечная точка использует частный IP-адрес из виртуальной сети, по сути перемещая службу в виртуальную сеть. Весь трафик к службе может маршрутизироваться через частную конечную точку, поэтому шлюзы, устройства преобразования сетевых адресов (NAT), подключения ExpressRoute и VPN, а также общедоступные IP-адреса не требуются. Трафик между виртуальной сетью и службой проходит через магистральную сеть Майкрософт, что позволяет избежать рисков общедоступного Интернета. Вы можете подключиться к экземпляру ресурса Azure, обеспечивая наивысшую степень детализации в управлении доступом.  Инструкции по реализации см. в статье [интеграция Key Vault с помощью частной ссылки Azure](private-link-service.md) .

## <a name="tls-and-https"></a>TLS и HTTPS

- Серверная часть Key Vault (плоскость данных) является сервером с несколькими клиентами. Это означает, что хранилища ключей от разных клиентов могут совместно использовать один и тот же общедоступный IP-адрес. Для достижения изоляции каждый HTTP-запрос проходит проверку подлинности и авторизован независимо от других запросов.
- Вы можете вычислить более старые версии TLS, чтобы сообщать об уязвимостях, но так как общедоступный IP-адрес является общим, Группа службы хранилища ключей не может отключить старые версии TLS для отдельных хранилищ ключей на транспортном уровне.
- Протокол HTTPS позволяет клиенту принимать участие в согласовании TLS. **Клиенты могут принудительно применять последнюю версию TLS**, и каждый раз, когда клиент делает это, все соединение будет использовать соответствующую защиту на уровне. Тот факт, что Key Vault по-прежнему поддерживает более старые версии TLS, не будет нарушать безопасность подключений с использованием более новых версий TLS.
- Несмотря на известные уязвимости протокола TLS, нет известных атак, которые позволят вредоносному агенту извлекать любую информацию из хранилища ключей, когда злоумышленник инициирует подключение к версии TLS с уязвимостями. Злоумышленнику по-прежнему потребуется пройти проверку подлинности и авторизацию, и при условии, что надежные клиенты всегда подключаются к последним версиям TLS, не существует способа утечки учетных данных из уязвимостей в старых версиях TLS.

## <a name="identity-management"></a>Управление удостоверениями

При создании хранилища ключей в подписке Azure оно автоматически связывается с арендатором Azure AD этой подписки. Любой пользователь, пытающийся управлять содержимым в хранилище или извлекать его из хранилища, должен пройти аутентификацию в Azure AD. В обоих случаях приложения могут получить доступ к Key Vault тремя способами:

- **Только для приложений**: приложение представляет субъект-службу или управляемое удостоверение. Это удостоверение является наиболее распространенным сценарием для приложений, которые периодически нуждаются в доступе к сертификатам, ключам или секретам из хранилища ключей. Для работы этого сценария `objectId` приложение должно быть указано в политике доступа, а `applicationId` _не_ должно быть указано или должно быть `null` .
- **Только для пользователей**. пользователь обращается к хранилищу ключей из любого приложения, зарегистрированного в клиенте. Такой доступ осуществляется с помощью Azure PowerShell и портала Azure. Чтобы этот сценарий работал, `objectId` пользователь должен быть указан в политике доступа, а параметр `applicationId` _не_ должен быть указан или должен быть `null` .
- **Приложение и пользователь** (иногда называется _составным удостоверением_): пользователь должен получить доступ к хранилищу ключей из конкретного приложения _, и_ приложение должно использовать поток проверки подлинности "от имени" (OBO) для олицетворения пользователя. Чтобы этот сценарий работал, оба параметра `applicationId` и `objectId` должны быть указаны в политике доступа. `applicationId`Определяет требуемое приложение и `objectId` определяет пользователя. В настоящее время этот параметр недоступен для плоскости данных Azure RBAC (Предварительная версия).

Во всех типах доступа приложение выполняет проверку подлинности в Azure AD. Приложения используют любой из [поддерживаемых методов аутентификации](../../active-directory/develop/authentication-vs-authorization.md) в зависимости от своего типа. Приложение получает маркер для ресурса в плоскости, в которой нужно предоставить доступ. Ресурс является конечной точкой в плоскости управления или данных на основе среды Azure. Приложение отправляет запрос REST API в Key Vault с использованием этого маркера. Узнайте больше о [полном потоке аутентификации](../../active-directory/develop/v2-oauth2-auth-code-flow.md).

Дополнительные сведения см. в статье [основы проверки Подлинности Key Vault](authentication-fundamentals.md)

## <a name="privileged-access"></a>Привилегированный доступ

Авторизация определяет, какие операции может выполнять вызывающая сторона. Авторизация в Key Vault использует сочетание [управления доступом на основе ролей Azure (Azure RBAC)](../../role-based-access-control/overview.md) и политик доступа Azure Key Vault.

Доступ к хранилищам осуществляется через два интерфейса или плоскости. Это плоскость управления и плоскость данных.

- *Плоскость управления* — это место, где вы управляете Key Vault, а также интерфейс, используемый для создания и удаления хранилищ. Вы также можете читать свойства хранилища ключей и управлять политиками доступа.
- *Плоскость данных* позволяет работать с хранимыми данными в хранилище ключей. Вы можете добавлять, удалять и изменять ключи, секреты и сертификаты.

Приложения получают доступ к плоскостям через конечные точки. Элементы управления доступом для двух плоскостей работают независимо. Чтобы предоставить приложению доступ для использования ключей в хранилище ключей, вы предоставляете доступ к плоскости данных с помощью политики доступа Key Vault или Azure RBAC (Предварительная версия). Чтобы предоставить пользователю доступ на чтение к Key Vault свойствам и тегам, но не к данным (ключам, секретам или сертификатам), предоставьте доступ к плоскости управления с помощью Azure RBAC.

В следующей таблице показаны конечные точки плоскости управления и плоскости данных.

| Плоскость&nbsp;доступа | Конечные точки доступа | Операции | Механизм&nbsp;управление доступом |
| --- | --- | --- | --- |
| Плоскость управления | **Глобально:**<br> management.azure.com:443<br><br> **Azure China 21Vianet:**<br> management.chinacloudapi.cn:443<br><br> **Azure для US Gov :**<br> management.usgovcloudapi.net:443<br><br> **Azure для Германии:**<br> management.microsoftazure.de:443 | Создание, чтение, изменение и удаление хранилищ ключей<br><br>Настройка политик доступа Key Vault<br><br>Настройка тегов Key Vault | Azure RBAC |
| Плоскость данных | **Глобально:**<br> &lt;vault-name&gt;.vault.azure.net:443<br><br> **Azure China 21Vianet:**<br> &lt;vault-name&gt;.vault.azure.cn:443<br><br> **Azure для US Gov :**<br> &lt;vault-name&gt;.vault.usgovcloudapi.net:443<br><br> **Azure для Германии:**<br> &lt;vault-name&gt;.vault.microsoftazure.de:443 | Ключи: шифрование, расшифровка, wrapKey, unwrapKey, подпись, проверка, получение, перечисление, создание, обновление, импорт, удаление, восстановление, резервное копирование, восстановление, очистка<br><br> Сертификаты: манажеконтактс, поставщики, листиссуерс, сетиссуерс, делетеиссуерс, манажеиссуерс, Get, список, создание, импорт, обновление, удаление, восстановление, резервное копирование, восстановление, очистка<br><br>  Секреты: получение, перечисление, задание, удаление, восстановление, резервное копирование, восстановление, очистка | Политика доступа Key Vault или Azure RBAC (Предварительная версия)|

### <a name="managing-administrative-access-to-key-vault"></a>Управление административным доступом к Key Vault

При создании хранилища ключей в группе ресурсов вы управляете доступом посредством Azure AD. Можно предоставить пользователям или группе возможность управлять хранилищами ключей в группе ресурсов. Вы можете предоставить доступ на определенном уровне области, назначив соответствующие роли Azure. Чтобы предоставить пользователю доступ к управлению хранилищами ключей, ему необходимо назначить предопределенную роль `key vault Contributor` в определенной области. Роли Azure могут быть назначены следующие уровни областей:

- **Подписка**. роль Azure, назначенная на уровне подписки, применяется ко всем группам ресурсов и ресурсам в рамках этой подписки.
- **Группа ресурсов**. роль Azure, назначенная на уровне группы ресурсов, применяется ко всем ресурсам в этой группе ресурсов.
- **Конкретный ресурс**. роль Azure, назначенная конкретному ресурсу, применяется к этому ресурсу. В этом случае ресурс является определенным хранилищем ключей.

Есть несколько заданных по умолчанию ролей. Если заданные роли не соответствуют вашим потребностям, вы можете определить собственные. Дополнительные сведения см. в статье о [встроенных ролях в Azure RBAC](../../role-based-access-control/built-in-roles.md).

> [!IMPORTANT]
> Если у пользователя есть разрешения `Contributor` в плоскости управления хранилища ключей, он может предоставить себе доступ к плоскости данных, настроив политику доступа к хранилищу ключей. Следует очень внимательно контролировать, у кого есть доступ `Contributor` к вашим хранилищам ключей в рамках роли. Убедитесь, что только авторизованные лица могут получать доступ к хранилищам ключей, ключам, секретам и сертификатам, а также управлять ими.

### <a name="controlling-access-to-key-vault-data"></a>Управление доступом к данным Key Vault

Политики доступа Key Vault предоставляют разрешения отдельно для ключей, секретов или сертификата. Можно предоставить пользователю доступ только к ключам, но не к секретам. Разрешения к ключам, секретам и сертификатам управляются на уровне хранилища.

> [!IMPORTANT]
> Политика доступа к Key Vault не поддерживает детализированные разрешения на уровне объектов, таких как определенный ключ, секрет или сертификат. Если пользователю предоставлено разрешение на создание и удаление ключей, он может выполнять эти операции со всеми ключами в этом хранилище ключей.

Вы можете задать политики доступа для хранилища ключей, используя [портал Azure](assign-access-policy-portal.md), [Azure CLI](assign-access-policy-cli.md), [Azure POWERSHELL](assign-access-policy-powershell.md)или [API-интерфейсы RESTful управления Key Vault](/rest/api/keyvault/).

Вы можете ограничить доступ к плоскости данных с помощью [конечных точек службы виртуальной сети для Azure Key Vault](overview-vnet-service-endpoints.md). Вы можете настроить [брандмауэры и правила виртуальной сети](network-security.md) в качестве дополнительного уровня безопасности.

## <a name="logging-and-monitoring"></a>Ведение журналов и мониторинг

Ведение журнала Key Vault сохраняет сведения о действиях, выполняемых в вашем хранилище. Полные сведения см. в разделе [ведение журнала Key Vault](logging.md).

Можно интегрировать Key Vault со службой "Сетка событий", чтобы получать уведомления при изменении состояния ключа, сертификата или секрета, хранящегося в хранилище ключей. Дополнительные сведения см. в статье [мониторинг Key Vault с помощью службы "Сетка событий Azure](event-grid-overview.md) ".

Также важно отслеживать работоспособность хранилища ключей, чтобы убедиться, что служба работает должным образом. Сведения о том, как это сделать, см. в разделе [мониторинг и создание оповещений для Azure Key Vault](alert.md).

## <a name="backup-and-recovery"></a>Резервное копирование и восстановление

Azure Key Vault защита от обратимого удаления и очистки позволяет восстанавливать удаленные хранилища и объекты хранилища. Дополнительные сведения см. в статье [обзор Azure Key Vault обратимого удаления](soft-delete-overview.md).

Вы также должны использовать регулярные резервные копии хранилища для обновления, удаления и создания объектов в хранилище.  

## <a name="next-steps"></a>Дальнейшие шаги

- [Базовые показатели безопасности Azure Key Vault](security-baseline.md)
- [Рекомендации по использованию Key Vault](security-baseline.md)
- [Конечные точки службы для виртуальной сети для Azure Key Vault](overview-vnet-service-endpoints.md)
- [Azure RBAC: встроенные роли](../../role-based-access-control/built-in-roles.md).
