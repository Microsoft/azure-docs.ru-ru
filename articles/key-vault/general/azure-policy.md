---
title: Интеграция Azure Key Vault с Политикой Azure
description: Сведения об интеграции Azure Key Vault с Политикой Azure
author: ShaneBala-keyvault
ms.author: sudbalas
ms.date: 10/15/2020
ms.service: key-vault
ms.subservice: general
ms.topic: how-to
ms.openlocfilehash: 6ac4d0e0744bfc82a686671234e013b2dd717146
ms.sourcegitcommit: 910a1a38711966cb171050db245fc3b22abc8c5f
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "92927759"
---
# <a name="integrate-azure-key-vault-with-azure-policy"></a>Интеграция Azure Key Vault с Политикой Azure

[Политика Azure](../../governance/policy/index.yml) — это средство управления, которое дает пользователям возможность выполнять аудит и управлять средой Azure в нужном масштабе. Политика Azure позволяет разместить ограничители на ресурсах Azure, чтобы убедиться, что ресурсы соответствуют назначенным правилам политики. Она позволяет пользователям выполнять аудит, принудительное применение в режиме реального времени и исправление среды Azure. Результаты аудита, выполненного политикой, будут доступны пользователям на панели мониторинга соответствия, где они смогут увидеть подробное описание того, какие ресурсы и компоненты соответствуют требованиям, а какие нет.  Дополнительные сведения см. в статье [Обзор службы "Политика Azure"](../../governance/policy/overview.md)

Примеры сценариев использования:

- Вы хотите повысить уровень безопасности компании, реализовав требования к минимальным размерам ключей и максимальному сроку действия сертификатов в хранилищах ключей вашей компании, но не зная, какие группы будут соответствовать требованиям, а какие — нет.
- В настоящее время у вас нет решения для проведения аудита в вашей организации, разве что можете выполнить аудит вручную, задавая индивидуальным командам в организации отчет о соответствии. Вы ищете способ автоматизации этой задачи, выполняете аудит в режиме реального времени и гарантируете точность аудита.
- Вы хотите применить политики безопасности компании и запретить пользователям создавать самозаверяющиеся сертификаты, но у вас нет автоматизированного способа заблокировать их создание. 
- Вы хотите смягчить некоторые требования к командам, проводящим тестирования, но при этом хотите сохранить жесткий контроль над своей производственной средой. Вам необходим простой автоматизированный способ разделения ограничений на ресурсы.
- Необходимо убедиться, что в случае проблемы с активным сайтом вы сможете выполнить откат новых политик. Вам нужно решение для отключения принудительного применения политики одним щелчком. 
- Вы полагаетесь на стороннее решение для аудита среды и хотите использовать внутреннее предложение Майкрософт.

## <a name="types-of-policy-effects-and-guidance"></a>Типы действий и руководств политики

**Аудит**: Если для политики задано значение "аудит", то политика не приведет к критическим изменениям в среде. Он оповещает вас о таких компонентах, как сертификаты, не соответствующие определениям политик в пределах указанной области, помечая эти компоненты как несоответствующие на панели мониторинга соответствия политике. Если влияния политики не выбрано, аудит выполняется по умолчанию.

**Запретить**: Если действие политики имеет значение "запретить", то политика будет блокировать создание новых компонентов, таких как сертификаты, а также блокировать новые версии существующих компонентов, которые не соответствуют определению политики. Существующие несоответствующие ресурсы в хранилище ключей не затрагиваются. Возможности "аудит" будут продолжать функционировать.

## <a name="available-built-in-policy-definitions"></a>Доступные "встроенные" определения политики

В Key Vault создан набор политик, которые можно использовать для управления объектами ключей, сертификатов и секретов. Эти политики являются "встроенными", что значит, что они не требуют написания каких-либо пользовательских файлов JSON для включения, и чтобы они были доступны на портале Azure для назначения. Вы по-прежнему можете настраивать определенные параметры в соответствии с потребностями вашей организации.

# <a name="certificate-policies"></a>[Политики сертификата](#tab/certificates)

### <a name="certificates-should-have-the-specified-maximum-validity-period-preview"></a>Сертификаты должны иметь указанный максимальный срок действия (предварительная версия)

Эта политика позволяет вам управлять максимальным сроком действия сертификатов, хранящихся в хранилище ключей. Рекомендуется ограничить максимальный срок действия сертификатов в соответствии с требованиями безопасности. Если секретный ключ вашего сертификата будет взломан без обнаружения, использование кратковременных сертификатов минимизирует временные рамки для текущего повреждения и снижает ценность сертификата для злоумышленника.

### <a name="certificates-should-use-allowed-key-types-preview"></a>Сертификаты должны использовать разрешенные типы ключей (предварительная версия)

Эта политика позволяет ограничивать тип сертификатов, которые могут находиться в хранилище ключей. Вы можете использовать эту политику, чтобы убедиться, что ваши закрытые ключи сертификата защищены RSA, ECC или поддерживают HSM. Вы можете выбрать из следующего списка разрешенных типов сертификатов.

- RSA
- RSA — HSM
- ECC
- ECC — HSM

### <a name="certificates-should-have-the-specified-lifetime-action-triggers-preview"></a>Для сертификатов необходимо настроить указанные триггеры действия для времени существования (предварительная версия)

Эта политика позволяет управлять действием времени существования, определенным для сертификатов, которые либо находятся в течение определенного количества дней после истечения срока действия, либо достигли определенного процента полезного срока службы.

### <a name="certificates-should-be-issued-by-the-specified-integrated-certificate-authority-preview"></a>Сертификаты должны быть выданы указанным интегрированным центром сертификации (предварительная версия)

Если вы используете интегрированный центр сертификации Key Vault (Digicert или GlobalSign) и хотите, чтобы пользователи пользовались услугами одного или одного из двух поставщиков, вы можете использовать эту политику для аудита или принудительного исполнения вашего выбора. Эта политика также может использоваться для аудита или отказа в создании самоуправляющихся сертификатов в хранилище ключей.

### <a name="certificates-should-be-issued-by-the-specified-non-integrated-certificate-authority-preview"></a>Сертификаты должны быть выданы указанным неинтегрированным центром сертификации (предварительная версия)

Если вы используете внутренний центр сертификации или центр сертификации, не интегрированный с хранилищем ключей, и хотите, чтобы пользователи использовали центр сертификации из списка, который вы предоставляете, вы можете использовать эту политику для создания списка разрешенных центров сертификации по имени издателя. Эта политика также может использоваться для аудита или отказа в создании самоуправляющихся сертификатов в хранилище ключей.

### <a name="certificates-using-elliptic-curve-cryptography-should-have-allowed-curve-names-preview"></a>У сертификатов, использующих шифрование на основе эллиптических кривых, должны быть разрешенные имена кривых (предварительная версия)

Если вы используете шифрование на основе эллиптических кривых или сертификаты ECC, вы можете настроить список разрешенных имен эллиптических кривых из списка ниже. Параметр по умолчанию позволяет выполнять все указанные ниже имена кривых.

- P-256
- P-256K
- P-384
- P-521

## <a name="certificates-using-rsa-cryptography-manage-minimum-key-size-for-rsa-certificates-preview"></a>Сертификаты, использующие шифрование RSA. Управление минимальным размером ключа для сертификатов RSA (предварительная версия)

При использовании сертификатов RSA можно выбрать минимальный размер ключа, который должен иметь сертификаты. Вы можете выбрать один из вариантов из приведенного ниже списка.

- 2048 bit
- 3072 bit
- 4096 bit

## <a name="manage-certificates-that-are-within-a-specified-number-of-days-of-expiration-preview"></a>Управление сертификатами, срок действия которых истекает за указанное число дней (предварительная версия)

Если сертификат, не прошедший надлежащий контроль, не будет заменен до истечения срока его действия, у вас может произойти сбой в работе службы. Эта политика очень важна для того, чтобы убедиться, что ваши сертификаты, хранящиеся в хранилище ключей, находятся под контролем. Эту политику рекомендуется применять несколько раз с разными порогами истечения срока действия, например, с порогами 180, 90, 60 и 30 дней. Эту политику можно использовать для мониторинга и рассмотрения срока действия сертификата в вашей организации.

# <a name="key-policies"></a>[Политики ключей](#tab/keys)

### <a name="keys-should-not-be-active-for-longer-than-the-specified-number-of-days-preview"></a>Ключи не должны быть активными дольше указанного числа дней (предварительная версия)

Если вы хотите гарантировать, чтобы ключи не оставались активными дольше указанного числа дней, можно использовать эту политику для аудита времени активности ключа.

**Если для ключа задана дата активации**, эта политика вычисляет количество дней, прошедших с **даты активации** ключа до текущей даты. Если это число дней превышает установленное пороговое значение, ключ будет помечен как несоответствующий этой политике.

**Если для ключа не задана дата активации**, эта политика вычисляет количество дней, прошедших с **даты создания** ключа до текущей даты. Если это число дней превышает установленное пороговое значение, ключ будет помечен как несоответствующий этой политике.

### <a name="keys-should-be-the-specified-cryptographic-type-rsa-or-ec-preview"></a>Ключи должны иметь указанный тип шифрования RSA или EC (предварительная версия)

Эта политика позволяет ограничивать тип ключей, которые могут находиться в хранилище ключей. Вы можете использовать эту политику, чтобы убедиться, что ваши ключи защищены RSA, ECC или поддерживают HSM. Вы можете выбрать из следующего списка разрешенных типов сертификатов.

- RSA
- RSA — HSM
- ECC
- ECC — HSM

### <a name="keys-using-elliptic-curve-cryptography-should-have-the-specified-curve-names-preview"></a>У ключей, использующих шифрование на основе эллиптических кривых, должны быть указаны имена кривых (предварительная версия)

Если вы используете шифрование на основе эллиптических кривых или ключи ECC, вы можете настроить список разрешенных имен эллиптических кривых из списка ниже. Параметр по умолчанию позволяет выполнять все указанные ниже имена кривых.

- P-256
- P-256K
- P-384
- P-521

### <a name="keys-should-have-expirations-dates-set-preview"></a>Для ключей должны быть заданы даты истечения срока действия (предварительная версия)

Эта политика выполняет аудит всех ключей в хранилищах ключей и помечает несоответствующими те из них, для которых не задана дата окончания срока действия. Эта политика также позволяет блокировать создание ключей, для которых не задана дата окончания срока действия.

### <a name="keys-should-have-more-than-the-specified-number-of-days-before-expiration-preview"></a>Ключи должны иметь больше указанного числа дней до истечения срока действия (предварительная версия)

Если ключ слишком близок к истечению срока действия и организация не выполнит его смену своевременно, работа служб может остановиться. Ключи необходимо сменять не позднее указанного числа дней до истечения срока действия, чтобы обеспечить достаточное время для реагирования на сбой. Эта политика выполняет аудит ключей, у которых приближается дата окончания срока действия, и позволяет задать пороговое значение в днях. Эта политика также позволяет предотвращать создание новых ключей со слишком коротким сроком действия.

### <a name="keys-should-be-backed-by-a-hardware-security-module-preview"></a>Ключи должны поддерживаться аппаратным модулем безопасности (предварительная версия)

Аппаратный модуль безопасности (HSM) используется для хранения ключей. HSM обеспечивает физический уровень защиты для криптографических ключей. Криптографический ключ не может покинуть физическое устройство HSM, что обеспечивает более высокий уровень безопасности, чем при использовании программного ключа. В некоторых организациях существуют требования по обязательному использованию ключей HSM. Эта политика используется для аудита всех ключей в хранилище ключей, для которых не настроено использование модуля HSM. Эта политика также позволяет блокировать создание новых ключей без HSM. Эта политика применяется ко всем типам ключей (RSA и ECC).

### <a name="keys-using-rsa-cryptography-should-have-a-specified-minimum-key-size-preview"></a>Для ключей, использующих шифрование RSA, должен быть указан минимальный размер ключа (предварительная версия)

Использование ключей RSA с малым размером считается небезопасной практикой при проектировании систем. Возможно, для вас действуют стандарты аудита и сертификации, определяющие минимально допустимый размер используемых ключей. Следующая политика позволяет задать требования к минимальному размеру ключа для хранилища ключей. Вы можете выполнять аудит ключей, которые не соответствуют этим минимальным требованиям. Эта политика также позволяет блокировать создание новых ключей, которые не соответствуют требованиям к минимальному размеру ключа.

### <a name="keys-should-have-the-specified-maximum-validity-period-preview"></a>Для ключей должен быть указан максимальный срок действия (предварительная версия)

Вы можете управлять требованиями к обеспечению соответствия для своей организации, указав максимальный период времени в днях, в течение которого ключ будет действительным в хранилище ключей. Ключи со сроком действия больше заданного порогового значения будут помечены как несоответствующие. Эта политика также позволяет блокировать создание новых ключей, у которых срок действия превышает указанный максимальный срок.

# <a name="secret-policies"></a>[Политики секретов](#tab/secrets)

### <a name="secrets-should-not-be-active-for-longer-than-the-specified-number-of-days-preview"></a>Секреты не должны быть активными дольше указанного числа дней (предварительная версия)

Если вы хотите гарантировать, чтобы секреты не оставались активными дольше указанного числа дней, можно использовать эту политику для аудита времени активности секрета.

**Если для секрета задана дата активации**, эта политика вычисляет количество дней, прошедших с **даты активации** секрета до текущей даты. Если это число дней превышает установленное пороговое значение, секрет будет помечен как несоответствующий этой политике.

**Если для секрета не задана дата активации**, эта политика вычисляет количество дней, прошедших с **даты создания** секрета до текущей даты. Если это число дней превышает установленное пороговое значение, секрет будет помечен как несоответствующий этой политике.

### <a name="secrets-should-have-content-type-set-preview"></a>Для секретов должен быть задан тип содержимого (предварительная версия)

В качестве секрета в хранилище ключей можно сохранить любой файл с обычным или закодированным текстом. Однако в организации могут существовать политики смены и ограничения для паролей, строк подключения или сертификатов, хранимых в качестве ключей. Тег типа содержимого поможет пользователю понять, что хранится в объекте секрета, не считывая значение этого секрета. Эту политику можно использовать для аудита секретов, для которых не указан тег типа содержимого. Также эта политика позволяет предотвращать создание новых секретов без тега типа содержимого.

### <a name="secrets-should-have-expiration-date-set-preview"></a>Секреты должны иметь установленную дату истечения срока действия (предварительная версия)

Эта политика выполняет аудит всех секретов в хранилищах ключей и помечает несоответствующими те из них, для которых не задана дата окончания срока действия. Также эта политика позволяет блокировать создание ключей, для которых не задана дата окончания срока действия.

### <a name="secrets-should-have-more-than-the-specified-number-of-days-before-expiration-preview"></a>Секреты должны иметь больше указанного числа дней до истечения срока действия (предварительная версия)

Если секрет слишком близок к истечению срока действия и организация не выполнит его смену своевременно, работа служб может остановиться. Секреты необходимо сменять не позднее указанного числа дней до истечения срока действия, чтобы обеспечить достаточное время для реагирования на сбой. Эта политика выполняет аудит секретов, у которых приближается дата окончания срока действия, и позволяет задать пороговое значение в днях. Эта политика также позволяет предотвращать создание новых секретов со слишком коротким сроком действия.

### <a name="secrets-should-have-the-specified-maximum-validity-period-preview"></a>Для секретов должен быть указан максимальный срок действия (предварительная версия)

Вы можете управлять требованиями к обеспечению соответствия для своей организации, указав максимальный период времени в днях, в течение которого секрет будет действительным в хранилище ключей. Секреты со сроком действия больше заданного порогового значения будут помечены как несоответствующие. Эта политика также позволяет блокировать создание новых секретов, у которых срок действия превышает указанный максимальный срок.

---

## <a name="example-scenario"></a>Пример сценария

Вы управляете хранилищем ключей, используемым несколькими командами, которое содержит 100 сертификатов, и хотите убедиться, что ни один из сертификатов в хранилище ключей не будет действителен более 2 лет.

1. Вы назначаете политику **Сертификаты должны иметь указанный максимальный срок действия**, указываете, что максимальный срок действия сертификата составляет 24 месяца, и указываете действие политики "Аудит". 
1. При просмотре [отчета о соответствии на портале Azure ](#view-compliance-results)вы обнаружите, что 20 сертификатов не соответствуют требованиям и действительны в течение более 2 лет. 
1. Вы связываетесь с владельцами этих сертификатов и сообщаете о новом требовании безопасности, согласно которому срок действия сертификатов не может превышать 2 года. Некоторые команды ответили и 15 сертификатов были обновлены с максимальным сроком действия 2 года или меньше. Другие команды не отвечают, и у вас по-прежнему есть 5 несоответствующих сертификатов в хранилище ключей.
1. Вы изменяете действие политики, присваивая значение "запретить". 5 несоответствующих сертификатов не отменяются и продолжают функционировать. Однако их невозможно продлить на период действия более 2 лет. 

## <a name="enabling-and-managing-a-key-vault-policy-through-the-azure-portal"></a>Включение политики Key Vault и управление ею с помощью портала Azure

### <a name="select-a-policy-definition"></a>Выбор назначения определения политики

1. Войдите на портал Azure. 
1. В строке поиска "Политика" найдите и выберите **Политика**.

    ![Снимок экрана: строка поиска.](../media/policy-img1.png)

1. В окне "Политика" выберите **Определения**.

    ![Снимок экрана: выделенный раздел "Определения"](../media/policy-img2.png)

1. В фильтре категорий снимите флажок **Выбрать все** и выберите **Key Vault**. 

    ![Снимок экрана: фильтр категорий с выбранной категорией "Key Vault".](../media/policy-img3.png)

1. Теперь вы сможете просмотреть все политики, доступные для общедоступной предварительной версии Azure Key Vault. Убедитесь, что вы прочитали и поняли раздел руководств по политике, приведенный выше, затем выберите политику, которую нужно назначить для области.  

    ![Снимок экрана: политики, предоставляемые в общедоступной предварительной версии.](../media/policy-img4.png)

### <a name="assign-a-policy-to-a-scope"></a>Назначение политики для области 

1. Выберите политику, которую хотите применить. В этом примере показана политика **Управление сроком действия сертификата**. Нажмите кнопку "Назначить" в левом верхнем углу.

    ![Снимок экрана: политика управления сроком действия сертификата.](../media/policy-img5.png)
  
1. Выберите подписку, в которой необходимо применить политику. Вы можете выбрать ограничение области только для одной группы ресурсов в рамках подписки. Если вы хотите применить политику ко всей подписке и исключить некоторые группы ресурсов, можно также настроить список исключений. Установите для параметра принудительного применения политики значение **Enabled** (Включено), если хотите, чтобы применить политику (аудит или запрет), или **Disabled** (Отключено), чтобы отключить эффект (аудит или отрицание). 

    ![Снимок экрана: здесь вы можете выбрать ограничение области только для одной группы ресурсов в рамках подписки.](../media/policy-img6.png)

1. Щелкните вкладку "Параметры" в верхней части экрана, чтобы указать максимальный срок действия в месяцах. Выберите **аудит** или **запретить** в отношении действия политики, следуя указаниям в разделах выше. Потом выберите кнопку "Просмотреть и создать". 

    ![Снимок экрана: вкладка "Параметры", на которой вы можете указать максимальный срок действия в месяцах.](../media/policy-img7.png)

### <a name="view-compliance-results"></a>Просмотр результатов соответствия

1. Вернитесь на вкладку "Политика" и перейдите на вкладку соответствия. Нажмите на задание политики, для которого нужно просмотреть результаты соответствия.

    ![Снимок экрана: вкладка "Соответствие", на которой вы можете выбрать назначение политики для просмотра ее результатов соответствия.](../media/policy-img8.png)

1. На этой странице вы можете фильтровать результаты по соответствующим или несоответствующим хранилищам. Здесь в области назначения политики можно просмотреть список несоответствующих хранилищ ключей. Хранилище считается несоответствующим, если какой-либо из компонентов (сертификатов) в хранилище не соответствует требованиям. Вы можете выбрать отдельное хранилище, чтобы просмотреть отдельные несоответствующие компоненты (сертификаты). 


    ![Снимок экрана: здесь в области назначения политики можно просмотреть список несоответствующих хранилищ ключей.](../media/policy-img9.png)

1. Просмотр названия несоответствующих компонентов в хранилище


    ![Снимок экрана: здесь вы можете просмотреть названия несоответствующих компонентов в хранилище.](../media/policy-img10.png)

1. Если вам нужно проверить, не запрещено ли пользователям создавать ресурсы в хранилище ключей, выберите вкладку **События компонентов (предварительный просмотр)**, чтобы просмотреть сводку запрещенных сертификатов со сведениями о запрашивающей стороне и метками времени запросов. 


    ![Общие сведения о работе хранилища Azure Key Vault](../media/policy-img11.png)

## <a name="feature-limitations"></a>Ограничения функции

При назначении "запрещенной" политики запуск запрета на создание несоответствующих ресурсов может занять до 30 минут (в среднем) и 1 час (в худшем случае). Оценка политики существующих компонентов хранилища может занять до 1 часа (в среднем) и 2 часов (в худшем случае), прежде чем результаты проверки будут доступны для просмотра в пользовательском интерфейсе портала. Если результаты проверки соответствия отображаются как "Не запущено", это может указывать на то, что:
- Оценка политики еще не завершена. В худшем случае задержка оценки может занять до 2 часов. 
- В области назначения политики нет хранилищ ключей.
- В области назначения политики нет хранилищ ключей с сертификатами.

> [!NOTE]
> [Режимы поставщика ресурсов](../../governance/policy/concepts/definition-structure.md#resource-provider-modes) Политики Azure, например предназначенные для Azure Key Vault, на странице [Соответствие компонентов](../../governance/policy/how-to/get-compliance-data.md#component-compliance) предоставляют сведения о соответствии ресурса политикам.

## <a name="next-steps"></a>Next Steps

- Дополнительные сведения о [службе "Политика Azure"](../../governance/policy/overview.md)
- См. примеры для Key Vault: [Определения встроенных политик для Key Vault](../../governance/policy/samples/built-in-policies.md#key-vault)
