---
title: Управление доступом с HSM, управляемым Azure
description: Управление разрешениями на доступ для управляемых HSM и ключей Azure. В этой статье рассматриваются модель проверки подлинности и авторизации для управляемого модуля HSM и защита HSM.
services: key-vault
author: amitbapat
tags: azure-resource-manager
ms.service: key-vault
ms.subservice: managed-hsm
ms.topic: conceptual
ms.date: 02/17/2021
ms.author: ambapat
ms.openlocfilehash: 0c0a0c5f62f92aaf195e207dfd505ffb017d924e
ms.sourcegitcommit: 910a1a38711966cb171050db245fc3b22abc8c5f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "100653906"
---
# <a name="managed-hsm-access-control"></a>Управление доступом к управляемому устройству HSM

> [!NOTE]
> Поставщик ресурсов Key Vault поддерживает два типа ресурсов: **хранилища** и **управляемый HSM**. Управление доступом, описанное в этой статье, применимо только к **управляемым HSM**. Дополнительные сведения об управлении доступом для управляемого модуля HSM см. в статье [предоставление доступа к Key Vault ключам, сертификатам и секретам с помощью управления доступом на основе ролей в Azure](../general/rbac-guide.md).

Управляемое устройство HSM в Azure Key Vault — это облачная служба, которая защищает ключи шифрования. Это критически важные для бизнеса конфиденциальные данные, поэтому важно защищать доступ к управляемым устройствам HSM, предоставляя его только авторизованным приложениям и пользователям. В этой статье описывается модель контроля доступа к Управляемому устройству HSM. Здесь приводится описание процессов аутентификации и авторизации, а также сведения о том, как защитить доступ к управляемым устройствам HSM.

## <a name="access-control-model"></a>Модель управления доступом

Доступ к управляемому HSM контролируется через два интерфейса: **плоскость управления** и **плоскость данных**. Плоскость управления — это место, где вы управляете модулем HSM. Операции в этой плоскости включают создание и удаление управляемых HSM и получение управляемых свойств HSM. Плоскость данных — это место, где вы работаете с данными, хранящимися в управляемом HSM, который является ключами шифрования, поддерживающими HSM. Вы можете добавлять, удалять, изменять и использовать ключи для выполнения криптографических операций, управлять назначениями ролей для управления доступом к ключам, создавать полную резервную копию HSM, восстанавливать полную резервную копию и управлять доменом безопасности из интерфейса плоскости данных.

Для доступа к управляемому HSM в любой плоскости все вызывающие объекты должны иметь правильную проверку подлинности и авторизацию. Аутентификация позволяет идентифицировать вызывающую сторону. Авторизация определяет, какие операции может выполнять вызывающий объект. Вызывающий объект может быть одним из [субъектов безопасности](../../role-based-access-control/overview.md#security-principal) , определенных в Azure Active Directory-User, Group, Service субъекта или управляемом удостоверении.

Обе плоскости используют Azure Active Directory для проверки подлинности. Для авторизации используются разные системы, как показано ниже.
- Плоскость управления использует управление доступом на основе ролей Azure — Azure RBAC — систему авторизации, созданную на базе Azure Azure Resource Manager 
- Плоскость данных использует управляемый объект RBAC уровня HSM (управляемый локально RBAC). система авторизации реализуется и применяется на управляемом уровне HSM.

При создании управляемого HSM запрашивающий также предоставляет список администраторов плоскости данных (поддерживаются все [субъекты безопасности](../../role-based-access-control/overview.md#security-principal) ). Только эти администраторы могут получить доступ к управляемой плоскости данных HSM, чтобы выполнять ключевые операции и управлять назначениями ролей в плоскости данных (управляемым HSM Local RBAC).

Модель разрешений для обеих плоскостей использует тот же синтаксис, но они применяются на разных уровнях, а назначения ролей используют разные области. Управляющая плоскость Azure RBAC обеспечивается Azure Resource Manager в то время как управляемый модуль HSM управляется локальным модулем HSM.

> [!IMPORTANT]
> Предоставление плоскости управления субъектами безопасности доступа к управляемому HSM не предоставляет им доступа к плоскости данных для доступа к ключам или назначениям ролей в плоскости данных, управляемым HSM Local RBAC). Эта изоляция заключается в том, чтобы предотвратить случайное расширение привилегий, затрагивающих доступ к ключам, хранящимся в управляемом HSM.

Например, администратор подписки (поскольку у него есть разрешение "участник" для всех ресурсов в подписке) может удалить управляемый HSM в своей подписке, но если у них нет доступа к плоскости данных, специально предоставленной через управляемый модуль HSM Local RBAC, они не смогут получить доступ к ключам или управлять назначением ролей в управляемом HSM, чтобы предоставить себе или другим пользователям доступ к плоскости данных

## <a name="azure-active-directory-authentication"></a>Проверка подлинности Azure Active Directory

При создании управляемого модуля HSM в подписке Azure он автоматически связывается с Azure Active Directory клиентом подписки. Все вызывающие объекты на обеих плоскостях должны быть зарегистрированы в этом клиенте и проходить проверку подлинности для доступа к управляемому HSM.

Приложение выполняет проверку подлинности с Azure Active Directory до вызова любой плоскости. Приложение может использовать любой [поддерживаемый метод проверки подлинности](../../active-directory/develop/authentication-vs-authorization.md) на основе типа приложения. Приложение получает маркер для ресурса на плоскости, чтобы получить доступ к нему. Ресурс является конечной точкой в плоскости управления или данных на основе среды Azure. Приложение использует маркер и отправляет запрос REST API управляемой конечной точке HSM. Узнайте больше о [полном потоке аутентификации](../../active-directory/develop/v2-oauth2-auth-code-flow.md).

Использование единого механизма проверки подлинности для обеих плоскостей имеет несколько преимуществ:

- Организации могут централизованно управлять доступом ко всем управляемым HSM в Организации.
- Если пользователь оставит, он сразу же теряет доступ ко всем управляемым HSM в Организации.
- Организации могут настроить проверку подлинности с помощью параметров в Azure Active Directory, например включить многофакторную проверку подлинности для повышения безопасности.

## <a name="resource-endpoints"></a>Конечные точки ресурсов

Субъекты безопасности обращаются к плоскостям через конечные точки. Элементы управления доступом для двух плоскостей работают независимо. Чтобы предоставить приложению доступ для использования ключей в управляемом HSM, вы предоставляете доступ к плоскости данных с помощью управляемого модуля HSM Local RBAC. Чтобы предоставить пользователю доступ к управляемому ресурсу HSM для создания, чтения, удаления, перемещения управляемых HSM и изменения других свойств и тегов, используемых в Azure RBAC.

В следующей таблице показаны конечные точки плоскости управления и плоскости данных.

| Плоскость&nbsp;доступа | Конечные точки доступа | Операции | Механизм контроля доступа |
| --- | --- | --- | --- |
| Плоскость управления | **Глобально:**<br> management.azure.com:443<br> | Создание, чтение, обновление, удаление и перемещение управляемых HSM<br>Задать управляемые Теги HSM | Azure RBAC |
| Плоскость данных | **Глобально:**<br> &lt;HSM-Name &gt; . managedhsm.Azure.NET:443<br> | **Ключи**: Расшифровка, шифрование,<br> Распаковка, перенос, проверка, подписывание, получение, перечисление, обновление, создание, импорт, удаление, архивация, восстановление, очистка<br/><br/> **Управление ролями в плоскости данных (управляемым HSM Local RBAC)**_: Перечисление определений ролей, назначение ролей, удаление назначений ролей <br/> <br/> , определение пользовательских ролей_* резервное копирование и восстановление **: резервное копирование, <br/> <br/> восстановление, проверка состояния "домен безопасности операций резервного копирования и восстановления"*** *: скачивание и отправка домена безопасности | Управляемый локальный RBAC HSM |
|||||
## <a name="management-plane-and-azure-rbac"></a>Плоскость управления и Azure RBAC

В плоскости управления вы используете Azure RBAC для авторизации операций, которые может выполнять вызывающий объект. В модели RBAC Azure каждая подписка Azure имеет экземпляр Azure Active Directory. Вы можете предоставить доступ пользователям, группам и приложениям из этого каталога. Доступ предоставляется для управления ресурсами в подписке Azure, использующими модель развертывания Azure Resource Manager. Чтобы предоставить доступ, можно использовать [портал Azure](https://portal.azure.com/), [Azure CLI](/cli/azure/install-classic-cli), [Azure PowerShell](/powershell/azureps-cmdlets-docs) или [REST API Azure Resource Manager](/rest/api/authorization/roleassignments).

Вы создаете хранилище ключей в группе ресурсов и управляете доступом с помощью Azure Active Directory. Можно предоставить пользователям или группе возможность управлять хранилищами ключей в группе ресурсов. Вы предоставляете доступ на определенном уровне области, назначая соответствующие роли Azure. Чтобы предоставить пользователю доступ к управлению хранилищами ключей, ему необходимо назначить предопределенную роль `key vault Contributor` в определенной области. Роли Azure могут быть назначены следующие уровни областей:

- **Группа управления**. роль Azure, назначенная на уровне подписки, применяется ко всем подпискам в этой группе управления.
- **Подписка**. роль Azure, назначенная на уровне подписки, применяется ко всем группам ресурсов и ресурсам в рамках этой подписки.
- **Группа ресурсов**. роль Azure, назначенная на уровне группы ресурсов, применяется ко всем ресурсам в этой группе ресурсов.
- **Конкретный ресурс**. роль Azure, назначенная конкретному ресурсу, применяется к этому ресурсу. В этом случае ресурс является определенным хранилищем ключей.

Есть несколько заданных по умолчанию ролей. Если заданные роли не соответствуют вашим потребностям, вы можете определить собственные. Дополнительные сведения см. в статье о [встроенных ролях в Azure RBAC](../../role-based-access-control/built-in-roles.md).

## <a name="data-plane-and-managed-hsm-local-rbac"></a>Плоскость данных и управляемый модуль HSM Local RBAC

Вы предоставляете субъекту безопасности доступ для выполнения конкретных операций с ключами путем назначения роли. Для каждого назначения роли необходимо указать роль и область, к которой применяется это назначение. Для управляемых модулей HSM Local RBAC доступны две области.

- **"/" или "/Кэйс"**: область действия уровня HSM. Участники безопасности, которым назначена роль в этой области, могут выполнять операции, определенные в роли для всех объектов (ключей) в управляемом HSM.
- **"/Кэйс/ &lt; Key-Name &gt; "**— область уровня ключа. Участники безопасности, которым назначена роль в этой области, могут выполнять операции, определенные в этой роли, только для всех версий указанного ключа.

## <a name="next-steps"></a>Дальнейшие действия

- Руководство для администраторов по началу работы см. в статье [об Управляемом устройстве HSM](overview.md).
- Руководство по управлению ролями см. в разделе [Managed HSM Local RBAC](role-management.md)
- Дополнительные сведения о ведении журналов использования Управляемого устройства HSM см. в [этой статье](logging.md).