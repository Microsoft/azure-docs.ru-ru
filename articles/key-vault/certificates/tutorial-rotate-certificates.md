---
title: Руководство. Изменение частоты автоматической смены сертификата в Key Vault | Документация Майкрософт
description: Это руководство содержит сведения о том, как изменить частоту автоматической смены сертификата в Azure Key Vault с помощью портала Azure
services: key-vault
author: msmbaldwin
manager: rkarlin
tags: azure-resource-manager
ms.service: key-vault
ms.subservice: certificates
ms.topic: tutorial
ms.custom: mvc
ms.date: 04/16/2020
ms.author: sebansal
ms.openlocfilehash: 78cdc0b59fd178049e755cca5e1e909ac24483f2
ms.sourcegitcommit: dda0d51d3d0e34d07faf231033d744ca4f2bbf4a
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/05/2021
ms.locfileid: "102204054"
---
# <a name="tutorial-configure-certificate-auto-rotation-in-key-vault"></a>Руководство по настройке автоматической смены сертификата в Key Vault

С помощью Azure Key Vault вы можете легко подготавливать и развертывать цифровые сертификаты, а также управлять ими. Это могут быть общедоступные или частные сертификаты SSL/TLS, подписанные центром сертификации, а также самозаверяющие сертификаты. Key Vault также позволяет запрашивать и обновлять сертификаты через отношения партнерства с центрами сертификации, предоставляя надежное решение для управления жизненным циклом сертификатов. Из этого руководства вы узнаете, как изменить для сертификата срок действия, частоту автоматической смены и центр сертификации.

В этом руководстве описаны следующие процедуры.

> [!div class="checklist"]
> * Управление сертификатом с помощью портала Azure.
> * Добавление учетной записи поставщика центра сертификации.
> * Изменение срока действия сертификата.
> * Изменение частоты автоматической смены сертификата.
> * Обновление атрибутов сертификата с помощью Azure PowerShell.

Перед началом работы ознакомьтесь c [основными понятиями службы Key Vault](../general/basic-concepts.md).

Если у вас еще нет подписки Azure, [создайте бесплатную учетную запись](https://azure.microsoft.com/free/?WT.mc_id=A261C142F), прежде чем начинать работу.

## <a name="sign-in-to-azure"></a>Вход в Azure

Войдите на портал Azure по адресу https://portal.azure.com.

## <a name="create-a-vault"></a>Создание хранилища

Создайте хранилище ключей Azure с помощью [портала Azure](../general/quick-create-portal.md), [Azure CLI](../general/quick-create-cli.md) или [Azure PowerShell](../general/quick-create-powershell.md). В нашем примере используется хранилище ключей с именем **Example-Vault**.

![Выходные данные после создания хранилища ключей](../media/certificates/tutorial-import-cert/vault-properties.png)

## <a name="create-a-certificate-in-key-vault"></a>Создайте сертификат в Key Vault

Создайте сертификат в хранилище ключей или импортируйте существующий (см. статью [Действия по созданию сертификата в Key Vault](../secrets/quick-create-portal.md)). В нашем примере для работы используется сертификат с именем **ExampleCertificate**.

## <a name="update-certificate-lifecycle-attributes"></a>Изменение атрибутов жизненного цикла сертификата

В Azure Key Vault атрибуты жизненного цикла сертификата можно изменить как до, так и после создания этого сертификата.

В Key Vault можно создавать следующие виды сертификатов:

- Самозаверяющий сертификат.
- Сертификат, созданный в центре сертификации, который является партнером Key Vault.
- Сертификат центра сертификации, который не является партнером Key Vault.

Следующие центры сертификации в настоящее время являются партнерами для Key Vault:

- DigiCert: Key Vault предоставляет OV-сертификаты TLS/SSL.
- GlobalSign: Key Vault предоставляет OV-сертификаты TLS/SSL.

Key Vault выполняет автоматическую смену сертификатов, используя существующие партнерские отношения с центрами сертификации. Поскольку Key Vault использует партнерские отношения для автоматического запроса и обновления сертификатов, функция автоматической смены неприменима для сертификатов, созданных в тех центрах сертификации, которые не имеют партнерских отношений с Key Vault.

> [!NOTE]
> Администратор учетной записи для центра сертификации создает учетные данные, которые Key Vault будет использовать для создания, обновления и применения TLS/SSL-сертификатов.
![Центр сертификации](../media/certificates/tutorial-rotate-cert/cert-authority-create.png)
>

### <a name="update-certificate-lifecycle-attributes-at-the-time-of-creation"></a>Изменение атрибутов жизненного цикла сертификата во время создания

1. На странице свойств Key Vault выберите **Сертификаты**.
1. Выберите **Создать или импортировать**.
1. На экране **Создание сертификата** измените следующие значения:

   - **Срок действия**. Введите значение, обозначающее количество месяцев. Для повышения безопасности рекомендуется создавать сертификаты с коротким сроком действия. По умолчанию для созданного сертификата устанавливается срок действия в 12 месяцев.
   - **Тип действия времени существования**. Выберите для сертификата действие автоматического продления или оповещения, а затем укажите срок в **процентах от времени существования** или **днях до истечения срока действия**. По умолчанию устанавливается автоматическое продление сертификата по истечении 80 % от времени его существования. Выберите один из следующих параметров в раскрывающемся меню.

        |  Автоматически продлевать в указанное время| Отправлять электронное письмо всем контактам в указанное время |
        |-----------|------|
        |При выборе этого параметра *включается* автоматическая смена. | При выборе этого параметра автоматическая смена *не выполняется*, а только отправляется оповещение контактным лицам.|

1. Нажмите кнопку **создания**.

![Жизненный цикл сертификата](../media/certificates/tutorial-rotate-cert/create-cert-lifecycle.png)

### <a name="update-lifecycle-attributes-of-a-stored-certificate"></a>Изменение атрибутов жизненного цикла для сохраненного сертификата

1. Выберите хранилище ключей.
1. На странице свойств Key Vault выберите **Сертификаты**.
1. Выберите сертификат, который вы хотите изменить. В нашем примере для работы используется сертификат с именем **ExampleCertificate**.
1. В строке меню сверху выберите **Политика выдачи**.

   ![Снимок экрана: выделенная кнопка "Политика выдачи".](../media/certificates/tutorial-rotate-cert/cert-issuance-policy.png)

1. На экране **Создание политики** измените следующие значения:

   - **Срок действия**. Измените значение (число месяцев).
   - **Тип действия времени существования**. Выберите для сертификата действие автоматического продления или оповещения, а затем укажите срок в **процентах от времени существования** или **днях до истечения срока действия**.

   ![Свойства сертификатов](../media/certificates/tutorial-rotate-cert/cert-policy-change.png)

1. Щелкните **Сохранить**.

> [!IMPORTANT]
> Изменение типа действия времени существования для сертификата немедленно изменит это значение для существующих сертификатов.


### <a name="update-certificate-attributes-by-using-powershell"></a>Изменение атрибутов сертификата с помощью PowerShell

```azurepowershell


Set-AzureKeyVaultCertificatePolicy -VaultName $vaultName 
                                   -Name $certificateName 
                                   -RenewAtNumberOfDaysBeforeExpiry [276 or appropriate calculated value]
```

> [!TIP]
> Чтобы изменить политику продления для нескольких сертификатов сразу, предоставьте файл `File.csv` со значениями `VaultName,CertName`, как в следующем примере:
> <br/>
 `vault1,Cert1` <br/>
>  `vault2,Cert2`
>
>  ```azurepowershell
>  $file = Import-CSV C:\Users\myfolder\ReadCSVUsingPowershell\File.csv 
> foreach($line in $file)
> {
> Set-AzureKeyVaultCertificatePolicy -VaultName $vaultName -Name $certificateName -RenewAtNumberOfDaysBeforeExpiry [276 or appropriate calculated value]
> }
>  ```
> 
Дополнительные сведения об этих параметрах см. в статье о команде [az keyvault certificate](/cli/azure/keyvault/certificate#az-keyvault-certificate-set-attributes).

## <a name="clean-up-resources"></a>Очистка ресурсов

В других руководства по Key Vault используются базовые компоненты, созданные по инструкциям из этой статьи. Если вы планируете переходить к этим руководствам, есть смысл пока не удалять созданные ресурсы.
Когда потребность в ресурсах отпадет, удалите эту группу ресурсов, что автоматически удалит хранилище ключей и все связанные ресурсы.

Чтобы удалить группу ресурсов с помощью портала, сделайте следующее:

1. В поле **Поиск** в верхней части портала введите имя группы ресурсов. Когда в результатах поиска появится группа ресурсов, использованная в этом кратком руководстве, выберите ее.
1. Выберите **Удалить группу ресурсов**.
1. В поле **Введите имя группы ресурсов:** введите имя группы ресурсов и щелкните **Удалить**.


## <a name="next-steps"></a>Дальнейшие действия

Из этого руководства вы узнали, как изменить атрибуты жизненного цикла сертификата. Дополнительные сведения о Key Vault и интеграции с приложениями представлены в следующих статьях.

- Узнайте больше об [управлении созданием сертификатов в Azure Key Vault](./create-certificate-scenarios.md).
- См. общие сведения о [Key Vault](../general/overview.md).
