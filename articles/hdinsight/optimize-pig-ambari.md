---
title: Оптимизация Apache Pig с помощью Apache Ambari в Azure HDInsight
description: Используйте веб-интерфейс Apache Ambari для настройки и оптимизации Apache Pig.
ms.service: hdinsight
ms.topic: how-to
ms.date: 05/04/2020
ms.openlocfilehash: 43159360342063af1682a984db037ae286721411
ms.sourcegitcommit: 42e4f986ccd4090581a059969b74c461b70bcac0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/23/2021
ms.locfileid: "104871169"
---
# <a name="optimize-apache-pig-with-apache-ambari-in-azure-hdinsight"></a>Оптимизация Apache Pig с помощью Apache Ambari в Azure HDInsight

Apache Ambari — это веб-интерфейс для управления кластерами HDInsight и их мониторинга. Общие сведения о пользовательском веб-интерфейсе Ambari см. [в статье Управление кластерами HDInsight с помощью веб-интерфейса Apache Ambari](hdinsight-hadoop-manage-ambari.md).

С помощью пользовательского веб-интерфейса Ambari можно изменить свойства Apache Pig, чтобы настроить запросы Pig. Непосредственное изменение свойств Pig из Ambari изменяет свойства Pig в файле `/etc/pig/2.4.2.0-258.0/pig.properties`.

1. Чтобы изменить свойства Pig, перейдите на вкладку **Configs** (Конфигурации) Pig, а затем разверните область **Advanced pig-properties** (Дополнительные свойства Pig).

1. Найдите, раскомментируйте и измените значение свойства, которое требуется изменить.

1. Щелкните **сохранить** в правой верхней части окна, чтобы сохранить новое значение. Изменение некоторых свойств может потребовать перезапуска службы.

    :::image type="content" source="./media/optimize-pig-ambari/advanced-pig-properties.png" alt-text="Дополнительные свойства Apache Pig" border="true":::

> [!NOTE]  
> Любые параметры уровня сеанса переопределяют значения свойств в файле `pig.properties`.

## <a name="tune-execution-engine"></a>Настройка подсистемы выполнения

Доступны две подсистемы выполнения для выполнения сценариев Pig: MapReduce и Tez. Tez — это оптимизированная подсистема, она работает намного быстрее, чем MapReduce.

1. Чтобы изменить подсистему выполнения, в области **Advanced pig-properties** (Дополнительные свойства Pig) найдите свойство `exectype`.

1. По умолчанию используется значение **MapReduce**. Измените его на **Tez**.

## <a name="enable-local-mode"></a>Включение локального режима

Как и в Hive, локальный режим используется для ускорения выполнения заданий со сравнительно небольшими объемами данных.

1. Чтобы включить локальный режим, для параметра `pig.auto.local.enabled` задайте значение **true**. Значением по умолчанию является false.

1. Задания с размером входных данных меньшим, чем значение свойства `pig.auto.local.input.maxbytes`, считаются небольшими заданиями. Значение этого свойства по умолчанию — 1 ГБ.

## <a name="copy-user-jar-cache"></a>Копирование кэша JAR-файлов пользователя

Pig копирует JAR-файлы, необходимые для определяемых пользователем функций, в распределенный кэш, чтобы сделать их доступными для узлов задач. Эти JAR не меняются часто. Если параметр `pig.user.cache.enabled` включен, JAR-файлы можно поместить в кэш для повторного использования заданиями, выполняемыми тем же пользователем. Этот параметр приводит к незначительному увеличению производительности задания.

1. Чтобы включить эту функцию, задайте для параметра `pig.user.cache.enabled` значение true. Значение по умолчанию – false.

1. Чтобы задать базовый путь к кэшированным JAR-файлам, задайте его в параметре `pig.user.cache.location`. Значение по умолчанию — `/tmp`.

## <a name="optimize-performance-with-memory-settings"></a>Оптимизация производительности с помощью параметров памяти

Приведенные ниже параметры памяти позволяют оптимизировать производительность сценариев Pig.

* `pig.cachedbag.memusage`: Объем памяти, заданный для контейнера. Контейнер представляет собой набор кортежей. Кортеж — это упорядоченный набор полей, а поле — это фрагмент данных. Если данные в контейнере выходят за пределы заданной памяти, они переносятся на диск. Значение по умолчанию — 0,2. Это означает 20 процентов доступной памяти. Эта память используется совместно всеми контейнерами в приложении.

* `pig.spill.size.threshold`: контейнеры, чей размер превышает это пороговое значение размера сброса (в байтах), сбрасываются на диск. Значение по умолчанию — 5 МБ.

## <a name="compress-temporary-files"></a>Сжатие временных файлов

Pig создает временные файлы во время выполнения заданий. Сжатие временных файлов позволяет повысить производительность дисковых операций чтения и записи файлов. Для сжатия временных файлов можно использовать следующие параметры.

* `pig.tmpfilecompression`: если имеет значение true, включает сжатие временных файлов. Значением по умолчанию является false.

* `pig.tmpfilecompression.codec`: кодек для сжатия временных файлов. Рекомендуемые кодеки сжатия — это LZO и привязка для снижения использования ЦП.

## <a name="enable-split-combining"></a>Включение объединения небольших файлов

Если эта функция включена, небольшие файлы объединяются, чтоб уменьшить число задач сопоставления. Этот параметр повышает эффективность заданий с большим количеством небольших файлов. Чтобы включить эту функцию, задайте для параметра `pig.noSplitCombination` значение true. Значением по умолчанию является false.

## <a name="tune-mappers"></a>Настройка модулей сопоставления

Число модулей сопоставления можно определить, изменив свойство `pig.maxCombinedSplitSize`. Это свойство определяет размер данных, которые должны обрабатываться одной задачей Map. Значение по умолчанию равно размеру блока по умолчанию в файловой системе. Увеличение этого значения приводит к уменьшению числа задач модуля сопоставления.

## <a name="tune-reducers"></a>Настройка модулей сжатия

Количество модулей сжатия вычисляется на основе параметра `pig.exec.reducers.bytes.per.reducer`. Этот параметр задает количество байтов, обрабатываемых модулем сжатия. По умолчанию он имеет значение 1 ГБ. Чтобы ограничить максимальное число модулей сжатия, установите `pig.exec.reducers.max` свойство по умолчанию 999.

## <a name="next-steps"></a>Дальнейшие действия

* [Управление кластерами HDInsight с помощью веб-интерфейса Ambari](hdinsight-hadoop-manage-ambari.md)
* [Управление кластерами HDInsight с помощью REST API Ambari](hdinsight-hadoop-manage-ambari-rest-api.md)
* [Оптимизация кластеров](./hdinsight-changing-configs-via-ambari.md)
* [Оптимизация Apache HBase](./optimize-hbase-ambari.md)
* [Оптимизация Apache Hive](./optimize-hive-ambari.md)
