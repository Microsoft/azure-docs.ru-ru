---
title: Управление сетевым трафиком в Azure HDInsight
description: Изучите методы управления входящим и исходящим трафиком в кластерах Azure HDInsight.
ms.service: hdinsight
ms.topic: conceptual
ms.date: 09/02/2020
ms.openlocfilehash: 0cbda0b533a64e627bfeef9589ab95c4163ae73e
ms.sourcegitcommit: 2f9f306fa5224595fa5f8ec6af498a0df4de08a8
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/28/2021
ms.locfileid: "98943365"
---
# <a name="control-network-traffic-in-azure-hdinsight"></a>Управление сетевым трафиком в Azure HDInsight

Для управления сетевым трафиком в виртуальных сетях Azure можно использовать следующие методы:

* **Группы безопасности сети** (NSG) позволяют фильтровать входящий и исходящий трафик в сети. Дополнительные сведения см. в документе [Фильтрация сетевого трафика с помощью групп безопасности сети](../virtual-network/network-security-groups-overview.md).

* **Виртуальные сетевые модули** можно использовать только с исходящим трафиком. Виртуальные сетевые модули выполняют функции таких устройств, как межсетевые экраны и маршрутизаторы. Дополнительные сведения см. в документе [Сетевые устройства](https://azure.microsoft.com/solutions/network-appliances).

Поскольку HDInsight является управляемой службой, ей требуется неограниченный доступ к службам работоспособности и управления HDinsight как для входящего, так и исходящего трафика виртуальной сети. При использовании групп безопасности сети необходимо убедиться, что эти службы могут взаимодействовать с кластером HDInsight.

![Схема сущностей HDInsight, созданных в настраиваемой виртуальной сети Azure](./media/control-network-traffic/hdinsight-vnet-diagram.png)

## <a name="hdinsight-with-network-security-groups"></a>Azure HDInsight с группами безопасности сети

Если для управления сетевым трафиком вы планируете использовать **группы безопасности сети**, выполните следующие действия перед установкой HDInsight.

1. Определите регион Azure, который планируется использовать для HDInsight.

2. Найдите теги службы, необходимые для HDInsight в вашем регионе. Существует несколько способов получить эти теги службы:
    1. Просмотрите список опубликованных тегов служб в [тегах службы "Группа безопасности сети" (NSG) для Azure HDInsight](hdinsight-service-tags.md). 
    2. Если ваш регион отсутствует в списке, используйте [API обнаружения тегов службы](../virtual-network/service-tags-overview.md#use-the-service-tag-discovery-api-public-preview) , чтобы найти тег службы для вашего региона.
    3. Если вы не можете использовать API, скачайте [JSON-файл тега службы](../virtual-network/service-tags-overview.md#discover-service-tags-by-using-downloadable-json-files) и найдите нужный регион.


3. Создайте или измените группы безопасности сети для подсети, в которой планируется установить HDInsight.

    * __Группы безопасности сети__: разрешите __входящий__ трафик через порт __443__ с диапазона IP-адресов. Это позволит гарантировать, что службы управления HDInsight смогут обращаться к кластеру из-за пределов виртуальной сети. Для __кластеров Kafka с поддержкой прокси-сервера REST__ дополнительно разрешите __входящий__ трафик через порт __9400__. Это обеспечит доступность прокси-сервера REST для Kafka.

Дополнительные сведения см. в статье [Группы безопасности сети](../virtual-network/network-security-groups-overview.md).

## <a name="controlling-outbound-traffic-from-hdinsight-clusters"></a>Управление исходящим трафиком из кластеров HDInsight

Дополнительные сведения об управлении исходящим трафиком из кластеров HDInsight см. в статье [Настройка исходящего сетевого трафика для кластеров Azure HDInsight с помощью брандмауэра](hdinsight-restrict-outbound-traffic.md).

### <a name="forced-tunneling-to-on-premises"></a>Принудительное туннелирование в локальную сеть

Принудительное туннелирование — это определяемая пользователем конфигурация маршрутизации, в которой весь трафик из подсети принудительно направляется в определенную сеть или расположение, например в локальную сеть или на брандмауэр. Принудительное туннелирование всех передаваемых данных в локальную среду _не_ рекомендуется из-за больших объемов передачи данных и потенциального ухудшения производительности.

Клиентам, которые хотят настроить принудительное туннелирование, следует применить [пользовательские хранилища метаданных](./hdinsight-use-external-metadata-stores.md) и настроить подключение к ним из подсети кластера или локальной сети.

Из [этой статьи](hdinsight-restrict-outbound-traffic.md) вы узнаете, как настроить ограничения исходящего сетевого трафика для кластеров Azure HDInsight с помощью определяемых пользователем маршрутов в Брандмауэре Azure.

## <a name="required-ports"></a>Требуемые порты

Если вы планируете использовать **брандмауэр** и получить доступ к кластеру за пределами определенных портов, вам следует разрешить трафик на этих портах, необходимых для вашего сценария. По умолчанию специальная фильтрация портов не требуется, пока трафик управления Azure, описанный в предыдущем разделе, может получить доступ к кластеру через порт 443.

См. [список портов, используемых службами Hadoop в HDInsight](hdinsight-hadoop-port-settings-for-services.md).

Дополнительные сведения о правилах межсетевого экрана для виртуальных модулей см. в документе [Сценарий использования виртуальных устройств](../virtual-network/virtual-network-scenario-udr-gw-nva.md).

## <a name="next-steps"></a>Дальнейшие действия

* Примеры кода и создания виртуальных сетей Azure см. в статье [Создание виртуальных сетей для кластеров Azure HDInsight](hdinsight-create-virtual-network.md).
* Полный пример настройки HDInsight для подключения к локальной сети см. в статье [Подключение HDInsight к локальной сети](./connect-on-premises-network.md).
* Дополнительные сведения о виртуальных сетях Azure см. в статье [Виртуальная сеть Azure](../virtual-network/virtual-networks-overview.md).
* Дополнительные сведения о группах безопасности сети см. в статье [Фильтрация сетевого трафика с помощью групп безопасности сети](../virtual-network/network-security-groups-overview.md).
* Дополнительные сведения о пользовательских маршрутах см. в статье [User-defined routes and IP forwarding](../virtual-network/virtual-networks-udr-overview.md) (Определяемые пользователем маршруты и IP-пересылка).
* Дополнительные сведения о виртуальных сетях см. в статье [Планирование виртуальной сети для Azure HDInsight](./hdinsight-plan-virtual-network-deployment.md).