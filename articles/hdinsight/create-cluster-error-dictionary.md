---
title: Создание словаря ошибок кластера Azure HDInsight
description: Узнайте, как устранять ошибки, возникающие при создании кластеров Azure HDInsight.
author: karkrish
ms.author: v-todmc
ms.service: hdinsight
ms.topic: troubleshooting
ms.custom: hdinsightactive,hdiseo17may2017
ms.date: 08/24/2020
ms.openlocfilehash: 6b8c0069d619d3ebd87e3c54b4f653812199f590
ms.sourcegitcommit: 2f9f306fa5224595fa5f8ec6af498a0df4de08a8
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/28/2021
ms.locfileid: "98943329"
---
# <a name="azure-hdinsight-cluster-creation-errors"></a>Azure HDInsight: ошибки создания кластера

В этой статье описываются способы устранения ошибок, которые могут возникнуть при создании кластеров.

> [!NOTE]
> Первые три ошибки, описанные в этой статье, являются ошибками проверки. Они могут возникать, если в продукте Azure HDInsight используется класс **CsmDocument_2_0** .

## <a name="error-codedeploymentdocument-csmdocument_2_0-failed-the-validation"></a>Код ошибки: Деплойментдокумент "CsmDocument_2_0" не прошел проверку

**Ошибка**: "не удается получить доступ к расположению действия скрипта: \<SCRIPT ACTION URL\> "

### <a name="error-message-1"></a>Сообщение об ошибке 1

"Удаленный сервер вернул ошибку: (404) не найден".

#### <a name="cause"></a>Причина

Служба HDInsight не может получить доступ к URL-адресу действия скрипта, указанному в составе запроса на создание кластера. Служба получает предыдущее сообщение об ошибке при попытке доступа к действию скрипта.

#### <a name="resolution"></a>Решение

- Для URL-адреса HTTP или HTTPS проверьте URL-адрес, выполнив попытку перехода к нему из окна браузера режиме инкогнито.
- Для URL-адреса WASB убедитесь, что сценарий существует в учетной записи хранения, которую вы передаете в запросе. Также убедитесь, что ключ хранилища для этой учетной записи хранения указан правильно.
- Для URL-адреса ADLS убедитесь, что сценарий существует в учетной записи хранения.

---

### <a name="error-message-2"></a>Сообщение об ошибке 2

"Указанный URI сценария \<SCRIPT_URI\> находится в ADLS, но этот кластер не имеет субъекта хранилища Data Lake Store"

#### <a name="cause"></a>Причина

Служба HDInsight не может получить доступ к URL-адресу действия скрипта, указанному в составе запроса на создание кластера. Служба получает предыдущее сообщение об ошибке при попытке доступа к действию скрипта.

#### <a name="resolution"></a>Решение

Добавьте соответствующую учетную запись Azure Data Lake Storage Gen 1 в кластер. Также добавьте субъект-службу, которая обращается к учетной записи Data Lake Storage Gen 1 к кластеру.

---

### <a name="error-message-3"></a>Сообщение об ошибке 3

"Размер виртуальной машины", \<CUSTOMER_SPECIFIED_VM_SIZE\> указанный в запросе, недопустим или не поддерживается для роли " \<ROLE\> ". Допустимые значения: \<VALID_VM_SIZE_FOR_ROLE\> .

#### <a name="cause"></a>Причина

Указанный размер виртуальной машины недопустим для этой роли. Эта ошибка может возникать из-за того, что значение размера виртуальной машины не работает должным образом или не подходит для роли компьютера.

#### <a name="resolution"></a>Решение

В сообщении об ошибке перечислены допустимые значения размера виртуальной машины. Выберите одно из этих значений и повторите запрос на создание кластера.

---

## <a name="error-codeinvalidvirtualnetworkid"></a>Код ошибки: Инвалидвиртуалнетворкид  

### <a name="error"></a>Ошибка

"VirtualNetworkId является недопустимым. VirtualNetworkId ' \<USER_VIRTUALNETWORKID\> ' * '

### <a name="cause"></a>Причина

Значение **VirtualNetworkId** , указанное во время создания кластера, имеет неправильный формат.

### <a name="resolution"></a>Решение

Убедитесь, что значения **VirtualNetworkId** и подсети имеют правильный формат. Чтобы получить значение **VirtualNetworkId** , сделайте следующее:

1. Перейдите на портал Azure.
1. Выберите свою виртуальную сеть.
1. Выберите пункт меню **Свойства** . Свойство **ResourceId** имеет значение **VirtualNetworkId** .

Ниже приведен пример идентификатора виртуальной сети.

"/subscriptions/c15fd9b8-e2b8-1d4e-aa85-2e668040233b/resourceGroups/myresourcegroup/providers/Microsoft.Network/virtualNetworks/myvnet"

---

## <a name="error-code-customizationfailederrorcode"></a>Код ошибки: Кустомизатионфаиледерроркоде

### <a name="error"></a>Ошибка

"Сбой развертывания кластера из-за ошибки в действии пользовательского скрипта. Действия, завершившиеся сбоем: \<SCRIPT_NAME\> . для дальнейшей отладки ошибки перейдите в пользовательский интерфейс Ambari. "

### <a name="cause"></a>Причина

Пользовательский скрипт, указанный во время запроса на создание кластера, выполняется после успешного развертывания кластера. Этот код ошибки указывает на ошибку, возник во время выполнения пользовательского скрипта с именем \<SCRIPT_NAME\> .

### <a name="resolution"></a>Решение

Так как скрипт является пользовательским скриптом, мы рекомендуем устранить проблему и при необходимости перезапустить сценарий. Чтобы устранить ошибку сценария, просмотрите журналы в папке/Вар/либ/Амбари-ажент/*. Или откройте страницу **операции** в пользовательском интерфейсе Ambari, а затем выберите **run_customscriptaction** операцию, чтобы просмотреть сведения об ошибке.

---

## <a name="error-codeinvaliddocumenterrorcode"></a>Код ошибки: Инвалиддокументерроркоде

### <a name="error"></a>Ошибка

" \<META_STORE_TYPE\> Версия схемы хранилище метаданных \<METASTORE_MAJOR_VERSION\> в базе данных \<DATABASE_NAME\> несовместима с версией кластера \<CLUSTER_VERSION\> "

### <a name="cause"></a>Причина

Настраиваемый хранилище метаданных несовместим с выбранной версией кластера HDInsight. В настоящее время кластеры HDInsight 4,0 поддерживают только хранилище метаданных версии 3,0 и более поздних версий, а кластеры HDInsight 3,6 не поддерживают хранилище метаданных версии 3,0 и выше.

### <a name="resolution"></a>Решение

Используйте только хранилище метаданных версии, поддерживаемые версией кластера HDInsight. Если вы не укажете настраиваемую хранилище метаданных, HDInsight создает хранилище метаданных, а затем удаляет его после удаления кластера.

---

## <a name="error-code-failedtoconnectwithclustererrorcode"></a>Код ошибки: Фаиледтоконнектвисклустерерроркоде 

### <a name="error"></a>Ошибка

"Не удалось подключиться к конечной точке управления кластера для выполнения операции масштабирования. Убедитесь, что правила сетевой безопасности не блокируют внешний доступ к кластеру, и что доступ к пользовательскому интерфейсу диспетчера кластеров (Ambari) возможен успешно».

### <a name="cause"></a>Причина

Правило брандмауэра в группе безопасности сети (NSG) блокирует обмен данными в кластере с критически важными службами работоспособности и управления Azure.

### <a name="resolution"></a>Решение

Если вы планируете использовать группы безопасности сети для управления сетевым трафиком, перед установкой HDInsight выполните следующие действия.

- Определите регион Azure, который планируется использовать для HDInsight.
- Определите IP-адреса, необходимые для HDInsight. Дополнительные сведения см. в статье [HDInsight management IP addresses](./hdinsight-management-ip-addresses.md) (IP-адреса управления HDInsight).
  - Создайте или измените группы безопасности сети для подсети, в которой планируется установить HDInsight.
  - Для групп безопасности сети разрешите входящий трафик через порт 443 с IP-адресов. Эта конфигурация гарантирует, что службы управления HDInsight могут получить доступ к кластеру извне виртуальной сети.

---

## <a name="error-code-storagepermissionsblockedformsi"></a>Код ошибки: Сторажепермиссионсблоккедформси

### <a name="error"></a>Ошибка

"У управляемого удостоверения нет разрешений на учетную запись хранения. Убедитесь, что роль "владелец данных BLOB-объекта хранилища" назначена управляемому удостоверению для учетной записи хранения. Хранилище:/Subscriptions/ \<Subscription ID\> /ResourceGroups/ \< Resource Group Name\> /Провидерс/Микрософт.стораже/сторажеаккаунтс/ \<Storage Account Name\> , управляемое удостоверение:/Subscriptions/ \<Subscription ID\> /resourceGroups// \< Resource Group Name\> /провидерс/Микрософт.манажедидентити/усерассигнедидентитиес/ \<User Managed Identity Name\> "

### <a name="cause"></a>Причина

Не предоставлены разрешения, необходимые для управления удостоверениями. Управляемое удостоверение, назначенное пользователем, не имеет роли участника хранилища BLOB-объектов в учетной записи хранения Azure Data Lake Storage 2-го поколения.

### <a name="resolution"></a>Решение

1. Откройте портал Azure.
1. Войдите в свою учетную запись хранения.
1. Просмотрите раздел **Управление доступом (IAM)**.
1. Убедитесь, что пользователь имеет роль участника данных BLOB-объекта хранилища или назначенную ему роль владельца данных BLOB-объекта хранилища.

Дополнительные сведения см. в разделе [Настройка разрешений для управляемого удостоверения в учетной записи Data Lake Storage 2-го поколения](hdinsight-hadoop-use-data-lake-storage-gen2.md).

---

## <a name="error-code-invalidnetworksecuritygroupsecurityrules"></a>Код ошибки: InvalidNetworkSecurityGroupSecurityRules

### <a name="error"></a>Ошибка

"Правила безопасности в группе безопасности сети/Subscriptions/ \<SubscriptionID\> /resourceGroups/<имя группы ресурсов \> по умолчанию/поставщики/Microsoft. Network/networkSecurityGroups/ \<Network Security Group Name\> настроены с подсетью/Subscriptions/ \<SubscriptionID\> /resourceGroups/ \<Resource Group name\> РГ-вестеуропе-внет-ТомТом-дефаулт/providers/Microsoft. Network/virtualNetworks/ \<Virtual Network Name\> /субнетс/не \<Subnet Name\> разрешают обязательное входящее и/или исходящее подключение. Дополнительные сведения см. в [Подплане плана виртуальной сети для Azure HDInsight](./hdinsight-plan-virtual-network-deployment.md)или обратитесь в службу поддержки ".

### <a name="cause"></a>Причина

Если группы безопасности сети или определяемые пользователем маршруты (определяемые пользователем маршруты) управляют входящим трафиком к кластеру HDInsight, убедитесь, что кластер может взаимодействовать с критически важными службами работоспособности и управления Azure.

### <a name="resolution"></a>Решение

Если вы планируете использовать группы безопасности сети для управления сетевым трафиком, перед установкой HDInsight выполните следующие действия.

- Укажите регион Azure, который планируется использовать для HDInsight, и создайте список надежных IP-адресов для вашего региона. Дополнительные сведения см. в разделе [службы работоспособности и управления: конкретные регионы](./hdinsight-management-ip-addresses.md#health-and-management-services-specific-regions).
- Выявление IP-адресов, необходимых для HDInsight. Дополнительные сведения см. в разделе [IP-адреса управления HDInsight](./hdinsight-management-ip-addresses.md).
- Создайте или измените группы безопасности сети для подсети, в которой планируется установить HDInsight. Для групп безопасности сети разрешите входящий трафик через порт 443 с IP-адресов. Эта конфигурация гарантирует, что службы управления HDInsight могут получить доступ к кластеру извне виртуальной сети.

---

## <a name="error-code-cluster-setup-failed-to-install-components-on-one-or-more-hosts"></a>Код ошибки: программе установки кластера не удалось установить компоненты на одном или нескольких узлах

### <a name="error"></a>Ошибка

"Программе установки кластера не удалось установить компоненты на одном или нескольких узлах. Повторите запрос ".

### <a name="cause"></a>Причина 

Как правило, эта ошибка возникает в случае временной проблемы или сбоя Azure.

### <a name="resolution"></a>Решение

На странице [состояния Azure](https://status.azure.com) можно просмотреть сведения о сбоях Azure, которые могут повлиять на развертывание кластера. Если нет простоев, повторите развертывание кластера.

---

## <a name="error-code-failedtoconnectwithclustererrorcode"></a>Код ошибки: Фаиледтоконнектвисклустерерроркоде

### <a name="error"></a>Ошибка

Не удалось подключиться к конечной точке управления кластера. Повторите попытку позже.

### <a name="cause"></a>Причина

Службе HDInsight не удается подключиться к кластеру при попытке создать кластер

### <a name="resolution"></a>Решение

При использовании пользовательской группы безопасности сети VNet (группы безопасности сети) и определяемых пользователем маршрутов (определяемые пользователем маршруты) убедитесь, что кластер может обмениваться данными со службами управления HDInsight. Дополнительные сведения см. в разделе [IP-адреса управления HDInsight](./hdinsight-management-ip-addresses.md).

---

## <a name="error-code-deployments-failed-due-to-policy-violation-resource-resource-uri-was-disallowed-by-policy-policy-identifiers-policyassignmentnamepolicy-name-idprovidersmicrosoftmanagementmanagementgroupsmanagement-group-name-providersmicrosoftauthorizationpolicyassignmentspolicy-namepolicydefinition-policy-definition"></a>Код ошибки: не удалось выполнить развертывание из-за нарушения политики: "ресурс" <Resource URI> "запрещен политикой. Идентификаторы политик: "[{" Полициассигнмент ": {" имя ":" <Policy Name> "," ID ":" <Management Group Name> поставщики/providers/Microsoft.Management/managementGroups//Microsoft. Authorization/полициассигнментс/ <Policy Name> "}," полицидефинитион ": <Policy Definition>

### <a name="cause"></a>Причина

Политики Azure на основе подписки могут запрещать создание общедоступных IP-адресов. Для создания кластера HDInsight требуется два общедоступных IP-адреса.

Следующие политики обычно влияют на создание кластера:

* Политики, препятствующие созданию IP-адресов или подсистем балансировки нагрузки в рамках подписки.
* Политика, запрещающая создание учетных записей хранения.
* Политика, предотвращающая удаление сетевых ресурсов, таких как IP-адреса или подсистемы балансировки нагрузки.

### <a name="resolution"></a>Решение

Удаление или отключение назначения политики Azure на основе подписки при создании кластера HDInsight.

---

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения об устранении ошибок при создании кластера см. в статье [Устранение неполадок при создании кластера с помощью Azure HDInsight](./hadoop/hdinsight-troubleshoot-cluster-creation-fails.md).