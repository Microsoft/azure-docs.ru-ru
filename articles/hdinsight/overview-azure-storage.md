---
title: Общие сведения о службе хранилища Azure в HDInsight
description: Общие сведения о службе хранилища Azure в HDInsight.
ms.service: hdinsight
ms.topic: conceptual
ms.custom: seoapr2020
ms.date: 04/21/2020
ms.openlocfilehash: 419b4939c19ee03651a406db44244897e17087f2
ms.sourcegitcommit: 42e4f986ccd4090581a059969b74c461b70bcac0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/23/2021
ms.locfileid: "104865474"
---
# <a name="azure-storage-overview-in-hdinsight"></a>Общие сведения о службе хранилища Azure в HDInsight

Служба хранилища Azure — это надежное, универсальное решение, которое полностью интегрируется с HDInsight. HDInsight может использовать контейнер больших двоичных объектов в службе хранилища Azure в качестве файловой системы по умолчанию для кластера. С помощью интерфейса HDFS все компоненты HDInsight могут напрямую взаимодействовать со структурированными или неструктурированными данными, хранящимися как большие двоичные объекты.

Мы рекомендуем использовать отдельные контейнеры хранилища для хранилища кластера по умолчанию и бизнес-данных. Разделение заключается в изоляции журналов HDInsight и временных файлов от собственных бизнес-данных. Мы также рекомендуем удалить контейнер больших двоичных объектов по умолчанию, который содержит журналы приложений и системы, после каждого использования, чтобы сократить затраты на хранение. Обязательно извлеките эти журналы перед удалением контейнера.

Если вы решили защитить учетную запись хранения с ограничениями **брандмауэра и виртуальной сети** в **выбранных сетях**, обязательно включите исключение **Разрешить доверенные службы Майкрософт.**... Исключением является то, что HDInsight может получить доступ к вашей учетной записи хранения.

## <a name="hdinsight-storage-architecture"></a>Архитектура хранилища HDInsight

Следующая схема является абстрактным представлением архитектуры HDInsight службы хранилища Azure:

:::image type="content" source="./media/overview-azure-storage/storage-architecture.png" alt-text="Архитектура хранилища HDInsight" border="false":::

HDInsight предоставляет доступ к распределенной файловой системе, которая локально присоединена к вычислительным узлам. Доступ к этой файловой системе может осуществляться с использованием полного универсального кода ресурса (URI), например:

`hdfs://<namenodehost>/<path>`

С помощью HDInsight можно также получить доступ к данным в службе хранилища Azure. Синтаксис выглядит следующим образом:

`wasb://<containername>@<accountname>.blob.core.windows.net/<path>`

Рассмотрите некоторые рекомендации для использования учетной записи хранения Azure с кластерами HDInsight.

* **Контейнеры в учетных записях хранения, подключенные к кластеру.** Поскольку имя учетной записи и ключ связываются с кластером во время создания, вы получаете полный доступ к BLOB-объектам в этих контейнерах.

* **Открытые контейнеры или общедоступные большие двоичные объекты в учетных записях хранения, не подключенных к кластеру:** У вас есть разрешение только на чтение для больших двоичных объектов в контейнерах.
  
  > [!NOTE]
  > Общедоступные контейнеры позволяют получить список всех доступных в этом контейнере больших двоичных объектов, а также метаданные контейнера. Общедоступные BLOB-объекты позволяют получить доступ к BLOB-объектам только при условии, что вам известен точный URL-адрес. Дополнительные сведения см. в статье [Управление анонимным доступом на чтение к контейнерам и большим двоичным объектам](../storage/blobs/anonymous-read-access-configure.md).

* **Закрытые контейнеры в учетных записях хранения, которые не подключены к кластеру:** Вы не можете получить доступ к BLOB-объектам в контейнерах, если вы не определили учетную запись хранения при отправке заданий WebHCat.

Определенные на этапе создания учетные записи хранения и их ключи хранятся в файле %HADOOP_HOME%/conf/core-site.xml на узлах кластера. По умолчанию HDInsight будет использовать учетные записи хранения, определенные в файле core-site.xml. Этот параметр можно изменить с помощью [Apache Ambari](./hdinsight-hadoop-manage-ambari.md).

Несколько заданий WebHCat, включая Apache Hive. И MapReduce, Apache Hadoop Streaming и Apache Pig, содержат описание учетных записей хранения и метаданных. (В настоящее время этот аспект относится к Pig с учетными записями хранения, но не для метаданных.) Дополнительные сведения см. в статье [Использование кластера HDInsight с альтернативными учетными записями хранения и метахранилища](https://social.technet.microsoft.com/wiki/contents/articles/23256.using-an-hdinsight-cluster-with-alternate-storage-accounts-and-metastores.aspx).

Большие двоичные объекты могут использоваться для хранения как структурированных, так и неструктурированных данных. В контейнерах больших двоичных объектов данные хранятся в виде пар "ключ — значение" и отсутствует иерархия каталогов. Тем не менее, в имени ключа может использоваться знак косой черты "/", чтобы оно выглядело так, будто файл хранится в структуре каталогов. Например, ключ большого двоичного объекта может выглядеть следующим образом: `input/log1.txt`. Фактического каталога `input` не существует, но из-за косой черты в имени ключа, ключ выглядит как путь к файлу.

## <a name="benefits-of-azure-storage"></a>Преимущества службы хранилища Azure

Вычислительные кластеры и ресурсы хранилища, которые не являются совместно размещенными, подразумевают затраты производительности. Эти затраты компенсируются благодаря созданию вычислительных кластеров близко к ресурсам учетной записи хранения в регионе Azure. В этом регионе эти вычислительные узлы могут получать эффективный доступ к данным по высокоскоростной сети в службе хранилища Azure.

При хранении данных в службе хранилища Azure вместо HDFS вы получаете ряд преимуществ:

* **Повторное использование данных и общий доступ к данным.** Данные в файловой системе HDFS расположены внутри вычислительного кластера. Только приложения, имеющие доступ к вычислительному кластеру, могут использовать данные через API HDFS. Доступ к данным в службе хранилища Azure, напротив, может осуществляться через API HDFS или через REST API хранилища BLOB-объектов. Из за этого для создания и использования данных можно применять больший набор приложений (включая другие кластеры HDInsight) и средств.

* **Архивирование данных:** Когда данные хранятся в службе хранилища Azure, кластеры HDInsight, используемые для вычислений, можно безопасно удалить без потери данных пользователя.

* **Стоимость хранения данных:** Хранение данных в DFS в долгосрочной перспективе является более дорогостоящим, чем хранение данных в службе хранилища Azure. Так как стоимость кластерного кластера превышает стоимость хранилища Azure. Кроме того, так как данные не требуется повторно загружать при создании каждого вычислительного кластера, вы экономите также на загрузке данных.

* **Гибкое масштабирование.** Хотя HDFS и представляет собой масштабируемую файловую систему, масштаб определяется количеством узлов, создаваемых для кластера. Изменение масштаба может оказаться более сложным, чем возможности эластичного масштабирования, которые вы автоматически получаете в службе хранилища Azure.

* **Георепликация:** Хранилище Azure можно географически реплицировать. Хотя это обеспечивает возможность географического восстановления и избыточность данных, переход в расположение геореплицированных данных при отработке отказа заметно влияет на производительность, что может привести к дополнительным затратам. Поэтому мы рекомендуем взвешенно подходить к использованию георепликации, применяя ее, только когда стоимость данных окупает дополнительные затраты.

Определенные задания и пакеты MapReduce могут создавать промежуточные результаты, которые нет нужды хранить в службе хранилища Azure. В таком случае можно выбрать хранение данных в локальной системе HDFS. HDInsight использует DFS для некоторых таких промежуточных результатов в заданиях Hive и других процессах.

> [!NOTE]  
> Большинство команд HDFS (например, `ls`, `copyFromLocal` и `mkdir`) работают правильно в службе хранилища Azure. В службе хранилища Azure будет отличаться поведение только тех команд, которые относятся к стандартной реализации HDFS (под названием DFS), например `fschk` и `dfsadmin`.

## <a name="next-steps"></a>Дальнейшие действия

* [Общие сведения об Azure Data Lake Storage 2-го поколения](../storage/blobs/data-lake-storage-introduction.md)
* [Введение в хранилище Azure](../storage/common/storage-introduction.md)
* [Обзор Azure Data Lake Storage 1-го поколения](./overview-data-lake-storage-gen1.md)
