---
title: Развертывание и администрирование топологий Apache Storm в Azure HDInsight
description: Узнайте, как развертывать, отслеживать и управлять топологиями Apache Storm с помощью панели мониторинга "многофактория" в HDInsight под управлением Linux. Использование инструментов Hadoop для Visual Studio.
ms.service: hdinsight
ms.topic: how-to
ms.custom: hdinsightactive
ms.date: 12/18/2019
ms.openlocfilehash: 417819cad3bc2ee258381426dfcee7c800b69d42
ms.sourcegitcommit: 2f9f306fa5224595fa5f8ec6af498a0df4de08a8
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/28/2021
ms.locfileid: "98929181"
---
# <a name="deploy-and-manage-apache-storm-topologies-on-azure-hdinsight"></a>Развертывание и администрирование топологий Apache Storm в Azure HDInsight

С помощью этого документа вы ознакомитесь с основами управления и мониторинга топологий [Apache Storm](https://storm.apache.org/), работающих в Storm в кластерах HDInsight.

## <a name="prerequisites"></a>Предварительные требования

* Кластер Apache Storm в HDInsight. Ознакомьтесь со статьей [Create Linux-based clusters in HDInsight by using the Azure portal](../hdinsight-hadoop-create-linux-clusters-portal.md) (Создание кластеров под управлением Linux в HDInsight с помощью портала Azure) и выберите **Storm** для параметра **Тип кластера**.

* Используемых Знакомство с Secure Shell (SSH) и безопасной копией (SCP). Дополнительные сведения см. в руководстве по [подключению к HDInsight (Apache Hadoop) с помощью SSH](../hdinsight-hadoop-linux-use-ssh-unix.md).

* Используемых Visual Studio, пакет Azure SDK 2.5.1 или более поздней версии и средства Data Lake для Visual Studio. Дополнительные сведения см. в разделе [Apache Hadoop & Visual Studio Data Lake Tools](../hadoop/apache-hadoop-visual-studio-tools-get-started.md).

## <a name="submit-a-topology-using-visual-studio"></a>Отправка топологии с помощью Visual Studio

Вы можете использовать инструменты Data Lake для Visual Studio, чтобы отправить в кластер с более ограниченным использованием C# или гибридные топологии. Далее используется пример приложения. Сведения о создании топологии с помощью средств Data Lake см. в разделе [Apache Storm топологии с помощью Visual Studio и C#](apache-storm-develop-csharp-visual-studio-topology.md).

1. Если вы еще не установили последнюю версию средств Data Lake для Visual Studio, см. статью [использование средств Data Lake для Visual Studio](../hadoop/apache-hadoop-visual-studio-tools-get-started.md).

    > [!NOTE]  
    > Средства Azure Data Lake и Stream Analytics ранее назывались инструментами HDInsight для Visual Studio.
    >
    > Средства Azure Data Lake и Stream Analytics для Visual Studio включены в рабочую нагрузку **разработки Azure** для visual Studio 2019.

1. Запустите Visual Studio.

1. В окне **Начало работы** выберите **Создать проект**.

1. В окне **Создание нового проекта** выберите поле поиска и введите `Storm` . Затем выберите **выборка из списка** результатов и нажмите кнопку **Далее**.

1. В окне **Настройка нового проекта** введите **имя проекта**, перейдите в каталог или создайте **Расположение** для сохранения нового проекта в. Щелкните **Создать**.

    ![Настройка нового окна проекта, Visual Studio](./media/apache-storm-deploy-monitor-topology-linux/apache-storm-sample1.png)

1. В **Обозреватель сервера** щелкните правой кнопкой мыши **Azure** и выберите **подключиться к Microsoft Azure подписке...** и завершите процесс входа.

1. В **Обозреватель решений** щелкните правой кнопкой мыши проект и выберите **отправить в кластер HDInsight**.

    > [!NOTE]  
    > При появлении запроса введите учетные данные входа для своей подписки Azure. Если у вас несколько подписок, воспользуйтесь той, что содержит ваш кластер Storm в HDInsight.

1. В диалоговом окне **Отправка топологии** в раскрывающемся списке **кластер кластера** выберите свой вариант в кластере HDInsight, а затем нажмите кнопку **Отправить**. Вы можете отслеживать успешность отправки, просмотрев область **вывода** .

## <a name="submit-a-topology-using-ssh-and-the-storm-command"></a>Отправка топологии с помощью SSH и команды "огонь"

1. С помощью команды [ssh command](../hdinsight-hadoop-linux-use-ssh-unix.md) подключитесь к кластеру. Измените приведенную ниже команду, заменив CLUSTERNAME именем своего кластера, а затем введите команду:

    ```cmd
    ssh sshuser@CLUSTERNAME-ssh.azurehdinsight.net
    ```

1. В сеансе SSH используйте следующую команду, чтобы запустить пример топологии **WordCount** :

    ```bash
    storm jar /usr/hdp/current/storm-client/contrib/storm-starter/storm-starter-topologies-*.jar org.apache.storm.starter.WordCountTopology WordCount
    ```

    Эта команда запускает пример топологии WordCount в кластере. Эта топология произвольно создает предложения, а затем подсчитывает число вхождений каждого слова в предложениях.

    > [!NOTE]  
    > При отправке топологии в кластер необходимо сначала скопировать JAR-файл, содержащий кластер, прежде чем использовать `storm` команду. Чтобы скопировать файл в кластер, можно использовать команду `scp`. Например, введите `scp FILENAME.jar USERNAME@CLUSTERNAME-ssh.azurehdinsight.net:FILENAME.jar`.
    >
    > Пример *WordCount* и другие примеры для начала работы уже включены в кластер в `/usr/hdp/current/storm-client/contrib/storm-starter/` .

## <a name="submit-a-topology-programmatically"></a>Программная отправка топологии

Топологию можно развернуть программными средствами с помощью службы Nimbus. [https://github.com/Azure-Samples/hdinsight-java-deploy-storm-topology](https://github.com/Azure-Samples/hdinsight-java-deploy-storm-topology) содержит пример приложения Java, которое демонстрирует развертывание и запуск топологии с помощью службы Nimbus.

## <a name="monitor-and-manage-a-topology-in-visual-studio"></a>Мониторинг топологии и управление ею в Visual Studio

При отправке топологии с помощью Visual Studio появляется окно **представление топология** . Выберите топологию в списке, чтобы просмотреть информацию о выполняемой топологии.

![Топология монитора, окно представления топологий, Visual Studio](./media/apache-storm-deploy-monitor-topology-linux/visual-studio-monitor.png)

> [!NOTE]  
> **Топологии Storm** можно также просмотреть в **обозревателе сервера**. Разверните **Azure**  >  **hdinsight**, щелкните правой кнопкой мыши множество в кластере HDInsight, а затем выберите пункт **Просмотр топологий**.

Выделите компонент spout или bolt, чтобы просмотреть информацию о нем. Для выбранного элемента отображается подсказка со сведениями о компоненте.

### <a name="deactivate-and-reactivate-a-topology"></a>Отключение и повторная активация топологии

Деактивация топологии приостанавливает ее до тех пор, пока топология не будет уничтожена или реактивирована. Для выполнения этих операций используйте кнопки **Отключить** и **повторно активировать** в области **действия** в верхней части окна **представление топологические топологии** .

### <a name="rebalance-a-topology"></a>Перераспределение топологии

Повторная балансировка топологии позволяет системе пересмотреть параллелизм топологии. Например, если вы изменяете размер кластера, чтобы добавить дополнительные примечания, resizeа позволяет топологии видеть новые узлы.

Для повторной балансировки топологии используйте кнопку **перераспределить** в области **действия** окна **представление топологий** .

> [!WARNING]  
> Повторная балансировка топологии деактивирует топологию, повторно распределяет рабочие роли в кластере, а затем возвращает топологию в состояние, в котором она находилась до повторной балансировки. Если топология активна, она снова станет активной. Если топология была отключена, она остается неактивной.

### <a name="kill-a-running-topology"></a>Завершение запущенной топологии

Топологии работы продолжают работать до тех пор, пока они не будут остановлены или кластер не будет удален. Чтобы остановить топологию, используйте кнопку **Kill** в области **действия** .

## <a name="monitor-and-manage-a-topology-using-ssh-and-the-storm-command"></a>Мониторинг топологии и управление ею с помощью SSH и команды,

Программа `storm` позволяет работать с запущенными топологиями из командной строки. Чтобы вывести полный список команд, воспользуйтесь `storm -h` .

### <a name="list-topologies"></a>Вывод списка топологий

Чтобы просмотреть список всех запущенных топологий, используйте следующую команду:

```shell
storm list
```

Эта команда возвращает сведения аналогичные следующим:

```shell
Topology_name        Status     Num_tasks  Num_workers  Uptime_secs
-------------------------------------------------------------------
WordCount            ACTIVE     29         2            263
```

### <a name="deactivate-and-reactivate-a-topology"></a>Отключение и повторная активация топологии

Деактивация топологии приостанавливает ее до тех пор, пока топология не будет уничтожена или реактивирована. Выполните следующие команды, чтобы отключить или повторно активировать:

```shell
storm Deactivate TOPOLOGYNAME
```

```shell
storm Activate TOPOLOGYNAME
```

### <a name="kill-a-running-topology"></a>Завершение запущенной топологии

Топологии Storm после запуска продолжают работать до тех пор, пока не будут остановлены. Для завершения топологии введите следующую команду:

```shell
storm kill TOPOLOGYNAME
```

### <a name="rebalance-a-topology"></a>Перераспределение топологии

Повторная балансировка топологии позволяет системе пересмотреть параллелизм топологии. Например, если вы изменяете размер кластера, чтобы добавить дополнительные примечания, resizeа позволяет топологии видеть новые узлы.

> [!WARNING]  
> Повторная балансировка топологии деактивирует топологию, повторно распределяет рабочие роли в кластере, а затем возвращает топологию в состояние, в котором она находилась до повторной балансировки. Если топология активна, она снова станет активной. Если она была отключена, то останется таковой.

```shell
storm rebalance TOPOLOGYNAME
```

## <a name="monitor-and-manage-a-topology-using-the-storm-ui"></a>Мониторинг топологии и управление ею с помощью пользовательского интерфейса

Пользовательский интерфейс "множество" предоставляет веб-интерфейс для работы с работающими топологиями и включается в кластер HDInsight. Чтобы открыть пользовательский интерфейс Storm, в веб-браузере перейдите по адресу `https://CLUSTERNAME.azurehdinsight.net/stormui`, где *CLUSTERNAME* — это имя вашего кластера.

> [!NOTE]  
> Если вам будет предложено ввести имя пользователя и пароль, то введите учетную запись администратора кластера и пароль, которые использовались при создании кластера.

### <a name="storm-ui-main-page"></a>Основная страница пользовательского интерфейса

На главной странице пользовательского интерфейса Storm отображается следующая информация.

| Section | Описание |
| --- | --- |
| Сводная информация о кластере| Основная информация о кластере Storm. |
| Сводка Nimbus | Список основных сведений Nimbus. |
| Topology summary | Список запущенных топологий. Чтобы просмотреть дополнительные сведения о конкретной топологии, выберите ее ссылку в столбце **имя** . |
| Сводка по супервизору | Информация о контролере Storm. Чтобы просмотреть рабочие ресурсы, связанные с конкретным супервизором, выберите соответствующую ссылку в столбце **узел** или **идентификатор** . |
| Конфигурация Nimbus | Конфигурация Nimbus для кластера. |

Основная страница пользовательского интерфейса с более близким интерфейсом выглядит так же, как на этой веб-странице:

![Главная страница, Пользовательский интерфейс для расApache Storm топологий, Azure](./media/apache-storm-deploy-monitor-topology-linux/apache-storm-web-ui-main-page.png)

#### <a name="topology-summary"></a>Topology summary

При выборе ссылки в разделе **Topology summary** (Сводка по топологиям) отображается следующая информация о топологии.

| Section | Описание |
| --- | --- |
| Topology summary | Общие сведения о топологии. |
| Действия топологии| Действия управления, которые можно выполнять для топологии. Доступные действия описаны далее в этом разделе. |
| Статистика топологии | Статистика по топологии. Чтобы установить интервал времени для записи в этом разделе, выберите соответствующую ссылку в столбце **окно** . |
| *Интервалы ожидания* | Используемые в топологии источники данных, которые называются воронками. Чтобы просмотреть дополнительные сведения о конкретном spout, выберите соответствующую ссылку в столбце **идентификатор** . |
| Винты *(временной интервал)* | Используемые в топологии обработчики данных, которые называются ситами. Чтобы просмотреть дополнительные сведения о конкретной молнии, выберите ее ссылку в столбце **идентификатор** . |
| Рабочие ресурсы | Список рабочих ресурсов. Чтобы просмотреть дополнительные сведения о конкретном рабочем ресурсе, выберите его ссылку в столбце **узел** . |
| Визуализация топологии | Кнопка **Показать визуализацию** , отображающую визуализацию топологии. |
| Конфигурация топологии | Конфигурация выбранной топологии. |

Страница сводных сведений о топологии области похожа на эту веб-страницу:

![Страница "Сводка топологии", Пользовательский интерфейс для расApache Storm, Azure](./media/apache-storm-deploy-monitor-topology-linux/apache-storm-web-ui-topology-summary.png)

В разделе **действия топологии** можно выбрать следующие кнопки для действия:

| Кнопка | Описание |
| --- | --- |
| Активировать | Возобновление обработки отключенной топологии. |
| Отключение | Приостановка выполняемой топологии. |
| Повторная балансировка | Корректировка параллелизма топологии. После изменения числа узлов в кластере следует выполнить повторную балансировку работы топологий. Эта операция позволяет топологии настроить параллелизм для компенсации дополнительного или уменьшенного числа узлов в кластере.<br/><br/>Дополнительные сведения см. в статье о <a href="https://storm.apache.org/documentation/Understanding-the-parallelism-of-a-Storm-topology.html" target="_blank">параллелизме топологии Apache Storm</a>.
| Завершить | Останавливает выполнение топологии Storm по истечении заданного времени ожидания. |
| Отладка | Начинает сеанс отладки для выполняющейся топологии. |
| Отключить отладку | Завершает сеанс отладки для выполняющейся топологии. |
| Изменить уровень ведения журнала | Изменяет уровень ведения журнала отладки. |

##### <a name="spout-and-bolt-summary"></a>Сводка по spout и молния

При выборе воронки в разделе **Spouts** (Воронки) или **Bolts** (Сита) отображается следующая информация о выбранном элементе.

| Section | Описание |
| --- | --- |
| Сводка по компоненту | Основная информация о воронке или сите. |
| Действия компонента | Кнопки **Отладка и** **Завершение отладки** . |
| Статистика spout или молния | Статистика по воронке или ситу. Чтобы установить интервал времени для записи в этом разделе, выберите соответствующую ссылку в столбце **окно** . |
| (С молнией)<br/>Входная статистика *(интервал времени)* | Информация о входных потоках, проходящих через сито. |
| Статистика выходных данных *(интервал времени)* | Информация о потоках, создаваемых компонентами воронки или сита. |
| Профилирование и отладка | Элементы управления для профилирования и отладки компонентов на этой странице. Можно задать значение **состояния/времени ожидания (в минутах)** , а также выбрать кнопки для **Жстакк**, **перезапуск рабочей роли** и **кучи**. |
| Исполнители *(кадр времени)* | Информация об экземплярах воронки или сита. Чтобы просмотреть журнал диагностических данных, созданных для данного экземпляра, выберите запись **порта** для конкретного исполнителя. Вы также можете просмотреть рабочие ресурсы, связанные с конкретным исполнителем, выбрав соответствующую ссылку в столбце **узел** . |
| ошибки | Информация об ошибках для компонентов воронки или сита. |

Страница «сводка» с молнией выглядит примерно так:

![Страница сводки «молния», Пользовательский интерфейс Apache Storm, Azure](./media/apache-storm-deploy-monitor-topology-linux/apache-storm-web-ui-bolt-summary.png)

## <a name="monitor-and-manage-the-topology-using-the-rest-api"></a>Мониторинг топологии и управление ею с помощью REST API

Пользовательский интерфейс, построенный на основе REST API, позволяет выполнять аналогичные задачи управления и мониторинга с помощью REST API. С помощью REST API можно создать пользовательские средства для отслеживания топологий Storm и управления ими.

Дополнительные сведения см. в статье о [REST API пользовательского интерфейса Apache Storm](https://storm.apache.org/releases/current/STORM-UI-REST-API.html). Следующая информация касается использования REST API с Apache Storm в HDInsight.

> [!IMPORTANT]  
> REST APIости не являются общедоступными через Интернет. Доступ к нему должен осуществляться с помощью туннеля SSH к головному узлу кластера HDInsight. Сведения о создании и использовании туннеля SSH см. в статье [Использование туннелирования SSH для доступа к Azure HDInsight](../hdinsight-linux-ambari-ssh-tunnel.md).

### <a name="base-uri"></a>Базовый универсальный код ресурса

Базовый URI для REST API в кластерах HDInsight под управлением Linux доступен по URL-адресу `https://HEADNODEFQDN:8744/api/v1/` , где *хеаднодефкдн* заменяется головным узлом. Доменное имя головного узла создается во время создания кластера и не является статическим.

Полное доменное имя (FQDN) головного узла кластера можно найти несколькими способами.

| Метод обнаружения FQDN | Описание |
| --- | --- |
| Сеанс SSH | Из сеанса SSH в кластер примените команду `headnode -f`. |
| Веб-Ambari | На веб-странице кластера Ambari ( `https://CLUSTERNAME.azurehdinsight.net` ) выберите **службы** в верхней части страницы, а затем выберите множество.  На вкладке **Summary** (Сводка) выберите **Storm UI Server** (Сервер пользовательского интерфейса Storm). Полное доменное имя узла, на котором размещены пользовательский интерфейс Storm и REST API, отображено в верхней части страницы. |
| Ambari REST API | Используйте команду `curl -u admin -G "https://CLUSTERNAME.azurehdinsight.net/api/v1/clusters/CLUSTERNAME/services/STORM/components/STORM_UI_SERVER"`, чтобы получить сведения об узле с выполняемыми пользовательскими интерфейсами Storm и REST API. Замените два экземпляра *имя_кластера* именем кластера. При появлении запроса введите пароль для учетной записи пользователя (администратора). В ответе запись "host_name" выходных данных JSON содержит полное доменное имя узла. |

### <a name="authentication"></a>Проверка подлинности

Запросы к REST API должны использовать *обычную проверку подлинности*, поэтому необходимо использовать имя администратора и пароль для кластера HDInsight.

> [!NOTE]  
> Так как при обычной проверке подлинности данные отправляются открытым текстом, следует *всегда* использовать HTTPS для защиты связи с кластером.

### <a name="return-values"></a>Возвращаемые значения

Сведения, возвращаемые из REST API, могут использоваться только в пределах кластера. Например, полное доменное имя (FQDN), возвращенное для серверов [Apache ZooKeeper](https://zookeeper.apache.org/) , недоступно из Интернета.

## <a name="next-steps"></a>Дальнейшие действия

См. дополнительные сведения о [разработке топологий на основе Java с помощью Apache Maven](apache-storm-develop-java-topology.md).

Список других примеров топологий см. [в статье пример Apache Storm топологий в Azure HDInsight](apache-storm-example-topology.md).
