---
title: Подключение кластера Avere vFXT в Azure
description: Сведения о подключении клиентов к кластеру Вфкст в Авере Вфкст для Azure и о балансировке нагрузки клиентского трафика между узлами кластера.
author: ekpgh
ms.service: avere-vfxt
ms.topic: how-to
ms.date: 12/16/2019
ms.author: rohogue
ms.openlocfilehash: 44a4e1293bc4c5a54e1e345d5cf95ba307a7b120
ms.sourcegitcommit: 772eb9c6684dd4864e0ba507945a83e48b8c16f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "88272577"
---
# <a name="mount-the-avere-vfxt-cluster"></a>Подключение кластера Avere vFXT

Чтобы подключить клиентские компьютеры к кластеру vFXT, выполните приведенные ниже шаги.

1. Решите, как распределить нагрузку трафика клиентов между узлами кластера. Подробные сведения см. разделе [Распределение нагрузки клиента](#balance-client-load).
1. Определите IP-адрес и путь соединения для подключения.
1. Выполните [команду подключения](#mount-command-arguments) с соответствующими аргументами.

## <a name="balance-client-load"></a>Распределение нагрузки клиента

Чтобы помочь распределить клиентские запросы между всеми узлами в кластере, подключите клиенты к полному диапазону IP-адресов, ориентированных на клиенты. Существует несколько простых способов автоматизации этой задачи.

> [!TIP]
> Для больших или сложных систем могут подходить другие методы балансировки нагрузки. Чтобы получить помощь, [откройте запрос в службу поддержки](avere-vfxt-open-ticket.md#open-a-support-ticket-for-your-avere-vfxt).
>
> Если для автоматической балансировки нагрузки на стороне сервера вы предпочитаете использовать DNS-сервер, вам необходимо настроить собственный DNS-сервер и управлять им в Azure. В таком случае вы можете настроить циклический DNS для кластера vFXT, выполнив инструкции, приведенные в [этой статье](avere-vfxt-configure-dns.md).

### <a name="sample-balanced-client-mounting-script"></a>Пример сценария сбалансированного подключения клиентов

В этом примере кода IP-адреса клиентов используются в качестве элемента рандомизации для распределения клиентов на все доступные IP-адреса кластера vFXT.

```bash
function mount_round_robin() {
    # to ensure the nodes are spread out somewhat evenly the default
    # mount point is based on this node's IP octet4 % vFXT node count.
    declare -a AVEREVFXT_NODES="($(echo ${NFS_IP_CSV} | sed "s/,/ /g"))"
    OCTET4=$((`hostname -i | sed -e 's/^.*\.\([0-9]*\)/\1/'`))
    DEFAULT_MOUNT_INDEX=$((${OCTET4} % ${#AVEREVFXT_NODES[@]}))
    ROUND_ROBIN_IP=${AVEREVFXT_NODES[${DEFAULT_MOUNT_INDEX}]}

    DEFAULT_MOUNT_POINT="${BASE_DIR}/default"

    # no need to write again if it is already there
    if ! grep --quiet "${DEFAULT_MOUNT_POINT}" /etc/fstab; then
        echo "${ROUND_ROBIN_IP}:${NFS_PATH}    ${DEFAULT_MOUNT_POINT}    nfs hard,proto=tcp,mountproto=tcp,retry=30 0 0" >> /etc/fstab
        mkdir -p "${DEFAULT_MOUNT_POINT}"
        chown nfsnobody:nfsnobody "${DEFAULT_MOUNT_POINT}"
    fi
    if ! grep -qs "${DEFAULT_MOUNT_POINT} " /proc/mounts; then
        retrycmd_if_failure 12 20 mount "${DEFAULT_MOUNT_POINT}" || exit 1
    fi
}
```

Приведенная выше функция является частью примера с пакетной службой, доступного на сайте [GitHub](https://github.com/Azure/Avere#tutorials).

## <a name="create-the-mount-command"></a>Создание команды подключения

> [!NOTE]
> Если вы не создали новый контейнер больших двоичных объектов при создании кластера Авере Вфкст, добавьте системы хранения, как описано в разделе [Настройка хранилища](avere-vfxt-add-storage.md) перед попыткой подключения клиентов.

Со стороны клиента команда ``mount`` сопоставляет виртуальный сервер (vserver) в кластере vFXT с путем в локальной файловой системе. Формат — ``mount <vFXT path> <local path> {options}``.

Команда mount имеет три элемента:

* Вфкст Path — сочетание IP-адреса и пути соединения пространства имен в кластере 9described ниже).
* локальный путь (путь в клиенте);
* Параметры команды mount — перечислены в [аргументах команды mount](#mount-command-arguments) .

### <a name="junction-and-ip"></a>Соединение и IP

Путь к vserver представляет собой комбинацию его *IP-адреса* и пути к *соединению по пространству имен*. Соединение по пространству имен является виртуальным путем, определенным при добавлении системы хранения.

Если кластер создан с хранилищем BLOB-объектов, путь к этому контейнеру будет иметь значение `/msazure`

Например, ``mount 10.0.0.12:/msazure /mnt/vfxt``.

Если хранилище добавлено после создания кластера, путь соединения пространства имен — это значение, заданное в **пути к пространству имен** при создании соединения. Например, если вы использовали ``/avere/files`` в качестве пути к пространству имен, ваши клиенты подключат путь *IP-адрес*:/avere/files к своей локальной точке подключения.

![Диалоговое окно добавления нового соединения с /avere/files в поле пути к пространству имен](media/avere-vfxt-create-junction-example.png) <!-- to do - change example and screenshot to vfxt/files instead of avere -->

IP-адрес представляет собой один из определенных для vserver IP-адресов, ориентированных на клиенты. Диапазон IP-адресов, взаимодействующих с клиентами, можно найти в двух расположениях на панели управления Avere:

* Таблица **VServers** (вкладка панели мониторинга):

  ![Вкладка Dashboard (Панель мониторинга) на панели управления Avere со вкладкой VServer, выбранной в таблице данных под графиком, и обведенным разделом IP-адресов](media/avere-vfxt-ip-addresses-dashboard.png)

* Страница параметров **Client Facing Network** (Сеть, ориентированная на клиента):

  ![Settings (Параметры) > VServer> страница конфигурации Client Facing Network (Сеть, ориентированная на клиента) с обведенным разделом Address Range (Диапазон адресов) в таблице для конкретного vserver](media/avere-vfxt-ip-addresses-settings.png)

В дополнение к путям, при подключении каждого клиента добавьте описанные ниже [аргументы команды подключения](#mount-command-arguments).

### <a name="mount-command-arguments"></a>Аргументы команды подключения

Чтобы обеспечить простое подключение клиента, передайте эти параметры и аргументы в команде подключения:

``mount -o hard,proto=tcp,mountproto=tcp,retry=30 ${VSERVER_IP_ADDRESS}:/${NAMESPACE_PATH} ${LOCAL_FILESYSTEM_MOUNT_POINT}``

| Обязательные параметры | Описание |
--- | ---
``hard`` | Нежесткие подключения к кластеру vFXT связаны со сбоями в работе приложений и возможной потерей данных.
``proto=netid`` | Этот параметр поддерживает соответствующую обработку сетевых ошибок NFS.
``mountproto=netid`` | Этот параметр поддерживает соответствующую обработку сетевых ошибок для операций подключения.
``retry=n`` | Задайте значение ``retry=30``, чтобы избежать временных ошибок при подключении. (При подключении переднего плана рекомендуется использовать другое значение.)

## <a name="next-steps"></a>Дальнейшие действия

После подключения клиентов их можно использовать для копирования данных в новый контейнер хранилища BLOB-объектов в кластере. Если вам не нужно заполнять новое хранилище, ознакомьтесь с другими ссылками, чтобы узнать о дополнительных задачах установки.

* [Перемещение данных в ядро кластера фильтр](avere-vfxt-data-ingest.md) . Использование нескольких клиентов и потоков для эффективной передачи данных в новый основной фильтр
* [Cluster tuning](avere-vfxt-tuning.md) (Настройка кластера). В этой статье представлены сведения о настройке параметров кластера в соответствии с рабочей нагрузкой.
* [Manage the Avere vFXT cluster](avere-vfxt-manage-cluster.md) (Управление кластером Avere vFXT). В этой статье представлены сведения о запуске или остановке кластера, а также об управлении узлами.
