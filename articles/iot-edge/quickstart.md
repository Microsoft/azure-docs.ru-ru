---
title: Краткое руководство. Создание устройства Azure IoT Edge в Windows | Документация Майкрософт
description: Из этого краткого руководства вы узнаете, как создать устройство IoT Edge и удаленно развернуть готовый код на портале Azure.
author: rsameser
manager: kgremban
ms.author: riameser
ms.date: 01/20/2021
ms.topic: quickstart
ms.service: iot-edge
services: iot-edge
ms.custom: mvc, devx-track-azurecli
monikerRange: =iotedge-2018-06
ms.openlocfilehash: 71e38059aceb7da63f3545610b9acfe48c5d3150
ms.sourcegitcommit: 52e3d220565c4059176742fcacc17e857c9cdd02
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/21/2021
ms.locfileid: "98663219"
---
# <a name="quickstart-deploy-your-first-iot-edge-module-to-a-windows-device-preview"></a>Краткое руководство. Развертывание модуля IoT Edge на устройстве Windows (предварительная версия)

Опробуйте Azure IoT Edge с помощью этого краткого руководства, развернув контейнерный код в Linux на устройстве IoT Edge с Windows. IoT Edge позволяет удаленно управлять кодом на устройствах, чтобы вы могли передавать больше рабочих нагрузок на пограничные устройства. Для работы с этим кратким руководством мы рекомендуем использовать собственное устройство. Вы увидите, насколько просто использовать Azure IoT Edge для Linux в Windows.

Из этого краткого руководства вы узнаете, как выполнять следующие задачи:

* Создайте Центр Интернета вещей.
* Регистрация устройства IoT Edge в Центре Интернета вещей.
* Установка и запуск среды выполнения IoT Edge для Linux в Windows на устройстве.
* Удаленное развертывание модуля на устройстве IoT Edge и отправка телеметрии.

![Схема рассматриваемой в этом кратком руководстве архитектуры для устройства и облака](./media/quickstart/install-edge-full.png)

В этом кратком руководстве объясняется, как настроить Azure IoT Edge для Linux на устройстве Windows. Затем вы развернете модуль на портале Azure для устройства. Модуль, который вы развернете с помощью этого краткого руководства, — это имитированный датчик, генерирующий данные температуры, влажности и давления. В других руководствах по Azure IoT Edge используются наработки из этой статьи: дополнительные развернутые модули, которые анализируют генерируемые данные для бизнес-аналитики.

Если у вас нет активной подписки Azure, перед началом работы создайте [бесплатную учетную запись](https://azure.microsoft.com/free).

>[!NOTE]
>IoT Edge для Linux в Windows предоставляется в [общедоступной предварительной версии](https://azure.microsoft.com/support/legal/preview-supplemental-terms/).

## <a name="prerequisites"></a>Предварительные требования

Подготовьте среду к работе с Azure CLI.

[!INCLUDE [azure-cli-prepare-your-environment-no-header.md](../../includes/azure-cli-prepare-your-environment-no-header.md)]

Облачные ресурсы.

* Группа ресурсов для управления всеми ресурсами, которые вы используете в этом кратком руководстве.

   ```azurecli-interactive
   az group create --name IoTEdgeResources --location westus2
   ```

Устройства IoT Edge:

* Устройство должно быть компьютером или сервером с Windows версии 1809 или более поздней.
* Не менее 4 ГБ памяти, рекомендуется 8 ГБ.
* 10 ГБ свободного дискового пространства

## <a name="create-an-iot-hub"></a>Создание Центра Интернета вещей

Начните с создания Центра Интернета вещей с помощью Azure CLI.

![Схема создания Центра Интернета вещей в облаке](./media/quickstart/create-iot-hub.png)

Для целей этого руководства можно использовать бесплатный уровень. Если у вас уже есть центр Интернета вещей, который вы использовали ранее, вы можете продолжить работу с ним.

При помощи следующего кода создается бесплатный центр **F1** в группе ресурсов `IoTEdgeResources`. Замените `{hub_name}` уникальным именем центра Интернета вещей. Создание Центра Интернета вещей может занять несколько минут.

   ```azurecli-interactive
   az iot hub create --resource-group IoTEdgeResources --name {hub_name} --sku F1 --partition-count 2
   ```

   Если отобразится сообщение об ошибке с уведомлением о том, что в вашей подписке уже имеется один бесплатный центр, измените номер SKU на **S1**. Если отобразится сообщение об ошибке с уведомлением о том, что имя недоступно, значит кто-то уже создал Центр Интернета вещей с таким именем. Выберите другое имя.

## <a name="register-an-iot-edge-device"></a>Регистрация устройства IoT Edge

Зарегистрируйте устройство IoT Edge в только что созданном Центре Интернета вещей.

![Схема регистрации устройства с помощью удостоверения Центра Интернета вещей](./media/quickstart/register-device.png)

Создайте удостоверение для своего имитированного устройства, чтобы оно могло обмениваться данными с Центром Интернета вещей. Удостоверение устройства находится в облаке. Чтобы связать физическое устройство с удостоверением, нужно использовать уникальную строку подключения к устройству.

Так как поведение и управление устройств IoT Edge и обычных устройств Интернета вещей отличаются, укажите в удостоверении, что это устройство IoT Edge, с помощью флага `--edge-enabled`.

1. Чтобы создать устройство с именем **myEdgeDevice** в своем центре, введите следующую команду в Azure Cloud Shell.

   ```azurecli-interactive
   az iot hub device-identity create --device-id myEdgeDevice --edge-enabled --hub-name {hub_name}
   ```

   Если отобразится сообщение об ошибке при использовании ключей политики iothubowner, убедитесь, что в Cloud Shell установлена последняя версия расширения azure-iot.

2. Просмотрите строку подключения для устройства, которая связывает физическое устройство с его удостоверением в Центре Интернета вещей. Она содержит имя центра Интернета вещей и имя устройства, а также общий ключ, который используется для аутентификации подключений между ними.

   ```azurecli-interactive
   az iot hub device-identity connection-string show --device-id myEdgeDevice --hub-name {hub_name}
   ```

3. Скопируйте значение ключа `connectionString` из выходных данных JSON и сохраните его. Это значение — строка подключения устройства. Эта строка потребуется для настройки среды выполнения IoT Edge в следующем разделе.

   ![Получение строки подключения из выходных данных интерфейса командной строки](./media/quickstart/retrieve-connection-string.png)

## <a name="install-and-start-the-iot-edge-runtime"></a>Установка и запуск среды выполнения IoT Edge

Установите IoT Edge для Linux в Windows на своем устройстве и настройте эту службу, используя строку подключения устройства.

![Схема запуска среды выполнения IoT Edge на устройстве](./media/quickstart/start-runtime.png)

1. [Скачайте Windows Admin Center.](https://aka.ms/WACDownloadEFLOW)

1. Следуйте указаниям мастера установки, чтобы настроить Windows Admin Center на устройстве.

1. В Windows Admin Center в правом верхнем углу экрана щелкните **значок шестеренки (значок параметров)** .

1. В меню "Параметры" в разделе "Шлюз" выберите **Расширения**.

1. Перейдите на вкладку **Веб-каналы** и выберите **Добавить**.

1. Введите https://aka.ms/wac-insiders-feed в текстовое поле и выберите **Добавить**.

1. После добавления веб-канала перейдите на вкладку **Доступные расширения**. Обновление списка расширений может занять некоторое время.

1. В списке **Доступные расширения** выберите **Azure IoT Edge**.

1. **Установите** расширение.

1. Установив расширение, перейдите на главную страницу панели мониторинга, выбрав **Windows Admin Center** в верхнем левом углу экрана.

1. Вы увидите подключение к локальному узлу, представляющем компьютер, где выполняется Windows Admin Center.

   :::image type="content" source="media/quickstart/windows-admin-center-start-page.png" alt-text="Снимок экрана: начальная страница Windows Admin Center":::

1. Выберите **Добавить**.

   :::image type="content" source="media/quickstart/windows-admin-center-start-page-add.png" alt-text="Снимок экрана: кнопка &quot;Добавить&quot; на начальной странице Windows Admin Center":::

1. Перейдите на плитку Azure IoT Edge и выберите **Создать**. Будет запущен мастер установки.

    :::image type="content" source="media/quickstart/select-tile-screen.png" alt-text="Снимок экрана: плитка Azure IoT Edge для Linux в Windows":::

1. Следуйте указаниям мастера установки, чтобы принять условия лицензионного соглашения, и нажмите **Далее**.

    :::image type="content" source="media/quickstart/wizard-welcome-screen.png" alt-text="Снимок экрана: начальный экран мастера":::

1. Выберите **Необязательные данные диагностики**, чтобы предоставлять расширенные данные диагностики, которые помогают Майкрософт отслеживать и поддерживать уровень обслуживания, а затем щелкните **Далее: развернуть**.

    :::image type="content" source="media/quickstart/diagnostic-data-screen.png" alt-text="Снимок экрана: данные диагностики":::

1. На экране **Выбор целевого устройства** выберите нужное целевое устройство, чтобы проверить его соответствие минимальным требованиям. С помощью этого краткого руководства мы установим IoT Edge на локальном устройстве, поэтому выберите подключение localhost. После подтверждения выберите **Далее**, чтобы продолжить.

    :::image type="content" source="media/quickstart/wizard-select-target-device-screen.png" alt-text="Снимок экрана: выбор целевого устройства":::

1. Примите параметры по умолчанию, нажав кнопку **Далее**.

1. На экране развертывания можно отслеживать процесс скачивания и установки пакета, настройки узла и окончательной настройки виртуальной машины Linux.  Успешное развертывание будет выглядеть, как показано ниже.

    :::image type="content" source="media/quickstart/wizard-deploy-success-screen.png" alt-text="Снимок экрана: успешное развертывание с помощью мастера":::

1. Щелкните **Далее: подключиться**, чтобы перейти к последнему шагу по подготовке устройства Azure IoT Edge с использованием идентификатора устройства, полученного в вашем экземпляре центра Интернета вещей.

1. Скопируйте строку подключения для устройства в Центре Интернета вещей Azure и вставьте ее в поле для строки подключения устройства. Затем выберите **Подготовить с помощью выбранного метода**.

    > [!NOTE]
    > Чтобы получить строку подключения, см. шаг 3 в предыдущем разделе [Регистрация устройства IoT Edge](#register-an-iot-edge-device).

    :::image type="content" source="media/quickstart/wizard-provision.png" alt-text="Снимок экрана: подготовка с помощью мастера":::

1. После завершения подготовки выберите **Готово**, чтобы завершить работу и вернуться на начальный экран Windows Admin Center. Теперь устройство должно отображаться в списке как устройство IoT Edge.

    :::image type="content" source="media/quickstart/windows-admin-center-device-screen.png" alt-text="Снимок экрана: устройство Azure IoT Edge в Windows Admin Center":::

1. Выберите свое устройство Azure IoT Edge, чтобы просмотреть его панель мониторинга. Вы должны увидеть, что рабочие нагрузки с устройства двойника в Центре Интернета вещей Azure уже развернуты. В **списке модулей IoT Edge** должен отображаться один запущенный модуль (**edgeAgent**), а в строке **Состояние IoT Edge** должно отображаться значение **Активно (работает)** .

Теперь устройство IoT Edge настроено. Оно готово для запуска модулей, развернутых в облаке.

## <a name="deploy-a-module"></a>Развертывание модуля

Управляя устройством Azure IoT Edge из облака, разверните модуль, который будет передавать данные телеметрии в Центр Интернета вещей.

![Схема: развертывание модуля из облака на устройство](./media/quickstart/deploy-module.png)

[!INCLUDE [iot-edge-deploy-module](../../includes/iot-edge-deploy-module.md)]

## <a name="view-generated-data"></a>Просмотр сформированных данных

В этом руководстве мы создали новое устройство IoT Edge и установили на нем среду выполнения IoT Edge. Затем с помощью портала Azure мы развернули модуль IoT Edge на устройстве, обеспечив возможность запуска без необходимости менять настройки на устройстве.

В этом примере отправленный модуль создает примеры данных среды, которые можно использовать для последующего тестирования. Имитируемый датчик выполняет мониторинг оборудования и окружающей среды. Например, этот датчик может быть в серверной комнате, производственном цехе или ветроэлектрической установке. В сообщении отображаются данные о температуре и влажности окружающей среды, температуре и давлении оборудования, а также метка времени. При работе с руководствами по IoT Edge используйте данные, созданные этим модулем, как тестовые данные для аналитики.

Убедитесь, что модуль, развернутый из облака, выполняется на устройстве IoT Edge, перейдя в командную оболочку в Windows Admin Center.

1. Подключение к созданному устройству IoT Edge

   :::image type="content" source="media/quickstart/connect-edge-screen.png" alt-text="Снимок экрана: подключение устройства":::

2. На странице **Общие сведения** вы увидите **список модулей IoT Edge** и **данные о состоянии IoT Edge**, чтобы вы могли просмотреть развернутые модули, а также состояние устройства.  

3. В разделе **Сервис** выберите **Командная оболочка**. Командная оболочка — это терминал PowerShell, который автоматически использует SSH (Secure Shell) для подключения к виртуальной машине Linux устройства Azure IoT Edge на компьютере с Windows.

   :::image type="content" source="media/quickstart/command-shell-screen.png" alt-text="Снимок экрана: командная оболочка":::

4. Чтобы проверить три модуля на устройстве, выполните следующую **команду Bash**:

   ```bash
   sudo iotedge list
   ```

   :::image type="content" source="media/quickstart/iotedge-list-screen.png" alt-text="Снимок экрана: список в командной оболочке":::

5. Убедитесь, что сообщения отправляются с модуля датчика температуры в облако.

   ```bash
   iotedge logs SimulatedTemperatureSensor -f
   ```

   >[!TIP]
   >В командах IoT Edge при использовании имен модулей учитывается регистр.

   :::image type="content" source="media/quickstart/temperature-sensor-screen.png" alt-text="Снимок экрана: датчик температуры":::

Вы также можете просматривать сообщения, которые поступают в Центр Интернета вещей, используя [расширение Центра Интернета вещей Azure для Visual Studio Code](https://marketplace.visualstudio.com/items?itemName=vsciot-vscode.azure-iot-toolkit).

## <a name="clean-up-resources"></a>Очистка ресурсов

Если вы хотите продолжить ознакомление с руководствами по IoT Edge, используйте устройство, зарегистрированное и настроенное в рамках этого краткого руководства. Если нет, вы можете удалить созданные ресурсы Azure, чтобы избежать расходов.

Если вы создали виртуальную машину и Центр Интернета вещей в новой группе ресурсов, можно удалить эту группу и все связанные с ней ресурсы. Внимательно проверьте содержимое группы ресурсов. В ней не должно быть важных ресурсов. Если вы не хотите удалять всю группу, можно удалить отдельные ресурсы.

> [!IMPORTANT]
> Удаление группы ресурсов — процесс необратимый.

Удалите группу **IoTEdgeResources**. Удаление группы ресурсов может занять несколько минут.

```azurecli-interactive
az group delete --name IoTEdgeResources
```

Чтобы проверить, удалена ли группа ресурсов, просмотрите список групп ресурсов.

```azurecli-interactive
az group list
```

### <a name="clean-removal-of-azure-iot-edge-for-linux-on-windows"></a>Полное удаление Azure IoT Edge для Linux в Windows

Вы можете удалить Azure IoT Edge для Linux в Windows с устройства IoT Edge с помощью расширения панели мониторинга в Windows Admin Center.

1. Выберите подключение к устройству с Azure IoT Edge для Linux в Windows в Windows Admin Center. Загрузится расширение средств панели мониторинга Azure.
2. Выберите **Удалить**. После удаления Azure IoT Edge для Linux в Windows отобразится начальная страница Windows Admin Center, а запись подключения устройства Azure IoT Edge будет удалена из списка.

Чтобы воспользоваться другим способом удаления Azure IoT Edge из системы Windows, выберите **Пуск** > **Параметры** > **Приложения** > **Azure IoT Edge** > **Удалить** на своем устройстве IoT Edge. Это приведет к удалению Azure IoT Edge с устройства IoT Edge, но подключение при этом будет сохранено в Windows Admin Center. Windows Admin Center также можно удалить из меню "Параметры".

## <a name="next-steps"></a>Дальнейшие действия

При работе с этим кратким руководством вы создали устройство IoT Edge и с помощью облачного интерфейса Azure IoT Edge развернули код на устройстве. В итоге вы получили устройство для тестирования, генерирующее необработанные данные о своей среде.

Далее вы можете настроить локальную среду разработки, чтобы приступить к созданию модулей IoT Edge, которые выполняют бизнес-логику.

> [!div class="nextstepaction"]
> [Разработка модулей IoT Edge](tutorial-develop-for-linux.md)
