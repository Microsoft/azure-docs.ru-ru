---
title: Учебник по разработке модулей для устройств Windows с помощью Azure IoT Edge
description: В этом учебнике описано, как настроить компьютер и облачные ресурсы для разработки модулей IoT Edge с использованием контейнеров Windows для устройств с Windows.
author: kgremban
manager: philmea
ms.author: kgremban
ms.date: 07/30/2020
ms.topic: tutorial
ms.service: iot-edge
services: iot-edge
ms.custom: mvc
monikerRange: =iotedge-2018-06
ms.openlocfilehash: a2d8a215dfc34073783a5d8a6233ec8dbae4ec17
ms.sourcegitcommit: 3f684a803cd0ccd6f0fb1b87744644a45ace750d
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/02/2021
ms.locfileid: "106218878"
---
# <a name="tutorial-develop-iot-edge-modules-using-windows-containers"></a>Руководство. Разработка модулей IoT Edge с использованием контейнеров Windows

[!INCLUDE [iot-edge-version-201806](../../includes/iot-edge-version-201806.md)]

Узнайте, как разработать и развернуть код на устройствах Windows с IoT Edge с помощью Visual Studio.

>[!NOTE]
>IoT Edge 1.1 LTS — это последний канал выпусков, который поддерживает контейнеры Windows. Начиная с версии 1.2, контейнеры Windows не поддерживаются. Мы рекомендуем вам использовать [IoT Edge для Linux в Windows](iot-edge-for-linux-on-windows.md) для выполнения IoT Edge на устройствах Windows.

В этом учебнике описано, что нужно для разработки и развертывания собственного кода на устройстве IoT Edge. Было бы полезно сперва ознакомиться с этим руководством, прежде чем изучать другие, в которых подробнее рассматриваются отдельные языки программирования или службы Azure.

В этом учебнике используется пример развертывания модуля **C# на устройстве Windows**. Этот пример выбран, так как он является наиболее распространенным сценарием разработки. Если вы заинтересованы в разработке на другом языке или планируете развертывание служб Azure в качестве модулей, все равно будет полезно ознакомиться с инструментами разработки в этом учебнике. Как только вы поймете принципы разработки, вы сможете выбрать предпочитаемый язык или службу Azure, чтобы ознакомиться с подробностями.

В этом руководстве описано следующее:

> [!div class="checklist"]
>
> * Настройка компьютера для разработки.
> * Создание проекта с помощью средств IoT Edge для Visual Studio.
> * Создание проекта как контейнера и его сохранение в реестре контейнеров Azure.
> * Развертывание кода на устройстве IoT Edge.

## <a name="prerequisites"></a>Предварительные требования

Компьютер для разработки:

* Windows 10 с обновлением 1809 или новее.
* При разработке можно использовать собственный компьютер или виртуальную машину в зависимости от ваших предпочтений.
  * Убедитесь, что компьютер для разработки поддерживает вложенную виртуализацию. Эта возможность необходима для запуска подсистемы контейнеров, установка которой описывается в следующем разделе.
* Установите [Git](https://git-scm.com/).

Устройство Azure IoT Edge на платформе Windows.

* [Установка и администрирование Azure IoT Edge с использованием контейнеров Windows.](how-to-install-iot-edge-windows-on-windows.md)
* Мы не рекомендуем выполнять IoT Edge на компьютере разработки. Вместо этого следует использовать другое устройство, если это возможно. Это различие между компьютером для разработки и устройством IoT Edge точнее отражает реальный сценарий развертывания и поможет не путать различные понятия.

Облачные ресурсы.

* [Центр Интернета вещей](../iot-hub/iot-hub-create-through-portal.md) ценовой категории "Бесплатный" или "Стандартный" в Azure.

[!INCLUDE [quickstarts-free-trial-note](../../includes/quickstarts-free-trial-note.md)]

## <a name="key-concepts"></a>Основные понятия

В этом учебнике рассказывается о разработке модуля IoT Edge. *Модуль IoT Edge*, а иногда просто *модуль*, является контейнером, который содержит исполняемый код. На устройстве IoT Edge можно развернуть один или несколько модулей. Модули выполняют определенные задачи, такие как прием данных с датчиков, выполнение анализа данных или операции очистки данных или отправки сообщений в центр Интернета вещей. Дополнительные сведения см. в статье [Understand Azure IoT Edge modules](iot-edge-modules.md) (Общие сведения о модулях Azure IoT Edge).

При разработке модулей IoT Edge важно понимать разницу между компьютером для разработки и целевым устройством IoT Edge, где в конечном итоге будет развернут модуль. Контейнер, созданный для хранения кода модуля, должен соответствовать операционной системе (ОС) *целевого устройства*. Для разработки контейнера Windows такой подход проще, так как контейнеры Windows запускаются только на операционных системах Windows. Но вы можете, например, использовать компьютер для разработки Windows, чтобы создать модули для устройств IoT Edge с Linux. В таком случае вам нужно было бы убедиться, что на компьютере для разработки запущены контейнеры Linux. При прохождении данного учебника помните о разнице между *ОС компьютера разработки* и *ОС контейнера*.

Этот учебник предназначен для устройств с Windows с IoT Edge. Устройства Windows IoT Edge используют контейнеры Windows. Для разработки решений для устройств с Windows мы рекомендуем использовать Visual Studio. Вы также можете использовать Visual Studio Code, хотя между этими двумя средствами есть различия в поддержке.

В следующей таблице перечислены поддерживаемые сценарии разработки **контейнеров Windows** в Visual Studio Code и Visual Studio.

|   | Visual Studio Code | Visual Studio 2017 или 2019 |
| - | ------------------ | ------------------ |
| **Службы Azure**; | Функции Azure <br> Azure Stream Analytics |   |
| **Языки** | C# (отладка не поддерживается) | C <br> C# |
| **Дополнительные сведения** | [Azure IoT Edge для Visual Studio Code](https://marketplace.visualstudio.com/items?itemName=vsciot-vscode.azure-iot-edge) | [Средства Azure IoT Edge для Visual Studio 2017](https://marketplace.visualstudio.com/items?itemName=vsc-iot.vsiotedgetools)<br>[Средства Azure IoT Edge для Visual Studio 2019](https://marketplace.visualstudio.com/items?itemName=vsc-iot.vs16iotedgetools) |

## <a name="install-container-engine"></a>Установка платформы контейнеров

Модули IoT Edge упакованы в виде контейнеров, поэтому для создания контейнеров и управления ими на компьютере разработки необходима платформа контейнеров. Для разработки приложений советуем использовать Docker Desktop из-за его обширного функционала и популярности в качестве платформы контейнеров. С помощью Docker Desktop на компьютере с Windows можно переключаться между контейнерами Linux и контейнерами Windows, чтобы с легкостью разрабатывать модули для различных типов устройств IoT Edge.

Чтобы выполнить установку на компьютере разработки, используйте документацию по Docker:

* [Установка Docker Desktop для Windows](https://docs.docker.com/docker-for-windows/install/)

  * При установке Docker Desktop для Windows вы увидите запрос на использование контейнеров Linux или Windows. Для этого учебника используйте **контейнеры Windows**. Дополнительные сведения см. в документации по Docker [о переключении между контейнерами Windows и Linux](https://docs.docker.com/docker-for-windows/#switch-between-windows-and-linux-containers).

## <a name="set-up-visual-studio-and-tools"></a>Настройка Visual Studio и инструментов

При разработке модулей IoT Edge вам помогут расширения Интернета вещей для Visual Studio. Эти расширения предоставляют шаблоны проектов, автоматизируют создание манифеста развертывания и позволяют отслеживать устройства IoT Edge и управлять ими. В этом разделе вы установите Visual Studio и расширения IoT Edge, а затем настроите учетную запись Azure для управления ресурсами Центра Интернета вещей в Visual Studio.

В этом руководстве описаны этапы разработки в Visual Studio 2019. Если вы используете Visual Studio 2017 (версии не ниже 15.7), то шаги будут похожи. Дополнительные сведения см. в статье [Use Visual Studio Code to develop and debug modules for Azure IoT Edge (Preview)](how-to-vs-code-develop-module.md) (Разработка и отладка модулей для Azure IoT Edge (предварительная версия) с помощью Visual Studio Code).

1. Подготовьте Visual Studio 2019 на компьютере для разработки.

   * Если у вас еще нет Visual Studio на компьютере для разработки, [установите Visual Studio 2019](/visualstudio/install/install-visual-studio) со следующими рабочими нагрузками:

      * Разработка Azure.
      * разработка классических приложений на C++;
      * Кроссплатформенная разработка .NET Core.

   * Если у вас уже есть Visual Studio 2019 на компьютере для разработки, выполните шаги, приведенные в статье [Изменение Visual Studio путем добавления или удаления рабочих нагрузок и компонентов](/visualstudio/install/modify-visual-studio), чтобы добавить требуемые рабочие нагрузки.

2. Скачайте и установите расширение [Средства Azure IoT Edge](https://marketplace.visualstudio.com/items?itemName=vsc-iot.vs16iotedgetools) для Visual Studio 2019.

   Если вы используете Visual Studio 2017 (версии не ниже 15.7), скачайте и установите [средства Azure IoT Edge для Visual Studio 2017](https://marketplace.visualstudio.com/items?itemName=vsc-iot.vsiotedgetools).

3. После установки откройте Visual Studio 2019 и выберите **Продолжить без кода**.

4. Выберите **Представление** > **Cloud Explorer**.

5. В Cloud Explorer выберите значок профиля и войдите в учетную запись Azure, если вы еще не вошли.

6. После входа будут перечислены ваши подписки Azure. Разверните подписку, которая содержит центр Интернета вещей.

7. В подписке разверните **Центры Интернета вещей** и свой центр Интернета вещей. Вы должны увидеть список устройств Интернета вещей и сможете использовать этот обозреватель, чтобы управлять ими.

   ![Доступ к ресурсам Центра Интернета вещей в Cloud Explorer](./media/tutorial-develop-for-windows/cloud-explorer-view-hub.png)

[!INCLUDE [iot-edge-create-container-registry](../../includes/iot-edge-create-container-registry.md)]

## <a name="create-a-new-module-project"></a>Создание проекта модуля

Расширение "Средства Azure IoT Edge" предоставляет шаблоны проектов для всех поддерживаемых языков модулей IoT Edge в Visual Studio. Эти шаблоны содержат все файлы и код, необходимые для развертывания рабочего модуля для тестирования IoT Edge, а также станут отправной точкой для настройки шаблона в соответствии с вашей бизнес-логикой.

1. Выберите **Файл** > **Создать** > **Проект**.

2. В окне нового проекта найдите проект **IoT Edge** и выберите для него тип **Azure IoT Edge (Windows amd64)** . Щелкните **Далее**.

   ![Создание проекта Azure IoT Edge](./media/tutorial-develop-for-windows/new-project.png)

3. В окне настроек проекта присвойте проекту и решению описательное имя, например **CSharpTutorialApp**. Щелкните **Создать**, чтобы создать проект.

   ![Настройка нового проекта Azure IoT Edge](./media/tutorial-develop-for-windows/configure-project.png)

4. В окне добавления модуля настройте проект, указав следующие значения:

   | Поле | Значение |
   | ----- | ----- |
   | Шаблон Visual Studio | Выберите **Модуль C#** . |
   | Имя модуля | Примите значение по умолчанию **IotEdgeModule1**. |
   | URL-адрес репозитория | Репозиторий изображений включает в себя имя реестра контейнеров и имя образа контейнера. Образ контейнера предварительно заполняется значением имени проекта модуля. Замените **localhost:5000** значением **сервера входа** из реестра контейнеров Azure. Вы можете узнать сервер входа на странице "Обзор" реестра контейнеров на портале Azure. <br><br> Окончательный вариант репозитория образов выглядит так: \<registry name\>.azurecr.io/iotedgemodule1. |

      ![Настройка целевого устройства, типа модуля и реестра контейнеров для проекта](./media/tutorial-develop-for-windows/add-module-to-solution.png)

5. Чтобы создать модуль, выберите **Добавить**.

Как только ваш новый проект загрузится в окне Visual Studio, ознакомьтесь с файлами, которые он создал:

* Проект IoT Edge называется **CSharpTutorialApp**.
  * Папка **Модули** содержит указатели к модулям, включенным в проект. В данном случае это должен быть просто IotEdgeModule1.
  * В скрытом **ENV**-файле хранятся учетные данные реестра контейнеров. Эти учетные данные совместно используются с вашим устройством IoT Edge, чтобы оно имело доступ для извлечения образов контейнеров.
  * Файл **deployment.template.json** представляет собой шаблон для создания манифеста развертывания. *Манифест развертывания* — это файл, который точно определяет, какие модули вы хотите развернуть на устройстве, как они должны быть настроены и как они могут взаимодействовать друг с другом и облаком.
    > [!TIP]
    > В разделе учетных данных реестра адрес автоматически заполняется на основе сведений, предоставленных вами при создании решения. Однако имя пользователя и пароль ссылаются на переменные, хранящиеся в ENV-файле. Это делается для безопасности, так как ENV-файл игнорируется, а шаблон развертывания — нет.
* Проект модуля IoT Edge с именем **IotEdgeModule1**.
  * Файл **program.cs** содержит код модуля C# по умолчанию, который поставляется с шаблоном проекта. Модуль по умолчанию принимает входные данные из источника и передает их в Центр Интернета вещей.
  * Файл **module.json** содержит сведения о модуле, включая полный репозиторий образа, версию образа и Dockerfile, который следует использовать для каждой поддерживаемой платформы.

### <a name="provide-your-registry-credentials-to-the-iot-edge-agent"></a>Предоставление учетных данных реестра агенту IoT Edge

Среде выполнения IoT Edge нужны учетные данные реестра, чтобы извлечь образы контейнеров на устройство IoT Edge. Расширение IoT Edge пытается извлечь сведения реестра контейнеров из Azure и заполнить их в шаблоне развертывания.

1. Откройте файл **deployment.template.json** в модуле решения.

1. Найдите свойство **registryCredentials** в требуемых свойствах $edgeAgent. Адрес реестра должен автоматически заполняться данными, предоставленными при создании проекта, а поля имени пользователя и пароля должны содержать имена переменных. Пример:

   ```json
   "registryCredentials": {
     "<registry name>": {
       "username": "$CONTAINER_REGISTRY_USERNAME_<registry name>",
       "password": "$CONTAINER_REGISTRY_PASSWORD_<registry name>",
       "address": "<registry name>.azurecr.io"
     }
   }
   ```

1. Откройте **ENV**-файл в модуле решения. (Он скрыт по умолчанию в обозревателе решений. Чтобы отобразить его, следует нажать кнопку **Показать все файлы**.)

1. Добавьте значения **имени пользователя** и **пароля**, скопированные из своего реестра контейнера Azure.

1. Сохраните изменения в ENV-файле.

### <a name="review-the-sample-code"></a>Просмотр примера кода

Созданный вами шаблон решения включает в себя пример кода для модуля IoT Edge. Этот пример модуля просто принимает сообщения, а затем передает их. Функциональность конвейера демонстрирует важную концепцию в IoT Edge, которая заключается в том, как модули взаимодействуют друг с другом.

Каждый модуль может содержать несколько очередей *ввода* и *вывода*, объявленных в своем коде. Центр IoT Edge, работающий на устройстве, направляет сообщения из ввода одного модуля в вывод одного или нескольких модулей. Конкретный код для объявления входных и выходных данных варьируется в зависимости от языка, но принцип одинаков для всех модулей. Дополнительные сведения о маршрутизации между модулями см. в разделе [Объявление маршрутов](module-composition.md#declare-routes).

В примере кода C#, который поставляется с шаблоном проекта, используется [класс ModuleClient](/dotnet/api/microsoft.azure.devices.client.moduleclient) из пакета SDK для Центра Интернета вещей для .NET.

1. В файле **program.cs** найдите метод **SetInputMessageHandlerAsync**.

2. Метод [SetInputMessageHandlerAsync](/dotnet/api/microsoft.azure.devices.client.moduleclient.setinputmessagehandlerasync) настраивает очередь ввода для получения входящих сообщений. Проверьте этот метод на инициализацию очереди ввода с названием **input1**.

   ![Поиск входного имени в конструкторе SetInputMessageHandlserAsync](./media/tutorial-develop-for-windows/declare-input-queue.png)

3. Затем найдите метод **SendEventAsync**.

4. Метод [SendEventAsync](/dotnet/api/microsoft.azure.devices.client.moduleclient.sendeventasync) обрабатывает полученные сообщения и настраивает очередь вывода, чтобы передать их вместе. Проверьте этот метод на инициализацию очереди вывода с названием **output1**.

   ![Поиск выходного имени в конструкторе SendEventAsync](./media/tutorial-develop-for-windows/declare-output-queue.png)

5. Откройте файл **deployment.template.json**.

6. Найдите свойство **modules** для требуемых свойств $edgeAgent.

   Здесь должно быть два модуля. Первый — это модуль **SimulatedTemperatureSensor**, по умолчанию включенный во все шаблоны, чтобы предоставить имитированные данные о температуре, которые вы можете использовать для тестирования своих модулей. Второй — модуль **IotEdgeModule1**, который вы создали как часть этого проекта.

   Это свойство модуля определяет, какие модули следует включить в развертывание на вашем устройстве или устройствах.

7. Найдите свойство **routes** для требуемых свойств $edgeHub.

   Одной из функций модуля центра IoT Edge является маршрутизация сообщений между всеми модулями в развертывании. Просмотрите значения в свойстве routes. Первый маршрут, **IotEdgeModule1ToIoTHub**, использует подстановочный знак (* *\** _) для включения любых сообщений, поступающих из любых выходных очередей в модуле IotEdgeModule1. Эти сообщения поступают в _$upstream*, зарезервированное имя, которое указывает на Центр Интернета вещей. Второй маршрут, **sensorToIotEdgeModule1**, принимает сообщения, поступающие из модуля SimulatedTemperatureSensor, и направляет их в очередь ввода *input1* модуля IotEdgeModule1.

   ![Просмотр маршрутов в deployment.template.json](./media/tutorial-develop-for-windows/deployment-routes.png)

## <a name="build-and-push-your-solution"></a>Сборка и отправка решения

Вы рассмотрели код модуля и шаблон развертывания, чтобы понять некоторые ключевые концепции развертывания. Теперь необходимо создать образ контейнера IotEdgeModule1 и передать его в реестр контейнеров. С помощью расширения средств Интернета вещей для Visual Studio этот шаг также создает манифест развертывания на основе информации в файле шаблона и информации о модуле из файлов решения.

### <a name="sign-in-to-docker"></a>Вход в Docker

Предоставьте свои учетные данные реестра контейнеров в Docker компьютеру для разработки, чтобы он мог передать образ контейнера для хранения в реестре.

1. Откройте командную строку или PowerShell.

2. Войдите в Docker с помощью учетных данных реестра контейнеров Azure, которые вы сохранили после создания реестра.

   ```cmd
   docker login -u <ACR username> -p <ACR password> <ACR login server>
   ```

   Возможно, появится предупреждение системы безопасности, в котором рекомендуется использовать `--password-stdin`. Для рабочих сценариев это лучшая методика, но мы не будем рассматривать ее в этом учебнике. Дополнительные сведения см. в описании команды [docker login](https://docs.docker.com/engine/reference/commandline/login/#provide-a-password-using-stdin) в справочнике.

### <a name="build-and-push"></a>Создание и отправка

Компьютер для разработки и устройства IoT Edge теперь имеют доступ к реестру контейнеров. Пришло время превратить код проекта в образ контейнера.

1. Щелкните правой кнопкой мыши папку проекта **CSharpTutorialApp** и выберите **Build and Push IoT Edge Modules** (Создание и отправка модулей IoT Edge).

   ![Создание и отправка модулей IoT Edge](./media/tutorial-develop-for-windows/build-and-push-modules.png)

   Эта команда сборки и отправки позволяет запустить три операции. Во-первых,в решении создается папка с именем **config**, которая содержит полный манифест развертывания на основе информации из шаблона развертывания и других файлов решения. Во-вторых, выполняется `docker build` для сборки образа контейнера на основе подходящего файла dockerfile для целевой архитектуры. В-третьих, выполняется `docker push` для отправки образа в реестр контейнеров.

   В первый раз выполнение этого процесса может занять несколько минут, но при следующем запуске команд он будет быстрее.

2. Откройте файл **deployment.windows-amd64.json** в созданной папке config. (Папка config может не отображаться в обозревателе решений в Visual Studio. Если это так, выберите значок **Показать все файлы** на панели задач обозревателя решений.)

3. Найдите параметр **image** в разделе IotEdgeModule1. Обратите внимание, что образ содержит полный репозиторий образов с именем, версией и тегом архитектуры из модуля файла module.json.

4. Откройте файл **module.json** в папке IotEdgeModule1.

5. Измените номер версии для образа модуля. (Это не версия $schema). Например, увеличьте номер версии исправления до **0.0.2**, как будто мы сделали небольшое исправление в коде модуля.

   >[!TIP]
   >Версии модулей обеспечивают управление версиями и позволяют тестировать изменения на небольшом наборе устройств, прежде чем развертывать обновления в рабочей среде. Если перед построением и принудительной отправкой вы не увеличите версию модуля, перезапишите репозиторий в реестре контейнеров.

6. Сохраните изменения в файле module.json.

7. Щелкните опять правой кнопкой мыши папку проекта **CSharpTutorialApp** и снова выберите **Build and Push IoT Edge modules** (Создание и отправка модулей IoT Edge).

8. Снова откройте файл **deployment.windows-amd64.json**. Обратите внимание, что при повторном выполнении команды сборки и отправки новый файл не был создан. Вместо этого, чтобы отразить изменения, был обновлен тот же файл. Образ IotEdgeModule1 теперь указывает на контейнер версии 0.0.2. Это изменение в манифесте развертывания заключается в том, как вы сообщаете устройству IoT Edge, что есть новая версия модуля для извлечения.

9. Чтобы дополнительно проверить, что сделала команда создания и отправки, откройте [портал Azure](https://portal.azure.com) и перейдите к своему реестру контейнеров.

10. В реестре контейнеров щелкните **Репозитории**, а затем выберите **iotedgemodule1**. Убедитесь, что обе версии образа отправлены в реестр.

    ![Просмотр обеих версий образа в реестре контейнеров](./media/tutorial-develop-for-windows/view-repository-versions.png)

### <a name="troubleshoot"></a>Диагностика

Если вы сталкиваетесь с ошибками при создании и отправке образа вашего модуля, это часто связано с настройкой Docker на вашем компьютере для разработки. Чтобы просмотреть конфигурацию, выполните следующие проверки:

* Вы выполнили команду `docker login`, используя учетные данные, скопированные из реестра контейнеров? Эти учетные данные отличаются от тех, которые вы используете для входа на портал Azure.
* Правильно ли указан репозиторий контейнеров? У вас есть правильное имя реестра контейнеров и правильное имя модуля? Чтобы проверить, откройте файл **module.json** в папке IotEdgeModule1. Значение репозитория должно выглядеть так: **\<registry name\>.azurecr.io/iotedgemodule1**.
* Если вы использовали другое имя, отличное от **IotEdgeModule1**, для вашего модуля, согласовано ли оно во всем решении?
* Ваш компьютер использует тот же тип контейнеров, который вы создаете? Этот учебник предназначен для устройств Windows IoT Edge, поэтому файлы Visual Studio должны иметь расширение **windows-amd64**, а Docker Desktop должен работать с контейнерами Windows.

## <a name="deploy-modules-to-device"></a>Развертывание модулей на устройстве

Вы убедились, что образы встроенных контейнеров хранятся в реестре контейнеров, поэтому пришло время развернуть их на устройстве. Убедитесь, что устройство IoT Edge работает.

1. Откройте Cloud Explorer в Visual Studio и разверните сведения для центра Интернета вещей.

2. Выберите имя устройства, которое необходимо развернуть. В списке **Действия** выберите **Создать развертывание**.

   ![Создание развертывания для одного устройства](./media/tutorial-develop-for-windows/create-deployment.png)

3. В проводнике перейдите в папку ​​config проекта и выберите файл **deployment.windows-amd64.json**. Этот файл всегда находится здесь: `C:\Users\<username>\source\repos\CSharpTutorialApp\CSharpTutorialApp\config\deployment.windows-amd64.json`

   Не используйте файл deployment.template.json, в котором нет полных значений образа модуля.

4. Разверните сведения для устройства IoT Edge в Cloud Explorer, чтобы просмотреть модули на устройстве.

5. С помощью кнопки **Обновить** обновите состояние устройства, чтобы увидеть, что модули SimulatedTemperatureSensor и IotEdgeModule1 развернуты на устройстве.

   ![Просмотр данных о модулях, запущенных на устройстве IoT Edge](./media/tutorial-develop-for-windows/view-running-modules.png)

## <a name="view-messages-from-device"></a>Просмотр сообщений с устройства

Код IotEdgeModule1 получает сообщения через свою очередь входящих сообщений и передает их через свою очередь выходящих сообщений. В манифесте развертывания объявлены маршруты, которые передают сообщения из SimulatedTemperatureSensor в IotEdgeModule1, а затем пересылают сообщения из IotEdgeModule1 в Центр Интернета вещей. Средства Azure IoT Edge для Visual Studio позволяют просматривать сообщения по мере их поступления в Центр Интернета вещей с ваших отдельных устройств.

1. В Visual Studio Cloud Explorer выберите имя устройства IoT Edge, на котором выполнено развертывание.

2. В меню **Действия** выберите **Начать мониторинг встроенной конечной точки событий**.

3. Посмотрите в раздел **Вывод** в Visual Studio, чтобы увидеть сообщения, поступающие в центр Интернета вещей.

   Модули могут запуститься через несколько минут. Среда выполнения IoT Edge должна получить новый манифест развертывания, извлечь образы модулей из среды выполнения контейнеров, а затем запустить каждый новый модуль.

   ![Просмотр входящих сообщений с устройств в облако](./media/tutorial-develop-for-windows/view-d2c-messages.png)

## <a name="view-changes-on-device"></a>Просмотр изменений на устройстве

Чтобы проверить среду выполнения IoT Edge и модули, работающие на вашем устройстве, используйте команды, приведенные в этом разделе.

Команды в этом разделе предназначены для устройства IoT Edge, а не для компьютера для разработки. Если вы используете виртуальную машину для устройства IoT Edge, подключитесь к ней сейчас. В Azure перейдите на страницу обзора виртуальной машины и щелкните **Подключить**, чтобы получить доступ к соединению удаленного рабочего стола. На устройстве откройте окно команды или PowerShell, чтобы запустить команды `iotedge`.

* Просмотрите все модули, развернутые на вашем устройстве, и проверьте их состояние:

   ```cmd
   iotedge list
   ```

   Вы увидите четыре модуля: два модуля среды выполнения IoT Edge, SimulatedTemperatureSensor и IotEdgeModule1. Все четыре должны быть указаны как работающие.

* Просмотрите журналы для определенного модуля:

   ```cmd
   iotedge logs <module name>
   ```

   Модули IoT Edge учитывают регистр.

   Журналы SimulatedTemperatureSensor и IotEdgeModule1 должны отображать сообщения, которые они обрабатывают. Модуль edgeAgent отвечает за запуск других модулей, поэтому его журналы будут содержать информацию о реализации манифеста развертывания. Если какой-либо модуль не указан или не запущен, возможно, в журналах edgeAgent возникли ошибки. Модуль edgeHub отвечает за обмен данными между модулями и Центром Интернета вещей. Если модули запущены и работают, но сообщения не поступают в ваш центр Интернета вещей, вероятно журналы edgeHub будут содержать ошибки.

## <a name="clean-up-resources"></a>Очистка ресурсов

Если вы планируете перейти к следующей рекомендуемой статье, можно сохранить созданные и повторно используемые ресурсы и конфигурации. Это же устройство IoT Edge также можно использовать в качестве тестового устройства.

В противном случае вы можете удалить локальные конфигурации и ресурсы Azure, созданные в рамках этой статьи, чтобы избежать расходов.

[!INCLUDE [iot-edge-clean-up-cloud-resources](../../includes/iot-edge-clean-up-cloud-resources.md)]

## <a name="next-steps"></a>Дальнейшие действия

В этом руководстве описано, как настроить Visual Studio 2019 на своем компьютере для разработки и развернуть свой первый модуль IoT Edge. Теперь, когда вы знаете основные понятия, попробуйте добавить функциональность в модуль, чтобы он мог анализировать данные, проходящие через него. Выберите предпочитаемый язык.

> [!div class="nextstepaction"]
> [C](tutorial-c-module-windows.md)
> [C#](tutorial-csharp-module-windows.md)