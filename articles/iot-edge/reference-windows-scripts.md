---
title: Скрипты для Azure IoT Edge с контейнерами Windows | Документация Майкрософт
description: Справочные сведения по сценариям IoT Edge PowerShell для установки, удаления или обновления на устройствах Windows
author: kgremban
manager: philmea
ms.author: kgremban
ms.date: 10/06/2020
ms.topic: reference
ms.service: iot-edge
services: iot-edge
ms.openlocfilehash: b7614f7ccd24d0237a043a9b5bf0ad988146d89c
ms.sourcegitcommit: d135e9a267fe26fbb5be98d2b5fd4327d355fe97
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/10/2021
ms.locfileid: "102615913"
---
# <a name="powershell-scripts-for-iot-edge-with-windows-containers"></a>Скрипты PowerShell для IoT Edge с контейнерами Windows

Ознакомьтесь с сценариями PowerShell, которые устанавливают, обновляют или удаляют IoT Edge на устройствах Windows.

Команды, описанные в этой статье, относятся к `IoTEdgeSecurityDaemon.ps1` файлу, который выпускается в каждом [выпуске IOT Edge](https://github.com/Azure/azure-iotedge/releases). Последняя версия скрипта всегда доступна по адресу aka.ms/iotedge-win.

`Invoke-WebRequest`Для доступа к последней версии скрипта можно выполнить любую команду с помощью командлета. Пример.

```powershell
. {Invoke-WebRequest -useb https://aka.ms/iotedge-win} | Invoke-Expression; `
Deploy-IoTEdge
```

Можно также скачать этот скрипт или версию скрипта из определенного выпуска для выполнения команд. Пример.

```powershell
. <path>\IoTEdgeSecurityDaemon.ps1
Deploy-IoTEdge
```

Предоставленный скрипт подписывается для повышения безопасности. Проверить подпись можно, загрузив сценарий на устройство, а затем выполнив следующую команду PowerShell:

```powershell
Get-AuthenticodeSignature "C:\<path>\IotEdgeSecurityDaemon.ps1"
```

Состояние вывода **допустимо** , если подпись проверена.

## <a name="deploy-iotedge"></a>Deploy-IoTEdge

Команда Deploy-IoTEdge скачивает и развертывает IoT Edge управляющую программу безопасности и ее зависимости. Команда развертывания принимает эти общие параметры, а также другие. Для полного списка используйте команду `Get-Help Deploy-IoTEdge -full` .  

| Параметр | Допустимые значения | Комментарии |
| --------- | --------------- | -------- |
| **ContainerOs** | **Windows** или **Linux** | Если не указана операционная система контейнера, значение по умолчанию — Windows.<br><br>Для контейнеров Windows IoT Edge использует подсистему контейнеров значок Кита, входящую в установку. Для контейнеров Linux необходимо установить подсистему контейнеров перед началом установки. |
| **Прокси** | URL-адрес прокси-сервера. | Включите этот параметр, если ваше устройство подключается к Интернету через прокси-сервер. Дополнительные сведения см. в статье [Настройка устройства IoT Edge для обмена данными через прокси-сервер](how-to-configure-proxy-support.md). |
| **OfflineInstallationPath** | Путь к каталогу. | Если этот параметр включен, установщик будет проверять указанный каталог на наличие файлов MSI для IoT Edge CAB и среды выполнения VC, необходимых для установки. Скачаны все файлы, не найденные в каталоге. Если оба файла находятся в каталоге, можно установить IoT Edge без подключения к Интернету. Этот параметр также можно использовать для использования определенной версии. |
| **InvokeWebRequestParameters** | Хэш-таблица параметров и значений. | Во время установки выполняется несколько веб-запросов. Используйте это поле, чтобы задать параметры для этих веб-запросов. Этот параметр нужен, чтобы настроить учетные данные для прокси-серверов. Дополнительные сведения см. в статье [Настройка устройства IoT Edge для обмена данными через прокси-сервер](how-to-configure-proxy-support.md). |
| **рестартифнидед** | нет | Этот флаг позволяет скрипту развертывания перезапускать компьютер без запроса при необходимости. |

## <a name="initialize-iotedge"></a>Initialize-IoTEdge

Команда Initialize-IoTEdge настраивает IoT Edge с помощью строки подключения устройства и сведений о работе. Большая часть информации, создаваемой этой командой, сохраняется в файле иотедже\конфиг.ямл. Команда инициализации принимает и другие общие параметры. Для полного списка используйте команду `Get-Help Initialize-IoTEdge -full` .

| Параметр | Допустимые значения | Комментарии |
| --------- | --------------- | -------- |
| **мануалконнектионстринг** | Нет | **Параметр Switch**. **Значение по умолчанию**. Если тип подготовки не указан, в качестве значения по умолчанию используется Ручная подготовка со строкой подключения.<br><br>Объявляет, что вы будете предоставлять строку подключения устройства для ручной инициализации устройства. |
| **ManualX509** | Нет | **Параметр Switch**. Если тип подготовки не указан, в качестве значения по умолчанию используется Ручная подготовка со строкой подключения.<br><br>Объявляет, что вы будете предоставлять сертификат удостоверения и закрытый ключ для самостоятельной инициализации устройства.
| **дпстпм** | Нет | **Параметр Switch**. Если тип подготовки не указан, в качестве значения по умолчанию используется Ручная подготовка со строкой подключения.<br><br>Объявляет, что вы предоставите идентификатор области службы подготовки устройств (DPS) и идентификатор регистрации устройства для подготовки через DPS.  |
| **дпссимметриккэй** | Нет | **Параметр Switch**. Если тип подготовки не указан, в качестве значения по умолчанию используется Ручная подготовка со строкой подключения.<br><br>Объявляет, что вы предоставляете идентификатор области службы подготовки устройств (DPS) и идентификатор регистрации устройства для подготовки через DPS, а также симметричный ключ для аттестации. |
| **DpsX509** | Нет | **Параметр Switch**. Если тип подготовки не указан, в качестве значения по умолчанию используется Ручная подготовка со строкой подключения.<br><br>Объявляет, что вы предоставляете идентификатор области службы подготовки устройств (DPS) и идентификатор регистрации устройства для подготовки через DPS, а также сертификат удостоверения X. 509 и закрытый ключ для аттестации.  |
| **девицеконнектионстринг** | Строка подключения из устройства IoT Edge, зарегистрированного в Центре Интернета вещей, в одинарных кавычках. | **Требуется** для ручной подготовки со строкой подключения. Если вы не предложит строку подключения в параметрах сценария, вам будет предложено ввести ее. |
| **IotHubHostName** | Имя узла центра Интернета вещей, к которому подключается устройство. | **Требуется** для подготовки вручную с помощью сертификатов X. 509. Имеет формат *{имя концентратора}. Azure-Devices.NET*. |
| **DeviceId** | ИДЕНТИФИКАТОР устройства из зарегистрированного удостоверения устройства в центре Интернета вещей. | **Требуется** для подготовки вручную с помощью сертификатов X. 509. |
| **ScopeId** | Идентификатор области из экземпляра службы подготовки устройств, связанного с Центром Интернета вещей. | **Требуется** для подготовки политики диагностики. Если вы не предложит идентификатор области в параметрах сценария, вам будет предложено ввести его. |
| **RegistrationId** | Идентификатор регистрации, созданный вашим устройством. | **Требуется** для подготовки DPS при использовании TPM или аттестации симметричного ключа. **Необязательно** , если используется аттестация сертификата X. 509. |
| **X509IdentityCertificate** | Путь URI к сертификату удостоверения устройства X. 509 на устройстве. | **Требуется** для подготовки вручную или DPS при использовании аттестации сертификата X. 509. |
| **X509IdentityPrivateKey** | Путь URI к ключу сертификата удостоверения устройства X. 509 на устройстве. | **Требуется** для подготовки вручную или DPS при использовании аттестации сертификата X. 509. |
| **SymmetricKey** | Симметричный ключ, используемый для подготовки удостоверения устройства IoT Edge при использовании DPS | **Требуется** для подготовки DPS при использовании аттестации симметричных ключей. |
| **ContainerOs** | **Windows** или **Linux** | Если не указана операционная система контейнера, значение по умолчанию — Windows.<br><br>Для контейнеров Windows IoT Edge использует подсистему контейнеров значок Кита, входящую в установку. Для контейнеров Linux необходимо установить подсистему контейнеров перед началом установки. |
| **девицекацертификате** | Путь URI к сертификату ЦС устройства X. 509 на устройстве. | Также можно настроить в `C:\ProgramData\iotedge\config.yaml` файле. Дополнительные сведения см. [в статье Управление сертификатами на IOT Edge устройстве](how-to-manage-device-certificates.md). |
| **девицекаприватекэй** | Путь URI к закрытому ключу ЦС устройства X. 509 на устройстве. | Также можно настроить в `C:\ProgramData\iotedge\config.yaml` файле. Дополнительные сведения см. [в статье Управление сертификатами на IOT Edge устройстве](how-to-manage-device-certificates.md). |
| **InvokeWebRequestParameters** | Хэш-таблица параметров и значений. | Во время установки выполняется несколько веб-запросов. Используйте это поле, чтобы задать параметры для этих веб-запросов. Этот параметр нужен, чтобы настроить учетные данные для прокси-серверов. Дополнительные сведения см. в статье [Настройка устройства IoT Edge для обмена данными через прокси-сервер](how-to-configure-proxy-support.md). |
| **AgentImage** | URI образа агента IoT Edge. | По умолчанию новая установка IoT Edge использует последний тег для образа агента IoT Edge. Используйте этот параметр, чтобы задать определенный тег для версии образа, или предоставьте свой образ агента. Дополнительные сведения см. в статье [Основные сведения о тегах IoT Edge](how-to-update-iot-edge.md#understand-iot-edge-tags). |
| **Имя пользователя** | Имя пользователя реестра контейнеров | Используйте этот параметр только в том случае, если вы задаете значение параметра -AgentImage для контейнера в частном реестре. Укажите имя пользователя с доступом к реестру. |
| **Пароль** | Строка надежного пароля. | Используйте этот параметр только в том случае, если вы задаете значение параметра -AgentImage для контейнера в частном реестре. Укажите пароль для доступа к реестру. |

## <a name="update-iotedge"></a>Update-IoTEdge

| Параметр | Допустимые значения | Комментарии |
| --------- | --------------- | -------- |
| **ContainerOs** | **Windows** или **Linux** | Если ОС контейнера не указана, по умолчанию используется значение Windows. Для контейнеров Windows подсистема контейнеров будет включена в установку. Для контейнеров Linux необходимо установить подсистему контейнеров перед началом установки. |
| **Прокси** | URL-адрес прокси-сервера. | Включите этот параметр, если ваше устройство подключается к Интернету через прокси-сервер. Дополнительные сведения см. в статье [Настройка устройства IoT Edge для обмена данными через прокси-сервер](how-to-configure-proxy-support.md). |
| **InvokeWebRequestParameters** | Хэш-таблица параметров и значений. | Во время установки выполняется несколько веб-запросов. Используйте это поле, чтобы задать параметры для этих веб-запросов. Этот параметр нужен, чтобы настроить учетные данные для прокси-серверов. Дополнительные сведения см. в статье [Настройка устройства IoT Edge для обмена данными через прокси-сервер](how-to-configure-proxy-support.md). |
| **OfflineInstallationPath** | Путь к каталогу. | Если этот параметр включен, установщик будет проверять указанный каталог на наличие файлов MSI для IoT Edge CAB и среды выполнения VC, необходимых для установки. Скачаны все файлы, не найденные в каталоге. Если оба файла находятся в каталоге, можно установить IoT Edge без подключения к Интернету. Этот параметр также можно использовать для использования определенной версии. |
| **рестартифнидед** | нет | Этот флаг позволяет скрипту развертывания перезапускать компьютер без запроса при необходимости. |

## <a name="uninstall-iotedge"></a>Uninstall-IoTEdge

| Параметр | Допустимые значения | Комментарии |
| --------- | --------------- | -------- |
| **Force** | нет | Этот флаг принудительно выполняет удаление, если предыдущая попытка удаления завершилась неудачно.
| **рестартифнидед** | нет | Этот флаг позволяет сценарию удаления перезапускать компьютер без запроса при необходимости. |

## <a name="next-steps"></a>Дальнейшие действия

Сведения об использовании этих команд см. в следующей статье:

* [Установка или удаление Azure IoT Edge для Windows](how-to-install-iot-edge-windows-on-windows.md)
