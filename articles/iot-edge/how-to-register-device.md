---
title: Регистрация нового устройства — Azure IoT Edge | Документация Майкрософт
description: Регистрация одного устройства IoT Edge в центре Интернета вещей для ручной подготовки с помощью симметричных ключей или сертификатов X. 509
author: kgremban
manager: philmea
ms.reviewer: veyalla
ms.service: iot-edge
services: iot-edge
ms.topic: conceptual
ms.date: 10/06/2020
ms.author: kgremban
ms.openlocfilehash: d75f184a324a9d418b0af2e3cf5790205af0fa42
ms.sourcegitcommit: 5f32f03eeb892bf0d023b23bd709e642d1812696
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/12/2021
ms.locfileid: "103200722"
---
# <a name="register-an-iot-edge-device-in-iot-hub"></a>Регистрация устройства IoT Edge в центре Интернета вещей

[!INCLUDE [iot-edge-version-all-supported](../../includes/iot-edge-version-all-supported.md)]

В этой статье описаны действия по регистрации нового устройства IoT Edge в центре Интернета вещей.

Каждое устройство, которое подключается к центру Интернета вещей, имеет идентификатор устройства, который используется для мониторинга обмена данными между облако-устройством или устройством и облаком. Вы настраиваете устройство, используя сведения о его подключении, включая имя узла центра Интернета вещей, идентификатор устройства и сведения, используемые устройством для проверки подлинности в центре Интернета вещей.

Действия, описанные в этой статье, посвящены процессу, который называется подготовка вручную, где вы подключаете одно устройство к центру Интернета вещей. Для подготовки вручную можно использовать два варианта проверки подлинности IoT Edge устройств:

* **Симметричный ключ**. при создании нового удостоверения устройства в центре Интернета вещей служба создает два ключа. Вы помещаете один ключ на устройство и предоставляете ключ в центре Интернета вещей при проверке подлинности.

  Этот метод проверки подлинности быстрее приступит к работе, но не защищен.

* **Самозаверяющий сертификат x. 509**. вы создаете два сертификата удостоверения x. 509 и размещайте их на устройстве. При создании нового удостоверения устройства в центре Интернета вещей вы предоставляете отпечатки обоих сертификатов. Когда устройство проходит проверку подлинности в центре Интернета вещей, оно предоставляет один сертификат и центр Интернета вещей проверяет, соответствует ли сертификат его отпечатку.

  Этот метод проверки подлинности более безопасен и рекомендуется для рабочих сценариев.

В этой статье рассматриваются оба метода проверки подлинности.

Если у вас много устройств для настройки и вы не хотите вручную подготавливать их, воспользуйтесь одной из следующих статей, чтобы узнать, как IoT Edge работает с службой подготовки устройств для центра Интернета вещей:

* [Создание и инициализация IoT Edge устройств с помощью сертификатов X. 509](how-to-auto-provision-x509-certs.md)
* [Создание и инициализация устройств IoT Edge с помощью доверенного платформенного модуля](how-to-auto-provision-simulated-device-linux.md)
* [Создание и инициализация IoT Edge устройств с помощью симметричных ключей](how-to-auto-provision-symmetric-keys.md)

## <a name="prerequisites"></a>Предварительные требования

# <a name="portal"></a>[Портал](#tab/azure-portal)

[Центр Интернета вещей](../iot-hub/iot-hub-create-through-portal.md) (бесплатно или уровня "Стандартный") в подписке Azure.

# <a name="visual-studio-code"></a>[Visual Studio Code](#tab/visual-studio-code)

* Бесплатный или стандартный [центр Интернета вещей](../iot-hub/iot-hub-create-through-portal.md) в подписке Azure
* [Visual Studio Code](https://code.visualstudio.com/)
* [Средства Azure IoT](https://marketplace.visualstudio.com/items?itemName=vsciot-vscode.azure-iot-tools) для Visual Studio Code.

# <a name="azure-cli"></a>[Azure CLI](#tab/azure-cli)

* [Центр Интернета вещей](../iot-hub/iot-hub-create-using-cli.md) (бесплатно или уровня "Стандартный") в подписке Azure.
* [Интерфейс командной строки Azure](/cli/azure/install-azure-cli) в вашей среде. Версия Azure CLI должна быть как минимум 2.0.70 или более поздней. Для проверки используйте `az --version`. Эта версия поддерживает команды расширения az и представляет собой платформу команд Knack.

---

## <a name="option-1-register-with-symmetric-keys"></a>Вариант 1. Регистрация с симметричными ключами

Вы можете использовать несколько средств для регистрации нового устройства IoT Edge в центре Интернета вещей и получения его строки подключения в зависимости от предпочтений.

# <a name="portal"></a>[Портал](#tab/azure-portal)

В центре Интернета вещей в портал Azure IoT Edge устройства создаются и управляются отдельно от устройств IoT, которые не включены в пограничные устройства.

1. Войдите на [портал Azure](https://portal.azure.com) и перейдите к своему Центру Интернета вещей.

1. В левой области выберите **IOT Edge** в меню, а затем выберите **Добавить устройство IOT Edge**.

   ![Добавление устройства IoT Edge из портал Azure](./media/how-to-register-device/portal-add-iot-edge-device.png)

1. На странице **Создание устройства** укажите следующие сведения.

   * Создайте описательный идентификатор устройства.
   * В качестве типа проверки подлинности выберите **Ключ содержимого**.
   * Для автоматического создания ключей проверки подлинности и подключения нового устройства к центру используйте параметры по умолчанию.

1. Щелкните **Сохранить**.

# <a name="visual-studio-code"></a>[Visual Studio Code](#tab/visual-studio-code)

### <a name="sign-in-to-access-your-iot-hub"></a>Вход в систему для получения доступа к Центру Интернета вещей

Для выполнения действий с Центром Интернета вещей можно использовать расширения Интернета вещей Azure для Visual Studio Code. Чтобы эти операции работали, необходимо войти в учетную запись Azure и выбрать центр.

1. Откройте в Visual Studio Code представление **Explorer**.
1. В нижней части Explorer разверните раздел **Центр Интернета вещей**.

   ![Развернутый раздел "Azure IoT Hub Devices" (Устройства Центра Интернета вещей Azure)](./media/how-to-register-device/azure-iot-hub-devices.png)

1. Щелкните значок **...** в заголовке раздела **Центр Интернета вещей**. Если значок многоточия не отображается, щелкните заголовок или наведите на него курсор.
1. Щелкните **Выбрать Центр Интернета вещей**.
1. Если вы еще не вошли в учетную запись Azure, сделайте это сейчас, следуя инструкциям.
1. Выберите подписку Azure.
1. Выберите нужный Центр Интернета вещей.

### <a name="register-a-new-device-with-visual-studio-code"></a>Регистрация нового устройства с помощью Visual Studio Code

1. В обозревателе Visual Studio Code разверните раздел **центр Интернета вещей Azure** .
1. Щелкните значок **...** в заголовке раздела **Центр Интернета вещей**. Если значок многоточия не отображается, щелкните заголовок или наведите на него курсор.
1. Выберите **Создать устройство IoT Edge**.
1. В открывшемся текстовом поле введите идентификатор для нового устройства.

На экране выходных данных отобразится результат выполнения команды. Здесь содержатся сведения об устройстве, в том числе введенный вами идентификатор **deviceId** и строка подключения **connectionString**, которая понадобится для подключения физического устройства к Центру Интернета вещей.

# <a name="azure-cli"></a>[Azure CLI](#tab/azure-cli)

Для создания нового удостоверения устройства в центре Интернета вещей используйте команду [az iot hub device-identity create](/cli/azure/ext/azure-iot/iot/hub/device-identity#ext-azure-iot-az-iot-hub-device-identity-create). Пример:

   ```azurecli
   az iot hub device-identity create --device-id [device id] --hub-name [hub name] --edge-enabled
   ```

Эта команда принимает три параметра:

* `--device-id` или `-d` укажите описательное имя, которое уникально в центре Интернета вещей.
* `--hub-name` или `-n` Укажите имя центра Интернета вещей.
* `--edge-enabled` или `--ee` . Объявите, что устройство является устройством IOT Edge.

   ![Выходные данные команды az iot hub device-identity](./media/how-to-register-device/create-edge-device-cli.png)

---

Теперь, когда устройство зарегистрировано в центре Интернета вещей, извлеките строку подключения, используемую для завершения установки и подготовки среды выполнения IoT Edge. Выполните действия, описанные далее в этой статье, чтобы [просмотреть зарегистрированные устройства и получить строки подключения](#view-registered-devices-and-retrieve-connection-strings).

## <a name="option-2-register-with-x509-certificates"></a>Вариант 2. Регистрация с помощью сертификатов X. 509

Для подготовки вручную с помощью сертификатов X. 509 требуется IoT Edge версии 1.0.10 или более поздней.

Для проверки подлинности на основе сертификата X. 509 данные проверки подлинности каждого устройства предоставляются в виде *отпечатков* , полученных из сертификатов удостоверений устройств. Эти отпечатки передаются в центр Интернета вещей во время регистрации устройства, чтобы служба могла распознать устройство при подключении.

### <a name="create-certificates-and-thumbprints"></a>Создание сертификатов и отпечатков

При подготовке устройства IoT Edge с сертификатами X. 509 используется то, что называется *сертификатом удостоверения устройства*. Этот сертификат используется только для подготовки устройства IoT Edge и проверки подлинности устройства в центре Интернета вещей Azure. Это конечный сертификат, который не подписывает другие сертификаты. Сертификат удостоверения устройства отделен от сертификатов центра сертификации (ЦС), которые устройство IoT Edge предоставляет модулям или подчиненным устройствам для проверки. Дополнительные сведения об использовании сертификатов ЦС в IoT Edge устройствах см. в разделе [понимание того, как Azure IOT Edge использует сертификаты](iot-edge-certs.md).

Для подготовки вручную с помощью X. 509 вам потребуются следующие файлы:

* Два сертификата удостоверений устройств с соответствующими сертификатами закрытых ключей в форматах CER или PEM.

  Для среды выполнения IoT Edge предоставляется один набор файлов сертификатов или ключей. При создании сертификатов удостоверений устройств задайте общее имя сертификата (CN) с ИДЕНТИФИКАТОРом устройства, которое должно иметь устройство в центре Интернета вещей.

* Отпечатки, взятые из сертификатов удостоверений устройств.

  Значения отпечатков — это 40-шестнадцатеричные символы для хэшей SHA-1 или 64-шестнадцатеричных символов для хэшей SHA-256. Оба отпечатки предоставляются в центре Интернета вещей во время регистрации устройства.

Если у вас нет доступных сертификатов, можно [создать демонстрационные сертификаты для тестирования функций IOT Edge устройства](how-to-create-test-certificates.md). Следуйте инструкциям в этой статье, чтобы настроить сценарии создания сертификатов, создать сертификат корневого ЦС, а затем создать два IoT Edge сертификатов удостоверений устройств.

Одним из способов получения отпечатка из сертификата является следующая команда OpenSSL:

```cmd
openssl x509 -in <certificate filename>.pem -text -fingerprint
```

### <a name="register-a-new-device"></a>Регистрация нового устройства

Вы можете использовать несколько средств для регистрации нового устройства IoT Edge в центре Интернета вещей и отправки его отпечатков сертификатов.

# <a name="portal"></a>[Портал](#tab/azure-portal)

В центре Интернета вещей в портал Azure IoT Edge устройства создаются и управляются отдельно от устройств IoT, которые не включены в пограничные устройства.

1. Войдите на [портал Azure](https://portal.azure.com) и перейдите к своему Центру Интернета вещей.

1. В левой области выберите **IOT Edge** в меню, а затем выберите **Добавить устройство IOT Edge**.

   ![Добавление устройства IoT Edge из портал Azure](./media/how-to-register-device/portal-add-iot-edge-device.png)

1. На странице **Создание устройства** укажите следующие сведения.

   * Создайте описательный идентификатор устройства. Запишите этот идентификатор устройства, так как он будет использоваться в следующем разделе.
   * В качестве типа проверки подлинности выберите **самозаверяющий сертификат X.509**.
   * Укажите отпечатки первичного и вторичного сертификата удостоверения. Значения отпечатков — это 40-шестнадцатеричные символы для хэшей SHA-1 или 64-шестнадцатеричных символов для хэшей SHA-256.

1. Щелкните **Сохранить**.

# <a name="visual-studio-code"></a>[Visual Studio Code](#tab/visual-studio-code)

В настоящее время расширение Интернета вещей Azure для Visual Studio Code не поддерживает регистрацию устройств с помощью сертификатов X. 509.

# <a name="azure-cli"></a>[Azure CLI](#tab/azure-cli)

Для создания нового удостоверения устройства в центре Интернета вещей используйте команду [az iot hub device-identity create](/cli/azure/ext/azure-iot/iot/hub/device-identity#ext-azure-iot-az-iot-hub-device-identity-create). Пример:

   ```azurecli
   az iot hub device-identity create --device-id [device id] --hub-name [hub name] --edge-enabled --auth-method x509_thumbprint --primary-thumbprint [SHA thumbprint] --secondary-thumbprint [SHA thumbprint]
   ```

Эта команда включает несколько параметров:

* `--device-id` или `-d` укажите описательное имя, уникальное для центра Интернета вещей. Запишите этот идентификатор устройства, так как он будет использоваться в следующем разделе.
* `hub-name` или `-n` Укажите имя центра Интернета вещей.
* `--edge-enabled` или `--ee` . Объявите, что устройство является устройством IOT Edge.
* `--auth-method` или `--am` . Объявите тип авторизации, который будет использоваться устройством. В этом случае мы используем отпечатки сертификата X. 509.
* `--primary-thumbprint` или `--ptp` : укажите отпечаток сертификата X. 509 для использования в качестве первичного ключа.
* `--secondary-thumbprint` или `--stp` : укажите отпечаток сертификата X. 509 для использования в качестве вторичного ключа.

---

Теперь, когда устройство зарегистрировано в центре Интернета вещей, вы можете установить и подготовить среду выполнения IoT Edge на устройстве. IoT Edge устройства, которые проходят проверку подлинности в сертификатах X. 509, не используют строки подключения, поэтому можно перейти к следующему шагу:

* [Установка или удаление Azure IoT Edge для Linux](how-to-install-iot-edge.md)
* [Установка или удаление Azure IoT Edge для Windows](how-to-install-iot-edge-windows-on-windows.md)

## <a name="view-registered-devices-and-retrieve-connection-strings"></a>Просмотр зарегистрированных устройств и получение строк подключения

Устройствам, использующим проверку подлинности с симметричным ключом, требуются строки подключения для завершения установки и подготовки среды выполнения IoT Edge.

Для устройств, использующих проверку подлинности с помощью сертификата X. 509, строки подключения не требуются. Вместо этого для завершения установки и подготовки среды выполнения IoT Edge этим устройствам требуется имя центра Интернета вещей, имя устройства и их файлы сертификатов.

# <a name="portal"></a>[Портал](#tab/azure-portal)

Все устройства IoT Edge, подключенные к Центру Интернета вещей, перечислены на странице **IoT Edge**.

![Использование портал Azure для просмотра всех устройств IoT Edge в центре Интернета вещей](./media/how-to-register-device/portal-view-devices.png)

Когда все будет готово к настройке устройства, вам понадобится строка подключения, которая связывает физическое устройство с его идентификатором в Центре Интернета вещей.

Для устройств, которые проходят проверку подлинности с симметричными ключами, строки подключения доступны для копирования на портале.

1. На странице **IoT Edge** на портале выберите идентификатор устройства в списке устройств IoT Edge.
2. Скопируйте значение в поле **Основная строка подключения** или **Дополнительная строка подключения**.

# <a name="visual-studio-code"></a>[Visual Studio Code](#tab/visual-studio-code)

### <a name="view-iot-edge-devices-with-visual-studio-code"></a>Просмотр устройств IoT Edge с помощью Visual Studio Code

Все устройства, подключенные к Центру Интернета вещей, перечислены в разделе **Центр Интернета вещей** в обозревателе Visual Studio Code. Устройства IoT Edge легко отличить от остальных, так как они обозначаются другим значком и их можно открыть для отображения модулей **$edgeAgent** и **$edgeHub**, развернутых на каждом из устройств IoT Edge.

![Использование VS Code для просмотра всех устройств IoT Edge в центре Интернета вещей](./media/how-to-register-device/view-devices.png)

### <a name="retrieve-the-connection-string-with-visual-studio-code"></a>Получение строки подключения с помощью Visual Studio Code

Когда все будет готово к настройке устройства, вам понадобится строка подключения, которая связывает физическое устройство с его идентификатором в Центре Интернета вещей.

1. Щелкните правой кнопкой мыши идентификатор устройства в разделе **Центр Интернета вещей**.
1. Выберите действие **Копировать строку подключения для устройства**.

   Строка подключения будет помещена в буфер обмена.

Также вы можете выбрать пункт **Получить информацию об устройства** в контекстном меню, чтобы просмотреть в окне выходных данных сведения об этом устройстве, в том числе строку подключения.

# <a name="azure-cli"></a>[Azure CLI](#tab/azure-cli)

### <a name="view-iot-edge-devices-with-the-azure-cli"></a>Просмотр устройств IoT Edge в Azure CLI

Для просмотра всех устройств в центре Интернета вещей используйте команду [az iot hub device-identity list](/cli/azure/ext/azure-iot/iot/hub/device-identity#ext-azure-iot-az-iot-hub-device-identity-list). Пример:

   ```azurecli
   az iot hub device-identity list --hub-name [hub name]
   ```

Для всех устройств, зарегистрированных в качестве устройства IoT Edge, свойство **capabilities.iotEdge** будет иметь значение **true**.

### <a name="retrieve-the-connection-string-with-the-azure-cli"></a>Получение строки подключения с помощью Azure CLI

Когда все будет готово к настройке устройства, вам понадобится строка подключения, которая связывает физическое устройство с его идентификатором в Центре Интернета вещей. Чтобы вернуть строку подключения для одного устройства, воспользуйтесь командой [AZ IOT концентратора подключение — строка-идентификация](/cli/azure/ext/azure-iot/iot/hub/device-identity/connection-string#ext_azure_iot_az_iot_hub_device_identity_connection_string_show) .

   ```azurecli
   az iot hub device-identity connection-string show --device-id [device id] --hub-name [hub name]
   ```

>[!TIP]
>`connection-string show`Команда была представлена в версии 0.9.8 расширения Интернета вещей Azure, заменив нерекомендуемую `show-connection-string` команду. Если при выполнении этой команды возникает ошибка, убедитесь, что версия расширения обновлена до 0.9.8 или более поздней версии. Дополнительные сведения и последние обновления см. в разделе [Microsoft Azure расширения IOT для Azure CLI](https://github.com/Azure/azure-iot-cli-extension).

В параметре `device-id` учитывается регистр.

При копировании строки подключения для использования на устройстве не включайте кавычки вокруг строки подключения.

---

## <a name="next-steps"></a>Дальнейшие действия

Теперь, когда устройство зарегистрировано в центре Интернета вещей, вы можете установить и подготовить среду выполнения IoT Edge на устройстве.

* [Установка или удаление Azure IoT Edge для Linux](how-to-install-iot-edge.md)
* [Установка или удаление Azure IoT Edge для Windows](how-to-install-iot-edge-windows-on-windows.md)