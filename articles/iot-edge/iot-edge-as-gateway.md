---
title: Шлюзы для подчиненных устройств — Azure IoT Edge | Документация Майкрософт
description: Используйте Azure IoT Edge для создания прозрачного и непрозрачного устройства-шлюза или устройства-шлюза прокси-сервера, который отправляет данные из нескольких подчиненных устройств в облако или обрабатывает их локально.
author: kgremban
manager: philmea
ms.author: kgremban
ms.date: 11/10/2020
ms.topic: conceptual
ms.service: iot-edge
services: iot-edge
ms.custom:
- amqp
- mqtt
ms.openlocfilehash: ca8f02b375420590bcf1cc732c067a165e22b3fa
ms.sourcegitcommit: 4bda786435578ec7d6d94c72ca8642ce47ac628a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/16/2021
ms.locfileid: "103492716"
---
# <a name="how-an-iot-edge-device-can-be-used-as-a-gateway"></a>Использование устройства IoT Edge в качестве шлюза

[!INCLUDE [iot-edge-version-201806-or-202011](../../includes/iot-edge-version-201806-or-202011.md)]

IoT Edge устройства могут действовать в качестве шлюзов, предоставляя подключение между другими устройствами в сети и центром Интернета вещей.

Модуль IoT Edge концентратора действует как центр Интернета вещей, поэтому может обслуживать подключения с любых устройств, имеющих удостоверение с центром Интернета вещей, включая другие устройства IoT Edge. Этот тип шаблона шлюза называется *прозрачным* , так как сообщения могут передаваться из нижестоящих устройств в центр Интернета вещей, как будто между ними нет шлюза.

<!-- 1.2.0 -->
::: moniker range=">=iotedge-2020-11"
Начиная с версии 1,2 IoT Edge, прозрачные шлюзы могут обслуживать подчиненные подключения от других IoT Edge устройств.
::: moniker-end

Для устройств, которые не могут самостоятельно подключаться к центру Интернета вещей, IoT Edge шлюзы могут предоставить это подключение. Этот тип шаблона шлюза называется *переводом* , так как устройство IOT Edge должно выполнять обработку входящих подчиненных сообщений устройства, прежде чем они могут быть перенаправлены в центр Интернета вещей. В этих сценариях для обработки шагов обработки требуются дополнительные модули шлюза IoT Edge.

Шаблоны шлюза прозрачности и перевода не являются взаимоисключающими. Одно устройство IoT Edge может работать как с прозрачным шлюзом, так и с шлюзом перевода.

Все шаблоны шлюза предоставляют следующие преимущества:

* **Аналитика на пограничном уровне** . Используйте службы искусственного интеллекта локально для обработки данных, поступающих от нижестоящих устройств, не отправляя данные телеметрии полной точности в облако. Находите данные и реагируйте на запросы локально, а также отправляйте подмножество данных в Центр Интернета вещей.
* **Изоляция подчиненного устройства.** Устройство шлюза может обеспечить всем подчиненным устройствам безопасность в Интернете. Она может находиться между сетью с операционными технологиями, не имеющей подключения, и сетью информационных технологий (ИТ), которая предоставляет доступ к Интернету. Аналогичным образом устройства, которые не имеют возможности подключаться к центру Интернета вещей, могут подключаться к устройству шлюза.
* **Мультиплексирование подключений** . все устройства, подключающиеся к центру Интернета вещей через шлюз IOT EDGE, могут использовать одно и то же базовое соединение. Эта возможность мультиплексирования требует, чтобы шлюз IoT Edge использовал AMQP в качестве вышестоящего протокола.
* **Сглаживание трафика** — Устройство IoT Edge автоматически будет выполнять экспоненциальную задержку, если Центр Интернета вещей регулирует трафик, при этом сообщения сохраняются локально. Это преимущество сделает ваше решение устойчивым к пикам трафика.
* **Автономная поддержка** . устройство шлюза хранит сообщения и обновления двойника, которые не могут быть доставлены в центр Интернета вещей.

## <a name="transparent-gateways"></a>Прозрачные шлюзы

В шаблоне прозрачного шлюза устройства, которые теоретически могут подключаться к центру Интернета вещей, могут подключаться к устройству шлюза. Подчиненные устройства имеют собственные удостоверения центра Интернета вещей и подключаются с помощью протоколов MQTT или AMQP. Шлюз просто обеспечивает взаимодействие между устройствами и Центром Интернета вещей. Устройства и пользователи, взаимодействующие с ними через центр Интернета вещей, не знают, что шлюз обрабатывают их связь. Отсутствие осведомленности означает, что шлюз считается *прозрачным*.

Дополнительные сведения о том, как центр IoT Edge управляет взаимодействием между подчиненными устройствами и облаком, см. [в разделе понимание среды выполнения Azure IOT EDGE и ее архитектуры](iot-edge-runtime.md).

<!-- 1.1 -->
::: moniker range="iotedge-2018-06"

IoT Edge устройства не могут быть частью шлюза IoT Edge.

![Схема-прозрачный шаблон шлюза](./media/iot-edge-as-gateway/edge-as-gateway-transparent.png)

::: moniker-end

<!-- 1.2.0 -->
::: moniker range=">=iotedge-2020-11"

Начиная с версии IoT Edge 1.2.0 устройства могут подключаться через прозрачные шлюзы.

<!-- TODO add a downstream IoT Edge device to graphic -->

::: moniker-end

### <a name="parent-and-child-relationships"></a>Родительские и дочерние отношения

Вы объявляете прозрачные связи шлюза в центре Интернета вещей, настроив шлюз IoT Edge как *родительский* для подчиненного *дочернего* устройства, который подключается к нему.

Связь «родители-потомки» устанавливается в трех точках в конфигурации шлюза.

#### <a name="cloud-identities"></a>Облачная идентификация

Для всех устройств в сценарии с прозрачным шлюзом требуются облачные удостоверения, чтобы они могли проходить проверку подлинности в центре Интернета вещей. При создании или обновлении удостоверения устройства можно задать родительские или дочерние устройства устройства. Эта конфигурация разрешает устройству родительского шлюза обработку проверки подлинности для своих дочерних устройств.

>[!NOTE]
>Настройка родительского устройства в центре Интернета вещей, которая является дополнительным шагом для подчиненных устройств, использующих проверку подлинности с симметричным ключом. Однако начиная с версии 1.1.0 каждое подчиненное устройство должно быть назначено родительскому устройству.
>
>Можно настроить центр IoT Edge для возврата к предыдущему поведению, задав для переменной среды **AuthenticationMode** значение **клаудандскопе**.

Дочерние устройства могут иметь только один родительский элемент. Каждый родительский элемент может иметь до 100 дочерних элементов.

<!-- 1.2.0 -->
::: moniker range=">=iotedge-2020-11"
IoT Edge устройства могут быть как родительскими, так и дочерними элементами в связях прозрачного шлюза. Можно создать иерархию нескольких IoT Edge устройств, сообщающих друг другу. Верхний узел иерархии шлюзов может содержать до пяти поколений дочерних элементов. Например, устройство IoT Edge может иметь пять уровней IoT Edge устройств, связанных как дочерние элементы. Но IoT Edge устройство в пятом поколении не может иметь дочерних элементов, IoT Edge или иным образом.
::: moniker-end

#### <a name="gateway-discovery"></a>Обнаружение шлюза

Дочернее устройство должно иметь возможность найти его родительское устройство в локальной сети. Настройте устройства шлюза с **именем узла**, полным доменным именем (FQDN) или IP-адресом, который его дочерние устройства будут использовать для его размещения.

На нижестоящих устройствах IoT используйте параметр **гатевайхостнаме** в строке подключения, чтобы указать родительское устройство.

<!-- 1.2.0 -->
::: moniker range=">=iotedge-2020-11"
На нижестоящих IoT Edge устройствах используйте параметр **parent_hostname** в файле конфигурации, чтобы указать родительское устройство.
::: moniker-end

#### <a name="secure-connection"></a>Безопасное подключение

Родительские и дочерние устройства также должны проходить проверку подлинности подключений друг к другу. Каждому устройству требуется копия общего корневого сертификата ЦС, который дочерние устройства используют для проверки подключения к соответствующему шлюзу.

<!-- 1.2.0 -->
::: moniker range=">=iotedge-2020-11"
Если несколько шлюзов IoT Edge подключаются друг к другу в иерархии шлюзов, все устройства в иерархии должны использовать одну цепочку сертификатов.
::: moniker-end

### <a name="device-capabilities-behind-transparent-gateways"></a>Возможности устройств за пределами прозрачных шлюзов

Все примитивы центра Интернета вещей, работающие с конвейером обмена сообщениями IoT Edge, также поддерживают сценарии с прозрачным шлюзом. Каждый шлюз IoT Edge имеет возможности хранения и пересылки для сообщений, поступающих от него.

Используйте следующую таблицу, чтобы узнать, как различные возможности центра Интернета вещей поддерживаются для устройств по сравнению с устройствами, расположенными за шлюзами.

<!-- 1.1 -->
::: moniker range="iotedge-2018-06"

| Возможности | Устройство Интернета вещей | Интернет вещей за шлюзом |
| ---------- | ---------- | -------------------- |
| [Сообщения с устройства в облако (D2C)](../iot-hub/iot-hub-devguide-messages-d2c.md) |  ![Да — D2C IoT](./media/iot-edge-as-gateway/check-yes.png) | ![Да — дочерняя D2C IoT](./media/iot-edge-as-gateway/check-yes.png) |
| [Сообщения из облака на устройство (C2D)](../iot-hub/iot-hub-devguide-messages-c2d.md) | ![Да — C2D IoT](./media/iot-edge-as-gateway/check-yes.png) | ![Да — дочерний C2D IoT](./media/iot-edge-as-gateway/check-yes.png) |
| [Прямые методы](../iot-hub/iot-hub-devguide-direct-methods.md) | ![Да — прямой метод IoT](./media/iot-edge-as-gateway/check-yes.png) | ![Да-дочерний прямой метод IoT](./media/iot-edge-as-gateway/check-yes.png) |
| [Двойников устройства](../iot-hub/iot-hub-devguide-device-twins.md) и [двойников модуля](../iot-hub/iot-hub-devguide-module-twins.md) | ![Да — двойников IoT](./media/iot-edge-as-gateway/check-yes.png) | ![Да — дочерняя двойников IoT](./media/iot-edge-as-gateway/check-yes.png) |
| [Отправка файлов](../iot-hub/iot-hub-devguide-file-upload.md) | ![Да — Отправка файлов IoT](./media/iot-edge-as-gateway/check-yes.png) | ![Нет — отправка дочернего файла IoT](./media/iot-edge-as-gateway/crossout-no.png) |

::: moniker-end

<!-- 1.2.0 -->
::: moniker range=">=iotedge-2020-11"

| Возможности | Устройство Интернета вещей | Интернет вещей за шлюзом | Устройство IoT Edge | IoT Edge за шлюзом |
| ---------- | ---------- | --------------------------- | --------------- | -------------------------------- |
| [Сообщения с устройства в облако (D2C)](../iot-hub/iot-hub-devguide-messages-d2c.md) |  ![Да — D2C IoT](./media/iot-edge-as-gateway/check-yes.png) | ![Да — дочерняя D2C IoT](./media/iot-edge-as-gateway/check-yes.png) | ![Да — IoT Edge D2C](./media/iot-edge-as-gateway/check-yes.png) | ![Да — дочерняя IoT Edge D2C](./media/iot-edge-as-gateway/check-yes.png) |
| [Сообщения из облака на устройство (C2D)](../iot-hub/iot-hub-devguide-messages-c2d.md) | ![Да — C2D IoT](./media/iot-edge-as-gateway/check-yes.png) | ![Да — дочерний C2D IoT](./media/iot-edge-as-gateway/check-yes.png) | ![Нет-IoT Edge C2D](./media/iot-edge-as-gateway/crossout-no.png) | ![Нет-IoT Edge дочернего C2D](./media/iot-edge-as-gateway/crossout-no.png) |
| [Прямые методы](../iot-hub/iot-hub-devguide-direct-methods.md) | ![Да — прямой метод IoT](./media/iot-edge-as-gateway/check-yes.png) | ![Да-дочерний прямой метод IoT](./media/iot-edge-as-gateway/check-yes.png) | !["Да"-IoT Edge прямой метод](./media/iot-edge-as-gateway/check-yes.png) | !["Да"-дочерний IoT Edge прямой метод](./media/iot-edge-as-gateway/check-yes.png) |
| [Двойников устройства](../iot-hub/iot-hub-devguide-device-twins.md) и [двойников модуля](../iot-hub/iot-hub-devguide-module-twins.md) | ![Да — двойников IoT](./media/iot-edge-as-gateway/check-yes.png) | ![Да — дочерняя двойников IoT](./media/iot-edge-as-gateway/check-yes.png) | ![Да — IoT Edge двойников](./media/iot-edge-as-gateway/check-yes.png) | ![Да — дочерняя IoT Edge двойников](./media/iot-edge-as-gateway/check-yes.png) |
| [Отправка файлов](../iot-hub/iot-hub-devguide-file-upload.md) | ![Да — Отправка файлов IoT](./media/iot-edge-as-gateway/check-yes.png) | ![Нет — отправка дочернего файла IoT](./media/iot-edge-as-gateway/crossout-no.png) | ![Передача файлов без IoT Edge](./media/iot-edge-as-gateway/crossout-no.png) | ![Передача дочернего файла без IoT Edge](./media/iot-edge-as-gateway/crossout-no.png) |
| Извлечение образа контейнера |   |   | ![Да — IoT Edge извлечение контейнера](./media/iot-edge-as-gateway/check-yes.png) | ![Да-дочерний IoT Edge контейнера по запросу](./media/iot-edge-as-gateway/check-yes.png) |
| Отправка BLOB-объектов |   |   | ![Да — IoT Edge отправки BLOB-объектов](./media/iot-edge-as-gateway/check-yes.png) | ![Да-дочерняя IoT Edge передача больших двоичных объектов](./media/iot-edge-as-gateway/check-yes.png) |

**Образы контейнеров** можно загружать, хранить и доставлять с родительских устройств на дочерние устройства.

**Большие двоичные объекты**, включая пакеты поддержки и журналы, можно передать с дочерних устройств на родительские устройства.

::: moniker-end

## <a name="translation-gateways"></a>Шлюзы перевода

Если подчиненные устройства не могут подключиться к центру Интернета вещей, шлюз IoT Edge должен работать в качестве переводчика. Часто этот шаблон необходим для устройств, которые не поддерживают MQTT, AMQP или HTTP. Так как эти устройства не могут подключаться к центру Интернета вещей, они также не могут подключиться к модулю IoT Edge концентратора без предварительной обработки.

Пользовательские или сторонние модули, которые часто относятся к оборудованию или протоколу подчиненного устройства, необходимо развернуть на шлюзе IoT Edge. Эти модули перевода принимают входящие сообщения и преобразовывать их в формат, который может быть понят центром Интернета вещей.

Существует два шаблона для шлюзов перевода: *Преобразование протоколов* и *преобразование идентификаторов*.

![Шаблоны шлюза перевода схемы](./media/iot-edge-as-gateway/edge-as-gateway-translation.png)

### <a name="protocol-translation"></a>Преобразование протоколов

В шаблоне шлюза преобразования протокола только шлюз IoT Edge имеет удостоверение с центром Интернета вещей. Модуль перевода получает сообщения от подчиненных устройств, преобразует их в поддерживаемый протокол, а затем устройство IoT Edge отправляет сообщения от имени подчиненных устройств. Вся информация выглядит так, будто она поступает с одного устройства, шлюза. Подчиненные устройства должны встраивать в сообщения дополнительную идентификационную информацию, если облачным приложениям требуется анализировать данные для каждого устройства отдельно. Кроме того, примитивы центра Интернета вещей, такие как двойников и прямые методы, поддерживаются только для устройств шлюза, а не для подчиненных устройств. Шлюзы в этом шаблоне считаются *непрозрачными* в отличие от прозрачных шлюзов, так как они скрывают удостоверения подчиненных устройств.

Преобразование протоколов поддерживает устройства с ограничением ресурсов. Многие имеющиеся устройства производят данные, которые могут предоставить бизнес-аналитику, однако они не были разработаны с учетом возможности подключения к облаку. Непрозрачные шлюзы позволяют разблокировать эти данные и использовать их в решении IoT.

### <a name="identity-translation"></a>Преобразование удостоверения

Шаблон шлюза преобразования удостоверений строится на переводе протоколов, но шлюз IoT Edge также предоставляет удостоверение устройства центра Интернета вещей от имени подчиненных устройств. Модуль перевода отвечает за понимание протокола, используемого подчиненными устройствами, предоставление удостоверений и перевод сообщений в примитивы центра Интернета вещей. Подчиненные устройства отображаются в центре Интернета вещей как устройства первого класса с двойниками и методами. Пользователь может взаимодействовать с устройствами в Центре Интернета вещей и не знает о промежуточном устройстве шлюза.

Преобразование удостоверений предоставляет преимущества преобразования протоколов, а также позволяет полностью управлять подчиненными устройствами из облака. Все устройства решения Интернета вещей отображаются в Центре Интернета вещей независимо от используемого протокола.

### <a name="device-capabilities-behind-translation-gateways"></a>Возможности устройств за шлюзами перевода

В следующей таблице объясняется, как функции центра Интернета вещей расширяются до подчиненных устройств в обоих шаблонах шлюза перевода.

| Возможности | Преобразование протоколов | Преобразование удостоверения |
| ---------- | -------------------- | -------------------- |
| Удостоверения, хранящиеся в реестре удостоверений Центра Интернета вещей | Только удостоверение устройства шлюза | Удостоверения всех подключенных устройств |
| "Двойник" устройства | Только у шлюза есть двойники устройства и модуля | У каждого подключенного устройства есть свой собственный двойник устройства |
| Прямые методы и сообщения, передающиеся из облака на устройства | Данные могут передаваться из облака только в шлюз | Данные могут передаваться из облака на каждое подключенное устройство по отдельности |
| [Квоты и регулирование в Центре Интернета вещей](../iot-hub/iot-hub-devguide-quotas-throttling.md) | Применяется к устройству шлюза | Применяется к каждому устройству |

При использовании шаблона преобразования протоколов все устройства, подключающиеся через этот шлюз, совместно используют одну и ту же очередь из облака на устройство, которая может содержать не более 50 сообщений. Используйте этот шаблон только в том случае, если несколько устройств подключаются через каждый шлюз полей, а трафик из облака на устройство имеет низкий уровень.

Среда выполнения IoT Edge не включает возможности преобразования протокола или удостоверения. Для этих шаблонов требуются пользовательские или сторонние модули, которые часто относятся к используемому оборудованию и протоколу. [Azure Marketplace](https://azuremarketplace.microsoft.com/marketplace/apps/category/internet-of-things?page=1&subcategories=iot-edge-modules) содержит несколько модулей для выбора протокола преобразования. Пример, в котором используется шаблон преобразования удостоверений, см. в разделе [Azure IOT Edge Лораван Starter Kit](https://github.com/Azure/iotedge-lorawan-starterkit).

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения о настройке прозрачного шлюза см. в следующих трех шагах.

* [Настройка устройства IoT Edge для использования в качестве прозрачного шлюза](how-to-create-transparent-gateway.md)
* [Аутентификация подчиненного устройства в Центре Интернета вещей](how-to-authenticate-downstream-device.md)
* [Connect a downstream device to an Azure IoT Edge gateway](how-to-connect-downstream-device.md) (Подключение подчиненного устройства к шлюзу Azure IoT Edge)
