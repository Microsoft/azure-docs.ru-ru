---
title: Руководство по настройке среды в службе "Машинное обучение Azure" для Azure IoT Edge
description: Руководство по Подготовка среды для разработки и развертывания модулей для машинного обучения на пограничных устройствах.
author: kgremban
manager: philmea
ms.author: kgremban
ms.date: 3/12/2020
ms.topic: tutorial
ms.service: iot-edge
services: iot-edge
ms.openlocfilehash: 723d7b6ae5b96cf6dc622be1b1bb98065151787f
ms.sourcegitcommit: 32e0fedb80b5a5ed0d2336cea18c3ec3b5015ca1
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/30/2021
ms.locfileid: "103463159"
---
# <a name="tutorial-set-up-an-environment-for-machine-learning-on-iot-edge"></a>Руководство по настройке среды для машинного обучения в IoT Edge

[!INCLUDE [iot-edge-version-201806](../../includes/iot-edge-version-201806.md)]

Эта статья поможет вам подготовить среду для разработки и развертывания. Сначала настройте все необходимые инструменты на компьютере для разработки. Затем создайте необходимые облачные ресурсы в Azure.

Из этого раздела учебника, вы узнаете, как:

> [!div class="checklist"]
>
> * настроить виртуальную машину для разработки;
> * настроить Центр Интернета вещей и облачное хранилище для среды разработки.

## <a name="prerequisites"></a>Предварительные требования

Эта статья входит в серию учебников по использованию Машинного обучения Azure в IoT Edge. Каждая статья в серии основана на инструкциях, выполненных при работе с предыдущей статьей. Если вы приступили сразу к этой статье, перейдите на [первую статью](tutorial-machine-learning-edge-01-intro.md) серии.

## <a name="set-up-the-development-vm"></a>Настройка виртуальной машины разработки

Этот шаг обычно выполняет разработчик облачных решений. Некоторое программное обеспечение, возможно, будет полезным также для специалиста по обработке и анализу данных.

Мы разработали скрипт PowerShell, который позволяет создать виртуальную машину Azure с несколькими уже настроенными предварительными инструментами. Виртуальная машина, которую мы создаем, должна иметь возможность обрабатывать [вложенную виртуализацию](../virtual-machines/windows/nested-virtualization.md). Поэтому мы выбрали виртуальную машину [Standard_D8s_v3](../virtual-machines/dv3-dsv3-series.md).

На виртуальной машине для разработки будут настроены следующие инструменты:

* Windows 10
* [Chocolatey](https://chocolatey.org/)
* [Docker Desktop для Windows](https://www.docker.com/products/docker-desktop);
* [Git для Windows](https://gitforwindows.org/)
* [диспетчер учетных данных Git для Windows](https://github.com/Microsoft/Git-Credential-Manager-for-Windows);
* [Базовый пакет SDK для .NET](https://dotnet.microsoft.com/)
* [Python 3](https://www.python.org/);
* [Visual Studio Code](https://code.visualstudio.com/)
* [Azure PowerShell](/powershell/azure/)
* [расширения VS Code](https://marketplace.visualstudio.com/search?target=VSCode):
  * [Средства Интернета вещей Azure](https://marketplace.visualstudio.com/items?itemName=vsciot-vscode.azure-iot-tools)
  * [Python](https://marketplace.visualstudio.com/items?itemName=ms-python.python)
  * [C#](https://marketplace.visualstudio.com/items?itemName=ms-dotnettools.csharp)
  * [Docker](https://marketplace.visualstudio.com/items?itemName=PeterJausovec.vscode-docker)
  * [PowerShell](https://marketplace.visualstudio.com/items?itemName=ms-vscode.PowerShell)

Не всегда нужно создавать отдельную виртуальную машину для разработки. Все необходимые инструменты можно запускать на локальном компьютере. Но мы настоятельно рекомендуем работать на виртуальной машине, чтобы обеспечить одинаковые условия.

Создание и настройка виртуальных машин занимает около 30 минут.

1. Клонируйте или скачайте пример репозитория [Машинного обучения и IoT Edge](https://github.com/Azure-Samples/IoTEdgeAndMlSample) на локальный компьютер.

1. Откройте PowerShell с правами администратора и перейдите в каталог **\IoTEdgeAndMlSample\DevVM**, расположенный в корневом каталоге, куда вы скачали код. Корневой каталог источника данных будет называться `srcdir`.

    ```powershell
    cd c:\srcdir\IoTEdgeAndMlSample\DevVM
    ```

   Каталог DevVM содержит файлы, необходимые для создания виртуальной машины Azure в целях изучения этого руководства.

1. Выполните приведенную ниже команду, чтобы разрешить выполнение скриптов. Выберите **Да для всех** при появлении запроса.

    ```powershell
    Set-ExecutionPolicy Bypass -Scope Process
    ```

1. Запустите Create-AzureDevVM.ps1.

    ```powershell
    .\Create-AzureDevVm.ps1
    ```

    При появлении запроса введите следующие сведения:

    * **Идентификатор подписки Azure** — идентификатор вашей подписки, который можно найти в [подписке Azure](https://ms.portal.azure.com/#blade/Microsoft_Azure_Billing/SubscriptionsBlade) на портале.
    * **Имя группы ресурсов** — имя новой или имеющейся группы ресурсов в Azure.
    * **Расположение.** выберите расположение Azure, где будет создана виртуальная машина. Например, "Западная часть США 2" или "Северная Европа". Дополнительные сведения см. в разделе о [расположениях Azure](https://azure.microsoft.com/global-infrastructure/locations/).
    * **Имя пользователя**. Введите запоминающее имя для учетной записи администратора виртуальной машины.
    * **Пароль**. Задайте пароль для учетной записи администратора виртуальной машины.

   Скрипт будет выполнять следующие действия в течение нескольких минут:

    1. Установка [модуля Az для Azure PowerShell](/powershell/azure/new-azureps-module-az).
    1. Отображение запроса на вход в Azure.
    1. Подтверждение сведений для создания виртуальной машины. Нажмите клавишу **Y** или **ВВОД**, чтобы продолжить.
    1. Создание группы ресурсов, если она не существует.
    1. Развертывание виртуальной машины.
    1. Включение Hyper-V на виртуальной машине.
    1. Установка программного обеспечения для разработки и клонирование примера репозитория.
    1. Перезапуск виртуальной машины.
    1. Создание RDP-файла на рабочем столе для подключения к виртуальной машине.

   Если будет предложено ввести имя виртуальной машины для перезапуска, ее имя можно скопировать из выходных данных скрипта. В выходных данных также отображается путь к RDP-файлу для подключения к виртуальной машине.

### <a name="set-auto-shutdown-schedule"></a>Настройка расписания автоматического завершения работы

Чтобы сократить затраты, автоматическое завершение работы виртуальной машины разработки установлено на 19:00 по тихоокеанскому времени. Возможно, потребуется изменить это время в зависимости от расположения и расписания работы. Чтобы изменить расписание завершения работы, сделайте следующее:

1. На портале Azure перейдите к виртуальной машине, созданной с помощью скрипта.

1. В меню панели слева в разделе **Операции** щелкните **Автозавершение работы**.

1. Измените параметры **Запланированное завершение работы** и **Часовой пояс** и нажмите кнопку **Сохранить**.

## <a name="connect-to-the-development-vm"></a>Подключение к виртуальной машине разработки

Теперь, когда мы создали виртуальную машину, нужно завершить установку программного обеспечения, необходимого для работы с этим руководством.

1. Дважды щелкните RDP-файл, созданный с помощью скрипта на рабочем столе.

1. Откроется диалоговое окно, информирующее о том, что издатель удаленного подключения неизвестен. Это допустимо, поэтому нажмите кнопку **Подключить**.

1. Укажите пароль администратора, который вы задали при создании виртуальной машины, и нажмите кнопку **ОК**.

1. Вам будет предложено принять сертификат для виртуальной машины. Выберите **Да**.

## <a name="install-visual-studio-code-extensions"></a>Установка расширений Visual Studio Code

Теперь, когда вы подключились к компьютеру для разработки, добавьте несколько полезных расширений в Visual Studio Code, чтобы упростить разработку.

1. Подключитесь к виртуальной машине разработки, откройте окно PowerShell и перейдите в каталог **C:\source\IoTEdgeAndMlSample\DevVM** Этот каталог создан с помощью того же скрипта, что и виртуальная машина.

    ```powershell
    cd C:\source\IoTEdgeAndMlSample\DevVM
    ```

1. Выполните приведенную ниже команду, чтобы разрешить выполнение скриптов. Выберите **Да для всех** при появлении запроса.

    ```powershell
    Set-ExecutionPolicy Bypass -Scope Process
    ```

1. Запустите скрипт расширений Visual Studio Code.

    ```powershell
    .\Enable-CodeExtensions.ps1
    ```

1. D течение нескольких минут с помощью скрипта будут установлены следующие расширения VS Code:

    * Средства Azure IoT
    * Python
    * C#
    * Docker
    * PowerShell

## <a name="set-up-iot-hub-and-storage"></a>Настройка Центра Интернета вещей и службы хранилища

Эти действия обычно выполняет разработчик облака.

Центр Интернета вещей Azure — это основа любого приложения Интернета вещей, которая обеспечивает безопасную связь между устройствами Интернета вещей и облаком. Это основной координационный пункт для работы решения IoT Edge для машинного обучения.

* Центр Интернета вещей использует маршруты для направления входящих данных с устройств Интернета вещей в другие подчиненные службы. Мы используем маршруты Центра Интернета вещей для отправки данных устройства в службу хранилища Azure. Здесь данные может использовать Машинное обучение Azure для обучения нашего классификатора оставшегося срока полезного использования (RUL).

* Далее в рамках этого руководстве мы будем использовать Центр Интернета вещей для настройки нашего устройства Azure IoT Edge и управления им.

В рамках этого раздела используется скрипт для создания Центра Интернета вещей Azure и учетной записи службы хранилища Azure. Затем на портале Azure настраивается маршрут, по которому данные, полученные центром, перенаправляются в контейнер службы хранилища Azure. Эти действия занимают около 10 минут.

1. Подключитесь к виртуальной машине разработки, откройте окно PowerShell и перейдите в каталог **IoTHub**.

    ```powershell
    cd C:\source\IoTEdgeAndMlSample\IoTHub
    ```

1. Запустите скрипт создания. Используйте те же значения идентификатора подписки, расположения и группы ресурсов, что и при создании виртуальной машины для разработки.

    ```powershell
    .\New-HubAndStorage.ps1 -SubscriptionId <subscription id> -Location <location> -ResourceGroupName <resource group>
    ```

    * Вам будет предложено войти в Azure.
    * Скрипт подтверждает сведения для создания Центра и учетной записи хранения. Нажмите клавишу **Y** или **ВВОД**, чтобы продолжить.

Выполнение сценария занимает около двух минут. По завершении скрипт выводит имя центра Интернета вещей и учетную запись хранения.

## <a name="review-route-to-storage-in-iot-hub"></a>Просмотр маршрута для хранения в Центре Интернета вещей

В ходе создания Центра Интернета вещей с помощью скрипта, который мы запускали в предыдущем разделе, также были созданы пользовательская конечная точка и маршрут. Маршруты Центра Интернета вещей состоят из выражения запроса и конечной точки. Если сообщение соответствует выражению, данные отправляются по маршруту в соответствующую конечную точку. Конечными точками могут быть Центры событий, очереди Служебной шины и разделы. В этом случае конечной точкой является контейнер BLOB-объектов в учетной записи хранения. На портале Azure можно просмотреть маршрут, созданный нашим скриптом.

1. Откройте [портал Azure](https://portal.azure.com) и перейдите к группе ресурсов, которую вы используете для работы с этим руководством.

1. В списке ресурсов выберите Центр Интернета вещей, созданный с помощью скрипта. Имя центра будет заканчиваться случайными символами, например `IotEdgeAndMlHub-jrujej6de6i7w`.

1. В меню панели слева в разделе **Messaging** (Сообщения) выберите вкладку **Маршрутизация сообщений**.

1. На странице **Маршрутизация сообщений** выберите вкладку **Пользовательские конечные точки**.

1. Разверните раздел **Хранение**:

   ![Проверка наличия элемента turbofanDeviceStorage в списке пользовательских конечных точек](media/tutorial-machine-learning-edge-02-prepare-environment/custom-endpoints.png)

   Элемент **turbofanDeviceStorage** отображается в списке пользовательских конечных точек. Обратите внимание на следующие характеристики этой конечной точки:

   * Она указывает на контейнер хранилища BLOB-объектов, созданный с помощью `devicedata`, как указано в столбце **Имя контейнера**.
   * В столбце **Формат имени файла** последний элемент имени — partition. Мы считаем этот формат более удобным для файловых операций, которые мы будем выполнять с Записными книжками Azure позже в рамках этого руководства.
   * Состояние конечной точки должно иметь значение **Работоспособна**.

1. Выберите вкладку **Маршруты**.

1. Выберите маршрут с именем **turbofanDeviceDataToStorage**.

1. Обратите внимание, что на странице **Сведения о маршрутизации** конечной точкой маршрута является **turbofanDeviceStorage**.

   ![Просмотр сведений о маршруте turbofanDeviceDataToStorage.](media/tutorial-machine-learning-edge-02-prepare-environment/route-details.png)

1. Просмотрите раздел **Маршрутизация запроса**, в котором задано значение **true**. Это означает, что все сообщения телеметрии устройства будут соответствовать этому маршруту, и, следовательно, все сообщения будут отправлены в конечную точку **turbofanDeviceStorage**.

1. Так как нет внесенных изменений, просто закройте эту страницу.

## <a name="clean-up-resources"></a>Очистка ресурсов

Этот учебник является частью серии статей, каждая из которых продолжает предыдущую. Не очищайте ресурсы, пока не завершите работу с последним учебником.

## <a name="next-steps"></a>Дальнейшие действия

В рамках этой статьи мы создали Центр Интернета вещей и настроили маршрут к учетной записи хранения Azure. В рамках следующей статьи мы отправим данные из набора имитированных устройств через Центр Интернета вещей в учетную запись хранения. Далее в рамках этого руководства мы вернемся к маршрутам и познакомимся подробнее с запросами маршрутизации после того, как настроим устройство и модули IoT Edge.

Чтобы создать имитированное устройство для мониторинга, перейдите к следующей статье.

> [!div class="nextstepaction"]
> [Создание данных об устройстве](tutorial-machine-learning-edge-03-generate-data.md)
