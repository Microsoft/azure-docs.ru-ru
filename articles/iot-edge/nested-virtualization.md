---
title: Вложенная виртуализация для Azure IoT Edge для Linux в Windows | Документация Майкрософт
description: Узнайте, как перемещаться по вложенной виртуализации в Azure IoT Edge для Linux в Windows.
author: fcabrera
manager: kgremban
ms.author: fcabrera
ms.date: 2/24/2021
ms.topic: conceptual
ms.service: iot-edge
services: iot-edge
monikerRange: =iotedge-2018-06
ms.openlocfilehash: 0e0021ec3564ca079f9ab02fe5ed3f0cfa5a1560
ms.sourcegitcommit: 772eb9c6684dd4864e0ba507945a83e48b8c16f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "104609655"
---
# <a name="nested-virtualization-for-azure-iot-edge-for-linux-on-windows"></a>Вложенная виртуализация для Azure IoT Edge для Linux в Windows
Существует две формы встроенной виртуализации, совместимые с Azure IoT Edge для Linux в Windows. Пользователи могут выбрать развертывание с помощью локальной виртуальной машины или виртуальной машины Azure. Эта статья поможет пользователям понять, какой вариант лучше подходит для своего сценария, и предоставить подробные сведения о требованиях к конфигурации.

> [!NOTE]
>
> Убедитесь, что для вложенной виртуализации включен один [параметр нетовркинг](/virtualization/hyper-v-on-windows/user-guide/nested-virtualization#networking-options) . Если этого не сделать, это приведет к ошибкам установки ЕФЛОВ. 

## <a name="deployment-on-local-vm"></a>Развертывание на локальной виртуальной машине
Это базовый подход для любой виртуальной машины Windows, на которой размещается Azure IoT Edge для Linux в Windows. В этом случае перед началом развертывания необходимо включить вложенную виртуализацию. Дополнительные сведения о настройке этого сценария см. [в статье запуск Hyper-V на виртуальной машине с вложенной виртуализацией](https://docs.microsoft.com/virtualization/hyper-v-on-windows/user-guide/nested-virtualization) .

Если вы используете Windows Server, убедитесь, что [установлена роль Hyper-V](https://docs.microsoft.com/windows-server/virtualization/hyper-v/get-started/install-the-hyper-v-role-on-windows-server).

## <a name="deployment-on-azure-vms"></a>Развертывание на виртуальных машинах Azure
Если вы решили выполнить развертывание на виртуальных машинах Azure, обратите внимание, что нет внешнего коммутатора по проекту. Azure IoT Edge для Linux в Windows также несовместимы на виртуальной машине Azure под управлением SKU сервера, если не выполняется специальный сценарий, который включает параметр по умолчанию. Дополнительные сведения о включении параметра по умолчанию см. в [разделе Windows Server](#windows-server) ниже. 

> [!NOTE]
>
> Все виртуальные машины Azure, на которых предполагается разместить ЕФЛОВ, должны быть виртуальной машиной, [поддерживающей вложенную виртуализацию](../virtual-machines/acu.md) .


## <a name="limited-use-of-external-switch"></a>Ограниченное использование внешнего коммутатора
В любом сценарии, в котором виртуальная машина не может получить IP-адрес с помощью внешнего коммутатора, функция развертывания автоматически использует для развертывания внутренний коммутатор по умолчанию. Это означает, что Управление Azure IoT Edge для виртуальной машины Linux может выполняться только на целевом устройстве (т. е. подключение к Azure IoT Edge для виртуальной машины Linux через расширение SSH ВАК PowerShell возможно только на localhost).

## <a name="windows-server"></a>Windows Server
Для пользователей Windows Server Обратите внимание, что Azure IoT Edge для Linux в Windows не поддерживает параметр по умолчанию автоматически.

* Последствия для локальной виртуальной машины: Убедитесь, что виртуальная машина ЕФЛОВ может получить IP-адрес через внешний коммутатор.

* Последствия для виртуальной машины Azure. Поскольку внешний коммутатор на виртуальных машинах Azure отсутствует, развернуть ЕФЛОВ перед настройкой внутреннего коммутатора на сервере невозможно.

По умолчанию на SKU сервера нет коммутатора (независимо от того, работает ли номер SKU сервера на виртуальной машине Azure). При развертывании на виртуальной машине Azure, где внешний коммутатор не может быть использован, коммутатор по умолчанию необходимо настроить и настроить вручную перед Azure IoT Edge для развертывания Linux в Windows. Наши функции развертывания посвящены этому, так как для внутреннего коммутатора требуется IP-конфигурация, конфигурация NAT, установка и настройка DHCP-сервера. Наши функции развертывания в общедоступной предварительной версии, не подправлять с этими параметрами, не могут нарушать сетевые конфигурации в продуктивном развертывании.

* Дополнительные сведения о настройке параметра по умолчанию вручную можно найти здесь: [как включить вложенную виртуализацию на виртуальных машинах Azure](https://docs.microsoft.com/azure/virtual-machines/windows/nested-virtualization) .
* Документацию по настройке DHCP-сервера для этого сценария можно найти здесь: [развертывание DHCP с помощью Windows PowerShell](https://docs.microsoft.com/windows-server/networking/technologies/dhcp/dhcp-deploy-wps)
