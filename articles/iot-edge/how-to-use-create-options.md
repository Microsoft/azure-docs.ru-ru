---
title: Запись Креатеоптионс для модулей — Azure IoT Edge | Документация Майкрософт
description: Как использовать Креатеоптионс в манифесте развертывания для настройки модулей во время выполнения
keywords: ''
author: kgremban
manager: philmea
ms.author: kgremban
ms.date: 04/01/2020
ms.topic: conceptual
ms.service: iot-edge
services: iot-edge
ms.openlocfilehash: 055b89858fde901ab014e409fbe30c3438efce12
ms.sourcegitcommit: c27a20b278f2ac758447418ea4c8c61e27927d6a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/03/2021
ms.locfileid: "101732995"
---
# <a name="how-to-configure-container-create-options-for-iot-edge-modules"></a>Настройка параметров создания контейнера для модулей IoT Edge

Параметр **креатеоптионс** в манифесте развертывания позволяет настраивать контейнеры модуля во время выполнения. Этот параметр расширяет возможности управления модулями и позволяет выполнять такие задачи, как разрешение или запрещение доступа модуля к ресурсам ведущего устройства или Настройка сети.

IoT Edge модули реализуются на устройстве IoT Edge как контейнеры, совместимые с DOCKER. DOCKER предлагает множество вариантов создания контейнеров, и эти параметры применимы к IoT Edgeным модулям. Дополнительные сведения см. в разделе [Параметры создания контейнера DOCKER](https://docs.docker.com/engine/api/v1.32/#operation/ContainerCreate).

## <a name="format-create-options"></a>Формат параметров создания

Манифест развертывания IoT Edge принимает параметры Create в формате JSON. Например, возьмем параметры создания, автоматически включаемые для каждого модуля edgeHub:

```json
"createOptions": {
  "HostConfig": {
    "PortBindings": {
      "5671/tcp": [
        {
          "HostPort": "5671"
        }
      ],
      "8883/tcp": [
        {
          "HostPort": "8883"
        }
      ],
      "443/tcp": [
        {
          "HostPort": "443"
        }
      ]
    }
  }
}
```

В этом примере edgeHub используется параметр **хостконфиг. портбиндингс** , позволяющий сопоставлять предоставленные порты в контейнере с портом на устройстве узла.

Если вы используете расширения средств Azure IoT для Visual Studio или Visual Studio Code, вы можете записать параметры Create в формате JSON в **deployment.template.js** файла. Затем при использовании расширения для создания IoT Edge решения или создания манифеста развертывания он будет stringify JSON в формате, который ожидает среда выполнения IoT Edge. Пример.

```json
"createOptions": "{\"HostConfig\":{\"PortBindings\":{\"5671/tcp\":[{\"HostPort\":\"5671\"}],\"8883/tcp\":[{\"HostPort\":\"8883\"}],\"443/tcp\":[{\"HostPort\":\"443\"}]}}}"
```

Одним из советов по написанию параметров создания является использование `docker inspect` команды. В рамках процесса разработки запустите модуль локально с помощью `docker run <container name>` . После того, как модуль будет работать, выполните команду `docker inspect <container name>` . Эта команда выводит сведения о модуле в формате JSON. Найдите настроенные параметры и скопируйте JSON. Пример.

[![Результаты проверки edgeHub для DOCKER](./media/how-to-use-create-options/docker-inspect-edgehub-inline-and-expanded.png)](./media/how-to-use-create-options/docker-inspect-edgehub-inline-and-expanded.png#lightbox)

## <a name="common-scenarios"></a>Распространенные сценарии

Параметры создания контейнера позволяют выполнять многие сценарии, но вот некоторые из них чаще всего возникают при создании IoT Edge решений.

* [Предоставление модулям доступа к хранилищу узла](how-to-access-host-storage-from-module.md)
* [Сопоставьте порт узла с портом модуля](#map-host-port-to-module-port)
* [Ограничение использования памяти и ЦП модуля](#restrict-module-memory-and-cpu-usage)

### <a name="map-host-port-to-module-port"></a>Сопоставьте порт узла с портом модуля

Если модулю необходимо взаимодействовать со службой за пределами IoT Edgeного решения и для этого не используется маршрутизация сообщений, то необходимо сопоставлять порт узла с портом модуля.

>[!TIP]
>Это сопоставление портов не требуется для обмена данными между модулями на одном устройстве. Если модулю A требуется запрашивать API, размещенный на модуле б, он может сделать это без сопоставления портов. Модуль б должен предоставлять порт в своем dockerfile, например: `EXPOSE 8080` . Затем модуль A может запросить API, используя имя модуля B, например: `http://ModuleB:8080/api` .

Во-первых, убедитесь, что порт внутри модуля открыт для прослушивания подключений. Это можно сделать с помощью инструкции [раскрыть](https://docs.docker.com/engine/reference/builder/#expose) в dockerfile. Например, `EXPOSE 8080`. Если значение не указано, по умолчанию используется инструкция предоставить протоколу TCP. также можно указать UDP.

Затем используйте параметр **портбиндингс** в группе **хостконфиг** [контейнера DOCKER параметры Create](https://docs.docker.com/engine/api/v1.32/#operation/ContainerCreate) , чтобы подключить предоставленный порт в модуле к порту на устройстве узла. Например, если вы предоставляли порт 8080 внутри модуля и хотите соотнести его с портом 80 главного устройства, параметры Create в template.jsдля файла будут выглядеть, как в следующем примере:

```json
"createOptions": {
  "HostConfig": {
    "PortBindings": {
      "8080/tcp": [
        {
          "HostPort": "80"
        }
      ]
    }
  }
}
```

После переведенные для манифеста развертывания такая же конфигурация будет выглядеть, как в следующем примере:

```json
"createOptions": "{\"HostConfig\":{\"PortBindings\":{\"8080/tcp\":[{\"HostPort\":\"80\"}]}}}"
```

### <a name="restrict-module-memory-and-cpu-usage"></a>Ограничение использования памяти и ЦП модуля

Можно объявить, какая часть ресурсов узла может использовать модуль. Этот элемент управления полезен для того, чтобы один модуль не использовал слишком много памяти или ЦП и не блокировал выполнение других процессов на устройстве. Вы можете управлять этими параметрами с помощью [контейнера DOCKER создать параметры](https://docs.docker.com/engine/api/v1.32/#operation/ContainerCreate) в группе **хостконфиг** , включая:

* **Память**: ограничение памяти в байтах. Например, 268435456 байт = 256 МБ.
* **Меморисвап**: общий предел памяти (память + переключение). Например, 536870912 байт = 512 МБ
* **Кпупериод**: длина периода ЦП в микросекундах. Значение по умолчанию — 100000, поэтому, например, значение 25000 ограничивает контейнер до 25% ресурсов ЦП.

В template.jsформате эти значения будут выглядеть, как в следующем примере:

```json
"createOptions": {
  "HostConfig": {
    "Memory": 268435456,
    "MemorySwap": 536870912,
    "CpuPeriod": 25000
  }
}
```

После переведенные для окончательного манифеста развертывания эти значения будут выглядеть, как в следующем примере:

```json
"createOptions":"{\"HostConfig\":{\"Memory\":268435456,\"MemorySwap\":536870912,\"CpuPeriod\":25000}}"
```

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные примеры создания параметров в действии см. в следующих IoT Edge примерах.

* [Пользовательское визуальное распознавание и Azure IoT Edge на Raspberry Pi 3](https://github.com/Azure-Samples/custom-vision-service-iot-edge-raspberry-pi)
* [Пример хранилища BLOB-объектов Azure IoT Edge](https://github.com/Azure-Samples/azure-iotedge-blobstorage-sample)
