---
title: Руководство по обучению и развертыванию моделей Машинного обучения в Azure IoT Edge
description: Работая с этим руководством, вы обучите модель машинного обучения с помощью Машинного обучения Azure, а затем упакуете модель в образ контейнера, который можно развернуть как модуль Azure IoT Edge.
author: kgremban
manager: philmea
ms.author: kgremban
ms.date: 3/24/2020
ms.topic: tutorial
ms.service: iot-edge
services: iot-edge
ms.openlocfilehash: 16d5fe90be71f39d448e4c1ce10c0373f6bfc86c
ms.sourcegitcommit: f28ebb95ae9aaaff3f87d8388a09b41e0b3445b5
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/30/2021
ms.locfileid: "103463108"
---
# <a name="tutorial-train-and-deploy-an-azure-machine-learning-model"></a>Руководство по Обучение и развертывание модели машинного обучения Azure

[!INCLUDE [iot-edge-version-201806](../../includes/iot-edge-version-201806.md)]

В этой статье описаны следующие задачи:

* обучение модели машинного обучения с помощью Студии машинного обучения Azure;
* упаковка обученной модели в образ контейнера;
* развертывание образа контейнера в качестве модуля Azure IoT Edge.

Студия машинного обучения — это основа для выполнения экспериментов, обучения и развертывания моделей машинного обучения.

Описанные в этой статье действия обычно выполняются специалистами по обработке и анализу данных.

Из этого раздела руководства вы узнаете, как:

> [!div class="checklist"]
> * создать записные книжки Jupyter в рабочей области Машинного обучения Azure, чтобы обучить модель машинного обучения;
> * создать контейнер для обученной модели машинного обучения;
> * создать модуль IoT Edge из контейнерной модели машинного обучения.

## <a name="prerequisites"></a>Предварительные требования

Эта статья входит в серию руководств по использованию Машинного обучения в IoT Edge. Каждая статья в серии основана на инструкциях, выполненных при работе с предыдущей статьей. Если вы нашли сразу эту статью, прочтите [первую статью](tutorial-machine-learning-edge-01-intro.md) этой серии.

## <a name="set-up-azure-machine-learning"></a>Настройка Машинного обучения Azure

Мы применим Студию машинного обучения для размещения двух записных книжек Jupyter и вспомогательных файлов. В этой статье показано, как создать и настроить проект Машинного обучения. Если вы еще не использовали Jupyter и Студию машинного обучения, ознакомьтесь с двумя вводными документами:

* **Jupyter Notebook:** [Работа с записными книжками Jupyter в Visual Studio Code](https://code.visualstudio.com/docs/python/jupyter-support)
* **Машинное обучение Azure:** [Руководство по началу работы с Машинным обучением Azure в Jupyter Notebook](../machine-learning/tutorial-1st-experiment-sdk-setup.md)

> [!NOTE]
> Завершив настройку службы, вы сможете обращаться к Машинному обучению с любого компьютера. Во время установки используйте виртуальную машину разработки, которая содержит все необходимые файлы.

### <a name="install-azure-machine-learning-visual-studio-code-extension"></a>Установка расширения Машинного обучения Azure для Visual Studio Code

Это расширение для Visual Studio Code должно быть установлено на виртуальной машине разработки. Если вы используете другой экземпляр, переустановите расширение, как описано в статье [Настройка расширения Машинного обучения Azure для Visual Studio Code (предварительная версия)](../machine-learning/tutorial-setup-vscode-extension.md).

### <a name="create-an-azure-machine-learning-account"></a>Создание учетной записи Машинного обучения Azure

Чтобы подготавливать ресурсы и выполнять рабочие нагрузки в Azure, выполните вход с учетной записью Azure.

1. В Visual Studio Code откройте палитру команд, выбрав **Вид** > **Палитра команд** в строке меню.

1. Введите команду `Azure: Sign In` в палитре команд, чтобы начать процесс входа. Следуйте инструкциям, чтобы выполнить вход.

1. Создайте вычислительный экземпляр Машинного обучения, чтобы выполнять в нем рабочую нагрузку. В палитре команд введите команду `Azure ML: Create Compute`.
1. Выберите подписку Azure.
1. Выберите **+ Create new Azure ML Workspace** (+ Создать новую рабочую область Машинного обучения Azure) и введите имя **turbofandemo**.
1. Выберите группу ресурсов, которую вы используете для этого примера.
1. Ход создания рабочей области можно контролировать в нижнем правом углу окна Visual Studio Code в разделе **Creating Workspace: turobofandemo** (Создание рабочей области: turobofandemo). На выполнение этого шага потребуется пара минут.
1. Дождитесь успешного создания рабочей области. Должно появиться сообщение **Рабочая область машинного обучения Azure turbofandemo создана**.

### <a name="upload-jupyter-notebook-files"></a>Отправка файлов Jupyter Notebook

Мы отправим примеры файлов записной книжки в новую рабочую область Машинного обучения.

1. Откройте сайт ml.azure.com и выполните вход.
1. Выберите каталог Майкрософт, подписку Azure и только что созданную рабочую область Машинного обучения.

    :::image type="content" source="media/tutorial-machine-learning-edge-04-train-model/select-studio-workspace.png" alt-text="Снимок экрана, на котором показан выбор рабочей области Машинного обучения Azure." :::

1. Выполнив вход в рабочую область Машинного обучения, перейдите к разделу **Записные книжки** через меню в левой части.
1. Выберите вкладку **Мои файлы**.

1. Выберите **Отправить** (значок со стрелкой вверх).

1. Перейдите в папку **C:\source\IoTEdgeAndMlSample\AzureNotebooks**. Выберите все файлы в этой папке и щелкните **Открыть**.

1. Установите флажок **I trust the content of these files** (Я доверяю содержимому этих файлов).

1. Щелкните **Отправить**, чтобы начать отправку. Когда процесс успешно завершится, нажмите кнопку **Готово**.

### <a name="jupyter-notebook-files"></a>Файлы Jupyter Notebook

Теперь мы проверим файлы, отправленные в рабочую область Машинного обучения. Действия в этой части руководства касаются двух файлов записных книжек, с которыми используется несколько вспомогательных файлов.

* **01-turbofan\_regression.ipynb.** В этой записной книжке для создания и запуска эксперимента машинного обучения используется рабочая область Машинного обучения. В целом записная книжка выполняет такие действия:

  1. Скачивает данные из учетной записи хранения Azure, созданной с помощью окружения устройства.
  1. Анализирует и подготавливает данные, а затем применяет их для обучения модели классификатора.
  1. Оценивает модель, полученную входе эксперимента, по тестовому набору данных (Test\_FD003.txt).
  1. Публикует лучшую модель классификатора в рабочей области Машинного обучения.

* **02-turbofan\_deploy\_model.ipynb.** Эта записная книжка принимает модель, созданную в предыдущей записной книжке, и создает на ее основе образ контейнера, готовый для развертывания на устройстве IoT Edge. Записная книжка выполняет следующие действия:

  1. Создает скрипт для оценки модели.
  1. Создает образ контейнера, используя модель классификатора, сохраненную в рабочей области Машинного обучения.
  1. Развертывает этот образ в качестве веб-службы в Экземплярах контейнеров Azure.
  1. С помощью веб-службы проверяет, правильно ли работают модель и образ. Проверенный образ будет развернут на устройстве IoT Edge, как описано в статье [Tutorial: Create and deploy custom IoT Edge modules](tutorial-machine-learning-edge-06-custom-modules.md) (Руководство. Создание и развертывание настраиваемых модулей IoT Edge).

* **Test\_FD003.txt.** Этот файл содержит данные, которые мы будем использовать в качестве тестового набора для проверки обученного классификатора. Для простоты мы решили использовать в качестве тестового набора тестовые данные, предоставленные для исходной проверки.
* **RUL\_FD003.txt.** Этот файл содержит значение оставшегося срока полезного использования (RUL) для последнего цикла каждого устройства в файле Test\_FD003.txt. Подробное описание этих данных вы найдете в файлах readme.txt и Damage Propagation Modeling.pdf, расположенных в папке C:\\source\\IoTEdgeAndMlSample\\data\\Turbofan.
* **Utils.py.** Этот файл содержит набор функций Python для работы с данными. Первая записная книжка содержит подробное описание функций.
* **README.md**. В этом файле сведений описывается использование записных книжек.

## <a name="run-the-jupyter-notebooks"></a>Выполнение записных книжек Jupyter

Теперь, когда рабочая область создана, можно запустить записные книжки.

1. На странице **Мои файлы** выберите **01-turbofan\_regression.ipynb**.

    :::image type="content" source="media/tutorial-machine-learning-edge-04-train-model/select-turbofan-notebook.png" alt-text="Снимок экрана, на котором показан выбор первой записной книжки для выполнения.":::

1. Если для записной книжки указано значение **Not Trusted** (Нет доверия), щелкните мини-приложение **Not Trusted** (Нет доверия) в правом верхнем углу записной книжки. В открывшемся диалоговом окне щелкните **Trust** (Доверять).

1. Для получения лучших результатов прочитайте документацию по каждой ячейке и запустите каждую отдельно. Выберите **Запустить** на панели инструментов. Позже вам будет удобнее запускать несколько ячеек. Предупреждения об обновлении и устаревании можно игнорировать.

    Для выполняющейся ячейки отображается звездочка в квадратных скобках ([\*]). Когда завершается выполнение ячейки, эта звездочка заменяется числом и могут отобразиться соответствующие выходные данные. Ячейки в записной книжке размещаются последовательно, и выполняться в любой момент может только одна из них.

    Можно также использовать действия запуска из меню **Ячейка**. Нажмите сочетание клавиш **CTRL+ВВОД**, чтобы выполнить ячейку, или **SHIFT+ВВОД**, чтобы выполнить ячейку и перейти к следующей.

    > [!TIP]
    > Для согласованного выполнения операций с ячейками не следует запускать одну и ту же записную книжку из нескольких вкладок в браузере.

1. В ячейке, которая расположена после инструкций **Set global properties** (Настройка глобальных свойств), введите значения для подписки, настроек и ресурсов Azure. Затем запустите ячейку.

    ![Снимок экрана, на котором показано, как задать глобальные свойства в записной книжке.](media/tutorial-machine-learning-edge-04-train-model/set-global-properties.png)

1. В ячейке перед элементом **Workspace details** (Сведения о рабочей области) после выполнения найдите ссылку с предложением войти для проверки подлинности.

    ![Снимок экрана, на котором показан запрос на вход для проверки подлинности устройства.](media/tutorial-machine-learning-edge-04-train-model/sign-in-prompt.png)

    Откройте эту ссылку и введите указанный код. Эта процедура входа проверяет полномочия записной книжки Jupyter на доступ к ресурсам Azure через кроссплатформенный интерфейс командной строки Microsoft Azure.

    ![Снимок экрана, на котором показано подтверждение в приложении проверки подлинности на устройстве.](media/tutorial-machine-learning-edge-04-train-model/cross-platform-cli.png)

1. В ячейке, предшествующей **Explore the results** (Изучить результаты), скопируйте значение из идентификатора выполнения и вставьте его для идентификатора выполнения в ячейку, следующую после **Reconstitute a run** (Воссоздать выполнение).

   ![Снимок экрана, на котором показано копирование идентификатора запуска между ячейками.](media/tutorial-machine-learning-edge-04-train-model/automl-id.png)

1. Выполните оставшиеся ячейки в записной книжке.

1. Сохраните записную книжку и вернитесь на страницу проекта.

1. Откройте **02-turbofan\_deploy\_model.ipynb** и запустите каждую ячейку. Для проверки подлинности необходимо выполнить вход в ячейке, следующей после **Configure workspace** (Настройка рабочей области).

1. Сохраните записную книжку и вернитесь на страницу проекта.

### <a name="verify-success"></a>Проверка успешного выполнения

Чтобы убедиться, что выполнение записных книжек успешно завершено, проверьте, созданы ли определенные элементы.

1. На вкладке **Мои файлы** для записных книжек Машинного обучения щелкните **Обновить**.

1. Убедитесь, что здесь созданы следующие файлы.

    | Файл | Описание |
    | --- | --- |
    | ./aml_config/.azureml/config.json | Файл конфигурации, с помощью которого создается рабочая область Машинного обучения. |
    | ./aml_config/model_config.json | Файл конфигурации, который потребуется для развертывания модели в рабочей области Машинного обучения **turbofanDemo** в Azure. |
    | myenv.yml| Содержит сведения о зависимостях развернутой модели машинного обучения.|

1. Убедитесь, что созданы следующие ресурсы Azure. К некоторым именам ресурсов добавляются случайные символы.

    | Ресурс Azure | Имя |
    | --- | --- |
    | Рабочая область службы "Машинное обучение Azure" | turborfanDemo |
    | Реестр контейнеров Azure | turbofandemoxxxxxxxx |
    | Application Insights | turbofaninsightxxxxxxxx |
    | Хранилище ключей Azure; | turbofankeyvaultbxxxxxxxx |
    | Хранилище Azure | turbofanstoragexxxxxxxxx |

### <a name="debugging"></a>Отладка

В записную книжку для отладки можно вставить инструкции Python, например команду `print()` для отображения значений. Если здесь отображаются переменные или объекты, которые не определены, выполните ячейки, в которых они впервые объявляются или в которых создается их экземпляр.

Для повторного выполнения записных книжек, возможно, потребуется удалить ранее созданные файлы и ресурсы Azure.

## <a name="clean-up-resources"></a>Очистка ресурсов

Этот учебник является частью серии статей, каждая из которых продолжает предыдущую. Не очищайте ресурсы, пока не завершите работу с последним учебником.

## <a name="next-steps"></a>Дальнейшие действия

В этой статье мы применили две записные книжки Jupyter, работающие в Студии машинного обучения, чтобы на основе данных от устройств с турбовентиляторным двигателем выполнить следующие операции:

- обучение классификатора RUL;
- сохранение классификатора в формате модели;
- создание образа контейнера;
- развертывание образа в виде веб-службы и ее тестирование.

Переходите к следующей статье, где вы создадите устройство IoT Edge.

> [!div class="nextstepaction"]
> [Tutorial: Configure an IoT Edge device](tutorial-machine-learning-edge-05-configure-edge-device.md) (Руководство. Настройка устройства IoT Edge)