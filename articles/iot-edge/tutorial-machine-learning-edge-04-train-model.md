---
title: Руководство по обучению и развертыванию моделей Машинного обучения в Azure IoT Edge
description: Работая с этим учебником, вы обучите модель машинного обучения с помощью Службы машинного обучения Azure, а затем упакуете модель в виде образа контейнера, который можно развернуть как модуль Azure IoT Edge.
author: kgremban
manager: philmea
ms.author: kgremban
ms.date: 3/24/2020
ms.topic: tutorial
ms.service: iot-edge
services: iot-edge
ms.openlocfilehash: 2cc96db88d9a2aec02de5e2fc4ed18b445972e7b
ms.sourcegitcommit: aacbf77e4e40266e497b6073679642d97d110cda
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/12/2021
ms.locfileid: "98121156"
---
# <a name="tutorial-train-and-deploy-an-azure-machine-learning-model"></a>Руководство по Обучение и развертывание модели машинного обучения Azure

В этой статье описаны следующие задачи:

* обучение модели машинного обучения с помощью Студии машинного обучения Azure;
* упаковка обученной модели в образ контейнера;
* развертывание образа контейнера в качестве модуля Azure IoT Edge.

Студия машинного обучения Azure — это основа для выполнения экспериментов, обучения и развертывания моделей машинного обучения.

Описанные в этой статье действия обычно выполняются специалистами по обработке и анализу данных.

Из этого раздела учебника, вы узнаете, как:

> [!div class="checklist"]
> * Создайте записные книжки Jupyter Notebook в рабочей области машинного обучения Azure, чтобы обучить модель машинного обучения.
> * создать контейнер для обученной модели машинного обучения;
> * создать модуль Azure IoT Edge из контейнерной модели машинного обучения.

## <a name="prerequisites"></a>Предварительные требования

Эта статья входит в серию учебников по использованию Машинного обучения Azure в IoT Edge. Каждая статья в серии основана на инструкциях, выполненных при работе с предыдущей статьей. Если вы приступили сразу к этой статье, перейдите на [первую статью](tutorial-machine-learning-edge-01-intro.md) серии.

## <a name="set-up-azure-machine-learning"></a>Настройка Машинного обучения Azure 

Мы используем Студию Машинного обучения Azure для размещения двух записных книжек Jupyter Notebook и вспомогательных файлов. В этой статье показано, как создать и настроить проект Машинного обучения Azure. Если вы впервые используете Jupyter и (или) Студию машинного обучения Azure, ознакомьтесь с приведенными ниже документами:

* **Jupyter Notebook:** [Работа с записными книжками Jupyter Notebook в Visual Studio Code](https://code.visualstudio.com/docs/python/jupyter-support)
* **Машинное обучение Azure:** [Начало работы с Машинным обучением Azure в записных книжках Jupyter Notebook](../machine-learning/tutorial-1st-experiment-sdk-setup.md)


> [!NOTE]
> После настройки вы сможете получить доступ к Службе машинного обучения Azure с любого компьютера. Во время установки используйте виртуальную машину разработки, которая содержит все необходимые файлы.

### <a name="install-azure-machine-learning-visual-studio-code-extension"></a>Установка расширения Машинного обучения Azure для Visual Studio Code
Это расширение должно быть установлено для VS Code на виртуальной машине разработки. Если вы используете другой экземпляр, переустановите расширение, как описано [здесь](../machine-learning/tutorial-setup-vscode-extension.md).

### <a name="create-an-azure-machine-learning-account"></a>Создание учетной записи Машинного обучения Azure  
Чтобы подготавливать ресурсы и выполнять рабочие нагрузки в Azure, необходимо выполнить вход с учетной записью Azure.

1. В Visual Studio Code откройте палитру команд, выбрав **Вид** > **Палитра команд** в строке меню. 

1. Введите команду `Azure: Sign In` в палитру команд, чтобы начать процесс входа. Следуйте инструкциям, чтобы выполнить вход. 

1. Создайте экземпляр Вычислительной среды Машинного обучения Azure для выполнения рабочей нагрузки. Используя палитру команд, введите команду `Azure ML: Create Compute`. 
1. Выбор подписки Azure
1. Выберите **+ Создать новую рабочую область машинного обучения Azure** и введите имя `turbofandemo`.
1. Выберите группу ресурсов, которая использовалась для этого примера.
1. Ход создания рабочей области должен отображаться в правом нижнем углу окна VS Code: **Создание рабочей области: turbofandemo** (это может занять одну или две минуты). 
1. Дождитесь успешного создания рабочей области. Должно появиться сообщение **Рабочая область машинного обучения Azure turbofandemo создана**.


### <a name="upload-jupyter-notebook-files"></a>Отправка файлов Jupyter Notebook

Сейчас мы отправим примеры файлов записных книжек в новую рабочую область машинного обучения Azure.

1. Перейдите по адресу ml.azure.com и выполните вход.
1. Выберите каталог Майкрософт, подписку Azure и созданную рабочую область машинного обучения Azure.

    :::image type="content" source="media/tutorial-machine-learning-edge-04-train-model/select-studio-workspace.png" alt-text="Выберите рабочую область машинного обучения Azure." :::

1. Войдя в рабочую область машинного обучения Azure, перейдите в раздел **Записные книжки**, используя меню в левой части.
1. Выберите вкладку **Мои файлы**.

1. Выберите **Отправить** (значок со стрелкой вверх). 


1. Перейдите в папку **C:\source\IoTEdgeAndMlSample\AzureNotebooks**. Выберите все файлы в списке и щелкните **Открыть**.

1. Установите флажок **I trust the content of these files** (Я доверяю содержимому этих файлов).

1. Выберите **Отправить**, чтобы начать передачу, а затем щелкните **Готово** после завершения процесса.

### <a name="jupyter-notebook-files"></a>Файлы Jupyter Notebook

Давайте проверим файлы, отправленные в рабочую область машинного обучения Azure. Действия в этой части руководства касаются двух файлов записных книжек, с которыми используется несколько вспомогательных файлов.

* **01-turbofan\_regression.ipynb.** В этой записной книжке для создания и запуска эксперимента машинного обучения используется рабочая область машинного обучения. В целом записная книжка выполняет такие действия:

  1. Скачивает данные из учетной записи хранения Azure, созданной с помощью окружения устройства.
  1. Анализирует и подготавливает данные, а затем обучает на их основе модель классификатора.
  1. Оценивает модель из эксперимента с помощью тестового набора данных (Test\_FD003.txt).
  1. Публикует лучшую модель классификатора в рабочей области машинного обучения.

* **02-turbofan\_deploy\_model.ipynb.** Эта записная книжка принимает модель, созданную в предыдущей книжке, и использует ее для создания образа контейнера, готового для развертывания на устройстве Azure IoT Edge. Записная книжка выполняет следующие действия:

  1. Создает скрипт для оценки модели.
  1. Создает образ контейнера, используя модель классификатора, сохраненную в рабочей области машинного обучения.
  1. Развертывает образ в качестве веб-службы в экземпляре контейнера Azure.
  1. С помощью веб-службы проверяет, правильно ли работают модель и образ. Проверенный образ будет развернут на устройстве IoT Edge, как описано в статье [Tutorial: Create and deploy custom IoT Edge modules](tutorial-machine-learning-edge-06-custom-modules.md) (Руководство. Создание и развертывание настраиваемых модулей IoT Edge).

* **Test\_FD003.txt.** Файл, содержащий данные, которые мы будем использовать в качестве тестового набора при проверке обученного классификатора. Для простоты мы решили использовать в качестве тестового набора тестовые данные, предоставленные для исходной проверки.

* **RUL\_FD003.txt.** Файл, содержащий оставшийся срок полезного использования (RUL) для последнего цикла каждого устройства в файле Test\_FD003.txt. Подробное описание данных см. в файлах readme.txt и Damage Propagation Modeling.pdf в папке C:\\source\\IoTEdgeAndMlSample\\data\\Turbofan.

* **Utils.py.** Файл, содержащий набор функций Python для работы с данными. Первая записная книжка содержит подробное описание функций.

* **README.md.** Файл сведений, содержащий описание использования записных книжек.  

## <a name="run-jupyter-notebooks"></a>Выполнение Jupyter Notebook

Теперь, когда рабочая область создана, можно запустить записные книжки. 

1. На странице **Мои файлы** выберите **01-turbofan\_regression.ipynb**.

    :::image type="content" source="media/tutorial-machine-learning-edge-04-train-model/select-turbofan-notebook.png" alt-text="Выберите первую записную книжку для выполнения.":::

1. Если для записной книжки указано значение **Not Trusted** (Нет доверия), щелкните виджет **Not Trusted** (Нет доверия) в правом верхнем углу записной книжки. Когда появится диалоговое окно, выберите **Доверие**.

1. Для получения лучших результатов прочитайте документацию по каждой ячейке и запустите каждую отдельно. Выберите **Запустить** на панели инструментов. Позже вы сочтете целесообразным запустить несколько ячеек. Предупреждения об обновлении и устаревании можно игнорировать.

    Для выполняющейся ячейки отображается звездочка в квадратных скобках ([\*]). По завершении выполнения ячейки звездочка заменяется на число и могут отобразиться соответствующие выходные данные. Ячейки в записной книжке создаются последовательно и могут выполняться только по очереди.

    Можно также использовать команды выполнения из меню **Ячейка**, клавиши `Ctrl` + `Enter` для выполнения ячейки и `Shift` + `Enter` для выполнения ячейки и перехода к следующей ячейке.

    > [!TIP]
    > Для согласованного выполнения операций с ячейками не следует запускать одну и ту же записную книжку из нескольких вкладок в браузере.

1. В ячейке, которая следует инструкциям **Set global properties** (Настройка глобальных свойств), запишите значения для вашей подписки, настроек и ресурсов Azure. Затем запустите ячейку.

    ![Раздел Set global properties (Настройка глобальных свойств) в записной книжке](media/tutorial-machine-learning-edge-04-train-model/set-global-properties.png)

1. В ячейке, предшествующей **сведениям о рабочей области** после того, как она запущена, найдите ссылку, которая инструктирует вас войти в систему для аутентификации:

    ![Запрос на вход для проверки подлинности устройства](media/tutorial-machine-learning-edge-04-train-model/sign-in-prompt.png)

    Откройте ссылку и введите указанный код. Эта процедура входа проверяет подлинность записной книжки Jupyter для доступа к ресурсам Azure с помощью кроссплатформенного интерфейса командной строки Microsoft Azure.  

    ![Подтверждение проверки подлинности приложения на устройстве](media/tutorial-machine-learning-edge-04-train-model/cross-platform-cli.png)

1. В ячейке, предшествующей **Explore the results** (Изучить результаты), скопируйте значение из идентификатора выполнения и вставьте его для идентификатора выполнения в ячейку, следующую после **Reconstitute a run** (Воссоздать выполнение).

   ![Копирование идентификатора запуска между ячейками](media/tutorial-machine-learning-edge-04-train-model/automl-id.png)

1. Выполните оставшиеся ячейки в записной книжке.

1. Сохраните записную книжку и вернитесь на страницу проекта.

1. Откройте **02-turbofan\_deploy\_model.ipynb** и запустите каждую ячейку. Для проверки подлинности в ячейке, следующей после **Настроить рабочую область** необходимо выполнить вход.

1. Сохраните записную книжку и вернитесь на страницу проекта.

### <a name="verify-success"></a>Проверка успешного выполнения

Чтобы убедиться, что выполнение записных книжек успешно завершено, проверьте, созданы ли определенные элементы.

1. На вкладке **Мои файлы** в записных книжках машинного обучения Azure выберите **Обновить**.

1. Проверьте, созданы ли такие файлы:

    | Файл | Описание |
    | --- | --- |
    | ./aml_config/.azureml/config.json | Файл конфигурации, с помощью которого создается рабочая область машинного обучения Azure. |
    | ./aml_config/model_config.json | Файл конфигурации, который потребуется для развертывания модели в рабочей области машинного обучения **turbofanDemo** в Azure. |
    | myenv.yml| Содержит сведения о зависимостях развернутой модели машинного обучения.|

1. Убедитесь, что созданы следующие ресурсы Azure. К некоторым именам ресурсов добавляются случайные символы.

    | Ресурс Azure | Имя |
    | --- | --- |
    | Рабочая область машинного обучения | turborfanDemo |
    | Реестр контейнеров | turbofandemoxxxxxxxx |
    | Applications Insights | turbofaninsightxxxxxxxx |
    | Key Vault | turbofankeyvaultbxxxxxxxx |
    | Память | turbofanstoragexxxxxxxxx |

### <a name="debugging"></a>Отладка

В записную книжку для отладки можно вставить инструкции Python, например команду `print()` для отображения значений. Если отображаются переменные или объекты, которые не определены, выполните ячейки, в которых они были впервые объявлены или созданы.

Если вам нужно будет перезапустить записные книжки, вам может понадобится удалить ранее созданные файлы и ресурсы Azure.

## <a name="clean-up-resources"></a>Очистка ресурсов

Этот учебник является частью серии статей, каждая из которых продолжает предыдущую. Не очищайте ресурсы, пока не завершите работу с последним учебником.

## <a name="next-steps"></a>Дальнейшие действия

В этой статье показано, как использовать две записные книжки Jupyter Notebook, выполняющиеся в Студии машинного обучения Azure, чтобы обучить классификатор оставшегося срока полезного использования (RUL) с помощью данных с турбореактивных устройств, сохранить классификатор в виде модели, создать образ контейнера, а также развернуть и протестировать образ в качестве веб-службы.

Переходите к следующей статье, где вы создадите устройство IoT Edge.

> [!div class="nextstepaction"]
> [Tutorial: Configure an IoT Edge device](tutorial-machine-learning-edge-05-configure-edge-device.md) (Руководство. Настройка устройства IoT Edge)