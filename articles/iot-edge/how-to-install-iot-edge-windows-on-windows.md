---
title: Установка Azure IoT Edge для Windows | Документация Майкрософт
description: Установка Azure IoT Edge для контейнеров Windows на устройствах Windows
author: kgremban
manager: philmea
ms.reviewer: veyalla
ms.service: iot-edge
services: iot-edge
ms.topic: conceptual
ms.date: 12/18/2020
ms.author: kgremban
ms.openlocfilehash: 7857f93e8c767f270041bb6bf041447786ce19ff
ms.sourcegitcommit: 484f510bbb093e9cfca694b56622b5860ca317f7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/21/2021
ms.locfileid: "98634243"
---
# <a name="install-and-manage-azure-iot-edge-for-windows"></a>Установка Azure IoT Edge для Windows и управление ими

Azure IoT Edge для Windows выполняется непосредственно на размещающем устройстве Windows и использует контейнеры Windows для выполнения бизнес-логики на границе.

Среда выполнения Azure IoT Edge превращает устройство в устройство IoT Edge. Среду выполнения можно развернуть на всех устройствах — от небольшого Raspberry Pi до технического сервера. После настройки устройства с помощью среды выполнения IoT Edge можно приступить к развертыванию в ней бизнес-логики из облака. Дополнительные сведения см. [в разделе Знакомство со средой выполнения Azure IOT EDGE и ее архитектурой](iot-edge-runtime.md).

>[!NOTE]
>Azure IoT Edge для Windows не будет поддерживаться начиная с версии 1.2.0 Azure IoT Edge.
>
>Рассмотрите возможность использования нового метода для запуска IoT Edge на устройствах Windows, Azure IoT Edge для Linux в Windows.

<!-- TODO: link to EFLOW-->

Настройка устройства IoT Edge выполняется в два этапа. Первым шагом является установка среды выполнения и ее зависимостей. Вторым шагом является подключение устройства к удостоверению в облаке и Настройка проверки подлинности с помощью центра Интернета вещей.

В этой статье перечислены действия по установке среды выполнения Azure IoT Edge на устройствах Windows. При установке среды выполнения можно выбрать использование контейнеров Linux или контейнеров Windows. В настоящее время в рабочих сценариях поддерживаются только контейнеры Windows в Windows. Контейнеры Linux в Windows полезны для сценариев разработки и тестирования, особенно при разработке на компьютере под управлением Windows для развертывания на устройствах Linux.

## <a name="prerequisites"></a>Предварительные требования

* Устройство Windows

  Для IoT Edge с контейнерами Windows требуется версия Windows 1809/Build 17762, которая является последней [сборкой долгосрочной поддержки Windows](/windows/release-information/). Для сценариев разработки и тестирования любой SKU (Pro, Enterprise, Server и т. д.), поддерживающий функцию контейнеров, будет работать. Однако перед переходом в рабочую среду обязательно ознакомьтесь со [списком поддерживаемых систем](support.md#operating-systems) .

  IoT Edge с контейнерами Linux могут работать в любой версии Windows, которая соответствует [требованиям для работы с DOCKER Desktop](https://docs.docker.com/docker-for-windows/install/#what-to-know-before-you-install).

* Поддержка контейнеров на устройстве

  Azure IoT Edge полагается на подсистему контейнера, [совместимую с OCI](https://www.opencontainers.org/) . Убедитесь, что устройство может поддерживать контейнеры.

  Если вы устанавливаете IoT Edge на виртуальную машину, включите вложенную виртуализацию и выделите не менее 2 ГБ памяти. Для виртуальных машин Hyper-V версии 2 вложенная виртуализация включена по умолчанию. Для VMware существует переключатель, позволяющий включить эту функцию на виртуальной машине.

  Если вы устанавливаете IoT Edge на устройстве IoT Core, используйте следующую команду в [удаленном сеансе PowerShell](/windows/iot-core/connect-your-device/powershell) , чтобы проверить, поддерживаются ли на устройстве контейнеры Windows:

  ```powershell
  Get-Service vmcompute
  ```

* [Зарегистрированный идентификатор устройства](how-to-register-device.md)

  Если вы зарегистрировали устройство с помощью проверки подлинности с симметричным ключом, строка подключения устройства будет готова.

  Если вы зарегистрировали устройство с помощью самозаверяющего сертификата X. 509, у вас должен быть по крайней мере один из сертификатов удостоверений, которые использовались для регистрации устройства, и соответствующий закрытый закрытый ключ, доступный на вашем устройстве.

## <a name="install-a-container-engine"></a>Установка подсистемы контейнеров

Служба Azure IoT Edge использует среду выполнения контейнера, совместимую с OCI. Для рабочих сценариев рекомендуется использовать подсистему на основе значок Кита. Подсистема значок Кита — это единственный механизм контейнеров, официально поддерживаемый Azure IoT Edge. Образы контейнеров Docker (Community Edition или Enterprise Edition) совместимы со средой выполнения Moby.

Для рабочих сценариев используйте подсистему на основе значок Кита, включенную в скрипт установки. Нет дополнительных действий для установки подсистемы.

Для IoT Edge с контейнерами Linux необходимо предоставить собственную среду выполнения контейнера. Установите на устройстве [DOCKER Desktop](https://docs.docker.com/docker-for-windows/install/) и настройте его для [использования контейнеров Linux](https://docs.docker.com/docker-for-windows/#switch-between-windows-and-linux-containers) перед продолжением.

## <a name="install-the-iot-edge-security-daemon"></a>Установка управляющей программы IoT Edge Security

>[!TIP]
>Для устройств IoT Core рекомендуется запускать команды установки с помощью удаленного сеанса PowerShell. Дополнительные сведения см. [в статье Использование PowerShell для Windows IOT](/windows/iot-core/connect-your-device/powershell).

1. Откройте сеанс PowerShell от имени администратора.

   Используйте сеанс AMD64 PowerShell, а не PowerShell (x86). Если вы не уверены, какой тип сеанса вы используете, выполните следующую команду:

   ```powershell
   (Get-Process -Id $PID).StartInfo.EnvironmentVariables["PROCESSOR_ARCHITECTURE"]
   ```

2. Выполните команду [deploy-IoTEdge](reference-windows-scripts.md#deploy-iotedge) , которая выполняет следующие задачи:

   * Проверяет, что компьютер Windows находится в поддерживаемой версии.
   * Включает функцию контейнеров.
   * Скачивает модуль значок Кита и среду выполнения IoT Edge.

   ```powershell
   . {Invoke-WebRequest -useb https://aka.ms/iotedge-win} | Invoke-Expression; `
   Deploy-IoTEdge
   ```

   `Deploy-IoTEdge`Команда по умолчанию использует контейнеры Windows. Если вы хотите использовать контейнеры Linux, добавьте `ContainerOs` параметр:

   ```powershell
   . {Invoke-WebRequest -useb https://aka.ms/iotedge-win} | Invoke-Expression; `
   Deploy-IoTEdge -ContainerOs Linux
   ```

3. На этом этапе устройства IoT Core могут перезапускаться автоматически. На устройствах Windows 10 или Windows Server может появиться запрос на перезагрузку. Если да, перезагрузите устройство прямо сейчас.

При установке IoT Edge на устройстве можно использовать дополнительные параметры для изменения процесса, включая:

* Направить трафик через прокси-сервер.
* Наведите установщик на локальный каталог для автономной установки.

Дополнительные сведения об этих дополнительных параметрах см. [в статье сценарии PowerShell для IOT EDGE в Windows](reference-windows-scripts.md).

## <a name="provision-the-device-with-its-cloud-identity"></a>Подготавливает устройство к облачному удостоверению

Теперь, когда модуль контейнера и среда выполнения IoT Edge установлены на устройстве, вы готовы к следующему этапу, который заключается в настройке устройства с удостоверением облака и сведениями о проверке подлинности.

Выберите следующий раздел в зависимости от типа проверки подлинности, который вы хотите использовать:

* [Вариант 1. Проверка подлинности с симметричными ключами](#option-1-authenticate-with-symmetric-keys)
* [Вариант 2. Проверка подлинности с помощью сертификатов X. 509](#option-2-authenticate-with-x509-certificates)

### <a name="option-1-authenticate-with-symmetric-keys"></a>Вариант 1. Проверка подлинности с симметричными ключами

На этом этапе среда выполнения IoT Edge установлена на устройстве Windows, и вам необходимо подготавливать устройство с удостоверением облака и сведениями проверки подлинности.

В этом разделе рассматриваются шаги по подготовке устройства с проверкой подлинности с помощью симметричного ключа. Вы должны зарегистрировать устройство в центре Интернета вещей и получить строку подключения из сведений об устройстве. В противном случае выполните действия, описанные в разделе [Регистрация устройства IOT EDGE в центре Интернета вещей](how-to-register-device.md).

1. На IoT Edge устройстве запустите PowerShell от имени администратора.

2. Используйте команду [Initialize-IoTEdge](reference-windows-scripts.md#initialize-iotedge) , чтобы настроить среду выполнения IOT EDGE на компьютере. По умолчанию при выполнении команды применяется подготовка вручную с помощью контейнеров Windows.

   ```powershell
   . {Invoke-WebRequest -useb https://aka.ms/iotedge-win} | Invoke-Expression; `
   Initialize-IoTEdge -ManualConnectionString -ContainerOs Windows
   ```

   * Если вы используете контейнеры Linux, добавьте `-ContainerOs` параметр к флагу. Следует согласовать с выбранным параметром контейнера с `Deploy-IoTEdge` командой, которая была выполнена ранее.

      ```powershell
      . {Invoke-WebRequest -useb https://aka.ms/iotedge-win} | Invoke-Expression; `
      Initialize-IoTEdge -ContainerOs Linux
      ```

   * Если вы загрузили сценарий IoTEdgeSecurityDaemon.ps1 на устройство для автономной или определенной установки версии, обязательно сослаться на локальную копию скрипта.

      ```powershell
      . <path>/IoTEdgeSecurityDaemon.ps1
      Initialize-IoTEdge -ManualX509
      ```

3. При появлении запроса введите строку подключения устройства, полученную в предыдущем разделе. Строка подключения устройства связывает физическое устройство с ИДЕНТИФИКАТОРом устройства в центре Интернета вещей и предоставляет сведения о проверке подлинности.

   Строка подключения устройства имеет следующий формат и не должна содержать кавычки: `HostName={IoT hub name}.azure-devices.net;DeviceId={device name};SharedAccessKey={key}`

При подготовке устройства вручную можно использовать дополнительные параметры для изменения процесса, включая:

* Направить трафик через прокси-сервер.
* Объявите конкретный образ контейнера edgeAgent и укажите учетные данные, если они находятся в частном реестре

Дополнительные сведения об этих дополнительных параметрах см. [в статье сценарии PowerShell для IOT EDGE в Windows](reference-windows-scripts.md).

### <a name="option-2-authenticate-with-x509-certificates"></a>Вариант 2. Проверка подлинности с помощью сертификатов X. 509

На этом этапе среда выполнения IoT Edge установлена на устройстве Windows, и вам необходимо подготавливать устройство с удостоверением облака и сведениями проверки подлинности.

В этом разделе рассматриваются шаги по подготовке устройства с проверкой подлинности на основе сертификата X. 509. Вы должны зарегистрировать устройство в центре Интернета вещей, предоставив отпечатки, соответствующие сертификату и закрытому ключу, расположенным на устройстве IoT Edge. В противном случае выполните действия, описанные в разделе [Регистрация устройства IOT EDGE в центре Интернета вещей](how-to-register-device.md).

1. На IoT Edge устройстве запустите PowerShell от имени администратора.

2. Используйте команду [Initialize-IoTEdge](reference-windows-scripts.md#initialize-iotedge) , чтобы настроить среду выполнения IOT EDGE на компьютере.

   ```powershell
   . {Invoke-WebRequest -useb https://aka.ms/iotedge-win} | Invoke-Expression; `
   Initialize-IoTEdge -ManualX509
   ```

   * Если вы используете контейнеры Linux, добавьте `-ContainerOs` параметр к флагу. Следует согласовать с выбранным параметром контейнера с `Deploy-IoTEdge` командой, которая была выполнена ранее.

      ```powershell
      . {Invoke-WebRequest -useb https://aka.ms/iotedge-win} | Invoke-Expression; `
      Initialize-IoTEdge -ManualX509 -ContainerOs Linux
      ```

   * Если вы загрузили сценарий IoTEdgeSecurityDaemon.ps1 на устройство для автономной или определенной установки версии, обязательно сослаться на локальную копию скрипта.

      ```powershell
      . <path>/IoTEdgeSecurityDaemon.ps1
      Initialize-IoTEdge -ManualX509
      ```

3. При появлении запроса введите следующие сведения:

   * **IotHubHostName**: имя узла центра Интернета вещей, к которому будет подключено устройство. Например, `{IoT hub name}.azure-devices.net`.
   * **DeviceID**— идентификатор, указанный при регистрации устройства.
   * **X509IdentityCertificate**: абсолютный путь к сертификату удостоверения на устройстве. Например, `C:\path\identity_certificate.pem`.
   * **X509IdentityPrivateKey**: абсолютный путь к файлу закрытого ключа для предоставленного сертификата удостоверения. Например, `C:\path\identity_key.pem`.

При подготовке устройства вручную можно использовать дополнительные параметры для изменения процесса, включая:

* Направить трафик через прокси-сервер.
* Объявите конкретный образ контейнера edgeAgent и укажите учетные данные, если они находятся в частном реестре

Дополнительные сведения об этих дополнительных параметрах см. [в статье сценарии PowerShell для IOT EDGE в Windows](reference-windows-scripts.md).

## <a name="offline-or-specific-version-installation-optional"></a>Установка в автономном режиме или с определенной версией (необязательно)

Действия, описанные в этом разделе, предназначены для сценариев, не охваченных стандартными шагами установки. Это может быть:

* Установка IoT Edge в автономном режиме
* Установка версии-кандидата
* Установите версию, отличную от последней

Во время установки будут скачаны три файла:

* Сценарий PowerShell, содержащий инструкции по установке
* Microsoft Azure IoT Edge CAB-файл, содержащий управляющую программу IoT Edge (иотеджед), контейнер значок Кита и интерфейс командной строки значок Кита
* Установщик Visual C++ распространяемого пакета (среда выполнения VC)

Если устройство будет отключено во время установки или вы хотите установить определенную версию IoT Edge, эти файлы можно загрузить на устройство заранее. Когда пора установить, наведите сценарий установки в каталог, содержащий Скачанные файлы. Установщик сначала проверяет каталог, а затем загружает только те компоненты, которые не найдены. Если все файлы доступны в автономном режиме, можно установить без подключения к Интернету.

1. Последние файлы установки IoT Edge вместе с предыдущими версиями см. в разделе [Azure IOT Edge выпуски](https://github.com/Azure/azure-iotedge/releases).

2. Найдите версию, которую вы хотите установить, и скачайте следующие файлы из раздела " **активы** " заметки о выпуске на устройство IOT:

   * IoTEdgeSecurityDaemon.ps1
   * Microsoft-Azure-IoTEdge-amd64.cab из выпусков 1.0.9 или более поздней версии или Microsoft-Azure-IoTEdge.cab из выпусков 1.0.8 и более старых версий.

   Microsoft-Azure-IotEdge-arm32.cab также доступна начиная с 1.0.9 только в целях тестирования. IoT Edge в настоящее время не поддерживается на устройствах Windows ARM32.

   Очень важно использовать сценарий PowerShell из того же выпуска, что и используемый CAB-файл, так как функциональность изменяется для поддержки функций в каждом выпуске.

3. Если загруженный CAB-файл имеет суффикс архитектуры, переименуйте файл в **Microsoft-Azure-IoTEdge.cab**.

4. При необходимости скачайте установщик для распространяемого пакета Visual C++. Например, сценарий PowerShell использует эту версию: [vc_redist.x64.exe](https://download.microsoft.com/download/0/6/4/064F84EA-D1DB-4EAA-9A5C-CC2F0FF6A638/vc_redist.x64.exe). Сохраните установщик в той же папке на устройстве IoT, что и файлы IoT Edge.

5. Чтобы установить с автономными компонентами, [источником точки](/powershell/module/microsoft.powershell.core/about/about_scripts#script-scope-and-dot-sourcing) является локальная копия сценария PowerShell.

6. Выполните команду [deploy-IoTEdge](reference-windows-scripts.md#deploy-iotedge) с `-OfflineInstallationPath` параметром. Укажите абсолютный путь к каталогу файлов. Например,

   ```powershell
   . <path>\IoTEdgeSecurityDaemon.ps1
   Deploy-IoTEdge -OfflineInstallationPath <path>
   ```

   Команда развертывания будет использовать все компоненты, найденные в указанном каталоге локальных файлов. Если CAB-файл или установщик Visual C++ отсутствуют, он попытается скачать их.

## <a name="update-iot-edge"></a>Обновление IoT Edge

Используйте `Update-IoTEdge` команду, чтобы обновить управляющую программу безопасности. Сценарий автоматически извлекает последнюю версию управляющей программы безопасности.

```powershell
. {Invoke-WebRequest -useb aka.ms/iotedge-win} | Invoke-Expression; Update-IoTEdge -ContainerOs <Windows or Linux>
```

При выполнении команды Update-IoTEdge удаляет и обновляет управляющую программу безопасности с устройства, а также два образа контейнеров среды выполнения. Файл config. YAML хранится на устройстве, а также данные из подсистемы контейнеров значок Кита (если вы используете контейнеры Windows). Хранение сведений о конфигурации означает, что в процессе обновления не требуется повторно указывать строку подключения или сведения о службе подготовки устройств для устройства.

Если вы хотите выполнить обновление до определенной версии управляющей программы безопасности, найдите версию, которую вы хотите использовать, из [IOT Edge выпусков](https://github.com/Azure/azure-iotedge/releases). В этой версии Скачайте файл **Microsoft-Azure-IoTEdge.cab** . Затем используйте параметр, `-OfflineInstallationPath` чтобы указать расположение локального файла. Пример:

```powershell
. {Invoke-WebRequest -useb aka.ms/iotedge-win} | Invoke-Expression; Update-IoTEdge -ContainerOs <Windows or Linux> -OfflineInstallationPath <absolute path to directory>
```

>[!NOTE]
>`-OfflineInstallationPath`Параметр ищет файл с именем **Microsoft-Azure-IoTEdge.cab** в указанном каталоге. Начиная с версии IoT Edge-RC4, можно использовать два CAB-файла: один для устройств AMD64 и один для ARM32. Скачайте правильный файл для устройства, а затем переименуйте файл, чтобы удалить суффикс архитектуры.

Если вы хотите обновить устройство в автономном режиме, найдите версию, которую вы хотите использовать, из [Azure IOT Edge выпусков](https://github.com/Azure/azure-iotedge/releases). В этой версии Скачайте файлы *IoTEdgeSecurityDaemon.ps1* и *Microsoft-Azure-IoTEdge.cab* . Очень важно использовать сценарий PowerShell из того же выпуска, что и используемый CAB-файл, так как функциональность изменяется для поддержки функций в каждом выпуске.

Если загруженный CAB-файл имеет суффикс архитектуры, переименуйте файл в **Microsoft-Azure-IoTEdge.cab**.

Чтобы выполнить обновление с помощью автономных компонентов, [источник точки](/powershell/module/microsoft.powershell.core/about/about_scripts#script-scope-and-dot-sourcing) является локальной копией сценария PowerShell. Затем используйте параметр в `-OfflineInstallationPath` составе `Update-IoTEdge` команды и укажите абсолютный путь к каталогу файла. Например,

```powershell
. <path>\IoTEdgeSecurityDaemon.ps1
Update-IoTEdge -OfflineInstallationPath <path>
```

Для получения дополнительных сведений о параметрах обновления используйте команду `Get-Help Update-IoTEdge -full` или обратитесь к [сценарию PowerShell для IOT EDGE в Windows](reference-windows-scripts.md).

## <a name="uninstall-iot-edge"></a>Удаление IoT Edge

Если вы хотите удалить IoT Edge установку с устройства, используйте следующие команды.

Если вы хотите удалить IoT Edge установку с устройства Windows, используйте команду [uninstall-IoTEdge](reference-windows-scripts.md#uninstall-iotedge) в административном окне PowerShell. Эта команда удаляет среду выполнения IoT Edge вместе с существующей конфигурацией и данными подсистемы Moby.

```powershell
. {Invoke-WebRequest -useb aka.ms/iotedge-win} | Invoke-Expression; `
Uninstall-IoTEdge
```

`Uninstall-IoTEdge`Команда не работает в Windows IOT базовая. Чтобы удалить IoT Edge, необходимо повторно развернуть образ Windows IoT Core.

Для получения дополнительных сведений о параметрах удаления используйте команду `Get-Help Uninstall-IoTEdge -full` .

## <a name="next-steps"></a>Дальнейшие действия

Продолжайте [развертывать модули IOT Edge](how-to-deploy-modules-portal.md) , чтобы узнать, как развернуть модули на устройстве.
