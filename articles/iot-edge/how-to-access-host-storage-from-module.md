---
title: Использование IoT Edge локального хранилища устройств из модуля — Azure IoT Edge | Документация Майкрософт
description: Используйте переменные среды и создайте параметры, чтобы предоставить доступ к модулю IoT Edge локальному хранилищу устройства.
author: kgremban
manager: philmea
ms.author: kgremban
ms.date: 08/14/2020
ms.topic: conceptual
ms.service: iot-edge
services: iot-edge
ms.openlocfilehash: 53d1504b03e3dbe99cbdeac23df2623a5390b3d9
ms.sourcegitcommit: 58ff80474cd8b3b30b0e29be78b8bf559ab0caa1
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/17/2021
ms.locfileid: "100635427"
---
# <a name="give-modules-access-to-a-devices-local-storage"></a>Предоставление модулям доступа к локальному хранилищу устройства

Помимо хранения данных с помощью служб хранилища Azure или хранилища контейнера устройства, можно также выделить хранилище на узле IoT Edge само устройство для повышения надежности, особенно при работе в автономном режиме.

## <a name="link-module-storage-to-device-storage"></a>Связывание хранилища модуля с хранилищем устройства

Чтобы включить ссылку из хранилища модулей в хранилище в системе узла, создайте переменную среды для модуля, указывающего на папку хранилища в контейнере. Затем используйте параметры создания для привязки этой папки хранения к папке на хост-компьютере.

Например, если вы хотите включить центр IoT Edge для хранения сообщений в локальном хранилище устройства и получить их позже, можно настроить переменные среды и параметры создания в портал Azure в разделе **Параметры среды выполнения** .

1. Как для IoT Edge концентратора, так и для агента IoT Edge добавьте переменную среды с именем **сторажефолдер** , указывающую на каталог в модуле.
1. Как для IoT Edge концентратора, так и для IoT Edge агента добавьте привязки, чтобы подключить локальный каталог на хост-компьютере к каталогу в модуле. Пример.

   ![Добавление параметров создания и переменных среды для локального хранилища](./media/how-to-access-host-storage-from-module/offline-storage.png)

Кроме того, локальное хранилище можно настроить непосредственно в манифесте развертывания. Пример.

```json
"systemModules": {
    "edgeAgent": {
        "settings": {
            "image": "mcr.microsoft.com/azureiotedge-agent:1.1",
            "createOptions": {
                "HostConfig": {
                    "Binds":["<HostStoragePath>:<ModuleStoragePath>"]
                }
            }
        },
        "type": "docker",
        "env": {
            "storageFolder": {
                "value": "<ModuleStoragePath>"
            }
        }
    },
    "edgeHub": {
        "settings": {
            "image": "mcr.microsoft.com/azureiotedge-hub:1.1",
            "createOptions": {
                "HostConfig": {
                    "Binds":["<HostStoragePath>:<ModuleStoragePath>"],
                    "PortBindings":{"5671/tcp":[{"HostPort":"5671"}],"8883/tcp":[{"HostPort":"8883"}],"443/tcp":[{"HostPort":"443"}]}}}
        },
        "type": "docker",
        "env": {
            "storageFolder": {
                "value": "<ModuleStoragePath>"
            }
        },
        "status": "running",
        "restartPolicy": "always"
    }
}
```

Замените `<HostStoragePath>` и на `<ModuleStoragePath>` путь к хранилищу узла и модуля; оба значения должны быть абсолютным путем.

Например, в системе Linux это означает, `"Binds":["/etc/iotedge/storage/:/iotedge/storage/"]` что каталог **/ЕТК/иотедже/стораже** в главной системе сопоставляется с каталогом **/иотедже/стораже/** в контейнере. В системе Windows в качестве другого примера означает, `"Binds":["C:\\temp:C:\\contemp"]` что каталог **c: \\ TEMP** в системе размещения сопоставлен с каталогом **c: \\** в контейнере.

Кроме того, на устройствах Linux убедитесь, что профиль пользователя модуля имеет необходимые разрешения на чтение, запись и выполнение для каталога главной системы. Вернувшись к предыдущему примеру включения концентратора IoT Edge для хранения сообщений в локальном хранилище устройства, необходимо предоставить разрешения для своего профиля пользователя, UID 1000. (Агент IoT Edge работает как корень, поэтому ему не требуются дополнительные разрешения.) Существует несколько способов управления разрешениями каталога в системах Linux, в том числе с помощью `chown` для изменения владельца каталога, а также `chmod` для изменения разрешений, например:

```bash
sudo chown 1000 <HostStoragePath>
sudo chmod 700 <HostStoragePath>
```

Дополнительные сведения о параметрах создания можно найти в документации по [DOCKER](https://docs.docker.com/engine/api/v1.32/#operation/ContainerCreate).

## <a name="encrypted-data-in-module-storage"></a>Зашифрованные данные в хранилище модулей

Когда модули вызывают API рабочей нагрузки управляющей программы IoT Edge для шифрования данных, ключ шифрования извлекается с использованием идентификатора модуля и идентификатора создания модуля. Идентификатор поколения используется для защиты секретов, если модуль удален из развертывания, а затем другой модуль с таким же ИДЕНТИФИКАТОРом модуля будет развернут на том же устройстве. Идентификатор создания модуля можно просмотреть с помощью команды Azure CLI [AZ IOT концентратор — Показать идентификаторы](/cli/azure/ext/azure-iot/iot/hub/module-identity).

Если требуется совместное использование файлов между модулями в поколениях, они не должны содержать секреты, иначе они не будут расшифровываться.

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные примеры доступа к хранилищу узлов из модуля см. в разделе [хранение данных в пограничном хранилище с помощью хранилища BLOB-объектов Azure на IOT Edge](how-to-store-data-blob.md).
