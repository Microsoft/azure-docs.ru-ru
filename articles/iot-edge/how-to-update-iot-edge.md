---
title: Обновления версии Azure IoT Edge на устройствах | Документация Майкрософт
description: Сведения об обновлении устройства IoT Edge для запуска последних версий управляющей программы безопасности и среды выполнения IoT Edge
keywords: ''
author: kgremban
manager: philmea
ms.author: kgremban
ms.date: 03/01/2021
ms.topic: conceptual
ms.service: iot-edge
services: iot-edge
ms.openlocfilehash: db809807f0494b8510ba7eb71c742a7a7631f97e
ms.sourcegitcommit: d135e9a267fe26fbb5be98d2b5fd4327d355fe97
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/10/2021
ms.locfileid: "102609589"
---
# <a name="update-the-iot-edge-security-daemon-and-runtime"></a>Обновление управляющей программы безопасности и среды выполнения IoT Edge

По мере выпуска службой IoT Edge новых версий необходимо обновить устройства IoT Edge, чтобы получить новейшие функции и улучшения безопасности. В этой статье представлены сведения об обновлении устройств IoT Edge при наличии новой версии.

Если вы хотите перейти на новую версию, вам необходимо обновить два компонента устройства IoT Edge. Первый компонент — управляющая программа безопасности, которая выполняется на устройстве и запускает модули среды выполнения при запуске устройства. В настоящее время обновить управляющую программу безопасности можно только на самом устройстве. Второй компонент — это среда выполнения, состоящая из модулей центра и агента IoT Edge. В зависимости от структуры развертывания среду выполнения можно обновить как на устройстве, так и удаленно.

Последнюю версию Azure IoT Edge можно найти [на сайте GitHub](https://github.com/Azure/azure-iotedge/releases).

## <a name="update-the-security-daemon"></a>Обновление управляющей программы безопасности

Управляющая программа безопасности IoT Edge — это собственный компонент, который необходимо обновить с помощью диспетчера пакетов на устройстве IoT Edge.

Проверьте версию управляющей программы безопасности, запущенной на вашем устройстве, с помощью команды `iotedge version`.

>[!IMPORTANT]
>При обновлении устройства с версии 1,0 или 1,1 до версии 1,2 существуют различия в процессах установки и настройки, требующих дополнительных действий. Дополнительные сведения см. в описании действий далее в этой статье: [особый случай: обновление с 1,0 или 1,1 до 1,2](#special-case-update-from-10-or-11-to-12).

# <a name="linux"></a>[Linux](#tab/linux)

На устройствах Linux x64 используйте apt-get или соответствующий диспетчер пакетов, чтобы обновить управляющую программу до последней версии.

Получите последнюю конфигурацию репозитория от корпорации Майкрософт:

* **Ubuntu Server 18.04**:

   ```bash
   curl https://packages.microsoft.com/config/ubuntu/18.04/multiarch/prod.list > ./microsoft-prod.list
   ```

* **Raspberry Pi OS Stretch**:

   ```bash
   curl https://packages.microsoft.com/config/debian/stretch/multiarch/prod.list > ./microsoft-prod.list
   ```

Скопируйте созданный список.

   ```bash
   sudo cp ./microsoft-prod.list /etc/apt/sources.list.d/
   ```

Установите открытый ключ Microsoft GPG.

   ```bash
   curl https://packages.microsoft.com/keys/microsoft.asc | gpg --dearmor > microsoft.gpg
   sudo cp ./microsoft.gpg /etc/apt/trusted.gpg.d/
   ```

Обновление apt.

   ```bash
   sudo apt-get update
   ```

<!-- 1.1 -->
:::moniker range="iotedge-2018-06"

Проверьте, какие версии IoT Edge доступны.

   ```bash
   apt list -a iotedge
   ```

Если вы хотите выполнить обновление до последней версии управляющей программы безопасности, используйте следующую команду, которая также обновляет **либиоссм-STD** до последней версии:

   ```bash
   sudo apt-get install iotedge
   ```

Если необходимо выполнить обновление до определенной версии управляющей программы безопасности, укажите версию из списка APT. При каждом обновлении **iotedge** автоматически пытается обновить пакет **либиоссм-STD** до последней версии, что может привести к конфликту зависимостей. Если вы не переходите к самой последней версии, не забудьте выбрать оба пакета для одной и той же версии. Например, следующая команда устанавливает определенную версию выпуска 1.0.9:

   ```bash
   sudo apt-get install iotedge=1.0.9-1 libiothsm-std=1.0.9-1
   ```

Если версия, которую вы хотите установить, недоступна через APT-GET, можно использовать фигурные скобки, чтобы выбрать любую версию из репозитория [IOT Edge выпусков](https://github.com/Azure/azure-iotedge/releases) . Для любой версии, которую вы хотите установить, выберите соответствующие файлы **либиоссм-STD** и **iotedge** для вашего устройства. Для каждого файла щелкните правой кнопкой мыши ссылку на файл и скопируйте адрес ссылки. Используйте адрес ссылки для установки конкретных версий этих компонентов:

```bash
curl -L <libiothsm-std link> -o libiothsm-std.deb && sudo dpkg -i ./libiothsm-std.deb
curl -L <iotedge link> -o iotedge.deb && sudo dpkg -i ./iotedge.deb
```
<!-- end 1.1 -->
:::moniker-end

<!-- 1.2 -->
:::moniker range=">=iotedge-2020-11"

Проверьте, какие версии IoT Edge доступны.

   ```bash
   apt list -a aziot-edge
   ```

Если вы хотите выполнить обновление до последней версии IoT Edge, используйте следующую команду, которая также обновляет службу удостоверений до последней версии:

   ```bash
   sudo apt-get install aziot-edge
   ```
<!-- end 1.2 -->
:::moniker-end

# <a name="windows"></a>[Windows](#tab/windows)

<!-- 1.1 -->
::: moniker range="iotedge-2018-06"

При использовании IoT Edge для Linux в Windows IoT Edge выполняется на виртуальной машине Linux, размещенной на устройстве Windows. Эта виртуальная машина предустановлена с IoT Edge и управляется с помощью Центр обновления Майкрософт для обновления компонентов. Если автоматическое обновление включено, новые обновления будут скачиваться и устанавливаться каждый раз, когда они станут доступны.

При использовании IoT Edge для Windows IoT Edge запускается непосредственно на устройстве Windows. Инструкции по обновлению с помощью сценариев PowerShell см. в статье [установка Azure IOT Edge для Windows и управление ими](how-to-install-iot-edge-windows-on-windows.md).
:::moniker-end

<!-- 1.2 -->
:::moniker range=">=iotedge-2020-11"

В настоящее время поддержка IoT Edge версии 1,2, работающей на устройствах Windows, не поддерживается.

:::moniker-end

---

## <a name="update-the-runtime-containers"></a>Обновление контейнеров среды выполнения

Способ обновления IoT Edgeного агента и контейнера центра IoT Edge зависит от того, используются ли в развертывании чередующиеся Теги (например, 1,0) или определенные теги (например, 1.0.7).

Проверьте версию модулей агента и центра IoT Edge, используемую в настоящее время на вашем устройстве, с помощью команды `iotedge logs edgeAgent` или `iotedge logs edgeHub`.

  ![Поиск версии контейнера в журналах](./media/how-to-update-iot-edge/container-version.png)

### <a name="understand-iot-edge-tags"></a>Сведения о тегах IoT Edge

Образы агента и центра IoT Edge отмечены тегами версии IoT Edge, с которой они связаны. Существует два способа использования тегов с образами среды выполнения:

* **Последовательные теги**: используются только первые два значения номера версии для получения последнего образа, соответствующего этим цифрам. Например, 1.0 обновляется всякий раз, когда появляется новый выпуск, указывающий на последнюю версию 1.0.x. Если среда выполнения контейнера на устройстве IoT Edge снова извлекает образ, модули среды выполнения обновляются до последней версии. Такой подход рекомендуется использовать для разработки. Для развертываний с портала Azure по умолчанию установлены последовательные теги.

* **Конкретные теги**: используются все три значения номера версии для явной установки версии образа. Например, 1.0.7 не изменится после первоначального выпуска. Вы можете объявить новый номер версии в манифесте развертывания, когда будете готовы к обновлению. Такой подход рекомендуется использовать для производственных целей.

### <a name="update-a-rolling-tag-image"></a>Обновление образа последовательного тега

Если вы используете последовательные теги в своем развертывании (например, mcr.microsoft.com/azureiotedge-hub:**1.0**), вам необходимо принудительно запустить среду выполнения контейнера на устройстве, чтобы извлечь последнюю версию образа.

Удалите локальную версию образа с устройства IoT Edge. На компьютерах Windows удаление управляющей программы безопасности приводит к удалению образов среды выполнения, поэтому не нужно снова выполнять этот шаг.

```bash
docker rmi mcr.microsoft.com/azureiotedge-hub:1.0
docker rmi mcr.microsoft.com/azureiotedge-agent:1.0
```

Для удаления образов может потребоваться использовать флаг force `-f`.

Служба IoT Edge извлечет последние версии образов среды выполнения и автоматически запустит их на вашем устройстве.

### <a name="update-a-specific-tag-image"></a>Обновление образа конкретного тега

Если в развертывании используются определенные теги (например, mcr.microsoft.com/azureiotedge-hub:**1.0.8**), то все, что нужно сделать, — это обновить тег в манифесте развертывания и применить изменения к устройству.

1. В центре Интернета вещей в портал Azure выберите свое устройство IoT Edge и щелкните **задать модули**.

1. В разделе **модули IOT Edge** выберите **Параметры среды выполнения**.

   ![Настройка параметров среды выполнения](./media/how-to-update-iot-edge/configure-runtime.png)

1. В **параметрах среды выполнения** обновите значение **образа** для **концентратора ребра** , указав требуемую версию. Не выбирайте **сохранить** еще.

   ![Обновить версию образа концентратора ребра](./media/how-to-update-iot-edge/runtime-settings-edgehub.png)

1. Сверните параметры **концентратора ребра** или прокрутите вниз и обновите значение **образа** для **агента ребра** с той же требуемой версией.

   ![Обновление версии агента концентратора ребра](./media/how-to-update-iot-edge/runtime-settings-edgeagent.png)

1. Щелкните **Сохранить**.

1. Выберите **Проверка + создать**, проверьте развертывание и щелкните **создать**.

## <a name="special-case-update-from-10-or-11-to-12"></a>Особый случай: обновление с 1,0 или 1,1 до 1,2

Начиная с версии 1,2, служба IoT Edge использует новое имя пакета и имеет некоторые различия в процессах установки и настройки. Если у вас IoT Edge устройство под управлением версии 1,0 или 1,1, воспользуйтесь приведенными ниже инструкциями, чтобы узнать, как обновить до 1,2.

>[!NOTE]
>В настоящее время отсутствует поддержка IoT Edge версии 1,2, работающей на устройствах Windows.

Ниже приведены некоторые ключевые отличия между 1,2 и более ранними версиями.

* Имя пакета изменилось с **iotedge** на **азиот-ребро**.
* Пакет **либиоссм-STD** больше не используется. Если вы использовали стандартный пакет, предоставленный в составе выпуска IoT Edge, то ваши конфигурации можно передать в новую версию. Если вы использовали другую реализацию либиоссм-STD, то все предоставляемые пользователем сертификаты, такие как сертификат удостоверения устройства, центр сертификации устройства и пакет Trust, потребуется настроить заново.
* В состав выпуска 1,2 появилась новая служба удостоверений **азиот-Identity-Service** . Эта служба обрабатывает подготовку и управление удостоверениями для IoT Edge и для других компонентов устройств, которые должны взаимодействовать с центром Интернета вещей, например с обновлением устройства центра Интернета вещей Azure. <!--TODO: add link to ADU when available -->
* Файл конфигурации по умолчанию имеет новое имя и расположение. Ранее `/etc/iotedge/config.yaml` сведения о конфигурации устройства теперь должны быть в по `/etc/aziot/congig.toml` умолчанию. `iotedge config import`Команду можно использовать для переноса сведений о конфигурации в старое расположение и синтаксис в новую.
* Все модули, использующие API рабочей нагрузки IoT Edge для шифрования и расшифровки постоянных данных, не могут быть расшифрованы после обновления. IoT Edge динамически создает главный ключ удостоверения и ключ шифрования для внутреннего использования. Этот ключ не будет передан в новую службу. IoT Edge v 1.2 создаст новую.

Прежде чем автоматизировать какие-либо процессы обновления, проверьте, работает ли он на тестовых компьютерах.

Когда будете готовы, выполните следующие действия, чтобы обновить IoT Edge на устройствах.

1. Получите последнюю конфигурацию репозитория от корпорации Майкрософт:

   * **Ubuntu Server 18.04**:

     ```bash
     curl https://packages.microsoft.com/config/ubuntu/18.04/multiarch/prod.list > ./microsoft-prod.list
     ```

   * **Raspberry Pi OS Stretch**:

     ```bash
     curl https://packages.microsoft.com/config/debian/stretch/multiarch/prod.list > ./microsoft-prod.list
     ```

2. Скопируйте созданный список.

   ```bash
   sudo cp ./microsoft-prod.list /etc/apt/sources.list.d/
   ```

3. Установите открытый ключ Microsoft GPG.

   ```bash
   curl https://packages.microsoft.com/keys/microsoft.asc | gpg --dearmor > microsoft.gpg
   sudo cp ./microsoft.gpg /etc/apt/trusted.gpg.d/
   ```

4. Обновление apt.

   ```bash
   sudo apt-get update
   ```

5. Удалите предыдущую версию IoT Edge и оставьте файлы конфигурации на месте.

   ```bash
   sudo apt-get remove iotedge
   ```

6. Установите последнюю версию IoT Edge, а также службу удостоверений IoT.

   ```bash
   sudo apt-get install aziot-edge
   ```

7. Импортируйте старый файл config. YAML в новый формат и примените сведения о конфигурации.

   ```bash
   sudo iotedge config import
   ```

Теперь, когда служба IoT Edge, запущенная на устройствах, была обновлена, выполните действия, описанные в этой статье, чтобы также [обновить Контейнеры среды выполнения](#update-the-runtime-containers).

## <a name="special-case-update-to-a-release-candidate-version"></a>Особый случай: обновление до версии-кандидата

Azure IoT Edge регулярно выпускает новые версии службы IoT Edge. Перед каждым стабильным выпуском есть одна или несколько версий версии-кандидата (RC). Версии RC включают все запланированные функции выпуска, но по-прежнему проходят тестирование и проверку. Если вы хотите протестировать новую функцию на раннем этапе, можно установить версию-кандидат и отправить отзыв через GitHub.

Версии-кандидаты соответствуют тем же правилам нумерации выпусков, но имеют значение **— RC** плюс добавочный номер, добавленный к концу. Кандидаты выпуска можно просмотреть в том же списке [Azure IOT Edge выпусках](https://github.com/Azure/azure-iotedge/releases) , что и стабильные версии. Например, найдите **1.0.9-RC5** и **1.0.9-RC6**, два из кандидатов выпуска, которые были выпущены до **1.0.9**. Также можно увидеть, что версии RC помечены метками **предварительной версии** .

Агент IoT Edge и модули концентратора имеют версии-КАНДИДАТы, помеченные одинаковым соглашением. Например, **MCR.Microsoft.com/azureiotedge-Hub:1.0.9-RC6**.

В качестве предварительных версий версии-кандидата не входят в качестве последней версии, предназначенной для обычных установщиков. Вместо этого необходимо вручную ориентироваться на ресурсы для версии RC, которую требуется протестировать. В большинстве случаев установка или обновление версии-КАНДИДАТа аналогична нацеливанию на любую другую конкретную версию IoT Edge.

Используйте разделы этой статьи, чтобы узнать, как обновить устройство IoT Edge до определенной версии управляющей программы или модулей среды выполнения.

Если вы устанавливаете IoT Edge, а не обновляете установленную версию, выполните действия, описанные в статье [Установка в автономном режиме или с определенной версией](how-to-install-iot-edge.md#offline-or-specific-version-installation-optional).

## <a name="next-steps"></a>Дальнейшие действия

Ознакомьтесь с последними выпусками Azure IoT Edge [на сайте GitHub](https://github.com/Azure/azure-iotedge/releases).

Оставайтесь в курсе последних обновлений и объявлений в [блоге Интернет вещей](https://azure.microsoft.com/blog/topics/internet-of-things/)