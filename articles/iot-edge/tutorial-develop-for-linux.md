---
title: Учебник по разработке модулей для устройств Linux с помощью Azure IoT Edge
description: В этом учебнике описано, как настроить компьютер и облачные ресурсы для разработки модулей IoT Edge с использованием контейнеров Linux для устройств Linux.
author: kgremban
manager: philmea
ms.author: kgremban
ms.date: 07/30/2020
ms.topic: tutorial
ms.service: iot-edge
services: iot-edge
ms.custom: mvc
ms.openlocfilehash: fea8f52ebf40ba8195de134098693f90315bb384
ms.sourcegitcommit: afb9e9d0b0c7e37166b9d1de6b71cd0e2fb9abf5
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/14/2021
ms.locfileid: "103461425"
---
# <a name="tutorial-develop-iot-edge-modules-with-linux-containers"></a>Учебник. Разработка модулей IoT Edge с контейнерами Linux

[!INCLUDE [iot-edge-version-all-supported](../../includes/iot-edge-version-all-supported.md)]

Для разработки и развертывания кода на устройствах с IoT Edge используйте Visual Studio Code.

При работе с этим кратким руководством вы создали устройство IoT Edge и развернули модуль из Azure Marketplace. В этом учебнике описано, как выполнять разработку и развертывание собственного кода на устройстве IoT Edge. Было бы полезно сперва ознакомиться с этой статьей, прежде чем изучать другие, в которых подробнее рассматриваются отдельные языки программирования или службы Azure.

В этом учебнике используется пример развертывания модуля **C# на устройстве Linux**. Мы выбрали этот пример, так как он является самым распространенным сценарием разработки для решений IoT Edge. Даже если вы планируете использовать другой язык или развертывать службу Azure, сведения об инструментах и концепциях разработки, содержащиеся в этом учебнике, будут для вас полезны. Завершите эту вводную статью о процессе развертывания, а затем выберите предпочитаемый язык или службу Azure, чтобы ознакомиться с подробными сведениями.

В этом руководстве описано следующее:

> [!div class="checklist"]
>
> * Настройка компьютера для разработки.
> * Создание проекта с помощью средств IoT Edge для Visual Studio Code.
> * Создание проекта как контейнера и его сохранение в реестре контейнеров Azure.
> * Развертывание кода на устройстве IoT Edge.

## <a name="prerequisites"></a>Предварительные требования

Компьютер для разработки:

* При разработке можно использовать собственный компьютер или виртуальную машину в зависимости от ваших предпочтений.
  * Убедитесь, что компьютер для разработки поддерживает вложенную виртуализацию. Эта возможность необходима для запуска подсистемы контейнеров, установка которой описывается в следующем разделе.
* Для разработки модулей IoT Edge для устройств Linux можно использовать большинство операционных систем, на базе которых может работать платформа контейнеров. В этом учебнике используется компьютер под управлением Windows, но при этом отмечены известные различия в macOS или Linux.
* Установите [Git](https://git-scm.com/), чтобы получить пакеты шаблонов модулей далее в этом учебнике.  
* [C# для расширения Visual Studio Code (на платформе OmniSharp)](https://marketplace.visualstudio.com/items?itemName=ms-dotnettools.csharp).
* [Пакет SDK для .NET Core 2.1](https://www.microsoft.com/net/download).

Устройство Azure IoT Edge.

* Мы не советуем запускать IoT Edge на компьютере разработки. Вместо этого следует использовать другое устройство. Это различие между компьютером для разработки и устройством IoT Edge точнее отражает реальный сценарий развертывания и поможет не путать различные понятия.
* Если у вас нет второго доступного устройства, воспользуйтесь краткой статьей, чтобы создать устройство IoT Edge в Azure с [виртуальной машиной Linux](quickstart-linux.md).

Облачные ресурсы.

* [Центр Интернета вещей](../iot-hub/iot-hub-create-through-portal.md) ценовой категории "Бесплатный" или "Стандартный" в Azure.

[!INCLUDE [quickstarts-free-trial-note](../../includes/quickstarts-free-trial-note.md)]

## <a name="key-concepts"></a>Основные понятия

В этом учебнике рассказывается о разработке модуля IoT Edge. *Модуль IoT Edge*, а иногда просто *модуль*, является контейнером с исполняемым кодом. На устройстве IoT Edge можно развернуть один или несколько модулей. Модули выполняют определенные задачи, такие как прием данных с датчиков, выполнение анализа или очистки данных, или отправки сообщений в центр Интернета вещей. Дополнительные сведения см. в статье [Understand Azure IoT Edge modules](iot-edge-modules.md) (Общие сведения о модулях Azure IoT Edge).

При разработке модулей IoT Edge важно понимать разницу между компьютером для разработки и целевым устройством IoT Edge, где в конечном итоге будет развернут модуль. Контейнер, созданный для хранения кода модуля, должен соответствовать операционной системе (ОС) *целевого устройства*. Например, самый распространенный сценарий — это разработка модуля на компьютере под управлением Windows для его использования на устройстве IoT Edge под управлением Linux. В этом случае операционной системой контейнера будет Linux. При прохождении данного учебника помните о разнице между *ОС компьютера разработки* и *ОС контейнера*.

>[!TIP]
>Если вы используете [IoT Edge для Linux в Windows](iot-edge-for-linux-on-windows.md), *целевым устройством* в вашем сценарии будет виртуальная машина Linux, а не узел Windows.

Этот учебник предназначен для устройств с IoT Edge с контейнерами Linux. Вы можете использовать предпочитаемую операционную систему, пока компьютер разработки может запускать контейнеры Linux. Для разработки решений с контейнерами Linux мы советуем использовать Visual Studio Code, поэтому в этом учебнике будет использоваться именно эта среда. Вы можете также использовать Visual Studio, хотя поддержка этих двух инструментов отличается.

В следующей таблице перечислены поддерживаемые сценарии разработки **контейнеров Linux** в Visual Studio Code и Visual Studio.

|   | Visual Studio Code | Visual Studio 2017 или 2019 |
| - | ------------------ | ------------------ |
| **Архитектура устройств Linux** | Linux AMD64 <br> Linux ARM32 | Linux AMD64 <br> Linux ARM32 |
| **Службы Azure**; | Функции Azure <br> Azure Stream Analytics <br> Машинное обучение Azure |   |
| **Языки** | C <br> C# <br> Java <br> Node.js <br> Python | C <br> C# |
| **Дополнительные сведения** | [Azure IoT Edge для Visual Studio Code](https://marketplace.visualstudio.com/items?itemName=vsciot-vscode.azure-iot-edge) | [Средства Azure IoT Edge для Visual Studio 2017](https://marketplace.visualstudio.com/items?itemName=vsc-iot.vsiotedgetools) <br> [Средства Azure IoT Edge для Visual Studio 2019](https://marketplace.visualstudio.com/items?itemName=vsc-iot.vs16iotedgetools) |

>[!NOTE]
>Поддержка устройств Linux ARM64 предоставляется в [общедоступной предварительной версии](https://azure.microsoft.com/support/legal/preview-supplemental-terms/). Подробные сведения см. в статье [Develop and debug ARM64 IoT Edge modules in Visual Studio Code (preview)](https://devblogs.microsoft.com/iotdev/develop-and-debug-arm64-iot-edge-modules-in-visual-studio-code-preview) (Разработка и отладка модулей IoT Edge для устройств ARM64 в Visual Studio Code (предварительная версия)).

В этом учебнике описываются этапы разработки в Visual Studio Code. Инструкции по использованию Visual Studio приведены в статье [Использование Visual Studio 2019 для разработки и отладки модулей для Azure IoT Edge (предварительная версия)](how-to-visual-studio-develop-module.md).
## <a name="install-container-engine"></a>Установка платформы контейнеров

Модули IoT Edge упакованы в виде контейнеров, поэтому для создания контейнеров и управления ими на компьютере разработки необходима платформа контейнеров. Мы рекомендуем использовать для разработки Docker Desktop из-за его функциональной поддержки и популярности. Docker Desktop на устройстве с Windows позволяет переключаться между контейнерами Linux и контейнерами Windows, чтобы с легкостью разрабатывать модули для различных типов устройств IoT Edge.

Чтобы выполнить установку на компьютере разработки, используйте документацию по Docker:

* [Установка Docker Desktop для Windows](https://docs.docker.com/docker-for-windows/install/)

  * При установке Docker Desktop для Windows вы увидите запрос на использование контейнеров Linux или Windows. Это решение может измениться в любое время. В этом учебнике мы используем контейнеры Linux, так как модули предназначенные для устройств Linux. Дополнительные сведения см. в документации по Docker [о переключении между контейнерами Windows и Linux](https://docs.docker.com/docker-for-windows/#switch-between-windows-and-linux-containers).

* [Установка Docker Desktop для Mac](https://docs.docker.com/docker-for-mac/install/)

* Дополнительные сведения об установке на нескольких платформах Linux см. в статье [о Docker CE](https://docs.docker.com/install/).
  * В подсистеме Windows для Linux (WSL) установите Docker Desktop для Windows.

## <a name="set-up-vs-code-and-tools"></a>Настройка VS Code и средств

При разработке модулей IoT Edge используйте расширения Интернета вещей для Visual Studio Code. Эти расширения предоставляют шаблоны проектов, автоматизируют создание манифеста развертывания и позволяют отслеживать устройства IoT Edge и управлять ими. В этом разделе вы установите Visual Studio Code и расширения Интернета вещей, а затем настроите учетную запись Azure для управления ресурсами Центра Интернета вещей в Visual Studio Code.

1. Установите [Visual Studio Code](https://code.visualstudio.com/) на компьютере для разработки.

2. После завершения установки последовательно выберите **Вид** > **Расширения**.

3. Найдите средства **Azure IoT Tools**. Это набор расширений, который поможет взаимодействовать с Центром Интернета вещей и его устройствами, а также поможет разрабатывать модули IoT Edge.

4. Выберите пункт **Установить**. Каждое включенное расширение устанавливается индивидуально.

5. После установки расширений откройте палитру команд, выбрав **Вид** > **Палитра команд**.

6. В палитре команд найдите и щелкните **Azure: Войти**. Следуйте указаниям по входу в учетную запись Azure.

7. В палитре команд найдите и щелкните **Центр Интернета вещей: Select IoT Hub** (Центр Интернета вещей Azure: выбрать Центр Интернета вещей). Следуя инструкциям, выберите подписку Azure и центр Интернета вещей.

8. Откройте Visual Studio Code в разделе обозревателя, щелкнув значок на панели действий в левой части, или выбрав **Вид** > **Explorer**.

9. В нижней части раздела "Обозреватель" разверните свернутое меню **Устройства/Центр Интернета вещей Azure**. Вы увидите устройства и устройства IoT Edge, связанные с Центром Интернета вещей, который вы выбрали в палитре команд.

   ![Просмотр устройств в центре Интернета вещей](./media/tutorial-develop-for-linux/view-iot-hub-devices.png)

[!INCLUDE [iot-edge-create-container-registry](../../includes/iot-edge-create-container-registry.md)]

## <a name="create-a-new-module-project"></a>Создание проекта модуля

Расширение Azure IoT Tools предоставляет шаблоны проектов для всех поддерживаемых языков модулей IoT Edge в Visual Studio Code. Эти шаблоны содержат все файлы и код, необходимые для развертывания рабочего модуля для тестирования IoT Edge, а также станут отправной точкой для настройки шаблона в соответствии с вашей бизнес-логикой.

В этом учебнике мы используем шаблон модуля C#, так как он является самым распространенным шаблоном.

### <a name="create-a-project-template"></a>Создание шаблона проекта

В палитре команд Visual Studio Code найдите и выберите **Azure IoT Edge: New IoT Edge Solution** (Azure IoT Edge: создать решение IoT Edge). Выполняя инструкции, укажите следующие значения для создания решения:

   | Поле | Значение |
   | ----- | ----- |
   | Выбор папки | Выберите расположение на компьютере разработчика для VS Code, чтобы создать файлы решения. |
   | Введите название решения. | Введите описательное имя решения или примите имя по умолчанию **EdgeSolution**. |
   | Выбор шаблона модуля | Выберите **модуль C#** . |
   | Указание имени модуля | Примите значение по умолчанию **SampleModule**. |
   | Указание репозитория изображений Docker для модуля | Репозиторий изображений включает в себя имя реестра контейнеров и имя образа контейнера. Образ контейнера предварительно заполняется именем, которое вы указали на последнем шаге. Замените **localhost:5000** значением **сервера входа** из реестра контейнеров Azure. Вы можете узнать сервер входа на странице "Обзор" реестра контейнеров на портале Azure. <br><br> Окончательный вариант репозитория образов выглядит так: \<registry name\>.azurecr.io/samplemodule. |

   ![Выбор репозитория образа Docker](./media/tutorial-develop-for-linux/image-repository.png)

Как только ваше новое решение загрузится в окне Visual Studio Code, ознакомьтесь с файлами, которые оно создало:

* В папке **.vscode** содержится файл с именем **launch.json**, который используется для отладки модулей.
* В папке **modules** содержится папка для каждого модуля в решении. Прямо сейчас там есть папка **SampleModule** или папка с любым другим именем, которое вы дали модулю. В папке SampleModule содержится основной программный код, метаданные модуля и несколько файлов Docker.
* В **ENV**-файле хранятся учетные данные реестра контейнеров. Эти учетные данные совместно используются с вашим устройством IoT Edge, чтобы оно имело доступ для извлечения образов контейнеров.
* Файлы **Deployment.debug.template.json** и **deployment.template.json** — это шаблоны, которые помогут вам создать манифест развертывания. *Манифест развертывания* — это файл, который точно определяет, какие модули вы хотите развернуть на устройстве, как они должны быть настроены и как они могут взаимодействовать друг с другом и облаком. Файлы шаблонов используют указатели для некоторых значений. Когда вы преобразуете шаблон в настоящий манифест развертывания, указатели заменяются значениями, взятыми из других файлов решения. Найдите два общих заполнителя в шаблоне развертывания:

  * В разделе учетных данных реестра адрес автоматически заполняется на основе сведений, предоставленных вами при создании решения. Однако имя пользователя и пароль ссылаются на переменные, хранящиеся в ENV-файле. Эта конфигурация обеспечивает безопасность, так как ENV-файл игнорируется, а шаблон развертывания — нет.
  * В разделе SampleModule образ контейнера не заполняется, даже если вы создали репозиторий образов при создании решения. Этот заполнитель указывает на файл **module.json** внутри папки SampleModule. Если вы перейдете к этому файлу, вы увидите, что поле образа содержит репозиторий, а также значение тега, которое состоит из версии и платформы контейнера. Вы можете выполнить итерацию версии вручную в рамках цикла разработки и выбрать платформу контейнеров с помощью переключателя, который мы рассмотрим позже в этом разделе.

### <a name="provide-your-registry-credentials-to-the-iot-edge-agent"></a>Предоставление учетных данных реестра агенту IoT Edge

Файл среды хранит учетные данные для реестра контейнеров и совместно использует их со средой выполнения IoT Edge. Среде выполнения нужны эти учетные данные, чтобы извлечь образы контейнеров на устройство IoT Edge.

>[!NOTE]
>Если вы не заменили значение **localhost:5000** на значение сервера входа из реестра контейнеров Azure, на шаге [**Создание шаблона проекта**](#create-a-project-template) файл **.env** и раздел registryCredentials в манифесте развертывания будут отсутствовать. 

Расширение IoT Edge пытается извлечь учетные данные реестра контейнеров из Azure и заполнить их в файле среды. Проверьте, включены ли ваши учетные данные. В противном случае добавьте их:

1. Откройте **ENV**-файл в модуле решения.
2. Добавьте значения **имени пользователя** и **пароля**, скопированные из своего реестра контейнера Azure.
3. Сохраните изменения в ENV-файле.

### <a name="select-your-target-architecture"></a>Выбор целевой архитектуры

Сейчас Visual Studio Code позволяет разрабатывать модули C# для устройств Linux AMD64 и ARM32v7. Для каждого решения вам нужно выбрать одну архитектуру, так как это влияет на то, как будет создаваться и работать контейнер. По умолчанию используется Linux AMD64.

1. Откройте палитру команд и выполните поиск **Azure IoT Edge: Set Default Target Platform for Edge Solution** (Azure IoT Edge: установить целевую платформу по умолчанию для решения Edge) или выберите значок ярлыка на боковой панели в нижней части окна.

   ![Выбор значка архитектуры на боковой панели](./media/tutorial-develop-for-linux/select-architecture.png)

2. В палитре команд выберите целевую архитектуру из списка параметров. В рамках этого руководства мы используем в качестве устройства IoT Edge виртуальную машину Ubuntu. Поэтому сохраним значение по умолчанию **amd64**.

### <a name="review-the-sample-code"></a>Просмотр примера кода

Созданный вами шаблон решения включает в себя пример кода для модуля IoT Edge. Этот пример модуля просто принимает сообщения, а затем передает их. Функциональность конвейера демонстрирует важную концепцию в IoT Edge, которая заключается в том, как модули взаимодействуют друг с другом.

Каждый модуль может содержать несколько очередей *ввода* и *вывода*, объявленных в своем коде. Центр IoT Edge, работающий на устройстве, направляет сообщения из ввода одного модуля в вывод одного или нескольких модулей. Конкретный код для объявления входных и выходных данных варьируется в зависимости от языка, но принцип одинаков для всех модулей. Дополнительные сведения о маршрутизации между модулями см. в разделе [Объявление маршрутов](module-composition.md#declare-routes).

В примере кода C#, который поставляется с шаблоном проекта, используется [класс ModuleClient](/dotnet/api/microsoft.azure.devices.client.moduleclient) из пакета SDK для Центра Интернета вещей для .NET.

1. Откройте файл **Program.cs**, который находится в папке **modules/SampleModule/** .

2. В файле program.cs найдите метод **SetInputMessageHandlerAsync**.

3. Метод [SetInputMessageHandlerAsync](/dotnet/api/microsoft.azure.devices.client.moduleclient.setinputmessagehandlerasync) настраивает очередь ввода для получения входящих сообщений. Проверьте этот метод на инициализацию очереди ввода с названием **input1**.

   ![Поиск входного имени в конструкторе SetInputMessageCallback](./media/tutorial-develop-for-linux/declare-input-queue.png)

4. Затем найдите метод **SendEventAsync**.

5. Метод [SendEventAsync](/dotnet/api/microsoft.azure.devices.client.moduleclient.sendeventasync) обрабатывает полученные сообщения и настраивает очередь вывода, чтобы передать их вместе. Проверьте этот метод на инициализацию очереди вывода с названием **output1**.

   ![Поиск выходного имени в SendEventToOutputAsync](./media/tutorial-develop-for-linux/declare-output-queue.png)

6. Откройте файл **deployment.template.json**.

7. Найдите свойство **modules** для требуемых свойств $edgeAgent.

   Здесь должно быть два модуля. Первый — это модуль **SimulatedTemperatureSensor**, по умолчанию включенный во все шаблоны, чтобы предоставить имитированные данные о температуре, которые вы можете использовать для тестирования своих модулей. Вторым является модуль **SampleModule**, который вы создали как часть этого решения.

8. В нижней части файла найдите требуемые свойства для модуля **$edgeHub**.

   Одной из функций модуля центра IoT Edge является маршрутизация сообщений между всеми модулями в развертывании. Просмотрите значения в свойстве **routes**. Первый маршрут, **SampleModuleToIoTHub**, использует подстановочный знак (* *\** _) для указания любых сообщений, поступающих из любых выходных очередей в модуле SampleModule. Эти сообщения поступают в _$upstream*, зарезервированное имя, которое указывает на Центр Интернета вещей. Второй маршрут, **sensorToSampleModule**, принимает сообщения, поступающие из модуля SimulatedTemperatureSensor, и направляет их в очередь ввода *input1*, которую вы инициализировали в коде SampleModule.

   ![Просмотр маршрутов в deployment.template.json](./media/tutorial-develop-for-linux/deployment-routes.png)

## <a name="build-and-push-your-solution"></a>Сборка и отправка решения

Вы рассмотрели код модуля и шаблон развертывания, чтобы понять некоторые ключевые концепции развертывания. Теперь необходимо создать образ контейнера SampleModule и передать его в реестр контейнеров. С помощью расширения средств Интернета вещей для Visual Studio Code этот шаг также создает манифест развертывания на основе информации в файле шаблона и информации о модуле из файлов решения.

### <a name="sign-in-to-docker"></a>Вход в Docker

Предоставьте свои учетные данные реестра контейнеров в Docker, чтобы он мог передать ваш образ контейнера для хранения в реестре.

1. В Visual Studio Code откройте интегрированный терминал, последовательно выбрав элементы **Вид** > **Терминал**.

2. Войдите в Docker с помощью учетных данных реестра контейнеров Azure, которые вы сохранили после создания реестра.

   ```cmd/sh
   docker login -u <ACR username> -p <ACR password> <ACR login server>
   ```

   Возможно, появится предупреждение системы безопасности, в котором рекомендуется использовать `--password-stdin`. Для рабочих сценариев это лучшая методика, но мы не будем рассматривать ее в этом учебнике. Дополнительные сведения см. в описании команды [docker login](https://docs.docker.com/engine/reference/commandline/login/#provide-a-password-using-stdin) в справочнике.
   
3. Вход в реестр контейнеров Azure

   ```cmd/sh
   az acr login -n <ACR registry name>
   ```

### <a name="build-and-push"></a>Создание и отправка

Теперь у Visual Studio Code есть доступ к вашему реестру контейнеров, поэтому пришло время превратить код решения в образ контейнера.

1. В обозревателе Visual Studio Code щелкните правой кнопкой мыши файл **deployment.template.json** и выберите **Build and Push IoT Edge solution** (Создать и отправить решение IoT Edge).

   ![Создание и отправка модулей IoT Edge](./media/tutorial-develop-for-linux/build-and-push-modules.png)

   Эта команда сборки и отправки позволяет запустить три операции. Во-первых,в решении создается папка с именем **config**, которая содержит полный манифест развертывания на основе информации из шаблона развертывания и других файлов решения. Во-вторых, выполняется `docker build` для сборки образа контейнера на основе подходящего файла dockerfile для целевой архитектуры. В-третьих, выполняется `docker push` для отправки образа в реестр контейнеров.

   В первый раз выполнение этого процесса может занять несколько минут, но при следующем запуске команд он будет быстрее.

2. Откройте файл **deployment.amd64.json** в папке созданной конфигурации. Имя файла отражает целевую архитектуру, поэтому оно будет другим, если вы выбрали другую архитектуру.

3. Обратите внимание на то, что два параметра, которые имели заполнители, теперь заполнены правильными значениями. Раздел **registryCredentials** содержит имя пользователя и пароль реестра, полученные из ENV-файла. **SampleModule** содержит полный репозиторий образов с именем, версией и тегом архитектуры из модуля файла module.json.

4. Откройте файл **module.json** в папке SampleModule.

5. Измените номер версии для образа модуля. (Это не версия $schema). Например, увеличьте номер версии исправления до **0.0.2**, как будто мы сделали небольшое исправление в коде модуля.

   >[!TIP]
   >Версии модулей обеспечивают управление версиями и позволяют тестировать изменения на небольшом наборе устройств, прежде чем развертывать обновления в рабочей среде. Если перед построением и принудительной отправкой вы не увеличите версию модуля, перезапишите репозиторий в реестре контейнеров.

6. Сохраните изменения в файле module.json.

7. Щелкните правой кнопкой мыши файл **deployment.template.json** и выберите **Build and Push IoT Edge solution** (Создать и отправить решение IoT Edge).

8. Снова откройте файл **deployment.amd64.json**. Обратите внимание, что при повторном выполнении команды сборки и отправки новый файл не был создан. Вместо этого, чтобы отразить изменения, был обновлен тот же файл. Образ SampleModule теперь указывает на контейнер версии 0.0.2.

9. Чтобы дополнительно проверить, что сделала команда создания и отправки, откройте [портал Azure](https://portal.azure.com) и перейдите к своему реестру контейнеров.

10. В реестре контейнеров щелкните **Репозитории**, а затем выберите **samplemodule**. Убедитесь, что обе версии образа отправлены в реестр.

    ![Просмотр обеих версий образа в реестре контейнеров](./media/tutorial-develop-for-linux/view-repository-versions.png)

<!--Alternative steps: Use VS Code Docker tools to view ACR images with tags-->

### <a name="troubleshoot"></a>Диагностика

Если вы сталкиваетесь с ошибками при создании и отправке образа вашего модуля, это часто связано с настройкой Docker на вашем компьютере для разработки. Чтобы просмотреть конфигурацию, выполните следующие проверки:

* Вы выполнили команду `docker login`, используя учетные данные, скопированные из реестра контейнеров? Эти учетные данные отличаются от тех, которые вы используете для входа на портал Azure.
* Правильно ли указан репозиторий контейнеров? У вас есть правильное имя реестра контейнеров и правильное имя модуля? Чтобы проверить, откройте файл **module.json** в папке SampleModule. Значение репозитория должно выглядеть так: **\<registry name\>.azurecr.io/samplemodule**.
* Если вы использовали другое имя, отличное от **SampleModule**, для вашего модуля, согласовано ли оно во всем решении?
* Ваш компьютер использует тот же тип контейнеров, который вы создаете? Этот учебник предназначен для устройств IoT Edge с Linux, поэтому на боковой панели в Visual Studio Code должно отображаться **amd64** или **arm32v7**, а на Docker Desktop должны запускаться контейнеры Linux.  

## <a name="deploy-modules-to-device"></a>Развертывание модулей на устройстве

Вы убедились, что образы встроенных контейнеров хранятся в реестре контейнеров, поэтому пришло время развернуть их на устройстве. Убедитесь, что устройство IoT Edge работает.

1. В обозревателе Visual Studio Code в разделе **Центр Интернета вещей Azure** разверните меню **Устройства**, чтобы отобразить список устройств Интернета вещей.

2. Щелкните устройство IoT Edge правой кнопкой мыши, а затем выберите **Create Deployment for Single Device** (Создание развертывания для одного устройства).

   ![Создание развертывания для одного устройства](./media/tutorial-develop-for-linux/create-deployment.png)

3. В проводнике перейдите в папку **​​config** и выберите файл **deployment.amd64.json**.

   Не используйте файл deployment.template.json, в котором нет учетных данных реестра контейнера или значений образа модуля. Если вы ориентируетесь на устройство Linux ARM32, манифест развертывания будет называться deployment.arm32v7.json.

4. Разверните меню **Модули** для своего устройства, чтобы просмотреть список развернутых и запущенных модулей. Нажмите кнопку "Обновить". Вы должны увидеть новые модули SimulatedTemperatureSensor и SampleModule, которые выполняются на вашем устройстве.

   На запуск модулей может потребоваться несколько минут. Среда выполнения IoT Edge должна получить новый манифест развертывания, извлечь образы модулей из среды выполнения контейнеров, а затем запустить каждый новый модуль.

   ![Просмотр данных о модулях, запущенных на устройстве IoT Edge](./media/tutorial-develop-for-linux/view-running-modules.png)

## <a name="view-messages-from-device"></a>Просмотр сообщений с устройства

Код SampleModule получает сообщения через свою очередь входящих сообщений и передает их через свою очередь выходящих сообщений. В манифесте развертывания объявлены маршруты, которые передают сообщения в SampleModule из SimulatedTemperatureSensor, а затем пересылают сообщения из SampleModule в IoT Hub. Средства Интернета вещей Azure для Visual Studio Code позволяют просматривать сообщения по мере их поступления в Центр Интернета вещей с ваших отдельных устройств.

1. В обозревателе Visual Studio Code щелкните правой кнопкой мыши имя устройства IoT Edge, которое вы хотите отслеживать, и выберите **Start Monitoring Built-in Event Endpoint** (Начать мониторинг встроенной конечной точки событий).

2. Посмотрите в окно вывода в Visual Studio Code, чтобы увидеть сообщения, поступающие в центр Интернета вещей.

   ![Просмотр входящих сообщений с устройств в облако](./media/tutorial-develop-for-linux/view-d2c-messages.png)

## <a name="view-changes-on-device"></a>Просмотр изменений на устройстве

Чтобы проверить среду выполнения IoT Edge и модули, работающие на вашем устройстве, используйте команды, приведенные в этом разделе.

Команды в этом разделе предназначены для устройства IoT Edge, а не для компьютера для разработки. Если вы используете виртуальную машину для устройства IoT Edge, подключитесь к ней сейчас. В Azure перейдите на страницу обзора виртуальной машины и щелкните **Подключить**, чтобы получить доступ к безопасному соединению оболочки.

* Просмотрите все модули, развернутые на вашем устройстве, и проверьте их состояние:

   ```bash
   iotedge list
   ```

   Вы увидите четыре модуля: два модуля времени выполнения IoT Edge, SimulatedTemperaSensor и SampleModule. Все четыре должны быть указаны как работающие.

* Просмотрите журналы для определенного модуля:

   ```bash
   iotedge logs <module name>
   ```

   Модули IoT Edge учитывают регистр.

   Журналы SimulatedTemperatureSensor и SampleModule должны отображать сообщения, которые они обрабатывают. Модуль edgeAgent отвечает за запуск других модулей, поэтому его журналы будут содержать информацию о реализации манифеста развертывания. Если какой-либо модуль не указан или не запущен, возможно, в журналах edgeAgent возникли ошибки. Модуль edgeHub отвечает за обмен данными между модулями и Центром Интернета вещей. Если модули запущены и работают, но сообщения не поступают в ваш центр Интернета вещей, вероятно журналы edgeHub будут содержать ошибки.

## <a name="clean-up-resources"></a>Очистка ресурсов

Если вы планируете перейти к следующей рекомендуемой статье, можно сохранить созданные и повторно используемые ресурсы и конфигурации. Это же устройство IoT Edge также можно использовать в качестве тестового устройства.

В противном случае вы можете удалить локальные конфигурации и ресурсы Azure, созданные в рамках этой статьи, чтобы избежать расходов.

[!INCLUDE [iot-edge-clean-up-cloud-resources](../../includes/iot-edge-clean-up-cloud-resources.md)]

## <a name="next-steps"></a>Дальнейшие действия

В этом учебнике вы настроили Visual Studio Code на своем компьютере для разработки и развернули на нем свой первый модуль IoT Edge. Теперь, когда вы знаете основные понятия, попробуйте добавить функциональность в модуль, чтобы он мог анализировать данные, проходящие через него. Выберите предпочитаемый язык.

> [!div class="nextstepaction"]
> [C](tutorial-c-module.md)
> [C#](tutorial-csharp-module.md)
> [Java](tutorial-java-module.md)
> [Node.js](tutorial-node-module.md)
> [Python](tutorial-python-module.md)
