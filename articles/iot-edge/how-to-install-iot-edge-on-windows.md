---
title: Установка Azure IoT Edge для Linux в Windows | Документация Майкрософт
description: Инструкции по установке Azure IoT Edge на устройствах Windows
author: kgremban
manager: philmea
ms.reviewer: veyalla
ms.service: iot-edge
services: iot-edge
ms.topic: conceptual
ms.date: 01/20/2021
ms.author: v-tcassi
monikerRange: =iotedge-2018-06
ms.openlocfilehash: 3470e07c1b5673efa6cd015e43e077828da1573e
ms.sourcegitcommit: 75041f1bce98b1d20cd93945a7b3bd875e6999d0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/22/2021
ms.locfileid: "98703671"
---
# <a name="install-and-provision-azure-iot-edge-for-linux-on-a-windows-device-preview"></a>Установка и инициализация Azure IoT Edge для Linux на устройстве Windows (Предварительная версия)

Среда выполнения Azure IoT Edge превращает устройство в устройство IoT Edge. Среда выполнения может быть развернута на устройствах от класса ПК до промышленных серверов. После настройки устройства с помощью среды выполнения IoT Edge можно приступить к развертыванию в ней бизнес-логики из облака. Дополнительные сведения см. [в разделе Знакомство со средой выполнения Azure IOT EDGE и ее архитектурой](iot-edge-runtime.md).

Azure IoT Edge для Linux в Windows позволяет использовать Azure IoT Edge на устройствах Windows с помощью виртуальных машин Linux. Версия Linux Azure IoT Edge и все развернутые на нем модули Linux выполняются на виртуальной машине. В нем приложения и код Windows, а также среда выполнения IoT Edge и модули могут свободно взаимодействовать друг с другом.

В этой статье перечислены действия по настройке IoT Edge на устройстве Windows. При выполнении этих действий выполняется развертывание виртуальной машины Linux, которая содержит среду выполнения IoT Edge, для запуска на устройстве Windows, а затем подготавливает устройство с удостоверением устройства центра Интернета вещей.

>[!NOTE]
>IoT Edge для Linux в Windows находится в [общедоступной предварительной версии](https://azure.microsoft.com/support/legal/preview-supplemental-terms/).

## <a name="prerequisites"></a>Предварительные условия

* Учетная запись Azure с действительной подпиской. Если у вас еще нет [подписки Azure](../guides/developer/azure-developer-guide.md#understanding-accounts-subscriptions-and-billing), создайте [бесплатную учетную запись Azure](https://azure.microsoft.com/free/), прежде чем начать работу.

* [Центр Интернета вещей](../iot-hub/iot-hub-create-through-portal.md) ценовой категории "Бесплатный" или "Стандартный" в Azure.

* Устройство Windows со следующими минимальными требованиями к системе:

  * Windows 10 версии 1809 или более поздней; Сборка 17763 или более поздняя
  * Выпуски Professional, Enterprise или Server
  * Минимальный объем ОЗУ: 4 ГБ (рекомендуется 8 ГБ)
  * Минимальный объем хранилища: 10 ГБ

* Доступ к сборке Insider Preview в центре администрирования Windows с установленным расширением Azure IoT Edge для центра администрирования Windows:  <!-- The link below needs the language localization to work; otherwise broken -->
   1. Посетите [предварительную версию Windows Insider](https://www.microsoft.com/en-us/software-download/windowsinsiderpreviewserver)Preview.

   1. В раскрывающемся списке предварительного просмотра выберите **Windows Admin Center (Предварительная версия) — сборка 2012** и нажмите кнопку **подтвердить**.

      ![В раскрывающемся меню доступные предварительные версии выберите центр администрирования Windows — сборка 2012.](./media/how-to-install-iot-edge-on-windows/select-windows-admin-center-preview-build.png)

   1. В раскрывающемся списке **выберите язык** выберите **Английский** и нажмите кнопку **подтвердить**.

   1. Выберите **скачать сейчас** , чтобы скачать *WindowsAdminCenterPreview2012.msi*.

   1. Запустите *WindowsAdminCenterPreview2012.msi* и следуйте инструкциям мастера установки, чтобы установить центр администрирования Windows. После установки откройте центр администрирования Windows.

   1. При первом использовании центра администрирования Windows вам будет предложено выбрать сертификат для использования. В качестве сертификата выберите **клиент центра администрирования Windows** .

   1. Время установки расширения Azure IoT Edge. Щелкните значок шестеренки в правом верхнем углу панели мониторинга центра администрирования Windows.

      ![Щелкните значок шестеренки в правом верхнем углу панели мониторинга, чтобы получить доступ к параметрам.](./media/how-to-install-iot-edge-on-windows/select-gear-icon.png)

   1. В меню **Параметры** в разделе **шлюз** выберите **расширения**.

   1. Перейдите на вкладку **веб-каналы** и нажмите кнопку **Добавить**.

   1. Введите https://aka.ms/wac-insiders-feed в текстовое поле и нажмите кнопку **Добавить**.

   1. После добавления веб-канала перейдите на вкладку **Доступные расширения** . Обновление списка расширений может занять некоторое время.

   1. На вкладке **Доступные расширения** найдите **Azure IOT Edge** в списке расширений. Выберите его и выберите запрос **установки** над списком расширений.

   1. После завершения установки в списке установленных расширений на вкладке **установленные расширения** появится Azure IOT Edge.

## <a name="choose-your-provisioning-method"></a>Выбор метода подготовки

Azure IoT Edge для Linux в Windows поддерживает следующие методы подготовки:

* Подготовка вручную с помощью строки подключения устройства IoT Edge. Чтобы использовать этот метод, зарегистрируйте устройство и получите строку подключения, выполнив действия, описанные в статье [регистрация IOT Edge устройства в центре Интернета вещей](how-to-register-device.md).
  * Выберите параметр аутентификации с симметричным ключом, так как сертификаты X. 509 в настоящее время не поддерживаются IoT Edge для Linux в Windows.
* Автоматическая подготовка с помощью службы подготовки устройств (DPS) и симметричных ключей. Узнайте больше о [создании и подготовке устройства IOT Edge с помощью политики DPS и симметричных ключей](how-to-auto-provision-symmetric-keys.md).
* Автоматическая подготовка с использованием DPS и сертификатов X. 509. Узнайте больше о [создании и подготовке устройства IOT Edge с помощью DPS и сертификатов X. 509](how-to-auto-provision-x509-certs.md).

Подготовка вручную упрощает запуск нескольких устройств. Служба подготовки устройств полезна для подготовки множества устройств.

Если вы планируете использовать один из методов DPS для подготовки устройства или устройств, выполните действия, описанные в соответствующей статье, чтобы создать экземпляр DP, связать экземпляр DPS с центром Интернета вещей и создать регистрацию в службу DPS. Можно создать *отдельную регистрацию* для одного устройства или группы, чтобы *зарегистрировать* группу устройств. Дополнительные сведения о типах регистрации см. в статье [Основные понятия службы подготовки устройств для центра Интернета вещей Azure](https://docs.microsoft.com/azure/iot-dps/concepts-service#enrollment).

## <a name="create-a-new-deployment"></a>Создание развертывания

Создайте развертывание Azure IoT Edge для Linux в Windows на целевом устройстве.

# <a name="windows-admin-center"></a>[Windows Admin Center](#tab/windowsadmincenter);

На начальной странице центра администрирования Windows в списке подключений отображается подключение к локальному узлу, представляющее компьютер, на котором работает центр администрирования Windows. Все дополнительные серверы, компьютеры или кластеры, которыми вы управляете, также будут отображаться здесь.

Центр администрирования Windows можно использовать для установки и управления Azure IoT Edge для Linux в Windows на локальном устройстве или на удаленных управляемых устройствах. В этом пошаговом окне Подключение к локальному узлу будет служить целевым устройством для развертывания Azure IoT Edge для Linux в Windows.

Если вы хотите выполнить развертывание на удаленном целевом устройстве, а не на локальном устройстве, и вы не видите нужное целевое устройство в списке, следуйте [инструкциям по добавлению устройства.](https://docs.microsoft.com/windows-server/manage/windows-admin-center/use/get-started#connecting-to-managed-nodes-and-clusters)

   ![Начальная панель мониторинга центра администрирования Windows с указанным целевым устройством](./media/how-to-install-iot-edge-on-windows/windows-admin-center-initial-dashboard.png)

1. Выберите **Добавить**.

1. На панели **Добавление или создание ресурсов** выберите плитку **Azure IOT Edge** . Выберите **создать** , чтобы установить новый экземпляр Azure IOT Edge для Linux в Windows на устройстве.

   Если у вас уже есть IoT Edge для Linux в Windows, работающем на устройстве, можно нажать кнопку **Добавить** , чтобы подключиться к существующему IOT Edge устройству и управлять им с помощью центра администрирования Windows.

   ![Щелкните элемент создать на плитке Azure IoT Edge в центре администрирования Windows.](./media/how-to-install-iot-edge-on-windows/resource-creation-tiles.png)

1. Откроется область **развертывания создание Azure IOT Edge для Linux в Windows** . На **1. Начало работы** вкладке убедитесь, что целевое устройство соответствует минимальным требованиям, и нажмите кнопку **Далее**.

1. Просмотрите условия лицензионного соглашения, установите флажок **я принимаю** и нажмите кнопку **Далее**.

1. Можно включить или отключить **дополнительные диагностические данные** в зависимости от предпочтений.

1. Нажмите кнопку **Далее: развернуть**.

   ![Нажмите кнопку Далее: развернуть после переключения необязательных диагностических данных в предпочтения.](./media/how-to-install-iot-edge-on-windows/select-next-deploy.png)

1. На странице **2. Вкладка Развертывание** в разделе **выберите целевое устройство** щелкните свое устройство, чтобы проверить соответствие минимальным требованиям. Когда состояние будет подтверждено как поддерживается, нажмите кнопку **Далее**.

   ![Выберите устройство, чтобы убедиться, что оно поддерживается](./media/how-to-install-iot-edge-on-windows/evaluate-supported-device.png)

1. Примите параметры по умолчанию на вкладке **параметры 2,2** .

1. На вкладке **развертывание 2,3** можно просмотреть ход выполнения развертывания. Полный процесс включает в себя загрузку пакета Azure IoT Edge для Linux в Windows, установку пакета, настройку устройства узла и настройку виртуальной машины Linux. Выполнение этого процесса может занять несколько минут. Успешное развертывание показано ниже.

   ![При успешном развертывании каждый шаг будет отображаться зеленой галочкой и меткой "завершено"](./media/how-to-install-iot-edge-on-windows/successful-deployment.png)

После завершения развертывания вы можете подготовить устройство. Нажмите кнопку **Далее: подключиться** , чтобы перейти к **3.** Вкладка "подключение", которая обрабатывает Azure IOT Edge подготовки устройств.

# <a name="powershell"></a>[PowerShell](#tab/powershell)

Установите IoT Edge для Linux в Windows на целевое устройство, если это еще не сделано.

> [!NOTE]
> В следующем примере процесса PowerShell показано, как создать развертывание на локальном узле Azure IoT Edge для Linux в Windows. Чтобы создать развертывание на удаленном целевом устройстве с помощью PowerShell, можно использовать [удаленную оболочку PowerShell](https://docs.microsoft.com/powershell/module/microsoft.powershell.core/about/about_remote) , чтобы установить подключение к удаленному устройству и выполнить удаленное выполнение этих команд на этом устройстве.

1. В сеансе PowerShell с повышенными привилегиями выполните каждую из следующих команд, чтобы скачать IoT Edge для Linux в Windows.

   ```azurepowershell-interactive
   $msiPath = $([io.Path]::Combine($env:TEMP, 'AzureIoTEdge.msi'))
   $ProgressPreference = 'SilentlyContinue'
   Invoke-WebRequest "https://aka.ms/AzureEdgeForLinuxOnWindowsMSI" -OutFile $msiPath
   ```

1. Установите IoT Edge для Linux в Windows на устройстве.

   ```azurepowershell-interactive
   Start-Process -Wait msiexec -ArgumentList "/i","$([io.Path]::Combine($env:TEMP, 'AzureIoTEdge.msi'))","/qn"
   ```

   > [!NOTE]
   > Вы можете указать пользовательские IoT Edge для Linux в установочных каталогах Windows и VHDX-каталоги, добавив параметры INSTALLDIR = "<FULLY_QUALIFIED_PATH>" и ВХДКСДИР = "<FULLY_QUALIFIED_PATH>" в команду Install выше.

1. Чтобы развертывание выполнялось успешно, необходимо присвоить политике выполнения на целевом устройстве значение, `AllSigned` если оно еще не задано. Текущую политику выполнения можно проверить в командной строке PowerShell с повышенными привилегиями, используя:

   ```azurepowershell-interactive
   Get-ExecutionPolicy -List
   ```

   Если политика выполнения `local machine` не имеет значение `AllSigned` , политику выполнения можно задать с помощью:

   ```azurepowershell-interactive
   Set-ExecutionPolicy -ExecutionPolicy AllSigned -Force
   ```

1. Создание IoT Edge для развертывания Linux в Windows.

   ```azurepowershell-interactive
   Deploy-Eflow
   ```

   <!-- Most likely temporary until cmdlet is fully documented -->
   > [!NOTE]
   > Эту команду можно выполнить без параметров или при необходимости настроить развертывание с параметрами. Изучите модуль PowerShell Азурифлов. psm1, чтобы просмотреть параметры и их значение (см. раздел C:\Program Филес\виндовсповершелл\модулес\азурифлов).

1. Введите "Y", чтобы принять условия лицензионного соглашения.

1. Введите "O" или "R", чтобы включить или отключить **дополнительные диагностические данные** в зависимости от предпочтений. Успешное развертывание показано ниже.

   ![Успешное развертывание получит сообщение "Развертывание прошло успешно" в конце сообщения](./media/how-to-install-iot-edge-on-windows/successful-powershell-deployment.png)

После завершения развертывания вы можете подготовить устройство.

---

Чтобы подготовить устройство, воспользуйтесь приведенными ниже ссылками, чтобы перейти к разделу, в котором находится выбранный метод подготовки:

* [Вариант 1. Подготовка вручную с помощью строки подключения устройства IoT Edge](#option-1-provisioning-manually-using-the-connection-string)
* [Вариант 2. Автоматическая подготовка с помощью службы подготовки устройств (DPS) и симметричных ключей](#option-2-provisioning-via-dps-using-symmetric-keys)
* [Вариант 3. Автоматическая подготовка с использованием DPS и сертификатов X. 509](#option-3-provisioning-via-dps-using-x509-certificates)

## <a name="provision-your-device"></a>Подготавливает устройство

Выберите метод подготовки устройства и следуйте инструкциям в соответствующем разделе. Для подготовки устройств можно использовать центр администрирования Windows или сеанс PowerShell с повышенными привилегиями.

### <a name="option-1-provisioning-manually-using-the-connection-string"></a>Вариант 1. Подготовка вручную с помощью строки подключения

В этом разделе описывается подготовка устройства вручную с помощью строки подключения устройства Azure IoT Edge.

# <a name="windows-admin-center"></a>[Windows Admin Center](#tab/windowsadmincenter);

1. В области **Подготовка устройства Azure IOT Edge** выберите **строку подключения (вручную)** в раскрывающемся списке Метод подготовки.

1. В [портал Azure](https://ms.portal.azure.com/)перейдите на вкладку **IOT Edge** центра Интернета вещей.

1. Щелкните идентификатор устройства. Скопируйте поле **первичная строка подключения** .

1. Вставьте его в поле Строка подключения устройства в центре администрирования Windows. Затем выберите **подготовку с помощью выбранного метода**.

   ![Выберите подготовку с выбранным методом после того, как будет вставлена строка подключения устройства](./media/how-to-install-iot-edge-on-windows/provisioning-with-selected-method-connection-string.png)

1. После завершения подготовки нажмите кнопку **Готово**. Вы будете перенаправлены на главную панель мониторинга. Теперь в списке должно отобразиться новое устройство с типом `IoT Edge Devices` . Вы можете выбрать устройство IoT Edge для подключения к нему. На странице **обзора** можно просмотреть **список модулей IOT Edge** и **IOT Edge состояние** устройства.

# <a name="powershell"></a>[PowerShell](#tab/powershell)

1. В [портал Azure](https://ms.portal.azure.com/)перейдите на вкладку **IOT Edge** центра Интернета вещей.

1. Щелкните идентификатор устройства. Скопируйте поле **первичная строка подключения** .

1. Вставьте текст заполнителя в следующую команду и запустите его в сеансе PowerShell с повышенными привилегиями на целевом устройстве.

   ```azurepowershell-interactive
   Provision-EflowVm -provisioningType manual -devConnString "<CONNECTION_STRING_HERE>"
   ```

---

### <a name="option-2-provisioning-via-dps-using-symmetric-keys"></a>Вариант 2. Подготовка через службу DPS с помощью симметричных ключей

В этом разделе описывается подготовка устройства автоматически с помощью политики DPS и симметричных ключей.

# <a name="windows-admin-center"></a>[Windows Admin Center](#tab/windowsadmincenter);

1. В области **Подготовка устройства Azure IOT Edge** выберите **симметричный ключ (DPS)** в раскрывающемся списке Метод подготовки.

1. В [портал Azure](https://ms.portal.azure.com/)перейдите к экземпляру DP.

1. На вкладке **Обзор** скопируйте значение **области идентификатор** . Вставьте его в поле Идентификатор области в центре администрирования Windows.

1. На вкладке **Управление регистрацией** в портал Azure выберите созданную вами регистрацию. Скопируйте значение **первичного ключа** в сведения о регистрации. Вставьте его в поле симметричный ключ в центре администрирования Windows.

1. Укажите идентификатор регистрации устройства в поле идентификатор регистрации в центре администрирования Windows.

1. Выберите **подготовку с помощью выбранного метода**.

   ![Выберите подготовку с помощью выбранного метода после заполнения обязательных полей для подготовки симметричного ключа.](./media/how-to-install-iot-edge-on-windows/provisioning-with-selected-method-symmetric-key.png)

1. После завершения подготовки нажмите кнопку **Готово**. Вы будете перенаправлены на главную панель мониторинга. Теперь в списке должно отобразиться новое устройство с типом `IoT Edge Devices` . Вы можете выбрать устройство IoT Edge для подключения к нему. На странице **обзора** можно просмотреть **список модулей IOT Edge** и **IOT Edge состояние** устройства.

# <a name="powershell"></a>[PowerShell](#tab/powershell)

1. Скопируйте приведенную ниже команду в текстовый редактор. Замените текст заполнителя информацией как подробный.

   ```azurepowershell-interactive
   Provision-EflowVm -provisioningType symmetric -scopeId <ID_SCOPE_HERE> -registrationId <REGISTRATION_ID_HERE> -symmKey <PRIMARY_KEY_HERE>
   ```

1. В [портал Azure](https://ms.portal.azure.com/)перейдите к экземпляру DP.

1. На вкладке **Обзор** скопируйте значение **области идентификатор** . Вставьте его поверх соответствующего текста заполнителя в команде.

1. На вкладке **Управление регистрацией** в портал Azure выберите созданную вами регистрацию. Скопируйте значение **первичного ключа** в сведения о регистрации. Вставьте его поверх соответствующего текста заполнителя в команде.

1. Укажите идентификатор регистрации устройства, чтобы заменить соответствующий текст заполнителя в команде.

1. Выполните команду в сеансе PowerShell с повышенными привилегиями на целевом устройстве.

---

### <a name="option-3-provisioning-via-dps-using-x509-certificates"></a>Вариант 3. Подготовка через службу DPS с помощью сертификатов X. 509

В этом разделе описывается подготовка устройства автоматически с помощью DPS и сертификатов X. 509.

# <a name="windows-admin-center"></a>[Windows Admin Center](#tab/windowsadmincenter);

1. В области **Подготовка устройства Azure IOT Edge** выберите **сертификат X. 509 (DPS)** в раскрывающемся списке Метод подготовки.

1. В [портал Azure](https://ms.portal.azure.com/)перейдите к экземпляру DP.

1. На вкладке **Обзор** скопируйте значение **области идентификатор** . Вставьте его в поле Идентификатор области в центре администрирования Windows.

1. Укажите идентификатор регистрации устройства в поле идентификатор регистрации в центре администрирования Windows.

1. Отправьте файлы сертификата и закрытого ключа.

1. Выберите **подготовку с помощью выбранного метода**.

   ![Выберите подготовку с помощью выбранного метода после заполнения обязательных полей для подготовки сертификата X. 509.](./media/how-to-install-iot-edge-on-windows/provisioning-with-selected-method-x509-certs.png)

1. После завершения подготовки нажмите кнопку **Готово**. Вы будете перенаправлены на главную панель мониторинга. Теперь в списке должно отобразиться новое устройство с типом `IoT Edge Devices` . Вы можете выбрать устройство IoT Edge для подключения к нему. На странице **обзора** можно просмотреть **список модулей IOT Edge** и **IOT Edge состояние** устройства.

# <a name="powershell"></a>[PowerShell](#tab/powershell)

1. Скопируйте приведенную ниже команду в текстовый редактор. Замените текст заполнителя информацией как подробный.

   ```azurepowershell-interactive
   Provision-EflowVm -provisioningType x509 -scopeId <ID_SCOPE_HERE> -registrationId <REGISTRATION_ID_HERE> -identityCertLocWin <ABSOLUTE_CERT_SOURCE_PATH_ON_WINDOWS_MACHINE> -identityPkLocWin <ABSOLUTE_PRIVATE_KEY_SOURCE_PATH_ON_WINDOWS_MACHINE> -identityCertLocWin <ABSOLUTE_CERT_DEST_PATH_ON_LINUX_MACHINE -identityPkLocVm <ABSOLUTE_PRIVATE_KEY_DEST_PATH_ON_LINUX_MACHINE>
   ```

1. В [портал Azure](https://ms.portal.azure.com/)перейдите к экземпляру DP.

1. На вкладке **Обзор** скопируйте значение **области идентификатор** . Вставьте его поверх соответствующего текста заполнителя в команде.

1. Укажите идентификатор регистрации устройства, чтобы заменить соответствующий текст заполнителя в команде.

1. Замените соответствующий текст заполнителя абсолютным исходным путем к файлу сертификата.

1. Замените соответствующий текст заполнителя абсолютным исходным путем к файлу закрытого ключа.

1. Выполните команду в сеансе PowerShell с повышенными привилегиями на целевом устройстве.

---

## <a name="verify-successful-configuration"></a>Проверка успешной настройки

Убедитесь, что IoT Edge для Linux в Windows успешно установлены и настроены на устройстве IoT Edge.

1. Выберите устройство IoT Edge из списка подключенных устройств в центре администрирования Windows, чтобы подключиться к нему.
1. На странице "Обзор устройства" отображаются некоторые сведения об устройстве:

    1. В разделе **список модулей IOT Edge** показано выполнение модулей на устройстве. Когда служба IoT Edge запускается впервые, вы должны увидеть только запущенный модуль **edgeAgent** . Модуль edgeAgent запускается по умолчанию и позволяет установить и запустить любые дополнительные модули, развертываемые на устройстве.
    1. В разделе **состояние IOT Edge** отображаются сведения о состоянии службы и о том, что отчет должен быть **активен (работает)**.

1. Если вам нужно устранить неполадки со службой IoT Edge, используйте средство **командной оболочки** на странице устройства для SSH (Secure Shell) на виртуальной машине и выполните команды Linux.

    1. Если нужно устранить неполадки со службой, извлеките журналы службы.

       ```bash
       journalctl -u iotedge
       ```

    2. Используйте `check` средство для проверки конфигурации и состояния подключения устройства.

       ```bash
       sudo iotedge check
       ```

## <a name="next-steps"></a>Следующие шаги

Продолжайте [развертывать модули IOT Edge](how-to-deploy-modules-portal.md) , чтобы узнать, как развернуть модули на устройстве.
