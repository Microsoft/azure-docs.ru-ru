---
title: Управление доступом к данным Sentinel Azure по ресурсу | Документация Майкрософт
description: В этой статье объясняется, как управлять доступом к данным Sentinel Azure с помощью ресурсов, к которым у пользователя есть доступ. Управление доступом по ресурсам позволяет предоставлять доступ только к конкретным данным, не выполняя весь процесс Azure Sentinel. Этот метод также известен как контекст ресурса RBAC.
services: sentinel
cloud: na
documentationcenter: na
author: batamig
manager: rkarlin
ms.assetid: ''
ms.service: azure-sentinel
ms.subservice: azure-sentinel
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: conceptual
ms.date: 03/03/2021
ms.author: bagol
ms.openlocfilehash: 26124f8f650e1006244b4871e26962d417d90fd4
ms.sourcegitcommit: 867cb1b7a1f3a1f0b427282c648d411d0ca4f81f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/20/2021
ms.locfileid: "102055047"
---
# <a name="manage-access-to-azure-sentinel-data-by-resource"></a>Управление доступом к данным Sentinel Azure по ресурсам

Как правило, пользователи, у которых есть доступ к рабочей области Sentinel Azure, также имеют доступ ко всем данным рабочей области, включая содержимое системы безопасности. Администраторы могут использовать [роли Azure](roles.md) для настройки доступа к конкретным функциям в Azure Sentinel в зависимости от требований к доступу в группе.

Тем не менее у вас может быть несколько пользователей, которым требуется доступ только к определенным данным в рабочей области "Sentinel" Azure, но у вас нет доступа ко всей среде Azure Sentinel. Например, может потребоваться предоставить группе операций, не связанных с безопасностью (не-SOC), доступ к данным событий Windows для серверов, которыми они владеют.

В таких случаях рекомендуется настроить управление доступом на основе ролей (RBAC) на основе ресурсов, разрешенных для пользователей, вместо предоставления им доступа к рабочей области Azure Sentinel или конкретным функциям Azure Sentinel. Этот метод также называется настройкой **RBAC для контекста ресурса**.

Когда пользователи получают доступ к данным Sentinel Azure через ресурсы, к которым они могут получить доступ, а не рабочую область Azure Sentinel, они могут просматривать журналы и книги с помощью следующих методов:

- **Через сам ресурс**, например виртуальную машину Azure. Этот метод используется для просмотра журналов и книг только для определенного ресурса.

- **Через Azure Monitor**. Используйте этот метод, если требуется создать запросы, охватывающие несколько ресурсов или групп ресурсов. При переходе к журналам и книгам в Azure Monitor определите область для одной или нескольких определенных групп ресурсов или ресурсов.

Включение контекста ресурса RBAC в Azure Monitor. Дополнительные сведения см. [в разделе Управление доступом к данным и рабочим областям журнала в Azure Monitor](/azure/azure-monitor/logs/manage-access).

> [!NOTE]
> Если данные не являются ресурсами Azure, такими как syslog, CEF или AAD, или данные, собранные пользовательским сборщиком, необходимо вручную настроить идентификатор ресурса, используемый для идентификации данных, и разрешить доступ.
>
> Дополнительные сведения см. в разделе [явная настройка контекстного ресурса RBAC](#explicitly-configure-resource-context-rbac).
>
## <a name="scenarios-for-resource-context-rbac"></a>Сценарии для контекста ресурса RBAC

В следующей таблице перечислены сценарии, в которых наиболее полезны контекстные ресурсы RBAC. Обратите внимание на различия в требованиях к доступу между командами SOC и группами, не являющимися командами SOC.

| Тип требования |Команда SOC  |Группа, не относящаяся к SOC  |
|---------|---------|---------|
|**Разрешения**     | Вся рабочая область        |   Только определенные ресурсы      |
|**Доступ к данным**     |  Все данные в рабочей области       | Только данные для ресурсов, доступ к которым разрешен группе        |
|**Взаимодействие**     |  Полный интерфейс Azure Sentinel, возможно, ограничен [функциональными разрешениями](roles.md) , назначенными пользователю.       |  Вести журнал только для запросов и книг       |
|     |         |         |

Если у вашей команды есть аналогичные требования к доступу к группе, не являющейся группой SOC, описанной в таблице выше, то в качестве решения для вашей организации можно использовать контекстные ресурсы RBAC.

## <a name="alternative-methods-for-implementing-resource-context-rbac"></a>Альтернативные методы реализации RBAC контекста ресурса

В зависимости от разрешений, необходимых в вашей организации, использование контекста ресурса RBAC может не дать полного решения.

В следующем списке описаны сценарии, в которых другие решения для доступа к данным могут соответствовать вашим требованиям.

|Сценарий  |Решение  |
|---------|---------|
|**У представительства есть группа SoC, которая требует полноценного использования Azure Sentinel**.     |  В этом случае используйте архитектуру с несколькими рабочими областями для разделения разрешений на данные. <br><br>Дополнительные сведения см. в разделе: <br>- [Расширение маркеров Azure между рабочими областями и клиентами](extend-sentinel-across-workspaces-tenants.md)<br>    - [Работа с инцидентами во многих рабочих областях одновременно](multiple-workspace-view.md)          |
|Необходимо **предоставить доступ к определенному типу события**.     |  Например, предоставьте администратору Windows доступ к событиям безопасности Windows во всех системах. <br><br>В таких случаях для определения разрешений для каждой таблицы используйте [RBAC на уровне таблицы](https://techcommunity.microsoft.com/t5/azure-sentinel/table-level-rbac-in-azure-sentinel/ba-p/965043) .       |
| **Ограничьте доступ более детализированным уровнем, не основанным на ресурсе, или только с подмножеством полей в событии.**   |   Например, может потребоваться ограничить доступ к журналам Office 365 на основе представительства пользователя. <br><br>В этом случае предоставьте доступ к данным с помощью встроенной интеграции с [Power BI панелями мониторинга и отчетами](/azure/azure-monitor/platform/powerbi).      |
| | |

## <a name="explicitly-configure-resource-context-rbac"></a>Явно настроить контекст RBAC для ресурса

Выполните следующие действия, если вы хотите настроить в контексте ресурса RBAC, но ваши данные не являются ресурсами Azure.

Например, данные в рабочей области Sentinel Azure, которые не являются ресурсами Azure, включают в себя syslog, CEF или данные AAD или данные, собранные пользовательским сборщиком.

**Для явной настройки контекстного ресурса RBAC**:

1. Убедитесь, что в Azure Monitor [включен контекст ресурса RBAC](/azure/azure-monitor/platform/manage-access) . 

1. [Создайте группу ресурсов](/azure/azure-resource-manager/management/manage-resource-groups-portal) для каждой группы пользователей, которым требуется доступ к ресурсам без использования всей среды Azure Sentinel.

    Назначьте [разрешения читателя журнала](/azure/azure-monitor/platform/manage-access#resource-permissions) для каждого члена команды.

1. Назначьте ресурсы созданным группам рабочей группы ресурсов и пометьте события с соответствующими идентификаторами ресурсов.

    Когда ресурсы Azure отправляют данные в метку Azure, записи журнала автоматически помечаются ИДЕНТИФИКАТОРом ресурса источника данных.

    > [!TIP]
    > Рекомендуется группировать ресурсы, к которым предоставляется доступ, в определенной группе ресурсов, созданной для назначения.
    >
    > Если вы не можете, убедитесь, что ваша команда имеет разрешения на чтение журнала непосредственно для ресурсов, к которым вы хотите получить доступ.
    >

    Дополнительные сведения об идентификаторах ресурсов см. в следующих статьях:

    - [Идентификаторы ресурсов с пересылкой журналов](#resource-ids-with-log-forwarding)
    - [Идентификаторы ресурсов с коллекцией Logstash](#resource-ids-with-logstash-collection)
    - [Идентификаторы ресурсов с коллекцией API Log Analytics](#resource-ids-with-the-log-analytics-api-collection)

### <a name="resource-ids-with-log-forwarding"></a>Идентификаторы ресурсов с пересылкой журналов

При сборе событий с помощью [стандартного формата событий (CEF)](connect-common-event-format.md) или [системного](connect-syslog.md)журнала пересылка журналов используется для сбора событий из нескольких исходных систем.

Например, когда виртуальная машина перенаправления CEF или syslog прослушивает источники, отправляющие события системного журнала, и пересылает их в Azure Sentinel, идентификатор ресурса виртуальной машины для перенаправления журнала назначается всем пересылаемым событиям.

При наличии нескольких команд убедитесь, что виртуальные машины пересылки журналов обрабатывают события для каждой отдельной команды.

Например, разделение виртуальных машин обеспечивает сбор событий syslog, относящихся к команде а, с помощью виртуальной машины сборщика а.

> [!TIP]
> - При использовании локальной виртуальной машины или другой облачной виртуальной машины, например AWS, в качестве сервера пересылки журналов убедитесь, что у него есть идентификатор ресурса, реализуя [дугу Azure](/azure/azure-arc/servers/overview).
> - Для масштабирования среды виртуальной машины, пересылаемой по журналу, рассмотрите возможность создания [масштабируемого набора виртуальных машин](https://techcommunity.microsoft.com/t5/azure-sentinel/scaling-up-syslog-cef-collection/ba-p/1185854) для получения журналов CEF и силог.


### <a name="resource-ids-with-logstash-collection"></a>Идентификаторы ресурсов с коллекцией Logstash

Если вы собираете данные с помощью [подключаемого модуля выходных](connect-logstash.md)данных Azure Sentinel Logstash, используйте поле **azure_resource_id** , чтобы настроить пользовательский сборщик на включение идентификатора ресурса в выходные данные.

Если вы используете RBAC в контексте ресурсов и хотите, чтобы события, собираемые API, были доступны конкретным пользователям, используйте идентификатор ресурса группы ресурсов, [созданной для пользователей](#explicitly-configure-resource-context-rbac).

Например, в следующем коде показан пример файла конфигурации Logstash:

``` ruby
 input {
     beats {
         port => "5044"
     }
 }
 filter {
 }
 output {
     microsoft-logstash-output-azure-loganalytics {
       workspace_id => "4g5tad2b-a4u4-147v-a4r7-23148a5f2c21" # <your workspace id>
       workspace_key => "u/saRtY0JGHJ4Ce93g5WQ3Lk50ZnZ8ugfd74nk78RPLPP/KgfnjU5478Ndh64sNfdrsMni975HJP6lp==" # <your workspace key>
       custom_log_table_name => "tableName"
       azure_resource_id => "/subscriptions/wvvu95a2-99u4-uanb-hlbg-2vatvgqtyk7b/resourceGroups/contosotest" # <your resource ID>   
     }
 }
```

> [!TIP]
> Может потребоваться добавить несколько `output` разделов для различения тегов, применяемых к различным событиям.
>
### <a name="resource-ids-with-the-log-analytics-api-collection"></a>Идентификаторы ресурсов с коллекцией API Log Analytics

При сборе с помощью [API сборщика данных log Analytics](/azure/azure-monitor/platform/data-collector-api)можно назначить события с идентификатором ресурса, используя заголовок запроса HTTP [*x-MS-азурересаурцеид*](/azure/azure-monitor/platform/data-collector-api#request-headers) .

Если вы используете RBAC в контексте ресурсов и хотите, чтобы события, собираемые API, были доступны конкретным пользователям, используйте идентификатор ресурса группы ресурсов, [созданной для пользователей](#explicitly-configure-resource-context-rbac).


## <a name="next-steps"></a>Следующие шаги

Дополнительные сведения см. [в статье разрешения в Azure Sentinel](roles.md).
