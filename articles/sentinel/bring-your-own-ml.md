---
title: Перевод собственного машинного обучения в Azure Sentinel | Документация Майкрософт
description: В этой статье объясняется, как создавать и использовать собственные алгоритмы машинного обучения для анализа данных в Azure Sentinel.
services: sentinel
cloud: na
documentationcenter: na
author: yelevin
manager: rkarlin
ms.assetid: ''
ms.service: azure-sentinel
ms.subservice: azure-sentinel
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: conceptual
ms.date: 09/23/2020
ms.author: yelevin
ms.openlocfilehash: f8d795dcf64230140e1dd07e3f30ca3aa6825ab4
ms.sourcegitcommit: 867cb1b7a1f3a1f0b427282c648d411d0ca4f81f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "99807009"
---
# <a name="bring-your-own-machine-learning-ml-into-azure-sentinel"></a>Перевод собственного Машинное обучение (машинного обучения) в Azure Sentinel

Машинное обучение (машинное обучение) — одно из основных закрепления Sentinel в Azure, а также один из основных атрибутов, которые устанавливают его отдельно. Azure Sentinel предлагает МАШИНное обучение в нескольких интерфейсах: встроенные в подсистему корреляции [Fusion](fusion.md) и записные книжки Jupyter, а также Новая доступная платформа для создания собственных машин ml (BYO ml). 

Модели обнаружения машинного обучения можно адаптировать к отдельным средам и изменения в поведении пользователей, чтобы сократить количество ложных срабатываний и определить угрозы, которые не были бы обнаружены традиционным подходом. Многие организации безопасности понимают ценность ML для обеспечения безопасности, хотя многие из них не имеют люкс специалистов, имеющих опыт в области безопасности и машинного обучения. Мы разработали платформу, представленную здесь для организаций и специалистов по безопасности, которые будут развиваться с нами в своем пути в МАШИНном обучении. Организации, впервые работающие в МАШИНном обучении или без необходимого опыта, могут получить значительное значение защиты от встроенных возможностей машинного обучения Azure Sentinel.

:::image type="content" source="./media/bring-your-own-ml/machine-learning-framework.png" alt-text="платформа машинного обучения":::

## <a name="what-is-the-bring-your-own-machine-learning-byo-ml-platform"></a>Что такое собственная платформа Машинное обучение (BYO-ML)?

Для организаций, которые имеют ресурсы ML и хотели бы создавать настраиваемые модели машинного обучения для своих уникальных бизнес-задач, мы предлагаем **платформу BYO-ML**. Платформа использует [Azure Databricks](/azure/databricks/scenarios/what-is-azure-databricks) / [Apache Spark](http://spark.apache.org/) среды и записные книжки Jupyter для создания среды ML. Он предоставляет следующие компоненты:

- пакет BYO-ML, который включает библиотеки для доступа к данным и отправки результатов в Log Analytics (LA), что позволяет интегрировать результаты с обнаружением, исследованием и поиском. 

- Шаблоны алгоритмов ML для настройки в соответствии с конкретными проблемами безопасности в Организации. 

- Примеры записных книжек для обучения модели и планирования оценки модели. 

Помимо всего этого, вы можете объединить собственные модели машинного обучения и (или) собственную среду Spark, чтобы интегрировать их с Azure Sentinel.

С помощью платформы BYO-ML вы можете начать создавать собственные модели машинного обучения: 

- Записная книжка с примерами данных позволяет получить практический опыт, не беспокоясь об обработке производственных данных.

- Пакет, интегрированный с средой Spark, уменьшает проблемы и трения в управлении инфраструктурой.

- Библиотеки поддерживают перемещения данных. Обучающие и количественные портативные компьютеры демонстрируют комплексную процедуру и служат шаблоном для адаптации к вашей среде.

### <a name="use-cases"></a>Варианты использования
 
Платформа и пакет BYO-ML значительно сокращают время и усилия, необходимые для создания собственных обнаружений машинного обучения, и позволяют устранить определенные проблемы безопасности в Azure Sentinel. Платформа поддерживает следующие варианты использования:

**Обучить алгоритм машинного обучения для получения настраиваемой модели:** Можно взять существующий алгоритм машинного обучения (предоставленный Майкрософт или сообществом пользователей) и легко обучить его на своих данных, чтобы получить настраиваемую модель машинного обучения, которая лучше подходит для ваших данных и среды.

**Измените шаблон алгоритма машинного обучения, чтобы получить настраиваемую модель:** Вы можете изменить шаблон алгоритма машинного обучения (совместно используемый корпорацией Майкрософт или сообществом пользователей) и обучить модифицированный алгоритм для собственных данных, чтобы создать настраиваемую модель для соответствия конкретной проблеме.

**Создайте собственную модель:** Создавайте собственную модель с нуля, используя платформу и служебные программы для Sentinel-ML в Azure.

**Интегрируйте среду для работы с модулями и средами Spark:** Интегрируйте существующую среду в Azure Sentinel и используйте библиотеки и шаблоны BYO-ML для создания моделей машинного обучения в своих уникальных ситуациях.

**Импортируйте собственную модель машинного обучения:** Вы можете импортировать собственные модели машинного обучения и использовать платформу и служебные программы BYO-ML, чтобы интегрировать их с Azure Sentinel.

**Совместное использование алгоритма машинного обучения:** Совместное использование алгоритма машинного обучения для внедрения и адаптации сообщества.

**Используйте ml, чтобы расширить возможности SecOps:** используйте собственную модель машинного обучения и результаты поиска, обнаружения, исследования и ответа.

В этой статье описываются компоненты платформы BYO-ML, а также использование платформы и алгоритма доступа к неограниченным ресурсам для доставки пользовательского определения машинного обучения с помощью Sentinel Azure.

## <a name="azure-databricksspark-environment"></a>Среда Azure Databricks и Spark

[Apache Spark™](http://spark.apache.org/) выполнили скачок в упрощении больших данных, предоставляя единую платформу для создания конвейеров данных. Azure Databricks выполняет это дальше, предоставляя облачную платформу для управления нулями, созданную на основе Spark. Мы рекомендуем использовать модули обработки данных для платформы BYO-ML, чтобы вы могли сосредоточиться на поиске ответов, которые немедленно повлияют на ваш бизнес, вместо того чтобы решать конвейеры и проблемы с платформой.
Если у вас уже есть кирпичы или другие среды Spark и вы предпочитаете использовать существующую программу установки, пакет BYO-ML будет работать правильно. 

## <a name="byo-ml-package"></a>BYO — пакет ML

Пакет BYO ML содержит рекомендации и исследования корпорации Майкрософт в интерфейсной части ML для обеспечения безопасности. В этом пакете мы предоставляем следующий список служебных программ, записных книжек и шаблонов алгоритмов для проблем безопасности.

| Имя файла | Описание |
| --------- | ----------- |
| azure_sentinel_utilities. WHL | Содержит служебные программы для чтения больших двоичных объектов из Azure и записи в Log Analytics. |
| аномалаусрасампледата | В записной книжке демонстрируется использование модели доступа к аномальным ресурсам в Azure Sentinel с созданными образцами данных для обучения и тестирования. |
| Аномалаусратраининг. ipynb | Записная книжка для обучения алгоритма, сборка и сохранение моделей. |
| Аномалаусраскоринг. ipynb | Записная книжка, чтобы запланировать выполнение модели, визуализировать результат и записать оценку обратно в Azure Sentinel. |
|

Первый шаблон алгоритма машинного обучения, предлагаемый нами, предназначен для [обнаружения аномальных обращений к ресурсам](https://github.com/Azure/Azure-Sentinel/tree/master/BYOML). Она основана на алгоритме совместной фильтрации и обучена в журналах доступа к файловому ресурсу Windows (события безопасности с ИДЕНТИФИКАТОРом события 5140). Ключевой информацией, необходимой для этой модели в журнале, является связывание пользователей и ресурсов, к которым осуществлялся доступ. 

## <a name="example-walkthrough-anomalous-file-share-access-detection"></a>Пример пошагового руководства. аномальное обнаружение доступа к общей папке 

Теперь, когда вы знакомы с ключевыми компонентами платформы BYO-ML, приведен пример, демонстрирующий использование платформы и компонентов для предоставления настраиваемого определения машинного обучения.

### <a name="setup-the-databricksspark-environment"></a>Настройка среды "кирпичи" или "Spark"

Если у вас ее еще нет, необходимо настроить собственную среду для работы с модулями. Инструкции см. в документе с [кратким руководством по модулям](/azure/databricks/scenarios/quickstart-create-databricks-workspace-portal?tabs=azure-portal) .

### <a name="auto-export-instruction"></a>Инструкция по автоматическому экспорту

Для создания пользовательских моделей машинного обучения на основе собственных данных в Sentinel Azure необходимо экспортировать данные из Log Analytics в хранилище BLOB-объектов или ресурс концентратора событий, чтобы модель машинного обучения могла получить к ней доступ из блоков данных. Узнайте, как принимать [данные в Azure Sentinel](connect-data-sources.md).

В этом примере необходимо иметь обучающие данные для журнала доступа к общей папке в хранилище BLOB-объектов Azure. Формат данных задокументирован в записной книжке и библиотеках.

Вы можете автоматически экспортировать данные из Log Analytics с помощью [интерфейса командной строки Azure (CLI)](/cli/azure/monitor/log-analytics). 

Для выполнения команд необходимо назначить роль **участника** в рабочей области log Analytics, вашей учетной записи хранения и в ресурсе EventHub. 

Ниже приведен пример набора команд для установки автоматического экспорта:

```azurecli

az –version

# Login with Azure CLI
 az login

# List all Log Analytics clusters
 az monitor log-analytics cluster list

# Set to specific subscription
 az account set --subscription "SUBSCRIPTION_NAME"
 
# Export to Storage - all tables
 az monitor log-analytics workspace data-export create --resource-group "RG_NAME" --workspace-name "WS_NAME" -n LAExportCLIStr --destination “DESTINATION_NAME" --enable "true" --tables SecurityEvent
 
# Export to EventHub - all tables
 az monitor log-analytics workspace data-export create --resource-group "RG_NAME" --workspace-name "WS_NAME" -n LAExportCLIEH --destination “DESTINATION_NAME" --enable "true" --tables SecurityEvent Heartbeat"]

# List export settings
az monitor log-analytics workspace data-export list --resource-group "RG_NAME" --workspace-name "WS_NAME"

# Delete export setting
 az monitor log-analytics workspace data-export delete --resource-group "RG_NAME" --workspace-name "WS_NAME" --name "NAME"
```

### <a name="export-custom-data"></a>Экспорт пользовательских данных

Для пользовательских данных, которые не поддерживаются Log Analytics автоматического экспорта, можно использовать приложение логики или другие решения для перемещения данных. Вы можете ознакомиться с разделом [экспорт log Analytics данных в](https://www.borninthecloud.com/exporting-log-analytics-data-to-blob-store/?preview=true) блог и сценарий хранилища BLOB-объектов.

### <a name="correlate-with-data-outside-of-azure-sentinel"></a>Сопоставить с данными за пределами Azure Sentinel

Вы также можете перенести данные за пределами Sentinel-метки Azure в хранилище BLOB-объектов или концентратор событий и сопоставить их с данными Sentinel Azure для создания моделей машинного обучения. 
 
### <a name="copy-and-install-the-related-packages"></a>Копирование и установка связанных пакетов

Скопируйте пакет BYO-ML из репозитория Azure Sentinel GitHub, упомянутого выше, в среду модуля данных. Затем откройте записные книжки и следуйте инструкциям в записной книжке, чтобы установить необходимые библиотеки в кластерах.

### <a name="model-training-and-scoring"></a>Обучение и оценка модели

Следуйте инструкциям в двух записных книжках для изменения конфигураций в соответствии с собственными средами и ресурсами, выполните действия по обучению и построению модели, а затем запланируйте модель для оценки входящих журналов доступа к общей папке.

### <a name="write-results-to-log-analytics"></a>Записать результаты в Log Analytics

После получения оценки вы можете использовать модуль в записной книжке для оценки, чтобы записать результаты оценки в Log Analytics рабочую область, связанную с экземпляром Sentinel Azure.

### <a name="check-results-in-azure-sentinel"></a>Проверка результатов в Azure Sentinel

Чтобы просмотреть оцененные результаты вместе со сведениями о связанном журнале, вернитесь на портал Azure Sentinel. В **журналах** > пользовательские журналы отобразятся результаты в таблице **AnomalousResourceAccessResult_CL** (или в собственном имени настраиваемой таблицы). Эти результаты можно использовать для улучшения расследования и поиска.

:::image type="content" source="./media/bring-your-own-ml/anomalous-resource-access-logs.png" alt-text="журналы аномального доступа к ресурсам":::

### <a name="build-custom-analytics-rule-with-ml-results"></a>Создание настраиваемого правила аналитики с помощью результатов ML

После подтверждения того, что результаты машинного обучения находятся в таблице пользовательские журналы, и вы удовлетворены достоверностью оценок, вы можете создать обнаружение на основе результатов. Перейдите к **аналитике** на портале Sentinel Azure и [Создайте новое правило обнаружения](tutorial-detect-threats-custom.md). Ниже приведен пример запроса, используемого для создания обнаружения.

:::image type="content" source="./media/bring-your-own-ml/create-byo-ml-analytics-rule.png" alt-text="создать настраиваемое правило аналитики для обнаружений B Y O M L":::

### <a name="view-and-respond-to-incidents"></a>Просмотр инцидентов и реагирование на них
После настройки правила аналитики на основе результатов машинного обучения, если результаты выше порогового значения, заданного в запросе, создается инцидент и отображается на странице **инциденты** в Azure Sentinel. 

## <a name="next-steps"></a>Дальнейшие действия

В этом документе вы узнали, как использовать платформу BYO-ML в Azure Sentinel для создания или импорта собственных алгоритмов машинного обучения для анализа данных и обнаружения угроз.

- См. записи о машинном обучении и много других важных подразделах в [блоге Azure Sentinel](https://aka.ms/azuresentinelblog).