---
title: Выявление дополнительных угроз с помощью анализа поведения пользователей и сущностей (УЕБА) в Azure Sentinel | Документация Майкрософт
description: Создание базовых показателей поведения для сущностей (пользователи, имена узлов, IP-адреса) и их использование для обнаружения аномального поведения и выявления неактивных постоянных устойчивых угроз (APT).
services: sentinel
documentationcenter: na
author: yelevin
manager: rkarlin
editor: ''
ms.service: azure-sentinel
ms.subservice: azure-sentinel
ms.devlang: na
ms.topic: conceptual
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 02/10/2021
ms.author: yelevin
ms.openlocfilehash: bf7a17d96d31fd4214d5465a5739acc9ce9a9d53
ms.sourcegitcommit: 910a1a38711966cb171050db245fc3b22abc8c5f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/20/2021
ms.locfileid: "102455507"
---
# <a name="identify-advanced-threats-with-user-and-entity-behavior-analytics-ueba-in-azure-sentinel"></a>Выявление дополнительных угроз с помощью анализа поведения пользователей и сущностей (УЕБА) в Azure Sentinel

> [!IMPORTANT]
>
> - Функции УЕБА и Entity Pages теперь доступны в **общедоступной** части **_всех_** географических регионов и регионах Azure Sentinel.

## <a name="what-is-user-and-entity-behavior-analytics-ueba"></a>Что такое аналитика поведения пользователей и сущностей (УЕБА)?

### <a name="the-concept"></a>Концепция

Определение угроз (скомпрометированных сущностей или злонамеренных пользователей внутри организации) в организации и их потенциального влияния всегда было продолжительным и трудоемким процессом. Продираться через оповещения, подключаясь к точкам и активному поиску, вы добавляете до огромного количества времени и усилий, затрачиваемых на минимальное число возвратов, а также возможность сложных угроз просто обходятного обнаружения. В частности, сомнительны угрозы, такие как нулевые, целевые и расширенные постоянные угрозы, могут быть наиболее опасными для вашей организации, что делает их обнаружение более важным.

Функция анализа поведения пользователей и сущностей в Azure Sentinel позволяет избавить аналитиков от нужной монотонной работы и неуверенности в ее результатах, а также предоставляет точные оперативные аналитические данные, чтобы аналитики могли сосредоточиться на расследовании и устранении угроз.

Так как Azure Sentinel собирает журналы и оповещения из всех подключенных источников данных, она анализирует их и создает базовые профили поведения сущностей Организации (например, пользователей, узлов, IP-адресов и приложений) в пределах времени и одноранговой группы. С помощью различных методов и возможностей машинного обучения Azure Sentinel может определить аномальные действия и помочь определить, скомпрометирован ли ресурс. Кроме того, решение также позволяет определять относительную чувствительность конкретных активов, выявлять одноранговые группы активов и оценивать потенциальное влияние скомпрометированного актива («радиус поражения»). Используя эти сведения, можно эффективно определять приоритеты при расследовании и обработке инцидентов. 

### <a name="architecture-overview"></a>Обзор архитектуры

:::image type="content" source="media/identify-threats-with-entity-behavior-analytics/entity-behavior-analytics-architecture.png" alt-text="Архитектура аналитики поведения сущностей":::

### <a name="security-driven-analytics"></a>Аналитика на основе безопасности

Azure Sentinel, вдохновившись парадигмой решений для анализа поведения пользователей и сущностей, предложенной Gartner, разработала подход «снаружи внутрь», основанный на трех опорных кадрах.

- **Варианты использования:** Путем определения приоритетов для соответствующих направлений атак и сценариев, основанных на исследованиях в области безопасности, согласованных с MITRE АТРИ&CK, методиками и вспомогательными методами, которые размещают различные сущности как жертвы, перпетраторс или точки вращения в цепочке уничтожения; Метка Azure специализируется на наиболее ценных журналах, которые может предоставить каждый источник данных.

- **Источники данных.** Хотя в первую очередь поддерживаются источники данных Azure, Azure Sentinel тщательно выбирает сторонние источники данных, чтобы предоставлять данные, соответствующие нашим сценариям угроз.

- **Аналитика.** Используя различные алгоритмы машинного обучения (МО), Sentinel Azure определяет аномальную активность и предоставляет четкие доказательства в виде контекстных дополнений, примеры которых приведены ниже.

    :::image type="content" source="media/identify-threats-with-entity-behavior-analytics/behavior-analytics-top-down.png" alt-text="Анализ поведения за пределами":::

Azure Sentinel представляет артефакты, которые помогают аналитикам безопасности оценить аномальную активность в контексте и в сравнении с базовым профилем пользователя. Действия, выполняемые пользователем (или узлом, или адресом), оцениваются в контексте, где результат true указывает на выявленную аномалию:
- в различных географических местоположениях, устройствах и средах;
- за период времени и с определенным интервалом (в сравнении с собственным журналом пользователя);
- по сравнению с поведением одноранговых узлов;
- по сравнению с поведением организации.

    :::image type="content" source="media/identify-threats-with-entity-behavior-analytics/context.png" alt-text="Контекст сущности":::


### <a name="scoring"></a>оценка.

Каждое действие оценивается как "Оценка приоритета расследования", которая определяет вероятность конкретного пользователя, выполняющего определенное действие, на основе изучения поведения пользователя и его коллег. Действия, определяемые как самые аномальные, получают наивысший рейтинг (на шкале 0–10).

См. статью использование аналитики поведения в [Microsoft Cloud App Security](https://techcommunity.microsoft.com/t5/microsoft-security-and/prioritize-user-investigations-in-cloud-app-security/ba-p/700136) в качестве примера работы.

## <a name="entity-pages"></a>Страницы сущностей

Дополнительные сведения о [сущностях в Azure Sentinel](entities-in-azure-sentinel.md) см. в полном списке [поддерживаемых сущностей и идентификаторов](entities-reference.md).

При обнаружении сущности (в настоящее время ограничены пользователями и узлами) в ходе поиска, предупреждении или расследовании вы можете выбрать сущность и перенести ее на **страницу сущностей**, где представлена полная таблица с полезной информацией об этой сущности. На этой странице можно найти следующие сведения: основные сведения сущности, временная шкала значимых событий, связанных с этой сущностью, и полезные сведения о поведении сущности.
 
Страницы сущностей состоят из трех частей.
- На панели слева приведены идентификационные данные сущности, собранные из источников данных, таких как Azure Active Directory, Azure Monitor, центр безопасности Azure и Microsoft Defender.

- На центральной панели отображается графическая текстовая шкала для значимых событий, связанных с сущностью, таких как оповещения, закладки и действия. Действия — это агрегаты важных событий из Log Analytics. Запросы, которые обнаруживают эти действия, разрабатываются аналитиками безопасности Майкрософт.

- На правой панели представлены полезные сведения о поведении сущности. Эти полезные сведения помогают быстро выявить аномалии и угрозы безопасности. Полезные сведения разрабатываются аналитиками безопасности Майкрософт на основе моделей обнаружения аномалий.

### <a name="the-timeline"></a>Временная шкала

:::image type="content" source="./media/identify-threats-with-entity-behavior-analytics/entity-pages-timeline.png" alt-text="Временная шкала страниц сущностей":::

Временная шкала является основным вкладом страницы сущности в аналитику поведения в Azure Sentinel. Это история событий, связанных с сущностями, которая помогает понять действия сущности в течение определенного промежутка времени.

Можно выбрать **диапазон времени** из нескольких предварительно заданных параметров (например, за *последние 24 часа*) или задать для него любой пользовательский интервал. Кроме того, можно задать фильтры, которые ограничивают данные на временной шкале конкретными типами событий или оповещений.

На временной шкале представлены следующие типы элементов.

- Оповещения — все оповещения, в которых сущность определена как **сопоставленная сущность**. Обратите внимание, что если ваша организация создала [пользовательские оповещения с помощью правил аналитики](./tutorial-detect-threats-custom.md), то следует убедиться, что сопоставление сущностей правил выполнено правильно.

- Закладки — все закладки, которые содержат конкретную сущность, показанную на странице.

- Действия — это агрегирование важных событий, связанных с сущностью. 
 
### <a name="entity-insights"></a>Полезные сведения о сущностях
 
Полезные сведения о сущностях — это запросы, определяемые аналитиками безопасности Майкрософт, которые помогают им проводить расследования более эффективно. Аналитика представляется как часть страницы сущности и предоставляет ценные сведения о безопасности узлов и пользователей в виде табличных данных и диаграмм. Если здесь есть информация, то вам не нужно переходить в Log Analytics. Аналитические сведения включают в себя данные о входах, добавлении групп, аномальных событиях и многом другим, а также включают сложные алгоритмы ML для обнаружения аномального поведения. 

Аналитика основана на следующих источниках данных:
- системный журнал (Linux);
- SecurityEvent (Windows)
- AuditLogs (Azure AD)
- Сигнинлогс (Azure AD)
- Оффицеактивити (Office 365)
- Бехавиораналитикс (Azure Sentinel УЕБА)
- Пульс (агент Azure Monitor)
- CommonSecurityLog (Sentinel Azure)

### <a name="how-to-use-entity-pages"></a>Работа со страницами сущностей

Страницы сущностей предназначены для использования в рамках нескольких сценариев, и доступ к ним осуществляется из системы управления инцидентами, графов расследования, закладок или непосредственно со страницы поиска сущностей в разделе **Анализ поведения сущностей** в главном меню Azure Sentinel.

:::image type="content" source="./media/identify-threats-with-entity-behavior-analytics/entity-pages-use-cases.png" alt-text="Варианты использования страниц сущностей":::

## <a name="data-schema"></a>Схема данных

### <a name="behavior-analytics-table"></a>Таблица аналитики поведения

| Поле                     | Описание                                                         |
|---------------------------|---------------------------------------------------------------------|
| TenantId                  | уникальный идентификатор клиента                                      |
| саурцерекордид            | уникальный идентификатор события ЕБА                                   |
| TimeGenerated             | Метка времени для вхождения действия                              |
| тимепроцессед             | Метка времени обработки действия ядром ЕБА            |
| ActivityType              | Категория высокого уровня действия                                 |
| Тип действия                | нормализованное имя действия                                     |
| Имя пользователя                  | имя пользователя, инициировавшего действие                    |
| UserPrincipalName         | полное имя пользователя, инициировавшего действие               |
| EventSource               | Источник данных, который предоставил исходное событие                        |
| саурцеипаддресс           | IP-адрес, с которого было инициировано действие                        |
| саурцеиплокатион          | страна, из которой было инициировано действие, дополненное с IP-адреса |
| саурцедевице              | имя узла устройства, инициировавшего действие                  |
| дестинатионипаддресс      | IP-адрес целевого объекта действия                            |
| дестинатиониплокатион     | страна целевого объекта действия, дополненного IP-адресом     |
| дестинатиондевице         | имя целевого устройства                                           |
| **усерсинсигхтс**         | Контекстные обогащения вовлеченных пользователей                            |
| **девицесинсигхтс**       | контекстуальное дополнение вовлеченных устройств                          |
| **активитинсигхтс**      | контекстный анализ действий на основе нашего профилирования              |
| **инвестигатионприорити** | Оценка аномалий, от 0-10 (0 = мягкое, 10 = сильно аномальное)         |
|

Полный набор контекстных дополнений, указанных в **усерсинсигхтс**, **девицесинсигхтс** и **активитинсигхтс** , см. в [справочном документе уеба](ueba-enrichments.md).

### <a name="querying-behavior-analytics-data"></a>Запрос данных аналитики поведения

С помощью [ККЛ](/azure/data-explorer/kusto/query/)можно запрашивать таблицу аналитики поведения.

Например, если нам нужно найти все варианты пользователя, который не смог войти в ресурс Azure, где он впервые попытался подключиться из определенной страны, а подключения из этой страны нередко применяются к одноранговым узлам пользователя, можно использовать следующий запрос:

```Kusto
BehaviorAnalytics
| where ActivityType == "FailedLogOn"
| where FirstTimeUserConnectedFromCountry == True
| where CountryUncommonlyConnectedFromAmongPeers == True
```

### <a name="user-peers-metadata---table-and-notebook"></a>Метаданные пиринга пользователя — таблица и Записная книжка

Метаданные одноранговых узлов предоставляют важный контекст при обнаружении угроз, в исследовании инцидента и поиске потенциальных угроз. Аналитики безопасности могут наблюдать за нормальными действиями одноранговых пользователей, чтобы определить, являются ли действия пользователя нетипичными по сравнению с его коллегами.

Azure Sentinel вычисляет и ранжирует одноранговые узлы пользователей на основе членства пользователя в группе безопасности Azure AD, списка рассылки, обновляло и сохраняет ранги, Ранжированные по 1-20, в таблице **усерпираналитикс** . На следующем снимке экрана показана схема таблицы Усерпираналитикс и отображаются первые 8-Ранжированные одноранговые узлы пользователя Кендалл Коллинз. Для нормализации коэффициентами взвешивания для вычисления ранга Azure Sentinel используется алгоритм *Term-инверсия документов* (TF-IDF). чем меньше группа, тем выше плотность. 

:::image type="content" source="./media/identify-threats-with-entity-behavior-analytics/user-peers-metadata.png" alt-text="Снимок экрана таблицы метаданных для одноранговых узлов пользователей":::

Вы можете использовать [записную книжку Jupyter](https://github.com/Azure/Azure-Sentinel-Notebooks/tree/master/BehaviorAnalytics/UserSecurityMetadata) , предоставленную в репозитории Azure Sentinel GitHub, для визуализации метаданных одноранговых узлов пользователей. Подробные инструкции по использованию записной книжки см. в разделе " [Интерактивный анализ и](https://github.com/Azure/Azure-Sentinel-Notebooks/blob/master/BehaviorAnalytics/UserSecurityMetadata/Guided%20Analysis%20-%20User%20Security%20Metadata.ipynb) Записная книжка метаданных безопасности пользователя".

### <a name="permission-analytics---table-and-notebook"></a>Аналитика разрешений — таблица и Записная книжка

Аналитика разрешений помогает определить потенциальное влияние взлома ресурса организации злоумышленником. Это воздействие также называется «радиусом» для ресурса «всплеск». Аналитики безопасности могут использовать эти сведения для определения приоритетов обработки происшествий и инцидентов.

Метка Azure определяет прямые и транзитивные права доступа, удерживаемые определенным пользователем, в ресурсы Azure, оценивая подписки Azure, к которым пользователь имеет доступ напрямую или через группы или субъекты-службы. Эти сведения, а также полный список членства пользователя в группе безопасности Azure AD хранятся в таблице **усеракцессаналитикс** . На снимке экрана ниже показан пример строки в таблице Усеракцессаналитикс для пользователя Алекс Джонсон. **Исходная сущность** — это учетная запись пользователя или субъекта-службы, а **Целевая сущность** — это ресурс, к которому имеет доступ исходная сущность. Значения **уровня доступа** и **типа доступа** зависят от модели управления доступом целевой сущности. Вы видите, что Алекс имеет доступ для участников в подписке Azure для *клиента гостиниц Contoso*. Модель управления доступом подписки — это Azure RBAC.   

:::image type="content" source="./media/identify-threats-with-entity-behavior-analytics/user-access-analytics.png" alt-text="Снимок экрана таблицы аналитики доступа пользователей":::

Для визуализации данных аналитики разрешений можно использовать [записную книжку Jupyter](https://github.com/Azure/Azure-Sentinel-Notebooks/tree/master/BehaviorAnalytics/UserSecurityMetadata) (ту же самую записную книжку, которую упоминали ранее) из репозитория Azure Sentinel в репозитории GitHub. Подробные инструкции по использованию записной книжки см. в разделе " [Интерактивный анализ и](https://github.com/Azure/Azure-Sentinel-Notebooks/blob/master/BehaviorAnalytics/UserSecurityMetadata/Guided%20Analysis%20-%20User%20Security%20Metadata.ipynb) Записная книжка метаданных безопасности пользователя".

### <a name="hunting-queries-and-exploration-queries"></a>Поиск запросов и исследование запросов

Azure Sentinel предоставляет готовый набор запросов на поиск, исследование запросов и книгу на основе таблицы Бехавиораналитикс. Эти средства представляют обогащенные данные, нацеленные на конкретные варианты использования, которые указывают на аномальное поведение. 

Узнайте больше о [поиске и диаграмме расследования](./hunting.md) в Azure Sentinel.

## <a name="next-steps"></a>Дальнейшие действия
В этом документе вы узнали о возможностях аналитики поведения сущностей Azure Sentinel. Практические рекомендации по реализации и использованию ценных сведений, которые вы получили, см. в следующих статьях:

- [Включите аналитику поведения сущностей](./enable-entity-behavior-analytics.md) в Azure Sentinel.
- [Поиск угроз безопасности](./hunting.md).
