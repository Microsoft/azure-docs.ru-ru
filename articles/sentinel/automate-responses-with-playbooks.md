---
title: Автоматизация реагирования на угрозы с помощью модули Playbook в Azure Sentinel | Документация Майкрософт
description: В этой статье описывается Автоматизация в Azure Sentinel и демонстрируется использование модули PlayBook для автоматизации предотвращения угроз и реагирования на них.
services: sentinel
cloud: na
documentationcenter: na
author: yelevin
manager: rkarlin
ms.assetid: ''
ms.service: azure-sentinel
ms.subservice: azure-sentinel
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: conceptual
ms.date: 03/17/2021
ms.author: yelevin
ms.openlocfilehash: 0158c9f5b9debf0c47978e816951e25634621645
ms.sourcegitcommit: 772eb9c6684dd4864e0ba507945a83e48b8c16f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "104609805"
---
# <a name="automate-threat-response-with-playbooks-in-azure-sentinel"></a>Автоматизация реагирования на угрозы с помощью модули Playbook в Azure Sentinel

В этой статье объясняется, что такое модули PlayBook Azure Sentinel, и как их использовать для реализации операций оркестрации безопасности, автоматизации и реагирования (ВЗЛЕТЕЛ), достижения лучших результатов при сохранении времени и ресурсов.

## <a name="what-is-a-playbook"></a>Что такое сборник тренировочных заданий?

Группы SIEM/SOC обычно засыпаны с оповещениями системы безопасности и инцидентами на регулярной основе, так как тома настолько велики, что доступный персонал является огромным. Это приводит к слишком частому результату в ситуациях, когда много предупреждений пропускается и многие инциденты не изучаются, в результате чего Организация становится уязвимой для атак, которые не были замечены.

Многие (если не большинство) эти предупреждения и инциденты соответствуют повторяющимся шаблонам, которые могут быть решены определенными и определенными наборами действий по исправлению.

Сборник тренировочных заданий — это набор этих действий по исправлению, которые можно запустить из Sentinel в качестве подпрограммы. Сборник тренировочных заданий может помочь в автоматизации и координации реагирования на угрозы; его можно запустить вручную или настроить для автоматического запуска в ответ на определенные предупреждения или инциденты, которые вызываются правилом аналитики или правилом автоматизации соответственно.

Модули PlayBook создаются и применяются на уровне подписки, но вкладка **модули PlayBook** (в колонке Новая **Автоматизация** ) отображает все модули PlayBook, доступные в выбранных подписках.

### <a name="azure-logic-apps-basic-concepts"></a>Azure Logic Apps основные понятия

Модули Playbook в Azure Sentinel основаны на рабочих процессах, встроенных в [Azure Logic Apps](../logic-apps/logic-apps-overview.md), облачной службе, которая помогает планировать, автоматизировать и управлять задачами и рабочими процессами во всей системе предприятия. Это означает, что модули PlayBook может воспользоваться всеми возможностями и возможностью настройки встроенных шаблонов Logic Apps.

> [!NOTE]
> Поскольку Azure Logic Apps являются отдельным ресурсом, может взиматься дополнительная плата. Дополнительные сведения см. на странице цен на [Azure Logic Apps](https://azure.microsoft.com/pricing/details/logic-apps/) .

Azure Logic Apps взаимодействует с другими системами и службами с помощью соединителей. Ниже приведено краткое описание соединителей и некоторые их важные атрибуты.

- **Управляемый соединитель:** Набор действий и триггеров, которые обходит вызовы API к определенному продукту или службе. Azure Logic Apps предлагает сотни соединителей для взаимодействия со службами Майкрософт и сторонних разработчиков.
  - [Список всех соединителей Logic Apps и их документации](/connectors/connector-reference/)

- **Настраиваемый соединитель:** Вам может потребоваться связаться со службами, которые недоступны в качестве готовых соединителей. Настраиваемые соединители решают эту потребность, позволяя создать (и даже поделиться) соединитель и определить собственные триггеры и действия.
  - [Создание собственных настраиваемых соединителей Logic Apps](/connectors/custom-connectors/create-logic-apps-connector)

- **Соединитель Sentinel Azure:** Чтобы создать модули PlayBook, взаимодействующие с Azure Sentinel, используйте соединитель Sentinel Azure.
  - [Документация по соединителю Sentinel Azure](/connectors/azuresentinel/)

- **Триггер:** Компонент соединителя, который запускает сборник тренировочных заданий. Он определяет схему, которую сборник тренировочных заданий будет принимать при срабатывании. В настоящее время соединитель Sentinel Azure имеет два триггера:
  - [Триггер оповещения](/connectors/azuresentinel/#triggers): сборник тренировочных заданий получает оповещение в качестве входных данных.
  - [Триггер инцидента](/connectors/azuresentinel/#triggers). сборник тренировочных заданий получает в качестве входных данных инцидент, а также все входящие в него предупреждения и сущности.

    > [!IMPORTANT]
    >
    > - Функция **триггера инцидента** для модули PlayBook сейчас доступна в **предварительной версии**. Ознакомьтесь с дополнительными [условиями использования Microsoft Azure](https://azure.microsoft.com/support/legal/preview-supplemental-terms/) предварительных версий для дополнительных юридических условий, которые относятся к функциям Azure, которые доступны в бета-версии, предварительном просмотре или еще не выпущены в общедоступную версию.

- **Действия:** Действия — это все шаги, которые происходят после триггера. Они могут быть упорядочены последовательно, параллельно или в матрице сложных условий.

- **Динамические поля:** Временные поля, определяемые выходной схемой триггеров и действий, которые заполняются фактическим выходом, который можно использовать в следующих действиях.

### <a name="permissions-required"></a>Необходимые разрешения

 Чтобы дать команде SecOps возможность использовать Logic Apps для оркестрации, автоматизации и реагирования (ВЗЛЕТЕЛ), то есть для создания и запуска модули Playbook-в Azure Sentinel можно назначить роли Azure для конкретных членов группы операций безопасности или для всей команды. Ниже описаны различные доступные роли и задачи, для которых они должны быть назначены.

#### <a name="azure-roles-for-logic-apps"></a>Роли Azure для Logic Apps

- **Участник приложения логики** позволяет управлять приложениями логики и запускать модули PlayBook, но вы не можете изменить доступ к ним (для того, чтобы роль **владельца** не была обязательной).
- **Оператор приложения логики**  позволяет читать, включать и отключать приложения логики, но не может изменять или обновлять их.

#### <a name="azure-roles-for-sentinel"></a>Роли Azure для Sentinel

- Роль " **участник Sentinel Azure** " позволяет присоединить сборник тренировочных заданий к правилу аналитики.
- Роль **респондента Azure Sentinel** позволяет запустить сборник тренировочных заданий вручную.
- **Участник автоматизации Sentinel Azure** позволяет использовать правила автоматизации для запуска модули PlayBook. Она не должена использоваться для других целей.

#### <a name="learn-more"></a>Материалы для дальнейшего изучения

- Дополнительные [сведения о ролях Azure см. в Azure Logic Apps](../logic-apps/logic-apps-securing-a-logic-app.md#access-to-logic-app-operations).
- Дополнительные [сведения о ролях Azure в Azure Sentinel](roles.md).

## <a name="steps-for-creating-a-playbook"></a>Шаги для создания сборник тренировочных заданий

- [Определите сценарий автоматизации](#use-cases-for-playbooks).

- [Создайте приложение логики Azure](tutorial-respond-threats-playbook.md).

- [Протестируйте приложение логики](#run-a-playbook-manually-on-an-alert).

- Присоедините сборник тренировочных заданий к [правилу службы автоматизации](#incident-creation-automated-response) или к [правилу аналитики](#alert-creation-automated-response)или [выполните его вручную при необходимости](#run-a-playbook-manually-on-an-alert).

### <a name="use-cases-for-playbooks"></a>Варианты использования для модули PlayBook

Платформа Azure Logic Apps предлагает сотни действий и триггеров, поэтому можно создать практически любой сценарий автоматизации. Azure Sentinel рекомендует начать со следующих сценариев SOC:

#### <a name="enrichment"></a>Обогащение данных

**Собирайте данные и присоедините их к инциденту, чтобы принимать разумные решения.**

Пример:

Инцидент Azure Sentinel создан на основе предупреждения правилом аналитики, создающим сущности IP-адресов.

Инцидент запускает правило автоматизации, которое запускает сборник тренировочных заданий, выполняя следующие действия.

- Запуск при [создании нового инцидента Sentinel Azure](/connectors/azuresentinel/#triggers). Сущности, представленные в инциденте, хранятся в динамических полях триггера инцидента.

- Для каждого IP-адреса запросите для получения дополнительных данных запрос к внешнему поставщику аналитики угроз, например по [общему числу вирусов](https://www.virustotal.com/).

- Добавьте возвращенные данные и аналитические сведения в качестве комментариев инцидента.

#### <a name="bi-directional-sync"></a>Двунаправленная синхронизация

**Модули PlayBook можно использовать для синхронизации инцидентов Azure Sentinel с другими системами билетов.**

Пример:

Создайте правило автоматизации для всех операций создания инцидентов и вложите сборник тренировочных заданий, открывающий билет в ServiceNow:

- Запуск при [создании нового инцидента Sentinel Azure](/connectors/azuresentinel/#triggers).

- Создайте новый билет в [ServiceNow](/connectors/service-now/).

- Добавьте в билет имя инцидента, важные поля и URL-адрес инцидента Azure Sentinel, чтобы упростить сведение.

#### <a name="orchestration"></a>Оркестрация

**Используйте платформу SOC Chat для лучшего управления очередью инцидентов.**

Пример:

Инцидент Azure Sentinel создан на основе предупреждения правилом аналитики, формирующим сущности имени пользователя и IP-адреса.

Инцидент запускает правило автоматизации, которое запускает сборник тренировочных заданий, выполняя следующие действия.

- Запуск при [создании нового инцидента Sentinel Azure](/connectors/azuresentinel/#triggers).

- Отправьте сообщение в свой канал операций безопасности в [Microsoft Teams](/connectors/teams/) или [резервном](/connectors/slack/) времени, чтобы убедиться, что ваши аналитики безопасности знают об инциденте.

- Отправьте всю информацию в оповещении по электронной почте руководителю сети и администратору безопасности. Сообщение электронной почты будет включать кнопки " **блокировать** " и " **игнорировать** " для пользователя.

- Дождитесь получения ответа от администраторов, а затем продолжайте выполнение.

- Если администраторы имеют выбранный **блок**, отправьте команду в брандмауэр, чтобы заблокировать IP-адрес в предупреждении, а другой — в Azure AD, чтобы отключить этого пользователя.

#### <a name="response"></a>Ответ

**Немедленно отвечайте на угрозы с минимальными зависимостями людей.**

Два примера:

**Пример 1.** Ответ на правило аналитики, указывающее на скомпрометированного пользователя, обнаруженный [Защита идентификации Azure AD](../active-directory/identity-protection/overview-identity-protection.md):

   - Запуск при [создании нового инцидента Sentinel Azure](/connectors/azuresentinel/#triggers).

   - Для каждой сущности пользователя в инциденте, как было скомпрометировано:

     - Отправить пользователю сообщение команды, запрашивая подтверждение о том, что пользователь принял подозрительное действие.

     - Проверьте с помощью защита идентификации Azure AD, чтобы [подтвердить состояние пользователя как Скомпрометированное](/connectors/azureadip/#confirm-a-risky-user-as-compromised). Защита идентификации Azure AD помечает пользователя как **рискованный** и примените уже настроенную политику применения. Например, чтобы требовать от пользователя использовать MFA при следующем входе в систему.

        > [!NOTE]
        > Сборник тренировочных заданий не запускает никаких действий по принудительной реализации для пользователя и не инициирует настройку политики принудительного применения. Он только сообщает защита идентификации Azure AD применить все уже определенные политики соответствующим образом. Любое принудительное применение полностью зависит от соответствующих политик, определенных в защита идентификации Azure AD.

**Пример 2:** Ответьте на правило аналитики, которое указывает на скомпрометированный компьютер, обнаруженный [защитником Майкрософт для конечной точки](/windows/security/threat-protection/):

   - Запуск при [создании нового инцидента Sentinel Azure](/connectors/azuresentinel/#triggers).

   - Используйте действие " **сущности — получение узлов** " в Azure Sentinel для анализа подозрительных компьютеров, которые включены в сущности инцидента.

   - Выполните команду в защитнике Майкрософт для конечной точки, чтобы [изолировать компьютеры](/connectors/wdatp/#actions---isolate-machine) в предупреждении.

## <a name="how-to-run-a-playbook"></a>Как запустить сборник тренировочных заданий

Модули PlayBook можно запустить либо **вручную** , либо **автоматически**.

Запуск их вручную означает, что когда вы получаете оповещение, вы можете выбрать запуск сборника схем по запросу в качестве ответа на выбранное предупреждение. В настоящее время эта функция поддерживается только для оповещений, а не для инцидентов.

Их запуск автоматически означает задание в качестве автоматического ответа в правиле аналитики (для оповещений) или в качестве действия в правиле автоматизации (для инцидентов). Дополнительные [сведения о правилах автоматизации](automate-incident-handling-with-automation-rules.md).

### <a name="set-an-automated-response"></a>Установка автоматического ответа

Группы операций безопасности могут значительно сократить рабочую нагрузку, полностью автоматизируя подпрограммы для повторяющихся типов инцидентов и предупреждений, что позволяет сосредоточиться на уникальных инцидентах и предупреждениях, анализе шаблонов, поиске угроз и т. д.

Установка автоматического отклика означает, что при каждом запуске правила аналитики в дополнение к созданию предупреждения правило запустит сборник тренировочных заданий, которое будет получать предупреждение, созданное правилом.

Если оповещение создает инцидент, то инцидент запускает правило автоматизации, которое, в свою очередь, запускает сборник тренировочных заданий, которое получает в качестве входных данных инцидент, созданный предупреждением.

#### <a name="alert-creation-automated-response"></a>Автоматическое реагирование на создание предупреждений

Для модули PlayBook, активируемых при создании предупреждения, и получения оповещений в качестве их входных данных (первый шаг — это "при активации оповещения Azure Sentinel") Присоедините сборник тренировочных заданий к правилу аналитики:

1. Измените [правило аналитики](tutorial-detect-threats-custom.md) , создающее предупреждение, для которого необходимо определить автоматический ответ.

1. В разделе **Автоматизация оповещений** на вкладке **автоматизированный ответ** выберите сборник тренировочных заданий или модули PlayBook, которые будут запускаться этим правилом аналитики при создании оповещения.

#### <a name="incident-creation-automated-response"></a>Автоматическое реагирование на создание инцидентов

Для модули PlayBook, активируемых при создании инцидента и получении инцидентов в качестве их входных данных (первый шаг — это "при активации инцидента Azure Sentinel"), создайте правило автоматизации и определите в нем действие **Run сборник тренировочных заданий** . Это можно сделать двумя способами:

- Измените правило аналитики, создающее инцидент, для которого необходимо определить автоматический ответ. В разделе **Автоматизация инцидентов** на вкладке **автоматизированный ответ** создайте правило автоматизации. Будет создан автоматизированный ответ только для этого правила аналитики.

- На вкладке **правила автоматизации** в колонке **Автоматизация** создайте новое правило автоматизации и укажите соответствующие условия и требуемые действия. Это правило автоматизации будет применяться к любому правилу аналитики, удовлетворяющему заданным условиям.

    > [!NOTE]
    > Чтобы запустить сборник тренировочных заданий из правила автоматизации, в Azure Sentinel используется учетная запись службы, специально предназначенная для этого. Использование этой учетной записи (в отличие от учетной записи пользователя) увеличивает уровень безопасности службы и включает API правил автоматизации для поддержки вариантов использования CI/CD.
    >
    > Этой учетной записи необходимо предоставить явные разрешения для группы ресурсов, в которой находится сборник тренировочных заданий. На этом этапе любое правило автоматизации сможет выполнять любые сборник тренировочных заданий в этой группе ресурсов.
    >
    > При добавлении действия **выполнить сборник тренировочных заданий** в правило автоматизации появится раскрывающийся список модули PlayBook. Модули PlayBook, к которому метка Azure не имеет разрешений, будет отображаться как недоступная (выделена серым цветом). Вы можете предоставить разрешение на метку Azure на месте, выбрав ссылку **Управление разрешениями сборник тренировочных заданий** .
    >
    > В сценарии с несколькими клиентами ([лигхсаусе](extend-sentinel-across-workspaces-tenants.md#managing-workspaces-across-tenants-using-azure-lighthouse)) необходимо определить разрешения на клиенте, где находится сборник тренировочных заданий, даже если правило автоматизации, вызывающее сборник тренировочных заданий, находится в другом клиенте. Для этого необходимо иметь разрешения **владельца** для группы ресурсов сборник тренировочных заданий.

Ознакомьтесь с [полными инструкциями по созданию правил автоматизации](tutorial-respond-threats-playbook.md#respond-to-incidents).

### <a name="run-a-playbook-manually-on-an-alert"></a>Запуск сборник тренировочных заданий на оповещении вручную

Активация вручную доступна на портале Sentinel Azure в следующих колонках:

- В представлении **инциденты** выберите конкретный инцидент, откройте его вкладку **оповещения** и выберите оповещение.

- В **расследовании** выберите конкретное оповещение.

1. Щелкните **View модули PlayBook (просмотреть** ) для выбранного оповещения. Вы получите список всех модули PlayBook, начинающихся с a **при активации оповещения Azure Sentinel** и доступ к которому у вас есть.

1. Щелкните **выполнить** в строке определенного сборник тренировочных заданий, чтобы активировать его.

1. Перейдите на вкладку **запуски** , чтобы просмотреть список всех случаев, когда для этого предупреждения выполнялось любое сборник тренировочных заданий. Для отображения только что выполненного выполнения в этом списке может потребоваться несколько секунд.

1. Если щелкнуть конкретный запуск, будет открыт журнал полного запуска в Logic Apps.

### <a name="run-a-playbook-manually-on-an-incident"></a>Запуск сборник тренировочных заданий на инциденте вручную

Еще не поддерживается. <!--make this a note instead? -->

## <a name="manage-your-playbooks"></a>Управление модули PlayBook

На вкладке **модули PlayBook** отображается список всех модули PlayBook, к которым у вас есть доступ, отфильтрованные по подпискам, которые в настоящее время отображаются в Azure. Фильтр подписок доступен в меню **каталог и подписка** в заголовке глобальной страницы.

Щелкнув имя сборник тренировочных заданий, вы направитесь на главную страницу сборник тренировочных заданий в Logic Apps. В столбце **состояние** отображается значение включено или отключено.

**Тип триггера** представляет Logic Apps триггер, который запускает этот сборник тренировочных заданий.

| Тип триггера | Указывает типы компонентов в сборник тренировочных заданий |
|-|-|
| **Инцидент или оповещение Azure Sentinel** | Сборник тренировочных заданий запускается с одним из триггеров Sentinel (Alert, инцидент). |
| **Использование действия Sentinel для Azure** | Сборник тренировочных заданий запускается с триггером, не являющимся Sentinel, но использует действие Sentinel Azure. |
| **Другое** | Сборник тренировочных заданий не включает компоненты Sentinel |
| **Не инициализировано** | Сборник тренировочных заданий был создан, но не содержит компонентов (триггеров или действий). |
|

На странице приложения логики сборник тренировочных заданий можно просмотреть дополнительные сведения о сборник тренировочных заданий, включая журнал всех выполнений, а также результат (успех или неудача, а также другие сведения). Если у вас есть соответствующие разрешения, можно также ввести конструктор Logic Apps и изменить сборник тренировочных заданий.

### <a name="api-connections"></a>Подключения API

Подключения API используются для подключения Logic Apps к другим службам. Каждый раз, когда выполняется новая проверка подлинности для соединителя Logic Apps, создается новый ресурс типа **Connection (подключение API** ) и содержатся сведения, предоставляемые при настройке доступа к службе.

Чтобы просмотреть все подключения API, введите *подключения API* в поле поиска заголовков портал Azure. Обратите внимание на интересующие столбцы:

- Отображаемое имя — понятное имя, назначаемое для подключения при каждом его создании.
- Состояние — указывает состояние подключения: ошибка, подключено.
- Группа ресурсов — подключения API создаются в группе ресурсов ресурса сборник тренировочных заданий (Logic Apps).

Другой способ просмотра подключений API — перейти в колонку **все ресурсы** и отфильтровать их по типу *подключение API*. Таким образом можно выбрать, пометить и удалить несколько подключений одновременно.

Чтобы изменить авторизацию существующего подключения, введите ресурс подключения и выберите **изменить подключение API**.

## <a name="next-steps"></a>Дальнейшие действия

- [Руководство. Использование модули PlayBook для автоматизации реагирования угроз в Azure Sentinel](tutorial-respond-threats-playbook.md)
