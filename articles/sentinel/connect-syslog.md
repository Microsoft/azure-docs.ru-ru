---
title: Подключение данных syslog к Azure Sentinel | Документация Майкрософт
description: Подключите любой компьютер или устройство, поддерживающее syslog, в метку Azure, используя агент на компьютере Linux между устройством и Sentinel.
services: sentinel
documentationcenter: na
author: yelevin
manager: rkarlin
editor: ''
ms.service: azure-sentinel
ms.subservice: azure-sentinel
ms.devlang: na
ms.topic: conceptual
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 07/17/2020
ms.author: yelevin
ms.openlocfilehash: 8c3cf4c3c135b3f275542af4f531d1071e180ebe
ms.sourcegitcommit: 3c8964a946e3b2343eaf8aba54dee41b89acc123
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/25/2021
ms.locfileid: "98747196"
---
# <a name="collect-data-from-linux-based-sources-using-syslog"></a>Получение данных из источников на основе Linux с помощью системного журнала

С помощью агента Log Analytics для Linux (ранее известного как агент OMS) вы можете выполнять потоковую передачу событий из машин или устройств, поддерживающих syslog, на основе Linux в Azure Sentinel. Это можно сделать для любого компьютера, который позволяет установить агент Log Analytics непосредственно на компьютере. Машинный демон системного журнала на компьютере будет выполнять накопление локальных событий указанных типов и пересылать их локально в агент, который будет передавать их в рабочую область Log Analytics.

> [!NOTE]
> - Если устройство поддерживает **общий формат событий (CEF) в syslog**, собирается более полный набор данных, а данные анализируются в коллекции. Выберите этот параметр и следуйте инструкциям в статье [Подключение внешнего решения с помощью CEF](connect-common-event-format.md).
>
> - Log Analytics поддерживает сбор сообщений, отправленных управляющими программами **rsyslog** или **syslog-ng** , где значение по умолчанию — rsyslog. Управляющая программа системного журнала по умолчанию для версии 5 Red Hat Enterprise Linux (RHEL), CentOS и Oracle Linux версии (**sysklog**) не поддерживается для сбора событий syslog. Чтобы собирать данные системного журнала из дистрибутивов этих версий, требуется установить и настроить управляющую программу rsyslog, которая заменит sysklog.

## <a name="how-it-works"></a>Принципы работы

**Syslog** — это протокол ведения журнала событий, который является общим для Linux. Если на виртуальной машине или устройстве установлен **агент log Analytics для Linux** , программа установки настраивает локальную управляющую программу системного журнала на пересылку сообщений агенту через TCP-порт 25224. Затем агент отправляет сообщение в рабочую область Log Analytics по протоколу HTTPS, где он анализируется в запись журнала событий в таблице syslog в журнале **Sentinel >**.

Дополнительные сведения см. [в разделе источники данных syslog в Azure Monitor](../azure-monitor/platform/data-sources-syslog.md).

## <a name="configure-syslog-collection"></a>Настройка сбора системного журнала

### <a name="configure-your-linux-machine-or-appliance"></a>Настройка компьютера или устройства Linux

1. В поле Sentinel Azure выберите **соединители данных** , а затем выберите соединитель **syslog** .

1. В колонке **системного журнала** выберите **открыть страницу соединителя**.

1. Установите агент Linux. В разделе **Выбор места установки агента выполните следующие действия.**
    
    **Для виртуальной машины Linux в Azure:**
      
    1. Выберите **установить агент на виртуальной машине Linux в Azure**.
    
    1. Щелкните **скачать & установить агент для виртуальных машин Linux в Azure >** ссылку. 
    
    1. В колонке **виртуальные машины** щелкните виртуальную машину для установки агента, а затем нажмите кнопку **подключить**. Повторите этот шаг для каждой виртуальной машины, которую вы хотите подключить.
    
    **Для любой другой виртуальной машины Linux:**

    1. Выбор **установки агента на компьютере, отличном от Azure Linux**

    1. Щелкните **скачать & установить агент для компьютеров Linux, не относящихся к Azure >** ссылку. 

    1. В колонке **Управление агентами** перейдите на вкладку **Серверы Linux** , скопируйте команду **скачать и подключите агент для Linux** и запустите его на компьютере Linux. 
    
   > [!NOTE]
   > Убедитесь, что настройки безопасности для этих компьютеров настроены в соответствии с политикой безопасности вашей организации. Например, можно настроить параметры сети для согласования с политикой сетевой безопасности Организации, а также изменить порты и протоколы в управляющей программе в соответствии с требованиями безопасности.

### <a name="configure-the-log-analytics-agent"></a>Настройка агента Log Analytics

1. В нижней части колонки соединителя системного журнала щелкните ссылку **открыть рабочую область Конфигурация дополнительных параметров >** .

1. В колонке **Дополнительные параметры** выберите **Data**  >  **syslog**. Затем добавьте средства для собираются соединителя.
    
    - Добавьте в заголовки журналов средства, включаемые устройством syslog. 
    
    - Если вы хотите использовать аномальное обнаружение входа SSH с собранными данными, добавьте **AUTH** и **аусприв**. Дополнительные сведения см. в [следующем разделе](#configure-the-syslog-connector-for-anomalous-ssh-login-detection) .

1. После добавления всех средств, которые необходимо отслеживать, и настройки параметров серьезности для каждого из них, установите флажок **Применить к моим компьютерам следующую конфигурацию**.

1. Щелкните **Сохранить**. 

1. На виртуальной машине или устройстве убедитесь, что вы отправляете указанные Вами средства.

1. Чтобы запросить данные журнала Syslog **в журналах,** введите `Syslog` в окне запроса.

1. Вы можете использовать параметры запроса, описанные в разделе [Использование функций в Azure Monitor запросов журналов](../azure-monitor/log-query/functions.md) для анализа сообщений системного журнала. Затем можно сохранить запрос как новую функцию Log Analytics и использовать ее в качестве нового типа данных.

> [!NOTE]
> **Использование одного компьютера для пересылки обычных системных syslog *и* сообщений CEF**
>
>
> Вы можете использовать имеющийся [компьютер сервера пересылки журналов CEF](connect-cef-agent.md) для накопления и пересылки журналов из простых источников syslog. Однако необходимо выполнить следующие действия, чтобы избежать отправки событий в обоих форматах в Azure Sentinel, так как это приведет к дублированию событий.
>
>    Уже настроили [сбор данных из источников CEF](connect-common-event-format.md)и настроили агент log Analytics следующим образом:
>
> 1. На каждом компьютере, который отправляет журналы в формате CEF, необходимо изменить файл конфигурации syslog, чтобы удалить средства, которые используются для отправки сообщений CEF. Таким образом, средства, отправляемые в CEF, не будут отправляться в syslog. Подробные инструкции по выполнению этой задачи см. в статье [Настройка системного журнала в агенте Linux](../azure-monitor/platform/data-sources-syslog.md#configure-syslog-on-linux-agent) .
>
> 1. На этих компьютерах необходимо выполнить следующую команду, чтобы отключить синхронизацию агента с конфигурацией syslog в Azure Sentinel. Это гарантирует, что изменение конфигурации, сделанное на предыдущем шаге, не перезаписывается.<br>
> `sudo su omsagent -c 'python /opt/microsoft/omsconfig/Scripts/OMS_MetaConfigHelper.py --disable'`


### <a name="configure-the-syslog-connector-for-anomalous-ssh-login-detection"></a>Настройка соединителя syslog для обнаружения аномальных входов SSH

> [!IMPORTANT]
> Аномальное обнаружение входа SSH в настоящее время находится в общедоступной предварительной версии.
> Эта функция предоставляется без соглашения об уровне обслуживания и не рекомендуется для рабочих нагрузок.
> Дополнительные сведения см. в статье [Дополнительные условия использования предварительных выпусков Microsoft Azure](https://azure.microsoft.com/support/legal/preview-supplemental-terms/).

Sentinel Azure может применить машинное обучение (ML) к данным системного журнала для обнаружения аномальных Secure Shell (SSH). Сценарии включают:

- Невозможность перемещения — когда два успешных события входа происходят из двух расположений, которые не удается достичь в течение времени двух событий входа в систему.
- Неожиданное расположение — это расположение, из которого произошло успешное событие входа, подозрительное. Например, расположение не было недавно замечено.
 
Для этого обнаружения требуется определенная конфигурация соединителя данных syslog: 

1. В шаге 5 предыдущей процедуры убедитесь, что в качестве наблюдаемых средств выбраны обе **проверки подлинности** и **аусприв** . Используйте параметры по умолчанию для параметров серьезности, чтобы они были выбраны. Например:
    
    > [!div class="mx-imgBorder"]
    > ![Средства, необходимые для обнаружения аномальных входов по протоколу SSH](./media/connect-syslog/facilities-ssh-detection.png)

2. Подождите, достаточно времени для сбора данных системного журнала. Затем перейдите в раздел **Azure Sentinel-Logs** и скопируйте и вставьте следующий запрос:
    
    ```kusto
    Syslog
    | where Facility in ("authpriv","auth")
    | extend c = extract( "Accepted\\s(publickey|password|keyboard-interactive/pam)\\sfor ([^\\s]+)",1,SyslogMessage)
    | where isnotempty(c)
    | count 
    ```
    
    Измените **диапазон времени** , если это необходимо, и выберите **выполнить**.
    
    Если полученное значение счетчика равно нулю, проверьте конфигурацию соединителя и убедитесь, что наблюдаемые компьютеры успешно выполнили вход в течение указанного периода времени для запроса.
    
    Если полученное число больше нуля, данные системного журнала подходят для обнаружения аномальных входов по протоколу SSH. Это обнаружение включается из   >   **шаблона правил** аналитики  >  **(Предварительная версия) с аномальным обнаружением входа SSH**.

## <a name="next-steps"></a>Следующие шаги
В этом документе вы узнали, как подключить локальные устройства syslog к Azure Sentinel. Ознакомьтесь с дополнительными сведениями об Azure Sentinel в соответствующих статьях.
- Узнайте, как [отслеживать свои данные и потенциальные угрозы](quickstart-get-visibility.md).
- Узнайте, как приступить к [обнаружению угроз с помощью Azure Sentinel](tutorial-detect-threats-built-in.md).
- [Используйте книги](tutorial-monitor-your-data.md) для мониторинга данных.

