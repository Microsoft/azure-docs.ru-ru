---
title: Расширение маркеров Azure между рабочими областями и клиентами | Документация Майкрософт
description: Использование Sentinel Azure для запроса и анализа данных в рабочих областях и клиентах.
services: sentinel
documentationcenter: na
author: yelevin
manager: rkarlin
editor: ''
ms.service: azure-sentinel
ms.subservice: azure-sentinel
ms.devlang: na
ms.topic: conceptual
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 09/11/2020
ms.author: yelevin
ms.openlocfilehash: 49b267d36fb6c365cf2125912c0d27fe7d669474
ms.sourcegitcommit: e559daa1f7115d703bfa1b87da1cf267bf6ae9e8
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/17/2021
ms.locfileid: "100585292"
---
# <a name="extend-azure-sentinel-across-workspaces-and-tenants"></a>Расширение Azure Sentinel между рабочими областями и арендаторами

## <a name="the-need-to-use-multiple-azure-sentinel-workspaces"></a>Необходимость использования нескольких рабочих областей Azure Sentinel

Azure Sentinel построен на основе рабочей области Log Analytics. Вы заметите, что первым шагом в адаптации Sentinel Azure является выбор рабочей области Log Analytics, которую вы хотите использовать для этой цели.

Одной рабочей области может быть достаточно, чтобы использовать все преимущества Azure Sentinel. Даже в некоторых случаях может потребоваться наличие нескольких рабочих областей. В следующей таблице перечислены некоторые из этих ситуаций, и, по возможности, предлагается, как это требование может быть удовлетворено одной рабочей областью:

| Требование | Описание | Способы сокращения количества рабочих областей |
|-------------|-------------|--------------------------------|
| Независимости и соответствие нормативным требованиям | Рабочая область связана с конкретным регионом. Если данные должны храниться в разных [географических регионах Azure](https://azure.microsoft.com/global-infrastructure/geographies/) для удовлетворения нормативных требований, их необходимо разделить на отдельные рабочие области. |  |
| Владение данными | Границы владения данными, например дочерними компаниями или аффилированными организациями, лучше разделить с помощью отдельных рабочих областей. |  |
| Несколько клиентов Azure | Azure Sentinel поддерживает сбор данных из ресурсов Microsoft и Azure SaaS только в пределах своей собственной границы клиента Azure Active Directory (Azure AD). Таким образом, каждому клиенту Azure AD требуется отдельная рабочая область. |  |
| Детальное управление доступом к данным | Для доступа к некоторым данным, собранным с помощью Sentinel Azure, Организации может потребоваться разрешить другим группам в организации или за ее пределами. Пример.<br><ul><li>Доступ владельцев ресурсов к данным, относящимся к их ресурсам</li><li>Региональный или дочерний SoC доступ к данным, относящимся к их частям Организации</li></ul> | Использование [ресурса Azure](https://techcommunity.microsoft.com/t5/azure-sentinel/controlling-access-to-azure-sentinel-data-resource-rbac/ba-p/1301463) RBAC или [Azure RBAC на уровне таблицы](https://techcommunity.microsoft.com/t5/azure-sentinel/table-level-rbac-in-azure-sentinel/ba-p/965043) |
| Детальные параметры хранения | Исторически несколько рабочих областей были единственным способом задать разные сроки хранения для разных типов данных. В большинстве случаев это больше не требуется, благодаря вводу параметров хранения на уровне таблицы. | Использование [параметров хранения на уровне таблицы](https://techcommunity.microsoft.com/t5/azure-sentinel/new-per-data-type-retention-is-now-available-for-azure-sentinel/ba-p/917316) или автоматизация [удаления данных](../azure-monitor/logs/personal-data-mgmt.md#how-to-export-and-delete-private-data) |
| Раздельное выставление счетов | Поместив рабочие области в отдельные подписки, можно выставлять счета за них для разных сторон. | Отчеты об использовании и перекрестное выставление счетов |
| Устаревшая архитектура | Использование нескольких рабочих областей может быть обусловлено историческим дизайном, в котором были рассмотрены ограничения или рекомендации, которые больше не имеют значения true. Это также может быть произвольно выбранный проект, который можно изменить для приведения в соответствие с Azure Sentinel.<br><br>Примеры приведены ниже.<br><ul><li>Использование рабочей области по умолчанию для каждой подписки при развертывании центра безопасности Azure</li><li>Потребность в детализированном управлении доступом или параметрах хранения, решения, для которых относительно новые</li></ul> | Перепроектирование рабочих областей |

### <a name="managed-security-service-provider-mssp"></a>Поставщик управляемой службы безопасности (МССП)

Конкретный вариант использования, который требует нескольких рабочих областей, — это МССП служба Sentinel Azure. В этом случае многие из перечисленных выше требований не применяются, поэтому рекомендуется сделать несколько рабочих областей в разных клиентах. МССП может использовать [Лигхсаусе Azure](../lighthouse/overview.md) для расширения возможностей работы с несколькими рабочими областями маркеров Azure между клиентами.

## <a name="azure-sentinel-multiple-workspace-architecture"></a>Архитектура с несколькими рабочими областями Azure Sentinel

Как оговорено в приведенных выше требованиях, существуют случаи, когда несколько рабочих областей Azure Sentinel, потенциально для клиентов Azure Active Directory (Azure AD), должны централизованно отслеживаться и управляться одним SOC.

- Служба МССП Azure Sentinel.

- Глобальный SOC, обслуживающий несколько дочерних компаний, у каждого из которых есть собственная учетная роль SOC.

- Средство SOC, отслеживающее несколько клиентов Azure AD в Организации.

Для решения этого требования Azure Sentinel предлагает возможность использования нескольких рабочих областей, обеспечивающих централизованный мониторинг, настройку и управление, предоставляя единую панель прозрачности по всему, что определяется средством SOC, как показано на схеме ниже.

:::image type="content" source="media/extend-sentinel-across-workspaces-tenants/cross-workspace-architecture.png" alt-text="Архитектура между рабочими областями":::

Эта модель предоставляет значительные преимущества по сравнению с полностью централизованной моделью, в которой все данные копируются в одну рабочую область:

- Гибкое назначение ролей глобальным и локальным SoC или МССП своим клиентам.

- Меньшее количество проблем, связанных с владением данными, конфиденциальностью данных и соответствием нормативным требованиям.

- сокращение сетевых задержек и расходов;

- Простота адаптации и отключения новых дочерних компаний или клиентов.

В следующих разделах будет объяснено, как использовать эту модель, и, в частности, как:

- Централизованно отслеживать несколько рабочих областей, которые, в своюмся, могут быть разными клиентами, предоставляя SOC с одной панелью стекла.

- Централизованная настройка и управление несколькими рабочими областями, которые могут быть разными клиентами, с помощью автоматизации.

## <a name="cross-workspace-monitoring"></a>Мониторинг между рабочими областями

### <a name="manage-incidents-on-multiple-workspaces"></a>Управление инцидентами в нескольких рабочих областях

Azure Sentinel поддерживает [представление инцидентов нескольких рабочих областей](./multiple-workspace-view.md) , которое упрощает мониторинг централизованных инцидентов и управление ими в нескольких рабочих областях. Представление централизованного инцидента позволяет управлять инцидентами напрямую или детализировать их прозрачно до сведений об инциденте в контексте исходной рабочей области.

### <a name="cross-workspace-querying"></a>Запросы между рабочими областями

Azure Sentinel поддерживает запросы [к нескольким рабочим областям в одном запросе](../azure-monitor/logs/cross-workspace-query.md), позволяя выполнять поиск и сопоставление данных из нескольких рабочих областей в одном запросе. 

- Используйте [выражение Workspace ()](../azure-monitor/logs/workspace-expression.md) для ссылки на таблицу в другой рабочей области. 
- Используйте [оператор Union](/azure/data-explorer/kusto/query/unionoperator?pivots=azuremonitor) наряду с выражением Workspace (), чтобы применить запрос к нескольким таблицам в нескольких рабочих областях.

Сохраненные [функции](../azure-monitor/logs/functions.md) можно использовать для упрощения запросов между рабочими областями. Например, если ссылка на рабочую область является длинной, может потребоваться сохранить выражение `workspace("customer-A's-hard-to-remember-workspace-name").SecurityEvent` как функцию с именем `SecurityEventCustomerA` . Затем можно создавать запросы как `SecurityEventCustomerA | where ...` .

Функция также может упростить широко используемое объединение. Например, можно сохранить следующее выражение как функцию с именем `unionSecurityEvent` :

`union workspace(“hard-to-remember-workspace-name-1”).SecurityEvent, workspace(“hard-to-remember-workspace-name-2”).SecurityEvent`

Затем можно написать запрос в обеих рабочих областях, начиная с `unionSecurityEvent | where ...` .

#### <a name="cross-workspace-analytics-rules"></a>Правила аналитики между рабочими областями<a name="scheduled-alerts"></a>
<!-- Bookmark added for backward compatibility with old heading -->
Запросы между рабочими областями теперь можно включать в запланированные правила аналитики с соблюдением следующих ограничений.

- Один запрос может содержать до 20 рабочих областей.
- Sentinel Azure необходимо развернуть в каждой рабочей области, на которую ссылается запрос.

> [!NOTE] 
> Запрос нескольких рабочих областей в одном запросе может повлиять на производительность, поэтому рекомендуется только в том случае, если логика требует этой функции.

#### <a name="cross-workspace-workbooks"></a>Книги с разными рабочими областями<a name="using-cross-workspace-workbooks"></a>
<!-- Bookmark added for backward compatibility with old heading -->
[Книги](./overview.md#workbooks) предоставляют панели мониторинга и приложения для Azure Sentinel. При работе с несколькими рабочими областями они обеспечивают мониторинг и действия в рабочих областях.

Книги могут предоставлять запросы между рабочими областями одним из трех способов, каждый из которых подходит к различным уровням знаний конечного пользователя:

| Метод  | Описание | Когда следует использовать? |
|---------|-------------|--------------------|
| Создание запросов между рабочими областями | Создатель книги может создавать запросы между рабочими областями (описанными выше) в книге. | Этот параметр позволяет создателям книг полностью защитить пользователя от структуры рабочей области. |
| Добавление в книгу селектора рабочей области | Создатель книги может реализовать селектор рабочей области как часть книги, как описано [здесь](https://techcommunity.microsoft.com/t5/azure-sentinel/making-your-azure-sentinel-workbooks-multi-tenant-or-multi/ba-p/1402357). | Этот параметр позволяет пользователю управлять рабочими областями, отображаемыми книгой, с помощью простого раскрывающегося списка. |
| Интерактивное редактирование книги | Опытный пользователь, изменяющий существующую книгу, может изменять запросы в ней, выбирая целевые рабочие области с помощью селектора рабочей области в редакторе. | Этот параметр позволяет опытному пользователю легко изменять существующие книги для работы с несколькими рабочими областями. |
|

#### <a name="cross-workspace-hunting"></a>Поиск между рабочими областями

Azure Sentinel предоставляет предварительно загруженные образцы запросов, предназначенные для начала работы и знакомства с таблицами и языком запросов. Эти встроенные запросы поиска разрабатываются исследователими Майкрософт по безопасности на постоянной основе, добавляя новые запросы и тонкую настройку существующих запросов, чтобы предоставить точку входа для поиска новых обнаружений и определить признаки вторжения, которые могли быть не обнаружены средствами безопасности.  

Возможности поиска в разных рабочих областях позволяют скидкамиу угроз создавать новые запросы поиска или адаптировать существующие, чтобы охватывать несколько рабочих областей, с помощью оператора UNION и выражения Workspace (), как показано выше.

## <a name="cross-workspace-management-using-automation"></a>Управление между рабочими областями с помощью автоматизации

Для настройки нескольких рабочих областей Azure Sentinel и управления ими необходимо автоматизировать использование API-интерфейса управления Sentinel Azure. Дополнительные сведения об автоматизации развертывания ресурсов-маркеров Azure, включая правила оповещений, запросы на поиск, книги и модули PlayBook, см. в разделе [расширение Azure Sentinel: API, интеграция и Автоматизация управления](https://techcommunity.microsoft.com/t5/azure-sentinel/extending-azure-sentinel-apis-integration-and-management/ba-p/1116885).

См. также [развертывание и управление Sentinel Azure в качестве кода](https://techcommunity.microsoft.com/t5/azure-sentinel/deploying-and-managing-azure-sentinel-as-code/ba-p/1131928) и [объединение Azure Лигхсаусе с возможностями DevOps Sentinel](https://techcommunity.microsoft.com/t5/azure-sentinel/combining-azure-lighthouse-with-sentinel-s-devops-capabilities/ba-p/1210966) для Объединенной, предоставляемой сообществом методологии управления Sentinel Azure в виде кода, а также для развертывания и настройки ресурсов из закрытого репозитория GitHub. 

## <a name="managing-workspaces-across-tenants-using-azure-lighthouse"></a>Управление рабочими областями в клиентах с помощью Azure Лигхсаусе

Как упоминалось выше, во многих сценариях различные рабочие области Azure Sentinel могут находиться в разных клиентах Azure AD. Вы можете использовать [Azure лигхсаусе](../lighthouse/overview.md) , чтобы расширить все действия между рабочими областями в пределах каждого клиента, что позволяет пользователям вашего управляемого клиента работать в рабочих областях Azure Sentinel во всех клиентах. После подключения Azure Лигхсаусе используйте [селектор каталог и подписка](./multiple-tenants-service-providers.md#how-to-access-azure-sentinel-in-managed-tenants) на [портал Azure, чтобы](../lighthouse/how-to/onboard-customer.md)выбрать все подписки, содержащие рабочие области, которыми требуется управлять, чтобы убедиться, что они будут доступны на разных селекторах рабочей области на портале.

При использовании Azure Лигхсаусе рекомендуется создать группу для каждой роли Sentinel Azure и делегировать разрешения из каждого клиента в эти группы.

## <a name="next-steps"></a>Дальнейшие шаги
В этом документе вы узнали, как можно расширить возможности Azure Sentinel в нескольких рабочих областях и клиентах. Практические рекомендации по реализации архитектуры межрабочей области Azure Sentinel см. в следующих статьях:

- Узнайте, как [работать с несколькими клиентами](./multiple-tenants-service-providers.md) в Azure Sentinel с помощью Azure лигхсаусе.
- Узнайте, как легко [просматривать инциденты в нескольких рабочих областях и управлять ими](./multiple-workspace-view.md) .
