---
title: Общие сведения о проверке подлинности учетной записи службы автоматизации Azure
description: Эта статья содержит общие сведения о проверке подлинности учетной записи службы автоматизации Azure.
keywords: безопасность в службе автоматизации, обеспечение безопасности в службе автоматизации, проверка подлинности в службе автоматизации
services: automation
ms.subservice: process-automation
ms.date: 02/01/2021
ms.topic: conceptual
ms.openlocfilehash: e3ed14a0845d90a1b9b951dd5175acf6233f8718
ms.sourcegitcommit: d49bd223e44ade094264b4c58f7192a57729bada
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/02/2021
ms.locfileid: "99255005"
---
# <a name="automation-account-authentication-overview"></a>Общие сведения о проверке подлинности учетной записи службы автоматизации

С помощью службы автоматизации Azure можно автоматизировать задачи, выполняемые с ресурсами Azure (локально), а также с ресурсами других поставщиков облачных служб, например Amazon Web Services (AWS). Модули Runbook можно использовать для автоматизации задач или гибридной рабочей роли Runbook, если у вас есть бизнес-процессы для управления за пределами Azure. Для работы в любой из этих сред требуются разрешения на безопасный доступ к ресурсам с минимальными необходимыми правами.

В этой статье рассматриваются разные сценарии проверки подлинности, поддерживаемые службой автоматизации Azure, и описывается процесс начала работы с учетом среды или сред, для которых вы настраиваете управление.

## <a name="automation-account"></a>Учетная запись службы автоматизации

При первом запуске службы автоматизации Azure необходимо создать по крайней мере одну учетную запись службы автоматизации. Учетные записи службы автоматизации позволяют изолировать ресурсы автоматизации, модули Runbook, ресурсы и конфигурации из ресурсов других учетных записей. Учетные записи службы автоматизации можно использовать для разделения ресурсов на отдельные логические среды или делегированные обязанности. Например, для разработки можно использовать одну учетную запись, для рабочей среды — другую, а для локальной среды — третью. Также можно выделить учетную запись службы автоматизации для управления обновлениями операционной системы на всех компьютерах с [Управление обновлениями](update-management/overview.md). 

Учетная запись службы автоматизации Azure отличается от учетной записи Майкрософт или учетных записей, созданных в рамках подписки Azure. Общие сведения см. в статье [Создание учетной записи службы автоматизации](automation-quickstart-create-account.md).

## <a name="automation-resources"></a>Ресурсы службы автоматизации

Ресурсы каждой учетной записи службы автоматизации связаны с одним регионом Azure, но учетные записи могут управлять всеми ресурсами в вашей подписке Azure. Главной причиной создания учетных записей службы автоматизации в разных регионах будет наличие политик, требующих изолировать данные и ресурсы в определенном регионе.

Все задачи, создаваемые для ресурсов с использованием Azure Resource Manager и командлетов PowerShell в службе автоматизации Azure, должны выполнять проверку подлинности в Azure с помощью корпоративных учетных данных (удостоверения Azure Active Directory).

## <a name="run-as-accounts"></a>Учетные записи запуска от имени

Учетные записи запуска от имени в службе автоматизации Azure обеспечивают проверку подлинности для управления Azure Resource Manager ресурсами или ресурсами, развернутыми в классической модели развертывания. В службе автоматизации Azure существует два типа учетных записей запуска от имени:

* Учетная запись запуска от имени Azure. позволяет управлять ресурсами Azure на основе службы развертывания и управления Azure Resource Manager для Azure.
* Классическая учетная запись запуска от имени Azure. позволяет управлять классическими ресурсами Azure на основе классической модели развертывания.

Дополнительные сведения о Azure Resource Manager и классических моделях развертывания см. в разделе [Диспетчер ресурсов и классическое развертывание](../azure-resource-manager/management/deployment-models.md).

>[!NOTE]
>Подписки Поставщика облачных речений Azure (CSP) поддерживают только модель Azure Resource Manager. Службы, не являющиеся частью Azure Resource Manager, недоступны в программе. При использовании подписки CSP создается не классическая учетная запись запуска от имени Azure, а учетная запись запуска от имени Azure. Дополнительные сведения о подписках CSP см. в разделе [Доступные службы в подписках CSP](/azure/cloud-solution-provider/overview/azure-csp-available-services).

При создании учетной записи службы автоматизации по умолчанию создается учетная запись запуска от имени. Если вы решили не создавать его вместе с учетной записью службы автоматизации, его можно создать по отдельности. Классическая учетная запись запуска от имени Azure является необязательной и создается отдельно, если требуется управлять классическими ресурсами.

### <a name="run-as-account"></a>учетная запись запуска от имени

При создании учетной записи запуска от имени она выполняет следующие задачи:

* Создает приложение Azure AD с самозаверяющим сертификатом, создает учетную запись субъекта-службы для приложения в Azure AD и назначает роль [участника](../role-based-access-control/built-in-roles.md#contributor) для учетной записи в текущей подписке. Можно изменить параметр сертификата на [читатель](../role-based-access-control/built-in-roles.md#reader) или любую другую роль. Дополнительные сведения см. в статье [Управление доступом на основе ролей в службе автоматизации Azure](automation-role-based-access-control.md).

* Создает ресурс сертификата службы автоматизации `AzureRunAsCertificate` в указанной учетной записи службы автоматизации. Этот ресурс содержит закрытый ключ сертификата, используемый в приложении Azure AD.

* Создает ресурс подключения службы автоматизации `AzureRunAsConnection` в указанной учетной записи службы автоматизации. Этот ресурс содержит идентификаторы приложения, клиента и подписки, а также отпечаток сертификата.

### <a name="azure-classic-run-as-account"></a>классическая учетная запись запуска от имени Azure.

При создании классической учетной записи запуска от имени Azure выполняются следующие задачи.

> [!NOTE]
> Для создания или обновления этого типа учетной записи запуска от имени необходимо быть соадминистратором подписки.

* Создает сертификат управления в подписке.

* Создает ресурс сертификата службы автоматизации `AzureClassicRunAsCertificate` в указанной учетной записи службы автоматизации. Этот ресурс содержит закрытый ключ сертификата, используемый в сертификате управления.

* Создает ресурс подключения службы автоматизации `AzureClassicRunAsConnection` в указанной учетной записи службы автоматизации. Этот ресурс содержит имя подписки, идентификатор подписки и имя ресурса сертификата.

## <a name="service-principal-for-run-as-account"></a>Субъект-служба для учетной записи запуска от имени

У субъекта-службы для учетной записи запуска от имени по умолчанию нет разрешений на чтение данных из Azure AD. Если вы хотите добавить разрешения на чтение данных из Azure AD или управления ими, необходимо предоставить субъекту-службе разрешения в разделе **Разрешения API**. Дополнительные сведения см. в разделе [Добавление разрешений для доступа к веб-API](../active-directory/develop/quickstart-configure-app-access-web-apis.md#add-permissions-to-access-your-web-api).

## <a name="run-as-account-permissions"></a><a name="permissions"></a>Разрешения учетной записи запуска от имени

В этом разделе определены разрешения для обычной и классической учетных записей запуска от имени.

* Чтобы создать или обновить учетную запись запуска от имени, администратор приложения в Azure Active Directory и владелец в подписке могут выполнить все задачи.
* Чтобы настроить или обновить классические учетные записи запуска от имени, необходима роль соадминистратора на уровне подписки. Чтобы узнать больше о разрешениях классической подписки, ознакомьтесь с разделом [Классические администраторы подписок Azure](../role-based-access-control/classic-administrators.md#add-a-co-administrator).

В следующей таблице показаны списки задач, эквивалентный командлет и необходимые разрешения для ситуаций, когда применяется разделение обязанностей.

|Задача|Командлет  |Минимальные разрешения  |Где необходимо установить разрешения|
|---|---------|---------|---|
|Создание приложения Azure AD|[New-AzADApplication](/powershell/module/az.resources/new-azadapplication)     | Роль разработчика приложения<sup>1</sup>        |[Azure AD](../active-directory/develop/howto-create-service-principal-portal.md#permissions-required-for-registering-an-app)</br>"Главная" > "Azure AD" > "Регистрация приложений" |
|Добавление учетных данных приложения|[New-AzADAppCredential](/powershell/module/az.resources/new-azadappcredential)     | Администратор приложений или глобальный администратор<sup>1</sup>         |[Azure AD](../active-directory/develop/howto-create-service-principal-portal.md#permissions-required-for-registering-an-app)</br>"Главная" > "Azure AD" > "Регистрация приложений"|
|Создание или получение субъекта-службы Azure AD|[New-AzADServicePrincipal](/powershell/module/az.resources/new-azadserviceprincipal)</br>[Get-AzADServicePrincipal](/powershell/module/az.resources/get-azadserviceprincipal)     | Администратор приложений или глобальный администратор<sup>1</sup>        |[Azure AD](../active-directory/develop/howto-create-service-principal-portal.md#permissions-required-for-registering-an-app)</br>"Главная" > "Azure AD" > "Регистрация приложений"|
|Назначение или получение роли Azure для указанного субъекта|[New-AzRoleAssignment](/powershell/module/az.resources/new-azroleassignment)</br>[Get-AzRoleAssignment](/powershell/module/Az.Resources/Get-AzRoleAssignment)      | Администратор доступа пользователей, владелец или пользователь со следующими разрешениями:</br></br><code>Microsoft.Authorization/Operations/read</br>Microsoft.Authorization/permissions/read</br>Microsoft.Authorization/roleDefinitions/read</br>Microsoft.Authorization/roleAssignments/write</br>Microsoft.Authorization/roleAssignments/read</br>Microsoft.Authorization/roleAssignments/delete</code></br></br> | [Подписка](../role-based-access-control/role-assignments-portal.md)</br>Подписки главной > > \<subscription name\> — Управление доступом (IAM)|
|Создание или удаление сертификата службы автоматизации|[New-AzAutomationCertificate](/powershell/module/Az.Automation/New-AzAutomationCertificate)</br>[Remove-AzAutomationCertificate](/powershell/module/az.automation/remove-azautomationcertificate)     | Участник группы ресурсов         |Группа ресурсов учетной записи службы автоматизации|
|Создание или удаление подключения службы автоматизации|[New-AzAutomationConnection](/powershell/module/az.automation/new-azautomationconnection)</br>[Remove-AzAutomationConnection](/powershell/module/az.automation/remove-azautomationconnection)|Участник группы ресурсов |Группа ресурсов учетной записи службы автоматизации|

<sup>1</sup> пользователи без прав администратора в клиенте Azure AD могут [регистрировать приложения AD](../active-directory/develop/howto-create-service-principal-portal.md#permissions-required-for-registering-an-app) , если параметр пользователи клиента Azure AD **может зарегистрировать приложения** на странице **Параметры пользователя** имеет значение **Да**. Если для этого параметра задано значение **Нет**, то пользователь, выполняющий данное действие, должен соответствовать требованиям в этой таблице.

Если вам назначается роль глобального администратора или соадминистратора подписки, но вы не являетесь участником экземпляра Active Directory подписки, то вы будете добавлены в качестве гостя. В этом случае `You do not have permissions to create…` на странице **Добавление учетной записи службы автоматизации** появится предупреждение.

Вот как можно убедиться, что ситуация, создающая сообщение об ошибке, исправлена.

1. На портале Azure в области Azure Active Directory выберите **Пользователи и группы**.
2. Выберите **Все пользователи**.
3. Выберите свое имя, а затем выберите **Профиль**.
4. Убедитесь, что для атрибута **Тип пользователя** в профиле пользователя не задано значение **Гость**.

## <a name="role-based-access-control"></a>Управление доступом на основе ролей

В Azure Resource Manager контроль доступа на основе ролей можно использовать для предоставления разрешений учетной записи пользователя Azure AD и учетной записи запуска от имени, а также для проверки подлинности субъекта-службы. Дополнительные сведения о разработке модели управления разрешениями в службе автоматизации см. в статье [Управление доступом на основе ролей в службе автоматизации Azure](automation-role-based-access-control.md).

Если для назначения разрешений в группах ресурсов имеются ограниченные элементы управления безопасностью, необходимо назначить членство в учетной записи запуска от имени роли **участника** в группе ресурсов.

## <a name="runbook-authentication-with-hybrid-runbook-worker"></a>Проверка подлинности runbook для гибридной рабочей роли Runbook

Последовательности runbook, запущенные в гибридной рабочей роли Runbook в вашем центре обработки данных или в других облаках, например в вычислительных службах AWS, не могут использовать стандартный для обычных runbook метод проверки подлинности в ресурсах Azure. Это происходит потому, что такие ресурсы работают за пределами Azure и для них требуются отдельные учетные данные безопасности, определяемые службой автоматизации для проверки подлинности ресурсов, доступ к которым они получают локально. Дополнительные сведения о проверке подлинности runbook в рабочей роли runbook см. в статье [Запуск модулей Runbook в гибридной рабочей роли Runbook](automation-hrw-run-runbooks.md).

Для runbook, которые используют гибридные рабочие роли Runbook на виртуальных машинах Azure, вместо учетной записи запуска от имени можно применить [проверку подлинности на основе управляемых удостоверений](automation-hrw-run-runbooks.md#runbook-auth-managed-identities), чтобы получать доступ к ресурсам Azure.

## <a name="next-steps"></a>Дальнейшие действия

* Сведения о создании учетной записи службы автоматизации на портале Azure см. в статье [Создание автономной учетной записи службы автоматизации Azure](automation-create-standalone-account.md).
* Если вы предпочитаете работать с шаблонами, см. статью [Создание учетной записи службы автоматизации с помощью шаблона Azure Resource Manager](quickstart-create-automation-account-template.md).
* Для использования Amazon Web Services прочитайте статью [Аутентификация модулей runbook службы автоматизации Azure с помощью Amazon Web Services](automation-config-aws-account.md).