---
title: Устранение неполадок службы автоматизации Azure — проблемы функции "Отслеживание и инвентаризация изменений"
description: В этой статье рассказывается, как устранять неполадки и разрешать проблемы функции "Отслеживание и инвентаризации изменений" службы автоматизации Azure.
services: automation
ms.subservice: change-inventory-management
ms.date: 02/15/2021
ms.topic: troubleshooting
ms.openlocfilehash: dd027f94edad580836f0afb8c7293c81ca77605a
ms.sourcegitcommit: 910a1a38711966cb171050db245fc3b22abc8c5f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/20/2021
ms.locfileid: "101723832"
---
# <a name="troubleshoot-change-tracking-and-inventory-issues"></a>Устранение неполадок с Отслеживанием изменений и инвентаризации

В этой статье описывается, как устранять неполадки и устранять проблемы с отслеживанием и инвентаризацией изменений в службе автоматизации Azure. Общие сведения о функциях отслеживания изменений и инвентаризации см. в [Обзор функции "Отслеживание и инвентаризация изменений"](../change-tracking/overview.md).

## <a name="general-errors"></a>Общие ошибки

### <a name="scenario-machine-is-already-registered-to-a-different-account"></a><a name="machine-already-registered"></a>Сценарий. Компьютер уже зарегистрирован в другой учетной записи

### <a name="issue"></a>Проблема

Отображается следующее сообщение об ошибке:

```error
Unable to Register Machine for Change Tracking, Registration Failed with Exception System.InvalidOperationException: {"Message":"Machine is already registered to a different account."}
```

### <a name="cause"></a>Причина

Компьютер уже был развернут в другой рабочей области для Отслеживание изменений.

### <a name="resolution"></a>Решение

1. Убедитесь, что компьютер отправляет отчеты в правильную рабочую область. Инструкции по проверке см. в разделе [Проверка подключения агента к Azure Monitor](../../azure-monitor/agents/agent-windows.md#verify-agent-connectivity-to-azure-monitor). Также убедитесь, что эта рабочая область связана с учетной записью службы автоматизации Azure. Для подтверждения перейдите на страницу учетной записи службы автоматизации и в разделе **Связанные ресурсы** выберите **Связанная рабочая область**.

1. Убедитесь, что компьютеры отображаются в рабочей области Log Analytics, связанной с вашей учетной записью службы автоматизации. Выполните следующий запрос в рабочей области Log Analytics.

   ```kusto
   Heartbeat
   | summarize by Computer, Solutions
   ```

   Если компьютер не отображается в результатах запроса, он не был возвращен в последнее время. Возможно, есть проблемы с локальной конфигурацией. Необходимо переустановить агент Log Analytics.

   Если компьютер указан в результатах запроса, проверьте свойство Solutions, которое **отслеживания изменений** в списке. Он проверяет, зарегистрирован ли он в Отслеживание изменений и инвентаризации. Если это не так, проверьте наличие проблем с конфигурацией области. Конфигурация области определяет, какие компьютеры настроены для Отслеживание изменений и инвентаризации. Чтобы настроить конфигурацию области для целевого компьютера, см. статью [включение отслеживание изменений и инвентаризации из учетной записи службы автоматизации](../change-tracking/enable-from-automation-account.md).

   В рабочей области выполните этот запрос.

   ```kusto
   Operation
   | where OperationCategory == 'Data Collection Status'
   | sort by TimeGenerated desc
   ```

1. Если получен такой результат: ```Data collection stopped due to daily limit of free data reached. Ingestion status = OverQuota```, значит достигнута квота, определенная в рабочей области, которая не позволяет сохранить данные. В рабочей области выберите **использование и оценочные затраты**. Выберите новую **ценовую категорию** , которая позволит использовать больше данных, или щелкните **ежедневное ограничение** и снимите ограничение.

:::image type="content" source="./media/change-tracking/change-tracking-usage.png" alt-text="Использование и предполагаемые затраты." lightbox="./media/change-tracking/change-tracking-usage.png":::

Если проблема по прежнему не решена, следуйте инструкциям статьи [Развертывание гибридной рабочей роли Runbook для Windows](../automation-windows-hrw-install.md), чтобы переустановить гибридную рабочую роль для Windows. Для Linux выполните действия, описанные в статье  [развертывание гибридной рабочей роли Runbook для Linux](../automation-linux-hrw-install.md).

## <a name="windows"></a>Windows

### <a name="scenario-change-tracking-and-inventory-records-arent-showing-for-windows-machines"></a><a name="records-not-showing-windows"></a>Сценарий. Записи отслеживания и инвентаризации изменений не отображаются для компьютеров Windows

#### <a name="issue"></a>Проблема

Вы не видите никаких результатов отслеживания и инвентаризации изменений для компьютеров Windows, для которых была включена эта функция.

#### <a name="cause"></a>Причина

Эта ошибка может быть вызвана следующими причинами.

* Агент Azure Log Analytics для Windows не работает.
* Обмен данными в учетной записи службы автоматизации заблокирован.
* Не скачаны пакеты управления для отслеживания и инвентаризации изменений.
* Включенная виртуальная машина может быть взята с клонированного компьютера, который не был подготовлен с помощью программы подготовки системы (sysprep) с установленным агентом Службы анализа журналов для Windows.

#### <a name="resolution"></a>Решение

На компьютере агента Службы анализа журналов перейдите в папку **C:\Program Files\Microsoft Monitoring Agent\Agent\Tools** и выполните следующие команды.

```cmd
net stop healthservice
StopTracing.cmd
StartTracing.cmd VER
net start healthservice
```

Если вам по-прежнему нужна помощь, можно собрать сведения диагностики и обратиться в службу поддержки.

> [!NOTE]
> По умолчанию агент Службы анализа журналов включает трассировку ошибок. Чтобы включить подробные сообщения об ошибках, как в предыдущем примере, используйте параметр `VER`. Для трассировки информации используйте `INF` при вызове `StartTracing.cmd`.

##### <a name="log-analytics-agent-for-windows-not-running"></a>Агент Службы анализа журналов для Windows не работает

Убедитесь, что на компьютере выполняется агент Службы анализа журналов для Windows (**HealthService.exe**).

##### <a name="communication-to-automation-account-blocked"></a>Обмен данными с учетной записью службы автоматизации заблокирован

Проверьте компонент "Просмотр событий" на компьютере, а также найдите любые события, которые содержат слово `changetracking`.

Чтобы узнать, какие адреса и порты должны быть разрешены для работы отслеживания и инвентаризации изменений, см. [Планирование сети](../automation-hybrid-runbook-worker.md#network-planning).

##### <a name="management-packs-not-downloaded"></a>Пакеты управления не скачаны

Убедитесь, что на локальном компьютере существуют следующие пакеты управления отслеживания и инвентаризации изменений.

* `Microsoft.IntelligencePacks.ChangeTrackingDirectAgent.*`
* `Microsoft.IntelligencePacks.InventoryChangeTracking.*`
* `Microsoft.IntelligencePacks.SingletonInventoryCollection.*`

##### <a name="vm-from-cloned-machine-that-has-not-been-sysprepped"></a>Виртуальная машина на клонированном компьютере не прошла подготовки sysprep

При использовании клонированного образа сначала выполните sysprep образа, а потом установите агент Службы анализа журналов для Windows.

## <a name="linux"></a>Linux

### <a name="scenario-no-change-tracking-and-inventory-results-on-linux-machines"></a>Сценарий: Нет результатов отслеживания и инвентаризации изменений на компьютерах Linux

#### <a name="issue"></a>Проблема

Вы не видите никаких результатов отслеживания и инвентаризации изменений для компьютеров Linux, для которых включена эта функция. 

#### <a name="cause"></a>Причина
Ниже приведены возможные причины этой проблемы.
* Агент Службы анализа журналов для Linux не работает.
* Агент Службы анализа журналов для Linux настроен неправильно.
* Существуют конфликты мониторинга целостности файлов (FIM).

#### <a name="resolution"></a>Решение 

##### <a name="log-analytics-agent-for-linux-not-running"></a>Агент Службы анализа журналов для Linux не работает

Убедитесь, что управляющая программа агента Службы анализа журналов для Linux (**omsagent**) запущена на компьютере. Выполните следующий запрос в рабочей область Службы анализа журналов, связанной с вашей учетной записью службы автоматизации.

```loganalytics Copy
Heartbeat
| summarize by Computer, Solutions
```

Если компьютер не отображается в результатах запроса, он давно не синхронизировался. Вероятно, существует ошибка локальной конфигурации и необходимо переустановить агент. Сведения об установке и настройке см. в статье [Сбор данных журнала с помощью агента Службы анализа журналов](../../azure-monitor/agents/log-analytics-agent.md).

Если компьютер отображается в результатах запроса, проверьте конфигурацию области. См. [Определение решений мониторинга в Azure Monitor](../../azure-monitor/insights/solution-targeting.md).

Дополнительные сведения об устранении этой проблемы см. в разделе [Проблема: не отображаются данные Linux](../../azure-monitor/agents/agent-linux-troubleshoot.md#issue-you-are-not-seeing-any-linux-data).

##### <a name="log-analytics-agent-for-linux-not-configured-correctly"></a>Агент Службы анализа журналов для Linux неправильно настроен

Возможно, агент Службы анализа журналов для Linux неправильно настроен для сбора выходных данных журнала и командной строки с помощью средства сбора журналов OMS. См. [Обзор функции "Отслеживание и инвентаризация изменений"](../change-tracking/overview.md).

##### <a name="fim-conflicts"></a>Конфликты FIM

Возможно, функция FIM Центра безопасности Azure неправильно проверяет целостность файлов Linux. Убедитесь, что FIM работает и правильно настроена для мониторинга файлов Linux. См. [Обзор функции "Отслеживание и инвентаризация изменений"](../change-tracking/overview.md).

## <a name="next-steps"></a>Дальнейшие действия

Если вы не нашли здесь свою проблему или рекомендации не позволили ее решить, попробуйте использовать один из следующих каналов для получения дополнительной поддержки.

* Получите ответы специалистов Azure на [форумах Azure](https://azure.microsoft.com/support/forums/).
* Подпишитесь на [@AzureSupport](https://twitter.com/azuresupport) — официальный канал Microsoft Azure для работы с клиентами. Служба поддержки Azure взаимодействует с сообществом Azure, предоставляя ответы, поддержку и советы экспертов.
* Отправьте запрос в службу поддержки Azure Перейдите на [сайт поддержки Azure](https://azure.microsoft.com/support/options/) и выберите **Получить поддержку**.