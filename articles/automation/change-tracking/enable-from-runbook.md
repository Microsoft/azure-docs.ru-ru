---
title: Включение отслеживания изменений и инвентаризации службы автоматизации Azure в модуле runbook
description: В этой статье рассказывается, как включить отслеживание изменений и инвентаризацию в модуле runbook.
services: automation
ms.subservice: change-inventory-management
ms.topic: conceptual
ms.date: 10/14/2020
ms.openlocfilehash: e5b42d6102737b778ea5d19cd7da3c2f64881b1b
ms.sourcegitcommit: 910a1a38711966cb171050db245fc3b22abc8c5f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/20/2021
ms.locfileid: "100585927"
---
# <a name="enable-change-tracking-and-inventory-from-a-runbook"></a>Включение Отслеживания изменений и инвентаризации в последовательности runbook

В этой статье описывается, как можно использовать модуль Runbook для включения [Отслеживание изменений и инвентаризации](overview.md) виртуальных машин в вашей среде. Чтобы включить большое количество виртуальных машин Azure, сначала необходимо включить существующую виртуальную машину с помощью Отслеживания изменений и инвентаризации.

> [!NOTE]
> При использовании Отслеживания изменений и инвентаризации только определенные регионы поддерживают связывание рабочей области Log Analytics с учетной записью службы автоматизации. Список поддерживаемых пар сопоставлений см. в статье о [сопоставлении региона для учетной записи службы автоматизации и рабочей области Log Analytics](../how-to/region-mappings.md).

Этот метод использует два модуля Runbook:

* **Enable-MultipleSolution** — основной модуль Runbook, который запрашивает сведения о конфигурации, запрашивает УКАЗАНную виртуальную машину и выполняет другие проверки, а затем вызывает модуль Runbook **Enable-аутоматионсолутион** для настройки отслеживание изменений и инвентаризации для каждой виртуальной машины в указанной группе ресурсов.
* **Enable-аутоматионсолутион** — включает отслеживание изменений и инвентаризацию для одной или нескольких виртуальных машин, указанных в Целевой группе ресурсов. Он проверяет соблюдение предварительных требований, проверяет, установлено ли Log Analytics расширение виртуальной машины и устанавливает его, если оно не найдено, и добавляет виртуальные машины в конфигурацию области в указанной Log Analytics рабочей области, связанной с учетной записью службы автоматизации.

## <a name="prerequisites"></a>Предварительные требования

* Подписка Azure. Если у вас ее нет, [активируйте преимущества для подписчиков MSDN](https://azure.microsoft.com/pricing/member-offers/msdn-benefits-details/) или [зарегистрируйте бесплатную учетную запись](https://azure.microsoft.com/free/?WT.mc_id=A261C142F).
* [Учетная запись службы автоматизации](../automation-security-overview.md) для управления компьютерами.
* [Рабочая область Log Analytics](../../azure-monitor/logs/design-logs-deployment.md)
* [Виртуальная машина](../../virtual-machines/windows/quick-create-portal.md).
* Два ресурса автоматизации, которые используются модулем Runbook **Enable-аутоматионсолутион** . Этот модуль Runbook, если он еще не существует в вашей учетной записи службы автоматизации, автоматически импортируется модулем Runbook **Enable-MultipleSolution** во время первого запуска.
    * *Ласолутионсубскриптионид*: идентификатор подписки, в которой находится рабочая область log Analytics.
    * *Ласолутионворкспацеид*: идентификатор рабочей области log Analytics, связанной с вашей учетной записью службы автоматизации.

    Эти переменные используются для настройки рабочей области подключенной виртуальной машины. Если они не указаны, сценарий сначала выполняет поиск любой виртуальной машины, подключенной к Отслеживание изменений и инвентаризации в своей подписке, за которой следует подписка, в которой находится учетная запись службы автоматизации, а затем все другие подписки, к которым имеет доступ учетная запись пользователя. Если они не настроены должным образом, это может привести к подключению компьютеров к некоторой случайной Log Analytics рабочей области.

## <a name="sign-in-to-azure"></a>Вход в Azure

Войдите на [портал Azure](https://portal.azure.com).

## <a name="enable-change-tracking-and-inventory"></a>Включение решения для отслеживания изменений и инвентаризации

1. В портал Azure перейдите к **учетным записям службы автоматизации**. На странице **учетные записи службы автоматизации** выберите свою учетную запись из списка.

1. В учетной записи службы автоматизации выберите пункт **Инвентаризация** или **Отслеживание изменений** в разделе **Управление конфигурацией**.

1. Выберите рабочую область Log Analytics и нажмите кнопку **Включить**. При включении учета или Отслеживание изменений отображается баннер.

    ![Включение решения для отслеживания изменений и инвентаризации](media/enable-from-automation-account/enable-feature.png)

## <a name="install-and-update-modules"></a>установка и обновление модулей;

Чтобы успешно включить Управление обновлениями для виртуальных машин с помощью модуля Runbook, необходимо выполнить обновление до последних модулей Azure и импортировать модуль [AZ. OperationalInsights](/powershell/module/az.operationalinsights) .

1. В учетной записи службы автоматизации выберите элемент **Модули** в области **Общие ресурсы**.

2. Выберите **Обновить модули Azure**, чтобы обновить модули Azure до последней версии.

3. Щелкните вариант **Да**, чтобы обновить все существующие модули Azure до последней версии.

    ![Обновление модулей](media/enable-from-runbook/update-modules.png)

4. Вернитесь к параметру **Модули** в разделе **Общие ресурсы**.

5. Щелкните **Обзор коллекции**, чтобы открыть коллекцию модулей.

6. Найдите `Az.OperationalInsights` и импортируйте этот модуль в учетную запись службы автоматизации.

    ![Импорт модуля OperationalInsights](media/enable-from-runbook/import-operational-insights-module.png)

## <a name="select-azure-vm-to-manage"></a>Выбор виртуальной машины Azure для управления

Если функция "Отслеживание изменений и инвентаризация" включена, можно добавить виртуальную машину Azure для управления с помощью этой функции.

1. В учетной записи службы автоматизации выберите **Отслеживание изменений** или **Инвентаризация** в разделе **Управление конфигурацией**.

2. Щелкните элемент **Добавить виртуальные машины Azure**, чтобы добавить виртуальную машину.

3. Выберите нужную виртуальную машину из списка и щелкните элемент **Включить**. Будет активировано Отслеживание изменений и инвентаризация для этой виртуальной машины.

   ![Включение Отслеживания изменений и инвентаризации для виртуальной машины](media/enable-from-runbook/enable-azure-vm.png)

    > [!NOTE]
    > Если вы попытаетесь включить другую функцию до завершения установки Отслеживания изменений и инвентаризации, появится следующее сообщение: `Installation of another solution is in progress on this or a different virtual machine. When that installation completes the Enable button is enabled, and you can request installation of the solution on this virtual machine.`

## <a name="import-a-runbook-to-enable-change-tracking-and-inventory"></a>Импорт модуля runbook для включения функции "Отслеживание изменений и инвентаризация"

1. В учетной записи службы автоматизации выберите **Модули Runbook** в области **Автоматизация процессов**.

2. Выберите **Обзор коллекции**.

3. Поиск **обновлений и отслеживание изменений**.

4. Выберите модуль Runbook и нажмите кнопку **Импорт** на странице **Просмотр исходного кода** .

5. Нажмите кнопку **ОК**, чтобы импортировать runbook в учетную запись службы автоматизации.

   ![Импорт модуля runbook для настройки](media/enable-from-runbook/import-from-gallery.png)

6. На странице **Runbook** выберите Runbook **Enable-MultipleSolution** и нажмите кнопку **изменить**. В текстовом редакторе выберите  **опубликовать**.

7. При появлении запроса на подтверждение нажмите кнопку **Да** , чтобы опубликовать модуль Runbook.

## <a name="start-the-runbook"></a>Запуск модуля runbook

Для запуска модуля runbook необходимо включить функцию "Отслеживание изменений и инвентаризация" для виртуальной машины Azure. Для настройки одной или нескольких виртуальных машин в Целевой группе ресурсов требуется существующая виртуальная машина и группа ресурсов с включенной функцией.

1. Откройте runbook с именем **Enable-MultipleSolution**.

   ![Модуль runbook для нескольких решений](media/enable-from-runbook/runbook-overview.png)

2. Нажмите кнопку "Пуск" и введите значения параметров в следующих полях:

   * **VMNAME** — имя существующей виртуальной машины, добавляемой в Отслеживание изменений и инвентаризацию. Оставьте это поле пустым, чтобы добавить все виртуальные машины в группе ресурсов.
   * **VMRESOURCEGROUP** — имя группы ресурсов для включения виртуальных машин.
   * **SUBSCRIPTIONID** — идентификатор подписки новой включаемой виртуальной машины. Оставьте это поле пустым, чтобы использовать подписку рабочей области. При использовании другого идентификатора подписки добавьте учетную запись запуска для учетной записи службы автоматизации в качестве участника подписки.
   * **ALREADYONBOARDEDVM** — имя виртуальной машины, которая уже включена вручную для обновлений.
   * **ALREADYONBOARDEDVMRESOURCEGROUP** — имя группы ресурсов, в которую входит виртуальная машина.
   * **SOLUTIONTYPE** — введите **ChangeTracking** (Отслеживание изменений).

   ![Параметры модуля runbook Enable-MultipleSolution](media/enable-from-runbook/runbook-parameters.png)

3. Выберите **ОК**, чтобы выполнить задание runbook.

4. Отслеживайте ход выполнения задания Runbook и всех ошибок на странице **задания** .

## <a name="next-steps"></a>Дальнейшие действия

* Сведения о планировании выполнения модуля runbook см. в статье [Управление расписаниями в службе автоматизации Azure](../shared-resources/schedules.md).

* Дополнительные сведения о работе с этой функцией см. в статье Управление [инвентаризацией](manage-inventory-vms.md)в [Отслеживание изменений](manage-change-tracking.md) и управление ими.

* Сведения об устранении общих проблем в работе этой функции см. в статье [Устранение неполадок с Отслеживанием изменений и инвентаризацией](../troubleshoot/change-tracking.md).


