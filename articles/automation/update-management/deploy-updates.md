---
title: Создание развертываний обновлений для службы автоматизации Azure Управление обновлениями
description: В этой статье описывается, как запланировать развертывания обновлений и просматривать их состояние.
services: automation
ms.subservice: update-management
ms.date: 12/09/2020
ms.topic: conceptual
ms.openlocfilehash: 1b5ced7038f692046d1ce4ba2f4599cae3962510
ms.sourcegitcommit: 484f510bbb093e9cfca694b56622b5860ca317f7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/21/2021
ms.locfileid: "98632467"
---
# <a name="how-to-deploy-updates-and-review-results"></a>Развертывание обновлений и результатов проверки

В этой статье описывается, как запланировать развертывание обновлений и просматривать процесс после завершения развертывания. Вы можете настроить развертывание обновлений из выбранной виртуальной машины Azure, с выбранного сервера с поддержкой Arc или из учетной записи службы автоматизации на всех настроенных компьютерах и серверах.

В каждом сценарии создается развертывание, предназначенное для выбранного компьютера или сервера, или в случае создания развертывания из учетной записи службы автоматизации можно выбрать одну или несколько машин. При планировании развертывания обновлений с виртуальной машины Azure или сервера с поддержкой Arc действия выполняются так же, как и при развертывании из учетной записи службы автоматизации со следующими исключениями.

* Операционная система автоматически выбирается в соответствии с ОС компьютера.
* Целевой компьютер для обновления настроен для автоматического назначения
* При настройке расписания можно указать **обновление сейчас**, выполняется один раз или использует повторяющееся расписание.

## <a name="sign-in-to-the-azure-portal"></a>Вход на портал Azure

Войдите на [портал Azure](https://portal.azure.com)

## <a name="schedule-an-update-deployment"></a>Планирование развертывания обновлений

При планировании развертывания обновлений создается ресурс [расписания](../shared-resources/schedules.md) , связанный с модулем **установки Patch-микрософтомскомпутерс** , который обрабатывает развертывание обновлений на целевом компьютере или компьютерах. Для установки обновлений задайте расписание развертывания, соответствующее вашему графику выпуска и периоду обслуживания. Вы можете выбрать типы обновлений, которые будут включены в развертывание. Например, можно включить критические обновления или обновление безопасности, а также исключить накопительные пакеты обновления.

>[!NOTE]
>Если вы удалите ресурс расписания с помощью портала Azure или PowerShell после создания развертывания, это приведет к прерыванию запланированного развертывания обновлений и ошибке при попытке повторной настройки ресурса расписания на портале. Ресурс расписания можно удалить только удалив соответствующее расписание развертывания.  

Чтобы запланировать новое развертывание обновлений, выполните следующие действия. В зависимости от выбранного ресурса (то есть учетная запись службы автоматизации, сервер с поддержкой Arc, виртуальная машина Azure) приведенные ниже действия применяются ко всем с незначительными различиями во время настройки расписания развертывания.

1. На портале, чтобы запланировать развертывание для:

   * Один или несколько компьютеров, перейдите к **учетным записям службы автоматизации** и выберите учетную запись службы автоматизации с Управление обновлениями включенным в списке.
   * Для виртуальной машины Azure перейдите к **виртуальным машинам** и выберите виртуальную машину из списка.
   * Для сервера с поддержкой Arc перейдите к разделу **серверы — дугу Azure** и выберите сервер из списка.

2. В зависимости от выбранного ресурса для перехода к Управление обновлениями:

   * Если вы выбрали учетную запись службы автоматизации, перейдите в раздел **Управление обновлениями** в разделе **Управление обновлениями**, а затем выберите **запланировать развертывание обновлений**.
   * Если вы выбрали виртуальную машину Azure, перейдите в раздел **Гостевые и обновления узла**, а затем выберите **Переход к Управление обновлениями**.
   * Если выбран сервер с поддержкой Arc, перейдите в **Управление обновлениями**, а затем выберите **запланировать развертывание обновлений**.

3. В разделе **новое развертывание обновлений** в поле **имя** введите уникальное имя для развертывания.

4. Выберите операционную систему для развертывания обновлений.

    > [!NOTE]
    > Этот параметр недоступен, если выбрана виртуальная машина Azure или сервер с поддержкой ARC. Операционная система определяется автоматически.

5. В области **группы для обновления** укажите запрос, который сочетает подписку, группы ресурсов, расположения и теги, чтобы создать динамическую группу виртуальных машин Azure для включения в развертывание. Узнайте, [как использовать динамические группы с Управлением обновлениями](configure-groups.md).

    > [!NOTE]
    > Этот параметр недоступен, если выбрана виртуальная машина Azure или сервер с поддержкой ARC. Компьютер автоматически предназначен для запланированного развертывания.

6. В области **Обновляемые компьютеры** выберите сохраненный поисковый запрос, импортированную группу либо нажмите в раскрывающемся меню пункт **Компьютеры** и укажите нужные компьютеры. Так вы сможете проверить готовность агента Log Analytics для каждого компьютера. Дополнительные сведения о различных способах создания групп компьютеров в журналах Azure Monitor см. в статье [Группы компьютеров в запросах к журналам Azure Monitor](../../azure-monitor/platform/computer-groups.md). Можно включить не более 1000 компьютеров в запланированное развертывание обновлений.

    > [!NOTE]
    > Этот параметр недоступен, если выбрана виртуальная машина Azure или сервер с поддержкой ARC. Компьютер автоматически предназначен для запланированного развертывания.

7. В области **Классификации обновлений** укажите [классификации обновлений](view-update-assessments.md#work-with-update-classifications) продуктов. Для каждого продукта отмените выбор всех поддерживаемых классификаций обновлений, кроме тех, которые нужно включить в развертывание обновлений.

    Если развертывание предполагает применение только выбранного набора обновлений, необходимо отменить выбор всех предварительно выбранных классификаций обновлений при настройке параметра **включить или исключить обновления** , как описано в следующем шаге. Это гарантирует, что на целевых компьютерах будут установлены только те обновления, которые вы указали для *включения* в это развертывание.

8. Используйте регион " **включить или исключить обновления** ", чтобы добавить или исключить выбранные обновления из развертывания. На странице **включение/исключение** введите идентификаторы статей базы знаний, которые будут включены или исключены для обновлений Windows. Для поддерживаемых дистрибутивов Linux укажите имя пакета.

   > [!IMPORTANT]
   > Помните: исключения переопределяют включения. Например, если вы определите правило исключения `*`, решение "Управление обновлениями" не установит ни одного исправления и пакета, так как они все будут исключены. Исключенные исправления будут отображаться как отсутствующие на компьютере. На компьютерах под управлением Linux: если вы включите пакет с зависимым пакетом, который был исключен, решение "Управление обновлениями" не установит основной пакет.

   > [!NOTE]
   > Замененные обновления нельзя включать в развертывание.

9. Выберите **Параметры расписания**. Время начала по умолчанию — на 30 минут позднее текущего времени. В будущем можно изменить время начала на любое другое начиная с 10 минут.

    > [!NOTE]
    > Этот параметр отличается, если выбран сервер с поддержкой ARC. В будущем можно выбрать **обновление сейчас** или время начала в 20 минут.

10. Используйте **повторение** , чтобы указать, происходит ли развертывание один раз или использует повторяющееся расписание, а затем нажмите кнопку **ОК**.

11. В области **Предварительные сценарии + после скриптов** выберите скрипты, которые должны выполняться до и после развертывания. Узнайте, [как управлять сценариями предварительного и последующего выполнения](pre-post-scripts.md).

12. В поле **Период обслуживания (минуты)** укажите, сколько времени может длиться установка обновлений. При указании периода обслуживания учитывайте следующие особенности.

    * Период обслуживания определяет количество устанавливаемых обновлений.
    * Решение "Управление обновлениями" не останавливает установку новых обновлений, если приближается окончание периода обслуживания.
    * Решение "Управление обновлениями" не прекращает выполняющиеся обновления, если время периода обслуживания истекло. Попытки установки оставшихся обновлений не будут выполняться. Если это происходит постоянно, следует повторно оценить длительность периода обслуживания.
    * Если период обслуживания в Windows превышен, это часто обусловлено тем, что установка пакета обновления занимает много времени.

    > [!NOTE]
    > Чтобы обновления применялись в Ubuntu только в период обслуживания, отключите в пакете `Unattended-Upgrade` автоматическое обновление. Инструкции по настройке пакета см. в разделе [Автоматические обновления](https://help.ubuntu.com/lts/serverguide/automatic-updates.html) руководства по Ubuntu Server.

13. В поле **Параметры перезагрузки** укажите, нужно ли перезагружать компьютеры при развертывании обновлений. Доступны следующие варианты: 
    * Reboot if necessary (Перезагружать при необходимости) (по умолчанию).
    * Всегда выполнять перезагрузку
    * Никогда не перезагружать
    * Только перезагрузка (без установки обновлений)

    > [!NOTE]
    > Разделы реестра, перечисленные в разделе [Registry keys used to manage restart](/windows/deployment/update/waas-restart#registry-keys-used-to-manage-restart) (Разделы реестра, используемые для управления перезапуском), могут вызвать событие перезагрузки, даже если для **параметров перезагрузки** установлено значение **Никогда не перезагружать**.

14. Завершив настройку расписания развертывания, нажмите кнопку **создать**.

    ![Панель параметров расписания обновлений](./media/deploy-updates/manageupdates-schedule-win.png)

    > [!NOTE]
    > Завершив настройку расписания развертывания для выбранного сервера с поддержкой Arc, выберите **проверить и создать**.

15. Вы вернетесь к панели мониторинга состояния. Выберите пункт **расписания развертывания** , чтобы отобразить созданное расписание развертывания. В списке отображается не более 500 расписаний. Если у вас более 500 расписаний и вы хотите просмотреть полный список, см. метод REST API [списка конфигураций обновлений программного обеспечения](/rest/api/automation/softwareupdateconfigurations/list) . Укажите API версии 2019-06-01 или более поздней.

## <a name="schedule-an-update-deployment-programmatically"></a>Программное планирование развертывания обновлений

Чтобы узнать, как создать развертывание обновлений с помощью REST API, ознакомьтесь со статьей [Software Update Configurations — Create](/rest/api/automation/softwareupdateconfigurations/create) (Конфигурации обновления программного обеспечения. Создание).

Развертывание еженедельного обновления можно создать с помощью примера модуля runbook. Дополнительные сведения об этом модуле runbook см. в статье [Create a weekly update deployment for one or more VMs in a resource group](https://github.com/azureautomation/create-a-weekly-update-deployment-for-one-or-more-vms-in-a-resource-group) (Создание развертывания еженедельного обновления для одной или нескольких виртуальных машин в группе ресурсов).

## <a name="check-deployment-status"></a>Проверка состояния развертывания

После запуска запланированного развертывания можно просмотреть его состояние на вкладке " **Журнал** " в разделе " **Управление обновлениями**". Во время выполнения развертывания отображается состояние **Выполняется**. Когда развертывание успешно завершится, состояние изменится на **Выполнено**. Если в развертывании возникают сбои с одним или несколькими обновлениями, состояние **не** выполняется.

## <a name="view-results-of-a-completed-update-deployment"></a>Просмотр результатов выполненного развертывания обновлений

После завершения развертывания можно выбрать его, чтобы увидеть его результаты.

[![Обновить панель мониторинга состояния развертывания для определенного развертывания](./media/deploy-updates/manageupdates-view-results.png)](./media/deploy-updates/manageupdates-view-results-expanded.png#lightbox)

В разделе **Результаты обновления** содержится сводная информация об общем количестве обновлений и результатах их развертывания на целевых виртуальных машинах. В таблице справа представлена подробная информация о каждом обновлении и результатах его установки.

Возможные значения:

* **Попытка не предпринималась**. Обновление не установлено из-за недостатка времени (т. е. слишком короткого периода обслуживания).
* **Не выбрано**. Обновление не включено в развертывание.
* **Выполнено**. Обновление успешно установлено.
* **Сбой**. Обновление не удалось установить.

Чтобы просмотреть все записи журнала, созданные при этом развертывании, выберите **Все журналы**.

Чтобы просмотреть поток заданий для модуля runbook, который управляет развертыванием обновлений на целевых виртуальных машинах, выберите **Выходные данные**.

Чтобы просмотреть подробные сведения об ошибках развертывания, выберите **Ошибки**.

## <a name="next-steps"></a>Дальнейшие действия

* Сведения о создании оповещений о результатах развертывания обновлений см. в статье [Создание оповещений для управление обновлениями](configure-alerts.md).
* Дополнительные сведения см. в статье [Устранение неполадок с Управлением обновлениями](../troubleshoot/update-management.md).
