---
title: Перемещение учетной записи службы автоматизации Azure в другую подписку
description: Узнайте, как переместить учетную запись службы автоматизации в другую подписку.
services: automation
ms.service: automation
ms.subservice: process-automation
author: mgoedtel
ms.author: magoedte
ms.date: 03/11/2019
ms.topic: conceptual
manager: carmonm
ms.openlocfilehash: 8454c5a5bb5b44d2a60ae0095a9b82a19ed27c8d
ms.sourcegitcommit: 100390fefd8f1c48173c51b71650c8ca1b26f711
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/27/2021
ms.locfileid: "98896652"
---
# <a name="move-your-azure-automation-account-to-another-subscription"></a>Перемещение учетной записи службы автоматизации Azure в другую подписку

Служба автоматизации Azure позволяет перемещать некоторые ресурсы в новую группу ресурсов или подписку. Ресурсы можно перемещать с помощью портала Azure, PowerShell, Azure CLI или REST API. См. сведения в статье [Перемещение ресурсов в новую группу ресурсов или подписку](../../azure-resource-manager/management/move-resource-group-and-subscription.md).

Учетная запись службы автоматизации — это один из ресурсов, который можно переместить. Из этой статьи вы узнаете, как переместить учетные записи службы автоматизации в другой ресурс или подписку. Общие действия по перемещению учетной записи службы автоматизации:

1. Отключение компонентов.
2. Отключение рабочей области.
3. Перемещение учетной записи службы автоматизации.
4. Удаление и повторное создание учетных записей запуска от имени.
5. Повторное включение компонентов.

## <a name="remove-features"></a>Удаление компонентов

Чтобы отключить рабочую область от учетной записи службы автоматизации, необходимо удалить следующие ресурсы компонентов в этой рабочей области:

- Отслеживание изменений и инвентаризация
- Управление обновлениями
- Запуск и остановка виртуальных машин в нерабочее время

1. Найдите группу ресурсов на портале Azure.
2. Найдите каждый компонент и щелкните **Удалить** на странице **Удаление ресурсов**.

    ![Снимок экрана: удаление ресурсов компонентов на портале Azure](../media/move-account/delete-solutions.png)

Кроме того, ресурсы можно удалить с помощью командлета [Remove-AzResource](/powershell/module/Az.Resources/Remove-AzResource).

```azurepowershell-interactive
$workspaceName = <myWorkspaceName>
$resourceGroupName = <myResourceGroup>
Remove-AzResource -ResourceType 'Microsoft.OperationsManagement/solutions' -ResourceName "ChangeTracking($workspaceName)" -ResourceGroupName $resourceGroupName
Remove-AzResource -ResourceType 'Microsoft.OperationsManagement/solutions' -ResourceName "Updates($workspaceName)" -ResourceGroupName $resourceGroupName
Remove-AzResource -ResourceType 'Microsoft.OperationsManagement/solutions' -ResourceName "Start-Stop-VM($workspaceName)" -ResourceGroupName $resourceGroupName
```

### <a name="remove-alert-rules-for-startstop-vms-during-off-hours"></a>Удаление правил генерации оповещений для Запуска и остановки виртуальных машин в нерабочее время

Для Запуска и остановки виртуальных машин в нерабочее время также необходимо удалить правила генерации оповещений, созданные компонентом.

1. На портале Azure перейдите к группе ресурсов и выберите **Мониторинг** > **Оповещения** > **Управление правилами генерации оповещений**.

   ![Снимок экрана: страница "Оповещения" с разделом "Управление правилами генерации оповещений"](../media/move-account/alert-rules.png)

2. На странице "Правила" вы увидите список оповещений, настроенных в этой группе ресурсов. Этот компонент создает следующие правила:

    * AutoStop_VM_Child
    * ScheduledStartStop_Parent
    * SequencedStartStop_Parent

3. Выбирайте каждое правило по очереди и щелкайте **Удалить**.

    ![Снимок экрана: страница "Правила" с запросом на подтверждение удаления выбранных правил](../media/move-account/delete-rules.png)

    > [!NOTE]
    > Если на странице "Правила" не отображаются правила генерации оповещений, измените значение поля **Состояние** на **Отключено**, чтобы отобразить отключенные оповещения. 

4. При удалении правил генерации оповещений необходимо удалить группу действий, созданную для уведомлений Запуска и остановки виртуальных машин в нерабочее время. На портале Azure выберите **Монитор** > **Оповещения** > **Управление группами действий**.

5. Выберите **StartStop_VM_Notification**. 

6. На странице "Группа действий" щелкните **Удалить**.

    ![Снимок экрана: страница "Группа действий"](../media/move-account/delete-action-group.png)

Кроме того, группу действий можно удалить с помощью командлета [Remove-AzActionGroup](/powershell/module/az.monitor/remove-azactiongroup).

```azurepowershell-interactive
Remove-AzActionGroup -ResourceGroupName <myResourceGroup> -Name StartStop_VM_Notification
```

## <a name="unlink-your-workspace"></a>Отключение рабочей области

Теперь вы можете отключить рабочую область.

1. На портале Azure выберите **Учетная запись службы автоматизации** > **Связанные ресурсы** > **Связанная рабочая область**. 

2. Щелкните **Отменить связь с рабочей областью**, чтобы отключить рабочую область от учетной записи службы автоматизации.

    ![Снимок экрана: отключение рабочей области от учетной записи службы автоматизации](../media/move-account/unlink-workspace.png)

## <a name="move-your-automation-account"></a>Перемещение учетной записи службы автоматизации

Теперь вы можете переместить учетную запись службы автоматизации и ее последовательности runbook. 

1. На портале Azure перейдите к группе ресурсов учетной записи службы автоматизации. Выберите **Переместить** > **Переместить в другую подписку**.

    ![Снимок экрана: страница "Группа ресурсов" с перемещением в другую подписку](../media/move-account/move-resources.png)

2. В группе ресурсов выберите ресурсы, которые нужно переместить. Убедитесь, что вы включили учетную запись службы автоматизации, последовательности runbook и ресурсы рабочей области Log Analytics.

## <a name="re-create-run-as-accounts"></a>Повторное создание учетных записей запуска от имени

[Учетные записи запуска от имени](../manage-runas-account.md) создают субъект-службу в Azure Active Directory для аутентификации в ресурсах Azure. После изменения подписок учетная запись службы автоматизации не использует существующую учетную запись запуска от имени. Чтобы повторно создать учетные записи запуска от имени, сделайте следующее.

1. Перейдите к учетной записи службы автоматизации в новой подписке и выберите **Учетные записи запуска от имени** в разделе **Параметры учетной записи**. Вы увидите, что учетные записи запуска от имени отображаются как незавершенные.

    ![Снимок экрана: учетные записи запуска от имени, которые отображаются как незавершенные](../media/move-account/run-as-accounts.png)

2. Поочередно удалите учетные записи запуска от имени, выбрав **Удалить** на странице **Свойства**. 

    > [!NOTE]
    > Если у вас нет разрешений на создание или просмотр учетных записей запуска от имени, отобразится следующее сообщение: `You do not have permissions to create an Azure Run As account (service principal) and grant the Contributor role to the service principal.` См. сведения в разделе [Разрешения учетной записи запуска от имени](../manage-runas-account.md#permissions).

3. После удаления учетных записей запуска от имени выберите **Создать** в разделе **Учетная запись запуска от имени Azure**. 

4. На странице "Добавление учетной записи запуска от имени Azure" выберите **Создать**, чтобы создать учетную запись запуска от имени и субъект-службу. 

5. Повторите описанные выше действия с классической учетной записью запуска от имени Azure.

## <a name="enable-features"></a>Включение компонентов

После повторного создания учетных записей запуска от имени необходимо повторно включить компоненты, удаленные перед перемещением.

1. Чтобы включить Отслеживание изменений и инвентаризацию, выберите элемент **Отслеживание изменений и Инвентаризация** в учетной записи службы автоматизации. Выберите рабочую область Log Analytics, которую вы переместили, и щелкните **Включить**.

2. Повторите шаг 1 для Управления обновлениями.

    ![Снимок экрана: повторное включение компонентов в перемещенной учетной записи службы автоматизации](../media/move-account/reenable-solutions.png)

3. Компьютеры с включенными компонентами будут отображаться при подключении к существующей рабочей области Log Analytics. Вам также нужно повторно включить Запуск и остановку виртуальных машин в нерабочее время. В разделе **Связанные ресурсы** выберите **Запуск и остановка виртуальных машин** > **Дополнительные сведения и включение решения** > **Создать**, чтобы начать развертывание.

4. На странице "Добавление решения" выберите рабочую область Log Analytics и учетную запись службы автоматизации.

    ![Снимок экрана: меню "Добавить решение"](../media/move-account/add-solution-vm.png)

5. Настройте компонент, как описано в статье [Общие сведения о Запуске и остановке виртуальных машин в нерабочее время](../automation-solution-vm-management.md).

## <a name="verify-the-move"></a>Проверка перемещения

После завершения перемещения убедитесь, что включены следующие компоненты. 

|Функция|Тесты|Устранение неполадок|
|---|---|---|
|Модули runbook|Последовательность runbook можно запустить и подключить к ресурсам Azure.|[Устранение неполадок с модулями Runbook](../troubleshoot/runbooks.md)
|Система управления версиями|Вы можете выполнить синхронизацию вручную в репозитории системы управления версиями.|[Интеграция системы управления версиями](../source-control-integration.md)|
|Отслеживание изменений и инвентаризация|Убедитесь, что вы видите текущие данные инвентаризации с ваших компьютеров.|[Устранение неполадок с Отслеживанием изменений](../troubleshoot/change-tracking.md)|
|Управление обновлениями|Убедитесь, что вы видите свои компьютеры и что они работоспособны.</br>Запустите тестовое развертывание обновлений программного обеспечения.|[Устранение неполадок с Управлением обновлениями](../troubleshoot/update-management.md)|
|Общие ресурсы|Убедитесь, что вы видите все общие ресурсы, такие как [учетные данные](../shared-resources/credentials.md) и [переменные](../shared-resources/variables.md).|

## <a name="next-steps"></a>Дальнейшие действия

См. сведения в статье [Поддержка операции перемещения для ресурсов](../../azure-resource-manager/management/move-support-resources.md).
