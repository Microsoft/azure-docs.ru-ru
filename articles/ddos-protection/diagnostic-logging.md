---
title: Стандартные отчеты и журналы потоков для защиты Azure от атак DDoS
description: Узнайте, как настроить отчеты и журналы потоков.
services: ddos-protection
documentationcenter: na
author: yitoh
ms.service: ddos-protection
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 12/28/2020
ms.author: yitoh
ms.openlocfilehash: 22c49502883cb444027bd59a24bfb5bb3c32da4c
ms.sourcegitcommit: 67b44a02af0c8d615b35ec5e57a29d21419d7668
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/06/2021
ms.locfileid: "97915170"
---
# <a name="view-and-configure-ddos-diagnostic-logging"></a>Просмотр и настройка журнала диагностики атак DDoS

Защита от атак DDoS Azure (цен. категория "Стандартный") обеспечивает подробные сведения об атаках и визуализацию с помощью аналитики атак DDoS. Клиенты, защищающие виртуальные сети от атак DDoS, могут просматривать подробные сведения о трафике атаки и действиях, предпринятых для устранения атак, благодаря отчетам об устранении рисков атак и журналам потоков устранения рисков. Расширенные телеметрические данные предоставляются через Azure Monitor включая подробные метрики в течение от атак DDoS атаки. Предупреждения можно настроить для любой метрики Azure Monitor, предоставленной с помощью службы "Защита от атак DDoS". Ведение журнала может быть дополнительно интегрировано с [Azure Sentinel](../sentinel/connect-azure-ddos-protection.md), Splunk (концентраторы событий Azure), OMS log Analytics и хранилищем Azure для расширенного анализа через интерфейс диагностики Azure Monitor.

Следующие журналы диагностики доступны для стандарта защиты Azure от атак DDoS. 

- **Ддоспротектионнотификатионс**: уведомления сообщают вам каждый раз, когда ресурс общедоступного IP-адреса будет находиться под угрозой, а также когда защита от атак будет запущена.
- **Ддосмитигатионфловлогс**. журналы потоков для предотвращения атак позволяют просматривать удаленный трафик, перенаправленный трафик и другие интересные точки данных во время активной атаки от атак DDoS в ближайшем режиме реального времени. Вы можете передать постоянный поток этих данных в метку Azure или в сторонние системы SIEM с помощью концентратора событий для мониторинга практически в реальном времени. для этого выполните возможные действия и устраните необходимость в операциях защиты.
- **Ддосмитигатионрепортс**. отчеты по предотвращению атак используют данные протокола NetFlow, которые суммируются для предоставления подробных сведений об атаках на ресурс. Каждый раз, когда ресурс общедоступного IP-адреса подвергается атаке, начинается устранение рисков и создание отчетов. Каждые 5 минут создается добавочный отчет, кроме того, после устранения рисков создается отчет за весь период устранения. Это гарантирует, что в случае продолжительной атаки DDoS каждые 5 минут можно будет просмотреть наиболее актуальный моментальный снимок отчета об устранении рисков, а после устранения рисков атаки будет доступна полная сводка. 
- **Аллметрикс**: предоставляет все возможные метрики, доступные в течение срока действия от атак DDoS атаки. 

Из этого руководства вы узнаете, как выполнять следующие задачи:

> [!div class="checklist"]
> * Настройте журналы диагностики от атак DDoS, включая уведомления, отчеты об устранении рисков и журналы потоков для устранения рисков. 
> * Включите ведение журнала диагностики для всех общедоступных IP-адресов в определенной области.
> * Просмотр данных журнала в книгах.

## <a name="prerequisites"></a>Предварительные требования

- Если у вас еще нет подписки Azure, [создайте бесплатную учетную запись](https://azure.microsoft.com/free/?WT.mc_id=A261C142F), прежде чем начинать работу.
- Перед выполнением действий, описанных в этом руководстве, необходимо сначала создать [план защиты Azure от атак DDoS Standard](manage-ddos-protection.md) , а для виртуальной сети должен быть включен стандарт защиты от атак DDoS.
- Служба защиты от атак DDoS отслеживает общедоступные IP-адреса, которые назначаются ресурсам в виртуальной сети. При отсутствии в виртуальной сети ресурсов с общедоступными IP-адресами необходимо сначала создать ресурс с общедоступным IP-адресом. Вы можете отслеживать общедоступный IP-адрес всех ресурсов, развернутых с помощью диспетчер ресурсов (не классической), перечисленных в [виртуальной сети для служб Azure](../virtual-network/virtual-network-for-azure-services.md#services-that-can-be-deployed-into-a-virtual-network) (включая подсистемы балансировки нагрузки Azure, в которых внутренние виртуальные машины находятся в виртуальной сети), за исключением сред службы приложений Azure. Чтобы продолжить работу с этим руководством, можно быстро создать виртуальную машину [Windows](../virtual-machines/windows/quick-create-portal.md?toc=%2fazure%2fvirtual-network%2ftoc.json) или [Linux](../virtual-machines/linux/quick-create-portal.md?toc=%2fazure%2fvirtual-network%2ftoc.json).    

## <a name="configure-ddos-diagnostic-logs"></a>Настройка журналов диагностики от атак DDoS

Если вы хотите автоматически включить ведение журнала диагностики для всех общедоступных IP-адресов в среде, перейдите к [включению ведения журнала диагностики на всех общедоступных IP](#enable-diagnostic-logging-on-all-public-ips)-адресах.

1. В левой верхней части портала выберите **Все службы**.
2. Введите *Monitor* в поле **Фильтр**. Когда в результатах поиска появится элемент **Monitor**, щелкните его.
3. В разделе **Параметры** выберите **параметры диагностики**.
4. Выберите **подписку** и **группу ресурсов**, содержащую общедоступный IP-адрес, для которого требуется вести журнал.
5. Выберите **общедоступный IP-адрес** для **типа ресурса**, а затем выберите КОНКРЕТНЫЙ общедоступный IP-адрес, для которого нужно включить журналы.
6. Выберите **Добавить параметр диагностики**. В разделе **сведения о категории** выберите требуемое количество вариантов, а затем нажмите кнопку **сохранить**.

    ![Параметры диагностики от атак DDoS](./media/ddos-attack-telemetry/ddos-diagnostic-settings.png)

7. В разделе **сведения о назначении** выберите столько из следующих параметров, сколько требуется:

    - **Archive to a storage account** (Архивация в учетную запись хранения). Запись данных в учетную запись хранения Azure. Дополнительные сведения об этом параметре см. в разделе [архивирование журналов ресурсов](../azure-monitor/platform/resource-logs.md?toc=%2fazure%2fvirtual-network%2ftoc.json#send-to-azure-storage).
    - **Stream to an event hub** (Потоковая передача в концентратор событий). Позволяет получателю журнала принимать журналы с помощью концентратора событий Azure. Центры событий обеспечивают интеграцию со Splunk или другими системами SIEM. Дополнительные сведения об этом параметре см. в статье [потоковая передача журналов ресурсов в концентратор событий](../azure-monitor/platform/resource-logs.md?toc=%2fazure%2fvirtual-network%2ftoc.json#send-to-azure-event-hubs).
    - **Send to log Analytics**: записывает журналы в службу Azure Monitor. Дополнительные сведения об этом параметре см. [в разделе Получение журналов для использования в журналах Azure Monitor](../azure-monitor/platform/resource-logs.md?toc=%2fazure%2fvirtual-network%2ftoc.json#send-to-log-analytics-workspace).

### <a name="log-schemas"></a>Схемы журналов

В следующей таблице перечислены имена и описания полей.

# <a name="ddosprotectionnotifications"></a>[DDoSProtectionNotifications](#tab/DDoSProtectionNotifications)

| Имя поля | Описание |
| --- | --- |
| **TimeGenerated** | Дата и время создания уведомления в формате UTC. |
| **ResourceId** | Идентификатор ресурса общедоступного IP-адреса. |
| **Категория** | Для уведомлений это будет `DDoSProtectionNotifications` .|
| **ResourceGroup** | Группа ресурсов, содержащая общедоступный IP-адрес и виртуальную сеть. |
| **Подписки** | Идентификатор подписки плана защиты от атак DDoS. |
| **Ресурс** | Имя общедоступного IP-адреса. |
| **ResourceType** | Это всегда будет `PUBLICIPADDRESS` . |
| **OperationName** | Для уведомлений это будет `DDoSProtectionNotifications` .  |
| **Message** | Сведения об атаке. |
| **Тип** | Тип уведомления. Возможные значения: `MitigationStarted` . `MitigationStopped`. |
| **PublicIpAddress** | Ваш общедоступный IP-адрес. |

# <a name="ddosmitigationflowlogs"></a>[DDoSMitigationFlowLogs](#tab/DDoSMitigationFlowLogs)

| Имя поля | Описание |
| --- | --- |
| **TimeGenerated** | Дата и время (в формате UTC) создания журнала потоков. |
| **ResourceId** | Идентификатор ресурса общедоступного IP-адреса. |
| **Категория** | Для журналов потоков это будет `DDoSMitigationFlowLogs` .|
| **ResourceGroup** | Группа ресурсов, содержащая общедоступный IP-адрес и виртуальную сеть. |
| **Подписки** | Идентификатор подписки плана защиты от атак DDoS. |
| **Ресурс** | Имя общедоступного IP-адреса. |
| **ResourceType** | Это всегда будет `PUBLICIPADDRESS` . |
| **OperationName** | Для журналов потоков это будет `DDoSMitigationFlowLogs` . |
| **Message** | Сведения об атаке. |
| **саурцепублиЦипаддресс** | Общедоступный IP-адрес клиента, который создает трафик на общедоступный IP-адрес. |
| **SourcePort** | Номер порта в диапазоне от 0 до 65535. |
| **дестпублиЦипаддресс** | Ваш общедоступный IP-адрес. |
| **дестпорт** | Номер порта в диапазоне от 0 до 65535. |
| **протокол**; | Тип протокола. Возможные значения: `tcp` , `udp` , `other` .|

# <a name="ddosmitigationreports"></a>[DDoSMitigationReports](#tab/DDoSMitigationReports)

| Имя поля | Описание |
| --- | --- |
| **TimeGenerated** | Дата и время создания отчета в формате UTC. |
| **ResourceId** | Идентификатор ресурса общедоступного IP-адреса. |
| **Категория** | Для уведомлений это будет `DDoSProtectionNotifications` .|
| **ResourceGroup** | Группа ресурсов, содержащая общедоступный IP-адрес и виртуальную сеть. |
| **Подписки** | Идентификатор подписки плана защиты от атак DDoS. |
| **Ресурс** | Имя общедоступного IP-адреса. |
| **ResourceType** | Это всегда будет `PUBLICIPADDRESS` . |
| **OperationName** | Для отчетов об устранении рисков это будет `DDoSMitigationReports` . |
| **ReportType** | Возможные значения: `Incremental` , `PostMitigation` .|
| **митигатионпериодстарт** | Дата и время (в формате UTC) начала устранения рисков.  |
| **митигатионпериоденд** | Дата и время (в формате UTC) окончания устранения рисков. |
| **IPAddress** | Ваш общедоступный IP-адрес. |
| **аттакквекторс** |  Разделение типов атак. Ключи включают `TCP SYN flood` , `TCP flood` , `UDP flood` , `UDP reflection` , `Other packet flood` .|
| **траффиковервиев** |  Разделение трафика атаки. Ключи включают `Total packets` , `Total packets dropped` , `Total TCP packets` , `Total TCP packets dropped` , `Total UDP packets` , `Total UDP packets dropped` , `Total Other packets` , `Total Other packets dropped` . |
| **Протоколы** | Разделение используемых протоколов. Ключи включают `TCP` , `UDP` , `Other` . |
| **дропреасонс** | Разделение причин отброшенных пакетов. Ключи включают `Protocol violation invalid TCP syn` , `Protocol violation invalid TCP` , `Protocol violation invalid UDP` , `UDP reflection` , `TCP rate limit exceeded` , `UDP rate limit exceeded` , `Destination limit exceeded` , `Other packet flood` , `Rate limit exceeded` , `Packet was forwarded to service` . |
| **топсаурцекаунтриес** | Разделение первых 10 исходных стран входящего трафика. |
| **топсаурцекаунтриесфордроппедпаккетс** | Разбивка первых 10 исходных стран трафика атак, которые были устранены. |
| **топсаурцеаснс** | Разбивка первых 10 исходных номеров автономных систем (ASN) входящего трафика.  |
| **саурцеконтинентс** | Разделение исходного континента входящего трафика. |
***

## <a name="enable-diagnostic-logging-on-all-public-ips"></a>Включить ведение журнала диагностики на всех общедоступных IP-адресах

Этот [шаблон](https://github.com/Azure/Azure-Network-Security/tree/master/Azure%20DDoS%20Protection/Enable%20Diagnostic%20Logging/Azure%20Policy) создает определение политики Azure для автоматического включения ведения журнала диагностики для всех журналов общедоступных IP-адресов в определенной области.

[![Развертывание в Azure](../media/template-deployments/deploy-to-azure.svg)](https://portal.azure.com/#create/Microsoft.Template/uri/https%3A%2F%2Fraw.githubusercontent.com%2FAzure%2FAzure-Network-Security%2Fmaster%2FAzure%2520DDoS%2520Protection%2FEnable%2520Diagnostic%2520Logging%2FAzure%2520Policy%2FDDoSLogs.json)

## <a name="view-log-data-in-workbooks"></a>Просмотр данных журнала в книгах

### <a name="azure-sentinel-data-connector"></a>Соединитель данных Sentinel Azure

Вы можете подключить журналы к Azure Sentinel, просматривать и анализировать данные в книгах, создавать пользовательские оповещения и внедрять их в процессы исследования. Чтобы подключиться к Azure Sentinel, см. статью [Подключение к Azure Sentinel](../sentinel/connect-azure-ddos-protection.md). 

![Соединитель от атак DDoS Azure Sentinel](./media/ddos-attack-telemetry/azure-sentinel-ddos.png)

### <a name="azure-ddos-protection-workbook"></a>Книга защиты от атак DDoS Azure

Этот шаблон Azure Resource Manager (ARM) можно использовать для развертывания книги анализа атак. Эта книга позволяет визуализировать данные атаки на нескольких фильтруемых панелях, чтобы легко понять, что находится на заявляйте. 

[![Развертывание в Azure](../media/template-deployments/deploy-to-azure.svg)](https://portal.azure.com/#create/Microsoft.Template/uri/https%3A%2F%2Fraw.githubusercontent.com%2FAzure%2FAzure-Network-Security%2Fmaster%2FAzure%2520DDoS%2520Protection%2FAzure%2520DDoS%2520Protection%2520Workbook%2FAzureDDoSWorkbook_ARM.json)

![Книга защиты от атак DDoS](./media/ddos-attack-telemetry/ddos-attack-analytics-workbook.png)

## <a name="validate-and-test"></a>Проверка и тестирование

Сведения о моделировании от атак ddosной атаки для проверки журналов см. в разделе [Проверка обнаружения от атак DDoS](test-through-simulations.md).

## <a name="next-steps"></a>Дальнейшие действия

В этом руководстве вы узнали, как выполнять следующие задачи:

- Настройте журналы диагностики от атак DDoS, включая уведомления, отчеты об устранении рисков и журналы потоков для устранения рисков. 
- Включите ведение журнала диагностики для всех общедоступных IP-адресов в определенной области.
- Просмотр данных журнала в книгах.

Чтобы узнать, как настроить оповещения об атаках, перейдите к следующему руководству.

> [!div class="nextstepaction"]
> [Просмотр и настройка оповещений защиты от атак DDoS](alerts.md)
