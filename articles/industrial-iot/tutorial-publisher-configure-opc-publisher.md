---
title: Настройка издателя Microsoft OPC
description: Из этого учебника вы узнаете, как настроить издатель OPC в автономном режиме.
author: jehona-m
ms.author: jemorina
ms.service: industrial-iot
ms.topic: tutorial
ms.date: 3/22/2021
ms.openlocfilehash: 4d4f9c90fd96365216480164f29f08fad92eb9d0
ms.sourcegitcommit: f611b3f57027a21f7b229edf8a5b4f4c75f76331
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/22/2021
ms.locfileid: "104787343"
---
# <a name="tutorial-configure-the-opc-publisher"></a>Учебник. Настройка издателя OPC

В этом учебнике содержатся сведения о конфигурации издателя OPC. Для его настройки можно использовать несколько интерфейсов.

В этом руководстве описано следующее.

> [!div class="checklist"]
> * Настройка издателя OPC с помощью файла конфигурации.
> * Настройка издателя OPC с помощью аргументов командной строки.
> * Настройка издателя OPC с помощью прямых методов Центра Интернета вещей.
> * Настройка издателя OPC с помощью облачной вспомогательной микрослужбы REST.

## <a name="configuring-security"></a>Настройка безопасности

IoT Edge предоставляет издатель OPC с конфигурацией безопасности для автоматического доступа к центру Интернета вещей. Издатель OPC также можно запустить в качестве автономного контейнера Docker, указав строку подключения устройства для доступа к центру Интернета вещей с помощью параметра `dc` командной строки. Устройство для центра Интернета вещей и полученную строку подключения можно создать на портале Azure.

Для доступа к ресурсам с поддержкой OPC UA используются сертификаты X.509 и связанные с ними закрытые ключи. Это называется проверкой подлинности приложения OPC UA, которая используется в дополнение к проверке подлинности пользователя OPC UA. Издатель OPC использует хранилище сертификатов на основе файловой системы для управления всеми сертификатами приложений. Во время запуска издатель OPC проверяет наличие сертификата, который можно использовать в этом хранилище сертификатов, и создает самозаверяющий сертификат и связанный закрытый ключ, если он отсутствует. Самозаверяющие сертификаты обеспечивают слабую проверку подлинности, так как они не подписаны доверенным центром сертификации, но по крайней мере таким образом можно зашифровать связь с ресурсом, поддерживающим OPC UA.

Безопасность включается в файле конфигурации с помощью флажка `"UseSecurity": true,`. Автоматически выбирается наиболее безопасная конечная точка, доступная на серверах OPC UA, к которой должен подключаться издатель OPC.
По умолчанию издатель OPC использует проверку подлинности анонимных пользователей (в дополнение к проверке подлинности приложения, описанной выше). Однако издатель OPC также поддерживает проверку подлинности пользователя, выполняемую с помощью имени пользователя и пароля. Это можно указать с помощью интерфейса конфигурации REST API (как описано ниже) или файла конфигурации следующим образом:
```
"OpcAuthenticationMode": "UsernamePassword",
"OpcAuthenticationUsername": "usr",
"OpcAuthenticationPassword": "pwd",
```
Кроме того, издатель OPC версии 2.5 и более ранних версий шифрует имя пользователя и пароль в файле конфигурации. Версия 2.6 и более поздние версии поддерживают только имя пользователя и пароль в виде открытого текста. Эта функциональность будет улучшена в следующей версии издателя OPC.

Чтобы сохранить конфигурацию безопасности издателя OPC во всех перезагрузках, сертификат и закрытый ключ, расположенные в каталоге хранилища сертификатов, необходимо сопоставить с файловой системой ОС узла IoT Edge. См. раздел "Указание параметров создания контейнера на портале Azure" выше.

## <a name="configuration-via-configuration-file"></a>Настройка с помощью файла конфигурации

Самый простой способ настроить издатель OPC — с помощью файла конфигурации. Пример файла конфигурации, а также документация, относящаяся к его формату, предоставлена в файле [`publishednodes.json`](https://raw.githubusercontent.com/Azure/iot-edge-opc-publisher/master/opcpublisher/publishednodes.json) в этом репозитории.
Синтаксис файла конфигурации был изменен с течением времени, а издатель OPC по-прежнему может читать старые форматы, но преобразует их в последний формат при сохранении конфигурации, регулярно выполняемой в автоматическом режиме.

Ниже показано, как выглядит файл базовой конфигурации.
```
[
  {
    "EndpointUrl": "opc.tcp://testserver:62541/Quickstarts/ReferenceServer",
    "UseSecurity": true,
    "OpcNodes": [
      {
        "Id": "i=2258",
        "OpcSamplingInterval": 2000,
        "OpcPublishingInterval": 5000,
        "DisplayName": "Current time"
      }
    ]
  }
]
```

Ресурсы OPC UA оптимизируют пропускную способность сети, отправляя изменения данных в издатель OPC только после их изменения. Если изменения данных необходимо публиковать чаще или через регулярные интервалы, издатель OPC поддерживает "пульс" для каждого настроенного элемента данных, который можно включить, дополнительно указав ключ HeartbeatInterval в конфигурации элемента данных. Значение интервала указывается в секундах.
```
 "HeartbeatInterval": 3600,
```

Ресурс OPC UA всегда отправляет текущее значение элемента данных при первом подключении издателя OPC. Чтобы предотвратить публикацию этих данных в Центре Интернета вещей, в конфигурации элемента данных можно дополнительно указать ключ SkipFirst:
```
 "SkipFirst": true,
```

Оба параметра можно включить глобально с помощью параметров командной строки.

## <a name="configuration-via-command-line-arguments"></a>Настройка с помощью аргументов командной строки

Существует несколько аргументов командной строки, которые можно использовать для настройки глобальных параметров для издателя OPC. Они [описаны тут](reference-command-line-arguments.md).


## <a name="configuration-via-the-built-in-opc-ua-server-interface"></a>Настройка с помощью встроенного интерфейса сервера OPC UA

>[!NOTE] 
> Эта функция доступна только в издателе OPC версии 2.5 и более ранних версий.**

Издатель OPC имеет встроенный сервер OPC UA, работающий через порт 62222. Он реализует три метода OPC UA:

  - PublishNode
  - UnpublishNode
  - GetPublishedNodes

Доступ к этому интерфейсу можно получить с помощью клиентского приложения OPC UA, например [UA Expert](https://www.unified-automation.com/products/development-tools/uaexpert.html).

## <a name="configuration-via-iot-hub-direct-methods"></a>Настройка с помощью прямых методов Центра Интернета вещей

>[!NOTE] 
> Эта функция доступна только в издателе OPC версии 2.5 и более ранних версий.**

Издатель OPC реализует следующие [прямые методы центра Интернета вещей](https://docs.microsoft.com/azure/iot-hub/iot-hub-devguide-direct-methods), которые можно вызывать из приложения (в любой части мира), используя [пакет SDK для устройств Центра Интернета вещей](https://docs.microsoft.com/azure/iot-hub/iot-hub-devguide-sdks):

  - PublishNodes
  - UnpublishNodes
  - UnpublishAllNodes
  - GetConfiguredEndpoints
  - GetConfiguredNodesOnEndpoint
  - GetDiagnosticInfo
  - GetDiagnosticLog
  - GetDiagnosticStartupLog
  - ExitApplication
  - GetInfo

Мы предоставили [пример приложения конфигурации](https://github.com/Azure-Samples/iot-edge-opc-publisher-nodeconfiguration), а также [приложение для чтения диагностических сведений](https://github.com/Azure-Samples/iot-edge-opc-publisher-diagnostics) из издателя OPC с открытым кодом, используя этот интерфейс.

## <a name="configuration-via-cloud-based-companion-rest-microservice"></a>Настройка с помощью облачной вспомогательной микрослужбы REST

>[!NOTE] 
> Эта функция доступна только в издателе OPC версии 2.6 и более поздних версий.**

Облачная вспомогательная микрослужба с интерфейсом REST описана и доступна на [этой странице](https://github.com/Azure/Industrial-IoT/blob/master/docs/services/publisher.md). Ее можно использовать для настройки издателя OPC через интерфейс, совместимый с OpenAPI, например с помощью Swagger.

## <a name="configuration-of-the-simple-json-telemetry-format-via-separate-configuration-file"></a>Настройка простого формата телеметрии JSON с помощью отдельного файла конфигурации

>[!NOTE] 
> Эта функция доступна только в издателе OPC версии 2.5 и более ранних версий.

Издатель OPC позволяет фильтровать части нестандартизованного простого формата телеметрии с помощью отдельного файла конфигурации, который можно указать с помощью параметра tc командной строки. Если файл конфигурации не указан, в Центр Интернета вещей отправляется полный формат телеметрии JSON. Формат отдельного файла конфигурации телеметрии описан на [этой странице](reference-opc-publisher-telemetry-format.md#opc-publisher-telemetry-configuration-file-format).

## <a name="next-steps"></a>Дальнейшие действия
Теперь, когда издатель OPC настроен, вы можете узнать, как настроить производительность и память модуля Edge:

> [!div class="nextstepaction"]
> [Настройка производительности и памяти](tutorial-publisher-performance-memory-tuning-opc-publisher.md)