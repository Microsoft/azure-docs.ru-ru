---
title: Мониторинг и просмотр журналов выполнения машинного обучения & метрики
titleSuffix: Azure Machine Learning
description: Отслеживайте эксперименты машинного обучения и просматривайте метрики запуска с помощью мини-приложений Jupyter и Машинное обучение Azure Studio.
services: machine-learning
author: likebupt
ms.author: keli19
ms.reviewer: peterlu
ms.service: machine-learning
ms.subservice: core
ms.date: 07/30/2020
ms.topic: conceptual
ms.custom: how-to
ms.openlocfilehash: 8b2a61a92a25e1c0da9f85439438e75969fcfbf0
ms.sourcegitcommit: b4647f06c0953435af3cb24baaf6d15a5a761a9c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/02/2021
ms.locfileid: "101661024"
---
# <a name="monitor-and-view-ml-run-logs-and-metrics"></a>Мониторинг и просмотр журналов и метрик выполнения машинного обучения

Узнайте, как отслеживать запуски Машинное обучение Azure и просматривать их журналы. 

При запуске эксперимента журналы и метрики передаются в потоке.  Кроме того, можно добавить собственные.  Чтобы узнать, как это сделать, см. раздел [Включение ведения журнала в учебных курсах машинного обучения Azure](how-to-track-experiments.md).

Журналы могут помочь в диагностике ошибок и предупреждений для выполнения. Метрики производительности, такие как параметры и точность модели, помогают отслеживать и отслеживать запуски.

В этой статье вы узнаете, как просматривать журналы с помощью следующих методов.

> [!div class="checklist"]
> * Мониторинг запусков в студии
> * Мониторинг запусков с помощью мини-приложения Jupyter Notebook
> * Мониторинг запуска автоматизированного машинного обучения
> * Просмотр журналов вывода после завершения
> * Просмотр журналов вывода в студии

Общие сведения об управлении экспериментами см. в статье [Запуск, мониторинг и отмена обучающих запусков](how-to-manage-runs.md).

## <a name="monitor-runs-using-the-jupyter-notebook-widget"></a>Мониторинг запусков с помощью мини-приложения записной книжки Jupyter

При использовании метода **скриптрунконфиг** для отправки запусков можно отслеживать ход выполнения с помощью мини-приложения [Jupyter](/python/api/azureml-widgets/azureml.widgets?preserve-view=true&view=azure-ml-py). Подобно представлению запуска, мини-приложение является асинхронным и предоставляет обновления в реальном времени каждые 10–15 секунд до завершения задания.

Просмотрите мини-приложения Jupyter во время ожидания завершения выполнения.
    
```python
from azureml.widgets import RunDetails
RunDetails(run).show()
```

![Снимок экрана. Мини-приложение записной книжки Jupyter](./media/how-to-track-experiments/run-details-widget.png)

Ссылку на это же отображение можно получить и в рабочей области.

```python
print(run.get_portal_url())
```

## <a name="monitor-automated-machine-learning-runs"></a>Мониторинг запуска автоматизированного машинного обучения

Для автоматического выполнения машинного обучения для доступа к диаграммам из предыдущего запуска замените на `<<experiment_name>>` имя соответствующего эксперимента:

```python
from azureml.widgets import RunDetails
from azureml.core.run import Run

experiment = Experiment (workspace, <<experiment_name>>)
run_id = 'autoML_my_runID' #replace with run_ID
run = Run(experiment, run_id)
RunDetails(run).show()
```

![Мини-приложение записной книжки Jupyter для автоматического машинного обучения](./media/how-to-track-experiments/azure-machine-learning-auto-ml-widget.png)

## <a name="show-output-upon-completion"></a>Показывать выходные данные после завершения

При использовании **ScriptRunConfig** можно указать ```run.wait_for_completion(show_output = True)```, чтобы узнать, когда обучение модели будет завершено. Флаг ```show_output``` предоставляет подробные выходные данные. Дополнительные сведения см. в разделе Скриптрунконфиг, [посвященном включению ведения журнала](how-to-track-experiments.md#scriptrun-logs).

<a id="queryrunmetrics"></a>

### <a name="logging-run-metrics"></a>Регистрация метрик запуска 

Используйте следующие методы в API ведения журнала, чтобы повлиять на визуализации метрик. Обратите внимание на [ограничения службы](https://docs.microsoft.com/azure/machine-learning/resource-limits-quotas-capacity#metrics) для этих зарегистрированных метрик. 

|Значение в журнале|Пример кода| Формат на портале|
|----|----|----|
|Массив числовых значений| `run.log_list(name='Fibonacci', value=[0, 1, 1, 2, 3, 5, 8, 13, 21, 34, 55, 89])`|График для одной переменной|
|Одно повторяющееся числовое значение с тем же именем метрики (например, в цикле for)| `for i in tqdm(range(-10, 10)):    run.log(name='Sigmoid', value=1 / (1 + np.exp(-i))) angle = i / 2.0`| График для одной переменной|
|Повторяющиеся строки с двумя числовыми столбцами|`run.log_row(name='Cosine Wave', angle=angle, cos=np.cos(angle))   sines['angle'].append(angle)      sines['sine'].append(np.sin(angle))`|Графики для двух переменных|
|Таблица с двумя числовыми столбцами|`run.log_table(name='Sine Wave', value=sines)`|Графики для двух переменных|

## <a name="query-run-metrics"></a>Запрос метрик выполнения

Метрики обученной модели можно просмотреть с помощью ```run.get_metrics()```. Например, с помощью приведенного выше примера можно определить наилучшую модель, выполнив поиск модели с наименьшим значением квадратной ошибки (MSE).

<a name="view-the-experiment-in-the-web-portal"></a>

## <a name="view-run-records-in-the-studio"></a>Просмотр записей запуска в студии

В [машинное обучение Azure Studio](https://ml.azure.com)можно просматривать завершенные записи о выполнении, включая зарегистрированные метрики.

Перейдите на вкладку **эксперименты** . Чтобы просмотреть все запуски в рабочей области в разных экспериментах, перейдите на вкладку **все запуски** . Вы можете детализировать ход выполнения для конкретных экспериментов, применив фильтр эксперимента в верхней строке меню.

Для просмотра отдельных экспериментов перейдите на вкладку **все эксперименты** . На панели мониторинга запуск эксперимента можно просмотреть метрики и журналы для каждого запуска. 

Можно также отредактировать таблицу список выполнения, чтобы выбрать несколько запусков и отобразить Последнее, минимальное или максимальное значение журнала для выполненных операций. Настройте диаграммы, чтобы сравнить зарегистрированные значения метрик и статистические выражения для нескольких запусков. 

![Сведения о запуске в студии Машинного обучения Azure](media/how-to-track-experiments/experimentation-tab.gif)

### <a name="view-log-files-for-a-run"></a>Просмотр файлов журнала для запуска 

Файлы журнала являются ключевым ресурсом для отладки рабочих нагрузок машинного обучения Azure. Выполните детализацию до определенного запуска, чтобы просмотреть его журналы и выходные данные:  

1. Перейдите на вкладку **эксперименты** .
1. Выберите runID для конкретного запуска.
1. Выберите **выходные данные и журналы** в верхней части страницы.

:::image type="content" source="media/how-to-monitor-view-training-logs/view-logs.png" alt-text="Снимок экрана: раздел выходных данных и журналов выполнения":::

В таблицах ниже показано содержимое файлов журнала в папках, которые вы увидите в этом разделе.

> [!NOTE]
> Вы не обязательно будете видеть каждый файл для каждого запуска. Например, 20_image_build_log *. txt отображается только при построении нового образа (например, при изменении среды).

#### <a name="azureml-logs-folder"></a>`azureml-logs`

|Файл  |Описание  |
|---------|---------|
|20_image_build_log.txt     | Журнал создания образа DOCKER для среды обучения (необязательно), по одному на запуск. Применимо только при обновлении среды. В противном случае AML будет повторно использовать кэшированный образ. В случае успеха содержит сведения о реестре изображений для соответствующего образа.         |
|55_azureml-Execution-<node_id # C1.txt     | Журнал stdout/stderr средства размещения, по одному на узел. Извлекает изображение в целевой объект вычислений. Обратите внимание, что этот журнал отображается только после получения защищенных ресурсов вычислений.         |
|65_job_prep <node_id # C1.txt     |   Журнал stdout/stderr скрипта подготовки задания, по одному на узел. Скачайте код в целевой объект вычислений и хранилища данных (при запросе).       |
|70_driver_log (_x). txt      |  Журнал stdout/stderr из скрипта управления AML и скрипта обучения клиента, по одному на процесс. **Это стандартные выходные данные скрипта. Здесь отображаются журналы кода (например, инструкции печати).** В большинстве случаев журналы будут отслеживаться здесь.       |
|70_mpi_log.txt     |   Журнал инфраструктуры MPI, необязательный, один для каждого запуска. Только для запуска MPI.   |
|75_job_post <node_id # C1.txt     |  журнальный сценарий выпуска для stdout/stderr, по одному на узел. Отправляйте журналы, освобождайте ресурсы для вычислений обратно в Azure.        |
|process_info.jsна      |   показывает, какой процесс выполняется на каком узле.  |
|process_status.jsна      | Отображение состояния процесса, т. е. Если процесс не запущен, выполняется или завершен.         |

#### <a name="logs--azureml-folder"></a>`logs > azureml`

|Файл  |Описание  |
|---------|---------|
|110_azureml. log      |         |
|job_prep_azureml. log     |   системный журнал для подготовки задания        |
|job_release_azureml. log     | системный журнал для выпуска задания        |

#### <a name="logs--azureml--sidecar--node_id-folder"></a>`logs > azureml > sidecar > node_id`

Если расширения включен, скрипты подготовки заданий и выпусков заданий будут выполняться в контейнере расширения.  Для каждого узла существует одна папка. 

|Файл  |Описание  |
|---------|---------|
|start_cms.txt     |  Журнал процесса, который запускается при запуске контейнера расширения       |
|prep_cmd.txt      |   Журнал для Контекстманажерс, указанный при `job_prep.py` запуске (часть из этого будет передаваться в поток `azureml-logs/65-job_prep` )       |
|release_cmd.txt     |  Журнал для Комтекстманажерс завершен, когда выполняется `job_release.py`        |

#### <a name="other-folders"></a>Другие папки

Для обучения заданий на кластерах с несколькими вычисленийми журналы существуют для каждого IP-адреса узла. Структура для каждого узла аналогична заданиям одного узла. Для общего журнала выполнения, stderr и stdout существует одна папка дополнительных журналов.

Машинное обучение Azure записывает сведения из различных источников во время обучения, например Аутомл или контейнер DOCKER, который запускает задание обучения. Многие из этих журналов не документированы. Если у вас возникли проблемы и вы обратились в службу поддержки Майкрософт, ее специалисты могут воспользоваться этими журналами для устранения неполадок.

## <a name="monitor-a-compute-cluster"></a>Мониторинг кластера вычислений

Чтобы отслеживать запуски для определенного целевого объекта вычислений из браузера, выполните следующие действия.

1. В [машинное обучение Azure Studio](https://ml.azure.com/)выберите рабочую область, а затем в левой части страницы выберите пункт __вычислить__ .

1. Выберите __Кластеры обучения__, чтобы отобразить список целевых объектов вычислений, используемых для обучения. Выберите кластер.

    ![Выбор кластера обучения](./media/how-to-track-experiments/select-training-compute.png)

1. Выберите __Запуски__. Отобразится список запусков, использующих этот кластер. Чтобы просмотреть сведения о конкретном запуске, нажмите соответствующую ссылку в столбце __Запуск__. Чтобы просмотреть сведения об эксперименте, используйте соответствующую ссылку в столбце __Эксперимент__.

    ![Выбор запусков для кластера обучения](./media/how-to-track-experiments/show-runs-for-compute.png)
    
    > [!TIP]
    > Поскольку целевые показатели для обучения являются общими ресурсами, они могут иметь несколько запусков в очереди или быть активными в определенный момент времени.
    > 
    > У запуска могут быть дочерние запуски, поэтому у одного задания обучения может быть несколько записей.

После завершения запуска он больше не будет отображаться на этой странице. Чтобы просмотреть сведения о завершенных запусках, перейдите в раздел студии __Эксперименты__, затем выберите эксперимент и запуск. Дополнительные сведения см. в разделе [Просмотр метрик для завершенных запусков](#view-the-experiment-in-the-web-portal).


## <a name="next-steps"></a>Дальнейшие действия

Выполните следующие действия, чтобы узнать, как использовать Машинное обучение Azure.

* Сведения об [отслеживании экспериментов и включении журналов в конструкторе машинное обучение Azure](how-to-track-designer-experiments.md).

* Пример регистрации оптимальных моделей и их развертывания см. в руководстве [Руководство № 1. Обучение модели классификации изображений с помощью Машинного обучения Azure](tutorial-train-models-with-aml.md).
