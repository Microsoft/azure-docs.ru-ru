---
title: Как обновить виртуальную машину для обработки и анализа данных до Ubuntu 18,04
titleSuffix: Azure Data Science Virtual Machine
description: Узнайте, как обновить CentOS и Ubuntu 16,04 до последней виртуальной машины Ubuntu 18,04 для обработки и анализа данных.
keywords: глубокое обучение, AI, средства обработки и анализа данных, виртуальная машина для анализа данных, обработка и анализ данных группы
services: machine-learning
ms.service: data-science-vm
author: samkemp
ms.author: samkemp
ms.topic: conceptual
ms.date: 10/07/2020
ms.openlocfilehash: 5b897ff7527d2d60234162ccbdeb08a00260bb1d
ms.sourcegitcommit: 910a1a38711966cb171050db245fc3b22abc8c5f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "101659466"
---
# <a name="upgrade-your-data-science-virtual-machine-to-ubuntu-1804"></a>Обновите виртуальную машину для обработки и анализа данных до версии Ubuntu 18.04

Если у вас есть виртуальная машина для обработки и анализа данных с более ранним выпуском, например Ubuntu 16,04 или CentOS, необходимо перенести DSVM в Ubuntu 18,04. Миграция обеспечит получение последних исправлений операционной системы, драйверов, предварительно установленного программного обеспечения и версий библиотеки. В этом документе объясняется, как выполнить миграцию из более старых версий Ubuntu или CentOS. 

## <a name="prerequisites"></a>Предварительные условия

- Знакомство с SSH и командной строкой Linux

## <a name="overview"></a>Обзор

Существует два возможных способа миграции.

- Миграция на месте, также называемая «одинаковым сервером». Эта миграция обновляет существующую виртуальную машину без создания новой виртуальной машины. Миграция на месте — это более простой способ перехода с Ubuntu 16,04 на Ubuntu 18,04.
- Параллельная миграция, также называемая переходом между серверами. Эта миграция передает данные из существующей виртуальной машины на только что созданную виртуальную машину. Параллельная миграция — это способ перехода с CentOS на Ubuntu 18,04. Вы можете предпочесть параллельную миграцию для обновления между версиями Ubuntu, если вы считаете, что старая установка стала ненужной.

## <a name="snapshot-your-vm-in-case-you-need-to-roll-back"></a>Создайте моментальный снимок виртуальной машины, если необходимо выполнить откат

В портал Azure используйте панель поиска, чтобы найти функциональные возможности **моментальных снимков** . 

:::image type="content" source="media/ubuntu_upgrade/azure-portal-search-bar.png" alt-text="Снимок экрана, показывающий портал Azure и панель поиска с выделенными * * снимками * *":::

1. Нажмите кнопку **Добавить**, чтобы перейти на страницу **Создание моментального снимка** . Выберите подписку и группу ресурсов виртуальной машины. В поле **регион** выберите тот же регион, в котором находится целевое хранилище. Выберите диск хранилища DSVM и дополнительные параметры резервного копирования. **HDD (цен. Категория "Стандартный")** является подходящим типом хранилища для этого сценария резервного копирования.

:::image type="content" source="media/ubuntu_upgrade/create-snapshot-options.png" alt-text="Снимок экрана с параметрами &quot;создать моментальный снимок&quot;":::

2. Когда все сведения будут заполнены и пройдены проверки, выберите проверить и **создать** , чтобы проверить и создать моментальный снимок. После успешного завершения создания моментального снимка вы увидите сообщение о том, что развертывание завершено.

## <a name="in-place-migration"></a>Миграция на месте

Если вы выполняете миграцию более старой версии Ubuntu, вы можете выполнить миграцию на месте. Эта миграция не создает новую виртуальную машину и содержит меньше шагов, чем параллельная миграция.  Если вы хотите выполнить параллельную миграцию, так как вам нужен дополнительный контроль или если вы выполняете миграцию из другого дистрибутива, например CentOS, перейдите к разделу [параллельной миграции](#side-by-side-migration) . 

1. В портал Azure запустите DSVM и выполните вход с помощью SSH. Для этого выберите **подключить** и **SSH** и следуйте инструкциям по подключению. 

1. После подключения к сеансу терминала в DSVM выполните следующую команду обновления:

    ```bash
    sudo do-release-upgrade
    ```

Для завершения процесса обновления потребуется некоторое время. Когда оно перейдет, программа запросит разрешение на перезапуск виртуальной машины. Ответьте **Да**. После перезагрузки системы вы будете отключены от сеанса SSH.

### <a name="if-necessary-regenerate-ssh-keys"></a>При необходимости повторно создайте ключи SSH.

> [!IMPORTANT] 
> После обновления и перезагрузки может потребоваться повторное создание ключей SSH.

После обновления и перезагрузки виртуальной машины попытайтесь снова получить доступ к ней через SSH. IP-адрес мог быть изменен во время перезагрузки, поэтому перед попыткой подключения подтвердите его.

Если при получении сообщения об ошибке **идентификатор удаленного узла изменился**, вам потребуется повторно создать учетные данные SSH.

:::image type="content" source="media/ubuntu_upgrade/remote-host-warning.png" alt-text="Снимок экрана PowerShell с предупреждением об изменении идентификатора удаленного узла":::

Для этого на локальном компьютере выполните команду:

```bash
ssh-keygen -R "your server hostname or ip"
```

Теперь вы можете подключиться по протоколу SSH. Если у вас по-прежнему возникают проблемы, на странице **подключения** перейдите по ссылке, чтобы устранить неполадки с **подключением SSH**.

## <a name="side-by-side-migration"></a>Параллельная миграция

Если выполняется миграция с CentOS или требуется чистая установка ОС, можно выполнить параллельную миграцию. Этот тип миграции содержит больше шагов, но позволяет контролировать, какие именно файлы переносятся.

Миграция из других систем, основанных на одном наборе вышестоящего исходного пакета, должна быть относительно простой, например [часто задаваемых вопросов и CentOS3](https://wiki.centos.org/FAQ/CentOS3).

Вы можете обновить части операционной системы FileSystem и оставить каталоги пользователей, например `/home` на месте. Если оставить старые корневые каталоги пользователей на месте, то, возможно, возникнут проблемы с меню GNOME/KDE и другими элементами рабочего стола. Проще всего создать новые учетные записи пользователей и подключить старые каталоги где-либо в файловой системе для справки, копирования или связывания материала пользователей после миграции.

### <a name="migration-at-a-glance"></a>Краткий обзор миграции

1.  Создайте моментальный снимок существующей виртуальной машины, как описано выше.

1.  Создание диска на основе этого снимка

1.  Создание новой виртуальной машины Ubuntu для обработки и анализа данных

1.  Повторное создание учетных записей пользователей на новой виртуальной машине

1.  Подключение диска виртуальной машины снапшоттед в качестве диска данных на новой виртуальной машине для обработки и анализа данных

1.  Вручную копировать нужные данные

### <a name="create-a-disk-from-your-vm-snapshot"></a>Создание диска из моментального снимка виртуальной машины

Если вы еще не создали моментальный снимок виртуальной машины, как описано выше, сделайте это. 

1. В портал Azure найдите **диски** и нажмите кнопку **Добавить**, после чего откроется страница **диск** .

:::image type="content" source="media/ubuntu_upgrade/portal-disks-search.png" alt-text="Снимок экрана: портал Azure отображение страницы &quot;Поиск дисков&quot; и кнопки &quot;Добавить&quot;":::

2. Задайте для параметра **Подписка**, **Группа ресурсов** и **регион** значение моментальный снимок виртуальной машины. Выберите **имя** создаваемого диска.

3. Выберите **тип источника** в качестве **моментального снимка** и выберите моментальный снимок виртуальной машины в качестве **исходного моментального снимка**. Проверьте и создайте диск. 

:::image type="content" source="media/ubuntu_upgrade/disk-create-options.png" alt-text="Снимок экрана: диалоговое окно создания диска с параметрами":::

### <a name="create-a-new-ubuntu-data-science-virtual-machine"></a>Создание новой виртуальной машины Ubuntu для обработки и анализа данных

Создайте новую виртуальную машину Ubuntu для обработки и анализа данных с помощью [портал Azure](https://portal.azure.com) или [шаблона ARM](./dsvm-tutorial-resource-manager.md). 

### <a name="recreate-user-accounts-on-your-new-data-science-virtual-machine"></a>Повторное создание учетных записей пользователей на новой виртуальной машине для обработки и анализа данных

Поскольку вы просто копируете данные со старого компьютера, необходимо повторно создать учетные записи пользователей и программные среды, которые будут использоваться на новом компьютере.

Linux достаточно гибок для настройки каталогов и путей в новой установке, чтобы соответствовать старому компьютеру. Однако в общем случае проще использовать современные предпочтительные макеты Ubuntu и изменять среду пользователя и сценарии для адаптации.

Дополнительные сведения см. [в разделе Краткое руководство. Настройка виртуальной машины для обработки и анализа данных для Linux (Ubuntu)](./dsvm-ubuntu-intro.md).

### <a name="mount-the-disk-of-the-snapshotted-vm-as-a-data-disk-on-your-new-data-science-virtual-machine"></a>Подключение диска виртуальной машины снапшоттед в качестве диска данных на новой виртуальной машине для обработки и анализа данных

1. В портал Azure убедитесь, что виртуальная машина для обработки и анализа данных запущена.

2. На портал Azure перейдите на страницу виртуальной машины для обработки и анализа данных. Выберите колонку **диски** на левой границе. Выберите **присоединить существующие диски**.

3. В раскрывающемся списке **имя диска** выберите диск, созданный на основе моментального снимка старой виртуальной машины.

:::image type="content" source="media/ubuntu_upgrade/attach-data-disk.png" alt-text="Снимок экрана: страница &quot;Параметры DSVM&quot; с параметрами вложений диска":::

4. Выберите **сохранить** , чтобы обновить виртуальную машину.

> [!Important]
> Виртуальная машина должна быть запущена во время подключения диска данных. Если виртуальная машина не запущена, диски могут быть добавлены в неправильном порядке, что приведет к путанице и потенциально неустранимой системе. Если вы добавите диск данных с виртуальной машиной, выберите **X** рядом с диском данных, запустите виртуальную машину и повторно подключите ее.

### <a name="manually-copy-the-wanted-data"></a>Вручную копировать нужные данные 

1. Войдите в работающую виртуальную машину с помощью SSH.

2. Убедитесь, что вы подключили диск, созданный из моментального снимка старой виртуальной машины, выполнив следующую команду:

    ```bash
    lsblk -o NAME,HCTL,SIZE,MOUNTPOINT | grep -i 'sd'
    ```
    
    Результаты должны выглядеть примерно так, как на следующем рисунке. В образе диск `sda1` монтируется в корне и `sdb2` является временным `/mnt` диском. Диск данных, созданный из моментального снимка старой виртуальной машины, определен как, `sdc1` но пока недоступен, что свидетельствует о нехватке места для подключения. Результаты могут иметь разные идентификаторы, но вы должны увидеть похожую схему.
    
    :::image type="content" source="media/ubuntu_upgrade/lsblk-results.png" alt-text="Снимок экрана с выходными данными лсблк, показывающий неподключенный диск данных":::
    
3. Чтобы получить доступ к диску данных, создайте для него расположение и подключите его. Замените на `/dev/sdc1` соответствующее значение, возвращаемое `lsblk` :

    ```bash
    sudo mkdir /datadrive && sudo mount /dev/sdc1 /datadrive
    ```
    
4. Теперь `/datadrive` содержит каталоги и файлы старой виртуальной машины для обработки и анализа данных. Переместите или скопируйте нужные каталоги или файлы с диска данных на новую виртуальную машину.

Дополнительные сведения см. в статье [Подключение диска данных к виртуальной машине Linux с помощью портала](../../virtual-machines/linux/attach-disk-portal.md#connect-to-the-linux-vm-to-mount-the-new-disk).

## <a name="connect-and-confirm-version-upgrade"></a>Подключение и подтверждение обновления версии

Независимо от того, выполнялась ли миграция на месте или параллельно, убедитесь, что обновление выполнено успешно. В сеансе терминала выполните: 

```bash
cat /etc/os-release
```

Вы должны увидеть, что вы используете Ubuntu 18,04.

:::image type="content" source="media/ubuntu_upgrade/ssh-os-release.png" alt-text="Снимок экрана терминала Ubuntu с данными о версии ОС":::

Изменение версии также отображается в портал Azure.

:::image type="content" source="media/ubuntu_upgrade/portal-showing-os-version.png" alt-text="Снимок экрана: Отображение свойств DSVM, включая версию ОС":::

## <a name="next-steps"></a>Дальнейшие действия

- [Обработка и анализ данных с помощью машины Ubuntu для обработки и анализа данных в Azure](./linux-dsvm-walkthrough.md)
- [Какие средства включены в виртуальную машину Azure для обработки и анализа данных?](./tools-included.md)