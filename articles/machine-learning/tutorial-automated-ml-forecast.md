---
title: Руководство по прогнозированию спроса и AutoML
titleSuffix: Azure Machine Learning
description: Узнайте, как обучить и развернуть модель прогнозирования спроса с помощью автоматизированного машинного обучения в Студии машинного обучения Azure.
services: machine-learning
ms.service: machine-learning
ms.subservice: core
ms.topic: tutorial
ms.author: sacartac
ms.reviewer: nibaccam
author: cartacioS
ms.date: 12/21/2020
ms.custom: automl
ms.openlocfilehash: 2653161b5828d89858234a9ca98fe432e0eacb5c
ms.sourcegitcommit: aaa65bd769eb2e234e42cfb07d7d459a2cc273ab
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/27/2021
ms.locfileid: "98879365"
---
# <a name="tutorial-forecast-demand-with-automated-machine-learning"></a>Руководство по Прогнозирование спроса с помощью автоматизированного машинного обучения


Во время работы с этим руководством вы создадите в Студии машинного обучения Azure с помощью автоматизированного машинного обучения модель прогнозирования временных рядов для прогнозирования спроса для службы проката велосипедов.

Пример модели классификации см. в руководстве [по созданию модели классификации с использованием автоматизированного машинного обучения в службе "Машинное обучение Azure"](tutorial-first-experiment-automated-ml.md).

Из этого руководства вы узнаете, как выполнять такие задачи:

> [!div class="checklist"]
> * создание и загрузка набора данных;
> * настройка и выполнение эксперимента автоматического машинного обучения;
> * Укажите параметры прогнозирования.
> * анализ результатов эксперимента;
> * развертывание лучшей модели.

## <a name="prerequisites"></a>Предварительные требования

* Рабочая область машинного обучения Azure. См. сведения о [создании рабочей области машинного обучения Azure](how-to-manage-workspace.md). 

* Файл данных [bike-no.csv](https://github.com/Azure/MachineLearningNotebooks/blob/master/how-to-use-azureml/automated-machine-learning/forecasting-bike-share/bike-no.csv).

## <a name="get-started-in-azure-machine-learning-studio"></a>Начало работы в Студии машинного обучения Azure

В рамках этого учебника вы создадите эксперимент автоматизированного машинного обучения, который будет выполняться в Студии машинного обучения Azure — объединенном веб-интерфейсе, включающем в себя средства машинного обучения для выполнения сценариев обработки и анализа данных, основанных на всех уровнях навыков. Студия не поддерживается в браузерах Internet Explorer.

1. Войдите в [Студию машинного обучения Azure](https://ml.azure.com).

1. Выберите свою подписку и рабочую область, которую создали.

1. Выберите **Начать**.

1. На панели слева выберите **Automated ML** (Автоматизированное ML) в разделе **Автор**.

1. Выберите **+Новое выполнение автоматизированного машинного обучения**. 

## <a name="create-and-load-dataset"></a>Создание и загрузка набора данных

Прежде чем настроить эксперимент, отправьте файл данных в рабочую область в виде набора данных Машинного обучения Azure. Это позволит правильно отформатировать данные для эксперимента.

1. В форме **Выбор набора данных** выберите из раскрывающегося списка **+Создание набора данных** пункт **From local files** (Из локальных файлов). 

    1. В форме **Общие сведения** присвойте набору данных имя и по желанию добавьте описание. По умолчанию следует использовать тип набора данных **Табличный**, так как автоматизированное машинное обучение в Студии машинного обучения Azure сейчас поддерживает только табличные наборы данных.
    
    1. Выберите **Далее** внизу слева.

    1. В форме **Выбор хранилища данных и файлов** выберите хранилище данных по умолчанию, которое было автоматически настроено при создании рабочей области **workspaceblobstore (хранилище BLOB-объектов Azure)** . В это хранилище вы отправите файл данных. 

    1. Нажмите кнопку **Обзор**. 
    
    1. Выберите файл **bike-no.csv** на локальном компьютере. Это тот файл, который вы скачали при подготовке [необходимых компонентов](https://github.com/Azure/MachineLearningNotebooks/blob/master/how-to-use-azureml/automated-machine-learning/forecasting-bike-share/bike-no.csv).

    1. Щелкните **Далее**.

       Когда загрузка завершится, форма "Settings and preview" (Настройки и предварительный просмотр) будет автоматически заполнена в зависимости от типа файла. 
       
    1. Убедитесь, что форма **Settings and preview** (Настройки и предварительный просмотр) заполнена, как описано ниже, и щелкните **Далее**.
        
        Поле|Описание| Значение для руководства
        ---|---|---
        Формат файла|Свойство определяет структуру и тип данных, хранящихся в файле.| С разделителями
        Разделитель|Один или несколько символов для указания границы между&nbsp; отдельными, независимыми регионами в виде простого текста или других потоков данных. |Запятая
        Кодирование|Определяет, какой бит следует использовать в таблице схемы символов, чтобы считать набор данных.| UTF-8
        Заголовки столбцов| Указывает, как будут обрабатываться заголовки набора данных, если таковые имеются.| Использовать заголовки из первого файла
        Пропустить строки | Указывает, сколько строк, если таковые имеются, пропускается в наборе данных.| None

    1. Форма **Схема** позволяет выполнять дальнейшую настройку данных для этого эксперимента. 
    
        1. В этом примере игнорируйте столбцы **casual** и **registered**. Эти столбцы предназначены для разбивки данных из столбца **cnt**, поэтому мы их исключаем.

        1. Кроме того, в этом примере оставьте значения по умолчанию для параметров **Свойства** и **Тип**. 
        
        1. Выберите **Далее**.

    1. В форме **Confirm details** (Подтверждение сведений) проверьте правильность сведений, которые ранее были введены в формах **Basic info** (Базовые сведения) и **Settings and preview** (Параметры и просмотр).

    1. Выберите **Создать**, чтобы завершить создание набора данных.

    1. Выберите набор данных, когда он появится в списке.

    1. Нажмите кнопку **Далее**.

## <a name="configure-run"></a>Настройка запуска

После загрузки и настройки данных настройте удаленный целевой объект вычислений и выберите столбец данных, который вы хотите спрогнозировать.

1. Заполните форму **Настройка запуска** следующим образом.
    1. Укажите для эксперимента имя `automl-bikeshare`.

    1. Выберите **cnt** в качестве целевого столбца, данные в котором нужно спрогнозировать. В этом столбце указывается общее число велосипедов, взятых напрокат.

    1. Щелкните **Create a new compute** (Создать новую вычислительную среду) и настройте целевой объект вычислений. Автоматизированное машинное обучение поддерживает только вычисления в Службе машинного обучения Azure. 

        1. Заполните форму **Виртуальная машина**, чтобы настроить вычислительную среду.

            Поле | Описание | Значение для руководства
            ----|---|---
            Приоритет&nbsp;виртуальной&nbsp;машины |Выберите приоритет, который должен иметь ваш эксперимент.| Выделенные
            Virtual&nbsp;machine&nbsp;type| Выберите тип виртуальной машины для вычислительной среды.|ЦП (центральный процессор)
            Virtual&nbsp;machine&nbsp;size| Выберите размер виртуальной машины для вычислительной среды. Список рекомендуемых размеров выводится с учетом ваших данных и типа эксперимента. |Standard_DS12_V2
        
        1. Выберите **Далее**, чтобы заполнить форму **Настройка параметров**.
        
             Поле | Описание | Значение для руководства
            ----|---|---
            Имя вычислительной среды |  Уникальное имя для идентификации контекста вычислительной среды. | bike-compute
            Min/Max nodes (Минимальное и максимальное количество узлов)| Для профилирования данных необходимо указать один или больше узлов.|Min nodes (Минимум узлов): 1<br>Max nodes (Максимум узлов): 6
            Время до уменьшения масштаба (сек) | Время простоя перед автоматическим уменьшением масштаба кластера до минимального количества узлов.|120 (по умолчанию)
            Дополнительные параметры | Параметры для настройки и авторизации виртуальной сети для эксперимента.| None 
  
        1. Выберите **Создать**, чтобы получить целевой объект вычислений. 

            **Операция займет несколько минут.** 

        1. Когда создание целевого объекта вычислений завершится, выберите его из раскрывающегося списка.

    1. Выберите **Далее**.

## <a name="select-forecast-settings"></a>Выбор параметров прогнозирования

Завершите настройку эксперимента автоматического машинного обучения, указав тип задачи и параметры конфигурации машинного обучения.

1. В форме **Тип задачи и параметры** в качестве типа задачи машинного обучения выберите **Прогнозирование временных рядов**.

1. В качестве **столбца времени** выберите **date**, а значение **Time series identifiers** (Идентификаторы временных рядов) оставьте пустым. 

1. **Горизонт прогноза** — продолжительность времени в будущем, на которое требуется прогноз.  Снимите флажок "Автовыбор" и введите 14 в поле. 

1. Выберите **View additional configuration settings** (Просмотреть дополнительные параметры конфигурации) и заполните поля следующим образом. Эти параметры позволяют лучше контролировать задание обучения и указывать параметры для прогнозирования. В противном случае применяются значения по умолчанию, основанные на выборе эксперимента и данных.

    Дополнительные&nbsp;конфигурации|Описание|Значение&nbsp;для&nbsp;руководства
    ------|---------|---
    Основная метрика| Оценочная метрика, по которой будет проверяться алгоритм машинного обучения.|Нормализованная среднеквадратическая погрешность
    Пояснения для наилучшей модели| Автоматическое отображение пояснений для лучшей модели, созданной с помощью автоматизированного машинного обучения.| Включить
    Запрещенные алгоритмы | Алгоритмы, которые вы хотите исключить из задания обучения.| Крайне случайные деревья
    Дополнительные параметры прогнозирования| Следующие параметры помогают повысить точность модели. <br><br> _**Forecast target lags**_ (Задержка целевого объекта для прогноза) — время, на которое вы хотите создать задержку для целевой переменной. <br> _**Размер целевого скользящего интервала**_  — определяет длительность периода, в течение которого будут создаваться функции, такие как *max, min* и *sum*. | <br><br>Задержка&nbsp;целевого объекта&nbsp;для прогноза: None <br> Размер&nbsp;целевого&nbsp;скользящего&nbsp;интервала: None
    Критерий выхода| Если условия соблюдены, задание обучения останавливается. |Время&nbsp;задания&nbsp;обучения (ч): 3 <br> Порог&nbsp;оценки&nbsp;метрики: None
    Проверка | Выберите тип перекрестной проверки и число тестов.|Тип проверки:<br>перекрестная проверка в &nbsp;k-кратном порядке&nbsp;. <br> <br> Количество проверок: 5
    Параллелизм| Максимальное число выполняемых параллельных итераций за одну итерацию.| Максимальное число&nbsp;параллельных&nbsp;итераций: 6
    
    Щелкните **Сохранить**.

## <a name="run-experiment"></a>Выполнение эксперимента

Чтобы выполнить эксперимент, щелкните **Готово**. Откроется экран **Сведения о запуске**, в верхней части которого рядом с номером запуска указано **состояние запуска**. Это состояние обновляется по мере выполнения эксперимента. Уведомления также отображаются в правом верхнем углу студии, сообщая о состоянии эксперимента.

>[!IMPORTANT]
> Подготовка к запуску эксперимента занимает **10-15 минут**.
> С начала эксперимента на каждую итерацию уходит **2-3 минуты**.<br> <br>
> В рабочей среде у вас будет время заняться другими делами, так как это длительный процесс. Пока вы ждете, рекомендуем начинать изучение протестированных алгоритмов на вкладке **Модели** по мере их завершения. 

##  <a name="explore-models"></a>Изучение моделей

Перейдите на вкладку **Модели**, чтобы просмотреть протестированные алгоритмы (модели). По умолчанию модели упорядочиваются по оценке метрики по мере их завершения. В рамках работы с этим руководством в начале списка отображается модель, имеющая максимальное значение выбранной метрики **Нормализованная среднеквадратическая погрешность**.

В ожидании завершения всех моделей эксперимента вы можете щелкнуть **Algorithm name** (Имя алгоритма) для любой завершенной модели, чтобы просмотреть сведения о ее эффективности. 

Чтобы просмотреть свойства, метрики и диаграммы производительности выбранной модели, воспользуйтесь вкладками **Подробности** и **Метрики** из следующего примера. 

![Сведения о запуске](./media/tutorial-automated-ml-forecast/explore-models.gif)

## <a name="deploy-the-model"></a>Развертывание модели

Автоматизированное машинное обучение в Студии машинного обучения Azure позволяет развернуть лучшую модель как веб-службу всего с помощью нескольких действий. Развертывание — это интеграция модели для прогнозирования по новым данным и определения потенциальных новых возможностей. 

В этом эксперименте развертывание в веб-службе означает, что у компании по прокату велосипедов теперь есть итеративное масштабируемое веб-решение для прогнозирования спроса на прокат велосипедов. 

После завершения выполнения вернитесь на страницу родительского выполнения, выбрав **Run 1** (Запуск 1) в верхней части экрана.

В разделе **Сводка по лучшей модели** лучшей моделью на основе метрики **Нормализованная среднеквадратическая погрешность** в контексте этого эксперимента считается модель **StackEnsemble**.  

Мы развернем эту модель. Учитывайте, что процесс развертывания занимает около 20 минут. Процесс развертывания выполняется за несколько шагов, включая регистрацию модели, создание ресурсов и их настройку для веб-службы.

1. Выберите **StackEnsemble**, чтобы открыть страницу для конкретной модели.

1. Нажмите кнопку **Развернуть** в левой верхней области экрана.

1. Заполните панель **Deploy a model** (Развертывание модели), как показано ниже.

    Поле| Значение
    ----|----
    Deployment name (Имя развертывания)| bikeshare-deploy
    Deployment description (Описание развертывания)| Развертывание модели спроса на прокат велосипедов
    Тип вычисления | Выберите "Вычислительная операция Azure (ACI)"
    Включить проверку подлинности| Отключите. 
    Использовать настраиваемые ресурсы развертывания| Отключите. Отключение позволяет автоматически создавать файл драйвера (скрипт оценки) и файл среды по умолчанию. 
    
    Для этого примера мы воспользуемся стандартными параметрами, доступными в меню *Дополнительно*. 

1. Выберите **Развернуть**.  

    В верхней части окна **запуска** появится зеленое сообщение об успешном завершении, в котором указано, что развертывание было начато успешно. Ход выполнения развертывания можно просмотреть в области **Сводка по модели** в разделе **Deploy status** (Состояние развертывания).
    
Если развертывание завершилось успешно, теперь у вас есть рабочая веб-служба для создания прогнозов. 

Перейдите к [**дальнейшим действиям**](#next-steps), чтобы узнать больше о том, как использовать новую веб-службу, и протестируйте прогнозы, используя встроенную поддержку Power BI в Машинном обучении Azure.

## <a name="clean-up-resources"></a>Очистка ресурсов

Файлы развертывания имеют больший размер, чем файлы данных и экспериментов, поэтому их хранение обходится дороже. Вы можете удалить только файлы развертывания, чтобы снизить затраты на учетную запись, если хотите сохранить рабочую области и файлы экспериментов. В противном случае, если вы не планируете дальше использовать эти файлы, удалите всю группу ресурсов.  

### <a name="delete-the-deployment-instance"></a>Удаление промежуточного развертывания

Чтобы сохранить группу ресурсов и рабочую область для изучения других руководств и собственных исследований, удалите из Студии машинного обучения Azure только экземпляр развертывания. 

1. Перейдите в [Студию машинного обучения Azure](https://ml.azure.com/). Перейдите в свою рабочую область и слева под областью **Ресурсы** выберите **Конечные точки**. 

1. Выберите развертывание для удаления и щелкните **Удалить**. 

1. Выберите **Продолжить**.

### <a name="delete-the-resource-group"></a>удаление группы ресурсов.

[!INCLUDE [aml-delete-resource-group](../../includes/aml-delete-resource-group.md)]

## <a name="next-steps"></a>Дальнейшие действия

Во время работы с этим руководством вы создали и развернули в Студии машинного обучения Azure с помощью автоматизированного машинного обучения модель прогнозирования временных рядов для прогнозирования спроса для службы проката велосипедов. 

В этой статье приведены инструкции о том, как создать схему с поддержкой Power BI для облегчения использования новой развернутой веб-службы:

> [!div class="nextstepaction"]
> [Использование веб-службы](/power-bi/connect-data/service-aml-integrate?context=azure%2fmachine-learning%2fcontext%2fml-context)

+ Дополнительные сведения [об автоматическом машинном обучении](concept-automated-ml.md).
+ Дополнительные сведения о классификационных метриках и графиках см. в статье [Общие сведения об автоматических результатах машинного обучения](how-to-understand-automated-ml.md).
+ Подробная информация о [добавлении признаков](how-to-configure-auto-features.md#featurization).
+ Подробная информация [о профилировании данных](how-to-connect-data-ui.md#profile).

>[!NOTE]
> Набор данных о прокате велосипедов был изменен для этого руководства. Этот набор данных был представлен в рамках [конкурса Kaggle](https://www.kaggle.com/c/bike-sharing-demand/data) и изначально был доступен на сайте [Capital Bikeshare](https://www.capitalbikeshare.com/system-data). Его также можно найти в [базе данных машинного обучения UCI](http://archive.ics.uci.edu/ml/datasets/Bike+Sharing+Dataset).<br><br>
> Источник: Хади Фанаи-Ти, Жоао Гама (Hadi Fanaee-T, Joao Gama), Event labeling combining ensemble detectors and background knowledge (Создание меток для событий путем объединения средств обнаружения ансамблей и фоновых знаний), Progress in Artificial Intelligence (Прогресс в области искусственного интеллекта), 2013 г., стр. 1–15, Springer Berlin Heidelberg.