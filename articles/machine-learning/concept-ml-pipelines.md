---
title: Что такое конвейеры Машинное обучение Azure
titleSuffix: Azure Machine Learning
description: Узнайте, как конвейеры машинного обучения (ML) помогают создавать, оптимизировать и администрировать рабочие процессы машинного обучения.
services: machine-learning
ms.service: machine-learning
ms.subservice: core
ms.topic: conceptual
ms.author: laobri
author: lobrien
ms.date: 01/11/2021
ms.custom: devx-track-python
ms.openlocfilehash: ee3d7d1cf285573db894d64549cf79babb517d95
ms.sourcegitcommit: 431bf5709b433bb12ab1f2e591f1f61f6d87f66c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/12/2021
ms.locfileid: "98131293"
---
# <a name="what-are-azure-machine-learning-pipelines"></a>Что такое Машинное обучение Azure конвейеров?

В этой статье вы узнаете, как Машинное обучение Azure конвейеры помогают создавать, оптимизировать и администрировать рабочие процессы машинного обучения. Эти рабочие процессы имеют ряд преимуществ. 

+ Простота
+ Speed
+ Повторяемость
+ Гибкость
+ Управление версиями и отслеживание
+ Модульность 
+ Контроль качества
+ Управление затратами

Эти преимущества становятся значительными, как только проект машинного обучения перейдет за пределы чистого исследования и в итерацию. Даже простые одноэтапные конвейеры могут быть полезными. Проекты машинного обучения часто находятся в сложном состоянии, и это может быть простым процессом выполнения простого процесса.

<a name="compare"></a>
### <a name="which-azure-pipeline-technology-should-i-use"></a>Какую технологию конвейера Azure следует использовать?

Облако Azure предоставляет несколько других конвейеров с разными целями. В следующей таблице перечислены различные конвейеры и их использование.

| Сценарий | Первичный персонаж | Предложение Azure | Предложение OSS | Канонический канал | Преимущества | 
| -------- | --------------- | -------------- | ------------ | -------------- | --------- | 
| Оркестрации модели (машинное обучение) | Специалист по обработке и анализу данных | Конвейеры Машинного обучение Azure | Конвейеры Kubeflow | Модель > данных | Распространение, кэширование, сначала код, повторное использование | 
| Оркестрации данных (подготовка данных) | Инженер данных | [Конвейеры Фабрики данных Azure](../data-factory/concepts-pipelines-activities.md) | Apache Airflow | Данные > данных | Строго типизированное перемещение, действия, ориентированные на данные |
| Согласование кода & приложений (CI/CD) | Разработка и Ops приложения | [Azure Pipelines](https://azure.microsoft.com/services/devops/pipelines/) | Jenkins | Код + модель — > приложения или службы | Поддержка наиболее открытых и гибких действий, очереди утверждений, фазы с ограничением | 

## <a name="what-can-azure-ml-pipelines-do"></a>Что могут выполнять конвейеры машинного обучения Azure?

Конвейер Машинное обучение Azure — это независимый исполняемый рабочий процесс полной задачи машинного обучения. Подзадачи инкапсулируются в последовательность шагов в конвейере. Конвейер Машинное обучение Azure может быть таким же простым, как и тот, который вызывает сценарий Python, поэтому _может_ выполнять практически любые действия. Конвейеры _должны_ сосредоточиться на задачах машинного обучения, таких как:

+ подготовка данных, включая импорт, проверку, очистку, изменение, преобразование, нормализацию и промежуточное хранение;
+ настройка обучения, включая параметризацию аргументов, путей, а также конфигураций ведения журналов и отчетности;
+ Обучение и проверка эффективно и многократно. Эффективность может полагаться на указание конкретных поднаборов данных, различных вычислительных ресурсов оборудования, распределенной обработки и мониторинга хода выполнения.
+ развертывание, включая управление версиями, масштабирование, подготовку и управление доступом;

Независимые шаги позволяют нескольким специалистам по обработке данных работать в одном конвейере одновременно без чрезмерных ресурсов вычислений. Отдельные шаги также упрощают использование различных типов вычислений и размеров для каждого шага.

После создания конвейера часто нужно выполнить более тонкую настройку его цикла обучения. При повторном запуске конвейера выполняется переход к шагам, которые необходимо повторить, например обновленному сценарию обучения. Шаги, которые не нужно повторять, пропускаются. 

С помощью конвейеров вы можете использовать разные аппаратные средства для различных задач. Azure координирует различные используемые [целевые объекты вычислений](concept-azure-machine-learning-architecture.md) , поэтому промежуточные данные легко передаются в подчиненные целевые объекты вычислений.

[Метрики для экспериментов конвейера можно отслеживаниь](./how-to-track-experiments.md) непосредственно в портал Azure или на [целевой странице рабочей области (Предварительная версия)](https://ml.azure.com). После публикации конвейера можно настроить конечную точку RESTFUL, которая позволит перезапустить конвейер из любой платформы или стека.

Вкратце, все сложные задачи жизненного цикла машинного обучения можно использовать с конвейерами. Другие технологии конвейера Azure обладают собственными преимуществами. [Конвейеры фабрики данных Azure](../data-factory/concepts-pipelines-activities.md) предназначен в работе с данными и [Azure pipelines](https://azure.microsoft.com/services/devops/pipelines/) — это подходящий инструмент для непрерывной интеграции и развертывания. Но если ваше внимание уделяется машинному обучению, Машинное обучение Azure конвейеры, скорее всего, будут лучшим выбором для нужд рабочего процесса. 

### <a name="analyzing-dependencies"></a>Анализ зависимостей

Многие экосистемы программирования имеют средства для управления зависимостями ресурсов, библиотек или компиляции. Как правило, эти средства используют метки времени файлов для вычисления зависимостей. При изменении файла только он и его зависимые элементы обновляются (скачаны, перекомпилированы или упакованы). Конвейеры машинного обучения Azure расширяют эту концепцию. Как и традиционные средства сборки, конвейеры вычисляют зависимости между шагами и выполняют только необходимые повторные вычисления. 

Анализ зависимостей в конвейерах машинного обучения Azure более сложен по сравнению с простыми метками времени. Каждый шаг может выполняться в различных аппаратных и программных средах. Подготовка данных может быть трудоемким процессом, но не нужно работать на оборудовании с мощными графическими процессорами. для некоторых шагов может потребоваться программное обеспечение, предназначенное для конкретной операционной системы, можно использовать распределенное обучение и т. д. 

Машинное обучение Azure автоматически управляет всеми зависимостями между этапами конвейера. Это может привести к ускорению и понижению работы образов DOCKER, подключению и отсоединению вычислений и перемещению данных между действиями в единообразном и автоматическом режиме.

### <a name="coordinating-the-steps-involved"></a>Координация необходимых действий

При создании и запуске `Pipeline` объекта выполняются следующие общие действия.

+ Для каждого шага служба вычисляет требования для:
    + Аппаратные ресурсы для вычислений
    + Ресурсы ОС (образы DOCKER)
    + Ресурсы программного обеспечения (зависимости Conda и Virtualenv)
    + Входные данные 
+ Служба определяет зависимости между шагами, что приводит к динамическому графу выполнения
+ При выполнении каждого узла в графе выполнения:
    + Служба настраивает необходимую аппаратную и программную среду (возможно, повторное использование существующих ресурсов).
    + Этот шаг выполняется, предоставляя сведения о ведении журнала и мониторинге содержащего его `Experiment` объекта.
    + После завершения шага его выходные данные подготавливаются в качестве входных данных для следующего шага и (или) записи в хранилище.
    + Ресурсы, которые больше не нужны, завершаются и отсоединяются

![Этапы конвейера](./media/concept-ml-pipelines/run_an_experiment_as_a_pipeline.png)

## <a name="building-pipelines-with-the-python-sdk"></a>Создание конвейеров с помощью пакета SDK для Python

В [пакете SDK для машинное обучение Azure Python](/python/api/overview/azure/ml/install?preserve-view=true&view=azure-ml-py)конвейер — это объект Python, определенный в `azureml.pipeline.core` модуле. Объект [конвейера](/python/api/azureml-pipeline-core/azureml.pipeline.core.pipeline%28class%29?preserve-view=true&view=azure-ml-py) содержит упорядоченную последовательность из одного или нескольких объектов [пипелинестеп](/python/api/azureml-pipeline-core/azureml.pipeline.core.builder.pipelinestep?preserve-view=true&view=azure-ml-py) . `PipelineStep`Класс является абстрактным, и фактические шаги будут подклассами, такими как [естиматорстеп](/python/api/azureml-pipeline-steps/azureml.pipeline.steps.estimatorstep?preserve-view=true&view=azure-ml-py), [писонскриптстеп](/python/api/azureml-pipeline-steps/azureml.pipeline.steps.pythonscriptstep?preserve-view=true&view=azure-ml-py)или [дататрансферстеп](/python/api/azureml-pipeline-steps/azureml.pipeline.steps.datatransferstep?preserve-view=true&view=azure-ml-py). Класс [модулестеп](/python/api/azureml-pipeline-steps/azureml.pipeline.steps.modulestep?preserve-view=true&view=azure-ml-py) содержит многократно используемую последовательность действий, которые могут совместно использоваться в конвейерах. `Pipeline`Выполняется как часть `Experiment` .

Конвейер машинного обучения Azure связан с рабочей областью Машинное обучение Azure, а этап конвейера связан с целевым объектом вычислений, доступным в этой рабочей области. Дополнительные сведения см. в статьях [создание рабочих областей машинное обучение Azure и управление ими в портал Azure](./how-to-manage-workspace.md) или [целевые объекты вычислений в машинное обучение Azure?](./concept-compute-target.md).

### <a name="a-simple-python-pipeline"></a>Простой конвейер Python

В этом фрагменте кода показаны объекты и вызовы, необходимые для создания и выполнения `Pipeline` :

```python
ws = Workspace.from_config() 
blob_store = Datastore(ws, "workspaceblobstore")
compute_target = ws.compute_targets["STANDARD_NC6"]
experiment = Experiment(ws, 'MyExperiment') 

input_data = Dataset.File.from_files(
    DataPath(datastore, '20newsgroups/20news.pkl'))

dataprep_step = PythonScriptStep(
    name="prep_data",
    script_name="dataprep.py",
    compute_target=cluster,
    arguments=[input_dataset.as_named_input('raw_data').as_mount(), dataprep_output]
    )
output_data = OutputFileDatasetConfig()
input_named = input_data.as_named_input('input')

steps = [ PythonScriptStep(
    script_name="train.py",
    arguments=["--input", input_named.as_download(), "--output", output_data],
    compute_target=compute_target,
    source_directory="myfolder"
) ]

pipeline = Pipeline(workspace=ws, steps=steps)

pipeline_run = experiment.submit(pipeline)
pipeline_run.wait_for_completion()
```

Фрагмент кода начинается с общих Машинное обучение Azure объектов,, a, `Workspace` `Datastore` [ComputeTarget](/python/api/azureml-core/azureml.core.computetarget?preserve-view=true&view=azure-ml-py)и `Experiment` . Затем код создает объекты для хранения `input_data` и `output_data` . `input_data`Является экземпляром [филедатасет](https://docs.microsoft.com/python/api/azureml-core/azureml.data.filedataset?view=azure-ml-py&preserve-view=true) , а `output_data` — экземпляром [аутпутфиледатасетконфиг](https://docs.microsoft.com/python/api/azureml-core/azureml.data.output_dataset_config.outputfiledatasetconfig?view=azure-ml-py&preserve-view=true). Для `OutputFileDatasetConfig` поведения по умолчанию необходимо скопировать выходные данные в хранилище данных по `workspaceblobstore` пути `/dataset/{run-id}/{output-name}` , где `run-id` — идентификатор выполнения, а `output-name` — автоматически формируемое значение, если оно не указано разработчиком.

Массив `steps` содержит один элемент, `PythonScriptStep` который будет использовать объекты данных и выполняется в `compute_target` . Затем код создает экземпляр `Pipeline` самого объекта, передавая в него рабочую область и массив шагов. Вызов начинается с `experiment.submit(pipeline)` запуска конвейера машинного обучения Azure. Вызов `wait_for_completion()` блокируется до завершения конвейера. 

Дополнительные сведения о подключении конвейера к данным см. в статьях [доступ к данным в машинное обучение Azure](concept-data.md) и [Перемещение данных между этапами конвейера ml (Python)](how-to-move-data-in-out-of-pipelines.md). 

## <a name="building-pipelines-with-the-designer"></a>Создание конвейеров с помощью конструктора

Разработчики, предпочитающие визуальную область конструктора, могут использовать конструктор Машинное обучение Azure для создания конвейеров. Доступ к этому средству можно получить с помощью выбора **конструктора** на домашней странице рабочей области.  Конструктор позволяет перетаскивать шаги в область конструктора. 

При визуальном проектировании конвейеров входные и выходные данные шага отображаются как видимые. Можно перетаскивать подключения к данным, что позволяет быстро понять и изменить поток данных конвейера.

![Пример конструктора Машинного обучения Azure](./media/concept-designer/designer-drag-and-drop.gif)

## <a name="key-advantages"></a>Ключевые преимущества

Основные преимущества использования конвейеров для рабочих процессов машинного обучения:

|Ключевое преимущество|Описание|
|:-------:|-----------|
|**Автоматические&nbsp;выполнения**|Планирование выполнения шагов параллельно или в последовательности в надежном и автоматическом режиме. Подготовка и моделирование данных могут быть за последние дни или недели, а Конвейеры позволяют сосредоточиться на других задачах во время выполнения процесса. |
|**Разнородных вычислений**|Используйте несколько конвейеров, которые надежно скоординированы между разнородными и масштабируемыми вычислительными ресурсами и местами хранения. Эффективно используйте доступные вычислительные ресурсы, выполняя отдельные этапы конвейера для различных целевых объектов вычислений, таких как HDInsight, виртуальные машины обработки и анализа данных GPU, а также кирпичы.|
|**Возможность многократного использования**|Создание шаблонов конвейера для конкретных сценариев, таких как переобучение и пакетная оценка. Активация опубликованных конвейеров из внешних систем с помощью простых вызовов RESTFUL.|
|**Отслеживание и управление версиями**|Вместо отслеживания данных и папок результатов вручную при выполнении итераций используйте пакет SDK для конвейеров, чтобы присваивать имена и определять версии источников данных, входных и выходных данных. Вы можете также отдельно управлять сценариями и данными для повышения эффективности.|
| **Модульность** | Отделение областей проблем и изоляция изменений позволяет программному обеспечению развиваться быстрее с более высоким качеством. | 
|**Совместная работа**|Конвейеры позволяют специалистам по обработке и анализу данных совместно работать во всех областях процесса разработки машинного обучения, в то же время одновременно работая с этапами конвейера.|

## <a name="next-steps"></a>Дальнейшие действия

Конвейеры машинного обучения Azure — это мощное средство, которое начинает доставку ценности на стадии раннего развертывания. Значение увеличивается по мере роста группы и проекта. В этой статье объясняется, как указать конвейеры с помощью пакета SDK для Машинное обучение Azure Python и в Azure. Вы увидели простой исходный код и предоставили несколько `PipelineStep` доступных классов. Вы должны иметь представление о том, когда следует использовать конвейеры машинного обучения Azure и как они работают в Azure. 


+ Узнайте, как [создать свой первый конвейер](how-to-create-your-first-pipeline.md).

+ Узнайте, как [выполнять пакетные прогнозы для больших данных](tutorial-pipeline-batch-scoring-classification.md ).

+ См. справочную документацию по пакету SDK и [этапам](/python/api/azureml-pipeline-steps/?preserve-view=true&view=azure-ml-py) [конвейера](/python/api/azureml-pipeline-core/?preserve-view=true&view=azure-ml-py) .

+ Ознакомьтесь с примерами записных книжек Jupyter, демонстрирующими [машинное обучение Azure конвейеры](https://github.com/Azure/MachineLearningNotebooks/blob/master/how-to-use-azureml/machine-learning-pipelines). Узнайте, как [запускать записные книжки для изучения этой службы](samples-notebooks.md).
