---
title: Руководство по Развертывание моделей Машинного обучения с помощью конструктора
titleSuffix: Azure Machine Learning
description: Создайте решение для прогнозной аналитики в конструкторе Машинного обучения Azure. Обучение, оценка и развертывание модели машинного обучения с помощью перетаскиваемых модулей.
author: likebupt
ms.author: keli19
services: machine-learning
ms.service: machine-learning
ms.subservice: core
ms.topic: tutorial
ms.date: 01/15/2021
ms.custom: designer
ms.openlocfilehash: ec563371ab505113117707f56c31f506f7fdf377
ms.sourcegitcommit: b4647f06c0953435af3cb24baaf6d15a5a761a9c
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/02/2021
ms.locfileid: "101659521"
---
# <a name="tutorial-deploy-a-machine-learning-model-with-the-designer"></a>Руководство по развертыванию модели машинного обучения с помощью конструктора


Чтобы другие пользователи могли применить модель прогнозирования, которую вы создали по инструкциям из [первой части этого руководства](tutorial-designer-automobile-price-train-score.md), разверните модель. В первой части вы обучили модель. Теперь пора создать прогнозы на основе вводимых пользователем данных. В этой части руководства вы выполните следующее:

> [!div class="checklist"]
> * Создание конвейера вывода в режиме реального времени.
> * Создание кластера вывода.
> * Развертывание конечной точки в режиме реального времени.
> * Тестирование конечной точки в режиме реального времени.

## <a name="prerequisites"></a>Предварительные требования

Изучите [первую часть учебника](tutorial-designer-automobile-price-train-score.md), чтобы узнать, как обучать и оценивать модель машинного обучения в конструкторе.

[!INCLUDE [machine-learning-missing-ui](../../includes/machine-learning-missing-ui.md)]

## <a name="create-a-real-time-inference-pipeline"></a>Создание конвейера вывода в реальном времени

Чтобы развернуть конвейер, сначала преобразуйте обучающий конвейер в конвейер вывода в режиме реального времени. В этом процессе удаляются обучающие модули и добавляются входные и выходные данные веб-службы для обработки запросов.

### <a name="create-a-real-time-inference-pipeline"></a>Создание конвейера вывода в реальном времени

1. Над холстом конвейера выберите **Create inference pipeline (Создать конвейер вывода)**  > **Real-time inference pipeline (Конвейер вывода в режиме реального времени)** .

    :::image type="content" source="./media/tutorial-designer-automobile-price-deploy/tutorial2-create-inference-pipeline.png" alt-text="Снимок экрана, на котором показано, где найти кнопку для создания конвейера":::

    Теперь этот конвейер будет выглядеть следующим образом: 

   ![Снимок экрана: ожидаемая конфигурация конвейера после его подготовки к развертыванию](./media/tutorial-designer-automobile-price-deploy/real-time-inference-pipeline.png)

    При нажатии кнопки **Create inference pipeline** (Создать конвейер вывода) произойдет несколько вещей:
    
    * Обученная модель будет сохранена в виде модуля **Набор данных** в палитре модулей. Его можно найти в разделе **My Datasets** (Мои наборы данных).
    * Удаляются такие обучающие модули, как **Train Model** (Обучение модели) и **Split Data** (Разделение данных).
    * Сохраненная обученная модель добавляется обратно в конвейер.
    * Добавляются модули **Web Service Input** (Входные данные веб-службы) и **Web Service Output** (Выходные данные веб-службы). В этих модулях показано, откуда пользовательские данные поступают в конвейер и куда они возвращаются.

    > [!NOTE]
    > По умолчанию **входные данные веб-службы** должны иметь ту же схему данных, что и данные для обучения, используемые для создания прогнозного конвейера. В этом сценарии стоимость включена в схему. Однако стоимость не используется в качестве фактора во время прогнозирования.
    >

1. Выберите **Отправить** и используйте тот же целевой объект вычислений и эксперимент, который использовался в первой части.

    При первом запуске для завершения работы конвейера может потребоваться 20 минут. В параметрах вычислений по умолчанию минимальный размер узла равен 0. Это означает, что конструктор должен выделить ресурсы после простоя. Последующие выполнения конвейера займут меньше времени, так как ресурсы вычислений уже будут выделены. Кроме того, конструктор использует кэшированные результаты для каждого модуля, чтобы повысить эффективность.

1. Выберите **Развернуть**.

## <a name="create-an-inferencing-cluster"></a>Создание кластера вывода

Для развертывания модели можно выбрать любой кластер Службы Azure Kubernetes (AKS) в открывшемся диалоговом окне. Если у вас нет кластера AKS, создайте его, сделав следующее.

1. В открывшемся диалоговом окне выберите **Вычисления**, чтобы перейти к странице **Вычисления**.

1. В ленте навигации выберите **Inference Clusters** (Кластеры вывода)  >  **+ Создать**.

    ![Снимок экрана, показывающий, как переходить в новую область кластера вывода](./media/tutorial-designer-automobile-price-deploy/new-inference-cluster.png)
   
1. В области кластера вывода настройте новую службу Kubernetes.

1. Введите *aks-compute* в поле **Имя вычислений**.
    
1. Выберите ближайший регион, доступный для модуля **Регион**.

1. Нажмите кнопку **создания**.

    > [!NOTE]
    > Создание службы AKS занимает около 15 минут. Состояние подготовки можно проверить на странице **Inference Clusters** (Кластеры вывода).
    >

## <a name="deploy-the-real-time-endpoint"></a>Развертывание конечной точки для прогнозирования в реальном времени

После завершения подготовки службы AKS вернитесь к конвейеру вывода в режиме реального времени для завершения развертывания.

1. Выберите **Развернуть** над холстом.

1. Выберите **Deploy new real-time endpoint** (Развертывание новой конечной точки для прогнозирования в реальном времени). 

1. Выберите созданный кластер AKS.

    :::image type="content" source="./media/tutorial-designer-automobile-price-deploy/setup-endpoint.png" alt-text="Снимок экрана, показывающий, как настроить новую конечную точку для прогнозирования в реальном времени":::

    Кроме того, вы можете изменить параметр **Дополнительно** для своей конечной точки для прогнозирования в реальном времени.
    
    |Расширенный параметр|Описание|
    |---|---|
    |Включить сбор данных и диагностику Application Insights| Определяет, следует ли разрешить Azure Application Insights сбор данных из развернутых конечных точек. </br> Значение по умолчанию: false |
    |Время ожидания оценки| Принудительное время ожидания вызовов оценки веб-службы (в миллисекундах).</br>По умолчанию: 60 000|
    |Автоматическое масштабирование включено|   Позволяет указать, нужно ли включить автомасштабирование для веб-службы.</br>Значение по умолчанию: true|
    |Минимум реплик| Минимальное число используемых контейнеров при автомасштабировании этой веб-службы.</br>По умолчанию: 1|
    |Максимум реплик| Максимальное число используемых контейнеров при автомасштабировании этой веб-службы.</br> По умолчанию: 10|
    |Целевое использование|Целевой объем использования, который нужно пытаться поддерживать при автомасштабировании этой веб-службы (в процентах до 100).</br> По умолчанию: 70|
    |Период обновления|Частота попыток автомасштабирования этой веб-службы (в секундах).</br> По умолчанию: 1|
    |Резервная мощность ЦП|Количество ядер ЦП, выделяемых для этой веб-службы.</br> По умолчанию: 0,1|
    |Резервная мощность памяти|Объем памяти (в ГБ), выделяемой для этой веб-службы.</br> По умолчанию: 0,5|
        

1. Выберите **Развернуть**. 

    После завершения развертывания в приложении на основе холста появится уведомление об успешном выполнении. Это может занять несколько минут.

> [!TIP]
> Кроме того, можно выполнить развертывание в **экземпляр контейнера Azure** (ACI). Для этого выберите элемент **Экземпляр контейнера Azure** в качестве **типа вычислений** в поле параметров конечной точки для прогнозирования в реальном времени.
> Экземпляр контейнера Azure используется для тестирования или разработки. Используйте ACI для небольших рабочих нагрузок на основе ЦП, которым требуется менее 48 ГБ ОЗУ.

## <a name="test-the-real-time-endpoint"></a>Тестирование конечной точки для прогнозирования в реальном времени

После развертывания вы можете просмотреть конечную точку для прогнозирования в реальном времени. Для этого перейдите к странице **Конечные точки**.

1. На странице **Конечные точки** выберите развернутую конечную точку.

    На вкладке **Сведения** можно просмотреть дополнительную информацию, такую как URI REST, определение Swagger, сведения о состоянии и теги.

    На вкладке **Использование** можно найти пример кода использования, ключи безопасности и задать методы аутентификации.

    На вкладке **Журналы развертывания** можно найти подробные журналы с данными о развертывании конечной точки для прогнозирования в реальном времени.

1. Чтобы проверить конечную точку, перейдите на вкладку **Тестирование**. Здесь можно ввести тестовые данные и выбрать **Тестировать**, чтобы проверить выходные данные конечной точки.

Дополнительные сведения см. в статье об [использовании модели, развернутой как веб-служба](how-to-consume-web-service.md).

## <a name="limitations"></a>Ограничения

Если вы внесете изменения в конвейер обучения, вам потребуется повторно отправить конвейер обучения, **обновить** конвейер вывода и еще раз запустить его.

Учтите, что в конвейере вывода будут обновлены только обученные модели, без преобразований данных.

Чтобы использовать обновленное преобразование в конвейере вывода, вам потребуется зарегистрировать выходные данные преобразования, предоставленные модулем преобразования, в виде набора данных.

![Снимок экрана: как зарегистрировать набор данных преобразования](./media/tutorial-designer-automobile-price-deploy/register-transformation-dataset.png)

Затем вручную замените модуль **TD-** в конвейере вывода зарегистрированным набором данных.

![Снимок экрана: как заменить модуль преобразования](./media/tutorial-designer-automobile-price-deploy/replace-td-module.png)

Затем вы можете отправить конвейер вывода с обновленной моделью и преобразованием и выполнить развертывание.

## <a name="clean-up-resources"></a>Очистка ресурсов

[!INCLUDE [aml-ui-cleanup](../../includes/aml-ui-cleanup.md)]

## <a name="next-steps"></a>Дальнейшие действия

В этом учебнике вы узнали как создать, развернуть и использовать модели машинного обучения в конструкторе. Дополнительные сведения об использовании конструктора см. по следующим ссылкам:

+ [Примеры из конструктора:](samples-designer.md) узнайте, как использовать конструктор для решения других типов проблем.
+ [Использование Студии машинного обучения Azure в виртуальной сети Azure.](how-to-enable-studio-virtual-network.md)
