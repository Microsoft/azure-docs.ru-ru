---
title: Тестирование кода обработки и анализа данных с помощью Azure DevOps Services — командный процесс обработки и анализа данных
description: Тестирование кода обработки и анализа данных в Azure на примере набора данных UCI для прогнозирования дохода совершеннолетних лиц с помощью командного процесса обработки и анализа данных и Azure DevOps Services
services: machine-learning
author: marktab
manager: marktab
editor: marktab
ms.service: machine-learning
ms.subservice: team-data-science-process
ms.topic: article
ms.date: 01/10/2020
ms.author: tdsp
ms.custom: seodec18, previous-author=weig, previous-ms.author=weig
ms.openlocfilehash: 66853b580ba1b619bf4cc995e05bd3cfaff07cfb
ms.sourcegitcommit: 7edadd4bf8f354abca0b253b3af98836212edd93
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/10/2021
ms.locfileid: "102565875"
---
# <a name="data-science-code-testing-on-azure-with-the-team-data-science-process-and-azure-devops-services"></a>Тестирование кода обработки и анализа данных в Azure с помощью командного процесса обработки и анализа данных и Azure DevOps Services
В этой статье приведены предварительные рекомендации по тестированию кода в рабочем потоке обработки и анализа данных. Такое тестирование предоставляет специалистам по обработке и анализу данных системный и эффективный способ проверки качества и ожидаемого результата выполнения созданного кода. Мы продемонстрируем тестирование кода на примере [проекта для командного процесса обработки и анализа данных (TDSP), основанного на наборе данных UCI с данными о доходе совершеннолетних лиц](https://github.com/Azure/MachineLearningSamples-TDSPUCIAdultIncome), который мы опубликовали ранее. 

## <a name="introduction-on-code-testing"></a>Общие сведения о тестировании кода
В отрасли программного обеспечения уже долгое время стандартом считается "Модульное тестирование". Но для обработки и анализа данных часто неясно, что означает модульное тестирование, и как следует тестировать код на различных стадиях жизненного цикла обработки и анализа данных, например:

* Подготовка данных
* анализ качества данных;
* Моделирование
* Развертывание модели 

В этой статье вместо "модульного тестирования" мы используем термин "тестирование кода". Этим мы хотим подчеркнуть, что тестирование должно определить, предоставляет ли код "полностью ожидаемые" данные на конкретном этапе жизненного цикла обработки и анализа данных. Специалист, создающий тест, должен определить "ожидаемый" результат по конкретному назначению функции (например, проверка качества данных или моделирование).

Эта статья содержит ссылки на полезные ресурсы.

## <a name="azure-devops-for-the-testing-framework"></a>Azure DevOps для платформы тестирования
В этой статье описывается выполнение и автоматизация тестирования с помощью Azure DevOps. Вы можете использовать другие средства. Также мы продемонстрируем, как настроить автоматическую сборку на основе Azure DevOps и агентов сборки. В качестве агентов сборки мы применяем виртуальные машины для обработки и анализа данных Azure (DSVM).

## <a name="flow-of-code-testing"></a>Поток тестирования кода
Общий рабочий процесс тестирования кода в проекте обработки и анализа данных выглядит следующим образом: 

![Схема потока тестирования кода](./media/code-test/test-flow-chart.PNG)

    
## <a name="detailed-steps"></a>Подробные инструкции

Выполните следующие действия, чтобы установить и запустить систему тестирования кода и автоматизированной сборки с помощью агента сборки и Azure DevOps.

1. Создайте в Visual Studio проект классического приложения:

    ![Экран "Создание проекта" в Visual Studio](./media/code-test/create_project.PNG)

   Завершив создание проекта, вы сможете найти его на правой панели обозревателя решений:
    
    ![Процесс создания проекта](./media/code-test/create_python_project_in_vs.PNG)

    ![Обозреватель решений](./media/code-test/solution_explorer_in_vs.PNG)

1. Передайте код проекта в репозиторий кода проекта Azure DevOps: 

    ![Репозиторий кода проекта](./media/code-test/create_repo.PNG)

1. Предположим, вы уже выполнили некоторые действия для подготовки данных: прием данных, проектирование функций и создание меток столбцов. Теперь вы хотите убедиться, что выполнение этого кода дает ожидаемые результаты. Вот пример кода, для которого можно выполнить тестирование и определить, правильно ли он обрабатывает данные:

    * Убедитесь, что создаются правильные имена столбцов:
    
      ![Код для сопоставления имен столбцов](./media/code-test/check_column_names.PNG)

    * Убедитесь, что установлены правильные уровни ответа:

      ![Код для сопоставления уровней](./media/code-test/check_response_levels.PNG)

    * Убедитесь, что получен обоснованный процент ответов:

      ![Код для процента ответов](./media/code-test/check_response_percentage.PNG)

    * Проверьте долю отсутствия данных для каждого столбца данных:
    
      ![Код для отсутствия данных](./media/code-test/check_missing_rate.PNG)


1. Завершив обработку данных и проектирование функций, а затем обучение эффективной модели, нужно проверить эту модель на правильность оценки для новых наборов данных. Следующие два теста позволят проверить уровни прогноза и распределение значений меток:

    * Проверка уровней прогноза:
    
      ![Код для проверки уровней прогноза](./media/code-test/check_prediction_levels.PNG)

    * Проверка распределения прогнозируемых значений:

      ![Код для проверки прогнозируемых значений](./media/code-test/check_prediction_values.PNG)

1. Соберите все тестовые функции в один скрипт Python с именем **test_funcs.py**:

    ![Скрипт Python с функциями тестирования](./media/code-test/create_file_test_func.PNG)


1. Завершив подготовку кода для тестирования, переходите к настройке среды тестирования в Visual Studio.

   Создайте файл Python с именем **test1.py**. В этом файле создайте класс, который включает все нужные тесты. Следующий пример содержит шесть подготовленных тестов:
    
    ![Файл Python со списком тестов в классе](./media/code-test/create_file_test1_class.PNG)

1. Эти тесты будут обнаруживаться автоматически, если вы укажете метку **codetest.testCase** после имени класса. Откройте обозреватель тестов в области справа и выберите **Run All** (Запустить все). Все тесты будут последовательно выполнены, и вы получите сведения об их успешности.

    ![Выполнение тестов](./media/code-test/run_tests.PNG)

1. Зарегистрируйте код в репозитории проекта с помощью команд Git. Новейшая версия вскоре появится в Azure DevOps.

    ![Команды Git для регистрации кода](./media/code-test/git_check_in.PNG)

    ![Новейшие версии в Azure DevOps](./media/code-test/git_check_in_most_recent_work.PNG)

1. Настройте автоматическую сборку и тестирование в Azure DevOps:

    a. В репозитории проекта выберите **Build and Release** (Сборка и выпуск), а затем щелкните **+Создать**, чтобы создать процесс сборки.

    ![Выбранные параметры для запуска нового процесса сборки](./media/code-test/create_new_build.PNG)

    b. Следуйте инструкциям на экране, чтобы выбрать расположение исходного кода, имя проекта, репозиторий и сведения о ветви.
    
    ![Источник, имя, репозиторий и сведения о ветви](./media/code-test/fill_in_build_info.PNG)

    c. Выберите шаблон. Так как у нас нет готового шаблона для проектов Python, выберите вариант **Пустой процесс**. 

    ![Список шаблонов и кнопка "Пустой процесс"](./media/code-test/start_empty_process_template.PNG)

    d. Присвойте сборке имя и выберите агент. Вы можете выбрать значение по умолчанию, если вы хотите использовать DSVM для завершения процесса сборки. Дополнительные сведения о настройке агентов см. в статье [Build and Release Agents](/azure/devops/pipelines/agents/agents) (Агенты сборки и выпуска).
    
    ![Настройки для сборки и агента](./media/code-test/select_agent.PNG)

    д) Выберите **+** в левой области, чтобы добавить задачу для этого этапа сборки. Поскольку мы запустим сценарий Python **test1.py** для выполнения всех проверок, эта задача использует команду PowerShell для выполнения кода Python.
    
    ![Область "Добавить задачи" с выбранным элементом PowerShell](./media/code-test/add_task_powershell.PNG)

    е) В области сведений о PowerShell укажите обязательные параметры, например имя и версию PowerShell. Выберите тип **Встроенный сценарий**. 
    
    В поле под заголовком **Встроенный сценарий** введите строку **python test1.py**. Убедитесь, для Python правильно настроена переменная среды. Если вы хотите использовать другую версию или другое ядро Python, укажите путь к ним явным образом, как показано на изображении: 
    
    ![Сведения о PowerShell](./media/code-test/powershell_scripts.PNG)

    ж. Выберите **сохранить & очередь** , чтобы завершить процесс сборки конвейера.

    ![Кнопка Save & queue (Сохранить и поместить в очередь)](./media/code-test/save_and_queue_build_definition.PNG)

Теперь при каждой новой фиксации в репозитории кода будет автоматически запускаться процесс сборки Можно определить любую ветвь. Этот процесс запускает на компьютере агента файл **test1.py**, который проверяет, правильно ли выполняются все определенные в коде действия. 

Если оповещения настроены верно, по завершении сборки вы получите сообщение по электронной почте. Также состояние сборки можно проверить в Azure DevOps. В случае неудачи вам будут предоставлены подробные сведения о сборке, позволяющие найти проблемный элемент.

![Сообщение по электронной почте об успешной сборке](./media/code-test/email_build_succeed.PNG)

![Уведомление в Azure DevOps об успешной сборке](./media/code-test/vs_online_build_succeed.PNG)

## <a name="next-steps"></a>Дальнейшие действия
* В [репозитории прогноза доходов UCI](https://github.com/Azure/MachineLearningSamples-TDSPUCIAdultIncome) представлены конкретные примеры модульных тестов для сценариев обработки и анализа данных.
* Выполните приведенные выше рекомендации и примеры для сценария прогнозирования доходов UCI в собственных проектах обработки и анализа данных.

## <a name="references"></a>Ссылки
* [Командный процесс обработки и анализа данных](./index.yml)
* [Средства тестирования для Visual Studio](https://www.visualstudio.com/vs/features/testing-tools/)
* [Ресурсы для тестирования в Azure DevOps](https://www.visualstudio.com/team-services/)
* [Виртуальная машина для обработки и анализа данных](https://azure.microsoft.com/services/virtual-machines/data-science-virtual-machines/)