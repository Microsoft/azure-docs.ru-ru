---
title: API обнаружения аномалий в Машинном обучении Azure в процессе обработки и анализа данных группы
description: API обнаружения аномалий — это встроенный в Машинное обучение Microsoft Azure пример API, который обнаруживает аномалии в данных временных рядов и предоставляет результаты в виде числовых значений, равномерно распределенных по времени.
services: machine-learning
author: marktab
manager: marktab
editor: marktab
ms.service: machine-learning
ms.subservice: team-data-science-process
ms.topic: article
ms.date: 01/10/2020
ms.author: tdsp
ms.custom: seodec18, previous-author=alokkirpal, previous-ms.author=alok
ms.openlocfilehash: e210c1683d5f14181bc0549e73a892eb91d2e746
ms.sourcegitcommit: f28ebb95ae9aaaff3f87d8388a09b41e0b3445b5
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/30/2021
ms.locfileid: "93305700"
---
# <a name="machine-learning-anomaly-detection-api"></a>API обнаружения аномалий в машинном обучении

> [!NOTE]
> Этот элемент находится на обслуживании. Мы рекомендуем использовать [службу API Детектора аномалий](https://azure.microsoft.com/services/cognitive-services/anomaly-detector/) на основе коллекции алгоритмов Машинного обучения в Azure Cognitive Services, чтобы обнаруживать аномалии для бизнес-метрик, операционных метрик и метрик Интернета вещей.

## <a name="overview"></a>Обзор
[API обнаружения аномалий](https://gallery.azure.ai/MachineLearningAPI/Anomaly-Detection-2) — это пример, построенный на базе машинного обучения Azure, который обнаруживает аномалии в данных временных рядов, содержащих равномерно распределенные по времени числовые значения.

Этот интерфейс может обнаруживать следующие типы аномалий в данных временных рядов:

* **Положительные и отрицательные тенденции**. Например, положительной тенденцией в вычислении является мониторинг использования памяти, который может быть важным признаком утечки памяти.
* **Изменение динамического диапазона значений**. Например, при мониторинге исключений, инициированных облачной службой, любое изменение динамического диапазона значений свидетельствует о нестабильности работоспособности службы.
* **Пики и спады**. Например, при мониторинге количества неудачных входов в службу или количества оформления заказов на сайте электронной коммерции пики и спады помогают обнаружить ненормальное поведение.

Эти средства обнаружения машинного обучения отслеживают изменения в значениях с течением времени и сообщают о текущих изменениях значений в виде показателей аномалий. Они не требуют прямой настройки пороговых значений, и их оценки можно использовать для управления ложноположительными результатами. API обнаружения аномалий удобно использовать в некоторых сценариях, например при мониторинге служб путем отслеживания ключевых показателей эффективности с течением времени, мониторинге использования на основе метрик (таких как количество поисковых запросов, количество щелчков), мониторинге производительности с помощью счетчиков (таких как память, ЦП, операции считывания файлов) и т. д. с течением времени.

Предложение по обнаружению аномалий поставляется с полезными средствами, которые помогут вам начать работу.

* [Веб-приложение](https://anomalydetection-aml.azurewebsites.net/) позволяет оценить и визуализировать результаты интерфейсов API обнаружения аномалий в данных.

> [!NOTE]
> Попробуйте **ИТ-решение аналитики аномалий** на базе [этого API](https://gallery.azure.ai/MachineLearningAPI/Anomaly-Detection-2)
>
<!-- This Solution is no longer available
> To get this end to end solution deployed to your Azure subscription <a href="https://gallery.cortanaintelligence.com/Solution/Anomaly-Detection-Pre-Configured-Solution-1" target="_blank">**Start here >**</a>
-->

## <a name="api-deployment"></a>Развертывание API
Чтобы использовать API-интерфейс, необходимо развернуть его в подписке Azure. Он будет размещаться там в роли веб-службы машинного обучения Azure.  Это можно сделать в [коллекции решений ИИ Azure](https://gallery.azure.ai/MachineLearningAPI/Anomaly-Detection-2).  В результате в подписке Azure будут развернуты две веб-службы Студии машинного обучения Azure (классическая) (и соответствующие ресурсы). Одна из них используется для обнаружения аномалий и сезонности, а вторая работает без обнаружения сезонности.  Когда завершится развертывание, этими интерфейсами API можно будет управлять на странице [веб-служб Студии машинного обучения Azure (классическая)](https://services.azureml.net/webservices/).  На этой странице вы можете найти расположения конечных точек, ключи API и примеры кода для вызова API.  Более подробные инструкции см. [здесь](../classic/manage-new-webservice.md).

## <a name="scaling-the-api"></a>Масштабирование API
По умолчанию для развертывания применяется бесплатный тарифный план для разработки и тестирования, который предоставляет 1000 транзакций и 2 часа вычислений ежемесячно.  Этот план вы можете сменить на любой другой в соответствии с потребностями.  Сведения о ценах на разные планы приводятся [на этой странице](https://azure.microsoft.com/pricing/details/machine-learning/) в разделе "Цены на производственный веб-API".

## <a name="managing-aml-plans"></a>Управление планами AML
Управление тарифным планом осуществляется [здесь](https://services.azureml.net/plans/).  Имя плана формируется на основе имени группы ресурсов, которую вы выберете при развертывании API. К нему добавляется строка, используемая только для вашей подписки.  Инструкции по обновлению плана можно найти [на этой странице](../classic/manage-new-webservice.md) в разделе "Управление планами выставления счетов".

## <a name="api-definition"></a>Определение интерфейса API
Эта веб-служба предоставляет API-интерфейс REST по протоколу HTTPS, который можно использовать различными способами, в том числе в мобильном или веб-приложении, R, Python, Excel и т. д.  В эту службу отправляются данные временных рядов путем вызова REST API, который запускает средства для трех типов аномалий, описанные ниже.

## <a name="calling-the-api"></a>Вызов интерфейса API
Чтобы вызвать API, вам нужно знать расположение его конечной точки и ключ API.  Оба этих компонента можно получить на странице [веб-служб Студии машинного обучения (классическая)](https://services.azureml.net/webservices/). Там же вы найдете пример кода для вызова API.  Чтобы получить эти сведения, перейдите к нужному API и щелкните вкладку "Использование".  Этот API можно вызвать как API с поддержкой Swagger (т. е. с использованием параметра `format=swagger` в URL-адресе) или без поддержки Swagger (т. е. без параметра `format` в URL-адресе).  В приведенных примерах кода используется формат Swagger.  Ниже представлен пример запроса и ответа без поддержки Swagger.  В этих примерах обращение выполняется к конечной точке с поддержкой сезонности.  Для другой конечной точки все выглядит точно так же.

### <a name="sample-request-body"></a>Пример текста запроса
Этот запрос содержит два объекта: `Inputs` и `GlobalParameters`.  В следующем примере запроса некоторые параметры передаются в явном виде, а другие — нет (прокрутите его вниз до полного списка параметров для каждой конечной точки).  Для параметров, которые не отправляются в запросе в явном виде, будут использоваться приведенные ниже значения по умолчанию.

```json
{
            "Inputs": {
                    "input1": {
                            "ColumnNames": ["Time", "Data"],
                            "Values": [
                                    ["5/30/2010 18:07:00", "1"],
                                    ["5/30/2010 18:08:00", "1.4"],
                                    ["5/30/2010 18:09:00", "1.1"]
                            ]
                    }
            },
    "GlobalParameters": {
        "tspikedetector.sensitivity": "3",
        "zspikedetector.sensitivity": "3",
        "bileveldetector.sensitivity": "3.25",
        "detectors.spikesdips": "Both"
    }
}
```

### <a name="sample-response"></a>Пример ответа
Чтобы увидеть поле `ColumnNames`, необходимо включить в запрос параметр URL-адреса `details=true`.  В следующих таблицах описано назначение каждого из этих полей.

```json
{
    "Results": {
        "output1": {
            "type": "table",
            "value": {
                "Values": [
                    ["5/30/2010 6:07:00 PM", "1", "1", "0", "0", "-0.687952590518378", "0", "-0.687952590518378", "0", "-0.687952590518378", "0"],
                    ["5/30/2010 6:08:00 PM", "1.4", "1.4", "0", "0", "-1.07030497733224", "0", "-0.884548154298423", "0", "-1.07030497733224", "0"],
                    ["5/30/2010 6:09:00 PM", "1.1", "1.1", "0", "0", "-1.30229513613974", "0", "-1.173800281031", "0", "-1.30229513613974", "0"]
                ],
                "ColumnNames": ["Time", "OriginalData", "ProcessedData", "TSpike", "ZSpike", "BiLevelChangeScore", "BiLevelChangeAlert", "PosTrendScore", "PosTrendAlert", "NegTrendScore", "NegTrendAlert"],
                "ColumnTypes": ["DateTime", "Double", "Double", "Double", "Double", "Double", "Int32", "Double", "Int32", "Double", "Int32"]
            }
        }
    }
}
```


## <a name="score-api"></a>API оценки
С помощью API оценки можно обнаруживать аномалии в данных временных рядов, которые не являются сезонными. API запускает несколько средств обнаружения аномалий в данных и возвращает соответствующие показатели аномалий.
На рисунке ниже показан пример аномалий, которые может обнаружить API оценки. В этом временном ряду есть два отчетливых изменения уровня и три пика. Красными точками обозначено время обнаружения изменений уровня, а черными точками — обнаруженные пики.
![API оценки][1]

### <a name="detectors"></a>Средства обнаружения
API обнаружения аномалий поддерживает средства обнаружения, которые подразделяются на три обширные категории. Сведения об определенных входных параметрах и выходных данных для каждого средства обнаружения представлены в следующей таблице.

| Категория средства обнаружения | Средство обнаружения | Описание | Входные параметры | Выходные данные |
| --- | --- | --- | --- | --- |
| Средства обнаружения пиков |Средства обнаружения пиков TSpike |Обнаружение пиков и спадов на основе удаленности значений от первой и третьей квартилей |*tspikedetector.sensitivity:* принимает целое значение в диапазоне от 1 до 10, по умолчанию: 3. Более высокие значения перехватывают больше предельных значений, тем самым делая их менее чувствительными |TSpike: двоичные значения — 1 при обнаружении пика или спада, в противном случае — 0. |
| Средства обнаружения пиков | Средства обнаружения пиков ZSpike |Обнаружение пиков и спадов на основе удаленности точек данных от среднего значения |*zspikedetector.sensitivity:* принимает значение целого числа в диапазоне от 1 до 10, по умолчанию: 3. Более высокие значения перехватывают больше предельных значений, тем самым делая их менее чувствительными |ZSpike: двоичные значения — 1 при обнаружении пика или спада, в противном случае — 0. |
| Средство обнаружения медленно развивающихся тенденций |Средство обнаружения медленно развивающихся тенденций |Обнаружение медленно развивающихся положительных тенденций согласно чувствительности набора |*trenddetector.sensitivity:* пороговое значение оценки средства обнаружения (по умолчанию: 3,25; 3,25–5 — допустимый диапазон для выбора значения; чем выше, тем меньше чувствительность) |tscore: число с плавающей точкой, которое используется как показатель аномалий в тенденции |
| Средства обнаружения изменений уровня | Средство обнаружения двунаправленных изменений уровня |Обнаружение восходящих и нисходящих изменений уровня согласно чувствительности набора |*bileveldetector.sensitivity:* пороговое значение оценки средства обнаружения (по умолчанию: 3,25; 3,25–5 — допустимый диапазон для выбора значения; чем выше, тем меньше чувствительность) |rpscore: число с плавающей точкой, которое используется как показатель аномалий в восходящем и нисходящем изменении уровня |

### <a name="parameters"></a>Параметры
Подробные сведения об этих входных параметрах представлены в следующей таблице.

| Входные параметры | Описание | Параметр по умолчанию | Тип | Допустимый диапазон значений | Рекомендуемый диапазон значений |
| --- | --- | --- | --- | --- | --- |
| detectors.historywindow |Глубина анализа (количество используемых точек данных) для вычисления показателей аномалий |500 |Целое число |10–2000 |Зависит от временных рядов |
| detectors.spikesdips | Указывает, нужно ли выявлять только пики, только спады, или и то, и другое |both |перечисляемый |Both, Spikes, Dips |both |
| bileveldetector.sensitivity |Чувствительность для средства обнаружения двунаправленных изменений уровня. |3.25 |double |None |3,25–5 (чем меньше значение, тем больше чувствительность) |
| trenddetector.sensitivity |Чувствительность для средства обнаружения положительных тенденций |3.25 |double |None |3,25–5 (чем меньше значение, тем больше чувствительность) |
| tspikedetector.sensitivity |Чувствительность для средства обнаружения пиков TSpike |3 |Целое число |1–10 |3,5–5 (чем меньше значение, тем выше чувствительность) |
| zspikedetector.sensitivity |Чувствительность для средства обнаружения пиков ZSpike |3 |Целое число |1–10 |3,5–5 (чем меньше значение, тем выше чувствительность) |
| postprocess.tailRows |Число последних точек данных, которые нужно сохранить в выходных результатах |0 |Целое число |0 (сохранить все точки данных) или укажите количество точек, которые следует сохранить в результатах |Недоступно |

### <a name="output"></a>Выходные данные
API запускает все средства обнаружения для данных временных рядов и возвращает оценки аномалий, а также показатели пиков в двоичных данных в каждый момент времени. В следующей таблице перечислены выходные данные API.

| Выходные данные | Описание |
| --- | --- |
| Time |Метки времени из необработанных данных или агрегированные (и/или) добавленные данные при применении агрегирования и/или добавления отсутствующих данных |
| Данные |Значения из необработанных данных или агрегированные (и/или) добавленные данные при применении агрегирования и/или добавления отсутствующих данных |
| TSpike |Двоичный показатель обнаружения пика с помощью средства обнаружения пиков TSpike |
| ZSpike |Двоичный показатель обнаружения пика с помощью средства обнаружения пиков ZSpike |
| rpscore |Число с плавающей точкой, которое используется как показатель аномалий в двунаправленном изменении уровня |
| rpalert |Значение 1 или 0, которое указывает на обнаружение аномалий двунаправленного изменения уровня согласно чувствительности входных данных |
| tscore |Число с плавающей точкой, которое используется как показатель аномалий в положительной тенденции |
| talert |Значение 1 или 0, которое указывает на обнаружение аномалий положительной тенденции согласно чувствительности входных данных |

## <a name="scorewithseasonality-api"></a>API ScoreWithSeasonality
API ScoreWithSeasonality позволяет обнаруживать аномалии во временных рядах с сезонными закономерностями. Этот API используется для обнаружения отклонений в сезонных закономерностях.
На следующем рисунке показан пример аномалий, обнаруженных в сезонных временных рядах. Во временных рядах обнаружен один пик (первая черная точка), два спада (вторая и последняя черная точка) и одно изменение уровня (красная точка). Спад посредине временных рядов и изменение уровня становятся четко выраженными только после удаления сезонных компонентов из рядов.
![API сезонности][2]

### <a name="detectors"></a>Средства обнаружения
В конечной точке с поддержкой сезонности используются почти такие же средства обнаружения, как и в конечной точке без поддержки сезонности, но с немного другими именами параметров (перечислены ниже).

### <a name="parameters"></a>Параметры

Подробные сведения об этих входных параметрах представлены в следующей таблице.

| Входные параметры | Описание | Параметр по умолчанию | Тип | Допустимый диапазон значений | Рекомендуемый диапазон значений |
| --- | --- | --- | --- | --- | --- |
| preprocess.aggregationInterval |Интервал агрегации в секундах для агрегирования входных временных рядов |0 (агрегирование не выполняется) |Целое число |0 — агрегирование пропускается, в противном случае используется значение больше 0 |От 5 минут до 1 дня, зависит от временных рядов |
| preprocess.aggregationFunc |Функция, используемая для агрегирования данных в указанный параметр AggregationInterval |mean |перечисляемый |mean, sum, length |Недоступно |
| preprocess.replaceMissing |Значения, используемые для добавления отсутствующих данных |lkv (последнее известное значение) |перечисляемый |zero, lkv, mean |Недоступно |
| detectors.historywindow |Глубина анализа (количество используемых точек данных) для вычисления показателей аномалий |500 |Целое число |10–2000 |Зависит от временных рядов |
| detectors.spikesdips | Указывает, нужно ли выявлять только пики, только спады, или и то, и другое |both |перечисляемый |Both, Spikes, Dips |both |
| bileveldetector.sensitivity |Чувствительность для средства обнаружения двунаправленных изменений уровня. |3.25 |double |None |3,25–5 (чем меньше значение, тем больше чувствительность) |
| postrenddetector.sensitivity |Чувствительность для средства обнаружения положительных тенденций |3.25 |double |None |3,25–5 (чем меньше значение, тем больше чувствительность) |
| negtrenddetector.sensitivity |Чувствительность для средства обнаружения отрицательных тенденций. |3.25 |double |None |3,25–5 (чем меньше значение, тем больше чувствительность) |
| tspikedetector.sensitivity |Чувствительность для средства обнаружения пиков TSpike |3 |Целое число |1–10 |3,5–5 (чем меньше значение, тем выше чувствительность) |
| zspikedetector.sensitivity |Чувствительность для средства обнаружения пиков ZSpike |3 |Целое число |1–10 |3,5–5 (чем меньше значение, тем выше чувствительность) |
| seasonality.enable |Указывает, нужно ли выполнять анализ сезонности |Да |Логическое |true, false |Зависит от временных рядов |
| seasonality.numSeasonality |Максимальное число периодических циклов для обнаружения |1 |Целое число |1, 2 |1–2 |
| seasonality.transform |Указывает, будут ли перед обнаружением аномалий удаляться сезонные компоненты и компоненты тенденций |deseason |перечисляемый |none, deseason, deseasontrend |Недоступно |
| postprocess.tailRows |Число последних точек данных, которые нужно сохранить в выходных результатах |0 |Целое число |0 (сохранить все точки данных) или укажите количество точек, которые следует сохранить в результатах |Недоступно |

### <a name="output"></a>Выходные данные
API запускает все средства обнаружения для данных временных рядов и возвращает оценки аномалий, а также показатели пиков в двоичных данных в каждый момент времени. В следующей таблице перечислены выходные данные API.

| Выходные данные | Описание |
| --- | --- |
| Time |Метки времени из необработанных данных или агрегированные (и/или) добавленные данные при применении агрегирования и/или добавления отсутствующих данных |
| OriginalData |Значения из необработанных данных или агрегированные (и/или) добавленные данные при применении агрегирования и/или добавления отсутствующих данных |
| ProcessedData |Один из следующих параметров: <ul><li>Временные ряды данных с корректировкой сезонных колебаний, если обнаружены существенные сезонные колебания и активирована функция "deseason".</li><li>Временные ряды данных с корректировкой сезонных колебаний и тенденций, если обнаружены существенные сезонные колебания и активирована функция "deseasontrend".</li><li>Во всех остальных случаях параметр совпадает с исходными данными (OriginalData).</li> |
| TSpike |Двоичный показатель обнаружения пика с помощью средства обнаружения пиков TSpike |
| ZSpike |Двоичный показатель обнаружения пика с помощью средства обнаружения пиков ZSpike |
| BiLevelChangeScore |Число с плавающей точкой, которое используется как показатель аномалий в изменении уровня |
| BiLevelChangeAlert |Значение 1 или 0, которое указывает на обнаружение аномалий изменения уровня с учетом чувствительности входных данных |
| PosTrendScore |Число с плавающей точкой, которое используется как показатель аномалий в положительной тенденции |
| PosTrendAlert |Значение 1 или 0, которое указывает на обнаружение аномалий положительной тенденции согласно чувствительности входных данных |
| NegTrendScore |Число с плавающей точкой, которое используется как показатель аномалий в отрицательной тенденции |
| NegTrendAlert |Значение 1 или 0, которое указывает на обнаружение аномалий отрицательной тенденции с учетом чувствительности входных данных |

[1]: ./media/apps-anomaly-detection-api/anomaly-detection-score.png
[2]: ./media/apps-anomaly-detection-api/anomaly-detection-seasonal.png