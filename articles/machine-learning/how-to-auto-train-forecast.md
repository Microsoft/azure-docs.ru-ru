---
title: Автоматическое обучение прогнозной модели временных рядов
titleSuffix: Azure Machine Learning
description: Узнайте, как использовать Машинное обучение Azure для обучения модели регрессии прогнозирования временных рядов с помощью автоматизированного машинного обучения.
services: machine-learning
author: nibaccam
ms.author: nibaccam
ms.service: machine-learning
ms.subservice: core
ms.topic: conceptual
ms.custom: how-to, contperf-fy21q1, automl
ms.date: 08/20/2020
ms.openlocfilehash: 2b24b6480e4331f3a9470dcbb49e7ad221809187
ms.sourcegitcommit: 431bf5709b433bb12ab1f2e591f1f61f6d87f66c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/12/2021
ms.locfileid: "98132088"
---
# <a name="auto-train-a-time-series-forecast-model"></a>Автоматическое обучение прогнозной модели временных рядов


Из этой статьи вы узнаете, как настроить и обучить модель регрессии прогнозов временных рядов с помощью автоматического машинного обучения Аутомл в [пакете SDK для Python машинное обучение Azure](/python/api/overview/azure/ml/?preserve-view=true&view=azure-ml-py). 

Для этого сделайте следующее. 

> [!div class="checklist"]
> * Подготовка данных для моделирования временных рядов.
> * Настройте определенные параметры временных рядов в [`AutoMLConfig`](/python/api/azureml-train-automl-client/azureml.train.automl.automlconfig.automlconfig) объекте.
> * Выполнение прогнозов с данными временных рядов.

Сведения о возможностях уменьшения количества необходимого кода см. в [учебнике по прогнозированию спроса с помощью автоматизированного машинного обучения](tutorial-automated-ml-forecast.md), в котором приведен пример прогнозирования временных рядов с использованием автоматизированного машинного обучения в [Студии машинного обучения Azure](https://ml.azure.com/).

В отличие от классических методов временных рядов, в автоматизированном ML значения временных рядов "сведены", чтобы стать дополнительными измерениями для регрессии вместе с другими прогностические факторы. Этот подход предусматривает использование нескольких контекстных переменных и их связи друг с другом во время обучения. Так как на прогноз могут повлиять несколько факторов, этот метод хорошо согласуется с реальными сценариями прогнозирования. Например, при прогнозировании продаж, взаимодействии исторических тенденций, обменного курса и цены все совместно с результатами продаж. 

## <a name="prerequisites"></a>Предварительные требования

Для этой статьи требуется: 

* Рабочая область машинного обучения Azure. Дополнительные сведения см. в [инструкциях по созданию рабочей области Машинного обучения Azure](how-to-manage-workspace.md).

* В этой статье предполагается, что вы настроили автоматический эксперимент машинного обучения. Следуйте указаниям [руководства](tutorial-auto-train-models.md) или [инструкции](how-to-configure-auto-train.md) , чтобы просмотреть основные шаблоны автоматического проектирования экспериментов машинного обучения.

## <a name="preparing-data"></a>Подготовка данных

Наиболее важным различием между типом задачи регрессия прогноза и задачей регрессии в Аутомл является включение в данные функции, представляющей допустимые временные ряды. Обычный временной ряд имеет четко определенную и постоянную периодичность, а также значение в каждой точке выборки в пределах непрерывного промежутка времени. 

Рассмотрим следующий моментальный снимок файла `sample.csv`.
Этот набор данных представляет собой ежедневные данные по продажам для компании с двумя разными магазинами, а и б. 

Кроме того, существуют функции для

 *  `week_of_year`: позволяет модели обнаруживать еженедельные сезонности.
* `day_datetime`— представляет чистые временные ряды с ежедневной частотой.
* `sales_quantity`: целевой столбец для выполнения прогнозов. 

```output
day_datetime,store,sales_quantity,week_of_year
9/3/2018,A,2000,36
9/3/2018,B,600,36
9/4/2018,A,2300,36
9/4/2018,B,550,36
9/5/2018,A,2100,36
9/5/2018,B,650,36
9/6/2018,A,2400,36
9/6/2018,B,700,36
9/7/2018,A,2450,36
9/7/2018,B,650,36
```


Прочтите данные в объект Dataframe в Pandas, а затем используйте функцию `to_datetime`, чтобы проверить, принадлежит ли временной ряд к типу `datetime`.

```python
import pandas as pd
data = pd.read_csv("sample.csv")
data["day_datetime"] = pd.to_datetime(data["day_datetime"])
```

В этом случае данные уже отсортированы по полю времени `day_datetime`. Однако для создания допустимого временного ряда при настройке эксперимента необходимо, чтобы требуемый столбец времени был отсортирован в порядке возрастания. 

Приведенный ниже код 
* Предполагается, что данные содержат 1 000 записей и составляют детерминированное разбиение данных для создания обучающих и проверочных наборов данных. 
* Определяет столбец меток как `sales_quantity` .
* Отделяет поле метки от `test_data` до формирования `test_target` набора.

```python
train_data = data.iloc[:950]
test_data = data.iloc[-50:]

label =  "sales_quantity"
 
test_labels = test_data.pop(label).values
```

> [!IMPORTANT]
> При обучении модели для прогнозирования будущих значений убедитесь, что все признаки, используемые при обучении, можно применять при выполнении прогнозов для предполагаемого горизонта. <br> <br>Например, при создании прогноза спроса включение признака текущей цены акций может существенно повысить точность обучения. Однако если вы намерены выполнить прогнозирование с дальним горизонтом, возможно, вам не удастся точно предсказать будущую стоимость акций, соответствующую будущим точкам временного ряда, и точность модели может снизиться.

<a name="config"></a>

## <a name="training-and-validation-data"></a>Данные для обучения и проверки

Можно указать отдельные наборы для обучения и проверки непосредственно в `AutoMLConfig` объекте.   Узнайте больше о [AutoMLConfig](#configure-experiment).

Для прогнозирования временных рядов для проверки по умолчанию используется только **Перекрестная проверка источника (рокв)** . Передайте данные для обучения и проверки и задайте число перекрестной проверки с помощью `n_cross_validations` параметра в `AutoMLConfig` . ROCV делит ряд на данные для обучения и проверки с помощью временной точки источника. Скользящий во времени источник создает свертки перекрестной проверки. Эта стратегия сохраняет целостность данных временных рядов и устраняет риск утечки данных.

![Перекрестная проверка пересечения источников](./media/how-to-auto-train-forecast/ROCV.svg)

Вы также можете перенести собственные данные проверки, дополнительные сведения см. в статье [Настройка разбиения данных и перекрестной проверки в аутомл](how-to-configure-cross-validation-data-splits.md#provide-validation-data).


```python
automl_config = AutoMLConfig(task='forecasting',
                             n_cross_validations=3,
                             ...
                             **time_series_settings)
```

Узнайте больше о том, как Аутомл применяет перекрестную проверку для [предотвращения чрезмерного подгонки моделей](concept-manage-ml-pitfalls.md#prevent-over-fitting).

## <a name="configure-experiment"></a>Настройка эксперимента

Объект [`AutoMLConfig`](/python/api/azureml-train-automl-client/azureml.train.automl.automlconfig.automlconfig?preserve-view=true&view=azure-ml-py) определяет параметры и данные, необходимые для задачи автоматизированного машинного обучения. Настройка модели прогнозирования аналогична настройке стандартной модели регрессии, но некоторые модели, параметры конфигурации и добавление признаков шаги существуют специально для данных временных рядов. 

### <a name="supported-models"></a>Поддерживаемые модели
Автоматическое машинное обучение автоматически пытается выполнить различные модели и алгоритмы в рамках процесса создания и настройки модели. Пользователю не нужно указывать алгоритм. Для экспериментов, как собственные, так и собственные модели временного и глубокого обучения являются частью системы рекомендаций. В следующей таблице приведена сводка по этому подмножеству моделей. 

>[!Tip]
> Традиционные модели регрессии также тестируются как часть системы рекомендаций для экспериментов. Полный список моделей см. в [таблице поддерживаемых моделей](how-to-configure-auto-train.md#supported-models) . 

Модели| Описание | Преимущества
----|----|---
Prophet (предварительная версия)|Модель Prophet работает наилучшим образом с временными рядами, которым присущи сильные сезонные эффекты, при наличии данных за несколько прошедших сезонов. Чтобы использовать эту модель, установите ее локально с помощью `pip install fbprophet` . | Высокая точность и скорость, надежность при наличии выбросов, отсутствующих данных и существенных изменений во временных рядах.
Auto-ARIMA (предварительная версия)|Автоматическое регрессионное интегрированное скользящее среднее (ARIMA) работает лучше, когда данные являются стационарными. Это означает, что его статистические свойства, например среднее и вариация, постоянны для всего набора. Например, если Вы переворачиваете монет, то вероятность появления головок составляет 50%, независимо от того, переворачиваются ли вы сегодня, завтра или в следующий год.| Отлично подходит для одномерных рядов, так как для прогнозирования будущих значений используются прошлые.
ForecastTCN (предварительная версия)| ForecastTCN — это модель нейронной сети, предназначенная для решения самых ресурсоемких задач прогнозирования, отслеживающая нелинейные локальные и глобальные тенденции в данных, а также связи между временными рядами.|Возможность использования сложных тенденций в данных и простота масштабирования до самых больших наборов данных.

### <a name="configuration-settings"></a>Параметры конфигурации

Как и в случае с задачей регрессии, вы определяете стандартные параметры обучения, например тип задачи, число итераций, данные для обучения и число перекрестных проверок. Для задач прогнозирования необходимо задать дополнительные параметры, которые влияют на эксперимент. 

В следующей таблице приведены эти дополнительные параметры. Шаблоны проектирования синтаксиса см. в [справочной документации по классу форекастингпараметер](/python/api/azureml-automl-core/azureml.automl.core.forecasting_parameters.forecastingparameters?preserve-view=true&view=azure-ml-py) .

| Имя&nbsp;параметра | Описание | Обязательно |
|-------|-------|-------|
|`time_column_name`|Используется, чтобы задать столбец даты и времени во входных данных, используемых для создания временного ряда и выявления его периодичности.|✓|
|`forecast_horizon`|Определяет, сколько периодов пересылается для прогнозирования. Горизонт находится в единицах измерения частоты временных рядов. Единицы измерения определяются на основе интервала времени данных для обучения, например месяц или неделя, на который следует составить прогноз.|✓|
|`enable_dnn`|[Включить прогнозирование DNN]().||
|`time_series_id_column_names`|Имена столбцов, используемые для уникальной идентификации временных рядов в данных, имеющих несколько строк с одинаковой отметкой времени. Если идентификаторы временных рядов не определены, предполагается, что набор данных является одним временным набором. Дополнительные сведения об одиночном временном ряде см. на странице [energy_demand_notebook](https://github.com/Azure/MachineLearningNotebooks/tree/master/how-to-use-azureml/automated-machine-learning/forecasting-energy-demand).||
|`freq`| Частота набора данных временных рядов. Этот параметр представляет период времени, в течение которого события должны выполняться, например ежедневно, еженедельно, ежегодно и т. д. Частота должна быть [псевдонимом смещения Pandas](https://pandas.pydata.org/pandas-docs/stable/user_guide/timeseries.html#dateoffset-objects).||
|`target_lags`|Число строк для запаздывания целевых значений на основе периодичности данных. Запаздывание представляется в виде списка или одного целого числа. Запаздывание следует использовать, когда связь между независимыми и зависимыми переменными не согласованна или не коррелирует по умолчанию. ||
|`feature_lags`| Функции, которые следует задержать, будут автоматически приняты при установке автоматического ML, если задано значение `target_lags` `feature_lags` `auto` . Включение функции "задержка" может помочь повысить точность. Функция отключения по умолчанию отключена. ||
|`target_rolling_window_size`|Число *n* предыдущих периодов, которые следует использовать для получения прогнозируемых значений (меньше или равно размеру набора для обучения). Если этот параметр не задан, *n* принимается равным полному размеру набора для обучения. Этот параметр следует задавать в том случае, если при обучении модели нужно учитывать только определенный объем данных за предыдущие периоды. Дополнительные сведения о [целевом агрегате для последовательного окна](#target-rolling-window-aggregation).||
|`short_series_handling_config`| Включает обработку коротких временных рядов, чтобы избежать сбоев во время обучения из-за недостатка данных. Для обработки коротких циклов по `auto` умолчанию задано значение. Дополнительные сведения об [обработке коротких серий](#short-series-handling).|


Приведенный ниже код 
* Использует [`ForecastingParameters`](/python/api/azureml-automl-core/azureml.automl.core.forecasting_parameters.forecastingparameters?preserve-view=true&view=azure-ml-py) класс для определения параметров прогнозирования для обучения экспериментов.
* Задает `time_column_name` для `day_datetime` поля в наборе данных. 
* Определяет `time_series_id_column_names` параметр для `"store"` . Это гарантирует, что для данных будут созданы **две отдельные группы временных рядов** . один для хранилищ A и B.
* Задает значение `forecast_horizon` 50 для прогнозирования всего набора тестов. 
* Задает для окна прогноза 10 периодов с `target_rolling_window_size`
* Задает одиночную задержку в целевых значениях за две точки вперед с помощью `target_lags` параметра. 
* Задает `target_lags` рекомендуемый параметр "Auto", который автоматически определит это значение.

```python
from azureml.automl.core.forecasting_parameters import ForecastingParameters

forecasting_parameters = ForecastingParameters(time_column_name='day_datetime', 
                                               forecast_horizon=50,
                                               time_series_id_column_names=["store"],
                                               freq='W',
                                               target_lags='auto',
                                               target_rolling_window_size=10)
                                              
```

`forecasting_parameters`Затем они передаются в стандартный `AutoMLConfig` объект вместе с `forecasting` типом задачи, основной метрикой, условиями выхода и обучающими данными. 

```python
from azureml.core.workspace import Workspace
from azureml.core.experiment import Experiment
from azureml.train.automl import AutoMLConfig
import logging

automl_config = AutoMLConfig(task='forecasting',
                             primary_metric='normalized_root_mean_squared_error',
                             experiment_timeout_minutes=15,
                             enable_early_stopping=True,
                             training_data=train_data,
                             label_column_name=label,
                             n_cross_validations=5,
                             enable_ensembling=False,
                             verbosity=logging.INFO,
                             **forecasting_parameters)
```

### <a name="featurization-steps"></a>Добавление признаков шаги

В каждом автоматическом эксперименте машинного обучения автоматические методики масштабирования и нормализации применяются к данным по умолчанию. Эти методы являются типами **Добавление признаков** , которые помогают *некоторым* алгоритмам, которые чувствительны к функциям различных масштабов. Дополнительные сведения о действиях Добавление признаков по умолчанию в [Добавление признаков в аутомл](how-to-configure-auto-features.md#automatic-featurization)

Однако следующие шаги выполняются только для `forecasting` типов задач.

* определение периодичности выборки временных рядов (например, ежечасно, ежедневно, еженедельно) и создание новых записей для отсутствующих временных точек с целью обеспечения непрерывности ряда;
* аппроксимация отсутствующих значений в столбцах целевых значений (путем прямого заполнения) и признаков (по медиане столбцов);
* Создание компонентов на основе идентификаторов временных рядов для включения фиксированных эффектов в разных рядах
* создание временных признаков, которые помогут в изучении сезонных закономерностей;
* кодирование категориальных переменных в числовые величины.

Чтобы получить сводные сведения о том, какие функции создаются в результате выполнения этих действий, см. раздел [прозрачность Добавление признаков](how-to-configure-auto-features.md#featurization-transparency) .

> [!NOTE]
> Шаги конструирования признаков автоматизированного машинного обучения (нормализация признаков, обработка недостающих данных, преобразование текста в числовой формат и т. д.) становятся частью базовой модели. При использовании модели прогнозирования те же этапы конструирования признаков, которые выполнялись во время обучения, автоматически выполняются для входных данных.

#### <a name="customize-featurization"></a>Настройка Добавление признаков

Вы также можете настроить параметры Добавление признаков, чтобы убедиться, что данные и функции, используемые для обучения результатов модели машинного обучения, соответствуют прогнозам. 

В число поддерживаемых настроек для `forecasting` задач входят следующие.

|Настройка|Определение|
|--|--|
|**Изменение назначения столбца**|Переопределение автоматического обнаруженного типа компонента для указанного столбца.|
|**Изменение параметра преобразователя** |Обновите параметры для указанного преобразователя. В настоящее время поддерживает *импутер* (fill_value и медиана).|
|**Удаление столбцов** |Указывает столбцы для удаления из признаками.|

Чтобы настроить феатуризатионс с помощью пакета SDK, укажите `"featurization": FeaturizationConfig` в `AutoMLConfig` объекте. Дополнительные сведения о [пользовательском феатуризатионс](how-to-configure-auto-features.md#customize-featurization).

>[!NOTE]
> Функции **Drop Columns** устарели в пакете SDK версии 1,19. Удаление столбцов из набора данных в ходе очистки данных до их использования в автоматическом эксперименте ML. 

```python
featurization_config = FeaturizationConfig()

# `logQuantity` is a leaky feature, so we remove it.
featurization_config.drop_columns = ['logQuantitity']

# Force the CPWVOL5 feature to be of numeric type.
featurization_config.add_column_purpose('CPWVOL5', 'Numeric')

# Fill missing values in the target column, Quantity, with zeroes.
featurization_config.add_transformer_params('Imputer', ['Quantity'], {"strategy": "constant", "fill_value": 0})

# Fill mising values in the `INCOME` column with median value.
featurization_config.add_transformer_params('Imputer', ['INCOME'], {"strategy": "median"})
```

Если вы используете Машинное обучение Azure Studio для эксперимента, см. статью [Настройка Добавление признаков в студии](how-to-use-automated-ml-for-ml-models.md#customize-featurization).

## <a name="optional-configurations"></a>Дополнительные конфигурации

Для задач прогнозирования доступны дополнительные необязательные конфигурации, такие как включение глубокого обучения и указание целевого агрегата для скользящего окна. 

### <a name="enable-deep-learning"></a>Включить глубокое обучение

> [!NOTE]
> Поддержка DNN для прогнозирования в автоматизированных Машинное обучение доступна в **предварительной версии** и не поддерживается для локальных запусков.

Кроме того, можно использовать глубокое обучение с глубокими нейронными сетями, DNN, чтобы улучшить оценки модели. Глубокое обучение при автоматизированном машинном обучении позволяет прогнозировать данные одномерных и многомерных временных рядов.

Моделям глубокого обучения присущи три характерные особенности.
1. Они могут обучаться на произвольных сопоставлениях входных данных с выходными.
1. Они поддерживают несколько входов и выходов.
1. Они могут автоматически извлекать закономерности во входных данных, охватывающие длинные последовательности. 

Чтобы включить глубокое обучение, задайте `enable_dnn=True` в `AutoMLConfig` объекте.

```python
automl_config = AutoMLConfig(task='forecasting',
                             enable_dnn=True,
                             ...
                             **forecasting_parameters)
```
> [!Warning]
> При включении DNN для экспериментов, созданных с помощью пакета SDK, [лучшие объяснения модели](how-to-machine-learning-interpretability-automl.md) отключены.

Сведения о включении DNN для Аутомл эксперимента, созданного в Машинное обучение Azure Studio, см. в разделе " [Параметры типа задачи" в статье "практические руководства по Studio"](how-to-use-automated-ml-for-ml-models.md#create-and-run-experiment).

Подробный пример кода, использующий глубокую нейронную сеть, см. в [записной книжке прогнозирования производства напитков](https://github.com/Azure/MachineLearningNotebooks/blob/master/how-to-use-azureml/automated-machine-learning/forecasting-beer-remote/auto-ml-forecasting-beer-remote.ipynb).

### <a name="target-rolling-window-aggregation"></a>Целевой агрегат со скользящим окном
Часто наилучшей информацией для прогнозиста оказывается последнее значение целевого объекта.  Целевые агрегаты для скользящих окон позволяют добавить последовательное агрегирование значений данных в виде функций. Создание и использование этих дополнительных признаков в качестве дополнительных контекстных данных способствует точности модели обучения.

Например, предположим, что требуется прогнозировать спрос на энергию. Может потребоваться добавить функцию пошагового окна за три дня, чтобы учитывать температурные изменения в пространствах накала. В этом примере создайте это окно, задав `target_rolling_window_size= 3` в `AutoMLConfig` конструкторе. 

В таблице показано формирование функций, возникающих при применении агрегирования окон. Столбцы для **минимума, максимума** и **суммы** создаются в скользящем окне трех на основе заданных параметров. Каждая строка содержит новую вычисляемую функцию. в случае метки времени для 8 сентября 2017 4:8:00 максимальное, минимальное и вычисленное значения вычисляются с использованием **значений спроса** для 8 сентября 2017 1:8:00-3:8:00. Это окно размером три смещается во времени для заполнения данными оставшихся строк.

![целевое окно с скользящими](./media/how-to-auto-train-forecast/target-roll.svg)

Просмотрите пример кода Python, в котором [в качестве признака используется целевой агрегат со скользящим окном](https://github.com/Azure/MachineLearningNotebooks/blob/master/how-to-use-azureml/automated-machine-learning/forecasting-energy-demand/auto-ml-forecasting-energy-demand.ipynb).

### <a name="short-series-handling"></a>Обработка коротких циклов

Автоматический ML рассматривает временный ряд в виде **короткого ряда** , если нет достаточных точек данных для проведения этапов обучения и проверки разработки модели. Количество точек данных различается для каждого эксперимента и зависит от max_horizon, количества разбиений между проверками и длины модели лукбакк, которая является максимальным объемом журнала, необходимого для создания функций временных рядов. Точные вычисления см. в [справочной документации по short_series_handling_configuration](/python/api/azureml-automl-core/azureml.automl.core.forecasting_parameters.forecastingparameters?preserve-view=true&view=azure-ml-py#short-series-handling-configuration).

Автоматический ML предлагает обработку коротких циклов по умолчанию с `short_series_handling_configuration` параметром в `ForecastingParameters` объекте. 

Чтобы включить обработку коротких циклов, `freq` необходимо также определить параметр. Чтобы определить почасовую частоту, мы настроили `freq='H'` . Просмотрите [Параметры частоты](https://pandas.pydata.org/pandas-docs/stable/user_guide/timeseries.html#dateoffset-objects)строк. Чтобы изменить поведение по умолчанию, `short_series_handling_configuration = 'auto'` обновите `short_series_handling_configuration` параметр в `ForecastingParameter` объекте.  

```python
from azureml.automl.core.forecasting_parameters import ForecastingParameters

forecast_parameters = ForecastingParameters(time_column_name='day_datetime', 
                                            forecast_horizon=50,
                                            short_series_handling_configuration='auto',
                                            freq = 'H',
                                            target_lags='auto')
```
В следующей таблице перечислены доступные параметры для `short_series_handling_config` .
 
|Параметр|Описание
|---|---
|`auto`| Ниже приведено поведение по умолчанию для обработки коротких рядов. <li> *Если все ряды являются короткими*, раскладка данных. <br> <li> *Если не все ряды являются короткими*, удалите короткий ряд. 
|`pad`| Если `short_series_handling_config = pad` , то автоматически ML добавляет случайные значения в каждый обнаруженный короткий ряд. Ниже перечислены типы столбцов и их поля. <li>Столбцы объекта с значений NaN <li> Числовые столбцы с 0 <li> Логические и логические столбцы с false <li> Целевой столбец дополняется случайными значениями с средним нулем и стандартным отклонением 1. 
|`drop`| Если `short_series_handling_config = drop` , то автоматический ML удаляет короткий ряд и не будет использоваться для обучения или прогнозирования. Прогнозы для этих рядов будут возвращать значение NaN.
|`None`| Ряды не добавляются или не удаляются

>[!WARNING]
>Заполнение может повлиять на точность результирующей модели, так как мы представляем искусственные данные только для того, чтобы пройти прошлую работу без сбоев. <br> <br> Если многие из рядов являются короткими, вы также можете увидеть некоторое воздействие на результаты объяснения.

## <a name="run-the-experiment"></a>Выполнение эксперимента 

После `AutoMLConfig` подготовки объекта можно отправить эксперимент. После завершения моделирования извлеките наиболее подходящую итерацию выполнения.

```python
ws = Workspace.from_config()
experiment = Experiment(ws, "Tutorial-automl-forecasting")
local_run = experiment.submit(automl_config, show_output=True)
best_run, fitted_model = local_run.get_output()
```
 
## <a name="forecasting-with-best-model"></a>Прогнозирование с использованием лучшей модели

Используйте лучшую итерацию модели для прогнозирования значений по набору данных для тестирования.

`forecast()`Функция позволяет использовать спецификации при запуске прогнозов в отличие от `predict()` , которое обычно используется для задач классификации и регрессии.

В следующем примере сначала все значения в `y_pred` заменяются на `NaN`. В этом случае источник прогноза будет находиться в конце обучающих данных. Однако если заменить только вторую половину `y_pred` на `NaN`, функция оставит числовые значения в первой половине неизменными и будет прогнозировать значения `NaN` во второй половине. Функция возвращает как прогнозируемые значения, так и выровненные признаки.

Для прогнозирования значений до указанной даты в функции `forecast()` можно также использовать параметр `forecast_destination`.

```python
label_query = test_labels.copy().astype(np.float)
label_query.fill(np.nan)
label_fcst, data_trans = fitted_pipeline.forecast(
    test_data, label_query, forecast_destination=pd.Timestamp(2019, 1, 8))
```

Вычислить среднюю квадратную ошибку (корень СРЕДНЕКВАДРАТИЧНОЙ ПОГРЕШНОСТИ) между `actual_labels` фактическими значениями и прогнозируемыми значениями в `predict_labels` .

```python
from sklearn.metrics import mean_squared_error
from math import sqrt

rmse = sqrt(mean_squared_error(actual_labels, predict_labels))
rmse
```

Теперь, когда определена точность общей модели, наиболее реалистичным следующим шагом будет использование модели для прогнозирования неизвестных будущих значений. 

Укажите набор данных в том же формате, что и набор для тестирования `test_data`, но с будущими значениями даты и времени. Результирующим набором прогнозов будут прогнозируемые значения для каждого шага временного ряда. Предположим, что последние записи временных рядов в наборе данных датированы 31.12.2018. Чтобы спрогнозировать спрос на следующий день (или столько периодов, сколько необходимо для прогнозирования, но не более `forecast_horizon`), создайте одну запись одиночного временного ряда для каждого магазина на 01.01.2019.

```output
day_datetime,store,week_of_year
01/01/2019,A,1
01/01/2019,A,1
```

Повторите необходимые шаги, чтобы загрузить эти будущие данные в объект DataFrame, а затем запустите `best_run.predict(test_data)` для прогнозирования будущих значений.

> [!NOTE]
> Если количество периодов превышает `forecast_horizon`, спрогнозировать значения невозможно. Для прогнозирования будущих значений за пределами текущего горизонта необходимо повторно обучить модель с большим горизонтом.


## <a name="example-notebooks"></a>Примеры записных книжек
Подробные примеры кода для расширенной настройки прогнозирования см. в [записных книжках примеров прогнозирования](https://github.com/Azure/MachineLearningNotebooks/tree/master/how-to-use-azureml/automated-machine-learning), в том числе:

* [контроль сплошности и конструирование признаков](https://github.com/Azure/MachineLearningNotebooks/blob/master/how-to-use-azureml/automated-machine-learning/forecasting-bike-share/auto-ml-forecasting-bike-share.ipynb);
* [перекрестная проверка источников скользящего прогноза](https://github.com/Azure/MachineLearningNotebooks/blob/master/how-to-use-azureml/automated-machine-learning/forecasting-energy-demand/auto-ml-forecasting-energy-demand.ipynb);
* [настраиваемые задержки](https://github.com/Azure/MachineLearningNotebooks/blob/master/how-to-use-azureml/automated-machine-learning/forecasting-bike-share/auto-ml-forecasting-bike-share.ipynb);
* [признаки для скользящих агрегатов значений окна](https://github.com/Azure/MachineLearningNotebooks/blob/master/how-to-use-azureml/automated-machine-learning/forecasting-energy-demand/auto-ml-forecasting-energy-demand.ipynb);
* [глубокая нейронная сеть](https://github.com/Azure/MachineLearningNotebooks/blob/master/how-to-use-azureml/automated-machine-learning/forecasting-beer-remote/auto-ml-forecasting-beer-remote.ipynb).

## <a name="next-steps"></a>Дальнейшие действия

* Узнайте больше о том, [как и где можно развернуть модель](how-to-deploy-and-where.md).
* Сведения о [интерпретации: объяснение модели в автоматизированном машинном обучении (Предварительная версия)](how-to-machine-learning-interpretability-automl.md). 
* Узнайте, как обучить несколько моделей с помощью Аутомл в [акселераторе решений для многих моделей](https://aka.ms/many-models).
* Следуйте указаниям [в конце](tutorial-auto-train-models.md) примера, чтобы создать эксперименты с автоматизированным машинным обучением.
