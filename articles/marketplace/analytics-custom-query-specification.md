---
title: Спецификация пользовательского запроса
description: Узнайте, как использовать пользовательские запросы для программного извлечения данных из таблиц аналитики для ваших предложений в коммерческом магазине Майкрософт.
ms.service: marketplace
ms.subservice: partnercenter-marketplace-publisher
ms.topic: article
author: sayantanroy83
ms.author: sroy
ms.date: 3/08/2021
ms.openlocfilehash: 4be063342a6c46d73c86f2d9dff1da5395328389
ms.sourcegitcommit: e6de1702d3958a3bea275645eb46e4f2e0f011af
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/20/2021
ms.locfileid: "102584025"
---
# <a name="custom-query-specification"></a>Спецификация пользовательского запроса

Партнеры могут использовать эту спецификацию запроса, чтобы легко формулировать пользовательские запросы на извлечение данных из таблиц аналитики. Запросы можно использовать для выбора только нужных столбцов и метрик, соответствующих определенному условию. В основе спецификации языка лежит определение набора данных, в котором можно написать пользовательский запрос.

## <a name="datasets"></a>Наборы данных

Так же, как некоторые запросы выполняются для базы данных, которая содержит таблицы и столбцы, Пользовательский запрос работает с наборами, имеющими столбцы и метрики. Полный список доступных наборов данных для составления можно получить с помощью API наборов данных.

Ниже приведен пример набора данных, представленного в виде JSON.

```json
{
     "datasetName": "ISVUsage",
     "selectableColumns": [
       "MarketplaceSubscriptionId",
       "OfferName",
            "CustomerId",
     "MonthStartDate",
     "SKU"
    ],
    "availableMetrics": [
     "NormalizedUsage", 
     "RawUsage"
        "EstimatedExtendedChargeCC"
    ],
    "availableDateRanges": [
     "LAST_MONTH",
     "LAST_3_MONTHS",
     "LAST_6_MONTHS",
     "LIFETIME"
    ]
}
```

### <a name="parts-of-a-dataset"></a>Части набора данных

- Имя набора данных похоже на имя таблицы базы данных. Например, Исвусаже. Набор данных содержит список столбцов, которые можно выбрать, например Маркетплацесубскриптионид.
- Набор данных также имеет метрики, которые подобны статистическим функциям в базе данных. Например, Нормализедусаже.
- Существуют фиксированные интервалы времени, по которым можно экспортировать данные.

### <a name="formulating-a-query-on-a-dataset"></a>Составления запроса к набору данных

Ниже приведены примеры запросов, демонстрирующих извлечение различных типов данных.

| Запрос | Описание |
| ------------ | ------------- |
| **Выберите** Маркетплацесубскриптионид, CustomerId **от** исвусаже **TIMESPAN LAST_MONTH** | Этот запрос будет получать все уникальные `MarketplaceSubscriptionId` и соответствующие ему `CustomerId` последние 1 месяца. |
| **Выберите** Маркетплацесубскриптионид, Естиматедекстендедчаржекк **из** ИСВУСАЖЕ **ORDER BY** естиматедекстендедчаржекк **ограничение** 10 | Этот запрос будет получать 10 наиболее частых подписок в порядке убывания количества лицензий, проданных по каждой подписке. |
| **Выберите** CustomerId, Нормализедусаже, Равусаже **из** исвусаже **ORDER BY нормализедусаже,** **где** Нормализедусаже > 100000 **ORDER BY** нормализедусаже **TIMESPAN** LAST_6_MONTHS | Этот запрос получит Нормализедусаже и Равусаже всех клиентов, у которых Нормализедусаже больше 100 000. |
| **Выберите** Маркетплацесубскриптионид, Монсстартдате, Нормализедусаже **из** Исвусаже, **где** CustomerID in (' 2a31c234-1f4e-4c60-909e-76d234f93161 ', ' 80780748-3f9a-11eb-b378-0242ac130002 ') | Этот запрос получит `MarketplaceSubscriptionId` и доход, созданный для каждого месяца двумя `CustomerId` значениями: `2a31c234-1f4e-4c60-909e-76d234f93161` и `80780748-3f9a-11eb-b378-0242ac130002` . |
|||

## <a name="query-specification"></a>Спецификация запроса

В этом разделе описывается определение и структура запроса.

### <a name="grammar-reference"></a>Справочник по грамматике

В этой таблице описаны символы, используемые в запросах.

| Символ | Значение |
| ------------ | ------------- |
| ? | Необязательно |
| * | Ноль или более |
| + | Один или более |
| &#124; | Или один из списков |
| | |

### <a name="query-definition"></a>Определение запроса

Инструкция запроса имеет следующие предложения: SelectClause, Фромклаусе, Вхереклаусе?, Ордерклаусе?, Лимитклаусе? и TimeSpan?.

- **SelectClause**: **SELECT** колуморметрикнаме (, колуморметрикнаме) *
    - **Колуморметрикнаме**: столбцы и метрики, определенные в наборе данных
- **Фромклаусе**: **от** DataSetName
    - **DataSetName**: имя набора данных, определенное в наборе данных
- **Вхереклаусе**: **где** филтеркондитион (**и** филтеркондитион) *
    - **Филтеркондитион**: значение оператора колуморметрикнаме
        - **Оператор**: = | > | < | >= | <= |! = | LIKE | НЕ НРАВИТСЯ | В | НЕ В
        - **Значение**: число | Стринглитерал | Мултинумберлист | мултистринглист 
            - **Номер**:-? [0-9] + (. [0-9] [0-9] *)?
            - **Стринглитерал**: ' [a-Za-z0-9_] * '
            - **Мултинумберлист**: (число (, число) *)
            - **Мултистринглист**: (стринглитерал (, стринглитерал) *)
- **Ордерклаусе**: **ORDER BY** ордеркондитион (, ордеркондитион) *
    - **Ордеркондитион**: колуморметрикнаме (**ASC**  |  **DESC**) *
    - **Лимитклаусе**: **Limit** [0-9] +
    - **TimeSpan**: **TimeSpan** (сегодня) | ВЧЕРА | LAST_7_DAYS | LAST_14_DAYS | LAST_30_DAYS | LAST_90_DAYS | LAST_180_DAYS | LAST_365_DAYS | LAST_MONTH | LAST_3_MONTHS | LAST_6_MONTHS | LAST_1_YEAR | КОНТРОЛИРУ

### <a name="query-structure"></a>Структура запроса

Запрос отчета состоит из нескольких частей:

- SELECT
- FROM
- WHERE
- ORDER BY
- LIMIT
- ВРЕМЕННОЙ

Каждая часть описана ниже.

#### <a name="select"></a>SELECT

В этой части запроса указываются столбцы, которые будут экспортированы. Столбцы, которые могут быть выбраны, являются полями, перечисленными в `selectableColumns` `availableMetrics` разделах и набора данных. Окончательные экспортированные строки всегда будут содержать уникальные значения в выбранных столбцах. Например, в экспортированном файле не будет повторяющихся строк. Метрики будут рассчитываться для каждого отдельного сочетания выбранных столбцов.

**Пример**:
- **Выберите** `OfferName` , `NormalizedUsage`

#### <a name="from"></a>FROM

Эта часть запроса указывает набор данных, из которого необходимо экспортировать данные. Имя набора данных, указанное здесь, должно быть допустимым именем набора данных, возвращаемым API наборов данных.

**Пример**:
- FROM `ISVUsage`
- FROM `ISVOrder`

#### <a name="where"></a>WHERE

Эта часть запроса используется для указания условий фильтра для набора данных. В окончательном экспортированном файле будут присутствовать только строки, соответствующие условиям, указанным в этом предложении. Условие фильтра может находиться в любом из столбцов, перечисленных в `selectableColumns` и `availableMetrics` . Значения, указанные в условии фильтра, могут представлять собой список чисел или список строк только в том случае, если оператор имеет значение `IN` или `NOT IN` . Значения всегда могут быть заданы в виде литеральной строки, и они будут преобразованы в собственные типы столбцов. Несколько условий фильтра должны быть разделены `AND` операцией.

**Пример**:

- Маркетплацесубскриптионид = ' 868368da-957d-4959-8992-3c12dc7e6260 '
- CustomerName, **например** "% контоссо%"
- CustomerId **не в** (1000, 1001, 1002)
- OrderQuantity = 100
- OrderQuantity = ' 100 '
    - Маркетплацесубскриптионид = ' 7b487ac0-CE12-B732-dcd6-91a1e4e74a50 ' и CustomerId = ' 0f8b7fa0-eb83-A183-1225-ca153ef807aa '

#### <a name="order-by"></a>ORDER BY

В этой части запроса указываются критерии упорядочивания для экспортируемых строк. Столбцы, для которых может быть определен порядок сортировки, должны находиться в `selectableColumns` и `availableMetrics` из набора данных. Если направление упорядочивания не указано, по умолчанию будет использоваться значение по `DESC` столбцу. Упорядочивание можно определить по нескольким столбцам, разделяя критерий запятой.

**Пример**:

- **УПОРЯДОЧИТЬ по** Нормализедусаже **ASC**, ЕСТИМАТЕДЕКСТЕНДЕДЧАРЖЕ (CC) **DESC**
- **УПОРЯДОЧИТЬ по** CustomerName **ASC**, нормализедусаже

#### <a name="limit"></a>LIMIT

В этой части запроса указывается количество строк, которые будут экспортированы. Указанное число должно быть положительным ненулевым целым числом.

#### <a name="timespan"></a>ВРЕМЕННОЙ

В этой части запроса указывается период времени, в течение которого необходимо экспортировать данные. Возможные значения должны быть из `availableDateRanges` поля в определении набора данных.

### <a name="case-sensitivity-in-query-specification"></a>Чувствительность к регистру в спецификации запроса

Спецификация полностью не учитывает регистр. Предопределенные ключевые слова, имена и значения столбцов можно указать с помощью прописных и строчных букв.

## <a name="see-also"></a>См. также раздел

- [Список системных запросов](analytics-system-queries.md)
