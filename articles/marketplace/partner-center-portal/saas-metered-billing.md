---
title: Выставление счетов за использование предложений SaaS с помощью службы контроля использования коммерческих рынков Майкрософт
description: Узнайте о гибких моделях выставления счетов для SaaS, используя службу контроля использования коммерческих рынков.
ms.service: marketplace
ms.subservice: partnercenter-marketplace-publisher
ms.topic: conceptual
ms.date: 05/08/2020
author: mingshen-ms
ms.author: mingshen
ms.openlocfilehash: 9f72d54fda8f66c2fce35f0520b51406aa276bb0
ms.sourcegitcommit: 910a1a38711966cb171050db245fc3b22abc8c5f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "92892759"
---
# <a name="metered-billing-for-saas-using-the-commercial-marketplace-metering-service"></a>Выставление счетов за использование SaaS с помощью службы контроля использования коммерческих рынков

С помощью службы контроля использования коммерческих рынков вы можете создавать предложения по как услуга (SaaS), которые выставляются в соответствии с нестандартными единицами. Перед публикацией предложения SaaS на коммерческом рынке необходимо определить такие измерения выставления счетов, как пропускная способность, билеты или сообщения электронной почты.  Клиенты затем платят в соответствии с их потреблением, и ваша система сообщает корпорации Майкрософт через API-интерфейс службы контроля измерений коммерческого рынка по мере их возникновения.  

## <a name="prerequisites-for-metered-billing"></a>Предварительные требования для тарифного счета

Чтобы предложение SaaS использовало лимитное выставление счетов, необходимо сначала:

- Выполните все требования предложения по [продаже через предложение Майкрософт](../plan-saas-offer.md#listing-options) , как описано в подокне [Создание предложения SaaS в коммерческом магазине](../create-new-saas-offer.md).
- Интегрируйтесь с [API-интерфейсами выполнения SaaS](./pc-saas-fulfillment-api-v2.md) , чтобы клиенты могли подготавливать свое предложение и подключаться к нему.  
- Настроить для модели ценообразования с **фиксированной ставкой** при отсчете клиентов для вашей службы.  Измерения являются дополнительным расширением модели ценообразования с фиксированной ставкой. 

Затем предложение SaaS может интегрироваться с [API-интерфейсами коммерческого магазина](./marketplace-metering-service-apis.md) для информирования Майкрософт о оплачиваемых мероприятиях.

>[!Note]
>Служба измерения Marketplace доступна только для модели выставления счетов с фиксированной ставкой и не применяется к модели выставления счетов для каждого пользователя.

## <a name="how-metered-billing-fits-in-with-pricing"></a>Как взимается плата за использование с учетом цен

Понимание иерархии предложений имеет важное значение, когда дело доходит до определения предложения вместе с его моделями ценообразования.

- Каждое предложение SaaS настраивается на продажу через корпорацию Майкрософт.  После публикации предложения этот параметр нельзя изменить.
- Каждое предложение SaaS, настроенное для продажи в корпорации Майкрософт, может иметь один или несколько планов.  Пользователь подписывается на предложение SaaS, но его можно приобрести в корпорации Майкрософт в контексте плана.
- С каждым планом связана модель ценообразования: **фиксированная ставка** или **на пользователя**. Все планы в предложении должны быть связаны с одной и той же моделью ценообразования. Например, не может быть предложения использовать плановую модель ценообразования и другую модель ценообразования для каждого пользователя.
- В каждом плане, настроенном для модели выставления счетов с фиксированной ставкой, включена по крайней мере одна повторяющаяся плата (которая может быть $0):
    - Ежегодная **ежемесячная** плата: Фиксированная ежемесячная плата, которая предоплачена за ежемесячное повторение, когда пользователь приобретает план.
    - **Ежегодная годовая** плата: фиксированная ежегодная плата, которая предоплачена в течение ежегодного повторения, когда пользователь приобретает план.
- В дополнение к повторяющимся тарифам тарифный план также может включать необязательные настраиваемые измерения, используемые для оплаты клиентов на избыточное использование, не включенное в фиксированную ставку.  Каждое измерение представляет собой оплачиваемую единицу, которую служба будет обмениваться данными с корпорацией Майкрософт с помощью [API службы контроля использования коммерческих рынков](./marketplace-metering-service-apis.md).

## <a name="sample-offer"></a>Пример предложения

Например, contoso — это издатель с службой SaaS, именуемый Contoso Notification Services (CNS). CNS позволяет клиентам отправлять уведомления с помощью электронной почты или текста. Contoso регистрируется как издатель в центре партнеров, чтобы программа коммерческого рынка опубликовала предложения SaaS для клиентов Azure.  С параметром CNS связаны два плана, описанные ниже.

- План "Базовый"
    - Отправка 10000 сообщений электронной почты и 1000 за $0 в месяц (неструктурированная ежемесячная плата)
    - Свыше 10000 сообщений электронной почты, платите $1 за каждые 100 сообщений электронной почты
    - За пределами 1000, платите $0,02 для каждого текста

    [![Цены на базовый план](./media/saas-basic-pricing.png "Щелкните для увеличения представления")](./media/saas-basic-pricing.png)

- План "Премиум"
    - Отправьте 50000 по электронной почте и 10000 текста для 5 мин и 1-го месяца, а также для $3500 долларов в год.
    - Свыше 50000 сообщений электронной почты, платите $0,5 за каждые 100 сообщений электронной почты
    - За пределами 10000, платите $0,01 для каждого текста

    [![Цены на план Premium](./media/saas-premium-pricing.png "Щелкните для увеличения представления")](./media/saas-premium-pricing.png)

- План "Корпоративный"
    - Отправка неограниченного числа сообщений электронной почты и 50000 текста за %400 в месяц
    - Свыше 50000 текстов оплачивается $0,005 для каждого txt

    [![Цены на план Enterprise](./media/saas-enterprise-pricing.png "Щелкните для увеличения представления")](./media/saas-enterprise-pricing.png)

В соответствии с выбранным планом в подписке на приобретение клиентов Azure с помощью подписки на CNS SaaS можно будет отправить включенное количество текста и сообщений электронной почты по сроку подписки (месяц или год, как показано в сведениях о подписке — startDate и endDate).  Contoso подсчитывает использование до входящего количества в базе без отправки каких бы то ни было событий использования в корпорацию Майкрософт. Когда клиенты потребляют больше, чем количество входящих, не нужно изменять планы или выполнять какие-либо другие действия.  Компания Contoso будет измерять превышение, превышающее включенное количество, и приступить к передаче событий использования в корпорацию Майкрософт для выставления счетов за использование с помощью [API службы контроля использования коммерческих рынков](./marketplace-metering-service-apis.md).  Корпорация Майкрософт, в свою очередь, будет взимать плату за чрезмерное использование, указанное издателем в пользовательских измерениях. Выставление счетов выполняется в следующем цикле выставления счетов (ежемесячно, но может быть ежеквартально или раньше для некоторых клиентов).  Для месячного плана с фиксированным тарифом будет выставлен счет за каждый месяц, в котором произошло превышение.  Для тарифного плана с фиксированным тарифным планом, как только будет потреблено количество, включенное в базовый в год, все дополнительное использование, создаваемое настраиваемым счетчиком, будет выставляться в течение каждого цикла выставления счетов (ежемесячно) до конца года подписки.

## <a name="billing-dimensions"></a>Измерения выставления счетов

Каждое измерение выставления счетов определяет пользовательскую единицу, с помощью которой независимый поставщик программного обеспечения может создавать события использования.  Измерения выставления счетов также используются для обмена данными с клиентом о том, как будут выставляться счета за использование программного обеспечения.  Они определяются следующим образом:

- **ID**: неизменяемый идентификатор измерения, на который указывает ссылка при выдаче событий использования.
- **Отображаемое имя**: отображаемое имя, связанное с измерением, например "Отправленные текстовые сообщения".
- **Единица измерения**: Описание единицы оплаты, например "на текстовое сообщение" или "за 100 сообщений электронной почты".
- **Цена за единицу в USD**: Цена для одной единицы измерения.  Оно может быть равно 0. 
- **Ежемесячное количество, включаемое в базовый**: количество измерений, включаемых в месяц для клиентов, которые платите за период ежегодной ежемесячной оплаты, должно быть целым числом. Оно может быть равно 0 или не ограничено.
- **Годовое количество, включаемое в базовый**: количество измерений, включаемых в каждый год для клиентов, которые платите за период ежегодной оплаты, должно быть целым числом. Может иметь значение 0 или не ограничено.

Измерения выставления счетов совместно используются во всех планах предложения.  Некоторые атрибуты применяются к измерению во всех планах, а другие атрибуты зависят от плана.

Атрибуты, определяющие само измерение, совместно используются во всех планах предложения.  Перед публикацией предложения изменения, внесенные в эти атрибуты из контекста любого плана, повлияют на определение измерения во всех планах.  После публикации предложения эти атрибуты больше не будут доступны для изменения.  Они перечислены ниже.

- ID
- Отображаемое имя
- Единица измерения

Другие атрибуты измерения относятся к каждому плану и могут иметь разные значения из плана планирования.  Перед публикацией плана можно изменить эти значения, и только этот план будет затронуты.  После публикации плана эти атрибуты больше не будут доступны для изменения.  Они перечислены ниже.

- Цена за единицу в USD
- Ежемесячное количество, включаемое в базовый  
- Годовое количество, включаемое в Басеинклудед  

Измерения также имеют два специальных понятия: «включено» и «бесконечное».

- **Включено** указывает, что этот план участвует в этом измерении.  Если создается новый план, который не отправляет события использования на основе этого измерения, может потребоваться снять этот флажок.  Кроме того, все новые измерения, добавленные после первоначальной публикации плана, будут отображаться как "не включено" для уже опубликованного плана.  Отключенное измерение не будет отображаться ни в одном списке измерений для плана, видимого для клиентов.
- **Infinite** , представленный символом бесконечности "∞", указывает, что этот план участвует в этом измерении, но не выдает использование в этом измерении.  Если вы хотите сообщить клиентам, что функции, представленные этим измерением, включены в план, но без ограничения на использование.  Измерение с бесконечным использованием будет отображаться в списках измерений для плана, видимого для клиентов, с указанием, что плата за этот план никогда не будет взиматься.

>[!Note] 
>Следующие сценарии поддерживаются явно: <br> — Можно добавить новое измерение в новый план.  Новое измерение не будет включено для всех уже опубликованных планов. <br> — Можно опубликовать план с **фиксированной ставкой** без каких-либо измерений, добавить новый план и настроить новое измерение для этого плана. Новое измерение не будет включено для уже опубликованных планов.

### <a name="setting-dimension-price-per-unit-per-supported-market"></a>Задание цены за единицу на поддерживаемый рыночный уровень

Как и в случае с фиксированной ставкой, цены на измерения выставления счетов можно задать для каждой поддерживаемой страны или региона. Необходимо использовать функцию импорта и экспорта данных о ценах в центре партнеров, как показано ниже.

1. Определите нужные измерения и отметьте, какие рынки поддерживаются. 
1. Экспортируйте эти данные в файл.
1. Добавьте правильные цены на страну или регион и импортируйте файл в центр партнеров.

Пользовательский интерфейс индикатора изменится в соответствии с тем, что цены на измерение могут отображаться только в файле.

[![измерения обслуживания для коммерческого рынка](media/metering-service-dimensions.png "Щелкните для увеличения представления")](media/metering-service-dimensions.png)

### <a name="private-plan"></a>Частный план

Как и планы по фиксированным тарифам, план с измерениями можно задать в качестве частного плана, доступного только для определенной аудитории плана.

## <a name="constraints"></a>Ограничения

### <a name="trial-behavior"></a>Поведение пробной версии

Выставление счетов за использование службы контроля использования коммерческих рынков не совместимо с предложением бесплатной пробной версии.  Невозможно настроить план на использование как тарифного счета, так и бесплатной пробной версии.

### <a name="locking-behavior"></a>Режим блокировки

Поскольку измерение, используемое с коммерческой службой измерения рынка, представляет сведения о том, как клиент будет платить за службу, все детали измерения больше не будут доступны для изменения после его публикации.  Перед публикацией важно, чтобы измерения были полностью определены для плана.

После публикации предложения с измерением сведения на уровне предложения для этого измерения больше не могут быть изменены:

- ID
- Отображаемое имя
- Единица измерения

После публикации плана сведения на уровне плана больше не могут быть изменены:

- Цена за единицу в USD
- Ежемесячное количество, включаемое в базовый
- Годовое количество, включаемое в базовый
- Включено ли измерение для плана или нет

### <a name="upper-limits"></a>Верхние пределы

Максимальное число измерений, которое можно настроить для одного предложения, составляет 30 уникальных измерений.

## <a name="get-support"></a>Получение поддержки

При наличии одной из следующих проблем можно открыть запрос в службу поддержки.

- Технические проблемы с API службы измерения Marketplace.
- Проблема, которая должна быть передана из-за ошибки или ошибки на стороне пользователя (например, неверное событие использования.)
- Другие проблемы, связанные с лимитным выставленным счетом.

Чтобы узнать о вариантах поддержки издателя и отправить запрос в службу поддержки корпорации Майкрософт, следуйте инструкциям в статье [Поддержка программы коммерческого рынка в центре партнеров](../support.md).

## <a name="next-steps"></a>Дальнейшие действия

- [API-интерфейсы службы из Marketplace для контроля потребления](./marketplace-metering-service-apis.md)
