---
title: Вопросы и ответы по API службы контроля использования — коммерческий магазин Майкрософт
description: Часто задаваемые вопросы о API службы измерения для предложений SaaS в Microsoft AppSource и Azure Marketplace.
ms.service: marketplace
ms.subservice: partnercenter-marketplace-publisher
ms.topic: conceptual
ms.date: 06/01/2020
author: mingshen-ms
ms.author: mingshen
ms.openlocfilehash: ddec23f695396b8322d51da62158a97456096ae8
ms.sourcegitcommit: 772eb9c6684dd4864e0ba507945a83e48b8c16f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "87320006"
---
# <a name="marketplace-metered-billing-apis---faq"></a>API тарифного счета в Marketplace — часто задаваемые вопросы

Когда клиент подписывается на службу SaaS или приложение Azure с планом управляемых приложений с лимитным выставленным счетом, вы будете отслеживать потребление для каждого используемого измерения выставления счетов.  Если потребление превышает включенное количество, установленное для выбранного клиентом термина, служба будет отправлять события использования в корпорацию Майкрософт.

## <a name="for-both-saas-offers-and-managed-apps"></a>Для предложений SaaS и управляемых приложений

### <a name="how-often-is-it-expected-to-emit-usage"></a>Как часто ожидается вывод сведений об использовании?

В идеале предполагается, что использование будет выдаваться каждый час за последний час, только если используется предыдущий час.

### <a name="is-there-a-maximal-period-between-one-emission-and-the-next-one"></a>Существует ли максимальный период между одним выбросом и следующим?

Такого ограничения нет. Выдавать данные об использовании только по мере их возникновения. Например, если необходимо отправить только одну единицу использования на время существования подписки, это можно сделать.

### <a name="what-is-the-maximum-delay-between-the-time-an-event-occurs-and-the-time-a-usage-event-is-emitted-to-microsoft"></a>Какова максимальная задержка между временем возникновения события и временем выпуска события использования в корпорацию Майкрософт?

В идеале событие использования создается каждый час для событий, произошедших за последний час. Однако ожидается задержка. Максимально допустимая задержка составляет 24 часа, после чего события использования не будут приниматься. Рекомендуется собираются почасовое использование, а для выпуска — как одно событие в конце часа.

Например, если событие использования происходит в 1 РМ в день, то в следующий день у вас будет до 1 PM для создания события использования, связанного с этим событием.  Если использование выпуска системы не работает, оно может восстановить, а затем отправить событие использования в течение часового интервала, в котором произошло использование, без потери точности.

Если после фактического использования прошло 24 часа, вы все равно можете выпустить использованные единицы с более поздними событиями использования.  Однако такая практика может понизить надежность отчетов о событиях выставления счетов для конечного клиента.  Рекомендуется избегать отправки счетчиков раз в день/неделю/месяц.  Будет труднее понять фактическое использование клиентом, а также решить проблемы или вопросы, которые могут возникать в отношении событий использования.

Другой причиной для отправки сведений об использовании каждый час является избежание ситуаций, в которых пользователь отменяет подписку до того, как издатель отправляет событие ежедневного/еженедельного или ежемесячного эмиссии.

### <a name="what-happens-when-you-send-more-than-one-usage-event-in-the-same-hour"></a>Что происходит при отправке нескольких событий использования за один час?

Для интервала в один час принимается только одно событие использования. Интервал времени начинается в минуту 0 и заканчивается в 59 минут.  Если в течение одного часа выдается более одного события использования, все последующие события использования удаляются как дубликаты.

### <a name="what-happens-when-the-customer-cancels-the-purchase-within-the-time-allowed-by-the-cancellation-policy"></a>Что происходит, когда клиент отменяет покупку в течение времени, допускаемого политикой отмены?

Сумма нефиксированной ставки не будет начисляться, но чрезмерное использование будет иметь значение.

### <a name="can-custom-meter-plans-be-used-for-one-time-payments"></a>Можно ли использовать пользовательские планы отслеживания для одноразовых платежей?

Да, можно определить пользовательское измерение как одну единицу одноразового платежа и выдавать его только один раз для каждого клиента.

### <a name="can-custom-meter-plans-be-used-to-tiered-pricing-model"></a>Можно ли использовать пользовательские планы использования для многоуровневой модели ценообразования?

Да, он может быть реализован с каждым пользовательским измерением, представляющим одну ценовую категорию.

Например, компания Contoso хочет наплатить $0,5 на электронную почту для первых 1000 сообщений электронной почты, $0,4 по электронной почте между 1000 и 5000 и $0,2 на электронную почту для более чем сообщений электронной почты. Они могут определять три пользовательских измерения, которые соответствуют трем ценовым категориям электронной почты. Выдача единиц первого измерения для до тех пор, пока количество сообщений электронной почты остается менее 1000, затем единицы измерения второго размера, когда количество сообщений электронной почты находится в диапазоне от 1000 до 5000, а наконец, единицы третьего измерения для свыше 5000 сообщений электронной почты.

### <a name="what-happens-if-the-marketplace-metering-service-has-an-outage"></a>Что произойдет, если в службе измерения Marketplace возникает сбой?

Если поставщик программного обеспечения отправляет пользовательский счетчик и получает сообщение об ошибке, которое могло быть вызвано проблемой на стороне Майкрософт (обычно в случае, если аналогичные события были приняты до возникновения ошибки), то поставщик программного обеспечения должен подождать и повторить эмиссию.

Если ошибка повторяется, отправьте настраиваемый измеритель на следующий час (накопление количества). Продолжайте процесс, пока не будет получен ответ, не связанный с ошибкой.

## <a name="for-saas-offers-only"></a>Только для предложений SaaS

### <a name="what-happens-when-you-emit-usage-for-a-saas-subscription-that-has-been-unsubscribed-already"></a>Что происходит при выпуске использования подписки SaaS, для которой уже была отменена подписка?

Любое событие использования, переданное на платформу Marketplace, не будет принято после удаления подписки SaaS.

Использование может быть выдаваться только для подписок в состоянии подписки (а не для подписок `PendingFulfillmentStart` в `Suspended` состоянии, или `Unsubscribed` ).

Единственным исключением является создание отчетов об использовании в течение времени, которое было до отмены подписки SaaS.

Например, Клиент отменил подписку SaaS сегодня до 3 РМ. Теперь имеет значение 5 PM. издатель может по-прежнему выпускать использование в течение периода от 6 до вчерашнего дня и 3 PM для этой подписки SaaS.

### <a name="can-you-get-a-list-of-all-saas-subscriptions-including-active-and-unsubscribed-subscriptions"></a>Можно ли получить список всех подписок SaaS, включая активные и неподписанные подписки?

Да, при вызове [API получения списка подписок](pc-saas-fulfillment-api-v2.md#subscription-apis) , так как он включает список всех подписок SaaS. В поле состояние в ответе для каждой подписки SaaS захватывается, является ли подписка активной или неподписанной.

### <a name="are-the-start-and-end-dates-of-saas-subscription-term-and-overage-usage-emission-connected"></a>Существуют ли даты начала и окончания срока подписки SaaS и подключения к чрезмерному использованию?

Избыточные события могут создаваться в любой момент времени для существующей подписки SaaS в состоянии *подписки* . Ответственность за вывод событий использования на основе политики, определенной в плане выставления счетов, несет издатель. Превышение должно рассчитываться на основе дат, определенных в термине подписки SaaS. 

Например, если издатель определяет план SaaS, включающий 1000 сообщений электронной почты для $100 в месячном фиксированном Тарифе, каждое сообщение электронной почты, превышающее 1000, оплачивается по цене $1 через настраиваемое измерение.

Когда клиент покупает и активирует подписку 6 января, в этом дне будет учитываться электронная почта 1000, включенная в фиксированную ставку. Таким образом, если до 5 февраля (конец первого месяца подписки) отправляются только сообщения электронной почты 900, клиент оплачивает фиксированную ставку только за первый месяц этой подписки, и на издателе не будут выдаваться события чрезмерного использования. 6 февраля подписка будет автоматически продлена, а отсчет начнется снова. Если до 15 февраля клиент достиг 1000 сообщений электронной почты, остальная часть сообщений электронной почты, отправленная до 5 марта, будет оплачена как избыточная ($1 на адрес электронной почты) на основе событий превышения использования, созданных издателем.

## <a name="next-steps"></a>Дальнейшие действия

- Дополнительные сведения см. в разделе [API-интерфейсы службы измерения Marketplace](./marketplace-metering-service-apis.md).
