---
title: Рекомендации по обеспечению безопасности и соответствию пакетной службы
description: Ознакомьтесь с рекомендациями и полезными советами по повышению безопасности с помощью решений пакетной службы Azure.
ms.date: 12/18/2020
ms.topic: conceptual
ms.openlocfilehash: 6ec4a1d89ebaa9318986fc0d51e832652ba51683
ms.sourcegitcommit: 910a1a38711966cb171050db245fc3b22abc8c5f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "98723818"
---
# <a name="batch-security-and-compliance-best-practices"></a>Рекомендации по обеспечению безопасности и соответствию пакетной службы

В этой статье приводятся рекомендации и рекомендации по повышению безопасности при использовании пакетной службы Azure.

По умолчанию учетные записи пакетной службы Azure имеют общедоступную конечную точку и доступны для общего доступа. При создании пула пакетной службы Azure пул подготавливается в указанной подсети виртуальной сети Azure. Доступ к виртуальным машинам в пуле пакетной службы осуществляется через общедоступные IP-адреса, созданные пакетной службой. Вычислительные узлы в пуле могут взаимодействовать друг с другом при необходимости, например для выполнения задач с несколькими экземплярами, но узлы в пуле не могут взаимодействовать с виртуальными машинами за пределами пула.

:::image type="content" source="media/security-best-practices/typical-environment.png" alt-text="Схема, показывающая типичную пакетную среду.":::

Доступно множество функций, которые помогут вам создать более безопасное развертывание пакетной службы Azure. Можно ограничить доступ к узлам и снизить возможность обнаружения узлов из Интернета путем [подготовки пула без общедоступных IP-адресов](batch-pool-no-public-ip-address.md). Ресурсы для вычислений могут безопасно взаимодействовать с другими виртуальными машинами или с локальной сетью путем [подготовки пула в подсети виртуальной сети Azure](batch-virtual-network.md). Вы также можете включить [частный доступ из виртуальных сетей](private-connectivity.md) из службы, работающей с помощью частной связи Azure.

:::image type="content" source="media/security-best-practices/secure-environment.png" alt-text="Схема, демонстрирующая более безопасную пакетную среду.":::

## <a name="general-security-related-best-practices"></a>Общие рекомендации по обеспечению безопасности

### <a name="pool-configuration"></a>Конфигурация пула

Многие функции безопасности доступны только для пулов, настроенных с помощью [конфигурации виртуальной машины](nodes-and-pools.md#configurations), а не для пулов с конфигурацией облачных служб. При возможности рекомендуется использовать пулы конфигурации виртуальных машин, которые используют [масштабируемые наборы виртуальных машин](../virtual-machine-scale-sets/overview.md).

### <a name="batch-account-authentication"></a>Аутентификация учетной записи пакетной службы

Доступ к учетной записи пакетной службы поддерживает два метода проверки подлинности: общий ключ и [Azure Active Directory (Azure AD)](batch-aad-auth.md).

Мы настоятельно рекомендуем использовать Azure AD для проверки подлинности учетной записи пакетной службы. Для некоторых возможностей пакетной службы требуется этот метод проверки подлинности, включая многие связанные с безопасностью функции, обсуждаемые здесь.

### <a name="batch-account-pool-allocation-mode"></a>Режим выделения пула учетной записи пакетной службы

При создании учетной записи пакетной службы можно выбрать один из двух [режимов выделения пула](accounts.md#batch-accounts):

- **Пакетная служба**: параметр по умолчанию, в котором базовая облачная служба или ресурсы масштабируемого набора виртуальных машин, используемые для выделения узлов пула и управления ими, создаются во внутренних подписках и не отображаются непосредственно в портал Azure. Видимы только пулы и узлы пакетной службы. 
- **Подписка пользователя**. Базовая облачная служба или ресурсы масштабируемого набора виртуальных машин создаются в той же подписке, что и учетная запись пакетной службы. Таким образом, эти ресурсы отображаются в подписке в дополнение к соответствующим ресурсам пакетной службы.

При использовании режима подписки пользователя виртуальные машины пакетной службы и другие ресурсы создаются непосредственно в подписке при создании пула. Режим подписки пользователя необходим, если требуется создать пулы пакетной службы с помощью Azure Reserved VM Instances, использовать политику Azure в ресурсах масштабируемого набора виртуальных машин и (или) управлять квотой ядра в подписке (совместно используется всеми учетными записями пакетной службы в подписке). Чтобы создать учетную запись пакетной службы в режиме пользовательской подписки, необходимо зарегистрировать подписку в пакетной службе Azure и связать учетную запись с Azure Key Vault.

## <a name="restrict-network-endpoint-access"></a>Ограничение доступа к конечной точке сети

### <a name="batch-network-endpoints"></a>Конечные точки пакетной службы

Учтите, что по умолчанию конечные точки с общедоступными IP-адресами используются для взаимодействия с учетными записями пакетной службы, пулами пакетной службы и узлами пула.

### <a name="batch-account-api"></a>API учетной записи пакетной службы

 При создании учетной записи пакетной службы создается общедоступная конечная точка, которая используется для вызова большинства операций с учетной записью с помощью [REST API](/rest/api/batchservice/). Конечная точка учетной записи имеет базовый URL-адрес, использующий формат `https://{account-name}.{region-id}.batch.azure.com` . Доступ к учетной записи пакетной службы обеспечивается с помощью подключения к конечной точке учетной записи, зашифрованной с помощью HTTPS, и каждого запроса, прошедшего проверку подлинности с использованием общего ключа или Azure Active Directory (Azure AD).

### <a name="azure-resource-manager"></a>Azure Resource Manager

В дополнение к операциям, относящимся к учетной записи пакетной службы, [операции управления](/rest/api/batchmanagement/) применяются к одной и нескольким учетным записям пакета. Доступ к этим операциям управления осуществляется через Azure Resource Manager.

Операции управления пакетной службой через Azure Resource Manager шифруются по протоколу HTTPS, и каждый запрос проходит проверку подлинности с помощью аутентификации Azure AD.

### <a name="batch-pool-nodes"></a>Узлы пула пакетной службы

Пакетная служба взаимодействует с агентом узла пакетной службы, который выполняется на каждом узле в пуле. Например, служба указывает агенту узла выполнить задачу, прерывать задачу или получить файлы для задачи. Связь с агентом узла включается одним или несколькими подсистемами балансировки нагрузки, количество которых зависит от количества узлов в пуле. Балансировщик нагрузки перенаправляет связь с нужным узлом, при этом каждый узел подписывается по уникальному номеру порта. По умолчанию подсистемы балансировки нагрузки имеют связанные с ними общедоступные IP-адреса. Вы также можете удаленно обращаться к узлам пула через RDP или SSH (этот доступ включен по умолчанию, с обменом данными через подсистемы балансировки нагрузки).

### <a name="restricting-access-to-batch-endpoints"></a>Ограниченный доступ к конечным точкам пакета 

Существует несколько возможностей для ограничения доступа к различным конечным точкам пакета, особенно если решение использует виртуальную сеть. 

#### <a name="use-private-endpoints"></a>Использование частных конечных точек

[Частная ссылка Azure](../private-link/private-link-overview.md) обеспечивает доступ к службам Azure PaaS и службам, размещенным в Azure, на основе частной конечной точки в виртуальной сети. С помощью частной ссылки можно ограничить доступ к учетной записи пакетной службы из виртуальной сети или из любой одноранговой виртуальной сети. Ресурсы, сопоставленные с Приватным каналом, также доступны локально по частному пирингу через VPN или Azure ExpressRoute.

Для использования частных конечных точек учетная запись пакетной службы должна быть настроена соответствующим образом при создании; необходимо отключить конфигурацию доступа к общедоступной сети. После создания частные конечные точки можно создать и связать с учетной записью пакетной службы. Дополнительные сведения см. [в статье использование частных конечных точек с учетными записями пакетной службы Azure](private-connectivity.md).

#### <a name="create-pools-in-virtual-networks"></a>Создание пулов в виртуальных сетях

Вычислительные узлы в пуле пакетной службы могут взаимодействовать друг с другом, например для выполнения задач с несколькими экземплярами, не требуя виртуальной сети (VNET). Однако по умолчанию узлы в пуле не могут взаимодействовать с виртуальными машинами, находящимися за пределами пула в виртуальной сети, и иметь частные IP-адреса, такие как серверы лицензий или файловые серверы.

Чтобы обеспечить безопасную связь между узлами вычислений с другими виртуальными машинами или с локальной сетью, можно настроить пул в подсети Azure VNET.

Если у пулов есть общедоступные конечные точки IP-адресов, подсеть должна разрешать входящий трафик из пакетной службы, чтобы иметь возможность планировать задачи и выполнять другие операции на этих узлах, а также исходящий обмен данными с хранилищем Azure или другими ресурсами, необходимыми для вашей рабочей нагрузки. Для пулов в конфигурации виртуальной машины Пакетная службы добавляет группы безопасности сети (группы безопасности сети) на уровне сетевого интерфейса, подключенного к вычисленным узлам. Эти группы безопасности сети имеют правила для включения:

- Входящий трафик TCP из IP-адресов пакетной службы
- Входящий трафик TCP для удаленного доступа
- Исходящий трафик по любому порту в виртуальной сети (может быть изменен на правила NSG на уровне подсети).
- Исходящий трафик на любом порте в Интернете (может быть изменен в соответствии с правилами NSG на уровне подсети).

Не нужно указывать группы безопасности сети на уровне подсети виртуальной сети, так как пакет настраивает собственный группы безопасности сети. Если у вас есть NSG, связанный с подсетью, в которой развернуты составные кластерные узлы, или если вы хотите применить настраиваемые правила NSG для переопределения применяемых по умолчанию правил, необходимо настроить этот NSG по крайней мере с помощью правил безопасности для входящего и исходящего трафика, чтобы обеспечить взаимодействие пакетной службы с узлами пула и связью с узлом пула в службе хранилища Azure.

Дополнительные сведения см. [в статье Создание пула пакетной службы Azure в виртуальной сети](batch-virtual-network.md).

#### <a name="create-pools-with-static-public-ip-addresses"></a>Создание пулов со статическими общедоступными IP-адресами

По умолчанию общедоступные IP-адреса, связанные с пулами, являются динамическими. они создаются при создании пула, а IP-адреса могут добавляться или удаляться при изменении размера пула. Если приложениям задач, выполняемым на узлах пула, требуется доступ к внешним службам, доступ к этим службам может быть ограничен конкретными IP-адресами.  В этом случае наличие динамических IP-адресов не будет управляться.

Вы можете создать статические ресурсы общедоступного IP-адреса в той же подписке, что и учетная запись пакетной службы, до создания пула. Затем эти адреса можно указать при создании пула.

Дополнительные сведения см. в статье [Создание пула пакетной службы Azure с указанными общедоступными IP-адресами](create-pool-public-ip.md).

#### <a name="create-pools-without-public-ip-addresses"></a>Создание пулов без общедоступных IP-адресов

По умолчанию всем вычисленным узлам в пуле конфигурации виртуальной машины пакетной службы Azure назначается один или несколько общедоступных IP-адресов. Эти конечные точки используются пакетной службой для планирования задач и обмена данными с узлами вычислений, включая исходящий доступ к Интернету.

Чтобы ограничить доступ к этим узлам и снизить возможность обнаружения этих узлов из Интернета, можно предоставить пул без общедоступных IP-адресов.

Дополнительные сведения см. [в статье Создание пула без общедоступных IP-адресов](batch-pool-no-public-ip-address.md).

#### <a name="limit-remote-access-to-pool-nodes"></a>Ограничение удаленного доступа к узлам пула

По умолчанию Пакетная служба позволяет пользователю узла с сетевым подключением подключаться извне к кластерному узлу в пуле пакетной службы по протоколу RDP или SSH.

Чтобы ограничить удаленный доступ к узлам, используйте один из следующих методов.

- Настройте [пулендпоинтконфигуратион](/rest/api/batchservice/pool/add#poolendpointconfiguration) , чтобы запретить доступ. Соответствующая группа безопасности сети (NSG) будет связана с пулом.
- Создайте пул [без общедоступных IP-адресов](batch-pool-no-public-ip-address.md). По умолчанию к этим пулам нельзя получить доступ за пределами виртуальной сети.
- Свяжите NSG с виртуальной сетью, чтобы запретить доступ к портам RDP или SSH.
- Не создавайте пользователей на узле. Без пользователей узлов удаленный доступ будет невозможен.

## <a name="encrypt-data"></a>Шифрование данных

### <a name="encrypt-data-in-transit"></a>Шифрование передаваемых данных

Все соединения с конечной точкой учетной записи пакетной службы (или с помощью Azure Resource Manager) должны использовать протокол HTTPS. При `https://` подключении к пакетной службе необходимо использовать в URL-адресах учетной записи пакетной службы, указанных в API.

Клиенты, взаимодействующие с пакетной службой, должны быть настроены для использования протокола TLS 1,2.

### <a name="encrypt-batch-data-at-rest"></a>Шифрование неактивных данных пакета

Некоторые сведения, указанные в API пакетной службы, такие как сертификаты учетных записей, метаданные заданий и задач, а также командные строки задач, автоматически шифруются при хранении пакетной службой. По умолчанию эти данные шифруются с помощью ключей, управляемых платформой пакетной платформы Azure, уникальных для каждой учетной записи пакетной службы.

Эти данные также можно зашифровать с помощью [управляемых клиентом ключей](batch-customer-managed-key.md). [Azure Key Vault](../key-vault/general/overview.md) используется для создания и хранения ключа с идентификатором ключа, зарегистрированным в учетной записи пакетной службы.

### <a name="encrypt-compute-node-disks"></a>Шифрование дисков узла вычислений

Для кластерных узлов пакетной службы по умолчанию используются два диска: диск операционной системы и локальный временный SSD. [Файлы и каталоги](files-and-directories.md) , управляемые пакетом, размещаются на временном SSD, который является расположением по умолчанию для файлов, таких как выходные файлы задач. Приложения пакетной задачи могут использовать расположение по умолчанию на SSD или на диске ОС.

Для обеспечения дополнительной безопасности зашифруйте эти диски с помощью одной из следующих возможностей шифрования дисков Azure:

- [Управляемое шифрование диска неактивных с ключами, управляемыми платформой](../virtual-machines/disk-encryption.md#platform-managed-keys)
- [Шифрование на узле с помощью управляемого платформой ключа](../virtual-machines/disk-encryption.md#encryption-at-host---end-to-end-encryption-for-your-vm-data)
- [Дисковое шифрование Azure](disk-encryption.md)

## <a name="securely-access-services-from-compute-nodes"></a>Безопасный доступ к службам с узлов вычислений

Узлы пакетной службы могут [безопасно обращаться к учетным данным и секретам](credential-access-key-vault.md) , хранящимся в [Azure Key Vault](../key-vault/general/overview.md), которые могут использоваться приложениями задач для доступа к другим службам. Сертификат используется для предоставления узлам пула доступа к Key Vault.

## <a name="governance-and-compliance"></a>Система управления и соответствие требованиям

### <a name="compliance"></a>Соответствие нормативным требованиям

Чтобы помочь клиентам удовлетворить свои обязательства по обеспечению соответствия в регулируемых отраслях и рынках по всему миру, Azure поддерживает [большой портфель предложений соответствия](https://azure.microsoft.com/overview/trusted-cloud/compliance). 

Эти предложения основаны на различных типах гарантий, включая формальные сертификаты, аттестации, проверки, авторизации и оценки, полученные от независимых компаний по аудиту, а также о контрактных предложениях, самостоятельной оценке и документах, посвященных клиентам, созданным корпорацией Майкрософт. Ознакомьтесь с [полным обзором предложений о соответствии требованиям](https://aka.ms/AzureCompliance) , чтобы определить, какие из них могут быть связаны с решениями пакетной службы.

### <a name="azure-policy"></a>Политика Azure

[Политика Azure](../governance/policy/overview.md) помогает применять стандарты Организации и оценивать соответствие при масштабировании. Политика Azure широко применяется для реализации средств контроля за согласованностью ресурсов, соответствием нормативным требованиям, безопасностью, расходами и управлением.

В зависимости от режима выделения пула и ресурсов, к которым должна применяться политика, используйте политику Azure с пакетной службой одним из следующих способов.

- Напрямую, используя ресурс Microsoft.BatCH/Батчаккаунтс. Можно использовать подмножество свойств для учетной записи пакетной службы. Например, политика может включать допустимые регионы учетной записи пакетной службы, разрешенный режим выделения пула и возможность включения общедоступной сети для учетных записей.
- Косвенно, используя ресурс Microsoft. COMPUTE/virtualMachineScaleSets. Учетные записи пакетной службы с режимом выделения пула пользовательских подписок могут иметь политику, заданную для ресурсов масштабируемого набора виртуальных машин, создаваемых в подписке учетной записи Batch. Например, разрешены размеры виртуальных машин и убедитесь, что определенные расширения выполняются на каждом узле пула.

## <a name="next-steps"></a>Дальнейшие действия

- Ознакомьтесь с [базовым планом безопасности Azure для пакетной](security-baseline.md)службы.
- Ознакомьтесь с дополнительными [рекомендациями по пакетной службе Azure](best-practices.md).