---
title: Использование частных конечных точек с учетными записями пакетной службы Azure
description: Узнайте, как использовать частные конечные точки для частного подключения к учетной записи пакетной службы Azure.
ms.topic: how-to
ms.date: 09/28/2020
ms.custom: references_regions
ms.openlocfilehash: d2e9d36e9e964f2e9f9a5a986fbf55d19b3069d8
ms.sourcegitcommit: 436518116963bd7e81e0217e246c80a9808dc88c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/27/2021
ms.locfileid: "98920009"
---
# <a name="use-private-endpoints-with-azure-batch-accounts"></a>Использование частных конечных точек с учетными записями пакетной службы Azure

По умолчанию [учетные записи пакетной службы Azure](accounts.md) имеют общедоступную конечную точку и доступны для общего доступа. Пакетная служба предоставляет возможность создавать частные учетные записи пакетной службы, отключая доступ к общедоступной сети.

С помощью функции " [Частная связь Azure](../private-link/private-link-overview.md)" можно подключиться к учетной записи пакетной службы Azure через [закрытую конечную точку](../private-link/private-endpoint-overview.md). Частная конечная точка — это набор частных IP-адресов в подсети в виртуальной сети. Затем можно ограничить доступ к учетной записи пакетной службы Azure по частным IP-адресам.

Частная ссылка позволяет пользователям получить доступ к учетной записи пакетной службы Azure из виртуальной сети или из любой одноранговой виртуальной сети. Ресурсы, сопоставленные с частной ссылкой, также доступны локально через частный пиринг через VPN или [Azure ExpressRoute](../expressroute/expressroute-introduction.md). Вы можете подключиться к учетной записи пакетной службы Azure, для которой настроена частная связь, с помощью [метода автоматического или ручного утверждения](../private-link/private-endpoint-overview.md#access-to-a-private-link-resource-using-approval-workflow).

> [!IMPORTANT]
> Поддержка частного подключения в пакетной службе Azure в настоящее время доступна для всех регионов, кроме Германии Central, Северо-Восточная Германия, Восточный Китай, Восточный Китай 2, Северный Китай и Северный Китай 2.

В этой статье описываются действия по созданию частной учетной записи пакетной службы и доступу к ней с помощью частной конечной точки.

## <a name="azure-portal"></a>Портал Azure

Чтобы создать учетную запись частного пакета с помощью портал Azure, выполните следующие действия.

1. В области **создать ресурс** выберите **Пакетная служба** , а затем щелкните **создать**.
2. Введите имя подписки, группы ресурсов, региона и учетной записи пакетной службы на вкладке " **основы** " и нажмите кнопку **Далее: дополнительно**.
3. На вкладке **Дополнительно** задайте для параметра **доступ к** общедоступной сети значение **отключено**.
4. В окне **Параметры** выберите **частные конечные точки подключения** и выберите **+ Частная конечная точка**.
   :::image type="content" source="media/private-connectivity/private-endpoint-connections.png" alt-text="Подключения к частным конечным точкам":::
5. На панели " **основы** " введите или выберите подписку, группу ресурсов, имя ресурса частной конечной точки и сведения о регионе, а затем выберите **Далее: ресурс**.
6. В области **ресурсов** задайте **тип ресурса** **Microsoft.BatCH/батчаккаунтс**. Выберите учетную запись частного пакета, к которой требуется получить доступ, а затем нажмите кнопку **Далее: Конфигурация**.
   :::image type="content" source="media/private-connectivity/create-private-endpoint.png" alt-text="Создание частной конечной точки — область ресурсов":::
7. В области **Конфигурация** введите или выберите следующие сведения:
   - **Виртуальная сеть**. Выберите виртуальную сеть.
   - **Подсеть**. Выберите подсеть.
   - **Интеграция с частной зоной DNS**: выберите **Да**. Для частного подключения к частной конечной точке требуется запись DNS. Рекомендуем интегрировать частную конечную точку с частной зоной DNS. Вы также можете использовать собственные DNS-серверы или создать записи DNS с использованием файлов узлов на своих виртуальных машинах.
   - **Частная зона DNS зона**: выберите привателинк. \<region\> . batch.azure.com. Частная зона DNS определяется автоматически. Ее нельзя изменить на портале Azure.
8. Выберите **проверить и создать**, а затем подождите, пока Azure проверит вашу конфигурацию.
9. При появлении сообщения **Проверка пройдена** нажмите кнопку **Создать**.

После подготовки частной конечной точки вы можете получить доступ к учетной записи пакетной службы из виртуальных машин в той же виртуальной сети с помощью частной конечной точки.

> [!IMPORTANT]
> Выполнение операций вне виртуальной сети, в которой подготовлена частная конечная точка, приведет к появлению сообщения "Аусоризатионфаилуре" на портале Azure.

Чтобы просмотреть IP-адрес из портал Azure:

1. Щелкните **Все ресурсы**.
2. Найдите частную конечную точку, созданную ранее.
3. Перейдите на вкладку **Обзор**, чтобы просмотреть параметры DNS и IP-адреса.

:::image type="content" source="media/private-connectivity/access-private.png" alt-text="Параметры DNS частной конечной точки и IP-адреса":::

## <a name="azure-resource-manager-template"></a>Шаблон Azure Resource Manager

При [создании учетной записи пакетной службы с помощью шаблона Azure Resource Manager](quick-create-template.md)измените шаблон, чтобы задать для **публикнетворкакцесс** значение **disabled** , как показано ниже.

```json
{
  "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "parameters": {
    "batchAccountName": {
      "type": "string",
      },
    "location": {
      "type": "string",
    }
  },
  "resources": [
    {
      "name": "[parameters('batchAccountName')]",
      "type": "Microsoft.Batch/batchAccounts",
      "apiVersion": "2020-03-01-preview",
      "location": "[parameters('location')]",
      "dependsOn": []
      "properties": {
        "poolAllocationMode": "BatchService"
        "publicNetworkAccess": "Disabled"
      }
    }
  ]
}
```

## <a name="configure-dns-zones"></a>Настройка зон DNS

Используйте [частную зону DNS](../dns/private-dns-privatednszone.md) в подсети, в которой была создана частная конечная точка. Настройте конечные точки таким образом, чтобы каждый частный IP-адрес был сопоставлен с записью DNS.

При создании частной конечной точки ее можно интегрировать с [частной зоной DNS](../dns/private-dns-privatednszone.md) в Azure. Если вместо этого вы решили использовать [личный домен](../dns/dns-custom-domain.md), необходимо настроить его для добавления записей DNS для всех частных IP-адресов, зарезервированных для частной конечной точки.

## <a name="pricing"></a>Цены

Дополнительные сведения о затратах, связанных с частными конечными точками, см. в разделе [цены на частную связь Azure](https://azure.microsoft.com/pricing/details/private-link/).

## <a name="current-limitations-and-best-practices"></a>Текущие ограничения и рекомендации

При создании учетной записи частного пакета учитывайте следующее.

- Ресурсы частной конечной точки должны создаваться в той же подписке, что и учетная запись пакетной службы.
- Чтобы удалить частное подключение, необходимо удалить ресурс частной конечной точки.
- Когда учетная запись пакетной службы создается с доступом к общедоступной сети, ее нельзя изменить на частный доступ.
- Записи DNS в частной зоне DNS не удаляются автоматически при удалении частной конечной точки или при удалении региона из учетной записи пакетной службы. Необходимо вручную удалить записи DNS перед добавлением новой частной конечной точки, связанной с этой частной зоной DNS. Если не очистить записи DNS, могут возникнуть непредвиденные проблемы с плоскостью данных, такие как сбои данных в регионах, добавленные после удаления частной конечной точки или удаления региона.

## <a name="next-steps"></a>Дальнейшие действия

- Узнайте, как [создавать пулы пакетной службы в виртуальных сетях](batch-virtual-network.md).
- Узнайте, как [создавать пулы пакетной службы без общедоступных IP-адресов](batch-pool-no-public-ip-address.md) .
- Узнайте, как [создавать пулы пакетной службы с указанными общедоступными IP-адресами](create-pool-public-ip.md).
- Сведения о [частной ссылке Azure](../private-link/private-link-overview.md).
