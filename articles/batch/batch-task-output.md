---
title: Сохранение выходных данных заданий и задач в хранилище данных
description: Дополнительные сведения о различных параметрах для сохранения выходных данных из пакетных задач и заданий. Вы можете сохранить данные в службе хранилища Azure или в другом хранилище данных.
ms.topic: how-to
ms.date: 11/14/2018
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: 4ebe0b6d57225eff9f3f1251d5e491c95e9b7ffc
ms.sourcegitcommit: 772eb9c6684dd4864e0ba507945a83e48b8c16f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "85965116"
---
# <a name="persist-job-and-task-output"></a>Сохранение пакетных заданий и выходных данных задач

[!INCLUDE [batch-task-output-include](../../includes/batch-task-output-include.md)]

К типичным примерам выходных данных задачи относятся:

- файлы, созданные при обработке задачей входных данных;
- файлы журналов, сопоставленные с выполнением задачи.

В этой статье описываются различные способы сохранения выходных данных задачи.

## <a name="options-for-persisting-output"></a>Способы сохранения выходных данных

В зависимости от сценария существует несколько способов для сохранения выходных данных задач:

- [Использование API пакетной службы](batch-task-output-files.md).  
- [Использование библиотеки соглашений по пакетным файлам для .NET](batch-task-output-file-conventions.md).  
- Реализация стандарта соглашений по пакетным файлам в приложении.
- Реализация пользовательского решения для перемещения файлов.

В следующих разделах кратко описан каждый подход, а также приводятся общие рекомендации по сохранению выходных данных.

### <a name="use-the-batch-service-api"></a>Использование API пакетной службы

Пакетная служба поддерживает указание выходных файлов в службе хранилища Azure для данных задачи при [добавлении отдельной задачи](/rest/api/batchservice/add-a-task-to-a-job) или [их коллекции](/rest/api/batchservice/add-a-collection-of-tasks-to-a-job) в задание.

Дополнительные сведения о сохранении выходных данных задач с помощью API пакетной службы см. в разделе [Сохранение данных для задач в службе хранилища Azure с помощью API пакетной службы](batch-task-output-files.md).

### <a name="use-the-batch-file-conventions-library-for-net"></a>Использование библиотеки соглашений по пакетным файлам для .NET

Пакет определяет дополнительный набор соглашений для именования выходных файлов задач в службе хранилища Azure. Эти соглашения описаны в [стандарте соглашений по пакетным файлам](https://github.com/Azure/azure-sdk-for-net/tree/master/sdk/batch/Microsoft.Azure.Batch.Conventions.Files#conventions). Стандарт соглашений об именовании файлов определяет имя целевого контейнера и путь к BLOB-объекту в службе хранилища Azure для заданного выходного файла на основе имен задания и задачи.

Вы сами решаете, нужно ли использовать стандарт соглашений по файлам для именования файлов выходных данных. Вы также можете назначить целевому контейнеру и BLOB-объекту любое подходящее имя. Если для именования выходных файлов используется стандарт соглашений об именовании файлов, то выходные файлы доступны для просмотра на [портале Azure][portal].

Разработчики, создающие пакетные решения с помощью C# и .NET, могут использовать [библиотеку соглашений об именовании файлов для .NET][nuget_package], чтобы сохранять данные задач в учетной записи службы хранилища Azure согласно [стандарту соглашений об именовании пакетных файлов](https://github.com/Azure/azure-sdk-for-net/tree/master/sdk/batch/Microsoft.Azure.Batch.Conventions.Files#conventions). Библиотека соглашений по файлам обрабатывает перемещение выходных файлов в службу хранилища Azure, а также именование целевых контейнеров и BLOB-объектов хорошо известным образом.

Дополнительные сведения о сохранении выходных данных задачи с помощью библиотеки соглашений о файлах для .NET см. в разделе [Сохранение данных заданий и задач в службе хранилища Azure с помощью библиотеки соглашений о пакетных файлах для .NET](batch-task-output-file-conventions.md).

### <a name="implement-the-batch-file-conventions-standard"></a>Реализация стандарта соглашений по пакетным файлам

При работе на языке, отличном от .NET, можно реализовать в приложении [стандарт соглашений по пакетным файлам](https://github.com/Azure/azure-sdk-for-net/tree/master/sdk/batch/Microsoft.Azure.Batch.Conventions.Files#conventions).

Это может быть уместным, когда требуется проверенная схема именования или нужно просматривать выходные данные задач на портале Azure.

### <a name="implement-a-custom-file-movement-solution"></a>Реализация пользовательского решения для перемещения файлов

Вы также можете реализовать собственное полноценное решение для перемещения файлов. Такой подход применим в следующих случаях:

- Требуется сохранить данные задачи в хранилище данных, отличном от службы хранилища Azure. Чтобы отправить файлы в хранилище данных, например Azure SQL или Azure DataLake, можно создать настраиваемый скрипт или исполняемый файл. Затем его можно вызвать в командной строке после запуска основного исполняемого файла. Например, на узле Windows можно вызывать две следующие команды:`doMyWork.exe && uploadMyFilesToSql.exe`
- Требуется выполнить сохранение по контрольным точкам или предварительную отправку начальных результатов.
- Требуется детально управлять обработкой ошибок. Например, может возникнуть потребность в собственном решении, когда нужно использовать действия зависимостей задач для выполнения определенных операций отправки на основе кодов выхода конкретной задачи. Дополнительные сведения о действиях зависимостей задач см. в разделе [Создание зависимостей для выполнения задач, которые зависят от других задач](batch-task-dependencies.md).

## <a name="design-considerations-for-persisting-output"></a>Рекомендации по проектированию сохраняемых выходных данных

При разработке решения пакетной обработки нужно учесть несколько приведенных ниже факторов, связанных с выходными данными заданий и задач.

- **Время существования узла службы вычислений**. Нередко вычислительные узлы являются временными, особенно в пулах с поддержкой автомасштабирования. Выходные данные задачи, которая выполняется на узле, доступны, только пока этот узел существует и только в течение периода хранения файлов, заданного для задачи. Если задача создает выходные данные, которые могут понадобиться после ее завершения, задача должна отправить их в долговременное хранилище, например службу хранилища Azure.

- **Хранилище выходных данных**. В качестве хранилища выходных данных задачи рекомендуется использовать службу хранилища Azure, но подойдет и любое долговременное хранилище. Функция записи выходных данных задачи в службу хранилища Azure интегрирована в API пакетной службы. Если используется другое долговременное хранилище, вам потребуется написать логику приложения для самостоятельного сохранения выходных данных задач.

- **Извлечение выходных данных**. Вы можете получить выходные данные задачи, если они сохраняются, непосредственно с вычислительных узлов в пуле либо из службы хранилища Azure или другого хранилища данных. Чтобы получить выходные данные задачи непосредственно от вычислительных узлов, необходимо знать имя файла и расположение его выходных данных на узле. Если выходные данные задачи сохраняются в службе хранилища Azure, потребуется полный путь к файлу в этой службе, чтобы скачивать подобные файлы с помощью пакета SDK службы хранилища Azure.

- **Просмотр выходных данных**. Если перейти к задаче пакетной службы на портале Azure и щелкнуть **Файлы на узле**, отобразятся все файлы, связанные с задачей, а не только интересующие вас выходные файлы. Опять же, файлы на вычислительных узлах доступны, только пока узел существует и только в течение периода хранения файлов, заданного для задачи. Чтобы просмотреть выходные данные задачи, сохраненные в службе хранилища Azure, можно воспользоваться порталом Azure или клиентским приложением этой службы, например [Обозревателем службы хранилища Azure][storage_explorer]. Чтобы просмотреть выходные данные в службе хранилища Azure с портала или из другого средства, нужно знать расположение файла и перейти напрямую к нему.

## <a name="next-steps"></a>Дальнейшие действия

- Познакомьтесь с новыми функциями в API пакетной службы, предназначенными для сохранения данных задачи, в разделе [Сохранение данных для задач в службе хранилища Azure с помощью API пакетной службы](batch-task-output-files.md).
- Дополнительные сведения об использовании библиотеки соглашений по пакетным файлам для .NET см. в разделе [Сохранение данных заданий и задач в службе хранилища Azure с помощью библиотеки соглашений о пакетных файлах для .NET](batch-task-output-file-conventions.md).
- Ознакомьтесь с примером проекта [PersistOutputs][github_persistoutputs] на GitHub, который показывает, как использовать клиентскую библиотеку пакетной службы и библиотеку соглашений об именовании файлов для .NET, чтобы сохранять выходные данные задач в долговременном хранилище.

[nuget_package]: https://www.nuget.org/packages/Microsoft.Azure.Batch.Conventions.Files
[portal]: https://portal.azure.com
[storage_explorer]: https://storageexplorer.com/
[github_persistoutputs]: https://github.com/Azure/azure-batch-samples/tree/master/CSharp/ArticleProjects/PersistOutputs 
