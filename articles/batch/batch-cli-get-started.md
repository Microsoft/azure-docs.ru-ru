---
title: Начало работы с Azure CLI пакетной службы
description: Ознакомьтесь с командами интерфейса командной строки пакетной службы Azure для управления ресурсами пакетной службы Azure.
ms.topic: how-to
ms.date: 07/24/2018
ms.custom: H1Hack27Feb2017, devx-track-azurecli
ms.openlocfilehash: bee25d9b8985f1627a5cfc05bfb336b83be60f74
ms.sourcegitcommit: 772eb9c6684dd4864e0ba507945a83e48b8c16f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "92144761"
---
# <a name="manage-batch-resources-with-azure-cli"></a>Управление ресурсами пакетной службы с помощью Azure CLI

Azure CLI — это интерфейс командной строки Azure для управления ресурсами Azure. Его можно использовать в Windows, Linux и macOS. Интерфейс командной строки Azure (Azure CLI) оптимизирован для администрирования ресурсов Azure и управления ими из командной строки. При помощи этого интерфейса вы можете управлять учетными записями пакетной службы Azure, а также такими ресурсами, как пулы, задания и задачи. Кроме того, Azure CLI позволяет создавать и выполнять скрипты для многих однотипных задач, выполняемых с помощью API-интерфейсов пакетной службы, портала Azure и командлетов PowerShell пакетной службы.

В этой статье содержатся общие сведения об использовании [Azure CLI версии 2.0](/cli/azure) с пакетной службой. Общие сведения об использовании интерфейса командной строки с Azure см. в статье [Начало работы с Azure CLI](/cli/azure/get-started-with-azure-cli).

## <a name="set-up-the-azure-cli"></a>Настройка Azure CLI

Можно также запустить последнюю версию Azure CLI в [Azure Cloud Shell](../cloud-shell/overview.md). Чтобы установить Azure CLI локально, используйте указания из статьи [Установка Azure CLI 2.0](/cli/azure/install-azure-cli).

> [!TIP]
> Рекомендуем регулярно обновлять интерфейс командной строки Azure, чтобы использовать все преимущества обновлений и улучшений службы.
> 
> 

## <a name="command-help"></a>Справка по командам

Текст справки для каждой команды в Azure CLI можно просмотреть, добавив к ней `-h`. Другие параметры следует опустить. Пример:

* Чтобы получить справку по команде `az`, введите: `az -h`
* Чтобы получить список всех команд пакетной службы в интерфейсе командной строки, используйте: `az batch -h`
* Чтобы получить справку по созданию учетной записи пакетной службы, введите: `az batch account create -h`

Если у вас возникнут сомнения, с помощью параметра командной строки `-h` вы сможете получить справку по любой из команд интерфейса командной строки Azure.



Дополнительные сведения о командах Azure CLI для пакетной службы см. в [справочной документации по Azure CLI](/cli/azure/batch). 

## <a name="log-in-and-authenticate"></a>Вход в систему и проверки подлинности

Чтобы использовать Azure CLI с пакетной службой, сначала необходимо войти в систему и пройти проверку подлинности. Выполните следующие два простых действия:

1. **Войдите в Azure.** Это позволит получить доступ к командам Azure Resource Manager, в том числе командам [службы управления пакетной службой](batch-management-dotnet.md).  
2. **Войдите в учетную запись пакетной службы.** Это позволит получить доступ к командам пакетной службы.   

### <a name="log-in-to-azure"></a>Вход в Azure

В Azure можно войти разными способами, описанными в статье [Вход с помощью Azure CLI](/cli/azure/authenticate-azure-cli):

1. [Интерактивный вход.](/cli/azure/authenticate-azure-cli) Используйте этот способ, если вы самостоятельно выполняете команды Azure CLI из командной строки.
2. [Вход с использованием субъекта-службы.](/cli/azure/authenticate-azure-cli) Используйте этот способ, если вы выполняете команды Azure CLI из скрипта или приложения.

В рамках этого руководства мы покажем, как войти в Azure в интерактивном режиме. В окне командной строки введите [az login](/cli/azure/reference-index#az-login):

```azurecli
# Log in to Azure and authenticate interactively.
az login
```

Команда `az login` возвращает токен, используемый при аутентификации, как показано ниже. Следуйте предоставленным указаниям, чтобы открыть веб-страницу и отправить токен в Azure:

![Вход в Azure](./media/batch-cli-get-started/az-login.png)

Примеры, приведенные в разделе примеров скриптов оболочки, позволяют запустить сеанс Azure CLI после входа в Azure в интерактивном режиме. После входа вы сможете вызвать команды для работы с ресурсами управления пакетной службой, в том числе учетные записи пакетной службы, ключи, пакеты приложений и квоты.  

### <a name="log-in-to-your-batch-account"></a>Вход в учетную запись пакетной службы

Чтобы управлять ресурсами пакетной службы, такими как пулы, задания и задачи, с помощью Azure CLI, сначала необходимо войти в учетную запись пакетной службы и пройти проверку подлинности. Для этого используйте команду [az batch account login](/cli/azure/batch/account#az-batch-account-login). 

Проверку подлинности в учетной записи пакетной службы можно пройти двумя способами:

- **Проверка подлинности через Azure Active Directory (Azure AD)** . 

    При использовании Azure CLI с пакетной службой этот метод проверки подлинности реализован по умолчанию. Мы советуем использовать его в большинстве сценариев. 
    
    При входе в Azure в интерактивном режиме, как описано в предыдущем разделе, учетные данные пользователя кэшируются. Поэтому Azure CLI может войти в учетную запись пакетной службы, используя те же учетные данные. Если вы входите Azure с использованием субъекта-службы, эти учетные данные также используются для входа в учетную запись пакетной службы.

    Преимущество Azure AD заключается в том, что он предлагает управление доступом на основе ролей Azure (Azure RBAC). В Azure RBAC доступ пользователя зависит от назначенной им роли, а не от того, имеют ли они ключи учетной записи. Вместо управления ключами учетной записи вы можете управлять ролями Azure и разрешать доступ и проверку подлинности в Azure AD.  

     Чтобы войти в учетную запись пакетной службы с помощью Azure AD, вызовите команду [az batch account login](/cli/azure/batch/account#az-batch-account-login): 

    ```azurecli
    az batch account login -g myresource group -n mybatchaccount
    ```

- **Проверка подлинности на основе общего ключа**.

    При использовании метода [проверки подлинности на основе общего ключа](/rest/api/batchservice/authenticate-requests-to-the-azure-batch-service#authentication-via-shared-key) проверка подлинности команд Azure CLI для пакетной службы выполняется на основе ключей доступа к учетной записи.

    Если вы используете скрипты Azure CLI для автоматического вызова команд пакетной службы, вы можете реализовать проверку подлинности на основе общего ключа или проверку подлинности Azure AD с использованием субъекта-службы. В некоторых случаях проверку подлинности на основе общего ключа реализовать проще, чем создать субъект-службу.  

    Чтобы войти с использованием проверки подлинности на основе общего ключа, включите параметр `--shared-key-auth` в командной строке:

    ```azurecli
    az batch account login -g myresourcegroup -n mybatchaccount --shared-key-auth
    ```

В примерах, приведенных в разделе примеров скриптов оболочки, описано, как войти в учетную запись пакетной службы с помощью Azure CLI, используя Azure AD и общий ключ.

## <a name="use-azure-batch-cli-extension-commands"></a>Использование команд расширения CLI для пакетной службы Azure

Установив расширение CLI для пакетной службы Azure, можно использовать Azure CLI для запуска заданий пакетной службы без необходимости писать код. Команды пакетной службы, поддерживаемые расширением, позволяют использовать шаблоны JSON для создания пулов, заданий и задач с помощью Azure CLI. Вы также можете использовать команды расширения CLI для отправки входных файлов заданий в учетную запись хранения Azure, связанную с учетной записью пакетной службы, а также скачивания выходных файлов задания из нее. Дополнительные сведения см. в статье [Использование шаблонов интерфейса командной строки для пакетной службы Azure и передачи файлов (предварительная версия)](batch-cli-templates.md).

## <a name="script-examples"></a>Примеры скриптов

Дополнительные сведения о выполнении распространенных задач см. в [примерах скриптов CLI](./scripts/batch-cli-sample-create-account.md) для пакетной службы. В этих примерах описываются разные команды, используемые в Azure CLI для пакетной службы для создания и администрирования учетных записей, пулов, заданий и задач.

## <a name="json-files-for-resource-creation"></a>JSON-файлы для создания ресурса

После создания ресурсов пакетной службы, таких как пулы и задания, вы можете указать JSON-файл, содержащий конфигурацию нового ресурса, вместо того чтобы передавать его параметры в виде параметров командной строки. Пример:

```azurecli
az batch pool create my_batch_pool.json
```

Хотя большинство ресурсов пакетной службы можно создавать только с помощью параметров командной строки, для некоторых функций необходимо указать файл формата JSON, содержащий сведения о ресурсе. Например, JSON-файл следует использовать, если нужно указать файлы ресурсов для задачи запуска.

Синтаксис JSON, необходимый для создания ресурса, см. в [справочной документации по REST API пакетной службы][rest_api]. В каждой статье о добавлении *определенного типа ресурса* приведены примеры скриптов JSON для создания этого ресурса. Вы можете использовать эти примеры скриптов как шаблоны файлов JSON, которые можно использовать с Azure CLI. Например, синтаксис JSON для создания пула см. в статье [Добавление пула в учетную запись][rest_add_pool].

Пример скрипта указания файла JSON см. в статье [Выполнение заданий в пакетной службе Azure с помощью Azure CLI](./scripts/batch-cli-sample-run-job.md).

> [!NOTE]
> Если при создании ресурса вы указываете JSON-файл, все остальные параметры, которые указываются в командной строке для этого ресурса, можно пропустить.
> 
> 

## <a name="efficient-queries-for-batch-resources"></a>Эффективные запросы для ресурсов пакетной службы

Каждый тип ресурса пакетной службы поддерживает команду `list` , которая запрашивает учетную запись пакетной службы и предоставляет списки ресурсов заданного типа. Например, вы можете получить список пулов в учетной записи и задач, входящих в задание, следующим образом:

```azurecli
az batch pool list
az batch task list --job-id job001
```

При выполнении запроса к пакетной службе, используя операцию `list`, вы можете указать предложение OData, чтобы ограничить объем возвращаемых данных. Так как фильтрация выполняется на стороне сервера, передаются только запрашиваемые данные. Используйте эти предложения для экономии пропускной способности (а значит, и времени) при выполнении операций со списками.

В таблице ниже описаны предложения OData, поддерживаемые пакетной службой.

| Предложение | Описание |
|---|---|
| `--select-clause [select-clause]` | Возвращает подмножество свойств для каждой сущности. |
| `--filter-clause [filter-clause]` | Возвращает только те сущности, которые соответствуют указанному выражению OData. |
| `--expand-clause [expand-clause]` | Получает сведения о сущности за один базовый вызов REST. Сейчас предложение expand поддерживает только свойство `stats`. |

Пример скрипта с предложением OData см. в статье [Выполнение заданий в пакетной службе Azure с помощью Azure CLI](./scripts/batch-cli-sample-run-job.md).

Дополнительные сведения о выполнении эффективных запросов на вывод списка с приложениями OData см. в [этой статье](batch-efficient-list-queries.md).

## <a name="troubleshooting-tips"></a>Советы по устранению неполадок

Ниже приведены советы, которые могут помочь устранить проблемы с Azure CLI.

* Используйте параметр `-h` , чтобы вывести на экран **текст справки** по любой из команд интерфейса командной строки.
* Чтобы отобразить выходные данные команды **verbose**, используйте `-v` и `-vv`. Когда флаг `-vv` включен, Azure CLI отображает текущие REST-запросы и ответы. Эти параметры удобно использовать для просмотра полного вывода ошибок.
* Вы можете просмотреть **выходные данные команды в виде JSON** с помощью параметра `--json`. Например, параметр `az batch pool show pool001 --json` отображает свойства элемента pool001 в формате JSON. Затем вы можете скопировать и изменить эти выходные данные для использования в параметре `--json-file` (см. выше раздел, посвященный JSON-файлам).
<!---Loc Comment: Please, check link [JSON files] since it's not redirecting to any location.--->

## <a name="next-steps"></a>Дальнейшие действия

* См. [документацию по Azure CLI](/cli/azure).
* Узнайте подробнее о [рабочем процессе и основных ресурсах пакетной службы](batch-service-workflow-features.md), таких как пулы, узлы, задания и задачи.
* Дополнительные сведения о создании пулов, заданий и задач без написания кода с помощью шаблонов пакетной службы см. в руководстве [Использование шаблонов интерфейса командной строки для пакетной службы Azure и передачи файлов](batch-cli-templates.md).

[github_readme]: https://github.com/Azure/azure-xplat-cli/blob/dev/README.md
[rest_api]: /rest/api/batchservice/
[rest_add_pool]: /rest/api/batchservice/pool/add
