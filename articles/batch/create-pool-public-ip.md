---
title: Создание пула с указанными общедоступными IP-адресами
description: Узнайте, как создать пул пакетной службы, использующий собственные общедоступные IP-адреса.
ms.topic: how-to
ms.date: 10/08/2020
ms.openlocfilehash: e822311718847e173763847d503335f71457308b
ms.sourcegitcommit: 772eb9c6684dd4864e0ba507945a83e48b8c16f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "91849334"
---
# <a name="create-an-azure-batch-pool-with-specified-public-ip-addresses"></a>Создание пула пакетной службы Azure с указанными общедоступными IP-адресами

При создании пула пакетной службы Azure [пул можно подготавливать в подсети указанной вами виртуальной сети Azure](batch-virtual-network.md) . Доступ к виртуальным машинам в пуле пакетной службы осуществляется через общедоступные IP-адреса, созданные пакетной службой. Эти общедоступные IP-адреса могут измениться в течение всего времени существования пула. Это означает, что параметры сети могут устареть, если IP-адреса не обновляются.

Вы можете создать список статических общедоступных IP-адресов для использования с виртуальными машинами в пуле. Это позволяет управлять списком общедоступных IP-адресов и обеспечивать их непредвиденное изменение. Это может быть особенно полезно при работе с любой внешней службой, такой как база данных, которая разрешает доступ к определенным IP-адресам.

Сведения о создании пулов без общедоступных IP-адресов см. в статье [Создание пула пакетной службы Azure без общедоступных IP-адресов](./batch-pool-no-public-ip-address.md).

## <a name="prerequisites"></a>Предварительные требования

- **Проверка подлинности**. Чтобы использовать общедоступный IP-адрес, API клиента пакетной [службы должен использовать проверку подлинности Azure Active Directory (AD)](batch-aad-auth.md).

- **Виртуальная сеть Azure**. Необходимо использовать [виртуальную сеть](batch-virtual-network.md) из той же подписки Azure, в которой создается пул и IP-адреса. Можно использовать только виртуальных сетей на основе Azure Resource Manager. Убедитесь, что виртуальная сеть соответствует всем [общим требованиям](batch-virtual-network.md#vnet-requirements).

- **По крайней мере один общедоступный IP-адрес Azure**. Чтобы создать один или несколько общедоступных IP-адресов, можно использовать [портал Azure](../virtual-network/virtual-network-public-ip-address.md#create-a-public-ip-address), [интерфейс Command-Line Azure (CLI)](/cli/azure/network/public-ip#az-network-public-ip-create)или [Azure PowerShell](/powershell/module/az.network/new-azpublicipaddress). Обязательно следуйте приведенным ниже требованиям.

> [!NOTE]
> Пакетная службы автоматически выделяет дополнительные сетевые ресурсы в группе ресурсов, содержащей общедоступные IP-адреса. Для каждого выделенного 100 узла Пакетная служба обычно выделяет одну группу безопасности сети (NSG) и одну подсистему балансировки нагрузки. Эти ресурсы ограничиваются квотами ресурсов подписки. При использовании более крупных пулов может потребоваться [запросить увеличение квоты](batch-quota-limit.md#increase-a-quota) для одного или нескольких из этих ресурсов.

## <a name="public-ip-address-requirements"></a>Требования к общедоступному IP-адресу

При создании общедоступных IP-адресов учитывайте следующие требования.

- Общедоступные IP-адреса должны находиться в той же подписке и регионе, что и учетная запись пакетной службы, используемая для создания пула.
- Для **назначения IP-адресов** необходимо задать значение **static**.
- **Номер SKU** должен быть установлен в значение " **стандартный**".
- Необходимо указать DNS-имя.
- Общедоступные IP-адреса должны использоваться только для пулов конфигурации виртуальных машин. Никакие другие ресурсы не должны использовать эти IP-адреса, или пул может столкнуться с ошибками выделения ресурсов.
- Политики безопасности и блокировки ресурсов не должны ограничивать доступ пользователя к общедоступному IP-адресу.
- Количество общедоступных IP-адресов, указанных для пула, должно быть достаточно большим, чтобы соответствовать количеству виртуальных машин, предназначенных для пула. Это должна быть по крайней мере сумма свойств **таржетдедикатеднодес**   и **таржетловприоритинодес**   пула. Если IP-адреса недостаточно, пул частично выделяет ресурсы для вычислений, и возникнет ошибка изменения размера. В настоящее время Пакетная обработка использует один общедоступный IP-адрес для каждых 100 виртуальных машин.
- Всегда иметь дополнительный буфер общедоступных IP-адресов. Рекомендуется добавить по крайней мере один дополнительный общедоступный IP-адрес или примерно 10% от общего числа общедоступных IP-адресов, добавляемых в пул, в зависимости от того, какое значение больше. Этот дополнительный буфер поможет пакетно выполнить внутреннюю оптимизацию при уменьшении масштаба, а также ускорить масштабирование после неудачного увеличения или уменьшения масштаба.
- После создания пула вы не сможете добавить или изменить список общедоступных IP-адресов, используемых пулом. Если необходимо изменить список, необходимо удалить пул, а затем создать его заново.

## <a name="create-a-batch-pool-with-public-ip-addresses"></a>Создание пула пакетной службы с общедоступными IP-адресами

В приведенном ниже примере показано, как использовать [пакетную службу Azure REST API](/rest/api/batchservice/pool/add) для создания пула, использующего общедоступные IP-адреса.

### <a name="batch-service-rest-api"></a>REST API пакетной службы

Универсальный код ресурса (URI) REST API

```http
POST {batchURL}/pools?api-version=2020-03-01.11.0
client-request-id: 00000000-0000-0000-0000-000000000000
```

Текст запроса

```json
"pool": {
      "id": "pool2",
      "vmSize": "standard_a1",
      "virtualMachineConfiguration": {
        "imageReference": {
          "publisher": "Canonical",
          "offer": "UbuntuServer",
          "sku": "16.04.0-LTS"
        },
        "nodeAgentSKUId": "batch.node.ubuntu 16.04"
      },
"networkConfiguration": {
          "subnetId": "/subscriptions/<subId>/resourceGroups/<rgId>/providers/Microsoft.Network/virtualNetworks/<vNetId>/subnets/<subnetId>",
          "publicIPAddressConfiguration": {
            "provision": "usermanaged",
            "ipAddressIds": [
              "/subscriptions/<subId>/resourceGroups/<rgId>/providers/Microsoft.Network/publicIPAddresses/<publicIpId>"
          ]
        },

       "resizeTimeout":"PT15M",
      "targetDedicatedNodes":5,
      "targetLowPriorityNodes":0,
      "taskSlotsPerNode":3,
      "taskSchedulingPolicy": {
        "nodeFillType":"spread"
      },
      "enableAutoScale":false,
      "enableInterNodeCommunication":true,
      "metadata": [ {
        "name":"myproperty",
        "value":"myvalue"
      } ]
    }
```

## <a name="next-steps"></a>Дальнейшие действия

- Узнайте подробнее о [рабочем процессе и основных ресурсах пакетной службы](batch-service-workflow-features.md), таких как пулы, узлы, задания и задачи.
- Узнайте [, как создать пул в подсети виртуальной сети Azure](batch-virtual-network.md).
- Узнайте [, как создать пул пакетной службы Azure без общедоступных IP-адресов](./batch-pool-no-public-ip-address.md).

