---
title: Основные понятия — схема сети для Azure Red Hat на OpenShift 4
description: Схема сети и общие сведения о сети Azure Red Hat OpenShift
author: sakthi-vetrivel
ms.author: suvetriv
ms.topic: tutorial
ms.service: azure-redhat-openshift
ms.date: 11/23/2020
ms.openlocfilehash: 5d69aacb6e3f25e3414aa446c4c5ae7852cabdfc
ms.sourcegitcommit: f28ebb95ae9aaaff3f87d8388a09b41e0b3445b5
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/29/2021
ms.locfileid: "101720908"
---
# <a name="network-concepts-for-azure-red-hat-openshift-aro"></a>Основные понятия сети для Azure Red Hat OpenShift (АТО)

В этом руководстве приведены общие сведения о сетях в Azure Red Hat OpenShift на базе кластеров OpenShift 4, а также схема и список важных конечных точек. Дополнительную информацию об основных понятиях, связанных с сетями в OpenShift, см. в [документации по сетям в Azure Red Hat OpenShift 4](https://docs.openshift.com/container-platform/4.6/networking/understanding-networking.html).

![Схема сети в Azure Red Hat OpenShift 4](./media/concepts-networking/aro4-networking-diagram.png)

При развертывании Azure Red Hat на OpenShift 4 весь кластер размещается в виртуальной сети. В этой виртуальной сети главные и рабочие узлы находятся в собственных подсетях. Каждая подсеть использует внутреннюю подсистему балансировки нагрузки и общедоступную подсистему балансировки нагрузки.

## <a name="networking-components"></a>Сетевые компоненты

В следующем списке перечислены важные компоненты сети в кластере Azure Red Hat OpenShift:

* **aro-pls**
    * Это конечная точка Приватного канала Azure, которая используется специалистами по обеспечению надежности сайтов корпорации Майкрософт и компании Red Hat для управления кластером.
* **aro-internal-lb**
    * Эта конечная точка распределяет трафик на сервер API. Главные узлы для этой подсистемы балансировки нагрузки находятся во внутреннем пуле.
* **aro-public-lb**
    * Если API является общедоступным, эта конечная точка направляет и распределяет трафик на сервер API. Эта конечная точка назначает общедоступный IP-адрес для исходящих подключений, чтобы главные серверы могли обращаться к Azure Resource Manager и сообщать о работоспособности кластера.
* **aro-internal**
    * Эта конечная точка распределяет внутренний трафик службы. Рабочие узлы для этой подсистемы балансировки нагрузки находятся во внутреннем пуле.
    * По умолчанию эта подсистема балансировки нагрузки не создается. Она создается только при создании службы типа LoadBalancer с правильными заметками. Например, так: service.beta.kubernetes.io/azure-load-balancer-internal: "true".
* **aro-internal-lb**
    * Эта конечная точка используется для любого общедоступного трафика. Когда вы создаете приложение и маршрут, именно этот путь назначается для входящего трафика.
    * Эта подсистема балансировки нагрузки также применяется к исходящим подключениям к Интернету из любого pod, запущенного на рабочих узлах с использованием правил исходящего трафика Azure Load Balancer.
        * Сейчас правила для исходящего трафика настроить нельзя. Они выделяют каждому узлу 1024 TCP-порта.
        * DisableOutboundSnat не настраивается в правилах LB, а значит объекты pod могут получить любой исходящий IP-адрес и любой общедоступный IP-адрес, настроенный для этого Azure Load Balancer.
        * Как следствие двух предыдущих правил временные порты SNAT можно добавить только путем добавления общедоступных служб типа LoadBalancer в АRО.
* **aro-outbound-pip**
    * Эта конечная точка служит общедоступным IP-адресом для рабочих узлов.
    * Эта конечная точка позволяет добавить в список разрешения служб конкретный IP-адрес для исходящих подключений из кластера Azure Red Hat OpenShift.
* **aro-nsg:**
    * Когда вы предоставляете доступ к службе, API создает в этой группе безопасности сети правило, которое позволяет пропускать трафик на уровень управления и узлы.
    * По умолчанию эта группа безопасности сети разрешает весь исходящий трафик. В настоящее время ограничить исходящий трафик можно только уровнем управления Azure Red Hat OpenShift.
* **aro-controlplane-nsg**
  * Эта конечная точка разрешает входящий трафик для главных узлов только через порт 6443.
* **Реестр контейнеров Azure**
    * Это реестр контейнеров, который предоставляется и используется корпорацией Майкрософт для внутренних целей. Этот реестр доступен только для чтения и не предназначен для использования пользователями Azure Red Hat OpenShift.
        * Этот реестр предоставляет образы платформы узла и компоненты кластера. Например, сюда относятся контейнеры мониторинга или ведения журналов.
        * Подключения к этому реестру осуществляются через конечную точку службы (внутреннее взаимодействие между службами Azure).
        * По умолчанию этот внутренний реестр недоступен за пределами кластера.
* **Приватный канал**
    * Поддерживает сетевое подключение из плоскости управления к кластеру для инженеров по обеспечению надежности сайта Майкрософт и Red Hat, чтобы они могли помочь вам в управлении кластером.

## <a name="networking-policies"></a>Сетевые политики

* **Ingress** (Входящий трафик). Политика входящего сетевого трафика поддерживается в рамках [OpenShift SDN](https://docs.openshift.com/container-platform/4.5/networking/openshift_sdn/about-openshift-sdn.html). Эта сетевая политика включена по умолчанию, а применяют ее пользователи. Политика входящего сетевого трафика соответствует NetworkPolicy версии 1,но не поддерживает типы Egress и IPBlock.

* **Egress** (Исходящий трафик). Политики для исходящего трафика поддерживаются с помощью функции [брандмауэра исходящего трафика](https://docs.openshift.com/container-platform/4.5/networking/openshift_sdn/configuring-egress-firewall.html) в OpenShift. Для каждого пространства имен или проекта есть только одна политика исходящего трафика. Политики исходящего трафика не поддерживаются для пространства имен default и оцениваются строго по порядку (с первой до последней).

## <a name="networking-basics-in-openshift"></a>Основные сведения о сетях в OpenShift

В OpenShift используется программно-определяемая сеть [(SDN)](https://docs.openshift.com/container-platform/4.6/networking/openshift_sdn/about-openshift-sdn.html) для настройки наложенной сети с помощью [OVS](https://www.openvswitch.org/) (Open vSwitch). Такая сеть — это реализация OpenFlow на основе спецификации CNI (сетевого интерфейса контейнера). SDN поддерживает разные подключаемые модули, и в Azure Red Hat на платформе OpenShift 4 используется подключаемый модуль Network Policy (Сетевая политика). Все сетевые подключения управляются через SDN, поэтому для взаимодействия между разными pod не придется создавать дополнительных маршрутов в виртуальных сетях.

## <a name="networking--for-azure-red-hat-openshift"></a>Сеть для Azure Red Hat OpenShift

Для Azure Red Hat OpenShift характерны следующие возможности сети:  
* Пользователи могут создать свой кластер ARO в существующей виртуальной сети или виртуальную сеть при создании кластера ARO.
* Есть возможность настраивать CIDR для pod и сети службы.
* Главные и рабочие узлы находятся в разных подсетях.
* Для главных и рабочих узлов требуются подсети виртуальной сети размером не менее /27.
* По умолчанию для CIDR группы pod задано значение 10.128.0.0/14.
* По умолчанию для CIDR службы задано значение 172.30.0.0/16.
* Значения CIDR для pod и службы не должны перекрывать другие диапазоны IP-адресов, используемые в виртуальной сети, и не должны находиться в пределах диапазона IP-адресов виртуальной сети вашего кластера.
* Для pod нужно использовать CIDR размером не менее /18. (IP-адреса сети pod не маршрутизируются и используются только в пределах OpenShift SDN.)
* Каждому узлу для размещения pod выделяется подсеть размера /23 (512 IP-адресов). Это значение невозможно изменить.
* Вы не можете подключить pod к нескольким сетям.
* Вы не можете настроить статический IP-адрес для исходящего трафика. (Это возможность OpenShift. Дополнительные сведения см. в [документации по настройке IP-адресов для исходящего трафика](https://docs.openshift.com/container-platform/4.6/networking/openshift_sdn/assigning-egress-ips.html)).

## <a name="network-settings"></a>Параметры сети

В кластерах Azure Red Hat OpenShift 4 доступны следующие параметры сети:

* **Видимость API** — задается при выполнении команды [az aro create](tutorial-create-cluster.md#create-the-cluster):
    * "Public" обозначает, что сервер API доступен для внешних сетей;
    * "Private" обозначает, что серверу API назначается частный IP-адрес из подсети главных узлов, который доступен только из подключенных сетей (одноранговые виртуальные сети, другие подсети в том же кластере). От имени клиента создается частная зона DNS.
* **Видимость входящего трафика** — задается при выполнении команды [az aro create](tutorial-create-cluster.md#create-the-cluster).
    * Маршруты Public (Общедоступные) по умолчанию используют общедоступную подсистему Load Balancer (цен. категория "Стандартный"), но это можно изменить;
    * Маршруты Private (Частные) по умолчанию обозначают внутренние подсистемы балансировки нагрузки, но это можно изменить.

## <a name="network-security-groups"></a>Группы безопасности сети
Группы безопасности сети будут создаваться в группе ресурсов узла, которая недоступна для пользователей. Группы безопасности сети назначаются непосредственно подсетям, а не сетевым адаптерам узлов. Группы безопасности сети являются неизменяемыми, то есть у пользователей нет прав на их изменение.

При использовании общедоступного сервера API нельзя создавать группы безопасности сети и назначать их сетевым адаптерам.

## <a name="domain-forwarding"></a>Переадресация домена
Azure Red Hat OpenShift использует CoreDNS. Можно настроить пересылку доменов. Нельзя использовать собственные DNS-службы в виртуальных сетях. Дополнительные сведения см. в документации по [использованию переадресации DNS](https://docs.openshift.com/container-platform/4.6/networking/dns-operator.html#nw-dns-forward_dns-operator).

## <a name="whats-new-in-openshift-45"></a>Новые возможности в OpenShift 4.5

Чтобы реализовать поддержку OpenShift 4.5, в Azure Red Hat OpenShift внесены несколько существенных архитектурных изменений. Эти изменения относятся только к новым создаваемым кластерам под управлением OpenShift 4.5. В существующих кластерах, которые обновляются до версии OpenShift 4.5, сетевая архитектура при обновлении изменяться не будет. Пользователям, которые хотят использовать эту новую архитектуру, нужно будет повторно создать свои кластеры.

![Схема сети в Azure Red Hat OpenShift 4.5](./media/concepts-networking/aro-4-5-networking-diagram.png)

На представленной выше схеме вы можете заметить несколько изменений.
* Ранее в ARO использовались две общедоступные подсистемы балансировки нагрузки: одна для сервера API и другая для пула рабочих узлов. После обновления архитектуры они объединены в одну подсистему балансировки нагрузки. 
* Чтобы уменьшить сложность, удалены ресурсы выделенного IP-адреса для внешней стороны.
* Уровень управления ARO теперь использует ту же группу безопасности сети, что и рабочие узлы ARO.

Чтобы получить дополнительные сведения об OpenShift 4.5, ознакомьтесь с [заметками о выпуске OpenShift 4.5](https://docs.openshift.com/container-platform/4.5/release_notes/ocp-4-5-release-notes.html).

## <a name="next-steps"></a>Дальнейшие действия
Дополнительные сведения об исходящем трафике и о возможностях, которые Azure Red Hat OpenShift поддерживает для исходящего трафика, см. в [документации по политикам поддержки](support-policies-v4.md).
