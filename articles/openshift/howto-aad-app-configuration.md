---
title: Интеграция Azure Active Directory для Azure Red Hat OpenShift
description: Узнайте, как создать группу безопасности Azure AD и пользователя для тестирования приложений в Microsoft Azure кластере Red Hat OpenShift.
author: jimzim
ms.author: jzim
ms.service: azure-redhat-openshift
ms.topic: conceptual
ms.date: 05/13/2019
ms.openlocfilehash: f0bf28d61d4c9ad95a485fb4b60e370c16ace16c
ms.sourcegitcommit: 58ff80474cd8b3b30b0e29be78b8bf559ab0caa1
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/17/2021
ms.locfileid: "100633331"
---
# <a name="azure-active-directory-integration-for-azure-red-hat-openshift"></a>Интеграция Azure Active Directory для Azure Red Hat OpenShift

> [!IMPORTANT]
> Azure Red Hat OpenShift 3,11 будет прекращена 30 июня 2022. Поддержка для создания новых кластеров Azure Red Hat OpenShift 3,11 продолжится до 30 ноября 2020. После выхода из эксплуатации оставшиеся кластеры Azure Red Hat OpenShift 3,11 будут закрыты для предотвращения уязвимости системы безопасности.
> 
> Следуйте указаниям этого руководством, чтобы [создать кластер Azure Red Hat OpenShift 4](tutorial-create-cluster.md).
> Если у вас есть определенные вопросы, [свяжитесь с нами](mailto:arofeedback@microsoft.com).

Если вы еще не создали клиент Azure Active Directory (Azure AD), следуйте указаниям в статье [Создание клиента Azure AD для Azure Red Hat OpenShift](howto-create-tenant.md) перед продолжением этих инструкций.

Microsoft Azure Red Hat OpenShift требуются разрешения на выполнение задач от имени кластера. Если в вашей организации еще нет пользователя Azure AD, группы безопасности Azure AD или регистрации приложения Azure AD для использования в качестве субъекта-службы, следуйте этим инструкциям, чтобы создать их.

## <a name="create-a-new-azure-active-directory-user"></a>Создание нового пользователя Azure Active Directory

В [портал Azure](https://portal.azure.com)убедитесь, что ваш клиент отображается под именем пользователя в правом верхнем углу портала:

![Снимок экрана портала с клиентом в списке справа в ](./media/howto-create-tenant/tenant-callout.png) случае, если отображается неправильный клиент, щелкните имя пользователя в правом верхнем углу, щелкните " **Сменить каталог**" и выберите правильный клиент в списке " **все каталоги** ".

Создайте нового пользователя Azure Active Directory "владелец", чтобы войти в кластер Azure Red Hat OpenShift.

1. Перейдите в колонку [пользователи — все пользователи](https://portal.azure.com/#blade/Microsoft_AAD_IAM/UsersManagementMenuBlade/AllUsers) .
2. Щелкните **+ создать пользователя** , чтобы открыть область **пользователь** .
3. Введите **имя** этого пользователя.
4. Создайте **имя пользователя** на основе имени созданного клиента с  `.onmicrosoft.com` добавлением в конец. Например, `yourUserName@yourTenantName.onmicrosoft.com`. Запишите это имя пользователя. Он понадобится для входа в кластер.
5. Щелкните **роль каталога** , чтобы открыть область роль каталога, и выберите **владелец** , а затем нажмите кнопку **ОК** в нижней части панели.
6. В области **пользователь** щелкните **Показывать пароль** и запишите временный пароль. После первого входа вам будет предложено сбросить его.
7. В нижней части панели щелкните **создать** , чтобы создать пользователя.

## <a name="create-an-azure-ad-security-group"></a>Создание группы безопасности Azure AD

Чтобы предоставить административный доступ к кластеру, членство в группе безопасности Azure AD синхронизируется с группой OpenShift "OSA-Customer-Admins". Если не указано, доступ администратора кластера не будет предоставлен.

1. Откройте колонку [группы Azure Active Directory](https://portal.azure.com/#blade/Microsoft_AAD_IAM/GroupsManagementMenuBlade/AllGroups) .
2. Щелкните **+ создать группу**.
3. Укажите имя и описание группы.
4. Задайте для параметра **Тип группы** значение **Безопасность**.
5. Задайте для параметра **Тип членства** значение **назначено**.

    Добавьте пользователя Azure AD, созданного на предыдущем шаге, в эту группу безопасности.

6. Щелкните **элементы** , чтобы открыть панель **Выбор элементов** .
7. В списке Члены выберите созданного ранее пользователя Azure AD.
8. В нижней части портала щелкните **выбрать** , а затем **создать** , чтобы создать группу безопасности.

    Запишите значение идентификатора группы.

9. Когда группа будет создана, она появится в списке всех групп. Щелкните новую группу.
10. На появившейся странице скопируйте **идентификатор объекта**. Мы будем называть это значение, как описано `GROUPID` в учебнике [Создание кластера Azure Red Hat OpenShift](tutorial-create-cluster.md) .

> [!IMPORTANT]
> Чтобы синхронизировать эту группу с группой "OSA — клиент-администраторы OpenShift", создайте кластер с помощью Azure CLI. В портал Azure в настоящее время отсутствует поле для задания этой группы.

## <a name="create-an-azure-ad-app-registration"></a>Создание регистрации приложения Azure AD

Вы можете автоматически создать клиент регистрации приложений Azure Active Directory (Azure AD) в рамках создания кластера, опустив `--aad-client-app-id` флаг для `az openshift create` команды. В этом руководстве показано, как создать регистрацию приложения Azure AD для полноты.

Если в вашей организации еще нет регистрации приложения Azure Active Directory (Azure AD) для использования в качестве субъекта-службы, следуйте этим инструкциям, чтобы создать ее.

1. Откройте [колонку регистрация приложений](https://portal.azure.com/#blade/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/RegisteredAppsPreview) и щелкните **+ Новая регистрация**.
2. В области **Регистрация приложения** введите имя для регистрации приложения.
3. Убедитесь, что выбраны **Поддерживаемые типы учетных** записей, которые являются **учетными записями в этом каталоге Организации** . Это наиболее безопасный вариант.
4. URI перенаправления будет добавлен позже, когда мы понимаем URI кластера. Нажмите кнопку **Register (зарегистрировать** ), чтобы создать регистрацию приложения Azure AD.
5. На появившейся странице скопируйте **идентификатор приложения (клиента)**. Мы будем называть это значение, как описано `APPID` в учебнике [Создание кластера Azure Red Hat OpenShift](tutorial-create-cluster.md) .

![Снимок экрана: страница "объекты приложения"](./media/howto-create-tenant/get-app-id.png)

### <a name="create-a-client-secret"></a>Создание секрета клиента

Создайте секрет клиента для проверки подлинности приложения, чтобы Azure Active Directory.

1. В разделе **Управление** на странице регистрации приложений щелкните **Сертификаты & секреты**.
2. На панели **сертификаты & секреты** щелкните **+ новый секрет клиента**.  Появится панель **Добавление секрета клиента** .
3. Введите **Описание**.
4. **Срок действия параметра истекает** , например, **в течение 2 лет**.
5. Нажмите кнопку **Добавить** , и значение ключа появится в разделе **секреты клиента** страницы.
6. Скопируйте значение ключа. Мы будем называть это значение, как описано `SECRET` в учебнике [Создание кластера Azure Red Hat OpenShift](tutorial-create-cluster.md) .

![Снимок экрана: панель "сертификаты и секреты"](./media/howto-create-tenant/create-key.png)

Дополнительные сведения об объектах приложений Azure см. [в разделе объекты приложения и субъекта-службы в Azure Active Directory](../active-directory/develop/app-objects-and-service-principals.md).

Дополнительные сведения о создании нового приложения Azure AD см. [в статье регистрация приложения с помощью конечной точки Azure Active Directory v 1.0](../active-directory/develop/quickstart-register-app.md).

## <a name="add-api-permissions"></a>Добавление разрешений API

[//]: # (Не изменяйте значение на Microsoft Graph. Он не работает с Microsoft Graph.)
1. В разделе **Управление** щелкните **разрешения API** .
2. Нажмите кнопку **Добавить разрешение** и выберите **Azure Active Directory Graph** , а затем **делегированные разрешения**.
> [!NOTE]
> Убедитесь, что выбрана Azure Active Directory графика, а не "Microsoft Graph".

3. Разверните **пользователя** в списке ниже и включите разрешение " **пользователь. чтение** ". Если **пользователь. Read** включен по умолчанию, убедитесь, что это **Azure Active Directory разрешение графа** **пользователя. Read**.
4. Прокрутите экран вверх и выберите **разрешения приложения**.
5. Разверните **Каталог** в списке ниже и включите **Directory. ReadAll**.
6. Нажмите кнопку **Добавить разрешения** , чтобы принять изменения.
7. Теперь панель разрешений API должна показывать как *User. Read* , так и *Directory. ReadAll*. Обратите внимание на предупреждение в столбце **"требуется согласие администратора"** рядом с *каталогом Directory. ReadAll*.
8. Если вы являетесь *администратором подписки Azure*, щелкните **предоставить согласие администратора для *имени подписки*** ниже. Если вы не являетесь *администратором подписки Azure*, запросите согласие у администратора.

![Снимок экрана: панель разрешений API. Добавлены разрешения User. Read и Directory. ReadAll, требуется согласие администратора для Directory. ReadAll](./media/howto-aad-app-configuration/permissions-required.png)

> [!IMPORTANT]
> Синхронизация группы администраторов кластера будет работать только после предоставления согласия. Вы увидите зеленый кружок с галочкой и сообщением "предоставлено для *имени подписки*" в столбце " *требуется согласие администратора* ".

Дополнительные сведения об управлении администраторами и другими ролями см. в статье [Добавление или изменение администраторов Подписки Azure](../cost-management-billing/manage/add-change-subscription-administrator.md).

## <a name="resources"></a>Ресурсы

* [Приложения и объекты субъекта-службы в Azure Active Directory](../active-directory/develop/app-objects-and-service-principals.md)
* [Краткое руководство. Регистрация приложения в конечной точке Azure Active Directory версии 1.0](../active-directory/develop/quickstart-register-app.md)

## <a name="next-steps"></a>Дальнейшие действия

Если вы удовлетворены всеми [предварительными требованиями для Azure Red Hat OpenShift](howto-setup-environment.md), вы можете создать свой первый кластер.

Воспользуйтесь руководством.
> [!div class="nextstepaction"]
> [Создание кластера Azure Red Hat OpenShift](tutorial-create-cluster.md)