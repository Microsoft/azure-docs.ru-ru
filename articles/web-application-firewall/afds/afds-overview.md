---
title: Что такое брандмауэр веб-приложения в Azure Front Door?
description: Сведения о том, как брандмауэр веб-приложения Azure в службе Azure Front Door защищает ваши веб-приложения от вредоносных атак.
services: web-application-firewall
author: vhorne
ms.service: web-application-firewall
ms.topic: conceptual
ms.date: 05/22/2020
ms.author: victorh
ms.openlocfilehash: 66ca039a449e355e47563b689f5f44cced164fea
ms.sourcegitcommit: 910a1a38711966cb171050db245fc3b22abc8c5f
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/20/2021
ms.locfileid: "101724155"
---
# <a name="azure-web-application-firewall-on-azure-front-door"></a>Брандмауэр веб-приложения Azure в Azure Front Door

Брандмауэр веб-приложения Azure (WAF) в Azure Front Door обеспечивает централизованную защиту веб-приложений. WAF защищает веб-службы от распространенных эксплойтов и уязвимостей. Он обеспечивает высокую доступность службы для пользователей и помогает отвечать требованиям соответствия.

WAF в Azure Front Door — это глобальное и централизованное решение. Он разворачивается в граничных расположениях сети Azure по всему миру. Веб-приложения с поддержкой WAF проверяют каждый входящий запрос, поступающий от Front Door на границе сети. 

WAF предотвращает вредоносные атаки вблизи их источников, до того как они попадут в вашу виртуальную сеть. Вы получаете глобальную защиту в большом масштабе, не жертвуя производительностью. Политика WAF легко связывается с любым профилем Front Door в вашей подписке. Новые правила можно развернуть в течение нескольких минут, что позволяет быстро реагировать на изменения моделей угроз.

![Брандмауэр веб-приложения Azure](../media/overview/wafoverview.png)

В Azure Front Door доступны [две новых ценовых категории SKU в предварительной версии](https://docs.microsoft.com/azure/frontdoor/standard-premium/overview): SKU Front Door "Стандартный" и "Премиум". В WAF изначально реализована интеграция с SKU Front Door Premium со всеми возможностями. Для SKU Front Door "Стандартный" поддерживаются только [настраиваемые правила](https://docs.microsoft.com/azure/web-application-firewall/afds/afds-overview#custom-authored-rules).

## <a name="waf-policy-and-rules"></a>Политика и правила WAF

Вы можете настроить [политику WAF](waf-front-door-create-portal.md) и связать ее с любым числом интерфейсов Front Door, чтобы защитить их. Политика WAF состоит из правил безопасности двух типов:

- настраиваемые правила, созданные пользователем;

- управляемые наборы правил, которые представляют собой управляемую Azure коллекцию предварительно настроенных правил.

Если используются правила обоих типов, то настраиваемые правила обрабатываются раньше, чем правила из управляемого службой набора правил. Каждое правило определяет условие соответствия, приоритет и действие. Поддерживаются следующие типы действий: ALLOW (разрешить), BLOCK (блокировать), LOG (занести в журнал) и REDIRECT (перенаправить). Вы можете создать полностью настраиваемую политику в соответствии с индивидуальными требованиями к защите приложения, комбинируя управляемые и пользовательские правила.

Правила в рамках политики обрабатываются в приоритетном порядке. Приоритет — это уникальное целое число, определяющее порядок обработки правил. Чем меньше это значение, тем выше приоритет правила, а значит правила будут обработаны раньше правил с более высоким значением. Когда обнаруживается подходящее правило, к запросу применяется действие, определенное в этом правиле. После обработки обнаруженного соответствия правила с более низким приоритетом не обрабатываются.

Веб-приложение на платформе Front Door может иметь только одну связанную политику WAF в любой момент времени. Но вы можете использовать конфигурацию Front Door, с которой не связана ни одна политика WAF. Если политика WAF присутствует, она реплицируется во все наши граничные расположения, чтобы применять согласованные политики безопасности по всему миру.

## <a name="waf-modes"></a>Режимы WAF

Для политики WAF можно настроить один из следующих двух режимов работы.

- **Режим обнаружения**. В режиме обнаружения WAF не предпринимает никаких действий, кроме отслеживания запросов, ведения журнала запросов и занесения соответствий с правилами WAF в журнал WAF. Для Front Door можно включить ведение журнала диагностики. При использовании портала перейдите к разделу **Диагностика**.

- **Режим предотвращения**. В режиме предотвращения WAF выполняет указанное действие, если запрос соответствует правилу. Дальнейшие низкоприоритетные правила не оцениваются, если совпадение найдено. Все запросы, для которых обнаружены совпадающие правила, также регистрируются в журналах WAF.

## <a name="waf-actions"></a>Действия WAF

Пользователи WAF могут выбрать одно из следующих действий для применения к запросу, который соответствует условиям правила.

- **Разрешить:**  запрос пропускается через WAF и передается в серверную часть. Никакие правила с более низким приоритетом не могут блокировать такой запрос.
- **Block** (блокировать). Запрос блокируется, и WAF самостоятельно отправляет клиенту ответ, не передавая запрос в серверную часть.
- **Log** (занести в журнал).  WAF записывает запрос в свои журналы и продолжает анализ правил с более низким приоритетом.
- **Redirect** (перенаправить). WAF перенаправляет запрос на указанный URI. Этот URI задается в параметре уровня политики. После настройки URI на него передаются все запросы, которые соответствуют правилам с действием **Redirect**.

## <a name="waf-rules"></a>Правила WAF

Политика WAF может состоять из правил безопасности двух типов — настраиваемые правила, созданные пользователем, и управляемые Azure наборы предварительно настроенных правил.

### <a name="custom-authored-rules"></a>Созданные пользователем правила

Пользовательские правила WAF можно настроить следующим образом.

- **Списки разрешенных и запрещенных IP-адресов**. Вы можете управлять доступом к веб-приложениям на основе списка или диапазонов IP-адресов клиентов. Поддерживаются типы адресов IPv4 и IPv6. В этом списке вы можете разрешать или блокировать запросы, у которых исходный IP-адрес присутствует в заданном списке.

- **Управление доступом на основе географического региона**. Вы можете управлять доступом к веб-приложениям на основе кода страны, связанного с IP-адресом клиента.

- **Управление доступом на основе параметров HTTP-запроса**. Правила можно основывать на совпадениях строк в параметрах запроса HTTP/HTTPS.  Например, строках запроса, аргументах POST, URI запроса, Заголовке запроса и Тексте запроса.

- **Управление доступом на основе метода запроса**. Вы основываете правила на методе HTTP-запроса. Например, GET, PUT или HEAD.

- **Ограничение по размеру**. Вы можете основывать правила на размере отдельных частей запроса, например строки запроса, URI или текста запроса.

- **Правила ограничения частоты**. Правило управления скоростью позволяет ограничить аномально интенсивный трафик, поступающий с какого-либо IP-адреса клиента. Вы можете задать предельное число веб-запросов, пропускаемых с одного IP-адреса клиента в течение минуты. Это правило отличается от пользовательского правила разрешения или блокировки на основе списка IP-адресов, которое разрешает или блокирует все запросы с определенного IP-адреса клиента. Ограничения частоты можно сочетать с дополнительными условиями соответствия, например с параметром запроса HTTP(S), чтобы более точно управлять частотой.

### <a name="azure-managed-rule-sets"></a>Управляемые Azure наборы правил

Наборы правил, управляемые Azure, позволяют легко развернуть защиту от типичного набора угроз безопасности. Этими наборами правил управляет Azure, а значит они быстро обновляются по мере необходимости для защиты от новых сигнатур атак. Управляемый Azure стандартный набор правил содержит правила для защиты от следующих категорий угроз.

- Межсайтовые сценарии.
- Атаки Java.
- Включение локального файла.
- Атака путем внедрения кода PHP.
- Удаленное выполнение команд.
- Включение удаленного файла.
- Фиксация сеанса.
- Защита от внедрения кода SQL.
- Атаки на протокол.

Номер версии набора правил по умолчанию увеличивается при каждом добавлении сигнатур атак в набор правил.
Стандартный набор правил по умолчанию включен в режиме обнаружения во всех политиках WAF. Вы можете отключить или включить отдельные правила в стандартном наборе правил в соответствии с требованиями приложения. Можно также настроить действия (ALLOW, BLOCK, REDIRECT, LOG) для каждого правила.

Иногда бывает нужно исключать некоторые атрибуты запроса из проверки WAF. Распространенный пример — дополнительные токены Active Directory, которые используются для проверки подлинности. Вы можете настроить список исключений для управляемого правила, группы правил или для всего набора правил.  

По умолчанию используется действие BLOCK. Кроме того, в той же политике WAF можно настроить пользовательские правила, если вы хотите обойти какие-то из предварительно настроенных правил в стандартном наборе правил.

Пользовательские правила всегда применяются до оценки правил в стандартном наборе правил. Соответствующее действие правила применяется, если запрос соответствует пользовательскому правилу. Запрос будет либо заблокирован, либо передан на сервер. Никакие другие пользовательские правила или правила из стандартного набора правил не обрабатываются. Вы можете также удалить стандартный набор правил из политик WAF.

### <a name="bot-protection-rule-set-preview"></a>Набор правил защиты от ботов (предварительная версия)

Можно включить управляемый набор правил защиты от ботов, чтобы выполнять пользовательские действия по запросам от известных категорий ботов. 

Поддерживаются три категории ботов: Плохие, Хорошие и Неизвестные. Подписи ботов управляются и динамически обновляются платформой WAF.

К плохим ботам относятся боты из вредоносных IP-адресов и боты с подделанным удостоверением. Вредоносные IP-адреса передаются из канала Microsoft Threat Intelligence и обновляются каждый час. [Intelligent Security Graph](https://www.microsoft.com/security/operations/intelligence) поддерживает Microsoft Threat Intelligence и используется во множестве служб, включая Центр безопасности Azure.

Хорошие боты включают в себя проверенные поисковые системы. Категории "Неизвестные" включают дополнительные группы ботов, которые идентифицировали себя как боты. Например, анализатор рынка, двойники веб-каналов и агенты сбора данных. 

Неизвестные боты классифицируются через опубликованные пользовательские агенты без дополнительной проверки. Вы можете настроить пользовательские действия для блокировки, разрешения, регистрации или перенаправления для различных типов ботов.

![Набор правил защиты от ботов](../media/afds-overview/botprotect2.png)

> [!IMPORTANT]
> Сейчас набор правил защиты от ботов предоставляется в общедоступной предварительной версии и поддерживается соглашением об уровне обслуживания для предварительной версии. Некоторые функции могут не поддерживаться или их возможности могут быть ограничены.  См. [дополнительные условия использования для предварительных версий Microsoft Azure](https://azure.microsoft.com/support/legal/preview-supplemental-terms/).

Если защита от ботов включена, входящие запросы, соответствующие обоим правилам, регистрируются в журнале FrontdoorWebApplicationFirewallLog. Доступ к журналам WAF можно получить через учетную запись хранения, концентратор событий или Log Analytics.

## <a name="configuration"></a>Конфигурация

Правила WAF любого типа можно настроить и развернуть с помощью портала Azure, интерфейсов REST API, шаблонов Azure Resource Manager и Azure PowerShell.

## <a name="monitoring"></a>Наблюдение

Функции мониторинга WAF в Front Door интегрированы с Azure Monitor, что позволяет удобно отслеживать оповещения и изменения в характере трафика.

## <a name="next-steps"></a>Дальнейшие действия

- Подробные сведения о брандмауэре веб-приложения для Шлюза приложений Azure см. [здесь](../ag/ag-overview.md).
