---
title: Предельный размер запросов брандмауэра веб-приложения и списки исключений в Шлюзе приложений Azure — портал Azure
description: В этой статье приведены сведения об ограничениях размера запроса брандмауэра веб-приложения и конфигурации списков исключений в шлюзе приложений с портал Azure.
services: web-application-firewall
author: vhorne
ms.service: web-application-firewall
ms.date: 02/20/2020
ms.author: victorh
ms.topic: conceptual
ms.openlocfilehash: 2d34641fdecfe334e84347efe1a2f64482cae74b
ms.sourcegitcommit: 910a1a38711966cb171050db245fc3b22abc8c5f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "93040260"
---
# <a name="web-application-firewall-request-size-limits-and-exclusion-lists"></a>Ограничения размера запроса брандмауэра веб-приложения и списки исключений

Брандмауэр веб-приложения шлюза приложений Azure (WAF) обеспечивает защиту для веб-приложений. В этой статье описывается настройка предельного размера запросов WAF и списков исключений. Эти параметры находятся в политике WAF, связанной с вашим шлюзом приложений. Дополнительные сведения о политиках WAF см. в статье [брандмауэр веб-приложения Azure в шлюзе приложений Azure](ag-overview.md) и [Создание политик брандмауэра для веб-приложений для шлюза приложений](create-waf-policy-ag.md) .

## <a name="waf-exclusion-lists"></a>Списки исключений WAF

![Предельный размер запросов](../media/application-gateway-waf-configuration/waf-policy.png)

Списки исключений WAF позволяют пропустить некоторые атрибуты запроса при проверке WAF. Распространенный пример — вставленные токены Active Directory, которые используются для проверки подлинности или полей пароля. Такие атрибуты часто могут содержать специальные символы, которые активируют ложные срабатывания правил WAF. После добавления атрибута в список исключений WAF он не учитывается ни одним настроенным и активным правилом WAF. Списки исключений применяются глобально.

Следующие атрибуты могут быть добавлены к спискам исключений по имени. Значения выбранного поля не оцениваются по правилам WAF, но их имена по-прежнему являются (см. Пример 1 ниже, значение заголовка User-Agent исключается из вычисления WAF). Список исключений удаляет проверку значения поля.

* Заголовки запросов
* Объекты cookie запросов
* Имя атрибута запроса (args) можно добавить как элемент исключения, например:

   * Имя поля формы
   * Сущность JSON
   * Аргументы строки запроса URL-адреса

Вы можете указать точное соответствие заголовка запроса, текста, файла cookie или атрибута строки запроса.  Либо при необходимости вы можете задать частичное соответствие. Правила исключения являются глобальными в области и применяются ко всем страницам и всем правилам.

Поддерживаемые операторы критериев соответствия:

- **Equals**: этот оператор используется для точного совпадения. Например, для выбора заголовка с именем **bearerToken** используйте оператор равенства со значением селектора **bearerToken**.
- **Starts with**: этот оператор находит все поля, которые начинаются с указанного значения селектора.
- **Ends with**: этот оператор находит все поля запроса, заканчивающиеся на указанное значение селектора.
- **Contains**: этот оператор находит все поля запроса, которые содержат указанное значение селектора.
- **Равно Any**: Этот оператор соответствует всем полям запроса. * будет значением селектора.

Во всех случаях при поиске не учитывается регистр, и в качестве селекторов запрещено использовать регулярные выражения.

> [!NOTE]
> Дополнительные сведения и справку по устранению неполадок см. в разделе [WAF устранение неполадок](web-application-firewall-troubleshoot.md).

### <a name="examples"></a>Примеры

[!INCLUDE [updated-for-az](../../../includes/updated-for-az.md)]

В следующих примерах демонстрируется использование исключений.

#### <a name="example-1"></a>Пример 1

В этом примере необходимо исключить заголовок User-Agent. Заголовок запроса User-Agent содержит строку характеристик, которая позволяет одноранговым узлам сетевого протокола указывать тип приложения, операционную систему, поставщика программного обеспечения или версию программного обеспечения агента запрашивающего пользователя программного обеспечения. Дополнительные сведения см. в разделе [User-Agent](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/User-Agent).

Для отключения вычисления этого заголовка может потребоваться по нескольким причинам. Может существовать строка, которую WAF видит и считает ее вредоносной. Например, классическая атака SQL "x = x" в строке. В некоторых случаях это может привести к подлинному трафику. Поэтому может потребоваться исключить этот заголовок из оценки WAF.

Следующий командлет Azure PowerShell исключает заголовок User-Agent из оценки:

```azurepowershell
$exclusion1 = New-AzApplicationGatewayFirewallExclusionConfig `
   -MatchVariable "RequestHeaderNames" `
   -SelectorMatchOperator "Equals" `
   -Selector "User-Agent"
```
#### <a name="example-2"></a>Пример 2

Этот пример исключает значение в параметре *пользователя* , переданном в запросе через URL-адрес. Например, предположим, что в вашей среде для поля пользователя есть строка, которую WAF представления в виде вредоносного содержимого, поэтому она блокирует его.  Вы можете исключить параметр пользователя в этом случае, чтобы WAF не вычислит что-либо в поле.

Следующий командлет Azure PowerShell исключает пользовательский параметр из оценки:

```azurepowershell
$exclusion2 = New-AzApplicationGatewayFirewallExclusionConfig `
   -MatchVariable "RequestArgNames" `
   -SelectorMatchOperator "StartsWith" `
   -Selector "user"
```
Таким образом, если URL-адрес `http://www.contoso.com/?user%281%29=fdafdasfda` передается в WAF, он не вычисляет строку **фдафдасфда**, но по-прежнему будет оценивать имя параметра **User %281 %29**. 

## <a name="waf-request-size-limits"></a>Предельный размер запросов WAF



Брандмауэр веб-приложения позволяет настроить предельный размер запроса с нижней и верхней границей. Доступны следующие две конфигурации предельного размера:

- Поле "максимальный размер текста запроса" указывается в килобайтах и управляет ограничением общего размера запроса за исключением всех отправок файлов. Это поле имеет минимальное значение, равное 1 КБ, и максимальное значение 128 КБ. Значение по умолчанию — 128 КБ.
- Поле "Предельный размер отправки файла" указывается в МБ и определяет максимальный размер отправки файла. Это поле может иметь минимальное значение, равное 1 МБ, и следующие максимальные значения:

   - 100 МБ для шлюзов v1 среднего WAF
   - 500 МБ для больших WAF шлюзов v1
   - 750 МБ для шлюзов WAF v2 

 Значение по умолчанию — 100 МБ.

WAF также позволяет настроить ручку, включающую и отключающую проверку текста запроса. По умолчанию проверка включена. Если проверка текста запроса отключена, WAF не оценивает содержимое текста HTTP-сообщения. В таких случаях WAF продолжит применять свои правила к заголовкам, файлам cookie и URI. Если проверка текста запроса отключена, то поле максимального размера текста запроса будет неприменимо и его невозможно будет настроить. Отключение проверки текста запроса позволяет отправлять в брандмауэр веб-приложения сообщения, длина которых превышает 128 Кбайт, но текст сообщения не проверяется на наличие уязвимостей.

## <a name="next-steps"></a>Дальнейшие действия

После настройки параметров WAF вы можете узнать, как просматривать журналы WAF. Дополнительные сведения см. в разделе [Журналы диагностики](../../application-gateway/application-gateway-diagnostics.md#diagnostic-logging).
