---
title: Мультитенантность и изоляция содержимого
titleSuffix: Azure Cognitive Search
description: Узнайте об общих шаблонах проектирования для многоклиентских приложений SaaS при использовании Azure Когнитивный поиск.
manager: nitinme
author: LiamCavanagh
ms.author: liamca
ms.service: cognitive-search
ms.topic: conceptual
ms.date: 09/25/2020
ms.openlocfilehash: cd21197d6d1559b681ae622b974f6eb7ba95ad3d
ms.sourcegitcommit: 772eb9c6684dd4864e0ba507945a83e48b8c16f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "91397374"
---
# <a name="design-patterns-for-multitenant-saas-applications-and-azure-cognitive-search"></a>Конструктивные шаблоны для многоклиентских приложений SaaS и Azure Когнитивный поиск

Мультитенантным называется приложение, предоставляющее одинаковые службы и возможности любому числу клиентов, каждый из которых не может видеть или совместно использовать данные любого другого клиента. В этом документе обсуждаются стратегии изоляции клиентов для многоклиентских приложений, созданных с помощью Azure Когнитивный поиск.

## <a name="azure-cognitive-search-concepts"></a>Основные понятия Azure Когнитивный поиск
В качестве решения для поиска как услуги [Azure когнитивный Поиск](search-what-is-azure-search.md) позволяет разработчикам добавлять широкие возможности поиска в приложения без управления инфраструктурой или стать экспертом по извлечению информации. Данные передаются в службу и затем сохраняются в облаке. Используя простые запросы к API Azure Когнитивный поиск, данные можно изменить и выполнить поиск. 

### <a name="search-services-indexes-fields-and-documents"></a>Службы поиска, индексы, поля и документы

Перед обсуждением шаблонов разработки важно понимать несколько основных понятий.

При использовании Когнитивный поиск Azure одна подписывается на *службу поиска*. По мере передачи данных в Azure Когнитивный поиск они хранятся в *индексе* в службе поиска. В одной службе может существовать множество индексов. Чтобы оперировать привычными понятиями баз данных, службу поиска можно сравнить с базой данных, а индексы в службе — с таблицами в базе данных.

Каждый индекс в службе поиска имеет свою собственную схему, которая определяется рядом настраиваемых *полей*. Данные добавляются в индекс Azure Когнитивный поиск в виде отдельных *документов*. Каждый документ необходимо передать в определенный индекс, при этом данный документ должен соответствовать схеме индекса. При поиске данных с помощью Когнитивный поиск Azure запросы полнотекстового поиска выдаются по определенному индексу.  Чтобы провести аналогию этих понятий с базой данных, поля можно сравнить со столбцами в таблице, а документы — со строками.

### <a name="scalability"></a>Масштабируемость
Любая служба Когнитивный поиск Azure в [ценовой](https://azure.microsoft.com/pricing/details/search/) категории "Стандартный" может масштабироваться в двух измерениях: хранилище и доступность.

* *секции* для увеличения хранилища службы поиска.
* *реплики* .

Добавление и удаление секций и реплик в любое время позволяет увеличивать емкость службы поиска по мере роста объема данных и трафика, необходимых приложению. Чтобы служба поиска выполняла [соглашение об уровне обслуживания](https://azure.microsoft.com/support/legal/sla/search/v1_0/)чтения, требуется две реплики. Чтобы служба поиска выполняла [соглашение об уровне обслуживания](https://azure.microsoft.com/support/legal/sla/search/v1_0/)чтения и записи, требуется три реплики.

### <a name="service-and-index-limits-in-azure-cognitive-search"></a>Ограничения службы и индекса в Azure Когнитивный поиск
В Azure Когнитивный поиск есть несколько разных [ценовых](https://azure.microsoft.com/pricing/details/search/) категорий. на каждом из этих уровней действуют разные [ограничения и квоты](search-limits-quotas-capacity.md). Некоторые из этих ограничений действуют на уровне службы, некоторые — на уровне индекса, а некоторые — на уровне секции.

|  | Basic | Standard1 | Standard2 | Standard3 | Standard3 HD |
| --- | --- | --- | --- | --- | --- |
| **Максимальное число реплик на службу** |3 |12 |12 |12 |12 |
| **Максимальное число секций на службу** |1 |12 |12 |12 |3 |
| **Максимальное число единиц поиска ((число реплик) * (число секций)) на службу** |3 |36 |36 |36 |36 (максимум 3 секции) |
| **Максимальный объем хранилища на службу** |2 ГБ |300 ГБ |1,2 ТБ |2,4 ТБ |600 ГБ |
| **Максимальный объем хранилища на секцию** |2 ГБ |25 ГБ |100 ГБ |200 ГБ |200 ГБ |
| **Максимальное число индексов на службу** |5 |50 |200 |200 |3000 (максимум 1000 индексов на секцию) |

#### <a name="s3-high-density"></a>S3, высокая плотность
В ценовой категории S3 для Когнитивный поиск Azure предусмотрен вариант режима высокой плотности (HD), предназначенного специально для многоклиентских сценариев. Во многих случаях, чтобы использовать преимущества упрощения и экономичности, требуется поддерживать большое количество небольших клиентов в отдельной службе.

Уровень S3 HD позволяет собрать множество небольших индексов под управлением отдельной службы поиска, жертвуя возможностью разворачивать индексы посредством секций ради возможности разместить большее число индексов в отдельной службе.

Служба S3 разработана для размещения фиксированного числа индексов (максимум 200) и позволяет масштабировать каждый индекс по горизонтали по мере добавления новых секций в службу. Добавление секций в службы S3 HD увеличивает максимальное количество индексов, которые может разместить служба. Идеальный максимальный размер для отдельного индекса S3HD составляет около 50-80 ГБ, хотя ограничение на размер каждого индекса, накладываемого системой, не ограничено.

## <a name="considerations-for-multitenant-applications"></a>Рекомендации для мультитенантных приложений
Мультитенантные приложения должны эффективно распределять ресурсы между клиентами, сохраняя при этом определенный уровень конфиденциальности между различными клиентами. Существует несколько рекомендаций по проектированию архитектуры подобного приложения.

* *Изоляция клиентов*. Разработчики приложений должны принять соответствующие меры, чтобы клиенты не имели возможности получить неавторизованный или нежелательный доступ к данным других клиентов. Помимо реализации конфиденциальности данных, стратегии изоляции клиентов требуют эффективного управления общими ресурсами и защиты от "шумных соседей".
* *Стоимость облачных ресурсов.* Как и любое другое приложение, программные решения должны обладать конкурентоспособной ценой в составе мультитенантного приложения.
* *Простота эксплуатации.* При разработке мультитенантной архитектуры важно учесть влияние на эксплуатацию и сложность приложения. Когнитивный поиск Azure имеет [соглашение об уровне обслуживания 99,9%](https://azure.microsoft.com/support/legal/sla/search/v1_0/).
* *Размещение по всему миру*. Мультитенантным приложениям может потребоваться эффективно обслуживать клиенты по всему миру.
* *Масштабируемость*. Разработчики приложений должны решить, как сохранить относительно низкий уровень сложности приложения и спроектировать приложение, которое можно масштабировать, чтобы обслуживать множество клиентов с учетом их размера данных и рабочей нагрузки.

Azure Когнитивный поиск предлагает несколько границ, которые можно использовать для изоляции данных и рабочей нагрузки клиентов.

## <a name="modeling-multitenancy-with-azure-cognitive-search"></a>Моделирование многоаренды с помощью Azure Когнитивный поиск
В случае мультитенантого сценария разработчик приложений использует одну или несколько служб поиска и разделяет их клиентов между службами и индексами. В Когнитивный поиск Azure есть несколько распространенных шаблонов при моделировании сценария для нескольких клиентов:

1. *Индекс на каждого клиента*. Каждый клиент имеет собственный индекс в службе поиска, используемой совместно с другими клиентами.
2. *Служба на клиент:* Каждый клиент имеет собственную выделенную службу Когнитивный поиск Azure, предлагающую самый высокий уровень разделения данных и рабочей нагрузки.
3. *Сочетание обоих вариантов*. Более активным клиентам большого размера назначаются выделенные службы, а небольшим клиентам назначаются отдельные индексы в общих службах.

## <a name="1-index-per-tenant"></a>1. индекс на клиент

:::image type="content" source="media/search-modeling-multitenant-saas-applications/azure-search-index-per-tenant.png" alt-text="Изображение модели с индексом на каждого клиента" border="false":::

В модели с индексами на каждый клиент несколько клиентов занимают одну службу Когнитивный поиск Azure, в которой каждый клиент имеет собственный индекс.

Клиенты достигают изоляции данных, так как все запросы поиска и операции с документами выдаются на уровне индекса в Когнитивный поиск Azure. На прикладном уровне имеется понимание необходимости перенаправлять трафик различных клиентов к соответствующим индексам, управляя при этом ресурсами всех клиентов на уровне службы.

Ключевой атрибут модели с индексом на каждого клиента заключается в том, что разработчик приложений может неравномерно распределить емкость службы поиска между подписанными на нее клиентами приложения. Если рабочая нагрузка неравномерно распределена между клиентами, то можно распределить оптимальное сочетание клиентов между индексами службы поиска, чтобы обслуживать ресурсоемкие высокоактивные клиенты, одновременно обслуживая длинную очередь менее активных клиентов. Недостаток модели заключается в том, что она не подходит для ситуаций, в которых все клиенты одновременно являются высокоактивными.

Модель с индексами на каждый клиент предоставляет базис для модели переменных стоимости, где вся служба Когнитивный поиск Azure будет приобретена заранее, а затем будет заполнена клиентами. Это позволяет выделить неиспользуемую емкость для пробных и бесплатных учетных записей.

Для приложений, развертываемых по всему миру, модель с индексом на каждого клиента может быть не самой эффективной. Если клиенты приложения распределены по всему миру, то может потребоваться отдельная служба в каждом регионе, что может привести к повторным затратам в каждом из них.

Azure Когнитивный поиск позволяет масштабировать как отдельные индексы, так и общее число индексов, которые необходимо увеличить. Если выбрана соответствующая ценовая категория, то во всю службу поиска можно будет добавить секции и реплики, когда какой-либо индекс в службе станет слишком большим с точки зрения потребляемых ресурсов хранения или трафика.

Если общее число индексов для одной службы становится слишком большим, то для обработки новых клиентов следует подготовить еще одну службу. Если необходимо перемещать индексы между службами поиска по мере добавления новых служб, данные из индекса необходимо вручную скопировать из одного индекса в другой, так как Azure Когнитивный поиск не разрешает перемещение индекса.

## <a name="2-service-per-tenant"></a>2. служба на клиент

:::image type="content" source="media/search-modeling-multitenant-saas-applications/azure-search-service-per-tenant.png" alt-text="Изображение модели со службой на каждого клиента" border="false":::

В архитектуре со службой на каждого клиента каждый клиент имеет свою собственную службу поиска.

В этой модели приложение обеспечивает максимальный уровень изоляции своих клиентов. Каждая служба имеет выделенное хранилище и пропускную способность для обработки запросов на поиск, а также отдельные ключи API.

Модель со службой на каждого клиента отлично подойдет для приложений, в которых каждому клиенту требуется много ресурсов или рабочие нагрузки клиентов мало отличаются между собой, так как ресурсы не являются общими для рабочих нагрузок разных клиентов.

Данная модель также дает преимущества модели с прогнозируемыми, фиксированными затратами. Какие-либо первоначальные вложения во всю службу поиска отсутствуют, пока она не заполнится клиентами, однако затраты на каждого клиента выше, чем в модели с индексом на каждого клиента.

Модель со службой на каждого клиента — удачный выбор для приложений, развертываемых по всему миру. С помощью географически распределенных клиентов легко разместить службу для каждого клиента в соответствующем регионе.

При такой схеме трудности масштабирования возникают, когда отдельным клиентам перестает хватать емкости их службы. В настоящее время Azure Когнитивный поиск не поддерживает обновление ценовой категории службы поиска, поэтому все данные должны быть скопированы вручную в новую службу.

## <a name="3-mixing-both-models"></a>3. Смешивание обеих моделей
Еще один шаблон для моделирования мультитенантности подразумевает совмещение модели с индексом на каждый клиента и модели со службой на каждый клиент.

При совмещении двух шаблонов наибольшие клиенты приложения могут занимать выделенные службы, а длинная очередь менее активных клиентов меньшего размера может занимать индексы в общей службе. Эта модель обеспечивает наибольшим клиентам постоянную высокую производительность обслуживания службой, помогая при этом защитить небольшие клиенты от "шумных соседей".

Тем не менее, для реализации этой стратегии понадобится спрогнозировать, каким клиентам потребуется выделенная служба, а каким — индекс в общей службе. Повышается сложность приложения, так как необходимо управлять обеими моделям мультитенантности.

## <a name="achieving-even-finer-granularity"></a>Достижение большей степени детализации
Приведенные выше шаблоны проектирования для моделирования многоклиентских сценариев в Azure Когнитивный поиск предполагают однородную область, в которой каждый клиент является целым экземпляром приложения. Однако иногда приложения могут обрабатывать несколько областей меньшего размера.

Если область применения модели со службой на каждого клиента и модели с индексом на каждого клиента недостаточно мала, можно смоделировать индекс для повышения степени детализации.

Чтобы один индекс функционировал по-разному для разных клиентских конечных точек, в него можно добавить поля, которые задают определенное значение для каждого возможного клиента. Каждый раз, когда клиент вызывает Когнитивный поиск Azure для запроса или изменения индекса, код из клиентского приложения указывает соответствующее значение для этого поля с помощью функции [фильтрации](./query-odata-filter-orderby-syntax.md) когнитивный Поиск Azure во время запроса.

Данный метод может использоваться для реализации отдельных учетных записей пользователей, отдельных уровней разрешений и даже полностью отдельных приложений.

> [!NOTE]
> Использование описанного выше подхода для настройки одного индекса, обслуживающего несколько клиентов, влияет на релевантность результатов поиска. Показатели релевантности поиска вычисляются на уровне индекса, а не на уровне клиента, поэтому все данные клиентов включаются в базовую статистику показателей релевантности (например, частота встречаемости термина).
> 
> 

## <a name="next-steps"></a>Дальнейшие действия
Когнитивный поиск Azure — это замечательный вариант для многих приложений. При оценке различных шаблонов проектирования для многоклиентских приложений рассмотрите [различные ценовые категории](https://azure.microsoft.com/pricing/details/search/) и соответствующие [ограничения службы](search-limits-quotas-capacity.md) , чтобы лучше адаптировать когнитивный Поиск Azure, чтобы они соответствовали рабочим нагрузкам приложений и архитектурам всех размеров.

Все вопросы о сценариях Когнитивный поиск и клиентов Azure можно направлять в azuresearch_contact@microsoft.com .