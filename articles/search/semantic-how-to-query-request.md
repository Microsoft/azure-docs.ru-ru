---
title: Создание семантического запроса
titleSuffix: Azure Cognitive Search
description: Задайте семантический тип запроса, чтобы присоединить модели глубокого обучения к обработке запросов, выложить намерение и контекст в рамках ранжирования и релевантности поиска.
manager: nitinme
author: HeidiSteen
ms.author: heidist
ms.service: cognitive-search
ms.topic: conceptual
ms.date: 03/18/2021
ms.openlocfilehash: c33739124092a17acf0590f00b2f9c3c09bf894e
ms.sourcegitcommit: 867cb1b7a1f3a1f0b427282c648d411d0ca4f81f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "104654668"
---
# <a name="create-a-query-for-semantic-captions-in-cognitive-search"></a>Создание запроса для семантических заголовков в Когнитивный поиск

> [!IMPORTANT]
> Семантический поиск — это общедоступная Предварительная версия, доступная в предварительной версии REST API и портал Azure. Предварительные версии функций предлагаются "как есть" в [дополнительных условиях использования](https://azure.microsoft.com/support/legal/preview-supplemental-terms/). Эти функции являются оплачиваемыми. Дополнительные сведения см. в разделе [доступность и цены](semantic-search-overview.md#availability-and-pricing).

Из этой статьи вы узнаете, как формулировать запрос поиска, использующий семантическое ранжирование, и возвращает семантические заголовки (и, при необходимости, [семантические ответы](semantic-answers.md)) с выделением наиболее релевантных терминов и фраз. В запросах, которые определяются с помощью типа запроса "семантический", возвращаются заголовки и ответы.

Заголовки и ответы извлекаются буквально из текста в документе поиска. Семантическая подсистема определяет, какая часть содержимого имеет характеристики заголовка или ответа, но не объединяет новые предложения или фразы. По этой причине содержимое, включающее объяснения или определения, лучше подходит для семантического поиска.

## <a name="prerequisites"></a>Предварительные требования

+ Служба поиска на уровне "Стандартный" (S1, S2, S3), расположенная в одном из следующих регионов: северо-центральная часть США, Запад США и Западная часть США 2, Восточная часть США 2, Северная Европа, Западная Европа. При наличии существующей службы S1 или более поздней версии в одном из этих регионов вы можете запросить доступ без создания новой службы.

+ Доступ к предварительному просмотру семантического поиска: [Регистрация](https://aka.ms/SemanticSearchPreviewSignup)

+ Существующий индекс поиска, содержащий содержимое на английском языке

+ Клиент поиска для отправки запросов

  Клиент поиска должен поддерживать предварительный просмотр API-интерфейсов RESTFUL в запросе. Вы можете использовать [POST](search-get-started-rest.md), [Visual Studio Code](search-get-started-vs-code.md)или код, который выполняет вызовы API предварительного просмотра. Можно также использовать [Обозреватель поиска](search-explorer.md) в портал Azure для отправки семантического запроса.

+ [Запрос](/rest/api/searchservice/preview-api/search-documents) должен включать параметр семантики и другие параметры, описанные в этой статье.

## <a name="whats-a-semantic-query"></a>Что такое семантический запрос?

В Когнитивный поиск запрос представляет собой параметризованный запрос, который определяет обработку запросов и форму ответа. *Семантический запрос* добавляет параметры, которые вызывают семантическую модель реранжирования, которая может оценивать контекст и значение соответствующих результатов, додвигать более релевантные соответствия в верхней части и возвращать семантические ответы и заголовки.

Следующий запрос является образцом минимального семантического запроса (без ответов).

```http
POST https://[service name].search.windows.net/indexes/[index name]/docs/search?api-version=2020-06-30-Preview      
{    
    "search": " Where was Alan Turing born?",    
    "queryType": "semantic",  
    "searchFields": "title,url,body",  
    "queryLanguage": "en-us"  
}
```

Как и в случае со всеми запросами в Когнитивный поиск, запрос обращается к коллекции Documents одного индекса. Более того, семантический запрос проходит ту же последовательность синтаксического анализа, анализа, просмотра и оценки, что и несемантический запрос. 

Разница заключается в релевантности и оценках. Как определено в этом предварительном выпуске, семантический запрос, *результаты* которого передаются в соответствии с семантической моделью языка, предоставляя способ отображения совпадений, которые наиболее важны для семантического ранжирования, а не оценки, назначенные алгоритмом ранжирования сходства по умолчанию.

Только первые 50 соответствий от первоначальных результатов могут быть семантически ранжированы, а все включаемые заголовки в ответе. При необходимости можно указать **`answer`** параметр запроса, чтобы извлечь потенциальный ответ. Дополнительные сведения см. в разделе [семантические ответы](semantic-answers.md).

## <a name="query-with-search-explorer"></a>Подача запросов с использованием обозревателя поиска

[Обозреватель поиска](search-explorer.md) обновлен и включает параметры семантических запросов. После выполнения следующих действий эти параметры становятся видимыми на портале.

1. [Регистрация](https://aka.ms/SemanticSearchPreviewSignup) и поступления службы поиска в программу предварительной версии

1. Откройте портал, используя следующий синтаксис: `https://portal.azure.com/?feature.semanticSearch=true`

Параметры запроса включают параметры для включения семантических запросов, searchFields и исправления орфографии. Также можно вставить необходимые параметры запроса в строку запроса.

:::image type="content" source="./media/semantic-search-overview/search-explorer-semantic-query-options.png" alt-text="Параметры запроса в обозревателе поиска" border="true":::

## <a name="query-using-rest"></a>Запрос с помощью функции "ОСТАВШАЯся"

Используйте [Поиск документов (Предварительная версия для просмотра)](/rest/api/searchservice/preview-api/search-documents) , чтобы программно сформулировать запрос.

Ответ включает заголовки и выделение автоматически. Если требуется, чтобы ответ включал исправление или ответы, добавьте в запрос необязательный **`speller`** **`answers`** параметр или.

В следующем примере для создания семантического запроса с семантическими ответами и заголовками используется Гостиница-Sample-index:

```http
POST https://[service name].search.windows.net/indexes/hotels-sample-index/docs/search?api-version=2020-06-30-Preview      
{
    "search": "newer hotel near the water with a great restaurant",
    "queryType": "semantic",
    "queryLanguage": "en-us",
    "searchFields": "HotelName,Category,Description",
    "speller": "lexicon",
    "answers": "extractive|count-3",
    "highlightPreTag": "<strong>",
    "highlightPostTag": "</strong>",
    "select": "HotelId,HotelName,Description,Category",
    "count": true
}
```

В следующей таблице перечислены параметры запроса, используемые в семантическом запросе, чтобы их можно было увидеть как целостные. Список всех параметров см. в разделе [Поиск документов (Предварительная версия для просмотра)](/rest/api/searchservice/preview-api/search-documents)

| Параметр | Тип | Описание |
|-----------|-------|-------------|
| queryType | Строка | Допустимые значения: простая, полная и семантическая. Для семантических запросов требуется значение "семантика". |
| куерилангуаже | Строка | Требуется для семантических запросов. В настоящее время реализован только "en-US". |
| searchFields | Строка | Разделенный запятыми список полей с возможностью поиска. Указывает поля, по которым происходит семантическое ранжирование, из которого извлекаются заголовки и ответы. </br></br>В отличие от простых и полных типов запросов, порядок, в котором перечислены поля, определяет приоритет. Дополнительные инструкции по использованию см. в разделе [Step 2: Set searchFields](#searchfields). |
| средство проверки орфографии | Строка | Необязательный параметр, не относящийся к семантическим запросам, исправляет неправильно написанные термины перед достижением поисковой системы. Дополнительные сведения см. [в разделе Добавление исправления орфографии в запросы](speller-how-to-add.md). |
| Вас |Строка | Необязательные параметры, указывающие, включаются ли в результат семантические ответы. В настоящее время реализуется только "извлечение". Ответы можно настроить так, чтобы они возвращали не более пяти. Значение по умолчанию — One. В этом примере показано число трех ответов: "извлечение \| Count3". Дополнительные сведения см. в разделе [возвращение семантических ответов](semantic-answers.md).|

### <a name="formulate-the-request"></a>Формулировка запроса

В этом разделе описаны параметры запроса, необходимые для семантического поиска.

#### <a name="step-1-set-querytype-and-querylanguage"></a>Шаг 1. Настройка queryType и Куерилангуаже

Добавьте следующие параметры в остальные. Оба параметра являются обязательными.

```json
"queryType": "semantic",
"queryLanguage": "en-us",
```

Куерилангуаже должен соответствовать любым [анализаторам языка](index-add-language-analyzers.md) , назначенным определениям полей в схеме индекса. Если Куерилангуаже имеет значение en-US, то все анализаторы языка должны также иметь английский вариант ("en. Microsoft" или "en. Lucene"). Анализаторы, не зависящие от языка, такие как ключевое слово или Simple, не конфликтуют со значениями Куерилангуаже.

В запросе, если вы также используете [исправление правописания](speller-how-to-add.md), заданный куерилангуаже применяется к проверке орфографии, ответам и заголовкам. Для отдельных частей переопределение не предусмотрено. 

Хотя содержимое в индексе поиска может состоять из нескольких языков, входные данные запроса, скорее всего, находятся в одном. Поисковая система не проверяет совместимость Куерилангуаже, анализатор языка и язык, на котором состоит содержимое, поэтому обязательно выполняйте запросы соответствующим образом, чтобы избежать получения неверных результатов.

<a name="searchfields"></a>

#### <a name="step-2-set-searchfields"></a>Шаг 2. Настройка searchFields

Параметр searchFields используется для того, чтобы определять прохождение для оценки семантического сходства с запросом. В предварительной версии мы не рекомендуем оставить searchFields пустым, так как для модели требуется указание того, какие поля являются наиболее важными для обработки.

Порядок searchFields является критически важным. Если вы уже используете searchFields в существующем коде для простых или полных запросов Lucene, перейдите к этому параметру, чтобы проверить порядок полей при переключении на семантический тип запроса.

Для двух или более searchFields:

+ Включайте только строковые поля и строковые поля верхнего уровня в коллекциях. Если в коллекцию были включены нестроковые поля или поля более низкого уровня, то ошибок не будет, но эти поля не будут использоваться в семантическом ранжировании.

+ Первое поле должно всегда быть кратким (например, названием или именем), в идеале — 25 словами.

+ Если в индексе есть поле URL-адреса, которое является текстовым (например, для чтения `www.domain.com/name-of-the-document-and-other-details` , а не для компьютера `www.domain.com/?id=23463&param=eis` ), поместите его вторым в списке (или сначала, если нет поля с кратким названием).

+ Используйте эти поля в описательных полях, где можно найти ответ на семантические запросы, например основное содержимое документа.

Если указано только одно поле, используйте описательное поле, в котором можно найти ответ на семантические запросы, например основное содержимое документа. 

#### <a name="step-3-remove-orderby-clauses"></a>Шаг 3. Удаление предложений orderBy

Удалите все предложения orderBy, если они существуют в существующем запросе. Семантическая Оценка используется для упорядочивания результатов и при включении явной логики сортировки возвращается ошибка HTTP 400.

#### <a name="step-4-add-answers"></a>Шаг 4. Добавление ответов

При необходимости добавьте "Answers", если хотите включить дополнительную обработку, которая предоставляет ответ. Ответы (и заголовки) извлекаются из фрагментов, находящихся в полях, перечисленных в searchFields. Не забудьте включить в searchFields поля с богатым содержимым, чтобы получить наилучшие ответы в ответе. Дополнительные сведения см. [в разделе как вернуть семантические ответы](semantic-answers.md).

#### <a name="step-5-add-other-parameters"></a>Шаг 5. Добавление других параметров

Задайте любые другие параметры, которые должны быть в запросе. Такие параметры, как средство [проверки орфографии](speller-how-to-add.md), [SELECT](search-query-odata-select.md)и Count, улучшают качество запроса и удобочитаемость ответа.

При необходимости можно настроить стиль выделения, применяемый к заголовкам. Субтитры применяют форматирование выделения для ключевых фрагментов в документе, который обобщает ответ. Значение по умолчанию — `<em>`. Если необходимо указать тип форматирования (например, желтый фон), можно задать параметры Хигхлигхтпретаг и Хигхлигхтпосттаг.

## <a name="evaluate-the-response"></a>Оценка ответа

Как и во всех запросах, ответ состоит из всех полей, помеченных как доступные для получения, или только для полей, перечисленных в параметре SELECT. Он включает исходную оценку релевантности, а также может включать в себя количество или пакетные результаты в зависимости от того, как вы набрали запрос.

В семантическом запросе ответ содержит дополнительные элементы: новую Семантическо ранжированную оценку релевантности, заголовки в виде обычного текста и выделение, а также, при необходимости, ответ.

В клиентском приложении можно структурировать страницу поиска, включив в нее заголовок в качестве описания совпадения, а не всего содержимого определенного поля. Это полезно, если отдельные поля слишком плотны для страницы результатов поиска.

Ответ для приведенного выше примера запроса возвращает следующее совпадение в качестве верхнего подбора. Заголовки возвращаются автоматически, с обычным текстом и выделенными версиями. В примере пропущены ответы, так как их не удалось определить для конкретного запроса и совокупности.

```json
"@odata.count": 35,
"@search.answers": [],
"value": [
    {
        "@search.score": 1.8810667,
        "@search.rerankerScore": 1.1446577133610845,
        "@search.captions": [
            {
                "text": "Oceanside Resort. Luxury. New Luxury Hotel. Be the first to stay. Bay views from every room, location near the pier, rooftop pool, waterfront dining & more.",
                "highlights": "<strong>Oceanside Resort.</strong> Luxury. New Luxury Hotel. Be the first to stay.<strong> Bay</strong> views from every room, location near the pier, rooftop pool, waterfront dining & more."
            }
        ],
        "HotelName": "Oceanside Resort",
        "Description": "New Luxury Hotel. Be the first to stay. Bay views from every room, location near the pier, rooftop pool, waterfront dining & more.",
        "Category": "Luxury"
    },
```

## <a name="next-steps"></a>Дальнейшие действия

Помните, что семантические ранжирование и ответы создаются на основе исходного результирующего набора. Любая логика, улучшающая качество первоначальных результатов, будет переноситься в семантический поиск. В качестве следующего шага просмотрите функции, которые вносят первоначальные результаты, включая анализаторы, которые влияют на разметку строк, профили оценки, которые могут настраивать результаты, и алгоритм соответствия по умолчанию.

+ [Анализаторы для обработки текста](search-analyzers.md)
+ [Алгоритм ранжирования подобия](index-similarity-and-scoring.md)
+ [Профили оценки](index-add-scoring-profiles.md)
+ [Обзор семантического поиска](semantic-search-overview.md)
+ [Алгоритм семантического ранжирования](semantic-ranking.md)
