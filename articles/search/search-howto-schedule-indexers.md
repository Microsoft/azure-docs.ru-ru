---
title: Расписание выполнения индексатора
titleSuffix: Azure Cognitive Search
description: Запланируйте Azure Когнитивный поиск индексировать содержимое периодически или в определенное время.
author: HeidiSteen
manager: nitinme
ms.author: heidist
ms.service: cognitive-search
ms.topic: conceptual
ms.date: 02/09/2021
ms.openlocfilehash: 8ae9a89ddba2010603ae5a5f6b812e3aa1e1e3a6
ms.sourcegitcommit: 24f30b1e8bb797e1609b1c8300871d2391a59ac2
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/10/2021
ms.locfileid: "100097982"
---
# <a name="how-to-schedule-indexers-in-azure-cognitive-search"></a>Как планировать индексаторы в Azure Когнитивный поиск

Индексатор обычно выполняется один раз сразу после создания. Затем его можно запустить повторно по запросу с помощью портал Azure, [запуска индексатора (RESTful)](/rest/api/searchservice/run-indexer)или пакета Azure SDK. Кроме того, можно настроить выполнение индексатора по расписанию. В некоторых ситуациях, где полезно планирование индексатора, входят следующие.

* С течением времени исходные данные будут меняться, и необходимо, чтобы индексатор поиска автоматически обрабатывал разницу.

* Исходные данные очень велики, и вы хотите распределить обработку индексатора с течением времени. Для заданий индексатора применяется максимальное время выполнения в 24 часа для обычных источников данных и 2 часа для индексаторов с навыков. Если индексирование не может завершиться в течение максимального интервала, можно настроить расписание, выполняемое каждые 2 часа. Индексаторы могут автоматически отбираться там, где они остановились, в соответствии с внутренней высокой нагрузкой, которая отмечает место последнего прекращения индексирования. Использование индексатора в расписании с повторением в два часа позволяет ему обрабатывать очень большой набор данных (множество миллионов документов) сверх интервала, допустимого для одного задания. Дополнительные сведения об индексировании больших объемов данных см. [в статье индексирование больших наборов данных в Azure когнитивный Поиск](search-howto-large-index.md).

* Индекс поиска будет заполнен из нескольких источников данных, и для уменьшения конфликтов необходимо, чтобы индексаторы выполнялись в разное время.

Визуально расписание может выглядеть следующим образом: начиная с 1 января и выполняя каждые 50 минут.

```json
{
    "dataSourceName" : "myazuresqldatasource",
    "targetIndexName" : "target index name",
    "schedule" : { "interval" : "PT50M", "startTime" : "2021-01-01T00:00:00Z" }
}
```

> [!NOTE]
> Планировщик — это встроенная функция Когнитивный поиск Azure. Внешние планировщики не поддерживаются.

## <a name="schedule-property"></a>Свойство Schedule

Расписание является частью определения индексатора. Если свойство **Schedule** пропущено, то индексатор будет выполняться только один раз сразу после его создания. При добавлении свойства **расписания** необходимо указать две части.

| Свойство | Описание |
|----------|-------------|
|**Интервал** | необходимости Промежуток времени между началом двух последовательных выполнений индексатора. Минимальный интервал составляет 5 минут, а максимальный — 1440 минут (24 часа). Значение должно быть отформатировано как значение dayTimeDuration XSD (ограниченное подмножество значения [продолжительности ISO 8601](https://www.w3.org/TR/xmlschema11-2/#dayTimeDuration) ). Используется следующий шаблон: `P(nD)(T(nH)(nM))`. <br/><br/>Примеры: `PT15M` для каждых 15 минут, `PT2H` для каждых 2 часов.|
| **Время начала (UTC)** | используемых Указывает, когда должны начинаться запланированные выполнения. Если этот параметр опущен, используется текущее время в формате UTC. Это время может быть раньше, в этом случае первое выполнение планируется так, как если бы индексатор выполнялся непрерывно с момента исходного времени **начала**.<br/><br/>Примеры: `2021-01-01T00:00:00Z` начиная с полуночи 1 января, `2021-01-05T22:28:00Z` начиная с 10:28 вечера. 5 января.|

## <a name="scheduling-behavior"></a>Поведение планирования

Одновременно можно выполнить только один запуск выбранного индексатора. Если индексатор уже выполняется при запланированном следующем выполнении, это выполнение откладывается до следующего запланированного времени.

Для большей ясности рассмотрим пример. Предположим, что расписание индексатора настроено с **интервалом** в час и **временем начала** 1 июня 2019 8:00:00 по Гринвичу. Вот что может произойти, если выполнение индексатора длится дольше часа:

* Первое выполнение индексатора начинается с 1 июня 2019 в 8:00 по ГРИНВИЧу. Предположим, выполнение займет 20 минут (или иное количество времени в пределах часа).
* Второе выполнение начинается с 1 июня 2019 9:00 по ГРИНВИЧу или около него. Предположим, что выполнение занимает 70 минут — больше часа, и оно не будет выполнено до 10:10 по ГРИНВИЧу.
* Третье выполнение по расписанию начинается с 10:00 по Гринвичу (UTC), но в то время как предыдущее выполнение все еще выполняется. Это запланированное выполнение затем пропускается. Следующее выполнение индексатора не будет начато до 11:00 времени в формате UTC.

> [!NOTE]
> Если для индексатора задано определенное расписание, но при каждом повторном возникновении ошибки в одном и том же документе происходит каждый раз, то работа индексатора начнется с меньшей периодичностью (до максимального интервала как минимум раз в 24 часа) до тех пор, пока процесс не будет успешно выполнен. Если вы считаете, что какая – либо из базовых проблем решена, вы можете запустить индексатор вручную и, если индексирование завершится успешно, индексатор вернется к регулярному расписанию.

## <a name="schedule-using-rest"></a>Расписание с помощью функции "ОСТАВШАЯся"

Укажите свойство **Schedule** при создании или обновлении индексатора.

```http
    PUT https://myservice.search.windows.net/indexers/myindexer?api-version=2020-06-30
    Content-Type: application/json
    api-key: admin-key

    {
        "dataSourceName" : "myazuresqldatasource",
        "targetIndexName" : "target index name",
        "schedule" : { "interval" : "PT10M", "startTime" : "2021-01-01T00:00:00Z" }
    }
```

## <a name="schedule-using-net"></a>Планирование с помощью .NET

В следующем примере кода C# создается индексатор базы данных SQL Azure с использованием предопределенного источника данных и индекса и задается расписание запуска раз в день, начиная с этого момента.

```csharp
var schedule = new IndexingSchedule(TimeSpan.FromDays(1))
{
    StartTime = DateTimeOffset.Now
};

var indexer = new SearchIndexer("hotels-sql-idxr", dataSource.Name, searchIndex.Name)
{
    Description = "Data indexer",
    Schedule = schedule
};

await indexerClient.CreateOrUpdateIndexerAsync(indexer);
```

Расписание определяется с помощью класса [индексингсчедуле](/dotnet/api/azure.search.documents.indexes.models.indexingschedule) при создании или обновлении индексатора с помощью [сеарчиндексерклиент](/dotnet/api/azure.search.documents.indexes.searchindexerclient). Для конструктора **индексингсчедуле** требуется параметр **Interval** , заданный с помощью объекта **TimeSpan** . Как отмечалось ранее, наименьшее допустимое значение интервала — 5 минут, а максимальное — 24 часа. Второй параметр **StartTime** , указанный в качестве объекта **DateTimeOffset** , является необязательным.

## <a name="next-steps"></a>Дальнейшие действия

Для индексаторов, выполняемых по расписанию, можно отслеживать операции путем извлечения состояния из службы поиска или получения подробных сведений, включив ведение журнала диагностики.

* [Мониторинг состояния индексатора поиска](search-howto-monitor-indexers.md)
* [Собирайте и анализируйте данные журнала](search-monitor-logs.md)