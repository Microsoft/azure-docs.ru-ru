---
title: Масштабирование и управление пользовательским навыком
titleSuffix: Azure Cognitive Search
description: Узнайте о средствах и методах эффективного масштабирования пользовательского навыка для максимальной пропускной способности. Пользовательские навыки вызывают настраиваемые модели или логику AI, которые можно добавить в конвейер индексирования на основе искусственного интеллекта в Azure Когнитивный поиск.
manager: luisca
author: vkurpad
ms.author: vikurpad
ms.service: cognitive-search
ms.topic: conceptual
ms.date: 01/28/2021
ms.openlocfilehash: 22e48239631850d82cbb3e3208748416087da87c
ms.sourcegitcommit: 772eb9c6684dd4864e0ba507945a83e48b8c16f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/20/2021
ms.locfileid: "103422208"
---
# <a name="efficiently-scale-out-a-custom-skill"></a>Эффективное масштабирование пользовательского навыка

Пользовательские навыки — это веб-API, реализующие конкретный интерфейс. Пользовательский навык можно реализовать на любом доступном для адресации ресурсе. Ниже приведены наиболее распространенные реализации пользовательских навыков.
* Функции Azure для навыков настраиваемой логики
* Веб-приложения Azure для простых контейнерных навыков AI
* Служба Kubernetes Azure для более сложных и крупных навыков.

## <a name="prerequisites"></a>Предварительные требования

+ Изучите [Пользовательский интерфейс навыка](cognitive-search-custom-skill-interface.md) , чтобы получить представление о интерфейсе ввода-вывода, который должен быть реализован в пользовательском навыке.

+ Настройте среду. Вы можете начать с [этого руководства](/python/tutorial-vs-code-serverless-python-01) , чтобы настроить бессерверную функцию Azure с помощью расширений Visual Studio Code и Python.

## <a name="skillset-configuration"></a>Настройка набора навыков

Настройка пользовательского навыка для максимизации пропускной способности процесса индексирования требует понимания навыков, конфигураций индексаторов и того, как навык относится к каждому документу. Например, количество вызовов навыка для каждого документа и ожидаемая длительность для каждого вызова.

### <a name="skill-settings"></a>Параметры навыка

Для [пользовательского навыка](cognitive-search-custom-skill-web-api.md) задайте следующие параметры.

1. Набор `batchSize` настраиваемых навыков для настройки количества записей, отправляемых в навыке при одном вызове навыка.

2. Задайте для параметра значение `degreeOfParallelism` откалибровать число параллельных запросов, которые будут внесены индексатором в ваш навык.

3. Задайте `timeout` значение, достаточное для ответа на допустимый ответ.

4. В `indexer` определении задайте [`batchSize`](https://docs.microsoft.com/rest/api/searchservice/create-indexer#indexer-parameters) число документов, которые должны быть считаны из источника данных и расширяются одновременно.

### <a name="considerations"></a>Рекомендации

Установка этих переменных для оптимизации производительности индексаторов требует определения того, подходит ли ваш навык для большего количества одновременных небольших запросов или меньшего количества больших запросов. Рассмотрим следующие вопросы:

* Какова кратность вызова навыков? Выполняет ли навык один раз для каждого документа, например навык классификации документов или может ли навык выполняться несколько раз для каждого документа, навыка классификации абзацев?

* В среднем сколько документов считывается из источника данных для заполнения запроса на выработку навыков на основе размера пакета навыков? В идеале это должно быть меньше размера пакета индексатора. Если размер пакета превышает 1, ваш навык может получить записи из нескольких исходных документов. Например, если количество пакетов индексатора равно 5, а количество пакетов навыков равно 50, а каждый документ создает только пять записей, то индексатору потребуется заполнить запрос на пользовательский навык в нескольких пакетах индексатора.

* Среднее число запросов, создаваемых пакетом индексатора, должно быть оптимальным параметром для степеней параллелизма. Если инфраструктура, в которой размещается навык, не поддерживает этот уровень параллелизма, рассмотрите возможность набора степеней параллелизма. Рекомендуется протестировать конфигурацию с помощью нескольких документов, чтобы проверить выбранные параметры.

* При тестировании с использованием меньшего примера документов следует оценить время выполнения вашего навыка до общего времени, затрачиваемого на обработку подмножества документов. Ваш индексатор тратит больше времени на создание пакета или ожидает ответа от вашего навыка? 

* Рассмотрим восходящие последствия параллелизма. Если входные данные для пользовательского навыка являются выходными данными из предыдущих навыков, то все навыки в наборе навыков масштабируются, чтобы уменьшить задержку.

## <a name="error-handling-in-the-custom-skill"></a>Обработка ошибок в пользовательском навыке

Пользовательские навыки должны возвращать код состояния успеха HTTP 200 после успешного завершения навыков. Если одна или несколько записей в пакете выводят ошибки, попробуйте вернуть код с несколькими состояниями 207. Список ошибок или предупреждений для записи должен содержать соответствующее сообщение.

Все элементы в пакете, которые являются ошибками, приведут к сбою соответствующего документа. Если требуется, чтобы документ был выполнен, возвращайте предупреждение.

Любой код состояния более 299 оценивается как ошибка, и все обогащения не дают результата в случае сбоя. 

### <a name="common-error-messages"></a>Распространенные сообщения об ошибках

* `Could not execute skill because it did not execute within the time limit '00:00:30'. This is likely transient. Please try again later. For custom skills, consider increasing the 'timeout' parameter on your skill in the skillset.` Задайте параметр времени ожидания для навыка, чтобы обеспечить более длительное выполнение.

* `Could not execute skill because Web Api skill response is invalid.` Указание навыка, не возвращающего сообщение в пользовательском формате ответа квалификации. Это может быть результатом неперехваченного исключения в навыке.

* `Could not execute skill because the Web Api request failed.` Вероятнее всего это вызвано ошибками авторизации или исключениями.

* `Could not execute skill.` Обычно результат отклика о навыках сопоставляется с существующим свойством в иерархии документа.

## <a name="testing-custom-skills"></a>Тестирование пользовательских навыков

Начните с проверки пользовательского навыка с помощью REST API клиента для проверки:

* Навык реализует пользовательский интерфейс квалификации для запросов и ответов.

* Навык возвращает допустимый формат JSON с `application/JSON` типом MIME

* Возвращает допустимый код состояния HTTP

Создайте [сеанс отладки](cognitive-search-debug-session.md) , чтобы добавить свой навык в набор навыков, и убедитесь, что он создает допустимое расширение. Хотя сеанс отладки не позволяет настраивать производительность, он позволяет убедиться, что для навыка настроены допустимые значения, и возвращать ожидаемые обогащенные объекты.

## <a name="best-practices"></a>Рекомендации

* Хотя навыки могут принимать и возвращать большие полезные данные, рассмотрите возможность ограничения ответа на 150 МБ или меньше при возврате JSON.

* Рассмотрите возможность установки размера пакета для индексатора и навыка, чтобы гарантировать, что каждый пакет источника данных создает полные полезные данные для вашего навыка.

* Для длительных задач задайте для времени ожидания достаточно большое значение, чтобы при параллельной обработке документов индексатор не выпустил ошибку.

* Оптимизируйте размер пакета индексатора, размер пакета подготовки и степень параллелизма для создания шаблона нагрузки, который требуется для вашего навыка, меньшего количества больших запросов или большого количества небольших запросов.

* Отслеживайте пользовательские навыки с подробными журналами сбоев, так как можно использовать сценарии, в которых определенные запросы постоянно завершаются сбоем в результате вариативности данных.


## <a name="next-steps"></a>Дальнейшие действия
Поздравляем! Теперь пользовательский навык масштабируется вправо, чтобы повысить пропускную способность индексатора. 

+ [Power Skills: репозиторий пользовательских навыков](https://github.com/Azure-Samples/azure-search-power-skills)
+ [Добавление пользовательского навыка в конвейер обогащения искусственного интеллекта](cognitive-search-custom-skill-interface.md)
+ [Добавление Машинное обучение Azure навыка](https://docs.microsoft.com/azure/search/cognitive-search-aml-skill)
+ [Использование сеансов отладки для тестирования изменений](https://docs.microsoft.com/azure/search/cognitive-search-debug-session)