---
title: Мониторинг состояния индексатора и результатов
titleSuffix: Azure Cognitive Search
description: Отслеживайте состояние, ход выполнения и результаты работы индексаторов Azure Когнитивный поиск в портал Azure с помощью REST API или пакета SDK для .NET.
manager: nitinme
author: HeidiSteen
ms.author: heidist
ms.service: cognitive-search
ms.topic: conceptual
ms.date: 01/28/2021
ms.openlocfilehash: a94720e6b84821d53a3bfdcbdce249390078940f
ms.sourcegitcommit: 1a98b3f91663484920a747d75500f6d70a6cb2ba
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/29/2021
ms.locfileid: "99063263"
---
# <a name="how-to-monitor-azure-cognitive-search-indexer-status-and-results"></a>Как отслеживать состояние и результаты индексатора Azure Когнитивный поиск

Вы можете отслеживать обработку индексатора в портал Azure или программными средствами с помощью вызовов RESTFUL или пакета SDK для Azure. Помимо состояния самого индексатора можно проверить время начала и окончания, а также подробные сведения об ошибках и предупреждениях из определенного запуска.

## <a name="monitor-using-azure-portal"></a>Мониторинг с помощью портал Azure

Текущее состояние всех индексаторов можно просмотреть на странице обзора службы поиска. Страницы портала обновляются каждые несколько минут, поэтому вы не увидите свидетельство о том, что новый индексатор будет запущен немедленно.

   ![Список индексаторов](media/search-monitor-indexers/indexers-list.png "Список индексаторов")

| Состояние | Описание |
|--------|-------------|
| **Выполняется** | Указывает на активное выполнение. Портал будет сообщать о частичной информации. По мере выполнения индексирования можно следить за тем, чтобы в ответе было получено значение " **прошло успех** ". Индексаторы, обрабатывающие большие объемы данных, могут занимать много времени. Например, индексаторы, обрабатывающие миллионы исходных документов, могут выполняться в течение 24 часов, а затем сразу же перезапускаются. Состояние индексаторов с большим объемом громкости всегда может **говориться на** портале. Даже если выполняется индексатор, доступны подробные сведения о текущем ходе выполнения и предыдущих запусках. |
| **Успешно** | Указывает, что выполнение прошло успешно. Выполнение индексатора может быть успешным, даже если отдельные документы содержат ошибки, если количество ошибок меньше значения параметра **Максимальное число элементов, завершившихся** с помощью индексатора. |
| **Сбой** | Число ошибок превысило **Максимальное количество неудачных** погрешностей, и индексирование остановлено. |
| **Сброс** | Внутреннее состояние отслеживания изменений в индексаторе сброшено. Индексатор будет выполняться полностью, обновляются все документы, а не только с новыми метками времени. |

Можно щелкнуть индексатор в списке, чтобы просмотреть дополнительные сведения о текущих и последних запусках индексатора.

   ![Сводка индексатора и журнал выполнения](media/search-monitor-indexers/indexer-summary.png "Сводка индексатора и журнал выполнения")

На диаграмме **сводки индексатора** отображается график количества документов, обработанных в самых последних запусках.

В списке **сведения о выполнении** отображается до 50 последних результатов выполнения. Щелкните результат выполнения в списке, чтобы просмотреть конкретные сведения об этом запуске. Сюда входит время начала и окончания, а также все возникшие ошибки и предупреждения.

   ![Сведения о выполнении индексатора](media/search-monitor-indexers/indexer-execution.png "Сведения о выполнении индексатора")

Если во время выполнения возникли проблемы, связанные с документами, они будут перечислены в полях ошибки и предупреждения.

   ![Сведения об индексаторе с ошибками](media/search-monitor-indexers/indexer-execution-error.png "Сведения об индексаторе с ошибками")

Предупреждения являются общими для некоторых типов индексаторов и не всегда указывают на проблему. Например, индексаторы, использующие службы, могут сообщать о предупреждениях, если изображения или PDF-файлы не содержат текст для обработки. 

Дополнительные сведения об анализе ошибок и предупреждений индексатора см. [в статье Устранение распространенных неполадок индексатора в когнитивный Поиск Azure](search-indexer-troubleshooting.md).

## <a name="monitor-using-get-indexer-status-rest-api"></a>Мониторинг с помощью получения состояния индексатора (REST API)

Состояние и журнал выполнения индексатора можно получить с помощью [команды получить состояние индексатора](/rest/api/searchservice/get-indexer-status):

```http
GET https://[service name].search.windows.net/indexers/[indexer name]/status?api-version=2020-06-30
api-key: [Search service admin key]
```

Ответ содержит сведения об общем состоянии индексатора, последнем (или текущем) вызове индексатора, а также журнал последних вызовов индексатора.

```output
{
    "status":"running",
    "lastResult": {
        "status":"success",
        "errorMessage":null,
        "startTime":"2018-11-26T03:37:18.853Z",
        "endTime":"2018-11-26T03:37:19.012Z",
        "errors":[],
        "itemsProcessed":11,
        "itemsFailed":0,
        "initialTrackingState":null,
        "finalTrackingState":null
     },
    "executionHistory":[ {
        "status":"success",
         "errorMessage":null,
        "startTime":"2018-11-26T03:37:18.853Z",
        "endTime":"2018-11-26T03:37:19.012Z",
        "errors":[],
        "itemsProcessed":11,
        "itemsFailed":0,
        "initialTrackingState":null,
        "finalTrackingState":null
    }]
}
```

Журнал выполнения содержит до 50 последних запусков, которые сортируются в обратный хронологический порядок (последний первый).

Обратите внимание, что существует два разных значения состояния. Состояние верхнего уровня — для самого индексатора. Состояние индексатора **выполняется** означает, что индексатор настроен правильно и доступен для выполнения, но не работает.

Каждый запуск индексатора также имеет собственное состояние, которое указывает, выполняется ли данное конкретное выполнение (**выполняется**) или уже завершено с состоянием **Success**, **трансиентфаилуре** или **персистентфаилуре** . 

Когда индексатор сбрасывается для обновления состояния отслеживания изменений, добавляется отдельная запись журнала выполнения с состоянием **сброса** .

Дополнительные сведения о кодах состояния и данных мониторинга индексатора см. в разделе [Получение состояния индексатора](/rest/api/searchservice/get-indexer-status).

## <a name="monitor-using-net"></a>Мониторинг с помощью .NET

С помощью пакета SDK для Azure Когнитивный поиск .NET в следующем примере на C# в консоль записываются сведения о состоянии индексатора и результатах самого последнего (или текущего) запуска в консоли.

```csharp
static void CheckIndexerStatus(SearchIndexerClient indexerClient, SearchIndexer indexer)
{
    try
    {
        string indexerName = "hotels-sql-idxr";
        SearchIndexerStatus execInfo = indexerClient.GetIndexerStatus(indexerName);

        Console.WriteLine("Indexer has run {0} times.", execInfo.ExecutionHistory.Count);
        Console.WriteLine("Indexer Status: " + execInfo.Status.ToString());

        IndexerExecutionResult result = execInfo.LastResult;

        Console.WriteLine("Latest run");
        Console.WriteLine("Run Status: {0}", result.Status.ToString());
        Console.WriteLine("Total Documents: {0}, Failed: {1}", result.ItemCount, result.FailedItemCount);

        TimeSpan elapsed = result.EndTime.Value - result.StartTime.Value;
        Console.WriteLine("StartTime: {0:T}, EndTime: {1:T}, Elapsed: {2:t}", result.StartTime.Value, result.EndTime.Value, elapsed);

        string errorMsg = (result.ErrorMessage == null) ? "none" : result.ErrorMessage;
        Console.WriteLine("ErrorMessage: {0}", errorMsg);
        Console.WriteLine(" Document Errors: {0}, Warnings: {1}\n", result.Errors.Count, result.Warnings.Count);
    }
    catch (Exception e)
    {
        // Handle exception
    }
}
```

Выходные данные в консоли будут выглядеть примерно так:

```output
Indexer has run 18 times.
Indexer Status: Running
Latest run
  Run Status: Success
  Total Documents: 7, Failed: 0
  StartTime: 11:29:31 PM, EndTime: 11:29:31 PM, Elapsed: 00:00:00.2560000
  ErrorMessage: none
  Document Errors: 0, Warnings: 0
```

Обратите внимание, что существует два разных значения состояния. Состояние верхнего уровня — это состояние самого индексатора. Состояние индексатора " **выполняется** " означает, что индексатор настроен правильно и доступен для выполнения, но не выполняется в данный момент.

Каждый запуск индексатора также имеет собственное состояние для того, является ли это конкретное выполнение текущим (**запущенным**) или уже завершенным с состоянием **Success** или **трансиентеррор** . 

Когда индексатор сбрасывается для обновления состояния отслеживания изменений, добавляется отдельная запись журнала с состоянием **сброса** .

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения о кодах состояния и данных мониторинга индексатора см. в следующей справочнике по API:

* [Жетиндексерстатус (REST API)](/rest/api/searchservice/get-indexer-status)
* [индексерстатус](/dotnet/api/azure.search.documents.indexes.models.indexerstatus)
* [индексерексекутионстатус](/dotnet/api/azure.search.documents.indexes.models.indexerexecutionstatus)
* [индексерексекутионресулт](/dotnet/api/azure.search.documents.indexes.models.indexerexecutionresult)