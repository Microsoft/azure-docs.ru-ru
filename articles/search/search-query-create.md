---
title: Создание запроса
titleSuffix: Azure Cognitive Search
description: Узнайте, как создать запрос запроса в Когнитивный поиск, какие средства и интерфейсы API следует использовать для тестирования и кода, а также как решения запросов начинаются с проектирования индекса.
manager: nitinme
author: HeidiSteen
ms.author: heidist
ms.service: cognitive-search
ms.topic: conceptual
ms.date: 02/03/2021
ms.openlocfilehash: 9419e5f419a358be50fbb3b8478d62dfe6e3dff0
ms.sourcegitcommit: b85ce02785edc13d7fb8eba29ea8027e614c52a2
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/03/2021
ms.locfileid: "99509356"
---
# <a name="creating-queries-in-azure-cognitive-search"></a>Создание запросов в Когнитивный поиск Azure

При создании запроса в первый раз в этой статье описываются подходы и методы настройки запросов. Он также вводит запрос и объясняет, как атрибуты полей и лингвистические анализаторы могут повлиять на результаты запроса.

## <a name="whats-a-query-request"></a>Что такое запрос запроса?

Запрос — это запрос только для чтения для коллекции документов одного индекса поиска. Он указывает "queryType" и выражение запроса, хотя параметр "Search". Выражение запроса может содержать условия поиска, заключенные в кавычки фразы и операторы.

Запрос может также иметь "Count" для получения числа совпадений, найденных в индексе, "Select" для выбора полей, возвращаемых в результате поиска, и "OrderBy" для сортировки результатов. В следующих примерах показан запрос запроса с подмножеством доступных параметров. Дополнительные сведения о составлении запросов см. в разделе [типы запросов и композиции](search-query-overview.md) и [Поиск документов (остальные)](/rest/api/searchservice/search-documents).

```http
POST https://[service name].search.windows.net/indexes/hotels-sample-index/docs/search?api-version=2020-06-30
{
    "queryType": "simple"
    "search": "`New York` +restaurant",
    "select": "HotelId, HotelName, Description, Rating, Address/City, Tags",
    "count": "true",
    "orderby": "Rating desc"
}
```

## <a name="choose-a-client"></a>Выбор клиента

Вам потребуется средство или API для создания запроса, например портал Azure или POST, или кода, создающего клиент запроса. Для раннего тестирования и проверки концепции рекомендуется использовать интерфейсы API портал Azure или служб.

### <a name="permissions"></a>Разрешения

Любая операция, в том числе запросы запросов, будет работать с [ключом API администратора](search-security-api-keys.md), но при необходимости в запросах можно использовать [ключ API запроса](search-security-api-keys.md#create-query-keys). Настоятельно рекомендуется использовать ключи API запросов. Можно создать до 50 для каждой службы и назначить разные ключи для разных приложений.

В портал Azure доступ к средствам, мастерам и объектам требуется членство в роли участника или выше в службе. 

### <a name="use-azure-portal-to-query-an-index"></a>Использование портал Azure для запроса индекса

[Обозреватель поиска (портал)](search-explorer.md) — это интерфейс запросов в портал Azure, который выполняет запросы к индексам в базовой службе поиска. На внутреннем уровне портал выполняет запросы [поиска](/rest/api/searchservice/search-documents) , но не может вызывать Автозаполнение, предложения или поиск документов. 

Можно выбрать любой индекс и REST API версию, включая предварительный просмотр. В строке запроса может использоваться простой или полный синтаксис с поддержкой всех параметров запроса (Filter, SELECT, searchFields и т. д.). На портале при открытии индекса можно работать с обозревателем поиска наряду с определением JSON индекса на параллельных вкладках для упрощения доступа к атрибутам полей. Проверьте, какие поля доступны для поиска, сортировки, фильтрации и для которых можно определить особенности при тестировании запросов.

### <a name="use-a-rest-client"></a>Использование клиента RESTFUL

POST и Visual Studio Code (с расширением для Когнитивный поиск Azure) могут работать как клиент запросов. С помощью любого из этих средств можно подключиться к службе поиска и отправить запросы [поиска (остальные документы)](/rest/api/searchservice/search-documents) . Многочисленные учебники и примеры демонстрируют клиенты RESTFUL для запроса индексирования. 

Начните с любой из этих статей, чтобы узнать о каждом клиенте (оба содержат инструкции по запросам):

+ [Создание индекса поиска с помощью функции RESTFUL и POST](search-get-started-rest.md)
+ [Начало работы с Visual Studio Code и Когнитивным поиском Azure](search-get-started-vs-code.md)

Каждый запрос является автономным, поэтому необходимо указать конечную точку, имя индекса и версию API при каждом запросе. Другие свойства, тип содержимого и ключ API передаются в заголовке запроса. Дополнительные сведения см. в разделе [Поиск документов (остальное)](/rest/api/searchservice/search-documents) для получения справки по запросам составления.

### <a name="use-an-sdk"></a>Использование пакета SDK

Для Когнитивный поиск в пакетах SDK для Azure реализованы общедоступные функции. Таким образом, можно использовать любой из пакетов SDK для запроса индекса. Все они предоставляют **сеарчклиент** с методами для взаимодействия с индексом, от загрузки индекса с документами поиска до составления запросов.

| Пакет Azure SDK | Клиент | Примеры |
|-----------|--------|----------|
| .NET | [сеарчклиент](/dotnet/api/azure.search.documents.searchclient) | [дотнесовто](https://github.com/Azure-Samples/search-dotnet-getting-started/tree/master/DotNetHowTo) |
| Java | [сеарчклиент](/java/api/com.azure.search.documents.searchclient) | [Сеарчфординамикдокументсексампле. Java](https://github.com/Azure/azure-sdk-for-java/blob/azure-search-documents_11.1.3/sdk/search/azure-search-documents/src/samples/java/com/azure/search/documents/SearchForDynamicDocumentsExample.java) |
| JavaScript | [сеарчклиент](/javascript/api/@azure/search-documents/searchclient) | [readonlyQuery.js](https://github.com/Azure/azure-sdk-for-js/blob/master/sdk/search/search-documents/samples/javascript/src/readonlyQuery.js) |
| Python | [сеарчклиент](/python/api/azure-search-documents/azure.search.documents.searchclient) | [sample_simple_query. Корректировка ](https://github.com/Azure/azure-sdk-for-python/blob/7cd31ac01fed9c790cec71de438af9c45cb45821/sdk/search/azure-search-documents/samples/sample_simple_query.py) |

## <a name="choose-a-query-type-simple--full"></a>Выбор типа запроса: простой | полный

Если запрос является полнотекстовым поиском, для обработки любого текста, который передается в виде условий поиска и фраз, будет использоваться средство синтаксического анализа запросов. Когнитивный поиск Azure предлагает два средства синтаксического анализа запросов. 

+ Простой синтаксический анализатор понимает [простой синтаксис запросов](query-simple-syntax.md). Это средство синтаксического анализа было выбрано по умолчанию для скорости и эффективности в текстовых запросах в свободной форме. Синтаксис поддерживает стандартные операторы поиска (и, или, не) для поиска терминов и фраз и префикс ( `*` ) (например, "Sea *" для Сиэтл и Владикавказ). Общая рекомендация заключается в том, чтобы сначала попробовать выполнить простой синтаксический анализатор, а затем перейти на полный синтаксический анализатор, если требования приложения вызывают более эффективные запросы.

+ [Полный синтаксис запроса Lucene](query-Lucene-syntax.md#bkmk_syntax), включенный при добавлении `queryType=full` в запрос, основан на [средстве синтаксического анализа Apache Lucene](https://lucene.apache.org/core/6_6_1/queryparser/org/apache/lucene/queryparser/classic/package-summary.html).

Полный синтаксис и простой синтаксис перекрываются в той степени, которая поддерживает одинаковые операции prefix и Boolean, но полный синтаксис предоставляет больше операторов. В полной мере, существуют дополнительные операторы для логических выражений и другие операторы для расширенных запросов, таких как нечеткий поиск, поиск с использованием подстановочных знаков, поиск с учетом расположения и регулярные выражения.

## <a name="choose-query-methods"></a>Выбор методов запроса

Поиск — это принципиально управляемое пользователем упражнение, в котором термины или фразы собираются из поля поиска или из событий щелчка на странице. В следующей таблице перечислены механизмы, с помощью которых можно собираются данные, введенные пользователем, а также ожидаемый интерфейс поиска.

| Входные данные | Взаимодействие |
|-------|---------|
| [Метод Search](/rest/api/searchservice/search-documents) | Пользователь вводит термины или фразы в поле поиска с операторами или без них и щелкает Поиск для отправки запроса. Поиск можно использовать с фильтрами для одного и того же запроса, но не с помощью автозаполнения или предложений. |
| [Метод автозаполнения](/rest/api/searchservice/autocomplete) | Пользователь вводит несколько символов, и запросы инициируются после ввода каждого нового символа. Ответ — это завершенная строка из индекса. Если указана допустимая строка, пользователь нажимает кнопку Поиск, чтобы отправить запрос в службу. |
| [Метод предложений](/rest/api/searchservice/suggestions) | Как и при использовании автозаполнения, пользователь вводит несколько символов и создаются добавочные запросы. Ответ — это раскрывающийся список соответствующих документов, которые обычно представляются в нескольких уникальных или описательных полях. Если какой-либо из вариантов допустим, пользователь щелкнет один и будет возвращен соответствующий документ. |
| [Фасетная навигация](/rest/api/searchservice/search-documents#query-parameters) | На странице отображаются навигационные ссылки или пути перехода, ограничивающие область поиска. Структура многоаспектной навигации создается динамически на основе исходного запроса. Например, `search=*` для заполнения дерева навигации с аспектом, состоящего из каждой возможной категории. Структура навигации с аспектами создается на основе ответа на запрос, но также является механизмом для выражения следующего запроса. n REST API ссылка `facets` задокументирована как параметр запроса операции поиска документов, но может использоваться без `search` параметра.|
| [Метод фильтра](/rest/api/searchservice/search-documents#query-parameters) | Фильтры используются с аспектами для уменьшения результатов. Можно также реализовать фильтр за страницей, например для инициализации страницы с полями, зависящими от языка. В REST API Reference `$filter` описан как параметр запроса операции поиска документов, но его можно использовать без `search` параметра.|

## <a name="know-your-field-attributes"></a>Сведения об атрибутах полей

Если вы ранее проверили [типы и композицию запросов](search-query-overview.md), возможно, вы помните, что параметры запроса запроса зависят от того, как поля в индексе имеют атрибуты. Например, для использования в запросе, фильтре или порядке сортировки поле должно иметь возможность *поиска*, *фильтрации* и *сортировки*. Аналогичным образом в результатах могут отображаться только те поля, которые помечены как доступные для *извлечения* . По мере того как вы начинаете `search` указывать `filter` Параметры, и `orderby` в запросе, не забудьте проверить атрибуты во время перехода, чтобы избежать непредвиденных результатов.

На снимке экрана на портале ниже [индекса примера гостиниц](search-get-started-portal.md)только два последних поля "части lastrenovationdate" и "Оценка" могут использоваться только в `"$orderby"` предложении.

![Определение индекса для примера отеля](./media/search-query-overview/hotel-sample-index-definition.png "Определение индекса для примера отеля")

Описание атрибутов полей см. в разделе [CREATE INDEX (REST API)](/rest/api/searchservice/create-index).

## <a name="know-your-tokens"></a>Знакомство с маркерами

Во время индексирования поисковая система использует анализатор для анализа текста строк, увеличивая вероятность сопоставления во время выполнения запроса. Как минимум, строки имеют нижний регистр, но могут также лемматизация и прекращать удаление Word. Большие строки или составные слова обычно разбиваются на пробелы, дефисы, тире и индексируются как отдельные маркеры. 

Точка, которую нужно убрать здесь, заключается в том, что вы думаете, что ваш индекс содержит, и что на самом деле оно может отличаться. Если запросы не возвращают ожидаемых результатов, можно проверить маркеры, созданные анализатором, с помощью [анализа текста (REST API)](/rest/api/searchservice/test-analyzer). Дополнительные сведения о разметки и влиянии на запросы см. в разделе [частичный Поиск терминов и шаблоны со специальными символами](search-query-partial-matching.md).

## <a name="about-queries-per-second-qps"></a>О запросах в секунду (QPS)

Из-за большого количества факторов, которые переходят в производительность запросов, корпорация Майкрософт не публикует ожидаемые QPS числа. Оценки QPS должны разрабатываться независимо каждым клиентом с помощью конструкций уровня службы, конфигурации, индекса и запроса, которые являются допустимыми для вашего приложения. Основными определителями QPS являются размер и сложность индексов, размер и сложность запросов, а также объем трафика. Если такие факторы неизвестны, оценка не будет информативной.

Прогнозируемость показателей повышается, если оцениваются службы, работающие в выделенных ресурсах (категорий "Базовый" и "Стандартный"). Можно точнее оценить QPS, так как вы можете контролировать больше параметров. Рекомендации по оценке см. в статье [Производительность и оптимизация службы "Когнитивный поиск Azure"](search-performance-optimization.md).

Для уровней "Оптимизировано для хранилища" (L1 и L2) следует ожидать меньшую пропускную способность обработки запросов и более высокую задержку по сравнению с уровнями "Стандартный".

## <a name="next-steps"></a>Дальнейшие действия

Теперь, когда вы понимаете, как работают запросы запросов, ознакомьтесь со следующими краткими руководствами для практических занятий.

+ [Обозреватель поиска](search-explorer.md)
+ [Выполнение запроса в REST](search-get-started-rest.md)
+ [Выполнение запроса в .NET](search-get-started-dotnet.md)
+ [Как выполнить запрос в Python](search-get-started-python.md)
+ [Как выполнить запрос в JavaScript](search-get-started-javascript.md)