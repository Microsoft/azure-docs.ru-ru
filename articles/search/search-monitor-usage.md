---
title: Мониторинг операций и действий
titleSuffix: Azure Cognitive Search
description: Включите ведение журнала, получите метрики действий запросов, использование ресурсов и другие системные данные из службы Когнитивный поиск Azure.
manager: nitinme
author: HeidiSteen
ms.author: heidist
ms.service: cognitive-search
ms.topic: conceptual
ms.date: 06/30/2020
ms.openlocfilehash: aa224a09317aafd49ae10c89ae0c50455ddd4602
ms.sourcegitcommit: dae6b628a8d57540263a1f2f1cdb10721ed1470d
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/29/2021
ms.locfileid: "105709928"
---
# <a name="monitor-operations-and-activity-of-azure-cognitive-search"></a>Мониторинг операций и активности Когнитивный поиск Azure

В этой статье представлен обзор основных понятий и средств мониторинга для Azure Когнитивный поиск. Для комплексного мониторинга можно использовать сочетание встроенных функций и дополнительных служб, таких как Azure Monitor.

В целом, можно отвестись от следующих действий:

* Служба: работоспособность, доступность и изменения в конфигурации службы.
* Хранилище. используется и доступно, с учетом количества для каждого типа содержимого относительно квоты, разрешенной для уровня службы.
* Действия запроса: том, задержка, регулируемый или пропущенный запрос. Для зарегистрированных запросов запроса требуется [Azure Monitor](#add-azure-monitor).
* Действие индексирования: требуется [ведение журнала диагностики](#add-azure-monitor) с Azure Monitor.

Служба поиска не поддерживает проверку подлинности для отдельных пользователей, поэтому в журналах не будут найдены сведения об удостоверениях.

## <a name="built-in-monitoring"></a>Встроенный мониторинг

Встроенные средства мониторинга относятся к действиям, регистрируемым службой поиска. За исключением диагностики, для этого уровня мониторинга не требуется никаких настроек.

Azure Когнитивный поиск поддерживает внутренние данные в течение 30-дневного расписания для создания отчетов о работоспособности службы и метриках запросов, которые можно найти на портале или с помощью этих [интерфейсов API](#monitoring-apis).

На следующем снимке экрана вы найдете сведения о мониторинге на портале. Данные становятся доступными сразу после начала использования службы. Страницы портала обновляются каждые несколько минут.

* На вкладке **мониторинг** на главной странице Обзор отображаются объем запросов, задержка и нехватка нагрузки на службу.
* **Журнал действий** в левой области навигации подключен к Azure Resource Manager. Журнал действий сообщает о действиях, выполняемых диспетчер ресурсов: доступность и состояние службы, изменения емкости (реплики и секции) и действия, связанные с ключами API.
* Параметры **мониторинга** в дальнейшем предоставляют настраиваемые оповещения, визуализации метрик и журналы диагностики. Создавайте их при необходимости. После сбора и сохранения данных можно запросить или визуализировать информацию для получения ценных сведений.

  ![Интеграция Azure Monitor в службу поиска](./media/search-monitor-usage/azure-monitor-search.png
 "Интеграция Azure Monitor в службу поиска")

> [!NOTE]
> Так как страницы портала обновляются каждые несколько минут, указанные числа приблизительны, предоставляющих общее представление о том, насколько хорошо система обслуживает запросы. Фактические метрики, например запросы в секунду (QPS), могут быть выше или ниже числа, указанного на странице. Если точность является требованием, рассмотрите возможность использования интерфейсов API.

<a name="monitoring-apis"> </a>

### <a name="apis-useful-for-monitoring"></a>Интерфейсы API, полезные для мониторинга

Для получения тех же сведений, которые находятся на вкладках Мониторинг и использование на портале, можно использовать следующие API-интерфейсы.

* [ПОЛУЧЕНИЕ статистики службы](/rest/api/searchservice/get-service-statistics)
* [ПОЛУЧЕНИЕ статистики индекса](/rest/api/searchservice/get-index-statistics)
* [Получение количества документов](/rest/api/searchservice/count-documents)
* [ПОЛУЧЕНИЕ состояния индексатора](/rest/api/searchservice/get-indexer-status)

### <a name="activity-logs-and-service-health"></a>Журналы действий и работоспособность службы

Страница [**Журнал действий**](../azure-monitor/essentials/activity-log.md#view-the-activity-log) на портале собирает сведения из Azure Resource Manager и сообщает об изменениях в работоспособности служб. Журнал действий можно отслеживать для критических условий, ошибок и предупреждений, относящихся к работоспособности служб.

Общие записи включают ссылки на ключи API — общие информационные уведомления, такие как *Получение ключа администратора* и *получение ключей запроса*. Эти действия указывают на запросы, выполненные с помощью ключа администратора (создание или удаление объектов) или ключа запроса, но не отображают сам запрос. Чтобы получить сведения об этом детализации, необходимо настроить ведение журнала диагностики.

Вы можете получить доступ к **журналу действий** из области навигации слева, с помощью уведомления на панели команд в верхнем окне или на странице **Диагностика и решение проблем**.

### <a name="monitor-storage-in-the-usage-tab"></a>Мониторинг хранилища на вкладке "использование"

Для визуального мониторинга на портале на вкладке **Использование** отображаются сведения о доступности ресурсов относительно текущих [ограничений](search-limits-quotas-capacity.md) , накладываемых уровнем служб. Если вы принимаете решения о том, [какой уровень выбрать для производственных рабочих нагрузок](search-sku-tier.md), или о том, следует ли [изменить число активных реплик и секций](search-capacity-planning.md), эти метрики помогут вам, так как они показывают, насколько быстро используются ресурсы и насколько хорошо текущая конфигурация справляется с текущей нагрузкой.

На следующем рисунке показана служба ценовой категории "Бесплатный", которая ограничена 3 объектами каждого типа и 50 МБ памяти. Службы ценовых категории "Базовый" и "Стандартный" обеспечивают больше ресурсов, а при увеличении числа секций максимальный размер хранилища пропорционально возрастает.

![Состояние использования относительно ограничений уровня](./media/search-monitor-usage/usage-tab.png
 "Состояние использования относительно ограничений уровня")

> [!NOTE]
> Оповещения, связанные с хранилищем, в настоящее время недоступны; потребление хранилища не будет агрегировано или входить в таблицу **азуреметрикс** в Azure Monitor. Чтобы получить оповещения хранилища, необходимо [создать пользовательское решение](../azure-monitor/insights/solutions.md) , которое выдает уведомления, связанные с ресурсами, где код проверяет размер хранилища и обрабатывает ответ.

<a name="add-azure-monitor"></a>

## <a name="add-on-monitoring-with-azure-monitor"></a>Мониторинг надстроек с помощью Azure Monitor

Многие службы, включая Azure Когнитивный поиск, интегрируются с [Azure Monitor](../azure-monitor/index.yml) для дополнительных оповещений, метрик и ведения журнала диагностических данных. 

[Включите ведение журнала диагностики](search-monitor-logs.md) для службы поиска, если требуется управлять сбором и хранением данных. Записанные в журнал события, записанные Azure Monitor, хранятся в таблице **AzureDiagnostics** и включают операционные данные, связанные с запросами и индексированием.

Azure Monitor предоставляет несколько вариантов хранения, и вы можете выбрать способ использования данных:

* Выберите хранилище BLOB-объектов Azure, если необходимо [визуализировать данные журнала](search-monitor-logs-powerbi.md) в Power BI отчете.
* Выберите Log Analytics, если хотите исследовать данные с помощью запросов Kusto.

Azure Monitor имеет собственную структуру выставления счетов, а журналы диагностики, упоминаемые в этом разделе, имеют связанные затраты. Дополнительные сведения см. [в разделе Использование и оценка затрат в Azure Monitor](../azure-monitor//usage-estimated-costs.md).

## <a name="monitor-user-access"></a>Мониторинг доступа пользователей

Поскольку индексы поиска являются компонентом более крупного клиентского приложения, нет встроенной методики для управления доступом к индексу для каждого пользователя или наблюдения за ним. Предполагается, что запросы поступают из клиентского приложения, представляющего запрос администратора или запроса. Административные операции чтения и записи включают создание, обновление и удаление объектов во всей службе. Операции только для чтения — это запросы к коллекции Documents, областью действия которых является один индекс. 

Таким образом, вы увидите в журналах действий ссылки на вызовы с помощью ключей администратора или ключей запросов. Соответствующий ключ включается в запросы, исходящие из клиентского кода. Служба не поддерживает обработку токенов идентификации или олицетворения.

При наличии бизнес-требований для авторизации на уровне пользователя рекомендация заключается в интеграции с Azure Active Directory. Можно использовать $filter и удостоверения пользователей, чтобы [обрезать результаты поиска](search-security-trimming-for-azure-search-with-aad.md) документов, которые не должны видеть пользователь. 

Не существует способа записи этой информации отдельно от строки запроса, включающей параметр $filter. Подробные сведения о строках запросов см. в разделе [мониторинг запросов](search-monitor-queries.md) .

## <a name="next-steps"></a>Дальнейшие шаги

Владение с Azure Monitor важно для получения сведений о любой службе Azure, включая такие ресурсы, как Azure Когнитивный поиск. Если вы не знакомы с Azure Monitor, уделите время для просмотра статей, связанных с ресурсами. В дополнение к руководствам лучше всего начать с следующей статьи.

> [!div class="nextstepaction"]
> [Мониторинг ресурсов Azure с помощью Azure Monitor](../azure-monitor/essentials/monitor-azure-resource.md)