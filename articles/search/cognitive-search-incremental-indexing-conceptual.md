---
title: Основные понятия поэтапного обогащения (Предварительная версия)
titleSuffix: Azure Cognitive Search
description: Кэшировать промежуточное содержимое и добавочные изменения из конвейера обогащения искусственного интеллекта в службе хранилища Azure для сохранения инвестиций в существующие обработанные документы. Эта функция сейчас доступна в виде общедоступной предварительной версии.
manager: nitinme
author: Vkurpad
ms.author: vikurpad
ms.service: cognitive-search
ms.topic: conceptual
ms.date: 02/09/2021
ms.openlocfilehash: 2448609b1184c8e91947bffbd13cfea8e3fe5d52
ms.sourcegitcommit: d4734bc680ea221ea80fdea67859d6d32241aefc
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/14/2021
ms.locfileid: "100390867"
---
# <a name="incremental-enrichment-and-caching-in-azure-cognitive-search"></a>Добавочное обогащение и кэширование в Azure Когнитивный поиск

> [!IMPORTANT] 
> Добавочное углубление в настоящее время находится в общедоступной предварительной версии. Эта предварительная версия предоставляется без соглашения об уровне обслуживания и не рекомендована для использования рабочей среде. Дополнительные сведения см. в статье [Дополнительные условия использования предварительных выпусков Microsoft Azure](https://azure.microsoft.com/support/legal/preview-supplemental-terms/). 
> Эта функция доступна в [предварительных версиях REST API](search-api-preview.md) . В настоящее время отсутствует поддержка портала или пакета SDK для .NET.

*Добавочное обогащение* — это функция, предназначенная для [навыков](cognitive-search-working-with-skillsets.md). Он использует службу хранилища Azure для сохранения выходных данных обработки, генерируемых конвейером обогащения, для повторного использования в будущих запусках индексатора. Везде, где это возможно, индексатор повторно использует все кэшированные выходные данные, которые все еще действительны. 

Это не только позволяет сохранить денежные инвестиции в обработку (в частности, распознавание текста и обработки изображений), но также делает систему более эффективной. 

Рабочий процесс, использующий добавочное кэширование, включает следующие шаги.

1. [Создайте или найдите учетную запись хранения Azure](../storage/common/storage-account-create.md) для хранения кэша.
1. [Включить добавочное углубление](search-howto-incremental-index.md) в индексаторе.
1. [Создание индексатора](/rest/api/searchservice/create-indexer) и набора [навыков](/rest/api/searchservice/create-skillset) для вызова конвейера. Во время обработки этапы обогащения сохраняются для каждого документа в хранилище BLOB-объектов для будущего использования.
1. Протестируйте код и после внесения изменений используйте набор [квалификационных навыков](/rest/api/searchservice/update-skillset) для изменения определения.
1. [Запустите индексатор](/rest/api/searchservice/run-indexer) , чтобы вызвать конвейер, извлекая кэшированные выходные данные для более быстрой и экономичной обработки.

Дополнительные сведения о шагах и вопросах, касающихся работы с существующим индексатором, см. в разделе [Настройка добавочного уточнения](search-howto-incremental-index.md).

## <a name="indexer-cache"></a>Кэш индексатора

При добавочном обогащении добавляется кэш в конвейер обогащения. Индексатор кэширует результаты взлома документа, а также выходные данные каждого навыка для каждого документа. При обновлении набора знаний повторно запускаются только измененные навыки и те, которые выполняются после них. Обновленные результаты записываются в кэш, а документ обновляется в индексе поиска или в хранилище знаний.

Физически кэш хранится в контейнере больших двоичных объектов в вашей учетной записи хранения Azure. Кэш также использует хранилище таблиц для внутренней записи обновлений обработки. Все индексы в службе поиска могут использовать для кэша индексатора одну учетную запись хранения. Каждому индексатору назначается уникальный и неизменяемый идентификатор кэша для контейнера, который он использует.

## <a name="cache-configuration"></a>Конфигурация кэша

Необходимо задать `cache` свойство индексатора для запуска выигрыша из добавочного уточнения. В следующем примере показан индексатор с включенным кэшированием. Конкретные части этой конфигурации описаны в следующих разделах. Дополнительные сведения см. в разделе [Настройка добавочного обогащения](search-howto-incremental-index.md).

```json
{
    "name": "myIndexerName",
    "targetIndexName": "myIndex",
    "dataSourceName": "myDatasource",
    "skillsetName": "mySkillset",
    "cache" : {
        "storageConnectionString" : "Your storage account connection string",
        "enableReprocessing": true
    },
    "fieldMappings" : [],
    "outputFieldMappings": [],
    "parameters": []
}
```

Если установить это свойство для существующего индексатора, потребуется сбросить и повторно запустить индексатор, что приведет к повторной обработке всех документов в источнике данных. Этот шаг необходим для удаления документов, дополненных предыдущими версиями набора навыков. 

## <a name="cache-management"></a>Управление кэшем

Жизненным циклом кэша управляет индексатор. Если `cache` свойство в индексаторе имеет значение null или строка подключения изменяется, существующий кэш удаляется при следующем запуске индексатора. Кроме того, жизненный цикл кэша привязан к жизненному циклу индексатора. При удалении индексатора удаляется и связанный с ним кэш.

Хотя поэтапное углубление предназначено для обнаружения изменений и реагирования на них без вмешательства пользователя, существуют параметры, которые можно использовать для переопределения поведения по умолчанию.

+ Определение приоритетов для новых документов
+ Обход проверок набора навыков
+ Обход проверок источников данных
+ Принудительная Оценка набора навыков

### <a name="prioritize-new-documents"></a>Определение приоритетов для новых документов

Задайте `enableReprocessing` свойство для управления обработкой входящих документов, уже представленных в кэше. Если задано `true` значение (по умолчанию), документы, которые уже находятся в кэше, повторно обрабатываются при перезапуске индексатора при условии, что обновление навыка влияет на этот документ. 

При `false` этом существующие документы не обрабатываются повторно, что позволяет эффективно расставлять приоритеты для нового входящего содержимого поверх существующего. Значение должно `enableReprocessing` быть задано `false` на временной основе. Чтобы обеспечить согласованность в совокупности, `enableReprocessing` должна быть `true` большая часть времени, гарантирующая, что все документы, как новые, так и существующие, действительны в соответствии с текущим определением набора навыков.

### <a name="bypass-skillset-evaluation"></a>Обход оценки набора навыков

Изменение набора навыков и повторная обработка этого набора навыков обычно направляются вручную. Однако некоторые изменения в наборе навыков не должны приводить к повторной обработке (например, развертыванию пользовательского навыка в новом месте или с помощью нового ключа доступа). Скорее всего, это периферийные изменения, не подлинность которых повлияла на вещество самого набора навыков. 

Если известно, что изменение набора навыков действительно является недоступным, следует переопределить оценку набора навыков, задав `disableCacheReprocessingChangeDetection` для параметра значение `true` :

1. Вызовите Update квалификационный набор и измените определение набора навыков.
1. Добавьте `disableCacheReprocessingChangeDetection=true` параметр в запрос.
1. Отправьте изменение.

Установка этого параметра гарантирует, что зафиксированы только обновления определения набора навыков, и изменение не будет оцениваться на наличие изменений в существующем совокупности.

В следующем примере показан запрос на обновление набора квалификационных навыков с помощью параметра:

```http
PUT https://[search service].search.windows.net/skillsets/[skillset name]?api-version=2020-06-30-Preview&disableCacheReprocessingChangeDetection=true
```

### <a name="bypass-data-source-validation-checks"></a>Обход проверки источника данных

Большинство изменений в определении источника данных сделает кэш недействительным. Однако в случаях, когда известно, что изменение не должно сделать кэш недействительным, например изменение строки подключения или вращение ключа в учетной записи хранения, добавьте `ignoreResetRequirement` параметр в обновление источника данных. Установка этого параметра `true` позволяет выполнить фиксацию, не запуская условие сброса, которое приведет к перестроению всех объектов и заполнению с нуля.

```http
PUT https://[search service].search.windows.net/datasources/[data source name]?api-version=2020-06-30-Preview&ignoreResetRequirement=true
```

### <a name="force-skillset-evaluation"></a>Принудительная Оценка набора навыков

Целью кэша является избежание ненужной обработки, но предположим, что вы вносите изменения в навык, который не обнаруживает индексатор (например, изменение какого-либо внешнего кода, например пользовательского навыка).

В этом случае можно использовать [Сброс навыков](/rest/api/searchservice/preview-api/reset-skills) для принудительной повторной обработки определенного навыка, включая все нисходящие навыки, зависящие от выходных данных этого навыка. Этот API принимает запрос POST со списком навыков, которые должны быть аннулированы и помечены для повторной обработки. После сброса навыков запустите индексатор, чтобы вызвать конвейер.

### <a name="reset-documents"></a>Сброс документов

[Сброс индексатора](/rest/api/searchservice/reset-indexer) приведет к повторной обработке всех документов в совокупности поиска. В сценариях, где необходимо повторно обработать только несколько документов, и не удается обновить источник данных, используйте параметр [сбросить документы (Предварительная версия)](/rest/api/searchservice/preview-api/reset-documents) для принудительной повторной обработки конкретных документов. При сбросе документа индексатор делает кэш недействительным для этого документа, и документ повторно обрабатывается путем считывания из источника данных. Дополнительные сведения см. в разделе [Запуск или сброс индексаторов, навыков и документов](search-howto-run-reset-indexers.md).

## <a name="change-detection"></a>Обнаружение изменений

После включения кэша индексатор оценивает изменения в компоновке конвейера, чтобы определить, какое содержимое можно повторно использовать и что требуется выполнить повторную обработку. В этом разделе перечисляются изменения, которые делают кэш недействительным, за которыми следуют изменения, которые инициируют добавочную обработку. 

### <a name="changes-that-invalidate-the-cache"></a>Изменения, которые делают кэш недействительным

К таким изменениям относятся такие действия, после которых весь кэш становится недействительным. Например, приводящим к недействительности изменением является обновление источника данных. Вот полный список изменений, которые делают кэш недействительным:

* изменение типа внешнего источника данных;
* изменение контейнера источника данных;
* учетные данные источника данных;
* политика обнаружения изменений в источнике данных;
* политика обнаружения удалений в источнике данных;
* сопоставления полей индексатора;
* Параметры индексатора
    * режим анализа;
    * исключаемые расширения имен файлов;
    * индексируемые расширения имен файлов;
    * индексация метаданных хранилища только для очень больших документов;
    * заголовки текста с разделителями;
    * разделители текста с разделителями;
    * корневой каталог документов;
    * действие с изображением (изменения в способе извлечения изображений).

### <a name="changes-that-trigger-incremental-processing"></a>Изменения, вызывающие добавочную обработку

Добавочная обработка оценивает определение набора навыков и определяет, какие навыки следует повторно запустить, выборочно обновив затронутые части дерева документов. Ниже приведен полный список изменений, которые в результате добавочного уточнения:

* другой тип навыка в наборе навыков; изменение типа OData для навыка;
* обновление параметров конкретного навыка, например его URL-адреса, значений по умолчанию или других параметров;
* изменение выходных данных навыков, в том числе их наличие дополнительных или других выходных данных;
* изменения в навыках, изменяющие их родственные отношения и цепочки зависимостей, например: входные данные навыков
* недействительность любого навыка на уровне выше, если он предоставляет входные данные для этого навыка;
* изменение расположения для проекции хранилища знаний, которое приводит к повторному проецированию документов;
* изменение проекций хранилища знаний, которое приводит к повторному проецированию документов;
* изменение сопоставления выходных полей в индексаторе, которое приводит к повторному проецированию документов в индекс.

## <a name="api-reference"></a>Справочник по интерфейсам API

REST API версия `2020-06-30-Preview` обеспечивает добавочное дополнение через дополнительные свойства индексаторов. Навыков и источники данных могут использовать общедоступную версию. В дополнение к справочной документации см. раздел  [Настройка кэширования для добавочного уточнения](search-howto-incremental-index.md) для получения дополнительных сведений о вызове API.

+ [Создание индексатора (API-Version = 2020 – 06 -30-Preview)](/rest/api/searchservice/create-indexer) 

+ [Индексатор обновления (API версии = 2020-06 -30-Preview)](/rest/api/searchservice/update-indexer) 

+ [Обновление набора навыков (API-Version = 2020-06-30)](/rest/api/searchservice/update-skillset) (новый параметр URI в запросе)

+ [Сброс навыков (API-Version = 2020-06-30)](/rest/api/searchservice/preview-api/reset-skills)

+ Индексаторы базы данных (SQL Azure, Cosmos DB). Некоторые Индексаторы получают данные через запросы. Для запросов, извлекающих данные, [Обновление источника данных](/rest/api/searchservice/update-data-source) поддерживает новый параметр в запросе **игнорересетрекуиремент**, который должен быть установлен в, `true` Если действие обновления не должно сделать кэш недействительным. 

  Используйте **игнорересетрекуиремент** экономно, так как это может привести к непредвиденному несогласованности данных, которые не будут обнаружены легко.

## <a name="next-steps"></a>Следующие шаги

Добавочное дополнение — это мощная функция, которая расширяет отслеживание изменений до навыков и искусственного интеллекта. Добавочное дополнение позволяет повторно использовать существующее обработанное содержимое при переборе проекта набора навыков.

В качестве следующего шага включите кэширование для существующего индексатора или добавьте кэш при определении нового индексатора.

> [!div class="nextstepaction"]
> [Настройка кэширования для добавочного дополнения](search-howto-incremental-index.md)