---
title: Индексаторы для обхода данных при импорте
titleSuffix: Azure Cognitive Search
description: Просканировать базу данных SQL Azure, SQL Управляемый экземпляр, Azure Cosmos DB или службу хранилища Azure, чтобы извлечь данные для поиска и заполнить индекс Azure Когнитивный поиск.
manager: nitinme
author: HeidiSteen
ms.author: heidist
ms.service: cognitive-search
ms.topic: conceptual
ms.date: 01/11/2020
ms.custom: fasttrack-edit
ms.openlocfilehash: 5861e79054bed0d9d75258dfa9cb39b198f0f93d
ms.sourcegitcommit: d59abc5bfad604909a107d05c5dc1b9a193214a8
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/14/2021
ms.locfileid: "98216450"
---
# <a name="indexers-in-azure-cognitive-search"></a>Indexers in Azure Cognitive Search (Индексаторы в службе "Когнитивный поиск Azure")

*Индексатор* в когнитивный Поиск Azure — это средство, которое извлекает данные и метаданные с возможностью поиска из внешнего источника данных Azure и заполняет индекс поиска, используя сопоставления полей и полей между исходными данными и индексом. Этот подход иногда называют "моделью извлечения", так как служба извлекает данные в, не требуя написания кода, добавляющего данные в индекс.

Индексаторы доступны только для Azure, с индивидуальными индексаторами для [Azure SQL](search-howto-connecting-azure-sql-database-to-azure-search-using-indexers.md), [Azure Cosmos DB](search-howto-index-cosmosdb.md), [хранилищем таблиц Azure](search-howto-indexing-azure-tables.md) и [хранилищем BLOB-объектов](search-howto-indexing-azure-blob-storage.md). При настройке индексатора вы указываете источник данных (происхождение), а также индекс (назначение). Несколько источников, таких как хранилище BLOB-объектов, имеют дополнительные свойства конфигурации, относящиеся к этому типу содержимого.

Индексаторы можно запускать по требованию или по регулярному расписанию обновления данных, которое выполняется каждые пять минут. Для более частых обновлений требуется модель отправки, которая одновременно обновляет данные в Когнитивный поиск Azure и внешнем источнике данных.

## <a name="usage-scenarios"></a>Сценарии использования

Индексатор можно использовать как единственный способ приема данных или использовать сочетание методов, включающих загрузку только некоторых полей в индексе, при необходимости преобразуя или расширяя содержимое. В следующей таблице перечислены основные сценарии.

| Сценарий |Стратегия |
|----------|---------|
| Один источник | Этот шаблон является самым простым: один источник данных является единственным поставщиком содержимого для индекса поиска. Из источника вы обнаружите одно поле, содержащее уникальные значения, которые будут использоваться в качестве ключа документа в индексе поиска. Уникальное значение будет использоваться в качестве идентификатора. Все остальные поля источника сопоставляются неявно или явно с соответствующими полями в индексе. </br></br>Важным мысль является то, что значение ключа документа поступает из исходных данных. Служба поиска не создает значения ключа. При последующих запусках добавляются входящие документы с новыми ключами, а входящие документы с существующими ключами объединяются или перезаписываются в зависимости от того, имеют ли поля индекса значения NULL или заполнены. |
| Несколько источников| Индекс может принимать содержимое из нескольких источников, где каждый запуск помещает новое содержимое из другого источника. </br></br>Одним из результатов может быть индекс, который получает документы после выполнения каждого индексатора, при этом все документы создаются полностью из каждого источника. Например, документы 1-100 находятся в хранилище BLOB-объектов, документы 101-200 — из Azure SQL и т. д. Задача в этом сценарии заключается в проектировании схемы индекса, которая работает для всех входящих данных, и ключевой структуры документа, единообразной в индексе поиска. В собственном виде значения, однозначно идентифицирующие документ, metadata_storage_path в контейнере больших двоичных объектов и первичном ключе в таблице SQL. Можно предположить, что один или оба источника должны быть дополнены для предоставления ключевых значений в общем формате, независимо от происхождения содержимого. Для этого сценария следует выполнить определенный уровень предварительной обработки, чтобы хоможенизе данные, чтобы их можно было извлечь в один индекс.</br></br>В качестве альтернативного результата можно привести Поиск документов, которые частично заполнены при первом запуске, а затем заполняются последующими запусками для получения значений из других источников. Например, поля 1-10 находятся в хранилище BLOB-объектов, 11-20 из Azure SQL и т. д. Задача этого шаблона заключается в том, что каждый запуск индексирования предназначен для одного и того же документа. Для объединения полей в существующий документ требуется совпадение с ключом документа. Демонстрацию этого сценария см. в разделе [учебник. индекс из нескольких источников данных](tutorial-multiple-data-sources.md). |
| Преобразование содержимого | Когнитивный поиск поддерживает дополнительное поведение [искусственного интеллекта](cognitive-search-concept-intro.md) , которое добавляет анализ изображений и обработку естественного языка для создания нового содержимого и структуры с возможностью поиска. Обогащение искусственного интеллекта осуществляется на основе индексатора с помощью присоединенного набора [навыков](cognitive-search-working-with-skillsets.md). Чтобы выполнить обогащение искусственного интеллекта, индексатору по-прежнему нужен индекс и источник данных, но в этом сценарии добавляет обработку набора навыков в выполнение индексатора. |

## <a name="approaches-for-creating-and-managing-indexers"></a>Способы создания индексаторов и управления ими

Далее представлены способы создания индексаторов и управления ими.

+ [Мастер импорта данных > портала](search-import-data-portal.md)
+ [API REST службы](/rest/api/searchservice/Indexer-operations)
+ [Пакет SDK для .NET](/dotnet/api/azure.search.documents.indexes.models.searchindexer)

Если вы используете пакет SDK, создайте [сеарчиндексерклиент](/dotnet/api/azure.search.documents.indexes.searchindexerclient) для работы с индексаторами, источниками данных и навыков. Приведенная выше ссылка предназначена для пакета SDK для .NET, но все пакеты SDK предоставляют Сеарчиндексерклиент и аналогичные API.

Изначально новые источники данных объявляются как функции предварительной версии и доступны только для чтения. После завершения работы в общем доступе полная поддержка встроена в портал и в различные пакеты SDK, каждая из которых находится в собственных расписаниях выпуска.

## <a name="permissions"></a>Разрешения

Для всех операций, связанных с индексаторами, включая запросы на получение состояния или определений, требуется [Административный ключ API](search-security-api-keys.md).

<a name="supported-data-sources"></a>

## <a name="supported-data-sources"></a>Поддерживаемые источники данных

Данные о сканировании, выполненном индексаторами, хранятся в Azure.

+ [Хранилище BLOB-объектов Azure](search-howto-indexing-azure-blob-storage.md)
+ [Azure Data Lake Storage 2-го поколения](search-howto-index-azure-data-lake-storage.md) (Предварительная версия)
+ [хранилище таблиц Azure](search-howto-indexing-azure-tables.md)
+ [Azure Cosmos DB](search-howto-index-cosmosdb.md)
+ [База данных SQL Azure](search-howto-connecting-azure-sql-database-to-azure-search-using-indexers.md)
+ [Управляемый экземпляр SQL](search-howto-connecting-azure-sql-mi-to-azure-search-using-indexers.md)
+ [SQL Server на Виртуальных машинах Microsoft Azure](search-howto-connecting-azure-sql-iaas-to-azure-search-using-indexers.md)

## <a name="stages-of-indexing"></a>Этапы индексирования

При начальном запуске, когда индекс пуст, индексатор будет считывать все данные, предоставленные в таблице или контейнере. При последующих запусках индексатор обычно может обнаруживать и извлекать только измененные данные. Для данных больших двоичных объектов обнаружение изменений будет автоматическим. Для других источников данных, таких как Azure SQL или Cosmos DB, необходимо включить обнаружение изменений.

Для каждого документа, который он принимает, индексатор реализует или координирует несколько шагов, от извлечения документа до завершающей поисковой системы для индексирования. При необходимости индексатор также Instrumental в ходе выполнения и выхода навыков, предполагая, что набор навыков определен.

:::image type="content" source="media/search-indexer-overview/indexer-stages.png" alt-text="Этапы индексатора" border="false":::

### <a name="stage-1-document-cracking"></a>Этап 1. взлом документов

Взлом документов — это процесс открытия файлов и извлечения содержимого. В зависимости от типа источника данных индексатор попытается выполнить различные операции для извлечения потенциально индексируемого содержимого.  

Примеры:  

+ Если документ является записью в [источнике данных SQL Azure](search-howto-connecting-azure-sql-database-to-azure-search-using-indexers.md), индексатор извлекает каждое из полей для записи.
+ Если документ является PDF-файлом в [источнике данных хранилища больших двоичных объектов Azure](search-howto-indexing-azure-blob-storage.md), индексатор извлечет текст, изображения и метаданные.
+ Если документ является записью в [Cosmos DB источнике данных](search-howto-index-cosmosdb.md), индексатор извлечет поля и подполя из Cosmos DB документа.

### <a name="stage-2-field-mappings"></a>Этап 2. сопоставления полей 

Индексатор извлекает текст из исходного поля и отправляет его в поле назначения в индексе или в хранилище знаний. Если имена и типы полей совпадают, путь является четким. Однако в выходных данных могут потребоваться различные имена или типы, в этом случае необходимо сообщить индексатору, как сопоставлять поле. Этот шаг происходит после взлома документа, но до преобразований, когда индексатор считывает из исходных документов. При определении [сопоставления полей](search-indexer-field-mappings.md)значение исходного поля отправляется как есть в целевое поле без изменений. Сопоставления полей являются необязательными.

### <a name="stage-3-skillset-execution"></a>Этап 3. выполнение набора навыков

Набор квалификационных навыков — это необязательный шаг, который вызывает встроенную или настраиваемую обработку искусственного интеллекта. Он может потребоваться для оптического распознавания символов (OCR) в форме анализа изображений, или может потребоваться перевод языка. Независимо от преобразования, при выполнении набора навыков выполняется обогащение. Если индексатор является конвейером, можно представить [навык](cognitive-search-defining-skillset.md) в виде конвейера в конвейере. Набор навыков имеет собственную последовательность шагов, называемых навыками.

### <a name="stage-4-output-field-mappings"></a>Этап 4. сопоставления полей вывода

Если включить набор навыков, то, скорее всего, потребуется включить сопоставления полей вывода. Выходные данные набора навыков на самом деле представляют собой дерево информации, называемой обогащенным документом. Сопоставления полей вывода позволяют выбрать, какие части этого дерева должны сопоставляться с полями в индексе. Узнайте, как [определять сопоставления полей вывода](cognitive-search-output-field-mapping.md).

В то время как сопоставления полей связывают точные значения из источника данных с полями назначения, сопоставления полей вывода сообщают индексатору, как связать преобразованные значения в расширенном документе с полями назначения в индексе. В отличие от сопоставлений полей, которые считаются необязательными, всегда необходимо определять сопоставление полей вывода для любого преобразованного содержимого, которое должно находиться в индексе.

На следующем рисунке показан пример представления [сеанса отладки](cognitive-search-debug-session.md) индексатора этапов индексатора: взлом документов, сопоставления полей, выполнение набора навыков и сопоставления полей вывода.

:::image type="content" source="media/search-indexer-overview/sample-debug-session.png" alt-text="Пример сеанса отладки" lightbox="media/search-indexer-overview/sample-debug-session.png":::

## <a name="basic-configuration-steps"></a>Основные этапы настройки

В индексаторах реализованы уникальные функции для работы с источниками данных. Поэтому тип индексатора будет определять особенности настройки источника данных или индексатора. Тем не менее всем индексаторам присущи сходные структура и требования. Ниже описаны действия, общие для всех индексаторов.

### <a name="step-1-create-a-data-source"></a>Шаг 1. Создание источника данных

Индексатор получает соединение с источником данных из объекта *источника данных* . Определение источника данных предоставляет строку подключения и, возможно, учетные данные. Вызовите класс [CREATE Datasource](/rest/api/searchservice/create-data-source) REST API или [сеарчиндексердатасаурцеконнектион](/dotnet/api/azure.search.documents.indexes.models.searchindexerdatasourceconnection) , чтобы создать ресурс.

Источники данных настраиваются и управляются независимо от индексаторов, которые их используют. Это означает, что источник данных может использоваться несколькими индексаторами для одновременной загрузки нескольких индексов.

### <a name="step-2-create-an-index"></a>Шаг 2. Создание индекса

Хотя индексатор автоматизирует некоторые задачи, связанные с приемом данных, это обычно не распространяется на создание индекса. Перед началом работы у вас должен быть стандартный индекс с полями, которые соответствуют полям во внешнем источнике данных. Поля должны совпадать по имени и типу данных. Дополнительные сведения о структурировании индекса см. в статье [Создание индекса (Azure Когнитивный поиск REST API)](/rest/api/searchservice/Create-Index) или [класса сеарчиндекс](/dotnet/api/azure.search.documents.indexes.models.searchindex). Справку по сопоставлению полей см. [в разделе сопоставления полей в Azure когнитивный Поиск индексаторы](search-indexer-field-mappings.md).

> [!Tip]
> Хотя индексаторы не могут создавать индексы, вы можете это сделать с помощью мастера **импорта данных**. В большинстве случаев мастер может определить схему индекса на основе существующих метаданных в источнике, предоставляя предварительную схему, которую можно изменить в мастере во время его работы. После создания индекса в службе последующие изменения на портале ограничиваются добавлением новых полей. Используйте мастер для создания индекса, но не для изменения. Чтобы пройти практическое обучение, перейдите к [пошаговому руководству по порталу](search-get-started-portal.md).

### <a name="step-3-create-and-schedule-the-indexer"></a>Шаг 3. Создание и планирование индексатора

Определение индексатора — это конструкция, которая объединяет все элементы, связанные с приемом данных. Обязательные элементы включают источник данных и индекс. Необязательные элементы включают в себя расписание и сопоставления полей. Сопоставления полей являются необязательными, если поля источника и поля индекса четко соответствуют друг другу. Дополнительные сведения о структурировании индексатора см. в статье [Создание индексатора (REST API когнитивный Поиск Azure)](/rest/api/searchservice/Create-Indexer).

<a id="RunIndexer"></a>

## <a name="run-indexers-on-demand"></a>Выполнение индексаторов по запросу

Хотя можно запланировать индексирование, для вызова индексатора также может быть вызвано использование [команды Run](/rest/api/searchservice/run-indexer):

```http
POST https://[service name].search.windows.net/indexers/[indexer name]/run?api-version=2020-06-30
api-key: [Search service admin key]
```

> [!NOTE]
> Когда API запуска возвращает код успешного выполнения, был запланирован вызов индексатора, но фактическая обработка происходит асинхронно. 

Вы можете отслеживать состояние индексатора на портале или с помощью [API получения состояния индексатора](/rest/api/searchservice/get-indexer-status). 

<a name="GetIndexerStatus"></a>

## <a name="get-indexer-status"></a>Получение состояния индексатора

Состояние и журнал выполнения индексатора можно получить с помощью [команды получить состояние индексатора](/rest/api/searchservice/get-indexer-status):

```http
GET https://[service name].search.windows.net/indexers/[indexer name]/status?api-version=2020-06-30
api-key: [Search service admin key]
```

Ответ содержит сведения об общем состоянии индексатора, последнем (или текущем) вызове индексатора, а также журнал последних вызовов индексатора.

```output
{
    "status":"running",
    "lastResult": {
        "status":"success",
        "errorMessage":null,
        "startTime":"2018-11-26T03:37:18.853Z",
        "endTime":"2018-11-26T03:37:19.012Z",
        "errors":[],
        "itemsProcessed":11,
        "itemsFailed":0,
        "initialTrackingState":null,
        "finalTrackingState":null
     },
    "executionHistory":[ {
        "status":"success",
         "errorMessage":null,
        "startTime":"2018-11-26T03:37:18.853Z",
        "endTime":"2018-11-26T03:37:19.012Z",
        "errors":[],
        "itemsProcessed":11,
        "itemsFailed":0,
        "initialTrackingState":null,
        "finalTrackingState":null
    }]
}
```

История выполнения включает не более 50 последних завершенных выполнений, которые сортируются в обратном хронологическом порядке (то есть в ответе первым отображается последнее выполнение).

## <a name="next-steps"></a>Дальнейшие действия

Теперь, когда вы ознакомились с основной идеей, можно переходить к изучению требований и задач, связанных с каждым типом источника данных.

+ [База данных SQL Azure, SQL Управляемый экземпляр или SQL Server на виртуальной машине Azure](search-howto-connecting-azure-sql-database-to-azure-search-using-indexers.md)
+ [Azure Cosmos DB](search-howto-index-cosmosdb.md)
+ [Хранилище BLOB-объектов Azure](search-howto-indexing-azure-blob-storage.md)
+ [хранилище таблиц Azure](search-howto-indexing-azure-tables.md)
+ [Индексирование больших двоичных объектов CSV с помощью индексатора больших двоичных объектов Azure Когнитивный поиск](search-howto-index-csv-blobs.md)
+ [Индексирование больших двоичных объектов JSON с помощью индексатора BLOB-объектов Когнитивный поиск Azure](search-howto-index-json-blobs.md)