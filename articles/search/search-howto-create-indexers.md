---
title: Создание индексатора
titleSuffix: Azure Cognitive Search
description: Задайте свойства индексатора, чтобы определить источник данных и назначения. Можно задать параметры для изменения поведения во время выполнения.
manager: nitinme
author: HeidiSteen
ms.author: heidist
ms.service: cognitive-search
ms.topic: conceptual
ms.date: 01/28/2021
ms.openlocfilehash: 596eca0d73ffc4a590fae9b346658a2c31a1d68c
ms.sourcegitcommit: b4647f06c0953435af3cb24baaf6d15a5a761a9c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/02/2021
ms.locfileid: "101676483"
---
# <a name="creating-indexers-in-azure-cognitive-search"></a>Создание индексаторов в Когнитивный поиск Azure

Индексатор поиска предоставляет автоматизированный рабочий процесс для передачи документов и содержимого из внешнего источника данных в индекс поиска в службе поиска. Изначально она извлекает текст и метаданные из источника данных Azure, сериализует документы в JSON и передает полученные документы в поисковую систему для индексирования. Так как она была расширена для поддержки [обогащения искусственного интеллекта](cognitive-search-concept-intro.md) для обработки глубокого содержимого. 

Использование индексаторов значительно сокращает количество и сложность кода, который необходимо написать. В этой статье рассматривается механизм создания индексатора в качестве подготовки для более сложной работы с индексаторами и [навыков](cognitive-search-working-with-skillsets.md), зависящими от источника.

## <a name="whats-an-indexer-definition"></a>Что такое определение индексатора?

Индексаторы используются для текстового индексирования, которое извлекает буквенно-цифровое содержимое из исходных полей в поля индекса или обработку на основе искусственного интеллекта, которая анализирует неструктурированный текст для структуры или анализирует изображения для текста и информации, а также добавляет это содержимое в индекс. Ниже перечислены типичные определения индексов, которые можно создать для любого сценария.

### <a name="indexers-for-text-content"></a>Индексаторы для текстового содержимого

Первоначальное назначение индексатора заключается в упрощении сложного процесса загрузки индекса путем предоставления механизма для подключения и чтения текста и числового содержимого из полей в источнике данных, сериализации этого содержимого в виде документов JSON и передачи этих документов в поисковую систему для индексирования. Это все еще основной вариант использования, и для этой операции необходимо создать индексатор со свойствами, определенными в следующем примере.

```json
{
  "name": (required) String that uniquely identifies the indexer,
  "dataSourceName": (required) String indicated which existing data source to use,
  "targetIndexName": (required) String,
  "parameters": {
    "batchSize": null,
    "maxFailedItems": null,
    "maxFailedItemsPerBatch": null
  },
  "fieldMappings": [ optional unless there are field discrepancies that need resolution]
}
```

**`name`** Свойства, **`dataSourceName`** и **`targetIndexName`** являются обязательными, и в зависимости от того, как вы создаете индексатор, как источник данных, так и индекс уже должны существовать в службе, прежде чем можно будет запустить индексатор. 

**`parameters`** Свойство изменяет поведение во время выполнения, например количество ошибок, которые следует принять, прежде чем завершать все задания. Параметры также определяют поведение, зависящее от источника. Например, если источником является хранилище BLOB-объектов, можно задать параметр, фильтрующий файлы по расширениям: `"parameters" : { "configuration" : { "indexedFileNameExtensions" : ".pdf,.docx" } }` .

**`field mappings`** Свойство используется для явной привязки полей источника к назначению, если эти поля отличаются по имени или типу. Другие свойства (не показаны) используются для [указания расписания](search-howto-schedule-indexers.md), создания индексатора в отключенном состоянии или указания [ключа шифрования](search-security-manage-encryption-keys.md) для дополнительного шифрования неактивных данных.

### <a name="indexers-for-ai-indexing"></a>Индексаторы для индексирования AI

Так как индексаторы — это механизм, с помощью которого служба поиска выполняет исходящие запросы, индексаторы были расширены для поддержки обогащений искусственного интеллекта, добавления инфраструктуры и объектов для реализации этого варианта использования.

Все указанные выше свойства и параметры применяются к индексаторам, которые выполняют обогащение искусственного интеллекта. Следующие свойства относятся к расширению искусственного интеллекта: **`skillSets`** , **`outputFieldMappings`** , **`cache`** (Предварительная версия и только для остальных). 

```json
{
  "name": (required) String that uniquely identifies the indexer,
  "dataSourceName": (required) String, name of an existing data source,
  "targetIndexName": (required) String, name of an existing index,
  "skillsetName" : (required for AI enrichment) String, name of an existing skillset,
  "cache":  {
    "storageConnectionString" : (required for caching AI enriched content) Connection string to a blob container,
    "enableReprocessing": true
    },
  "parameters": {
    "batchSize": null,
    "maxFailedItems": null,
    "maxFailedItemsPerBatch": null
  },
  "fieldMappings": [],
  "outputFieldMappings" : (required for AI enrichment) { ... },
}
```

Обогащение искусственного интеллекта выходит за рамки этой статьи. Для получения дополнительных сведений Начните со следующих статей: [обогащение искусственного интеллекта](cognitive-search-concept-intro.md), [навыков в Azure когнитивный Поиск](cognitive-search-working-with-skillsets.md)и [Создание набора знаний (остальные)](/rest/api/searchservice/create-skillset).

## <a name="choose-an-indexer-client-and-create-the-indexer"></a>Выбор клиента индексатора и создание индексатора

Когда вы будете готовы создать индексатор для службы удаленного поиска, вам потребуется клиент поиска в виде средства, например портал Azure или POST, или кода, создающего экземпляр клиента индексатора. Для раннего тестирования и проверки концепции рекомендуется использовать интерфейсы API портал Azure или служб.

### <a name="permissions"></a>Разрешения

Всем операциям, связанным с индексаторами, включая запросы на получение состояния или определений, требуется [Административный ключ API](search-security-api-keys.md) для запроса.

### <a name="limits"></a>Ограничения

Все [уровни служб ограничивают](search-limits-quotas-capacity.md#indexer-limits) количество объектов, которые можно создать. При эксперименте на уровне Free можно использовать только 3 объекта каждого типа и 2 минуты обработки индексатора (не включая обработку набора навыков).

### <a name="use-azure-portal-to-create-an-indexer"></a>Использование портал Azure для создания индексатора

Портал предоставляет два варианта создания индексатора: [**Мастер импорта данных**](search-import-data-portal.md) и **Новый индексатор** , предоставляющий поля для указания определения индексатора. Мастер является уникальным в том, что он создает все необходимые элементы. При других подходах требуется заранее определить источник данных и индекс.

На следующем снимке экрана показано, где можно найти эти функции на портале. 

  :::image type="content" source="media/search-howto-create-indexers/portal-indexer-client.png" alt-text="Индексатор hotels" border="true":::

### <a name="use-a-rest-client"></a>Использование клиента REST

POST и Visual Studio Code (с расширением для Когнитивный поиск Azure) могут работать как клиент индексатора. С помощью любого из этих средств можно подключиться к службе поиска и отправить запросы на [Создание индексатора (RESTful)](/rest/api/searchservice/create-indexer) . Существует множество руководств и примеров, демонстрирующих клиенты RESTFUL для создания объектов. 

Чтобы узнать о каждом клиенте, начните с любой из этих статей:

+ [Создание индекса поиска с помощью функции RESTFUL и POST](search-get-started-rest.md)
+ [Начало работы с Visual Studio Code и Когнитивным поиском Azure](search-get-started-vs-code.md)

Дополнительные сведения о запросах индексатора составления см. в разделе [операции индексатора (остальное)](/rest/api/searchservice/Indexer-operations) .

### <a name="use-an-sdk"></a>Использование пакета SDK

Для Когнитивный поиск в пакетах SDK для Azure реализованы общедоступные функции. Таким образом, для создания объектов, связанных с индексатором, можно использовать любой из пакетов SDK. Все они предоставляют **сеарчиндексерклиент** с методами для создания индексаторов и связанных объектов, включая навыков.

| Пакет Azure SDK | Клиент | Примеры |
|-----------|--------|----------|
| .NET | [сеарчиндексерклиент](/dotnet/api/azure.search.documents.indexes.searchindexerclient) | [DotNetHowToIndexers](https://github.com/Azure-Samples/search-dotnet-getting-started/tree/master/DotNetHowToIndexers) |
| Java | [сеарчиндексерклиент](/java/api/com.azure.search.documents.indexes.searchindexerclient) | [Креатеиндексерексампле. Java](https://github.com/Azure/azure-sdk-for-java/blob/master/sdk/search/azure-search-documents/src/samples/java/com/azure/search/documents/indexes/CreateIndexerExample.java) |
| JavaScript | [сеарчиндексерклиент](/javascript/api/@azure/search-documents/searchindexerclient) | [Индексаторы](https://github.com/Azure/azure-sdk-for-js/tree/master/sdk/search/search-documents/samples/javascript/src/indexers) |
| Python | [сеарчиндексерклиент](/python/api/azure-search-documents/azure.search.documents.indexes.searchindexerclient) | [sample_indexers_operations. Корректировка](https://github.com/Azure/azure-sdk-for-python/blob/master/sdk/search/azure-search-documents/samples/sample_indexers_operations.py) |

## <a name="run-the-indexer"></a>Запуск индексатора

Индексатор выполняется автоматически при создании индексатора в службе. Это момент, когда вы обнаружите ошибки подключения к источнику данных, проблемы сопоставления полей или набор квалификационных навыков. 

Существует несколько способов запуска индексатора:

+ Отправьте HTTP-запрос для [создания индексатора](/rest/api/searchservice/create-indexer) или [индексатора обновления](/rest/api/searchservice/update-indexer) , чтобы добавить или изменить определение, и запустите индексатор.

+ Отправка HTTP-запроса на [Запуск индексатора](/rest/api/searchservice/run-indexer) для выполнения индексатора без изменений в определении.

+ Запустите программу, вызывающую методы Сеарчиндексерклиент для создания, обновления или выполнения.

> [!NOTE]
> Чтобы избежать немедленного запуска индексатора при создании, включите **`disabled=true`** в определение индексатора.

Кроме того, можно разместить индексатор [по расписанию](search-howto-schedule-indexers.md) для вызова обработки через регулярные интервалы. 

Обработка по расписанию обычно совпадает с потребностью в добавочном индексировании измененного содержимого. Логика обнаружения изменений — это возможность, встроенная в исходные платформы. Изменения в контейнере больших двоичных объектов автоматически обнаруживаются индексатором. Рекомендации по использованию обнаружения изменений в других источниках данных см. в документах индексатора для конкретных источников данных:

+ [База данных SQL Azure](search-howto-connecting-azure-sql-database-to-azure-search-using-indexers.md)
+ [Azure Data Lake Storage 2-го поколения](search-howto-index-azure-data-lake-storage.md)
+ [хранилище таблиц Azure](search-howto-indexing-azure-tables.md)
+ [Azure Cosmos DB](search-howto-index-cosmosdb.md)

## <a name="change-detection-and-indexer-state"></a>Обнаружение изменений и состояние индексатора

Индексаторы могут обнаруживать изменения в базовых данных и обрабатывать только новые или обновленные документы при каждом выполнении индексатора. Например, если состояние индексатора говорит о том, что запуск прошел успешно с `0/0` обработанными документами, это означает, что индексатор не нашел новых или измененных строк или больших двоичных объектов в базовом источнике данных.

Как индексатор поддерживает обнаружение изменений зависит от источника данных:

+ Хранилище BLOB-объектов Azure, хранилище таблиц Azure и Azure Data Lake Storage 2-го поколения отмечать обновление каждого большого двоичного объекта или строки на дату и время. Различные индексаторы используют эти сведения для определения документов для обновления в индексе. Встроенное обнаружение изменений означает, что индексатор может распознать новые и обновленные документы без дополнительной настройки.

+ Azure SQL и Cosmos DB предоставляют функции обнаружения изменений на своих платформах. В определении источника данных можно указать политику обнаружения изменений.

При больших нагрузках при индексировании индексатор также отслеживает последний документ, обработанный с помощью внутренней метки "высокая наводы". Маркер никогда не отображается в API, но внутренний индексатор отслеживает, откуда оно остановлено. Когда индексирование возобновляется с помощью запланированного выполнения или вызова по требованию, индексатор ссылается на верхний маркер воды, чтобы он мог продолжить работу с места остановки.

Если необходимо очистить верхнюю подложку для полного повторного индексирования, можно использовать [Сброс индексатора](/rest/api/searchservice/reset-indexer). Для более выборочной повторной индексации используйте [Сброс навыков](/rest/api/searchservice/preview-api/reset-skills) или [Сброс документов](/rest/api/searchservice/preview-api/reset-documents). С помощью API сброса можно очистить внутреннее состояние, а также очистить кэш, если вы включили [добавочное уточнение](search-howto-incremental-index.md). Дополнительные сведения и сравнение всех параметров сброса см. в разделе [Запуск или сброс индексаторов, навыков и документов](search-howto-run-reset-indexers.md).

## <a name="know-your-data"></a>Знание данных

Индексаторы предполагают набор табличных строк, где каждая строка преобразуется в индекс в виде полного или частичного документа поиска. Часто существует однозначное соответствие между строкой и результирующим документом поиска, где все поля в наборе строк полностью заполнены каждым документом. Однако индексаторы можно использовать для создания только части документа, например, если вы используете несколько индексаторов или подходов для построения индекса. 

Чтобы свести реляционные данные в набор строк, следует создать представление SQL или создать запрос, возвращающий родительские и дочерние записи в той же строке. Например, встроенный набор данных из набора гостиниц — это база данных SQL, которая содержит 50 записей (по одному для каждого отеля), связанных с записями комнаты в связанной таблице. Запрос, который выполняет сведение общих данных в набор строк, внедряет все сведения о комнате в документы JSON в каждой записи отеля. Сведения о внедренном помещении создаются запросом, использующим предложение **for JSON Auto** . Дополнительные сведения об этом методе см. в статье [Определение запроса, возвращающего внедренный код JSON](index-sql-relational-data.md#define-a-query-that-returns-embedded-json). Это лишь один пример. Вы можете найти другие подходы, которые приведут к тому же результату.

В дополнение к плоским данным важно извлечь только данные, которые можно найти. Данные с возможностью поиска являются буквенно-цифровыми. Когнитивный поиск не может выполнять поиск по двоичным данным в любом формате, хотя он может извлекать и выводить текстовые описания файлов изображений (см. [обогащение искусственного интеллекта](cognitive-search-concept-intro.md)) для создания содержимого с возможностью поиска. Аналогично, использование обогащения искусственного интеллекта позволяет анализировать большой текст с помощью естественных языковых моделей для поиска структуры или релевантной информации, а также создания нового содержимого, которое можно добавить в документ поиска.

Учитывая, что Индексаторы не устраняют проблемы с данными, могут потребоваться другие формы очистки данных или манипуляций. Дополнительные сведения см. в документации по продукту [базы данных Azure](../index.yml?product=databases).

## <a name="know-your-index"></a>Знакомство с индексом

Помните, что индексаторы передают поисковые документы в поисковую систему для индексирования. Точно так же, как индексаторы имеют свойства, определяющие поведение выполнения, схема индекса имеет свойства, которые определяют, как индексируются строки (только строки анализируются и размечены). В зависимости от назначений анализатора индексированные строки могут отличаться от переданных. Вы можете оценить влияние анализаторов с помощью функции [анализа текста (остальное)](/rest/api/searchservice/test-analyzer). Дополнительные сведения о анализаторах см. в разделе [анализаторы для обработки текста](search-analyzers.md).

С точки зрения взаимодействия индексаторов с индексом индексатор проверяет только имена и типы полей. Этап проверки, гарантирующий, что входящее содержимое верно для соответствующего поля поиска в индексе, не существует. На этапе проверки можно выполнять запросы к заполненному индексу, который возвращает целые документы или выбранные поля. Дополнительные сведения о запросе содержимого индекса см. [в разделе Создание простого запроса](search-query-create.md).

## <a name="next-steps"></a>Дальнейшие действия

+ [Расписание индексаторов](search-howto-schedule-indexers.md)
+ [Определение сопоставлений полей](search-indexer-field-mappings.md)
+ [Мониторинг состояния индексатора](search-howto-monitor-indexers.md)
+ [Подключение с использованием управляемых удостоверений](search-howto-managed-identities-data-sources.md)