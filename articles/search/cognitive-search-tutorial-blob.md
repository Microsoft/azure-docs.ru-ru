---
title: Руководство по использованию REST и искусственного интеллекта с большими двоичными объектами
titleSuffix: Azure Cognitive Search
description: Узнайте, как выполнять извлечение текста и обработку естественного языка по содержимому хранилища BLOB-объектов с помощью Postman и REST API Когнитивного поиска Azure.
manager: nitinme
author: luiscabrer
ms.author: luisca
ms.service: cognitive-search
ms.topic: tutorial
ms.date: 11/17/2020
ms.openlocfilehash: 21f0d141567f17c470732088c6a93a2ae7ed3c67
ms.sourcegitcommit: 867cb1b7a1f3a1f0b427282c648d411d0ca4f81f
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "94738056"
---
# <a name="tutorial-use-rest-and-ai-to-generate-searchable-content-from-azure-blobs"></a>Руководство по использованию REST и искусственного интеллекта для создания доступного для поиска содержимого на основе данных больших двоичных объектов Azure

Если у вас есть неструктурированный текст или изображения в Хранилище BLOB-объектов Azure, [конвейер обогащения с помощью искусственного интеллекта](cognitive-search-concept-intro.md) поможет извлечь информацию из BLOB-объектов и создавать содержимое, используемое в сценариях полнотекстового поиска и интеллектуального анализа. Хотя конвейер может обрабатывать изображения, в этом учебнике для REST внимание уделяется созданию полей на основе распознавания языка и обработки естественного языка. Все это позволит вам использовать информацию в запросах, аспектах и фильтрах.

В этом учебнике используется Postman и [REST API поиска](/rest/api/searchservice/), чтобы выполнять следующие задачи:

> [!div class="checklist"]
> * Настройте службы и коллекцию Postman.
> * Создайте конвейер обогащения, который извлекает текст, а также распознает язык, сущности и ключевые фразы.
> * Создайте индекс для хранения выходных данных (необработанное содержимое и созданные конвейером пары "имя — значение").
> * Выполните конвейер, чтобы начать преобразования и анализ, а также загрузить индекс.
> * Изучите результаты с помощью полнотекстового поиска и расширенного синтаксиса запросов.

Если у вас еще нет подписки Azure, [создайте бесплатную учетную запись Azure](https://azure.microsoft.com/free/?WT.mc_id=A261C142F), прежде чем начинать работу.

## <a name="overview"></a>Обзор

В этом руководстве используется C# и REST API службы "Когнитивный поиск Azure" для создания источника данных, индекса, индексатора и набора навыков. Вы начнете работу с документами (неструктурированный текст) в формате PDF, HTML, DOCX и PPTX в Хранилище BLOB-объектов Azure, а затем будете использовать набор навыков для извлечения сущностей, ключевых фраз и другого текста в файлах содержимого.

Набор навыков использует встроенные навыки на основе API-интерфейсов Cognitive Services. К этапам конвейера относятся определение языка в тексте, извлечение ключевых фраз и распознавание сущностей (организаций). Новые сведения хранятся в новых полях, которые можно использовать в запросах, аспектах и фильтрах.

## <a name="prerequisites"></a>Предварительные требования

+ [Хранилище Azure](https://azure.microsoft.com/services/storage/)
+ [Классическое приложение Postman](https://www.getpostman.com/)
+ [Создайте службу поиска](search-create-service-portal.md) или [найдите существующую службу](https://ms.portal.azure.com/#blade/HubsExtension/BrowseResourceBlade/resourceType/Microsoft.Search%2FsearchServices) 

> [!Note]
> Для выполнения инструкций из этого руководства вы можете использовать бесплатную версию службы. В бесплатной версии вы можете использовать не более трех индексов, трех индексаторов и трех источников данных. В этом руководстве создается по одному объекту из каждой категории. Перед началом работы убедитесь, что у службы есть достаточно места, чтобы принять новые ресурсы.

## <a name="download-files"></a>Загрузка файлов

1. Откройте эту [папку OneDrive](https://1drv.ms/f/s!As7Oy81M_gVPa-LCb5lC_3hbS-4) и щелкните **Скачать** вверху слева, чтобы скопировать файлы на локальный компьютер. 

1. Щелкните ZIP-файл правой кнопкой мыши и выберите **Извлечь все**. Доступно 14 файлов разных типов. В этом примере вам потребуются семь из них.

Кроме того, вы также можете скачать исходный код, коллекцию файлов Postman, для этого руководства. Исходный код можно найти здесь: [https://github.com/Azure-Samples/azure-search-postman-samples/tree/master/Tutorial](https://github.com/Azure-Samples/azure-search-postman-samples/tree/master/Tutorial).

## <a name="1---create-services"></a>1\. Создание служб

В этом учебнике используются Когнитивный поиск Azure для индексирования и создания запросов, сервер Cognitive Services — для обогащения с помощью искусственного интеллекта и хранилище BLOB-объектов Azure — для предоставления данных. В этом учебнике остается свободное выделение 20 транзакций на индексатор в день в Cognitive Services, поэтому необходимо создать только службы поиска и хранения.

Желательно создать все службы в одном регионе и одной группе ресурсов, чтобы упростить взаимодействие и управление. В реальной системе учетная запись хранения Azure может находиться в любом регионе.

### <a name="start-with-azure-storage"></a>Служба хранилища Azure

1. [Войдите на портал Azure](https://portal.azure.com/) и щелкните **+ Создать ресурс**.

1. Выполните поиск по строке *учетная запись хранения* и выберите "Учетная запись хранения Microsoft".

   ![Создание учетной записи хранения](media/cognitive-search-tutorial-blob/storage-account.png "Создание учетной записи хранения")

1. На вкладке "Основные сведения" нужно ввести следующие сведения. Сохраните значения по умолчанию для остальных параметров.

   + **Группа ресурсов**. Вы можете выбрать существующую группу ресурсов или создать новую, но для всех служб это должна быть одна и та же группа для совместного управления.

   + **Имя учетной записи хранения.** Если вы ожидаете, что у вас будет несколько ресурсов одного типа, используйте имена, которые будут четко определять тип и регион, например *blobstoragewestus*. 

   + **Расположение.** Желательно выбрать то же расположение, которое использовалось для Когнитивного поиска Azure и Cognitive Services. При использовании одного расположения плата за трафик не взимается.

   + **Тип учетной записи.** Выберите значение по умолчанию *StorageV2 (общего назначения версии 2)* .

1. Щелкните **Просмотреть и создать**, чтобы создать службу.

1. По завершении процесса щелкните **Перейти к ресурсу** чтобы открыть страницу со сводкой.

1. Щелкните службу **Большие двоичные объекты**.

1. Щелкните **+ Контейнер**, чтобы создать контейнер, и присвойте ему имя *cog-search-demo*.

1. Выберите *cog-search-demo* и щелкните **Отправить**, чтобы открыть папку с сохраненными файлами для скачивания. Выберите все файлы, не являющиеся изображениями. Их должно быть семь. Щелкните **ОК**, чтобы начать отправку.

   ![Отправка образцов файлов](media/cognitive-search-tutorial-blob/sample-files.png "Отправка образцов файлов")

1. Прежде чем выйти из службы хранилища Azure, получите строку подключения для создания подключения в Когнитивном поиске Azure. 

   1. Вернитесь на страницу со сводкой об учетной записи хранения (в качестве примера мы использовали *blobstragewestus*). 
   
   1. В области навигации слева выберите **Ключи доступа** и скопируйте одну из строк подключения. 

   Строка подключения — это URL-адрес в следующем формате:

      ```http
      DefaultEndpointsProtocol=https;AccountName=cogsrchdemostorage;AccountKey=<your account key>;EndpointSuffix=core.windows.net
      ```

1. Сохраните эту строку подключения в Блокноте. Она понадобится позже при настройке подключения к источнику данных.

### <a name="cognitive-services"></a>Cognitive Services

Обогащение ИИ основано на платформе Cognitive Services, которая включает службы "Анализ текста" для обработки естественного языка и "Компьютерное зрение" для обработки изображений. Если бы вы создавали реальный прототип или проект, на этом этапе нужно было бы создать Cognitive Services (в том же регионе, что и Когнитивный поиск Azure) для связывания с операциями индексирования.

Но для нашего примера подготовку ресурсов можно пропустить, так как Когнитивный поиск Azure может подключаться к Cognitive Services в фоновом режиме и предоставляет 20 бесплатных транзакций для каждого выполнения индексатора. В примере из этого руководства используется всего семь транзакций. Это значит, что нам достаточно уровня "Бесплатный". Для крупных проектов вам, скорее всего, нужно будет подготовить Cognitive Services на уровне S0 с оплатой по мере использования. См. сведения о [подключении Cognitive Services](cognitive-search-attach-cognitive-services.md).

### <a name="azure-cognitive-search"></a>Когнитивный поиск Azure

Третий компонент — Когнитивный поиск Azure, который вы можете [создать на портале](search-create-service-portal.md). Для выполнения действий в этом пошаговом руководстве можно использовать уровень "Бесплатный". 

Как и с хранилищем BLOB-объектов Azure, не забудьте сохранить ключ доступа. Позже, когда вы начнете структурировать запросы, адрес конечной точки и административный ключ интерфейса нужно будет указывать в каждом запросе для проверки подлинности.

### <a name="copy-an-admin-api-key-and-url-for-azure-cognitive-search"></a>Копирование ключа API и URL-адреса конечной точки для администрирования Когнитивного поиска Azure

1. [Войдите на портал Azure](https://portal.azure.com/) и на странице **Обзор** для службы поиска получите ее имя. Имя службы можно проверить, просмотрев URL-адрес конечной точки. Если URL-адрес конечной точки имеет вид `https://mydemo.search.windows.net`, значит служба называется `mydemo`.

2. В разделе **Параметры** > **Ключи** получите ключ администратора, чтобы обрести полные права на службу. Существуют два взаимозаменяемых ключа администратора, предназначенных для обеспечения непрерывности бизнес-процессов на случай, если вам потребуется сменить один из них. Вы можете использовать первичный или вторичный ключ для выполнения запросов на добавление, изменение и удаление объектов.

   Получите также ключ запроса. Мы рекомендуем создавать запросы с доступом только для чтения.

   ![Получение имени службы, ключей запросов и администратора](media/search-get-started-javascript/service-name-and-keys.png)

Для выполнения любого запроса к службе нужно включить ключ API в заголовок. Действительный ключ устанавливает для каждого запроса отношения доверия между приложением, которое отправляет запрос, и службой, которая его обрабатывает.

## <a name="2---set-up-postman"></a>2\. Настройка Postman

Запустите Postman и настройте HTTP-запрос. Если вы не работали с этим инструментом, изучите краткое руководство по [интерфейсам REST API службы "Когнитивный поиск Azure"](search-get-started-rest.md).

Методы запроса, используемые в этом руководстве: **POST**, **PUT** и **GET**. Вы примените эти методы для четырех вызовов API к службе поиска, которые создадут источник данных, набор навыков, индекс и индексатор.

В разделе "Заголовки" присвойте параметру Content-type значение `application/json`, а в параметре `api-key` сохраните значение ключа администрирования для службы "Когнитивный поиск Azure". Единожды выполнив настройку заголовков, вы сможете применять их для всех запросов в этом руководстве.

  ![URL-адрес и заголовок запроса Postman](media/search-get-started-rest/postman-url.png "URL-адрес и заголовок запроса Postman")

## <a name="3---create-the-pipeline"></a>3\. Создание конвейера

В службе "Когнитивный поиски Azure" обогащение выполняется во время индексирования (или приема данных). В этой части пошагового руководства описано, как создать четыре объекта: источник данных, определение индекса, набор навыков и индексатор. 

### <a name="step-1-create-a-data-source"></a>Шаг 1. Создание источника данных

[Объект источника данных](/rest/api/searchservice/create-data-source) предоставляет строку подключения к контейнеру больших двоичных объектов, который содержит файлы.

1. Используйте запрос **POST** и следующий URL-адрес, заменив YOUR-SERVICE-NAME фактическим именем службы.

   ```http
   https://[YOUR-SERVICE-NAME].search.windows.net/datasources?api-version=2020-06-30
   ```

1. В **текст** запроса поместите следующее определение JSON, заменив в нем `connectionString` фактической строкой подключения к учетной записи хранения. 

   Не забудьте также изменить имя контейнера. На предыдущем шаге мы предложили назвать этот контейнер cog-search-demo.

    ```json
    {
      "name" : "cog-search-demo-ds",
      "description" : "Demo files to demonstrate cognitive search capabilities.",
      "type" : "azureblob",
      "credentials" :
      { "connectionString" :
        "DefaultEndpointsProtocol=https;AccountName=<YOUR-STORAGE-ACCOUNT>;AccountKey=<YOUR-ACCOUNT-KEY>;"
      },
      "container" : { "name" : "<YOUR-BLOB-CONTAINER-NAME>" }
    }
    ```
1. Отправьте запрос. Вы увидите код состояния 201, подтверждающий успешное выполнение. 

Если вы получили ошибку 403 или 404, проверьте структуру запроса: `api-version=2020-06-30` должен находиться в конечной точке, `api-key` должен находиться в заголовке после `Content-Type`, и его значение должно быть действительным для службы поиска. Вы можете применить к документу JSON средство проверки JSON в Интернете, чтобы проверить синтаксис. 

### <a name="step-2-create-a-skillset"></a>Шаг 2. Создание набора навыков

[Объект набора навыков](/rest/api/searchservice/create-skillset) — это набор шагов обогащения, которые применяются к содержимому. 

1. Используйте запрос **PUT** и следующий URL-адрес, заменив YOUR-SERVICE-NAME фактическим именем службы.

    ```http
    https://[YOUR-SERVICE-NAME].search.windows.net/skillsets/cog-search-demo-sd?api-version=2020-06-30
    ```

1. В **текст** запроса скопируйте представленное ниже определение JSON. Набор навыков содержит перечисленные ниже встроенные навыки.

   | Навык                 | Описание    |
   |-----------------------|----------------|
   | [Распознавание сущностей](cognitive-search-skill-entity-recognition.md) | Извлекает имена людей, а также названия организаций и расположений из содержимого в контейнере больших двоичных объектов. |
   | [распознавание языка](cognitive-search-skill-language-detection.md); | Определяет язык содержимого. |
   | [Разделение текста](cognitive-search-skill-textsplit.md)  | Разбивает содержимое большого объема на более мелкие фрагменты данных перед вызовом метода извлечения ключевых фраз. Этот метод принимает входные данные объемом 50 000 символов или меньше. Некоторые примеры файлов следует разделить, чтобы удовлетворить это ограничение. |
   | [извлечение ключевых фраз](cognitive-search-skill-keyphrases.md); | Извлекает ключевые фразы, которые встречаются чаще всего. |

   Каждый навык выполняется в содержимом документа. Во время обработки служба "Когнитивный поиск Azure" разбивает каждый документ для чтения содержимого из разных форматов файлов. Найденный текст в исходном файле помещается в созданное поле ```content```, по одному для каждого документа. Входные данные принимают следующий вид: ```"/document/content"```.

   Мы используем навык разделения текста для разбиения больших файлов на страницы, поэтому контекстом для навыка извлечения ключевых фраз будет ```"document/pages/*"``` (для каждой страницы в документе), а не ```"/document/content"```.

    ```json
    {
      "description": "Extract entities, detect language and extract key-phrases",
      "skills":
      [
        {
          "@odata.type": "#Microsoft.Skills.Text.EntityRecognitionSkill",
          "categories": [ "Person", "Organization", "Location" ],
          "defaultLanguageCode": "en",
          "inputs": [
            { "name": "text", "source": "/document/content" }
          ],
          "outputs": [
            { "name": "persons", "targetName": "persons" },
            { "name": "organizations", "targetName": "organizations" },
            { "name": "locations", "targetName": "locations" }
          ]
        },
        {
          "@odata.type": "#Microsoft.Skills.Text.LanguageDetectionSkill",
          "inputs": [
            { "name": "text", "source": "/document/content" }
          ],
          "outputs": [
            { "name": "languageCode", "targetName": "languageCode" }
          ]
        },
        {
          "@odata.type": "#Microsoft.Skills.Text.SplitSkill",
          "textSplitMode" : "pages",
          "maximumPageLength": 4000,
          "inputs": [
            { "name": "text", "source": "/document/content" },
            { "name": "languageCode", "source": "/document/languageCode" }
          ],
          "outputs": [
            { "name": "textItems", "targetName": "pages" }
          ]
        },
        {
          "@odata.type": "#Microsoft.Skills.Text.KeyPhraseExtractionSkill",
          "context": "/document/pages/*",
          "inputs": [
            { "name": "text", "source": "/document/pages/*" },
            { "name":"languageCode", "source": "/document/languageCode" }
          ],
          "outputs": [
            { "name": "keyPhrases", "targetName": "keyPhrases" }
          ]
        }
      ]
    }
    ```
    Графическое представление набора навыков показано ниже. 

    ![Общие сведения о наборе навыков](media/cognitive-search-tutorial-blob/skillset.png "Общие сведения о наборе навыков")

1. Отправьте запрос. Postman должен вернуть код состояния 201, подтверждающий успешное выполнение. 

> [!NOTE]
> Выходные данные могут быть сопоставлены с индексом, используемым в качестве входных данных для нисходящего навыка, или к обоим, как в случае с кодом языка. В индексе код языка полезен для фильтрации. В качестве входных данных код языка используется навыками анализа текста, чтобы указать лингвистические правила для разбивки слов. Общие сведения о наборах навыков см. в статье [How to create a skillset in an enrichment pipeline](cognitive-search-defining-skillset.md) (Способ создания набора навыков в конвейере обогащения).

### <a name="step-3-create-an-index"></a>Шаг 3. Создание индекса

[Индекс](/rest/api/searchservice/create-index) предоставляет схему для создания физического выражения содержимого в инвертированных индексах и других конструкциях в Когнитивном поиске Azure. Самым крупным компонентом индекса является коллекция полей, где указаны тип данных и атрибуты для определения содержимого и поведения в Когнитивном поиске Azure.

1. Используйте запрос **POST** и следующий URL-адрес, заменив YOUR-SERVICE-NAME фактическим именем службы, чтобы присвоить индексу имя.

   ```http
   https://[YOUR-SERVICE-NAME].search.windows.net/indexes/cog-search-demo-idx?api-version=2020-06-30
   ```

1. В **текст** запроса скопируйте представленное ниже определение JSON. Поле `content` содержит сам документ. Дополнительные поля `languageCode`, `keyPhrases` и `organizations` представляют новые сведения (поля и значения), которые создаются набором навыков.

    ```json
    {
      "fields": [
        {
          "name": "id",
          "type": "Edm.String",
          "key": true,
          "searchable": true,
          "filterable": false,
          "facetable": false,
          "sortable": true
        },
        {
          "name": "metadata_storage_name",
          "type": "Edm.String",
          "searchable": false,
          "filterable": false,
          "facetable": false,
          "sortable": false
        },
        {
          "name": "content",
          "type": "Edm.String",
          "sortable": false,
          "searchable": true,
          "filterable": false,
          "facetable": false
        },
        {
          "name": "languageCode",
          "type": "Edm.String",
          "searchable": true,
          "filterable": false,
          "facetable": false
        },
        {
          "name": "keyPhrases",
          "type": "Collection(Edm.String)",
          "searchable": true,
          "filterable": false,
          "facetable": false
        },
        {
          "name": "persons",
          "type": "Collection(Edm.String)",
          "searchable": true,
          "sortable": false,
          "filterable": true,
          "facetable": true
        },
        {
          "name": "organizations",
          "type": "Collection(Edm.String)",
          "searchable": true,
          "sortable": false,
          "filterable": true,
          "facetable": true
        },
        {
          "name": "locations",
          "type": "Collection(Edm.String)",
          "searchable": true,
          "sortable": false,
          "filterable": true,
          "facetable": true
        }
      ]
    }
    ```

1. Отправьте запрос. Postman должен вернуть код состояния 201, подтверждающий успешное выполнение. 

### <a name="step-4-create-and-run-an-indexer"></a>Шаг 4. Создание и запуск индексатора

[Индексатор](/rest/api/searchservice/create-indexer) управляет работой конвейера. Три компонента, которые вы создали ранее (источник данных, набор навыков и индекс) предоставляют входные данные для индексатора. Именно создание индексатора в Когнитивном поиске Azure является событием, которое запускает весь конвейер. 

1. Используйте запрос **POST** и следующий URL-адрес, заменив YOUR-SERVICE-NAME фактическим именем службы, чтобы присвоить индексатору имя.

   ```http
   https://[servicename].search.windows.net/indexers/cog-search-demo-idxr?api-version=2020-06-30
   ```

1. В **текст** запроса скопируйте представленное ниже определение JSON. Обратите внимание на элементы сопоставления полей. Они очень важны, так как определяют поток данных. 

   Обработка `fieldMappings` выполняется перед выполнением набора навыков. При этом содержимое отправляется из источника данных в целевые поля в индексе. Сопоставления полей используются для отправки неизмененного существующего содержимого в индекс. Если имена и типы полей одинаковы в исходном и целевом расположениях, сопоставление не требуется.

   `outputFieldMappings` используется для полей, создаваемых навыками, следовательно, обрабатывается после выполнения набора навыков. Ссылки на `sourceFieldNames` в `outputFieldMappings` не существуют до того момента, пока не будут созданы в процессе распознавания или обогащения документа. `targetFieldName` обозначает поле в индексе, определенное в схеме индекса.

    ```json
    {
      "name":"cog-search-demo-idxr",
      "dataSourceName" : "cog-search-demo-ds",
      "targetIndexName" : "cog-search-demo-idx",
      "skillsetName" : "cog-search-demo-ss",
      "fieldMappings" : [
        {
          "sourceFieldName" : "metadata_storage_path",
          "targetFieldName" : "id",
          "mappingFunction" :
            { "name" : "base64Encode" }
        },
        {
          "sourceFieldName" : "metadata_storage_name",
          "targetFieldName" : "metadata_storage_name",
          "mappingFunction" :
            { "name" : "base64Encode" }
        },
        {
          "sourceFieldName" : "content",
          "targetFieldName" : "content"
        }
      ],
      "outputFieldMappings" :
      [
        {
          "sourceFieldName" : "/document/persons",
          "targetFieldName" : "persons"
        },
        {
          "sourceFieldName" : "/document/organizations",
          "targetFieldName" : "organizations"
        },
        {
          "sourceFieldName" : "/document/locations",
          "targetFieldName" : "locations"
        },
        {
          "sourceFieldName" : "/document/pages/*/keyPhrases/*",
          "targetFieldName" : "keyPhrases"
        },
        {
          "sourceFieldName": "/document/languageCode",
          "targetFieldName": "languageCode"
        }
      ],
      "parameters":
      {
        "maxFailedItems":-1,
        "maxFailedItemsPerBatch":-1,
        "configuration":
        {
          "dataToExtract": "contentAndMetadata",
          "parsingMode": "default",
          "firstLineContainsHeaders": false,
          "delimitedTextDelimiter": ","
        }
      }
    }
    ```

1. Отправьте запрос. Postman должен вернуть код состояния 201, подтверждающий успешную обработку. 

   Выполнение этого действия может занять несколько минут. Несмотря на то что набор данных невелик, аналитические навыки выполняют интенсивные вычисления. 

> [!NOTE]
> Создание индексатора вызывает конвейер. Если есть проблемы с получением данных, сопоставлением входных и выходных данных или порядком операций, они появятся на этом этапе. Чтобы повторно запустить конвейер с изменениями кода или скрипта, вам может потребоваться сначала удалить объекты. Дополнительные сведения см. в статье [Руководство по вызову API-интерфейсов когнитивного поиска (предварительная версия)](#reset).

#### <a name="about-indexer-parameters"></a>Сведения о параметрах индексатора

Скрипт устанавливает значение -1 для ```"maxFailedItems"```, которое инструктирует механизм индексирования игнорировать ошибки во время импорта данных. Это допустимо, так как в демонстрационном источнике данных мало документов. Для большего источника данных необходимо установить значение больше 0.

Инструкция ```"dataToExtract":"contentAndMetadata"``` указывает, что индексатор должен автоматически извлекать содержимое из файлов разных форматов вместе с метаданными, связанными с каждым файлом. 

Когда содержимое будет извлечено, вы можете установить ```imageAction``` для извлечения текста из изображений, найденных в источнике данных. Конфигурация ```"imageAction":"generateNormalizedImages"``` вместе с навыком распознавания текста и навыком объединения текста инструктирует индексатор извлекать текст из изображений (например слово "стоп" из знака остановки движения) и вставлять его как часть поля содержимого. Это относится как к изображениям, встроенным в документы (например, изображение внутри PDF-файлов), так и к изображениям, найденным в источнике данных, например к файлу JPG.

## <a name="4---monitor-indexing"></a>4\. Мониторинг индексирования

Индексирование и обогащение начинаются сразу же после отправки запроса на создание индексатора. В зависимости от того, какие когнитивные навыки вы определили, индексирование может занять некоторое время. Чтобы узнать, работает ли индексатор, отправьте следующий запрос для получения сведений о состоянии.

1. Используйте запрос **GET** и следующий URL-адрес, заменив YOUR-SERVICE-NAME фактическим именем службы, чтобы присвоить индексатору имя.

   ```http
   https://[YOUR-SERVICE-NAME].search.windows.net/indexers/cog-search-demo-idxr/status?api-version=2020-06-30
   ```

1. Проверьте ответ, чтобы узнать, работает ли индексатор, или просмотрите сведения об ошибках и предупреждениях.  

Если используется уровень "Бесплатный", вы получите следующее сообщение: Could not extract content or metadata from your document. Truncated extracted text to '32768' characters (Не удалось извлечь содержимое или метаданные из документа. Извлеченный текст усечен до 32 768 символов). Это связано с тем, что для индексирования больших двоичных объектов на уровне "Бесплатный" действует ограничение [на извлечение символов в 32 КБ](search-limits-quotas-capacity.md#indexer-limits). Это сообщение не будет отображаться для этого набора данных на более высоких уровнях. 

> [!NOTE]
> Предупреждения в некоторых сценариях считаются нормальным явлением, то есть не всегда обозначают проблему. Например, если контейнер больших двоичных объектов содержит файлы изображений, а конвейер не обрабатывает изображения, вы получите предупреждение о том, что изображения не были обработаны.

## <a name="5---search"></a>5\. Поиск

Итак, вы создали поля и сведения. Теперь давайте выполним запросы, чтобы оценить полезность Когнитивного поиска в типичном сценарии поиска.

Как вы помните, мы начали работу с содержимого большого двоичного объекта, где весь документ упакован в одно поле `content`. Вы можете выполнить поиск по этому полю и найти результаты, соответствующие вашим запросам.

1. Используйте запрос **GET** и указанный ниже URL-адрес, заменив в нем YOUR-SERVICE-NAME фактическим именем службы, чтобы найти вхождения термина или фразы. Этот запрос возвращает поле `content` и количество соответствующих документов.

   ```http
   https://[YOUR-SERVICE-NAME].search.windows.net/indexes/cog-search-demo-idx/docs?search=*&$count=true&$select=content&api-version=2020-06-30
   ```
   
   Результаты этого запроса возвращают содержимое документа. Такой же результат вы получили бы при использовании индексатора больших двоичных объектов без конвейера Когнитивного поиска. Это поле доступно для поиска, но не подходит для использования аспектов, фильтров или автозаполнения.

   ![Выходные данные поля содержимого](media/cognitive-search-tutorial-blob/content-output.png "Выходные данные поля содержимого")
   
1. Второй запрос вернет несколько новых полей, созданных конвейером (persons, organizations, locations, languageCode). Для краткости мы не используем поле keyPhrases, но если вам нужны эти значения, добавьте его.

   ```http
   https://[YOUR-SERVICE-NAME].search.windows.net/indexes/cog-search-demo-idx/docs?search=*&$count=true&$select=metadata_storage_name,persons,organizations,locations,languageCode&api-version=2020-06-30
   ```
   Поля в инструкции $select содержат новые сведения, созданные на основе функций обработки естественного языка Cognitive Services. Вполне ожидаемо, что в этих результатах есть некоторые неточности и различия между документами. Но в большинстве случаев аналитические модели возвращают точные результаты.

   На следующем изображении показаны результаты поиска открытого письма Сатья Наделла (Satya Nadella) после получения должности генерального директора в корпорации Майкрософт.

   ![Выходные данные конвейера](media/cognitive-search-tutorial-blob/pipeline-output.png "Выходные данные конвейера")

1. Чтобы изучить возможности этих полей, добавьте параметр аспекта, который будет возвращать агрегированные соответствующие документы по расположению.

   ```http
   https://[YOUR-SERVICE-NAME].search.windows.net/indexes/cog-search-demo-idx/docs?search=*&facet=locations&api-version=2020-06-30
   ``` 

   В нашем примере для каждого расположения получено два или три совпадения.

   ![Выходные данные аспекта](media/cognitive-search-tutorial-blob/facet-output.png "Выходные данные аспекта")
   

1. В нашем последнем примере вы примените фильтр к коллекции организаций, которые вернет два совпадения по данным NASDAQ с учетом критериев фильтрации.

   ```http
   https://[YOUR-SERVICE-NAME].search.windows.net/indexes/cog-search-demo-idx/docs?search=*&$filter=organizations/any(organizations: organizations eq 'NASDAQ')&$select=metadata_storage_name,organizations&$count=true&api-version=2020-06-30
   ```

Эти запросы иллюстрируют несколько способов работы с синтаксисом и фильтрами по новым полям, созданными с помощью когнитивного поиска. Дополнительные примеры запросов см. в разделах с примерами [для REST API поиска документов](/rest/api/searchservice/search-documents#bkmk_examples), [запросов с простым синтаксисом](search-query-simple-examples.md) и [запросов full Lucene](search-query-lucene-examples.md).

<a name="reset"></a>

## <a name="reset-and-rerun"></a>Сброс и повторный запуск

На ранних экспериментальных этапах разработки самый практичный подход к итерации схемы — удалить все объекты из службы "Когнитивный поиск Azure" и восстановить их с помощью кода. Имена ресурсов являются уникальными. Удаление объекта позволяет воссоздать его с использованием того же имени.

Для удаления индексов, индексаторов, источников данных и наборов навыков можно использовать портал. Когда вы удаляете индексатор, вы можете по желанию одновременно выборочно удалить индекс, набор навыков и источник данных.

![Удаление объектов поиска](./media/cognitive-search-tutorial-blob-python/py-delete-indexer-delete-all.png "Удаление объектов поиска на портале")

Или используйте **DELETE** и укажите URL-адреса для каждого объекта. Следующая команда удаляет индексатор.

```http
DELETE https://[YOUR-SERVICE-NAME].search.windows.net/indexers/cog-search-demo-idxr?api-version=2020-06-30
```

При успешном удалении возвращается код состояния 204.

## <a name="takeaways"></a>Общие выводы

В этом руководстве показаны основные шаги для построения обогащенного конвейера индексирования посредством создания компонентов: источника данных, набора навыков, индекса и индексатора.

Вы получили сведения о [встроенных навыках](cognitive-search-predefined-skills.md), а также об определении набора навыков и механизме построения цепочек навыков путем сопоставления входных и выходных данных. Вы также узнали, что `outputFieldMappings` в определении индексатора требуется для маршрутизации обогащенных значений из конвейера в индекс для поиска в службе "Когнитивный поиск Azure".

Наконец, вы узнали, как тестировать результаты и выполнять сброс системы для дальнейших итераций. Вы узнали, что отправка запросов к индексу возвращает результат, созданный обогащенным конвейером индексирования. 

## <a name="clean-up-resources"></a>Очистка ресурсов

Если вы работаете в своей подписке, после завершения проекта целесообразно удалить созданные ресурсы, которые вам больше не потребуются. Работающие ресурсы могут означать лишние затраты. Можно удалить отдельные ресурсы или удалить группу ресурсов, что позволит удалить весь набор ресурсов.

Просматривать ресурсы и управлять ими можно на портале с помощью ссылок "Все ресурсы" или "Группы ресурсов" в области навигации слева.

## <a name="next-steps"></a>Дальнейшие действия

Теперь, когда вы знакомы со всеми объектами в конвейере обогащения с помощью ИИ, давайте более подробно рассмотрим определения набора навыков и отдельные навыки.

> [!div class="nextstepaction"]
> [Создание набора навыков](cognitive-search-defining-skillset.md)
