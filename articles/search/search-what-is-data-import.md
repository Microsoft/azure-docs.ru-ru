---
title: Импорт и прием данных в индексах поиска
titleSuffix: Azure Cognitive Search
description: Заполнение и отправка данных в индекс в Azure Когнитивный поиск из внешних источников данных.
manager: nitinme
author: HeidiSteen
ms.author: heidist
ms.service: cognitive-search
ms.topic: conceptual
ms.date: 11/05/2020
ms.openlocfilehash: aa44a27fa5bf6b7b4ea649e1a9b9a69ef8cd78d3
ms.sourcegitcommit: 867cb1b7a1f3a1f0b427282c648d411d0ca4f81f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/20/2021
ms.locfileid: "102049327"
---
# <a name="data-import-overview---azure-cognitive-search"></a>Общие сведения об импорте данных в Azure Когнитивный поиск

В Когнитивный поиск Azure запросы выполняются по содержимому, загруженному и сохраненному в [индексе поиска](search-what-is-an-index.md). В этой статье рассматриваются два основных подхода к заполнению индекса: *Отправка* данных в индекс программным образом или указание [индексатора когнитивный Поиск Azure](search-indexer-overview.md) в поддерживаемом источнике данных для *извлечения* данных.

При любом подходе цель заключается в загрузке данных из внешнего источника данных в индекс Azure Когнитивный поиск. Когнитивный поиск Azure позволяет создать пустой индекс, но пока вы не отправите или запросите данные, он не будет подбираться.

> [!NOTE]
> Если [обогащение искусственного интеллекта](cognitive-search-concept-intro.md) является требованием решения, то для загрузки индекса необходимо использовать модель извлечения (индексаторы). Внешняя обработка поддерживается только через навыков, подключенный к индексатору.

## <a name="pushing-data-to-an-index"></a>Отправка данных в индекс

Модель push-уведомлений, используемая для программной отправки данных в Azure Когнитивный поиск, является самым гибким подходом. Во-первых, в этой модели нет ограничений на тип источника данных. Любой набор данных, состоящий из документов JSON, может быть отправлен в индекс Когнитивный поиск Azure, предполагая, что каждый документ в наборе данных имеет поля, сопоставленные с полями, определенными в схеме индекса. Во-вторых, в этой модели нет ограничений на частоту выполнения. Вы можете отправлять изменения в индекс с любой частотой. Для приложений с очень высокими требованиями к задержке (например, если операции поиска должны синхронизироваться с динамической учетной базой данных) можно использовать только модель передачи.

Передача является более гибким подходом, чем извлечение, поскольку документы можно передавать по одному или пакетами (не более 1000 документов и не более 16 МБ в каждом пакете). Модель push-уведомлений также позволяет отправлять документы в Когнитивный поиск Azure независимо от того, где находятся ваши данные.

### <a name="how-to-push-data-to-an-azure-cognitive-search-index"></a>Как отправлять данные в индекс Когнитивный поиск Azure

Для загрузки одного или нескольких документов в индекс можно использовать следующие API-интерфейсы:

+ [добавление, обновление и удаление документов (REST API)](/rest/api/searchservice/AddUpdate-or-Delete-Documents);
+ [класс IndexDocumentsAction](/dotnet/api/azure.search.documents.models.indexdocumentsaction) или [класс IndexDocumentsBatch](/dotnet/api/azure.search.documents.models.indexdocumentsbatch). 

Инструментов для передачи данных через портал пока не существует.

Общие сведения о каждой методологии см. в статье [Краткое руководство. Создание индекса когнитивный Поиск Azure с помощью PowerShell](./search-get-started-powershell.md) или [C#: создание индекса когнитивный Поиск для Azure с помощью пакета SDK для .NET](search-get-started-dotnet.md).

<a name="indexing-actions"></a>

### <a name="indexing-actions-upload-merge-mergeorupload-delete"></a>Индексирование действий: отправка, слияние, mergeOrUpload, удаление

Можно управлять типом действия индексирования для каждого документа, указывая, должен ли документ быть полностью передан, объединен с существующим содержимым документа или удален.

В REST API выдайте запрос HTTP POST с текстом запроса JSON в URL-адрес конечной точки индекса Azure Когнитивный поиск. Каждый объект JSON в массиве "value" содержит ключ документа и указывает, добавляется ли действие индексирования, обновляет или удаляет содержимое документа. Пример кода см. в разделе [Загрузка документов](search-get-started-dotnet.md#load-documents).

В пакете SDK для .NET упакуйте данные в `IndexBatch` объект. `IndexBatch`Инкапсулирует коллекцию `IndexAction` объектов, каждая из которых содержит документ и свойство, которое сообщает Azure когнитивный Поиск, какое действие выполнять с этим документом. Пример кода см. в [кратком руководстве по C#](search-get-started-dotnet.md).


| @search.action | Описание | Необходимые поля для каждого документа | Примечания |
| -------------- | ----------- | ---------------------------------- | ----- |
| `upload` |Операция `upload` аналогична операции upsert, которая добавляет документ, если он новый, и обновляет либо заменяет его, если он уже существует. |Поле key, а также другие поля, которые вы хотите определить. |При обновлении или замене существующего документа все поля, не указанные в запросе, получат значение `null`. Это происходит, даже если для поля указано непустое значение. |
| `merge` |Обновляет существующий документ с использованием указанных полей. Если документ не существует в индексе, объединение завершится ошибкой. |Поле key, а также другие поля, которые вы хотите определить. |Поля, указанные в запросе на объединение, заменяют собой существующие поля документа. В пакет SDK для .NET входят поля типа `DataType.Collection(DataType.String)` . В REST API сюда входят поля типа `Collection(Edm.String)` . Например, если документ содержит поле `tags` со значением `["budget"]` и вы выполняете операцию объединения со значением `["economy", "pool"]` для поля `tags`, в итоге поле `tags` примет значение `["economy", "pool"]`, а не `["budget", "economy", "pool"]`. |
| `mergeOrUpload` |Эта операция аналогична операции `merge`, если документ с указанным значением ключа уже существует в индексе. Если документа нет, эта операция выполняется так же, как и операция `upload` с новым документом. |Поле key, а также другие поля, которые вы хотите определить. |- |
| `delete` |Удаление указанного документа из индекса. |Только ключ |Все указанные поля, которые отличаются от ключевого поля, будут игнорироваться. Чтобы удалить из документа определенное поле, лучше воспользуйтесь операцией `merge`, явным образом задав для требуемого поля значение NULL. |

### <a name="formulate-your-query"></a>Формулировка запроса

Существует два способа [поиска в индексе с помощью REST API](/rest/api/searchservice/Search-Documents). Один из них — отправка HTTP-запроса POST с текстом, содержащим объект JSON, в котором определены параметры запроса. Другой способ — отправка HTTP-запроса GET, содержащего URL-адрес, в котором определены параметры запроса. Обратите внимание, что в запросе POST предусмотрены [менее жесткие ограничения](/rest/api/searchservice/Search-Documents) на размер параметров запроса, чем в запросе GET. Поэтому мы рекомендуем использовать запрос POST, за исключением особых случаев, когда удобнее использовать запрос GET.

Для POST и GET необходимо указать *имя службы*, *имя индекса* и *версию API* в URL-адресе запроса. 

Если вы используете запрос GET, его параметры указываются в *строке запроса* в конце URL-адреса. Ниже приведен формат URL-адреса.

```http
    https://[service name].search.windows.net/indexes/[index name]/docs?[query string]&api-version=2019-05-06
```

Формат записи аналогичен, но имеет значение `api-version` в параметрах строки запроса.

## <a name="pulling-data-into-an-index"></a>Извлечение данных в индекс

Модель извлечения выполняет поиск в поддерживаемом источнике данных, автоматически загружая данные в индекс. В Когнитивный поиск Azure эта возможность реализуется с помощью *индексаторов*, которые в настоящее время доступны для этих платформ:

+ [Хранилище BLOB-объектов](search-howto-indexing-azure-blob-storage.md)
+ [Хранилище таблиц](search-howto-indexing-azure-tables.md)
+ [Azure Cosmos DB](search-howto-index-cosmosdb.md)
+ [База данных SQL Azure, SQL Управляемый экземпляр и SQL Server на виртуальных машинах Azure](search-howto-connecting-azure-sql-database-to-azure-search-using-indexers.md)
+ [SharePoint Online (предварительная версия)](search-howto-index-sharepoint-online.md)
+ [Azure Data Lake Storage 2-го поколения (предварительная версия)](search-howto-index-azure-data-lake-storage.md)

Индексаторы подключают индекс к источнику данных (как правило, это таблица, представление или эквивалентная структура) и сопоставляют поля источника с эквивалентными полями в индексе. Во время выполнения набор строк автоматически преобразуется в формат JSON и загружается в указанный индекс. Все индексаторы поддерживают планирование, так что вы можете указать частоту обновления данных. Большинство индексаторов позволяют отслеживать изменения, если источник данных поддерживает такую возможность. Отслеживая процессы изменения и удаления существующих документов, помимо распознания новых документов, индексаторы исключают необходимость в активном управлении данными в индексе.

### <a name="how-to-pull-data-into-an-azure-cognitive-search-index"></a>Извлечение данных в индекс Когнитивный поиск Azure

Индексатор доступен на [портале Azure](search-import-data-portal.md), в интерфейсе [REST API](/rest/api/searchservice/Indexer-operations) и в [пакете SDK для .NET](/dotnet/api/azure.search.documents.indexes.searchindexerclient).

Преимуществом использования портала является то, что Azure Когнитивный поиск может создать схему индекса по умолчанию, прочитав метаданные исходного набора данных. Можно изменить создаваемый индекс до его обработки, после чего будут разрешены только те изменения схемы, которые не требуют повторного индексирования. Если вносимые изменения непосредственно влияют на схему, вам потребуется повторно создать индекс. 

## <a name="verify-data-import-with-search-explorer"></a>Проверка импорта данных с помощью проводника поиска

Чтобы быстро выполнить предварительную проверку при отправке документа, используйте **Обозреватель поиска** на портале. Проводник позволяет создавать запросы к индексу без необходимости писать код. Поисковый интерфейс основан на параметрах по умолчанию, таких как [простой синтаксис](/rest/api/searchservice/simple-query-syntax-in-azure-search) и [параметр запроса searchMode](/rest/api/searchservice/search-documents)по умолчанию. Результаты возвращаются в формате JSON, позволяя проверить весь документ.

> [!TIP]
> Многочисленные [примеры кода когнитивный Поиск Azure](https://github.com/Azure-Samples/?utf8=%E2%9C%93&query=search) включают в себя встроенные или готовые наборы данных, предлагающие простой способ начать работу. На портале также доступен пример индексатора и источника данных, представленного небольшим набором данных, связанных с недвижимостью (realestate-us-sample). При запуске предварительно настроенного индексатора с примером источника данных создается и загружается индекс с документами. Затем вы можете создать запрос к этому индексу, используя проводник поиска или программные средства.

## <a name="see-also"></a>См. также раздел

+ [Обзор индексатора](search-indexer-overview.md)
+ [Руководство по созданию первого индекса службы поиска Azure на портале](search-get-started-portal.md)