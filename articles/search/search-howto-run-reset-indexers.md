---
title: Выполнение или сброс индексаторов
titleSuffix: Azure Cognitive Search
description: Сброс индексатора, навыков или отдельных документов для обновления всей базы данных или ее части, а также индекса или хранилища знаний.
author: HeidiSteen
manager: nitinme
ms.author: heidist
ms.service: cognitive-search
ms.topic: conceptual
ms.date: 02/09/2021
ms.openlocfilehash: bf8a4e51e23f438265af706914a6bc73ec30f64d
ms.sourcegitcommit: b4647f06c0953435af3cb24baaf6d15a5a761a9c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/02/2021
ms.locfileid: "101667657"
---
# <a name="how-to-run-or-reset-indexers-skills-or-documents"></a>Запуск и сброс индексаторов, навыков и документов

Выполнение индексатора может произойти при первом создании [индексатора](search-indexer-overview.md), при выполнении индексатора по требованию или при задании индексатора по расписанию. После первоначального запуска индексатор отслеживает, какие документы поиска были проиндексированы с помощью внутренней «высокой» маркировки. Маркер никогда не отображается в API, но внутренний индексатор знает, где индексирование остановлено, чтобы его можно было использовать при следующем запуске.

Вы можете очистить верхнюю подложку, переустановив индексатор, если хотите выполнить повторную обработку с нуля. API-интерфейсы сброса доступны на убывающем уровне иерархии объектов:

+ Совокупности поиска целиком (используйте [индексаторы сброса](#reset-indexers))
+ Конкретный документ или список документов (использование [сброса документов — Предварительная версия](#reset-docs))
+ Конкретный навык или обогащение в документе (использование [сброса навыков — Предварительная версия](#reset-skills))

API-интерфейсы сброса используются для обновления кэшированного содержимого (применимо в сценариях [обогащения искусственного интеллекта](cognitive-search-concept-intro.md) ) или для очистки верхнего знака воды и перестроения индекса.

Сброс с последующим запуском может привести к повторной обработке существующих документов и новых документов, но не удаляет потерянные документы поиска в индексе поиска, которые были созданы при выполнении предыдущих запусков. Дополнительные сведения об удалении см. в разделе [Добавление, обновление или удаление документов](/rest/api/searchservice/addupdate-or-delete-documents).

## <a name="run-indexers"></a>Запуск индексаторов

[CREATE индексатор](/rest/api/searchservice/create-indexer) создает и запускает индексатор, если он не создан в отключенном состоянии ("Disabled": true). Первый запуск занимает немного времени, так как он также создает объект покрытия.

[Индексатор запуска](/rest/api/searchservice/run-indexer) обнаружит и обработает только то, что необходимо для синхронизации индекса поиска с источником данных. Хранилище BLOB-объектов имеет встроенное обнаружение изменений. Другие источники данных, такие как Azure SQL или Cosmos DB, должны быть настроены для обнаружения изменений, прежде чем индексатор сможет считывать только новые и обновленные строки.

Индексатор можно запустить с помощью любого из следующих подходов:

+ Портал Azure с помощью команды **Run** на странице индексатора
+ [Запуск индексатора (остальное)](/rest/api/searchservice/run-indexer)
+ [Метод руниндексерс](/dotnet/api/azure.search.documents.indexes.searchindexerclient.runindexer) в пакете SDK для Azure .NET (или использование эквивалентного метода руниндексер в другом пакете SDK)

Выполнение индексатора подчиняется следующим ограничениям:

+ Максимальное число заданий индексатора равно 1 для одной реплики без параллельных заданий.

  Если выполнение индексатора уже находится на емкости, вы получите это уведомление: "не удалось запустить индексатор" <индексатор-имя> ", ошибка:" выполняется другой вызов индексатора; одновременные вызовы запрещены».

+ Максимальное время выполнения составляет 2 часа при использовании набора навыков и 24 часа без. 

  Можно растянуть обработку, поместив индексатор по расписанию. Уровень Free имеет меньшее ограничение времени выполнения. Полный список см. в разделе [ограничения индексатора](search-limits-quotas-capacity.md#indexer-limits)

<a name="reset-indexers"></a>

## <a name="reset-an-indexer"></a>Сброс индексатора

Сброс индексатора включается. В индексе поиска все документы поиска, первоначально заполненные индексатором, помечаются для полной обработки. При обнаружении новых документов базовый источник будет добавлен в индекс в качестве поисковых документов. Если в индексаторе настроено использование набора навыков и [кэширования](search-howto-incremental-index.md), то набор навыков перезапускается и кэш обновляется.

Вы можете сбросить индексатор с помощью любого из этих подходов, а затем выполнить индексатор, используя один из описанных выше методов.

+ Портал Azure с помощью команды **Reset** на странице индексатора
+ [Сброс индексатора (остальное)](/rest/api/searchservice/reset-indexer)
+ [Метод ресетиндексерс](/dotnet/api/azure.search.documents.indexes.searchindexerclient.resetindexer) в пакете SDK для Azure .NET (или использование эквивалентного метода руниндексер в другом пакете SDK)

После завершения выполнения снимается флажок сброса. Любая обычная логика обнаружения изменений, действующая для источника данных, будет возобновлена при следующем запуске, при этом будут выбраны новые или обновленные значения в оставшейся части набора данных.

> [!NOTE]
> Запрос на сброс определяет, что переобрабатывается (индексатор, навык или документ), но не влияет на поведение времени выполнения индексатора. Если индексатор имеет параметры времени выполнения, сопоставления полей, кэширование, Параметры пакетной службы и т. д., все эти параметры действуют при запуске индексатора после его сброса.

<a name="reset-skills"></a>

## <a name="reset-skills-preview"></a>Сбросить навыки (Предварительная версия)

> [!IMPORTANT] 
> Дополнительные [навыки](/rest/api/searchservice/preview-api/reset-skills) доступны в общедоступной предварительной версии, доступной только в предварительной версии REST API. Предварительные версии функций предлагаются "как есть" в [дополнительных условиях использования](https://azure.microsoft.com/support/legal/preview-supplemental-terms/).

Для индексаторов, имеющих навыков, можно сбросить определенные навыки для принудительной обработки этого навыка и всех нижестоящих навыков, зависящих от выходных данных. Также обновляются [кэшированные дополнения](search-howto-incremental-index.md) . Сброс навыков делает недействительными кэшированные результаты навыков, что полезно при развертывании новой версии навыка и необходимости повторного запуска этого навыка для всех документов в индексаторе. 

[Сбросить навыки](/rest/api/searchservice/preview-api/reset-skills) можно с помощью остальных компонентов **`api-version=2020-06-30-Preview`** .

```http
POST https://[service name].search.windows.net/skillsets/[skillset name]/resetskills?api-version=2020-06-30-Preview
{
    "skillNames" : [
        "#1",
        "#5",
        "#6"
    ]
}
```

Вы можете указать отдельные навыки, как указано в приведенном выше примере, но если какой-либо из этих навыков требует выхода из непредусмотренных навыков (#2 с помощью #4), то будут выполняться неопределенные навыки, если только кэш не предоставит необходимые сведения. Чтобы это было истинно, кэшированные дополнения для навыков #2 с помощью #4 не должны иметь зависимости от #1 (перечислены для сброса).

Если уровни опыта не указаны, выполняется весь набор навыков и, если кэширование включено, кэш также обновляется.

<a name="reset-docs"></a>

## <a name="reset-docs-preview"></a>Сброс документов (Предварительная версия)

> [!IMPORTANT] 
> [Сброс документов](/rest/api/searchservice/preview-api/reset-documents) находится в общедоступной предварительной версии, доступном только в предварительной версии REST API. Предварительные версии функций предлагаются "как есть" в [дополнительных условиях использования](https://azure.microsoft.com/support/legal/preview-supplemental-terms/).

[API сброса документов](/rest/api/searchservice/preview-api/reset-documents) принимает список ключей документов, чтобы можно было обновлять определенные документы. Если этот параметр задан, параметры сброса становятся единственным определителем обрабатываемого объекта, независимо от других изменений в базовых данных. Например, если 20 BLOB-объектов были добавлены или обновлены с момента запуска последнего индексатора, но только один документ был сброшен, будет обработан только один документ.

Для каждого документа все поля в этом документе поиска обновляются значениями из источника данных. Вы не можете выбрать поля для обновления. 

Если документ дополнен набором навыков и содержит кэшированные данные, набор навыков вызывается только для указанных документов, а кэширование обновляется для повторно обработанных документов.

При первом тестировании этого API следующие API помогут проверить и протестировать поведение:

+ [Получение состояния индексатора](/rest/api/searchservice/get-indexer-status) с версией API `2020-06-30-Preview` для проверки состояния сброса и состояния выполнения. Сведения о запросе на сброс можно найти в конце ответа о состоянии.
+ [Сброс документов](/rest/api/searchservice/preview-api/reset-documents) с использованием версии API `2020-06-30-Preview` для указания документов для обработки.
+ [Запуск](/rest/api/searchservice/run-indexer) индексатора для запуска индексатора (любая версия API).
+ [Поиск в документах](/rest/api/searchservice/search-documents) , чтобы проверить наличие обновленных значений, а также возврат ключей документа, если вы не уверены в значении. Используйте, `"select": "<field names>"` Если нужно ограничить поля, отображаемые в ответе.

### <a name="formulate-and-send-the-reset-request"></a>Формулировка и отправка запроса на сброс

```http
POST https://[service name].search.windows.net/indexers/[indexer name]/resetdocs?api-version=2020-06-30-Preview
{
    "documentKeys" : [
        "1001",
        "4452"
    ]
}
```

Ключи документов, указанные в запросе, — это значения из индекса поиска, которые могут отличаться от соответствующих полей в источнике данных. Если вы не уверены в значении ключа, [отправьте запрос](search-query-create.md) для возврата значения. Можно использовать `select` , чтобы вернуть только поле ключа документа.

Для больших двоичных объектов, которые анализируются в нескольких документах поиска (например, если в качестве режима синтаксического анализа используется [жсонлинес или жсонаррайс](search-howto-index-json-blobs.md)или [delimitedText](search-howto-index-csv-blobs.md)), ключ документа создается индексатором и может быть неизвестным. В этом случае запрос для ключа документа будет Instrumental при предоставлении правильного значения.

Многократный вызов API с разными ключами добавляет новые ключи в список ключей документа, сброшенных. Вызов API с **`overwrite`** параметром, имеющим значение true, приведет к перезаписи текущего списка ключей документа, которые будут сброшены с помощью полезных данных запроса:

```http
POST https://[service name].search.windows.net/indexers/[indexer name]/resetdocs?api-version=2020-06-30-Preview
{
    "documentKeys" : [
        "200",
        "630"
    ],
    "overwrite": true
}
```

## <a name="check-reset-status"></a>Проверить состояние сброса

Чтобы проверить состояние сброса и узнать, какие ключи документа ставятся в очередь для обработки, используйте параметр [получить состояние индексатора](/rest/api/searchservice/get-indexer-status) с помощью **`api-version=06-30-2020-Preview`** . API предварительной версии вернет **`currentState`** раздел, который можно найти в конце ответа "получение состояния индексатора".

"Mode" будет использоваться **`indexingAllDocs`** для сброса навыков (так как потенциально все документы затрагиваются, для полей, заполняемых через обогащение искусственного интеллекта).

Для сброшенных документов режим имеет значение **`indexingResetDocs`** . Индексатор оставляет это состояние до тех пор, пока не будут обработаны все ключи документа, предоставленные в вызове сброса документов, и никакие другие задания индексатора не смогут выполняться во время выполнения операции. Поиск всех документов в списке ключей документов требует взлома каждого документа для поиска и сопоставления по ключу. это может занять некоторое время, если набор данных имеет большой размер. Если контейнер больших двоичных объектов содержит сотни больших двоичных объектов, а документы, которые нужно сбросить, находятся в конце, индексатор не будет искать совпадающие большие двоичные объекты до тех пор, пока все остальные не будут проверены первыми.

```json
"currentState": {
    "mode": "indexingResetDocs",
    "allDocsInitialTrackingState": "{\"LastFullEnumerationStartTime\":\"2021-02-06T19:02:07.0323764+00:00\",\"LastAttemptedEnumerationStartTime\":\"2021-02-06T19:02:07.0323764+00:00\",\"NameHighWaterMark\":null}",
    "allDocsFinalTrackingState": "{\"LastFullEnumerationStartTime\":\"2021-02-06T19:02:07.0323764+00:00\",\"LastAttemptedEnumerationStartTime\":\"2021-02-06T19:02:07.0323764+00:00\",\"NameHighWaterMark\":null}",
    "resetDocsInitialTrackingState": null,
    "resetDocsFinalTrackingState": null,
    "resetDocumentKeys": [
        "200",
        "630"
    ]
}
```

После повторной обработки документов индексатор возвращается в **`indexingAllDocs`** режим и будет обрабатывать любые другие новые или обновленные документы при следующем запуске.

## <a name="next-steps"></a>Дальнейшие действия

API-интерфейсы сброса используются для информирования об области выполнения следующего индексатора. Для фактической обработки необходимо вызвать выполнение индексатора по запросу или разрешить запланированное задание завершить работу. После завершения выполнения индексатор возвращается к нормальной обработке, независимо от того, находится ли оно по расписанию или при обработке по требованию.

После сброса и повторного запуска заданий индексатора можно отслеживать состояние службы поиска или получать подробные сведения с помощью журнала диагностики.

+ [Операции индексатора (остальные)](/rest/api/searchservice/indexer-operations)
+ [Мониторинг состояния индексатора поиска](search-howto-monitor-indexers.md)
+ [Собирайте и анализируйте данные журнала](search-monitor-logs.md)
+ [Планирование индексатора](search-howto-schedule-indexers.md)