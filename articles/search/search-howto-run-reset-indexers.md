---
title: Выполнение или сброс индексаторов
titleSuffix: Azure Cognitive Search
description: Сброс индексатора, навыков или отдельных документов для обновления всей базы данных или ее части, а также индекса или хранилища знаний.
author: HeidiSteen
manager: nitinme
ms.author: heidist
ms.service: cognitive-search
ms.topic: conceptual
ms.date: 02/09/2021
ms.openlocfilehash: bf8a4e51e23f438265af706914a6bc73ec30f64d
ms.sourcegitcommit: f28ebb95ae9aaaff3f87d8388a09b41e0b3445b5
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/29/2021
ms.locfileid: "101667657"
---
# <a name="how-to-run-or-reset-indexers-skills-or-documents"></a>В этой статье рассказывается, как выполнять запуск или сброс индексаторов, навыков и документов

Необходимость в запуске индексатора может возникать при первом создании [индексатора](search-indexer-overview.md), в случае, когда запуск индексатора происходит по требованию или при настройке работы индексатора по расписанию. После первоначального запуска индексатор отслеживает, какие документы поиска были проиндексированы с помощью внутренней "предельной отметки". Эта отметка никогда не отображается в API-интерфейсе, но на внутреннем уровне индексатор знает, где было остановлено индексирование, чтобы его можно было возобновить с этого места при следующем запуске.

Вы можете очистить предельную отметку, выполнив сброс индексатора, если хотите выполнить повторную обработку с самого начала. API-интерфейсы сброса доступны на более низких уровнях в иерархии объектов:

+ Полная совокупность поисковых данных (используйте [Сброс индексаторов](#reset-indexers))
+ Конкретный документ или список документов (используйте [Сброс документов — предварительная версия](#reset-docs))
+ Конкретный навык или обогащение в документе (используйте [Сброс навыков — предварительная версия](#reset-skills))

API-интерфейсы сброса используются для обновления кэшированного содержимого (применимо в сценариях [Обогащения искусственного интеллекта](cognitive-search-concept-intro.md)) или для очистки предельной отметки и перестроения индекса.

Сброс с последующим запуском может привести к повторной обработке существующих документов и новых документов, но не удаляет потерянные поисковые документы из индекса поиска, который был создан при предыдущих запусках. Дополнительные сведения см. в статье [Добавление, обновление и удаление документов](/rest/api/searchservice/addupdate-or-delete-documents).

## <a name="run-indexers"></a>Запуск индексаторов

Команда [Создать индексатор](/rest/api/searchservice/create-indexer) выполняет создание и запуск индексатора, если только не указано его создание с состоянием "disabled (отключено)" ("disabled": true). Первый запуск занимает чуть более продолжительное время, так как при этом создается также объект покрытия.

Команда [Запуск индексатора](/rest/api/searchservice/run-indexer) выполняет обнаружение и обработку только тех данных, которые нужны для синхронизации поискового индекса с источником данных. У хранилища BLOB-объектов имеется встроенная функция обнаружения изменений. Другие источники данных, такие как Azure SQL или Cosmos DB, должны быть настроены так, чтобы обнаруживать изменения до того, как индексатор сможет считывать только новые и обновленные строки.

Выполнить запуск индексатора можно при реализации любого из следующих подходов:

+ На портале Azure на странице индексатора с помощью команды **Запустить**
+ [Запуск индексатора (REST)](/rest/api/searchservice/run-indexer)
+ [Метод RunIndexers](/dotnet/api/azure.search.documents.indexes.searchindexerclient.runindexer) в пакете .NET SDK для Azure (или путем использования метода, эквивалентного RunIndexer, из другого пакета SDK)

При выполнении у индексатора имеются следующим ограничения.

+ Максимальное число заданий индексатора равно 1 для одной реплики, параллельные задания отсутствуют.

  Если при выполнении индексатора достигнуто предельно допустимое значение, вы получите следующие уведомления: "Не удалось запустить индексатор", ошибка: "Выполняется другой вызов индексатора; одновременные вызовы запрещены".

+ Максимальное время выполнения составляет 2 часа при использовании набора навыков и 24 часа без такого набора. 

  Обработку можно продлить, организовав работу индексатора по расписанию. Для уровня Free предусмотрено более короткое по продолжительности ограничение времени выполнения. С полным списком можно ознакомиться в разделе [Ограничения индексатора](search-limits-quotas-capacity.md#indexer-limits)

<a name="reset-indexers"></a>

## <a name="reset-an-indexer"></a>Сброс индексатора

Сброс индексатора является всеохватывающим. В поисковом индексе все документы поиска, первоначально заполненные индексатором, помечаются для полной обработки. При обнаружении новых документов базовый источник добавляется в индекс в качестве поисковых документов. Если в индексаторе настроено использование набора навыков и [кэширования](search-howto-incremental-index.md), то набор навыков перезапускается и кэш обновляется.

Вы можете сбросить индексатор с помощью любого из указанных подходов, а затем выполнить запуск индексатора, используя один из описанных выше методов.

+ На портале Azure на странице индексатора с помощью команды **Сброс**
+ [Сброс индексатора (REST)](/rest/api/searchservice/reset-indexer)
+ [Метод ResetIndexers](/dotnet/api/azure.search.documents.indexes.searchindexerclient.resetindexer) в пакете .NET SDK для Azure (или путем использования метода, эквивалентного ResetIndexers, из другого пакета SDK)

При завершении выполнения флажок сброса снимается. Любая логика периодического обнаружения изменений в источнике данных возобновляет работу при следующем запуске, при этом будут выбираться любые другие новые или обновленные значения из оставшейся части набора данных.

> [!NOTE]
> Запрос на сброс определяет, что будет обрабатываться повторно (индексатор, навык или документ), но не влияет на поведение индексатора в процессе выполнения. Если у индексатора имеются параметры рабочего процесса, сопоставления полей, кэширования, параметры пакета и т. д., все эти параметры остаются действующими при запуске индексатора после его сброса.

<a name="reset-skills"></a>

## <a name="reset-skills-preview"></a>Сброс навыков (предварительная версия)

> [!IMPORTANT] 
> Функция [Сброс навыков](/rest/api/searchservice/preview-api/reset-skills) имеет статус предварительной версии и доступна только посредством предварительной версии API-интерфейса REST. Предварительные версии функций предоставляются по принципу "как есть" в соответствии с [Дополнительными условиями использования](https://azure.microsoft.com/support/legal/preview-supplemental-terms/).

Для индексаторов с наборами навыков можно сбросить определенные навыки, чтобы выполнить принудительную обработку этих навыков и всех нижестоящих навыков, зависящих от результатов этой операции. [Кэшированные обогащения](search-howto-incremental-index.md) также обновляются. При сбросе навыков кэшированные результаты навыков становятся недействительными, что полезно при развертывании новой версии навыка и при необходимости повторного запуска этого навыка для всех документов в индексаторе. 

[Сброс навыков](/rest/api/searchservice/preview-api/reset-skills) доступен посредством REST **`api-version=2020-06-30-Preview`** .

```http
POST https://[service name].search.windows.net/skillsets/[skillset name]/resetskills?api-version=2020-06-30-Preview
{
    "skillNames" : [
        "#1",
        "#5",
        "#6"
    ]
}
```

Вы можете указать отдельные навыки, как продемонстрировано в приведенном выше примере, но если для какого-либо из этих навыков потребуется результат отсутствующих в списке навыков (с #2 до #4), то будут выполняться отсутствующие в списке навыки, если только кэш не предоставит необходимые сведения. Чтобы это осуществилось, кэшированные обогащения для навыков с #2 по #4 не должны зависеть от #1 (указан для сброса).

Если никаких навыков не указано, выполняется весь набор навыков и, если кэширование включено, кэш также обновляется.

<a name="reset-docs"></a>

## <a name="reset-docs-preview"></a>Сброс документов (предварительная версия)

> [!IMPORTANT] 
> Функция [Сброс документов](/rest/api/searchservice/preview-api/reset-documents) имеет статус предварительной версии и доступна только посредством предварительной версии API-интерфейса REST. Предварительные версии функций предоставляются по принципу "как есть" в соответствии с [Дополнительными условиями использования](https://azure.microsoft.com/support/legal/preview-supplemental-terms/).

[API сброса документов](/rest/api/searchservice/preview-api/reset-documents) принимает список ключей документов, чтобы можно было обновлять определенные документы. При указании параметров сброса они становятся единственным определителем обрабатываемого объекта, независимо от других изменений в базовых данных. Например, если 20 BLOB-объектов было добавлено или обновлено с момента последнего запуска индексатора, но сброшен был только один документ, обрабатываться будет только один документ.

При реализации принципа работы, основанного на документах, все поля в этом поисковом документе обновляются значениями из источника данных. Вы не можете выбирать поля для обновления. 

Если документ обогащен набором навыков и содержит кэшированные данные, набор навыков вызывается только для указанных документов, а кэшированные данные обновляются для повторно обработанных документов.

При первом тестировании этого API-интерфейса следующие API-интерфейсы могут быть полезными для оценки и проверки его работы:

+ [Получение состояния индексатора](/rest/api/searchservice/get-indexer-status) с версией API-интерфейса `2020-06-30-Preview` — позволяет проверить состояние сброса и состояние выполнения. Сведения о запросе на сброс можно найти в конце ответа о состоянии.
+ [Сброс документов](/rest/api/searchservice/preview-api/reset-documents) с использованием API-интерфейса версии `2020-06-30-Preview` — позволяет указывать документы для обработки.
+ [Запуск индексатора](/rest/api/searchservice/run-indexer) — для запуска индексатора (любая версия API-интерфейса).
+ [Поиск в документах](/rest/api/searchservice/search-documents) — позволяет проверить наличие обновленных значений, а также возвращает ключи документов, если имеются сомнения в достоверности значений. Используйте `"select": "<field names>"`, если нужно ограничить поля, отображаемые в ответе.

### <a name="formulate-and-send-the-reset-request"></a>Формулировка и отправка запроса на сброс

```http
POST https://[service name].search.windows.net/indexers/[indexer name]/resetdocs?api-version=2020-06-30-Preview
{
    "documentKeys" : [
        "1001",
        "4452"
    ]
}
```

Ключи документов, указанные в запросе, — это значения из поискового индекса, которые могут отличаться от соответствующих полей в источнике данных. Если вы не уверены в значении ключа, [отправьте запрос](search-query-create.md) для возврата определенного значения. Можно использовать `select`, чтобы был выполнен возврат только поля ключа документа.

Для BLOB-объектов, которые анализируются в нескольких документах поиска (например, если в качестве режима синтаксического анализа используется [jsonLines или jsonArrays](search-howto-index-json-blobs.md) или [delimitedText](search-howto-index-csv-blobs.md)), ключ документа создается индексатором и может быть неизвестным пользователю. В таком случае запрос для ключа документа будет выступать в качестве инструмента для предоставления правильного значения.

В результате многократного вызова API-интерфейса с разными ключами новые ключи добавляются в список сброса ключей документа. Вызов API с параметром **`overwrite`** , имеющим значение "true", приводит к перезаписи текущего списка ключей документа, которые сбрасываются с помощью полезных данных запроса:

```http
POST https://[service name].search.windows.net/indexers/[indexer name]/resetdocs?api-version=2020-06-30-Preview
{
    "documentKeys" : [
        "200",
        "630"
    ],
    "overwrite": true
}
```

## <a name="check-reset-status"></a>Проверка состояния сброса

Чтобы проверить состояние сброса и узнать, какие ключи документа поставлены в очередь для обработки, используйте операцию [Получить состояние индексатора](/rest/api/searchservice/get-indexer-status) с **`api-version=06-30-2020-Preview`** . API предварительной версии возвращает раздел **`currentState`** , который можно найти в конце ответного сообщения для операции "Получение состояния индексатора".

"Режим" будет иметь значение **`indexingAllDocs`** для сброса навыков (так как потенциально затрагиваются все документы, это справедливо для полей, заполняемых через обогащение искусственного интеллекта).

Для сброшенных документов режим имеет значение **`indexingResetDocs`** . Индексатор остается в этом состоянии до тех пор, пока не будут обработаны все ключи документа, имеющиеся в вызове сброса документов, и никакие другие задания индексатора не смогут выполняться во время выполнения этой операции. При поиске всех документов в списке ключей документов требуется анализ каждого документа для выполнения поиска и сопоставления по ключу. На это может понадобиться некоторое время, если у набора данных большой объем. Если в контейнере BLOB-объектов содержится несколько сотен больших двоичных объектов, а документы, которые нужно сбросить, находятся в конце, индексатор не будет искать совпадающие BLOB-объекты до тех пор, пока сначала не будет проверено все остальное.

```json
"currentState": {
    "mode": "indexingResetDocs",
    "allDocsInitialTrackingState": "{\"LastFullEnumerationStartTime\":\"2021-02-06T19:02:07.0323764+00:00\",\"LastAttemptedEnumerationStartTime\":\"2021-02-06T19:02:07.0323764+00:00\",\"NameHighWaterMark\":null}",
    "allDocsFinalTrackingState": "{\"LastFullEnumerationStartTime\":\"2021-02-06T19:02:07.0323764+00:00\",\"LastAttemptedEnumerationStartTime\":\"2021-02-06T19:02:07.0323764+00:00\",\"NameHighWaterMark\":null}",
    "resetDocsInitialTrackingState": null,
    "resetDocsFinalTrackingState": null,
    "resetDocumentKeys": [
        "200",
        "630"
    ]
}
```

После повторной обработки документов индексатор возвращается в режим **`indexingAllDocs`** и при следующем запуске будет обрабатывать любые другие новые или обновленные документы.

## <a name="next-steps"></a>Дальнейшие действия

API-интерфейсы сброса используются для предоставления информации об области следующего выполнения индексатора. Для фактической обработки необходимо инициировать выполнение индексатора по запросу или разрешить запланированному заданию завершить работу. После завершения выполнения индексатор возвращается к нормальной обработке, независимо от того, осуществляется ли она по расписанию или по требованию.

После сброса и повторного запуска заданий индексатора отслеживать состояние службы поиска или получать подробные сведения можно с помощью журнала диагностики.

+ [Операции индексатора (REST)](/rest/api/searchservice/indexer-operations)
+ [Мониторинг состояния индексатора поиска](search-howto-monitor-indexers.md)
+ [Сбор и анализ данных журналов](search-monitor-logs.md)
+ [Планирование индексатора](search-howto-schedule-indexers.md)