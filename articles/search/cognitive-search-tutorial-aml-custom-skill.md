---
title: Пример созданию и развертыванию настраиваемого навыка с помощью службы "Машинное обучение Azure"
titleSuffix: Azure Cognitive Search
description: В этом примере показано, как использовать Машинное обучение Azure для создания и развертывания настраиваемого навыка для конвейера обогащения с помощью ИИ в Когнитивном поиске Azure.
manager: nitinme
author: HeidiSteen
ms.author: heidist
ms.service: cognitive-search
ms.topic: conceptual
ms.date: 09/25/2020
ms.openlocfilehash: 98d8395236bf955eed88f36c03c96981fa0e4b6b
ms.sourcegitcommit: f28ebb95ae9aaaff3f87d8388a09b41e0b3445b5
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/29/2021
ms.locfileid: "98745639"
---
# <a name="example-build-and-deploy-a-custom-skill-with-azure-machine-learning"></a>Пример созданию и развертыванию настраиваемого навыка с помощью службы "Машинное обучение Azure" 

В этом примере рассказывается о том, как с помощью Машинного обучения Azure создать [настраиваемый навык](./cognitive-search-aml-skill.md) для извлечения аспектной тональности из [набора данных с отзывами об отеле](https://www.kaggle.com/datafiniti/hotel-reviews) (распространяется по лицензии Creative Commons [CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/legalcode.txt)). Это позволит правильно назначать положительные и отрицательные тональности определенным сущностям, например персоналу, номеру, холлу или бассейну, в пределах одного отзыва.

Для обучения аспектной модели тональности в службе "Машинное обучение Azure" вы будете использовать [репозиторий рецептов NLP](https://github.com/microsoft/nlp-recipes/tree/master/examples/sentiment_analysis/absa). Затем модель будет развернута в качестве конечной точки в кластере Azure Kubernetes. После развертывания конечная точка добавляется в конвейер обогащения в качестве навыка Машинного обучения Azure для использования службой "Когнитивный поиск".

В этом сценарии предоставляется два набора данных. Если вы хотите самостоятельно обучить модель, потребуется файл hotel_reviews_1000.csv. Хотите пропустить шаг обучения? Скачайте файл hotel_reviews_100.csv.

> [!div class="checklist"]
> * Создание экземпляра службы "Когнитивный поиск Azure"
> * Создание рабочей области Машинного обучения Azure (служба поиска и рабочая область должны находиться в одной подписке)
> * Обучение и развертывание модели в кластере Azure Kubernetes
> * Связывание конвейера обогащения с помощью ИИ с развернутой моделью
> * Прием выходных данных из развернутой модели в качестве настраиваемого навыка

> [!IMPORTANT] 
> Этот навык сейчас находится на этапе общедоступной предварительной версии. Для предварительной версии функции соглашение об уровне обслуживания не предусмотрено. Мы не рекомендуем использовать ее в рабочей среде. Дополнительные сведения см. в статье [Дополнительные условия использования предварительных выпусков Microsoft Azure](https://azure.microsoft.com/support/legal/preview-supplemental-terms/). Пакет SDK для .NET сейчас не поддерживается.

## <a name="prerequisites"></a>Предварительные требования

* Подписка Azure (получите [бесплатную подписку](https://azure.microsoft.com/free/?WT.mc_id=A261C142F))
* [Служба "Когнитивный поиск Azure"](./search-get-started-arm.md)
* [Ресурсы Cognitive Services](../cognitive-services/cognitive-services-apis-create-account.md?tabs=multiservice%2cwindows)
* [Учетная запись хранения Azure](../storage/common/storage-account-create.md?tabs=azure-portal&toc=%2fazure%2fstorage%2fblobs%2ftoc.json)
* [Рабочая область машинного обучения Azure](../machine-learning/how-to-manage-workspace.md)

## <a name="setup"></a>Настройка

* Клонируйте или скачайте содержимое [примера репозитория](https://github.com/Azure-Samples/azure-search-python-samples/tree/master/AzureML-Custom-Skill).
* Извлеките содержимое, если оно скачано в виде ZIP-файла. Убедитесь, что файлы доступны для чтения и записи.
* При настройке учетных записей и служб Azure копируйте имена и ключи в легкодоступный текстовый файл. Имена и ключи будут добавлены в первую ячейку записной книжки, в которой определены переменные для доступа к службам Azure.
* Если вы не знакомы со службой "Машинное обучение Azure" и ее требованиями, перед началом работы вам, возможно, следует ознакомиться с перечисленными ниже документами.
 * [Настройка среды разработки для Машинного обучения Azure](../machine-learning/how-to-configure-environment.md)
 * [Создание рабочих областей Машинного обучения Azure и управление ими с помощью портала Azure](../machine-learning/how-to-manage-workspace.md)
 * Чтобы легко и быстро приступить к работе при настройке среды разработки для Машинного обучения Azure, рекомендуется использовать [облачную вычислительную операцию](../machine-learning/how-to-configure-environment.md#compute-instance).
* Отправьте файл набора данных в контейнер в учетной записи хранения. Если вы хотите настроить обучение в записной книжке, потребуется файл большего размера. Если вы предпочитаете пропустить этап обучения, рекомендуется использовать файл меньшего размера.

## <a name="open-notebook-and-connect-to-azure-services"></a>Открытие записной книжки и подключение к службам Azure

1. Укажите в первой ячейке все необходимые сведения о переменных, которые будут разрешать доступ к службам Azure, и выполните эту ячейку.
1. При выполнении второй ячейки будет подтверждено, что вы подключились к службе поиска для вашей подписки.
1. Разделы 1.1–1.5 используются для создания хранилища данных службы поиска, набора навыков, индекса и индексатора.

На этом этапе можно пропустить шаги по созданию набора данных для обучения и эксперимента в Машинном обучении Azure и сразу же перейти к регистрации двух моделей, предоставленных в папке моделей репозитория GitHub. Если вы пропускаете эти действия, перейдите в записной книжке к разделу 3.5, который используется для написания скрипта оценки. Это позволит сэкономить время. Для завершения скачивания и отправки данных может потребоваться до 30 минут.

## <a name="creating-and-training-the-models"></a>Создание и обучение моделей

Раздел 2 содержит шесть ячеек, которые используются для скачивания файла внедрений Glove из репозитория рецептов NLP. После скачивания файл загружается в хранилище данных службы "Машинное обучение Azure". Размер ZIP-файла составляет примерно 2 ГБ, поэтому на выполнение этих задач потребуется некоторое время. После отправки данные для обучения извлекаются, и теперь все готово к переходу к разделу 3.

## <a name="train-the-aspect-based-sentiment-model-and-deploy-your-endpoint"></a>Обучение аспектной модели тональности и развертывание конечной точки

Раздел 3 записной книжки используется для обучения моделей, созданных с помощью раздела 2, регистрации этих моделей и развертывания их в качестве конечной точки в кластере Azure Kubernetes. Если вы не знакомы с Azure Kubernetes, прежде чем пытаться создать кластер вывода, настоятельно рекомендуем ознакомиться со следующими статьями.

* [Обзор службы Azure Kubernetes](../aks/intro-kubernetes.md)
* [Ключевые концепции Kubernetes для службы Azure Kubernetes (AKS)](../aks/concepts-clusters-workloads.md)
* [Квоты, ограничения размера виртуальной машины и доступность региона в службе Kubernetes Azure (AKS)](../aks/quotas-skus-regions.md)

Создание и развертывание кластера вывода может занять до 30 минут. Для тестирования веб-службы перед переходом к последним шагам рекомендуется обновить набор навыков и запустить индексатор.

## <a name="update-the-skillset"></a>Обновление набора навыков

Раздел 4 в записной книжке содержит четыре ячейки, которые используются для обновления набора навыков и индексатора. Кроме того, можно выбрать новый навык и применить его к набору навыков с помощью портала, а затем запустить индексатор для обновления службы поиска.

> [!VIDEO https://channel9.msdn.com/Shows/AI-Show/Active-Learning-with-Azure-Cognitive-Search/player#time=19m35s:paused/03/player]

На портале перейдите к набору навыков и выберите ссылку на определение набора навыков (JSON). На портале отобразится код JSON вашего набора навыков, который был создан с помощью первых ячеек записной книжки. В правой части экрана находится раскрывающееся меню, в котором можно выбрать шаблон определения навыка. Выберите шаблон "Машинное обучение Azure (AML)". Укажите имя рабочей области Машинного обучения Azure и конечную точку для модели, развернутой в кластере вывода. Шаблон будет обновлен с использованием URI и ключа этой конечной точки.

> :::image type="content" source="media/cognitive-search-aml-skill/portal-aml-skillset-definition.png" alt-text="Шаблон определения набора навыков":::

Скопируйте шаблон набора навыков из окна и вставьте его в определение набора навыков слева. Измените шаблон, задав отсутствующие значения для перечисленных ниже параметров.

* Имя
* Описание
* Контекст
* Имя и источник входных данных
* Имя и targetName выходных данных

Сохраните набор навыков.

После сохранения набора навыков перейдите к индексатору и выберите ссылку на его определение (JSON). На портале отобразится код JSON индексатора, который был создан с помощью первых ячеек записной книжки. При этом сопоставления полей выходных данных потребуется обновить с учетом дополнительных сопоставлений полей, чтобы индексатор мог правильно их обрабатывать и передавать. Сохраните изменения и нажмите "Выполнить". 

## <a name="clean-up-resources"></a>Очистка ресурсов

Если вы работаете в своей подписке, по окончании проекта рекомендуем решить, нужны ли вам созданные ресурсы. Работающие ресурсы могут означать лишние затраты. Можно удалить отдельные ресурсы или удалить группу ресурсов, что позволит удалить весь набор ресурсов.

Просматривать ресурсы и управлять ими можно на портале с помощью ссылок **Все ресурсы** или **Группы ресурсов** на панели навигации слева.

При работе с бесплатной версией службы помните о том, что вам доступно максимум три индекса, индексатора и источника данных. Вы можете удалить отдельные элементы на портале, чтобы не превысить лимит.

## <a name="next-steps"></a>Дальнейшие действия

> [!div class="nextstepaction"]
> [Ознакомьтесь с возможностями веб-API для настраиваемых навыков](./cognitive-search-custom-skill-web-api.md)
> [Узнайте больше о добавлении настраиваемых навыков в конвейер обогащения](./cognitive-search-custom-skill-interface.md)