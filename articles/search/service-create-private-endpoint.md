---
title: Создание частной конечной точки для безопасного подключения
titleSuffix: Azure Cognitive Search
description: Настройте частную конечную точку в виртуальной сети для безопасного подключения к службе Когнитивный поиск Azure.
manager: nitinme
author: markheff
ms.author: maheff
ms.service: cognitive-search
ms.topic: conceptual
ms.date: 02/16/2021
ms.openlocfilehash: 7445ac5d750ac29d3e6ce466a48e82efd1bcde40
ms.sourcegitcommit: 867cb1b7a1f3a1f0b427282c648d411d0ca4f81f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "100545536"
---
# <a name="create-a-private-endpoint-for-a-secure-connection-to-azure-cognitive-search"></a>Создание частной конечной точки для безопасного подключения к Azure Когнитивный поиск

В этой статье вы будете использовать портал Azure для создания нового экземпляра службы Когнитивный поиск Azure, доступ к которому через Интернет невозможен. Далее вы настроите виртуальную машину Azure в той же виртуальной сети и будете использовать ее для доступа к службе поиска через частную конечную точку.

Частные конечные точки предоставляются [частной ссылкой Azure](../private-link/private-link-overview.md)как отдельная служба. Дополнительные сведения о затратах см. на [странице с ценами](https://azure.microsoft.com/pricing/details/private-link/).

В портал Azure можно создать закрытую конечную точку, как описано в этой статье. Кроме того, можно использовать [REST API управления версии 2020-03-13](/rest/api/searchmanagement/), [Azure PowerShell](/powershell/module/az.search)или [Azure CLI](/cli/azure/search).

> [!NOTE]
> Если конечная точка службы закрыта, некоторые функции портала отключены. Можно просматривать сведения об уровне обслуживания и управлять ими, но сведения об индексе, индексаторе и наборе навыков скрыты по соображениям безопасности. В качестве альтернативы порталу можно использовать [расширение VS Code](https://aka.ms/vscode-search) для взаимодействия с различными компонентами службы.

## <a name="why-use-a-private-endpoint-for-secure-access"></a>Зачем использовать частную конечную точку для безопасного доступа?

[Частные конечные точки](../private-link/private-endpoint-overview.md) для Azure когнитивный Поиск позволяют клиенту в виртуальной сети безопасно получать доступ к данным в индексе поиска по [закрытой ссылке](../private-link/private-link-overview.md). Частная конечная точка использует IP-адрес из [адресного пространства виртуальной сети](../virtual-network/private-ip-addresses.md) для службы поиска. Сетевой трафик между клиентом и службой поиска проходит по виртуальной сети и частной связи в магистральной сети Майкрософт, что устраняет уязвимость в общедоступном Интернете. Список других служб PaaS, поддерживающих частную связь, см. в [разделе Доступность](../private-link/private-link-overview.md#availability) документации по продукту.

Частные конечные точки для службы поиска позволяют:

- Блокировать все подключения в общедоступной конечной точке для службы поиска.
- Увеличьте безопасность виртуальной сети, позволяя блокировать утечка данных из виртуальной сети.
- Безопасное подключение к службе поиска из локальных сетей, которые подключаются к виртуальной сети с помощью [VPN](../vpn-gateway/vpn-gateway-about-vpngateways.md) или [которыми](../expressroute/expressroute-locations.md) с частными пиринга.

## <a name="create-the-virtual-network"></a>Создание виртуальной сети

В этом разделе вы создадите виртуальную сеть и подсеть для размещения виртуальной машины, которая будет использоваться для доступа к частной конечной точке службы поиска.

1. На вкладке портал Azure Главная выберите **создать ресурс**  >  **сети**  >  **Виртуальная сеть**.

1. В подменю **Создать виртуальную сеть** введите или выберите следующую информацию:

    | Параметр | Значение |
    | ------- | ----- |
    | Подписка | Выберите свою подписку.|
    | Группа ресурсов | Выберите **создать**, введите *myResourceGroup*, а затем нажмите кнопку **ОК** . |
    | Имя | Введите *MyVirtualNetwork* |
    | Регион | Выберите нужный регион |
    |||

1. Оставьте значения по умолчанию для остальных параметров. Щелкните **Проверка + создать** , а затем — **создать** .

## <a name="create-a-search-service-with-a-private-endpoint"></a>Создание службы поиска с закрытой конечной точкой

В этом разделе вы создадите новую службу Когнитивный поиск Azure с частной конечной точкой. 

1. В верхней левой части экрана портал Azure выберите **создать ресурс**  >  **веб-**  >  **когнитивный Поиск Azure**.

1. В статье **новые служба поиска — основы** введите или выберите следующие сведения:

    | Параметр | Значение |
    | ------- | ----- |
    | **Сведения о проекте** | |
    | Подписка | Выберите свою подписку. |
    | Группа ресурсов | Выберите **myResourceGroup**. Вы создали ее в предыдущем разделе.|
    | **Подробности об экземпляре** |  |
    | URL-адрес | Укажите уникальное имя. |
    | Расположение | Выберите нужный регион. |
    | Ценовая категория | Щелкните **изменить ценовую категорию** и выберите нужный уровень служб. (Не поддерживается на уровне **Free** . Должен быть **базовым** или более высоким.) |
    |||
  
1. Выберите **Далее: масштаб**.

1. Оставьте значения по умолчанию и нажмите кнопку **Далее: сеть**.

1. В **новом служба поиска — сеть** выберите **частный** для **подключения к конечной точке (данные)**.

1. В разделе **новая служба поиска — сеть** выберите **+ Добавить** в области **Частная конечная точка**. 

1. В окне **Создание частной конечной точки** введите или выберите следующие сведения:

    | Параметр | Значение |
    | ------- | ----- |
    | Подписка | Выберите свою подписку. |
    | Группа ресурсов | Выберите **myResourceGroup**. Вы создали ее в предыдущем разделе.|
    | Расположение | Выберите **Западная часть США**.|
    | Имя | Введите *myPrivateEndpoint*.  |
    | Целевой подресурс | Оставьте **сеарчсервице** по умолчанию. |
    | **СЕТИ** |  |
    | Виртуальная сеть  | Выберите *MyVirtualNetwork* из группы ресурсов *myResourceGroup*. |
    | Подсеть | Выберите *mySubnet*. |
    | **ЧАСТНАЯ ИНТЕГРАЦИЯ DNS** |  |
    | Интеграция с частной зоной DNS  | Оставьте значение по умолчанию **Да**. |
    | Частная зона DNS  | Оставьте значение по умолчанию * * (новое) privatelink.search.windows.net * *. |
    |||

1. Щелкните **ОК**. 

1. Выберите **Review + create** (Просмотреть и создать). Вы будете перенаправлены на страницу **Просмотр и создание**, где Azure проверит вашу конфигурацию. 

1. При появлении сообщения **Проверка пройдена** нажмите кнопку **Создать**. 

1. После завершения подготовки новой службы перейдите к только что созданному ресурсу.

1. Выберите **ключи** в меню содержимого слева.

1. Скопируйте **первичный ключ администратора** для последующего использования при подключении к службе.

## <a name="create-a-virtual-machine"></a>Создание виртуальной машины

1. В верхней левой части экрана портал Azure выберите **создать ресурс**  >  **вычислений**  >  **Виртуальная машина**.

1. В окне **Создание виртуальной машины — Основы** введите или выберите следующую информацию:

    | Параметр | Значение |
    | ------- | ----- |
    | **Сведения о проекте** | |
    | Подписка | Выберите свою подписку. |
    | Группа ресурсов | Выберите **myResourceGroup**. Вы создали ее в предыдущем разделе.  |
    | **Подробности об экземпляре** |  |
    | Имя виртуальной машины | Введите *myVm*. |
    | Регион | Выберите **Западная часть США** или любой регион, который вы используете. |
    | Параметры доступности | Оставьте значение по умолчанию **No infrastructure redundancy required** (Избыточность инфраструктуры не требуется). |
    | Образ — | Выберите **Центр обработки данных Windows Server 2019**. |
    | Размер | Оставьте значение по умолчанию **Standard DS1 v2**. |
    | **Учетная запись администратора** |  |
    | Имя пользователя | Введите выбранное имя пользователя. |
    | Пароль | Введите выбранный пароль. Пароль должен включать минимум 12 символов и соответствовать [определенным требованиям к сложности](../virtual-machines/windows/faq.md?toc=%2fazure%2fvirtual-network%2ftoc.json#what-are-the-password-requirements-when-creating-a-vm).|
    | Подтверждение пароля | Введите пароль еще раз. |
    | **Правила входящего порта** |  |
    | Общедоступные входящие порты | Оставьте значение по умолчанию **Разрешить выбранные порты**. |
    | Выбрать входящие порты | Оставьте протокол RDP по умолчанию **(3389)**. |
    | **Экономия** |  |
    | Already have a Windows license? (У вас уже есть лицензия Windows?) | Оставьте значение по умолчанию **Нет**. |
    |||

1. По завершении выберите **Next: Диски**.

1. В окне **Создание виртуальной машины — Диски** оставьте значения по умолчанию и выберите **Далее: Сети**.

1. В окне **Создание виртуальной машины — Сети** выберите такую информацию:

    | Параметр | Значение |
    | ------- | ----- |
    | Виртуальная сеть | Оставьте значение по умолчанию **myVirtualNetwork**.  |
    | Пространство адресов | Оставьте значение по умолчанию **10.1.0.0/24**.|
    | Подсеть | Оставьте значение по умолчанию **mySubnet (10.1.0.0/24)** .|
    | Общедоступный IP-адрес | Оставьте значение по умолчанию **(new) myVm-ip**. |
    | Общедоступные входящие порты | Выберите **Разрешить выбранные порты**. |
    | Выбрать входящие порты | Выберите **HTTP** и **RDP**.|
    ||

   > [!NOTE]
   > IPv4-адреса можно выразить в формате [CIDR](https://en.wikipedia.org/wiki/Classless_Inter-Domain_Routing) . Не забывайте использовать диапазон IP-адресов, зарезервированный для частных сетей, как описано в [RFC 1918](https://tools.ietf.org/html/rfc1918):
   >
   > - `10.0.0.0 - 10.255.255.255  (10/8 prefix)`
   > - `172.16.0.0 - 172.31.255.255  (172.16/12 prefix)`
   > - `192.168.0.0 - 192.168.255.255 (192.168/16 prefix)`

1. Выберите **Review + create** (Просмотреть и создать). Вы будете перенаправлены на страницу **Просмотр и создание**, где Azure проверит вашу конфигурацию.

1. При появлении сообщения **Проверка пройдена** нажмите кнопку **Создать**. 

## <a name="connect-to-the-vm"></a>Подключение к виртуальной машине

Скачайте и подключитесь к виртуальной машине *myVm* следующим образом:

1. На портале в строке поиска введите *myVm*.

1. Нажмите кнопку **Подключиться**. После нажатия кнопки **Подключиться** откроется окно **Connect to virtual machine** (Подключение к виртуальной машине).

1. Щелкните **Скачать RDP-файл**. Azure создаст и скачает на ваш компьютер файл протокола удаленного рабочего стола (*RDP*).

1. Откройте скачанный RDP-файл*.

    1. При появлении запроса выберите **Подключиться**.

    1. Введите имя пользователя и пароль, указанные при создании виртуальной машины.

        > [!NOTE]
        > Возможно, потребуется выбрать **More choices** > **Use a different account** (Дополнительные варианты > Использовать другую учетную запись), чтобы указать учетные данные, введенные при создании виртуальной машины.

1. Щелкните **ОК**.

1. При входе в систему может появиться предупреждение о сертификате. В таком случае выберите **Да** или **Продолжить**.

1. Когда появится рабочий стол виртуальной машины, сверните его, чтобы вернуться на локальный рабочий стол.  

## <a name="test-connections"></a>Проверка подключения

В этом разделе вы проверите доступ частной сети к службе поиска и подключитесь к, используя закрытую конечную точку.

Если конечная точка службы поиска закрыта, некоторые функции портала отключены. Вы сможете просматривать параметры уровня обслуживания и управлять ими, но доступ на портале к данным индекса и другим компонентам службы, таким как определение индекса, индексатора и набора навыков, ограничен по соображениям безопасности.

1. Откройте PowerShell на удаленном рабочем столе *myVm*.

1. Введите команду "nslookup [имя службы поиска]. Search. Windows. NET"

    Должно появиться сообщение следующего вида:
    ```azurepowershell
    Server:  UnKnown
    Address:  168.63.129.16
    Non-authoritative answer:
    Name:    [search service name].privatelink.search.windows.net
    Address:  10.0.0.5
    Aliases:  [search service name].search.windows.net
    ```

1. На виртуальной машине подключитесь к службе поиска и создайте индекс. В этом [кратком руководстве](search-get-started-rest.md) вы можете создать новый индекс поиска в службе с помощью REST API. Для настройки запросов из средства тестирования веб-API требуется конечная точка службы поиска (HTTPS://[имя службы поиска]. Search. Windows. NET) и ключ API администратора, скопированный на предыдущем шаге.

1. Завершение краткого руководства по виртуальной машине — подтверждение того, что служба полностью работоспособна.

1. Закройте подключение к удаленному рабочему столу *myVM*. 

1. Чтобы убедиться, что служба недоступна в общедоступной конечной точке, откройте POST на локальной рабочей станции и попытайтесь выполнить первые несколько задач в кратком руководстве. Если появится сообщение о том, что удаленный сервер не существует, вы успешно настроили частную конечную точку для службы поиска.

## <a name="clean-up-resources"></a>Очистка ресурсов 
Завершив использование частной конечной точки, службы поиска и виртуальной машины, удалите группу ресурсов и все содержащиеся в ней ресурсы.
1. Введите  *myResourceGroup*   в поле **поиска** в верхней части портала и выберите  *myResourceGroup* в   результатах поиска. 
1. Выберите команду **Удалить группу ресурсов**. 
1. Введите  *myResourceGroup*   **в поле введите имя группы ресурсов** и выберите **Удалить**.

## <a name="next-steps"></a>Дальнейшие действия
В этой статье вы создали виртуальную машину в виртуальной сети и службу поиска с закрытой конечной точкой. Вы подключились к виртуальной машине из Интернета и безопасно взаимодействовали со службой поиска, используя закрытую ссылку. Дополнительные сведения о частных конечных точках см. в статье [что такое частная конечная точка Azure?](../private-link/private-endpoint-overview.md).
