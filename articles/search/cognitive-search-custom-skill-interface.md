---
title: Определение интерфейса для пользовательских навыков
titleSuffix: Azure Cognitive Search
description: Пользовательский интерфейс извлечения данных для пользовательского навыка веб-API в конвейере обогащения искусственного интеллекта в Azure Когнитивный поиск.
manager: nitinme
author: luiscabrer
ms.author: luisca
ms.service: cognitive-search
ms.topic: conceptual
ms.date: 05/06/2020
ms.openlocfilehash: e78f0d1e8d6d637dfebe1ff475ab8416ba49a263
ms.sourcegitcommit: 772eb9c6684dd4864e0ba507945a83e48b8c16f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "88935421"
---
# <a name="how-to-add-a-custom-skill-to-an-azure-cognitive-search-enrichment-pipeline"></a>Как добавить пользовательский навык в конвейер Когнитивный поиск обогащения Azure

> [!VIDEO https://www.youtube.com/embed/fHLCE-NZeb4?version=3&start=172&end=221]

[Конвейер обогащения](cognitive-search-concept-intro.md) в Azure когнитивный Поиск можно собрать на основе [встроенных знаний](cognitive-search-predefined-skills.md) , а также [пользовательских навыков](cognitive-search-custom-skill-web-api.md) , которые вы создаете и добавляете в конвейер. Из этой статьи вы узнаете, как создать пользовательский навык, предоставляющий интерфейс, позволяющий включать его в конвейер обогащения искусственного интеллекта. 

Создание пользовательского навыка позволяет вставлять преобразования, уникальные для содержимого. Пользовательский навык выполняется независимо, применяя любой нужный вам шаг обогащения. Например, вы можете определить пользовательские сущности конкретных полей, создать настраиваемые модели классификации для разделения деловых и финансовых контрактов и документов, а также добавить навык распознавания речи, чтобы углубиться в содержимое звуковых файлов. Пошаговый пример см. в разделе [пример. Создание пользовательского навыка для обогащения искусственного интеллекта](cognitive-search-create-custom-skill-example.md).

 Какая бы настраиваемая возможность вам ни требовалась, доступен простой и понятный интерфейс для подключения пользовательского навыка к остальной части конвейера обогащения. Единственным требованием для включения в [набор навыков](cognitive-search-defining-skillset.md) является возможность принимать входные данные и выводить выходные данные способами, поддерживаемыми всем набором навыков. В этой статье основное внимание уделено форматам входных и выходных данных для конвейера обогащения.

## <a name="web-api-custom-skill-interface"></a>Интерфейс пользовательских навыков веб-API

Если ответ от настраиваемых конечных точек навыка API Поиска в Интернете не будет получен в течение 30-секундного окна, то по умолчанию они истекают. Конвейер индексирования является синхронным и индексация будет вызывать ошибку времени ожидания, если ответ не будет получен в этом окне времени.  Можно настроить время ожидания до 230 секунд, установив параметр timeout:

```json
        "@odata.type": "#Microsoft.Skills.Custom.WebApiSkill",
        "description": "This skill has a 230 second timeout",
        "uri": "https://[your custom skill uri goes here]",
        "timeout": "PT230S",
```

Убедитесь, что URI защищен (HTTPS).

Сейчас единственный механизм взаимодействия с пользовательским навыком основан на интерфейсе веб-API. Этот веб-API должен удовлетворять требованиям, описанным в данном разделе.

### <a name="1--web-api-input-format"></a>1. Входной формат веб-API


> [!VIDEO https://www.youtube.com/embed/fHLCE-NZeb4?version=3&start=294&end=340]


Веб-API должен принимать массив записей для обработки. Каждая запись должна содержать "контейнер свойств", то есть входные данные для веб-API. 

Предположим, что нужно создать простой обогатитель, который определяет первую дату, упомянутую в тексте контракта. В этом примере навык принимает один входной элемент *contractText* в качестве текста контракта. Кроме того, навык имеет один выходной элемент — дату контракта. Чтобы улучшить обогатитель, можно возвратить этот элемент *contractDate* в форме составного сложного типа.

Веб-API должен быть готов к приему пакета входящих записей. Каждый член массива *values* представляет входные данные для конкретной записи. Каждая запись должна иметь следующие элементы:

+ Член *recordId*, являющийся уникальным идентификатором для конкретной записи. Если ваш обогатитель возвращает результаты, он должен предоставлять этот *recordId*, чтобы позволить вызывающему объекту сопоставить результаты записи с их входными данными.

+ Член *данные*, являющийся контейнером полей входных данных для каждой записи.

Если выражаться конкретнее, то в соответствии с приведенным выше примером веб-API следует ожидать запросы следующего вида:

```json
{
    "values": [
      {
        "recordId": "a1",
        "data":
           {
             "contractText": 
                "This is a contract that was issues on November 3, 2017 and that involves... "
           }
      },
      {
        "recordId": "b5",
        "data":
           {
             "contractText": 
                "In the City of Seattle, WA on February 5, 2018 there was a decision made..."
           }
      },
      {
        "recordId": "c3",
        "data":
           {
             "contractText": null
           }
      }
    ]
}
```
На самом деле служба может вызываться с сотнями или тысячами записей, а не только тремя, показанными здесь.

### <a name="2-web-api-output-format"></a>2. выходной формат веб-API

Формат выходных данных — это набор записей, содержащих *recordId* и контейнер свойств 

```json
{
  "values": 
  [
      {
        "recordId": "b5",
        "data" : 
        {
            "contractDate":  { "day" : 5, "month": 2, "year" : 2018 }
        }
      },
      {
        "recordId": "a1",
        "data" : {
            "contractDate": { "day" : 3, "month": 11, "year" : 2017 }                    
        }
      },
      {
        "recordId": "c3",
        "data" : 
        {
        },
        "errors": [ { "message": "contractText field required "}   ],  
        "warnings": [ {"message": "Date not found" }  ]
      }
    ]
}
```

Этот конкретный пример имеет всего один выходной элемент, но вывести можно более одного свойства. 

### <a name="errors-and-warning"></a>Ошибки и предупреждения

Как показано в предыдущем примере, для каждой записи можно возвращать сообщения об ошибках и предупреждения.

## <a name="consuming-custom-skills-from-skillset"></a>Использование пользовательских навыков из набора навыков

При создании обогатителя веб-API можно в составе запроса описать HTTP-заголовки и параметры. В приведенном ниже фрагменте кода показано, как можно описать параметры запроса и *необязательные* заголовки HTTP как часть определения набора навыков. Заголовки HTTP не являются обязательными, но они позволяют добавлять дополнительные возможности настройки в навык и задавать их из определения набора навыков.

```json
{
    "skills": [
      {
        "@odata.type": "#Microsoft.Skills.Custom.WebApiSkill",
        "description": "This skill calls an Azure function, which in turn calls TA sentiment",
        "uri": "https://indexer-e2e-webskill.azurewebsites.net/api/DateExtractor?language=en",
        "context": "/document",
        "httpHeaders": {
            "DateExtractor-Api-Key": "foo"
        },
        "inputs": [
          {
            "name": "contractText",
            "source": "/document/content"
          }
        ],
        "outputs": [
          {
            "name": "contractDate",
            "targetName": "date"
          }
        ]
      }
  ]
}
```

## <a name="next-steps"></a>Дальнейшие действия

В этой статье были рассмотрены требования к интерфейсу, необходимые для интеграции пользовательского навыка в набор навыков. Перейдите по следующим ссылкам, чтобы получить дополнительные сведения о настраиваемых навыках и композиции навыков.

+ [Ознакомьтесь с нашим видео о пользовательских навыках](https://youtu.be/fHLCE-NZeb4)
+ [Power Skills: репозиторий пользовательских навыков](https://github.com/Azure-Samples/azure-search-power-skills)
+ [Пример. Создание пользовательского навыка для обогащения искусственного интеллекта](cognitive-search-create-custom-skill-example.md)
+ [Определение набора навыков](cognitive-search-defining-skillset.md)
+ [Создание набора навыков (REST)](/rest/api/searchservice/create-skillset)
+ [Сопоставление обогащенных полей](cognitive-search-output-field-mapping.md)