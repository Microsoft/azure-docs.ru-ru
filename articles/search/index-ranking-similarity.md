---
title: Алгоритм подобия ранжирования
titleSuffix: Azure Cognitive Search
description: Как задать алгоритм подобия, чтобы опробовать новый алгоритм подобия для ранжирования
manager: nitinme
author: luiscabrer
ms.author: luisca
ms.service: cognitive-search
ms.topic: conceptual
ms.date: 03/13/2020
ms.openlocfilehash: e2caa09d41abb1842100ed8259e82ec411390ccb
ms.sourcegitcommit: e972837797dbad9dbaa01df93abd745cb357cde1
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/14/2021
ms.locfileid: "100520635"
---
# <a name="ranking-algorithm-in-azure-cognitive-search"></a>Алгоритм ранжирования в Azure Когнитивный поиск

> [!IMPORTANT]
> Начиная с 15 июля 2020, недавно созданные службы поиска будут использовать функцию ранжирования BM25 автоматически, что в большинстве случаев позволяет обеспечить ранжирование поиска, которое лучше всего соответствует ожиданиям пользователей по сравнению с текущим рейтингом по умолчанию. Помимо старшего ранжирования, BM25 также позволяет настраивать параметры для результатов настройки на основе таких факторов, как размер документа.  
>
> С этим изменением, скорее всего, будут видны небольшие изменения в порядке результатов поиска. Для тех, кто хочет протестировать влияние этого изменения, алгоритм BM25 доступен в API-версии 2019-05-06-Preview и в 2020-06-30.  

В этой статье описывается, как использовать новый алгоритм ранжирования BM25 в существующих службах поиска для новых индексов, созданных и запрашиваемых с помощью предварительной версии API.

Когнитивный поиск Azure находится в процессе внедрения официальной реализации Lucene алгоритма BM25 Окапи, *BM25Similarity*, которая заменит ранее использованную реализацию *классиксимиларити* . Как и в старом алгоритме Классиксимиларити, BM25Similarity представляет собой функцию извлечения, аналогичную TF-IDF, которая использует термин Frequency (TF) и обратную частоту документа (IDF) в качестве переменных для вычисления оценки релевантности для каждой пары документов-запросов, которая затем используется для ранжирования. 

Хотя концептуально аналогичен старому классическому алгоритму подобия, BM25 получает его корневой каталог в вероятностная Information, чтобы улучшить его. BM25 также предлагает расширенные возможности настройки, такие как разрешение пользователю определять, как показатель релевантности масштабируется с термином частота совпадений терминов.

## <a name="how-to-test-bm25-today"></a>Как протестировать BM25 сегодня

При создании нового индекса можно задать свойство **подобия** , чтобы указать алгоритм. Можно использовать `api-version=2019-05-06-Preview` , как показано ниже, или `api-version=2020-06-30` .

```http
PUT https://[search service name].search.windows.net/indexes/[index name]?api-version=2019-05-06-Preview
```

```json  
{
    "name": "indexName",
    "fields": [
        {
            "name": "id",
            "type": "Edm.String",
            "key": true
        },
        {
            "name": "name",
            "type": "Edm.String",
            "searchable": true,
            "analyzer": "en.lucene"
        },
        ...
    ],
    "similarity": {
        "@odata.type": "#Microsoft.Azure.Search.BM25Similarity"
    }
}
```

Свойство **подобия** полезно в этом временном периоде, когда оба алгоритма доступны, только в существующих службах. 

| Свойство | Описание |
|----------|-------------|
| подобие | Необязательный элемент. Допустимые значения: *"#Microsoft. Azure. Search. классиксимиларити"* или *"#Microsoft. Azure. Search. BM25Similarity"*. <br/> Требуется `api-version=2019-05-06-Preview` или более поздняя версия службы поиска, созданной до 15 июля 2020. |

Для новых служб, созданных после 15 июля 2020, BM25 используется автоматически и является единственным алгоритмом подобия. Если вы попытаетесь задать **подобие** для `ClassicSimilarity` новой службы, будет возвращена ошибка 400, так как этот алгоритм не поддерживается в новой службе.

Для существующих служб, созданных до 15 июля 2020, классическое сходство остается алгоритмом по умолчанию. Если свойство **подобия** опущено или имеет значение null, индекс использует классический алгоритм. Если вы хотите использовать новый алгоритм, необходимо задать **сходство** , как описано выше.

## <a name="bm25-similarity-parameters"></a>Параметры подобия BM25

BM25 подобие добавляет два настраиваемых пользователем параметра для управления вычисленным показателем релевантности.

### <a name="k1"></a>k1

Параметр *K1* управляет функцией масштабирования между термином частота соответствующих терминов и конечной показателем релевантности пары документов-запросов.

Нулевое значение представляет собой "двоичную модель", где вклад одного совпадающего термина одинаков для всех соответствующих документов независимо от того, сколько раз этот термин встречается в тексте, а более крупное K1 значение позволяет продолжить увеличение по мере того, как в документе будет найдено больше экземпляров одного и того же термина. По умолчанию Когнитивный поиск Azure использует значение 1,2 для параметра K1. Использование более высокого значения K1 может быть важным в случаях, когда предполагается, что несколько терминов будут входить в поисковый запрос. В таких случаях может потребоваться предпочитать документы, которые соответствуют многим различным терминам запроса, которые ищутся в документах, которые соответствуют только одному из них, несколько раз. Например, при запросе индекса для документов, содержащих термины «Apollo Спацефлигхт», нам может потребоваться уменьшить оценку статьи о греческом Мифологиие, которая содержит слово «Apollo», в несколько десятков раз, без упоминания «Спацефлигхт» по сравнению с другой статьей, в которой явно упоминается «Apollo» и «Спацефлигхт» несколько раз. 
 
### <a name="b"></a>b

Параметр *b* определяет, как длина документа влияет на показатель релевантности.

Значение 0,0 означает, что длина документа не будет влиять на оценку, а значение 1,0 означает, что влияние частоты терминов на показатель релевантности будет нормализовано по длине документа. Значение по умолчанию, используемое в Когнитивный поиск Azure для параметра b, — 0,75. Нормализация тактовой частоты по длине документа полезна в случаях, когда нам нужно пенализе более длинные документы. В некоторых случаях более длинные документы (например, полный роман), скорее всего, будут содержать множество незначимых терминов по сравнению с более короткими документами.

### <a name="setting-k1-and-b-parameters"></a>Настройка параметров K1 и b

Чтобы настроить значения b или K1, просто добавьте их в качестве свойств объекта подобия при использовании BM25:

```json
    "similarity": {
        "@odata.type": "#Microsoft.Azure.Search.BM25Similarity",
        "b" : 0.5,
        "k1" : 1.3
    }
```

Алгоритм подобия может быть установлен только во время создания индекса. Это означает, что используемый алгоритм подобия нельзя изменить для существующих индексов. Параметры *"b"* и *"K1"* можно изменить при обновлении существующего определения индекса, использующего BM25. При изменении этих значений в существующем индексе индекс будет переведен в автономный режим по крайней мере через несколько секунд, что приведет к сбою запросов индексирования и запросов. По этой причине в строке запроса на обновление необходимо задать параметр "Алловиндексдовнтиме = true":

```http
PUT https://[search service name].search.windows.net/indexes/[index name]?api-version=[api-version]&allowIndexDowntime=true
```

## <a name="see-also"></a>См. также раздел  

+ [Справочник по REST API](/rest/api/searchservice/)
+ [Добавление профилей оценки в индекс](index-add-scoring-profiles.md)
+ [Создание API индекса](/rest/api/searchservice/create-index)
+ [Библиотеки службы "Поиск Azure" для .NET](/dotnet/api/overview/azure/search)