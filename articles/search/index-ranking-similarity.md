---
title: Настройка алгоритма подобия
titleSuffix: Azure Cognitive Search
description: Узнайте, как включить BM25 для старых служб поиска и как изменить параметры BM25 для лучшего размещения содержимого индексов.
manager: nitinme
author: luiscabrer
ms.author: luisca
ms.service: cognitive-search
ms.topic: conceptual
ms.date: 03/12/2021
ms.openlocfilehash: 52b3523d3c092f1b9375f53038cc3b20d0ddedcc
ms.sourcegitcommit: 772eb9c6684dd4864e0ba507945a83e48b8c16f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/20/2021
ms.locfileid: "103232840"
---
# <a name="configure-the-similarity-ranking-algorithm-in-azure-cognitive-search"></a>Настройка алгоритма ранжирования сходства в Azure Когнитивный поиск

Azure Когнитивный поиск поддерживает два алгоритма ранжирования подобия:

+ *Классический алгоритм подобия* , используемый всеми службами поиска вплоть до 15 июля 2020.
+ Реализация алгоритма *ОКАПИ BM25* , используемая во всех службах поиска, созданных после 15 июля.

BM25 ранжирование — это новое значение по умолчанию, так как оно создает ранжирование поиска, которое лучше всего соответствует ожиданиям пользователей. Он поставляется с [параметрами](#set-bm25-parameters) для настройки результатов на основе таких факторов, как размер документа. 

Для новых служб, созданных после 15 июля 2020, BM25 используется автоматически и является единственным алгоритмом подобия. Если вы попытаетесь задать подобие для Классиксимиларити в новой службе, будет возвращена ошибка HTTP 400, так как этот алгоритм не поддерживается службой.

Для старых служб, созданных до 15 июля 2020, классическое сходство остается алгоритмом по умолчанию. Более старые службы могут обновляться до BM25 на основе индекса, как описано ниже. Если вы переходите с классической модели на BM25, вы можете увидеть некоторые отличия порядка результатов поиска.

> [!NOTE]
> Семантические ранжирование, которое сейчас находится в предварительной версии для стандартных служб в выбранных регионах, является дополнительным шагом вперед в создании более релевантных результатов. В отличие от других алгоритмов, это надстройка, которая выполняет итерацию по существующему результирующему набору. Дополнительные сведения см. в разделе [Общие сведения о семантическом поиске](semantic-search-overview.md) и [семантическое ранжирование](semantic-ranking.md).

## <a name="enable-bm25-scoring-on-older-services"></a>Включение оценки BM25 в старых службах

Если вы используете службу поиска, которая была создана до 15 июля 2020, можно включить BM25, задав свойство подобия для новых индексов. Свойство доступно только для новых индексов, поэтому если требуется BM25 для существующего индекса, необходимо удалить и [перестроить индекс](search-howto-reindex.md) с новым свойством подобия, имеющим значение Microsoft. Azure. Search. BM25Similarity.

После того как индекс существует со свойством подобия, можно переключаться между BM25Similarity или Классиксимиларити. 

Следующие ссылки описывают свойство подобия в пакетах SDK для Azure. 

| Клиентская библиотека | Свойство подобия |
|----------------|---------------------|
| .NET  | [Сеарчиндекс. подобие](/dotnet/api/azure.search.documents.indexes.models.searchindex.similarity) |
| Java | [Сеарчиндекс. Сетсимиларити](/java/api/com.azure.search.documents.indexes.models.searchindex.setsimilarity) |
| JavaScript | [Сеарчиндекс. подобие](/javascript/api/@azure/search-documents/searchindex#similarity) |
| Python | [Свойство подобия для Сеарчиндекс](/python/api/azure-search-documents/azure.search.documents.indexes.models.searchindex) |

### <a name="rest-example"></a>Пример REST

Можно также использовать [REST API](/rest/api/searchservice/create-index), как показано в следующем примере:

```http
PUT https://[search service name].search.windows.net/indexes/[index name]?api-version=2020-06-30
{
    "name": "indexName",
    "fields": [
        {
            "name": "id",
            "type": "Edm.String",
            "key": true
        },
        {
            "name": "name",
            "type": "Edm.String",
            "searchable": true,
            "analyzer": "en.lucene"
        },
        ...
    ],
    "similarity": {
        "@odata.type": "#Microsoft.Azure.Search.BM25Similarity"
    }
}
```

## <a name="set-bm25-parameters"></a>Задать параметры BM25

BM25 подобие добавляет два настраиваемых пользователем параметра для управления вычисленным показателем релевантности. Параметры BM25 можно задать во время создания индекса или как обновление индекса, если во время создания индекса был указан алгоритм BM25.

| Свойство. | Тип | Описание |
|----------|------|-------------|
| k1 | number | Управляет функцией масштабирования между термином частота соответствующих терминов и конечной показателем релевантности пары "документ-запрос". Обычно значения 0,0 – 3,0, а для по умолчанию — 1,2. </br></br>Значение 0,0 представляет "двоичную модель", где вклад одного совпадающего термина одинаков для всех соответствующих документов независимо от того, сколько раз этот термин встречается в тексте, а более крупное K1 значение позволяет продолжить увеличение по мере того, как в документе будет найдено больше экземпляров одного и того же термина. </br></br>Использование более высокого значения K1 может быть важным в случаях, когда предполагается, что несколько терминов будут входить в поисковый запрос. В таких случаях может потребоваться предпочитать документы, которые соответствуют многим различным терминам запроса, которые ищутся в документах, которые соответствуют только одному из них, несколько раз. Например, при запросе индекса для документов, содержащих термины «Apollo Спацефлигхт», нам может потребоваться уменьшить оценку статьи о греческом Мифологиие, содержащей слово «Apollo», в несколько десятков раз, без упоминания «Спацефлигхт» по сравнению с другой статьей, в которой явно упоминается «Apollo» и «Спацефлигхт» несколько раз. |
| b | number | Определяет, как длина документа влияет на показатель релевантности. Значения находятся в диапазоне от 0 до 1, по умолчанию 0,75. </br></br>Значение 0,0 означает, что длина документа не будет влиять на оценку, а значение 1,0 означает, что влияние частоты терминов на показатель релевантности будет нормализовано по длине документа. </br></br>Нормализация тактовой частоты по длине документа полезна в случаях, когда нам нужно пенализе более длинные документы. В некоторых случаях более длинные документы (например, полный роман), скорее всего, будут содержать множество незначимых терминов по сравнению с более короткими документами. |

### <a name="setting-k1-and-b-parameters"></a>Настройка параметров K1 и b

Чтобы задать или изменить значения b или K1, добавьте их в объект подобия BM25. При установке или изменении этих значений в существующем индексе индекс будет переведен в автономный режим по крайней мере через несколько секунд, что приведет к сбою активных запросов на индексирование и запросы. Следовательно, необходимо задать параметр "Алловиндексдовнтиме = true" для запроса на обновление:

```http
PUT https://[search service name].search.windows.net/indexes/[index name]?api-version=2020-06-30&allowIndexDowntime=true
{
    "similarity": {
        "@odata.type": "#Microsoft.Azure.Search.BM25Similarity",
        "b" : 0.5,
        "k1" : 1.3
    }
}
```

## <a name="see-also"></a>См. также раздел  

+ [Справочник по REST API](/rest/api/searchservice/)
+ [Добавление профилей оценки в индекс](index-add-scoring-profiles.md)
+ [Создание API индекса](/rest/api/searchservice/create-index)
+ [Библиотеки службы "Поиск Azure" для .NET](/dotnet/api/overview/azure/search)