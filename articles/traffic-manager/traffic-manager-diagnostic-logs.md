---
title: Включение ведения журнала ресурсов в диспетчере трафика Azure
description: Узнайте, как включить ведение журнала ресурсов для профиля диспетчера трафика и получить доступ к файлам журнала, созданным в результате.
services: traffic-manager
author: duongau
ms.service: traffic-manager
ms.devlang: na
ms.topic: how-to
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 01/25/2019
ms.author: duau
ms.openlocfilehash: f24a4a0d982ff78ca4d6726e950825ed2c784e67
ms.sourcegitcommit: 0aec60c088f1dcb0f89eaad5faf5f2c815e53bf8
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/14/2021
ms.locfileid: "98184549"
---
# <a name="enable-resource-logging-in-azure-traffic-manager"></a>Включение ведения журнала ресурсов в диспетчере трафика Azure

В этой статье описывается, как включить сбор журналов ресурсов диагностики и доступ к данным журнала для профиля диспетчера трафика.

Журналы ресурсов диспетчера трафика Azure позволяют получить представление о поведении ресурса профиля диспетчера трафика. Например, данные журнала профиля можно использовать, чтобы определить, почему для конечной точки истекло время ожидания отдельных проб.

## <a name="enable-resource-logging"></a>Включение журналов ресурсов

[!INCLUDE [updated-for-az](../../includes/updated-for-az.md)]

Вы можете выполнить приведенные ниже команды в [Azure Cloud Shell](https://shell.azure.com/powershell) или с помощью PowerShell на своем компьютере. Azure Cloud Shell — это бесплатная интерактивная оболочка. Она включает предварительно установленные общие инструменты Azure и настроена для использования с вашей учетной записью. Если вы решили запустить PowerShell на своем компьютере, вам потребуется модуль Azure PowerShell 1.0.0 или более поздней версии. Выполните командлет `Get-Module -ListAvailable Az`, чтобы узнать установленную версию. Если вам необходимо выполнить установку или обновление, см. статью [об установке модуля Azure PowerShell](/powershell/azure/install-az-ps). Если модуль PowerShell запущен локально, необходимо также выполнить командлет `Login-AzAccount`, чтобы войти в Azure.

1. **Извлечение профиля диспетчера трафика.**

    Чтобы включить ведение журнала ресурсов, необходим идентификатор профиля диспетчера трафика. Получите профиль диспетчера трафика, для которого необходимо включить ведение журнала ресурсов, с помощью [Get-азтраффикманажерпрофиле](/powershell/module/az.TrafficManager/Get-azTrafficManagerProfile). Выходные данные содержат сведения об идентификаторе профиля диспетчера трафика.

    ```azurepowershell-interactive
    Get-AzTrafficManagerProfile -Name <TrafficManagerprofilename> -ResourceGroupName <resourcegroupname>
    ```

2. **Включите ведение журнала ресурсов для профиля диспетчера трафика.**

    Включите ведение журнала ресурсов для профиля диспетчера трафика, используя идентификатор, полученный на предыдущем шаге, с помощью [Set-аздиагностиксеттинг](/powershell/module/az.monitor/set-azdiagnosticsetting?view=latest). Следующая команда позволяет сохранить журналы подробных сведений профиля диспетчера трафика для указанной учетной записи службы хранилища Azure. 

      ```azurepowershell-interactive
    Set-AzDiagnosticSetting -ResourceId <TrafficManagerprofileResourceId> -StorageAccountId <storageAccountId> -Enabled $true
      ``` 
3. **Проверка параметров диагностики.**

      Проверьте параметры диагностики для профиля диспетчера трафика с помощью командлета [Get-AzDiagnosticSetting](/powershell/module/az.monitor/get-azdiagnosticsetting?view=latest). Следующая команда позволяет просмотреть категории, зарегистрированные для ресурса.

     ```azurepowershell-interactive
     Get-AzDiagnosticSetting -ResourceId <TrafficManagerprofileResourceId>
     ```  
      Убедитесь, что все категории журнала, связанные с ресурсом профиля диспетчера трафика, отображаются как включенные. Проверьте также, правильно ли настроена учетная запись хранения.

## <a name="access-log-files"></a>Файлы журнала доступа
1. Войдите на [портал Azure](https://portal.azure.com). 
1. Войдите в свою учетную запись службы хранилища Azure на портале.
2. На странице **Обзор** учетной записи хранения Azure в разделе **Службы** выберите **Большие двоичные объекты**.
3. Для **контейнеров** выберите **insights-logs-probehealthstatusevents**, перейдите вниз к файлу PT1H.json и щелкните **Загрузка**, чтобы скачать и сохранить копию этого файла журнала.

    ![Получение доступа к файлам журнала профиля диспетчера трафика из хранилища BLOB-объектов](./media/traffic-manager-logs/traffic-manager-logs.png)


## <a name="traffic-manager-log-schema"></a>Схема журнала диспетчера трафика

Все журналы ресурсов, доступные через Azure Monitor, используют общую схему верхнего уровня, обеспечивая гибкость для каждой службы, чтобы создавать уникальные свойства для собственных событий. Сведения о схеме журналов ресурсов верхнего уровня см. в статье [Поддерживаемые службы, схемы и категории для журналов ресурсов Azure](../azure-monitor/platform/resource-logs-schema.md).

В следующей таблице приведены схемы журналов, относящиеся к ресурсу профиля диспетчера трафика Azure.

|Имя поля|Тип поля|Определение|Пример|
|----|----|---|---|
|EndpointName|Строка|Имя конечной точки диспетчера трафика, для которой выполняется запись состояния работоспособности.|*myPrimaryEndpoint*|
|Состояние|Строка|Состояние работоспособности проверенной конечной точки диспетчера трафика. Состояние может иметь значение **Работает** или **Не работает**.|**Работает**.|
|||||

## <a name="next-steps"></a>Дальнейшие действия

* Дополнительные сведения см. в статье [Мониторинг конечных точек в диспетчере трафика](traffic-manager-monitoring.md).