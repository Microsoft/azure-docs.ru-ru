---
title: Регистрация и сканирование Базы данных SQL Azure
description: Сведения о том, как сканировать Базу данных SQL Azure.
author: hophanms
ms.author: hophan
ms.service: purview
ms.subservice: purview-data-catalog
ms.topic: tutorial
ms.date: 10/02/2020
ms.openlocfilehash: b3503dead21eeca32d82e896f889b99d11435642
ms.sourcegitcommit: aaa65bd769eb2e234e42cfb07d7d459a2cc273ab
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/27/2021
ms.locfileid: "98879736"
---
# <a name="register-and-scan-an-azure-sql-database"></a>Регистрация и сканирование Базы данных SQL Azure

В этой статье описано, как зарегистрировать Базу данных SQL Azure в качестве источника данных в Purview и настроить сканирование.

## <a name="supported-capabilities"></a>Поддерживаемые возможности

База данных SQL Azure как источник данных поддерживает следующие функциональные возможности:

- **Полное и добавочное сканирование** для сохранения метаданных и классификации в Базе данных SQL Azure.

- **Отслеживание происхождения данных** по нескольким ресурсам данных для операций копирования и потоков данных в Фабрике данных Azure.

### <a name="known-limitations"></a>Известные ограничения

Azure Purview не поддерживает сканирование [представлений](/sql/relational-databases/views/views?view=azuresqldb-current&preserve-view=true) в Базе данных SQL Azure.

## <a name="prerequisites"></a>Предварительные требования

1. Создайте новую учетную запись Azure Purview, если у вас ее еще нет.

1. Сетевой доступ между учетной записью Azure Purview и Базой данных SQL Azure.


### <a name="set-up-authentication-for-a-scan"></a>Настройка проверки подлинности для сканирования

Настройте проверку подлинности для сканирования Базы данных SQL Azure. Если вам нужно создать новую проверку подлинности, [авторизуйте доступ к базе данных в Базе данных SQL](../azure-sql/database/logins-create-manage.md). Сейчас служба Purview поддерживает три метода проверки подлинности:

- Проверка подлинности SQL
- Субъект-служба
- Управляемое удостоверение

#### <a name="sql-authentication"></a>Проверка подлинности SQL

> [!Note]
> Создавать имена входа могут только имена входа участника уровня сервера (созданного процессом подготовки) или члены роли базы данных `loginmanager` в базе данных master. Процесс предоставления разрешений займет примерно **15 минут**, и после этого Purview будет иметь нужные разрешения для сканирования ресурсов.

Если у вас еще нет имени входа для Базы данных SQL Azure, создайте его по инструкциям из раздела о команде [CREATE LOGIN](/sql/t-sql/statements/create-login-transact-sql?view=azuresqldb-current&preserve-view=true#examples-1). Значения **имя пользователя** и **пароль** вам потребуются для последующих шагов.

1. На портале Azure перейдите к хранилищу ключей.
1. Выберите **Параметры > Секреты**.
1. Выберите **+ Создать или импортировать** и введите **Имя** и **Значение** для *пароля* от Базы данных SQL Azure.
1. Чтобы завершить процесс, щелкните **Создать**.
1. Если хранилище ключей еще не подключено к службе Purview, вам придется [создать новое подключение к хранилищу ключей](manage-credentials.md#create-azure-key-vaults-connections-in-your-azure-purview-account).
1. Наконец, [создайте новые учетные данные](manage-credentials.md#create-a-new-credential) для сканирования, указав **имя пользователя** и **пароль**.

#### <a name="service-principal-and-managed-identity"></a>Субъект-служба и управляемое удостоверение

За несколько простых шагов вы можете настроить для Purview субъект-службу или **управляемое удостоверение**, которые будут использоваться для сканирования Базы данных SQL Azure.

   > [!Note]
   > Для сканирования в Purview нужно предоставить значения **Идентификатор приложения (клиент)** и **Секрет клиента**.

##### <a name="create-or-use-an-existing-service-principal"></a>Создание нового субъекта-службы или выбор существующего

> [!Note]
> Пропустите этот шаг, если вы используете **управляемое удостоверение** Purview.

Чтобы использовать субъект-службу, вам нужно выбрать существующий субъект-службу или создать новый. 

> [!Note]
> Если необходимо создать субъект-службу, выполните следующие действия:
> 1. Перейдите на [портал Azure](https://portal.azure.com).
> 1. В меню слева выберите **Azure Active Directory**.
> 1. Щелкните **Регистрация приложений**.
> 1. Выберите **Регистрация нового приложения**.
> 1. Введите имя **приложения** (имя субъекта-службы).
> 1. Установите флажок **Учетные записи только в этом каталоге организации**.
> 1. Для URI перенаправления выберите тип **Интернет** и введите произвольный URL-адрес, не обязательно существующий и работающий.
> 1. Нажмите кнопку **Зарегистрировать**.

##### <a name="configure-azure-ad-authentication-in-the-database-account"></a>Настройка проверки подлинности Azure AD в учетной записи базы данных

Субъект-служба или управляемое удостоверение должны иметь разрешение на получение метаданных для базы данных, схем и таблиц. Кроме того, требуется возможность запрашивать из таблиц примеры для классификации.

- [Настройка и администрирование проверки подлинности Azure Active Directory с помощью Azure SQL](../azure-sql/database/authentication-aad-configure.md)
- Если вы предпочитаете использовать управляемое удостоверение, для этой цели учетная запись Purview имеет собственное управляемое удостоверение, которое по сути является именем Purview, указанным при создании ресурса. Вы должны создать пользователя Azure AD в Базе данных SQL Azure, указав для его точное значение управляемого удостоверения Purview или собственный субъект-службу, по инструкциям из раздела [Создание пользователя субъекта-службы в службе "База данных SQL Azure"](../azure-sql/database/authentication-aad-service-principal-tutorial.md#create-the-service-principal-user-in-azure-sql-database). Вам нужно назначить удостоверению соответствующие разрешения (например, `db_owner` или `db_datareader`). Пример синтаксиса SQL для создания пользователя и предоставления разрешений:

    ```sql
    CREATE USER [Username] FROM EXTERNAL PROVIDER
    GO
    
    EXEC sp_addrolemember 'db_owner', [Username]
    GO
    ```

    > [!Note]
    > В качестве `Username` можно использовать собственный субъект-службу или управляемое удостоверение Purview. Ознакомиться с ролями фиксированной базы данных и их возможностями можно [здесь](/sql/relational-databases/security/authentication-access/database-level-roles?view=sql-server-ver15&preserve-view=true#fixed-database-roles).
    
##### <a name="add-service-principal-to-key-vault-and-purviews-credential"></a>Добавление субъекта-службы в хранилище ключей и учетные данные Purview

> [!Note]
> Если вы планируете использовать **управляемое удостоверение** Purview, этот шаг можно пропустить, так как управляемое удостоверение Purview по умолчанию уже включено в учетные данные **Purview-MSI**.

Оно потребуется для получения идентификатора приложения и секрета для субъекта-службы:

1. Откройте страницу субъекта-службы на [портале Azure](https://portal.azure.com).
1. Скопируйте значения **Идентификатор приложения (клиент)** из раздела **Обзор** и **Секрет клиента** из раздела **Сертификаты и секреты**.
1. Перейдите в хранилище ключей.
1. Выберите **Параметры > Секреты**.
1. Выберите **+ Создать или импортировать**, а затем введите **Имя** и **Значение**, содержащее **секрет клиента** для вашего субъекта-службы.
1. Чтобы завершить процесс, щелкните **Создать**.
1. Если хранилище ключей еще не подключено к службе Purview, вам придется [создать новое подключение к хранилищу ключей](manage-credentials.md#create-azure-key-vaults-connections-in-your-azure-purview-account).
1. Наконец, [создайте новые учетные данные](manage-credentials.md#create-a-new-credential) для сканирования, указав субъект-службу.

### <a name="firewall-settings"></a>Параметры брандмауэра

Сервер базы данных должен разрешать подключения к Azure. Это нужно Azure Purview для доступа к серверу и его подключения. Вы можете воспользоваться практическим руководством по [подключению из среды Azure](../azure-sql/database/firewall-configure.md#connections-from-inside-azure).

1. Перейдите к учетной записи базы данных.
1. На странице **Обзор** выберите имя сервера.
1. Выберите **Безопасность > Брандмауэры и виртуальные сети**.
1. Выберите значение **Да** для параметра **Разрешить доступ к серверу службам и ресурсам Azure**.

    :::image type="content" source="media/register-scan-azure-sql-database/sql-firewall.png" alt-text="Разрешить доступ к серверу службам и ресурсам Azure" border="true":::.
    
> [!Note]
> В настоящее время Azure Purview не поддерживает конфигурацию виртуальной сети. Это означает, что вы не сможете использовать параметры брандмауэра на основе IP-адресов.

## <a name="register-an-azure-sql-database-data-source"></a>Регистрация Базы данных SQL Azure в качестве источника данных

Чтобы зарегистрировать новую Базу данных SQL Azure в каталоге данных, выполните следующие действия:

1. Перейдите к учетной записи Purview.

1. В области навигации слева выберите **Источники**.

1. Нажмите кнопку **Зарегистрировать**.

1. В разделе **Регистрация источников** выберите **База данных SQL Azure**. Выберите **Continue** (Продолжить).

:::image type="content" source="media/register-scan-azure-sql-database/register-new-data-source.png" alt-text="Регистрация источника данных" border="true":::

На экране **Регистрация источников (База данных SQL Azure)** выполните следующие действия:

1. Введите **Имя**, под которым этот источник данных будет включен в каталог.
1. Выберите способ указания нужной учетной записи хранения:
   1. Выберите **Из подписки Azure**, затем выберите подходящую подписку в раскрывающемся списке **Подписка Azure** и подходящий сервер из раскрывающегося списка **Имя сервера**.
   1. Можно также выбрать действие **Ввести вручную** и указать **Имя сервера**.
1. Щелкните **Готово**, чтобы завершить регистрацию источника данных.

:::image type="content" source="media/register-scan-azure-sql-database/add-azure-sql-database.png" alt-text="Параметры регистрации источников" border="true":::

[!INCLUDE [create and manage scans](includes/manage-scans.md)]

> [!NOTE]
> Удаление сканирования не приводит к удалению ресурсов из других сканирований Базы данных SQL Azure.

## <a name="next-steps"></a>Дальнейшие действия

- [Обзор каталога данных Azure Purview](how-to-browse-catalog.md)
- [Поиск по каталогу данных Azure Purview](how-to-search-catalog.md)