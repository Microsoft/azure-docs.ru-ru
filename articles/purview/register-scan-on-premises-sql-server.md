---
title: Регистрация и сканирование локального сервера SQL Server
description: В этом учебнике описывается проверка локального сервера SQL Server с помощью локальной среды IR.
author: viseshag
ms.author: viseshag
ms.service: purview
ms.subservice: purview-data-catalog
ms.topic: how-to
ms.date: 09/18/2020
ms.openlocfilehash: 86942f509ab067a53c47b5132c451f0585760050
ms.sourcegitcommit: 5b926f173fe52f92fcd882d86707df8315b28667
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/04/2021
ms.locfileid: "99549649"
---
# <a name="register-and-scan-an-on-premises-sql-server"></a>Регистрация и сканирование локального сервера SQL Server

В этой статье описано, как зарегистрировать источник данных SQL Server в зрения и настроить на нем проверку.

## <a name="supported-capabilities"></a>Поддерживаемые возможности

Локальный источник данных SQL Server поддерживает следующие функциональные возможности.

- **Полное и добавочное сканирование** для записи метаданных и классификации в локальной сети или на сервере SQL Server, установленном на виртуальной машине Azure.

- **Журнал преобразований** между ресурсами данных для операций копирования и потока ADF

Локальный источник данных SQL Server поддерживает:

- для каждой версии SQL Server 2019 назад к SQL Server 2000

- Метод проверки подлинности: проверка подлинности SQL

### <a name="known-limitations"></a>Известные ограничения

Azure зрения не поддерживает сканирование [представлений](/sql/relational-databases/views/views) в SQL Server.

## <a name="prerequisites"></a>Предварительные требования

- Перед регистрацией источников данных создайте учетную запись Azure зрения. Дополнительные сведения о создании учетной записи зрения см. в разделе [Краткое руководство. Создание учетной записи Azure зрения](create-catalog-portal.md).

- Настройте локальную [среду выполнения интеграции](manage-integration-runtimes.md) для сканирования источника данных.

## <a name="setting-up-authentication-for-a-scan"></a>Настройка проверки подлинности для сканирования

Существует только один способ настройки проверки подлинности для локальной среды SQL Server:

- Проверка подлинности SQL

### <a name="sql-authentication"></a>Проверка подлинности SQL

Учетная запись SQL должна иметь доступ к базе данных **master** . Это обусловлено тем, что `sys.databases` находится в базе данных master. Сканер зрения должен выполнить перечисление, `sys.databases` чтобы найти все базы данных SQL на сервере.

#### <a name="using-an-existing-server-administrator"></a>Использование существующего администратора сервера

Если вы планируете использовать существующего пользователя администратора сервера (SA) для сканирования локального сервера SQL Server, убедитесь в следующем:

1. `sa` не является учетной записью проверки подлинности Windows.

2. Имя входа на уровне сервера, которое вы планируете использовать, должно иметь роли сервера public и sysadmin. Это можно проверить, подключившись к серверу, перейдя к SQL Server Management Studio (SSMS), перейдя в раздел Безопасность, выбрав имя входа, которое вы планируете использовать, щелкнув правой кнопкой мыши **Свойства** и выбрав пункт **роли сервера**.

   :::image type="content" source="media/register-scan-on-premises-sql-server/server-level-login.png" alt-text="Имя входа на уровне сервера.":::

#### <a name="creating-a-new-login-and-user"></a>Создание нового имени входа и пользователя

Если вы хотите создать новое имя входа и пользователя для проверки SQL Server, выполните следующие действия:

> [!Note]
    > Все приведенные ниже действия можно выполнить с помощью приведенного [здесь](https://github.com/Azure/Purview-Samples/blob/master/TSQL-Code-Permissions/grant-access-to-on-prem-sql-databases.sql)кода.

1. Перейдите к SQL Server Management Studio (SSMS), подключитесь к серверу, перейдите к разделу Безопасность, щелкните правой кнопкой мыши имя входа и создайте новое имя входа. Убедитесь, что выбрана проверка подлинности SQL.

   :::image type="content" source="media/register-scan-on-premises-sql-server/create-new-login-user.png" alt-text="Создайте новое имя входа и пользователя.":::

2. Выберите роли сервера в левой области навигации и убедитесь, что назначена роль public.

3. Выберите сопоставление пользователей в левой области навигации, выберите все базы данных на карте и выберите роль базы данных: **db_datareader**.

   :::image type="content" source="media/register-scan-on-premises-sql-server/user-mapping.png" alt-text="Сопоставление пользователей.":::

4. Нажмите кнопку ОК, чтобы сохранить изменения.

5. Снова перейдите к созданному пользователю, щелкнув правой кнопкой мыши и выбрав пункт **Свойства**. Введите новый пароль и подтвердите его. Выберите параметр "укажите старый пароль" и введите старый пароль. **Пароль необходимо изменить сразу после создания нового имени входа.**

   :::image type="content" source="media/register-scan-on-premises-sql-server/change-password.png" alt-text="изменение пароля.":::

#### <a name="storing-your-sql-login-password-in-a-key-vault-and-creating-a-credential-in-purview"></a>Хранение пароля имени входа SQL в хранилище ключей и создание учетных данных в зрения

1. Перейдите в хранилище ключей в Azure portal1. Выберите **Параметры > Секреты**.
1. Выберите **+ создать/импортировать** и введите **имя** и **значение** в качестве *пароля* для имени входа SQL Server.
1. Чтобы завершить процесс, щелкните **Создать**.
1. Если хранилище ключей еще не подключено к службе Purview, вам придется [создать новое подключение к хранилищу ключей](manage-credentials.md#create-azure-key-vaults-connections-in-your-azure-purview-account).
1. Наконец, [создайте новые учетные данные](manage-credentials.md#create-a-new-credential) для сканирования, указав **имя пользователя** и **пароль**.

## <a name="register-a-sql-server-data-source"></a>Регистрация источника данных SQL Server

1. Перейдите к учетной записи Purview.

1. В разделе источники и сканирование в левой области навигации выберите **среды выполнения интеграции**. Убедитесь, что локальная среда выполнения интеграции настроена. Если она не настроена, выполните описанные [здесь](manage-integration-runtimes.md) действия, чтобы создать локальную среду выполнения интеграции для проверки на локальной или виртуальной машине Azure, которая имеет доступ к локальной сети.

1. В области навигации слева выберите **Источники**.

1. Нажмите кнопку **Зарегистрировать**.

1. Выберите **SQL Server** , а затем **Продолжайте**

   :::image type="content" source="media/register-scan-on-premises-sql-server/set-up-sql-data-source.png" alt-text="Настройте источник данных SQL.":::

5. Укажите понятное имя и конечную точку сервера, а затем нажмите кнопку **Готово** , чтобы зарегистрировать источник данных. Например, если полное доменное имя SQL Server — **foobar.Database.Windows.NET**, введите *foobar* в качестве конечной точки сервера.

[!INCLUDE [create and manage scans](includes/manage-scans.md)]

## <a name="next-steps"></a>Дальнейшие действия

- [Обзор каталога данных Azure Purview](how-to-browse-catalog.md)
- [Поиск по каталогу данных Azure Purview](how-to-search-catalog.md)
