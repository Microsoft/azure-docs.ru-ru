---
title: Подключение к фабрике данных Azure
description: В этой статье описывается, как подключить фабрику данных Azure и Azure зрения для контроля журнала преобразований данных.
author: chanuengg
ms.author: csugunan
ms.service: purview
ms.subservice: purview-data-catalog
ms.topic: how-to
ms.date: 11/22/2020
ms.openlocfilehash: 0e993cb1e53645f7081a20fc6a2785b8cfef1cce
ms.sourcegitcommit: 4e70fd4028ff44a676f698229cb6a3d555439014
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/28/2021
ms.locfileid: "98954194"
---
# <a name="how-to-connect-azure-data-factory-and-azure-purview"></a>Подключение фабрики данных Azure и Azure зрения

В этом документе объясняются шаги, необходимые для подключения учетной записи фабрики данных Azure к учетной записи Azure зрения для мониторинга журнала преобразований данных. Документ также получает сведения о области охвата и поддерживаемых шаблонах журнала преобразований.

## <a name="view-existing-data-factory-connections"></a>Просмотр существующих подключений фабрики данных

Несколько фабрик данных Azure могут подключаться к одному каталогу данных Azure зрения для отправки сведений об журналах обращений и преобразований. Текущее ограничение позволяет подключать десять учетных записей фабрики данных за раз в центре управления зрения. Чтобы отобразить список учетных записей фабрики данных, подключенных к каталогу данных зрения, выполните следующие действия.

1. В области навигации слева выберите **центр управления** .
2. В разделе **внешние подключения** выберите **Подключение к фабрике данных**.
3. Откроется список подключения фабрики данных.

    :::image type="content" source="./media/how-to-link-azure-data-factory/data-factory-connection.png" alt-text="Снимок экрана: список подключений фабрики данных." lightbox="./media/how-to-link-azure-data-factory/data-factory-connection.png":::

4. Обратите внимание на различные значения для **состояния** подключения:

    - **Подключено**: фабрика данных подключена к каталогу данных.
    - **Отключено**. фабрика данных имеет доступ к каталогу, но она подключена к другому каталогу. В результате журнал преобразований данных не будет автоматически передаваться в каталог.
    - **Каннотакцесс**: текущий пользователь не имеет доступа к фабрике данных, поэтому состояние подключения неизвестно.
 >[!Note]
 >Чтобы просмотреть подключения фабрики данных, необходимо назначить одну из зрения ролей:
 >- Участник
 >- Владелец
 >- Читатель
 >- Администратор доступа пользователей

## <a name="create-new-data-factory-connection"></a>Создание нового подключения к фабрике данных

>[!Note]
>Чтобы добавить или удалить подключения к фабрике данных, необходимо назначить одну из зрения ролей:
>- Владелец
>- Администратор доступа пользователей
>
> Кроме того, он требует, чтобы пользователи были "владельцем" или "участником" фабрики данных. 

Выполните следующие действия, чтобы подключить существующие учетные записи фабрики данных к каталогу данных зрения.

1. В области навигации слева выберите **центр управления** .
2. В разделе **внешние подключения** выберите **Подключение к фабрике данных**.
3. На странице **Подключение к фабрике данных** выберите **создать**.

4. Выберите в списке свою учетную запись фабрики данных и нажмите кнопку **ОК**. Можно также выполнить фильтрацию по имени подписки, чтобы ограничить список.

    :::image type="content" source="./media/how-to-link-azure-data-factory/connect-data-factory.png" alt-text="Снимок экрана, показывающий, как подключить фабрику данных Azure." lightbox="./media/how-to-link-azure-data-factory/connect-data-factory.png":::

    Некоторые экземпляры фабрики данных могут быть отключены, если фабрика данных уже подключена к текущей учетной записи зрения или у фабрики данных нет управляемого удостоверения.

    Появится предупреждающее сообщение, если какая-либо из выбранных фабрик данных уже подключена к другой учетной записи зрения. После нажатия кнопки "ОК" подключение фабрики данных к другой учетной записи зрения будет разорвано. Дополнительные подтверждения не требуются.


    :::image type="content" source="./media/how-to-link-azure-data-factory/warning-for-disconnect-factory.png" alt-text="Снимок экрана, показывающий предупреждение для отключения фабрики данных Azure." lightbox="./media/how-to-link-azure-data-factory/warning-for-disconnect-factory.png":::

>[!Note]
>Теперь поддерживается добавление не более 10 фабрик данных одновременно. Если вы хотите добавить более 10 фабрик данных одновременно, отправьте запрос в службу поддержки.

### <a name="how-does-the-authentication-work"></a>Как работает проверка подлинности?

Когда пользователь зрения регистрирует фабрику данных, к которой у них есть доступ, в серверной части происходит следующее:

1. **MSI фабрики данных** добавляется в роль зрения RBAC: **зрения Data пленку**.

    :::image type="content" source="./media/how-to-link-azure-data-factory/adf-msi.png" alt-text="Снимок экрана, показывающий MSI фабрики данных Azure." lightbox="./media/how-to-link-azure-data-factory/adf-msi.png":::
     
2. Конвейер фабрики данных должен быть выполнен повторно, чтобы метаданные журнала преобразований могли быть переданы обратно в зрения.
3. После выполнения метаданные фабрики данных помещаются в зрения.

### <a name="remove-data-factory-connections"></a>Удаление подключений фабрики данных
Чтобы удалить подключение фабрики данных, выполните следующие действия.

1. На странице **Подключение к фабрике данных** нажмите кнопку **Удалить** рядом с одним или несколькими подключениями к фабрике данных.
2. Выберите пункт **подтвердить** во всплывающем окне, чтобы удалить выбранные подключения к фабрике данных.

    :::image type="content" source="./media/how-to-link-azure-data-factory/remove-data-factory-connection.png" alt-text="Снимок экрана, показывающий, как выбрать фабрики данных для удаления подключения." lightbox="./media/how-to-link-azure-data-factory/remove-data-factory-connection.png":::

## <a name="configure-a-self-hosted-ir-to-collect-lineage-from-on-prem-sql"></a>Настройка автономного IR для получения журнала обращений и преобразований из локального SQL

Журнал преобразований для действия копирования фабрики данных доступен для локальных баз данных SQL. Если вы используете локальную среду выполнения интеграции для перемещения данных с помощью фабрики данных Azure и хотите захватить журнал обращений и преобразований в Azure зрения, убедитесь, что используется версия 4.8.7418.1 или более поздняя. Дополнительные сведения о локальной среде выполнения интеграции см. в разделе [Создание и Настройка локальной среды выполнения интеграции](../data-factory/create-self-hosted-integration-runtime.md).

## <a name="supported-azure-data-factory-activities"></a>Поддерживаемые действия фабрики данных Azure

Azure зрения захватывает журналы выполнения из следующих действий фабрики данных Azure:

- Копирование данных
- Поток данных
- Выполнение пакетов служб SSIS

> [!IMPORTANT]
> Azure зрения удаляет журнал обращений и преобразований, если в источнике или назначении используется неподдерживаемая система хранения данных.

Интеграция фабрики данных и зрения поддерживает только подмножество систем данных, поддерживаемых фабрикой данных, как описано в следующих разделах.

### <a name="data-factory-copy-data-support"></a>Поддержка Копирование данных фабрики данных

| Система хранения данных | Поддерживается в качестве источника | Поддерживается в качестве приемника |
| ------------------- | ------------------- | ----------------- |
| ADLS 1-го поколения | Да | Да (только для копирования без двоичного файла) |
| ADLS 2-го поколения | Да | Да |
| Большой двоичный объект Azure | Да | Да |
| Azure Cosmos DB (API SQL) | Да | Да |
| Azure Cosmos DB (API Mongo) | Да | Да |
| Когнитивный поиск Azure | Да | Да |
| Azure Data Explorer | Да | Да |
| База данных Azure для Марии \* | Да | Да |
| База данных Azure для MYSQL \* | Да | Да |
| База данных Azure для PostgreSQL \* | Да | Да |
| Хранилище файлов Azure | Да | Да |
| Хранилище таблиц Azure | Да | Да |
| База данных SQL Azure \* | Да | Да |
| SQL Azure MI \* | Да | Да |
| Azure синапсе Analytics (ранее — хранилище данных SQL) \* | Да | Да |
| Локальный SQL Server (требуется шир) \* | Да | Да |
| Amazon S3 | Да | Да |
| Teradata | Да | Да |
| SAP S4 Hana | Да | Да |
| SAP ECC | Да | Да |
| Hive | Да | Да |

> [!Note]
> Функция журнала обращений и преобразований имеет определенные издержки на производительность в действии копирования фабрики данных. Для тех, кто настраивает подключения фабрики данных в зрения, вы можете наблюдать за определенными заданиями копирования, которые занимают больше времени. В основном это влияние на незначительное воздействие. Обратитесь в службу поддержки со сравнением времени, если выполнение заданий копирования значительно дольше, чем обычно.

### <a name="data-factory-data-flow-support"></a>Поддержка потока данных фабрики данных

| Система хранения данных | Поддерживается |
| ------------------- | ------------------- | ----------------- |
| ADLS 1-го поколения | Да |
| ADLS 2-го поколения | Да |
| Большой двоичный объект Azure | Да |
| База данных SQL Azure \* | Да |
| Azure синапсе Analytics (ранее — хранилище данных SQL) \* | Да |

### <a name="data-factory-execute-ssis-package-support"></a>Поддержка пакетов служб SSIS в фабрике данных

| Система хранения данных | Поддерживается |
| ------------------- | ------------------- | ----------------- |
| Большой двоичный объект Azure | Да |
| ADLS 1-го поколения | Да |
| ADLS 2-го поколения | Да |
| База данных SQL Azure \* | Да |
| SQL Azure MI \*| Да |
| Azure синапсе Analytics (ранее — хранилище данных SQL) \* | Да |
| Локальная SQL Server \* | Да |
| Хранилище файлов Azure | Да |

*\* Для сценариев SQL (в Azure и в локальной среде) Azure зрения не поддерживает хранимые процедуры и скрипты для журнала преобразований или проверки. Журнал преобразований ограничен только источниками таблиц и представлений.*

> [!Note]
> Платформа Azure Data Lake Storage 2-го поколения теперь общедоступна. Мы рекомендуем приступить к ее использованию уже сегодня. См. сведения на [странице продукта](https://azure.microsoft.com/en-us/services/storage/data-lake-storage/).

## <a name="supported-lineage-patterns"></a>Поддерживаемые шаблоны журнала обращений и преобразований

Существует несколько шаблонов журнала преобразований, поддерживаемых Azure зрения. Созданные данные журнала обращений и преобразований основаны на типе источника и приемника, используемого в действиях фабрики данных. Хотя фабрика данных поддерживает более 80 источников и приемников, Azure зрения поддерживает только подмножество, указанное в списке [поддерживаемых действий фабрики данных Azure](#supported-azure-data-factory-activities).

Сведения о настройке фабрики данных для отправки сведений журнала обращений и преобразований см. в статье [Приступая к работе](catalog-lineage-user-guide.md#get-started-with-lineage)

Некоторые дополнительные способы поиска информации в представлении журнала преобразований включают следующее:

- На вкладке **журнал обращений** наведите указатель на фигуры, чтобы просмотреть дополнительные сведения о ресурсе в подсказке.
- Выберите узел или ребро, чтобы просмотреть тип ресурса, которому он принадлежит, или переключить активы.
- Столбцы набора данных отображаются в левой части вкладки " **Журнал преобразований** ". Дополнительные сведения о преобразовании на уровне столбцов см. в разделе [Журнал преобразований на уровне столбцов](catalog-lineage-user-guide.md#column-level-lineage).

### <a name="data-lineage-for-11-operations"></a>Журнал преобразований данных для операций 1:1

Наиболее распространенный шаблон для записи журнала преобразований данных — перемещение данных из одного входного набора данных в один выходной набор данных с процессом между.

Ниже приведен пример такого шаблона.

- 1 источник/входные данные: *клиент* (таблица SQL)
- 1 приемник/выход: *Customer1.csv* (BLOB-объект Azure)
- 1 процесс: *CopyCustomerInfo1 \#Customer1.csv* (действие копирования фабрики данных)

:::image type="content" source="./media/how-to-link-azure-data-factory/adf-copy-lineage.png" alt-text="Снимок экрана, показывающий журнал преобразований для одной операции копирования фабрики данных." lightbox="./media/how-to-link-azure-data-factory/adf-copy-lineage.png":::

### <a name="data-movement-with-11-lineage-and-wildcard-support"></a>Перемещение данных с использованием журнала преобразований 1:1 и поддержки подстановочных знаков

Другой распространенный сценарий для сбора журнала преобразований — использование подстановочного знака для копирования файлов из одного входного набора данных в один выходной набор данных. Подстановочный знак позволяет действию копирования сопоставлять несколько файлов для копирования, используя общую часть имени файла. Azure зрения захватывает журнал преобразований на уровне файлов для каждого отдельного файла, скопированного соответствующим действием копирования.

Ниже приведен пример такого шаблона.

* Источник/вход: *кустомеркалл \* . csv* (путь ADLS 2-го поколения)
* Приемник/вывод: *кустомеркалл \* . csv* (файл большого двоичного объекта Azure)
* 1 процесс: *CopyGen2ToBlob \#CustomerCall.csv* (действие копирования фабрики данных)  

:::image type="content" source="./media/how-to-link-azure-data-factory/adf-copy-lineage-wildcard.png" alt-text="Снимок экрана, показывающий журнал обращений и преобразований для одной операции копирования с поддержкой подстановочных знаков." lightbox="./media/how-to-link-azure-data-factory/adf-copy-lineage-wildcard.png":::

### <a name="data-movement-with-n1-lineage"></a>Перемещение данных с помощью журнала преобразований n:1

Действия потока данных можно использовать для выполнения операций с данными, таких как слияние, объединение и т. д. Для создания целевого набора данных можно использовать более одного исходного набора данных. В этом примере Azure зрения захватывает журнал преобразований на уровне файлов для отдельных входных файлов в таблицу SQL, которая является частью действия потока данных.

Ниже приведен пример такого шаблона.

* 2 источника/входные данные: *Customer.csv*, *Sales. parquet* (путь ADLS 2-го поколения)
* 1 приемник/выход: *данные организации* (таблица SQL Azure)
* 1 процесс: *датафловблобстоскл* (действие потока данных фабрики данных)

:::image type="content" source="./media/how-to-link-azure-data-factory/adf-data-flow-lineage.png" alt-text="Снимок экрана, показывающий журнал обращений и преобразований для n в одну операцию потока данных D F." lightbox="./media/how-to-link-azure-data-factory/adf-data-flow-lineage.png":::

### <a name="lineage-for-resource-sets"></a>Журнал обращений и преобразований для наборов ресурсов

Набор ресурсов — это логический объект в каталоге, который представляет многие файлы разделов в базовом хранилище. Дополнительные сведения см. в разделе [Основные сведения о наборах ресурсов](concept-resource-sets.md). Когда Azure зрения захватывает журналы обращений и преобразований из фабрики данных Azure, применяет правила для нормализации отдельных файлов секций и создания одного логического объекта.

В следующем примере набор ресурсов Azure Data Lake Gen2 создается из большого двоичного объекта Azure:

* 1 источник/вход: *\_management.csvсотрудника* (BLOB-объект Azure)
* 1 приемник/вывод: *\_management.csvсотрудников* (Azure Data Lake Gen 2)
* 1 процесс: *CopyBlobToAdlsGen2 \_ RS* (действие копирования фабрики данных)

:::image type="content" source="./media/how-to-link-azure-data-factory/adf-resource-set-lineage.png" alt-text="Снимок экрана, показывающий журнал обращений и преобразований для набора ресурсов." lightbox="./media/how-to-link-azure-data-factory/adf-resource-set-lineage.png":::

## <a name="next-steps"></a>Дальнейшие действия

- [Пользовательская структура журнала преобразований каталога](catalog-lineage-user-guide.md)
- [Ссылка на общую папку данных Azure для журнала обращений и преобразований](how-to-link-azure-data-share.md)
