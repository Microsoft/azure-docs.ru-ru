---
title: Подключение к хранилищу BLOB-объектов Azure
description: Создание больших двоичных объектов и управление ими в учетных записях хранения Azure с помощью Azure Logic Apps
services: logic-apps
ms.suite: integration
ms.reviewer: klam, logicappspm
ms.topic: conceptual
ms.date: 02/21/2020
tags: connectors
ms.openlocfilehash: cd23ff0f5ad9912440d38903a344011b069aaf16
ms.sourcegitcommit: 910a1a38711966cb171050db245fc3b22abc8c5f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "92677731"
---
# <a name="create-and-manage-blobs-in-azure-blob-storage-by-using-azure-logic-apps"></a>Создание больших двоичных объектов и управление ими в хранилище BLOB-объектов Azure с помощью Azure Logic Apps

В этой статье описано, как получить доступ к файлам, хранящимся в виде больших двоичных объектов в учетной записи хранения Azure, из приложения логики с помощью соединителя хранилища BLOB-объектов Azure. Таким образом можно создавать приложения логики, которые автоматизируют задачи и рабочие процессы по управлению файлами. Например, можно создавать приложения логики, которые создают, получают, обновляют и удаляют файлы в вашей учетной записи хранения.

Предположим, что у вас есть средство, которое обновляется на веб-сайте Azure. Оно используется как триггер для приложения логики. Когда это событие происходит, приложение логики может обновить некоторые файлы в контейнере хранилища BLOB-объектов, что является действием в приложении логики.

Если вы не знакомы с приложениями логики, ознакомьтесь со статьями [Что такое Azure Logic Apps](../logic-apps/logic-apps-overview.md) и [Краткое руководство. Создание первого автоматизированного рабочего процесса с помощью Azure Logic Apps на портале Azure](../logic-apps/quickstart-create-first-logic-app-workflow.md). См. технические сведения о [соединителях хранилища BLOB-объектов Azure](/connectors/azureblobconnector/).

> [!IMPORTANT]
> Приложения логики не могут напрямую обращаться к учетным записям хранения, которые находятся за брандмауэрами, если они находятся в одном регионе. В качестве обходного решения можно использовать приложения логики и учетную запись хранения в разных регионах. Дополнительные сведения о включении доступа из Azure Logic Apps к учетным записям хранения, защищенным брандмауэрами, см. в подразделе [доступ к учетным записям хранения, защищенным брандмауэрами](#storage-firewalls) далее в этом разделе.

<a name="blob-storage-limits"></a>

## <a name="limits"></a>Ограничения

* По умолчанию действия хранилища BLOB-объектов Azure могут считывать или записывать файлы размером *50 МБ или меньше*. Чтобы обрабатывались файлы размером более 50 МБ, но до 1024 МБ, действия хранилища BLOB-объектов Azure поддерживают [фрагментацию сообщений](../logic-apps/logic-apps-handle-large-messages.md). Действие **Получение содержимого BLOB-объекта** неявно использует фрагментацию.

* Триггеры хранилища BLOB-объектов Azure не поддерживают фрагментацию. При запросе содержимого файла триггеры выбирают только файлы размером 50 МБ или меньше. Чтобы получить файлы размером более 50 МБ, следуйте приведенному ниже шаблону:

  * Используйте триггер хранилища BLOB-объектов Azure, который возвращает свойства файла, например **при добавлении или изменении большого двоичного объекта (только свойства)**.

  * Следуйте указаниям триггера с действием **Получение содержимого BLOB** -объекта в хранилище BLOB-объектов Azure, которое считывает полный файл и неявно использует фрагментацию.

## <a name="prerequisites"></a>Предварительные требования

* Подписка Azure. Если у вас еще нет подписки Azure, [зарегистрируйтесь для получения бесплатной учетной записи Azure](https://azure.microsoft.com/free/).

* [Учетная запись хранения Azure и контейнер хранилища.](../storage/blobs/storage-quickstart-blobs-portal.md)

* Приложения логики с возможностью доступа к учетной записи хранилища BLOB-объектов Azure. Чтобы запустить приложение логики с помощью триггера хранилища BLOB-объектов Azure, требуется [пустое приложение логики](../logic-apps/quickstart-create-first-logic-app-workflow.md).

<a name="add-trigger"></a>

## <a name="add-blob-storage-trigger"></a>Добавление триггера хранилища BLOB-объектов

В Azure Logic Apps каждое приложение логики должно запускаться по [триггеру](../logic-apps/logic-apps-overview.md#logic-app-concepts), который активируется, когда происходит определенное событие или если выполняются заданные условия. При каждом срабатывании триггера обработчик Logic Apps создает экземпляр приложения логики, запускающий рабочий процесс.

В этом примере показано, как можно запустить рабочий процесс приложения логики с помощью **при добавлении или изменении большого двоичного объекта (только свойства)** , когда свойства большого двоичного объекта добавляются или обновляются в контейнере хранилища.

1. В [портал Azure](https://portal.azure.com) или Visual Studio создайте пустое приложение логики, открывающее конструктор приложений логики. В этом примере используется портал Azure.

2. В поле поиска введите "большой двоичный объект azure" в качестве условия фильтра. В списке триггеров выберите нужный триггер.

   В этом примере используется этот триггер: **при добавлении или изменении большого двоичного объекта (только свойства)**

   ![Выбор триггера хранилища BLOB-объектов Azure](./media/connectors-create-api-azureblobstorage/add-azure-blob-storage-trigger.png)

3. Если вам будет предложено ввести сведения о подключении, [создайте подключение к хранилищу BLOB-объектов](#create-connection). Или, если подключение уже существует, введите необходимые сведения для триггера.

   Для этого примера выберите контейнер и папку, которую вы хотите отслеживать.

   1. В поле **Контейнер** выберите значок папки.

   2. В списке Папка выберите правую угловую скобку ( **>** ), а затем перейдите к нужной папке, чтобы найти и выбрать нужную папку.

      ![Выбор папки хранилища для использования с триггером](./media/connectors-create-api-azureblobstorage/trigger-select-folder.png)

   3. Укажите частоту и продолжительность, с которыми триггер будет проверять изменения в папке.

4. Завершив работу, нажмите кнопку **Сохранить** на панели инструментов конструктора.

5. Теперь продолжайте добавлять действия в приложение логики для задач, которые необходимо выполнить с результатами триггера.

<a name="add-action"></a>

## <a name="add-blob-storage-action"></a>Добавление действия хранилища BLOB-объектов

В Azure Logic Apps [действие](../logic-apps/logic-apps-overview.md#logic-app-concepts) — это шаг в рамках рабочего процесса, выполняемый после срабатывания триггера или другого действия. В этом примере приложение логики запускается при срабатывании [триггера повторения](../connectors/connectors-native-recurrence.md).

1. На [портале Azure](https://portal.azure.com) или в Visual Studio откройте приложение логики в конструкторе приложений логики. В этом примере используется портал Azure.

2. В конструкторе приложений логики в разделе триггер или действие выберите **новый шаг**.

   ![Добавление нового шага в рабочий процесс приложения логики](./media/connectors-create-api-azureblobstorage/add-new-step-logic-app-workflow.png) 

   Чтобы добавить действие между существующими шагами, наведите указатель мыши на соединяющую стрелку. Выберите отображаемый знак плюса ( **+** ) и щелкните **Добавить действие**.

3. В поле поиска введите "большой двоичный объект azure" в качестве условия фильтра. В списке действий выберите любое необходимое действие.

   В этом примере используется это действие: **Получение содержимого BLOB-объекта**

   ![Выбор действия хранилища BLOB-объектов Azure](./media/connectors-create-api-azureblobstorage/add-azure-blob-storage-action.png)

4. Если вам будет предложено ввести сведения о подключении, [создайте подключение к хранилищу BLOB-объектов Azure](#create-connection).
Или, если подключение уже существует, введите необходимые сведения для действия.

   Для этого примера выберите нужный файл.

   1. В поле **Большой двоичный объект** выберите значок папки.
  
      ![Выбор папки хранилища для использования с действием](./media/connectors-create-api-azureblobstorage/action-select-folder.png)

   2. Найдите и выберите нужный файл на основе **идентификатора** BLOB-объекта. Этот номер **идентификатора** можно найти в метаданных большого двоичного объекта, который возвращается ранее описанным триггером хранилища BLOB-объектов.

5. Завершив работу, нажмите кнопку **Сохранить** на панели инструментов конструктора.
Для тестирования приложения логики выбранная папка должна содержать большой двоичный объект.

В этом примере возвращается только содержимое большого двоичного объекта. Чтобы просмотреть содержимое, добавьте другое действие для создания файла с большим двоичным объектом c использованием другого соединителя. Например, добавьте действие OneDrive, которое создает файл на основе содержимого большого двоичного объекта.

<a name="create-connection"></a>

## <a name="connect-to-storage-account"></a>Подключение к учетной записи хранилища

[!INCLUDE [Create connection general intro](../../includes/connectors-create-connection-general-intro.md)]

1. При появлении запроса на создание подключения укажите следующие сведения:

   | Свойство | Обязательно | Значение | Описание |
   |----------|----------|-------|-------------|
   | **Имя соединения** | Да | <*имя соединения*> | Имя создаваемого подключения |
   | **Учетная запись хранения** | Да | <*Учетная запись хранения*> | Выберите свою учетную запись хранения в списке. |
   ||||

   Пример:

   ![Создание подключения к учетной записи хранилища BLOB-объектов Azure](./media/connectors-create-api-azureblobstorage/create-storage-account-connection.png) 

1. Когда будете готовы, нажмите кнопку **создать** .

1. После создания подключения продолжите действие [Добавление триггера хранилища BLOB-объектов](#add-trigger) или [Добавление хранилища BLOB-объектов](#add-action).

## <a name="connector-reference"></a>Справочник по соединителям

Дополнительные технические сведения об этом соединителе, такие как триггеры, действия и ограничения, описанные в файле Swagger соединителя, см. на [странице справочника по соединителю](/connectors/azureblobconnector/).

> [!NOTE]
> Для приложений логики в [среде службы интеграции (ISE)](../logic-apps/connect-virtual-network-vnet-isolated-environment-overview.md)эта версия этого соединителя использует [ограничения сообщений интегрированной](../logic-apps/logic-apps-limits-and-config.md#message-size-limits) среды сценариев.

<a name="storage-firewalls"></a>

## <a name="access-storage-accounts-behind-firewalls"></a>Доступ к учетным записям хранения за брандмауэром

Вы можете добавить сетевую безопасность в учетную запись хранения Azure, запретив доступ с помощью [правил брандмауэра и брандмауэра](../storage/common/storage-network-security.md). Однако эта программа установки создает запрос для Azure и других служб Майкрософт, которым требуется доступ к учетной записи хранения. Локальное взаимодействие в центре обработки данных приводит к абстракции внутренних IP-адресов, поэтому не удается настроить правила брандмауэра с ограничениями IP-адресов. Дополнительные сведения см. в статье [Настройка брандмауэров службы хранилища Azure и виртуальных сетей](../storage/common/storage-network-security.md).

Ниже приведены различные варианты доступа к учетным записям хранения, защищенным брандмауэрами, от Azure Logic Apps с помощью соединителя хранилища BLOB-объектов Azure или других решений.

* Соединитель больших двоичных объектов службы хранилища Azure

  * [Доступ к учетным записям хранения в других регионах](#access-other-regions)
  * [Доступ к учетным записям хранения через доверенную виртуальную сеть](#access-trusted-virtual-network)

* Другие решения

  * [Доступ к учетным записям хранения как к доверенной службе с управляемыми удостоверениями](#access-trusted-service)
  * [Доступ к учетным записям хранения с помощью службы управления API Azure](#access-api-management)

<a name="access-other-regions"></a>

### <a name="problems-accessing-storage-accounts-in-the-same-region"></a>Проблемы с доступом к учетным записям хранения в одном регионе

Приложения логики не могут напрямую обращаться к учетным записям хранения, защищенным брандмауэром, если они находятся в одном регионе. В качестве обходного решения разместите приложения логики в регионе, который отличается от учетной записи хранения, и предоставьте доступ к [исходящим IP-адресам для управляемых соединителей в вашем регионе](../logic-apps/logic-apps-limits-and-config.md#outbound).

> [!NOTE]
> Это решение не относится к соединителю хранилища таблиц Azure и соединителю хранилища очередей Azure. Вместо этого для доступа к хранилищу таблиц или хранилищу очередей используйте встроенный триггер HTTP и действия.

<a name="access-trusted-virtual-network"></a>

### <a name="access-storage-accounts-through-a-trusted-virtual-network"></a>Доступ к учетным записям хранения через доверенную виртуальную сеть

Учетную запись хранения можно поместить в виртуальную сеть Azure, которую вы управляете, а затем добавить эту виртуальную сеть в список Доверенные виртуальные сети. Чтобы приложение логики имело доступ к учетной записи хранения через [доверенную виртуальную сеть](../virtual-network/virtual-networks-overview.md), необходимо развернуть это приложение логики в [среде службы интеграции (ISE)](../logic-apps/connect-virtual-network-vnet-isolated-environment-overview.md), которая может подключаться к ресурсам в виртуальной сети. Затем можно добавить подсети из этой ИНТЕГРИРОВАНной среды в список доверенных. Соединители хранилища Azure, такие как соединитель хранилища BLOB-объектов, могут напрямую обращаться к контейнеру хранилища. Эта настройка аналогична использованию конечных точек службы из интегрированной среды сценариев.

<a name="access-trusted-service"></a>

### <a name="access-storage-accounts-as-a-trusted-service-with-managed-identities"></a>Доступ к учетным записям хранения как к доверенной службе с управляемыми удостоверениями

Чтобы предоставить доверенным службам Майкрософт доступ к учетной записи хранения через брандмауэр, можно настроить для этих служб исключение в этой учетной записи хранения. Это решение позволяет службам Azure, поддерживающим [управляемые удостоверения, осуществлять аутентификацию](../active-directory/managed-identities-azure-resources/overview.md) для доступа к учетным записям хранения за брандмауэром в качестве доверенных служб. В частности, для приложения логики в глобальном нескольких клиентах Azure для доступа к этим учетным записям хранения сначала необходимо [включить поддержку управляемого удостоверения](../logic-apps/create-managed-service-identity.md) в приложении логики. Затем вы используете действие HTTP или триггер в приложении логики и [устанавливаете тип проверки подлинности для использования управляемого удостоверения приложения логики](../logic-apps/create-managed-service-identity.md#authenticate-access-with-managed-identity). В этом сценарии можно использовать *только* действие HTTP или триггер.

Чтобы настроить поддержку управляемых удостоверений и исключений, выполните следующие действия.

1. В учетной записи хранения в разделе **Параметры** выберите **брандмауэры и виртуальные сети**. В разделе **Разрешить доступ из** выберите вариант **Выбранные сети** , чтобы отобразить соответствующие параметры.

1. В разделе **исключения** выберите **разрешить доверенным службам Майкрософт доступ к этой учетной записи хранения**, а затем нажмите кнопку **сохранить**.

   ![Выберите исключение, разрешающее Доверенные службы Майкрософт](./media/connectors-create-api-azureblobstorage/allow-trusted-services-firewall.png)

1. В параметрах приложения логики [включите поддержку управляемого удостоверения](../logic-apps/create-managed-service-identity.md).

1. В рабочем процессе приложения логики добавьте и настройте действие HTTP или триггер для доступа к учетной записи хранения или сущности.

   > [!IMPORTANT]
   > Для исходящих вызовов HTTP-действий или триггеров в учетные записи хранения Azure убедитесь, что заголовок запроса содержит `x-ms-version` свойство и версию API для операции, которую требуется выполнить в учетной записи хранения. Дополнительные сведения см. в статье [Аутентификация доступа с помощью управляемого удостоверения](../logic-apps/create-managed-service-identity.md#authenticate-access-with-managed-identity) и [управления версиями для служб хранилища Azure](/rest/api/storageservices/versioning-for-the-azure-storage-services#specifying-service-versions-in-requests).

1. В этом действии [выберите управляемое удостоверение](../logic-apps/create-managed-service-identity.md#authenticate-access-with-managed-identity) , которое будет использоваться для проверки подлинности.

<a name="access-api-management"></a>

### <a name="access-storage-accounts-through-azure-api-management"></a>Доступ к учетным записям хранения с помощью службы управления API Azure

Если вы используете выделенный уровень для [управления API](../api-management/api-management-key-concepts.md), вы можете использовать интерфейс API хранилища с помощью службы управления API и разрешить другим IP-адресам через брандмауэр. По сути, добавьте виртуальную сеть Azure, используемую службой управления API, в параметр брандмауэра учетной записи хранения. Затем можно использовать действие управления API или действие HTTP для вызова API-интерфейсов службы хранилища Azure. Однако при выборе этого параметра необходимо самостоятельно обработать процесс проверки подлинности. Дополнительные сведения см. в статье [Простая архитектура корпоративной интеграции](/azure/architecture/reference-architectures/enterprise-integration/basic-enterprise-integration).

## <a name="next-steps"></a>Дальнейшие действия

* См. дополнительные сведения о других [соединителях Logic Apps](../connectors/apis-list.md).