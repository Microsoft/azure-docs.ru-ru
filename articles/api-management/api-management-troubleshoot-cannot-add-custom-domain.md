---
title: Не удается добавить личный домен с помощью сертификата Key Vault
titleSuffix: Azure API Management
description: Узнайте, как устранить проблему, из-за которой нельзя добавить личный домен в службу управления API Azure с помощью сертификата хранилища ключей.
services: api-management
documentationcenter: ''
author: genlin
manager: dcscontentpm
editor: ''
ms.service: api-management
ms.workload: mobile
ms.tgt_pltfrm: na
ms.topic: article
ms.date: 07/19/2019
ms.author: tehnoonr
ms.openlocfilehash: a09c15466a4a9f62b2696b087cb7ab23cc767379
ms.sourcegitcommit: 867cb1b7a1f3a1f0b427282c648d411d0ca4f81f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "75430577"
---
# <a name="failed-to-update-api-management-service-hostnames"></a>Не удалось обновить имена узлов службы управления API

В этой статье описывается ошибка "не удалось обновить имена узлов службы управления API", которая может возникнуть при добавлении пользовательского домена для службы управления API Azure. В этой статье содержатся инструкции по устранению неполадок, которые помогут устранить проблему.

## <a name="symptoms"></a>Симптомы

При попытке добавить личный домен для службы управления API с помощью сертификата из Azure Key Vault появляется следующее сообщение об ошибке:

- Не удалось обновить имена узлов службы управления API. Сбой запроса к ресурсу " https://vaultname.vault.azure.net/secrets/secretname/?api-version=7.0 " с StatusCode: запрещено для RequestId:. Сообщение об исключении: операция вернула недопустимый код состояния "запрещено".

## <a name="cause"></a>Причина

Служба управления API не имеет разрешения на доступ к хранилищу ключей, которое вы пытаетесь использовать для личного домена.

## <a name="solution"></a>Решение

Для устранения этой проблемы выполните следующие действия:

1. Перейдите к [портал Azure](Https://portal.azure.com), выберите экземпляр управления API, а затем щелкните **управляемые удостоверения**. Убедитесь, что для параметра **Регистрация с Azure Active Directory** выбрано значение **Да**. 
    ![Регистрация в Azure Active Directory](./media/api-management-troubleshoot-cannot-add-custom-domain/register-with-aad.png)
1. В портал Azure откройте службу **хранилища ключей** и выберите хранилище ключей, которое вы пытаетесь использовать для личного домена.
1. Выберите **политики доступа** и проверьте наличие субъекта-службы, соответствующего имени экземпляра службы управления API. Если это так, выберите субъект-службу и убедитесь, что у него есть разрешение **Get** , указанное в разделе **разрешения секрета**.  
    ![Добавление политики доступа для субъекта-службы](./media/api-management-troubleshoot-cannot-add-custom-domain/access-policy.png)
1. Если служба управления API отсутствует в списке, выберите **Добавить политику доступа**, а затем создайте следующую политику доступа:
    - **Настройка из шаблона**: нет
    - **Выберите субъект**: найдите имя службы управления API, а затем выберите ее в списке.
    - **Разрешения ключа**: нет
    - **Разрешения секрета**: получение
    - **Разрешения сертификата**: нет
1. Нажмите кнопку **ОК** , чтобы создать политику доступа.
1. Выберите **Сохранить**, чтобы сохранить изменения.

Убедитесь, что проблема устранена. Для этого попытайтесь создать личный домен в службе управления API с помощью сертификата Key Vault.

## <a name="next-steps"></a>Дальнейшие действия
Дополнительные сведения о службе управления API:

- См. другие [видео](https://azure.microsoft.com/documentation/videos/index/?services=api-management) об управлении API.
* Другие способы защиты внутренней серверной службы см. в разделе [Взаимная проверка подлинности на основе сертификата](api-management-howto-mutual-certificates.md).

* [Создайте экземпляр службы управления API](get-started-create-service-instance.md).
* [Импорт и публикация первого API](import-and-publish.md)