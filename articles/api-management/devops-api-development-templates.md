---
title: CI/CD для управления API Azure с помощью шаблонов ARM
description: Общие сведения об API DevOps с помощью службы управления API Azure использование шаблонов Azure Resource Manager для управления развертываниями API в конвейере CI/CD
services: api-management
author: miaojiang
ms.service: api-management
ms.topic: conceptual
ms.date: 10/09/2020
ms.author: apimpm
ms.openlocfilehash: 62f163b9ce649cd5ddb52b4325682570633dfb92
ms.sourcegitcommit: 910a1a38711966cb171050db245fc3b22abc8c5f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "96183164"
---
# <a name="cicd-for-api-management-using-azure-resource-manager-templates"></a>CI/CD для управления API с помощью шаблонов Azure Resource Manager

В этой статье показано, как использовать API DevOps со службой управления API Azure с помощью шаблонов Azure Resource Manager. Благодаря стратегическому значению интерфейсов API конвейер непрерывной интеграции и непрерывного развертывания (CI/CD) стал важным аспектом разработки API. Она позволяет организациям автоматизировать развертывание изменений API без проблем, выполняемых вручную, выявлять проблемы ранее и в конечном итоге предоставлять пользователям более высокую ценность. 

Дополнительные сведения, средства и примеры кода для реализации подхода DevOps, описанного в этой статье, см. в разделе [набор ресурсов Azure API Management DevOps](https://github.com/Azure/azure-api-management-devops-resource-kit) с открытым исходным кодом в GitHub. Так как клиенты приносят широкий спектр инженерных языков и региональных параметров и существующих решений по автоматизации, этот подход не является единым решением.

## <a name="the-problem"></a>задачи;

Сегодня организации обычно имеют несколько сред развертывания (таких как разработка, тестирование и производство) и используют отдельные экземпляры управления API для каждой среды. Некоторые экземпляры совместно используются несколькими группами разработчиков, которые отвечают за различные API-интерфейсы с разными пределами выпуска.

В результате клиенты сталкиваются со следующими проблемами:

* Автоматизация развертывания API в службах управления API
* Перенос конфигураций из одной среды в другую
* Как избежать помех между разными командами разработчиков, которые совместно используют один и тот же экземпляр управления API

## <a name="manage-configurations-in-resource-manager-templates"></a>Управление конфигурациями в диспетчер ресурсов шаблонах

На следующем рисунке показан предлагаемый подход. 

:::image type="content" source="media/devops-api-development-templates/apim-devops.png" alt-text="Схема, на которой показано DevOps с управлением API.":::

В этом примере есть две среды развертывания: *Разработка* и *производство*. Каждый из них имеет собственный экземпляр управления API. 

* Разработчики API имеют доступ к экземпляру разработки и могут использовать его для разработки и тестирования своих API-интерфейсов. 
* Назначенная команда, именуемая *издателями API* , управляет рабочим экземпляром.

Ключом в этом предложенном подходе является обеспечение всех конфигураций управления API в [шаблонах Azure Resource Manager](../azure-resource-manager/templates/template-syntax.md). Организация должна соудерживать эти шаблоны в системе управления версиями, такой как Git. Как показано на рисунке, репозиторий издателя содержит все конфигурации производственного экземпляра управления API в коллекции шаблонов:

|Шаблон  |Описание  |
|---------|---------|
|Шаблон службы     | Конфигурации уровня служб для экземпляра службы управления API, такие как ценовая категория и личные домены.         |
|Общие шаблоны     |  Общие ресурсы на любом экземпляре управления API, например группы, продукты и средства ведения журнала.    |
|Шаблоны API     |  Конфигурации API-интерфейсов и их подресурсов: операции, политики, параметры диагностики.        |
|Шаблон главного (основного)     |   Связывает все вместе, [связываясь](../azure-resource-manager/templates/linked-templates.md) со всеми шаблонами и развертывая их по порядку. Чтобы развернуть все конфигурации в экземпляре управления API, разверните основной шаблон. Можно также развернуть каждый шаблон по отдельности.       |

Разработчики API развилкают репозиторий издателей в репозиторий для разработчиков и работают над изменениями своих API-интерфейсов. В большинстве случаев они сосредоточены на шаблонах API для своих API-интерфейсов и не требуют изменения шаблонов общего доступа или служб.

## <a name="migrate-configurations-to-templates"></a>Перенос конфигураций в шаблоны
Разработчики API сталкиваются с проблемами при работе с шаблонами диспетчер ресурсов:

* Разработчики API часто работают со [спецификацией OpenAPI](https://github.com/OAI/OpenAPI-Specification) и могут не быть знакомы с диспетчер ресурсов схемами. Создание шаблонов вручную может быть подвержено ошибкам. 

   Средство [Creator](https://github.com/Azure/azure-api-management-devops-resource-kit/blob/master/src/APIM_ARMTemplate/README.md#Creator) в наборе ресурсов помогает автоматизировать создание шаблонов API на основе открытого файла спецификации API. Кроме того, разработчики могут предоставлять политики управления API для API в формате XML. 

* Для клиентов, которые уже используют управление API, еще одной проблемой является извлечение существующих конфигураций в шаблоны диспетчер ресурсов. Для этих клиентов средство, именуемое средством [извлечения](https://github.com/Azure/azure-api-management-devops-resource-kit/blob/master/src/APIM_ARMTemplate/README.md#extractor) в комплекте ресурсов, может помочь создать шаблоны путем извлечения конфигураций из экземпляров управления API.  

## <a name="workflow"></a>Рабочий процесс

* После того как разработчики API закончили разработку и тестирование API и создали шаблоны API, они могут отправить запрос на вытягивание, чтобы объединить изменения в репозиторий издателя. 

* Издатели API могут проверить запрос на вытягивание и убедиться, что изменения являются надежными и совместимыми. Например, они могут проверять, разрешено ли подключение только по протоколу HTTPS к API. Большинство проверок можно автоматизировать как шаг в конвейере CI/CD.

* После того как изменения утверждены и успешно объединены, издатели API могут развернуть их в рабочем экземпляре по расписанию или по запросу. Развертывание шаблонов можно автоматизировать с помощью [действий GitHub](https://github.com/Azure/apimanagement-devops-samples), [Azure pipelines](/azure/devops/pipelines), [Azure PowerShell](../azure-resource-manager/templates/deploy-powershell.md), [Azure CLI](../azure-resource-manager/templates/deploy-cli.md)или других средств.


При таком подходе Организация может автоматизировать развертывание изменений API в экземплярах управления API, а изменения из одной среды в другую легко повысить. Поскольку разные группы разработчиков API будут работать с различными наборами шаблонов и файлов API, это предотвращает помехи между разными командами.

## <a name="video"></a>Видеоролик

> [!VIDEO https://www.youtube.com/embed/4Sp2Qvmg6j8]

## <a name="next-steps"></a>Дальнейшие действия

- Дополнительные сведения, средства и примеры шаблонов см. в разделе [Azure API Management DevOps Resource Kit](https://github.com/Azure/azure-api-management-devops-resource-kit) с открытым исходным кодом.