---
title: Версии в службе управления API Azure | Документация Майкрософт
description: Сведения о концепциях версий в службе управления API Azure.
services: api-management
documentationcenter: ''
author: johndowns
ms.service: api-management
ms.topic: article
ms.date: 02/10/2021
ms.author: jodowns
ms.custom: fasttrack-new
ms.openlocfilehash: 55951f288314d92cf5057e7d5c1e988f65cb3e14
ms.sourcegitcommit: 867cb1b7a1f3a1f0b427282c648d411d0ca4f81f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/20/2021
ms.locfileid: "102040385"
---
# <a name="versions-in-azure-api-management"></a>Версии в службе управления API Azure

Версии позволяют предоставлять разработчикам группы связанных API. Вы можете использовать версии для безопасного управления критическими изменениями в API. Клиенты могут использовать новую версию API, когда они будут готовы, а существующие клиенты продолжат использовать более старую версию. Версии отличаются по идентификатору версии (который является любым выбранным строковым значением), а схема управления версиями позволяет клиентам определить, какую версию API нужно использовать.

В большинстве случаев каждая версия API может считаться собственным независимой API. Две разные версии API могут иметь разные наборы операций и разные политики.

С помощью следующих версий можно:

- Одновременно опубликуйте несколько версий API.
- Используйте путь, строку запроса или заголовок, чтобы различать версии.
- Используйте любое строковое значение, чтобы указать версию, которая может быть числом, датой или именем.
- Отображение версий API, сгруппированных вместе на портале разработчика.
- Возьмите существующий API (без версии) и создайте его новую версию без нарушения работы существующих клиентов.

[Начните работу с версиями, следуя нашему пошаговому руководству.](./api-management-get-started-publish-versions.md)

## <a name="versioning-schemes"></a>Схемы управления версиями

Разные разработчики API имеют разные требования для управления версиями. Служба управления API Azure не предписывает один подход к управлению версиями, а вместо этого предоставляет несколько вариантов.

### <a name="path-based-versioning"></a>Управление версиями на основе пути

При использовании схемы управления версиями пути идентификатор версии должен быть включен в URL-путь для любых запросов API.

Например, `https://apis.contoso.com/products/v1` и `https://apis.contoso.com/products/v2` могут ссылаться на тот же `products` API, но и на версии `v1` и `v2` соответственно.

Формат URL-адреса запроса API при использовании управления версиями на основе пути: `https://{yourDomain}/{apiName}/{versionIdentifier}/{operationId}` .

### <a name="header-based-versioning"></a>Управление версиями на основе заголовков

При использовании схемы управления версиями заголовков идентификатор версии необходимо включать в заголовок HTTP-запроса для любых запросов API. Можно указать имя заголовка HTTP-запроса.

Например, можно создать пользовательский заголовок с именем `Api-Version` , а клиенты могут указать `v1` или `v2` в значении этого заголовка.

### <a name="query-string-based-versioning"></a>Управление версиями на основе строк запроса

При использовании схемы управления версиями строк запросов идентификатор версии необходимо включать в параметр строки запроса для любых запросов API. Можно указать имя параметра строки запроса.

При использовании управления версиями на основе строк запроса используется формат URL-адреса запроса API: `https://{yourDomain}/{apiName}/{operationId}?{queryStringParameterName}={versionIdentifier}` .

Например, `https://apis.contoso.com/products?api-version=v1` и `https://apis.contoso.com/products/api-version=v2` могут ссылаться на тот же `products` API, но и на версии `v1` и `v2` соответственно.

## <a name="original-versions"></a>Исходные версии

При добавлении версии в API без управления версиями `Original` автоматически создается версия, которая будет реагировать на URL-адрес по умолчанию без указания идентификатора версии. `Original`Версия гарантирует, что все существующие вызывающие объекты не будут разбиваться процессом добавления версии. Если создать новый API с включенными версиями, `Original` версия не будет создана.

## <a name="how-versions-are-represented"></a>Представление версий

Служба управления API Azure поддерживает ресурс, называемый *набором версий*, который представляет набор версий для одного логического API. Набор версий содержит отображаемое имя API с управлением версиями и [схему управления версиями, используемую](#versioning-schemes) для направления запросов к указанным версиям.

Каждая версия API сохраняется в виде собственного ресурса API, который затем связывается с набором версий. Набор версий может содержать API-интерфейсы с разными операциями или политиками. Вы можете вносить существенные изменения между версиями в наборе.

Портал Azure создает наборы версий. Вы можете изменить имя и описание набора версий в портал Azure.

Вы можете просматривать наборы версий и управлять ими непосредственно с помощью [Azure CLI](/cli/azure/apim/api/versionset), [Azure PowerShell](/powershell/module/az.apimanagement/#api-management), [шаблонов диспетчер ресурсов](/azure/templates/microsoft.apimanagement/service/apiversionsets)или [API Azure Resource Manager](/rest/api/apimanagement/2020-06-01-preview/apiversionset).

### <a name="migrating-a-non-versioned-api-to-a-versioned-api"></a>Миграция API без управления версиями в API с управлением версиями

При использовании портал Azure для включения управления версиями на существующем API-интерфейсе в ресурсы управления API вносятся следующие изменения.

 * Создается новый набор версий.
 * Существующая версия сохраняется и [настраивается в качестве `Original` версии API](#original-versions). API связан с набором версий, но не требует указания идентификатора версии.
 * Новая версия создается как новый API и связывается с набором версий. Доступ к этому новому API должен осуществляться с помощью схемы управления версиями и идентификатора.

## <a name="versions-and-revisions"></a>Версии и редакции

Версии и редакции — это отдельные функции. Каждая версия может иметь несколько редакций, как и API без версии. Вы можете использовать редакции без использования версий или наоборот. Обычно версии используются для разделения версий API с критическими изменениями, в то время как редакции можно использовать для небольших и некритических изменений в API.

Если вы обнаружите, что в редакции внесены критические изменения, или если вы хотите формально преобразовать свою редакцию в пробную или тестовую версию, можно создать версию из редакции. С помощью портал Azure выберите пункт "создать версию из редакции" в контекстном меню редакции на вкладке "редакции".

## <a name="developer-portal"></a>Портал разработчика

[Портал разработчика](./api-management-howto-developer-portal.md) перечисляет каждую версию API отдельно.

![Портал разработчика управления API, отображающий список API с управлением версиями](media/api-management-versions/portal-list.png)

В сведениях об API также отображается список всех версий этого API. `Original`Версия отображается без идентификатора версии.

![Портал разработчика управления API, отображающий сведения об API и список версий для этого API](media/api-management-versions/portal-details.png)

> [!TIP]
> Версии API необходимо добавить в продукт, прежде чем они будут отображаться на портале разработчика.
