---
title: Учебник. Публикация версий API с помощью службы "Управление API Azure"
description: Следуйте инструкциям этого учебника, чтобы узнать, как опубликовать несколько версий API в службе "Управление API Azure".
author: vladvino
ms.service: api-management
ms.custom: mvc, devx-track-azurecli
ms.topic: tutorial
ms.date: 02/10/2021
ms.author: apimpm
ms.openlocfilehash: 5930979258372e4269c4d453ffbc5e0d46258088
ms.sourcegitcommit: afb79a35e687a91270973990ff111ef90634f142
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/14/2021
ms.locfileid: "107483619"
---
# <a name="tutorial-publish-multiple-versions-of-your-api"></a>Руководство по Публикация нескольких версий API 

Иногда нецелесообразно предоставлять всем вызывающим сторонам одну версию API. Если вызывающим сторонам требуется выполнить обновление до более поздней версии, они хотят, чтобы сделать это было просто. Как показано в этом учебнике, в службе "Управление API Azure" можно использовать несколько *версий*. 

Дополнительные сведения см. в статье [Версии и исправления](https://azure.microsoft.com/blog/versions-revisions/).

В этом руководстве описано следующее.

> [!div class="checklist"]
> * добавление новой версии в существующий интерфейс API;
> * выбор схемы версии;
> * Добавление версии в продукт
> * Обзор портала разработчика для просмотра версии

:::image type="content" source="media/api-management-getstarted-publish-versions/azure-portal.png" alt-text="Версия, показанная на портале Azure":::

## <a name="prerequisites"></a>предварительные требования

+ Ознакомьтесь с [терминологией службы управления API в Azure](api-management-terminology.md).
+ Выполните задачи в кратком руководстве по [созданию экземпляра службы управления API Azure](get-started-create-service-instance.md).
+ Также выполните задачи из руководства по [импорту и публикации первого API](import-and-publish.md).

## <a name="add-a-new-version"></a>Добавление новой версии

1. Перейдите к экземпляру Управления API на [портале Azure](https://portal.azure.com).
1. Выберите **Интерфейсы API**.
1. В списке API выберите **Demo Conference API**. 
1. Выберите контекстное меню ( **...** ) рядом с элементом **Demo Conference API**.
1. Выберите **Добавить версию**.

:::image type="content" source="media/api-management-getstarted-publish-versions/add-version-menu.png" alt-text="Контекстное меню API — добавление версии":::


> [!TIP]
> Версии также могут быть включены при создании API. На экране **Добавление API** выберите элемент **Управлять версией этого API?** .

## <a name="choose-a-versioning-scheme"></a>Выбор схемы управления версиями

В службе "Управление API Azure" укажите способ определения версии API вызывающими сторонами, выбрав *схему управления версиями*. Эта схема может быть **путем, заголовком** или **строкой запроса**. В приведенном ниже примере для выбора схемы управления версиями используется *путь*.

Введите значения из следующей таблицы. Затем выберите **Создать**, чтобы создать версию.

:::image type="content" source="media/api-management-getstarted-publish-versions/add-version.png" alt-text="Экран добавления версии":::



|Параметр   |Значение  |Описание  |
|---------|---------|---------|
|**Имя**     |  *demo-conference-api-v1*       |  Уникальное имя в экземпляре Управления API.<br/><br/>Так как версия фактически является новым API, созданным в результате [исправления](api-management-get-started-revise-api.md) API, этот параметр является новым именем API.   |
|**Схема управления версиями**     |  **Путь**       |  Способ, с помощью которого вызывающие стороны указывают версию API.     |
|**Идентификатор версии**     |  *Версия 1*       |  Относящийся к схеме индикатор версии. Это суффикс URL-адреса API для элемента **Путь**. <br/><br/> Если выбран параметр **Заголовок** или **Строка запроса**, введите дополнительное значение: имя заголовка или параметр строки запроса.<br/><br/> Отобразится пример использования.        |
|**Продукты**     |  **Unlimited**       |  Необязательно. Один или несколько продуктов, с которыми связана версия API. Чтобы опубликовать API, его нужно связать с определенным продуктом. Кроме того, можно [добавить версию в продукт](#add-the-version-to-a-product) позже.      |

После создания версия отображается под элементом **Demo Conference API** в списке API. Теперь отображаются два интерфейса API: **Original** и **v1**.

![Версии, перечисленные в списке API на портале Azure](media/api-management-getstarted-publish-versions/version-list.png)

Вы можете изменить и настроить **v1** в качестве API, не связанного с версией **Original**. Изменение одной версии не влияет на другую.

> [!Note]
> Если добавить версию для API без управления версиями, будет автоматически создаваться версия **Original** в соответствии с URL-адресом по умолчанию. Создание версии Original гарантирует, что работа вызывающих сторон не будет нарушена в процессе добавления версии. Если вы сразу создадите API с управлением версиями, то версия Original не будет создаваться.

## <a name="add-the-version-to-a-product"></a>Добавление версии в продукт

Чтобы для вызывающих сторон отображалась новая версия, ее необходимо добавить в *продукт*. Если вы еще не добавили версию в продукт, вы можете сделать это в любое время.

Например, чтобы добавить версию в продукт **Без ограничений**, выполните указанные ниже действия.
1. Перейдите к экземпляру Управления API на портале Azure.
1. Выберите **Продукты** > **Без ограничений** > **API** >  **+ Добавить**.
1. Выберите **Demo Conference API**, версия **v1**.
1. Нажмите кнопку **Выбрать**.

:::image type="content" source="media/api-management-getstarted-publish-versions/08-add-multiple-versions-03-add-version-product.png" alt-text="Добавление версии в продукт":::

## <a name="use-version-sets"></a>Использование наборов версий

При создании нескольких версий портал Azure создает *набор версий*, который представляет собой набор версий для одного логического API. Выберите имя API с несколькими версиями. Портал Azure отобразит его **набор версий**. Вы можете задать **имя** и **описание** виртуального набора.

Вы можете напрямую взаимодействовать с набором версий с помощью Azure CLI:

[!INCLUDE [azure-cli-prepare-your-environment-no-header.md](../../includes/azure-cli-prepare-your-environment-no-header.md)]

Чтобы просмотреть все наборы версий, выполните команду [az apim api versionset list](/cli/azure/apim/api/versionset#az_apim_api_versionset_list):

```azurecli
az apim api versionset list --resource-group apim-hello-word-resource-group \
    --service-name apim-hello-world --output table
```

Когда портал Azure создает набор версий, ему присваивается буквенно-цифровое имя, которое отображается в столбце **Имя** списка. Это имя можно использовать в других командах Azure CLI.

Чтобы просмотреть сведения о наборе версий, выполните команду [az apim api versionset show](/cli/azure/apim/api/versionset#az_apim_api_versionset_show):

```azurecli
az apim api versionset show --resource-group apim-hello-word-resource-group \
    --service-name apim-hello-world --version-set-id 00000000000000000000000
```

Дополнительные сведения о наборах версий см. в разделе [Версии в Управлении API Azure](api-management-versions.md#how-versions-are-represented).

## <a name="browse-the-developer-portal-to-see-the-version"></a>Обзор портала разработчика для просмотра версии

Если вы использовали [портал разработчика](api-management-howto-developer-portal-customize.md), вы можете просмотреть версии API.

1. Выберите **Портал разработчика** в верхнем меню.
2. Выберите **API**, а затем — **Demo Conference API**.
3. Появится раскрывающийся список с несколькими версиями рядом с именем API.
4. Выберите **v1**.
5. Обратите внимание на **URL-адрес запроса** первой операции в списке. В нем видно, что путь URL-адреса API содержит **v1**.

## <a name="next-steps"></a>Дальнейшие действия

В этом руководстве вы узнали, как выполнять следующие задачи:

> [!div class="checklist"]
> * добавление новой версии в существующий интерфейс API;
> * выбор схемы версии; 
> * Добавление версии в продукт
> * Обзор портала разработчика для просмотра версии

Перейдите к следующему руководству:

> [!div class="nextstepaction"]
> [Настройка стиля страниц для портала разработчика](api-management-howto-developer-portal-customize.md)
