---
title: Настройка автомасштабирования экземпляра Службы управления API Azure | Документация Майкрософт
description: В этой статье описано, как настроить автомасштабирование для экземпляра службы управления API Azure.
services: api-management
documentationcenter: ''
author: mikebudzynski
manager: anneta
editor: ''
ms.service: api-management
ms.workload: integration
ms.topic: article
ms.date: 06/20/2018
ms.author: apimpm
ms.openlocfilehash: 41a97c639d9148f2bff3e4f530363ea05a65a7b8
ms.sourcegitcommit: 910a1a38711966cb171050db245fc3b22abc8c5f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "96018259"
---
# <a name="automatically-scale-an-azure-api-management-instance"></a>Автоматическое масштабирование экземпляра службы управления API Azure  

Экземпляр службы управления API Azure может выполнять автоматическое масштабирование на основе набора правил. Такой механизм можно включить и настроить с помощью Azure Monitor. Он поддерживается только для ценовых категорий **Стандартный** и **Премиум** службы управления API Azure.

В этой статье описан пошаговый процесс настройки автомасштабирования и предлагается оптимальная конфигурация правил автомасштабирования.

> [!NOTE]
> Служба управления API на уровне **потребления** автоматически масштабируется на основе трафика — без какой-либо дополнительной настройки.

## <a name="prerequisites"></a>Предварительные условия

Чтобы выполнить шаги из этой статьи, понадобится следующее:

+ Наличие активной подписки Azure.
+ Экземпляр службы управления API Azure. Дополнительные сведения см. в статье о [создании экземпляра управления API Azure](get-started-create-service-instance.md).
+ Понимание концепции [емкости экземпляра службы управления API Azure](api-management-capacity.md).
+ Понимание [процесса масштабирования экземпляра службы управления API Azure вручную](upgrade-and-scale.md), включая незапланированные затраты.

[!INCLUDE [premium-standard.md](../../includes/api-management-availability-premium-standard.md)]

## <a name="azure-api-management-autoscale-limitations"></a>Ограничения автомасштабирования службы управления API

Перед настройкой механизма автомасштабирования нужно принять во внимание определенные ограничения и последствия решений в отношении масштабирования.

+ Автомасштабирование можно включить только для ценовых категорий **Стандартный** и **Премиум** службы управления API Azure.
+ Ценовые категории также указывают максимальное количество единиц для экземпляра службы.
+ Процесс масштабирования займет как минимум 20 минут.
+ Если служба заблокирована другой операцией, запрос на масштабирование завершится с ошибкой и повторится автоматически.
+ В случае если служба развернута для нескольких регионов, можно масштабировать только единицы в **основном расположении**. Единицы в других расположениях нельзя масштабировать.

## <a name="enable-and-configure-autoscale-for-azure-api-management-service"></a>Включение и настройка автомасштабирования для службы управления API Azure

Чтобы настроить автомасштабирование для службы управления API Azure, сделайте следующее:

1. Перейдите к экземпляру **Monitor** на портале Azure.

    ![Azure Monitor](media/api-management-howto-autoscale/01.png)

2. Выберите **Автомасштабирование** в меню слева.

    ![Автомасштабирование ресурсов Azure Monitor](media/api-management-howto-autoscale/02.png)

3. Найдите службу управления API Azure, используя фильтры в раскрывающемся меню.
4. Выберите нужный экземпляр службы управления API Azure.
5. В открывшемся разделе нажмите кнопку **Включить автомасштабирование**.

    ![Включение автомасштабирования в Azure Monitor](media/api-management-howto-autoscale/03.png)

6. В разделе **Правила** щелкните **+ Добавить правило**.

    ![Добавление правила автомасштабирования в Azure Monitor](media/api-management-howto-autoscale/04.png)

7. Определите новое правило развертывания единиц.

   Например, правило развертывания единиц может запустить добавление единицы управления API Azure, когда средний показатель емкости за последние 30 минут превышает 80 %. В следующей таблице представлена конфигурация для такого правила.

    | Параметр             | Значение             | Примечания                                                                                                                                                                                                                                                                           |
    |-----------------------|-------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
    | Источник метрики         | Текущий ресурс  | Определение правила на основе текущих метрик ресурсов службы управления API Azure.                                                                                                                                                                                                     |
    | *Критерии*            |                   |                                                                                                                                                                                                                                                                                 |
    | Агрегат времени      | Средняя           |                                                                                                                                                                                                                                                                                 |
    | Имя метрики           | Capacity          | Метрика емкости — это метрика управления API Azure, отражающая использование ресурсов экземпляра управления API Azure.                                                                                                                                                            |
    | Статистика интервала времени  | Средняя           |                                                                                                                                                                                                                                                                                 |
    | Оператор              | Больше      |                                                                                                                                                                                                                                                                                 |
    | Пороговое значение             | 80 %               | Пороговое значение для среднего показателя емкости.                                                                                                                                                                                                                                 |
    | Продолжительность (в минутах) | 30                | Временный диапазон для определения среднего значения емкости зависит от шаблонов использования. Чем дольше период времени, тем более плавной будет реакция. Прерывистые пики будут иметь меньше влияния на решение развертывания. Тем не менее также произойдет задержка триггера развертывания. |
    | *Действие*              |                   |                                                                                                                                                                                                                                                                                 |
    | Операция             | Увеличить счетчик на |                                                                                                                                                                                                                                                                                 |
    | Число экземпляров        | 1                 | Увеличение масштаба экземпляра службы управления API Azure на 1 единицу.                                                                                                                                                                                                                          |
    | Охлаждение (в минутах)   | 60                | Для масштабирования службы управления API Azure требуется не менее 20 минут. В большинстве случаев срок действия крайнего периода в 60 минут предотвращает срабатывание большого количества масштабируемых элементов.                                                                                                  |

8. Щелкните **Добавить** , чтобы сохранить правило.

    ![Правило развертывания единиц в Azure Monitor](media/api-management-howto-autoscale/05.png)

9. Снова щелкните **+ Добавить правило**.

    В данном случае необходимо определить правило свертывания единиц. Оно гарантирует, что ресурсы не будут потрачены впустую, когда использование API уменьшится.

10. Определите новое правило свертывания единиц.

    Например, правило свертывания единиц может запустить удаление единицы управления API Azure, когда средний показатель емкости за последние 30 минут ниже 35 %. В следующей таблице представлена конфигурация для такого правила.

    | Параметр             | Значение             | Примечания                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
    |-----------------------|-------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
    | Источник метрики         | Текущий ресурс  | Определение правила на основе текущих метрик ресурсов службы управления API Azure.                                                                                                                                                                                                                                                                                                                                                                                                                         |
    | *Критерии*            |                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
    | Агрегат времени      | Средняя           |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
    | Имя метрики           | Capacity          | Такая же метрика использовалась для правила развертывания единиц.                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
    | Статистика интервала времени  | Средняя           |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
    | Оператор              | Меньше         |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
    | Пороговое значение             | 35 %               | Как и для правила развертывания единиц, это значение во многом зависит от шаблонов использования управления API Azure. |
    | Продолжительность (в минутах) | 30                | Такое же значение использовалось для правила развертывания единиц.                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
    | *Действие*              |                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
    | Операция             | Уменьшить счетчик на | Значение, противоположное тому, которое использовалось для правила развертывания единиц.                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
    | Число экземпляров        | 1                 | Такое же значение использовалось для правила развертывания единиц.                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
    | Охлаждение (в минутах)   | 90                | Свертывание единиц должно быть более умеренным, чем развертывание, поэтому период охлаждения должен быть дольше.                                                                                                                                                                                                                                                                                                                                                                                                    |

11. Щелкните **Добавить** , чтобы сохранить правило.

    ![Правило свертывания единиц в Azure Monitor](media/api-management-howto-autoscale/06.png)

12. Задайте **максимальное** число единиц управления API Azure.

    > [!NOTE]
    > Экземпляр управления API Azure можно развернуть до ограниченного числа единиц. Ограничение зависит от ценовой категории служб.

    ![Снимок экрана, на котором показано, где можно задать максимальное число единиц управления API Azure.](media/api-management-howto-autoscale/07.png)

13. Выберите команду **Сохранить**. Автомасштабирование настроено.

## <a name="next-steps"></a>Дальнейшие действия

- [Развертывание экземпляра службы управления Azure API в различных регионах Azure](api-management-howto-deploy-multi-region.md)
- [Оптимизируйте и сохраняйте расходы на облачные технологии](../cost-management-billing/costs/quick-acm-cost-analysis.md?WT.mc_id=costmanagementcontent_docsacmhorizontal_-inproduct-learn)