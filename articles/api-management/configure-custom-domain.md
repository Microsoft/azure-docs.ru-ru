---
title: Настройка пользовательского доменного имени для экземпляра службы управления API Azure
titleSuffix: Azure API Management
description: В этом разделе описано, как настроить пользовательское имя домена для вашего экземпляра службы управления API Azure.
services: api-management
documentationcenter: ''
author: vladvino
manager: anneta
editor: ''
ms.service: api-management
ms.workload: integration
ms.topic: article
ms.date: 01/13/2020
ms.author: apimpm
ms.openlocfilehash: a7032c64efa486c65830e013373239647a368540
ms.sourcegitcommit: 910a1a38711966cb171050db245fc3b22abc8c5f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "92311139"
---
# <a name="configure-a-custom-domain-name-for-your-azure-api-management-instance"></a>Настройка пользовательского доменного имени для экземпляра службы управления API Azure

При создании экземпляра службы управления API Azure Azure назначает ему поддомен `azure-api.net` (например, `apim-service-name.azure-api.net` ). Тем не менее вы можете предоставлять конечные точки управления API, используя собственное доменное имя, например **contoso.com**. В этом руководстве показано, как сопоставлять существующее пользовательское DNS-имя с конечными точками, предоставляемыми экземпляром службы управления API.

> [!IMPORTANT]
> Управление API принимает только запросы со значениями [заголовка узла](https://tools.ietf.org/html/rfc2616#section-14.23) , совпадающими с именем домена по умолчанию или с любым из настроенных пользовательских доменных имен.

> [!WARNING]
> Клиенты, желающие использовать закрепление сертификатов для повышения безопасности своих приложений, должны использовать пользовательское доменное имя и сертификат, которыми они управляют, а не сертификат по умолчанию. Клиенты, которые заключают сертификат по умолчанию, заключают на себя жесткую зависимость от свойств неуправляемого сертификата, что не является рекомендуемым методом.

## <a name="prerequisites"></a>Предварительные требования

Чтобы выполнить действия, описанные в этой статье, необходимо следующее.

-   Активная подписка Azure.

    [!INCLUDE [quickstarts-free-trial-note](../../includes/quickstarts-free-trial-note.md)]

-   Экземпляр управления API. Дополнительные сведения см. в статье о [создании экземпляра управления API Azure](get-started-create-service-instance.md).
-   Пользовательское доменное имя, которое принадлежит вам или вашей организации. В этом разделе не приводятся инструкции по получению пользовательского доменного имени.
-   Запись CNAME, размещенная на DNS-сервере, который сопоставляет пользовательское доменное имя с доменным именем по умолчанию для экземпляра службы управления API. В этом разделе не приводятся инструкции по размещению записи CNAME.
-   Необходимо иметь действующий сертификат с открытым и закрытым ключами (PFX-файл). Субъект или альтернативное имя субъекта (SAN) должны соответствовать доменному имени (это позволяет экземпляру управления API безопасно предоставлять URL-адреса по протоколу TLS).

## <a name="use-the-azure-portal-to-set-a-custom-domain-name"></a>Настройка пользовательского доменного имени с помощью портала Azure

1. Перейдите к экземпляру управления API в [портал Azure](https://portal.azure.com/).
1. Выберите **Личные домены**.

    Существует несколько конечных точек, которым можно назначить пользовательское доменное имя. Сейчас доступны следующие конечные точки:

    - **Шлюз** (по умолчанию: `<apim-service-name>.azure-api.net` ),
    - **Портал разработчика (прежний)** (по умолчанию: `<apim-service-name>.portal.azure-api.net` ),
    - **Портал разработчика** (по умолчанию: `<apim-service-name>.developer.azure-api.net` ).
    - **Management** (по умолчанию: `<apim-service-name>.management.azure-api.net`),
    - **SCM** (по умолчанию: `<apim-service-name>.scm.azure-api.net` ),

    > [!NOTE]
    > Для конфигурации в уровне потребления доступна только конечная точка **шлюза** .
    > Можно обновить все конечные точки или некоторые из них. Обычно клиент обновляет **шлюз** (этот URL-адрес используется для вызова API, предоставляемого через Управление API) и **портала** (URL-адрес портала разработчика).
    > Конечные точки **управления** и **SCM** используются только владельцами экземпляра управления API и тем самым чаще назначаются имя пользовательского домена.
    > Уровень **Premium** поддерживает задание нескольких имен узлов для конечной точки **шлюза** .

1. Выберите конечную точку, которую необходимо обновить.
1. В окне справа выберите **Настраиваемое**.

    - В поле **Пользовательское доменное имя** укажите имя, которое следует использовать. Например, `api.contoso.com`.
    - В поле **сертификат** выберите сертификат из Key Vault. Также можно передать допустимый объект. PFX-файл и укажите **пароль**, если сертификат защищен паролем.

    > [!NOTE]
    > Доменные имена с подстановочными знаками, например, `*.contoso.com` поддерживаются на всех уровнях, кроме уровня потребления.

    > [!TIP]
    > Рекомендуется использовать [Azure Key Vault для управления сертификатами](../key-vault/certificates/about-certificates.md) и их настройки для автопродления.
    > Если для управления сертификатом TLS/SSL в пользовательском домене используется Azure Key Vault, убедитесь, что сертификат вставлен в Key Vault [как _сертификат_](/rest/api/keyvault/createcertificate/createcertificate), а не на _секрет_.
    >
    > Чтобы получить сертификат TLS/SSL, служба управления API должна иметь разрешения List и Get Secrets для Azure Key Vault, содержащей сертификат. При использовании портал Azure все необходимые действия по настройке будут выполняться автоматически. При использовании средств командной строки или API управления эти разрешения должны предоставляться вручную. Это делается в два этапа. Сначала используйте страницу управляемые удостоверения в экземпляре управления API, чтобы убедиться, что управляемое удостоверение включено, и запишите идентификатор участника, показанный на этой странице. Во-вторых, предоставьте разрешения на список разрешений и получение секретов для этого идентификатора субъекта на Azure Key Vault, содержащем сертификат.
    >
    > Если для сертификата задано автоматическое продление, служба управления API будет автоматически получать последнюю версию без простоя службы (если уровень управления API имеет соглашение об уровне обслуживания-i. e. на всех уровнях, кроме уровня разработчика).

1. Нажмите кнопку "Применить".

    > [!NOTE]
    > Назначение сертификата может занять 15 или более минут в зависимости от размера развертывания. У SKU Developer есть простой, а у основных и более высоких номеров SKU нет простоев.

[!INCLUDE [api-management-custom-domain](../../includes/api-management-custom-domain.md)]

## <a name="dns-configuration"></a>Настройка DNS

При настройке DNS для имени личного домена у вас есть два варианта:

-   Настройте запись CNAME, которая указывает на конечную точку настроенного имени пользовательского домена.
-   Настройка A-записи, указывающей на IP-адрес шлюза управления API.

> [!NOTE]
> Хотя IP-адрес экземпляра службы управления API является статическим, он может измениться в нескольких сценариях. Поэтому рекомендуется использовать CNAME при настройке пользовательского домена. Примите во внимание это при выборе метода конфигурации DNS. Дополнительные сведения см. в [статье документация по IP-адресу](api-management-howto-ip-addresses.md#changes-to-the-ip-addresses) и [вопросы и ответы по управлению API](api-management-faq.md#how-can-i-secure-the-connection-between-the-api-management-gateway-and-my-back-end-services).

## <a name="next-steps"></a>Дальнейшие действия

[Повышение категории и масштабирование службы](upgrade-and-scale.md)
