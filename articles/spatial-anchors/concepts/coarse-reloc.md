---
title: Простое уточнение расположения
description: Узнайте, как и когда следует использовать грубую перелокализацию. Грубая Локализация позволяет находить соседние привязки.
author: msftradford
manager: MehranAzimi-msft
services: azure-spatial-anchors
ms.author: parkerra
ms.date: 01/28/2021
ms.topic: conceptual
ms.service: azure-spatial-anchors
ms.custom: devx-track-csharp
ms.openlocfilehash: 3f0b04183c4df469d4f723486103790c4f97671b
ms.sourcegitcommit: 867cb1b7a1f3a1f0b427282c648d411d0ca4f81f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "104656181"
---
# <a name="coarse-relocalization"></a>Простое уточнение расположения

Грубая Локализация — это функция, которая обеспечивает крупномасштабную локализацию, предоставляя приблизительный, но быстрый ответ на следующие вопросы: 
- *Где мое устройство сейчас?* 
- *Какое содержимое следует наблюдать?* 
 
Ответ не является точным. Это в этой форме: *близко к этим привязкам. Попробуйте разместить один из них*.

Грубая локализация работает с помощью привязок тегов с различными считанными датчиками устройств, которые позже используются для быстрого выполнения запросов. В сценариях для общего использования данные датчика обычно являются позицией GPS (Глобальная система позиционирования) устройства. Когда GPS недоступен или ненадежен, как и в случае с подвижями, данные датчика состоят из Wi-Fi точек доступа и маяков Bluetooth в радиусе действия. Собранные данные датчика вносят вклад в хранение пространственного индекса, используемого пространственными привязками Azure, чтобы быстро определить, какие привязки близко к вашему устройству.

## <a name="when-to-use-coarse-relocalization"></a>Когда следует использовать грубую локализацию

Если вы планируете работать с более чем 35 пространственными привязками в пространстве, превышающем судебный зал, скорее всего, вы сможете воспользоваться преимуществами пространственного индексирования с грубой локализацией.

Быстрый поиск привязок, включенных при грубой локализации, предназначен для упрощения разработки приложений, поддерживающих коллекции мирового масштаба, скажем, миллионы геораспределенных привязок. Сложность пространственного индексирования скрыта, поэтому вы можете сосредоточиться на логике приложения. Вся сложная работа выполняется за кулисами с помощью пространственных привязок Azure.

## <a name="using-coarse-relocalization"></a>Использование грубой локализации

Ниже приведен типичный рабочий процесс создания и запроса пространственных привязок Azure с грубой локализацией.
1.  Создание и настройка поставщика отпечатков пальцев с датчика для получения нужных данных датчиков.
2.  Запустите сеанс пространственных привязок Azure и создайте привязки. Так как отпечаток датчика включен, привязки на пространственной основе индексируются с помощью грубой локализации.
3.  Применяйте запросы к привязкам с помощью грубой локализации через выделенные критерии поиска в сеансе пространственных привязок.

Вы можете обратиться к одному из этих руководств, чтобы настроить грубую перелокализацию в приложении:
* [Простое уточнение расположения в Unity](../how-tos/set-up-coarse-reloc-unity.md)
* [Простое уточнение расположения в Objective-C](../how-tos/set-up-coarse-reloc-objc.md)
* [Простое уточнение расположения в Swift](../how-tos/set-up-coarse-reloc-swift.md)
* [Простое уточнение расположения в Java](../how-tos/set-up-coarse-reloc-java.md)
* [Простое уточнение расположения в C++/NDK](../how-tos/set-up-coarse-reloc-cpp-ndk.md)
* [Простое уточнение расположения в C++/WinRT](../how-tos/set-up-coarse-reloc-cpp-winrt.md)

## <a name="sensors-and-platforms"></a>Датчики и платформы

### <a name="platform-availability"></a>Доступность платформы

Эти типы данных датчиков можно отправить в службу привязки:

* Расположение GPS: Широта, Долгота, высота
* Сила сигнала Wi-Fi точек доступа в диапазоне
* Сила сигнала сигналов маяков Bluetooth в диапазоне

В этой таблице приводится сводка по доступности данных датчика на поддерживаемых платформах и предоставляются сведения, о которых следует знать:

|                 | HoloLens | Android | iOS |
|-----------------|----------|---------|-----|
| **GPS**         | Нет<sup>1</sup>  | Да<sup>2</sup> | Да<sup>3</sup> |
| **Wi-Fi**        | Да<sup>4</sup> | Да<sup>5</sup> | Нет  |
| **BLE маяки** | Да<sup>6</sup> | Да<sup>6</sup> | Да<sup>6</sup>|


<sup>1</sup> внешнее устройство GPS может быть связано с HoloLens. Если вы пожелаете использовать HoloLens с средством регистрации GPS, обратитесь в [службу поддержки](../spatial-anchor-support.md) .<br/>
<sup>2</sup> поддерживаются через API-интерфейсы [ЛОКАТИОНМАНАЖЕР][3] (как GPS, так и Network).<br/>
<sup>3</sup> поддерживается через API-интерфейсы [кллокатионманажер][4] .<br/>
<sup>4</sup> поддерживаются с частотой приблизительно одного сканирования каждые 3 секунды. <br/>
<sup>5</sup> начиная с уровня API 28, Wi-Fi сканирование регулируется до четырех вызовов каждые 2 минуты. Начиная с Android 10, это регулирование можно отключить в меню " **Параметры разработчика** ". Дополнительные сведения см. в [документации по Android][5].<br/>
<sup>6</sup> ограничены [еддистоне][1] и [ибеакон][2].

### <a name="which-sensor-to-enable"></a>Выбор датчика для включения

Выбор датчика зависит от разрабатываемого приложения и платформы.
На этой схеме представлена отправная точка для определения сочетания датчиков, которые можно включить в зависимости от сценария локализации.

![Схема, показывающая включенные датчики для различных сценариев.](media/coarse-relocalization-enabling-sensors.png)

Следующие разделы содержат более подробные сведения о преимуществах и ограничениях для каждого типа датчика.

### <a name="gps"></a>GPS

GPS — это вариант для одностороннего сценария.
При использовании GPS в приложении следует помнить, что в нем используются следующие средства чтения:

* Асинхронная и низкая частота (менее 1 Гц).
* Ненадежный/шум (в среднем, стандартное отклонение 7 – m).

Как правило, как ОС устройства, так и пространственные привязки будут выполнять некоторую фильтрацию и экстраполяцию необработанного сигнала GPS, пытаясь устранить эти проблемы. Для этой дополнительной обработки требуется время для конвергенции, поэтому для получения наилучших результатов необходимо выполнить следующие действия.

* Создайте один поставщик отпечатков пальцев с датчика как можно раньше в своем приложении.
* Обеспечьте активность поставщика отпечатков пальцев между несколькими сеансами.
* Совместное использование поставщика отпечатков пальцев с датчика между несколькими сеансами.

Устройства GPS класса "потребитель" обычно неточны. Исследование на основе [занденбержен и барбеау (2011)][6] сообщает о том, что медиана точность мобильных телефонов с поддержкой GPS (A-GPS) составляет около 7 метров. Это очень большое значение для пропуска! Чтобы учитывать эти ошибки измерения, служба рассматривает привязки как распределения вероятностей в пространстве GPS. Таким образом, привязка — это область пространства, которая, вероятнее всего, (с достоверностью более 95%), содержит истинную, неизвестную координату GPS.

Та же причина применяется при выполнении запроса с помощью GPS. Устройство представляется в виде другой геопространственной области достоверности в отношении истинной, неизвестной координаты GPS. Обнаружение ближайших привязок преобразуется для поиска привязок с областями достоверности, *достаточно близкой* к региону достоверности устройства, как показано ниже:

![Схема, иллюстрирующая Поиск кандидатов на привязку с помощью GPS.](media/coarse-reloc-gps-separation-distance.png)

### <a name="wi-fi"></a>Wi-Fi

В HoloLens и Android Wi-Fi сила сигнала может быть хорошим способом включения грубой локализации.
Преимущество в том, что это потенциально немедленная доступность Wi-Fi точек доступа (например, в Office Spaces и центрах для покупок) без дополнительной настройки.

> [!NOTE]
> iOS не предоставляет API для чтения Wi-Fi силы сигнала, поэтому его нельзя использовать для грубой локализации через Wi-Fi.

При использовании Wi-Fi в приложении помните о том, что в нем используются следующие средства чтения:

* Асинхронная и низкая частота (менее 0,1 Гц).
* Потенциально регулируется на уровне ОС.
* Ненадежный/шум (в среднем, 3-dBm стандартное отклонение).

Пространственные привязки попытаются создать отфильтрованную карту Wi-Fi силы сигнала во время сеанса, пытаясь устранить эти проблемы. Для получения лучших результатов попробуйте:

* Создайте сеанс, прежде чем поместить первую привязку.
* Продерживайте сеанс в активном состоянии, пока это возможно. (То есть создайте все привязки и запрос в одном сеансе.)

### <a name="bluetooth-beacons"></a>Маяки Bluetooth
<a name="beaconsDetails"></a>

Тщательное развертывание маяков Bluetooth является хорошим решением для крупномасштабных сценариев повторной локализации, в которых GPS отсутствует или неточна. Это также единственный метод, поддерживаемый на всех трех платформах.

Сигналы маяка обычно являются универсальными устройствами, на которых можно настроить все, включая UUID и MAC-адреса. Пространственные привязки Azure предполагают уникальную идентификацию маркеров UUID. Если вы не гарантируете такую уникальность, вероятно, вы получите неверные результаты. Для получения лучших результатов сделайте следующее.

* Присвойте вашим маякам уникальные идентификаторы UUID.
* Развертывайте маяки так, чтобы они обрабатывают пространство единообразно, так что по крайней мере три маяка доступны из любой точки в пространстве.
* Передайте список уникальных идентификаторов UUID маяка поставщику отпечатков пальцев датчика.

Помехи радиосигнала, такие как Bluetooth, подвержены препятствиям и могут мешать другим радиосигналам. Поэтому может быть трудно угадать, является ли ваша сфера равномерной. Чтобы обеспечить лучшее взаимодействие с клиентами, рекомендуется вручную протестировать покрытие маяков. Тест можно выполнить путем прохода по модулю с устройствами-кандидатами и приложением, которое показывает Bluetooth в диапазоне. Протестируйте покрытие, убедитесь, что вы можете связаться по крайней мере с тремя маяками из любой стратегической позиции в вашем пространстве. Наличие слишком большого количества маяков может привести к увеличению количества помех между ними и не обязательно повысит точность грубой локализации.

Предупреждения Bluetooth обычно охватывают 80 метров, если в пространстве отсутствует препятствий.
Таким образом, для пространства, не имеющего больших препятствий, можно развернуть маяки в шаблоне сетки каждые 40 метров.

Экран, использующий батарею, повлияет на результаты, поэтому следует периодически выполнять мониторинг развертывания для недорогих или неоплаченных батарей.

Пространственные привязки Azure будут отслеживанием только маяков Bluetooth, которые находятся в списке идентификаторов UUID для известных маркеров. Но вредоносные маяки, запрограммированные на наличие алловлистед UUID, могут негативно повлиять на качество службы. Итак, вы получите лучшие результаты в проверенных пространствах, где можно управлять развертыванием маяка.

### <a name="sensor-accuracy"></a>Точность датчика

Точность сигнала GPS, как во время создания привязки, так и во время запросов, существенно влияет на набор возвращаемых привязок. В отличие от этого, запросы, основанные на Wi-Fi/маяках, будут рассматривать все привязки, имеющие по крайней мере одну точку доступа или Маяк с запросом. В этом смысле результат запроса, основанного на Wi-Fi/маяках, определяется главным образом физическим диапазоном точек доступа, маркеров маяков и препятствий на окружающей среде.
В этой таблице вычисляется ожидаемое пространство поиска для каждого типа датчика:

| Sensor      | Область поиска — радиус пространства (приблизительный) | Сведения |
|-------------|:-------:|---------|
| **GPS**         | от 20 м до 30 м | Среди прочих факторов определяется неопределенность GPS. Сообщаемые числа оцениваются по медиане точности GPS для мобильных телефонов с помощью A-GPS: 7 метров. |
| **Wi-Fi**        | от 50 м до 100 м | Определяется диапазоном точек беспроводного доступа. Зависит от частоты, силы передатчика, физических препятствий, помех и т. д. |
| **BLE маяки** |  70 м | Определяется диапазоном сигналов маяка. Зависит от частоты, силы передачи, физических препятствий, помех и т. д. |

<!-- Reference links in article -->
[1]: https://developers.google.com/beacons/eddystone
[2]: https://developer.apple.com/ibeacon/
[3]: https://developer.android.com/reference/android/location/LocationManager
[4]: https://developer.apple.com/documentation/corelocation/cllocationmanager?language=objc
[5]: https://developer.android.com/guide/topics/connectivity/wifi-scan
[6]: https://www.cambridge.org/core/journals/journal-of-navigation/article/positional-accuracy-of-assisted-gps-data-from-highsensitivity-gpsenabled-mobile-phones/E1EE20CD1A301C537BEE8EC66766B0A9
