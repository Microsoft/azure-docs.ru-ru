---
title: 'Документация по анализу кода безопасности Майкрософт: вопросы и ответы'
description: Узнайте о расширении анализа кода безопасности Майкрософт, просмотрев часто задаваемые вопросы.
author: sukhans
manager: sukhans
ms.author: terrylan
ms.date: 07/31/2019
ms.topic: article
ms.service: security
services: azure
ms.assetid: 521180dc-2cc9-43f1-ae87-2701de7ca6b8
ms.devlang: na
ms.tgt_pltfrm: na
ms.workload: na
ms.openlocfilehash: b851e52141cf93aba4aab9b2768658f0aac4660f
ms.sourcegitcommit: aaa65bd769eb2e234e42cfb07d7d459a2cc273ab
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/27/2021
ms.locfileid: "98879921"
---
# <a name="frequently-asked-questions"></a>Часто задаваемые вопросы
Есть вопросы? Дополнительные сведения см. в следующих часто задаваемых вопросах.

## <a name="general-faq"></a>Общие вопросы и ответы

### <a name="can-i-install-the-extension-on-my-visual-studio-team-foundation-server-instance-instead-of-on-an-azure-devops-instance"></a>Можно ли установить расширение на Team Foundation Server экземпляре Visual Studio, а не в экземпляре Azure DevOps?

Нет. Расширение недоступно для загрузки и установки Visual Studio Team Foundation Server.

### <a name="do-i-have-to-run-microsoft-security-code-analysis-with-my-build"></a>Нужно ли запускать анализ кода безопасности Майкрософт со своей сборкой? 

Возможно. Это зависит от типа средства анализа. Исходный код может быть единственным, который требуется, или может потребоваться вывод сборки.

Например, средство проверки учетных данных (Кредскан) анализирует файлы в структуре папок репозитория кода. Из-за этого анализа можно запустить журналы анализа безопасности Кредскан и опубликовать задачи сборки в автономной сборке, чтобы получить результаты.

Для других средств, например Бинским, которые анализируют артефакты после сборки, сначала требуется сборка.

### <a name="can-i-break-my-build-when-results-are-found"></a>Можно ли разбивать сборку при обнаружении результатов?

Да. Если какое-либо средство сообщает о проблеме или проблеме в файле журнала, можно ввести разрыв сборки. Просто добавьте задачу построения после анализа и установите флажок для любого инструмента, для которого требуется прервать сборку.

В пользовательском интерфейсе задачи, выполняемой после анализа, можно приостановить сборку, если любое из инструментов сообщает об ошибках или об ошибках и предупреждениях.

### <a name="how-do-the-command-line-arguments-in-azure-devops-differ-from-those-arguments-in-the-standalone-desktop-tools"></a>Как аргументы командной строки в Azure DevOps отличаются от этих аргументов в средствах изолированного рабочего стола? 

В большинстве случаев задачи сборки Azure DevOps являются прямыми оболочками в отношении аргументов командной строки средств безопасности. В качестве аргументов задачи сборки можно передать как аргументы, что обычно передается в программу командной строки.

Заметные различия:

- Средства запускаются из исходной папки агента $ (Build. SourcesDirectory) или из% BUILD_SOURCESDIRECTORY%. Например, К:\ажент \_ work\1\s.
- Пути в аргументах могут относиться к корню исходного каталога, приведенного выше. Пути также могут быть абсолютными. Абсолютные пути можно получить с помощью переменных сборки Azure DevOps или путем запуска локального агента с известными расположениями развертывания локальных ресурсов.
- Средства автоматически предоставляют путь к выходному файлу или папку. Если указать расположение выходных данных для задачи сборки, это расположение будет заменено на путь к известному расположению журналов на агенте сборки.
- Некоторые дополнительные аргументы командной строки для некоторых средств изменяются. Одним из примеров является добавление или удаление параметров, которые гарантируют, что графический интерфейс не запускается.

### <a name="can-i-run-a-build-task-like-credential-scanner-across-multiple-repositories-in-an-azure-devops-build"></a>Можно ли выполнять задачу сборки, например сканер учетных данных, в нескольких репозиториях в сборке Azure DevOps?

Нет. Запуск средств безопасной разработки для нескольких репозиториев в одном конвейере не поддерживается.

### <a name="the-output-file-i-specified-isnt-being-created-or-i-cant-find-the-output-file-i-specified"></a>Указанный выходной файл не создается, или не удается найти указанный выходной файл

Задачи сборки фильтруют некоторые входные данные пользователя. В частности, они обновляют расположение созданного выходного файла в качестве общего расположения на агенте сборки. Дополнительные сведения об этом расположении см. на следующих вопросах.

### <a name="where-are-the-output-files-generated-by-the-tools-saved"></a>Где сохраняются выходные файлы, созданные инструментами? 

Задачи сборки автоматически добавляют выходные пути к этому известному расположению в агенте сборки: $ (Agent. BuildDirectory) \_ сдт\логс. Так как мы используем стандартизацию в этом расположении, у всех команд, создающих или использующих журналы анализа кода, есть доступ к выходным данным.

### <a name="can-i-queue-a-build-to-run-these-tasks-on-a-hosted-build-agent"></a>Можно ли поместить сборку в очередь для выполнения этих задач на размещенном агенте сборки? 

Да. Все задачи и инструменты в расширении могут выполняться на размещенном агенте сборки.

>[!NOTE]
> Для задачи сборки сканера защиты от вредоносных программ требуется агент сборки с включенным защитником Windows. В размещении Visual Studio 2017 и более поздних версий предоставляется такой агент. Задача сборки не будет выполняться в размещенном агенте Visual Studio 2015.
>
> Хотя подписи не могут быть обновлены на этих агентах, подписи всегда должны быть менее трех часов назад.

### <a name="can-i-run-these-build-tasks-as-part-of-a-release-pipeline-as-opposed-to-a-build-pipeline"></a>Можно ли выполнять эти задачи сборки как часть конвейера выпуска, а не конвейер сборки?

В большинстве случаев да.

Однако Azure DevOps не поддерживает выполнение задач в конвейерах выпуска, когда эти задачи публикуют артефакты. Отсутствие поддержки не приводит к успешному запуску задачи публикации журналов анализа безопасности в конвейере выпуска. Эта задача завершается с ошибкой с описательным сообщением об ошибке.

### <a name="from-where-do-the-build-tasks-download-the-tools"></a>Откуда задачи сборки загружают средства?

Задачи сборки могут скачать пакеты NuGet средств из [веб-канала Управление пакетами Azure DevOps](https://securitytools.pkgs.visualstudio.com/_packaging/SecureDevelopmentTools/nuget/v3/index.json). Задачи сборки также могут использовать диспетчер пакетов узлов, который должен быть предварительно установлен на агенте сборки. Примером такой установки может быть команда **NPM Install tslint**.

### <a name="what-effect-does-installing-the-extension-have-on-my-azure-devops-organization"></a>Что влияет на установку расширения в моей организации Azure DevOps? 

После установки задачи сборки безопасности, предоставляемые расширением, становятся доступными для всех пользователей в Организации. При создании или изменении конвейера Azure эти задачи доступны в списке Коллекция задач сборка. В противном случае установка расширения в Организации Azure DevOps не будет действовать. При установке не изменяются параметры учетной записи, параметры проекта или конвейеры.

### <a name="does-installing-the-extension-modify-my-existing-azure-pipelines"></a>Устанавливает ли расширение изменение существующей Azure Pipelines? 

Нет. Установка расширения делает задачи сборки безопасности доступными для добавления к конвейерам. Вам по-прежнему необходимо добавлять или обновлять определения сборки, чтобы эти средства могли работать с процессом сборки.

## <a name="task-specific-faq"></a>Вопросы и ответы по конкретным задачам

В этом разделе перечислены вопросы, относящиеся к задачам сборки.

### <a name="credential-scanner"></a>Сканер учетных данных

#### <a name="what-are-common-suppression-scenarios-and-examples"></a>Что такое распространенные сценарии и примеры подавления?

Ниже приведены сведения о двух наиболее распространенных сценариях подавления.

##### <a name="to-suppress-all-occurrences-of-a-given-secret-within-the-specified-path"></a>Отключение всех вхождений заданного секрета в указанном пути

Требуется хэш-ключ секрета из выходного файла Кредскан, как показано в следующем примере.

```js
{
    "tool": "Credential Scanner",
    "suppressions": [
    {
        "hash": "CLgYxl2FcQE8XZgha9/UbKLTkJkUh3Vakkxh2CAdhtY=",
        "_justification": "Secret used by MSDN sample, it is fake."
    }
  ]
}
```

>[!WARNING]
> Хэш-ключ создается частью соответствующего значения или содержимого файла. Любая редакция исходного кода может изменить ключ хэша и отключить правило подавления.

##### <a name="to-suppress-all-secrets-in-a-specified-file-or-to-suppress-the-secrets-file-itself"></a>Отключение всех секретов в указанном файле или отключение самого файла секретов

Выражение файла может быть именем файла. Оно также может быть частью basename полного пути к файлу или имени файла. Подстановочные знаки не поддерживаются.

В следующих примерах показано, как подавить файл \<InputPath>\src\JS\lib\angular.js

Примеры допустимых правил подавления:

- \<InputPath>\src\JS\lib\angular.js — подавляет файл по указанному пути
- \src\JS\lib\angular.js
- \JS\lib\angular.js
- \lib\angular.js
- angular.js — подавляет любой файл с тем же именем

```js
{
    "tool": "Credential Scanner",
    "suppressions": [
    {
        "file": "\\files\\AdditonalSearcher.xml", 
        "_justification": "Additional CredScan searcher specific to my team"
    },
    {
        "file": "\\files\\unittest.pfx", 
        "_justification": "Legitimate UT certificate file with private key"
    }
  ]
}
```

>[!WARNING] 
> Все будущие секреты, добавленные в файл, также будут подавлены автоматически.

#### <a name="what-are-recommended-guidelines-for-managing-secrets"></a>Рекомендации по управлению секретами

Следующие ресурсы помогут безопасно управлять секретами и получать доступ к конфиденциальным сведениям из приложений.

 - [Azure Key Vault](../../key-vault/index.yml)
 - [Azure Active Directory (Azure AD)](../../azure-sql/database/authentication-aad-overview.md)
 - [Управляемое удостоверение службы Azure AD (MSI)](https://azure.microsoft.com/blog/keep-credentials-out-of-code-introducing-azure-ad-managed-service-identity/)
 - [Управляемые удостоверения для ресурсов Azure](../../active-directory/managed-identities-azure-resources/overview.md)
 - [Управляемые удостоверения в службе приложений Azure и функциях Azure](../../app-service/overview-managed-identity.md)
 - [Библиотека AppAuthentication](/dotnet/api/overview/azure/service-to-service-authentication)


Дополнительные сведения см. в записи блога [безопасное управление секретами в облаке](https://devblogs.microsoft.com/visualstudio/managing-secrets-securely-in-the-cloud/).

#### <a name="can-i-write-my-own-custom-searchers"></a>Можно ли написать собственные пользовательские поисковые заноски?

Сканер учетных данных использует набор поисков содержимого, который обычно определяется в файле buildsearchers.xml. Файл содержит массив сериализованных объектов XML, представляющих объект **контентсеарчер** . Программа распространяется с помощью набора хорошо проверенных поисков. Но вы также можете реализовать собственные пользовательские средства поиска.

Поиск содержимого определяется следующим образом:

- **Имя**: описательное имя поиска, которое будет использоваться в выходных файлах средства проверки учетных данных. Мы рекомендуем использовать соглашение об именовании в стиле Camel для имен поисков.
- **RuleId**: стабильный непрозрачный идентификатор поискового запроса:
    - Средство поиска учетных данных по умолчанию назначает значение **RuleId** , например CSCAN0010, CSCAN0020 или CSCAN0030. Последняя цифра зарезервирована для потенциального слияния или разделения групп поиска с помощью регулярных выражений (Regex).
    - Значение **RuleId** для настроенного поискового запроса должно иметь собственное пространство имен. Примеры: КСКАН- \<Namespace\> 0010, КСКАН- \<Namespace\> 0020 и КСКАН- \<Namespace\> 0030.
    - Полное имя службы поиска — это сочетание значения **RuleId** и имени службы поиска. Примеры включают CSCAN0010. Кэйсторефилес и CSCAN0020. Base64EncodedCertificate.
- **Ресаурцематчпаттерн**: регулярное выражение расширений файлов, которое проверяется по поисковому запросу.
- **Контентсеарчпаттернс**: массив строк, содержащий операторы Regex для сопоставления. Если шаблоны поиска не определены, возвращаются все файлы, соответствующие значению **ресаурцематчпаттерн** .
- **Контентсеарчфилтерс**: массив строк, содержащий операторы Regex для фильтрации ложных срабатываний, зависящих от поиска.
- **Матчдетаилс**: описательное сообщение, инструкции по устранению рисков или и то, и другое, чтобы добавить для каждого соответствия поиска.
- **Рекомендация**: содержимое поля вариантов для сопоставления в формате с быстрым отчетом.
- **Серьезность**— целое число, отражающее степень серьезности проблемы. Наивысший уровень серьезности имеет значение 1.

  ![XML-код, демонстрирующий настройку средства проверки учетных данных](./media/security-tools/6-credscan-customsearchers.png)

### <a name="roslyn-analyzers"></a>Анализаторы Roslyn

#### <a name="what-are-common-errors-when-using-the-roslyn-analyzers-task"></a>Каковы распространенные ошибки при использовании задачи «анализаторы Roslyn»?

##### <a name="the-project-was-restored-using-a-wrong-microsoftnetcoreapp-version"></a>Проект был восстановлен с использованием неверной версии Microsoft. NETCore. app

Полное сообщение об ошибке:

"Ошибка: проект был восстановлен с помощью Microsoft. NETCore. app версии *x. x. x*, но с текущими параметрами вместо него будет использоваться версия *y. y. y* . Чтобы устранить эту проблему, убедитесь, что для операции восстановления и для последующих операций, например сборки или публикации, используются одинаковые параметры. Обычно эта проблема возникает, если свойство RuntimeIdentifier задается во время сборки или публикации, а не во время восстановления".

Поскольку задачи Roslyn Analyzer выполняются как часть компиляции, исходное дерево на компьютере сборки должно находиться в состоянии построения.

Шаг между основными шагами сборки и Roslyn Analyzer может привести к постановке исходного дерева в состояние, препятствующее сборке. Возможно, этот дополнительный шаг **dotnet.exe публикации**. Попробуйте сделать дубликат шага, который выполняет восстановление NuGet, непосредственно перед шагом Roslyn Analyzers. Этот дубликат шага может вернуть исходное дерево в состояние, которое можно построить.

##### <a name="cscexe-cant-create-an-analyzer-instance"></a>csc.exe не удается создать экземпляр анализатора

Полное сообщение об ошибке:

"csc.exe" завершился с кодом ошибки 1. невозможно создать экземпляр анализатора *AAAA* из C: \\ *BBBB*. dll: не удалось загрузить файл или сборку "Microsoft. CodeAnalysis, Version =*X. x. x. x*, Culture = Neutral, PublicKeyToken = 31bf3856ad364e35" или одну из его зависимостей. The system cannot find the file specified" ("Недопустимое значение "/src" каталога "cwd". Системе не удается найти указанный файл")

Убедитесь, что компилятор поддерживает анализаторы Roslyn. Выполнение команды **csc.exe/Version** должно сообщить значение версии 2,6 или более поздней.

Иногда CSPROJ-файл может переопределить установку Visual Studio на компьютере сборки, обратившись к пакету из Microsoft.Net. compilers. Если вы не планируете использовать определенную версию компилятора, удалите ссылки на Microsoft.Net. compilers. В противном случае убедитесь, что версия пакета, на который указывает ссылка, также составляет 2,6 или более поздней версии.

Попытайтесь получить путь к журналу ошибок, который указан в параметре **csc.exe/еррорлог** . Параметр и путь отображаются в журнале для задачи сборки Roslyn Analyzer. Они могут выглядеть примерно так, как **/еррорлог: ф:\тс-сервицес-123 \_ work\456\s\Some\Project\Code\Code.csproj.Sarif**

##### <a name="the-c-compiler-version-isnt-recent-enough"></a>Версия компилятора C# недостаточно актуальна

Чтобы получить последние версии компилятора C#, перейдите по адресу [Microsoft.NET. compilers](https://www.nuget.org/packages/Microsoft.Net.Compilers). Чтобы получить установленную версию, выполните **csc.exe/Version** в командной строке. Убедитесь, что вы ссылаетесь на пакет NuGet Microsoft.Net. compilers версии 2,6 или более поздней.

##### <a name="msbuild-and-vsbuild-logs-arent-found"></a>Журналы MSBuild и Всбуилд не найдены

Задаче сборки Roslyn Analyzers необходимо запросить Azure DevOps для журнала MSBuild из задачи сборки MSBuild. Если задача анализатора запускается сразу после задачи MSBuild, журнал еще не будет доступен. Поместите другие задачи между задачей MSBuild и задачей Roslyn Analyzers. К примерам других задач относятся Бинским и сканер защиты от вредоносных программ.

## <a name="next-steps"></a>Дальнейшие действия

Если вам нужна дополнительная помощь, поддержка анализа кода безопасности Майкрософт доступна с понедельника по пятницу с 9:00 до 5:00 по тихоокеанскому времени.

- Адаптации: см. [документацию по адаптации](security-code-analysis-onboard.md)
  
- Поддержка: Электронная почта. Наша группа [поддерживает анализ кода безопасности Майкрософт](mailto:mscahelp@microsoft.com?Subject=Microsoft%20Security%20Code%20Analysis%20Support%20Request)