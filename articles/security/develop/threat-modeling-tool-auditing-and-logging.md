---
title: Аудит и ведение журналов. Средство моделирования угроз Microsoft Azure | Документация Майкрософт
description: Сведения об аудите и ведении журнала в Threat Modeling Tool. См. сведения об устранении рисков и просмотр примеров кода.
services: security
documentationcenter: na
author: jegeib
manager: jegeib
editor: jegeib
ms.assetid: na
ms.service: security
ms.subservice: security-develop
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 02/07/2017
ms.author: jegeib
ms.openlocfilehash: 9d3f3ca7b5d4516c2ad5dc9cb19a2eaed0a8a4a8
ms.sourcegitcommit: 867cb1b7a1f3a1f0b427282c648d411d0ca4f81f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "94518283"
---
# <a name="security-frame-auditing-and-logging--mitigations"></a>Механизм безопасности. Аудит и ведение журналов | Устранение проблем 

| Продукт или служба | Статья |
| --------------- | ------- |
| **Dynamics CRM**    | <ul><li>[Выявление конфиденциальных сущностей в решении и внедрение аудита изменений](#sensitive-entities)</li></ul> |
| **Веб-приложение** | <ul><li>[Проверка принудительного применения аудита и ведения журнала в приложении](#auditing)</li><li>[Проверка размещения и разделения журнала](#log-rotation)</li><li>[Проверка запрета записи в журнал приложением конфиденциальных сведений о пользователях](#log-sensitive-data)</li><li>[Проверка ограниченного доступа к функциям аудита и ведения журнала](#log-restricted-access)</li><li>[Проверка записи в журнал событий управления пользователями](#user-management)</li><li>[Проверка наличия в системе встроенных защит от несанкционированного использования](#inbuilt-defenses)</li><li>[Включение функции ведения журналов диагностики для веб-приложений в службе приложений Azure](#diagnostics-logging)</li></ul> |
| **База данных** | <ul><li>[Проверка включения на сервере SQL Server аудита входа в систему](#identify-sensitive-entities)</li><li>[Включение обнаружения угроз в Azure SQL](#threat-detection)</li></ul> |
| **Хранилище Azure** | <ul><li>[Использование аналитики службы хранилища для аудита доступа к службе хранилища Azure](#analytics)</li></ul> |
| **WCF** | <ul><li>[Реализация надлежащего ведения журнала](#sufficient-logging)</li><li>[Реализация надлежащей обработки сбоя аудита](#audit-failure-handling)</li></ul> |
| **Веб-интерфейс API** | <ul><li>[Проверка принудительного применения аудита и ведения журнала в веб-API](#logging-web-api)</li></ul> |
| **Полевой шлюз Интернета вещей** | <ul><li>[Проверка включения надлежащих аудита и ведения журнала в полевом шлюзе](#logging-field-gateway)</li></ul> |
| **Облачный шлюз Интернета вещей** | <ul><li>[Убедитесь, что в облачном шлюзе применяются соответствующие аудит и ведение журнала.](#logging-cloud-gateway)</li></ul> |

## <a name="identify-sensitive-entities-in-your-solution-and-implement-change-auditing"></a><a id="sensitive-entities"></a>Определение конфиденциальных сущностей в решении и реализация аудита изменений

| Title                   | Сведения      |
| ----------------------- | ------------ |
| **Компонент**               | Dynamics CRM | 
| **Этап SDL**               | Сборка |  
| **Применимые технологии** | Универсальный шаблон |
| **Атрибуты**              | Недоступно  |
| **Справочные материалы**              | Недоступно  |
| **Шаги**                   | Определите в решении сущности с конфиденциальными данными и реализуйте аудит изменений в этих сущностях и полях. |

## <a name="ensure-that-auditing-and-logging-is-enforced-on-the-application"></a><a id="auditing"></a>Проверка принудительного применения аудита и ведения журнала в приложении

| Title                   | Сведения      |
| ----------------------- | ------------ |
| **Компонент**               | Веб-приложение | 
| **Этап SDL**               | Сборка |  
| **Применимые технологии** | Универсальный шаблон |
| **Атрибуты**              | Недоступно  |
| **Справочные материалы**              | Недоступно  |
| **Шаги**                   | Включите аудит и ведение журнала во всех компонентах. Журналы аудита должны записывать контекст пользователя. Определите все важные события для их регистрации в журнале. Реализуйте централизованное ведение журнала. |

## <a name="ensure-that-log-rotation-and-separation-are-in-place"></a><a id="log-rotation"></a>Проверка разделения и чередования журналов

| Title                   | Сведения      |
| ----------------------- | ------------ |
| **Компонент**               | Веб-приложение | 
| **Этап SDL**               | Сборка |  
| **Применимые технологии** | Универсальный шаблон |
| **Атрибуты**              | Недоступно  |
| **Справочные материалы**              | Недоступно  |
| **Шаги**                   | <p>Чередование журналов — автоматизированный процесс, используемый в системном администрировании при архивации устаревших файлов журналов. Серверы, на которых выполняются крупные приложения, часто регистрируют каждый запрос. Следовательно, создаются огромные журналы, и чередование журналов — это способ ограничить общий размер журналов с возможностью анализа последних событий. </p><p>Разделение журналов по сути означает, что хранить файлы журналов следует в отдельной секции, в которой выполняется ОС или приложения. Это необходимо, чтобы предотвратить DoS-атаки (отказ в обслуживании) или снижение производительности приложения.</p>|

## <a name="ensure-that-the-application-does-not-log-sensitive-user-data"></a><a id="log-sensitive-data"></a>Проверка запрета записи в журнал приложением конфиденциальных сведений о пользователях

| Title                   | Сведения      |
| ----------------------- | ------------ |
| **Компонент**               | Веб-приложение | 
| **Этап SDL**               | Сборка |  
| **Применимые технологии** | Универсальный шаблон |
| **Атрибуты**              | Недоступно  |
| **Справочные материалы**              | Недоступно  |
| **Шаги**                   | <p>Проверьте, не записываете ли вы в журнал конфиденциальные данные, которые пользователь отправляет на ваш сайт. Проверьте, не настроено ли ведение журнала, а также нет ли каких-либо побочных эффектов, вызванных недостатками разработки. К конфиденциальным данным относятся:</p><ul><li>учетные данные пользователя;</li><li>номер социального страхования и другие идентификационные сведения;</li><li>номера кредитных карт и другие финансовые сведения;</li><li>сведения о работоспособности;</li><li>закрытые ключи и другие данные, которые могут использоваться для расшифровки зашифрованных данных;</li><li>сведения о системе или приложении, которые можно использовать для более эффективных атак на приложение.</li></ul>|

## <a name="ensure-that-audit-and-log-files-have-restricted-access"></a><a id="log-restricted-access"></a>Проверка ограниченного доступа к функциям аудита и ведения журнала

| Title                   | Сведения      |
| ----------------------- | ------------ |
| **Компонент**               | Веб-приложение | 
| **Этап SDL**               | Сборка |  
| **Применимые технологии** | Универсальный шаблон |
| **Атрибуты**              | Недоступно  |
| **Справочные материалы**              | Недоступно  |
| **Шаги**                   | <p>Проверьте, настроены ли права доступа к файлам журнала соответствующим образом. Учетным записям приложения следует назначить доступ только для записи, а доступ только для чтения должен быть назначен (при необходимости) операторам и сотрудникам службы поддержки.</p><p>Учетными записями администраторов являются только те учетные записи, которые предполагают полный доступ. Проверьте правильное ограничение файлов журнала с помощью Windows ACL:</p><ul><li>Учетные записи приложений должны иметь доступ только для записи.</li><li>Операторам и сотрудникам службы поддержки при необходимости должен быть предоставлен доступ только для чтения.</li><li>Учетными записями администраторов являются только те учетные записи, которые предполагают полный доступ.</li></ul>|

## <a name="ensure-that-user-management-events-are-logged"></a><a id="user-management"></a>Проверка записи в журнал событий управления пользователями

| Title                   | Сведения      |
| ----------------------- | ------------ |
| **Компонент**               | Веб-приложение | 
| **Этап SDL**               | Сборка |  
| **Применимые технологии** | Универсальный шаблон |
| **Атрибуты**              | Недоступно  |
| **Справочные материалы**              | Недоступно  |
| **Шаги**                   | <p>Убедитесь, что приложение отслеживает следующие события управления пользователями: успешные и неудачные операции входа в систему, сброс пароля, изменение пароля, блокировка учетной записи, регистрация пользователей. Это помогает обнаруживать потенциально опасное поведение и реагировать на него, а также собирать данные об операции, например, чтобы отслеживать пользователей, получивших доступ к приложению.</p>|

## <a name="ensure-that-the-system-has-inbuilt-defenses-against-misuse"></a><a id="inbuilt-defenses"></a>Проверка наличия в системе встроенных защит от несанкционированного использования

| Title                   | Сведения      |
| ----------------------- | ------------ |
| **Компонент**               | Веб-приложение | 
| **Этап SDL**               | Сборка |  
| **Применимые технологии** | Универсальный шаблон |
| **Атрибуты**              | Недоступно  |
| **Справочные материалы**              | Недоступно  |
| **Шаги**                   | <p>Должны присутствовать элементы управления, которые выдают исключения системы безопасности в случае несанкционированного использования приложения. Например, если выполняется проверка ввода и злоумышленник пытается ввести вредоносный код, который не соответствует регулярному выражению, может быть выдано исключение системы безопасности, указывающее на несанкционированные операции в системе.</p><p>При этом рекомендуется регистрировать исключения системы безопасности в журнале, а также выполнить действия для устранения следующих проблем:</p><ul><li>проверка входных данных;</li><li>нарушений CSRF;</li><li>атак методом подбора (верхний лимит для числа запросов на пользователя на ресурс);</li><li>нарушений отправки файлов.</li><ul>|

## <a name="enable-diagnostics-logging-for-web-apps-in-azure-app-service"></a><a id="diagnostics-logging"></a>Включение ведения журнала диагностики для веб-приложений в службе приложений Azure

| Title                   | Сведения      |
| ----------------------- | ------------ |
| **Компонент**               | Веб-приложение | 
| **Этап SDL**               | Сборка |  
| **Применимые технологии** | Универсальный шаблон |
| **Атрибуты**              | EnvironmentType: Azure |
| **Справочные материалы**              | Недоступно  |
| **Шаги** | <p>В Azure доступны встроенные средства диагностики для отладки веб-приложений службы приложений. Это также относится к приложениям API и мобильным приложениям. Веб-приложения службы приложений включают функции диагностики для записи в журнал информации как с веб-сервера, так и из веб-приложения.</p><p>Используется следующее логическое разделение: диагностика веб-сервера и диагностика приложений.</p>|

## <a name="ensure-that-login-auditing-is-enabled-on-sql-server"></a><a id="identify-sensitive-entities"></a>Проверка включения на сервере SQL Server аудита входа в систему

| Title                   | Сведения      |
| ----------------------- | ------------ |
| **Компонент**               | База данных | 
| **Этап SDL**               | Сборка |  
| **Применимые технологии** | Универсальный шаблон |
| **Атрибуты**              | Недоступно  |
| **Справочные материалы**              | [Настройка аудита входа](/sql/ssms/configure-login-auditing-sql-server-management-studio) |
| **Шаги** | <p>Для обнаружения и подтверждения атак методом подбора пароля следует включить аудит входа в систему для сервера базы данных. Очень важно зарегистрировать неудачные попытки входа. Запись успешных и неудачных попыток входа предоставляет дополнительные преимущества во время судебного разбирательства.</p>|

## <a name="enable-threat-detection-on-azure-sql"></a><a id="threat-detection"></a>Включение обнаружения угроз в Azure SQL

| Title                   | Сведения      |
| ----------------------- | ------------ |
| **Компонент**               | База данных | 
| **Этап SDL**               | Сборка |  
| **Применимые технологии** | SQL Azure |
| **Атрибуты**              | Версия SQL: 12 |
| **Справочные материалы**              | [Приступая к работе с обнаружением угроз базы данных SQL](../../azure-sql/database/threat-detection-configure.md)|
| **Шаги** |<p>Система обнаружения угроз обнаруживает подозрительную активность в базе данных, указывающую на наличие потенциальных угроз безопасности. Таким образом система обнаружения угроз формирует дополнительный уровень безопасности, позволяющий клиентам обнаруживать потенциальные угрозы по мере возникновения, а также реагировать на них.</p><p>Пользователи могут анализировать подозрительные события с помощью функции аудита базы данных SQL Azure, которая позволяет определить причину таких событий (включая попытки получить доступ к данным в базе данных, испортить или использовать их).</p><p>Система обнаружения угроз упрощает устранение потенциальных угроз безопасности базы данных. Для этого пользователю не нужно быть специалистом в сфере обеспечения безопасности или иметь опыт работы со сложными системами отслеживания угроз.</p>|

## <a name="use-azure-storage-analytics-to-audit-access-of-azure-storage"></a><a id="analytics"></a>Использование аналитики службы хранилища для аудита доступа к службе хранилища Azure

| Title                   | Сведения      |
| ----------------------- | ------------ |
| **Компонент**               | Хранилище Azure | 
| **Этап SDL**               | Развертывание |  
| **Применимые технологии** | Универсальный шаблон |
| **Атрибуты**              | Недоступно |
| **Справочные материалы**              | [Отслеживание типа авторизации с помощью аналитики хранилища](../../storage/blobs/security-recommendations.md#loggingmonitoring) |
| **Шаги** | <p>Для каждой учетной записи хранения можно включить аналитику службы хранилища Azure Storage Analytics, обеспечив возможность ведения журнала и хранения данных метрик. Кроме того, в журналах аналитики хранилища содержится важная информация о способе выполнения аутентификации, примененном пользователем для доступа к хранилищу.</p><p>Это может быть очень полезным, если вы строго контролируете доступ к хранилищу. Например, в хранилище BLOB-объектов можно настроить все контейнеры как частные и реализовать использование службы SAS во всех приложениях. Затем можно регулярно проверять журналы для определения того, не осуществлялся ли доступ к BLOB-объектам с помощью ключей учетной записи хранения, что может свидетельствовать о нарушении безопасности. Таким образом также можно установить, что BLOB-объект является общедоступным, хотя он не должен быть таковым.</p>|

## <a name="implement-sufficient-logging"></a><a id="sufficient-logging"></a>Реализация надлежащего ведения журнала

| Title                   | Сведения      |
| ----------------------- | ------------ |
| **Компонент**               | WCF | 
| **Этап SDL**               | Сборка |  
| **Применимые технологии** | .NET Framework |
| **Атрибуты**              | Недоступно  |
| **Справочные материалы**              | [MSDN](/previous-versions/msp-n-p/ff648500(v=pandp.10)), [Fortify Kingdom](https://vulncat.fortify.com/en/detail?id=desc.config.dotnet.wcf_misconfiguration_insufficient_logging) |
| **Шаги** | <p>Отсутствие правильного журнала аудита после инцидента безопасности может лишить вас преимуществ в ходе судебного разбирательства. Технология Windows Communication Foundation (WCF) позволяет регистрировать успешные и неудачные попытки аутентификации.</p><p>Использование журнала неудачных попыток аутентификации поможет администраторам узнать о потенциальных атаках методом подбора. Аналогично, ведение журнала событий успешной аутентификации позволяет получить полезные данные аудита при компрометации подлинной учетной записи. Включите функцию аудита безопасности WCF. |

### <a name="example"></a>Пример
Ниже приведен пример конфигурации с включенной функцией аудита.
```
<system.serviceModel>
    <behaviors>
        <serviceBehaviors>
            <behavior name=""NewBehavior"">
                <serviceSecurityAudit auditLogLocation=""Default""
                suppressAuditFailure=""false"" 
                serviceAuthorizationAuditLevel=""SuccessAndFailure""
                messageAuthenticationAuditLevel=""SuccessAndFailure"" />
                ...
            </behavior>
        </servicebehaviors>
    </behaviors>
</system.serviceModel>
```

## <a name="implement-sufficient-audit-failure-handling"></a><a id="audit-failure-handling"></a>Реализация надлежащей обработки сбоя аудита

| Title                   | Сведения      |
| ----------------------- | ------------ |
| **Компонент**               | WCF | 
| **Этап SDL**               | Сборка |  
| **Применимые технологии** | .NET Framework |
| **Атрибуты**              | Недоступно  |
| **Справочные материалы**              | [MSDN](/previous-versions/msp-n-p/ff648500(v=pandp.10)), [Fortify Kingdom](https://vulncat.fortify.com/en/detail?id=desc.config.dotnet.wcf_misconfiguration_insufficient_audit_failure_handling) |
| **Шаги** | <p>Разработанное решение не настроено для выдачи исключения при возникновении ошибки записи в журнал аудита. Если служба WCF не настроена выдавать исключения при ошибке записи в журнал аудита, программа не будет уведомлена о сбое и аудит критических событий безопасности может не произойти.</p>|

### <a name="example"></a>Пример
Элемент `<behavior/>` файла конфигурации WCF ниже указывает службе WCF уведомлять приложению о неудачной попытке службы записать событие в журнал аудита.
```
<behaviors>
    <serviceBehaviors>
        <behavior name="NewBehavior">
            <serviceSecurityAudit auditLogLocation="Application"
            suppressAuditFailure="true"
            serviceAuthorizationAuditLevel="Success"
            messageAuthenticationAuditLevel="Success" />
        </behavior>
    </serviceBehaviors>
</behaviors>
```
Настройте службу WCF уведомлять программу всякий раз, когда не удается выполнить запись в журнал аудита. Для программы следует разработать альтернативную схему оповещения, чтобы уведомлять организации, в которых ведение журналов аудита не поддерживается. 

## <a name="ensure-that-auditing-and-logging-is-enforced-on-web-api"></a><a id="logging-web-api"></a>Проверка принудительного применения аудита и ведения журнала в веб-API

| Title                   | Сведения      |
| ----------------------- | ------------ |
| **Компонент**               | Веб-API | 
| **Этап SDL**               | Сборка |  
| **Применимые технологии** | Универсальный шаблон |
| **Атрибуты**              | Недоступно  |
| **Справочные материалы**              | Недоступно  |
| **Шаги** | Включите аудит и ведение журнала в веб-API. Журналы аудита должны записывать контекст пользователя. Определите все важные события для их регистрации в журнале. Реализуйте централизованное ведение журнала. |

## <a name="ensure-that-appropriate-auditing-and-logging-is-enforced-on-field-gateway"></a><a id="logging-field-gateway"></a>Проверка включения надлежащих аудита и ведения журнала в полевом шлюзе

| Title                   | Сведения      |
| ----------------------- | ------------ |
| **Компонент**               | Полевой шлюз Интернета вещей | 
| **Этап SDL**               | Сборка |  
| **Применимые технологии** | Универсальный шаблон |
| **Атрибуты**              | Недоступно  |
| **Справочные материалы**              | Недоступно  |
| **Шаги** | <p>При подключении нескольких устройств к полевому шлюзу убедитесь, что попытки подключения и состояние аутентификации (успешно выполненной или нет) для отдельных устройств регистрируются в журнале и хранятся в полевом шлюзе.</p><p>Кроме того, если в полевом шлюзе хранятся учетные данные Центра Интернета вещей для отдельных устройств, проверьте, выполняется ли аудит при извлечении этих учетных данных. Для долгосрочного хранения следует разработать процесс периодической загрузки журналов в Центр Интернета вещей или хранилище Azure.</p> |

## <a name="ensure-that-appropriate-auditing-and-logging-is-enforced-on-cloud-gateway"></a><a id="logging-cloud-gateway"></a>Проверка включения надлежащих аудита и ведения журнала в облачном шлюзе

| Title                   | Сведения      |
| ----------------------- | ------------ |
| **Компонент**               | Облачный шлюз Интернета вещей | 
| **Этап SDL**               | Сборка |  
| **Применимые технологии** | Универсальный шаблон |
| **Атрибуты**              | Недоступно  |
| **Справочные материалы**              | [Вводные сведения о мониторинге операций Центра Интернета вещей](../../iot-hub/iot-hub-operations-monitoring.md) |
| **Шаги** | <p>Разработайте процесс сбора и хранения данных аудита, собранных в ходе мониторинга операций Центра Интернета вещей. Включите следующие категории мониторинга:</p><ul><li>Операции с удостоверениями устройства</li><li>обмен данными между устройством и облаком;</li><li>обмен данными между облаком и устройством;</li><li>Соединения</li><li>Передача файлов</li></ul>|