---
title: Разработка безопасных приложений на Microsoft Azure
description: В этой статье обсуждаются рекомендации по этапам разработки проекта веб-приложения.
author: TerryLanfear
manager: barbkess
ms.author: terrylan
ms.date: 06/11/2019
ms.topic: article
ms.service: security
ms.subservice: security-develop
services: azure
ms.assetid: 521180dc-2cc9-43f1-ae87-2701de7ca6b8
ms.devlang: na
ms.tgt_pltfrm: na
ms.workload: na
ms.openlocfilehash: 743412b7602e5781911cdf190e41a5ee15bfddd4
ms.sourcegitcommit: 910a1a38711966cb171050db245fc3b22abc8c5f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "96487683"
---
# <a name="design-secure-applications-on-azure"></a>Разработка безопасных приложений в Azure
В этой статье представлены действия по обеспечению безопасности и элементы управления, которые следует учитывать при проектировании приложений для облака. Учебные материалы, а также контрольные вопросы и основные понятия, которые следует учитывать во время требований и этапов проектирования [жизненного цикла разработки безопасности Майкрософт (SDL)](/previous-versions/windows/desktop/cc307891(v=msdn.10)) . Цель — помочь вам определить действия и службы Azure, которые можно использовать для создания более безопасного приложения.

В этой статье описаны следующие этапы SDL:

- Обучение
- Требования
- Конструирование

## <a name="training"></a>Обучение
Прежде чем приступить к разработке облачного приложения, уделите время для понимания безопасности и конфиденциальности в Azure. Выполнив этот шаг, можно уменьшить число и степень серьезности уязвимых мест в приложении. Вы будете готовы отреагировать на подходящие изменения в постоянно меняющейся ландшафте угроз.

Используйте следующие ресурсы на этапе обучения, чтобы ознакомиться со службами Azure, доступными для разработчиков, и с рекомендациями по обеспечению безопасности в Azure.

  - [Руководство разработчика по Azure](https://azure.microsoft.com/campaigns/developer-guide/) показывает, как приступить к работе с Azure. В этом руководством показано, какие службы можно использовать для запуска приложений, хранения данных, внедрения аналитики, создания приложений IoT и развертывания решений с более эффективным и безопасным способом.

  - [Руководство по началу работы для разработчиков Azure](../../guides/developer/azure-developer-guide.md) предоставляет необходимые сведения для разработчиков, желающих приступить к работе с платформой Azure в соответствии с потребностями разработки.

  - [Пакеты SDK и средства](../../index.yml?pivot=sdkstools) описывают средства, доступные в Azure.

  - [Azure DevOps Services](/azure/devops/) предоставляет средства для совместной работы в среде разработки. Эти средства включают высокопроизводительные конвейеры, бесплатные репозитории Git, настраиваемые доски Канбан, а также обширное автоматическое и облачное нагрузочное тестирование.
    [Центр ресурсов DevOps](/azure/devops/learn/) объединяет наши ресурсы для обучения методик DevOps, управления версиями Git, гибких методов, способов работы с DevOps в корпорации Майкрософт, а также для оценки собственного процесса DevOps.

  - [Первые 5 элементов безопасности, которые следует учесть перед отправкой в рабочую среду](/learn/modules/top-5-security-items-to-consider/index?WT.mc_id=Learn-Blog-tajanca) , показывают, как защитить веб-приложения в Azure и защитить приложения от наиболее распространенных и опасных атак веб-приложений.

  - Security [DevOps Kit for Azure](https://azsk.azurewebsites.net/index.html) — это набор сценариев, средств, расширений и автоматизации, которые применяются к полным подписке Azure и безопасности ресурсов для групп DevOps, использующих обширную автоматизацию. В DevOps Kit для Azure можно узнать, как плавно интегрировать безопасность в собственные рабочие процессы DevOps. В комплект входят такие средства, как проверка безопасности (СВТС), которые помогают разработчикам писать безопасный код и тестировать безопасную конфигурацию своих облачных приложений в коде и на ранних стадиях разработки.

  - Рекомендации [по обеспечению безопасности для решений Azure](https://azure.microsoft.com/resources/security-best-practices-for-azure-solutions) предоставляют набор рекомендаций по обеспечению безопасности для использования при проектировании, развертывании и управлении облачными решениями с помощью Azure.

## <a name="requirements"></a>Требования
Этап определения требований — это важный шаг в определении того, что такое приложение и что оно будет делать при его освобождении. На этапе требований также стоит подумать об элементах управления безопасностью, которые будут созданы в приложении. На этом этапе вы также начнете шаги, которые будут выполнены на протяжении всего жизненного цикла SDL, чтобы обеспечить выпуск и развертывание безопасного приложения.

### <a name="consider-security-and-privacy-issues"></a>Примите во внимание проблемы безопасности и конфиденциальности
Этот этап лучше подходит для соблюдения базовых проблем безопасности и конфиденциальности. Определение приемлемых уровней безопасности и конфиденциальности в начале проекта помогает команде:

- Общие сведения о рисках, связанных с проблемами безопасности.
- Выявление и устранение ошибок безопасности во время разработки.
- Применение установленных уровней безопасности и конфиденциальности во всем проекте.

При написании требований для приложения обязательно рассмотрите средства управления безопасностью, которые помогут обеспечить безопасность приложения и данных.

### <a name="ask-security-questions"></a>Задать контрольные вопросы
Задавайте вопросы безопасности следующим образом:

  - Содержит ли приложение конфиденциальные данные?

  - Собирается ли мое приложение сохранять или хранить данные, которые должны соответствовать отраслевым стандартам и программам обеспечения соответствия, таким как [Федеральный совет по финансовому учреждению (FFIEC)](/previous-versions/azure/security/blueprints/ffiec-analytics-overview) или [стандарты безопасности отраслевых платежных карт (PCI DSS)](/previous-versions/azure/security/blueprints/pcidss-analytics-overview)?

  - Будет ли приложение собрано или содержать конфиденциальные данные личного или клиентского данных, которые можно использовать самостоятельно или с другой информацией для обнаружения, обращения или поиска одного человека?

  - Будет ли приложение собрано или содержать данные, которые можно использовать для доступа к медицинских, образовательным, финансовым или трудовым сведениям? Определение конфиденциальности данных на этапе требований поможет вам классифицировать данные и определить метод защиты данных, который будет использоваться для приложения.

  - Где и как хранятся мои данные? Рассмотрим, как будет осуществляться мониторинг служб хранилища, используемых приложением для любых непредвиденных изменений (например, медленные значения времени ответа). Сможете ли вы повлиять на ведение журнала для сбора более подробных данных и тщательно проанализировать проблему?

  - Будет ли мое приложение доступно для общего доступа (в Интернете) или только для внутреннего использования? Если ваше приложение доступно для общего доступа, как защитить данные, которые могут быть собраны в случае неправильного использования? Если приложение доступно только для внутреннего использования, определите, кто из Организации должен иметь доступ к приложению и как долго они должны иметь доступ.

  - Вы понимаете модель удостоверений перед началом разработки приложения? Как вы определяете, что пользователи говорят, что они имеют и что у пользователя есть право на выполнение?

  - Позволяет ли приложение выполнять важные или важные задачи (например, переносить деньги, разблокирование дверей или доставка медицина)?
    Рассмотрите способ проверки того, что пользователь, выполняющий важную задачу, имеет право на выполнение этой задачи и способ проверки подлинности пользователя, который им говорят. Авторизация (AuthZ) — это действие предоставления субъекту безопасности с проверкой подлинности разрешения на выполнение каких-либо действий. Проверка подлинности (AuthN) — это трудная сторона для легальных учетных данных.

  - Выполняет ли мое приложение какие – либо рискованные действия по, например разрешить пользователям отправлять или скачивать файлы или другие данные? Если приложение выполняет рискованные действия, подумайте, как ваше приложение будет защищать пользователей от обработки вредоносных файлов или данных.

### <a name="review-owasp-top-10"></a>Ознакомьтесь с OWASP Top 10
Рассмотрите возможность просмотра [<span class="underline">OWASP лучших 10 угроз безопасности приложений</span>](https://www.owasp.org/index.php/Category:OWASP_Top_Ten_Project).
OWASP Top 10 устраняет критически важные риски безопасности веб-приложений.
Осведомленность об этих угрозах безопасности может помочь в решении и проектировании решений, которые снижают риски в приложении.

Для предотвращения нарушений важно подумать об элементах управления безопасностью.
Однако вы также хотите предположить, [что произойдет нарушение](/azure/devops/learn/devops-at-microsoft/security-in-devops) . Предполагая, что нарушение безопасности поможет заранее ответить на некоторые важные вопросы, так что им не нужно отвечать в экстренной ситуации:

  - Как будет обнаружена атака?

  - Что делать при атаке или нарушении?

  - Как будет происходить восстановление после атаки, например утечки данных или несанкционированного изменения?

## <a name="design"></a>Конструирование

Этап проектирования является критически важным для создания рекомендаций по проектированию и функциональным спецификациям. Это также крайне важно для проведения анализа рисков, который помогает устранить проблемы безопасности и конфиденциальности в рамках всего проекта.

При наличии требований к безопасности на месте и использовании концепций безопасного проектирования можно избежать или не сокращать возможности для изъяна безопасности. Недостаток безопасности — это ценная информация о структуре приложения, которая может позволить пользователю выполнять вредоносные или непредвиденные действия после выпуска приложения.

На этапе проектирования также Подумайте о том, как можно применять безопасность в слоях. один уровень защиты не обязательно должен быть достаточным. Что произойдет, если злоумышленник пойдет за брандмауэром веб-приложения (WAF)? Для защиты от атаки требуется еще один контроль безопасности.

Учитывая это, мы рассмотрим следующие концепции безопасного проектирования и элементы управления безопасностью, которые следует учитывать при проектировании безопасных приложений:

- Использование библиотеки безопасного кодирования и программной платформы.
- Проверка на наличие уязвимых компонентов.
- Использование моделирования угроз во время разработки приложения.
- Сократите контактную зону для атак.
- В качестве основного периметра безопасности следует применять политику удостоверений.
- Требовать повторную проверку подлинности для важных транзакций.
- Используйте решение для управления ключами, чтобы защитить ключи, учетные данные и другие секреты.
- Защитите конфиденциальные данные.
- Реализуйте резервные меры.
- Воспользуйтесь преимуществами обработки ошибок и исключений.
- Используйте ведение журнала и оповещения.

### <a name="use-a-secure-coding-library-and-a-software-framework"></a>Использование библиотеки безопасного кодирования и программной платформы

Для разработки используйте библиотеку безопасного кодирования и программную платформу с внедренной безопасностью. Разработчики могут использовать существующие, проверенные возможности (шифрование, входные самому, кодировку вывода, ключи или строки подключения, а также все остальное, что будет считаться элементом управления безопасностью) вместо разработки средств безопасности с нуля. Это помогает защититься от недостатков проектирования и реализации, связанных с безопасностью.

Убедитесь, что вы используете последнюю версию платформы и все функции безопасности, доступные в платформе. Корпорация Майкрософт предлагает полный [набор средств разработки](https://azure.microsoft.com/product-categories/developer-tools/) для всех разработчиков, работающий на любой платформе или языке, для доставки облачных приложений. Вы можете выполнять код на выбранном языке, выбрав один из различных [пакетов SDK](https://azure.microsoft.com/downloads/).
Вы можете воспользоваться преимуществами полнофункциональных интегрированных сред разработки (IDE) и редакторов с расширенными возможностями отладки и встроенной поддержкой Azure.

Корпорация Майкрософт предлагает разнообразные [языки, платформы и средства](../../index.yml?panel=sdkstools-all&pivot=sdkstools) , которые можно использовать для разработки приложений в Azure. Например, [Azure для разработчиков .NET и .NET Core](/dotnet/azure/). Для всех языков и платформ, предлагаемых нами, вы найдете краткие руководства, руководства и справочники по API, которые помогут вам быстро приступить к работе.

Azure предлагает разнообразные службы, которые можно использовать для размещения веб-сайтов и приложений. Эти службы позволяют разрабатывать данные на предпочитаемом языке, будь то .NET, .NET Core, Java, Ruby, Node.js, PHP или Python.
[Веб-приложения службы приложений Azure](../../app-service/overview.md) (веб-приложения) являются одной из этих служб.

Веб-приложения добавляют возможности Microsoft Azure в приложение. Она включает в себя безопасность, балансировку нагрузки, автоматическое масштабирование и автоматизированное управление. Вы также можете воспользоваться преимуществами возможностей DevOps в веб-приложениях, таких как Управление пакетами, промежуточные среды, Пользовательские домены, сертификаты SSL/TLS и непрерывное развертывание из Azure DevOps, GitHub, Docker HUB и других источников.

Azure предлагает другие службы, которые можно использовать для размещения веб-сайтов и приложений. В большинстве случаев оптимальным вариантом являются веб-приложения. Для архитектуры микрослужбы рассмотрите [Service Fabric Azure](https://azure.microsoft.com/documentation/services/service-fabric).
См. дополнительные сведения о дополнительном контроле над [виртуальными машинами Azure, на которых выполняется код](https://azure.microsoft.com/documentation/services/virtual-machines/).
Дополнительные сведения о выборе между этими службами Azure см. в статье [Сравнение службы приложений Azure, виртуальных машин, Service Fabric и облачных служб](/azure/architecture/guide/technology-choices/compute-decision-tree).

### <a name="apply-updates-to-components"></a>Применить обновления к компонентам

Чтобы предотвратить уязвимости, следует постоянно выполнять инвентаризацию клиентских и серверных компонентов (например, платформ и библиотек) и их зависимостей для обновлений. Новые уязвимости и обновленные версии программного обеспечения постоянно выпускаются. Убедитесь, что у вас есть план для отслеживания, рассмотрения и применения обновлений или изменений конфигурации для используемых библиотек и компонентов.

Советы по [использованию компонентов с известными уязвимостями](https://www.owasp.org/index.php/Top_10-2017_A9-Using_Components_with_Known_Vulnerabilities) см. на странице [Open Web Application Security Project (OWASP)](https://www.owasp.org/index.php/Main_Page) . Вы также можете подписываться на оповещения по электронной почте об уязвимостях системы безопасности, связанных с используемыми компонентами.

### <a name="use-threat-modeling-during-application-design"></a>Использование моделирование угроз во время разработки приложения

Моделирование угроз — это процесс выявления потенциальных угроз безопасности для вашего бизнеса и приложения, а также обеспечения необходимых мер по их устранению. SDL указывает, что группы должны участвовать в моделировании угроз на этапе проектирования, когда разрешение потенциальных проблем относительно просто и экономично. Использование моделирования угроз на этапе проектирования может значительно снизить общую стоимость разработки.

Чтобы упростить процесс моделирования угроз, мы разработали [SDL Threat Modeling Tool](threat-modeling-tool.md) с учетом несоблюдения экспертов по безопасности. Это средство упрощает моделирование угроз для всех разработчиков, предоставляя четкие рекомендации по созданию и анализу моделей угроз.

Моделирование архитектуры приложения и перечисление [угроз,](https://docs.google.com/viewer?a=v&pid=sites&srcid=ZGVmYXVsdGRvbWFpbnxzZWN1cmVwcm9ncmFtbWluZ3xneDo0MTY1MmM0ZDI0ZjQ4ZDMy) которые могут быть подменены, подмена, отказ, раскрытие информации, отказ в обслуживании и повышение привилегий, на всех границах доверия доказана эффективным способом перехвата ошибок разработки на ранних этапах. В следующей таблице перечислены угрозы STRIDE, а также приведены примеры их устранения, в которых используются функции, предоставляемые Azure. Эти способы могут помочь не во всех ситуациях.

| Угроза | Свойство безопасности | Потенциальная защита платформы Azure |
| ---------------------- | --------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| Спуфинг               | Проверка подлинности        | [Требовать подключения по протоколу HTTPS](/aspnet/core/security/enforcing-ssl?tabs=visual-studio&view=aspnetcore-2.1). |
| Незаконное изменение              | Целостность             | Проверьте сертификаты SSL/TLS. Приложения, использующие SSL/TLS, должны полностью проверять сертификаты X. 509 сущностей, к которым они подключаются. Используйте сертификаты Azure Key Vault для [управления сертификатами x509](../../key-vault/general/about-keys-secrets-certificates.md). |
| Отказ            | Невозможность отказа       | Включите [мониторинг и диагностику](/azure/architecture/best-practices/monitoring) в Azure.|
| Раскрытие информации | Конфиденциальность       | Шифрование конфиденциальных [неактивных](../fundamentals/encryption-atrest.md) и [транзитных](../fundamentals/data-encryption-best-practices.md#protect-data-in-transit)данных. |
| Отказ в обслуживании      | Доступность          | Мониторинг метрик производительности для потенциальных условий отказа в обслуживании. Примените фильтры подключения. [Защита от атак DDoS Azure](../../ddos-protection/ddos-protection-overview.md#next-steps)в сочетании с рекомендациями по проектированию приложений обеспечивает защиту от атак от атак DDoS.|
| Несанкционированное получение привилегий | Авторизация         | Используйте Azure Active Directory <span class="underline"></span> [Управление привилегированными пользователями](../../active-directory/privileged-identity-management/pim-configure.md).|

### <a name="reduce-your-attack-surface"></a>Сократите контактную зону для атак

Область атак — это общая сумма возможных уязвимостей. В этом документе основное внимание уделяется области атаки приложения.
Основное внимание уделяется защите приложения от атак. Простой и быстрый способ снижения уязвимой зоны — удаление неиспользуемых ресурсов и кода из приложения. Чем меньше ваше приложение, тем меньше зона для атак. Например, удалите:

- Код для функций, которые вы еще не выпустили.
- Отладка кода поддержки.
- Сетевые интерфейсы и протоколы, которые не используются или являются устаревшими.
- Виртуальные машины и другие ресурсы, которые вы не используете.

Выполнение регулярной очистки ресурсов и подтверждение удаления неиспользуемого кода — это прекрасный способ убедиться в наличии меньшего количества возможностей для атак злоумышленников.

Более подробный и глубокий способ снизить область атак — завершить анализ уязвимой зоны. Анализ уязвимой зоны помогает сопоставлять части системы, которые необходимо проверить и проверить на наличие уязвимостей в системе безопасности.

Целью анализа уязвимой зоны является понимание областей риска в приложении, чтобы разработчики и специалисты по безопасности понимали, какие части приложения открыты для атак. Затем можно найти способы, позволяющие максимально снизить этот потенциал, определить, когда и как меняется контактная зона, и что это означает с точки зрения риска.

Анализ уязвимой зоны помогает выявление следующих данных:

- Функции и части системы, которые необходимо проверить и проверить на наличие уязвимостей в системе безопасности.
- Области кода с высоким риском, требующие глубокой защиты (части системы, которые необходимо защищать).
- При изменении области атаки и необходимости обновления оценки угроз.

Снижение возможностей злоумышленников с целью взлома потенциально слабого места или уязвимости требует тщательного анализа общей области атаки приложения. Он также включает в себя отключение или запрет доступа к системным службам, применение принципа наименьших привилегий и применение многослойной защиты везде, где это возможно.

Мы обсудим [проведение проверки уязвимой зоны](secure-develop.md#conduct-attack-surface-review) на этапе проверки SDL.

> [!NOTE]
> **В чем разница между моделированием угроз и анализом уязвимой зоны?**
Моделирование угроз — это процесс выявления потенциальных угроз безопасности для приложения и обеспечения надлежащего устранения угроз. Анализ уязвимой зоны определяет области кода с высоким риском, которые открыты для атак. Она включает в себя поиск способов защиты областей приложения с высоким риском, а также просмотр и тестирование этих областей кода перед развертыванием приложения.

### <a name="adopt-a-policy-of-identity-as-the-primary-security-perimeter"></a>Применение политики удостоверения в качестве основного периметра безопасности

При проектировании облачных приложений важно расширить свой фокус периметра безопасности от подхода, ориентированного на сеть, к подходу, ориентированному на идентификацию. Исторически основным локальным периметром безопасности была сеть Организации. В большинстве локальных схем безопасности используется сеть в качестве основной сводки по безопасности. Для облачных приложений лучше обслуживать идентификаторы в качестве основного периметра безопасности.

Что можно сделать, чтобы разработать подход, ориентированный на идентификацию, для разработки веб-приложений:

- Применяйте многофакторную проверку подлинности для пользователей.
- Используйте надежные платформы аутентификации и авторизации.
- Примените принцип наименьших привилегий.
- Реализуйте JIT-доступ.

#### <a name="enforce-multi-factor-authentication-for-users"></a>Применение многофакторной проверки подлинности для пользователей

Используйте двухфакторную аутентификацию. Двухфакторная проверка подлинности — это текущий стандарт для аутентификации и авторизации, так как он позволяет избежать слабых мест безопасности, присущих именам пользователей и паролей для проверки подлинности. Доступ к интерфейсам управления Azure (портал Azure/Remote PowerShell) и к службам, ориентированным на клиентов, должен быть разработан и настроен для использования [многофакторной идентификации Azure](../../active-directory/authentication/concept-mfa-howitworks.md).

#### <a name="use-strong-authentication-and-authorization-platforms"></a>Использование надежных платформ для проверки подлинности и авторизации

Используйте предоставляемые платформой механизмы аутентификации и авторизации вместо пользовательского кода. Это связано с тем, что разработка пользовательского кода проверки подлинности может быть подвержена ошибкам. Коммерческий код (например, от Майкрософт) часто проверяется на предмет безопасности. [Azure Active Directory (Azure AD)](../../active-directory/fundamentals/active-directory-whatis.md) — это решение для идентификации и управления доступом в Azure. Эти средства и службы Azure AD помогают в обеспечении безопасной разработки:

- [Платформа Microsoft Identity](../../active-directory/develop/index.yml) — это набор компонентов, которые разработчики используют для создания приложений, которые безопасно подписываются пользователям. Платформа помогает разработчикам создавать приложения с одним клиентом, бизнес-приложениями и разработчиками, желающими разрабатывать приложения с несколькими клиентами. В дополнение к базовому входу приложения, созданные с помощью платформы идентификации Майкрософт, могут вызывать API Майкрософт и настраиваемые API. Платформа удостоверений Майкрософт поддерживает стандартные отраслевые протоколы, такие как OAuth 2,0 и OpenID Connect Connect.

- [Azure Active Directory B2C (Azure AD B2C)](../../active-directory-b2c/index.yml) — это служба управления удостоверениями, которую можно использовать для настройки и управления регистрацией клиентов, входа в систему и управления их профилями при использовании ваших приложений. К ним относятся приложения, разработанные для iOS, Android и .NET, а также другие. Azure AD B2C включает эти действия при защите идентификаторов клиентов.

#### <a name="apply-the-principle-of-least-privilege"></a>Применение принципа наименьших привилегий

Концепция [наименьших привилегий](https://en.wikipedia.org/wiki/Principle_of_least_privilege) означает предоставление пользователям точных уровней доступа и контроля, необходимых им для выполнения своих заданий, и ничего больше.

Требуется ли разработчику программного обеспечения права администратора домена? Нужен ли помощнику по администрированию доступ к административным элементам управления на своем персональном компьютере? Оценка доступа к программному обеспечению не отличается. Если вы используете [Управление доступом на основе ролей Azure (Azure RBAC)](../../role-based-access-control/overview.md) для предоставления пользователям различных возможностей и полномочий в приложении, вы не получите доступ ко всем ресурсам. Ограничивая доступ к тем, что требуется для каждой роли, вы ограничиваете риск возникновения проблемы безопасности.

Убедитесь, что приложение применяет [минимальные привилегии](/windows-server/identity/ad-ds/plan/security-best-practices/implementing-least-privilege-administrative-models#in-applications) на всех шаблонах доступа.

> [!NOTE]
> Правила минимальных привилегий должны применяться к программному обеспечению и к пользователям, создающим программное обеспечение. Разработчики программного обеспечения могут быть огромным риском для ИТ-безопасности, если им предоставляется слишком большой доступ. Последствия могут быть серьезными, если разработчику присвоено вредоносное намерение или слишком много доступа. Мы рекомендуем применять правила минимальных привилегий к разработчикам на протяжении всего жизненного цикла разработки.

#### <a name="implement-just-in-time-access"></a>Реализация JIT-доступа

Реализуйте JIT *-* доступ для дальнейшего снижения времени предоставления привилегий. Используйте [Azure AD privileged Identity Management](../../active-directory/roles/security-planning.md#stage-3-take-control-of-admin-activity) , чтобы:

- Предоставьте пользователям разрешения, необходимые только для JIT.
- назначать роли на короткий период с автоматическим отзывом привилегий.

### <a name="require-re-authentication-for-important-transactions"></a>Требовать повторную проверку подлинности для важных транзакций

[Подделка межсайтовых запросов](/aspnet/core/security/anti-request-forgery?view=aspnetcore-2.1) (также известная как *XSRF* или *CSRF*) — это атака на веб-приложения, в которых вредоносное приложение влияет на взаимодействие между браузером клиента и веб-приложением, которое доверяет этому браузеру. Атаки от подделки запросов между сайтами возможны, поскольку веб-браузеры автоматически отправляют некоторые типы маркеров проверки подлинности при каждом запросе на веб-сайт.
Такая форма использования называется также *атакой одним щелчком* или *обкрытием сеансов* , поскольку атака использует преимущества ранее проверенного сеанса пользователя.

Лучший способ защиты от атак такого рода — запросить у пользователя что-то, которое может предоставить только пользователь, перед каждой важной транзакцией, такой как покупка, Деактивация учетной записи или изменение пароля. Вы можете попросить пользователя повторно ввести пароль, завершить CAPTCHA или отправить маркер секрета, который будет иметь только пользователь. Наиболее распространенным подходом является секретный токен.

### <a name="use-a-key-management-solution-to-secure-keys-credentials-and-other-secrets"></a>Использование решения для управления ключами для защиты ключей, учетных данных и других секретов

Потеря ключей и учетных данных является распространенной проблемой. Хуже потери ключей и учетных данных может быть только получение к ним несанкционированного доступа. Злоумышленники могут воспользоваться преимуществами автоматизированных и ручных методов поиска ключей и секретов, которые хранятся в репозиториях кода, например GitHub. Не размещайте ключи и секреты в этих общедоступных репозиториях кода или на любом другом сервере.

Всегда размещайте ключи, сертификаты, секреты и строки подключения в решении для управления ключами. Вы можете использовать централизованное решение, в котором ключи и секреты хранятся в аппаратных модулях безопасности (HSM). Azure предоставляет аппаратный модуль HSM в облаке с [Azure Key Vault](../../key-vault/general/overview.md).

Key Vault является *хранилищем секретов*: это централизованная облачная служба для хранения секретов приложения. Key Vault защищает конфиденциальные данные, сохраняя секреты приложений в одном централизованном расположении и обеспечивая безопасный доступ, Управление разрешениями и ведение журнала доступа.

Секреты хранятся в отдельных *хранилищах*. Каждое хранилище имеет собственные настройки и политики безопасности для управления доступом. Вы получаете данные через REST API или через клиентский пакет SDK, доступный для большинства языков программирования.

> [!IMPORTANT]
> Azure Key Vault предназначен для хранения секретов конфигурации для серверных приложений. Он не предназначен для хранения данных, принадлежащих пользователям приложений. Это отражается в его характеристиках производительности, API и модели стоимости.
>
> Пользовательские данные должны храниться в любом расположении, например в экземпляре базы данных SQL Azure, который имеет прозрачное шифрование данных (TDE) или в учетной записи хранения, использующей Шифрование службы хранилища Azure. Секреты, используемые приложением для доступа к этим хранилищам данных, можно хранить в Azure Key Vault.

### <a name="protect-sensitive-data"></a>Защита конфиденциальных данных

Защита данных является важнейшей частью стратегии безопасности.
Классификация данных и определение потребностей в защите данных помогает спроектировать приложение с учетом требований к безопасности данных. Классификация (классификация) сохраненных данных с учетом конфиденциальности и бизнес-влияния помогает разработчикам определить риски, связанные с данными.

Пометка всех применимых данных в качестве конфиденциальных при проектировании форматов данных. Убедитесь, что приложение рассматривает применимые данные как конфиденциальные. Эти рекомендации помогут защитить конфиденциальные данные:

- Используйте шифрование.
- Избегайте жестко кодированных секретов, таких как ключи и пароли.
- Убедитесь, что используются элементы управления доступом и аудит.

#### <a name="use-encryption"></a>Использовать шифрование

Защита данных должна быть важнейшей частью стратегии безопасности.
Если данные хранятся в базе данных или перемещаются между расположениями, используйте шифрование [неактивных данных](../fundamentals/encryption-atrest.md) (в базе данных) и шифрование [передаваемых данных](../fundamentals/data-encryption-best-practices.md#protect-data-in-transit) (по своему пути к пользователю, базе данных, API или конечной точке службы). Для обмена данными рекомендуется всегда использовать протоколы SSL/TLS. Убедитесь, что вы используете последнюю версию протокола TLS для шифрования (в настоящее время это версия 1,2).

#### <a name="avoid-hard-coding"></a>Избегайте жесткого кодирования

Некоторые вещи никогда не должны быть жестко запрограммированы в программном обеспечении. Примерами могут быть имена узлов или IP-адреса, URL-адреса, адреса электронной почты, имена пользователей, пароли, ключи учетной записи хранения и другие криптографические ключи. Рассмотрите возможность реализации требований относительно того, что можно или не может быть жестко запрограммировано в коде, включая комментарии в разделах кода.

При помещении комментариев в код убедитесь, что не сохраняются конфиденциальные сведения. Сюда входят адрес электронной почты, пароли, строки подключения, сведения о приложении, которые могут быть известны только сотрудникам Организации, и все, что может дать злоумышленнику преимущество в атаках вашего приложения или организации.

По сути, предположим, что все в проекте разработки будет общедоступным набором знаний при развертывании. Не следует включать конфиденциальные данные любого типа в проект.

Ранее мы обсуждали [Azure Key Vault](../../key-vault/general/overview.md). Вы можете использовать Key Vault для хранения секретов, таких как ключи и пароли, а не жестко программировать их. При использовании Key Vault в сочетании с управляемыми удостоверениями для ресурсов Azure веб-приложение Azure может легко и безопасно обращаться к значениям конфигурации секрета без сохранения каких-либо секретов в системе управления версиями или конфигурации. Дополнительные сведения см. в статье [Управление секретами в серверных приложениях с помощью Azure Key Vault](/learn/modules/manage-secrets-with-azure-key-vault/).

### <a name="implement-fail-safe-measures"></a>Реализация резервных мер

Приложение должно уметь обрабатывать [ошибки](/dotnet/standard/exceptions/) , происходящие во время выполнения, согласованным образом. Приложение должно перехватить все ошибки, а также быть безуспешным или закрытым.

Также следует убедиться, что ошибки регистрируются с достаточным контекстом пользователя для обнаружения подозрительных или вредоносных действий. Журналы должны храниться в течение достаточного времени, чтобы разрешить отсроченный судебный анализ. Журналы должны иметь формат, который легко использовать в решении для управления журналами. Убедитесь, что активированы предупреждения об ошибках, связанных с безопасностью. Недостаточное протоколирование и мониторинг позволяют злоумышленникам получать более уязвимые системы и поддерживать сохраняемость.

### <a name="take-advantage-of-error-and-exception-handling"></a>Использование преимуществ обработки ошибок и исключений

Реализация правильной обработки ошибок и [исключений](/dotnet/standard/exceptions/best-practices-for-exceptions) является важной частью защитного программирования. Обработка ошибок и исключений очень важна для обеспечения надежности и безопасности системы. Ошибки обработки ошибок могут привести к различным типам уязвимостей системы безопасности, таким как утечка информации злоумышленникам и помощь злоумышленникам в понимании платформы и структуры.

Убедитесь в следующем:

- Вы обрабатываете исключения централизованным способом, чтобы избежать дублирования [блоков try/catch](/dotnet/standard/exceptions/how-to-use-the-try-catch-block-to-catch-exceptions) в коде.

- Все непредвиденные поведения обрабатываются внутри приложения.

- Сообщения, отображаемые пользователям, не вызывают критически важные данные, но предоставляют достаточно сведений для объяснения проблемы.

- Исключения записываются в журнал, и они предоставляют достаточно информации для исследования или для специалистов по реагированию на инциденты.

[Azure Logic Apps](../../logic-apps/logic-apps-overview.md) предоставляет интерфейс первого класса для [обработки ошибок и исключений](../../logic-apps/logic-apps-exception-handling.md) , вызванных зависимыми системами. Logic Apps можно использовать для создания рабочих процессов для автоматизации задач и процессов, которые интегрируют приложения, данные, системы и службы на предприятиях и в организациях.

### <a name="use-logging-and-alerting"></a>Использование ведения журналов и предупреждений

[Забудьте в курсе](/aspnet/core/fundamentals/logging/?view=aspnetcore-2.1) проблем безопасности, связанных с анализом безопасности, и активируйте оповещения о проблемах, чтобы убедиться, что люди своевременно узнают о проблемах. Включите аудит и ведение журнала во всех компонентах. Журналы аудита должны записывать контекст пользователя и находить все важные события.

Убедитесь, что не заносить в журнал конфиденциальные данные, отправляемые пользователем на ваш сайт. К конфиденциальным данным относятся:

- Учетные данные пользователя
- Номера социального страхования или другие идентифицирующие сведения
- номера кредитных карт и другие финансовые сведения;
- сведения о работоспособности;
- Закрытые ключи или другие данные, которые можно использовать для расшифровки зашифрованных данных
- сведения о системе или приложении, которые можно использовать для более эффективных атак на приложение.

Убедитесь, что приложение отслеживает события управления пользователями, такие как успешные и неудачные попытки входа пользователей, сброс паролей, изменение паролей, блокировка учетной записи и регистрация пользователей. Ведение журнала для этих событий помогает обнаруживать потенциально подозрительные поведения и реагировать на них. Он также позволяет собирать данные операций, например, кто обращается к приложению.

## <a name="next-steps"></a>Дальнейшие действия
В следующих статьях мы рекомендуем управлять безопасностью и действиями, которые могут помочь при разработке и развертывании безопасных приложений.

- [Разработка безопасных приложений](secure-develop.md)
- [Развертывание защищенных приложений](secure-deploy.md)