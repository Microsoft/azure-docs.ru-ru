---
title: Подключение к виртуальным сетям Azure с помощью среды службы интеграции
description: После создания среды службы интеграции она может подключаться к виртуальным сетям Azure из Azure Logic Apps.
services: logic-apps
ms.suite: integration
ms.reviewer: jonfan, logicappspm
ms.topic: conceptual
ms.date: 12/18/2020
ms.openlocfilehash: 315de18539bf083515658b40fa70f3c214d7c909
ms.sourcegitcommit: 772eb9c6684dd4864e0ba507945a83e48b8c16f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "97739745"
---
# <a name="connect-to-azure-virtual-networks-from-azure-logic-apps-by-using-an-integration-service-environment-ise"></a>Подключение к виртуальным сетям Azure из Azure Logic Apps с помощью среды службы интеграции (ISE)

Для сценариев, в которых приложениям логики и учетным записям интеграции требуется доступ к [виртуальной сети Azure](../virtual-network/virtual-networks-overview.md), создайте [*среду службы интеграции*](../logic-apps/connect-virtual-network-vnet-isolated-environment-overview.md). Среда службы интеграции является выделенной средой, в которой используются выделенное хранилище и другие ресурсы, существующие отдельно от "глобальной" мультитенантной службы Logic Apps. Такое разделение помогает уменьшить любое влияние других клиентов Azure на производительность вашего приложения. Среда службы интеграции также предоставляет собственные статические IP-адреса. Эти статические IP-адреса отделены от статических IP-адресов, совместно используемых приложениями логики в общедоступной мультитенантной службе.

После создания среды службы интеграции Azure *внедряет* эту среду в виртуальную сеть Azure и затем развертывает службу Logic Apps в вашей виртуальной сети. При создании приложений логики и учетных записей интеграции выберите свою среду службы интеграции в качестве их расположения. После этого приложение логики или учетная запись интеграции смогут напрямую получать доступ к ресурсам в виртуальной сети, таким как виртуальные машины, серверы, системы и службы.

![Выбор среды службы интеграции](./media/connect-virtual-network-vnet-isolated-environment/select-logic-app-integration-service-environment.png)

> [!IMPORTANT]
> Чтобы приложения логики и учетные записи интеграции работали вместе в среде службы интеграции, они должны использовать *ту же среду службы интеграции*, что и их расположение.

В среде службы интеграции выделен больший лимит на продолжительность выполнения, хранения, на пропускную способность, время ожидания HTTP-запросов и ответов, размер сообщений и запросов пользовательских соединителей. Дополнительные сведения см. в статье [Ограничения и сведения о конфигурации для Azure Logic Apps](../logic-apps/logic-apps-limits-and-config.md). Дополнительные сведения о среде службы интеграции см. в статье [Доступ к ресурсам виртуальной сети Azure из Azure Logic Apps](../logic-apps/connect-virtual-network-vnet-isolated-environment-overview.md).

В этой статье объясняется, как выполнять перечисленные ниже задачи с помощью портала Azure.

* Включение доступа к среде службы интеграции.
* Создание среды службы интеграции.
* Добавление дополнительных ресурсов в среду службы интеграции.

Вы также можете создать среду службы интеграции с помощью [образца шаблона быстрого запуска Azure Resource Manager](https://github.com/Azure/azure-quickstart-templates/tree/master/201-integration-service-environment) или с помощью REST API Logic Apps, в том числе выполнив настройку управляемых клиентом ключей:

* [Создание среды службы интеграции (ISE) с помощью REST API Logic Apps ](../logic-apps/create-integration-service-environment-rest-api.md)
* [Настройка управляемых клиентом ключей для шифрования неактивных данных для среды службы интеграции](../logic-apps/customer-managed-keys-integration-service-environment.md)

## <a name="prerequisites"></a>Предварительные требования

* Учетная запись и подписка Azure. Если у вас еще нет подписки Azure, [зарегистрируйтесь для получения бесплатной учетной записи Azure](https://azure.microsoft.com/free/).

  > [!IMPORTANT]
  > Приложения логики, встроенные триггеры и соединители, которые выполняются в среде службы интеграции, используют ценовой план, отличный от плана, рассчитанного на потребление. Сведения о ценах и выставлении счетов для сред ISE см. в статье [Модель ценообразования для Azure Logic Apps](../logic-apps/logic-apps-pricing.md#fixed-pricing). Сведения о тарифах см. на странице [цен на Logic Apps](../logic-apps/logic-apps-pricing.md).

* [Виртуальная сеть Azure](../virtual-network/virtual-networks-overview.md) с четырьмя *пустыми* подсетями, которые необходимы для создания и развертывания ресурсов в интегрированной среде сценариев и используются этими внутренними и скрытыми компонентами:

  * Logic Apps вычислений
  * Внутренние Среда службы приложений (соединители)
  * Внутреннее управление API (соединители)
  * Внутренние Redis для кэширования и производительности
  
  Вы можете создавать подсети заранее или при создании интегрированной среды сценариев, чтобы можно было одновременно создавать подсети. Однако перед созданием подсетей убедитесь, что вы просматриваете [требования к подсети](#create-subnet).

  * Убедитесь, что ваша виртуальная сеть [обеспечивает доступ к среде службы интеграции](#enable-access), чтобы ваша среда службы интеграции работала правильно и оставалась доступной.

  * Если вы используете или хотите использовать [ExpressRoute](../expressroute/expressroute-introduction.md) вместе с [принудительным туннелированием](../firewall/forced-tunneling.md), необходимо [создать таблицу маршрутов](../virtual-network/manage-route-table.md) со следующим конкретным маршрутом и связать таблицу маршрутов с каждой ПОДсетью, используемой интегрированной средой.

    **Имя**: <*имя_маршрута*><br>
    **Префикс адреса**: 0.0.0.0/0<br>
    **Определение следующего прыжка**. Интернет
    
    Эта таблица маршрутов необходима для того, чтобы Logic Apps компоненты могли взаимодействовать с другими зависимыми службами Azure, такими как служба хранилища Azure и база данных SQL Azure. Дополнительные сведения об этом маршруте см. в разделе [префикс адреса 0.0.0.0/0](../virtual-network/virtual-networks-udr-overview.md#default-route). Если вы не используете принудительное туннелирование с помощью ExpressRoute, эта таблица маршрутов не нужна.
    
    ExpressRoute позволяет расширять локальные сети в Microsoft Cloud и подключаться к облачным службам Майкрософт через частное подключение, которое обеспечивается поставщиком услуг подключения. В частности, ExpressRoute — это виртуальная частная сеть, которая направляет трафик через частную сеть, а не через общедоступный Интернет. Приложения логики могут подключаться к локальным ресурсам, которые находятся в той же виртуальной сети, когда они подключаются через ExpressRoute или виртуальную частную сеть.
   
  * Если вы используете [сетевой виртуальный модуль (NVA)](../virtual-network/virtual-networks-udr-overview.md#user-defined), убедитесь, что вы не включили завершение TLS/SSL или не измените исходящий трафик TLS/SSL. Кроме того, убедитесь, что вы не включили проверку для трафика, полученного из подсети ISE. Дополнительные сведения см. в разделе [Маршрутизация трафика виртуальной сети](../virtual-network/virtual-networks-udr-overview.md).

  * Если нужно использовать пользовательские DNS-серверы для виртуальной сети Azure, [настройте эти серверы, выполнив следующие действия](../virtual-network/virtual-networks-name-resolution-for-vms-and-role-instances.md) перед развертыванием среды службы интеграции в виртуальной сети. Дополнительные сведения об управлении параметрами DNS-сервера см. в разделе [Создание, изменение и удаление виртуальной сети](../virtual-network/manage-virtual-network.md#change-dns-servers).

    > [!NOTE]
    > При изменении параметров DNS-сервера или DNS-сервера необходимо перезапустить интегрированную среду сценариев, чтобы интегрированная среда сценариев могла получить эти изменения. Дополнительные сведения см. в разделе [Перезапуск среды службы интеграции](../logic-apps/ise-manage-integration-service-environment.md#restart-ISE).

<a name="enable-access"></a>

## <a name="enable-access-for-ise"></a>Включение доступа к среде службы интеграции

Когда вы используете среду службы интеграции в виртуальной сети Azure, часто возникает проблема с блокировкой одного или нескольких нужных портов. Соединители, используемые для создания подключений между средой службы интеграции и конечными системами, также могут иметь собственные требования к портам. Например, если для связи с FTP-системой используется соединитель FTP, убедитесь в доступности порта, который нужен этой FTP-системе (обычно это порт 21) для отправки команд.

Чтобы среда службы интеграции была доступна и приложения логики в среде службы интеграции могли обмениваться данными между каждой подсетью в виртуальной сети, [откройте порты, описанные в этой таблице, для каждой подсети](#network-ports-for-ise). Если необходимые порты недоступны, среда службы интеграции будет работать неправильно.

* Если у вас есть несколько экземпляров среды службы интеграции, которым требуется доступ к другим конечным точкам с ограничениями для IP-адресов, разверните [брандмауэр Azure](../firewall/overview.md) или [сетевой виртуальный модуль](../virtual-network/virtual-networks-overview.md#filter-network-traffic) в виртуальной сети и направьте исходящий трафик через этот брандмауэр или сетевой виртуальный модуль. Затем можно [настроить один исходящий общедоступный статический и прогнозируемый IP-адрес](connect-virtual-network-vnet-set-up-single-ip-address.md), чтобы все экземпляры среды службы интеграции в виртуальной сети могли использовать его для связи с конечными системами. Таким образом, вам не придется настраивать дополнительные пути брандмауэра в целевых системах для каждой ISE.

   > [!NOTE]
   > Этот подход можно использовать и в случае одной среды службы интеграции, если требуется ограничить количество IP-адресов, которым требуется доступ. Оцените оправданность дополнительных затрат на брандмауэр или сетевой виртуальный модуль для вашего сценария. Дополнительные сведения о [ценах на брандмауэр Azure](https://azure.microsoft.com/pricing/details/azure-firewall/).

* Если вы создали новую виртуальную сеть Azure и подсети без каких-либо ограничений, для управления трафиком между подсетями вам не нужно настраивать [группы безопасности сети](../virtual-network/network-security-groups-overview.md#network-security-groups) в виртуальной сети.

* Для существующей виртуальной сети можно *дополнительно* настроить [группы безопасности сети](../virtual-network/network-security-groups-overview.md#network-security-groups), чтобы [фильтровать сетевой трафик между подсетями](../virtual-network/tutorial-filter-network-traffic.md). Если вы хотите использовать этот маршрут или вы уже используете группы безопасности сети, убедитесь, что [порты, описанные в этой таблице,](#network-ports-for-ise) открыты для этих групп безопасности сети.

  При настройке [групповых правил безопасности](../virtual-network/network-security-groups-overview.md#security-rules) необходимо использовать *одновременно* протоколы **TCP** и **UDP**, либо вместо этого выбрать **любой из них**, чтобы не создавать отдельные правила для каждого протокола. Групповые правила безопасности описывают порты, которые необходимо открыть для IP-адресов, которым требуется доступ к этим портам. Убедитесь, что все брандмауэры, маршрутизаторы и другие элементы, существующие между этими конечными точками, также сохраняют эти порты доступными для этих IP-адресов.

* Если вы настроили принудительное туннелирование через брандмауэр для перенаправления трафика, связанного с Интернетом, ознакомьтесь с [дополнительными требованиями к принудительному туннелированию](#forced-tunneling).

<a name="network-ports-for-ise"></a>

### <a name="network-ports-used-by-your-ise"></a>Сетевые порты, используемые средой службы интеграции

В этой таблице описаны порты, которые должны быть доступны среде службы интеграции, и назначение для этих портов. Чтобы упростить настройку правил безопасности, в таблице используются [служебные теги](../virtual-network/service-tags-overview.md), представляющие группы префиксов IP-адресов для конкретной службы Azure. Если указано *Внутренняя среда службы интеграции* и *Внешняя среда службы интеграции* — это означает обозначение [конечной точки, которая выбирается во время создания среды службы интеграции](connect-virtual-network-vnet-isolated-environment.md#create-environment). Дополнительные сведения см. в разделе [Доступ к конечной точке](../logic-apps/connect-virtual-network-vnet-isolated-environment-overview.md#endpoint-access).

> [!IMPORTANT]
> Для всех правил убедитесь, что для исходных портов задано значение `*`, так как исходные порты являются временными.

#### <a name="inbound-security-rules"></a>Правила безопасности для входящего трафика

| Назначение | Тег или IP-адрес службы источника | Исходные порты | Тег или IP-адрес службы назначения | Конечные порты | Примечания |
|---------|------------------------------------|--------------|-----------------------------------------|-------------------|-------|
| Обмен данными между подсетями в виртуальной сети | Адресное пространство для виртуальной сети с подсетями среды службы интеграции | * | Адресное пространство для виртуальной сети с подсетями среды службы интеграции | * | Требуется для передачи трафика *между* подсетями в виртуальной сети. <p><p>**Важно!** Чтобы трафик передавался между *компонентами* в каждой подсети, все порты в каждой подсети должны быть открыты. |
| Оба. <p>Обмен данными с приложением логики <p><p>Журнал выполнения для приложения логики| Внутренняя среда службы интеграции: <br>**VirtualNetwork**; <p><p>Внешняя среда службы интеграции: **Интернет** или см. **Примечания** | * | **VirtualNetwork**; | 443 | Вместо использования служебного тега **Internet** можно указать исходный IP-адрес для этих элементов: <p><p>— компьютер или служба, которые вызывают любые триггеры запросов или веб-перехватчики в приложении логики; <p>— компьютер или служба, с которых требуется получить доступ к журналу выполнения приложения логики. <p><p>**Важно!** Закрытие или блокировка этого порта предотвращает вызов приложений логики, которые содержат триггеры запросов или веб-перехватчики. Вы также не сможете получить доступ к входным и выходным данным для каждого шага в журнале выполнения. Однако доступ к журналу выполнения приложений логики не запрещен.|
| Конструктор Logic Apps — динамические свойства | **LogicAppsManagement** | * | **VirtualNetwork**; | 454 | Запросы исходят из [входящих IP-адресов конечной точки доступа Logic Apps](../logic-apps/logic-apps-limits-and-config.md#inbound) для этого региона. |
| Развертывание соединителя | **AzureConnectors** | * | **VirtualNetwork**; | 454 | Требуется для развертывания и обновления соединителей. Закрытие или блокировка этого порта приводит к сбою развертываний среды службы интеграции и предотвращает обновления и исправления соединителя. |
| Проверка работоспособности сети | **LogicApps** | * | **VirtualNetwork**; | 454 | Запросы исходят из [входящих IP-адресов](../logic-apps/logic-apps-limits-and-config.md#inbound) и [исходящих IP-адресов](../logic-apps/logic-apps-limits-and-config.md#outbound) конечной точки доступа Logic Apps для этого региона. |
| Зависимость от управления службой приложений | **AppServiceManagement** | * | **VirtualNetwork**; | 454, 455 ||
| Обмен данными с диспетчером трафика Azure | **AzureTrafficManager** | * | **VirtualNetwork**; | Внутренняя среда службы интеграции: 454 <p><p>Внешняя среда службы интеграции: 443 ||
| Оба. <p>Развертывания политик соединителя <p>Управление API — конечная точка управления | **APIManagement** | * | **VirtualNetwork**; | 3443 | Для развертывания политик соединителя требуется доступ к портам для развертывания и обновления соединителей. Закрытие или блокировка этого порта приводит к сбою развертываний среды службы интеграции и предотвращает обновления и исправления соединителя. |
| Доступ к экземплярам кэша Azure для Redis между экземплярами ролей | **VirtualNetwork**; | * | **VirtualNetwork**; | 6379–6383, также см. **Примечания**| Чтобы интегрированная среда сценариев работала с кэшем Azure для Redis, необходимо открыть [входящие и исходящие порты, описанные в разделе часто задаваемых вопросов о кэше Azure для Redis](../azure-cache-for-redis/cache-how-to-premium-vnet.md#outbound-port-requirements). |
|||||||

#### <a name="outbound-security-rules"></a>Правила безопасности для исходящего трафика

| Назначение | Тег или IP-адрес службы источника | Исходные порты | Тег или IP-адрес службы назначения | Конечные порты | Примечания |
|---------|------------------------------------|--------------|-----------------------------------------|-------------------|-------|
| Обмен данными между подсетями в виртуальной сети | Адресное пространство для виртуальной сети с подсетями среды службы интеграции | * | Адресное пространство для виртуальной сети с подсетями среды службы интеграции | * | Требуется для передачи трафика *между* подсетями в виртуальной сети. <p><p>**Важно!** Чтобы трафик передавался между *компонентами* в каждой подсети, все порты в каждой подсети должны быть открыты. |
| Обмен данными из приложения логики | **VirtualNetwork**; | * | Зависит от места назначения | 80, 443 | Назначение зависит от конечных точек внешней службы, с которыми должно взаимодействовать приложение логики. |
| Azure Active Directory | **VirtualNetwork**; | * | **AzureActiveDirectory** | 80, 443 ||
| Зависимость от службы хранилища Azure | **VirtualNetwork**; | * | **Память** | 80, 443, 445 ||
| Управление соединениями | **VirtualNetwork**; | * | **AppService** | 443 ||
| Публикация журналов диагностики и метрик | **VirtualNetwork**; | * | **AzureMonitor** | 443 ||
| Зависимость SQL Azure | **VirtualNetwork**; | * | **SQL** | 1433 ||
| Служба работоспособности ресурса Azure | **VirtualNetwork**; | * | **AzureMonitor** | 1886 | Требуется для публикации состояния работоспособности в Работоспособности ресурсов Azure. |
| Зависимость от политики передачи журнала в концентратор событий и от агента мониторинга | **VirtualNetwork**; | * | **EventHub** | 5672 ||
| Доступ к экземплярам кэша Azure для Redis между экземплярами ролей | **VirtualNetwork**; | * | **VirtualNetwork**; | 6379–6383, также см. **Примечания**| Чтобы интегрированная среда сценариев работала с кэшем Azure для Redis, необходимо открыть [входящие и исходящие порты, описанные в разделе часто задаваемых вопросов о кэше Azure для Redis](../azure-cache-for-redis/cache-how-to-premium-vnet.md#outbound-port-requirements). |
| Разрешение DNS-имен | **VirtualNetwork**; | * | IP-адреса для любых пользовательских DNS-серверов в виртуальной сети | 53 | Требуется только при использовании пользовательских DNS-серверов в виртуальной сети. |
|||||||

Кроме того, необходимо добавить правила исходящего трафика для [Среда службы приложений (ASE)](../app-service/environment/intro.md):

* Если вы используете брандмауэр Azure, необходимо настроить брандмауэр с помощью тега Среда службы приложений (полное [доменное имя](../firewall/fqdn-tags.md#current-fqdn-tags)(ASE)), которое разрешает исходящий доступ к трафику платформы ASE.

* При использовании устройства брандмауэра, отличного от брандмауэра Azure, необходимо настроить брандмауэр, используя *все* правила, перечисленные в [зависимости интеграции брандмауэра](../app-service/environment/firewall-integration.md#dependencies) , необходимые для среда службы приложений.

<a name="forced-tunneling"></a>

#### <a name="forced-tunneling-requirements"></a>Требования принудительного туннелирования

Если вы настроили или используете [принудительное туннелирование](../firewall/forced-tunneling.md) через брандмауэр, необходимо предоставить дополнительные внешние зависимости для интегрированной среды сценариев. Принудительное туннелирование позволяет перенаправлять трафик, привязанный к Интернету, на назначенный следующий прыжок, например виртуальную частную сеть (VPN) или виртуальное устройство, а не через Интернет, чтобы можно было проверять и проверять исходящий сетевой трафик.

Если вы не разрешите доступ к этим зависимостям, развертывание ISE завершится сбоем, и развернутая интегрированная среда сценариев перестанет работать.

* Определяемые пользователем маршруты

  Чтобы предотвратить асимметричную маршрутизацию, необходимо определить маршрут для каждого IP-адреса, приведенного ниже, в качестве следующего прыжка к **Интернету** .
  
  * [Адреса управления среды службы приложений](../app-service/environment/management-addresses.md)
  * [IP-адреса Azure для соединителей в регионе ISE, доступных в этом загружаемом файле](https://www.microsoft.com/download/details.aspx?id=56519)
  * [Адреса управления диспетчером трафика Azure](https://azuretrafficmanagerdata.blob.core.windows.net/probes/azure/probe-ip-ranges.json)
  * [Logic Apps входящих и исходящих адресов для региона ISE](../logic-apps/logic-apps-limits-and-config.md#firewall-configuration-ip-addresses-and-service-tags)
  * [IP-адреса Azure для соединителей в регионе ISE, которые находятся в этом файле загрузки](https://www.microsoft.com/download/details.aspx?id=56519)

* Конечные точки служб

  Необходимо включить конечные точки службы для Azure SQL, хранилища, служебной шины, KeyVault и концентраторов событий, так как вы не можете отправить трафик через брандмауэр к этим службам.

*  Другие зависимости для входящей и исходящей связи

   В брандмауэре *должны быть* разрешены следующие входящие и исходящие зависимости:
   
   * [Зависимости службы приложений Azure](../app-service/environment/firewall-integration.md#deploying-your-ase-behind-a-firewall)
   * [Зависимости службы кэша Azure](../azure-cache-for-redis/cache-how-to-premium-vnet.md#what-are-some-common-misconfiguration-issues-with-azure-cache-for-redis-and-virtual-networks)
   * [Зависимости службы управления API Azure](../api-management/api-management-using-with-vnet.md#-common-network-configuration-issues)

<a name="create-environment"></a>

## <a name="create-your-ise"></a>Создание среды службы интеграции

1. На [портале Azure](https://portal.azure.com) в главном поле поиска Azure введите `integration service environments` в качестве фильтра и выберите **Среды службы интеграции**.

   ![Найдите и выберите раздел "Среды службы интеграции"](./media/connect-virtual-network-vnet-isolated-environment/find-integration-service-environment.png)

1. В области **Среды службы интеграции** выберите **Добавить**.

   ![Выберите "Добавить", чтобы создать среду службы интеграции](./media/connect-virtual-network-vnet-isolated-environment/add-integration-service-environment.png)

1. Укажите следующие сведения для своей среды, а затем выберите **Просмотр и создание**, как показано здесь:

   ![Предоставление сведений о среде](./media/connect-virtual-network-vnet-isolated-environment/integration-service-environment-details.png)

   | Свойство | Обязательно | Значение | Описание |
   |----------|----------|-------|-------------|
   | **Подписка** | Да | <*Azure-subscription-name*> | Подписка Azure, используемая для среды. |
   | **Группа ресурсов** | Да | <*имя_группы_ресурсов_Azure*> | Новая или существующая группа ресурсов Azure, в которой необходимо создать среду |
   | **Имя среды службы интеграции** | Да | <*имя_среды*> | Имя среды службы интеграции, которое может содержать только буквы, цифры, дефисы (`-`), символы подчеркивания (`_`) и точки (`.`). |
   | **Расположение** | Да | <*регион_центра_обработки_данных_Azure*> | Регион центра обработки данных Azure, в котором нужно развернуть среду. |
   | **SKU** | Да | **Премиум** или **Разработка (без соглашения об уровне обслуживания)** | Номер SKU среды службы интеграции для создания и использования. Различия между этими номерами SKU см. в разделе [SKU среды службы интеграции](../logic-apps/connect-virtual-network-vnet-isolated-environment-overview.md#ise-level). <p><p>**Важно!** Этот параметр доступен только при создании среды службы интеграции и не может быть изменен позже. |
   | **Дополнительная емкость** | Премиум <br>Да <p><p>Разработка <br>Неприменимо | Премиум <br>от 0 до 10 <p><p>Разработка <br>Неприменимо | Число дополнительных единиц обработки, используемых для этого ресурса среды службы интеграции. Дополнительные сведения о добавлении емкости после создания см. в разделе [Добавление емкости среды службы интеграции](../logic-apps/ise-manage-integration-service-environment.md#add-capacity). |
   | **Конечная точка доступа** | Да | **Внутренняя** или **внешняя** | Тип используемых конечных точек доступа в среде службы интеграции. Эти конечные точки определяют, могут ли триггеры запроса или веб-перехватчика в среде службы интеграции получать вызовы извне вашей виртуальной сети. <p><p>Например, если вы хотите использовать следующие триггеры на основе веб-перехватчика, убедитесь, что выбраны **Внешние**: <p><p>Azure DevOps <br>Сетка событий Azure <br>— Common Data Service <br>— Office 365 <br>-SAP (версия ISE) <p><p>Выбор также влияет на способ просмотра и доступа к входным и выходным данным в журнале выполнения приложения логики. Дополнительные сведения см. в разделе [Доступ к конечной точке среды службы интеграции](../logic-apps/connect-virtual-network-vnet-isolated-environment-overview.md#endpoint-access). <p><p>**Важно!** Вы можете выбрать конечную точку доступа только во время создания среды службы интеграции и не сможете изменить этот параметр позже. |
   | **Виртуальная сеть** | Да | <*имя_виртуальной_сети_Azure*> | Виртуальная сеть Azure, в которую нужно внедрить среду, чтобы приложения логики в этой среде могли получить доступ к виртуальной сети. Если у вас нет сети, [сначала создайте виртуальную сеть Azure](../virtual-network/quick-create-portal.md). <p><p>**Важно!** Внедрение среды службы интеграции можно выполнить *только* при ее создании. |
   | **Подсети** | Да | <*subnet-resource-list*> | Интегрированной среде сценариев требуется четыре *пустые* подсети, которые необходимы для создания и развертывания ресурсов в интегрированной среде сценариев и используются внутренними компонентами Logic Apps, такими как соединители и кэширование для повышения производительности. <p>**Важно**. [прежде чем продолжить выполнение этих действий для создания подсетей, убедитесь, что вы просматриваете требования к подсети](#create-subnet). |
   |||||

   <a name="create-subnet"></a>

   **Создание подсетей**

   Интегрированной среде сценариев требуется четыре *пустые* подсети, которые необходимы для создания и развертывания ресурсов в интегрированной среде сценариев и используются внутренними компонентами Logic Apps, такими как соединители и кэширование для повышения производительности. После создания среды вы *не можете изменить* эти адреса подсети. При создании и развертывании интегрированной среды сценариев с помощью портал Azure убедитесь, что вы не делегируйте эти подсети никаким службам Azure. Однако при создании и развертывании интегрированной среды сценариев с помощью REST API, Azure PowerShell или шаблона Azure Resource Manager необходимо [делегировать](../virtual-network/manage-subnet-delegation.md) одну пустую подсеть в `Microsoft.integrationServiceEnvironment` . Дополнительные сведения см. [в разделе Добавление делегирования подсети](../virtual-network/manage-subnet-delegation.md).

   Каждая подсеть должна отвечать требованиям, перечисленным ниже.

   * Использует имя, начинающееся с буквы или знака подчеркивания (без чисел), и не использует следующие символы: `<` ,,,,, `>` `%` `&` `\\` `?` , `/` .

   * Использует [Формат "Неклассовая маршрутизация Inter-Domain (CIDR)](https://en.wikipedia.org/wiki/Classless_Inter-Domain_Routing)".
   
     > [!IMPORTANT]
     >
     > Не используйте следующие пространства IP-адресов для виртуальной сети или подсетей, так как они не разрешается с помощью Azure Logic Apps:<p>
     > 
     > * 0.0.0.0/8
     > * 100.64.0.0/10
     > * 127.0.0.0/8
     > * 168.63.129.16/32
     > * 169.254.169.254/32

   * Использовать `/27` в адресном пространстве, так как для каждой подсети требуется 32 адреса. Например, `10.0.0.0/27` имеет 32 адреса, поскольку 2<sup>(32–27)</sup> — это 2<sup>5</sup> или 32. Дополнительные адреса не дают никаких дополнительных преимуществ. Подробнее о том, как рассчитать количество адресов, см. в разделе о блоках CIDR IPv4 [здесь](https://en.wikipedia.org/wiki/Classless_Inter-Domain_Routing#IPv4_CIDR_blocks).

   * При использовании [ExpressRoute](../expressroute/expressroute-introduction.md) необходимо [создать таблицу маршрутов](../virtual-network/manage-route-table.md) со следующим маршрутом и связать эту таблицу с каждой подсетью, используемой средой службы интеграции.

     **Имя**: <*имя_маршрута*><br>
     **Префикс адреса**: 0.0.0.0/0<br>
     **Определение следующего прыжка**. Интернет

   1. В списке **Подсети** выберите **Управление конфигурацией подсети**.

      ![Управление конфигурацией подсети](./media/connect-virtual-network-vnet-isolated-environment/manage-subnet-configuration.png)

   1. В области **Подсети** выберите **Подсеть**.

      ![Добавление четырех пустых подсетей](./media/connect-virtual-network-vnet-isolated-environment/add-empty-subnets.png)

   1. На панели **Добавить подсеть** введите следующие сведения.

      * **Name** (Имя). Имя для этой подсети.
      * **Диапазон адресов (блок CIDR)** . Диапазон адресов для подсети в виртуальной сети, выраженный в формате CIDR.

      ![Добавление сведений о подсети](./media/connect-virtual-network-vnet-isolated-environment/provide-subnet-details.png)

   1. Закончив, нажмите кнопку **OK**.

   1. Повторите эти шаги еще для трех подсетей.

      > [!NOTE]
      > Если подсети, которые вы пытаетесь создать, недействительны, портал Azure отображает сообщение, но не блокирует ход выполнения.

   Дополнительные сведения о создании подсетей см. в разделе [Добавление подсети виртуальной сети](../virtual-network/virtual-network-manage-subnet.md).

1. После того как Azure успешно проверит информацию о среде службы интеграции, щелкните **Создать**, как показано здесь:

   ![После успешной проверки щелкните "Создать"](./media/connect-virtual-network-vnet-isolated-environment/ise-validation-success.png)

   Azure начинает развертывание среды, что обычно занимает около двух часов. Изредка развертывание может занять до четырех часов. Чтобы проверить состояние развертывания, на панели инструментов Azure выберите значок уведомлений, который открывает область уведомлений.

   ![Проверка состояния развертывания](./media/connect-virtual-network-vnet-isolated-environment/environment-deployment-status.png)

   Если развертывание будет успешно завершено, в Azure отобразится следующее уведомление:

   ![Развертывание выполнено](./media/connect-virtual-network-vnet-isolated-environment/deployment-success-message.png)

   В противном случае следуйте инструкциям на портале Azure, чтобы устранить неполадки развертывания.

   > [!NOTE]
   > Если развертывание завершается неудачей или вы удаляете интегрированную среду сценариев, то перед освобождением подсетей Azure может занять до часа или даже дольше. Поэтому может потребоваться подождать, прежде чем можно будет повторно использовать эти подсети в другой интегрированной среде сценариев.
   >
   > При удалении виртуальной сети Azure, как правило, требуется до двух часов, прежде чем подсети будут свободны, но эта операция может занять и больше времени. 
   > При удалении виртуальных сетей убедитесь, что в них нет подключенных ресурсов. 
   > См. статью [Удаление виртуальной сети](../virtual-network/manage-virtual-network.md#delete-a-virtual-network).

1. Если Azure не перейдет автоматически к вашей среде после завершения развертывания, выберите **Перейти к ресурсу**, чтобы просмотреть среду.

1. Для интегрированной среды сценариев, имеющей доступ к *внешней* конечной точке, необходимо создать группу безопасности сети, если она еще не создана, и добавить правило безопасности для входящего трафика, разрешающее трафик из исходящих IP-адресов управляемого соединителя. Чтобы настроить это правило, выполните следующие действия.

   1. В меню интегрированной среды сценариев в разделе **Параметры** выберите пункт **свойства**.

   1. В разделе **Исходящие IP-адреса соединителя** скопируйте диапазоны общедоступных IP-адресов, которые также отображаются в этой статье, [ограничения и исходящие IP-адреса конфигурации](../logic-apps/logic-apps-limits-and-config.md#outbound).

   1. Создайте группу безопасности сети, если она еще не создана.
   
   1. На основе следующих сведений добавьте правило безопасности входящего трафика для скопированных общедоступных исходящих IP-адресов. Дополнительные сведения см. [в разделе Учебник. Фильтрация сетевого трафика с помощью группы безопасности сети в портал Azure](../virtual-network/tutorial-filter-network-traffic.md#create-a-network-security-group).

      | Назначение | Тег или IP-адрес службы источника | Исходные порты | Тег или IP-адрес службы назначения | Конечные порты | Примечания |
      |---------|------------------------------------|--------------|-----------------------------------------|-------------------|-------|
      | Разрешение трафика от исходящих IP-адресов соединителя | <*соединитель-Public-Outbound-IP-адреса*> | * | Адресное пространство для виртуальной сети с подсетями среды службы интеграции | * | |
      |||||||

1. Сведения о проверке работоспособности сети для среды службы интеграции см. в статье [Управление средой службы интеграции](../logic-apps/ise-manage-integration-service-environment.md#check-network-health).

   > [!CAUTION]
   > Если сеть ISE становится неработоспособной, внутренняя Среда службы приложений (ASE), используемая ИНТЕГРИРОВАНной средой, также может стать неработоспособной. Если ASE находится в неработоспособном состоянии более семи дней, ASE приостанавливается. Чтобы устранить это состояние, проверьте настройку виртуальной сети. Устраните все найденные проблемы и перезапустите интегрированную среду сценариев. В противном случае после 90 дней приостановленный ASE удаляется, и интегрированная среда сценариев становится непригодной для использования. Поэтому убедитесь, что интегрированная среда сценариев работоспособна, чтобы обеспечить необходимый трафик.
   > 
   > Дополнительные сведения см. в следующих статьях:
   >
   > * [Общие сведения о диагностике в службе приложений Azure](../app-service/overview-diagnostics.md)
   > * [Ведение журнала сообщений для Среда службы приложений Azure](../app-service/environment/using-an-ase.md#logging)

1. Сведения о том, как приступить к созданию приложений логики и других артефактов в среде службы интеграции, см. в статье [Добавление ресурсов в среды службы интеграции](../logic-apps/add-artifacts-integration-service-environment-ise.md).

   > [!IMPORTANT]
   > После создания интегрированной среды сценариев управляемые соединители ISE станут доступны для использования, но они не будут автоматически отображаться в средстве выбора соединителя в конструкторе приложений логики. Прежде чем использовать эти соединители ISE, необходимо вручную [Добавить и развернуть эти соединители в интегрированной среде сценариев](../logic-apps/add-artifacts-integration-service-environment-ise.md#add-ise-connectors-environment) , чтобы они отображались в конструкторе приложений логики.

## <a name="next-steps"></a>Дальнейшие действия

* [Добавление ресурсов в среды службы интеграции](../logic-apps/add-artifacts-integration-service-environment-ise.md)
* [Управление средами службы интеграции](../logic-apps/ise-manage-integration-service-environment.md#check-network-health)
* Узнайте больше о [виртуальной сети Azure](../virtual-network/virtual-networks-overview.md).
* Узнайте об [интеграции виртуальной сети для служб Azure](../virtual-network/virtual-network-for-azure-services.md).
