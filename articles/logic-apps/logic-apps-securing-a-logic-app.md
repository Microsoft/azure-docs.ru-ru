---
title: Безопасный доступ к данным
description: Безопасный доступ к входным и выходным данным, триггерам на основе запросов, журналу выполнения, задачам управления и другим ресурсам в Azure Logic Apps
services: logic-apps
ms.suite: integration
ms.reviewer: estfan, logicappspm, azla, rarayudu
ms.topic: conceptual
ms.date: 01/20/2021
ms.openlocfilehash: 337e242e3c194c8ec9f66e1888926e6a8f6a8375
ms.sourcegitcommit: 484f510bbb093e9cfca694b56622b5860ca317f7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/21/2021
ms.locfileid: "98633084"
---
# <a name="secure-access-and-data-in-azure-logic-apps"></a>Безопасный доступ и данные в Azure Logic Apps

Azure Logic Apps использует [хранилище Azure](../storage/index.yml) для хранения и автоматического [шифрования неактивных данных](../security/fundamentals/encryption-atrest.md). Это шифрование защищает ваши данные и помогает удовлетворить ваши обязательства по обеспечению безопасности и соответствия требованиям Организации. По умолчанию служба хранилища Azure использует ключи, управляемые корпорацией Майкрософт, для шифрования данных. Дополнительные сведения см. в статье [Шифрование службы хранилища Azure для неактивных данных](../storage/common/storage-service-encryption.md).

Для дальнейшего управления доступом и защитой конфиденциальных данных в Azure Logic Apps можно настроить дополнительную безопасность в следующих областях:

* [Доступ для входящих вызовов триггеров на основе запросов](#secure-inbound-requests)
* [Доступ к операциям приложения логики](#secure-operations)
* [Доступ к входным и выходным данным журнала выполнения](#secure-run-history)
* [Доступ к входным параметрам](#secure-action-parameters)
* [Доступ для исходящих вызовов к другим службам и системам](#secure-outbound-requests)
* [Блокировать создание подключений для конкретных соединителей](#block-connections)
* [Руководство по изоляции приложений логики](#isolation-logic-apps)
* [Базовый план безопасности Azure для Azure Logic Apps](../logic-apps/security-baseline.md)

Дополнительные сведения о безопасности в Azure см. в следующих разделах:

* [Общие сведения о шифровании в Azure](../security/fundamentals/encryption-overview.md)
* [Шифрование неактивных данных в Azure](../security/fundamentals/encryption-atrest.md)
* [Общие сведения о Тесте производительности системы безопасности Azure](../security/benchmarks/overview.md)

<a name="secure-inbound-requests"></a>

## <a name="access-for-inbound-calls-to-request-based-triggers"></a>Доступ для входящих вызовов триггеров на основе запросов

Входящие вызовы, которые приложение логики получает через триггер на основе запроса, например триггер [запроса](../connectors/connectors-native-reqres.md) или триггер [веб-перехватчика HTTP](../connectors/connectors-native-webhook.md) , поддерживают шифрование и ЗАЩИЩАЮТСЯ с помощью [протокола TLS 1,2](https://en.wikipedia.org/wiki/Transport_Layer_Security), как минимум, ранее известного как SSL (SSL). Logic Apps обеспечивает эту версию при получении входящего вызова триггера запроса или при обратном вызове триггера или действия веб-перехватчика HTTP. Если вы получаете ошибки подтверждения TLS, убедитесь в том, что используется протокол TLS 1.2. Дополнительные сведения см. в статье [Решение проблемы с TLS 1.0](/security/solving-tls1-problem).

Входящие вызовы поддерживают следующие комплекты шифров:

* TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384
* TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256
* TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384
* TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256
* TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA384
* TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA256
* TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384
* TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256

Ниже приведены дополнительные способы ограничения доступа к триггерам, которые получают входящие вызовы к приложению логики, чтобы только полномочные клиенты могли вызывать приложение логики:

* [Создание подписанных URL-адресов (SAS)](#sas)
* [включение открытой проверки подлинности Azure Active Directory (Azure AD OAuth)](#enable-oauth);
* [Предоставление приложения логики с помощью службы управления API Azure](#azure-api-management)
* [ограничение входящих IP-адресов](#restrict-inbound-ip-addresses);

<a name="sas"></a>

### <a name="generate-shared-access-signatures-sas"></a>Создание подписанных URL-адресов (SAS)

Каждая конечная точка запроса в приложении логики содержит [подписанный URL-адрес (SAS)](/rest/api/storageservices/constructing-a-service-sas) в своем URL-адресе, который имеет следующий формат.

`https://<request-endpoint-URI>sp=<permissions>sv=<SAS-version>sig=<signature>`

Каждый URL-адрес содержит параметры запроса `sp`, `sv` и `sig`, которые описаны в следующей таблице.

| Параметр запроса | Описание |
|-----------------|-------------|
| `sp` | Задает разрешенные для использования методы HTTP. |
| `sv` | Указывает версию SAS, используемую для создания подписи. |
| `sig` | Указывает подпись, используемую для проверки подлинности доступа к триггеру. Эта подпись создается с использованием алгоритма SHA256 с секретным ключом доступа для всех URL-путей и свойств. Этот секретный ключ хранится как часть приложения логики в зашифрованном виде,он никогда не раскрывается и не публикуется. Приложение логики авторизует только те триггеры, которые содержат действительную подпись, созданную с помощью секретного ключа. |
|||

Входящие вызовы к конечной точке запроса могут использовать только одну схему авторизации: SAS или [Azure Active Directory Open authentication](#enable-oauth). Хотя использование одной схемы не отключает другую схему, одновременное использование обеих схем приводит к ошибке, так как служба не знает, какую схему выбрать.

Дополнительные сведения о защите доступа с помощью SAS см. в следующих разделах этой статьи:

* [Повторное создание ключей доступа](#access-keys)
* [Создание URL-адресов обратного вызова с истекающим сроком действия](#expiring-urls)
* [Создание URL-адресов с использованием первичного или вторичного ключа](#primary-secondary-key)

<a name="access-keys"></a>

#### <a name="regenerate-access-keys"></a>Повторное создание ключей доступа

Можно в любое время создать новый защищенный ключ доступа с помощью REST API или портала Azure. Все URL-адреса, созданные ранее с помощью старого ключа, станут недействительны, и их нельзя будет использовать для запуска приложения логики. URL-адреса, полученные после повторного создания ключа, будут подписаны с помощью нового ключа доступа.

1. На [портале Azure](https://portal.azure.com) откройте приложение логики, для которого необходимо повторно создать ключ.

1. В меню приложения логики в разделе **Параметры** выберите **Ключи доступа**.

1. Выберите ключ, который необходимо создать повторно, и завершите процесс.

<a name="expiring-urls"></a>

#### <a name="create-expiring-callback-urls"></a>Создание URL-адресов обратного вызова с истекающим сроком действия

Если URL-адрес конечной точки триггера на основе запросов используется совместно с другими сторонами, можно создать URL-адреса обратного вызова, использующие определенные ключи и имеющие даты истечения срока действия. Таким образом можно легко менять ключи или ограничивать доступ для запуска приложения логики в определенные периоды времени. Для установки даты окончания срока действия для URL-адреса используйте [REST API для Logic Apps](/rest/api/logic/workflowtriggers), например, следующим образом:

```http
POST /subscriptions/<Azure-subscription-ID>/resourceGroups/<Azure-resource-group-name>/providers/Microsoft.Logic/workflows/<workflow-name>/triggers/<trigger-name>/listCallbackUrl?api-version=2016-06-01
```

Добавьте в текст свойство `NotAfter` с помощью строки даты JSON. Это свойство возвращает URL-адрес обратного вызова, действительный только до даты и времени, заданной для параметра `NotAfter`.

<a name="primary-secondary-key"></a>

#### <a name="create-urls-with-primary-or-secondary-secret-key"></a>Создание URL-адресов с использованием первичного или вторичного секретного ключа

При создании или перечислении URL-адресов обратного вызова для триггера на основе запросов можно указать ключ, который нужно использовать для подписи URL-адреса. Для создания URL-адреса, подписанного с использованием конкретного ключа, используйте [REST API для Logic Apps](/rest/api/logic/workflowtriggers), например, следующим образом:

```http
POST /subscriptions/<Azure-subscription-ID>/resourceGroups/<Azure-resource-group-name>/providers/Microsoft.Logic/workflows/<workflow-name>/triggers/<trigger-name>/listCallbackUrl?api-version=2016-06-01
```

Добавьте в текст свойство `KeyType` со значением `Primary` или `Secondary`. Это свойство возвращает URL-адрес, подписанный с помощью указанного ключа безопасности.

<a name="enable-oauth"></a>

### <a name="enable-azure-active-directory-open-authentication-azure-ad-oauth"></a>включение открытой проверки подлинности Azure Active Directory (Azure AD OAuth);

Для входящих вызовов к конечной точке, созданной триггером на основе запроса, можно включить [Azure Active Directory Open authentication (Azure AD OAuth)](../active-directory/develop/index.yml) , определив или добавив политику авторизации для приложения логики. Таким образом, входящие вызовы используют [маркеры доступа](../active-directory/develop/access-tokens.md) OAuth для авторизации.

Когда приложение логики получает входящий запрос, включающий маркер доступа OAuth, служба Azure Logic Apps сравнивает утверждения токена с утверждениями, указанными в каждой политике авторизации. Если существует совпадение между утверждениями маркера и всеми утверждениями по крайней мере одной политики, авторизация для входящего запроса будет выполнена. Маркер может иметь больше утверждений, чем указано в политике авторизации.

Прежде чем включить Azure AD OAuth, ознакомьтесь с приведенными ниже замечаниями.

* Входящий вызов конечной точки запроса может использовать только одну схему авторизации: Azure AD OAuth или [подписанный URL-адрес (SAS)](#sas). Хотя использование одной схемы не отключает другую схему, одновременное использование обеих схем приводит к ошибке, так как служба Logic Apps не знает, какую схему выбрать.

* Для маркеров доступа OAuth Azure AD поддерживаются только схемы авторизации [типа носителя](../active-directory/develop/active-directory-v2-protocols.md#tokens) . Это означает, что `Authorization` заголовок маркера доступа должен указывать `Bearer` тип.

* Приложение логики ограничено максимальным количеством политик авторизации. Каждая политика авторизации также имеет максимальное количество [утверждений](../active-directory/develop/developer-glossary.md#claim). Дополнительные сведения см. в статье [Ограничения и сведения о конфигурации для Azure Logic Apps](../logic-apps/logic-apps-limits-and-config.md#authentication-limits).

* Политика авторизации должна включать по крайней мере утверждение **издателя** , которое имеет значение, которое начинается с `https://sts.windows.net/` или `https://login.microsoftonline.com/` (OAuth v2) в качестве идентификатора издателя Azure AD.

  Например, предположим, что приложение логики имеет политику авторизации, для которой требуются два типа утверждений: **аудитория** и **Издатель**. Этот пример [раздела полезных данных](../active-directory/develop/access-tokens.md#payload-claims) для декодированного маркера доступа включает в себя оба типа утверждений, где `aud` — это значение **аудитории** , а `iss` — значение **издателя** :

  ```json
  {
      "aud": "https://management.core.windows.net/",
      "iss": "https://sts.windows.net/<Azure-AD-issuer-ID>/",
      "iat": 1582056988,
      "nbf": 1582056988,
      "exp": 1582060888,
      "_claim_names": {
         "groups": "src1"
      },
      "_claim_sources": {
         "src1": {
            "endpoint": "https://graph.windows.net/7200000-86f1-41af-91ab-2d7cd011db47/users/00000-f433-403e-b3aa-7d8406464625d7/getMemberObjects"
         }
      },
      "acr": "1",
      "aio": "AVQAq/8OAAAA7k1O1C2fRfeG604U9e6EzYcy52wb65Cx2OkaHIqDOkuyyr0IBa/YuaImaydaf/twVaeW/etbzzlKFNI4Q=",
      "amr": [
         "rsa",
         "mfa"
      ],
      "appid": "c44b4083-3bb0-00001-b47d-97400853cbdf3c",
      "appidacr": "2",
      "deviceid": "bfk817a1-3d981-4dddf82-8ade-2bddd2f5f8172ab",
      "family_name": "Sophia Owen",
      "given_name": "Sophia Owen (Fabrikam)",
      "ipaddr": "167.220.2.46",
      "name": "sophiaowen",
      "oid": "3d5053d9-f433-00000e-b3aa-7d84041625d7",
      "onprem_sid": "S-1-5-21-2497521184-1604012920-1887927527-21913475",
      "puid": "1003000000098FE48CE",
      "scp": "user_impersonation",
      "sub": "KGlhIodTx3XCVIWjJarRfJbsLX9JcdYYWDPkufGVij7_7k",
      "tid": "72f988bf-86f1-41af-91ab-2d7cd011db47",
      "unique_name": "SophiaOwen@fabrikam.com",
      "upn": "SophiaOwen@fabrikam.com",
      "uti": "TPJ7nNNMMZkOSx6_uVczUAA",
      "ver": "1.0"
   }
   ```

<a name="define-authorization-policy-portal"></a>

#### <a name="define-authorization-policy-in-azure-portal"></a>Определение политики авторизации в портал Azure

Чтобы включить Azure AD OAuth для приложения логики в портал Azure, выполните следующие действия, чтобы добавить одну или несколько политик авторизации в приложение логики.

1. На [портале Azure](https://portal.microsoft.com) найдите приложение логики и откройте его в конструкторе приложений логики.

1. В меню приложения логики в разделе **Параметры** выберите **Авторизация**. После открытия панели "Авторизация" выберите **Добавить политику**.

   ![Выберите "Авторизация" > "Добавить политику"](./media/logic-apps-securing-a-logic-app/add-azure-active-directory-authorization-policies.png)

1. Предоставьте сведения о политике авторизации, указав [типы утверждений](../active-directory/develop/developer-glossary.md#claim) и значения, которые приложение логики должно использовать в маркере доступа, представленном каждым входящим вызовом триггера запроса:

   ![Предоставление сведений для политики авторизации](./media/logic-apps-securing-a-logic-app/set-up-authorization-policy.png)

   | Свойство | Обязательно | Описание |
   |----------|----------|-------------|
   | **Имя политики** | Да | Имя, которое будет использоваться для политики авторизации |
   | **Утверждения** | Да | Типы утверждений и значения, принимаемые приложением логики из входящих вызовов. Значение утверждения ограничено [максимальным числом символов](logic-apps-limits-and-config.md#authentication-limits). Доступные типы утверждений: <p><p>- **Издатель** <br>- **Аудитория** <br>- **Тема** <br>- **Идентификатор JWT** (идентификатор JSON Web Token) <p><p>Список **утверждений** должен содержать как минимум утверждение **издателя** , которое имеет значение, начинающееся с `https://sts.windows.net/` или в `https://login.microsoftonline.com/` качестве идентификатора издателя Azure AD. Дополнительные сведения об этих типах утверждений см. в разделе [Утверждения в маркерах безопасности Azure AD](../active-directory/azuread-dev/v1-authentication-scenarios.md#claims-in-azure-ad-security-tokens). Можно также указать собственный тип и значение утверждения. |
   |||

1. Чтобы добавить еще одно утверждение, выберите один из следующих вариантов.

   * Чтобы добавить другой тип утверждения, нажмите **Добавить стандартное утверждение**, выберите тип утверждения и укажите его значение.

   * Чтобы добавить собственное утверждение, нажмите **Добавить настраиваемое утверждение** и укажите значение настраиваемого утверждения.

1. Чтобы добавить еще одну политику авторизации, нажмите **Добавить политику**. Повторите предыдущие шаги, чтобы настроить политику.

1. Когда все будет готово, нажмите кнопку **Сохранить**.

1. Чтобы включить `Authorization` заголовок из маркера доступа в выходные данные триггера на основе запроса, см. раздел [включение заголовка авторизации в выходные данные триггера запроса](#include-auth-header).

<a name="define-authorization-policy-template"></a>

#### <a name="define-authorization-policy-in-azure-resource-manager-template"></a>Определение политики авторизации в шаблоне Azure Resource Manager

Чтобы включить Azure AD OAuth в шаблоне ARM для развертывания приложения логики, выполните следующие действия и приведенный ниже синтаксис.

1. В `properties` разделе [определения ресурса приложения логики](../logic-apps/logic-apps-azure-resource-manager-templates-overview.md#logic-app-resource-definition)добавьте `accessControl` объект, если он не существует, который содержит `triggers` объект.

   Дополнительные сведения об `accessControl` объекте см. в разделе [ограничение диапазона входящих IP-адресов в шаблоне Azure Resource Manager](#restrict-inbound-ip-template) и [справочнике по шаблону рабочих процессов Microsoft. Logic](/azure/templates/microsoft.logic/2019-05-01/workflows).

1. В `triggers` объекте добавьте `openAuthenticationPolicies` объект, содержащий объект, в `policies` котором определена одна или несколько политик авторизации.

1. Укажите имя для политики авторизации, установите тип политики `AAD` и включите массив, в `claims` котором указывается один или несколько типов утверждений.

   Как минимум, `claims` массив должен включать тип утверждения издателя, в котором для свойства утверждения задается значение `name` `iss` , а в `value` `https://sts.windows.net/` `https://login.microsoftonline.com/` качестве идентификатора издателя Azure AD — значение. Дополнительные сведения об этих типах утверждений см. в разделе [Утверждения в маркерах безопасности Azure AD](../active-directory/azuread-dev/v1-authentication-scenarios.md#claims-in-azure-ad-security-tokens). Можно также указать собственный тип и значение утверждения.

1. Чтобы включить `Authorization` заголовок из маркера доступа в выходные данные триггера на основе запроса, см. раздел [включение заголовка авторизации в выходные данные триггера запроса](#include-auth-header).

Ниже приведен синтаксис:

```json
"resources": [
   {
      // Start logic app resource definition
      "properties": {
         "state": "<Enabled-or-Disabled>",
         "definition": {<workflow-definition>},
         "parameters": {<workflow-definition-parameter-values>},
         "accessControl": {
            "triggers": {
               "openAuthenticationPolicies": {
                  "policies": {
                     "<policy-name>": {
                        "type": "AAD",
                        "claims": [
                           {
                              "name": "<claim-name>",
                              "value": "<claim-value>"
                           }
                        ]
                     }
                  }
               }
            },
         },
      },
      "name": "[parameters('LogicAppName')]",
      "type": "Microsoft.Logic/workflows",
      "location": "[parameters('LogicAppLocation')]",
      "apiVersion": "2016-06-01",
      "dependsOn": [
      ]
   }
   // End logic app resource definition
],
```

<a name="include-auth-header"></a>

#### <a name="include-authorization-header-in-request-trigger-outputs"></a>Включить заголовок "Authorization" в выходные данные триггера запроса

Для приложений логики, которые [обеспечивают Azure Active Directory открытой аутентификации (Azure AD OAuth)](#enable-oauth) для авторизации входящих вызовов к триггерам на основе запросов, можно включить триггер запроса или выходные данные триггера веб-перехватчика HTTP, чтобы включить `Authorization` заголовок из маркера доступа OAuth. В базовом определении JSON триггера добавьте и присвойте `operationOptions` свойству значение `IncludeAuthorizationHeadersInOutputs` . Ниже приведен пример триггера запроса:

```json
"triggers": {
   "manual": {
      "inputs": {
         "schema": {}
      },
      "kind": "Http",
      "type": "Request",
      "operationOptions": "IncludeAuthorizationHeadersInOutputs"
   }
}
```

Дополнительные сведения см. в следующих статьях:

* [Справочник по схемам для триггеров и типов действий — триггер запроса](../logic-apps/logic-apps-workflow-actions-triggers.md#request-trigger)
* [Справочник по схемам для типов триггеров и действий — триггер веб-перехватчика HTTP](../logic-apps/logic-apps-workflow-actions-triggers.md#http-webhook-trigger)
* [Справочник по схемам для типов триггеров и действий — параметры операций](../logic-apps/logic-apps-workflow-actions-triggers.md#operation-options)

<a name="azure-api-management"></a>

### <a name="expose-your-logic-app-with-azure-api-management"></a>Предоставление приложения логики с помощью службы управления API Azure

Чтобы добавить дополнительные [протоколы проверки подлинности](../active-directory/develop/authentication-vs-authorization.md) в приложение логики, рассмотрите возможность использования службы [управления API Azure](../api-management/api-management-key-concepts.md) . Эта служба позволяет предоставлять приложение логики в качестве API и обеспечивает обширные возможности мониторинга, дополнительные средства безопасности, политики и документацию для любой конечной точки. Управление API может предоставлять общедоступную или частную конечную точку для приложения логики. Чтобы авторизовать доступ к этой конечной точке, можно использовать Azure AD OAuth, [сертификат клиента](#client-certificate-authentication)или другие стандарты безопасности для авторизации доступа к этой конечной точке. Когда служба "Управление API" получает запрос, она отправляет его в приложение логики, выполняя при этом необходимые преобразования или устанавливая ограничения. Чтобы позволить только управление API вызывать приложение логики, можно [ограничить входящие IP-адреса приложения логики](#restrict-inbound-ip).

<a name="restrict-inbound-ip"></a>

### <a name="restrict-inbound-ip-addresses"></a>Ограничение входящих IP-адресов

Наряду с подписанным URL-адресом (SAS) может потребоваться ограничить число клиентов, которые могут вызывать приложение логики. Например, если вы управляете конечной точкой запроса с помощью службы [управления API Azure](../api-management/api-management-key-concepts.md), вы можете ограничить приложение логики принимать запросы только от IP-адреса [создаваемого экземпляра службы управления API](../api-management/get-started-create-service-instance.md).

Независимо от указанных IP-адресов, можно по-прежнему запускать приложение логики с триггером на основе запросов с помощью [Logic Apps REST API: триггеры рабочего процесса — запрос на выполнение](/rest/api/logic/workflowtriggers/run) или с помощью управления API. Однако для этого потребуется [аутентификация](../active-directory/develop/authentication-vs-authorization.md) с помощью Azure REST API. Все события отобразятся в журнале аудита Azure. Убедитесь, что политики управления доступом настроены соответствующим образом.

<a name="restrict-inbound-ip-portal"></a>

#### <a name="restrict-inbound-ip-ranges-in-azure-portal"></a>Ограничение диапазонов входящих IP-адресов на портале Azure

При использовании портала для ограничения входящих IP-адресов для приложения логики эти ограничения влияют на триггеры *и* действия, несмотря на описание на портале в разделе **Разрешенные входящие IP-адреса**. Чтобы настроить ограничения для триггеров отдельно от действий, используйте [ `accessControl` объект в шаблоне Azure Resource Manager приложения логики](#restrict-inbound-ip-template) или в [операции Logic Apps REST API: рабочий процесс-создать или обновить](/rest/api/logic/workflows/createorupdate).

1. Откройте приложение логики в конструкторе приложений логики на [портале Azure](https://portal.azure.com).

1. В меню приложения логики в разделе **Параметры** выберите **Параметры рабочего процесса**.

1. В разделе **Конфигурация контроля доступа** в разделе **Разрешенные входящие IP-адреса** выберите путь для сценария:

   * Чтобы приложение логики было вызываемым только как вложенное приложение логики с помощью встроенного [действия Azure Logic Apps](../logic-apps/logic-apps-http-endpoint.md), выберите **только другие Logic Apps**, которые работают *только* при использовании действия **Azure Logic Apps** для вызова вложенного приложения логики.
   
     Этот параметр записывает пустой массив в ресурс приложения логики и требует, чтобы только вызовы из родительских приложений логики, которые используют встроенное действие **Azure Logic Apps** , могли запускать вложенное приложение логики.

   * Чтобы приложение логики было вызываемым только как вложенное приложение с помощью действия HTTP, выберите **определенные диапазоны IP-адресов**, а *не* **только другие Logic Apps**. Когда появится поле **диапазоны IP-адресов для триггеров** , введите [Исходящие IP-адреса](../logic-apps/logic-apps-limits-and-config.md#outbound)приложения логики. Допустимый диапазон IP-адресов использует следующие форматы: *x. x. x. x/x* или *x. x*. x. x-x. x. x. x.
   
     > [!NOTE]
     > Если вы используете **только другой параметр Logic Apps** и действие HTTP для вызова вложенного приложения логики, вызов блокируется и возникает ошибка "401" не санкционировано ".
        
   * Для сценариев, в которых необходимо ограничить входящие вызовы от других IP-адресов, когда появится поле **диапазоны IP для триггеров** , укажите диапазоны IP-адреса, принимаемые триггером. Допустимый диапазон IP-адресов использует следующие форматы: *x. x. x. x/x* или *x. x*. x. x-x. x. x. x.

1. При необходимости в разделе **ограничение вызовов для получения входных и выходных сообщений из журнала выполнения на указанные IP-адреса** можно указать диапазоны IP-адресов для входящих вызовов, которые могут получать доступ к входным и выходным сообщениям в журнале выполнения.

<a name="restrict-inbound-ip-template"></a>

#### <a name="restrict-inbound-ip-ranges-in-azure-resource-manager-template"></a>Ограничение диапазонов входящих IP-адресов в шаблоне Azure Resource Manager

При [автоматизации развертывания для приложений логики с помощью шаблонов диспетчер ресурсов](../logic-apps/logic-apps-azure-resource-manager-templates-overview.md)можно указать разрешенные диапазоны входящих IP-адресов в определении ресурса приложения логики с помощью `accessControl` раздела. В этом разделе используйте `triggers` , `actions` и необязательные разделы в `contents` соответствии с указанием `allowedCallerIpAddresses` раздела со `addressRange` свойством и задайте для свойства значение разрешенный диапазон IP-адресов в формате *x. x.* x. x/x или *x.* x. x. x-x. x. x. x.

* Если во вложенном приложении логики используется **единственный параметр Logic Apps** , который разрешает входящие вызовы только из других приложений логики, использующих действие Azure Logic Apps, установите `addressRange` для свойства пустой массив (**[]**).

* Если во вложенном приложении логики используется параметр **определенные диапазоны IP-адресов** для других входящих вызовов, например для других приложений логики, использующих действие HTTP, задайте `addressRange` для свойства значение разрешенный диапазон IP-адресов.

В этом примере показано определение ресурса для вложенного приложения логики, которое разрешает входящие вызовы только из приложений логики, использующих встроенное действие Azure Logic Apps:

```json
{
   "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
   "contentVersion": "1.0.0.0",
   "parameters": {},
   "variables": {},
   "resources": [
      {
         "name": "[parameters('LogicAppName')]",
         "type": "Microsoft.Logic/workflows",
         "location": "[parameters('LogicAppLocation')]",
         "tags": {
            "displayName": "LogicApp"
         },
         "apiVersion": "2016-06-01",
         "properties": {
            "definition": {
               <workflow-definition>
            },
            "parameters": {
            },
            "accessControl": {
               "triggers": {
                  "allowedCallerIpAddresses": [
                     {
                        "addressRange": []
                     }
                  ]
               },
               "actions": {
                  "allowedCallerIpAddresses": [
                     {
                        "addressRange": []
                     }
                  ]
               }
            },
            "endpointsConfiguration": {}
         }
      }
   ],
   "outputs": {}
}
```

В этом примере показано определение ресурса для вложенного приложения логики, которое разрешает входящие вызовы из приложений логики, использующих действие HTTP:

```json
{
   "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
   "contentVersion": "1.0.0.0",
   "parameters": {},
   "variables": {},
   "resources": [
      {
         "name": "[parameters('LogicAppName')]",
         "type": "Microsoft.Logic/workflows",
         "location": "[parameters('LogicAppLocation')]",
         "tags": {
            "displayName": "LogicApp"
         },
         "apiVersion": "2016-06-01",
         "properties": {
            "definition": {
               <workflow-definition>
            },
            "parameters": {
            },
            "accessControl": {
               "triggers": {
                  "allowedCallerIpAddresses": [
                     {
                        "addressRange": "192.168.12.0/23"
                     }
                  ]
               },
               "actions": {
                  "allowedCallerIpAddresses": [
                     {
                        "addressRange": "192.168.12.0/23"
                     }
                  ]
               }
            },
            "endpointsConfiguration": {}
         }
      }
   ],
   "outputs": {}
}
```

<a name="secure-operations"></a>

## <a name="access-to-logic-app-operations"></a>Доступ к операциям приложения логики

Вы можете разрешить только определенным пользователям или группам запускать определенные задачи, такие как управление, редактирование и просмотр приложений логики. Для управления их разрешениями используйте [Управление доступом на основе ролей Azure (Azure RBAC)](../role-based-access-control/role-assignments-portal.md) , чтобы можно было назначить настраиваемые или встроенные роли членам в вашей подписке Azure:

* [Создатель приложений логики](../role-based-access-control/built-in-roles.md#logic-app-contributor). Позволяет управлять приложениями логики, но не доступом к ним.

* [Оператор приложений логики](../role-based-access-control/built-in-roles.md#logic-app-operator). Позволяет читать, включать и отключать приложения логики, но не изменять или обновлять их.

Чтобы запретить другим пользователям изменять или удалять приложение логики, можно использовать [блокировку ресурсов Azure](../azure-resource-manager/management/lock-resources.md). Эта позволяет предотвратить изменение или удаление рабочих ресурсов.

<a name="secure-run-history"></a>

## <a name="access-to-run-history-data"></a>Доступ к данным журнала выполнения

Во время выполнения приложения логики все данные [шифруются во время передачи](../security/fundamentals/encryption-overview.md#encryption-of-data-in-transit) с помощью протокола TLS и [в неактивном состоянии](../security/fundamentals/encryption-atrest.md). После завершения работы приложения логики можно просмотреть журнал этого запуска, включая шаги, которые были выполнены, а также состояние, длительность, входные и выходные данные для каждого действия. Эти подробные сведения позволяют понять, как выполнялось приложение логики и где может потребоваться устранение каких-либо возникающих проблем.

При просмотре журнала выполнения приложения логики Logic Apps выполняет проверку подлинности доступа, а затем предоставляет ссылки на входные и выходные данные для запросов и ответов для каждого запуска. Однако для действий, которые обрабатывали пароли, секреты, ключи или другие конфиденциальные сведения, необходимо запретить другим пользователям просматривать эти данные и получать к ним доступ. Например, если приложение логики получает секрет от [Azure Key Vault](../key-vault/general/overview.md) для использования при проверке подлинности действия HTTP, необходимо скрыть этот секрет из представления.

Для управления доступом к входным и выходным данным в журнале выполнения приложения логики доступны следующие варианты.

* [Ограничение доступа по диапазону IP-адресов](#restrict-ip).

  Этот вариант позволяет защитить доступ к журналу выполнения на основе запросов из определенного диапазона IP-адресов.

* [Защита данных в журнале выполнения с помощью обфускации](#obfuscate).

  Во многих триггерах и действиях можно защитить входные или выходные данные, либо и то и другое, в журнале выполнения приложения логики.

<a name="restrict-ip"></a>

### <a name="restrict-access-by-ip-address-range"></a>Ограничение доступа по диапазону IP-адресов

Можно ограничить доступ к входным и выходным данным в журнале выполнения приложения логики, чтобы просматривать эти данные могли только запросы из конкретных диапазонов IP-адресов. Например, чтобы запретить всем пользователям доступ к входным и выходным данным, укажите диапазон IP-адресов `0.0.0.0-0.0.0.0`. Только пользователь с правами администратора может снять это ограничение, что предоставляет возможность JIT-доступа к содержимому приложения логики. Можно указать ограничения диапазонов IP-адресов либо с помощью портала Azure, либо в шаблоне Azure Resource Manager, который используется для развертывания приложения логики.

#### <a name="restrict-ip-ranges-in-azure-portal"></a>Ограничение диапазонов IP-адресов на портале Azure

1. Откройте приложение логики в конструкторе приложений логики на портале Azure.

1. В меню приложения логики в разделе **Параметры** выберите **Параметры рабочего процесса**.

1. В разделе **Конфигурация контроля доступа** > **Разрешенные IP-адреса для входящего трафика** щелкните **Конкретные диапазоны IP-адресов**.

1. В разделе **Диапазоны IP-адресов для содержимого** укажите диапазоны, которые могут получать доступ к содержимому входных и выходных данных.

   Допустимый диапазон IP-адресов имеет формат *x.x.x.x/x* или *x.x.x.x-x.x.x.x*.

#### <a name="restrict-ip-ranges-in-azure-resource-manager-template"></a>Ограничение диапазонов IP-адресов в шаблоне Azure Resource Manager

Если вы [автоматизируете развертывание приложений логики с помощью шаблонов Resource Manager](../logic-apps/logic-apps-azure-resource-manager-templates-overview.md), можно указать диапазоны IP-адресов, включив в раздел `accessControl` раздел `contents` в определении ресурса приложения логики, например:

``` json
{
   "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
   "contentVersion": "1.0.0.0",
   "parameters": {},
   "variables": {},
   "resources": [
      {
         "name": "[parameters('LogicAppName')]",
         "type": "Microsoft.Logic/workflows",
         "location": "[parameters('LogicAppLocation')]",
         "tags": {
            "displayName": "LogicApp"
         },
         "apiVersion": "2016-06-01",
         "properties": {
            "definition": {<workflow-definition>},
            "parameters": {},
            "accessControl": {
               "contents": {
                  "allowedCallerIpAddresses": [
                     {
                        "addressRange": "192.168.12.0/23"
                     },
                     {
                        "addressRange": "2001:0db8::/64"
                     }
                  ]
               }
            }
         }
      }
   ],
   "outputs": {}
}
```

<a name="obfuscate"></a>

### <a name="secure-data-in-run-history-by-using-obfuscation"></a>Защита данных в журнале выполнения с помощью обфускации

Во многих триггерах и действиях есть параметры для защиты входных или выходных данных, либо и того и другого, в журнале выполнения приложения логики. Прежде чем использовать эти параметры для защиты данных, [ознакомьтесь со следующими рекомендациями](#obfuscation-considerations).

#### <a name="secure-inputs-and-outputs-in-the-designer"></a>Защита входных и выходных данных в конструкторе

1. Откройте приложение логики в конструкторе приложений логики на [портале Azure](https://portal.azure.com).

   ![Откройте приложение логики в конструкторе приложений логики](./media/logic-apps-securing-a-logic-app/open-sample-logic-app-in-designer.png)

1. На триггере или действии, для которого требуется защитить конфиденциальные данные, нажмите кнопку с многоточием ( **…** ), а затем выберите **Параметры**.

   ![Откройте параметры триггера или действия](./media/logic-apps-securing-a-logic-app/open-action-trigger-settings.png)

1. Включите **Безопасные входные данные**, **Безопасные выходные данные**, либо оба параметра. По завершении нажмите кнопку **Готово**.

   ![Включение "безопасных входных данных" или "безопасных выходных данных"](./media/logic-apps-securing-a-logic-app/turn-on-secure-inputs-outputs.png)

   Действие или триггер теперь отображается со значком замка в заголовке окна.

   ![В строке заголовка действия или триггера отображается значок замка](./media/logic-apps-securing-a-logic-app/lock-icon-action-trigger-title-bar.png)

   Маркеры, которые представляют защищенные выходные данные из предыдущих действий, также отображаются со значками замка. Например, при выборе такого вывода из списка динамического содержимого для использования в действии этот маркер отображается со значком замка.

   ![Выбор маркера для защищенного вывода](./media/logic-apps-securing-a-logic-app/select-secured-token.png)

1. После запуска приложения логики можно просмотреть журнал этого запуска.

   1. На панели **Обзор** приложения логики выберите запуск, который необходимо просмотреть.

   1. На панели **Запуск приложения логики** разверните список действий, которые необходимо проверить.

      Если вы решили скрыть входные и выходные данные, эти значения теперь будут скрыты.

      ![Скрытые входные и выходные данные в журнале выполнения](./media/logic-apps-securing-a-logic-app/hidden-data-run-history.png)

<a name="secure-data-code-view"></a>

#### <a name="secure-inputs-and-outputs-in-code-view"></a>Защита входных и выходных данных в представлении кода

В базовом определении триггера или действия измените массив `runtimeConfiguration.secureData.properties`, добавив одно из следующих значений, или сразу оба значения:

* `"inputs"`: обеспечивает защиту входных данных в журнале выполнения.
* `"outputs"`: обеспечивает защиту выходных данных в журнале выполнения.

Ниже приведены некоторые [рекомендации по проверке](#obfuscation-considerations) при использовании этих параметров для защиты этих данных.

```json
"<trigger-or-action-name>": {
   "type": "<trigger-or-action-type>",
   "inputs": {
      <trigger-or-action-inputs>
   },
   "runtimeConfiguration": {
      "secureData": {
         "properties": [
            "inputs",
            "outputs"
         ]
      }
   },
   <other-attributes>
}
```

<a name="obfuscation-considerations"></a>

#### <a name="considerations-when-securing-inputs-and-outputs"></a>Рекомендации по защите входных и выходных данных

* При скрытии входных или выходных данных триггера или действия Logic Apps не отправляет защищенные данные в Azure Log Analytics. Кроме того, к такому триггеру или действию нельзя добавить [отслеживаемые свойства](../logic-apps/monitor-logic-apps-log-analytics.md#extend-data) для мониторинга.

* [API Logic Apps для обработки журнала рабочего процесса](/rest/api/logic/) не возвращает защищенные выходные данные.

* Чтобы защитить выходные данные из действия, которое скрывает входные данные или явно их маскирует, вручную включите в этом действии **Безопасные выходные данные**.

* Убедитесь, что вы включили параметр **Безопасные входные данные** или **Безопасные выходные данные** в подчиненных действиях, в которых необходимо скрывать эти данные в журнале выполнения.

  **Параметры безопасных выходных данных**

  При ручном включении **Безопасных выходных данных** в триггере или действии Logic Apps будет скрывать эти выходные данные в журнале выполнения. Если подчиненное действие явно использует эти защищенные выходные данные в качестве входных данных, Logic Apps скрывает входные данные этого действия в журнале выполнения, но *не включает* для действия параметр **Безопасные входные данные**.

  ![Защищенные выходные данные в качестве входных данных и последующее влияние на большинство действий](./media/logic-apps-securing-a-logic-app/secure-outputs-as-inputs-flow.png)

  У действий "создать", "анализ JSON" и "ответ" есть только параметр **Безопасные входные данные**. Когда он включен, то выходные данные также скрываются. Если эти действия явно используют вышестоящие защищенные выходные данные в качестве входных данных, Logic Apps скрывает входные и выходные данные этих действий, но *не включает* для этих действий параметр **Безопасные входные данные**. Если подчиненное действие явно использует скрытые выходные данные из действий "создать", "анализ JSON" или "ответ" в качестве входных данных, Logic Apps *не скрывает входные или выходные данные этого подчиненного действия*.

  ![Защищенные выходные данные в качестве входных данных и последующее влияние на некоторые действия](./media/logic-apps-securing-a-logic-app/secure-outputs-as-inputs-flow-special.png)

  **Параметры безопасных входных данных**

  При ручном включении **Безопасных входных данных** в триггере или действии Logic Apps будет скрывать эти входные данные в журнале выполнения. Если нисходящее действие явно использует видимые выходные данные из этого триггера или действия в качестве входных данных, Logic Apps скрывает входные данные этого подчиненного действия в журнале выполнения, но *не включает* для этого действия параметр **Безопасные входные данные** и не скрывает его выходные данные.

  ![Защищенные входные данные и последующее влияние на большинство действий](./media/logic-apps-securing-a-logic-app/secure-inputs-impact-on-downstream.png)

  Если действия "создать", "анализ JSON" и "ответ" явно используют видимые выходные данные триггера или действия, которые имеют защищенные входные данные, Logic Apps скрывает входные и выходные данные этих действий, но *не включает* для них параметр **Безопасные входные данные**. Если подчиненное действие явно использует скрытые выходные данные из действий "создать", "анализ JSON" или "ответ" в качестве входных данных, Logic Apps *не скрывает входные или выходные данные этого подчиненного действия*.

  ![Защищенные входные данные и последующее влияние на некоторые действия](./media/logic-apps-securing-a-logic-app/secure-inputs-flow-special.png)

<a name="secure-action-parameters"></a>

## <a name="access-to-parameter-inputs"></a>Доступ к входным параметрам

При развертывании в разных средах рассмотрите возможность параметризации значений в определении рабочего процесса в зависимости от среды. Так вы сможете избежать жестко запрограммированных данных, используя [шаблон Azure Resource Manager](../azure-resource-manager/templates/overview.md) для развертывания приложения логики, сможете защитить конфиденциальные данные путем определения защищенных параметров и передачи этих данных в виде отдельных входов через [параметры шаблона](../azure-resource-manager/templates/template-parameters.md) с помощью [файла параметров](../azure-resource-manager/templates/parameter-files.md).

Например, при проверке подлинности действий HTTP с помощью [открытой проверки подлинности Azure Active Directory](#azure-active-directory-oauth-authentication) (Azure AD OAuth) можно определить и скрыть параметры, которые принимают идентификатор и секрет клиента, используемые для аутентификации. Чтобы определить эти параметры в приложении логики, используйте раздел `parameters` в определении рабочего процесса приложения логики и шаблоне Resource Manager для развертывания. Чтобы дополнительно защитить значения параметров и не отображать их при изменении приложения логики или просмотре журнала выполнения, определите параметры с помощью типов `securestring` или `secureobject` и с использованием кодирования при необходимости. Параметры этого типа не возвращаются с помощью определения ресурса и недоступны при просмотре ресурса после развертывания. Чтобы получить доступ к этим значениям параметров во время выполнения, используйте выражение `@parameters('<parameter-name>')` в определении рабочего процесса. Это выражение вычисляется только во время выполнения и описывается на [языке определения рабочего процесса](../logic-apps/logic-apps-workflow-definition-language.md).

> [!NOTE]
> Если параметр используется в заголовках или тексте запроса, он может отображаться при просмотре журнала выполнения приложения логики или исходящего HTTP-запроса. Поэтому настройте политики доступа к содержимому соответствующим образом.
> Можно также использовать [обфускацию](#obfuscate), чтобы скрыть входные и выходные данные в журнале выполнения. Заголовки авторизации никогда не отображаются во входных и выходных данных. Таким образом, если используется секрет, то он не извлекается.

Дополнительные сведения см. в следующих разделах этой статьи.

* [Защищенные параметры в определениях рабочих процессов](#secure-parameters-workflow)
* [Защита данных в журнале выполнения с помощью обфускации](#obfuscate)

Если вы [автоматизируете развертывание приложений логики с помощью шаблонов Resource Manager](../logic-apps/logic-apps-azure-resource-manager-templates-overview.md), можно определить защищенные [параметры шаблона](../azure-resource-manager/templates/template-parameters.md), которые вычисляются при развертывании с помощью типов `securestring` и `secureobject`. Чтобы определить параметры шаблона, используйте раздел `parameters` верхнего уровня шаблона, который является отдельным и отличным от раздела `parameters` определения рабочего процесса. Чтобы указать значения для параметров шаблона, используйте отдельный [файл параметров](../azure-resource-manager/templates/parameter-files.md).

Например, при использовании секретов можно определить и использовать защищенные параметры шаблона, которые извлекают эти секреты из [Azure Key Vault](../key-vault/general/overview.md) при развертывании. Затем можно сослаться на хранилище ключей и секрет в файле параметров. Дополнительные сведения см. в следующих статьях:

* [Передача конфиденциальных значений при развертывании с помощью Azure Key Vault](../azure-resource-manager/templates/key-vault-parameter.md)
* Раздел [Защищенные параметры в шаблонах Azure Resource Manager](#secure-parameters-deployment-template) далее в этой статье

<a name="secure-parameters-workflow"></a>

### <a name="secure-parameters-in-workflow-definitions"></a>Защищенные параметры в определениях рабочих процессов

Для защиты конфиденциальной информации в определении рабочего процесса приложения логики используйте защищенные параметры, чтобы информация не отображалась после сохранения приложения логики. Предположим, например, что для действия HTTP требуется обычная проверка подлинности, в которой используются имя пользователя и пароль. В определении рабочего процесса в разделе `parameters` определяются параметры `basicAuthPasswordParam` и `basicAuthUsernameParam` с помощью типа `securestring`. Затем определение действия ссылается на эти параметры в разделе `authentication`.

```json
"definition": {
   "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
   "actions": {
      "HTTP": {
         "type": "Http",
         "inputs": {
            "method": "GET",
            "uri": "https://www.microsoft.com",
            "authentication": {
               "type": "Basic",
               "username": "@parameters('basicAuthUsernameParam')",
               "password": "@parameters('basicAuthPasswordParam')"
            }
         },
         "runAfter": {}
      }
   },
   "parameters": {
      "basicAuthPasswordParam": {
         "type": "securestring"
      },
      "basicAuthUsernameParam": {
         "type": "securestring"
      }
   },
   "triggers": {
      "manual": {
         "type": "Request",
         "kind": "Http",
         "inputs": {
            "schema": {}
         }
      }
   },
   "contentVersion": "1.0.0.0",
   "outputs": {}
}
```

<a name="secure-parameters-deployment-template"></a>

### <a name="secure-parameters-in-azure-resource-manager-templates"></a>Защищенные параметры в шаблонах Azure Resource Manager

[Шаблон Resource Manager](../logic-apps/logic-apps-azure-resource-manager-templates-overview.md) для приложения логики содержит несколько разделов `parameters`. Для защиты паролей, ключей, секретов и других конфиденциальных данных определите защищенные параметры на уровне шаблона и определения рабочего процесса с помощью типа `securestring` или `secureobject`. Затем эти значения можно сохранить в [Azure Key Vault](../key-vault/general/overview.md) и использовать [файл параметров](../azure-resource-manager/templates/parameter-files.md) для ссылки на хранилище ключей и секрет. Затем шаблон извлекает эти сведения при развертывании. Дополнительные сведения см. в статье [Передача конфиденциальных значений при развертывании с помощью Azure Key Vault](../azure-resource-manager/templates/key-vault-parameter.md).

Ниже приведены дополнительные сведения о разделах `parameters`.

* На верхнем уровне шаблона раздел `parameters` определяет параметры для значений, используемых шаблоном при *развертывании*. Например, эти значения могут включать строки подключения для определенной среды развертывания. Эти значения можно сохранить в отдельном [файле параметров](../azure-resource-manager/templates/parameter-files.md), что упрощает изменение этих значений.

* В определении ресурса приложения логики, но вне определения рабочего процесса, в разделе `parameters` указываются значения для параметров определения рабочего процесса. В этом разделе можно присвоить эти значения с помощью выражений шаблона, которые ссылаются на параметры шаблона. Эти выражения вычисляются при развертывании.

* В определении рабочего процесса в разделе `parameters` определяются параметры, используемые приложением логики во время выполнения. Затем можно сослаться на эти параметры в рабочем процессе приложения логики с помощью выражений определения рабочего процесса, которые вычисляются во время выполнения.

Ниже приведен пример шаблона с несколькими определениями защищенных параметров, использующих тип `securestring`.

| Имя параметра | Описание |
|----------------|-------------|
| `TemplatePasswordParam` | Параметр шаблона, принимающий пароль, который затем передается в параметр `basicAuthPasswordParam` определения рабочего процесса |
| `TemplateUsernameParam` | Параметр шаблона, принимающий имя пользователя, которое затем передается в параметр `basicAuthUserNameParam` определения рабочего процесса |
| `basicAuthPasswordParam` | Параметр определения рабочего процесса, который принимает пароль для обычной проверки подлинности в действии HTTP |
| `basicAuthUserNameParam` | Параметр определения рабочего процесса, который принимает имя пользователя для обычной проверки подлинности в действии HTTP |
|||

```json
{
   "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
   "contentVersion": "1.0.0.0",
   "parameters": {
      "LogicAppName": {
         "type": "string",
         "minLength": 1,
         "maxLength": 80,
         "metadata": {
            "description": "Name of the Logic App."
         }
      },
      "TemplatePasswordParam": {
         "type": "securestring"
      },
      "TemplateUsernameParam": {
         "type": "securestring"
      },
      "LogicAppLocation": {
         "type": "string",
         "defaultValue": "[resourceGroup().location]",
         "allowedValues": [
            "[resourceGroup().location]",
            "eastasia",
            "southeastasia",
            "centralus",
            "eastus",
            "eastus2",
            "westus",
            "northcentralus",
            "southcentralus",
            "northeurope",
            "westeurope",
            "japanwest",
            "japaneast",
            "brazilsouth",
            "australiaeast",
            "australiasoutheast",
            "southindia",
            "centralindia",
            "westindia",
            "canadacentral",
            "canadaeast",
            "uksouth",
            "ukwest",
            "westcentralus",
            "westus2"
         ],
         "metadata": {
            "description": "Location of the Logic App."
         }
      }
   },
   "variables": {},
   "resources": [
      {
         "name": "[parameters('LogicAppName')]",
         "type": "Microsoft.Logic/workflows",
         "location": "[parameters('LogicAppLocation')]",
         "tags": {
            "displayName": "LogicApp"
         },
         "apiVersion": "2016-06-01",
         "properties": {
            "definition": {
               "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
               "actions": {
                  "HTTP": {
                     "type": "Http",
                     "inputs": {
                        "method": "GET",
                        "uri": "https://www.microsoft.com",
                        "authentication": {
                           "type": "Basic",
                           "username": "@parameters('basicAuthUsernameParam')",
                           "password": "@parameters('basicAuthPasswordParam')"
                        }
                     },
                  "runAfter": {}
                  }
               },
               "parameters": {
                  "basicAuthPasswordParam": {
                     "type": "securestring"
                  },
                  "basicAuthUsernameParam": {
                     "type": "securestring"
                  }
               },
               "triggers": {
                  "manual": {
                     "type": "Request",
                     "kind": "Http",
                     "inputs": {
                        "schema": {}
                     }
                  }
               },
               "contentVersion": "1.0.0.0",
               "outputs": {}
            },
            "parameters": {
               "basicAuthPasswordParam": {
                  "value": "[parameters('TemplatePasswordParam')]"
               },
               "basicAuthUsernameParam": {
                  "value": "[parameters('TemplateUsernameParam')]"
               }
            }
         }
      }
   ],
   "outputs": {}
}
```

<a name="secure-outbound-requests"></a>

## <a name="access-for-outbound-calls-to-other-services-and-systems"></a>Доступ для исходящих вызовов к другим службам и системам

В зависимости от возможности целевой конечной точки, исходящие вызовы, отправленные [триггером HTTP или действием HTTP](../connectors/connectors-native-http.md), поддерживают шифрование и защищаются с помощью [протокола tls 1,0, 1,1 или 1,2](https://en.wikipedia.org/wiki/Transport_Layer_Security), ранее известного как SSL (SSL). Logic Apps выполняет согласование с целевой конечной точкой, используя максимально возможную версию, которая поддерживается. Например, если целевая конечная точка поддерживает 1,2, триггер или действие HTTP сначала использует 1,2. В противном случае соединитель использует следующую самую новую поддерживаемую версию.

Ниже приведены сведения о самозаверяющих сертификатах TLS/SSL.

* Для приложений логики в глобальной среде Azure с несколькими клиентами соединитель HTTP не допускают самозаверяющие сертификаты TLS/SSL. Если приложение логики выполняет HTTP-вызов к серверу и представляет самозаверяющий сертификат TLS/SSL, вызов HTTP завершается `TrustFailure` ошибкой.

* Для приложений логики в [среде службы интеграции (ISE)](../logic-apps/connect-virtual-network-vnet-isolated-environment-overview.md)соединитель HTTP разрешает самозаверяющие сертификаты для подтверждений TLS/SSL. Однако сначала необходимо [включить поддержку самозаверяющего сертификата](../logic-apps/create-integration-service-environment-rest-api.md#request-body) для существующей интегрированной среды сценариев или новой интегрированной среды скриптов с помощью REST API Logic Apps и установить общедоступный сертификат в `TrustedRoot` расположение.

Ниже приведены дополнительные способы защиты конечных точек, обрабатывающих вызовы, отправленные из приложения логики.

* [Добавление проверки подлинности к исходящим запросам](#add-authentication-outbound).

  При использовании триггера HTTP или действия для отправки исходящих вызовов можно добавить проверку подлинности в запрос, отправляемый приложением логики. Например, можно выбрать следующие типы проверки подлинности.

  * [обычная проверка подлинности](#basic-authentication)

  * [Аутентификация на основе сертификата клиента](#client-certificate-authentication)

  * [Проверка подлинности Active Directory OAuth](#azure-active-directory-oauth-authentication)

  * [Проверка подлинности управляемого удостоверения](#managed-identity-authentication)

* Разрешение доступа с определенных IP-адресов приложения логики.

  Все вызовы конечных точек из приложений логики осуществляются с определенных IP-адресов, основанных на регионе приложений логики. Можно добавить фильтрацию, чтобы принимать запросы только от этих IP-адресов. Список этих IP-адресов можно найти в статье [Ограничения и конфигурация Azure Logic Apps](logic-apps-limits-and-config.md#configuration).

* Повышение безопасности подключений к локальным системам.

  Azure Logic Apps обеспечивают интеграцию с этими службами для обеспечения безопасных и надежных локальных подключений.

  * Локальный шлюз данных

    Многие управляемые соединители в Azure Logic Apps обеспечивают безопасное подключение к локальным системам, включая файловую систему, SQL, SharePoint и DB2. Шлюз отправляет данные из локальных источников по шифрованным каналам через Служебную шину Azure. Весь трафик поступает как безопасный исходящий трафик от агента шлюза. Узнайте, [как работает локальный шлюз данных](logic-apps-gateway-install.md#gateway-cloud-service).

  * Подключение через службу управления API Azure

    Служба [управления API Azure](../api-management/api-management-key-concepts.md) предоставляет локальные варианты подключения, такие как виртуальная частная сеть типа "сеть — сеть" и интеграция [ExpressRoute](../expressroute/expressroute-introduction.md) для защищенного прокси-сервера и взаимодействия с локальными системами. Если у вас есть API, предоставляющий доступ к локальной системе, и вы предоставляли этот API путем создания [экземпляра службы управления API](../api-management/get-started-create-service-instance.md), вы можете вызвать этот API в рабочем процессе приложения логики, выбрав встроенный триггер или действие управления API в конструкторе приложений логики.

    > [!NOTE]
    > Соединитель показывает только те службы управления API, для которых у вас есть разрешения на просмотр и подключение, но не отображает службы управления API на основе потребления.

    1. В конструкторе приложений логики введите `api management` в поле поиска. Выберите шаг в зависимости от того, добавляете ли вы триггер или какое действие:<p>

       * Если вы добавляете триггер, который всегда является первым шагом в рабочем процессе, выберите **пункт выбрать триггер управления API Azure**.

       * Если вы добавляете действие, щелкните **выбрать действие управления API Azure**.

       В этом примере добавляется триггер:

       ![Добавление триггера управления API Azure](./media/logic-apps-securing-a-logic-app/select-api-management.png)

    1. Выберите ранее созданный экземпляр службы управления API.

       ![Выбор экземпляра службы управления API](./media/logic-apps-securing-a-logic-app/select-api-management-service-instance.png)

    1. Выберите используемый вызов API.

       ![Выбрать существующий API](./media/logic-apps-securing-a-logic-app/select-api.png)

<a name="add-authentication-outbound"></a>

### <a name="add-authentication-to-outbound-calls"></a>Добавление проверки подлинности в исходящие вызовы

Конечные точки HTTP и HTTPS поддерживают различные виды проверки подлинности. В некоторых триггерах и действиях, используемых для отправки исходящих вызовов или запросов к этим конечным точкам, можно указать тип проверки подлинности. В конструкторе приложений логики триггеры и действия, которые поддерживают выбор типа проверки подлинности, имеют свойство **проверки** подлинности. Однако это свойство может не всегда отображаться по умолчанию. В этих случаях в триггере или действии откройте список **Добавить новый параметр** и выберите **Проверка подлинности**.

> [!IMPORTANT]
> Для защиты конфиденциальных данных, обрабатываемых приложением логики, используйте защищенные параметры и зашифровать данные по мере необходимости.
> Дополнительные сведения об использовании и защите параметров см. в разделе [Доступ к входным параметрам](#secure-action-parameters).

<a name="authentication-types-supported-triggers-actions"></a>

#### <a name="authentication-types-for-triggers-and-actions-that-support-authentication"></a>Типы проверки подлинности для триггеров и действий, поддерживающих проверку подлинности

В этой таблице указаны типы проверки подлинности, доступные в триггерах и действиях, в которых можно выбрать тип проверки подлинности:

| Authentication type (Тип проверки подлинности) | Поддерживаемые триггеры и действия |
|---------------------|--------------------------------|
| [Основной](#basic-authentication) | Управление API Azure, службы приложений Azure, HTTP, HTTP + Swagger, веб-перехватчик HTTP |
| [Сертификат клиента](#client-certificate-authentication) | Управление API Azure, службы приложений Azure, HTTP, HTTP + Swagger, веб-перехватчик HTTP |
| [Active Directory OAuth](#azure-active-directory-oauth-authentication) | Управление API Azure, службы приложений Azure, функции Azure, HTTP, HTTP + Swagger, веб-перехватчик HTTP |
| [Raw](#raw-authentication) | Управление API Azure, службы приложений Azure, функции Azure, HTTP, HTTP + Swagger, веб-перехватчик HTTP |
| [Управляемое удостоверение](#managed-identity-authentication) | **Встроенные триггеры и действия** <p><p>Управление API Azure, службы приложений Azure, функции Azure, HTTP, веб-перехватчик HTTP <p><p>**Управляемые соединители** <p><p>Защита идентификации Azure AD, служба автоматизации Azure, экземпляр контейнера Azure, обозреватель данных Azure, фабрика данных Azure, Azure Data Lake, служба "Сетка событий Azure", Azure IoT Central v3, Azure Key Vault, Log Analytics Azure, журналы Azure Monitor, Azure Resource Manager, Sentinel Azure, HTTP с Azure AD <p><p>**Примечание**. Сейчас поддержка управляемых соединителей доступна в предварительной версии. |
|||

<a name="basic-authentication"></a>

#### <a name="basic-authentication"></a>обычная проверка подлинности

Если доступен параметр [Обычная](../active-directory-b2c/secure-rest-api.md), укажите следующие значения свойств.

| Свойство (конструктор) | Свойство (JSON) | Обязательно | Значение | Описание |
|---------------------|-----------------|----------|-------|-------------|
| **Аутентификация** | `type` | Да | Basic | Тип проверки подлинности |
| **Имя пользователя** | `username` | Да | <*имя-пользователя*>| Имя пользователя для аутентификации доступа к целевой конечной точке службы |
| **Пароль** | `password` | Да | <*пароль*> | Пароль для аутентификации доступа к целевой конечной точке службы |
||||||

При использовании [защищенных параметров](#secure-action-parameters) для управления конфиденциальной информацией, например, в [шаблоне Azure Resource Manager для автоматизации развертывания](../logic-apps/logic-apps-azure-resource-manager-templates-overview.md), можно использовать выражения для доступа к этим значениям параметров во время выполнения. В следующем примере определение действия HTTP задает тип проверки подлинности `type` как `Basic` и использует [функцию parameters()](../logic-apps/workflow-definition-language-functions-reference.md#parameters) для получения значений параметров.

```json
"HTTP": {
   "type": "Http",
   "inputs": {
      "method": "GET",
      "uri": "@parameters('endpointUrlParam')",
      "authentication": {
         "type": "Basic",
         "username": "@parameters('userNameParam')",
         "password": "@parameters('passwordParam')"
      }
  },
  "runAfter": {}
}
```

<a name="client-certificate-authentication"></a>

#### <a name="client-certificate-authentication"></a>Проверка подлинности на основе сертификата клиента

Если доступен параметр [Сертификат клиента](../active-directory/authentication/active-directory-certificate-based-authentication-get-started.md), укажите следующие значения свойств.

| Свойство (конструктор) | Свойство (JSON) | Обязательно | Значение | Описание |
|---------------------|-----------------|----------|-------|-------------|
| **Аутентификация** | `type` | Да | **Сертификат клиента** <br>или диспетчер конфигурации служб <br>`ClientCertificate` | Тип проверки подлинности. Управлять сертификатами можно с помощью службы [управления API Azure](../api-management/api-management-howto-mutual-certificates.md). <p></p>**Примечание**. пользовательские соединители не поддерживают проверку подлинности на основе сертификатов как для входящих, так и для исходящих вызовов. |
| **Pfx** | `pfx` | Да | <*закодированное-содержимое-файла-pfx*> | Содержимое файла обмена личной информацией (PFX-файла) с кодировкой base64. <p><p>Чтобы преобразовать PFX-файл в формат в кодировке base64, можно использовать PowerShell, выполнив следующие действия. <p>1. Сохраните содержимое сертификата в переменную: <p>   `$pfx_cert = get-content 'c:\certificate.pfx' -Encoding Byte` <p>2. Преобразуйте содержимое сертификата с помощью функции `ToBase64String()` и сохраните содержимое в текстовый файл: <p>   `[System.Convert]::ToBase64String($pfx_cert) | Out-File 'pfx-encoded-bytes.txt'` <p><p>**Устранение неполадок**. при использовании `cert mmc/PowerShell` команды может появиться следующее сообщение об ошибке: <p><p>`Could not load the certificate private key. Please check the authentication certificate password is correct and try again.` <p><p>Чтобы устранить эту ошибку, попробуйте преобразовать PFX-файл в файл PEM и снова с помощью `openssl` команды: <p><p>`openssl pkcs12 -in certificate.pfx -out certificate.pem` <br>`openssl pkcs12 -in certificate.pem -export -out certificate2.pfx` <p><p>Затем, когда вы получаете строку в кодировке Base64 для только что преобразованного PFX-файла сертификата, строка теперь работает в Azure Logic Apps. |
| **Пароль** | `password`| нет | <*пароль-для-файла-pfx*> | Пароль для доступа к PFX-файлу |
|||||

При использовании [защищенных параметров](#secure-action-parameters) для управления конфиденциальной информацией, например, в [шаблоне Azure Resource Manager для автоматизации развертывания](../logic-apps/logic-apps-azure-resource-manager-templates-overview.md), можно использовать выражения для доступа к этим значениям параметров во время выполнения. В следующем примере определение действия HTTP задает тип проверки подлинности `type` как `ClientCertificate` и использует [функцию parameters()](../logic-apps/workflow-definition-language-functions-reference.md#parameters) для получения значений параметров.

```json
"HTTP": {
   "type": "Http",
   "inputs": {
      "method": "GET",
      "uri": "@parameters('endpointUrlParam')",
      "authentication": {
         "type": "ClientCertificate",
         "pfx": "@parameters('pfxParam')",
         "password": "@parameters('passwordParam')"
      }
   },
   "runAfter": {}
}
```

Дополнительные сведения о защите служб с помощью проверки подлинности на основе сертификата клиента см. в следующих разделах.

* [Повышение защиты API-интерфейсов с помощью аутентификации на основе сертификата клиента в службе управления API Azure](../api-management/api-management-howto-mutual-certificates-for-clients.md)
* [Повышение защиты фоновых служб посредством проверки подлинности с помощью сертификата клиента в службе Azure API Management](../api-management/api-management-howto-mutual-certificates.md)
* [Повышение защиты служб RESTful с помощью сертификатов клиента](../active-directory-b2c/secure-rest-api.md)
* [Учетные данные сертификата для аутентификации приложения](../active-directory/develop/active-directory-certificate-credentials.md)
* [Использование TLS/SSL-сертификата в коде в Службе приложений Azure](../app-service/configure-ssl-certificate-in-code.md)

<a name="azure-active-directory-oauth-authentication"></a>

#### <a name="azure-active-directory-open-authentication"></a>Открытая проверка подлинности Azure Active Directory

В триггерах запросов можно использовать [Azure Active Directory Open authentication (Azure AD OAuth)](../active-directory/develop/index.yml)для проверки подлинности входящих вызовов после [настройки политик авторизации Azure AD](#enable-oauth) для приложения логики. Для всех других триггеров и действий, для которых можно выбрать **Active Directory OAuth** в качестве типа проверки подлинности, укажите следующие значения свойств.

| Свойство (конструктор) | Свойство (JSON) | Обязательно | Значение | Описание |
|---------------------|-----------------|----------|-------|-------------|
| **Аутентификация** | `type` | Да | **Active Directory OAuth** <br>или диспетчер конфигурации служб <br>`ActiveDirectoryOAuth` | Тип проверки подлинности. В настоящее время Logic Apps следует требованиям [протокола OAuth 2.0](../active-directory/develop/v2-overview.md). |
| **Центр авторизации** | `authority` | нет | <*URL-адрес для поставщика токена*> | URL-адрес центра, предоставляющего маркер доступа. По умолчанию это значение равно `https://login.windows.net`. |
| **Клиент** | `tenant` | Да | <*ИД клиента*> | Идентификатор клиента Azure Active Directory. |
| **Аудитория** | `audience` | Да | <*ресурс для авторизации*> | Ресурс, который нужно использовать для авторизации, например `https://management.core.windows.net/`. |
| **Идентификатор клиента** | `clientId` | Да | <*ИД клиента*> | Идентификатор клиента для приложения, запрашивающего авторизацию. |
| **Тип учетных данных** | `credentialType` | Да | Сертификат <br>или диспетчер конфигурации служб <br>Секрет | Тип учетных данных, который клиент использует для запроса авторизации. Это свойство и значение не отображаются в базовом определении приложения логики, но определяет свойства, отображаемые для выбранного типа учетных данных. |
| **Секрет** | `secret` | Да, но только для учетных данных типа "Секрет" | <*секрет-клиента*> | Секрет клиента для запроса на авторизацию |
| **Pfx** | `pfx` | Да, но только для учетных данных типа "Сертификат" | <*закодированное-содержимое-файла-pfx*> | Содержимое файла обмена личной информацией (PFX-файла) с кодировкой base64. |
| **Пароль** | `password` | Да, но только для учетных данных типа "Сертификат" | <*пароль-для-файла-pfx*> | Пароль для доступа к PFX-файлу |
|||||

При использовании [защищенных параметров](#secure-action-parameters) для управления конфиденциальной информацией, например, в [шаблоне Azure Resource Manager для автоматизации развертывания](../logic-apps/logic-apps-azure-resource-manager-templates-overview.md), можно использовать выражения для доступа к этим значениям параметров во время выполнения. В следующем примере определение действия HTTP задает тип проверки подлинности `type` как `ActiveDirectoryOAuth`, тип учетных данных как `Secret` и использует [функцию parameters()](../logic-apps/workflow-definition-language-functions-reference.md#parameters) для получения значений параметров.

```json
"HTTP": {
   "type": "Http",
   "inputs": {
      "method": "GET",
      "uri": "@parameters('endpointUrlParam')",
      "authentication": {
         "type": "ActiveDirectoryOAuth",
         "tenant": "@parameters('tenantIdParam')",
         "audience": "https://management.core.windows.net/",
         "clientId": "@parameters('clientIdParam')",
         "credentialType": "Secret",
         "secret": "@parameters('secretParam')"
     }
   },
   "runAfter": {}
}
```

<a name="raw-authentication"></a>

#### <a name="raw-authentication"></a>Проверка подлинности Raw

Если параметр **Raw** доступен, этот тип проверки подлинности можно использовать при необходимости использовать [схемы проверки подлинности](https://iana.org/assignments/http-authschemes/http-authschemes.xhtml), которые не соответствуют [протоколу OAuth 2.0](https://oauth.net/2/). При использовании этого типа вы вручную создаете значение заголовка авторизации, отправляемого с исходящим запросом, и указываете это значение заголовка в триггере или действии.

Ниже приведен пример заголовка для HTTPS-запроса, который соответствует [протоколу OAuth 1.0](https://tools.ietf.org/html/rfc5849).

```text
Authorization: OAuth realm="Photos",
   oauth_consumer_key="dpf43f3p2l4k3l03",
   oauth_signature_method="HMAC-SHA1",
   oauth_timestamp="137131200",
   oauth_nonce="wIjqoS",
   oauth_callback="http%3A%2F%2Fprinter.example.com%2Fready",
   oauth_signature="74KNZJeDHnMBp0EMJ9ZHt%2FXKycU%3D"
```

В триггере или действии, поддерживающем проверку подлинности Raw, укажите следующие значения свойств.

| Свойство (конструктор) | Свойство (JSON) | Обязательно | Значение | Описание |
|---------------------|-----------------|----------|-------|-------------|
| **Аутентификация** | `type` | Да | Raw | Тип проверки подлинности |
| **Значение** | `value` | Да | <*значение-заголовка-авторизации*> | Значение заголовка авторизации, используемое для проверки подлинности |
||||||

При использовании [защищенных параметров](#secure-action-parameters) для управления конфиденциальной информацией, например, в [шаблоне Azure Resource Manager для автоматизации развертывания](../logic-apps/logic-apps-azure-resource-manager-templates-overview.md), можно использовать выражения для доступа к этим значениям параметров во время выполнения. В следующем примере определение действия HTTP задает тип проверки подлинности `type` как `Raw` и использует [функцию parameters()](../logic-apps/workflow-definition-language-functions-reference.md#parameters) для получения значений параметров.

```json
"HTTP": {
   "type": "Http",
   "inputs": {
      "method": "GET",
      "uri": "@parameters('endpointUrlParam')",
      "authentication": {
         "type": "Raw",
         "value": "@parameters('authHeaderParam')"
      }
   },
   "runAfter": {}
}
```

<a name="managed-identity-authentication"></a>

#### <a name="managed-identity-authentication"></a>Проверка подлинности управляемого удостоверения

Если параметр [управляемое удостоверение](../active-directory/managed-identities-azure-resources/overview.md) доступен в [триггере или действии, поддерживающем проверку подлинности управляемого удостоверения](#add-authentication-outbound), приложение логики может использовать назначенное системой удостоверение или *однократно* созданное вручную удостоверение для проверки подлинности доступа к ресурсам Azure, защищенным Azure Active Directory (Azure AD), а не учетными данными, секретами или маркерами Azure AD. Azure управляет этим удостоверением и помогает защитить учетные данные, так как вы не имеете возможности управлять секретами или напрямую использовать токены Azure AD. Подробнее см. в статье [Службы, которые поддерживают управляемые удостоверения для проверки подлинности Azure AD](../active-directory/managed-identities-azure-resources/services-support-managed-identities.md#azure-services-that-support-azure-ad-authentication).

1. Прежде чем приложение логики сможет использовать управляемое удостоверение, выполните действия, описанные в разделе [Проверка подлинности доступа к ресурсам Azure с помощью управляемых удостоверений в Azure Logic Apps](../logic-apps/create-managed-service-identity.md). Это действия позволяют включить управляемое удостоверение в приложении логики и настроить доступ этого удостоверения к целевому ресурсу Azure.

1. Прежде чем функция Azure сможет использовать управляемое удостоверение, необходимо [включить проверку подлинности для функций Azure](../logic-apps/logic-apps-azure-functions.md#enable-authentication-for-functions).

1. В триггере или действии, поддерживающем использование управляемого удостоверения, укажите следующие сведения:

   **Встроенные триггеры и действия**

   | Свойство (конструктор) | Свойство (JSON) | Обязательно | Значение | Описание |
   |---------------------|-----------------|----------|-------|-------------|
   | **Аутентификация** | `type` | Да | **Управляемое удостоверение** <br>или диспетчер конфигурации служб <br>`ManagedServiceIdentity` | Тип проверки подлинности |
   | **Управляемое удостоверение** | `identity` | Да | * **Управляемое удостоверение, назначенное системой** <br>или диспетчер конфигурации служб <br>`SystemAssigned` <p><p>* <*назначенное-пользователем-имя-удостоверения*> | Управляемое удостоверение |
   | **Аудитория** | `audience` | Да | <*идентификатор-целевого-ресурса*> | Идентификатор целевого ресурса, к которому требуется получить доступ. <p>Например, значение `https://storage.azure.com/` делает [маркеры доступа](../active-directory/develop/access-tokens.md) действительными для проверки подлинности для всех учетных записей хранения. Однако можно также указать URL-адрес корневой службы для конкретной учетной записи хранения, например `https://fabrikamstorageaccount.blob.core.windows.net`. <p>**Примечание.** Свойство **Аудитория** может быть скрыто в некоторых триггерах или действиях. Чтобы отобразить это свойство, в триггере или действии откройте список **Добавить новый параметр** и выберите **Аудитория**. <p><p>**Важно!** Убедитесь, что значение идентификатора ресурса *точно совпадает* со значением, ожидаемым Azure AD, включая все необходимые знаки косой черты. Например, для идентификатора ресурса `https://storage.azure.com/` для всех учетных записей хранилища BLOB-объектов Azure требуется завершающая косая черта. Но для идентификатора ресурса конкретной учетной записи хранения завершающая косая черта не требуется. Сведения о том, как найти эти идентификаторы ресурсов, см. в разделе [Службы Azure, которые поддерживают Azure AD](../active-directory/managed-identities-azure-resources/services-support-managed-identities.md#azure-services-that-support-azure-ad-authentication). |
   |||||

   При использовании [защищенных параметров](#secure-action-parameters) для управления конфиденциальной информацией, например, в [шаблоне Azure Resource Manager для автоматизации развертывания](../logic-apps/logic-apps-azure-resource-manager-templates-overview.md), можно использовать выражения для доступа к этим значениям параметров во время выполнения. Например, это определение действия HTTP определяет проверку подлинности `type` как `ManagedServiceIdentity` и использует [функцию Parameters ()](../logic-apps/workflow-definition-language-functions-reference.md#parameters) для получения значений параметров:

   ```json
   "HTTP": {
      "type": "Http",
      "inputs": {
         "method": "GET",
         "uri": "@parameters('endpointUrlParam')",
         "authentication": {
            "type": "ManagedServiceIdentity",
            "identity": "SystemAssigned",
            "audience": "https://management.azure.com/"
         },
      },
      "runAfter": {}
   }
   ```

   **Триггеры и действия управляемых соединителей**

   | Свойство (конструктор) | Обязательно | Значение | Описание |
   |---------------------|----------|-------|-------------|
   | **Имя соединения** | Да | <*имя соединения*> ||
   | **Управляемое удостоверение** | Да | **Управляемое удостоверение, назначаемое системой** <br>или <br> <*назначенное пользователем удостоверение-имя*> | Тип проверки подлинности |
   |||||


<a name="block-connections"></a>

## <a name="block-creating-connections"></a>Блокировать создание подключений

Если ваша организация не разрешается подключаться к конкретным ресурсам с помощью соединителей в Azure Logic Apps, можно [заблокировать возможность создания этих подключений](../logic-apps/block-connections-connectors.md) для конкретных соединителей в рабочих процессах приложения логики с помощью [политики Azure](../governance/policy/overview.md). Дополнительные сведения см. [в разделе Блокирование подключений, созданных конкретными соединителями в Azure Logic Apps](../logic-apps/block-connections-connectors.md).

<a name="isolation-logic-apps"></a>

## <a name="isolation-guidance-for-logic-apps"></a>Руководство по изоляции приложений логики

Вы можете использовать Azure Logic Apps в [Azure для государственных организаций](../azure-government/documentation-government-welcome.md) , поддерживающих все уровни влияния в регионах, описанных в [руководствах по изоляции уровня влияния Azure для государственных организаций](../azure-government/documentation-government-impact-level-5.md#azure-logic-apps) , и [руководство по обеспечению защиты облачных вычислений в облаке США (имеющих)](https://dl.dod.cyber.mil/wp-content/uploads/cloud/SRG/index.html). Для удовлетворения этих требований Logic Apps поддерживает возможность создания и запуска рабочих процессов в среде с выделенными ресурсами, что позволяет снизить влияние других клиентов Azure на приложения логики и избежать совместного использования вычислительных ресурсов с другими клиентами.

* Чтобы запустить собственный код или выполнить преобразование XML, [Создайте и вызовите функцию Azure](../logic-apps/logic-apps-azure-functions.md), а не используйте [встроенные функции кода](../logic-apps/logic-apps-add-run-inline-code.md) или предоставьте [сборки для использования в качестве карт](../logic-apps/logic-apps-enterprise-integration-maps.md)соответственно. Кроме того, настройте среду внешнего размещения для приложения функции в соответствии с требованиями к изоляции.

  Например, чтобы удовлетворить требования уровня влияния 5, создайте приложение-функцию с помощью [плана службы приложений](../azure-functions/dedicated-plan.md) с использованием ценовой категории " [ **изолированный**](../app-service/overview-hosting-plans.md) " и [Среда службы приложений (ASE)](../app-service/environment/intro.md) , которая также использует ценовую категорию " **изолированная** ". В этой среде приложения-функции выполняются на выделенных виртуальных машинах Azure и выделенных виртуальных сетях Azure, которые обеспечивают изоляцию сети на основе изоляции вычислений для приложений и максимальных возможностей масштабирования. Дополнительные сведения см. в [статье Руководство по изоляции уровня влияния в Azure для государственных организаций: функции Azure](../azure-government/documentation-government-impact-level-5.md#azure-functions).

  Дополнительные сведения см. в следующих статьях:<p>

  * [Планы службы приложений Azure](../app-service/overview-hosting-plans.md)
  * [Параметры сети для Функций Azure](../azure-functions/functions-networking-options.md)
  * [Выделенные узлы Azure для виртуальных машин](../virtual-machines/dedicated-hosts.md)
  * [Изоляция виртуальных машин в Azure](../virtual-machines/isolation.md)
  * [Развертывание выделенных служб Azure в виртуальных сетях](../virtual-network/virtual-network-for-azure-services.md)

* Для создания приложений логики, которые выполняются на выделенных ресурсах и могут получать доступ к ресурсам, защищенным виртуальной сетью Azure, можно создать [среду службы интеграции (ISE)](../logic-apps/connect-virtual-network-vnet-isolated-environment-overview.md).

  * Некоторые виртуальные сети Azure используют частные конечные точки ([частные ссылки Azure](../private-link/private-link-overview.md)) для предоставления доступа к службам Azure PaaS, таким как служба хранилища azure, Azure Cosmos DB или база данных SQL Azure, партнерские службы или службы клиентов, размещенные в Azure. Если приложениям логики требуется доступ к виртуальным сетям, использующим частные конечные точки, необходимо создать, развернуть и запустить эти приложения логики в интегрированной среде сценариев.

  * Чтобы получить более полный контроль над ключами шифрования, используемыми службой хранилища Azure, можно настроить, использовать и управлять собственным ключом с помощью [Azure Key Vault](../key-vault/general/overview.md). Эта возможность также называется "создание собственных ключей" (BYOK), а ключ называется "ключом, управляемым клиентом". Дополнительные сведения см. [в разделе Настройка ключей, управляемых клиентом, для шифрования неактивных данных в средах служб Integration Services (исес) в Azure Logic Apps](../logic-apps/customer-managed-keys-integration-service-environment.md).

Дополнительные сведения см. в следующих статьях:

* [Изоляция в общедоступном облаке Azure](../security/fundamentals/isolation-choices.md)
* [Безопасность для приложений IaaS с высоким уровнем безопасности в Azure](/azure/architecture/reference-architectures/n-tier/high-security-iaas)

## <a name="next-steps"></a>Дальнейшие действия

* [Базовый план безопасности Azure для Azure Logic Apps](../logic-apps/security-baseline.md)
* [Автоматизация развертывания для Azure Logic Apps](../logic-apps/logic-apps-azure-resource-manager-templates-overview.md)
* [Мониторинг приложений логики](../logic-apps/monitor-logic-apps-log-analytics.md)
