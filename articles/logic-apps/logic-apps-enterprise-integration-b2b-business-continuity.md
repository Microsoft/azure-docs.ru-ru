---
title: Аварийное восстановление для учетных записей интеграции
description: Настройка учетных записей интеграции и артефактов B2B с помощью аварийного восстановления в разных регионах Azure Logic Apps
services: logic-apps
ms.suite: integration
author: divyaswarnkar
ms.author: divswa
ms.reviewer: jonfan, estfan, logicappspm
ms.topic: article
ms.date: 04/10/2017
ms.openlocfilehash: 1e006dd690e9c008afada8a490da6c3238bc0791
ms.sourcegitcommit: 772eb9c6684dd4864e0ba507945a83e48b8c16f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "91565417"
---
# <a name="set-up-cross-region-disaster-recovery-for-integration-accounts-in-azure-logic-apps"></a>Настройка аварийного восстановления в разных регионах для учетных записей интеграции в Azure Logic Apps

Рабочие нагрузки B2B включают денежные транзакции, например заказы и счета. Для компаний в случае аварии чрезвычайно важно быстро восстановить систему для соответствия Соглашениям об уровне обслуживания корпоративного уровня по договоренности с партнерами. В этой статье описывается создание плана обеспечения непрерывности бизнес-процессов для рабочих нагрузок B2B. 

* Готовность к аварийному восстановлению 
* Отработка отказа в дополнительный регион во время аварии 
* Восстановление размещения в основной регион после аварийного восстановления

## <a name="disaster-recovery-readiness"></a>Готовность к аварийному восстановлению  

1. Выберите дополнительный регион и создайте в нем [учетную запись интеграции](../logic-apps/logic-apps-enterprise-integration-create-integration-account.md).

2. Добавьте партнеров, схемы и соглашения для необходимых потоков сообщений, в которых состояние выполнения нужно реплицировать в учетную запись интеграции дополнительного региона.

   > [!TIP]
   > Соглашения об именовании артефактов учетной записи интеграции в регионах должны быть согласованы. 

3. Чтобы получить состояние выполнения из основного региона, создайте приложение логики в дополнительном регионе. 

   Приложение логики должно включать *триггер* и *действие*. 
   Триггер необходимо подключить к учетной записи интеграции основного региона, а действие — к учетной записи интеграции дополнительного региона. 
   В зависимости от интервала времени триггер выполняет опрос таблицы состояния выполнения для основного региона и извлекает новые записи при их наличии, а действие обновляет сведения о записях в учетной записи интеграции дополнительного региона. 
   Это позволяет передать добавочное состояние среды выполнения из основного региона в дополнительный.

4. Непрерывность бизнес-процессов в учетной записи интеграции Logic Apps поддерживает протоколы на базе B2B — X12, AS2 и EDIFACT. Чтобы получить дополнительные сведения, используйте соответствующие ссылки.

5. Мы рекомендуем также развернуть все ресурсы основного региона 

   (например, Базу данных SQL Azure и Azure Cosmos DB, Служебную шину Azure и Центры событий Azure, используемые для обмена сообщениями, управление API Azure и компонент Azure Logic Apps в Службе приложений Azure) в дополнительном регионе.   

6. Установите подключение между основным и дополнительным регионом. Чтобы получить состояние выполнения из основного региона, создайте приложение логики в дополнительном регионе. 

   Приложение логики должно включать триггер и действие. 
   Триггер необходимо подключить к учетной записи интеграции для основного региона, 
   а действие — к учетной записи интеграции для дополнительного региона. 
   В зависимости от интервала времени триггер выполняет опрос таблицы состояния выполнения для основного региона и извлекает новые записи при их наличии, 
   а действие обновляет сведения о записях в учетной записи интеграции дополнительного региона. 
   Этот процесс позволяет передать добавочное состояние среды выполнения из основного региона в дополнительный.

Непрерывность бизнес-процессов в учетной записи интеграции Logic Apps поддерживает протоколы на базе B2B — X12, AS2 и EDIFACT. Подробные инструкции по использованию протоколов X12 и AS2 см. в [этом](../logic-apps/logic-apps-enterprise-integration-b2b-business-continuity.md#x12) и в [этом](../logic-apps/logic-apps-enterprise-integration-b2b-business-continuity.md#as2) разделе данной статьи.

## <a name="fail-over-to-a-secondary-region-during-a-disaster-event"></a>Отработка отказа в дополнительный регион во время аварии

Во время аварийного события, когда основной регион является недоступным для обеспечения непрерывности бизнес-процессов, перенаправьте трафик к дополнительному региону. Дополнительный регион помогает компании быстро восстановить работу в соответствии с показателями RPO и RTO, согласованными с партнерами. При использовании этого региона очень просто выполнить отработку отказа из одного региона в другой. 

При копировании контрольных номеров из основного региона в дополнительный вы столкнетесь с ожидаемой задержкой. Чтобы избежать отправки повторно созданных контрольных номеров партнерам во время аварийного события, мы рекомендуем увеличивать эти номера в соглашениях для дополнительного региона с помощью [командлетов PowerShell](/powershell/module/azurerm.logicapp/set-azurermintegrationaccountgeneratedicn?view=azurermps-6.13.0).

## <a name="fall-back-to-a-primary-region-post-disaster-event"></a>Восстановление размещения в основной регион после аварийного восстановления

Чтобы восстановить размещение в основной регион (если он доступен), сделайте следующее:

1. Не принимайте сообщения от партнеров в дополнительном регионе.  

2. Увеличьте создаваемые контрольные номера для всех соглашений основного региона с помощью [командлетов PowerShell](/powershell/module/azurerm.logicapp/set-azurermintegrationaccountgeneratedicn?view=azurermps-6.13.0).  

3. Перенаправьте трафик из дополнительного региона в основной.

4. Проверьте, включено ли приложение логики, созданное в дополнительном регионе, чтобы передать состояние выполнения из основного региона.

## <a name="x12"></a>X12 

Для непрерывности бизнес-процессов для документов EDI X12 используются контрольные номера:

> [!TIP]
> Чтобы создать приложения логики, вы также можете использовать [шаблон быстрого запуска X12](https://azure.microsoft.com/resources/templates/201-logic-app-b2b-disaster-recovery-replication/). Для использования этого шаблона необходимо создать учетные записи интеграции для основного и дополнительного регионов. С помощью шаблона вы создадите два приложения логики: одно для полученного контрольного номера, а второе — для созданного. Соответствующие триггеры и действия создаются в Logic Apps. Триггер подключается к учетной записи интеграции для основного региона, а действие — к учетной записи интеграции для дополнительного региона.

**Предварительные требования**

Чтобы включить аварийное восстановление для входящих сообщений, выберите параметры проверки дублирования в разделе с настройками получения соглашения X12.

![Выбор параметров проверки дублирования](./media/logic-apps-enterprise-integration-b2b-business-continuity/dupcheck.png)  

1. Создайте [приложение логики](../logic-apps/quickstart-create-first-logic-app-workflow.md) в дополнительном регионе.    

2. Выполните поиск **X12** и выберите **X12 — при изменении контрольного номера**.   

   ![Поиск по запросу "X12"](./media/logic-apps-enterprise-integration-b2b-business-continuity/x12cn1.png)

   При выборе триггера вам будет предложено установить соединение с учетной записью интеграции. 
   Триггер необходимо подключить к учетной записи интеграции для основного региона.

3. Присвойте имя для подключения, выберите из списка свою *учетную запись интеграции для основного региона*, а затем выберите **Создать**.   

   ![Снимок экрана, на котором показано, где ввести имя подключения и выбрать учетную запись интеграции основного региона. ](./media/logic-apps-enterprise-integration-b2b-business-continuity/x12cn2.png)

4. Параметр **Дата и время начала синхронизации контрольного номера** является необязательным. Вы можете задать **частоту** с интервалом в **днях**, **часах**, **минутах** или **секундах**.   

   ![Снимок экрана, на котором показана дата и время запуска параметра синхронизации контрольного номера.](./media/logic-apps-enterprise-integration-b2b-business-continuity/x12cn3.png)

5. Выберите **New step** (Новый шаг) > **Добавить действие**.

   ![Снимок экрана, на котором показана кнопка "создать шаг" и параметр "добавить действие".](./media/logic-apps-enterprise-integration-b2b-business-continuity/x12cn4.png)

6. Выполните поиск **X12** и выберите **X12 — добавление или изменение контрольных номеров**.   

   ![Добавление или обновление контрольных номеров](./media/logic-apps-enterprise-integration-b2b-business-continuity/x12cn5.png)

7. Чтобы подключить действие к учетной записи интеграции с дополнительным регионом, выберите **изменить подключение**  >  **Добавить новое подключение** , чтобы получить список доступных учетных записей интеграции. Введите имя для подключения, выберите из списка свою *учетную запись интеграции для дополнительного региона*, а затем выберите **Создать**. 

   ![Снимок экрана, на котором показано, куда добавить имя учетной записи интеграции для дополнительного региона.](./media/logic-apps-enterprise-integration-b2b-business-continuity/x12cn6.png)

8. Переключитесь на необработанные входные данные, щелкнув значок в правом верхнем углу.

   ![Снимок экрана, на котором показан значок для переключения на необработанные данные.](./media/logic-apps-enterprise-integration-b2b-business-continuity/x12rawinputs.png)

9. Выберите "Текст" с помощью средства выбора динамического содержимого и сохраните приложение логики.

   ![Поля динамического содержимого](./media/logic-apps-enterprise-integration-b2b-business-continuity/x12cn7.png)

   В зависимости от интервала времени триггер выполняет опрос таблицы полученных контрольных номеров для основного региона и извлекает новые записи при их наличии, 
   а действие обновляет сведения о записях в учетной записи интеграции дополнительного региона. 
   Если эти сведения не обновляются, состояние триггера отображается как **Пропущено**.   

   ![Таблица контрольных номеров](./media/logic-apps-enterprise-integration-b2b-business-continuity/x12recevicedcn8.png)

В зависимости от интервала времени дополнительное состояние о среде выполнения реплицируется из основного региона в дополнительный. Во время аварийного события, когда основной регион является недоступным, перенаправьте трафик к дополнительному региону для обеспечения непрерывности бизнес-процессов. 

## <a name="edifact"></a>EDIFACT 

Чтобы обеспечить непрерывность бизнес-процессов для документов EDIFACT EDI, используются контрольные номера.

**Предварительные требования**

Чтобы включить аварийное восстановление для входящих сообщений, выберите параметры проверки дублирования в разделе с настройками получения соглашения EDIFACT.

![Снимок экрана, на котором показаны параметры проверки дублирования в параметрах получения соглашения EDIFACT.](./media/logic-apps-enterprise-integration-b2b-business-continuity/edifactdupcheck.png)  

1. Создайте [приложение логики](../logic-apps/quickstart-create-first-logic-app-workflow.md) в дополнительном регионе.    

2. Выполните поиск **EDIFACT** и выберите **EDIFACT — при изменении контрольного номера**.

   ![Поиск по запросу "EDIFACT"](./media/logic-apps-enterprise-integration-b2b-business-continuity/edifactcn1.png)

   При выборе триггера вам будет предложено установить соединение с учетной записью интеграции. 
   Триггер необходимо подключить к учетной записи интеграции для основного региона. 

3. Присвойте имя для подключения, выберите из списка свою *учетную запись интеграции для основного региона*, а затем выберите **Создать**.    

   ![Имя учетной записи интеграции для основного региона](./media/logic-apps-enterprise-integration-b2b-business-continuity/X12CN2.png)

4. Параметр **Дата и время начала синхронизации контрольного номера** является необязательным. Вы можете задать **частоту** с интервалом в **днях**, **часах**, **минутах** или **секундах**.    

   ![Снимок экрана, на котором показаны параметры даты и времени.](./media/logic-apps-enterprise-integration-b2b-business-continuity/x12cn3.png)

6. Выберите **New step** (Новый шаг) > **Добавить действие**.    

   ![Снимок экрана, на котором показано, где можно выбрать команду "добавить действие".](./media/logic-apps-enterprise-integration-b2b-business-continuity/x12cn4.png)

7. Выполните поиск **EDIFACT** и выберите **EDIFACT — добавление и изменение контрольных номеров**.   

   ![Снимок экрана, на котором показано, куда добавлять или обновлять контрольные номера.](./media/logic-apps-enterprise-integration-b2b-business-continuity/EdifactChooseAction.png)

8. Чтобы подключить действие к учетной записи интеграции с дополнительным регионом, выберите **изменить подключение**  >  **Добавить новое подключение** , чтобы получить список доступных учетных записей интеграции. Введите имя для подключения, выберите из списка свою *учетную запись интеграции для дополнительного региона*, а затем выберите **Создать**.

   ![Создайте имя учетной записи интеграции с дополнительным регионом.](./media/logic-apps-enterprise-integration-b2b-business-continuity/x12cn6.png)

9. Переключитесь на необработанные входные данные, щелкнув значок в правом верхнем углу.

   ![Снимок экрана, который выделяет значок для выбора при переключении на необработанные входные данные.](./media/logic-apps-enterprise-integration-b2b-business-continuity/Edifactrawinputs.png)

10. Выберите "Текст" с помощью средства выбора динамического содержимого и сохраните приложение логики.   

   ![Снимок экрана, на котором показано средство выбора динамического содержимого, в котором можно выбрать текст из.](./media/logic-apps-enterprise-integration-b2b-business-continuity/X12CN7.png)

   В зависимости от интервала времени триггер выполняет опрос таблицы полученных контрольных номеров для основного региона и извлекает новые записи при их наличии,
   а действие обновляет сведения о записях в учетной записи интеграции дополнительного региона. 
   Если эти сведения не обновляются, состояние триггера отображается как **Пропущено**.

   ![Таблица контрольных номеров](./media/logic-apps-enterprise-integration-b2b-business-continuity/x12recevicedcn8.png)

В зависимости от интервала времени дополнительное состояние о среде выполнения реплицируется из основного региона в дополнительный. Во время аварийного события, когда основной регион является недоступным, перенаправьте трафик к дополнительному региону для обеспечения непрерывности бизнес-процессов. 

## <a name="as2"></a>AS2 

Для непрерывности бизнес-процессов для документов, использующих протокол AS2, используется идентификатор сообщения и значение MIC.

> [!TIP]
> Чтобы создать приложения логики, вы также можете использовать [шаблон быстрого запуска AS2](https://github.com/Azure/azure-quickstart-templates/pull/3302). Для использования этого шаблона необходимо создать учетные записи интеграции для основного и дополнительного регионов. Шаблон позволяет создать приложение логики с триггером и действием. Приложение логики создает подключение от триггера к учетной записи интеграции для основного региона и подключение от действия к учетной записи интеграции для дополнительного региона.

1. Создайте [приложение логики](../logic-apps/quickstart-create-first-logic-app-workflow.md) в дополнительном регионе.  

2. Выполните поиск **AS2** и выберите **AS2 — When a MIC value is created** (AS2 — При создании значения MIC).   

   ![Поиск по запросу "AS2"](./media/logic-apps-enterprise-integration-b2b-business-continuity/as2messageid1.png)

   При выборе триггера вам будет предложено установить соединение с учетной записью интеграции. 
   Триггер необходимо подключить к учетной записи интеграции для основного региона. 
   
3. Присвойте имя для подключения, выберите из списка свою *учетную запись интеграции для основного региона*, а затем выберите **Создать**.

   ![Снимок экрана, на котором показано, где ввести имя подключения при создании значения MIC.](./media/logic-apps-enterprise-integration-b2b-business-continuity/as2messageid2.png)

4. Параметр **DateTime to start MIC value sync** (Дата и время для запуска синхронизации значения MIC) является необязательным. Вы можете задать **частоту** с интервалом в **днях**, **часах**, **минутах** или **секундах**.   

   ![Дата, время и частота](./media/logic-apps-enterprise-integration-b2b-business-continuity/as2messageid3.png)

5. Выберите **New step** (Новый шаг) > **Добавить действие**.  

   ![Выбор действий "Новый шаг" и "Добавить действие"](./media/logic-apps-enterprise-integration-b2b-business-continuity/as2messageid4.png)

6. Выполните поиск **AS2** и выберите **AS2 - Add or update MIC contents** (AS2 — Добавление или обновление содержимого MIC).  

   ![Добавление или обновление MIC](./media/logic-apps-enterprise-integration-b2b-business-continuity/as2messageid5.png)

7. Чтобы подключить действие к дополнительной учетной записи интеграции, выберите **изменить подключение**  >  **Добавить новое подключение** , чтобы получить список доступных учетных записей интеграции. Введите имя для подключения, выберите из списка свою *учетную запись интеграции для дополнительного региона*, а затем выберите **Создать**.

   ![Имя учетной записи интеграции для дополнительного региона](./media/logic-apps-enterprise-integration-b2b-business-continuity/as2messageid6.png)

8. Переключитесь на необработанные входные данные, щелкнув значок в правом верхнем углу.

   ![Переключение на необработанные входные данные](./media/logic-apps-enterprise-integration-b2b-business-continuity/as2rawinputs.png)

9. Выберите "Текст" с помощью средства выбора динамического содержимого и сохраните приложение логики.   

   ![Динамическое содержимое](./media/logic-apps-enterprise-integration-b2b-business-continuity/as2messageid7.png)

   В зависимости от интервала времени триггер выполняет опрос таблицы для основного региона и извлекает новые записи, а действие обновляет сведения о записях в учетной записи интеграции дополнительного региона. 
   Если эти сведения не обновляются, состояние триггера отображается как **Пропущено**.  

   ![Таблица для основного региона](./media/logic-apps-enterprise-integration-b2b-business-continuity/as2messageid8.png)

В зависимости от интервала времени дополнительное состояние о среде выполнения реплицируется из основного региона в дополнительный. Во время аварийного события, когда основной регион является недоступным, перенаправьте трафик к дополнительному региону для обеспечения непрерывности бизнес-процессов. 

## <a name="next-steps"></a>Дальнейшие действия

[Мониторинг сообщений B2B с помощью журналов Azure Monitor](../logic-apps/monitor-b2b-messages-log-analytics.md)
