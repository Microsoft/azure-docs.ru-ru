---
title: Пакетная обработка сообщений EDI как группы
description: Отправка и получение сообщений EDI в виде пакетов, групп или коллекций с помощью пакетной обработки в Azure Logic Apps
services: logic-apps
author: divyaswarnkar
ms.author: divswa
ms.reviewer: estfan, logicappspm
ms.topic: article
ms.date: 08/19/2018
ms.openlocfilehash: 6fc0833f70e3e9cd98100f193b52e5a1bfa4d651
ms.sourcegitcommit: 910a1a38711966cb171050db245fc3b22abc8c5f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "96000408"
---
# <a name="exchange-edi-messages-as-batches-or-groups-between-trading-partners-in-azure-logic-apps"></a>Обмен сообщениями EDI как пакетами или группами между торговыми партнерами в Azure Logic Apps

В сценариях «бизнес-бизнес» (B2B) партнеры часто обмениваются сообщениями в группах или *пакетах*. При создании решения пакетной обработки с помощью Logic Apps можно отправлять сообщения торговым партнерам и обрабатывать эти сообщения в пакетах. В этой статье показано, как выполнять пакетную обработку сообщений EDI, используя X12 в качестве примера, путем создания приложения логики для отправки пакета и приложения логики для получения пакета. 

Пакетная обработка сообщений X12 работает как пакетная обработка других сообщений. Вы используете триггер "Пакет", который собирает сообщения в пакет, и действие "Пакет", которое отправляет сообщения в пакет. Кроме того, пакетная обработка X12 включает в себя шаг кодирования X12, прежде чем сообщения будут отправлены торговому партнеру или по другому назначению. Дополнительные сведения о триггере и действии "Пакет" см. в статье [Отправка, получение и пакетная обработка сообщений в приложениях логики](../logic-apps/logic-apps-batch-process-send-receive-messages.md).

В результате работы с этой статьей вы получите решение пакетной обработки. Для этого вы создадите два приложения логики в одной подписке и одном регионе Azure, следуя этому порядку:

* Приложение логики для [получения пакета](#receiver), которое принимает и собирает сообщения в пакет, пока не будет выполнено определенное условие для отправки и обработки этих сообщений. В этом сценарии приложение логики для получения пакета кодирует сообщения в пакете с использованием указанного соглашения X12 или идентификаторов партнера.

  Сначала создайте получатель пакетов, чтобы потом при создании отправителя пакетов можно было выбрать назначение для пакетов.

* Приложение логики для [отправки пакета](#sender), которое отправляет сообщения в ранее созданное приложение логики для получения пакета. 

Убедитесь, что для получателя и отправителя пакетов используется одна и та же подписка Azure *и* регион Azure. В противном случае при создании отправителя пакетов вы не сможете выбрать получателя пакетов, так как они не видны друг другу.

## <a name="prerequisites"></a>Предварительные условия

Для выполнения этого примера необходимы следующие компоненты:

* Подписка Azure. Если у вас нет подписки, вы можете [начать с бесплатной учетной записи Azure](https://azure.microsoft.com/free/). Или [зарегистрируйтесь для получения подписки с оплатой по мере использования](https://azure.microsoft.com/pricing/purchase-options/).

* Базовые знания [создания приложений логики](../logic-apps/quickstart-create-first-logic-app-workflow.md).

* Имеющаяся [учетная запись интеграции](../logic-apps/logic-apps-enterprise-integration-create-integration-account.md), связанная с подпиской Azure и приложениями логики.

* По крайней мере два имеющихся [партнера](../logic-apps/logic-apps-enterprise-integration-partners.md) в учетной записи интеграции. Каждый партнер должен использовать квалификатор X12 (код SCAC) в свойствах партнера в качестве бизнес-идентификатора.

* Имеющееся [соглашение X12](../logic-apps/logic-apps-enterprise-integration-x12.md) в учетной записи интеграции.

* Чтобы использовать Visual Studio, а не портал Azure, [настройте Visual Studio для работы с приложениями логики](../logic-apps/quickstart-create-logic-apps-with-visual-studio.md).

<a name="receiver"></a>

## <a name="create-x12-batch-receiver"></a>Создание приложения логики для получения пакета X12

Прежде чем вы сможете отправлять сообщения в пакет, такой пакет должен существовать как назначение для отправки. Поэтому сначала необходимо создать приложение логики для получения пакета, которое запускает триггер **Пакет**. Тогда при создании приложения логики для отправки пакетов вы сможете выбрать это приложение логики для получения пакетов. Получатель пакетов продолжает собирать сообщения до тех пор, пока не будут выполнены определенные условия для отправки и обработки этих сообщений. Получателям пакетов не требуются сведения об отправителях пакетов, но отправители должны знать параметры назначения для отправки сообщений. 

Для этого приложения логики для получения пакета укажите пакетный режим, имя пакета, условия его отправки, соглашение X12 и другие параметры. 

1. На [портале Azure](https://portal.azure.com) или в Visual Studio создайте приложение логики с именем BatchX12Messages.

2. [Привяжите приложение логики к учетной записи интеграции](../logic-apps/logic-apps-enterprise-integration-create-integration-account.md#link-account).

3. В конструкторе Logic Apps добавьте триггер **Пакет**, который запускает рабочий процесс приложения логики. В поле поиска введите слово "пакет" в качестве фильтра. Выберите триггер **Пакетные сообщения**.

   ![Добавление триггера "Пакет"](./media/logic-apps-scenario-EDI-send-batch-messages/add-batch-receiver-trigger.png)

4. Задайте свойства приложения логики для получения пакетов: 

   | Свойство. | Значение | Примечания | 
   |----------|-------|-------|
   | **Пакетный режим** | Встроенный |  |  
   | **Имя пакета** | TestBatch | Доступно только в пакетном режиме **Встроенный** | 
   | **Условия отправки** | На основе количества сообщений, по расписанию | Доступно только в пакетном режиме **Встроенный** | 
   | **Количество сообщений** | 10 | Доступно только с условием отправки **На основе количества сообщений** | 
   | **Интервал** | 10 | Доступно только с условием отправки **По расписанию** | 
   | **Частота** | minute | Доступно только с условием отправки **По расписанию** | 
   ||| 

   ![Ввод сведений для триггера "Пакет"](./media/logic-apps-scenario-EDI-send-batch-messages/batch-receiver-release-criteria.png)

   > [!NOTE]
   > В этом примере раздел для пакета не настраивается, поэтому для каждого пакета используется один и тот же ключ раздела. Дополнительные сведения о разделах см. в разделе [Создание приложения логики, которое отправляет сообщения в пакет](../logic-apps/logic-apps-batch-process-send-receive-messages.md#batch-sender).

5. Теперь добавьте действие, которое кодирует каждый пакет: 

   1. В области триггера "Пакет" щелкните **Новый шаг**.

   2. В поле поиска введите "пакет X12" в качестве фильтра и выберите это действие (любая версия): **Пакетная кодировка <*версия*> - X12**. 

      ![Выбор действия пакетного кодирования X12](./media/logic-apps-scenario-EDI-send-batch-messages/add-batch-encode-action.png)

   3. Если вы ранее не подключились к учетной записи интеграции, создайте подключение сейчас. Введите имя для подключения, выберите учетную запись интеграции, а затем щелкните **Создать**.

      ![Создание подключения между кодировщиком пакетной службы и учетной записью интеграции](./media/logic-apps-scenario-EDI-send-batch-messages/batch-encoder-connect-integration-account.png)

   4. Задайте эти свойства для действия кодировщика пакетной службы:

      | Свойство. | Описание |
      |----------|-------------|
      | **Имя соглашения X12** | Откройте список и выберите ваше имеющееся соглашение. <p>Если список пуст, [свяжите свое приложение логики с учетной записью интеграции](../logic-apps/logic-apps-enterprise-integration-create-integration-account.md#link-account), которая содержит требуемое соглашение. | 
      | **Имя пакета** | Щелкните в этом поле, а после того как отобразится список динамического содержимого, выберите маркер **Имя пакета**. | 
      | **Имя раздела** | Щелкните в этом поле, а после того как отобразится список динамического содержимого, выберите маркер **Имя раздела**. | 
      | **Элементы** | Закройте поле сведений об элементе, а затем щелкните в этом поле. После того как отобразится список динамического содержимого, выберите маркер **Пакетные элементы**. | 
      ||| 

      ![Сведения о действии пакетного кодирования](./media/logic-apps-scenario-EDI-send-batch-messages/batch-encode-action-details.png)

      Для поля **Элементы**:

      ![Элементы действия пакетного кодирования](./media/logic-apps-scenario-EDI-send-batch-messages/batch-encode-action-items.png)

6. Сохраните приложение логики 

7. Если вы используете Visual Studio, [разверните приложение логики для получения пакетов в Azure](../logic-apps/quickstart-create-logic-apps-with-visual-studio.md#deploy-logic-app-to-azure). В противном случае вы не сможете выбрать этот получатель пакетов при создании отправителя пакетов.

### <a name="test-your-logic-app"></a>Тестирование приложения логики

Чтобы убедиться, что ваше приложение логики для получения пакета работает должным образом, можно добавить действие HTTP для тестирования и отправить пакетированное сообщение в [службу RequestBin](https://requestbin.com/). 

1. В области действия кодирования X12 выберите **Новый шаг**. 

2. В поле поиска введите "HTTP" в качестве фильтра. Выберите действие **HTTP — HTTP**.
    
   ![Выбор действия HTTP](./media/logic-apps-scenario-EDI-send-batch-messages/batch-receiver-add-http-action.png)

3. Задайте свойства действия HTTP:

   | Свойство. | Описание | 
   |----------|-------------|
   | **Метод** | Выберите **POST** в списке. | 
   | **URI** | Создайте универсальный код ресурса (URI) с помощью службы RequestBin и введите полученный URI в это поле. | 
   | **Текст** | Щелкните в этом поле, а после открытия списка динамического содержимого выберите маркер **Текст**, который отображается в разделе **Пакетная кодировка по имени соглашения**. <p>Если маркер **Текст** не отображается, то щелкните **Показать больше** рядом с пунктом **Пакетная кодировка по имени соглашения**. | 
   ||| 

   ![Ввод сведений о действии HTTP](./media/logic-apps-scenario-EDI-send-batch-messages/batch-receiver-add-http-action-details.png)

4. Сохраните приложение логики 

   Ваше приложение логики для получения пакета выглядит следующим образом: 

   ![Сохранение приложения логики для получения пакета](./media/logic-apps-scenario-EDI-send-batch-messages/batch-receiver-finished.png)

<a name="sender"></a>

## <a name="create-x12-batch-sender"></a>Создание приложения логики для отправки пакета X12

Теперь создайте одно или несколько приложений логики, которые отправляют сообщения в приложение логики для получения пакета. В каждом приложении логики для отправки пакета укажите приложение логики для получения пакета, имя пакета, содержимое сообщения и другие параметры. При необходимости можно указать уникальный ключ раздела, чтобы разделить пакет на подмножества для сбора сообщений с помощью этого ключа. 

* Убедитесь, что вы уже [создали получатель пакетов](#receiver), чтобы при создании отправителя пакетов можно было выбрать имеющийся получатель пакетов в качестве назначения. Получателям пакетов не требуются сведения об отправителях пакетов, но отправители должны знать параметры назначения для отправки сообщений. 

* Убедитесь, что для получателя и отправителя пакетов используется одна и та же подписка Azure *и* один регион Azure. В противном случае при создании отправителя пакетов вы не сможете выбрать получателя пакетов, так как они не видны друг другу.

1. Создайте второе приложение логики с именем SendX12MessagesToBatch. 

2. В поле поиска введите фильтр "когда HTTP-запрос". Выберите триггер **При получении HTTP-запроса**. 
   
   ![Добавление триггера "Запрос"](./media/logic-apps-scenario-EDI-send-batch-messages/add-request-trigger-sender.png)

3. Добавьте действие для отправки сообщений в пакет.

   1. В области действия HTTP-запроса выберите **Новый шаг**.

   2. В поле поиска введите слово "пакет" в качестве фильтра. 
   Выберите список **Действия**, а затем выберите это действие: **Выберите рабочий процесс Logic Apps с триггером пакета — Отправить сообщения в пакет**.

      ![Выбор действия "Выберите рабочий процесс Logic Apps с триггером пакета"](./media/logic-apps-scenario-EDI-send-batch-messages/batch-sender-select-batch-trigger.png)

   3. Теперь выберите приложение логики BatchX12Messages, которое вы создали ранее.

      ![Выбор приложения логики для "получения пакета"](./media/logic-apps-scenario-EDI-send-batch-messages/batch-sender-select-batch-receiver.png)

   4. Выберите действие: **Batch_messages (Пакетировать сообщения) — <*получатель_пакетов*>**.

      ![Выбор действия "Batch_messages" (Пакетировать сообщения)](./media/logic-apps-scenario-EDI-send-batch-messages/batch-sender-select-batch-messages-action.png)

4. Задайте свойства приложения логики для отправки пакета.

   | Свойство. | Описание | 
   |----------|-------------| 
   | **Имя пакета** | Имя пакета, определяемое принимающим приложением логики. В нашем примере это TestBatch. <p>**Важно**! Имя пакета проверяется во время выполнения. Оно должно совпадать с именем, указанным в принимающем приложении логики. Изменение имени пакета приводит к сбою в работе приложения логики для отправки пакета. | 
   | **Содержимое сообщения** | Содержимое сообщения, которое необходимо отправить. В этом примере для него используется маркер **Текст**. | 
   ||| 
   
   ![Настройка свойств пакета](./media/logic-apps-scenario-EDI-send-batch-messages/batch-sender-set-batch-properties.png)

5. Сохраните приложение логики 

   Ваше приложение логики для отправки пакета выглядит следующим образом:

   ![Сохранение приложения логики для отправки пакета](./media/logic-apps-scenario-EDI-send-batch-messages/batch-sender-finished.png)

## <a name="test-your-logic-apps"></a>Тестирование приложений логики

Чтобы проверить решение пакетной обработки, опубликуйте сообщения X12 в приложении логики для отправки пакета из приложения [Postman](https://www.getpostman.com/postman) или аналогичного инструмента. Через некоторое время вы начнете получать сообщения X12 в службе RequestBin — каждые 10 минут или в виде пакета из 10 элементов. Все они должны иметь одинаковый ключ раздела.

## <a name="next-steps"></a>Дальнейшие действия

* [Пакетная обработка сообщений](../logic-apps/logic-apps-batch-process-send-receive-messages.md) 
