---
title: Создание рабочих процессов Logic Apps Preview в Visual Studio Code
description: Создавайте и запускайте рабочие процессы для сценариев автоматизации и интеграции в Visual Studio Code с помощью расширения Azure Logic Apps (Предварительная версия).
services: logic-apps
ms.suite: integration
ms.reviewer: estfan, logicappspm, az-logic-apps-dev
ms.topic: conceptual
ms.date: 12/07/2020
ms.openlocfilehash: be8d00d795c19399d494db21578e9a7ba8dd9711
ms.sourcegitcommit: 2aa52d30e7b733616d6d92633436e499fbe8b069
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/06/2021
ms.locfileid: "97934022"
---
# <a name="create-stateful-and-stateless-workflows-in-visual-studio-code-with-the-azure-logic-apps-preview-extension"></a>Создание рабочих процессов с отслеживанием состояния и без отслеживания состояния в Visual Studio Code с помощью расширения Azure Logic Apps (Предварительная версия)

> [!IMPORTANT]
> Эта возможность предоставляется в общедоступной предварительной версии без соглашения об уровне обслуживания. Не рекомендуем использовать ее в рабочей среде. Некоторые функции могут не поддерживаться или их возможности могут быть ограничены. Дополнительные сведения см. в статье [Дополнительные условия использования предварительных выпусков Microsoft Azure](https://azure.microsoft.com/support/legal/preview-supplemental-terms/).

[Предварительная версия Azure Logic Apps](logic-apps-overview-preview.md)позволяет создавать решения для автоматизации и интеграции в приложениях, данных, облачных службах и системах, создавая и запуская приложения логики, которые включают [рабочие процессы с *отслеживанием состояния* и *без отслеживания состояния*](logic-apps-overview-preview.md#stateful-stateless) в Visual Studio Code с помощью расширения Azure Logic Apps (Предварительная версия). С помощью этого нового типа приложения логики можно создать несколько рабочих процессов, которые были включены в переработанную среду выполнения Azure Logic Apps Preview, которая обеспечивает переносимость, лучшую производительность и гибкость при развертывании и запуске в различных средах размещения, а не только в Azure, но также в контейнерах DOCKER. Дополнительные сведения о новом типе приложения логики см. в разделе [обзор Azure Logic Apps предварительной версии](logic-apps-overview-preview.md).

![Снимок экрана, на котором показано Visual Studio Code, проект приложения логики и рабочий процесс.](./media/create-stateful-stateless-workflows-visual-studio-code/visual-studio-code-logic-apps-overview.png)

В Visual Studio Code можно начать с создания проекта, который *локально* создает и выполняет рабочие процессы приложения логики в среде разработки с помощью расширения Azure Logic Apps (Предварительная версия). Хотя вы также можете начать с [создания нового ресурса **приложения логики (Предварительная версия)** в портал Azure](create-stateful-stateless-workflows-azure-portal.md), оба подхода предоставляют возможность развертывания и запуска приложения логики в тех же видах сред размещения.

В то же время можно создать исходный тип приложения логики. Хотя опыт разработки в Visual Studio Code отличается от исходного и нового типов приложений логики, подписка Azure может включать оба типа. Вы можете просматривать все развернутые приложения логики в подписке Azure и получать к ним доступ, но приложения организованы в собственные категории и разделы.

В этой статье показано, как создать приложение логики и рабочий процесс в Visual Studio Code с помощью расширения Azure Logic Apps (Предварительная версия) и выполнения следующих задач высокого уровня:

* Создайте проект для приложения логики и рабочего процесса.

* Добавьте триггер и действие.

* Запуск, тестирование, отладка и анализ журнала выполнения в локальной среде.

* Выполните развертывание в Azure, в том числе при необходимости включив Application Insights.

* Управляйте развернутым приложением логики в Visual Studio Code и портал Azure.

* Включите журнал выполнения для рабочих процессов без отслеживания состояния.

* Включите или откройте Application Insights после развертывания.

* Разверните в контейнер DOCKER, который можно запускать где угодно.

> [!NOTE]
> Сведения о текущих известных проблемах см. на [странице Logic Apps общедоступная Предварительная версия известных проблем в GitHub](https://github.com/Azure/logicapps/blob/master/articles/logic-apps-public-preview-known-issues.md).

## <a name="prerequisites"></a>Предварительные требования

### <a name="access-and-connectivity"></a>Доступ и подключение

* Доступ к Интернету для загрузки требований, подключения Visual Studio Code к учетной записи Azure, а также для публикации из Visual Studio Code в Azure, контейнера DOCKER или другой среды.

* Учетная запись и подписка Azure. Если у вас нет ее, вы можете [зарегистрироваться для получения бесплатной учетной записи Azure](https://azure.microsoft.com/free/?WT.mc_id=A261C142F).

* Чтобы создать тот же пример приложения логики в этой статье, вам потребуется учетная запись электронной почты Office 365 Outlook, которая использует рабочую или учебную учетную запись Майкрософт для входа.

  Если вы решили использовать другой [соединитель электронной почты, поддерживаемый Azure Logic Apps](/connectors/), например Outlook.com или [Gmail](../connectors/connectors-google-data-security-privacy-policy.md), вы по-прежнему можете следовать этому примеру, и общие действия одинаковы, но пользовательский интерфейс и параметры могут отличаться. Например, если вы используете соединитель Outlook.com, используйте личную учетная запись Майкрософт вместо входа.

<a name="storage-requirements"></a>

### <a name="storage-requirements"></a>Требования к системе хранения данных

#### <a name="windows-and-linux"></a>Windows и Linux

1. Скачайте и установите [эмулятор службы хранилища Azure 5,10](https://go.microsoft.com/fwlink/p/?linkid=717179).

1. Для запуска эмулятора требуется локальная установка базы данных SQL, например бесплатная [SQL Server 2019 Express Edition](https://go.microsoft.com/fwlink/p/?linkid=866658). Дополнительные сведения см. [в статье Использование эмулятора хранения Azure для разработки и тестирования](../storage/common/storage-use-emulator.md).

   > [!IMPORTANT]
   > Перед открытием конструктора для создания рабочего процесса убедитесь, что вы запускаете эмулятор. В противном случае вы получите сообщение о том, что `Workflow design time could not be started` .
   >
   > ![Снимок экрана, на котором отображается эмулятор службы хранилища Azure.](./media/create-stateful-stateless-workflows-visual-studio-code/start-storage-emulator.png)

#### <a name="macos"></a>macOS

1. Войдите в [портал Azure](https://portal.azure.com)и [Создайте учетную запись хранения Azure](../storage/common/storage-account-create.md?tabs=azure-portal), которая является [необходимым условием для функций Azure](../azure-functions/storage-considerations.md).

1. [Найдите и скопируйте строку подключения учетной записи хранения](../storage/common/storage-account-keys-manage.md?tabs=azure-portal#view-account-access-keys), например:

   `DefaultEndpointsProtocol=https;AccountName=fabrikamstorageacct;AccountKey=<access-key>;EndpointSuffix=core.windows.net`

   ![Снимок экрана, на котором показано портал Azure с ключами доступа к учетной записи хранения и скопированной строкой подключения.](./media/create-stateful-stateless-workflows-visual-studio-code/find-storage-account-connection-string.png)

1. Сохраните строку в безопасном месте, чтобы позднее можно было добавить строку в **local.settings.js** файлов проекта, используемых для создания приложения логики в Visual Studio Code.

При последующем попытке открыть конструктор для рабочего процесса в приложении логики вы получите сообщение о том, что `Workflow design time could not be started` . После появления этого сообщения необходимо добавить строку подключения учетной записи хранения к двум **local.settings.js** файлов в проекте, а затем снова открыть конструктор.

### <a name="tools"></a>Инструменты

* [Visual Studio Code 1.30.1 (2019 января) или более поздней версии](https://code.visualstudio.com/). Кроме того, скачайте и установите эти дополнительные средства для Visual Studio Code, если у вас их еще нет:

  * [Расширение учетной записи Azure](https://marketplace.visualstudio.com/items?itemName=ms-vscode.azure-account), предоставляющее единую общую фильтрацию входа и подписки Azure для всех других расширений azure в Visual Studio Code.

  * [C# для расширения Visual Studio Code](https://marketplace.visualstudio.com/items?itemName=ms-vscode.csharp), которое позволяет запускать приложение логики с помощью функции F5.

  * [Azure functions Core Tools 3.0.2931 или более поздней версии](https://github.com/Azure/azure-functions-core-tools/releases/tag/3.0.2931) с помощью установщика Microsoft (MSI).

    Эти средства включают в себя версию той же среды выполнения, которая выполняет функции среды выполнения функций Azure, которую модуль предварительной версии использует в Visual Studio Code.

    > [!IMPORTANT]
    > Если у вас установлена более ранняя версия, то сначала удалите эту версию или убедитесь, что переменная среды PATH указывает на версию, которую вы загрузили и установили.

  * [Расширение Azure Logic Apps (Предварительная версия) для Visual Studio Code](https://go.microsoft.com/fwlink/p/?linkid=2143167). Это расширение предоставляет возможность создавать приложения логики, в которых можно создавать рабочие процессы с отслеживанием состояния и без отслеживания состояния, которые локально запускаются в Visual Studio Code, а затем развертывать эти приложения логики непосредственно в Azure или контейнерах DOCKER.

    В настоящее время в Visual Studio Code можно установить как исходное расширение Azure Logic Apps, так и расширение общедоступного предварительного просмотра. Несмотря на то, что в процессе разработки между расширениями разные способы, ваша подписка Azure может включать как типы приложений логики, созданные с помощью расширений. Visual Studio Code показывает все развернутые приложения логики в подписке Azure, но упорядочивает их в разные разделы по именам расширений, **Logic Apps** и **Azure Logic Apps (Предварительная версия)**.

    > [!IMPORTANT]
    > Если вы создали приложения логики с предыдущим расширением для закрытой предварительной версии, эти приложения логики не будут работать с открытым предварительным расширением. Однако вы можете перенести эти приложения логики после удаления расширения закрытой предварительной версии, удалить связанные файлы и установить расширение для общедоступной предварительной версии. Затем создайте новый проект в Visual Studio Code и скопируйте ранее созданный файл **Workflow. Definition** приложения логики в новый проект. Дополнительные сведения см. в разделе [Миграция из расширения закрытой предварительной версии](#migrate-private-preview).

    Чтобы установить расширение **Azure Logic Apps (Предварительная версия)** , выполните следующие действия.

    1. В Visual Studio Code на панели инструментов слева выберите **расширения**.

    1. В поле поиска расширений введите `azure logic apps preview` . В списке результатов выберите **Azure Logic Apps (Предварительная версия)** **>** **установить**.

       После завершения установки расширение предварительной версии появится в списке **расширения: установленные** .

       ![Снимок экрана, на котором показан список установленных расширений Visual Studio Code с подчеркнутым расширением "Azure Logic Apps (Предварительная версия)".](./media/create-stateful-stateless-workflows-visual-studio-code/azure-logic-apps-extension-installed.png)

* Для локального запуска триггеров и действий на основе веб-перехватчика, например [встроенного триггера веб-перехватчика HTTP](../connectors/connectors-native-webhook.md), в Visual Studio Code необходимо [настроить переадресацию для URL-адреса обратного вызова](#webhook-setup).

* Чтобы протестировать пример приложения логики, созданного в этой статье, необходимо средство, которое может отправить вызовы триггера запроса, что является первым шагом в примере приложения логики. Если у вас нет такого средства, вы можете скачать, установить и использовать [POST](https://www.postman.com/downloads/).

* При создании приложения логики и развертывании с параметрами, поддерживающими использование [Application Insights](../azure-monitor/app/app-insights-overview.md), при необходимости можно включить ведение журнала диагностики и трассировку для приложения логики. Это можно сделать при развертывании приложения логики из Visual Studio Code или после развертывания. Необходимо иметь Application Insights экземпляр, но этот ресурс можно создать [заранее](../azure-monitor/app/create-workspace-resource.md), при развертывании приложения логики или после развертывания.

<a name="migrate-private-preview"></a>

## <a name="migrate-from-private-preview-extension"></a>Переход с закрытой предварительной версии расширения

Любые приложения логики, созданные с помощью расширения **Azure Logic Apps (закрытая Предварительная версия)** , не будут работать с расширением публикпревиев. Однако вы можете перенести эти приложения логики в новый проект Visual Studio Code, выполнив следующие действия.

1. Удалите расширение для закрытой предварительной версии.

1. Удалите связанные пакеты расширений и папки пакетов NuGet в следующих расположениях:

   * Папка **Microsoft. Azure. functions. екстенсионбундле. Workflows.** , которая содержит предыдущие пакеты расширений и расположена по одному из следующих путей:

     * `C:\Users\{userName}\AppData\Local\Temp\Functions\ExtensionBundles`

     * `C:\Users\{userName}.azure-functions-core-tools\Functions\ExtensionBundles`

   * Папка **Microsoft. Azure. Workflows. веб-задания. extension** , которая является кэшем [NuGet](/nuget/what-is-nuget) для расширения закрытой предварительной версии и находится по этому пути:

     `C:\Users\{userName}\.nuget\packages`

1. Установите расширение **Azure Logic Apps (Предварительная версия)** .

1. Создайте новый проект в Visual Studio Code.

1. Скопируйте ранее созданный файл **Workflow. Definition** приложения логики в новый проект.

<a name="set-up"></a>

## <a name="set-up-visual-studio-code"></a>Настройка Visual Studio Code

1. Чтобы убедиться, что все расширения установлены правильно, перезагрузите или перезапустите Visual Studio Code.

1. Включите или подтвердите, что Visual Studio Code автоматически найдет и установит обновления расширений, чтобы расширение Публикпревиев получит последние обновления. В противном случае необходимо вручную удалить устаревшую версию и установить последнюю версию.

   Для проверки сделайте следующее:

   1. В меню **файл** выберите  **>** **настройки параметры**.

   1. На вкладке **пользователь** перейдите к разделу **компоненты** **>** **расширения**.

   1. Убедитесь, что выбраны **Автоматические проверки обновлений** и **Автоматическое обновление** .

1. Включите или подтвердите, что параметры расширения имеют правильный набор параметров:

   * **Azure Logic Apps v2: режим панели**
   * **Azure Logic Apps v2: среда выполнения проекта**

   1. В меню **файл** выберите  **>** **настройки параметры**.

   1. На вкладке **пользователь** выберите **>** **расширения** **>** **Azure Logic Apps (Предварительная версия)**.

   1. Подтвердите следующие параметры расширения:

      * В разделе **Azure Logic Apps v2: режим панели** убедитесь, что выбран **режим включить панель** .

      * В разделе **Azure Logic Apps v2: проект Runtime** убедитесь, что для версии задано значение **~ 3**.

        > [!IMPORTANT]
        > Для использования [встроенных действий](../logic-apps/logic-apps-add-run-inline-code.md), которые в настоящее время недоступны для MacOS и Linux, для параметра **времени выполнения проекта** требуется версия 3.

      ![Снимок экрана, на котором показаны параметры Visual Studio Code для расширения "Azure Logic Apps (Предварительная версия)".](./media/create-stateful-stateless-workflows-visual-studio-code/azure-logic-apps-preview-settings.png)

<a name="connect-azure-account"></a>

## <a name="connect-to-your-azure-account"></a>Подключение к учетной записи Azure

1. На панели действий Visual Studio Code щелкните значок Azure.

   ![Снимок экрана, на котором показана Visual Studio Code панель действий и выбранный значок Azure.](./media/create-stateful-stateless-workflows-visual-studio-code/visual-studio-code-azure-icon.png)

1. В области Azure в разделе **Azure: Logic Apps (Предварительная версия)** выберите **войти в Azure**. Когда появится страница Проверка подлинности Visual Studio Code, войдите с помощью учетной записи Azure.

   ![Снимок экрана, показывающий панель Azure и выбранную ссылку для входа в Azure.](./media/create-stateful-stateless-workflows-visual-studio-code/sign-in-azure-subscription.png)

   После входа на панели Azure отобразятся подписки в учетной записи Azure. Если у вас также есть общедоступное расширение, можно найти все приложения логики, созданные с помощью этого расширения, в разделе **Logic Apps** , а не **Logic Apps (Предварительная версия)** .
   
   Если ожидаемые подписки не отображаются или вы хотите, чтобы на панели отображались только определенные подписки, выполните следующие действия.

   1. В списке подписки переместите указатель рядом с первой подпиской, пока не появится кнопка **Выбор подписок** (значок фильтра). Выберите значок фильтра.

      ![Снимок экрана, показывающий панель Azure и значок выбранного фильтра.](./media/create-stateful-stateless-workflows-visual-studio-code/filter-subscription-list.png)

      Или в строке состояния Visual Studio Code выберите свою учетную запись Azure. 

   1. Когда появится список других подписок, выберите нужные подписки и убедитесь, что выбрано значение **ОК**.

<a name="create-project"></a>

## <a name="create-a-local-project"></a>Создание локального проекта

Перед созданием приложения логики создайте локальный проект, чтобы можно было управлять приложением логики и развертывать его из Visual Studio Code. Базовый проект аналогичен проекту функций Azure, также известному как проект приложения-функции. Однако эти типы проектов отделены друг от друга, поэтому приложения логики и приложения функций не могут существовать в одном проекте.

1. На компьютере создайте *пустую* локальную папку для проекта, которая позже будет создана в Visual Studio Code.

1. В Visual Studio Code закройте все открытые папки.

1. В области Azure рядом с **Azure: Logic Apps (Предварительная версия)** выберите **создать новый проект** (значок, показывающий папку и молнию).

   ![Снимок экрана, на котором показана панель инструментов панели Azure с выбранным параметром "создать новый проект".](./media/create-stateful-stateless-workflows-visual-studio-code/create-new-project-folder.png)

1. Если брандмауэр защитника Windows предлагает предоставить доступ к сети для `Code.exe` , то есть Visual Studio Code, а для — `func.exe` Azure functions Core Tools, выберите **частные сети, например домашняя или Рабочая сеть** **>** **Разрешить доступ**.

1. Перейдите в папку, в которой была создана папка проекта, выберите эту папку и продолжайте работу.

   ![Снимок экрана, на котором отображается диалоговое окно "Выбор папки" с вновь созданной папкой проекта и выбранной кнопкой "выбрать".](./media/create-stateful-stateless-workflows-visual-studio-code/select-project-folder.png)

1. В появившемся списке шаблонов выберите рабочий процесс с **отслеживанием состояния** или **Рабочий процесс без отслеживания состояния**. В этом примере выбирается **Рабочий процесс с отслеживанием состояния**.

   ![Снимок экрана, показывающий список шаблонов рабочих процессов с выбранным параметром "Рабочий процесс с отслеживанием состояния".](./media/create-stateful-stateless-workflows-visual-studio-code/select-stateful-stateless-workflow.png)

1. Укажите имя рабочего процесса и нажмите клавишу ВВОД. В этом примере используется `Fabrikam-Stateful-Workflow` в качестве имени.

   ![Снимок экрана, показывающий, что в качестве имени рабочего процесса отображается поле "создать новый рабочий процесс с отслеживанием состояния (3/3)" и "Fabrikam-с отслеживанием состояния рабочего процесса".](./media/create-stateful-stateless-workflows-visual-studio-code/name-your-workflow.png)

   Visual Studio Code завершит создание проекта и откроет **workflow.js** файл для рабочего процесса.

1. На панели инструментов Visual Studio откройте панель Обозреватель, если она еще не открыта.

   На панели обозревателя отображается проект, который теперь включает автоматически создаваемые файлы проекта. Например, в проекте есть папка, в которой отображается имя рабочего процесса. В этой папке **workflow.js** файл содержит базовое определение JSON рабочего процесса.

   ![Снимок экрана, на котором показана панель обозревателя с папкой проекта, папкой рабочего процесса и файлом "workflow.js".](./media/create-stateful-stateless-workflows-visual-studio-code/local-project-created.png)

<a name="open-workflow-definition-designer"></a>

## <a name="open-the-workflow-definition-file-in-the-designer"></a>Открытие файла определения рабочего процесса в конструкторе

1. Проверьте версии, установленные на компьютере, выполнив следующую команду:

   `..\Users\{yourUserName}\dotnet --list-sdks`

   Если у вас пакет SDK для .NET Core 5. x, эта версия может не позволить открыть базовое определение рабочего процесса приложения логики в конструкторе. Вместо удаления этой версии на корневом уровне проекта создайте **global.jsдля** файла, который ссылается на версию среды выполнения .NET Core 3. x, которая позже, чем 3.1.201, например:

   ```json
   {
      "sdk": {
         "version": "3.1.8",
         "rollForward": "disable"
      }
   }
   ```

   Убедитесь, что вы явно добавили **global.js** в файл на корневом уровне проекта из Visual Studio Code. В противном случае конструктор не откроется.

1. Если вы используете Visual Studio Code в Windows или Linux, убедитесь, что эмулятор хранения Azure работает. Для получения дополнительных сведений ознакомьтесь с [предварительными требованиями](#prerequisites). Если вы используете Visual Studio Code на macOS, перейдите к следующему шагу.

1. Разверните папку проекта для рабочего процесса. Откройте **workflow.jsв** контекстном меню файла и выберите **Открыть в конструкторе**.

   ![Снимок экрана, на котором отображается панель обозревателя и контекстное окно для workflow.jsфайла с выбранным параметром "открыть в конструкторе".](./media/create-stateful-stateless-workflows-visual-studio-code/open-definition-file-in-designer.png)

   Если появится сообщение об ошибке, `Workflow design time could not be started` Проверьте следующие условия.

   * **Windows или Linux**: Убедитесь, что эмулятор хранения Azure работает. В противном случае см. раздел [Устранение неполадок и ошибок](#troubleshooting).

   * **macOS**: попробуйте следующее решение, и в случае неудачи см. статью [Устранение неполадок и ошибок](#troubleshooting).

     1. В проекте откройте **local.settings.js** файлов, которые можно найти в корневой папке проекта и в папке **Workflow-DesignTime** .

        ![Снимок экрана, на котором показаны панель обозревателя и файлы "local.settings.js" в проекте.](./media/create-stateful-stateless-workflows-visual-studio-code/local-settings-json-files.png)

     1. В каждом файле найдите `AzureWebJobsStorage` свойство, например:

        ```json
        {
           "IsEncrypted": false,
           "Values": {
              "AzureWebJobsStorage": "UseDevelopmentStorage=true",
              "FUNCTIONS_WORKER_RUNTIME": "dotnet"
            }
        }
        ```

      1. Замените `AzureWebJobsStorage` значение свойства строкой подключения, сохраненной ранее из учетной записи хранения, например:

         ```json
         {
            "IsEncrypted": false,
            "Values": {
               "AzureWebJobsStorage": "DefaultEndpointsProtocol=https;AccountName=fabrikamstorageacct;AccountKey=<access-key>;EndpointSuffix=core.windows.net",
               "FUNCTIONS_WORKER_RUNTIME": "dotnet"
            }
         }
         ```

      1. Сохраните изменения и попробуйте снова открыть файл **workflow.js** в конструкторе.

1. В списке **включить соединители в Azure** выберите **использовать соединители из Azure**, которые применяются ко всем управляемым соединителям, доступным и развернутым в Azure, а не только к соединителям для служб Azure.

   ![Снимок экрана, на котором отображается панель обозревателя с выбранным флажком "включить соединители в Azure" и "использовать соединители из Azure".](./media/create-stateful-stateless-workflows-visual-studio-code/use-connectors-from-azure.png)

   > [!NOTE]
   > Сейчас рабочие процессы без отслеживания состояния поддерживают только *действия* для [управляемых соединителей](../connectors/apis-list.md#managed-api-connectors), которые развертываются в Azure, а не триггеры. Хотя вы можете включить соединители в Azure для рабочего процесса без отслеживания состояния, конструктор не будет отображать триггеры управляемых соединителей для выбора.

1. В списке **выберите подписку** выберите подписку Azure, которая будет использоваться для проекта приложения логики.

   ![Снимок экрана, на котором отображается панель обозревателя с полем "Выбор подписки" и выбранной подпиской.](./media/create-stateful-stateless-workflows-visual-studio-code/select-azure-subscription.png)

1. В списке группы ресурсов выберите **создать новую группу ресурсов**.

   ![Снимок экрана, на котором отображается панель обозревателя с перечнем групп ресурсов и выбран параметр "создать новую группу ресурсов".](./media/create-stateful-stateless-workflows-visual-studio-code/create-select-resource-group.png)

1. Укажите имя группы ресурсов и нажмите клавишу ВВОД. В этом примере используется `Fabrikam-Workflows-RG`.

   ![Снимок экрана, показывающий область обозревателя и имя группы ресурсов.](./media/create-stateful-stateless-workflows-visual-studio-code/enter-name-for-resource-group.png)

1. В списке расположения найдите и выберите регион Azure, который будет использоваться при создании группы ресурсов и ресурсов. В этом примере используется **Западная Центральная часть США**.

   ![Снимок экрана, на котором показана область обозревателя с списком расположений и выбрано "Западная Центральная часть США".](./media/create-stateful-stateless-workflows-visual-studio-code/select-azure-region.png)

   После выполнения этого шага Visual Studio Code открывает Конструктор рабочих процессов.

   > [!NOTE]
   > Когда Visual Studio Code запускает API-интерфейс времени разработки рабочего процесса, появляется сообщение о том, что запуск может занять несколько секунд. Можно проигнорировать это сообщение или нажать кнопку **ОК**.

   После появления конструктора в конструкторе появится запрос **Выбор операции** , который будет выбран по умолчанию, в котором отображается панель **Добавление действия** .

   ![Снимок экрана, на котором показан конструктор рабочих процессов.](./media/create-stateful-stateless-workflows-visual-studio-code/workflow-app-designer.png)

1. Затем [добавьте триггер и действия](#add-trigger-actions) в рабочий процесс.

<a name="add-trigger-actions"></a>

## <a name="add-a-trigger-and-actions"></a>Добавление триггера и действий

После открытия конструктора в конструкторе появится запрос **Выбор операции** , который будет выбран по умолчанию. Теперь можно приступить к созданию рабочего процесса, добавив триггер и действия.

Рабочий процесс в этом примере использует этот триггер и следующие действия:

* Встроенный [триггер запроса](../connectors/connectors-native-reqres.md) **при получении HTTP-запроса**, который получает входящие вызовы или запросы и создает конечную точку, которую могут вызывать другие службы или приложения логики.

* [Office 365 Outlook](../connectors/connectors-create-api-office365-outlook.md)— **Отправка сообщения электронной почты**.

* Встроенное [действие ответа](../connectors/connectors-native-reqres.md), которое используется для отправки ответа и возврата данных обратно вызывающему объекту.

### <a name="add-the-request-trigger"></a>Добавление триггера "Запрос"

1. Рядом с конструктором в области **Добавление триггера** в поле Поиск **операции выберите** параметр **Встроенная** , чтобы можно было выбрать триггер, который выполняется изначально.

1. В поле поиска **Выбор операции** введите `when a http request` и выберите Встроенный триггер запроса, названный **при получении HTTP-запроса**.

   ![Снимок экрана, на котором показан конструктор рабочих процессов и * * Добавление области триггера * * с выбранным триггером "при получении HTTP-запроса".](./media/create-stateful-stateless-workflows-visual-studio-code/add-request-trigger.png)

   Когда триггер появляется в конструкторе, открывается область сведений триггера, в которой отображаются свойства, параметры и другие действия триггера.

   ![Снимок экрана, на котором показан конструктор рабочих процессов с выбранным триггером "при получении HTTP-запроса" и открытие области сведений о триггерах.](./media/create-stateful-stateless-workflows-visual-studio-code/request-trigger-added-to-designer.png)

   > [!TIP]
   > Если область сведений не отображается, проверяет, выбран ли триггер в конструкторе.

1. Если необходимо удалить элемент из конструктора, [выполните следующие действия для удаления элементов из конструктора](#delete-from-designer).

### <a name="add-the-office-365-outlook-action"></a>Добавление действия Office 365 Outlook

1. В конструкторе в разделе добавленный триггер выберите **новый шаг**.

   В конструкторе появится запрос **Выбор операции** , после чего откроется область **Добавить панель действий** , чтобы можно было выбрать следующее действие.

1. В области **Добавление действия** в поле Поиск **операции** выберите **Azure** , чтобы найти и выбрать действие для управляемого соединителя, развернутого в Azure.

   В этом примере выбирается и используется действие Office 365 Outlook, а также **отправляется сообщение электронной почты (v2)**.

   ![Снимок экрана, на котором показан конструктор рабочих процессов и * * Добавление области действия * * с помощью Office 365 Outlook "отправить электронное письмо".](./media/create-stateful-stateless-workflows-visual-studio-code/add-send-email-action.png)

1. В области Подробности действия выберите **Вход** , чтобы создать подключение к учетной записи электронной почты.

   ![Снимок экрана, на котором показан конструктор рабочих процессов и * * отправка сообщения электронной почты (v2) * * с выбранным параметром "вход".](./media/create-stateful-stateless-workflows-visual-studio-code/send-email-action-sign-in.png)

1. Когда Visual Studio Code запросит согласие на доступ к своей учетной записи электронной почты, нажмите кнопку **Открыть**.

   ![Снимок экрана, на котором показан запрос Visual Studio Code для разрешения доступа.](./media/create-stateful-stateless-workflows-visual-studio-code/visual-studio-code-open-external-website.png)

   > [!TIP]
   > Чтобы предотвратить дальнейшие запросы, выберите **Настроить доверенные домены** , чтобы можно было добавить страницу проверки подлинности в качестве доверенного домена.

1. Следуйте последующим запросам, чтобы войти, разрешить доступ и разрешить возврат в Visual Studio Code.

   > [!NOTE]
   > Если слишком много времени прошло до завершения запросов, время ожидания процесса проверки подлинности истекает и происходит сбой. В этом случае вернитесь в конструктор и повторите попытку входа, чтобы создать подключение.

1. Когда расширение Azure Logic Apps (Предварительная версия) запрашивает согласие на доступ к учетной записи электронной почты, нажмите кнопку **Открыть**. Чтобы разрешить доступ, следуйте указаниям в следующем запросе.

   ![Снимок экрана с запросом расширения предварительного просмотра для разрешения доступа.](./media/create-stateful-stateless-workflows-visual-studio-code/allow-preview-extension-open-uri.png)

   > [!TIP]
   > Чтобы предотвратить дальнейшие запросы, установите флажок **больше не спрашивать для этого расширения**.

   После Visual Studio Code создает подключение, некоторые соединители показывают это сообщение `The connection will be valid for {n} days only` . Это ограничение действует только в течение времени, пока вы разрабатываете приложение логики в Visual Studio Code. После развертывания это ограничение больше не применяется, так как приложение логики может проходить проверку подлинности во время выполнения с помощью автоматически включенного [управляемого удостоверения, назначенного системой](../logic-apps/create-managed-service-identity.md). Это управляемое удостоверение отличается от учетных данных проверки подлинности или строки подключения, используемой при создании соединения. Если отключить назначенное системой управляемое удостоверение, подключения не будут работать во время выполнения.

1. Если в конструкторе не выбрано действие **Отправить сообщение электронной почты** , выберите это действие.

1. В области Подробности действия на вкладке **Параметры** укажите необходимые сведения для действия, например:

   ![Снимок экрана, на котором показан конструктор рабочих процессов с подробными сведениями о действии "отправить электронное письмо Outlook" в Office 365.](./media/create-stateful-stateless-workflows-visual-studio-code/send-email-action-details.png)

   | Свойство | Обязательно | Значение | Описание |
   |----------|----------|-------|-------------|
   | **Чтобы** | Да | <*ваш адрес электронной почты*> | Получатель электронной почты, который может быть адресом электронной почты для целей тестирования. В этом примере используется фиктивное сообщение электронной почты `sophiaowen@fabrikam.com` . |
   | **Тема** | Да | `An email from your example workflow` | тему сообщения; |
   | **Текст** | Да | `Hello from your example workflow!` | Содержимое сообщения электронной почты |
   ||||

   > [!NOTE]
   > Если вы хотите внести любые изменения в области сведений на вкладке **Параметры**, **статический результат** или **выполнить после** , убедитесь, что выбран параметр **Готово** для фиксации этих изменений перед переключением вкладок или изменением фокуса на конструктор. В противном случае Visual Studio Code не сохранит изменения. Дополнительные сведения см. на [странице известных проблем Logic Apps общедоступной предварительной версии в GitHub](https://github.com/Azure/logicapps/blob/master/articles/logic-apps-public-preview-known-issues.md).

1. В конструкторе выберите **сохранить**.

> [!IMPORTANT]
> Для локального запуска рабочего процесса, использующего триггер или действия на основе веб-перехватчика, например [встроенного триггера веб-перехватчика HTTP или действия](../connectors/connectors-native-webhook.md), необходимо включить эту возможность, [настроив переадресацию для URL-адреса обратного вызова](#webhook-setup).

<a name="webhook-setup"></a>

## <a name="enable-locally-running-webhooks"></a>Включить локально выполняемые веб-перехватчики

При использовании триггера или действия на основе веб-перехватчика, например **http-перехватчика**, с приложением логики, запущенным в Azure, среда выполнения Logic Apps подписывается на конечную точку службы путем создания и регистрации URL-адреса обратного вызова с этой конечной точкой. Затем триггер или действие ожидают, пока конечная точка службы вызовет URL-адрес. Однако при работе в Visual Studio Code созданный URL-адрес обратного вызова начинается с `http://localhost:7071/...` . Этот URL-адрес предназначен для сервера localhost, который является частным, поэтому конечная точка службы не может вызвать этот URL-адрес.

Для локального запуска триггеров и действий на основе веб-перехватчика в Visual Studio Code необходимо настроить общедоступный URL-адрес, который обеспечивает доступ к серверу localhost, и безопасно перенаправлять вызовы из конечной точки службы в URL-адрес обратного вызова перехватчика. Вы можете использовать службу пересылки и средство, например [**ngrok**](https://ngrok.com/), которое открывает туннель HTTP к порту localhost, или вы можете использовать собственное средство.

#### <a name="set-up-call-forwarding-using-ngrok"></a>Настройка переадресации вызовов с помощью **ngrok**

1. [Зарегистрируйте учетную запись **ngrok**](https://dashboard.ngrok.com/signup) , если у вас ее нет. В противном случае [Войдите в свою учетную запись](https://dashboard.ngrok.com/login).

1. Получите личный маркер проверки подлинности, который ваш клиент **ngrok** должен подключить и проверить подлинность доступа к вашей учетной записи.

   1. Чтобы найти [страницу маркера проверки подлинности](https://dashboard.ngrok.com/auth/your-authtoken), в меню панели мониторинга учетной записи разверните узел **Проверка подлинности** и выберите **свой Authtoken**.

   1. В поле **Authtoken** Скопируйте маркер в надежное расположение.

1. На [странице загрузки **ngrok**](https://ngrok.com/download) или [на панели мониторинга учетной записи](https://dashboard.ngrok.com/get-started/setup)Скачайте нужную версию **ngrok** и Извлеките ZIP-файл. Дополнительные сведения см. [в разделе Шаг 1. Распаковка для установки](https://ngrok.com/download).

1. На компьютере откройте программу командной строки. Перейдите к расположению, в котором имеется файл **ngrok.exe** .

1. Подключите клиент **ngrok** к учетной записи **ngrok** , выполнив следующую команду. Дополнительные сведения см. [в разделе Шаг 2. подключение учетной записи](https://ngrok.com/download).

   `ngrok authtoken <your_auth_token>`

1. Откройте туннель HTTP для порта localhost 7071, выполнив следующую команду. Дополнительные сведения см. в разделе [Step 3: срабатывать](https://ngrok.com/download).

   `ngrok http 7071`

1. В выходных данных найдите следующую строку:

   `http://<domain>.ngrok.io -> http://localhost:7071`

1. Скопируйте и сохраните URL-адрес в следующем формате: `http://<domain>.ngrok.io`

#### <a name="set-up-the-forwarding-url-in-your-app-settings"></a>Настройка URL-адреса пересылки в параметрах приложения

1. В Visual Studio Code на корневом уровне проекта откройте **local.settings.jsв** файле.

1. В `Values` объекте добавьте свойство с именем `Workflows.WebhookRedirectHostUri` и задайте значение для URL-адреса пересылки, созданного ранее, например:

   ```json
   {
      "IsEncrypted": false,
      "Values": {
         "AzureWebJobsStorage": "UseDevelopmentStorage=true",
         "FUNCTIONS_WORKER_RUNTIME": "dotnet",
         "FUNCTIONS_V2_COMPATIBILITY_MODE": "true",
         "Workflows.WebhookRedirectHostUri": "http://xxxXXXXxxxXXX.ngrok.io",
         <...>
      }
   }
   ```

При первом запуске локального сеанса отладки или выполнении рабочего процесса без отладки среда выполнения Logic Apps регистрирует рабочий процесс с конечной точкой службы и подписывается на эту конечную точку для уведомления об операциях веб-перехватчика. При следующем запуске рабочего процесса среда выполнения не будет регистрироваться или повторно подписываться, так как регистрация подписки уже существует в локальном хранилище.

При отмене сеанса отладки для запуска рабочего процесса, использующего триггеры или действия на основе веб-перехватчика, существующие регистрации подписок не удаляются. Для отмены регистрации необходимо вручную удалить или удалить регистрации подписки.

> [!NOTE]
> После запуска рабочего процесса в окне терминала могут отображаться такие ошибки, как в следующем примере:
>
> `message='Http request failed with unhandled exception of type 'InvalidOperationException' and message: 'System.InvalidOperationException: Synchronous operations are disallowed. Call ReadAsync or set AllowSynchronousIO to true instead.`
>
> В этом случае откройте файл **local.settings.jsна** корневом уровне проекта и убедитесь, что для свойства задано значение `true` :
>
> `"FUNCTIONS_V2_COMPATIBILITY_MODE": "true"`

<a name="manage-breakpoints"></a>

## <a name="manage-breakpoints-for-debugging"></a>Управление точками останова для отладки

Перед запуском и тестированием рабочего процесса приложения логики путем запуска сеанса отладки можно установить [точки останова](https://code.visualstudio.com/docs/editor/debugging#_breakpoints) внутри **workflow.jsв** файле для каждого рабочего процесса. Другие настройки не требуются. 

В настоящее время точки останова поддерживаются только для действий, а не для триггеров. Каждое определение действия имеет следующие расположения точек останова:

* Установите начальную точку останова в строке, в которой отображается имя действия. При попадании этой точки останова во время сеанса отладки можно проверить входные данные действия, прежде чем они будут оценены.

* Установите конечную точку останова в строке, которая показывает закрывающую фигурную скобку действия (**}**). При попадании этой точки останова во время сеанса отладки можно проверить результаты действия до завершения выполнения действия.

Чтобы добавить точку останова, выполните следующие действия.

1. Откройте **workflow.jsв** файле для рабочего процесса, который требуется отладить.

1. В строке, где нужно задать точку останова, в левом столбце выберите внутри этого столбца. Чтобы удалить точку останова, выберите эту точку останова.

   Когда вы начнете сеанс отладки, в левой части окна кода появится представление запуск, а в верхней части появится панель инструментов Отладка.

   > [!NOTE]
   > Если представление запуск не отображается автоматически, нажмите клавиши CTRL + SHIFT + D.

1. Чтобы просмотреть доступные сведения при попадании в точку останова, в представлении выполнение проверьте панель **переменные** .

1. Чтобы продолжить выполнение рабочего процесса, на панели инструментов Отладка нажмите кнопку **продолжить** (кнопка воспроизведения). 

Вы можете добавлять и удалять точки останова в любое время во время выполнения рабочего процесса. Однако если вы обновляете **workflow.jsв** файле после запуска запуска, точки останова не обновляются автоматически. Чтобы обновить точки останова, перезапустите приложение логики.

Общие сведения см. в разделе [точки останова — Visual Studio Code](https://code.visualstudio.com/docs/editor/debugging#_breakpoints).

<a name="run-test-debug-locally"></a>

## <a name="run-test-and-debug-locally"></a>Запуск, тестирование и отладка локально

Чтобы протестировать приложение логики, выполните следующие действия, чтобы запустить сеанс отладки и найти URL-адрес конечной точки, созданной триггером запроса. Этот URL-адрес необходим, чтобы позже можно было отправить запрос к этой конечной точке.

1. Чтобы упростить отладку рабочего процесса без отслеживания состояния, можно [Включить журнал выполнения для этого рабочего процесса](#enable-run-history-stateless).

1. На панели действий Visual Studio Code откройте меню **выполнить** и выберите **начать отладку** (F5).

   Откроется окно **терминала** , в котором можно будет ознакомиться с сеансом отладки.

1. Теперь найдите URL-адрес обратного вызова для конечной точки в триггере запроса.

   1. Повторно откройте панель обозревателя, чтобы можно было просмотреть проект.

   1. В контекстном меню **workflow.jsв** файле выберите **Обзор**.

      ![Снимок экрана, на котором отображается панель обозревателя и контекстное окно для workflow.jsфайла с выбранным параметром "Обзор".](./media/create-stateful-stateless-workflows-visual-studio-code/open-workflow-overview.png)

   1. Найдите значение **URL-адреса обратного вызова** , похожее на этот URL-адрес для примера триггера запроса:

      `http://localhost:7071/api/<workflow-name>/triggers/manual/invoke?api-version=2020-05-01-preview&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=<shared-access-signature>`

      ![Снимок экрана, показывающий страницу обзора рабочего процесса с URL-адресом обратного вызова](./media/create-stateful-stateless-workflows-visual-studio-code/find-callback-url.png)

1. Чтобы проверить URL-адрес обратного вызова, активируя рабочий процесс приложения логики, откройте [публикацию POST](https://www.postman.com/downloads/) или предпочтительное средство для создания и отправки запросов.

   Этот пример можно продолжить с помощью процедуры POST. Дополнительные сведения см. в разделе [posting начало работы](https://learning.postman.com/docs/getting-started/introduction/).

   1. На панели инструментов после выберите **создать**.

      ![Снимок экрана, на котором показана публикация после нажатия кнопки "создать"](./media/create-stateful-stateless-workflows-visual-studio-code/postman-create-request.png)

   1. В области **создать новую** в разделе **стандартные блоки** выберите **запрос**.

   1. В окне **запрос на сохранение** в разделе **имя запроса** введите имя запроса, например `Test workflow trigger` .

   1. В разделе **выберите коллекцию или папку для сохранения** выберите **создать коллекцию**.

   1. В разделе **все коллекции** укажите имя коллекции, которую нужно создать для упорядочения запросов, нажмите клавишу ВВОД и выберите **сохранить в <*коллекция-имя* >**. В этом примере `Logic Apps requests` в качестве имени коллекции используется.

      Откроется панель запроса публикации, чтобы можно было отправить запрос на URL-адрес обратного вызова для триггера запроса.

      ![Снимок экрана, показывающий сообщение POST с открытой панелью запросов](./media/create-stateful-stateless-workflows-visual-studio-code/postman-request-pane.png)

   1. Вернитесь к Visual Studio Code. на странице Обзор рабочего процесса скопируйте значение свойства **URL-адрес обратного вызова** .

   1. Вернитесь к POST. На панели запросов рядом со списком метод, который в настоящее **время представляет метод** запроса по умолчанию, вставьте URL-адрес обратного вызова, скопированный ранее в поле адрес, и выберите **Отправить**.

      ![Снимок экрана, показывающий POST и URL-адрес обратного вызова в поле адреса с выбранной кнопкой "Отправить"](./media/create-stateful-stateless-workflows-visual-studio-code/postman-test-call-back-url.png)

      В примере рабочего процесса приложения логики отправляется сообщение электронной почты, которое выглядит примерно так:

      ![Снимок экрана, показывающий электронную почту Outlook, как описано в примере](./media/create-stateful-stateless-workflows-visual-studio-code/workflow-app-result-email.png)

1. В Visual Studio Code вернитесь на страницу обзора рабочего процесса.

   Если вы создали рабочий процесс с отслеживанием состояния, после отправки запроса вы запускаете рабочий процесс. на странице "Обзор" отображается состояние выполнения и журнал рабочего процесса.

   > [!TIP]
   > Если состояние выполнения не отображается, обновите страницу обзора, выбрав **Обновить**. Запуск не выполняется для триггера, который пропущен из-за условий неудовлетворенных или не удается найти данные.

   ![Снимок экрана, показывающий страницу обзора рабочего процесса с состоянием выполнения и журналом](./media/create-stateful-stateless-workflows-visual-studio-code/post-trigger-call.png)

   | Состояние выполнения | Описание |
   |------------|-------------|
   | **Прерывание** | Выполнение остановлено или не завершено из-за внешних проблем, например сбоя системы или подписки Azure. |
   | **Клонения** | Запуск был активирован и запущен, но получен запрос на отмену. |
   | **Сбой** | Не удалось выполнить по крайней мере одно действие в ходе выполнения. Последующие действия в рабочем процессе не были настроены для обработки сбоя. |
   | **Выполнение** | Запуск был запущен и выполняется, но это состояние также может отображаться для запуска, который регулируется из-за [ограничений действия](logic-apps-limits-and-config.md) или [текущего тарифного плана](https://azure.microsoft.com/pricing/details/logic-apps/). <p><p>**Совет**. Если вы настроили [ведение журнала диагностики](monitor-logic-apps-log-analytics.md), можно получить сведения о любых происходящих событиях регулирования. |
   | **Успешно** | Запуск выполнен. Если какое-либо действие завершилось сбоем, последующее действие в рабочем процессе обработало этот сбой. |
   | **Истекло время ожидания** | Время выполнения истекло, так как текущая длительность превысила ограничение продолжительности выполнения, которое управляется [параметром **срок хранения журнала выполнения в днях**](logic-apps-limits-and-config.md#run-duration-retention-limits). Длительность выполнения вычисляется с использованием времени начала и длительности выполнения в это время начала. <p><p>**Примечание**. Если длительность выполнения также превышает текущий *Размер журнала выполнения*, который также управляется [параметром **срок хранения журнала выполнения в днях**](logic-apps-limits-and-config.md#run-duration-retention-limits), запуск удаляется из журнала запусков заданием ежедневной очистки. Независимо от того, завершилось ли время ожидания выполнения или завершено, срок хранения всегда вычисляется с использованием времени начала выполнения и *текущего* предела удержания. Таким образом, при уменьшении предельной продолжительности выполняемого запуска время ожидания истекает. Однако выполнение либо остается, либо удаляется из журнала запусков в зависимости от того, превышает ли длительность выполнения предел удержания. |
   | **Ожидание** | Выполнение не началось или приостановлено, например, из-за более раннего экземпляра рабочего процесса, который еще работает. |
   |||

1. Чтобы просмотреть состояние каждого шага в определенном запуске, а также входных и выходных данных этого шага, нажмите кнопку с многоточием (**...**) для этого запуска и выберите команду **отобразить выполнение**.

   ![Снимок экрана, показывающий строку журнала выполнения рабочего процесса с многоточием и выбранным параметром "Показать выполнение"](./media/create-stateful-stateless-workflows-visual-studio-code/show-run-history.png)

   Visual Studio Code открывает представление Мониторинг и показывает состояние каждого шага в запуске.

   ![Снимок экрана, показывающий каждый шаг в запуске рабочего процесса и их состояние](./media/create-stateful-stateless-workflows-visual-studio-code/run-history-action-status.png)

   > [!NOTE]
   > В случае сбоя выполнения и шага в представлении мониторинга `400 Bad Request` Эта ошибка может возникать из-за более длинного имени триггера или имени действия, которое приводит к превышению предельного числа символов по умолчанию для базового универсального кода ресурса (URI). Дополнительные сведения см. в разделе ["400 недопустимый запрос"](#400-bad-request).

   Ниже приведены возможные состояния, которые могут иметь каждый шаг в рабочем процессе.

   | Состояние действия | Значок | Описание |
   |---------------|------|-------------|
   | Прерывание | ![Значок состояния действия "прервано"][aborted-icon] | Действие остановлено или не завершено из-за внешних проблем, например сбоя системы или подписки Azure. |
   | Отменено | ![Значок состояния действия "отменено"][cancelled-icon] | Действие было запущено, но получило запрос на отмену. |
   | Сбой | ![Значок состояния действия "сбой"][failed-icon] | Не удалось выполнить действие. |
   | Запущен | ![Значок состояния выполняемого действия][running-icon] | Действие выполняется в данный момент. |
   | Пропущено | ![Значок состояния действия "пропущено"][skipped-icon] | Действие было пропущено, так как предыдущее действие завершилось с ошибкой. Действие имеет `runAfter` условие, которое требует, чтобы предыдущее действие было успешно завершено перед выполнением текущего действия. |
   | Выполнено | ![Значок состояния действия "выполнен"][succeeded-icon] | Действие было выполнено. |
   | Выполнен с повторными попытками | ![Значок состояния действия "выполнен с повторными попытками"][succeeded-with-retries-icon] | Действие было завершено, но только после одной или нескольких повторных попыток. Чтобы просмотреть журнал повторных попыток, в представлении сведения о журнале выполнения выберите это действие, чтобы можно было просмотреть входные и выходные данные. |
   | Истекло время ожидания | ![Значок состояния действия "истекло время ожидания"][timed-out-icon] | Действие остановлено из-за предельного времени ожидания, указанного в параметрах этого действия. |
   | Ожидание | ![Значок состояния "ожидание" действия][waiting-icon] | Применяется к действию веб-перехватчика, ожидающему входящего запроса от вызывающего. |
   ||||

   [aborted-icon]: ./media/create-stateful-stateless-workflows-visual-studio-code/aborted.png
   [cancelled-icon]: ./media/create-stateful-stateless-workflows-visual-studio-code/cancelled.png
   [failed-icon]: ./media/create-stateful-stateless-workflows-visual-studio-code/failed.png
   [running-icon]: ./media/create-stateful-stateless-workflows-visual-studio-code/running.png
   [skipped-icon]: ./media/create-stateful-stateless-workflows-visual-studio-code/skipped.png
   [succeeded-icon]: ./media/create-stateful-stateless-workflows-visual-studio-code/succeeded.png
   [succeeded-with-retries-icon]: ./media/create-stateful-stateless-workflows-visual-studio-code/succeeded-with-retries.png
   [timed-out-icon]: ./media/create-stateful-stateless-workflows-visual-studio-code/timed-out.png
   [waiting-icon]: ./media/create-stateful-stateless-workflows-visual-studio-code/waiting.png

1. Чтобы просмотреть входные и выходные данные для каждого шага, выберите шаг, который необходимо проверить.

   ![Снимок экрана, показывающий состояние каждого шага в рабочем процессе плюс входные и выходные данные в расширенном действии "отправить электронное письмо"](./media/create-stateful-stateless-workflows-visual-studio-code/run-history-details.png)

1. Для дальнейшей проверки входных и выходных данных этого шага выберите параметр **Показывать необработанные входные** данные или **отобразить необработанные выходные данные**.

1. Чтобы отключить сеанс отладки, в меню **Запуск** выберите команду **отменить отладку** (Shift + F5).

<a name="return-response"></a>

## <a name="return-a-response"></a>Возврат ответа

Чтобы вернуть ответ вызывающей стороне, который отправил запрос в приложение логики, можно использовать встроенное [действие ответа](../connectors/connectors-native-reqres.md) для рабочего процесса, который начинается с триггера запроса.

1. В конструкторе рабочих процессов в разделе **Отправка действия по электронной почте** выберите **новый шаг**.

   В конструкторе появится запрос **Выбор операции** , после чего откроется **область добавить панель действий** , чтобы можно было выбрать следующее действие.

1. В области **Добавить действие** в поле поиска **Выбор действия** убедитесь, что выбран параметр **Встроенная** . В поле поиска введите `response` и выберите действие **ответ** .

   ![Снимок экрана, на котором показан конструктор рабочих процессов с выбранным действием ответ.](./media/create-stateful-stateless-workflows-visual-studio-code/add-response-action.png)

   Когда в конструкторе появится действие **ответ** , автоматически откроется область сведений действия.

   ![Снимок экрана, на котором показан конструктор рабочих процессов с открытой областью сведений действия "ответ" и свойством "Body", установленным в значение свойства "текст" действия "отправить электронное письмо".](./media/create-stateful-stateless-workflows-visual-studio-code/response-action-details.png)

1. На вкладке **Параметры** укажите необходимые сведения для функции, которую необходимо вызвать.

   В этом примере возвращается значение свойства **Body** , которое выводится в результате действия **Send a email** .

   1. Щелкните внутри поля свойств **текста** , чтобы появился список динамического содержимого, и отобразятся доступные выходные значения из предыдущего триггера и действий в рабочем процессе.

      ![Снимок экрана, показывающий область сведений действия "ответ" с указателем мыши внутри свойства "Body", чтобы появился список динамического содержимого.](./media/create-stateful-stateless-workflows-visual-studio-code/open-dynamic-content-list.png)

   1. В списке динамическое содержимое в разделе **Отправка сообщения электронной почты** выберите **текст**.

      ![Снимок экрана, на котором отображается список открытых динамических содержимого. В списке под заголовком "отправить сообщение электронной почты" выбрано выходное значение "текст".](./media/create-stateful-stateless-workflows-visual-studio-code/select-send-email-action-body-output-value.png)

      По завершении для свойства **Body** действия ответа теперь задается выходное значение **текста** для действия **Отправить сообщение электронной почты** .

      ![Снимок экрана, показывающий состояние каждого шага в рабочем процессе плюс входные и выходные данные в расширенном действии "ответ".](./media/create-stateful-stateless-workflows-visual-studio-code/response-action-details-body-property.png)

1. В конструкторе выберите **сохранить**.

<a name="retest-workflow"></a>

## <a name="retest-your-logic-app"></a>Повторное тестирование приложения логики

После внесения обновлений в приложение логики можно запустить другой тест, повторно запустив отладчик в Visual Studio и отправив другой запрос на активацию обновленного приложения логики, аналогично шагам в разделе [выполнение, тестирование и отладка локально](#run-test-debug-locally).

1. На панели действий Visual Studio Code откройте меню **выполнить** и выберите **начать отладку** (F5).

1. В POST или средстве для создания и отправки запросов отправьте другой запрос на активацию рабочего процесса.

1. Если вы создали рабочий процесс с отслеживанием состояния, на странице Обзор рабочего процесса проверьте состояние последнего запуска. Чтобы просмотреть состояние, входные и выходные данные для каждого шага в этом запуске, нажмите кнопку с многоточием (**...**) для этого запуска и выберите **Показать выполнение**.

   Например, ниже приведено пошаговое состояние запуска после обновления примера рабочего процесса с помощью действия ответ.

   ![Снимок экрана, показывающий состояние каждого шага в обновленном рабочем процессе плюс входные и выходные данные в расширенном действии "ответ".](./media/create-stateful-stateless-workflows-visual-studio-code/run-history-details-rerun.png)

1. Чтобы отключить сеанс отладки, в меню **Запуск** выберите команду **отменить отладку** (Shift + F5).

<a name="deploy-azure"></a>

## <a name="deploy-to-azure"></a>Развернуть в Azure

В Visual Studio Code можно напрямую опубликовать проект в Azure, который развертывает приложение логики с помощью нового типа ресурсов **приложения логики (Предварительная версия)** . Как и ресурс приложения-функции в функциях Azure, развертывание для этого нового типа ресурсов требует выбора [плана размещения и ценовой](../app-service/overview-hosting-plans.md)категории, которые можно настроить во время развертывания. Дополнительные сведения о планах размещения и ценах см. в следующих разделах:

* [Увеличение масштаба в службе приложений Azure](../app-service/manage-scale-up.md)
* [Масштабирование и размещение Функций Azure](../azure-functions/functions-scale.md)

Приложение логики можно опубликовать как новый ресурс, который автоматически создает дополнительные необходимые ресурсы, такие как [учетная запись хранения Azure, аналогично требованиям приложения-функции](../azure-functions/storage-considerations.md). Вы также можете опубликовать приложение логики в ранее развернутом ресурсе **приложения логики (Предварительная версия)** , который перезаписывает это приложение логики.

### <a name="publish-to-a-new-logic-app-preview-resource"></a>Публикация в новом ресурсе приложения логики (Предварительная версия)

1. На панели действий Visual Studio Code щелкните значок Azure.

1. На панели инструментов **Azure: Logic Apps (Предварительная версия)** выберите **развернуть в приложение логики**.

   ![Снимок экрана, на котором показано окно "Azure: Logic Apps (Предварительная версия)" и панель инструментов панели с выбранным параметром "развернуть в приложение логики".](./media/create-stateful-stateless-workflows-visual-studio-code/deploy-to-logic-app.png)

1. В открывшемся списке Visual Studio Code выберите следующие параметры:

   * **Создание нового приложения логики (Предварительная версия) в Azure** (быстрая)
   * **Создание нового приложения логики (Предварительная версия) в Azure Advanced**
   * Ранее развернутый ресурс **приложения логики (Предварительная версия)** , если он существует

   В этом примере **в Azure Advanced вы продолжите создавать новое приложение логики (Предварительная версия)**.

   ![Снимок экрана, на котором показана область "Azure: Logic Apps (Предварительная версия)" со списком с выбранным параметром "создать новое приложение логики (Предварительная версия) в Azure".](./media/create-stateful-stateless-workflows-visual-studio-code/select-create-logic-app-options.png)

1. Чтобы создать новый ресурс **приложения логики (Предварительная версия)** , выполните следующие действия.

   1. Укажите для нового приложения логики глобально уникальное имя, которое будет использоваться для ресурса **приложения логики (Предварительная версия)** . В этом примере используется `Fabrikam-Workflows-App`.

      ![Снимок экрана, на котором показана панель "Azure: Logic Apps (Предварительная версия)" и запрос на ввод имени нового создаваемого приложения логики.](./media/create-stateful-stateless-workflows-visual-studio-code/enter-logic-app-name.png)

   1. Выберите план размещения для нового приложения логики: [**план службы приложений**](../azure-functions/dedicated-plan.md) или [**Premium**](../azure-functions/functions-premium-plan.md). В этом примере выбирается **план службы приложений**.

      ![Снимок экрана, на котором показана панель "Azure: Logic Apps (Предварительная версия)" и запрос на выбор "план службы приложений" или "Премиум".](./media/create-stateful-stateless-workflows-visual-studio-code/select-hosting-plan.png)

   1. Создайте новый план службы приложений или выберите существующий план. В этом примере выбирается **Создание нового плана службы приложений**.

      ![Снимок экрана, на котором показана панель "Azure: Logic Apps (Предварительная версия)" и запрос на команду "создать новый план службы приложений" или выбрать существующий план службы приложений.](./media/create-stateful-stateless-workflows-visual-studio-code/create-app-service-plan.png)

   1. Укажите имя для плана службы приложений, а затем выберите [ценовую категорию](../app-service/overview-hosting-plans.md) для плана. В этом примере выбирается план **Free F1** .

      ![Снимок экрана, на котором показана панель "Azure: Logic Apps (Предварительная версия)" и запрос на выбор ценовой категории.](./media/create-stateful-stateless-workflows-visual-studio-code/select-pricing-tier.png)

   1. Для оптимальной производительности найдите и выберите ту же группу ресурсов, что и проект для развертывания.

      > [!NOTE]
      > Хотя вы можете создать или использовать другую группу ресурсов, это может повлиять на производительность. Если вы создаете или выбираете другую группу ресурсов, но Отмена после появления запроса подтверждения, развертывание также отменяется.

   1. Для рабочих процессов с отслеживанием состояния выберите **создать новую учетную запись хранения** или существующую учетную запись хранения.

      ![Снимок экрана, на котором показана панель "Azure: Logic Apps (Предварительная версия)" и запрос на создание или выбор учетной записи хранения.](./media/create-stateful-stateless-workflows-visual-studio-code/create-storage-account.png)

   1. Если параметры создания и развертывания приложения логики поддерживают использование [Application Insights](../azure-monitor/app/app-insights-overview.md), при необходимости можно включить ведение журнала диагностики и трассировку для приложения логики. Это можно сделать при развертывании приложения логики из Visual Studio Code или после развертывания. Необходимо иметь Application Insights экземпляр, но этот ресурс можно создать [заранее](../azure-monitor/app/create-workspace-resource.md), при развертывании приложения логики или после развертывания.

      Чтобы включить ведение журнала и трассировку сейчас, выполните следующие действия.

      1. Выберите существующий ресурс Application Insights или **Создайте новый Application Insights ресурс**.

      1. В [портал Azure](https://portal.azure.com)перейдите к ресурсу Application Insights.

      1. В меню ресурс выберите **Обзор**. Найдите и скопируйте значение **ключа инструментирования** .

      1. В Visual Studio Code на корневом уровне проекта откройте **local.settings.jsв** файле.

      1. В `Values` объекте добавьте `APPINSIGHTS_INSTRUMENTATIONKEY` свойство и задайте значение для ключа инструментирования, например:

         ```json
         {
            "IsEncrypted": false,
            "Values": {
               "AzureWebJobsStorage": "UseDevelopmentStorage=true",
               "FUNCTIONS_WORKER_RUNTIME": "dotnet",
               "APPINSIGHTS_INSTRUMENTATIONKEY": <instrumentation-key>
            }
         }
         ```

         > [!TIP]
         > Вы можете проверить, правильно ли указаны имена триггера и действий в экземпляре Application Insights.
         >
         > 1. В портал Azure перейдите к ресурсу Application Insights.
         >
         > 2. В меню ресурс ресурса в разделе **исследовать** выберите **схема приложения**.
         >
         > 3. Проверьте имена операций, которые отображаются на карте.
         >
         > Некоторые входящие запросы от встроенных триггеров могут отображаться как дубликаты в схеме приложения. 
         > Вместо использования `WorkflowName.ActionName` формата эти дубликаты используют имя рабочего процесса в качестве имени операции и берутся из узла функций Azure.

      1. Затем можно настроить уровень серьезности для данных трассировки, собираемых приложением логики и отправляемых в экземпляр Application Insights.

         Каждый раз, когда происходит событие, связанное с рабочим процессом, например при запуске рабочего процесса или при выполнении действия, среда выполнения создает различные трассировки. Эти трассировки охватывают время существования рабочего процесса и включают, но не ограничиваются следующие типы событий:

         * Действия службы, такие как запуск, завершение и ошибки.
         * Задания и действия диспетчера.
         * Действия рабочего процесса, такие как триггеры, действия и выполнения.
         * Операция запроса хранилища, например "успешно" или "сбой".
         * Активность HTTP-запросов, например входящая, исходящая, успешная и неудачная.
         * Трассировки нерегламентированной разработки, такие как сообщения отладки.

         Каждому типу события присваивается уровень серьезности. Например, `Trace` уровень фиксирует наиболее подробные сообщения, а `Information` уровень — общее действие в рабочем процессе, например, когда приложение логики, Рабочий процесс, триггер и действия запускаются и останавливаются. В этой таблице описаны уровни серьезности и их типы трассировки.

         | Степень серьезности | Тип трассировки |
         |----------------|------------|
         | Критически важно | Журналы, описывающие неустранимый сбой в приложении логики. |
         | Отладка | Журналы, которые можно использовать для изучения во время разработки, например Входящие и исходящие HTTP-вызовы. |
         | Ошибка | Журналы, указывающие на сбой выполнения рабочего процесса, но не общий сбой в приложении логики. |
         | Сведения | Журналы, которые отписывают общие действия в приложении логики или рабочем процессе, например: <p><p>— При запуске и завершении триггера, действия или запуска. <br>— При запуске или завершении приложения логики. |
         | Трассировка | Журналы, содержащие наиболее подробные сообщения, например запросы хранилища или действия диспетчера, а также все сообщения, связанные с действием выполнения рабочего процесса. |
         | Предупреждение | Журналы, которые выделяют ненормальное состояние в приложении логики, но не препятствуют его работе. |
         |||

         Чтобы задать уровень серьезности, на корневом уровне проекта откройте **host.jsв** файле и найдите `logging` объект. Этот объект управляет фильтрацией журналов для всех рабочих процессов в приложении логики и соответствует [разметке ASP.NET Core для фильтрации типов журналов](/aspnet/core/fundamentals/logging/?view=aspnetcore-2.1&preserve-view=true#log-filtering).

         ```json
         {
            "version": "2.0",
            "logging": {
               "applicationInsights": {
                  "samplingExcludedTypes": "Request",
                  "samplingSettings": {
                     "isEnabled": true
                  }
               }
            }
         }
         ```

         Если `logging` объект не содержит объект, `logLevel` включающий `Host.Triggers.Workflow` свойство, добавьте эти элементы. Задайте для свойства степень серьезности для нужного типа трассировки, например:

         ```json
         {
            "version": "2.0",
            "logging": {
               "applicationInsights": {
                  "samplingExcludedTypes": "Request",
                  "samplingSettings": {
                     "isEnabled": true
                  }
               },
               "logLevel": {
                  "Host.Triggers.Workflow": "Information"
               }
            }
         }
         ```

   После завершения действий по развертыванию Visual Studio Code приступает к созданию и развертыванию ресурсов, необходимых для публикации приложения логики.

1. Чтобы просмотреть и отслеживать процесс развертывания, в меню **вид** выберите пункт **выходные данные**. В списке Панель инструментов окна вывода выберите **Azure Logic Apps**.

   ![Снимок экрана, на котором отображается окно вывода с параметром "Azure Logic Apps", выбранным в списке панелей инструментов вместе с ходом выполнения и состояниями развертывания.](./media/create-stateful-stateless-workflows-visual-studio-code/logic-app-deployment-output-window.png)

   Когда Visual Studio Code завершит развертывание приложения логики в Azure, появится следующее сообщение:

   ![Снимок экрана, на котором показано сообщение о том, что развертывание в Azure успешно завершено.](./media/create-stateful-stateless-workflows-visual-studio-code/deployment-to-azure-completed.png)

   Поздравляем, приложение логики теперь активно в Azure и включено по умолчанию.

Далее можно узнать, как выполнять следующие задачи:

* [Добавьте в проект пустой рабочий процесс](#add-workflow-existing-project).

* [Управление развернутыми приложениями логики в Visual Studio Code](#manage-deployed-apps-vs-code) или с помощью [портал Azure](#manage-deployed-apps-portal).

* [Включите журнал выполнения рабочих процессов без отслеживания состояния](#enable-run-history-stateless).

* [Включите представление мониторинга в портал Azure для развернутого приложения логики](#enable-monitoring).

<a name="add-workflow-existing-project"></a>

## <a name="add-blank-workflow-to-project"></a>Добавить пустой рабочий процесс в проект

В проекте приложения логики можно использовать несколько рабочих процессов. Чтобы добавить пустой рабочий процесс в проект, выполните следующие действия.

1. На панели действий Visual Studio Code щелкните значок Azure.

1. В области Azure рядом с **Azure: Logic Apps (Предварительная версия)** выберите **создать рабочий процесс** (значок для Azure Logic Apps).

1. Выберите тип рабочего процесса, который требуется добавить, с **отслеживанием состояния** или **без отслеживания состояния**.

1. Укажите имя рабочего процесса.

По завершении в проекте появится новая папка рабочего процесса, а также **workflow.js** файл для определения рабочего процесса.

<a name="manage-deployed-apps-vs-code"></a>

## <a name="manage-deployed-logic-apps-in-visual-studio-code"></a>Управление развернутыми приложениями логики в Visual Studio Code

В Visual Studio Code можно просмотреть все развернутые приложения логики в подписке Azure, будь то исходный **Logic Apps** или тип ресурса **приложения логики (Предварительная версия)** , а также выбрать задачи, которые помогут управлять этими приложениями логики. Однако для доступа к обоим типам ресурсов требуются расширения **Azure Logic Apps** и **Azure Logic Apps (Предварительная версия)** для Visual Studio Code.

1. На панели инструментов слева щелкните значок Azure. В области **Azure: Logic Apps (Предварительная версия)** разверните подписку, в которой отображаются все развернутые приложения логики для этой подписки.

1. Найдите и выберите приложение логики, которым требуется управлять. Откройте контекстное меню приложения логики и выберите задачу, которую требуется выполнить.

   Например, можно выбрать такие задачи, как остановка, запуск, перезапуск или удаление развернутого приложения логики.

   ![Снимок экрана, на котором показано Visual Studio Code с открытой областью расширения "Azure Logic Apps (Предварительная версия)" и развернутым рабочим процессом.](./media/create-stateful-stateless-workflows-visual-studio-code/find-deployed-workflow-visual-studio-code.png)

1. Чтобы просмотреть все рабочие процессы в приложении логики, разверните приложение логики, а затем узел **рабочие процессы** .

1. Чтобы просмотреть конкретный рабочий процесс, откройте контекстное меню рабочего процесса и выберите **Открыть в конструкторе**, чтобы открыть рабочий процесс в режиме только для чтения.

   Чтобы изменить рабочий процесс, можно использовать следующие параметры:

   * В Visual Studio Code откройте файл **workflow.js** проекта в конструкторе рабочих процессов, внесите изменения и повторно разверните приложение логики в Azure.

   * В портал Azure [найдите и откройте приложение логики](#manage-deployed-apps-portal). Найдите, измените и сохраните рабочий процесс.

1. Чтобы открыть развернутое приложение логики в портал Azure, откройте контекстное меню приложения логики и выберите **Открыть на портале**.

   Портал Azure откроется в браузере, автоматически войдет на портал, если вы вошли в Visual Studio Code, и отобразите приложение логики.

   ![Снимок экрана, на котором показана портал Azure страница приложения логики в Visual Studio Code.](./media/create-stateful-stateless-workflows-visual-studio-code/deployed-workflow-azure-portal.png)

   Вы также можете войти отдельно в портал Azure, использовать поле поиска на портале, чтобы найти приложение логики, а затем выбрать приложение логики из списка результатов.

   ![Снимок экрана, на котором показаны портал Azure и панель поиска с результатами поиска для развернутого приложения логики, которое отображается в выбранном виде.](./media/create-stateful-stateless-workflows-visual-studio-code/find-deployed-workflow-azure-portal.png)

<a name="manage-deployed-apps-portal"></a>

## <a name="manage-deployed-logic-apps-in-the-portal"></a>Управление развернутыми приложениями логики на портале

В портал Azure можно просмотреть все развернутые приложения логики, которые находятся в вашей подписке Azure, независимо от того, являются ли они исходным типом ресурса **Logic Apps** или типом ресурсов **приложения логики (Предварительная версия)** . В настоящее время каждый тип ресурса организован и управляется как отдельные категории в Azure. Чтобы найти приложения логики с типом ресурсов **приложение логики (Предварительная версия)** , выполните следующие действия.

1. В поле поиска портал Azure введите `logic app preview` . Когда появится список результатов, в разделе **службы** выберите **приложение логики (Предварительная версия)**.

   ![Снимок экрана, на котором показано поле поиска портал Azure с текстом для поиска "Предварительная версия приложения логики".](./media/create-stateful-stateless-workflows-visual-studio-code/portal-find-logic-app-preview-resource.png)

1. В области **приложение логики (Предварительная версия)** найдите и выберите приложение логики, развернутое из Visual Studio Code.

   ![Снимок экрана, на котором показаны портал Azure и ресурсы приложения логики (Предварительная версия), развернутые в Azure.](./media/create-stateful-stateless-workflows-visual-studio-code/logic-app-preview-resources-pane.png)

   Портал Azure открывает страницу отдельных ресурсов для выбранного приложения логики.

   ![Снимок экрана, показывающий страницу ресурсов рабочего процесса приложения логики в портал Azure.](./media/create-stateful-stateless-workflows-visual-studio-code/deployed-workflow-azure-portal.png)

1. Чтобы просмотреть рабочие процессы в этом приложении логики, в меню приложения логики выберите **рабочие процессы**.

   На панели **рабочие процессы** отображаются все рабочие процессы в текущем приложении логики. В этом примере показан рабочий процесс, созданный в Visual Studio Code.

   ![Снимок экрана, на котором показана страница ресурсов "приложение логики (Предварительная версия)" с открытой панелью "рабочие процессы" и развернутый рабочий процесс](./media/create-stateful-stateless-workflows-visual-studio-code/deployed-logic-app-workflows-pane.png)

1. Чтобы просмотреть рабочий процесс, в области **рабочие процессы** выберите этот рабочий процесс.

   Откроется панель Рабочий процесс с дополнительными сведениями и задачами, которые можно выполнить в этом рабочем процессе.

   Например, чтобы просмотреть шаги в рабочем процессе, выберите **конструктор**.

   ![Снимок экрана, на котором показана панель "Обзор" выбранного рабочего процесса, а в меню "Рабочий процесс" отображается выбранная команда "Конструктор".](./media/create-stateful-stateless-workflows-visual-studio-code/workflow-overview-pane-select-designer.png)

   Откроется конструктор рабочих процессов, в котором будет показан рабочий процесс, созданный в Visual Studio Code. Теперь вы можете вносить изменения в этот рабочий процесс в портал Azure.

   ![Снимок экрана, на котором показан конструктор рабочих процессов и рабочий процесс, развернутые из Visual Studio Code.](./media/create-stateful-stateless-workflows-visual-studio-code/opened-workflow-designer.png)

<a name="add-workflow-portal"></a>

## <a name="add-another-workflow-in-the-portal"></a>Добавление другого рабочего процесса на портале

С помощью портал Azure можно добавить пустые рабочие процессы в ресурс **приложения логики (Предварительная версия)** , развернутый из Visual Studio Code и построить эти рабочие процессы в портал Azure.

1. В [портал Azure](https://portal.azure.com)найдите и выберите развернутый ресурс **приложения логики (Предварительная версия)** .

1. В меню приложение логики выберите **рабочие процессы**. В области **рабочие процессы** выберите **Добавить**.

   ![Снимок экрана, на котором показана панель "рабочие процессы" выбранного приложения логики и панель инструментов с выбранной командой "Добавить".](./media/create-stateful-stateless-workflows-visual-studio-code/add-new-workflow.png)

1. В области **создать рабочий процесс** укажите имя рабочего процесса. Выберите создание с **отслеживанием** или без **отслеживания состояния** **>** .

   После того, как Azure развернет новый рабочий процесс, который появится на панели **рабочие процессы** , выберите этот рабочий процесс, чтобы можно было управлять и выполнять другие задачи, такие как открытие конструктора или представления кода.

   ![Снимок экрана, на котором показан выбранный рабочий процесс с параметрами управления и проверки.](./media/create-stateful-stateless-workflows-visual-studio-code/view-new-workflow.png)

   Например, при открытии конструктора для нового рабочего процесса отображается пустой холст. Теперь этот рабочий процесс можно создать в портал Azure.

   ![Снимок экрана, показывающий конструктор рабочих процессов и пустой рабочий процесс.](./media/create-stateful-stateless-workflows-visual-studio-code/opened-blank-workflow-designer.png)

<a name="enable-run-history-stateless"></a>

## <a name="enable-run-history-for-stateless-workflows"></a>Включить журнал выполнения для рабочих процессов без отслеживания состояния

Чтобы упростить отладку рабочего процесса без отслеживания состояния, можно включить журнал выполнения для этого рабочего процесса, а затем отключить журнал выполнения по завершении. Выполните следующие действия для Visual Studio Code или, если вы работаете в портал Azure, см. статью [создание рабочих процессов с отслеживанием состояния и без отслеживания состояния в портал Azure](create-stateful-stateless-workflows-azure-portal.md#enable-run-history-stateless).

1. В проекте Visual Studio Code разверните папку **Workflow-DesignTime** и откройте **local.settings.jsв** файле.

1. Добавьте `Workflows.{yourWorkflowName}.operationOptions` свойство и задайте для него значение `WithStatelessRunHistory` , например:

   **Windows или Linux**

   ```json
   {
      "IsEncrypted": false,
      "Values": {
         "AzureWebJobsStorage": "UseDevelopmentStorage=true",
         "FUNCTIONS_WORKER_RUNTIME": "dotnet",
         "Workflows.{yourWorkflowName}.OperationOptions": "WithStatelessRunHistory"
      }
   }
   ```

   **macOS**

   ```json
   {
      "IsEncrypted": false,
      "Values": {
         "AzureWebJobsStorage": "DefaultEndpointsProtocol=https;AccountName=fabrikamstorageacct; \
             AccountKey=<access-key>;EndpointSuffix=core.windows.net",
         "FUNCTIONS_WORKER_RUNTIME": "dotnet",
         "Workflows.{yourWorkflowName}.OperationOptions": "WithStatelessRunHistory"
      }
   }
   ```

1. Чтобы отключить журнал выполнения по завершении, присвойте `Workflows.{yourWorkflowName}.OperationOptions` свойству значение `None` , или удалите свойство вместе со значением.

<a name="enable-monitoring"></a>

## <a name="enable-monitoring-view-in-the-azure-portal"></a>Включите представление мониторинга в портал Azure

После развертывания ресурса **логики (Предварительная версия)** из Visual Studio Code в Azure можно просмотреть любой доступный журнал выполнения и сведения для рабочего процесса в этом ресурсе с помощью портал Azure и интерфейса **монитора** для этого рабочего процесса. Однако сначала необходимо включить возможность просмотра **монитора** для этого ресурса приложения логики.

1. В [портал Azure](https://portal.azure.com)найдите и выберите развернутый ресурс **приложения логики (Предварительная версия)** .

1. В меню этого ресурса в разделе **API** выберите **CORS**.

1. В области **CORS** в разделе **Разрешенные источники** добавьте символ-шаблон (*).

1. Когда все будет готово, на панели инструментов **CORS** нажмите кнопку **сохранить**.

   ![Снимок экрана, на котором показано портал Azure с развернутым ресурсом приложения логики (Предварительная версия). В меню ресурсов будет выбрано "CORS" с новой записью для "разрешенные источники" в качестве символа подстановочного знака "*".](./media/create-stateful-stateless-workflows-visual-studio-code/enable-run-history-deployed-logic-app.png)

<a name="enable-open-application-insights"></a>

## <a name="enable-or-open-application-insights-after-deployment"></a>Включение или открытие Application Insights после развертывания

Во время выполнения рабочего процесса приложение логики выдает данные телеметрии вместе с другими событиями. Эту телеметрию можно использовать для получения более четкого представления о том, насколько хорошо работает рабочий процесс, а также о том, как среда выполнения Logic Apps работает различными способами. Вы можете отслеживать рабочий процесс с помощью [Application Insights](../azure-monitor/app/app-insights-overview.md), который предоставляет данные телеметрии практически в реальном времени (динамические метрики). Эта возможность упрощает исследование сбоев и проблем с производительностью при использовании этих данных для диагностики проблем, настройки оповещений и построения диаграмм.

Если параметры создания и развертывания приложения логики поддерживают использование [Application Insights](../azure-monitor/app/app-insights-overview.md), при необходимости можно включить ведение журнала диагностики и трассировку для приложения логики. Это можно сделать при развертывании приложения логики из Visual Studio Code или после развертывания. Необходимо иметь Application Insights экземпляр, но этот ресурс можно создать [заранее](../azure-monitor/app/create-workspace-resource.md), при развертывании приложения логики или после развертывания.

Чтобы включить Application Insights в развернутом приложении логики или проверить Application Insights данные, если они уже включены, выполните следующие действия.

1. В портал Azure найдите развернутое приложение логики.

1. В меню приложения логики в разделе **Параметры** выберите **Application Insights**.

1. Если Application Insights не включено, в области **Application Insights** выберите **включить Application Insights**. После обновления панели в нижней части щелкните **Применить**.

   Если Application Insights включен, в области **Application Insights** выберите **представление Application Insights данные**.

После открытия Application Insights можно просматривать различные метрики для приложения логики. Дополнительные сведения см. в разделе [Azure Logic Apps выполнение в любом месте монитора с Application Insights. часть 1](https://techcommunity.microsoft.com/t5/integrations-on-azure/azure-logic-apps-running-anywhere-monitor-with-application/ba-p/1877849).

<a name="deploy-docker"></a>

## <a name="deploy-to-docker"></a>Развертывание в DOCKER

Приложение логики можно развернуть в [контейнере DOCKER](/visualstudio/docker/tutorials/docker-tutorial#what-is-a-container) в качестве среды размещения с помощью [.net CLI](/dotnet/core/tools/). С помощью этих команд можно создать и опубликовать проект приложения логики. Затем можно создать и запустить контейнер DOCKER в качестве места назначения для развертывания приложения логики.

Если вы не знакомы с DOCKER, ознакомьтесь со следующими статьями:

* [Что такое Docker?](/dotnet/architecture/microservices/container-docker-introduction/docker-defined)
* [Общие сведения о контейнерах и Docker](/dotnet/architecture/microservices/container-docker-introduction/)
* [Общие сведения о .NET и Docker](/dotnet/core/docker/introduction)
* [Контейнеры, образы и реестры Docker](/dotnet/architecture/microservices/container-docker-introduction/docker-containers-images-registries)
* [Учебник. Начало работы с DOCKER (Visual Studio Code)](/visualstudio/docker/tutorials/docker-tutorial)

### <a name="requirements"></a>Требования

* Учетная запись хранения Azure, используемая приложением логики для развертывания

* Файл DOCKER для рабочего процесса .NET, который используется при создании контейнера DOCKER

   Например, этот пример файла DOCKER развертывает приложение логики с рабочим процессом с отслеживанием состояния. В файле указана строка подключения и ключ доступа для учетной записи хранения Azure, которая использовалась для публикации приложения логики в портал Azure.

   ```text
   FROM mcr.microsoft.com/dotnet/core/sdk3.1 AS installer-env

   COPY . /src/dotnet-function-app
   RUN cd /src/dotnet-function-app && \
       mkdir -p /home/site/wwwroot && \
       dotnet publish *.csproj --output /home/site/wwwroot

   FROM mcr.microsoft.com/azure-functions/dotnet:3.0
   ENV AzureWebJobsStorage <storage-account-connection-string>
   ENV AzureWebJobsScriptRoot=/home/site/wwwroot \
       AzureFunctionsJobHost__Logging__Console__IsEnabled=true \
       FUNCTIONS_V2_COMPATIBILITY_MODE=true

   COPY --from=installer-env ["/home/site/wwwroot", "/home/site/wwwroot"]
   ```

   Дополнительные сведения см. в статье рекомендации [по написанию файлов DOCKER](https://docs.docker.com/develop/develop-images/dockerfile_best-practices/) .

### <a name="build-and-publish-your-app"></a>Создание и публикация приложения

1. Чтобы создать проект приложения логики локально, откройте командную строку командной строки и выполните следующую команду:

   `dotnet build -c release`

   Дополнительные сведения см. на странице справки по [сборке DotNet](/dotnet/core/tools/dotnet-build/) .

1. Опубликуйте сборку проекта в папке, которая будет использоваться для развертывания в среде размещения, выполнив следующую команду:

   `dotnet publish -c release`

   Дополнительные сведения см. на странице справочника по [DotNet Publish](/dotnet/core/tools/dotnet-publish/) .

### <a name="access-to-your-storage-account"></a>Доступ к учетной записи хранения

Перед сборкой и запуском контейнера DOCKER необходимо получить строку подключения, содержащую ключи доступа к вашей учетной записи хранения.

1. В портал Azure в меню учетной записи хранения в разделе **Параметры** выберите **ключи доступа**. 

   ![Снимок экрана, на котором показано портал Azure с ключами доступа к учетной записи хранения и скопированной строкой подключения.](./media/create-stateful-stateless-workflows-visual-studio-code/find-storage-account-connection-string.png)

1. В разделе **строка подключения** скопируйте строку подключения учетной записи хранения. Строка подключения похожа на следующий образец:

   `DefaultEndpointsProtocol=https;AccountName=fabrikamstorageacct;AccountKey={access-key};EndpointSuffix=core.windows.net`

   Дополнительные сведения см. в обзоре [управления ключами учетной записи хранения](../storage/common/storage-account-keys-manage.md?tabs=azure-portal#view-account-access-keys).

1. Сохраните строку подключения в безопасном месте. В проекте приложения логики эту строку необходимо добавить в **local.settings.js** файлов. Также необходимо добавить эту строку в файл DOCKER.

### <a name="build-and-run-your-docker-container-image"></a>Сборка и запуск образа контейнера DOCKER

1. Создайте образ контейнера DOCKER с помощью файла DOCKER и выполните следующую команду:

   `docker build --tag local/workflowcontainer .`

   Дополнительные сведения см. в статье о [сборке DOCKER](https://docs.docker.com/engine/reference/commandline/build/).

1. Сохраните строку в безопасном месте, чтобы позднее можно было добавить строку в **local.settings.js** файлов проекта, используемых для создания приложения логики в Visual Studio Code.

1. Запустите контейнер локально с помощью следующей команды:

   `docker run -e WEBSITE_HOSTNAME=localhost -p 8080:80 local/workflowcontainer`

   Дополнительные сведения см. в разделе [выполнение DOCKER](https://docs.docker.com/engine/reference/commandline/run/).

### <a name="get-callback-url-for-request-trigger"></a>Получение URL-адреса обратного вызова для триггера запроса

Чтобы получить URL-адрес обратного вызова для триггера запроса, отправьте этот запрос:

`POST /runtime/webhooks/workflow/api/management/workflows/{workflow-name}/triggers/{trigger-name}/listCallbackUrl?api-version=2020-05-01-preview&code={master-key}`

Значение <*главного ключа*> определено в учетной записи хранения Azure, заданной для `AzureWebJobsStorage` в файле, **Azure-веб-заданиях (секреты)/{Deployment-Name}/host.json**, где можно найти значение в этом разделе:

```json
{
   <...>
   "masterKey": {
      "name": "master",
      "value": "<master-key>",
      "encrypted": false
   },
   <...>
   }
```

<a name="delete-from-designer"></a>

## <a name="delete-items-from-the-designer"></a>Удаление элементов из конструктора

Чтобы удалить элемент в рабочем процессе из конструктора, выполните любое из следующих действий.

* Выберите элемент, откройте контекстное меню элемента (Shift + F10) и выберите **Удалить**. Для подтверждения выберите **ОК**.

* Выберите элемент и нажмите клавишу DELETE. Для подтверждения выберите **ОК**.

* Выберите элемент, чтобы открыть область сведений для этого элемента. В верхнем правом углу панели откройте меню с многоточием (**...**) и выберите **Удалить**. Для подтверждения выберите **ОК**.

  ![Снимок экрана, на котором показан выбранный элемент в конструкторе с открытой областью сведений, плюс кнопка с многоточием и командой "Удалить".](./media/create-stateful-stateless-workflows-visual-studio-code/delete-item-from-designer.png)

  > [!TIP]
  > Если меню многоточия не отображается, последовательно разверните узлы Visual Studio Code окно, чтобы в области сведений отображалась кнопка с многоточием (**...**) в правом верхнем углу.

<a name="troubleshooting"></a>

## <a name="troubleshoot-errors-and-problems"></a>Устранение ошибок и проблем

<a name="designer-fails-to-open"></a>

### <a name="opening-designer-fails-with-error-workflow-design-time-could-not-be-started"></a>Сбой открытия конструктора с ошибкой: "не удалось запустить время разработки рабочего процесса"

1. В Visual Studio Code откройте окно вывод. В меню **вид** выберите пункт **выходные данные**.

1. В списке в заголовке окна вывода выберите **Azure Logic Apps (Предварительная версия)** , чтобы можно было просмотреть выходные данные расширения, например:

   ![Снимок экрана, на котором отображается окно вывода с выбранным параметром "Azure Logic Apps".](./media/create-stateful-stateless-workflows-visual-studio-code/check-outout-window-azure-logic-apps.png)

1. Просмотрите выходные данные и проверьте, отображается ли это сообщение об ошибке:

   ```text
   A host error has occurred during startup operation '{operationID}'.
   System.Private.CoreLib: The file 'C:\Users\{userName}\AppData\Local\Temp\Functions\
   ExtensionBundles\Microsoft.Azure.Functions.ExtensionBundle.Workflows\1.1.1\bin\
   DurableTask.AzureStorage.dll' already exists.
   Value cannot be null. (Parameter 'provider')
   Application is shutting down...
   Initialization cancellation requested by runtime.
   Stopping host...
   Host shutdown completed.
   ```

   Эта ошибка может произойти, если ранее была предпринята попытка открыть конструктор, а затем этот проект был снят или удален. Чтобы устранить эту ошибку, удалите папку **екстенсионбундлес** в этом расположении **. папка \Users \\ {username} \аппдата\локал\темп\функтионс\екстенсионбундлес** и повторите попытку открытия файла **workflow.js** в конструкторе.

<a name="missing-triggers-actions"></a>

### <a name="new-triggers-and-actions-are-missing-from-the-designer-picker-for-previously-created-workflows"></a>В средстве выбора конструктора для ранее созданных рабочих процессов отсутствуют новые триггеры и действия.

Azure Logic Apps Preview поддерживает встроенные действия для операций с функциями Azure, ликвидных операций и XML-операций, таких как **Проверка XML** и **XML-преобразование**. Однако для ранее созданных приложений логики эти действия могут не отображаться в средстве выбора конструктора для выбора, если Visual Studio Code использует устаревшую версию пакета расширений `Microsoft.Azure.Functions.ExtensionBundle.Workflows` .

Кроме того, соединитель и действия **функции Azure** не отображаются в средстве выбора конструктора, если вы не включили или не выбрали **Использование соединителей из Azure** при создании приложения логики. Если вы не включили соединители, развернутые в Azure, во время создания приложения, их можно включить в проекте в Visual Studio Code. Откройте **workflow.jsв** контекстном меню и выберите **использовать соединители из Azure**.

Чтобы исправить устаревшую версию пакета, выполните следующие действия, чтобы удалить устаревший пакет, что сделает Visual Studio Code автоматически обновлять пакет расширений до последней версии.

> [!NOTE]
> Это решение относится только к приложениям логики, которые создаются и развертываются с помощью Visual Studio Code с расширением Azure Logic Apps (Предварительная версия), а не с приложениями логики, созданными с помощью портал Azure. См. раздел [Поддерживаемые триггеры и действия отсутствуют в конструкторе в портал Azure](create-stateful-stateless-workflows-azure-portal.md#missing-triggers-actions).

1. Сохраните все результаты работы, которые не нужно терять, и закройте Visual Studio.

1. На компьютере перейдите в следующую папку, содержащую версии папок для существующего пакета:

   `...\Users\{your-username}\.azure-functions-core-tools\Functions\ExtensionBundles\Microsoft.Azure.Functions.ExtensionBundle.Workflows`

1. Удалите папку версии для предыдущего пакета, например, если у вас есть папка для версии 1.1.3, удалите эту папку.

1. Теперь перейдите в следующую папку, содержащую версии папок для требуемого пакета NuGet:

   `...\Users\{your-username}\.nuget\packages\microsoft.azure.workflows.webjobs.extension`

1. Удалите папку версии для более раннего пакета, например, если у вас есть папка для версии 1.0.0.8-Preview, удалите эту папку.

1. Повторно откройте Visual Studio Code, проект и **workflow.js** файл в конструкторе.

Отсутствующие триггеры и действия теперь отображаются в конструкторе.

<a name="400-bad-request"></a>

### <a name="400-bad-request-appears-on-a-trigger-or-action"></a>в триггере или действии отображается сообщение "400 Неверный запрос"

В случае сбоя выполнения и проверки выполнения в представлении мониторинга эта ошибка может возникать в триггере или действии с более длинным именем, что приводит к превышению предельного числа символов по умолчанию для базового универсального кода ресурса (URI).

Чтобы устранить эту проблему и настроить более длинный универсальный код ресурса (URI), измените `UrlSegmentMaxCount` `UrlSegmentMaxLength` разделы реестра и на компьютере, выполнив следующие действия. Эти значения ключа по умолчанию описаны в этом разделе, [Http.sys параметры реестра для Windows](/troubleshoot/iis/httpsys-registry-windows).

> [!IMPORTANT]
> Перед началом работы убедитесь, что вы сохранили работу. Это решение требует перезагрузки компьютера после завершения работы, чтобы изменения вступили в силу.

1. На компьютере откройте окно **Запуск** и выполните `regedit` команду, которая открывает редактор реестра.

1. В поле **контроль учетных записей пользователей** выберите **Да** , чтобы изменения были разрешены на компьютере.

1. В левой области в разделе **компьютер** разверните узлы по пути, **HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\HTTP\Parameters**, а затем выберите **Параметры**.

1. В области справа найдите `UrlSegmentMaxCount` `UrlSegmentMaxLength` разделы реестра и.

1. Увеличьте эти ключевые значения, чтобы URI могли разместить нужные имена. Если эти ключи не существуют, добавьте их в папку **Parameters** , выполнив следующие действия.

   1. В контекстном меню **Параметры** выберите **новое**  >  **значение DWORD (32 бит)**.

   1. В появившемся поле ввода введите в `UrlSegmentMaxCount` качестве нового имени ключа.

   1. Откройте контекстное меню нового ключа и выберите **изменить**.

   1. В появившемся поле **изменить строку** введите значение ключа **данных** , которое необходимо ввести в шестнадцатеричном или десятичном формате. Например, `400` шестнадцатеричное значение эквивалентно `1024` в десятичном.

   1. Чтобы добавить `UrlSegmentMaxLength` значение ключа, повторите эти действия.

   После увеличения или добавления этих ключевых значений редактор реестра будет выглядеть следующим образом:

   ![Снимок экрана, на котором показан редактор реестра.](media/create-stateful-stateless-workflows-visual-studio-code/edit-registry-settings-uri-length.png)

1. Когда вы будете готовы, перезагрузите компьютер, чтобы изменения вступили в силу.

## <a name="next-steps"></a>Дальнейшие действия

Мы хотели бы узнать о своих впечатлениях с помощью расширения Azure Logic Apps (Предварительная версия)!

* При возникновении ошибок или проблем [Создайте свои проблемы в GitHub](https://github.com/Azure/logicapps/issues).
* Для вопросов, запросов, комментариев и других отзывов [Используйте эту форму обратной связи](https://aka.ms/lafeedback).