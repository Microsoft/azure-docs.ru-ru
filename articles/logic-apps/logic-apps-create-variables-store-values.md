---
title: Создание и Управление переменными для хранения и передачи значений
description: Сведения о хранении, управлении, использовании и передаче значений с помощью переменных в автоматизированных задачах и рабочих процессах, создаваемых с помощью Azure Logic Apps
services: logic-apps
ms.suite: integration
ms.reviewer: klam, logicappspm
ms.topic: conceptual
ms.date: 09/20/2019
ms.openlocfilehash: b486b94a74d98f5630bd0bf40ebf0864c2ec5ab8
ms.sourcegitcommit: 772eb9c6684dd4864e0ba507945a83e48b8c16f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "91333908"
---
# <a name="store-and-manage-values-by-using-variables-in-azure-logic-apps"></a>Хранение значений и управление ими с помощью переменных в Azure Logic Apps

В этой статье показано, как создавать переменные, используемые для хранения значений в приложении логики, и работать с ними. Например, переменные могут помочь в отслеживании числа выполнений цикла. Чтобы выполнить итерацию по массиву или проверить массив для конкретного элемента, можно использовать переменную для ссылки на номер индекса для каждого элемента массива.

Вы можете создавать переменные для таких типов данных, как целые числа, числа с плавающей точкой, логические значения, строки, массивы и объекты. После создания переменной можно выполнять другие задачи, например:

* получить значение переменной или сослаться на него;
* увеличить или уменьшить переменную на фиксированное значение, также называемое *инкрементом* или *декрементом*;
* назначить переменной другое значение;
* Вставка или *Добавление* значения переменной в качестве последнего элемента в строке или массиве.

Переменные существуют и являются глобальными только в рамках экземпляра создавшего их приложения логики. Кроме того, они сохраняются между итерациями циклов в экземпляре приложения логики. При ссылке на переменную используйте имя переменной в качестве маркера, а не имя действия, которое является обычным способом ссылки на выходные данные действия.

> [!IMPORTANT]
> По умолчанию циклы в цикле for each выполняются параллельно. При использовании переменных в циклах выполните цикл [последовательно](../logic-apps/logic-apps-control-flow-loops.md#sequential-foreach-loop) , чтобы переменные возвращали прогнозируемые результаты.

## <a name="prerequisites"></a>Предварительные требования

* Подписка Azure. Если у вас нет подписки, [Зарегистрируйтесь, чтобы получить бесплатную учетную запись Azure](https://azure.microsoft.com/free/).

* Приложение логики, в котором нужно создать переменную

  Если вы не знакомы с приложениями логики, ознакомьтесь с [Azure Logic Apps?](../logic-apps/logic-apps-overview.md) и [Краткое руководство. Создание первого приложения логики](../logic-apps/quickstart-create-first-logic-app-workflow.md).

* [Триггер](../logic-apps/logic-apps-overview.md#logic-app-concepts) в качестве первого шага приложения логики

  Прежде чем добавлять действия для создания переменных и работы с ними, необходимо запустить приложение логики при помощи триггера.

<a name="create-variable"></a>

## <a name="initialize-variable"></a>Инициализация переменной

Вы можете создать переменную, а также объявить ее тип данных и исходное значение в рамках одного действия в приложении логики. Объявлять переменные можно только на глобальном уровне, а не в областях, условиях и циклах.

1. В [портал Azure](https://portal.azure.com) или Visual Studio откройте приложение логики в конструкторе приложений логики.

   В этом примере используются портал Azure и приложение логики с имеющимся триггером.

1. В приложении логики выполните одно из указанных ниже действий на том шаге, где требуется добавить переменную. 

   * Чтобы добавить действие на последнем шаге, выберите **новый шаг**.

     ![Снимок экрана, на котором показано действие "новый шаг", выбранное на странице "Конструктор приложений логики".](./media/logic-apps-create-variables-store-values/add-action.png)

   * Чтобы добавить действие между шагами, наведите указатель мыши на стрелку соединения, чтобы появился знак «плюс» ( **+** ). Щелкните знак «плюс», а затем выберите **Добавить действие**.

1. В разделе **Выберите действие** введите фильтр `variables` в поле поиска. В списке действия выберите **инициализировать переменную**.

   ![Выбор действия](./media/logic-apps-create-variables-store-values/select-initialize-variable-action.png)

1. Укажите эти сведения о переменной, как описано ниже.

   | Свойство | Обязательно | Значение |  Описание |
   |----------|----------|-------|--------------|
   | **имя**; | Да | <*имя переменной*> | Имя переменной |
   | **Тип** | Да | <*тип переменной*> | Тип данных для переменной |
   | **Значение** | Нет | <*начальное значение*> | Начальное значение для переменной <p><p>**Совет**. Указывать это значение необязательно, но рекомендуем сделать это, чтобы всегда знать начальное значение переменной. |
   |||||

   Пример:

   ![Инициализация переменной](./media/logic-apps-create-variables-store-values/initialize-variable.png)

1. Теперь продолжайте добавлять нужные действия. По завершении нажмите кнопку **Сохранить** на панели инструментов конструктора.

При переключении из конструктора в редактор представления кода ниже показано, как действие **инициализировать переменную** отображается в определении приложения логики, которое находится в формате НОТАЦИЯ объектов JavaScript (JSON):

```json
"actions": {
   "Initialize_variable": {
      "type": "InitializeVariable",
      "inputs": {
         "variables": [ {
               "name": "Count",
               "type": "Integer",
               "value": 0
          } ]
      },
      "runAfter": {}
   }
},
```

> [!NOTE]
> Хотя действие **инициализации переменной** имеет `variables` раздел, структурированный как массив, действие может создать только одну переменную за раз. Каждая новая переменная требует действия отдельной **инициализации переменной** .

Ниже представлены примеры других типов переменных.

*Строковая переменная*

```json
"actions": {
   "Initialize_variable": {
      "type": "InitializeVariable",
      "inputs": {
         "variables": [ {
               "name": "myStringVariable",
               "type": "String",
               "value": "lorem ipsum"
          } ]
      },
      "runAfter": {}
   }
},
```

*Логическая переменная*

```json
"actions": {
   "Initialize_variable": {
      "type": "InitializeVariable",
      "inputs": {
         "variables": [ {
               "name": "myBooleanVariable",
               "type": "Boolean",
               "value": false
          } ]
      },
      "runAfter": {}
   }
},
```

*Массив целых чисел*

```json
"actions": {
   "Initialize_variable": {
      "type": "InitializeVariable",
      "inputs": {
         "variables": [ {
               "name": "myArrayVariable",
               "type": "Array",
               "value": [1, 2, 3]
          } ]
      },
      "runAfter": {}
   }
},
```

*Массив строк*

```json
"actions": {
   "Initialize_variable": {
      "type": "InitializeVariable",
      "inputs": {
         "variables": [ {
               "name": "myArrayVariable",
               "type": "Array",
               "value": ["red", "orange", "yellow"]
          } ]
      },
      "runAfter": {}
   }
},
```

<a name="get-value"></a>

## <a name="get-the-variables-value"></a>Получение значения переменной

Чтобы получить содержимое переменной или сослаться на него, вы также можете использовать [функцию variables()](../logic-apps/workflow-definition-language-functions-reference.md#variables) в конструкторе приложений логики и редакторе кода. Ссылаясь на переменную, используйте в качестве токена ее имя, а не имя действия.

Например, это выражение получает элементы из переменной массива, [созданной ранее в этой статье](#append-value) , с помощью `variables()` функции. `string()`Функция возвращает содержимое переменной в строковом формате:`"1, 2, 3, red"`

```json
@{string(variables('myArrayVariable'))}
```

<a name="increment-value"></a>

## <a name="increment-variable"></a>Увеличение переменной 

Для увеличения или *увеличения* переменной по значению константы добавьте действие **инкремент переменной** в приложение логики. Это действие работает только с целочисленными и дробными переменными.

1. В конструкторе приложений логики на шаге, где необходимо увеличить существующую переменную, выберите **новый шаг**. 

   Допустим, это приложение логики уже содержит триггер и действие, создавшее переменную. Добавьте новое действие под этими шагами:

   ![Добавление действия](./media/logic-apps-create-variables-store-values/add-increment-variable-action.png)

   Чтобы добавить действие между существующими шагами, наведите указатель мыши на соединяющую стрелку. Появится знак "плюс" (+). Щелкните знак «плюс», а затем выберите **Добавить действие**.

1. В поле поиска введите фразу "увеличение переменной". В списке действия выберите **значение переменная приращения**.

   ![Выберите действие "Увеличение переменной"](./media/logic-apps-create-variables-store-values/select-increment-variable-action.png)

1. Укажите следующие сведения для увеличения переменной:

   | Свойство | Обязательно | Значение |  Описание |
   |----------|----------|-------|--------------|
   | **имя**; | Да | <*имя переменной*> | Имя переменной |
   | **Значение** | Нет | <*Приращение значения*> | Значение, используемое для увеличения переменной. Значение по умолчанию — единица. <p><p>**Совет**. Указывать это значение необязательно, но рекомендуем сделать это, чтобы всегда знать конкретное значение, на которое увеличивается переменная. |
   ||||

   Пример:

   ![Пример увеличения переменной](./media/logic-apps-create-variables-store-values/increment-variable-action-information.png)

1. По завершении нажмите кнопку **Сохранить** на панели инструментов конструктора.

Если переключиться из конструктора в редактор представления кода, то в определении приложения логики, который находится в формате JSON, отображается действие **Шаг приращения переменной** .

```json
"actions": {
   "Increment_variable": {
      "type": "IncrementVariable",
      "inputs": {
         "name": "Count",
         "value": 1
      },
      "runAfter": {}
   }
},
```

## <a name="example-create-loop-counter"></a>Пример: создание счетчика циклов

Переменные часто используются для подсчета повторений циклов. В этом примере показано, как создать и использовать переменные для этой цели, создав цикл, считающий вложения в электронном сообщении.

1. Создайте пустое приложение логики на портале Azure. Добавьте триггер, проверяющий наличие новых электронных сообщений и вложений.

   В этом примере используется триггер Outlook из Office 365 для события **Когда приходит новое электронное письмо**. Этот триггер можно настроить так, чтобы он срабатывал только при наличии вложений. Однако вы можете использовать любой соединитель, проверяющий наличие новых сообщений с вложениями, например соединитель Outlook.com.

1. Чтобы проверить наличие вложений и передать эти вложения в рабочий процесс приложения логики, выберите **Да** для этих свойств:

   * **Has Attachment** (С вложением)
   * **Включить вложения**

   ![Проверка и включение вложений](./media/logic-apps-create-variables-store-values/check-include-attachments.png)

1. Добавьте [действие **Инициализировать переменную**](#create-variable). Создайте целочисленную переменную с именем `Count` с нулевым начальным значением.

   ![Добавление действия "Инициализировать переменную"](./media/logic-apps-create-variables-store-values/initialize-variable.png)

1. Чтобы циклически пройти все вложения, добавьте цикл *for each* .

   1. В разделе действие **инициализации переменной** выберите **новый шаг**.

   1. В разделе **Выберите действие** выберите **Встроенный**. В поле поиска введите `for each` Фильтр поиска и выберите **для каждого из них**.

      ![Добавление цикла "for each"](./media/logic-apps-create-variables-store-values/add-loop.png)

1. В цикле щелкните поле **Выберите выходные данные из предыдущих шагов**. Когда появится список динамического содержимого, выберите **Вложения**.

   ![Выбор вложений](./media/logic-apps-create-variables-store-values/select-attachments.png)

   Свойство **вложения** передает массив с вложениями электронной почты из выходных данных триггера в цикл.

1. В цикле **for each** выберите **Добавить действие**.

   ![Выбор команды "Добавить действие"](./media/logic-apps-create-variables-store-values/add-action-2.png)

1. В поле поиска введите фразу "увеличение переменной". В списке действия выберите **значение переменная приращения**.

   > [!NOTE]
   > Убедитесь, что в цикле отображается действие **приращения переменной** . Если действие отображается за пределами цикла, перетащите действие в цикл.

1. В действии **Увеличение переменной** выберите в списке **Имя** переменную **Счетчик**.

   ![Выбор переменной "Счетчик"](./media/logic-apps-create-variables-store-values/add-increment-variable-example.png)

1. Добавьте в цикл любое действие, отправляющее вам количество вложений. Включите в это действие значение переменной **Счетчик**, например:

   ![Добавление действия, отправляющего результаты](./media/logic-apps-create-variables-store-values/send-email-results.png)

1. Сохраните приложение логики. На панели инструментов конструктора щелкните **Сохранить**.

### <a name="test-your-logic-app"></a>Тестирование приложения логики

1. Если приложение логики не включено, в меню приложения логики выберите **Обзор**. На панели инструментов выберите **включить**.

1. На панели инструментов конструктора приложений логики выберите **выполнить**. Так приложение логики будет запущено вручную.

1. Отправьте электронное сообщение с одним или несколькими вложениями по электронному адресу, используемому в этом примере.

   На этом шаге срабатывает триггер приложения логики, который создает и запускает экземпляр рабочего процесса приложения логики. В результате приложение логики отправляет вам сообщение или электронное письмо, в котором указывается количество вложений в отправленном сообщении.

При переключении из конструктора в редактор представления кода ниже показано, как отображается цикл **for each** вместе с действием **приращение переменной** в определении приложения логики, которое находится в формате JSON.

```json
"actions": {
   "For_each": {
      "type": "Foreach",
      "actions": {
         "Increment_variable": {
           "type": "IncrementVariable",
            "inputs": {
               "name": "Count",
               "value": 1
            },
            "runAfter": {}
         }
      },
      "foreach": "@triggerBody()?['Attachments']",
      "runAfter": {
         "Initialize_variable": [ "Succeeded" ]
      }
   }
},
```

<a name="decrement-value"></a>

## <a name="decrement-variable"></a>Переменная декремента

Чтобы *сократить или уменьшить* переменную по значению константы, выполните шаги по [увеличению переменной](#increment-value) , за исключением того, что вы найдете и выберите действие **декремента переменной** . Это действие работает только с целочисленными и дробными переменными.

Ниже перечислены свойства действия **Переменная декремента**.

| Свойство | Обязательно | Значение |  Описание |
|----------|----------|-------|--------------|
| **имя**; | Да | <*имя переменной*> | Имя уменьшаемой переменной | 
| **Значение** | Нет | <*Приращение значения*> | Значение для уменьшения переменной. Значение по умолчанию — единица. <p><p>**Совет**. Указывать это значение необязательно, но рекомендуем сделать это, чтобы всегда знать конкретное значение, на которое уменьшается переменная. |
||||| 

При переключении из конструктора в редактор представления кода ниже показано, как действие **декремента переменной** отображается в определении приложения логики, которое находится в формате JSON.

```json
"actions": {
   "Decrement_variable": {
      "type": "DecrementVariable",
      "inputs": {
         "name": "Count",
         "value": 1
      },
      "runAfter": {}
   }
},
```

<a name="assign-value"></a>

## <a name="set-variable"></a>Установка значения переменной

Чтобы назначить переменной другое значение, следуйте инструкциям по [увеличению переменной](#increment-value), но:

1. Найдите и выберите действие **Задание переменной** .

1. укажите имя переменной и нужное значение. Типы данных нового значения и переменной должны совпадать. Указывать значение обязательно, так как у этого действия нет значения по умолчанию.

Ниже перечислены свойства действия **Задать переменную**.

| Свойство | Обязательно | Значение |  Описание |
|----------|----------|-------|--------------|
| **имя**; | Да | <*имя переменной*> | Имя изменяемой переменной |
| **Значение** | Да | <*новое значение*> | Значение, которое требуется назначить переменной. Их типы данных должны совпадать. |
||||| 

> [!NOTE]
> Если вы не увеличиваете и не уменьшаете переменные, то изменение переменных в циклах *может* привести к неожиданным результатам, так как по умолчанию циклы выполняются параллельно. В таких случаях попробуйте включить последовательное выполнение циклов. Например, если вы хотите сослаться на значение переменной внутри цикла, а в начале и конце этого цикла ожидаются одинаковые значения, выполните следующие действия, чтобы изменить принцип работы цикла: 
>
> 1. В правом верхнем углу цикла нажмите кнопку с многоточием (**...**), а затем выберите **Параметры**.
> 
> 2. В разделе **Управление параллелизмом** измените значение параметра **Переопределить значения по умолчанию** на **Вкл**.
>
> 3. Перетащите ползунок **Степень параллелизма** на значение **1**.

При переключении из конструктора в редактор представления кода ниже показано, как действие **задать переменную** отображается в определении приложения логики в формате JSON. В этом примере `Count` Текущее значение переменной изменяется на другое.

```json
"actions": {
   "Initialize_variable": {
      "type": "InitializeVariable",
      "inputs": {
         "variables": [ {
               "name": "Count",
               "type": "Integer",
               "value": 0
          } ]
      },
      "runAfter": {}
   },
   "Set_variable": {
      "type": "SetVariable",
      "inputs": {
         "name": "Count",
         "value": 100
      },
      "runAfter": {
         "Initialize_variable": [ "Succeeded" ]
      }
   }
},
```

<a name="append-value"></a>

## <a name="append-to-variable"></a>Добавление к переменной

В переменные, в которых хранятся строки или массивы, можно вставлять или *добавлять* значения переменных в качестве последнего элемента строки или массива. Вы можете выполнить действия по [увеличению переменной](#increment-value), но: 

1. Найдите и выберите одно из следующих действий в зависимости от того, является ли переменная строкой или массивом: 

   * **Добавить к строковой переменной**
   * **Добавить к переменной массива** 

1. Укажите значение для добавления в качестве последнего элемента строки или массива. Это значение обязательно.

Ниже перечислены свойства действия **Добавление к...**

| Свойство | Обязательно | Значение |  Описание |
|----------|----------|-------|--------------|
| **имя**; | Да | <*имя переменной*> | Имя изменяемой переменной |
| **Значение** | Да | <*append-значение*> | Значение, которое требуется добавить. Оно может относиться к любому типу. |
|||||

При переключении из конструктора в редактор представления кода ниже показано, как в определении приложения логики, который находится в формате JSON, отображается действие **Добавить к переменной массива** . В этом примере создается массив, в конец которого затем добавляется новое значение. В результате получится обновленная переменная, содержащая следующий массив: `[1,2,3,"red"]`

```json
"actions": {
   "Initialize_variable": {
      "type": "InitializeVariable",
      "inputs": {
         "variables": [ {
            "name": "myArrayVariable",
            "type": "Array",
            "value": [1, 2, 3]
         } ]
      },
      "runAfter": {}
   },
   "Append_to_array_variable": {
      "type": "AppendToArrayVariable",
      "inputs": {
         "name": "myArrayVariable",
         "value": "red"
      },
      "runAfter": {
        "Initialize_variable": [ "Succeeded" ]
      }
   }
},
```

## <a name="next-steps"></a>Дальнейшие действия

* См. дополнительные сведения о [соединителях Logic Apps](../connectors/apis-list.md).
