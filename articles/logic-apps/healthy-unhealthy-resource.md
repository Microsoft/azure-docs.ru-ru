---
title: Настройка ведения журнала для мониторинга приложений логики в центре безопасности Azure
description: Отслеживайте работоспособность ресурсов Logic Apps в центре безопасности Azure, настроив ведение журнала диагностики.
services: logic-apps
ms.suite: integration
ms.reviewer: estfan, logicappspm
ms.topic: conceptual
ms.date: 12/07/2020
ms.openlocfilehash: 42b33a5b96de7334f8310b040052c633342f5e05
ms.sourcegitcommit: c27a20b278f2ac758447418ea4c8c61e27927d6a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/03/2021
ms.locfileid: "101712391"
---
# <a name="set-up-logging-to-monitor-logic-apps-in-azure-security-center"></a>Настройка ведения журнала для мониторинга приложений логики в центре безопасности Azure

При мониторинге Logic Appsных ресурсов в [центре безопасности Microsoft Azure](../security-center/security-center-introduction.md)можно просмотреть, [являются ли приложения логики политиками по умолчанию](#view-logic-apps-health-status). В Azure отображается состояние работоспособности Logic Apps ресурса после включения ведения журнала и правильной настройки назначения журналов. В этой статье объясняется, как настроить ведение журнала диагностики и убедиться, что все приложения логики являются работоспособными ресурсами.

> [!TIP]
> Чтобы узнать текущее состояние службы Logic Apps, ознакомьтесь со [страницей состояние Azure](https://status.azure.com/), в которой отображается состояние различных продуктов и служб в каждом доступном регионе.

## <a name="prerequisites"></a>Предварительные требования

* Подписка Azure. Если у вас нет подписки, [Создайте бесплатную учетную запись Azure](https://azure.microsoft.com/free/) перед началом работы.
* Существующие приложения логики с [включенным ведением журнала диагностики](#enable-diagnostic-logging).
* Рабочая область Log Analytics, которая необходима для включения ведения журнала для приложения логики. Если у вас нет рабочей области, сначала [Создайте рабочую область](../azure-monitor/logs/quick-create-workspace.md).

## <a name="enable-diagnostic-logging"></a>Включение ведения журналов диагностики

Прежде чем просматривать состояние работоспособности ресурсов для приложений логики, необходимо сначала [настроить ведение журнала диагностики](monitor-logic-apps-log-analytics.md). Если у вас уже есть рабочая область Log Analytics, вы можете включить ведение журнала при создании приложения логики или в существующих приложениях логики.

> [!TIP]
> По умолчанию рекомендуется включить журналы диагностики для Logic Apps. Однако вы управляете этим параметром для приложений логики. При включении журналов диагностики для приложений логики можно использовать сведения, помогающие анализировать инциденты безопасности.

### <a name="check-diagnostic-logging-setting"></a>Проверить параметр ведения журнала диагностики

Если вы не уверены, включено ли ведение журнала диагностики для приложений логики, можно проверить центр безопасности:

1. Войдите на [портал Azure](https://portal.azure.com).
1. В строке поиска введите и выберите **Центр безопасности**.
1. В меню панели мониторинга центра безопасности в разделе **Общие** выберите пункт **рекомендации**.
1. В таблице предложений по обеспечению безопасности найдите и выберите **включить аудит и ведение журнала** &gt; **диагностических журналов в Logic apps должны быть включены** в таблице элементов управления безопасностью.
1. На странице рекомендации разверните раздел действия по **исправлению** и проверьте параметры. Вы можете включить диагностику Logic Apps, выбрав **Быстрое исправление!** или следуя инструкциям по исправлению вручную.

## <a name="view-logic-apps-health-status"></a>Просмотр состояния работоспособности приложений логики

После [включения ведения журнала диагностики](#enable-diagnostic-logging)можно просмотреть состояние работоспособности приложений логики в центре безопасности.

1. Войдите на [портал Azure](https://portal.azure.com).
1. В строке поиска введите и выберите **Центр безопасности**.
1. В меню панели мониторинга центра безопасности в разделе **Общие** выберите пункт **Инвентаризация**.
1. На странице "Инвентаризация" отфильтруйте список активов, чтобы отображались только Logic Apps ресурсы. В меню Страница выберите **типы ресурсов** &gt; **приложения логики**.

   Счетчик **неработоспособные ресурсы** показывает количество приложений логики, которые центр безопасности считает неработоспособным.
1.  В списке ресурсов приложений логики ознакомьтесь со столбцом **рекомендации** . Чтобы проверить сведения о работоспособности для конкретного приложения логики, выберите имя ресурса или нажмите кнопку с многоточием (**...**) &gt; . **Просмотр ресурса**.
1.  Чтобы устранить потенциальные проблемы работоспособности ресурсов, выполните действия, указанные для приложений логики.

Если ведение журнала диагностики уже включено, возможно, возникла ошибка в назначении для журналов. Узнайте [, как устранить проблемы с разными назначениями ведения журнала диагностики](#fix-diagnostic-logging-for-logic-apps).

## <a name="fix-diagnostic-logging-for-logic-apps"></a>Исправление журнала диагностики для приложений логики

Если [приложения логики перечислены как неработоспособные в центре безопасности](#view-logic-apps-health-status), откройте приложение логики в представлении кода в портал Azure или с помощью Azure CLI. Затем проверьте целевую конфигурацию журналов диагностики: [Azure log Analytics](#log-analytics-and-event-hubs-destinations), [концентраторы событий Azure](#log-analytics-and-event-hubs-destinations)или [учетную запись хранения Azure](#storage-account-destination).

### <a name="log-analytics-and-event-hubs-destinations"></a>Log Analytics и назначения концентраторов событий

Если вы используете Log Analytics или концентраторы событий в качестве назначения для журналов диагностики Logic Apps, проверьте следующие параметры. 

1. Чтобы убедиться, что включены журналы диагностики, убедитесь, что `logs.enabled` для поля параметры диагностики установлено значение `true` . 
1. Чтобы убедиться, что в качестве назначения не задана учетная запись хранения, убедитесь, что `storageAccountId` для поля задано значение `false` .

Пример.

```json
"allOf": [
    {
        "field": "Microsoft.Insights/diagnosticSettings/logs.enabled",
        "equals": "true"
    },
    {
        "anyOf": [
            {
                "field": "Microsoft.Insights/diagnosticSettings/logs[*].retentionPolicy.enabled",
                "notEquals": "true"
            },
            {
                "field": "Microsoft.Insights/diagnosticSettings/storageAccountId",
                "exists": false
            }
        ]
    }
] 
```

### <a name="storage-account-destination"></a>Назначение учетной записи хранения

Если вы используете учетную запись хранения в качестве места назначения для журналов диагностики Logic Apps, проверьте следующие параметры.

1. Чтобы убедиться, что включены журналы диагностики, убедитесь, что `logs.enabled` для поля параметры диагностики установлено значение `true` .
1. Чтобы убедиться, что вы включили политику хранения для журналов диагностики, убедитесь, что `retentionPolicy.enabled` поле имеет значение `true` .
1. Чтобы убедиться, что срок хранения 0-365 дней установлен, установите `retentionPolicy.days` для поля значение, включающее число от 0 до 365.

```json
"allOf": [
    {
        "field": "Microsoft.Insights/diagnosticSettings/logs[*].retentionPolicy.enabled",
        "equals": "true"
    },
    {
        "anyOf": [
            {
                "field": "Microsoft.Insights/diagnosticSettings/logs[*].retentionPolicy.days",
                "equals": "0"
            },
            {
                "field": "Microsoft.Insights/diagnosticSettings/logs[*].retentionPolicy.days",
                "equals": "[parameters('requiredRetentionDays')]"
            }
          ]
    },
    {
        "field": "Microsoft.Insights/diagnosticSettings/logs.enabled",
        "equals": "true"
    }
]
```