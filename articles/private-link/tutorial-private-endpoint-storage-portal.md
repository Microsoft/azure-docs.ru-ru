---
title: Руководство по Подключение к учетной записи хранения с помощью частной конечной точки Azure
titleSuffix: Azure Private Link
description: Начните работу с этим руководством, используя частную конечную точку Azure для подключения к учетной записи хранения в частном порядке.
author: asudbring
ms.author: allensu
ms.service: private-link
ms.topic: tutorial
ms.date: 9/25/2020
ms.openlocfilehash: eefef0eb61df9aa0597206b537f3d58e8b8b3213
ms.sourcegitcommit: f28ebb95ae9aaaff3f87d8388a09b41e0b3445b5
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/29/2021
ms.locfileid: "96484827"
---
# <a name="tutorial-connect-to-a-storage-account-using-an-azure-private-endpoint"></a>Руководство по Подключение к учетной записи хранения с помощью частной конечной точки Azure

Частная конечная точка Azure — ключевой компонент для построения Приватного канала в Azure. Это позволяет ресурсам Azure, таким как виртуальные машины (ВМ), обмениваться данными с ресурсами Приватного канала в частном порядке.

В этом руководстве описано следующее:

> [!div class="checklist"]
> * Создание виртуальной сети и узла бастиона.
> * Создайте виртуальную машину.
> * Создайте учетную запись хранения с частной конечной точкой.
> * Проверьте подключение к частной конечной точке учетной записи хранения.

Если у вас еще нет подписки Azure, [создайте бесплатную учетную запись](https://azure.microsoft.com/free/?WT.mc_id=A261C142F), прежде чем начинать работу.

## <a name="prerequisites"></a>Предварительные требования

* Подписка Azure

## <a name="sign-in-to-azure"></a>Вход в Azure

Войдите на [портал Azure](https://portal.azure.com).

## <a name="create-a-virtual-network-and-bastion-host"></a>Создание виртуальной сети и узла бастиона

В этом разделе вы создадите виртуальную сеть, подсеть и узел бастиона. 

Для безопасного подключения к виртуальной машине с целью тестирования частной конечной точки будет использоваться узел бастиона.

1. Слева вверху экрана щелкните **Создать ресурс > Сеть > Виртуальная сеть** или выполните поиск по фразе **виртуальная сеть**.

2. В подменю **Создать виртуальную сеть** введите или выберите следующую информацию на вкладке **Основные сведения**:

    | **Параметр**          | **Значение**                                                           |
    |------------------|-----------------------------------------------------------------|
    | **Сведения о проекте**  |                                                                 |
    | Подписка     | Выбор подписки Azure                                  |
    | Группа ресурсов   | Выберите **MyResourceGroup**. |
    | **Сведения об экземпляре** |                                                                 |
    | Имя             | Введите **myVNet**.                                    |
    | Регион           | Выберите **Восточная часть США**. |

3. Откройте вкладку **IP-адрес** или нажмите кнопку **Далее: IP-адреса** внизу страницы.

4. На вкладке **IP-адреса** укажите следующие сведения:

    | Параметр            | Значение                      |
    |--------------------|----------------------------|
    | Диапазон IPv4-адресов | Введите **10.1.0.0/16**. |

5. В разделе **Имя подсети** выберите **по умолчанию**.

6. В окне **Изменение подсети** введите следующие сведения:

    | Параметр            | Значение                      |
    |--------------------|----------------------------|
    | Имя подсети | Введите **mySubnet**. |
    | Диапазон адресов подсети | Введите **10.1.0.0/24**. |

7. Щелкните **Сохранить**.

8. Перейдите на вкладку **Безопасность**.

9. В разделе **BastionHost** выберите **Включить**. Введите такие сведения:

    | Параметр            | Значение                      |
    |--------------------|----------------------------|
    | Имя бастиона | Введите **myBastionHost**. |
    | Адресное пространство AzureBastionSubnet | Введите **10.1.1.0/24**. |
    | Общедоступный IP-адрес | Выберите **Создать**. </br> В поле **Имя** введите **myBastionIP**. </br> Щелкните **ОК**. |


8. Перейдите на вкладку **Просмотр и создание** или нажмите кнопку **Просмотр и создание**.

9. Нажмите кнопку **Создать**.

## <a name="create-a-virtual-machine"></a>Создание виртуальной машины

В этом разделе вы создадите виртуальную машину, которая будет использоваться для тестирования частной конечной точки.


1. В левой верхней части портала выберите **Создать ресурс** > **Вычисления** > **Виртуальная машина** или выполните поиск по словам **виртуальная машина** в поле поиска.
   
2. В разделе **Создание виртуальной машины** на вкладке **Основные сведения** укажите следующее.

    | Параметр | Значение                                          |
    |-----------------------|----------------------------------|
    | **Сведения о проекте** |  |
    | Подписка | Выбор подписки Azure |
    | Группа ресурсов | Выберите **MyResourceGroup**. |
    | **Сведения об экземпляре** |  |
    | Имя виртуальной машины | Введите **myVM**. |
    | Регион | Выберите **Восточная часть США**. |
    | Параметры доступности | Выберите **Избыточность инфраструктуры не требуется**. |
    | Образ — | Выберите **Windows Server 2019 Datacenter — Gen1** |
    | Точечный экземпляр Azure | Выберите **Нет**. |
    | Размер | Выберите размер виртуальной машины или подтвердите значение по умолчанию. |
    | **Учетная запись администратора** |  |
    | Имя пользователя | Введите имя пользователя. |
    | Пароль | Введите пароль. |
    | Подтверждение пароля | Введите пароль еще раз. |

3. Выберите вкладку **Сеть** или **Далее: диски**, затем **Далее: сеть**.
  
4. На вкладке "Сеть" укажите следующее.

    | Параметр | Значение |
    |-|-|
    | **Сетевой интерфейс** |  |
    | Виртуальная сеть | **myVNet** |
    | Подсеть | **mySubnet** |
    | Общедоступный IP-адрес | Выберите **Отсутствует**. |
    | Сетевая группа безопасности сетевого адаптера | **Основной**|
    | Общедоступные входящие порты | Выберите **Отсутствует**. |
   
5. Выберите **Review + create** (Просмотреть и создать). 
  
6. Проверьте параметры, а затем нажмите кнопку **Создать**.

## <a name="create-storage-account-with-a-private-endpoint"></a>Создание учетной записи хранения с помощью частной конечной точки

В этом разделе вы создадите учетную запись хранения и настроите закрытую конечную точку.

1. В меню слева выберите **Создать ресурс** > **Хранилище** > **Учетная запись хранения** или выполните поиск по словам **учетная запись хранения** в поле поиска.

2. На вкладке **Основные сведения** в окне **Создание учетной записи хранения** введите или выберите следующие сведения:

    | Параметр | Значение                                          |
    |-----------------------|----------------------------------|
    | **Сведения о проекте** |  |
    | Подписка | Выбор подписки Azure |
    | Группа ресурсов | Выберите **MyResourceGroup**. |
    | **Сведения об экземпляре** |  |
    | Имя учетной записи хранения | Введите **mystorageaccount**. Если имя недоступно, введите уникальное имя. |
    | Расположение | Выберите **Восточная часть США**. |
    | Производительность | Оставьте значение по умолчанию **Стандартная**. |
    | Тип учетной записи | Оставьте значение по умолчанию **Storage (general purpose v2)** (Хранилище (общего назначения версии 2)). |
    | Репликация| Оставьте значение по умолчанию **Read-access geo-redundant storage (RA-GRS)** (Геоизбыточное хранилище с доступом на чтение (RA-GRS)). |
   
3. Выберите вкладку **Сеть** или нажмите кнопку **Далее: Сеть**.

4. На вкладке **Сеть** в разделе **Метод подключения** выберите **Частная конечная точка**.

5. В окне **Частная конечная точка** выберите **Добавить**.

6. В окне **Создание частной конечной точки** введите или выберите следующие сведения:

    | Параметр | Значение                                          |
    |-----------------------|----------------------------------|
    | Подписка | Выбор подписки Azure |
    | Группа ресурсов | Выберите **MyResourceGroup**. |
    | Расположение | Выберите **Восточная часть США**. |
    | Имя | Введите **myPrivateEndpoint**. |
    | Подресурс хранилища | Оставьте значение по умолчанию **blob** (большой двоичный объект) |
    | **Сеть** |  |
    | Виртуальная сеть | Выберите **myVNet**. |
    | Подсеть | Выберите **mySubnet**. |
    | **Интеграция с частной зоной DNS** |
    | Интеграция с частной зоной DNS | Оставьте значение по умолчанию **Да**. |
    | Частная зона DNS | Оставьте значение по умолчанию "(New) privatelink.blob.core.windows.net" |

7. Щелкните **ОК**.

8. Выберите **Review + create** (Просмотреть и создать).

9. Нажмите кнопку **Создать**.

10. В области навигации слева выберите **Группы ресурсов**.

11. Выберите **myResourceGroup**.

12. Выберите учетную запись хранения, созданную на предыдущих шагах.

13. В разделе **Параметры** учетной записи хранения выберите параметр **Ключи доступа**.

14. Скопируйте содержимое поля **Строка подключения** для **key1**.

## <a name="test-connectivity-to-private-endpoint"></a>Проверка подключения к частной конечной точке

В этом разделе вы будете использовать виртуальную машину, созданную на предыдущем шаге, для подключения к учетной записи хранения через частную конечную точку.

1. В области навигации слева выберите **Группы ресурсов**.

2. Выберите **myResourceGroup**.

3. Выберите **myVM**.

4. На обзорной странице для **myVM** выберите **Подключиться**, а затем — **Бастион**.

5. Нажмите синюю кнопку **Использовать Бастион**.

6. Введите имя пользователя и пароль, указанные при создании виртуальной машины.

7. После подключения откройте на сервере Windows PowerShell.

8. Введите `nslookup <storage-account-name>.blob.core.windows.net`. Замените **\<storage-account-name>** именем учетной записи хранения, созданной на предыдущих шагах.  Вы получите сообщение, аналогичное показанному ниже:

    ```powershell
    Server:  UnKnown
    Address:  168.63.129.16

    Non-authoritative answer:
    Name:    mystorageaccount8675.privatelink.blob.core.windows.net
    Address:  10.1.0.5
    Aliases:  mystorageaccount8675.blob.core.windows.net
    ```

    Для имени учетной записи хранения возвращен частный IP-адрес **10.1.0.5**.  Этот адрес находится в подсети виртуальной сети, созданной ранее.

9. Установите [Обозреватель службы хранилища Microsoft Azure](../vs-azure-tools-storage-manage-with-storage-explorer.md?tabs=windows&toc=%2fazure%2fstorage%2fblobs%2ftoc.json) на виртуальной машине.

10. После установки **Обозревателя службы хранилища Microsoft Azure** нажмите кнопку **Готово**.  Оставьте флажок установленным, чтобы открыть приложение.

11. На экране **Подключение к службе хранилища Azure** выберите **Использовать строку подключения**.

12. Выберите **Далее**.

13. Введите имя учетной записи хранения, использованное ранее, в поле **Отображаемое имя**.

14. В поле **Строка подключения** вставьте строку подключения из учетной записи хранения, скопированную на предыдущих шагах.

15. Выберите **Далее**.

16. Проверьте правильность используемых параметров в разделе **Сводка по соединению**.  

17. Выберите **Подключиться**.

18. Закройте подключение к **myVM**.

## <a name="clean-up-resources"></a>Очистка ресурсов

Если вы не собираетесь продолжать использовать это приложение, удалите виртуальную сеть, виртуальную машину и учетную запись хранения, выполнив следующие действия.

1. В меню слева выберите **Группы ресурсов**.

2. Выберите **myResourceGroup**.

3. Выберите **Удалить группу ресурсов**.

4. В поле **ВВЕДИТЕ ИМЯ ГРУППЫ РЕСУРСОВ** введите **myResourceGroup**.

5. Выберите команду **Удалить**.

## <a name="next-steps"></a>Дальнейшие действия

Создание службы Приватного канала:
> [!div class="nextstepaction"]
> [Создание службы "Приватный канал"](create-private-link-service-portal.md)