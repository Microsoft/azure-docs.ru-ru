---
title: Что такое служба частной связи Azure?
description: Сведения о службе частной связи Azure.
services: private-link
author: sumeetmittal
ms.service: private-link
ms.topic: conceptual
ms.date: 09/16/2019
ms.author: sumi
ms.openlocfilehash: 7983a80da8a5ca9d900e44515b5e078cc9d70d79
ms.sourcegitcommit: 910a1a38711966cb171050db245fc3b22abc8c5f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "98684192"
---
# <a name="what-is-azure-private-link-service"></a>Что такое служба частной связи Azure?

Служба "Приватный канал" Azure — это ссылка на вашу собственную службу, которая работает на базе Приватного канала Azure. Служба, выполняющаяся на [Load Balancer (цен. Категория "Стандартный") Azure](../load-balancer/load-balancer-overview.md) , может быть включена для доступа к частным каналам, чтобы пользователи службы могли получить к ней доступ в частном порядке из своих собственных виртуальных сетей. Ваши клиенты могут создать частную конечную точку в своей виртуальной сети и связать ее с этой службой. В этой статье описываются основные понятия, связанные со стороны поставщика услуг. 

:::image type="content" source="./media/private-link-service-overview/consumer-provider-endpoint.png" alt-text="Рабочий процесс службы частной связи" border="true":::

*Рисунок. Служба частной связи Azure.*

## <a name="workflow"></a>Рабочий процесс

![Рабочий процесс службы частной связи](media/private-link-service-overview/private-link-service-workflow.png)


*Рисунок. Рабочий процесс службы частной связи Azure.*

### <a name="create-your-private-link-service"></a>Создание службы частной связи

- Настройте приложение для запуска на основе стандартной подсистемы балансировки нагрузки в виртуальной сети. Если вы уже настроили приложение за стандартную подсистему балансировки нагрузки, этот шаг можно пропустить.   
- Создайте службу частной связи, ссылающуюся на подсистему балансировки нагрузки выше. В процессе выбора подсистемы балансировки нагрузки выберите IP-конфигурацию переднего плана, в которой требуется получить трафик. Выберите подсеть для IP-адресов NAT для службы частной связи. Рекомендуется, чтобы в подсети было доступно по крайней мере восемь IP-адресов NAT. Весь трафик потребителей поступает из этого пула частных IP-адресов поставщику услуг. Выберите соответствующие свойства и параметры для службы "Частная связь".    

    > [!NOTE]
    > Служба "Частная связь Azure" поддерживается только в Load Balancer (цен. категория "Стандартный"). 
    
### <a name="share-your-service"></a>Предоставление общего доступа к службе

После создания службы частной связи Azure создаст глобально уникальный именованный моникер с именем Alias (псевдоним) на основе имени, которое вы задаст для службы. Вы можете совместно использовать псевдоним или URI ресурса службы с клиентами в автономном режиме. Потребители могут запускать подключение к частной ссылке с помощью псевдонима или URI ресурса.
 
### <a name="manage-your-connection-requests"></a>Управление запросами на подключение

После того как потребитель инициирует подключение, поставщик услуг может принять или отклонить запрос на подключение. Все запросы на подключение будут перечислены в свойстве **приватиндпоинтконнектионс** в службе частной связи.
 
### <a name="delete-your-service"></a>Удаление службы

Если служба закрытых ссылок больше не используется, ее можно удалить. Однако перед удалением службы убедитесь, что с ней не связаны частные конечные точки. Вы можете отклонить все подключения и удалить службу.

## <a name="properties"></a>Свойства

Служба частной связи задает следующие свойства: 

|Свойство |Пояснение  |
|---------|---------|
|Состояние подготовки (provisioningState)  |Свойство только для чтения, которое содержит текущее состояние подготовки для службы закрытых ссылок. Применимые состояния подготовки: "Удаление; Ошибок Успешно Идет обновление ". Если состояние подготовки — "успешно", вы успешно подготовили службу частной связи.        |
|Псевдоним (псевдоним)     | Псевдоним — это глобально уникальная строка, доступная только для чтения для вашей службы. Он позволяет маскировать данные клиента для службы и в то же время создает удобное для общего доступа имя службы. При создании службы частной связи Azure создает псевдоним для вашей службы, к которому можно предоставить доступ своим клиентам. Клиенты могут использовать этот псевдоним для запроса подключения к службе.          |
|Видимость (видимость)     | Видимость — это свойство, которое управляет параметрами экспозиции для службы частной ссылки. Поставщики услуг могут ограничить доступ к своим службам по подпискам с разрешениями на управление доступом на основе ролей Azure (Azure RBAC), ограниченный набор подписок или все подписки Azure.          |
|Автоматическое утверждение (Автоутверждение)    |   Автоматическое утверждение управляет автоматическим доступом к службе частной ссылки. Подписки, указанные в списке автоматических утверждений, утверждаются автоматически при запросе соединения от частных конечных точек в этих подписках.          |
|Load Balancer многоинтерфейсной IP-конфигурации (Лоадбаланцерфронтендипконфигуратионс)    |    Служба частной связи привязана к интерфейсному IP-адресу Load Balancer (цен. категория "Стандартный"). Весь трафик, предназначенный для службы, будет достигнут на интерфейсе SLB. Можно настроить правила SLB, чтобы направить трафик в соответствующие серверные пулы, в которых выполняются приложения. Конфигурации внешнего IP-адреса балансировщика нагрузки отличаются от конфигураций IP-адресов NAT.      |
|IP-конфигурация NAT (ipConfigurations)    |    Это свойство относится к IP-конфигурации NAT (преобразование сетевых адресов) для службы закрытых ссылок. IP-адрес NAT можно выбрать из любой подсети в виртуальной сети поставщика услуг. Служба частной связи выполняет преобразование NAT на стороне назначения по трафику частной связи. Это гарантирует отсутствие конфликта IP-адресов между исходным (на стороне потребителя) и адресным пространством (поставщиком услуг). На стороне назначения (на стороне поставщика услуг) IP-адрес NAT будет отображаться как исходный IP для всех пакетов, полученных службой, и IP-адреса назначения для всех пакетов, отправляемых службой.       |
|Подключения к частным конечным точкам (Приватиндпоинтконнектионс)     |  Это свойство перечисляет частные конечные точки, подключающиеся к службе частной связи. Несколько частных конечных точек могут подключаться к одной и той же службе частной связи, и поставщик услуг может управлять состоянием отдельных частных конечных точек.        |
|Прокси-сервер TCP версии 2 (Енаблепроксипротокол)     |  Это свойство позволяет поставщику услуг использовать TCP-прокси версии 2 для получения сведений о подключении к потребителю службы. Поставщик услуг отвечает за настройку конфигураций получателей, чтобы иметь возможность проанализировать заголовок протокола прокси версии 2.        |
|||


### <a name="details"></a>Сведения

- Доступ к службе Private Link можно получить из утвержденных частных конечных точек в любом общедоступном регионе. Частная конечная точка может быть достигнута из той же виртуальной сети, с использованием виртуальных сетей, глобально равноправных виртуальных сетей и локальных, с помощью частных подключений VPN или ExpressRoute. 
 
- При создании службы частной связи создается сетевой интерфейс для жизненного цикла ресурса. Этот интерфейс не может управляться клиентом.
 
- Служба частной связи должна быть развернута в том же регионе, что и виртуальная сеть и Load Balancer (цен. категория "Стандартный").  
 
- К одной частной службе ссылок можно получить доступ из нескольких частных конечных точек, принадлежащих различным виртуальных сетей, подпискам и/или Active Directory клиентам. Соединение устанавливается через рабочий процесс подключения. 
 
- На одном Load Balancer (цен. категория "Стандартный") можно создать несколько служб частной связи, используя разные конфигурации IP-адресов внешнего интерфейса. Существует ряд ограничений на количество служб, которые можно создать на Load Balancer (цен. категория "Стандартный") и на подписку. Дополнительные сведения см. в разделе  [Ограничения сети](../azure-resource-manager/management/azure-subscription-service-limits.md#networking-limits).
 
- Служба частной связи может иметь несколько связанных с ней конфигураций IP-адресов NAT. При выборе нескольких конфигураций IP-адресов NAT поставщики услуг могут масштабировать их. Сейчас поставщики услуг могут назначить до восьми IP-адресов NAT на службу частных ссылок. С каждым IP-адресом NAT можно назначить дополнительные порты для подключений TCP и, таким же, масштабировать их. После добавления нескольких IP-адресов NAT в службу частной связи вы не сможете удалить IP-адреса NAT. Это делается для того, чтобы гарантировать, что активные подключения не будут затронуты при удалении IP-адресов NAT.


## <a name="alias"></a>Псевдоним

**Псевдоним** — это глобально уникальное имя для службы. Он позволяет маскировать данные клиента для службы и в то же время создает удобное для общего доступа имя службы. При создании службы частной связи Azure создает псевдоним для вашей службы, к которому можно предоставить доступ своим клиентам. Клиенты могут использовать этот псевдоним для запроса подключения к службе.

Псевдоним состоит из трех частей: *prefix*. *Идентификатор GUID*. *Суффикс*

- Prefix — имя службы. Вы можете выбрать собственный префикс. После создания псевдонима нельзя изменить, поэтому выберите соответствующий префикс.  
- Идентификатор GUID будет предоставляться платформой. Это позволяет сделать имя глобально уникальным. 
- Суффикс добавляется Azure: *Region*. Azure. привателинксервице 

Полный псевдоним:  *prefix*. {GUID}. *регион*. Azure. привателинксервице  

## <a name="control-service-exposure"></a>Предоставление доступа к службе

Служба частной связи предоставляет параметры для управления раскрытием службы с помощью параметра "видимость". Вы можете сделать службу закрытой для использования из разных виртуальных сетей (только разрешения RBAC Azure), ограничить доступ к ограниченному набору подписок, которым вы доверяете, или сделать его общедоступным, чтобы все подписки Azure могли запрашивать подключения к службе Private Link. Параметры видимости позволяют решить, может ли потребитель подключиться к службе. 

## <a name="control-service-access"></a>Управление доступом к службе

Потребители, у которых есть возможность получить доступ к службе частной связи (управляется параметром видимости), могут создать закрытую конечную точку в своих виртуальных сетей и запросить подключение к службе частной связи. Подключение к частной конечной точке будет создано в состоянии "ожидание" в объекте службы частной ссылки. Поставщик услуг отвечает за взаимодействие с запросом на подключение. Можно либо утвердить подключение, отклонить подключение, либо удалить подключение. Только утвержденные подключения могут передавать трафик в службу Private Link.

Действие по утверждению подключений можно автоматизировать с помощью свойства автоматического утверждения в службе Private Link. Автоматическое утверждение позволяет поставщикам услуг предварительно утверждать набор подписок для автоматического доступа к их службе. Клиентам потребуется предоставить доступ к своим подпискам в автономном режиме, чтобы поставщики услуг могли добавить их в список автоматического утверждения. Автоматическое утверждение является подмножеством массива видимости. Видимость управляет параметрами экспозиции, в то время как автоматическое утверждение управляет параметрами утверждения для службы. Если клиент запрашивает подключение из подписки в списке автоматического утверждения, подключение автоматически утверждается и подключение устанавливается. Поставщикам услуг больше не требуется вручную утверждать запрос. С другой стороны, если клиент запрашивает соединение из подписки в массиве видимости, а не в массиве автоматического утверждения, запрос будет достигнут поставщик услуг, но поставщику услуг необходимо вручную утвердить подключения.

## <a name="getting-connection-information-using-tcp-proxy-v2"></a>Получение сведений о подключении с помощью прокси-сервера TCP версии 2

При использовании службы частной связи исходный IP-адрес пакетов, поступающих от частной конечной точки, является преобразованием сетевых адресов (NAT) на стороне поставщика услуг с помощью IP-адреса NAT, выделенного из виртуальной сети поставщика. Таким образом, приложения получают выделенный IP-адрес NAT вместо действительного исходного IP-адреса потребителей службы. Если приложению требуется фактический исходный IP-адрес от стороны клиента, можно включить протокол прокси-сервера для службы и получить сведения из заголовка протокола прокси-сервера. Кроме исходного IP-адреса, заголовок протокола прокси также содержит LinkID для закрытой конечной точки. Сочетание исходного IP-адреса и LinkID может помочь поставщикам служб однозначно идентифицировать своих потребителей. Дополнительные сведения о протоколе прокси см. [здесь](https://www.haproxy.org/download/1.8/doc/proxy-protocol.txt). 

Эти сведения кодируются с помощью пользовательского вектора длины типа "Длина-значение" (TLV) следующим образом:

Пользовательские сведения о TLV:

|Поле |Длина (октетов)  |Описание  |
|---------|---------|----------|
|Type  |1        |PP2_TYPE_AZURE (0xEE)|
|Длина  |2      |Длина значения|
|Значение  |1     |PP2_SUBTYPE_AZURE_PRIVATEENDPOINT_LINKID (0x01)|
|  |4        |UINT32 (4 байта), представляющее LINKID для закрытой конечной точки. Кодировка в формате с прямым порядком байтов.|

 > [!NOTE]
 > Поставщик услуг несет ответственность за то, чтобы служба, использующая стандартную подсистему балансировки нагрузки, была настроена на анализ заголовка протокола прокси-сервера согласно [спецификации](https://www.haproxy.org/download/1.8/doc/proxy-protocol.txt) , если протокол прокси-сервера включен в службе частной связи. Запрос завершится ошибкой, если в службе частной связи включен параметр протокола прокси, но служба поставщика служб не настроена для синтаксического анализа заголовка. Аналогичным образом запрос завершится ошибкой, если служба поставщика услуг ожидает заголовок протокола прокси, пока этот параметр не включен в службе частной связи. После включения параметра протокола прокси заголовок прокси-протокола также будет включен в пробы работоспособности HTTP/TCP с узла на внутренние виртуальные машины, даже если в заголовке не будет сведений о клиенте. 

## <a name="limitations"></a>Ограничения

Ниже перечислены известные ограничения при использовании службы Private Link.
- Поддерживается только в Load Balancer (цен. категория "Стандартный") 
- Поддерживает только трафик IPv4
- Поддерживает только трафик TCP и UDP

## <a name="next-steps"></a>Дальнейшие действия
- [Создание службы частной связи с помощью Azure PowerShell](create-private-link-service-powershell.md)
- [Создание службы частной связи с помощью Azure CLI](create-private-link-service-cli.md)
