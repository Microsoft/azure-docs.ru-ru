---
title: Учебник. Подключение к серверу SQL Azure с использованием частной конечной точки Azure с помощью портала Azure
description: Из этого учебника вы узнаете, как создать сервер SQL Azure с частной конечной точкой с помощью портала Azure.
services: private-link
author: asudbring
ms.service: private-link
ms.topic: tutorial
ms.date: 10/20/2020
ms.author: allensu
ms.custom: fasttrack-edit
ms.openlocfilehash: 8bb227bdc4bbcdf986c2ed64e1f89e1dfa289b83
ms.sourcegitcommit: f28ebb95ae9aaaff3f87d8388a09b41e0b3445b5
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/30/2021
ms.locfileid: "102554978"
---
# <a name="tutorial-connect-to-an-azure-sql-server-using-an-azure-private-endpoint---azure-portal"></a>Руководство. Подключение к серверу SQL Azure с использованием частной конечной точки Azure с помощью портала Azure

Частная конечная точка Azure — ключевой компонент для построения Приватного канала в Azure. Это позволяет ресурсам Azure, таким как виртуальные машины (ВМ), обмениваться данными с ресурсами Приватного канала в частном порядке.

В этом руководстве описано следующее:

> [!div class="checklist"]
> * Создание виртуальной сети и узла бастиона.
> * Создайте виртуальную машину.
> * Создание Azure SQL Server и частной конечной точки.
> * Проверка подключения к частной конечной точке SQL Server.

## <a name="prerequisites"></a>Предварительные требования

* Учетная запись Azure с активной подпиской. [Создайте учетную запись](https://azure.microsoft.com/free/?WT.mc_id=A261C142F) бесплатно.

## <a name="sign-in-to-azure"></a>Вход в Azure

Войдите на портал Azure по адресу https://portal.azure.com.


## <a name="create-a-virtual-network-and-bastion-host"></a>Создание виртуальной сети и узла бастиона

В этом разделе вы создадите виртуальную сеть, подсеть и узел бастиона. 

Для безопасного подключения к виртуальной машине с целью тестирования частной конечной точки будет использоваться узел бастиона.

1. Слева вверху экрана щелкните **Создать ресурс > Сеть > Виртуальная сеть** или выполните поиск по фразе **виртуальная сеть**.

2. В подменю **Создать виртуальную сеть** введите или выберите следующую информацию на вкладке **Основные сведения**:

    | **Параметр**          | **Значение**                                                           |
    |------------------|-----------------------------------------------------------------|
    | **Сведения о проекте**  |                                                                 |
    | Подписка     | Выбор подписки Azure                                  |
    | Группа ресурсов   | Выберите **CreateSQLEndpointTutorial-rg** |
    | **Сведения об экземпляре** |                                                                 |
    | Имя             | Введите **myVNet**.                                    |
    | Регион           | Выберите **Восточная часть США**. |

3. Откройте вкладку **IP-адрес** или нажмите кнопку **Далее: IP-адреса** внизу страницы.

4. На вкладке **IP-адреса** укажите следующие сведения:

    | Параметр            | Значение                      |
    |--------------------|----------------------------|
    | Диапазон IPv4-адресов | Введите **10.1.0.0/16**. |

5. В разделе **Имя подсети** выберите **по умолчанию**.

6. В окне **Изменение подсети** введите следующие сведения:

    | Параметр            | Значение                      |
    |--------------------|----------------------------|
    | Имя подсети | Введите **mySubnet**. |
    | Диапазон адресов подсети | Введите **10.1.0.0/24**. |

7. Щелкните **Сохранить**.

8. Перейдите на вкладку **Безопасность**.

9. В разделе **BastionHost** выберите **Включить**. Введите такие сведения:

    | Параметр            | Значение                      |
    |--------------------|----------------------------|
    | Имя бастиона | Введите **myBastionHost**. |
    | Адресное пространство AzureBastionSubnet | Введите **10.1.1.0/24**. |
    | Общедоступный IP-адрес | Выберите **Создать**. </br> В поле **Имя** введите **myBastionIP**. </br> Щелкните **ОК**. |


8. Перейдите на вкладку **Просмотр и создание** или нажмите кнопку **Просмотр и создание**.

9. Нажмите кнопку **Создать**.

## <a name="create-a-virtual-machine"></a>Создание виртуальной машины

В этом разделе вы создадите виртуальную машину, которая будет использоваться для тестирования частной конечной точки.

1. В левой верхней части портала выберите **Создать ресурс** > **Вычисления** > **Виртуальная машина** или выполните поиск по словам **виртуальная машина** в поле поиска.
   
2. В разделе **Создание виртуальной машины** на вкладке **Основные сведения** укажите следующее.

    | Параметр | Значение                                          |
    |-----------------------|----------------------------------|
    | **Сведения о проекте** |  |
    | Подписка | Выбор подписки Azure |
    | Группа ресурсов | Выберите **CreateSQLEndpointTutorial** |
    | **Сведения об экземпляре** |  |
    | Имя виртуальной машины | Введите **myVM**. |
    | Регион | Выберите **Восточная часть США**. |
    | Параметры доступности | Выберите **Избыточность инфраструктуры не требуется**. |
    | Образ — | Выберите **Windows Server 2019 Datacenter — Gen1** |
    | Точечный экземпляр Azure | Выберите **Нет**. |
    | Размер | Выберите размер виртуальной машины или подтвердите значение по умолчанию. |
    | **Учетная запись администратора** |  |
    | Имя пользователя | Введите имя пользователя. |
    | Пароль | Введите пароль. |
    | Подтверждение пароля | Введите пароль еще раз. |

3. Выберите вкладку **Сеть** или **Далее: диски**, затем **Далее: сеть**.
  
4. На вкладке "Сеть" укажите следующее.

    | Параметр | Значение |
    |-|-|
    | **Сетевой интерфейс** |  |
    | Виртуальная сеть | **myVNet** |
    | Подсеть | **mySubnet** |
    | Общедоступный IP-адрес | Выберите **Отсутствует**. |
    | Сетевая группа безопасности сетевого адаптера | **Основной**|
    | Общедоступные входящие порты | Выберите **Отсутствует**. |
   
5. Выберите **Review + create** (Просмотреть и создать). 
  
6. Проверьте параметры, а затем нажмите кнопку **Создать**.

## <a name="create-an-azure-sql-server-and-private-endpoint"></a><a name ="create-a-private-endpoint"></a>Создание Azure SQL Server и частной конечной точки

Проходя этот раздел, вы создадите сервер SQL Server в Azure. 

1. В верхнем левом углу экрана на портале Azure выберите **Создать ресурс** > **Базы данных** > **База данных SQL**.

1. На вкладке **Основные сведения** раздела **Создать базу данных SQL** введите или выберите следующую информацию:

    | Параметр | Значение |
    | ------- | ----- |
    | **Сведения о проекте** | |
    | Подписка | Выберите свою подписку. |
    | Группа ресурсов | Выберите **CreateSQLEndpointTutorial**. Вы создали эту группу ресурсов в рамках предыдущего раздела.|
    | **Сведения о базе данных** |  |
    | Имя базы данных  | Введите **mysqldatabase**. Если это имя используется, создайте уникальное имя. |
    | Сервер | Выберите **Создать**. |

6. В окне **Новый сервер** введите или выберите следующую информацию:

    | Параметр | Значение |
    | ------- | ----- |
    | Имя сервера  | Введите **mysqlserver**. Если это имя используется, создайте уникальное имя.|
    | учетные данные администратора сервера для входа; | Введите выбранное имя администратора. |
    | Пароль | Введите выбранный пароль. Пароль должен включать минимум 8 символов и соответствовать определенным требованиям. |
    | Расположение | Выберите **Восточная часть США**. |
    
7. Щелкните **ОК**.

8. Выберите вкладку **Сеть** или нажмите кнопку **Далее: Сеть**.

9. На вкладке **Сеть** введите или выберите такие значения параметров:

    | Параметр | Значение |
    | ------- | ----- |
    | **Сетевое подключение** | |
    | Метод подключения | Выберите **Частная конечная точка**. |
   
10. На вкладке **Частные конечные точки** выберите **+ Добавить частную конечную точку**.

11. В окне **Создание частной конечной точки** введите или выберите эти сведения:

    | Параметр | Значение |
    | ------- | ----- |
    | Подписка | Выберите свою подписку. |
    | Группа ресурсов | Выберите **CreateSQLEndpointTutorial**. |
    | Расположение | Выберите **Восточная часть США**. |
    | Имя | Введите **myPrivateSQLendpoint**. |
    | Целевой подресурс | Выберите **SQLServer**. |
    | **Сеть** |  |
    | Виртуальная сеть | Выберите **myVNet**. |
    | Подсеть | Выберите **mySubnet**. |
    | **Интеграция с частной зоной DNS** | |
    | Интеграция с частной зоной DNS | Оставьте значение по умолчанию **Да**. |
    | Частная зона DNS | Оставьте значение по умолчанию **(New) privatelink.database.windows.net**. |

12. Щелкните **ОК**. 

13. Выберите **Review + create** (Просмотреть и создать).

14. Нажмите кнопку **создания**.

## <a name="test-connectivity-to-private-endpoint"></a>Проверка подключения к частной конечной точке

В этом разделе описано, как использовать виртуальную машину, созданную на предыдущем шаге, для подключения к серверу SQL через частную конечную точку.

1. В области навигации слева выберите **Группы ресурсов**.

2. Выберите **CreateSQLEndpointTutorial**.

3. Выберите **myVM**.

4. На обзорной странице для **myVM** выберите **Подключиться**, а затем — **Бастион**.

5. Нажмите синюю кнопку **Использовать Бастион**.

6. Введите имя пользователя и пароль, указанные при создании виртуальной машины.

7. После подключения откройте на сервере Windows PowerShell.

8. Введите `nslookup <sqlserver-name>.database.windows.net`. Замените **\<sqlserver-name>** именем сервера SQL, созданного на предыдущих шагах.  Вы получите сообщение, аналогичное показанному ниже:

    ```powershell
    Server:  UnKnown
    Address:  168.63.129.16

    Non-authoritative answer:
    Name:    mysqlserver8675.privatelink.database.windows.net
    Address:  10.1.0.5
    Aliases:  mysqlserver8675.database.windows.net
    ```

    Для имени сервера SQL возвращен частный IP-адрес **10.1.0.5**.  Этот адрес находится в подсети виртуальной сети, созданной ранее.


9. Установите [SQL Server Management Studio](/sql/ssms/download-sql-server-management-studio-ssms?preserve-view=true&view=sql-server-2017) в **myVM**.

10. Откройте **SQL Server Management Studio**.

4. В окне **Подключение к серверу** введите или выберите следующую информацию:

    | Параметр | Значение |
    | ------- | ----- |
    | Тип сервера | Выберите **Ядро СУБД**.|
    | Имя сервера | Введите **\<sqlserver-name>.database.windows.net** |
    | Проверка подлинности | Выберите **Проверка подлинности SQL Server**. |
    | Имя пользователя | Введите имя пользователя, указанное при создании сервера |
    | Пароль | Введите пароль, указанный при создании сервера |
    | Запоминание пароля | Выберите **Да**. |

1. Выберите **Подключиться**.
2. Просмотр баз данных из левого меню.
3. (Дополнительно) Создание или запрос информации из базы данных **mysqldatabase**.
4. Закройте подключение к удаленному рабочему столу **myVM**. 

## <a name="clean-up-resources"></a>Очистка ресурсов 
После завершения работы с частной конечной точкой,SQL server и виртуальными машинами удалите группу ресурсов и все содержащиеся в ней ресурсы: 
1. Введите **CreateSQLEndpointTutorial** в поле **Поиск** в верхней части портала и выберите **CreateSQLEndpointTutorial** из результатов поиска. 
2. Выберите **Удалить группу ресурсов**. 
3. В поле **TYPE THE RESOURCE GROUP NAME** (ВВЕДИТЕ ИМЯ ГРУППЫ РЕСУРСОВ) введите CreateSQLEndpointTutorial и выберите **Удалить**.

## <a name="next-steps"></a>Дальнейшие действия

В рамках этого учебника вы создали:

* виртуальную сеть и узел-бастион;
* Виртуальная машина.
* Azure SQL Server с частной конечной точкой.

Вы использовали виртуальную машину для безопасного тестирования подключения к SQL Server через частную конечную точку.

В качестве следующего шага вы также можете ознакомиться со сценарием архитектуры **веб-приложения с частным подключением к базе данных SQL Azure**, когда веб-приложение за пределами виртуальной сети подключается к частной конечной точке базы данных.
> [!div class="nextstepaction"]
> [Веб-приложение с частным подключением к базе данных SQL Azure](/azure/architecture/example-scenario/private-web-app/private-web-app)