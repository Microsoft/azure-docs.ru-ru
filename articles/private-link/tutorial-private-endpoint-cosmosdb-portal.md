---
title: Руководство по подключению к учетной записи Azure Cosmos с помощью частной конечной точки Azure
titleSuffix: Azure Private Link
description: Начните работу с этим руководством, используя частную конечную точку Azure для подключения к учетной записи Azure Cosmos в частном порядке.
author: asudbring
ms.author: allensu
ms.service: private-link
ms.topic: tutorial
ms.date: 9/25/2020
ms.openlocfilehash: 477856bd5772cdc0a9ec00d81adf9c50847afdd0
ms.sourcegitcommit: 8c3a656f82aa6f9c2792a27b02bbaa634786f42d
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/17/2020
ms.locfileid: "97631955"
---
# <a name="tutorial-connect-to-an-azure-cosmos-account-using-an-azure-private-endpoint"></a>Руководство по подключению к учетной записи Azure Cosmos с помощью частной конечной точки Azure

Частная конечная точка Azure — ключевой компонент для построения Приватного канала в Azure. Это позволяет ресурсам Azure, таким как виртуальные машины (ВМ), обмениваться данными с ресурсами Приватного канала в частном порядке.

В этом руководстве описано следующее:

> [!div class="checklist"]
> * Создание виртуальной сети и узла бастиона.
> * Создайте виртуальную машину.
> * Создание учетной записи Cosmos DB с помощью частной конечной точки.
> * Проверка подключения к частной конечной точке учетной записи Cosmos DB.

Если у вас еще нет подписки Azure, [создайте бесплатную учетную запись](https://azure.microsoft.com/free/?WT.mc_id=A261C142F), прежде чем начинать работу.

## <a name="prerequisites"></a>Предварительные требования

* Подписка Azure

## <a name="sign-in-to-azure"></a>Вход в Azure

Войдите на [портал Azure](https://portal.azure.com).

## <a name="create-a-virtual-network-and-bastion-host"></a>Создание виртуальной сети и узла бастиона

В этом разделе вы создадите виртуальную сеть, подсеть и узел бастиона. 

Для безопасного подключения к виртуальной машине с целью тестирования частной конечной точки будет использоваться узел бастиона.

1. Слева вверху экрана щелкните **Создать ресурс > Сеть > Виртуальная сеть** или выполните поиск по фразе **виртуальная сеть**.

2. В подменю **Создать виртуальную сеть** введите или выберите следующую информацию на вкладке **Основные сведения**:

    | **Параметр**          | **Значение**                                                           |
    |------------------|-----------------------------------------------------------------|
    | **Сведения о проекте**  |                                                                 |
    | Подписка     | Выбор подписки Azure                                  |
    | Группа ресурсов   | Выберите **MyResourceGroup**. |
    | **Сведения об экземпляре** |                                                                 |
    | Имя             | Введите **myVNet**.                                    |
    | Регион           | Выберите **Восточная часть США**. |

3. Откройте вкладку **IP-адрес** или нажмите кнопку **Далее: IP-адреса** внизу страницы.

4. На вкладке **IP-адреса** укажите следующие сведения:

    | Параметр            | Значение                      |
    |--------------------|----------------------------|
    | Диапазон IPv4-адресов | Введите **10.1.0.0/16**. |

5. В разделе **Имя подсети** выберите **по умолчанию**.

6. В окне **Изменение подсети** введите следующие сведения:

    | Параметр            | Значение                      |
    |--------------------|----------------------------|
    | Имя подсети | Введите **mySubnet**. |
    | Диапазон адресов подсети | Введите **10.1.0.0/24**. |

7. Щелкните **Сохранить**.

8. Перейдите на вкладку **Безопасность**.

9. В разделе **BastionHost** выберите **Включить**. Введите такие сведения:

    | Параметр            | Значение                      |
    |--------------------|----------------------------|
    | Имя бастиона | Введите **myBastionHost**. |
    | Адресное пространство AzureBastionSubnet | Введите **10.1.1.0/24**. |
    | Общедоступный IP-адрес | Выберите **Создать**. </br> В поле **Имя** введите **myBastionIP**. </br> Щелкните **ОК**. |


8. Перейдите на вкладку **Просмотр и создание** или нажмите кнопку **Просмотр и создание**.

9. Нажмите кнопку **Создать**.

## <a name="create-a-virtual-machine"></a>Создание виртуальной машины

В этом разделе вы создадите виртуальную машину, которая будет использоваться для тестирования частной конечной точки.

1. В левой верхней части портала выберите **Создать ресурс** > **Вычисления** > **Виртуальная машина** или выполните поиск по словам **виртуальная машина** в поле поиска.
   
2. В разделе **Создание виртуальной машины** на вкладке **Основные сведения** укажите следующее.

    | Параметр | Значение                                          |
    |-----------------------|----------------------------------|
    | **Сведения о проекте** |  |
    | Подписка | Выбор подписки Azure |
    | Группа ресурсов | Выберите **MyResourceGroup**. |
    | **Сведения об экземпляре** |  |
    | Имя виртуальной машины | Введите **myVM**. |
    | Регион | Выберите **Восточная часть США**. |
    | Параметры доступности | Выберите **Избыточность инфраструктуры не требуется**. |
    | Образ — | Выберите **Windows Server 2019 Datacenter — Gen1** |
    | Точечный экземпляр Azure | Выберите **Нет**. |
    | Размер | Выберите размер виртуальной машины или подтвердите значение по умолчанию. |
    | **Учетная запись администратора** |  |
    | Имя пользователя | Введите имя пользователя. |
    | Пароль | Введите пароль. |
    | Подтверждение пароля | Введите пароль еще раз. |

3. Выберите вкладку **Сеть** или **Далее: диски**, затем **Далее: сеть**.
  
4. На вкладке "Сеть" укажите следующее.

    | Параметр | Значение |
    |-|-|
    | **Сетевой интерфейс** |  |
    | Виртуальная сеть | **myVNet** |
    | Подсеть | **mySubnet** |
    | Общедоступный IP-адрес | Выберите **Отсутствует**. |
    | Сетевая группа безопасности сетевого адаптера | **Основной**|
    | Общедоступные входящие порты | Выберите **Отсутствует**. |
   
5. Выберите **Review + create** (Просмотреть и создать). 
  
6. Проверьте параметры, а затем нажмите кнопку **Создать**.

## <a name="create-a-cosmos-db-account-with-a-private-endpoint"></a>Создание учетной записи Cosmos DB с помощью частной конечной точки

В этом разделе вы создадите учетную запись Cosmos DB и настроите закрытую конечную точку.

1. В меню слева последовательно выберите **Создать ресурс** > **Базы данных** > **Учетная запись Cosmos DB** или выполните поиск по словам **учетная запись Cosmos DB** в поле поиска.

2. На вкладке **Основные сведения** в окне **Создайте учетную запись Cosmos DB** введите или выберите следующие сведения:

    | Параметр | Значение                                          |
    |-----------------------|----------------------------------|
    | **Сведения о проекте** |  |
    | Подписка | Выберите подписку Azure. |
    | Группа ресурсов | Выберите **myResourceGroup**. |
    | **Сведения об экземпляре** |  |
    | Имя учетной записи | Введите **mycosmosdb**. Если имя недоступно, введите уникальное имя. |
    | API | Выберите **Core (SQL)**. |
    | Расположение | Выберите **Восточная часть США**. |
    | Режим емкости | Оставьте значение по умолчанию **Provisioned throughput** (Подготовленная пропускная способность). |
    | Применение скидки на основе категории "Бесплатный" | Не изменяйте значения по умолчанию **Не применять**. |
    | Геоизбыточность | Не изменяйте значения по умолчанию **Отключить**. |
    | Операции записи с поддержкой нескольких регионов | Не изменяйте значения по умолчанию **Отключить**. |
   
3. Выберите вкладку **Сеть** или нажмите кнопку **Далее: Сеть**.

4. На вкладке **Сеть** введите или выберите следующие значения параметров.

    | Параметр | Значение |
    | ------- | ----- |
    | **Сетевое подключение** | |
    | Метод подключения | Выберите **Частная конечная точка**. |
    | **Настройка брандмауэра** | |
    | Разрешение доступа с портала Azure | Оставьте значение по умолчанию **Разрешить**. |
    | Разрешение доступа с моего IP-адреса | Оставьте значение по умолчанию **Запретить**. |

5. В окне **Частная конечная точка** выберите **Добавить**.

6. В окне **Создание частной конечной точки** введите или выберите следующие сведения:

    | Параметр | Значение                                          |
    |-----------------------|----------------------------------|
    | Подписка | Выбор подписки Azure |
    | Группа ресурсов | Выберите **MyResourceGroup**. |
    | Расположение | Выберите **Восточная часть США**. |
    | Имя | Введите **myPrivateEndpoint**. |
    | Целевой подресурс | Оставьте значение по умолчанию **Ядро (SQL)** . |
    | **Сеть** |  |
    | Виртуальная сеть | Выберите **myVNet**. |
    | Подсеть | Выберите **mySubnet**. |
    | **Интеграция с частной зоной DNS** |
    | Интеграция с частной зоной DNS | Оставьте значение по умолчанию **Да**. |
    | Частная зона DNS | Оставьте значение по умолчанию (Создать) privatelink.documents.azure.com. |

7. Щелкните **ОК**.

8. Выберите **Review + create** (Просмотреть и создать).

9. Нажмите кнопку **Создать**.

### <a name="add-a-database-and-a-container"></a>Добавление базы данных и контейнера

1. Выберите **Перейти к ресурсу** или на портале Azure в меню слева щелкните **Все ресурсы** > **mycosmosdb**.

2. В меню слева выберите **Обозреватель данных**.

3. В окне **Обозреватель данных** выберите **Новый контейнер**.

4. В области **Добавить контейнер** введите или выберите следующие сведения:

    | Параметр | Значение |
    | ------- | ----- |
    | Идентификатор базы данных | Оставьте значение по умолчанию **Создать новый**. </br> В текстовое поле введите **mydatabaseid**. |
    | Пропускная способность (400–100 000 ЕЗ/с) | Не изменяйте значения по умолчанию **Вручную**. </br> В текстовое поле введите **400**. |
    | Container ID (Идентификатор контейнера) | Введите **mycontainerid**. |
    | Ключ секции | Введите **/mykey**. |

5. Щелкните **ОК**.

6. В разделе **Параметры** учетной записи Cosmos DB выберите параметр **Ключи**.

7. Скопируйте значение **ОСНОВНАЯ СТРОКА ПОДКЛЮЧЕНИЯ**.

## <a name="test-connectivity-to-private-endpoint"></a>Проверка подключения к частной конечной точке

В рамках этого раздела для подключения к учетной записи Cosmos DB через частную конечную точку вы будете использовать виртуальную машину, созданную на предыдущем шаге.

1. В области навигации слева выберите **Группы ресурсов**.

2. Выберите **myResourceGroup**.

3. Выберите **myVM**.

4. На обзорной странице для **myVM** выберите **Подключиться**, а затем — **Бастион**.

5. Нажмите синюю кнопку **Использовать Бастион**.

6. Введите имя пользователя и пароль, указанные при создании виртуальной машины.

7. После подключения откройте на сервере Windows PowerShell.

8. Введите `nslookup <cosmosdb-account-name>.documents.azure.com`. Замените **\<cosmosdb-account-name>** именем учетной записи Cosmos DB, созданной на предыдущих шагах. 

    ```powershell
    Server:  UnKnown
    Address:  168.63.129.16

    Non-authoritative answer:
    Name:    mycosmosdb8675.privatelink.documents.azure.com
    Address:  10.1.0.5
    Aliases:  mycosmosdb8675.documents.azure.com
    ```

    Для имени учетной записи Cosmos DB возвращен частный IP-адрес **10.1.0.5**.  Этот адрес находится в подсети виртуальной сети, созданной ранее.

9. Установите [Обозреватель службы хранилища Microsoft Azure](../vs-azure-tools-storage-manage-with-storage-explorer.md?tabs=windows&toc=%2fazure%2fstorage%2fblobs%2ftoc.json) на виртуальной машине.

10. После установки **Обозревателя службы хранилища Microsoft Azure** нажмите кнопку **Готово**.  Оставьте флажок установленным, чтобы открыть приложение.

11. На экране **Подключение к Службе хранилища Azure** выберите **Отмена**.

12. В Обозревателе службы хранилища щелкните правой кнопкой мыши элемент **Учетные записи Cosmos DB** и выберите **Подключение к Cosmos DB**.

13. В разделе **Выбрать API** оставьте значение по умолчанию **SQL**.

14. В поле раздела **Строка подключения** вставьте строку подключения из учетной записи Cosmos DB, скопированную на предыдущих шагах.

15. Выберите **Далее**.

16. Проверьте правильность используемых параметров в разделе **Сводка по соединению**.  

17. Выберите **Подключиться**.

18. Закройте подключение к **myVM**.


## <a name="clean-up-resources"></a>Очистка ресурсов

Если вы не собираетесь продолжать использовать это приложение, удалите виртуальную сеть, виртуальную машину и учетную запись Cosmos DB, выполнив следующие действия.

1. В меню слева выберите **Группы ресурсов**.

2. Выберите **myResourceGroup**.

3. Выберите **Удалить группу ресурсов**.

4. В поле **ВВЕДИТЕ ИМЯ ГРУППЫ РЕСУРСОВ** введите **myResourceGroup**.

5. Выберите команду **Удалить**.

## <a name="next-steps"></a>Дальнейшие действия

В рамках этого учебника вы создали:

* виртуальную сеть и узел-бастион;
* виртуальную машину;
* учетную запись Cosmos DB.

Создание службы Приватного канала:
> [!div class="nextstepaction"]
> [Создание службы "Приватный канал"](create-private-link-service-portal.md)