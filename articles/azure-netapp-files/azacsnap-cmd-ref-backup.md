---
title: Резервное копирование с помощью средства создания моментальных снимков для приложений Azure для Azure NetApp Files | Документация Майкрософт
description: Содержит инструкции по запуску команды Backup средства создания моментальных снимков с единообразием приложений Azure, которое можно использовать с Azure NetApp Files.
services: azure-netapp-files
documentationcenter: ''
author: Phil-Jensen
manager: ''
editor: ''
ms.assetid: ''
ms.service: azure-netapp-files
ms.workload: storage
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: reference
ms.date: 12/14/2020
ms.author: phjensen
ms.openlocfilehash: 17c29fdf88495f6ecc40963eda08858887173fd1
ms.sourcegitcommit: 910a1a38711966cb171050db245fc3b22abc8c5f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "98730944"
---
# <a name="back-up-using-azure-application-consistent-snapshot-tool-preview"></a>Резервное копирование с помощью средства создания моментальных снимков для приложений Azure (Предварительная версия)

В этой статье представлено руководство по запуску команды Backup инструмента для создания моментальных снимков с помощью приложений Azure, который можно использовать с Azure NetApp Files.

## <a name="introduction"></a>Введение

Резервная копия на основе моментального снимка хранилища выполняется с помощью `azacsnap -c backup` команды.  Эта команда выполняет согласование моментального снимка хранилища базы данных на томах данных и моментальный снимок хранилища (без настройки согласованности базы данных) на других томах.  

Для томов данных `azacsnap` будет подготовлена база данных для моментального снимка хранилища, а затем будет создан моментальный снимок хранилища для всех настроенных томов, и, наконец, будет рекомендовано создать моментальный снимок базы данных.  Он также будет управлять всеми записями базы данных, которые записывают действие резервного копирования моментальных снимков (например, SAP HANA каталог резервных копий).

## <a name="command-options"></a>Параметры команды

`-c backup`Команда принимает следующие аргументы:

- `--volume=` тип тома для моментального снимка. Этот параметр может содержать `data` или `other`
  - `data` создание моментальных снимков томов в станзае тома файла конфигурации.
  - `other` моментальный снимок томов в Осерволуме станза файла конфигурации.
  
  > [!NOTE]
  > Создавая отдельный файл конфигурации с загрузочным томом в качестве Осерволуме, `boot` моментальные снимки можно создавать совершенно по-другому расписанию (например, ежедневно).

- `--prefix=` префикс моментального снимка клиента для имени моментального снимка. Этот параметр имеет две цели. Сначала необходимо предоставить уникальное имя для группирования моментальных снимков. Во вторых, чтобы определить `--retention` количество моментальных снимков хранилища, хранимых для указанного `--prefix` .

    > [!IMPORTANT]
    > Допускаются только альфа-цифры ("A – Z, A-z, 0-9"), символ подчеркивания ("_") и тире ("-").

- `--retention` количество моментальных снимков объекта, которые необходимо `--prefix` Сохранить. После создания нового моментального снимка все дополнительные моментальные снимки удаляются `--prefix` .

- `--trim` Этот параметр доступен для SAP HANA v2 и более поздних версий. Этот вариант поддерживает каталог резервного копирования, а также для каталога дисков и резервных копий журналов. Количество записей, которые необходимо разместить в каталоге резервных копий `--retention` , определяется параметром выше и удаляет старые записи для определенного префикса ( `--prefix` ) из каталога резервного копирования и резервной копии связанных физических журналов. Он также удаляет все записи резервных копий журналов, которые старше самой старой записи, не являющейся резервной копией журнала. Эта операция помогает предотвратить использование резервных копий журнала всего свободного места на диске.

  > [!NOTE]
  > В приведенном ниже примере команда сохранит 9 моментальных снимков хранилища и обеспечит непрерывное усечение каталога резервных копий, чтобы он соответствовал 9 моментальным снимкам хранилища, которые будут храниться.

    ```bash
    azacsnap -c backup --volume data --prefix hana_TEST --retention 9 --trim
    ```

- `[--ssl=]` Необязательный параметр, определяющий метод шифрования, используемый для взаимодействия с SAP HANA, либо `openssl` `commoncrypto` . Если этот параметр определен, `azacsnap -c backup` команда должна найти два файла в одном каталоге. Эти файлы должны называться после соответствующего идентификатора безопасности. Обратитесь к статье [использование SSL для связи с SAP HANA](azacsnap-installation.md#using-ssl-for-communication-with-sap-hana). В следующем примере создается `hana` моментальный снимок типа с префиксом `hana_TEST` и будет `9` использоваться для связи с SAP HANA помощью SSL ( `openssl` ).

    ```bash
    azacsnap -c backup --volume data --prefix hana_TEST --retention 9 --trim --ssl=openssl
    ```

- `[--configfile <config filename>]` — Необязательный параметр, который позволяет использовать пользовательские имена файлов конфигурации.

## <a name="snapshot-backups-are-fast"></a>Резервное копирование моментальных снимков выполняется быстро

Длительность резервного копирования моментальных снимков не зависит от размера тома, при этом том размером 10 ТБ привязывается в течение приблизительного времени, равного объему в 10 ГБ.  

Основные факторы, влияющие на общее время выполнения, — это количество томов, которые должны быть моментальными снимками, и любые изменения в `--retention` параметре (где сокращение может увеличить время выполнения при удалении избыточных моментальных снимков).

В приведенном выше примере конфигурации (для **крупных экземпляров Azure**) создание моментальных снимков для двух томов заняло менее 5 секунд. Для **Azure NetApp Files** моментальные снимки для двух томов занимают около 60 секунд.

> [!NOTE]
> Если `--retention` выполнение значительно уменьшилось с момента выполнения предыдущего времени `azacsnap` (например, с `--retention 50` до `--retention 5` ), то время, затрачиваемое на это, увеличится, так как потребуется `azacsnap` удалить лишние моментальные снимки.

## <a name="example-with-data-parameter"></a>Пример с `data` параметром

```bash
azacsnap -c backup --volume data --prefix hana_TEST --retention 9 --trim
```

Команда не выводит данные в консоль, но выполняет запись в файл журнала, файл результатов и `/var/log/messages` .

*Файл журнала* состоит из имени команды + параметр-c + имя файла конфигурации. По умолчанию имя файла журнала для `-c backup` запуска с именем файла конфигурации по умолчанию `azacsnap-backup-azacsnap.log` .

Файл *результатов* имеет то же базовое имя, что и файл журнала, в `.result` качестве суффикса, например, `azacsnap-backup-azacsnap.result` который содержит следующие выходные данные:

```bash
cat logs/azacsnap-backup-azacsnap.result
```

```output
Database # 1 (H80) : completed ok
```

`/var/log/messages`Файл содержит те же выходные данные, что и `.result` файл. См. Следующий пример (Запуск от имени привилегированного пользователя):

```bash
grep "azacsnap.*Database" /var/log/messages | tail -n10
```

```output
Jul  2 05:22:07 server01 azacsnap[183868]: Database # 1 (H80) : completed ok
Jul  2 05:27:06 server01 azacsnap[4069]: Database # 1 (H80) : completed ok
Jul  2 05:32:07 server01 azacsnap[19769]: Database # 1 (H80) : completed ok
Jul  2 05:37:06 server01 azacsnap[35312]: Database # 1 (H80) : completed ok
Jul  2 05:42:06 server01 azacsnap[50877]: Database # 1 (H80) : completed ok
Jul  2 05:47:06 server01 azacsnap[66429]: Database # 1 (H80) : completed ok
Jul  2 05:52:06 server01 azacsnap[82964]: Database # 1 (H80) : completed ok
Jul  2 05:57:06 server01 azacsnap[98522]: Database # 1 (H80) : completed ok
Jul  2 05:59:13 server01 azacsnap[105519]: Database # 1 (H80) : completed ok
Jul  2 06:02:06 server01 azacsnap[114280]: Database # 1 (H80) : completed ok
```

## <a name="example-with-other-parameter"></a>Пример с `other` параметром

```bash
azacsnap -c backup --volume other --prefix logs_TEST --retention 9
```

Команда не выводит данные в консоль, но выполняет запись только в файл журнала.  Он _не_ выполняет запись в файл результатов или `/var/log/messages` .

*Файл журнала* состоит из имени команды + параметр-c + имя файла конфигурации. По умолчанию имя файла журнала для `-c backup` запуска с именем файла конфигурации по умолчанию `azacsnap-backup-azacsnap.log` .

## <a name="example-with-other-parameter-to-backup-host-os"></a>Пример с `other` параметром (для резервного копирования ОС сервера)

> [!NOTE]
> Использование другого файла конфигурации ( `--configfile bootVol.json` ), который содержит только загрузочные тома.

```bash
azacsnap -c backup --volume other --prefix boot_TEST --retention 9 --configfile bootVol.json
```

Команда не выводит данные в консоль, но выполняет запись только в файл журнала.  Он _не_ выполняет запись в файл результатов или `/var/log/messages` .

В этом примере имя *файла журнала* — `azacsnap-backup-bootVol.log` .

> [!NOTE]
> Имя файла журнала состоит из "(имя команды-( `-c` параметр)-(имя файла конфигурации)".  Например, если используется `-c backup` параметр с именем файла журнала `h80.json` , то будет вызван файл журнала `azacsnap-backup-h80.log` .  При использовании `-c test` параметра с тем же файлом конфигурации будет вызван файл журнала `azacsnap-test-h80.log` .

- Тип крупных экземпляров HANA. в единице крупных экземпляров HANA есть два допустимых значения: или, в `TYPEI` `TYPEII` зависимости от единицы.
- Для подтверждения доступных номеров SKU см. раздел [Доступные номера SKU для крупных экземпляров Hana](../virtual-machines/workloads/sap/hana-available-skus.md) .

## <a name="next-steps"></a>Дальнейшие действия

- [Получение сведений о снимке](azacsnap-cmd-ref-details.md)
- [Удаление моментальных снимков](azacsnap-cmd-ref-delete.md)