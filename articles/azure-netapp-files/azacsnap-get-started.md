---
title: Приступая к работе со средством создания моментальных снимков для приложений Azure для Azure NetApp Files | Документация Майкрософт
description: Содержит инструкции по установке инструмента для создания моментальных снимков, совместимых с приложениями Azure, которые можно использовать с Azure NetApp Files.
services: azure-netapp-files
documentationcenter: ''
author: Phil-Jensen
manager: ''
editor: ''
ms.assetid: ''
ms.service: azure-netapp-files
ms.workload: storage
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: how-to
ms.date: 12/14/2020
ms.author: phjensen
ms.openlocfilehash: 25f555038c1ce0d960266eacc673a62a1ffd5ac0
ms.sourcegitcommit: 78ecfbc831405e8d0f932c9aafcdf59589f81978
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/23/2021
ms.locfileid: "98736368"
---
# <a name="get-started-with-azure-application-consistent-snapshot-tool-preview"></a>Приступая к работе с средством создания моментальных снимков для приложений Azure (Предварительная версия)

В этой статье представлено руководство по установке инструмента для создания моментальных снимков с единым приложением Azure, который можно использовать с Azure NetApp Files.

## <a name="getting-the-snapshot-tools"></a>Получение средств создания моментальных снимков

Мы рекомендуем клиентам получить последнюю версию [установщика азакснап](https://aka.ms/azacsnapdownload) от корпорации Майкрософт.

Файл с самоустановкой имеет связанный [файл подписи установщика азакснап](https://aka.ms/azacsnapdownloadsignature) , который подписан с помощью открытого ключа Майкрософт, чтобы разрешить GPG проверку скачанного установщика.

После завершения загрузки выполните действия, описанные в этом руководстве, чтобы установить.

### <a name="verifying-the-download"></a>Проверка загрузки

Установщик, который может быть скачан в более поздней версии, имеет связанный файл подписи PGP с `.asc` расширением имени файла. Этот файл можно использовать для того, чтобы загрузить установщик в проверенный файл, предоставленный корпорацией Майкрософт. Открытый ключ Microsoft PGP, используемый для подписи пакетов Linux, доступен здесь ( <https://packages.microsoft.com/keys/microsoft.asc> ) и использовался для подписания файла подписи.

Открытый ключ Microsoft PGP можно импортировать в локальную учетную запись пользователя следующим образом:

```bash
wget https://packages.microsoft.com/keys/microsoft.asc
gpg --import microsoft.asc
```

Следующие команды доверяют открытому ключу Microsoft PGP:

1. Перечислите ключи в хранилище.
2. Измените ключ Microsoft.
3. Проверка отпечатка пальца с `fpr`
4. Подпишите ключ, чтобы он доверял.

```bash
gpg --list-keys
```

Перечисленные разделы:
```output
----<snip>----
pub rsa2048 2015- 10 - 28 [SC]
BC528686B50D79E339D3721CEB3E94ADBE1229CF
uid [ unknown] Microsoft (Release signing) gpgsecurity@microsoft.com
```

```bash
gpg --edit-key gpgsecurity@microsoft.com
```

Выходные данные для `gpg` подписания интерактивного сеанса с открытым ключом Майкрософт:
```output
gpg (GnuPG) 2.1.18; Copyright (C) 2017 Free Software Foundation, Inc.
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.
pub rsa2048/EB3E94ADBE1229CF
created: 2015- 10 - 28 expires: never usage: SC
trust: unknown validity: unknown
[ unknown] (1). Microsoft (Release signing) <gpgsecurity@microsoft.com>

gpg> fpr
pub rsa2048/EB3E94ADBE1229CF 2015- 10 - 28 Microsoft (Release signing)
<gpgsecurity@microsoft.com>
Primary key fingerprint: BC52 8686 B50D 79E3 39D3 721C EB3E 94AD BE12 29CF

gpg> sign
pub rsa2048/EB3E94ADBE1229CF
created: 2015- 10 - 28 expires: never usage: SC
trust: unknown validity: unknown
Primary key fingerprint: BC52 8686 B50D 79E3 39D3 721C EB3E 94AD BE12 29CF
Microsoft (Release signing) <gpgsecurity@microsoft.com>
Are you sure that you want to sign this key with your
key "XXX XXXX <xxxxxxx@xxxxxxxx.xxx>" (A1A1A1A1A1A1)
Really sign? (y/N) y

gpg> quit
Save changes? (y/N) y
```

Файл сигнатуры PGP для установщика можно проверить следующим образом:

```bash
gpg --verify azacsnap_installer_v5.0.run.asc azazsnap_installer_v5.0.run
```

```output
gpg: Signature made Sat 13 Apr 2019 07:51:46 AM STD
gpg: using RSA key EB3E94ADBE1229CF
gpg: Good signature from "Microsoft (Release signing)
<gpgsecurity@microsoft.com>" [full]
```

Дополнительные сведения об использовании GPG см. [в руководстве по конфиденциальности GNU](https://www.gnupg.org/gph/en/manual/book1.html).

## <a name="supported-scenarios"></a>Поддерживаемые сценарии

Средства моментальных снимков можно использовать в следующих сценариях.

- Один идентификатор безопасности
- Несколько идентификаторов безопасности
- HSR
- Горизонтальное масштабирование
- MDC (поддерживается только один клиент)
- Один контейнер
- Операционная система SUSE
- Операционная система RHEL
- ТИП SKU I
- ТИП SKU II

См. раздел [Поддерживаемые сценарии для крупных экземпляров Hana](../virtual-machines/workloads/sap/hana-supported-scenario.md) .

## <a name="snapshot-support-matrix-from-sap"></a>Матрица поддержки моментальных снимков из SAP

Следующая матрица представлена в качестве рекомендации по тем, какие версии SAP HANA поддерживаются SAP для резервного копирования моментальных снимков хранилища.

| Версии базы данных       |1,0 SPS12|2,0 SPS0|2,0 SPS1|2,0 SPS2|2,0 SPS3|2,0 SPS4|
|-------------------------|---------|--------|--------|--------|--------|--------|
|База данных одного контейнера| √       | √      | -      | -      | -      | -      |
|MDC один клиент        | -       | -      | √      | √      | √      | √      |
|MDC нескольких клиентов     | -       | -      | -      | -      | -      | √      |
> √ = <small>поддерживается SAP для моментальных снимков хранилища</small>

## <a name="important-things-to-remember"></a>Важные замечания

- После установки средств создания моментальных снимков непрерывно Отслеживайте доступное дисковое пространство и при необходимости удаляйте старые моментальные снимки на регулярной основе, чтобы избежать заполнения хранилища.
- Всегда используйте новейшие средства создания моментальных снимков.
- Используйте одну и ту же версию средств создания моментальных снимков в альбомной ориентации.
- Протестируйте средства создания моментальных снимков и подготовьте необходимые параметры и выходные данные команды перед использованием в рабочей системе.
- При настройке пользователя HANA для резервного копирования (подробные сведения см. ниже в этом документе) необходимо настроить пользователя для каждого экземпляра HANA. Создайте учетную запись пользователя SAP HANA для доступа к экземпляру HANA в СИСТЕМДБ (а не в базе данных SID) для MDC. В среде с одним контейнером его можно настроить в базе данных клиента.
- Клиенты должны предоставить открытый ключ SSH для доступа к хранилищу. Это действие должно выполняться один раз для каждого узла и для каждого пользователя, от имени которого выполняется команда.
- Количество моментальных снимков на том ограничено 250.
- При ручном изменении файла конфигурации всегда используйте текстовый редактор Linux, например "VI", а не редакторы Windows, например Блокнот. Использование редактора Windows может привести к повреждению формата файла.
  - Настройте `hdbuserstore` для пользователя SAP HANA взаимодействовать с SAP HANA.
- Для аварийного восстановления. средства создания моментальных снимков необходимо тестировать на узле аварийного восстановления перед настройкой АВАРИЙного восстановления.
- Регулярно Отслеживайте место на диске. Автоматическое удаление журнала управляется с `--trim` параметром   `azacsnap -c backup` для SAP HANA 2 и более поздних выпусков.
- Риск невозможности **создания моментальных снимков** . средства создания моментальных снимков взаимодействуют только с узлом SAP HANA системы, указанной в файле конфигурации.  Если этот узел становится недоступным, механизм автоматического начала взаимодействия с другим узлом отсутствует.  
  - Для **SAP HANA Scale-Out с резервным** вариантом обычно устанавливаются и настраиваются средства создания моментальных снимков на главном узле. Но если главный узел становится недоступным, резервный узел будет принимать роль главного узла. В этом случае Группа реализации должна настроить средства создания моментальных снимков на обоих узлах (в основном и в автономном режиме), чтобы избежать пропусков моментальных снимков. В нормальном состоянии главный узел принимает моментальные снимки HANA, инициированные crontab, но после отработки отказа главного узла Эти моментальные снимки должны быть выполнены с другого узла, такого как новый главный узел (бывший резервный). Для достижения этого результата на резервном узле должно быть установлено средство создания моментальных снимков, включено подключение к хранилищу, настроенные, `azacsnap.json` настроенные и команды crontab, предварительно помещенные на отработку отказа.
  - Для сценария **SAP HANA HSR Ha** рекомендуется установить, настроить и запланировать инструменты создания моментальных снимков на обоих узлах (первичных и вторичных). Затем, если основной узел становится недоступным, вторичный узел берет на себя моментальные снимки, выполняемые на сервере-получателе. В обычном состоянии первичный узел принимает моментальные снимки HANA, инициированные crontab, а вторичный узел попытается сделать моментальные снимки, но при этом произойдет сбой, так как основной сервер работает правильно.  Но после отработки отказа первичного узла Эти моментальные снимки будут выполнены с вторичного узла. Для достижения этого результата на вторичном узле должно быть установлено средство создания моментальных снимков, включено подключение к хранилищу, `hdbuserstore` настроено, azacsnap.jsнастроено, а параметр crontab включен в качестве отработки отказа.

## <a name="guidance-provided-in-this-document"></a>Руководство, приведенное в этом документе

Для иллюстрации использования средств создания моментальных снимков предоставляются следующие рекомендации.

### <a name="taking-snapshot-backups"></a>Создание резервных копий моментальных снимков

- [Необходимые условия для создания моментального снимка хранилища](azacsnap-installation.md#prerequisites-for-installation)
  - [Включение взаимодействия с хранилищем](azacsnap-installation.md#enable-communication-with-storage)
  - [Включение взаимодействия с SAP HANA](azacsnap-installation.md#enable-communication-with-sap-hana)
- [Как создавать моментальные снимки вручную](azacsnap-tips.md#take-snapshots-manually)
- [Настройка автоматического резервного копирования моментальных снимков](azacsnap-tips.md#setup-automatic-snapshot-backup)
- [Мониторинг моментальных снимков](azacsnap-tips.md#monitor-the-snapshots)
- [Как удалить моментальный снимок?](azacsnap-tips.md#delete-a-snapshot)
- [Восстановление моментального снимка](azacsnap-tips.md#restore-a-snapshot)
- [Восстановление `boot` моментального снимка](azacsnap-tips.md#restore-a-boot-snapshot)
- [Основные факты, которые следует учитывать при создании моментальных снимков](azacsnap-tips.md#key-facts-to-know-about-snapshots)

> Моментальные снимки тестируются как для одного идентификатора безопасности, так и для нескольких идентификаторов SID.

### <a name="performing-disaster-recovery"></a>Выполнение аварийного восстановления

- [Необходимые условия для установки аварийного восстановления](azacsnap-disaster-recovery.md#prerequisites-for-disaster-recovery-setup)
- [Настройка аварийного восстановления](azacsnap-disaster-recovery.md#set-up-disaster-recovery)
- [Мониторинг репликации данных с первичного сайта на сайт аварийного восстановления](azacsnap-disaster-recovery.md#monitor-data-replication-from-primary-to-dr-site)
- [Как выполнить отработку отказа на сайт аварийного восстановления?](azacsnap-disaster-recovery.md#perform-a-failover-to-dr-site)

## <a name="next-steps"></a>Следующие шаги

- [Установка инструмента для создания моментальных снимков с единым приложением Azure](azacsnap-installation.md)