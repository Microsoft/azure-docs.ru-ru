---
title: Создание тома с двумя протоколами (NFSv3 и SMB) для Azure NetApp Files | Документация Майкрософт
description: В этой статье описывается создание тома, использующего сдвоенный протокол NFSv3 и SMB с поддержкой сопоставления пользователей LDAP.
services: azure-netapp-files
documentationcenter: ''
author: b-juche
manager: ''
editor: ''
ms.assetid: ''
ms.service: azure-netapp-files
ms.workload: storage
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: how-to
ms.date: 01/05/2020
ms.author: b-juche
ms.openlocfilehash: d296f80d85bb5081c466b27e6a8624e8b3f2c924
ms.sourcegitcommit: 67b44a02af0c8d615b35ec5e57a29d21419d7668
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/06/2021
ms.locfileid: "97915009"
---
# <a name="create-a-dual-protocol-nfsv3-and-smb-volume-for-azure-netapp-files"></a>Создание тома с двумя протоколами (NFSv3 и SMB) для Azure NetApp Files

Azure NetApp Files поддерживает создание томов с помощью NFS (NFSv3 и Нфсв 4.1), SMB3 или Dual Protocol. В этой статье показано, как создать том, использующий сдвоенный протокол NFSv3 и SMB с поддержкой сопоставления пользователей LDAP.  


## <a name="before-you-begin"></a>Перед началом 

* Вы должны уже создали пул емкости.  
    См. раздел [Настройка пула емкости](azure-netapp-files-set-up-capacity-pool.md).   
* Подсеть должна быть делегирована службе Azure NetApp Files.  
    См. раздел [Делегирование подсети для Azure NetApp Files](azure-netapp-files-delegate-subnet.md).

## <a name="considerations"></a>Рекомендации

* Убедитесь, что соблюдены [требования к Active Directoryным подключениям](azure-netapp-files-create-volumes-smb.md#requirements-for-active-directory-connections). 
* Создайте зону обратного просмотра на DNS-сервере, а затем добавьте запись указателя (PTR) компьютера узла Active Directory в эту зону обратного просмотра. В противном случае создание тома с двойным протоколом завершится ошибкой.
* Убедитесь, что клиент NFS обновлен и на нем установлены последние обновления для операционной системы.
* Убедитесь, что сервер LDAP Active Directory (AD) работает и работает на AD. Это можно сделать, установив и настроив роль [службы Active Directory облегченного доступа к каталогам (AD LDS)](/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/hh831593(v=ws.11)) на компьютере AD.
* Убедитесь, что для AD создан центр сертификации (ЦС), используя роль [служб сертификатов Active Directory (AD CS)](/windows-server/networking/core-network-guide/cncg/server-certs/install-the-certification-authority) для создания и экспорта самозаверяющего сертификата корневого ЦС.   
* Тома с двумя протоколами в настоящее время не поддерживают Azure Active Directory доменных служб (AADDS).  
* Версия NFS, используемая томом с двумя протоколами, — это NFSv3. Поэтому следует учитывать следующие моменты.
    * Сдвоенный протокол не поддерживает расширенные атрибуты ACL Windows `set/get` от клиентов NFS.
    * Клиенты NFS не могут изменять разрешения для стиля безопасности NTFS, а клиенты Windows не могут изменять разрешения для томов с двумя протоколами в стиле UNIX.   

    В следующей таблице описаны стили безопасности и их влияние.  
    
    | Стиль безопасности    | Клиенты, которые могут изменять разрешения   | Разрешения, которые могут использовать клиенты  | Итоговый действующий стиль безопасности    | Клиенты, у которых есть доступ к файлам     |
    |-  |-  |-  |-  |-  |
    | `Unix`    | NFS   | Биты режима NFSv3   | UNIX  | NFS и Windows   |
    | `Ntfs`    | Windows   | Списки ACL NTFS     | NTFS  |NFS и Windows|
* Пользователи UNIX, монтирование тома в стиле безопасности NTFS с помощью NFS, будут проходить проверку подлинности как пользователь Windows `root` для UNIX `root` и `pcuser` для всех остальных пользователей. Убедитесь, что эти учетные записи пользователей существуют в Active Directory до подключения тома при использовании NFS. 


## <a name="create-a-dual-protocol-volume"></a>Создание тома с двумя протоколами

1.  В колонке управления пулами емкости щелкните колонку **Тома**. Чтобы создать том щелкните **+ Добавить том**. 

    ![Переход к томам](../media/azure-netapp-files/azure-netapp-files-navigate-to-volumes.png) 

2.  В окне Создание тома нажмите кнопку **создать** и введите сведения для следующих полей на вкладке "основы":   
    * **Имя тома**      
        Укажите имя создаваемого тома.   

        Имя тома должно быть уникальным в пределах каждого пула емкости. Длина имени должна быть не менее трех знаков. Имя может состоять из любых буквенно-цифровых символов.   

        Нельзя использовать `default` или `bin` в качестве имени тома.

    * **Пул емкости**  
        Укажите пул емкости, в котором нужно создать том.

    * **Квота**  
        Укажите объем логического хранилища, выделенный для тома.  

        В поле **Доступная квота** отображается объем неиспользуемого пространства выбранного пула емкости, которое можно использовать для создания нового тома. Размер нового тома не должен превышать доступную квоту.  

    * **Пропускная способность (MiB/с)**   
        Если том создается в пуле ресурсов ручного обслуживания вручную, укажите необходимую пропускную способность для тома.   

        Если том создается в пуле ресурсов автоматического качества обслуживания, в этом поле отображается значение (пропускная способность уровня обслуживания "квота x").   

    * **Виртуальная сеть**  
        Укажите виртуальную сеть Azure, из которой будет осуществляться доступ к тому.  

        В указанной виртуальной сети должна быть подсеть, делегированная службе Azure NetApp Files. Доступ к службе Azure NetApp Files можно получить только из той же виртуальной сети либо из виртуальной сети, которая находится в том же расположении, что и том, через пиринговую связь. Доступ к тому также можно получить из локальной сети через Express Route.   

    * **Подсеть**  
        Укажите подсеть, которую нужно использовать для тома.  
        Указанная подсеть должна быть делегирована службе Azure NetApp Files. 
        
        Если вы не делегировали подсеть, вы можете щелкнуть **Создать** на странице "Создать том". Затем на странице "Создание подсети" укажите сведения о подсети и выберите **Microsoft.NetApp/volumes**, чтобы делегировать подсеть службе Azure NetApp Files. В каждой виртуальной сети можно делегировать только одну подсеть в Azure NetApp Files.   
 
        ![Создание тома](../media/azure-netapp-files/azure-netapp-files-new-volume.png)
    
        ![Создание подсети](../media/azure-netapp-files/azure-netapp-files-create-subnet.png)

    * Если вы хотите применить к тому существующую политику моментальных снимков, щелкните **Показать дополнительные** , чтобы развернуть его, укажите, нужно ли скрыть путь к моментальному снимку, а затем выберите политику моментальных снимков в раскрывающемся меню. 

        Дополнительные сведения о создании политики моментальных снимков см. в разделе [Управление политиками моментальных снимков](azure-netapp-files-manage-snapshots.md#manage-snapshot-policies).

        ![Отобразить расширенный выбор](../media/azure-netapp-files/volume-create-advanced-selection.png)

3. Щелкните **Протокол**, а затем выполните приведенные ниже действия.  
    * Выберите **два протокола (NFSv3 и SMB)** в качестве типа протокола для тома.   

    * Выберите подключение **Active Directory** из раскрывающегося списка.  
    Используемый Active Directory должен иметь сертификат корневого ЦС сервера. 

    * Укажите **путь тома** для тома.   
    Этот путь тома представляет собой имя общего тома. Имя должно начинаться с алфавитного символа и должно быть уникальным в пределах каждой подписки и каждого региона.  

    * Укажите используемый **стиль безопасности** : NTFS (по умолчанию) или UNIX.

    * При необходимости [Настройте политику экспорта для тома](azure-netapp-files-configure-export-policy.md).

    ![Указание двух протоколов](../media/azure-netapp-files/create-volume-protocol-dual.png)

4. Нажмите **Проверка и создание**, чтобы ознакомиться с сведениями о томе. Затем нажмите кнопку **создать** , чтобы создать том.

    Созданный том появится на странице "Тома". 
 
    От пула емкости том наследует атрибуты подписки, группы ресурсов и расположения. Состояние развертывания можно отслеживать на вкладке уведомлений.

## <a name="upload-active-directory-certificate-authority-public-root-certificate"></a>Отправить Active Directory открытый корневой сертификат центра сертификации  

1.  Следуйте инструкциям [по установке центра сертификации](/windows-server/networking/core-network-guide/cncg/server-certs/install-the-certification-authority) для установки и настройки добавления центра сертификации. 

2.  Следуйте указаниям в окне [Просмотр сертификатов с помощью оснастки MMC](/dotnet/framework/wcf/feature-details/how-to-view-certificates-with-the-mmc-snap-in) , чтобы использовать оснастку MMC и диспетчер сертификатов.  
    Используйте оснастку "Диспетчер сертификатов", чтобы указать корневой или выдающий сертификат для локального устройства. Команды оснастки управления сертификатами следует запускать из одного из следующих параметров:  
    * Клиент на основе Windows, который присоединился к домену и установил корневой сертификат 
    * Другой компьютер в домене, содержащий корневой сертификат  

3. Экспортируйте сертификат корневого ЦС.  
    Сертификаты корневого ЦС можно экспортировать из каталога личных или доверенных корневых центров сертификации, как показано в следующих примерах:   
    ![снимок экрана, на котором показаны персональные сертификаты](../media/azure-netapp-files/personal-certificates.png)   
    ![снимок экрана, на котором показаны Доверенные корневые центры сертификации](../media/azure-netapp-files/trusted-root-certification-authorities.png)    

    Убедитесь, что сертификат экспортирован в Base-64 с кодировкой X. 509 (. CER): 

    ![Мастер экспорта сертификатов](../media/azure-netapp-files/certificate-export-wizard.png)

4. Перейдите в учетную запись NetApp на томе с двумя протоколами, щелкните **Active Directory подключения** и отправьте сертификат КОРНЕВого ЦС с помощью окна " **соединение Active Directory** ":  

    ![Сертификат корневого ЦС сервера](../media/azure-netapp-files/server-root-ca-certificate.png)

    Убедитесь, что имя центра сертификации может быть разрешено DNS. Это имя является полем "выдано" или "Issuer" в сертификате:  

    ![Сведения о сертификате](../media/azure-netapp-files/certificate-information.png)

## <a name="manage-ldap-posix-attributes"></a>Управление атрибутами POSIX для LDAP

Управлять атрибутами POSIX, например UID, домашним каталогом и другими значениями, можно с помощью оснастки консоли управления Active Directory пользователи и компьютеры.  В следующем примере показан редактор атрибутов Active Directory.  

![Редактор Active Directoryных атрибутов](../media/azure-netapp-files/active-directory-attribute-editor.png) 

Необходимо задать следующие атрибуты для пользователей LDAP и групп LDAP: 
* Обязательные атрибуты для пользователей LDAP:   
    `uid`: Алиса, `uidNumber` : 139, `gidNumber` : 555, `objectClass` : посиксаккаунт
* Обязательные атрибуты для групп LDAP:   
    `objectClass`: "Посиксграуп", `gidNumber` : 555

## <a name="configure-the-nfs-client"></a>Настройка клиента NFS 

Следуйте инструкциям в разделе [Настройка клиента NFS для Azure NetApp Files](configure-nfs-clients.md) , чтобы настроить клиент NFS.  

## <a name="next-steps"></a>Дальнейшие действия  

* [Настройка клиента NFS для Azure NetApp Files](configure-nfs-clients.md)
* [Устранение неполадок с томами с двумя протоколами](troubleshoot-dual-protocol-volumes.md)
