---
title: Устранение неполадок с доменами и TLS/SSL-сертификатами
description: Найдите решения распространенных проблем, которые могут возникнуть при настройке домена или TLS/SSL-сертификата в службе приложений Azure.
author: genlin
manager: dcscontentpm
tags: top-support-issue
ms.topic: article
ms.date: 03/01/2019
ms.author: genli
ms.custom: seodec18
ms.openlocfilehash: 691cbd79e82432c8e919dcbb51642a76000296dc
ms.sourcegitcommit: 867cb1b7a1f3a1f0b427282c648d411d0ca4f81f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "97607615"
---
# <a name="troubleshoot-domain-and-tlsssl-certificate-problems-in-azure-app-service"></a>Устранение неполадок с сертификатами в домене и TLS/SSL в службе приложений Azure

В этой статье перечислены распространенные проблемы, которые могут возникнуть при настройке домена или сертификата TLS/SSL для веб-приложений в службе приложений Azure. Кроме того, здесь описаны возможные причины этих проблем и способы их устранения.

Если в любой момент при изучении этой статьи вам потребуется дополнительная помощь, вы можете обратиться к экспертам по Azure на [форумах MSDN и Stack Overflow](https://azure.microsoft.com/support/forums/). Кроме того, можно зарегистрировать обращение в службу поддержки Azure. Перейдите на [сайт поддержки Azure](https://azure.microsoft.com/support/options/) и выберите **получить поддержку**.

[!INCLUDE [updated-for-az](../../includes/updated-for-az.md)]

## <a name="certificate-problems"></a>Проблемы сертификата

### <a name="you-cant-add-a-tlsssl-certificate-binding-to-an-app"></a>Вы не можете добавить в приложение привязку сертификата TLS/SSL. 

#### <a name="symptom"></a>Симптом

При добавлении привязки TLS появляется следующее сообщение об ошибке:

"Не удалось добавить привязку SSL. Не удалось назначить сертификат для существующего виртуального IP-адреса, так как этот сертификат уже используется для другого виртуального IP-адреса."

#### <a name="cause"></a>Причина

Эта проблема может возникнуть, если у вас есть несколько привязок SSL на основе IP-адреса для одного IP-адреса в нескольких приложениях. Например, у приложения A есть привязка SSL на основе IP-адреса со старым сертификатом. У приложения B есть привязка SSL на основе IP-адреса с новым сертификатом для того же IP-адреса. Если вы обновляете привязку приложения TLS с помощью нового сертификата, она завершается ошибкой, так как для другого приложения используется тот же IP-адрес. 

#### <a name="solution"></a>Решение 

Чтобы устранить эту проблему, используйте один из следующих способов:

- Удалите привязку SSL на основе IP-адреса в приложении, в котором используется старый сертификат. 
- Создайте привязку SSL на основе IP-адреса, которая использует новый сертификат.

### <a name="you-cant-delete-a-certificate"></a>Не удается удалить сертификат 

#### <a name="symptom"></a>Симптом

При попытке удалить сертификат, появляется следующее сообщение об ошибке:

"Не удалось удалить сертификат, так как в настоящее время он используется в привязке TLS/SSL. Прежде чем можно будет удалить сертификат, необходимо удалить привязку TLS. "

#### <a name="cause"></a>Причина

Эта проблема может возникнуть, если сертификат используется другим приложением.

#### <a name="solution"></a>Решение

Удалите привязку TLS для этого сертификата из приложений. Затем попробуйте удалить сертификат. Если сертификат по-прежнему не удается удалить, очистите кэш веб-браузера, повторно откройте портал Azure в новом окне браузера. Затем попробуйте удалить сертификат.

### <a name="you-cant-purchase-an-app-service-certificate"></a>Не удается приобрести сертификат службы приложений 

#### <a name="symptom"></a>Симптом
Приобрести [сертификат службы приложений Azure](./configure-ssl-certificate.md#import-an-app-service-certificate) на портале Azure нельзя.

#### <a name="cause-and-solution"></a>Причина и решение
Эта проблема может возникать из-за любой из следующих причин:

- Служба приложений имеет план уровня "Бесплатный" или "Общий". Эти ценовые категории не поддерживают TLS. 

    **Решение**. Обновите план службы приложений для приложения до уровня "Стандартный".

- Подписка не имеет действительной кредитной карты.

    **Решение.** Добавьте действительную кредитную карту в подписку. 

- Предложение подписки не поддерживает покупку сертификата службы приложений, такого как Microsoft Student.  

    **Решение.** Обновите подписку. 

- Достигнуто максимальное количество покупок, предусмотренных для подписки.

    **Решение.** Для типов подписок с оплатой по мере использования и с Соглашением Enterprise предусмотрено не больше 10 покупок сертификатов службы приложений. Для других типов подписок ограничение равно 3. Чтобы увеличить это количество, обратитесь в [службу поддержки Azure](https://portal.azure.com/?#blade/Microsoft_Azure_Support/HelpAndSupportBlade).
- Сертификат службы приложений помечен как мошеннический. Отображается следующее сообщение об ошибке: "Ваш сертификат отмечен как потенциально мошеннический." Запрос находится на рассмотрении. Если сертификат не будет использоваться в течение 24 часов, обратитесь в службу поддержки Azure ".

    **Решение.** Если сертификат помечен как мошеннический и проблема не будет устранена по прошествии 24 часов, сделайте следующее:

    1. Войдите на [портал Azure](https://portal.azure.com).
    2. Перейдите к области **Сертификаты службы приложений**, а затем выберите сертификат.
    3. Выберите **Конфигурация сертификата**  >  **Шаг 2. Проверка**  >  **домена**. В результате будет отправлено электронное уведомление поставщику сертификата Azure для устранения проблемы.

## <a name="custom-domain-problems"></a>Проблемы с пользовательскими доменами

### <a name="a-custom-domain-returns-a-404-error"></a>Личный домен возвращает сообщение об ошибке 404 

#### <a name="symptom"></a>Симптом

При переходе на сайт с помощью имени личного домена отображается следующее сообщение об ошибке:

"Error 404-Web app not found" (Ошибка 404 — веб-приложение не найдено).

#### <a name="cause-and-solution"></a>Причина и решение

**Причина 1** 

На настроенном личном домене отсутствует запись A или CNAME. 

**Решение для причины 1**

- Если вы добавили запись A, убедитесь, что запись типа TXT также добавлена. Дополнительные сведения см. в разделе [Создание записи A](./app-service-web-tutorial-custom-domain.md#create-the-a-record).
- Если вам не нужно использовать корневой домен для приложения, рекомендуется использовать запись CNAME вместо записи A.
- Не используйте обе записи CNAME и A для одного домена. Эта проблема может вызвать конфликт и предотвратить разрешение домена. 

**Причина 2** 

Веб-браузер может по-прежнему кэшировать старый IP-адрес для домена. 

**Решение для причины 2**

Очистите браузер. Для устройств Windows можно выполнить команду `ipconfig /flushdns`. С помощью [WhatsmyDNS.net](https://www.whatsmydns.net/) можно проверить, указывает ли домен на IP-адрес приложения.

### <a name="you-cant-add-a-subdomain"></a>Не удалось добавить дочерний домен 

#### <a name="symptom"></a>Симптом

Не удается добавить новое имя узла в приложение, чтобы назначить поддомен.

#### <a name="solution"></a>Решение

- Обратитесь к администратору подписки, чтобы убедиться, что у вас есть разрешение на добавление имени узла в приложение.
- Если требуется больше поддоменов, рекомендуется изменить размещение домена в службе доменных имен Azure (DNS). С помощью Azure DNS можно добавить в приложение до 500 имен узлов. Дополнительные сведения см. в записи блога о [добавлении поддомена](/archive/blogs/waws/mapping-a-custom-subdomain-to-an-azure-website).

### <a name="dns-cant-be-resolved"></a>Не удается распознать службу доменных имен

#### <a name="symptom"></a>Симптом

Отображается следующее сообщение об ошибке:

"Не удается найти запись DNS".

#### <a name="cause"></a>Причина
Эта ошибка возникает по одной из следующих причин:

- Срок жизни не истек. Проверьте конфигурацию DNS своего домена, чтобы определить значение срока жизни, а затем подождите его окончания.
- Недопустимая конфигурация DNS.

#### <a name="solution"></a>Решение
- Подождите 48 часов. Спустя это время проблема устранится самостоятельно.
- Если вы можете изменить параметры срока жизни в конфигурации DNS, измените значение на 5 минут, чтобы увидеть, устранена ли проблема.
- С помощью [WhatsmyDNS.net](https://www.whatsmydns.net/) можно проверить, указывает ли домен на IP-адрес приложения. Если нет, настройте для записи A правильный IP-адрес приложения.

### <a name="you-need-to-restore-a-deleted-domain"></a>Нужно восстановить удаленный домен 

#### <a name="symptom"></a>Симптом
Домен больше не отображается на портале Azure.

#### <a name="cause"></a>Причина 
Возможно, домен случайно удален владельцем подписки.

#### <a name="solution"></a>Решение
Если домен удален меньше семи дней назад, процесс удаления не был запущен. В этом случае можно приобрести тот же домен снова на портале Azure в рамках одной подписки (Обязательно введите точное доменное имя в поле поиска.) К этому домену не будет применяться еще раз. Если домен был удален более семи дней назад, обратитесь в [службу поддержки Azure](https://portal.azure.com/?#blade/Microsoft_Azure_Support/HelpAndSupportBlade) за помощью по восстановлению домена.

## <a name="domain-problems"></a>Проблемы домена

### <a name="you-purchased-a-tlsssl-certificate-for-the-wrong-domain"></a>Вы приобрели сертификат TLS/SSL для неправильного домена

#### <a name="symptom"></a>Симптом

Приобретен сертификат службы приложений для неверного домена. Не удается обновить сертификат для использования правильного домена.

#### <a name="solution"></a>Решение

Удалите этот сертификат, а затем приобретите новый.

Если текущий сертификат, который использует неверный домен, имеет состояние "Выдан", за него также выставляется счет. Плата за сертификаты службы приложений не возвращается, но вы можете обратиться в [службу поддержки Azure](https://portal.azure.com/?#blade/Microsoft_Azure_Support/HelpAndSupportBlade), чтобы рассмотреть другие варианты. 

### <a name="an-app-service-certificate-was-renewed-but-the-app-shows-the-old-certificate"></a>Сертификат службы приложений был обновлен, но в приложении по-прежнему отображается старый сертификат 

#### <a name="symptom"></a>Симптом

Сертификат службы приложений обновлен, но приложение, использующее сертификат службы приложений, по-прежнему использует старый сертификат. Кроме того, вы получили предупреждение о том, что необходим протокол HTTP.

#### <a name="cause"></a>Причина 
Служба приложений автоматически синхронизирует сертификат в течение 48 часов. Если вы изменяете или обновляете сертификат, иногда приложение по-прежнему извлекает старый сертификат, а не только что обновленный. Это связано с тем, что задание для синхронизации ресурсов сертификата еще не запущено. Нажмите кнопку синхронизировать. Операция синхронизации автоматически обновляет привязки имен узлов для сертификата в службе приложений, не вызывая каких бы то ни было простоев в приложениях.

#### <a name="solution"></a>Решение

Вы можете принудительно выполнить синхронизацию сертификата. Для этого сделайте следующее:

1. Войдите на [портал Azure](https://portal.azure.com). Выберите **Сертификаты службы приложений**, а затем — сертификат.
2. Выберите переключатель **ключей и синхронизация**, а затем щелкните **синхронизировать**. Для завершения синхронизации потребуется некоторое время. 
3. После завершения синхронизации отобразится следующее уведомление: "Все ресурсы обновлены с использованием нового сертификата".

### <a name="domain-verification-is-not-working"></a>Проверка домена не работает 

#### <a name="symptom"></a>Симптом 
Прежде чем использовать сертификат службы приложений, необходимо выполнить проверку домена. Если щелкнуть **Проверить**, процесс завершится ошибкой.

#### <a name="solution"></a>Решение
Проверьте домен вручную, добавив запись типа TXT:

1. Перейдите к поставщику службы доменных имен (DNS), на котором размещено доменное имя.
1. Добавьте запись типа TXT для домена, использующего значение токена домена, показанного на портале Azure. 

Подождите несколько минут до запуска распространения данных в DNS, а затем нажмите кнопку **Обновить** для запуска проверки. 

В качестве альтернативы вы можете использовать метод веб-страницы HTML, чтобы вручную подтвердить свой домен. Этот метод позволяет центру сертификации подтвердить права на владение доменом, для которого выдан сертификат.

1. Создайте HTML-файл с именем {токен проверки домена}.html. Содержимым этого файла должно быть значение токена проверки домена.
1. Отправьте этот файл в корень веб-сервера, на котором размещается ваш домен.
1. Выберите **Обновить**, чтобы проверить состояние сертификата. Проверка может занять несколько минут.

Например, если вы приобретаете стандартный сертификат для azure.com с токеном проверки домена 1234abcd, то веб-запрос, направленный по адресу https://azure.com/1234abcd.html, должен возвратить 1234abcd. 

> [!IMPORTANT]
> При заказе сертификата на проверку домена отводится всего 15 дней, по истечении которых сертификат отклоняется центром сертификации, а счет за этот сертификат не выставляется. В такой ситуации удалите этот сертификат и повторите попытку.
>
> 

### <a name="you-cant-purchase-a-domain"></a>Не удается приобрести домен

#### <a name="symptom"></a>Симптом
Не удается приобрести домен службы приложений на портале Azure.

#### <a name="cause-and-solution"></a>Причина и решение

Эта ошибка возникает по одной из следующих причин:

- Кредитная карта для подписки Azure отсутствует или недействительна.

    **Решение.** Добавьте действительную кредитную карту в подписку.

- Вы не являетесь владельцем подписки, поэтому у вас нет разрешения на покупку домена.

    **Решение.**[Назначьте роль "Владелец"](../role-based-access-control/role-assignments-portal.md) своей учетной записи. Или свяжитесь с администратором, чтобы получить разрешение на приобретение домена.
- Вы достигли предельного числа приобретений доменов для подписки. Текущее ограничение — 20.

    **Решение.** Чтобы отправить запрос на увеличение ограничения, обратитесь в [службу поддержки Azure](https://portal.azure.com/?#blade/Microsoft_Azure_Support/HelpAndSupportBlade).
- Тип подписки Azure не поддерживает покупку домена службы приложений.

    **Решение.** Обновите подписку Azure до других типов подписки, например до подписки с оплатой по мере использования.

### <a name="you-cant-add-a-host-name-to-an-app"></a>Не удается добавить имя узла в приложение 

#### <a name="symptom"></a>Симптом

При добавлении имени узла процесс проверки и утверждения домена завершается ошибкой.

#### <a name="cause"></a>Причина 

Эта ошибка возникает по одной из следующих причин:

- У вас нет разрешения на добавление имени узла.

    **Решение.** Попросите администратора подписки дать вам разрешение на добавление имени узла.
- Не удается выполнить проверку владельца домена.

    **Решение.** Убедитесь, что запись CNAME или A настроены правильно. Чтобы сопоставить личный домен с приложением, создайте запись CNAME или A. Если вы хотите использовать корневой домен, необходимо воспользоваться записями типа A и TXT.

    |Тип записи|Узел|На что указывает|
    |------|------|-----|
    |A|@|IP-адрес приложения|
    |TXT|@|`<app-name>.azurewebsites.net`|
    |CNAME.|www|`<app-name>.azurewebsites.net`|

## <a name="faq"></a>Вопросы и ответы

**Нужно ли настраивать личный домен для веб-сайта после его приобретения?**

При покупке домена из портал Azure приложение службы приложений автоматически настраивается для использования этого пользовательского домена. Вам не нужно предпринимать никаких дополнительных действий. Дополнительные сведения см. в [самостоятельном обзоре службы приложений Azure: Добавление пользовательского доменного имени](https://channel9.msdn.com/blogs/Azure-App-Service-Self-Help/Add-a-Custom-Domain-Name) в Channel9.

**Можно ли использовать домен, приобретенный в портал Azure, чтобы указать на виртуальную машину Azure?**

Да, можно указать домен для виртуальной машины. Дополнительные сведения см. в статье [Использование Azure DNS для указания параметров личного домена для службы Azure](../dns/dns-custom-domain.md).

**Мой домен размещен в GoDaddy или Azure DNS?**

Домены службы приложений используют GoDaddy для регистрации доменов и Azure DNS для размещения доменов. 

**Я включил автоматическое продление, но получил уведомление об обновлении для своего домена по электронной почте. Что мне делать?**

Если вы включили автоматическое продление, вам не нужно предпринимать никаких действий. Уведомление о том, что домен близок к истечению срока действия, и продление вручную, если автоматическое продление не включено, предоставляется по электронной почте.

**Будет ли взята ставка за Azure DNS размещения моего домена?**

Начальная стоимость приобретения домена применяется только к регистрации домена. В дополнение к стоимости регистрации взимается плата за Azure DNS, основанную на использовании. Дополнительные сведения см. в разделе [Azure DNS цены](https://azure.microsoft.com/pricing/details/dns/) .

**Я приобрел свой домен ранее, начиная с портал Azure и хочу перейти от GoDaddy размещения к размещению Azure DNS. Как это можно сделать?**

Переход на Azure DNSное размещение не является обязательным. Если вы хотите выполнить миграцию на Azure DNS, то при управлении доменами в портал Azure сведения о действиях, необходимых для перехода на Azure DNS, см. здесь. Если домен был приобретен через службу приложений, миграция из GoDaddy, размещенного в Azure DNS, является относительно простой процедурой.

**Я хотел бы купить домен из домена службы приложений, но могу ли я разместить свой домен на GoDaddy, а не Azure DNS?**

Начиная с 24 июля 2017, домены службы приложений, приобретенные на портале, размещаются на Azure DNS. Если вы предпочитаете использовать другого поставщика услуг размещения, необходимо посетить свой веб-сайт, чтобы получить решение для размещения домена.

**Нужно ли платить за защиту конфиденциальности для моего домена?**

При покупке домена с помощью портал Azure можно бесплатно добавить конфиденциальность. Это одно из преимуществ приобретения домена с помощью службы приложений Azure.

**Если я решил, что мой домен больше не нужен, можно ли вернуть деньги?**

При покупке домена вы не платите за пять дней, в течение которых вы можете решить, что вы не хотите использовать домен. Если вы решите, что вы не хотите использовать домен в течение пяти дней, вы не платите за него. (домены Великобритании являются исключением из этого. Если вы приобретаете домен UK, вы сразу нападаете плату, и вы не сможете воздержаться в возмещении.)

**Можно ли использовать домен в другом приложении службы приложений Azure в моей подписке?**

Да. При доступе к колонке личные домены и TLS в портал Azure вы увидите приобретенные домены. Вы можете настроить приложение для использования любого из этих доменов.

**Можно ли переместить домен из одной подписки в другую?**

Вы можете переместить домен в другую подписку или группу ресурсов с помощью командлета PowerShell [Move-азресаурце](/powershell/module/az.Resources/Move-azResource) .

**Как управлять личным доменом, если у меня в настоящее время нет приложения службы приложений Azure?**

Вы можете управлять доменом, даже если у вас нет веб-приложения службы приложений. Домен может использоваться для таких служб Azure, как виртуальная машина, хранилище и т. д. Если вы планируете использовать домен для веб-приложений службы приложений, необходимо включить веб-приложение, которое не входит в план служба приложений (цен. категория "Бесплатный"), чтобы привязать домен к веб-приложению.

**Можно ли переместить веб-приложение с пользовательским доменом в другую подписку или с Среда службы приложений v1 на v2?**

Да, вы можете перемещать веб-приложение между подписками. Следуйте указаниям в статье [Перемещение ресурсов в Azure](../azure-resource-manager/management/move-resource-group-and-subscription.md). При перемещении веб-приложения существует ряд ограничений. Дополнительные сведения см. в статье [ограничения для перемещения ресурсов службы приложений](../azure-resource-manager/management/move-limitations/app-service-move-limitations.md).

После перемещения веб-приложения привязки имен узлов доменов в параметре личные домены должны остаться прежними. Для настройки привязок имен узлов дополнительные действия не требуются.