---
title: Резервное копирование приложения
description: Узнайте, как создавать резервные копии приложений в службе приложений Azure. Выполните ручное или плановое резервное копирование. Настройте резервные копии, включив в них присоединенную базу данных.
ms.assetid: 6223b6bd-84ec-48df-943f-461d84605694
ms.topic: article
ms.date: 10/16/2019
ms.custom: seodec18
ms.openlocfilehash: 7c00205e2931400caa64f35db962d94a732f2524
ms.sourcegitcommit: c27a20b278f2ac758447418ea4c8c61e27927d6a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/03/2021
ms.locfileid: "101714499"
---
# <a name="back-up-your-app-in-azure"></a>Резервное копирование приложения в Azure
Функция архивации и восстановления в [службе приложений Azure](overview.md) позволяет легко создавать резервные копии приложений вручную или по расписанию. Можно настроить бессрочное хранение резервных копий. Вы можете восстановить приложение до моментального снимка предыдущего состояния, перезаписав существующее приложение или восстановив другое.

Сведения о восстановлении приложения из резервной копии см. в статье [Восстановление приложения в службе приложений Azure](web-sites-restore.md).

<a name="whatsbackedup"></a>

## <a name="what-gets-backed-up"></a>Что входит в резервную копию
Служба приложений может архивировать в учетную запись хранения Azure и контейнер, который вы настроили для использования вашим приложением, следующую информацию: 

* конфигурация приложения;
* содержимое файла;
* база данных, подключенная к приложению.

Функция архивации поддерживается для следующих решений базы данных: 

- [База данных SQL](https://azure.microsoft.com/services/sql-database/)
- [База данных Azure для MySQL](https://azure.microsoft.com/services/mysql)
- [База данных Azure для PostgreSQL](https://azure.microsoft.com/services/postgresql)
- [MySQL в приложении](https://azure.microsoft.com/blog/mysql-in-app-preview-app-service/).
 

> [!NOTE]
> Каждая резервная копия является полной автономной копией приложения, а не добавочным обновлением.
>

<a name="requirements"></a>

## <a name="requirements-and-restrictions"></a>Требования и ограничения
* Для использования резервного копирования и восстановления требуется, чтобы у плана службы приложений был уровень **Стандартный**, **Премиум** или **Изолированный**. Дополнительные сведения о масштабировании плана службы приложений для использования более высокого уровня см. в статье [Масштабирование веб-приложения в службе приложений Azure](manage-scale-up.md). Уровни **Премиум** и **Изолированный** позволяют создавать большее количество ежедневных резервных копий по сравнению с уровнем **Стандартный**.
* Для архивации требуется учетная запись хранения Azure и контейнер в той же подписке, что и приложение, для которого вы хотите создавать резервные копии. Дополнительные сведения об учетных записях хранения Azure см. в статье [Общие сведения об учетной записи хранения](../storage/common/storage-account-overview.md).
* Резервная копия может вмещать до 10 ГБ содержимого приложения и базы данных. Если размер резервной копии превысит этот лимит, отобразится сообщение об ошибке.
* Резервные копии базы данных Azure для MySQL с поддержкой TLS не поддерживаются. Если резервная копия настроена, возникнут сбои резервного копирования.
* Резервные копии базы данных Azure для PostgreSQL с поддержкой TLS не поддерживаются. Если резервная копия настроена, возникнут сбои резервного копирования.
* Базы данных в приложении MySQL автоматически создают резервные копии без любой настройки. Резервные копии могут не работать должным образом, если вы вручную задаете параметры базы данных в приложении MySQL, такие как добавление строки подключения.
* Использование учетной записи хранения с поддержкой брандмауэра в качестве места назначения резервных копий не поддерживается. Если резервная копия настроена, возникнут сбои резервного копирования.


<a name="manualbackup"></a>

## <a name="create-a-manual-backup"></a>Создание резервной копии вручную
1. На [портале Azure](https://portal.azure.com) перейдите на страницу своего приложения и выберите **Резервные копии**. Откроется страница **Резервные копии**.

    ![Страница резервных копий](./media/manage-backup/access-backup-page.png)

    > [!NOTE]
    > Если вы видите приведенное ниже сообщение, щелкните его, чтобы обновить план службы приложений, прежде чем продолжить резервное копирование.
    > Дополнительные сведения см. в статье [Увеличение масштаба приложения в Azure](manage-scale-up.md).
    > :::image type="content" source="./media/manage-backup/upgrade-plan.png" alt-text="Снимок экрана баннера с сообщением для обновления плана службы приложений для доступа к функции резервного копирования и восстановления.":::
    > 
    > 

2. На странице **Архивация** выберите **Архивация не настроена. Щелкните здесь, чтобы настроить архивацию для приложения**.

    ![Щелкните "Настроить".](./media/manage-backup/configure-start.png)

3. На странице **Конфигурация архивации** щелкните **Хранилище: не настроено**, чтобы настроить учетную запись хранения.

    :::image type="content" source="./media/manage-backup/configure-storage.png" alt-text="Снимок экрана: раздел &quot;хранилище резервных копий&quot; с выбранным параметром &quot;хранилище не настроен&quot;.":::

4. Выберите расположение резервной копии, щелкнув **Учетная запись хранения** > **Контейнер**. Эта учетная запись хранения должна принадлежать к той же подписке, что и приложение, резервную копию которого вы собираетесь создать. При необходимости на соответствующих страницах можно создать новую учетную запись хранения или новый контейнер. Закончив, щелкните **Выбрать**.

5. На странице **Конфигурация резервного копирования** , которая остается открытой, можно настроить **базу данных архивации**, затем выбрать базы данных, которые необходимо включить в резервные копии (база данных SQL или MySQL), а затем нажать кнопку **ОК**.

    :::image type="content" source="./media/manage-backup/configure-database.png" alt-text="Снимок экрана: раздел &quot;резервное копирование базы данных&quot; с выбором параметра &quot;включить в резервную копию&quot;":::

    > [!NOTE]
    > Чтобы база данных появилась в этом списке, ее строка подключения должна присутствовать в разделе **Строки подключения** страницы **Параметры приложения** вашего приложения. 
    >
    > Базы данных в приложении MySQL автоматически создают резервные копии без любой настройки. Если вы сделаете параметры для баз данных MySQL в приложении вручную, например, добавьте строки подключения, резервные копии могут работать неправильно.
    > 
    > 

6. На странице **Конфигурация архивации** нажмите кнопку **Сохранить**.
7. На странице **Резервные копии** щелкните **Архивация**.

    ![Кнопка создания резервной копии](./media/manage-backup/manual-backup.png)

    Во время процесса архивации отображается сообщение о ходе выполнения.

После того как вы настроили учетную запись хранения и контейнер, вы можете вручную запустить резервное копирование в любой момент. Резервные копии, выполняемые вручную, хранятся неограниченное время.

<a name="automatedbackups"></a>

## <a name="configure-automated-backups"></a>Настройка автоматического резервного копирования
1. На странице **Конфигурация архивации** для параметра **Архивация по расписанию** установите значение **Вкл**. 

    ![Включение автоматически создаваемых резервных копий](./media/manage-backup/scheduled-backup.png)

2. Настройте расписание резервного копирования и нажмите кнопку **ОК**.

<a name="partialbackups"></a>

## <a name="configure-partial-backups"></a>Настройка частичной архивации
Иногда не нужно создавать резервную копию всего приложения. Вот несколько таких случаев.

* У вас [настроена еженедельная архивация](#configure-automated-backups) приложения со статическим содержимым, которое никогда не меняется. Это могут быть старые записи блога или изображения.
* Размер содержимого приложения превышает 10 ГБ (т. е. максимальный размер резервной копии, которую можно создать за раз).
* Не нужно создавать резервную копию файлов журнала.

Частичное резервное копирование позволяет выбрать только те файлы, для которых нужно создать резервную копию.

> [!NOTE]
> Размер отдельных баз данных в резервной копии не может быть больше 4 ГБ. Общий размер резервной копии не может быть больше 10 ГБ.

### <a name="exclude-files-from-your-backup"></a>Исключение файлов из резервной копии
Допустим, есть приложение, содержащее файлы журнала и статические изображения, которые были однажды архивированы и не будут изменяться. В таких случаях вы можете исключить эти папки и файлы из будущих резервных копий. Чтобы исключить файлы и папки из резервных копий, создайте файл `_backup.filter` в папке `D:\home\site\wwwroot` своего приложения. В этом файле укажите список файлов и папок, которые вы хотите исключить. 

Доступ к файлам можно получить, перейдя по адресу `https://<app-name>.scm.azurewebsites.net/DebugConsole`. Если отобразится запрос на вход в учетную запись Azure, выполните его.

Определите папки, которые вы хотите исключить из резервных копий. Например, вы хотите отфильтровать выделенные папки и файлы.

![Папка с изображениями](./media/manage-backup/kudu-images.png)

Создайте файл `_backup.filter` и поместите в него приведенный выше список, при этом удалив `D:\home`. В одной строке указывайте один каталог или файл. В результате содержимое файла будет выглядеть так:

 ```
\site\wwwroot\Images\brand.png
\site\wwwroot\Images\2014
\site\wwwroot\Images\2013
```

Отправьте файл `_backup.filter` в каталог `D:\home\site\wwwroot\` своего сайта с помощью протокола [FTP](deploy-ftp.md) или любым другим способом. При желании можно создать файл непосредственно с помощью `DebugConsole` Kudu и вставить в него содержимое.

Выполните архивацию привычным для вас способом — [вручную](#create-a-manual-backup) или [автоматически](#configure-automated-backups). Теперь любые файлы и папки, которые указаны в `_backup.filter`, будут исключены из будущих архиваций, инициированных по расписанию или вручную. 

> [!NOTE]
> Восстановление частичных резервных копий сайта происходит так же, как и [восстановление обычных резервных копий](web-sites-restore.md). Восстановление выполняется надлежащим образом.
> 
> При восстановлении полной резервной копии все содержимое сайта заменяется содержимым из резервной копии. Если файл, который находится на сайте, не включен в резервную копию, он удаляется. Но при восстановлении частичной резервной копии любое содержимое, расположенное в одном из каталогов с ограниченным доступом или с каким-либо ограниченным файлом, остается недоступным.
> 


<a name="aboutbackups"></a>

## <a name="how-backups-are-stored"></a>Как хранятся резервные копии
После создания одной или нескольких резервных копий приложения они отображаются на странице **Контейнеры** вашей учетной записи хранения, как и ваше приложение. В учетной записи хранения каждая резервная копия состоит из файла `.zip` с резервной копией данных и файла `.xml` с манифестом для содержимого файла `.zip`. Эти файлы можно распаковать и просмотреть, если необходимо получить доступ к резервным копиям без фактического восстановления приложения.

Резервная копия базы данных приложения хранится в корне ZIP-файла. Для базы данных SQL это BACPAC-файл (без расширения файла), который можно импортировать. Сведения о создании базы данных в базе данных SQL Azure на основе экспорта BACPAC см. в разделе [импорт BACPAC-файла для создания базы данных в базе данных SQL Azure](../azure-sql/database/database-import.md).

> [!WARNING]
> Изменение любого из этих файлов в контейнере **websitebackups** может привести к повреждению резервной копии и сделать восстановление из нее невозможным.
> 
> 

## <a name="automate-with-scripts"></a>Автоматизация с помощью сценариев

Управление резервным копированием можно автоматизировать с помощью сценариев, воспользовавшись [Azure CLI](/cli/azure/install-azure-cli) или [Azure PowerShell](/powershell/azure/).

Примеры см. в разделах:

- [Примеры Azure CLI](samples-cli.md)
- [Примеры сценариев Azure PowerShell](samples-powershell.md)

<a name="nextsteps"></a>

## <a name="next-steps"></a>Next Steps
Сведения о восстановлении приложения из резервной копии см. в статье [Восстановление приложения в службе приложений Azure](web-sites-restore.md).