---
title: Восстановление после сбоя в масштабе региона
description: Узнайте, как служба приложений Azure помогает поддерживать возможности обеспечения непрерывности бизнес-процессов и аварийного восстановления (BCDR). Восстановите приложение из-за сбоя на уровне региона в Azure.
ms.topic: how-to
ms.date: 06/09/2020
ms.custom: subject-moving-resources
ms.openlocfilehash: 1388dc11254324f74efcbaa55c97cac2ccd0c026
ms.sourcegitcommit: 772eb9c6684dd4864e0ba507945a83e48b8c16f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "87073744"
---
# <a name="move-an-app-service-app-to-another-region"></a>Перемещение приложения службы приложений в другой регион

В этой статье описывается, как подключить ресурсы службы приложений к сети в другом регионе Azure во время аварии, влияющей на весь регион Azure. Когда после аварии весь регион Azure находится в автономном режиме, все приложения службы приложений, размещенные в этом регионе, помещаются в режим аварийного восстановления. Доступны функции, которые помогут вам восстановить приложение в другом регионе или восстановить файлы из затронутого приложения.

Ресурсы службы приложений зависят от региона и не могут быть перемещены между регионами. Необходимо восстановить приложение в новом приложении в другом регионе, а затем создать конфигурации зеркального отображения или ресурсы для нового приложения.

## <a name="prerequisites"></a>Предварительные требования

- Нет. Для [восстановления из моментального снимка](app-service-web-restore-snapshots.md) обычно требуется уровень " **премиум** ", но в режиме аварийного восстановления он автоматически включается для затронутого приложения, независимо от уровня, в котором находится затронутое приложение.

## <a name="prepare"></a>Подготовка

Найдите все ресурсы службы приложений, которые в настоящее время использует затронутое приложение. Пример:

- Приложения службы приложений
- [Планы службы приложений](overview-hosting-plans.md)
- [Слоты развертывания](deploy-staging-slots.md)
- [Пользовательские домены, приобретенные в Azure](manage-custom-dns-buy-domain.md)
- [SSL-сертификаты](configure-ssl-certificate.md)
- [Интеграция виртуальной сети Azure](web-sites-integrate-with-vnet.md)
- [Гибридные подключения](app-service-hybrid-connections.md).
- [Управляемые удостоверения](overview-managed-identity.md)
- [Параметры резервного копирования](manage-backup.md)

Некоторые ресурсы, например импортированные сертификаты или гибридные подключения, содержат интеграцию с другими службами Azure. Сведения о том, как переместить эти ресурсы в регионах, см. в документации по соответствующим службам.

## <a name="restore-app-to-a-different-region"></a>Восстановить приложение в другом регионе

1. Создайте новое приложение службы приложений в *регионе Azure, отличном* от региона затронутого приложения. Это целевое приложение в сценарии аварийного восстановления.

1. В [портал Azure](https://portal.azure.com)перейдите на страницу управления затронутым приложением. В неисправном регионе Azure в затронутом приложении отображается текст предупреждения. Щелкните текст предупреждения.

    ![Снимок экрана со страницей затронутого приложения. Отображается предупреждающее уведомление, описывающее ситуацию, и предоставляет ссылку для восстановления приложения.](media/manage-disaster-recovery/restore-start.png)

1. На странице **Восстановление резервной копии** настройте операцию восстановления в соответствии со следующей таблицей. После завершения нажмите кнопку **ОК**.

   | Параметр | Значение | Описание |
   |-|-|-|
   | **Моментальный снимок (Предварительная версия)** | Выберите моментальный снимок. | Доступны два последних моментальных снимка. |
   | **Назначение восстановления** | **Существующее приложение** | Щелкните примечание ниже, **чтобы изменить целевое приложение восстановления** и выбрать целевое приложение. В случае аварии моментальный снимок можно восстановить только в приложение в другом регионе Azure. |
   | **Восстановить конфигурацию сайта** | **Да** | |

    ![Снимок экрана со страницей восстановления резервной копии. Указанный моментальный снимок, параметры, приведенные в предыдущей таблице, и кнопка «ОК» будут выделены.](media/manage-disaster-recovery/restore-configure.png)

3. Настройте [все остальное](#prepare) в целевом приложении, чтобы создать зеркальное отображение затронутого приложения, и проверьте конфигурацию.

4. Когда личный домен будет готов к переходу к целевому приложению, следует [сопоставить доменное имя](manage-custom-dns-migrate-domain.md#remap-the-active-dns-name).

## <a name="recover-app-content-only"></a>Восстановить только содержимое приложения

Если вы хотите восстановить только файлы из затронутого приложения без восстановления, выполните следующие действия.

1. В [портал Azure](https://portal.azure.com)перейдите на страницу управления затронутым приложением и щелкните **получить профиль публикации**.

    ![Снимок экрана со страницей затронутого приложения. Предупреждение отображается, но не выделено. Вместо этого выводится выделенный элемент профиля публикации.](media/manage-disaster-recovery/get-publish-profile.png)

1. Откройте скачанный файл и найдите профиль публикации, содержащий `ReadOnly - FTP` его имя. Это профиль аварийного восстановления. Пример:

    ```xml
    <publishProfile profileName="%app-name% - ReadOnly - FTP" publishMethod="FTP" publishUrl="ftp://%ftp-site%/site/wwwroot" ftpPassiveMode="True" userName="%app-name%\$%app-name%" userPWD="" destinationAppUrl="http://%app-name%.azurewebsites.net" SQLServerDBConnectionString="" mySQLDBConnectionString="" hostingProviderForumLink="" controlPanelLink="http://windows.azure.com" webSystem="WebSites">
        <databases />
    </publishProfile>
    ```
    
    Скопируйте три значения атрибута: 
        
    - `publishUrl`: имя узла FTP
    - `userName` и `userPWD` : учетные данные FTP

1. Используйте любой FTP-клиент по своему усмотрению, подключитесь к узлу FTP затронутого приложения, используя имя узла и учетные данные.

1. После подключения Скачайте всю папку */site/wwwroot* . На следующем снимке экрана показано, как скачать в [FileZilla](https://filezilla-project.org/).

    ![Снимок экрана: иерархия файлов FileZilla. Папка wwwroot выделяется, и ее контекстное меню отображается. В этом меню будет выделена загрузка.](media/manage-disaster-recovery/download-content.png)

## <a name="next-steps"></a>Дальнейшие действия
[Восстановление приложения в Azure из моментального снимка](app-service-web-restore-snapshots.md)
