---
title: Руководство по сопоставлению существующих настраиваемых DNS-имен
description: Узнайте, как добавить имеющееся DNS-имя личного домена (именного домена) для веб-приложения, серверной части мобильного приложения или приложения API в службе приложений Azure.
keywords: служба приложений, служба приложений Azure, сопоставление доменов, доменное имя, существующий домен, имя узла
ms.assetid: dc446e0e-0958-48ea-8d99-441d2b947a7c
ms.devlang: nodejs
ms.topic: tutorial
ms.date: 08/25/2020
ms.custom: mvc, seodec18
adobe-target: true
adobe-target-activity: DocsExp–386541–A/B–Enhanced-Readability-Quickstarts–2.19.2021
adobe-target-experience: Experience B
adobe-target-content: ./app-service-web-tutorial-custom-domain-uiex
ms.openlocfilehash: 79599ce04b93409c67342be73cf88d5e20621c1d
ms.sourcegitcommit: 24a12d4692c4a4c97f6e31a5fbda971695c4cd68
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/05/2021
ms.locfileid: "102182593"
---
# <a name="tutorial-map-an-existing-custom-dns-name-to-azure-app-service"></a>Руководство по Сопоставление существующего настраиваемого DNS-имени со Службой приложений Azure

[Служба приложений Azure](overview.md) — это служба веб-размещения с самостоятельной установкой исправлений и высоким уровнем масштабируемости. В этом учебнике показано, как сопоставить имеющееся настраиваемое DNS-имя со Службой приложений.

![Снимок экрана, на котором показан переход к приложению Azure на портале Azure.](./media/app-service-web-tutorial-custom-domain/app-with-custom-dns.png)

В этом руководстве описано следующее:

> [!div class="checklist"]
> * Сопоставление поддомена (например, `www.contoso.com`) с помощью записи CNAME.
> * Сопоставление корневого домена (например, `contoso.com`) с помощью записи A.
> * Сопоставление домена с подстановочным знаком (например, `*.contoso.com`) с помощью записи CNAME.
> * Перенаправление URL-адреса по умолчанию к пользовательскому каталогу.
> * Автоматизация сопоставления доменов с помощью скриптов.

## <a name="prerequisites"></a>Предварительные требования

Для работы с этим руководством сделайте следующее:

* [Создайте приложение службы приложений](./index.yml) или используйте приложение, созданное для работы с другим руководством.
* Приобретите доменное имя и убедитесь, что вы имеете доступ к реестру DNS поставщика домена (например, GoDaddy).

  Например, чтобы добавить записи DNS для `contoso.com` и `www.contoso.com`, необходимо настроить параметры DNS для корневого домена `contoso.com`.

  > [!NOTE]
  > Если у вас нет доменного имени, вы можете [купить его на портале Azure](manage-custom-dns-buy-domain.md).

## <a name="prepare-the-app"></a>Подготовка приложения

Чтобы сопоставить настраиваемое DNS-имя с веб-приложением, уровень [плана Службы приложений](https://azure.microsoft.com/pricing/details/app-service/) должен быть платным ("Общий", "Базовый", "Стандартный", "Премиум" или "Потребление" для Функций Azure). На этом шаге следует убедиться, что приложение службы приложений находится в поддерживаемой ценовой категории.

[!INCLUDE [app-service-dev-test-note](../../includes/app-service-dev-test-note.md)]

### <a name="sign-in-to-azure"></a>Вход в Azure

Откройте [портал Azure](https://portal.azure.com) и войдите в систему, используя свою учетную запись Azure.

### <a name="select-the-app-in-the-azure-portal"></a>Выбор приложения на портале Azure

1. Найдите в поиске и выберите **Службы приложений**.

   ![Снимок экрана, на котором показан выбор Служб приложений.](./media/app-service-web-tutorial-custom-domain/app-services.png)

1. На странице **Службы приложений** выберите имя приложения Azure.

   ![Снимок экрана, на котором показан переход к приложению Azure на портале.](./media/app-service-web-tutorial-custom-domain/select-app.png)

Откроется страница управления приложением службы приложений.

<a name="checkpricing" aria-hidden="true"></a>

### <a name="check-the-pricing-tier"></a>Проверка ценовой категории

1. В левой области страницы приложения перейдите к разделу **Параметры** и выберите **Увеличить масштаб (план службы приложений)** .

   ![Снимок экрана с меню параметра "Увеличить масштаб (план службы приложений)".](./media/app-service-web-tutorial-custom-domain/scale-up-menu.png)

1. Текущий уровень приложения выделен синей рамкой. Убедитесь, что приложение не находится в ценовой категории **F1**. Использование личного домена DNS не поддерживается на уровне **F1**.

   ![Снимок экрана, на котором показаны рекомендуемые ценовые категории.](./media/app-service-web-tutorial-custom-domain/check-pricing-tier.png)

1. Если план службы приложений не **F1**, закройте страницу **увеличения масштаба** и перейдите к разделу [Map a CNAME record](#map-a-cname-record) (Сопоставление записи CNAME).

<a name="scaleup" aria-hidden="true"></a>

### <a name="scale-up-the-app-service-plan"></a>Изменение уровня плана службы приложений

1. Выберите любой платный уровень (**D1**, **B1**, **B2**, **B3** или любой уровень в категории **Рабочие**). Чтобы просмотреть дополнительные параметры, выберите **См. дополнительные параметры**.

1. Нажмите кнопку **Применить**.

   ![Снимок экрана, на котором показана проверка ценовой категории.](./media/app-service-web-tutorial-custom-domain/choose-pricing-tier.png)

   Если вы увидите уведомление ниже, значит уровень плана службы приложений изменен.

   ![Снимок экрана, на котором показано подтверждение операции масштабирования.](./media/app-service-web-tutorial-custom-domain/scale-notification.png)

<a name="cname" aria-hidden="true"></a>

## <a name="get-a-domain-verification-id"></a>Получение идентификатора проверки домена

Чтобы добавить личный домен в приложение, необходимо проверить его принадлежность к домену, добавив идентификатор проверки в качестве записи в формате TXT в поставщике домена. В левой области страницы приложения выберите **Личные домены**. Скопируйте **идентификатор проверки личного домена**, который потребуется на следующем шаге, на странице **Личные домены**.

![Снимок экрана, показывающий идентификатор в поле идентификатора проверки личного домена.](./media/app-service-web-tutorial-custom-domain/get-custom-domain-verification-id.png)

> [!WARNING]
> Добавление идентификаторов проверки доменов в личный домен может предотвратить появление несвязанных записей DNS и захват поддоменов. Личные домены, которые вы настроили ранее без этого идентификатора проверки, следует защитить от такого же риска, добавив идентификатор проверки в запись DNS. Дополнительные сведения о таких распространенных угрозах с высоким уровнем серьезности см. в статье [Захват поддомена](../security/fundamentals/subdomain-takeover.md).

## <a name="map-your-domain"></a>Сопоставление домена

Для сопоставления настраиваемого DNS-имени со службой приложений можно использовать запись CNAME или запись A. Сделайте следующее:

- [Сопоставьте запись CNAME](#map-a-cname-record).
- [Сопоставьте запись A](#map-an-a-record).
- [Сопоставьте домен с подстановочным знаком с помощью записи CNAME](#map-a-wildcard-domain).

> [!NOTE]
> Вам нужно использовать записи CNAME для всех пользовательских имен DNS, кроме корневого домена (например, `contoso.com`). Для корневых доменов используйте записи A.

### <a name="map-a-cname-record"></a>Сопоставление записи CNAME

В примере из руководства вы добавите запись CNAME для поддомена `www` (например, `www.contoso.com`).

Если у вас есть поддомен, отличный от `www`, замените `www` своим поддоменом (например, `sub`, если в качестве личного домена используется `sub.constoso.com`).

#### <a name="access-dns-records-with-a-domain-provider"></a>Доступ к записям DNS с помощью поставщика домена

[!INCLUDE [Access DNS records with domain provider](../../includes/app-service-web-access-dns-records-no-h.md)]

#### <a name="create-the-cname-record"></a>Создание записи CNAME

Сопоставьте поддомен с доменным именем приложения по умолчанию (`<app-name>.azurewebsites.net`, где `<app-name>` — это имя приложения). Чтобы создать сопоставление CNAME для поддомена `www`, создайте две записи:

| Тип записи | Узел | Значение | Комментарии |
| - | - | - |
| CNAME | `www` | `<app-name>.azurewebsites.net` | Само сопоставление домена. |
| TXT | `asuid.www` | [Идентификатор проверки, полученный ранее](#get-a-domain-verification-id) | Служба приложений обращается к записи в формате TXT `asuid.<subdomain>`, чтобы проверить владение личным доменом. |

После добавления записей CNAME и TXT страница управления записями DNS выглядит так:

![Снимок экрана, на котором показан переход к приложению Azure на портале.](./media/app-service-web-tutorial-custom-domain/cname-record.png)

#### <a name="enable-the-cname-record-mapping-in-azure"></a>Включение сопоставления записи CNAME в приложении Azure

1. В левой области страницы приложения на портале Azure выберите **Личные домены**.

    ![Снимок экрана: меню "Личные домены".](./media/app-service-web-tutorial-custom-domain/custom-domain-menu.png)

1. На странице **Личные домены** приложения добавьте в список полное настраиваемое DNS-имя (`www.contoso.com`).

1. Нажмите кнопку **Добавить личный домен**.

    ![Снимок экрана, на котором показан элемент добавления имени узла.](./media/app-service-web-tutorial-custom-domain/add-host-name-cname.png)

1. Введите полное доменное имя, для которого вы добавили запись CNAME, например `www.contoso.com`.

1. Выберите **Проверить**. Откроется страница **Добавить личный домен**.

1. Убедитесь, что в поле **Тип записи имени узла** выбрана запись **CNAME (wwwexample\.com или любой поддомен)** . Нажмите кнопку **Добавить личный домен**.

    ![Снимок экрана, на котором показана кнопка "Добавить личный домен".](./media/app-service-web-tutorial-custom-domain/validate-domain-name-cname.png)

    Возможно, потребуется некоторое время, чтобы новый личный домен отобразился на странице **Личные домены** вашего приложения. Обновите браузер, чтобы обновить данные.

    ![Снимок экрана, показывающий добавление записи CNAME.](./media/app-service-web-tutorial-custom-domain/cname-record-added.png)

    > [!NOTE]
    > Метка предупреждения для личного домена означает, что он еще не привязан к TLS/SSL-сертификату. На любой HTTPS-запрос из браузера к такому личному домену возвращается сообщение об ошибке или предупреждение в зависимости от браузера. Сведения о добавлении привязки TLS см. в статье [Защита пользовательского доменного имени с помощью привязки TLS/SSL в Службе приложений Azure](configure-ssl-bindings.md).

    Если вы пропустили шаг или где-то допустили опечатку, в нижней части страницы появится сообщение об ошибке проверки.

    ![Снимок экрана, на котором показана ошибка проверки.](./media/app-service-web-tutorial-custom-domain/verification-error-cname.png)

<a name="a" aria-hidden="true"></a>

### <a name="map-an-a-record"></a>Сопоставление записи A

В примере из руководства вы добавите запись A для корневого домена (например, `contoso.com`).

<a name="info"></a>

#### <a name="copy-the-apps-ip-address"></a>Копирование IP-адреса приложения

Чтобы сопоставить запись A, необходим внешний IP-адрес вашего приложения. Этот IP-адрес можно найти на странице **Личные домены** приложения на портале Azure.

1. В левой области страницы приложения на портале Azure выберите **Личные домены**.

   ![Снимок экрана: меню "Личные домены".](./media/app-service-web-tutorial-custom-domain/custom-domain-menu.png)

1. На странице **Личные домены** скопируйте IP-адрес приложения.

   ![Снимок экрана, на котором показан переход к приложению Azure на портале.](./media/app-service-web-tutorial-custom-domain/mapping-information.png)

#### <a name="access-dns-records-with-a-domain-provider"></a>Доступ к записям DNS с помощью поставщика домена

[!INCLUDE [Access DNS records with domain provider](../../includes/app-service-web-access-dns-records-no-h.md)]

#### <a name="create-the-a-record"></a>Создание записи A

Чтобы связать запись A с приложением (обычно с корневым доменом), создайте две записи:

| Тип записи | Узел | Значение | Комментарии |
| - | - | - |
| Объект | `@` | IP-адрес из раздела [Копирование IP-адреса приложения](#info). | Само сопоставление домена (`@` обычно представляет корневой домен). |
| TXT | `asuid` | [Идентификатор проверки, полученный ранее](#get-a-domain-verification-id) | Служба приложений обращается к записи в формате TXT `asuid.<subdomain>`, чтобы проверить владение личным доменом. В качестве корневого домена используйте `asuid`. |

> [!NOTE]
> Чтобы добавить поддомен (например, `www.contoso.com`) с помощью записи A вместо рекомендуемой [записи CNAME](#map-a-cname-record), запись A и запись TXT должны выглядеть так, как показано в следующей таблице:
>
> | Тип записи | Узел | Значение |
> | - | - | - |
> | Объект | `www` | IP-адрес из раздела [Копирование IP-адреса приложения](#info). |
> | TXT | `asuid.www` | [Идентификатор проверки, полученный ранее](#get-a-domain-verification-id) |
>

После добавления этих записей страница управления записями DNS выглядит так:

![Снимок экрана, на котором показана страница записей DNS.](./media/app-service-web-tutorial-custom-domain/a-record.png)

<a name="enable-a" aria-hidden="true"></a>

#### <a name="enable-the-a-record-mapping-in-the-app"></a>Включение сопоставления записи A в приложении

На странице **Личные домены** приложения на портале Azure добавьте в список полное настраиваемое DNS-имя (например, `contoso.com`).

1. Нажмите кнопку **Добавить личный домен**.

    ![Снимок экрана, на котором показано добавление имени узла.](./media/app-service-web-tutorial-custom-domain/add-host-name-cname.png)

1. Введите полное доменное имя, для которого вы добавили запись A, например `contoso.com`. 

1. Выберите **Проверить**. Отобразится страница **добавления личного домена**.

1. Убедитесь, что в поле **Тип записи имени узла** выбрано значение **Запись А (example.com)** . Нажмите кнопку **Добавить личный домен**.

    ![Снимок экрана, показывающий добавление DNS-имени в приложение.](./media/app-service-web-tutorial-custom-domain/validate-domain-name.png)

    Возможно, потребуется некоторое время, чтобы новый личный домен отобразился на странице **Личные домены** вашего приложения. Обновите браузер, чтобы обновить данные.

    ![Снимок экрана, показывающий добавление записи A.](./media/app-service-web-tutorial-custom-domain/a-record-added.png)

    > [!NOTE]
    > Метка предупреждения для личного домена означает, что он еще не привязан к TLS/SSL-сертификату. На любой HTTPS-запрос из браузера к такому личному домену возвращается сообщение об ошибке или предупреждение в зависимости от браузера. Сведения о добавлении привязки TLS см. в статье [Защита пользовательского доменного имени с помощью привязки TLS/SSL в Службе приложений Azure](configure-ssl-bindings.md).
    
    Если вы пропустили шаг или где-то допустили опечатку, в нижней части страницы появится сообщение об ошибке проверки.
    
    ![Снимок экрана, на котором показана ошибка проверки.](./media/app-service-web-tutorial-custom-domain/verification-error.png)
    
<a name="wildcard" aria-hidden="true"></a>

### <a name="map-a-wildcard-domain"></a>Сопоставление домена с подстановочными знаками

В примере из руководства вы сопоставите [DNS-имя с подстановочными знаками](https://en.wikipedia.org/wiki/Wildcard_DNS_record) (например, `*.contoso.com`) с приложением службы приложений, добавив запись CNAME.

#### <a name="access-dns-records-with-a-domain-provider"></a>Доступ к записям DNS с помощью поставщика домена

[!INCLUDE [Access DNS records with domain provider](../../includes/app-service-web-access-dns-records-no-h.md)]

#### <a name="create-the-cname-record"></a>Создание записи CNAME

Сопоставьте имя с подстановочными знаками `*` с доменным именем приложения по умолчанию (`<app-name>.azurewebsites.net`, где `<app-name>` — это имя приложения). Чтобы сопоставить имя с подстановочными знаками, создайте две записи:

| Тип записи | Узел | Значение | Комментарии |
| - | - | - |
| CNAME | `*` | `<app-name>.azurewebsites.net` | Само сопоставление домена. |
| TXT | `asuid` | [Идентификатор проверки, полученный ранее](#get-a-domain-verification-id) | Служба приложений обращается к записи в формате TXT `asuid`, чтобы проверить владение личным доменом. |

Для примера домена `*.contoso.com` запись CNAME сопоставит имя `*` с `<app-name>.azurewebsites.net`.

После добавления записи CNAME страница управления записями DNS выглядит так:

![Снимок экрана, на котором показан переход к приложению Azure.](./media/app-service-web-tutorial-custom-domain/cname-record-wildcard.png)

#### <a name="enable-the-cname-record-mapping-in-the-app"></a>Включение сопоставления записи CNAME в приложении

Теперь вы можете добавить любой дочерний домен, соответствующий имени с подстановочными знаками в приложении (например, `sub1.contoso.com`, `sub2.contoso.com` или `*.contoso.com`, каждый из которых соответствует `*.contoso.com`).

1. В левой области страницы приложения на портале Azure выберите **Личные домены**.

    ![Снимок экрана: меню "Личные домены".](./media/app-service-web-tutorial-custom-domain/custom-domain-menu.png)

1. Нажмите кнопку **Добавить личный домен**.

    ![Снимок экрана, на котором показано добавление имени узла.](./media/app-service-web-tutorial-custom-domain/add-host-name-cname.png)

1. Введите полное доменное имя, соответствующее домену с подстановочными знаками (например, `sub1.contoso.com`), а затем выберите **Проверка**.

    Активируется кнопка **Добавить личный домен**.

1. Убедитесь, что в поле **Тип записи имени узла** выбрана запись **CNAME (www\.examplecom или любой поддомен)** . Нажмите кнопку **Добавить личный домен**.

    ![Снимок экрана, на котором показано добавление DNS-имени в приложение.](./media/app-service-web-tutorial-custom-domain/validate-domain-name-cname-wildcard.png)

    Возможно, потребуется некоторое время, чтобы новый личный домен отобразился на странице **Личные домены** вашего приложения. Обновите браузер, чтобы обновить данные.

1. Щелкните значок **+** , чтобы добавить другой личный домен, соответствующий домену с подстановочными знаками. Например, добавьте `sub2.contoso.com`.

    ![Снимок экрана, показывающий добавление записи CNAME.](./media/app-service-web-tutorial-custom-domain/cname-record-added-wildcard-2.png)

    > [!NOTE]
    > Метка предупреждения для личного домена означает, что он еще не привязан к TLS/SSL-сертификату. На любой HTTPS-запрос из браузера к такому личному домену возвращается сообщение об ошибке или предупреждение в зависимости от браузера. Сведения о добавлении привязки TLS см. в статье [Защита пользовательского доменного имени с помощью привязки TLS/SSL в Службе приложений Azure](configure-ssl-bindings.md).
    
## <a name="test-in-a-browser"></a>Проверка в браузере

Перейдите к DNS-именам, настроенным ранее (например, `contoso.com`, `www.contoso.com`, `sub1.contoso.com` и `sub2.contoso.com`).

![Снимок экрана, на котором показан переход к приложению Azure.](./media/app-service-web-tutorial-custom-domain/app-with-custom-dns.png)

## <a name="resolve-404-not-found"></a>Устранение ошибки 404 Not Found (Не найдено)

Если появляется ошибка "HTTP 404 (не найдено)" при переходе по URL-адресу вашего личного домена, убедитесь, что этот домен разрешает IP-адрес приложения, воспользовавшись сайтом <a href="https://www.nslookup.io/" target="_blank">nslookup.io</a>. Если это не так, с помощью того же сайта убедитесь, что записи A и CNAME настроены правильно. Если IP-адрес разрешается правильно, но по-прежнему возникает ошибка 404, возможно, в кэше браузера сохранен старый IP-адрес вашего домена. Выполните очистку кэша и еще раз проверьте разрешение DNS. На компьютере Windows кэш можно очистить с помощью команды `ipconfig /flushdns`.

## <a name="migrate-an-active-domain"></a>Перенос активного домена

Сведения о том, как перенести активный веб-сайт и его DNS-имя домена в службу приложений без простоев, см. в статье [Перенос активного DNS-имени в службу приложений Azure](manage-custom-dns-migrate-domain.md).

<a name="virtualdir" aria-hidden="true"></a>

## <a name="redirect-to-a-custom-directory"></a>Перенаправление к пользовательскому каталогу

По умолчанию служба приложений направляет веб-запросы в корневой каталог кода приложения. Однако некоторые веб-платформы не запускаются в корневом каталоге. Например, [Laravel](https://laravel.com/) запускается в подкаталоге `public`. Чтобы продолжить пример DNS `contoso.com`, такое приложение будет доступно по адресу `http://contoso.com/public`, но вместо этого вам потребуется направлять `http://contoso.com` в каталог `public`. Этот шаг включает в себя не разрешение имен DNS, а настройку виртуального каталога.

Чтобы настроить виртуальный каталог для приложений Windows, выберите **Параметры приложения** в левой области страницы веб-приложения. 

> [!NOTE]
> В приложениях Linux эта страница отсутствует. Чтобы изменить корень сайта для приложений Linux, см. инструкции по настройке для конкретного языка (например, [PHP](configure-language-php.md?pivots=platform-linux#change-site-root)).

В нижней части страницы корневой виртуальный каталог `/` указывает на `site\wwwroot` по умолчанию. Это корневой каталог кода вашего приложения. Измените его, например, указав `site\wwwroot\public`, и сохраните изменения.

![Снимок экрана, показывающий настройку виртуального каталога.](./media/app-service-web-tutorial-custom-domain/customize-virtual-directory.png)

По завершении операции приложение должно вернуть соответствующую страницу в корневом пути (например, `http://contoso.com`).

## <a name="automate-with-scripts"></a>Автоматизация с помощью сценариев

Управление личными доменами можно автоматизировать с помощью сценариев, воспользовавшись [Azure CLI](/cli/azure/install-azure-cli) или [Azure PowerShell](/powershell/azure/).

### <a name="azure-cli"></a>Azure CLI

Приведенная ниже команда добавляет заданное настраиваемое DNS-имя для приложения службы приложений.

```bash 
az webapp config hostname add \
    --webapp-name <app-name> \
    --resource-group <resource_group_name> \
    --hostname <fully_qualified_domain_name>
``` 

Дополнительные сведения см. в статье [Сопоставление пользовательского домена с веб-приложением](scripts/cli-configure-custom-domain.md).

### <a name="azure-powershell"></a>Azure PowerShell

[!INCLUDE [updated-for-az](../../includes/updated-for-az.md)]

Приведенная ниже команда добавляет заданное настраиваемое DNS-имя для приложения службы приложений.

```powershell  
Set-AzWebApp `
    -Name <app-name> `
    -ResourceGroupName <resource_group_name> ` 
    -HostNames @("<fully_qualified_domain_name>","<app-name>.azurewebsites.net")
```

Дополнительные сведения см. в статье [Назначение пользовательского домена веб-приложению](scripts/powershell-configure-custom-domain.md).

## <a name="next-steps"></a>Дальнейшие действия

В этом руководстве вы узнали, как выполнять следующие задачи:

> [!div class="checklist"]
> * Сопоставление поддомена с помощью записи CNAME.
> * Сопоставление корневого домена с помощью записи A.
> * Сопоставление домена с подстановочным знаком с помощью записи CNAME.
> * Перенаправление URL-адреса по умолчанию к пользовательскому каталогу.
> * Автоматизация сопоставления доменов с помощью скриптов.

Перейдите к следующему учебнику, чтобы научиться привязывать пользовательский TLS/SSL-сертификат к веб-приложению.

> [!div class="nextstepaction"]
> [Защита пользовательского доменного имени с помощью привязки TLS/SSL в Службе приложений Azure](configure-ssl-bindings.md)
