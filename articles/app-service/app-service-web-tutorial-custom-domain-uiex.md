---
title: Руководство по сопоставлению существующих настраиваемых DNS-имен
description: Узнайте, как добавить имеющееся DNS-имя личного домена (именного домена) для веб-приложения, серверной части мобильного приложения или приложения API в службе приложений Azure.
keywords: служба приложений, служба приложений Azure, сопоставление доменов, доменное имя, существующий домен, имя узла, личный домен
ms.assetid: dc446e0e-0958-48ea-8d99-441d2b947a7c
ms.devlang: nodejs
ms.topic: tutorial
ms.date: 08/25/2020
ms.custom: mvc, seodec18
ROBOTS: NOINDEX,NOFOLLOW
ms.openlocfilehash: ca1308c969227336bfb4970f7c5c77b9f2e0cc22
ms.sourcegitcommit: f7eda3db606407f94c6dc6c3316e0651ee5ca37c
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/05/2021
ms.locfileid: "102216536"
---
# <a name="tutorial-map-an-existing-custom-dns-name-to-azure-app-service"></a>Руководство по Сопоставление существующего настраиваемого DNS-имени со Службой приложений Azure

В этом учебнике демонстрируется, как сопоставить любое существующее <abbr title="Доменное имя, приобретенное у GoDaddy или другого регистратора доменов, или поддомен приобретенного домена.">имя DNS личного домена</abbr> значение <abbr title="Служба на основе HTTP для размещения веб-приложений, REST API и мобильных внутренних приложений.">Служба приложений Azure</abbr>.

В этом руководстве вы узнаете, как:

> [!div class="checklist"]
> * Сопоставить поддомен, используя <abbr title="Запись DNS для канонического имени сопоставляет одно доменное имя с другим.">Запись CNAME</abbr>.
> * Сопоставить корневой домен, используя <abbr title="Запись DNS для адреса сопоставляет имя узла с IP-адресом.">Запись A</abbr>.
> * Сопоставление домена с подстановочным знаком с помощью записи CNAME.
> * Перенаправление URL-адреса по умолчанию к пользовательскому каталогу.

<hr/> 

## <a name="1-prepare-your-environment"></a>1. Подготовка среды

* [Создайте приложение службы приложений](./index.yml) или используйте приложение, созданное для работы с другим руководством.
* Убедитесь, что вы можете изменять записи DNS для личного домена. Если у вас еще нет личного домена, вы можете [приобрести домен Службы приложений](manage-custom-dns-buy-domain.md).

    <details>
        <summary>Что нужно для изменения записей DNS?</summary>
        Вам потребуется доступ к реестру DNS используемого поставщика доменов, например GoDaddy. Например, чтобы добавить записи DNS для <code>contoso.com</code> и <code>www.contoso.com</code>, необходимо настроить параметры DNS для корневого домена <code>contoso.com</code>.
    </details>

<hr/> 

## <a name="2-prepare-the-app"></a>2. Подготовка приложения

Чтобы сопоставить пользовательское DNS-имя с приложением, требуется приложение <abbr title="Определяет расположение, размер и функции фермы веб-серверов для размещения приложения.">План службы приложений</abbr> платного уровня (не <abbr title="Уровень Службы приложений Azure, в котором на одной виртуальной машине выполняются все приложения, в том числе приложения других клиентов. Этот уровень предназначен только для разработки и тестирования.">**Бесплатный (F1)**</abbr>). Дополнительные сведения см. в статье [Обзор планов Службы приложений Azure](overview-hosting-plans.md).

#### <a name="sign-in-to-azure"></a>Вход в Azure

Откройте [портал Azure](https://portal.azure.com) и войдите в систему, используя свою учетную запись Azure.

#### <a name="select-the-app-in-the-azure-portal"></a>Выбор приложения на портале Azure

1. Найдите в поиске и выберите **Службы приложений**.

   ![Снимок экрана, на котором показан выбор Служб приложений.](./media/app-service-web-tutorial-custom-domain/app-services.png)

1. На странице **Службы приложений** выберите имя приложения Azure.

   ![Снимок экрана, на котором показан переход к приложению Azure на портале.](./media/app-service-web-tutorial-custom-domain/select-app.png)

    Откроется страница управления приложением службы приложений.

<a name="checkpricing" aria-hidden="true"></a>

#### <a name="check-the-pricing-tier"></a>Проверка ценовой категории

1. В левой области страницы приложения перейдите к разделу **Параметры** и выберите **Увеличить масштаб (план службы приложений)** .

   ![Снимок экрана с меню параметра "Увеличить масштаб (план службы приложений)".](./media/app-service-web-tutorial-custom-domain/scale-up-menu.png)

1. Текущий уровень приложения выделен синей рамкой. Убедитесь, что приложение не находится в ценовой категории **F1**. Использование личного домена DNS не поддерживается на уровне **F1**.

   ![Снимок экрана, на котором показаны рекомендуемые ценовые категории.](./media/app-service-web-tutorial-custom-domain/check-pricing-tier.png)

1. Если план Службы приложений не **F1**, закройте страницу **увеличения масштаба** и перейдите к разделу [3. Get a domain verification ID](#3-get-a-domain-verification-id) (Получение идентификатора проверки домена).

<a name="scaleup" aria-hidden="true"></a>

#### <a name="scale-up-the-app-service-plan"></a>Изменение уровня плана службы приложений

1. Выберите любой платный уровень (**D1**, **B1**, **B2**, **B3** или любой уровень в категории **Рабочие**). Чтобы просмотреть дополнительные параметры, выберите **См. дополнительные параметры**.

1. Нажмите кнопку **Применить**.

   ![Снимок экрана, на котором показана проверка ценовой категории.](./media/app-service-web-tutorial-custom-domain/choose-pricing-tier.png)

   Если вы увидите уведомление ниже, значит уровень плана службы приложений изменен.

   ![Снимок экрана, на котором показано подтверждение операции масштабирования.](./media/app-service-web-tutorial-custom-domain/scale-notification.png)

<hr/> 

<a name="cname" aria-hidden="true"></a>

## <a name="3-get-a-domain-verification-id"></a>3. Получение идентификатора проверки домена

Чтобы добавить личный домен в приложение, необходимо проверить его принадлежность к домену, добавив идентификатор проверки в качестве записи в формате TXT в поставщике домена. 

1. В левой области страницы приложения выберите **Личные домены**. 
1. Скопируйте **идентификатор проверки личного домена**, который потребуется на следующем шаге, на странице **Личные домены**.

    ![Снимок экрана, показывающий идентификатор в поле идентификатора проверки личного домена.](./media/app-service-web-tutorial-custom-domain/get-custom-domain-verification-id.png)

    <details>
        <summary>Зачем мне это нужно?</summary>
        Добавление идентификаторов проверки доменов в личный домен может предотвратить появление несвязанных записей DNS и захват поддоменов. Личные домены, которые вы настроили ранее без этого идентификатора проверки, следует защитить от такого же риска, добавив идентификатор проверки в запись DNS. Дополнительные сведения о таких распространенных угрозах с высоким уровнем серьезности см. в статье <a href="/azure/security/fundamentals/subdomain-takeover">Захват поддомена</a>.
    </details>
    
<a name="info"></a>

3. **(Только запись A)** Чтобы сопоставить <abbr title="Запись DNS для адреса сопоставляет имя узла с IP-адресом.">Запись A</abbr>, вам нужно знать внешний IP-адрес приложения. На странице **Личные домены** скопируйте значение **IP-адрес приложения**.

   ![Снимок экрана, на котором показан переход к приложению Azure на портале.](./media/app-service-web-tutorial-custom-domain/mapping-information.png)

<hr/> 

## <a name="4-create-the-dns-records"></a>4. Создание записей DNS

1. Войдите на веб-сайт своего поставщика домена.

    <details>
        <summary>Можно ли управлять системой DNS поставщика домена с помощью Azure?</summary>
        При желании вы можете применить Azure DNS для управления записями DNS для вашего домена и настройки пользовательского DNS-имени для Службы приложений Azure. Дополнительные сведения см. в руководстве по <a href="https://docs.microsoft.com/azure/dns/dns-delegate-domain-azure-dns">размещению домена в Azure DNS</a>.
    </details>

1. Найдите страницу управления записями DNS. 

    <details>
        <summary>Как найти эту страницу?</summary>
        <p>Каждый поставщик домена имеет свой собственный интерфейс записей DNS, поэтому вам следует обратиться к документации поставщика. Найдите области сайта, обозначенные как <strong>Имя домена</strong>, <strong>DNS</strong> или <strong>Name Server Management</strong> (Управление сервером доменных имен).</p>
        <p>Часто страницу записей DNS можно найти, открыв раздел со сведениями о своей учетной записи и найдя такую ссылку, как <strong>Мои домены</strong>. Перейдите на эту страницу и найдите ссылку с именем наподобие <strong>Файл зоны</strong>, <strong>Записи DNS</strong> или <strong>Расширенная конфигурация</strong>.</p>
    </details>

   На снимке экрана ниже показан пример страницы с записями DNS:

   ![Снимок экрана, на котором показан пример страницы с записями DNS.](../../includes/media/app-service-web-access-dns-records-no-h/example-record-ui.png)

1. Щелкните **Добавить** или выберите соответствующее мини-приложение, чтобы создать запись. 

1. Выберите тип создаваемой записи и следуйте инструкциям. Вы можете использовать <abbr title="Запись канонического имени в DNS сопоставляет одно доменное имя (псевдоним) с другим именем (каноническое имя).">Запись CNAME</abbr> либо <abbr title="Запись DNS для адреса сопоставляет имя узла с IP-адресом.">Запись A</abbr> для сопоставления пользовательского DNS-имени со Службой приложений. 

    <details>
        <summary>Какую запись мне лучше выбрать?</summary>
        <div>
            <ul>
            <li>Для сопоставления корневого домена (например, <code>contoso.com</code>) используйте запись A. Не используйте запись CNAME для корневой записи (подробные сведения см. в <a href="https://en.wikipedia.org/wiki/CNAME_record">статье в Википедии</a>).</li>
            <li>Для сопоставления поддомена (например, <code>www.contoso.com</code>) используйте запись CNAME.</li>
            <li>Вы можете сопоставить поддомен непосредственно с IP-адресом приложения, используя запись A, но <a href="https://docs.microsoft.com/azure/app-service/overview-inbound-outbound-ips#when-inbound-ip-changes">IP-адрес может измениться</a>. Запись CNAME сопоставляется не с ним, а с именем узла приложения, который менее подвержен изменениям.</li>
            <li>Чтобы сопоставить <a href="https://en.wikipedia.org/wiki/Wildcard_DNS_record">домен с подстановочным знаком</a> (например, <code>*.contoso.com</code>), используйте запись CNAME.</li>
            </ul>
        </div>
    </details>
    
# <a name="cname"></a>[CNAME](#tab/cname)

Для поддомена, например `www` в `www.contoso.com`, создайте две представленные в следующей таблице записи.

| Тип записи | Узел | Значение | Комментарии |
| - | - | - |
| CNAME | `<subdomain>` (например, `www`) | `<app-name>.azurewebsites.net` | Само сопоставление домена. |
| TXT | `asuid.<subdomain>` (например, `asuid.www`) | [Идентификатор проверки, полученный ранее](#3-get-a-domain-verification-id) | Служба приложений обращается к записи в формате TXT `asuid.<subdomain>`, чтобы проверить владение личным доменом. |

![Снимок экрана, на котором показан переход к приложению Azure на портале.](./media/app-service-web-tutorial-custom-domain/cname-record.png)
    
# <a name="a"></a>[А](#tab/a)

Для корневого домена, например `contoso.com`, создайте две представленные в следующей таблице записи.

| Тип записи | Узел | Значение | Комментарии |
| - | - | - |
| Объект | `@` | IP-адрес из раздела [Копирование IP-адреса приложения](#3-get-a-domain-verification-id). | Само сопоставление домена (`@` обычно представляет корневой домен). |
| TXT | `asuid` | [Идентификатор проверки, полученный ранее](#3-get-a-domain-verification-id) | Служба приложений обращается к записи в формате TXT `asuid.<subdomain>`, чтобы проверить владение личным доменом. В качестве корневого домена используйте `asuid`. |

![Снимок экрана, на котором показана страница записей DNS.](./media/app-service-web-tutorial-custom-domain/a-record.png)

<details>
<summary>Что делать, если поддомен должен быть сопоставлен с записью A?</summary>
Чтобы сопоставить поддомен (например, `www.contoso.com`) с записью A вместо рекомендуемой записи CNAME, запись A и запись TXT должны выглядеть так, как показано в следующей таблице.

<div class="table-scroll-wrapper"><table class="table"><caption class="visually-hidden">Таблица 3.</caption>
<thead>
<tr>
<th>Тип записи</th>
<th>Узел</th>
<th>Значение</th>
</tr>
</thead>
<tbody>
<tr>
<td>Объект</td>
<td><code>&lt;subdomain&gt;</code> (например, <code>www</code>)</td>
<td>IP-адрес из раздела <a href="#info" data-linktype="self-bookmark">Копирование IP-адреса приложения</a>.</td>
</tr>
<tr>
<td>TXT</td>
<td><code>asuid.&lt;subdomain&gt;</code> (например, <code>asuid.www</code>)</td>
<td><a href="#3-get-a-domain-verification-id" data-linktype="self-bookmark">Идентификатор проверки, полученный ранее</a></td>
</tr>
</tbody>
</table></div>
</details>

# <a name="wildcard-cname"></a>[Подстановочный знак (CNAME)](#tab/wildcard)

Для имени с подстановочным знаком, например `*` в `*.contoso.com`, создайте две представленные в следующей таблице записи.

| Тип записи | Узел | Значение | Комментарии |
| - | - | - |
| CNAME | `*` | `<app-name>.azurewebsites.net` | Само сопоставление домена. |
| TXT | `asuid` | [Идентификатор проверки, полученный ранее](#3-get-a-domain-verification-id) | Служба приложений обращается к записи в формате TXT `asuid`, чтобы проверить владение личным доменом. |

![Снимок экрана, на котором показан переход к приложению Azure.](./media/app-service-web-tutorial-custom-domain/cname-record-wildcard.png)
    
-----

<details>
<summary>Мои изменения удаляются после выхода из страницы.</summary>
<p>У некоторых поставщиков, например GoDaddy, изменения записей DNS не вступают в силу, пока вы не щелкнете ссылку <strong>Сохранить изменения</strong>.</p>
</details>

<hr/>

## <a name="5-enable-the-mapping-in-your-app"></a>5. Включение сопоставления в приложении

1. В левой области страницы приложения на портале Azure выберите **Личные домены**.

    ![Снимок экрана с меню "Личные домены".](./media/app-service-web-tutorial-custom-domain/custom-domain-menu.png)

1. Нажмите кнопку **Добавить личный домен**.

    ![Снимок экрана, на котором показан элемент добавления имени узла.](./media/app-service-web-tutorial-custom-domain/add-host-name-cname.png)

# <a name="cname"></a>[CNAME](#tab/cname)

3. Введите полное доменное имя, для которого вы добавили запись CNAME, например `www.contoso.com`.

1. Выберите **Проверить**. Откроется страница **Добавить личный домен**.

1. Убедитесь, что в поле **Тип записи имени узла** выбрана запись **CNAME (wwwexample\.com или любой поддомен)** . Нажмите кнопку **Добавить личный домен**.

    ![Снимок экрана, на котором показана кнопка "Добавить личный домен".](./media/app-service-web-tutorial-custom-domain/validate-domain-name-cname.png)

    Возможно, потребуется некоторое время, чтобы новый личный домен отобразился на странице **Личные домены** вашего приложения. Обновите браузер, чтобы обновить данные.

    ![Снимок экрана, показывающий добавление записи CNAME.](./media/app-service-web-tutorial-custom-domain/cname-record-added.png)

    <details>
        <summary>Что мне делать с меткой предупреждения <strong>Не защищено</strong>?</summary>
        Метка предупреждения для личного домена означает, что он еще не привязан к TLS/SSL-сертификату. На любой HTTPS-запрос из браузера к такому личному домену возвращается сообщение об ошибке или предупреждение в зависимости от браузера. Сведения о добавлении привязки TLS см. в статье <a href="https://docs.microsoft.com/azure/app-service/configure-ssl-bindings">Защита пользовательского доменного имени с помощью привязки TLS/SSL в Службе приложений Azure</a>.
    </details>

    Если вы пропустили шаг или где-то допустили опечатку, в нижней части страницы появится сообщение об ошибке проверки.

    ![Снимок экрана, на котором показана ошибка проверки.](./media/app-service-web-tutorial-custom-domain/verification-error-cname.png)

<a name="a" aria-hidden="true"></a>

<a name="enable-a" aria-hidden="true"></a>

# <a name="a"></a>[А](#tab/a)

3. Введите полное доменное имя, для которого вы добавили запись A, например `contoso.com`. 

1. Выберите **Проверить**. Отобразится страница **добавления личного домена**.

1. Убедитесь, что в поле **Тип записи имени узла** выбрано значение **Запись А (example.com)** . Нажмите кнопку **Добавить личный домен**.

    ![Снимок экрана, показывающий добавление DNS-имени в приложение.](./media/app-service-web-tutorial-custom-domain/validate-domain-name.png)

    Возможно, потребуется некоторое время, чтобы новый личный домен отобразился на странице **Личные домены** вашего приложения. Обновите браузер, чтобы обновить данные.

    ![Снимок экрана, показывающий добавление записи A.](./media/app-service-web-tutorial-custom-domain/a-record-added.png)

    <details>
        <summary>Что мне делать с меткой предупреждения <strong>Не защищено</strong>?</summary>
        Метка предупреждения для личного домена означает, что он еще не привязан к TLS/SSL-сертификату. На любой HTTPS-запрос из браузера к такому личному домену возвращается сообщение об ошибке или предупреждение в зависимости от браузера. Сведения о добавлении привязки TLS см. в статье <a href="https://docs.microsoft.com/azure/app-service/configure-ssl-bindings">Защита пользовательского доменного имени с помощью привязки TLS/SSL в Службе приложений Azure</a>.
    </details>
    
    Если вы пропустили шаг или где-то допустили опечатку, в нижней части страницы появится сообщение об ошибке проверки.
    
    ![Снимок экрана, на котором показана ошибка проверки.](./media/app-service-web-tutorial-custom-domain/verification-error.png)
    
<a name="wildcard" aria-hidden="true"></a>

# <a name="wildcard-cname"></a>[Подстановочный знак (CNAME)](#tab/wildcard)

3. Введите полное доменное имя, которое соответствует шаблону домена с подстановочными знаками. Например, в нашем примере для `*.contoso.com` можно использовать `sub1.contoso.com`, `sub2.contoso.com`, `*.contoso.com` или любую другую строку, которая соответствует этому шаблону с подстановочными знаками. Затем щелкните **Проверить**.

    Активируется кнопка **Добавить личный домен**.

1. Убедитесь, что в поле **Тип записи имени узла** выбрана запись **CNAME (www\.examplecom или любой поддомен)** . Нажмите кнопку **Добавить личный домен**.

    ![Снимок экрана, на котором показано добавление DNS-имени в приложение.](./media/app-service-web-tutorial-custom-domain/validate-domain-name-cname-wildcard.png)

    Возможно, потребуется некоторое время, чтобы новый личный домен отобразился на странице **Личные домены** вашего приложения. Обновите браузер, чтобы обновить данные.

    <details>
        <summary>Что мне делать с меткой предупреждения <strong>Не защищено</strong>?</summary>
        Метка предупреждения для личного домена означает, что он еще не привязан к TLS/SSL-сертификату. На любой HTTPS-запрос из браузера к такому личному домену возвращается сообщение об ошибке или предупреждение в зависимости от браузера. Сведения о добавлении привязки TLS см. в статье <a href="https://docs.microsoft.com/azure/app-service/configure-ssl-bindings">Защита пользовательского доменного имени с помощью привязки TLS/SSL в Службе приложений Azure</a>.
    </details>

-----

<hr/> 

## <a name="6-test-in-a-browser"></a>6. Проверка в браузере

Откройте в браузере DNS-имена, настроенные ранее.

![Снимок экрана, на котором показан переход к приложению Azure.](./media/app-service-web-tutorial-custom-domain/app-with-custom-dns.png)

<a name="resolve-404-not-found" aria-hidden="true"></a>
<details>
<summary>Появляется ошибка HTTP 404 (Не найдено).</summary>
<ul>
<li>На настроенном личном домене отсутствует запись A и запись CNAME.</li>
<li>В кэше клиента браузера сохранен старый IP-адрес вашего домена. Выполните очистку кэша и еще раз проверьте разрешение DNS. На компьютере Windows кэш можно очистить с помощью команды <code>ipconfig /flushdns</code>.</li>
</ul>
</details>

<hr/> 

## <a name="migrate-an-active-domain"></a>Перенос активного домена

Сведения о том, как перенести активный веб-сайт и его DNS-имя домена в службу приложений без простоев, см. в статье [Перенос активного DNS-имени в службу приложений Azure](manage-custom-dns-migrate-domain.md).

<hr/> 

<a name="virtualdir" aria-hidden="true"></a>

## <a name="redirect-to-a-custom-directory"></a>Перенаправление к пользовательскому каталогу

<details>
<summary>Мне это нужно?</summary>
<p>Ответ зависит от конкретного приложения. По умолчанию служба приложений направляет веб-запросы в корневой каталог кода приложения. Но некоторые веб-платформы не запускаются в корневом каталоге. Например, <a href="https://laravel.com/">Laravel</a> запускается в подкаталоге <code>public</code>. Чтобы продолжить пример DNS <code>contoso.com</code>, такое приложение будет доступно по адресу <code>http://contoso.com/public</code>, но вместо этого вам потребуется направлять <code>http://contoso.com</code> в каталог <code>public</code>. </p>
</details>

Это довольно распространенный сценарий, но в нем выполняется не сопоставление с личным доменом, а настройка виртуального каталога в приложении.

1. Выберите **Параметры приложения** на панели слева на странице веб-приложения.

1. В нижней части страницы корневой виртуальный каталог `/` указывает на `site\wwwroot` по умолчанию. Это корневой каталог кода вашего приложения. Измените его, например, указав `site\wwwroot\public`, и сохраните изменения.

    ![Снимок экрана, показывающий настройку виртуального каталога.](./media/app-service-web-tutorial-custom-domain/customize-virtual-directory.png)

1. Когда операция завершится, для проверки откройте в браузере адрес корневого пути приложения (например, `http://contoso.com` или `http://<app-name>.azurewebsites.net`).

<hr/> 

## <a name="automate-with-scripts"></a>Автоматизация с помощью сценариев

Управление личными доменами можно автоматизировать с помощью сценариев, воспользовавшись [Azure CLI](/cli/azure/install-azure-cli) или [Azure PowerShell](/powershell/azure/).

#### <a name="azure-cli"></a>Azure CLI

Приведенная ниже команда добавляет заданное настраиваемое DNS-имя для приложения службы приложений.

```bash 
az webapp config hostname add \
    --webapp-name <app-name> \
    --resource-group <resource_group_name> \
    --hostname <fully_qualified_domain_name>
``` 

Дополнительные сведения см. в статье [Сопоставление пользовательского домена с веб-приложением](scripts/cli-configure-custom-domain.md).

#### <a name="azure-powershell"></a>Azure PowerShell

[!INCLUDE [updated-for-az](../../includes/updated-for-az.md)]

Приведенная ниже команда добавляет заданное настраиваемое DNS-имя для приложения службы приложений.

```powershell  
Set-AzWebApp `
    -Name <app-name> `
    -ResourceGroupName <resource_group_name> ` 
    -HostNames @("<fully_qualified_domain_name>","<app-name>.azurewebsites.net")
```

Дополнительные сведения см. в статье [Назначение пользовательского домена веб-приложению](scripts/powershell-configure-custom-domain.md).

<hr/> 

## <a name="next-steps"></a>Дальнейшие действия

Перейдите к следующему учебнику, чтобы научиться привязывать пользовательский TLS/SSL-сертификат к веб-приложению.

> [!div class="nextstepaction"]
> [Защита пользовательского доменного имени с помощью привязки TLS/SSL в Службе приложений Azure](configure-ssl-bindings.md)
