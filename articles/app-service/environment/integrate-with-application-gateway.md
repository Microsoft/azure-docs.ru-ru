---
title: Интеграция со Шлюзом приложений
description: Узнайте, как интегрировать приложение в ILB Среда службы приложений с шлюзом приложений в этом сквозном пошаговом руководстве.
author: ccompy
ms.assetid: a6a74f17-bb57-40dd-8113-a20b50ba3050
ms.topic: article
ms.date: 03/03/2018
ms.author: ccompy
ms.custom: seodec18
ms.openlocfilehash: 3b73d528802a8aa33c6122eaf5edfa9d046b6753
ms.sourcegitcommit: 772eb9c6684dd4864e0ba507945a83e48b8c16f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "88962083"
---
# <a name="integrate-your-ilb-app-service-environment-with-the-azure-application-gateway"></a>Интеграция среды службы приложений с внутренней системой балансировки нагрузки (ILB) со шлюзом приложений Azure #

[Среда службы приложений](./intro.md) — это развернутая служба приложений Azure в подсети виртуальной сети Azure клиента. Ее можно развернуть с использованием общедоступной или частной конечной точки для доступа к приложениям. Развертывание среды службы приложений с закрытой конечной точкой (то есть внутренней подсистемы балансировки нагрузки) называется средой службы приложений с ILB.  

Брандмауэры веб-приложения защищают веб-приложения, проверяя входящий трафик Интернета и блокируя атаки с использованием кода SQL и межсайтовых скриптов, передачи вредоносных программ, атаки DDoS на приложения и другие атаки. Также они проверяют ответы от внутренних веб-серверов для предотвращения потери данных (DLP). Вы можете получить устройство WAF в Azure Marketplace. Также можно использовать [шлюз приложений Azure][appgw].

Шлюз приложений Azure — это виртуальное устройство, которое обеспечивает балансировку нагрузки уровня 7, разгрузку TLS/SSL и защиту брандмауэра веб-приложения (WAF). Он может ожидать передачи данных через общедоступный IP-адрес и направлять трафик к конечной точке приложения. Ниже описано, как интегрировать шлюз приложений с настроенным WAF с приложением в среде службы приложений ILB.  

Интеграция шлюза приложений и среды службы приложений с ILB осуществляется на уровне приложения. Настройка шлюза приложений для работы со средой службы приложений с внутренней подсистемой балансировки нагрузки выполняется для конкретных приложений в среде службы приложений с ILB. Этот способ позволяет разместить защищенные многопользовательские приложения в одной среде службы приложений с ILB.  

![Шлюз приложений, указывающий на приложение в среде службы приложений с внутренней подсистемой балансировки нагрузки][1]

В этом пошаговом руководстве описаны следующие операции.

* Создание шлюза приложений Azure.
* Связывание шлюза приложения с приложением в среде службы приложений с внутренней подсистемой балансировки нагрузки.
* Настройка приложения для использования имени личного домена.
* Изменение общедоступного имени узла DNS, указывающего на шлюз приложений.

## <a name="prerequisites"></a>Предварительные требования

Чтобы интегрировать шлюз приложений в среду службы приложений с внутренней подсистемой балансировки нагрузки, требуется:

* Среда службы приложений с подсистемой балансировки нагрузки.
* Приложение, выполняющееся в среде службы приложений с внутренней подсистемой балансировки нагрузки.
* Доменное имя с маршрутизацией через Интернет для приложения в среде службы приложений с внутренней подсистемой балансировки нагрузки.
* Адрес подсистемы балансировки нагрузки, используемый средой службы приложений с внутренней подсистемой балансировки нагрузки. Эти сведения находятся на портале среда службы приложений в разделе **Параметры**  >  **IP-адреса**:

    ![Пример списка IP-адресов, используемых средой службы приложений с внутренней подсистемой балансировки нагрузки][9]
    
* Общедоступное DNS-имя, которое будет использоваться позднее для указания на шлюз приложений. 

Дополнительные сведения о создании среды службы приложений с внутренней подсистемой балансировки нагрузки см. в [этой статье][ilbase].

В этой статье предполагается, что вам требуется шлюз приложений в той же виртуальной сети Azure, в которой развертывается среда службы приложений. Прежде чем создавать шлюз приложений, выберите или создайте подсеть для размещения шлюза. 

Для этого не следует выбирать подсеть с именем GatewaySubnet. Если разместить шлюз приложений в подсети GatewaySubnet, позже будет невозможно создать шлюз виртуальной сети. 

Шлюз также нельзя поместить в подсети, которая используется в среде службы приложений с внутренней подсистемой балансировки нагрузки. Среда службы приложений — это единственное, что может находиться в этой подсети.

## <a name="configuration-steps"></a>Этапы настройки ##

1. В портал Azure перейдите к разделу **Новый**  >  **сетевой**  >  **шлюз приложений**.

2. В области **Основные**:

   а. В поле **Имя** введите имя шлюза приложений.

   b. В области **Уровень** выберите **WAF**.

   c. В поле **Подписка** выберите подписку, которую использует виртуальная сеть среды службы приложений.

   d. В области **Группа ресурсов** создайте или выберите группу ресурсов.

   д) В поле **Расположение** выберите расположение виртуальной сети среды службы приложений.

   ![Основные параметры нового шлюза приложений][2]

3. В области **Параметры**:

   а. В разделе **Виртуальная сеть** выберите виртуальную сеть среды службы приложений.

   b. В поле **Подсеть** укажите подсеть, в которой будет развернут шлюз приложений. Не указывайте подсеть GatewaySubnet, иначе будет невозможно создание VPN-шлюзов.

   c. В разделе **Тип IP-адреса** выберите **Общедоступный**.

   d. В разделе общедоступного IP-адреса выберите **Общедоступный IP-адрес**. Если его у вас нет, создайте его.

   д) Для параметра **Protocol** (Протокол) выберите **HTTP**. или **HTTPS**. При настройке протокола HTTPS необходимо предоставить PFX-файл сертификата.

   е) В разделе **Брандмауэр веб-приложения** можно включить брандмауэр и настроить его для **обнаружения** или **предотвращения** в соответствии с вашими требованиями.

   ![Параметры нового шлюза приложений][3]
    
4. Просмотрите параметры в разделе **Сводка**, а затем нажмите кнопку **ОК**. Настройка шлюза приложений длится чуть более 30 минут.  

5. Настроив шлюз приложений, вернитесь на портал шлюза приложений. Выберите **Внутренний пул**. Добавьте адрес внутренней подсистемы балансировки нагрузки в среду службы приложений с внутренней подсистемой балансировки нагрузки.

   ![Настройка внутреннего пула][4]

6. После настройки внутреннего пула выберите **Зонды работоспособности**. Создайте пробу работоспособности для доменного имени, которое необходимо использовать для приложения. 

   ![Настройка проб работоспособности][5]
    
7. После настройки проб работоспособности выберите **Настройки HTTP**. Измените имеющийся параметр, щелкните **Использовать пользовательский зонд** и выберите настроенную вами пробу.

   ![Настройка параметров HTTP][6]
    
8. Перейдите к разделу **Обзор** шлюза приложений и скопируйте используемый общедоступный IP-адрес. Назначьте этот IP-адрес в качестве записи A для доменного имени приложения или используйте DNS-имя для этого адреса в записи CNAME. Проще выбрать общедоступный IP-адрес и скопировать его из раздела общедоступного IP-адреса в пользовательском интерфейсе, чем скопировать его из ссылки в разделе **Обзор** шлюза приложения. 

   ![Портал шлюза приложений][7]

9. Укажите имя личного домена для приложения в среде службы приложений с внутренней подсистемой балансировки нагрузки. Перейдите к своему приложению на портале и в списке **Параметры** выберите **Пользовательские домены**.

   ![Указание имени личного домена для приложения][8]

Сведения о настройке имен личных доменов для веб-приложений приведены в статье [Map an existing custom DNS name to Azure Web Apps][custom-domain] (Сопоставление имеющегося настраиваемого DNS-имени с веб-приложениями Azure). Однако для приложения в среде службы приложений с внутренней подсистемой балансировки нагрузки нет никакой проверки доменного имени. Так как вам принадлежит служба DNS, которая управляет конечными точками приложения, вы можете добавить все, что посчитаете нужным. Добавляемое в этом случае имя личного домена не обязательно должно находиться в вашей службе DNS, но его все равно нужно настроить для вашего приложения. 

После того, как установка будет завершена и вы подождете некоторое время, чтобы изменения DNS распространились, вы сможете обращаться к приложению с помощью созданного имени личного домена. 


<!--IMAGES-->
[1]: ./media/integrate-with-application-gateway/appgw-highlevel.png
[2]: ./media/integrate-with-application-gateway/appgw-createbasics.png
[3]: ./media/integrate-with-application-gateway/appgw-createsettings.png
[4]: ./media/integrate-with-application-gateway/appgw-backendpool.png
[5]: ./media/integrate-with-application-gateway/appgw-healthprobe.png
[6]: ./media/integrate-with-application-gateway/appgw-httpsettings.png
[7]: ./media/integrate-with-application-gateway/appgw-publicip.png
[8]: ./media/integrate-with-application-gateway/appgw-customdomainname.png
[9]: ./media/integrate-with-application-gateway/appgw-iplist.png

<!--LINKS-->
[appgw]: ../../application-gateway/overview.md
[custom-domain]: ../app-service-web-tutorial-custom-domain.md
[ilbase]: ./create-ilb-ase.md