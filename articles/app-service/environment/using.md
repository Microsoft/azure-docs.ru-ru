---
title: Использование среды службы приложений
description: Узнайте, как использовать Среда службы приложений для размещения изолированных приложений.
author: ccompy
ms.assetid: 377fce0b-7dea-474a-b64b-7fbe78380554
ms.topic: article
ms.date: 11/16/2020
ms.author: ccompy
ms.custom: seodec18
ms.openlocfilehash: ba06a0f9d520f445965329203aecd6c576666737
ms.sourcegitcommit: f5b8410738bee1381407786fcb9d3d3ab838d813
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/14/2021
ms.locfileid: "98209735"
---
# <a name="using-an-app-service-environment"></a>Использование среды службы приложений

Среда службы приложений (ASE) — это одно развертывание клиента службы приложений Azure, которое непосредственно вставляется в виртуальную сеть Azure по вашему выбору. Это система, которая используется только одним клиентом. Приложения, развернутые в ASE, подчиняются сетевым функциям, которые применяются к подсети ASE. В ваших приложениях нет дополнительных компонентов, которые должны быть включены в эти сетевые компоненты. 

## <a name="create-an-app-in-an-ase"></a>Создание приложения в ASE

Чтобы создать приложение в ASE, используйте тот же процесс, что и при обычном создании приложения, но с небольшими различиями. При создании плана службы приложений:

- Вместо выбора географического расположения, в котором будет развернуто приложение, выберите ASE в качестве расположения.
- Все планы службы приложений, созданные в ASE, могут быть только в ценовой категории с изолированным v2.

Если у вас нет ASE, можно создать его, следуя инструкциям в разделе [создание среда службы приложений][MakeASE].

Создание приложения в ASE.

1. Выберите **создать ресурс**  >  **Интернет и мобильные устройства**  >  **веб-приложение**.

1. Выберите подписку.

1. Введите имя для новой группы ресурсов или щелкните **Использовать существующий** и выберите вариант имени из раскрывающегося списка.

1. Введите имя приложения. Если вы уже выбрали план службы приложений в ASE, доменное имя приложения будет соответствовать доменному имени ASE:

    ![Создание приложения в ASE][1]

1. Выберите тип публикации, стек и операционную систему.

1.  Выберите регион. Здесь необходимо выбрать уже существующий Среда службы приложений v3.  Невозможно сделать ASEv3 во время создания приложения 

1. Выберите существующий план службы приложений в ASE или создайте новый. При создании нового приложения выберите нужный размер для вашего плана службы приложений. Единственный номер SKU, который вы можете выбрать для приложения, — это общедоступный SKU цены v2.

    ![Ценовые категории изолированного v2][2]

    > [!NOTE]
    > Приложения Linux и приложения Windows не могут находиться в одном плане службы приложений, но могут находиться в одном Среда службы приложений.
    >

1. Выберите **Далее: мониторинг**  если вы хотите включить Application Insights в приложении, вы можете сделать это здесь во время создания последовательности. 

1.  Нажмите кнопку **Далее: Теги** , чтобы добавить в приложение все необходимые теги.  

1. Выберите **Проверка + создать**, убедитесь, что сведения верны, а затем нажмите кнопку **создать**.

## <a name="how-scale-works"></a>Как работает масштабирование

Каждая служба приложений выполняется в плане службы приложений. В средах службы приложений содержатся планы службы приложений, которые в свою очередь содержат приложения. При масштабировании приложения также масштабируется план службы приложений и все приложения в том же плане.

При масштабировании плана службы приложений необходимая инфраструктура добавляется автоматически. Существует временная задержка для масштабирования операций во время добавления инфраструктуры. При масштабировании плана службы приложений любые другие операции масштабирования, запрошенные той же операционной системой и размером, будут ожидать завершения первого из них. После завершения операции по масштабированию блокировки все запросы, помещенные в очередь, обрабатываются одновременно. Операция масштабирования с одним размером и ОС не будет блокировать масштабирование других сочетаний размера и ОС. Например, если масштабировать план службы приложений Windows I2v2, любые другие запросы на масштабирование Windows I2v2 в этом ASE будут поставлены в очередь до завершения этого процесса.   

В службе приложений для клиентов масштабирование выполняется немедленно, так как для его поддержки доступен пул ресурсов. В ASE нет такого буфера, и ресурсы выделяются в зависимости от нужды.

## <a name="app-access"></a>Доступ к приложениям

В ASE суффиксом домена, используемым для создания приложения, является *. &lt; asename &gt; . appserviceenvironment.NET*. Если ASE имеет имя _My-ASE_ и вы размещаете приложение _contoso_ в этом ASEе, вы подйдете к нему по следующим URL-адресам:

- contoso.my-ase.appserviceenvironment.net
- contoso.scm.my-ase.appserviceenvironment.net

Сведения о создании ASE см. в разделе [создание среда службы приложений][MakeASE].

URL-адрес SCM используется для доступа к консоли KUDU или для публикации приложения с помощью веб-развертывание. Сведения о консоли Kudu см. на странице [Kudu console for Azure App Service][Kudu] (Консоль Kudu для службы приложений Azure). Консоль Kudu предоставляет веб-интерфейс для отладки, передачи и редактирования файлов, а также многих других возможностей.

### <a name="dns-configuration"></a>Настройка DNS 

ASE использует частные конечные точки для входящего трафика. Он не настраивается автоматически Azure DNS частными зонами. Если вы хотите использовать собственный DNS-сервер, необходимо добавить следующие записи:

1. создайте зону для &lt;имя_ASE&gt;.appserviceenvironment.net;
1. Создайте в этой зоне запись A, которая указывает * на входящий IP-адрес, используемый вашей частной конечной точкой ASE.
1. Создайте в этой зоне запись A, которая указывает @ на входящий IP-адрес, используемый вашей частной конечной точкой ASE.
1. создайте зону scm в &lt;имя_ASE&gt;.appserviceenvironment.net;
1. Создайте запись A в зоне SCM, которая указывает * на IP-адрес, используемый вашей частной конечной точкой ASE.

Чтобы настроить DNS в частных зонах Azure DNS, выполните следующие действия:

1. создайте частную зону Azure DNS с именем <ASE name>.appserviceenvironment.net;
1. создайте запись A в этой зоне, которая указывает (*) на IP-адрес внутренней подсистемы балансировки нагрузки;
1. создайте запись A в этой зоне, которая указывает (@) на IP-адрес внутренней подсистемы балансировки нагрузки.
1. создайте запись A в зоне, которая указывает *.scm на IP-адрес внутреннего балансировщика нагрузки.

Параметры DNS для суффикса домена по умолчанию ASE не ограничивают приложения доступными только по этим именам. Вы можете задать имя личного домена без проверки приложений в ASE. Если вы хотите создать зону с именем *contoso.NET*, это можно сделать и указать на входящий IP-адрес. Имя личного домена работает для запросов приложений, но не для сайта scm. Сайт SCM доступен только в *&lt; AppName &gt; . SCM. &lt; asename &gt; . appserviceenvironment.NET*. 

## <a name="publishing"></a>Публикация

В ASE, как и в службе многоклиентских приложений, вы можете опубликовать эти методы:

- Веб-развертывание
- Непрерывная интеграция (CI)
- функция перетаскивания в консоли Kudu;
- Интегрированная среда разработки, например Visual Studio, Eclipse или IntelliJ

При использовании ASE конечные точки публикации доступны только через входящий адрес, используемый частной конечной точкой. Если у вас нет сетевого доступа к адресу частной конечной точки, вы не сможете опубликовать приложения на этом ASE.  IDE также должен иметь сетевой доступ к ILB для непосредственной публикации.

Без дополнительных изменений такие системы непрерывной интеграции на основе Интернета, как GitHub и Azure DevOps, не работают с ASE ILB, так как конечная точка публикации не доступна в Интернете. Вы можете включить публикацию в ILB ASE из DevOps Azure, установив собственный агент выпуска в виртуальной сети, содержащей ILB ASE. 

## <a name="storage"></a>Хранение

У ASE есть 1 ТБ хранилища для всех приложений в ASE. План службы приложений в SKU "изолированная цена" имеет ограничение в 250 ГБ. В ASE хранилище 250 ГБ добавляется в план службы приложений вплоть до ограничения в 1 ТБ. Вы можете использовать больше планов службы приложений, чем четыре, но больше не нужно добавлять хранилище сверх ограничения в 1 ТБ.

## <a name="logging"></a>Logging

Вы можете интегрировать ASE с Azure Monitor для отправки журналов о ASE в службу хранилища Azure, в концентраторы событий Azure или Log Analytics. Эти элементы регистрируются сегодня:

| Ситуация | Сообщение |
|---------|----------|
| ASE неработоспособен | Указанный ASE является неработоспособным из-за недопустимой конфигурации виртуальной сети. Если неработоспособное состояние продолжает работать, ASE будет приостановлен. Убедитесь, что выполнены указанные здесь рекомендации: https://docs.microsoft.com/azure/app-service/environment/network-info . |
| В подсети ASE почти недостаточно свободного пространства | Указанный ASE находится в подсети, в которой почти не хватает свободного пространства. Существуют {0} оставшиеся адреса. Когда эти адреса будут исчерпаны, ASE не сможет масштабироваться.  |
| ASE приближается к общему ограничению экземпляров | Указанный ASE приближается к общему ограничению экземпляра ASE. В настоящее время он содержит {0} экземпляры плана службы приложений максимум 201 экземпляров. |
| ASE не удалось связаться с зависимостью | Указанный ASE не может быть достигнут {0} .  Убедитесь, что выполнены указанные здесь рекомендации: https://docs.microsoft.com/azure/app-service/environment/network-info . |
| ASE приостановлен | Указанный ASE приостановлен. Приостановка ASE может быть вызвана тем, что учетная запись шортфалл или недопустимая конфигурация виртуальной сети. Устраните основную причину и возобновите ASE, чтобы продолжить обслуживание трафика. |
| Начато обновление ASE | Начато обновление платформы до указанного ASE. В операциях масштабирования должны возникать задержки. |
| Обновление ASE завершено | Обновление платформы до указанного ASE завершено. |
| Операции масштабирования запущены | План службы приложений ( {0} ) начал масштабирование. Требуемое состояние {1} : {2} сотрудники.
| Операции масштабирования завершены | Масштабирование плана службы приложений ( {0} ) завершено. Текущее состояние: {1} {2} исполнители. |
| Сбой операций масштабирования | Не удалось масштабировать план службы приложений ( {0} ). Текущее состояние: {1} {2} исполнители. |

Чтобы включить ведение журнала в ASE, выполните следующие действия.

1. На портале выберите **параметры диагностики**.
1. Выберите **Добавить параметр диагностики**.
1. Укажите имя для интеграции журналов.
1. Выберите и настройте нужные назначения журналов.
1. Выберите **аппсервицеенвиронментплатформлогс**.

![Параметры журнала диагностики ASE][4]

При интеграции с Log Analytics можно просмотреть журналы, выбрав **журналы** на портале ASE и создав запрос к **аппсервицеенвиронментплатформлогс**. Журналы создаются только в том случае, если у ASE есть событие, которое запустит его. Если у вашего ASE нет такого события, журналы не будут существовать. Чтобы быстро просмотреть пример журналов в рабочей области Log Analytics, выполните операцию масштабирования с одним из планов службы приложений в ASE. Затем можно выполнить запрос к **аппсервицеенвиронментплатформлогс** , чтобы просмотреть эти журналы. 

**Создание предупреждения**

Чтобы создать оповещение для журналов, следуйте инструкциям в статье [Создание, просмотр и Управление оповещениями журнала с помощью Azure Monitor](../../azure-monitor/platform/alerts-log.md). Краткое описание

* Открытие страницы "оповещения" на портале ASE
* Выберите **новое правило генерации оповещений**
* Выберите ресурс для рабочей области Log Analytics
* Задайте условие с помощью пользовательского поиска по журналам, чтобы использовать запрос, например "Аппсервицеенвиронментплатформлогс | где Ресултдескриптион содержит "начало масштабирования" или что угодно. Установите соответствующее пороговое значение. 
* При необходимости добавьте или создайте группу действий. Группа действий определяет реакцию на предупреждение, например отправку сообщения электронной почты или SMS.
* Назовите оповещение и сохраните его.

## <a name="internal-encryption"></a>Внутреннее шифрование

Среда службы приложений работает по принципу "черного ящика", т. е. в ней не отображаются внутренние компоненты или обмен данными в системе. Чтобы обеспечить более высокую пропускную способность, по умолчанию шифрование между внутренними компонентами отключено. Система защищена за счет того, что трафик полностью недоступен для отслеживания или доступа. Если требуется полное шифрование пути к данным от сквозного шифрования, то в пользовательском интерфейсе **настройки** ASE можно включить это требование.

![Включить внутреннее шифрование][5]

Это обеспечит шифрование внутреннего сетевого трафика в ASE между внешними интерфейсами и рабочими процессами, шифрование файла подкачки, а также шифрование рабочих дисков. Включение InternalEncryption в качестве clusterSetting может повлиять на производительность системы. Когда вы внесете изменения, чтобы включить InternalEncryption, Среда службы приложений (ASE) будет пребывать в нестабильном состоянии, пока изменения не распространятся полностью. Полное распространение изменений может занять несколько часов в зависимости от количества экземпляров в ASE. Настоятельно рекомендуется не включать этот параметр в ASE, пока она используется. Если это необходимо сделать для активно используемых ASE, мы настоятельно рекомендуем перенаправлять трафик в резервную среду до завершения операции.

## <a name="upgrade-preference"></a>Параметры обновления

При наличии нескольких среды ASE может потребоваться обновить некоторые среды ASE перед другими. В объекте ASE **HostingEnvironment диспетчер ресурсов** можно задать значение для **упградепреференце**. Параметр **упградепреференце** можно настроить с помощью шаблона, ARMClient или https://resources.azure.com . Возможны следующие три значения:

- **Нет**. Azure обновит ASE без какого бы то ни было конкретного пакета. Это значение по умолчанию.
- **Рано**. ваш ASE будет обновлен в первой половине обновлений службы приложений.
- **Позднее**: ваш ASE будет обновлен во второй половине обновлений службы приложений.

Чтобы настроить параметры обновления, перейдите в пользовательский интерфейс **настройки** ASE. 

Функция **упградепреференцес** наиболее важна при наличии нескольких среды ASE, так как "раннее" среды ASE будет обновлен до "поздней" среды ASE. Если у вас несколько среды ASE, следует задать для разработки и тестирования среды ASE значение "рано", а рабочий среды ASE — "поздно".

## <a name="delete-an-ase"></a>Удаление ASE

Чтобы удалить ASE, сделайте следующее:

1. Выберите **Удалить** в верхней части области **Среда службы приложений** .

1. Введите имя среды ASE, чтобы подтвердить ее удаление. При удалении ASE также удаляется все содержимое внутри него.

    ![Удаление ASE][3]

1. Щелкните **ОК**.

<!--Image references-->
[1]: ./media/using/using-appcreate.png
[2]: ./media/using/using-appcreate-skus.png
[3]: ./media/using/using-delete.png
[4]: ./media/using/using-logsetup.png
[4]: ./media/using/using-logs.png
[5]: ./media/using/using-configuration.png

<!--Links-->
[Intro]: ./overview.md
[MakeASE]: ./creation.md
[ASENetwork]: ./networking.md
[UsingASE]: ./using.md
[UDRs]: ../../virtual-network/virtual-networks-udr-overview.md
[NSGs]: ../../virtual-network/network-security-groups-overview.md
[Pricing]: https://azure.microsoft.com/pricing/details/app-service/
[ARMOverview]: ../../azure-resource-manager/management/overview.md
[ConfigureSSL]: ../configure-ssl-certificate.md
[Kudu]: https://azure.microsoft.com/resources/videos/super-secret-kudu-debug-console-for-azure-web-sites/
[AppDeploy]: ../deploy-local-git.md
[ASEWAF]: app-service-app-service-environment-web-application-firewall.md
[AppGW]: ../../web-application-firewall/ag/ag-overview.md
[logalerts]: ../../azure-monitor/platform/alerts-log.md
