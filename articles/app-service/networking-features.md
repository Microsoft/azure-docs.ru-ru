---
title: Функции сетей
description: Сведения о сетевых функциях в службе приложений Azure, а также о возможностях, необходимых для обеспечения безопасности и других функций.
author: ccompy
ms.assetid: 5c61eed1-1ad1-4191-9f71-906d610ee5b7
ms.topic: article
ms.date: 03/26/2021
ms.author: ccompy
ms.custom: seodec18
ms.openlocfilehash: 9ba85ecfe2b57ceb1eed5c51929107a95f5a4669
ms.sourcegitcommit: a67b972d655a5a2d5e909faa2ea0911912f6a828
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/23/2021
ms.locfileid: "104889150"
---
# <a name="app-service-networking-features"></a>Сетевые функции службы приложений

Вы можете развернуть приложения в службе приложений Azure несколькими способами. По умолчанию приложения, размещенные в службе приложений, доступны напрямую через Интернет и могут обращаться только к конечным точкам, размещенным в Интернете. Но для многих приложений необходимо управлять входящим и исходящим сетевым трафиком. Существует несколько функций службы приложений, которые помогут вам удовлетворить эти потребности. Задача заключается в том, какую функцию следует использовать для решения определенной проблемы. Эта статья поможет определить, какую функцию использовать, основываясь на некоторых примерах использования.

Существует два основных типа развертывания для службы приложений Azure. 
- Общеклиентская общедоступная служба размещает планы службы приложений в оптовых, общедоступных, базовых, стандартных, расширенных, категории премиум v2 и PremiumV3 ценах. 
- В Среда службы приложений с одним клиентом (ASE) планы службы приложений для изолированного SKU размещаются непосредственно в виртуальной сети Azure. 

Используемые функции будут зависеть от того, находитесь ли вы в многоклиентской службе или в ASE. 

## <a name="multitenant-app-service-networking-features"></a>Сетевые возможности службы приложений с поддержкой клиентов 

Служба приложений Azure — это распределенная система. Роли, которые обрабатывают входящие запросы HTTP или HTTPS, называются *внешними* интерфейсами. Роли, в которых размещается Рабочая нагрузка клиента, называются *рабочими* процессами. Все роли в развертывании службы приложений существуют в многоклиентской сети. Так как в одной единице масштабирования службы приложений существует много различных клиентов, вы не сможете подключить сеть службы приложений непосредственно к вашей сети. 

Вместо подключения сетей необходимы функции для управления различными аспектами взаимодействия приложений. Функции, которые обрабатывали запросы *к* приложению, нельзя использовать для решения проблем при выполнении вызовов *из* приложения. Аналогичным образом функции, устраняющие проблемы с вызовами из приложения, нельзя использовать для решения проблем в приложении.  

| Входящие функции | Исходящие функции |
|---------------------|-------------------|
| Адрес, назначенный приложению | Гибридные подключения |
| Ограничения доступа | Интеграция с виртуальной сетью на базе шлюза |
| Конечные точки служб | интеграция с виртуальной сетью; |
| Частные конечные точки ||

Помимо отмеченных исключений, можно использовать все эти функции вместе. Вы можете сочетать функции, чтобы решить проблемы.

## <a name="use-cases-and-features"></a>Варианты использования и функции

Для любого конкретного варианта использования может быть несколько способов решения проблемы. Выбор наиболее подходящей функции иногда выходит за рамки сценария использования. В следующих примерах использования входящих сообщений предполагается использование сетевых функций службы приложений для решения проблем с управлением трафиком, передаваемых в приложение:
 
| Вариант входящего использования | Функция |
|---------------------|-------------------|
| Поддержка требований SSL на основе IP для вашего приложения | Адрес, назначенный приложению |
| Поддержка несовместного выделенного входящего адреса для приложения | Адрес, назначенный приложению |
| Ограничение доступа к приложению из набора четко определенных адресов | Ограничения доступа |
| Ограничение доступа к приложению из ресурсов в виртуальной сети | Конечные точки служб </br> Среда ASE с ILB </br> Частные конечные точки |
| Предоставление приложения на частном IP-адресе в виртуальной сети | Среда ASE с ILB </br> Частные конечные точки </br> Частный IP-адрес для входящего трафика на экземпляре шлюза приложений с конечными точками службы |
| Защита приложения с помощью брандмауэра веб-приложения (WAF) | Шлюз приложений и ILB ASE </br> Шлюз приложений с частными конечными точками </br> Использование Шлюза приложений с конечными точками служб </br> Передняя дверца Azure с ограничениями доступа |
| Балансировка нагрузки трафика в приложения в разных регионах | Передняя дверца Azure с ограничениями доступа | 
| Балансировка нагрузки трафика в одном регионе | [Использование Шлюза приложений с конечными точками служб][appgwserviceendpoints] | 

В следующих сценариях исходящего трафика показано, как использовать сетевые функции службы приложений для решения исходящих требований к доступу к приложению.

| Вариант исходящего использования | Функция |
|---------------------|-------------------|
| Доступ к ресурсам в виртуальной сети Azure в том же регионе | интеграция с виртуальной сетью; </br> ASE |
| Доступ к ресурсам в виртуальной сети Azure в другом регионе | Интеграция с виртуальной сетью на базе шлюза </br> ASE и пиринг виртуальных сетей |
| Доступ к ресурсам, защищенным с помощью конечных точек службы | интеграция с виртуальной сетью; </br> ASE |
| Доступ к ресурсам в частной сети, не подключенной к Azure | Гибридные подключения |
| Доступ к ресурсам через каналы Azure ExpressRoute | интеграция с виртуальной сетью; </br> ASE | 
| Защита исходящего трафика от веб-приложения | Интеграция виртуальной сети и группы безопасности сети </br> ASE | 
| Маршрутизация исходящего трафика из веб-приложения | Интеграция виртуальной сети и таблицы маршрутов </br> ASE | 


### <a name="default-networking-behavior"></a>Поведение сети по умолчанию

Единицы масштабирования службы приложений Azure поддерживают множество клиентов в каждом развертывании. Планы бесплатных и общих номеров SKU размещают рабочие нагрузки клиентов на рабочих процессах клиента. Базовые и более высокие планы размещают рабочие нагрузки клиентов, предназначенные только для одного плана службы приложений. Если у вас есть стандартный план службы приложений, все приложения в этом плане будут выполняться в одном рабочем процессе. При масштабировании рабочей роли все приложения в этом плане службы приложений будут реплицированы на новый рабочий процесс для каждого экземпляра в плане службы приложений. 

#### <a name="outbound-addresses"></a>Исходящие адреса

Рабочие виртуальные машины разбиваются в большую часть на планы службы приложений. Планы "бесплатный", "общий", "базовый", "Стандартный" и "Премиум" используют один и тот же тип рабочей машины. План категории премиум v2 использует другой тип виртуальной машины. PremiumV3 использует еще один тип виртуальной машины. При изменении семейства виртуальных машин вы получаете другой набор исходящих адресов. При масштабировании с Standard на категории премиум v2 исходящие адреса изменятся. При масштабировании с категории премиум v2 на PremiumV3 исходящие адреса изменятся. В некоторых старых единицах масштабирования входящие и исходящие адреса изменятся при масштабировании с Standard на категории премиум v2. 

Существует несколько адресов, используемых для исходящих вызовов. Исходящие адреса, используемые приложением для выполнения исходящих вызовов, перечислены в свойствах приложения. Эти адреса являются общими для всех приложений, работающих в одном семействе рабочих виртуальных машин в развертывании службы приложений. Если вы хотите просмотреть все адреса, которые приложение может использовать в единице масштабирования, будет вызвано свойство, в `possibleOutboundAddresses` котором они будут перечислены. 

![Снимок экрана, на котором показаны свойства приложения.](media/networking-features/app-properties.png)

Служба приложений имеет ряд конечных точек, которые используются для управления службой.  Эти адреса публикуются в отдельном документе и также находятся в `AppServiceManagement` теге службы IP. `AppServiceManagement`Тег используется только в средах службы приложений, где необходимо разрешить такой трафик. Входящие адреса службы приложений записываются в `AppService` теге службы IP. Отсутствует тег службы IP-адресов, содержащий исходящие адреса, используемые службой приложений. 

![Схема, на которой показан входящий и исходящий трафик службы приложений.](media/networking-features/default-behavior.png)

### <a name="app-assigned-address"></a>Адрес, назначенный приложению 

Компонент, назначенный приложением, является оффшутом возможности SSL на основе IP-адресов. Доступ к нему осуществляется путем настройки SSL для приложения. Эту функцию можно использовать для вызовов SSL на основе IP. Кроме того, его можно использовать, чтобы предоставить приложению только адрес. 

![Схема, на которой показан адрес, назначенный приложению.](media/networking-features/app-assigned-address.png)

При использовании адреса, назначенного приложению, трафик по-прежнему проходит через те же роли внешнего интерфейса, которые обрабатывали весь входящий трафик в единицу масштабирования службы приложений. Но адрес, назначенный вашему приложению, используется только вашим приложением. Варианты использования этой функции:

* Поддержка SSL на основе IP для вашего приложения.
* Задайте выделенный адрес для приложения, которое не является общим.

Чтобы узнать, как задать адрес в приложении, см. статью [Добавление сертификата TLS/SSL в службу приложений Azure][appassignedaddress]. 

### <a name="access-restrictions"></a>Ограничения доступа 

Ограничения доступа позволяют фильтровать *Входящие* запросы. Действие фильтрации выполняется на внешних ролях, которые находятся в потоке от рабочих ролей, в которых выполняются приложения. Так как внешние роли являются вышестоящими от рабочих ролей, вы можете подумать об ограничениях доступа в качестве защиты на уровне сети для приложений. 

Эта функция позволяет создать список разрешенных и отклоненных правил, которые оцениваются в порядке приоритета. Это похоже на функцию группы безопасности сети (NSG) в сети Azure. Эту функцию можно использовать в ASE или в многоклиентской службе. При использовании с конечной точкой ILB ASE или Private можно ограничить доступ из частных блоков адресов.
> [!NOTE]
> Для каждого приложения можно настроить до 512 правил ограничения доступа. 

![Схема, иллюстрирующая ограничения доступа.](media/networking-features/access-restrictions.png)

#### <a name="ip-based-access-restriction-rules"></a>Правила ограничения доступа на основе IP-адресов

Функция ограничений доступа на основе IP-адресов позволяет ограничить IP-адреса, которые могут использоваться для доступа к приложению. Поддерживаются форматы IPv4 и IPv6. Некоторые варианты использования этой функции:
* Ограничьте доступ к приложению из набора четко определенных адресов. 
* Ограничьте доступ к трафику, поступающему через внешнюю службу балансировки нагрузки или другие сетевые устройства с известными IP-адресами исходящего трафика. 

Сведения о том, как включить эту функцию, см. в разделе [Настройка ограничений доступа][iprestrictions].

> [!NOTE]
> Правила ограничения доступа на основе IP-адресов обрабатывались только в том случае, если приложение находится в Среда службы приложений. Если приложение находится в многоклиентской службе, необходимо использовать [конечные точки службы](../virtual-network/virtual-network-service-endpoints-overview.md) , чтобы ограничить трафик для выбора подсетей в виртуальной сети.

#### <a name="access-restriction-rules-based-on-service-endpoints"></a>Правила ограничения доступа на основе конечных точек службы 

Конечные точки службы позволяют заблокировать *входящий* доступ к приложению, чтобы исходный адрес был получен из набора подсетей, которые вы выбрали. Эта функция работает совместно с ограничениями доступа по протоколу IP. Конечные точки службы несовместимы с удаленной отладкой. Если вы хотите использовать удаленную отладку в приложении, клиент не может находиться в подсети, в которой включены конечные точки службы. Процесс установки конечных точек службы аналогичен процессу для настройки ограничений доступа по IP-адресу. Вы можете создать список разрешенных и запрещенных правил доступа, включающий общедоступные адреса и подсети в виртуальных сетях. 

Некоторые варианты использования этой функции:

* Настройте шлюз приложений с приложением, чтобы заблокировать входящий трафик для приложения.
* Ограничьте доступ к приложению для доступа к ресурсам в виртуальной сети. Эти ресурсы могут включать виртуальные машины, среды ASE или даже другие приложения, использующие интеграцию с виртуальной сетью. 

![Схема, иллюстрирующая использование конечных точек службы с шлюзом приложений.](media/networking-features/service-endpoints-appgw.png)

Дополнительные сведения о настройке конечных точек службы в приложении см. в статье [ограничения доступа для службы приложений Azure][serviceendpoints].

#### <a name="access-restriction-rules-based-on-service-tags"></a>Правила ограничения доступа на основе тегов служб

[Теги служб Azure][servicetags] — это четко определенные наборы IP-адресов для служб Azure. Теги служб группа диапазонов IP-адресов, используемых в различных службах Azure. Кроме того, они часто также относятся к конкретным регионам. Это позволяет фильтровать *входящий* трафик от конкретных служб Azure. 

Полный список тегов и дополнительные сведения см. по ссылке на тег Service выше. Сведения о том, как включить эту функцию, см. в разделе [Настройка ограничений доступа][iprestrictions].

#### <a name="http-header-filtering-for-access-restriction-rules"></a>Фильтрация заголовка HTTP для правил ограничения доступа

Для каждого правила ограничения доступа можно добавить дополнительную фильтрацию заголовков HTTP. Это позволяет дополнительно проверить входящий запрос и фильтр на основе конкретных значений заголовков HTTP. Каждый заголовок может иметь до 8 значений для каждого правила. В настоящее время поддерживается следующий список заголовков HTTP: 
* X-Forwarded-For
* X-Forwarded-Host
* X-Azure-ФДИД
* X-демон-HealthProbe

Ниже приведены некоторые варианты использования фильтрации заголовков HTTP.
* Ограничение доступа к трафику с прокси-серверов, пересылаемых с помощью имени узла
* Ограничение доступа к определенному экземпляру передней дверцы Azure с помощью правила тега службы и ограничения заголовка X-Azure-ФДИД

### <a name="private-endpoint"></a>Частная конечная точка

Частная конечная точка — это сетевой интерфейс, который надежно и безопасно подключается к веб-приложению по частной ссылке Azure. Частная конечная точка использует частный IP-адрес из виртуальной сети, фактически переводя веб-приложение в виртуальную сеть. Эта функция предназначена только для *входящих* потоков веб-приложения.
Дополнительные сведения см. [в статье использование частных конечных точек для веб-приложения Azure][privateendpoints].

Некоторые варианты использования этой функции:

* Ограничьте доступ к приложению из ресурсов в виртуальной сети. 
* Предоставьте свое приложение на частном IP-адресе в виртуальной сети. 
* Защитите свое приложение с помощью WAF.

Частные конечные точки предотвращают утечка данных, так как единственное, что можно достичь в частной конечной точке, — это приложение, с помощью которого она настроена. 
 
### <a name="hybrid-connections"></a>Гибридные подключения

Служба приложений гибридные подключения позволяет приложениям выполнять *Исходящие* вызовы к указанным конечным точкам TCP. Конечная точка может быть локальной, в виртуальной сети или в любом месте, которая разрешает исходящий трафик в Azure через порт 443. Чтобы использовать эту функцию, необходимо установить Агент ретранслятора с именем Диспетчер гибридных подключений на узле Windows Server 2012 или более поздней версии. Диспетчер гибридных подключений должен иметь возможность получить доступ к Azure Relay через порт 443. Вы можете скачать Диспетчер гибридных подключений из пользовательского интерфейса гибридные подключения службы приложений на портале. 

![Схема, показывающая гибридные подключения сетевой поток.](media/networking-features/hybrid-connections.png)

Гибридные подключения службы приложений основаны на Azure Relay гибридные подключения. Служба приложений использует специализированную форму функции, которая поддерживает только отправку исходящих вызовов из приложения на узел и порт TCP. Этот узел и порт должны быть разрешены только на узле, где установлен Диспетчер гибридных подключений. 

Когда приложение в службе приложений выполняет поиск DNS на узле и порту, определенных в гибридном подключении, трафик автоматически перенаправляется на подключение к гибридному подключению и из Диспетчер гибридных подключений. Дополнительные сведения см. в статье [гибридные подключения службы приложений][hybridconn].

Эта функция обычно используется для:

* Доступ к ресурсам в частных сетях, которые не подключены к Azure с помощью VPN или ExpressRoute.
* Поддержка миграции локальных приложений в службу приложений без необходимости перемещения вспомогательных баз данных.  
* Предоставление доступа с улучшенной безопасностью для одного узла и порта для гибридного подключения. Большинство сетевых функций открывают доступ к сети. С гибридные подключения можно получить доступ только к одному узлу и порту.
* Охватывают сценарии, не охваченные другими методами исходящего подключения.
* Выполните разработку в службе приложений таким образом, чтобы приложения могли легко использовать локальные ресурсы. 

Так как эта функция обеспечивает доступ к локальным ресурсам без отверстия для входящего трафика брандмауэра, она популярна для разработчиков. Другие сетевые компоненты исходящей связи службы приложений связаны с виртуальной сетью Azure. Гибридные подключения не зависит от прохождения через виртуальную сеть. Его можно использовать для более широкого спектра потребностей в сети. 

Обратите внимание, что служба приложений гибридные подключения не знает, что вы делаете над ней. Поэтому его можно использовать для доступа к базе данных, веб-службе или произвольному сокету TCP на мэйнфрейме. Компонент, по сути, осуществляет туннелирование пакетов TCP. 

Гибридные подключения является популярным для разработки, но она также используется в рабочих приложениях. Она отлично подходит для доступа к веб-службе или базе данных, но она не подходит для ситуаций, в которых предполагается создание множества подключений. 

### <a name="gateway-required-vnet-integration"></a>Интеграция с виртуальной сетью на базе шлюза 

Интеграция виртуальной сети службы приложений, требуемой для шлюза, позволяет приложению выполнять *Исходящие* запросы в виртуальную сеть Azure. Эта функция выполняется путем подключения узла, на котором выполняется приложение, к шлюзу виртуальной сети в виртуальной сети с помощью VPN типа "точка — сеть". При настройке функции приложение получает один из адресов типа "точка — сеть", назначенных каждому экземпляру. Эта функция позволяет получить доступ к ресурсам в классической или Azure Resource Manager виртуальных сетях в любом регионе. 

![Схема, которая иллюстрирует интеграцию виртуальной сети, требуемой для шлюза.](media/networking-features/gw-vnet-integration.png)

Эта функция решает проблему доступа к ресурсам в других виртуальных сетях. Она также может использоваться для подключения через виртуальную сеть к другим виртуальным сетям или к локальной среде. Он не работает с виртуальными сетями, подключенными к ExpressRoute, но работает с сетями, подключенными к VPN типа "сеть — сеть". Обычно не стоит использовать эту функцию из приложения в Среда службы приложений (ASE), так как ASE уже находится в вашей виртуальной сети. Варианты использования этой функции:

* Доступ к ресурсам на частных IP-адресах в виртуальных сетях Azure. 
* Доступ к ресурсам в локальной среде при наличии VPN типа "сеть — сеть". 
* Доступ к ресурсам в равноправных виртуальных сетях. 

Если эта функция включена, приложение будет использовать DNS-сервер, с которым настроена Целевая виртуальная сеть. Дополнительные сведения об этой функции см. в разделе [Интеграция службы приложений с виртуальной][vnetintegrationp2s]сетью. 

### <a name="vnet-integration"></a>интеграция с виртуальной сетью;

Интеграция виртуальной сети, необходимая для шлюза, полезна, но она не решает проблему доступа к ресурсам через ExpressRoute. Поначалу работы с подключениями ExpressRoute необходимо, чтобы приложения могли выполнять вызовы служб, защищенных конечной точкой службы. Другие возможности интеграции с виртуальной сетью могут соответствовать этим потребностям. 

Новая функция интеграции с виртуальной сетью позволяет разместить серверную часть приложения в подсети диспетчер ресурсов виртуальной сети в том же регионе, что и ваше приложение. Эта функция недоступна из Среда службы приложений, который уже находится в виртуальной сети. Варианты использования этой функции:

* Доступ к ресурсам в диспетчер ресурсов виртуальных сетях в одном регионе.
* Доступ к ресурсам, защищенным с помощью конечных точек службы. 
* Доступ к ресурсам, доступным для подключений ExpressRoute или VPN.
* Помощь в обеспечении безопасности всего исходящего трафика. 
* Принудительное туннелирование всего исходящего трафика. 

![Схема, иллюстрирующая интеграцию виртуальной сети.](media/networking-features/vnet-integration.png)

Дополнительные сведения см. в разделе [Интеграция службы приложений с виртуальной][vnetintegration]сетью.

### <a name="app-service-environment"></a>Среда службы приложений 

Среда службы приложений (ASE) — это развертывание службы приложений Azure, работающей в виртуальной сети, с помощью одного клиента. В некоторых случаях для этой функции:

* Доступ к ресурсам в виртуальной сети.
* Доступ к ресурсам в ExpressRoute.
* Предоставьте своим приложениям частный адрес в виртуальной сети. 
* Доступ к ресурсам между конечными точками службы. 

С помощью ASE вам не нужно использовать такие функции, как интеграция с виртуальной сетью или конечные точки службы, так как ASE уже находится в вашей виртуальной сети. Если вы хотите получить доступ к ресурсам, таким как SQL или хранилище Azure, через конечные точки службы, включите конечные точки службы в подсети ASE. Если вы хотите получить доступ к ресурсам в виртуальной сети, вам не нужно выполнять дополнительную настройку. Если вы хотите получить доступ к ресурсам в ExpressRoute, вы уже находитесь в виртуальной сети и не хотите настраивать что-либо в ASE или в приложениях. 

Так как приложения в ILB ASE могут быть предоставлены на частном IP-адресе, вы можете легко добавлять устройства WAF, чтобы предоставить доступ только к приложениям, которые вы хотите использовать в Интернете, и обеспечить безопасность остальных. Эта функция поможет упростить разработку многоуровневых приложений. 

В настоящее время некоторые из этих служб не поддерживаются, но возможны из ASE. Ниже приведены некоторые примеры:

* Предоставляйте свои приложения на частном IP-адресе.
* Защита всего исходящего трафика с помощью сетевых средств управления, которые не являются частью приложения.
* Размещение приложений в службе с одним клиентом. 
* Увеличение масштаба до большего числа экземпляров, чем возможно в многоклиентской службе. 
* Загрузка частных сертификатов клиента ЦС для использования приложениями с закрытыми конечными точками, защищенными центром сертификации.
* Принудительно выполните TLS 1,1 для всех приложений, размещенных в системе, без возможности отключить ее на уровне приложения. 
* Укажите выделенный исходящий адрес для всех приложений в ASE, которые не являются общими для клиентов. 

![Схема, иллюстрирующая ASE в виртуальной сети.](media/networking-features/app-service-environment.png)

ASE предоставляет оптимальную историю для изолированного и выделенного размещения приложений, но она требует некоторых проблем управления. Прежде чем использовать операционную ASE, необходимо учесть следующие моменты:
 
 * ASE выполняется внутри виртуальной сети, но имеет зависимости вне виртуальной сети. Эти зависимости должны быть разрешены. Дополнительные сведения см. [в статье рекомендации по сети для среда службы приложений][networkinfo].
 * ASE не масштабируется сразу же, как и многоклиентская служба. Необходимо предвидеть необходимость масштабирования, а не масштабирование в активном масштабе. 
 * ASE имеет более высокую стоимость. Чтобы максимально эффективно использовать ASE, следует запланировать помещение множества рабочих нагрузок в один ASE вместо использования их для небольших усилий.
 * Приложения в ASE не могут выборочно ограничивать доступ к некоторым приложениям в ASE, а не к другим.
 * ASE находится в подсети, а все правила работы с сетью применяются ко всему трафику, связанному с этим ASE. Если вы хотите назначить правила входящего трафика только для одного приложения, используйте ограничения доступа. 

## <a name="combining-features"></a>Объединение функций 

Функции, указанные для многоклиентской службы, можно использовать совместно для решения более сложных вариантов использования. Здесь описаны два наиболее распространенных варианта использования, но они являются просто примерами. Зная о различных функциях, можно удовлетворить практически все требования к архитектуре системы.

### <a name="place-an-app-into-a-virtual-network"></a>Размещение приложения в виртуальной сети

Может возникнуть вопрос о том, как разместить приложение в виртуальной сети. Если приложение размещено в виртуальной сети, входящие и исходящие конечные точки приложения находятся в пределах виртуальной сети. ASE — лучший способ решения этой проблемы. Но вы можете удовлетворить большую часть ваших потребностей в многоклиентской службе, объединив функции. Например, можно размещать приложения только для интрасети с частными входящими и исходящими адресами:

* Создание шлюза приложений с частными входящими и исходящими адресами.
* Защита входящего трафика приложения с конечными точками службы. 
* С помощью новой функции интеграции с виртуальной сетью, чтобы серверная часть приложения была в вашей виртуальной сети. 

Этот стиль развертывания не предоставляет выделенный адрес для исходящего трафика в Интернет или возможность блокировать весь исходящий трафик из приложения. В этом случае вы получите множество возможностей, которые в противном случае можно было бы получить с помощью ASE. 

### <a name="create-multitier-applications"></a>Создание многоуровневых приложений

Многоуровневое приложение — это приложение, в котором серверные приложения API могут быть доступны только из уровня внешнего интерфейса. Существует два способа создания многоуровневого приложения. Начните с использования интеграции с виртуальной сетью, чтобы подключить Интерфейсное веб-приложение к подсети в виртуальной сети. Это позволит веб-приложению выполнять вызовы в вашу виртуальную сеть. После подключения внешнего приложения к виртуальной сети необходимо решить, как заблокировать доступ к приложению API. Вы можете:

* Разместите как внешний интерфейс, так и приложение API в одном ILB ASE и предоставьте доступ к внешнему приложению через Интернет с помощью шлюза приложений.
* Размещение внешнего интерфейса в многоклиентской службе и серверной части в ILB ASE.
* Размещение внешнего интерфейса и приложения API в многоклиентской службе.

Если вы размещаете интерфейсное приложение и приложение API для многоуровневого приложения, вы можете:

- Предоставьте доступ к приложению API с помощью частных конечных точек в виртуальной сети:

  ![Схема, иллюстрирующая использование частных конечных точек в двухуровневом приложении.](media/networking-features/multi-tier-app-private-endpoint.png)

- Используйте конечные точки службы, чтобы убедиться, что входящий трафик к приложению API поступает только из подсети, используемой интерфейсным веб-приложением.

  ![Схема, иллюстрирующая использование конечных точек службы для защиты приложения.](media/networking-features/multi-tier-app.png)

Ниже приведены некоторые рекомендации, которые помогут решить, какой метод использовать.

* При использовании конечных точек службы необходимо только защитить трафик к приложению API в подсети интеграции. Это помогает защитить приложение API, но вы по-прежнему можете утечка данные из внешнего приложения в другие приложения в службе приложений.
* При использовании частных конечных точек у вас есть две подсети, что повышает сложность. Кроме того, Частная конечная точка является ресурсом верхнего уровня и добавляет дополнительные затраты на управление. Преимущество использования частных конечных точек заключается в том, что у вас нет возможности утечка данных. 

Любой из этих методов будет работать с несколькими внешними интерфейсами. В небольшом масштабе конечные точки службы проще использовать, так как вы просто включаете конечные точки службы для приложения API в подсети интеграции переднего плана. При добавлении дополнительных интерфейсных приложений необходимо настроить каждое приложение API для включения конечных точек службы в подсеть интеграции. При использовании частных конечных точек это усложняется, но вам не нужно изменять все приложения API после установки частной конечной точки. 

### <a name="line-of-business-applications"></a>бизнес-приложения;

Бизнес-приложения — это внутренние приложения, которые обычно не предоставляются для доступа из Интернета. Эти приложения вызываются из корпоративных сетей, в которых доступ можно контролировать. При использовании ILB ASE можно легко разместить бизнес-приложения. При использовании многоклиентской службы можно либо использовать частные конечные точки, либо использовать конечные точки службы совместно с шлюзом приложений. Существует две причины использовать шлюз приложений с конечными точками службы вместо частных конечных точек.
* Требуется WAF защита бизнес-приложений.
* Вы хотите распределить нагрузку между несколькими экземплярами бизнес-приложений.

Если ни одна из этих нужд не применяется, лучше использовать частные конечные точки. Если в службе приложений доступны частные конечные точки, вы можете предоставлять свои приложения на частных адресах в виртуальной сети. Частная конечная точка, размещенная в виртуальной сети, может быть достигнута через подключения ExpressRoute и VPN. 

При настройке частных конечных точек ваши приложения будут предоставляться по частному адресу, но вам потребуется настроить DNS для доступа к этому адресу из локальной среды. Чтобы выполнить эту настройку, необходимо перенаправить Azure DNS частную зону, содержащую частные конечные точки, на локальные DNS-серверы. Azure DNS частные зоны не поддерживают пересылку зон, но вы можете поддерживать переадресацию зон с помощью DNS-сервера для этой цели. Шаблон [сервера пересылки DNS](https://azure.microsoft.com/resources/templates/301-dns-forwarder/) упрощает пересылку Azure DNS частной зоны на локальные DNS-серверы.

## <a name="app-service-ports"></a>Порты службы приложений

При сканировании службы приложений можно найти несколько портов, доступных для входящих подключений. Нет способа заблокировать или контролировать доступ к этим портам в многоклиентской службе. Ниже приведен список доступных портов.

| Использование | Порт или порты |
|----------|-------------|
|  HTTP/HTTPS  | 80, 443 |
|  Управление | 454, 455 |
|  FTP/FTPS    | 21, 990, 10001-10020 |
|  Удаленная отладка в Visual Studio  |  4020, 4022, 4024 |
|  Служба веб-развертывание | 8172 |
|  Использование инфраструктуры | 7654, 1221 |

<!--Links-->
[appassignedaddress]: ./configure-ssl-certificate.md
[iprestrictions]: ./app-service-ip-restrictions.md
[serviceendpoints]: ./app-service-ip-restrictions.md
[hybridconn]: ./app-service-hybrid-connections.md
[vnetintegrationp2s]: ./web-sites-integrate-with-vnet.md
[vnetintegration]: ./web-sites-integrate-with-vnet.md
[networkinfo]: ./environment/network-info.md
[appgwserviceendpoints]: ./networking/app-gateway-with-service-endpoints.md
[privateendpoints]: ./networking/private-endpoint.md
[servicetags]: ../virtual-network/service-tags-overview.md