---
title: Исправление ошибок HTTP 502 и HTTP 503
description: Устранение ошибок "502 — недопустимый шлюз" и "503 — служба недоступна", возникающих при работе приложения, размещенного в Службе приложений Azure.
tags: top-support-issue
keywords: 502 — недопустимый шлюз, 503 — служба недоступна, ошибка 503, ошибка 502
ms.assetid: 51cd331a-a3fa-438f-90ef-385e755e50d5
ms.topic: article
ms.date: 07/06/2016
ms.custom: seodec18
ms.openlocfilehash: 801f4840d0d1447f839e5c2c4bc3168741b62b63
ms.sourcegitcommit: f28ebb95ae9aaaff3f87d8388a09b41e0b3445b5
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/29/2021
ms.locfileid: "100586258"
---
# <a name="troubleshoot-http-errors-of-502-bad-gateway-and-503-service-unavailable-in-azure-app-service"></a>Устранение ошибок HTTP "502 — недопустимый шлюз" и "503 — служба недоступна" в Службе приложений Azure
"502 — недопустимый шлюз" и "503 — служба недоступна" — распространенные ошибки, возникающие при работе приложения, размещенного в [Службе приложений Azure](./overview.md). Эта статья поможет вам устранить эти ошибки.

Если вам потребуется дополнительная помощь по любому из вопросов, рассматриваемых в статье, вы можете обратиться к экспертам по Azure на [форумах MSDN Azure и Stack Overflow](https://azure.microsoft.com/support/forums/). Кроме того, можно зарегистрировать обращение в службу поддержки Azure. Перейдите на [сайт службы поддержки Azure](https://azure.microsoft.com/support/options/) и щелкните **Поддержка**.

## <a name="symptom"></a>Симптом
При открытии приложения браузер возвращает ошибку HTTP "502 — недопустимый шлюз" или HTTP "503 — служба недоступна".

## <a name="cause"></a>Причина
Эта проблема часто связана с проблемами на уровне приложения, например:

* слишком долгое выполнение запросов;
* слишком высокие требования приложения к памяти и процессору;
* сбой приложения из-за исключения.

## <a name="troubleshooting-steps-to-solve-502-bad-gateway-and-503-service-unavailable-errors"></a>Действия по устранению ошибок "502 — недопустимый шлюз" и "503 — служба недоступна"
Процесс устранения неполадок можно разделить на три последовательных задачи.

1. [Наблюдение за поведением приложения.](#observe)
2. [Сбор данных.](#collect)
3. [Устранение проблемы.](#mitigate)

[Служба приложений](overview.md) содержит несколько параметров для каждого из этих этапов.

<a name="observe"></a>

### <a name="1-observe-and-monitor-application-behavior"></a>1. Наблюдение за поведением приложения
#### <a name="track-service-health"></a>Мониторинг работоспособности службы
Microsoft Azure информирует о каждом случае прерывания работы или снижения производительности службы. Можно следить за работоспособностью службы на [портале Azure](https://portal.azure.com/). Дополнительные сведения см. в статье [Получение информации о работоспособности службы](../service-health/service-notifications.md).

#### <a name="monitor-your-app"></a>Отслеживание работы приложения
Этот инструмент позволяет определить наличие проблем с приложением. В колонке вашего приложения щелкните на плитку **Запросы и ошибки**. Колонка **Метрика** содержит все метрики, которые вы можете добавить.

Некоторые из этих метрик помогут вам отслеживать работу приложения, например,

* средний размер рабочего набора памяти;
* Среднее время ответа
* время ЦП;
* рабочий набор памяти;
* Requests

![Мониторинг приложения для устранения ошибок HTTP "502 — недопустимый шлюз" и "503 — служба недоступна"](./media/app-service-web-troubleshoot-HTTP-502-503/1-monitor-metrics.png)

Дополнительные сведения см. в разделе:

* [Мониторинг приложений в Службе приложений Azure](web-sites-monitor.md)
* [Создание оповещений для служб Azure с помощью портала Azure](../azure-monitor/alerts/alerts-overview.md)

<a name="collect"></a>

### <a name="2-collect-data"></a>2. Сбор данных
#### <a name="use-the-diagnostics-tool"></a>Использование средства диагностики
Служба приложений не требует никакой настройки и предоставляет вам интеллектуальный и интерактивный интерфейс для устранения неполадок в приложении. Если возникнут проблемы с приложением, средство диагностики предоставит сведения об ошибках, которые помогут быстрее найти нужную информацию для поиска и устранения этих проблем.

Чтобы открыть диагностику службы приложений, перейдите на [портале Azure](https://portal.azure.com) к приложению службы приложений или к среде службы приложений. На панели навигации слева щелкните **Диагностика и решение проблем**.

#### <a name="use-the-kudu-debug-console"></a>Использование консоли отладки Kudu
Служба приложений оснащена консолью отладки, с помощью которой вы можете получать сведения о среде, используя функции отладки, изучения, передачи файлов и конечных точек JSON. Она называется *консоль Kudu* или *панель SCM* приложения.

Вы можете открыть эту панель по ссылке **https://&lt;имя приложения>.scm.azurewebsites.net/** .

Вот некоторые возможности консоли Kudu:

* настройки среды для вашего приложения;
* потоковая передача журналов;
* диагностический дамп;
* консоль отладки с возможностью запуска командлетов Powershell и основных команд DOS.

У консоли Kudu есть еще одна очень полезная функция. Если приложение создает обрабатываемые исключения, с помощью консоли Kudu и средства SysInternals Procdump вы можете получать дампы памяти. Эти дампы памяти представляют собой снимок процессов и могут помочь в устранении сложных проблем в приложении.

Дополнительные сведения о возможностях консоли Kudu см. в статье [Azure Websites online tools you should know about](https://azure.microsoft.com/blog/windows-azure-websites-online-tools-you-should-know-about/) (Интерактивные инструменты веб-сайтов Azure, о которых вам нужно знать).

<a name="mitigate"></a>

### <a name="3-mitigate-the-issue"></a>3. Устранение проблемы
#### <a name="scale-the-app"></a>Масштабирование приложения
В службе приложений Azure вы можете изменять масштаб выполнения приложения, чтобы увеличить его производительность и пропускную способность. Масштабирование приложения предполагает два связанных действия: изменение ценовой категории для используемого плана службы приложений на более высокую с последующей настройкой некоторых параметров.

Дополнительные сведения о масштабировании см. в статье [Увеличение масштаба приложения в Azure](manage-scale-up.md).

Кроме того, вы можете запустить более одного экземпляра приложения. Это не только увеличит возможности обработки, но и повысит устойчивость приложения к сбоям. Если прекратит работу один экземпляр приложения, другой экземпляр продолжит обрабатывать запросы.

Вы можете выбрать ручной или автоматический режим масштабирования.

#### <a name="use-autoheal"></a>Использование функции AutoHeal
Функция AutoHeal перезапускает рабочий процесс вашего приложения при определенных условиях, которые вы определяете в настройках (например, при изменении конфигурации, при определенном количестве запросов, при достижении ограничений памяти или времени выполнения запроса). В большинстве случаев повторный запуск процесса будет самым быстрым способом устранения проблемы. Хотя приложение всегда можно вручную перезапустить на портале Azure, функция AutoHeal позволяет выполнять перезапуск автоматически. Для этого достаточно добавить в корневой файл web.config вашего приложения некоторые триггеры. Эти параметры одинаково работают во всех приложениях, а не только в приложениях .NET.

Дополнительные сведения см. в статье об [автоматическом восстановлении веб-сайтов Microsoft Azure](https://azure.microsoft.com/blog/auto-healing-windows-azure-web-sites/).

#### <a name="restart-the-app"></a>Перезапуск приложения
Обычно это самый простой способ восстановления после проблемы, которая возникла один раз. Остановить или перезапустить приложение можно с помощью колонки вашего приложения на [портале Azure](https://portal.azure.com/).

 ![Перезапуск приложения для устранения ошибок HTTP "502 — недопустимый шлюз" и "503 — служба недоступна"](./media/app-service-web-troubleshoot-HTTP-502-503/2-restart.png)

Вы также можете управлять приложением с помощью Azure PowerShell. Дополнительные сведения см. в статье [Использование Azure PowerShell с диспетчером ресурсов Azure](../azure-resource-manager/management/manage-resources-powershell.md).