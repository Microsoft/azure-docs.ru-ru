---
title: Функциональные возможности операционной системы
description: Сведения о функциональных возможностях ОС в службе приложений Azure в Windows. Узнайте, какие типы файлов, сети и реестра получают доступ к вашему приложению.
ms.assetid: 39d5514f-0139-453a-b52e-4a1c06d8d914
ms.topic: article
ms.date: 10/30/2018
ms.custom: seodec18
ms.openlocfilehash: 949e408544e25cb55622cf2a1b1d2dddb92350a6
ms.sourcegitcommit: 910a1a38711966cb171050db245fc3b22abc8c5f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "96001513"
---
# <a name="operating-system-functionality-on-azure-app-service"></a>Функциональные возможности операционной системы для службы приложений Azure
В этой статье описываются базовые функциональные возможности операционной системы, доступные для всех приложений в [Службе приложений Azure](./overview.md). Данные функциональные возможности включают в себя доступ к файлам, сети и реестру, а также диагностику и журналы событий. 

> [!NOTE] 
> [Приложения Linux](overview.md#app-service-on-linux) в Службе приложений работают в собственных контейнерах. Доступ к операционной системе хоста запрещен, но у вас есть права root на доступ к контейнеру. В случае с [приложениями, работающими в контейнерах Windows](quickstart-custom-container.md?pivots=container-windows), у вас есть административный доступ к контейнеру, но нет доступа к операционной системе хоста. 
>

<a id="tiers"></a>

## <a name="app-service-plan-tiers"></a>Уровни обслуживания плана службы приложений
Служба приложений запускает приложения клиента в мультитенантной среде размещения. Приложения, развернутые на уровнях **Бесплатный** и **Общий**, выполняются в рабочих процессах на общих виртуальных машинах, а приложения, развернутые на уровнях **Стандартный** и **Премиум**, выполняются на виртуальных машинах, которые выделены специально для приложений, связанных с отдельным клиентом.

[!INCLUDE [app-service-dev-test-note](../../includes/app-service-dev-test-note.md)]

Поскольку служба приложений поддерживает простое масштабирование между различными уровнями, конфигурация безопасности для приложений службы приложений не изменится. Это обеспечивает отсутствие внезапного изменения режима работы приложений и неожиданных сбоев при переключении плана службы приложений с одного уровня на другой.

<a id="developmentframeworks"></a>

## <a name="development-frameworks"></a>Платформы разработки
От ценовых категорий службы приложений зависит объем доступных приложениям вычислительных ресурсов (ЦП, дисковое пространство, память и исходящий сетевой трафик). При этом спектр доступных приложениям функциональных возможностей платформы остается неизменным в любом уровне масштабирования.

Служба приложений поддерживает широкий спектр платформ разработки, включая ASP.NET, классический ASP, node.js, PHP и Python, выполняемых в виде расширений в службах IIS. Чтобы упростить и нормализовать конфигурацию безопасности, служба приложений обычно использует различные платформы разработки с параметрами по умолчанию. Один из подходов к настройке приложений может заключаться в настройке контактной зоны API и функциональных возможностей для каждой отдельной платформы разработки. Вместо этого служба приложений использует более общий подход, реализуя общий базовый уровень функциональных возможностей операционной системы независимо от среды разработки приложения.

В следующих разделах приведены общие виды функциональных возможностей операционной системы, доступных приложениям службы приложений.

<a id="FileAccess"></a>

## <a name="file-access"></a>Доступ к файлам
В службе приложений используются разные диски, включая локальные и сетевые диски.

<a id="LocalDrives"></a>

### <a name="local-drives"></a>Локальные диски
По своей сути служба приложений является службой, выполняемой поверх инфраструктуры Azure PaaS (платформа как услуга). В результате локальные диски, "подключенные" к виртуальной машине, – это те же типы дисков, которые доступны любой рабочей роли в Azure. В том числе:

- Диск операционной системы (диск D:\)
- Диск, содержащий CSPKG-файлы пакета Azure, используемые исключительно службой приложений (и недоступные для клиентов)
- "Пользовательский" диск (диск C:\), размер которого зависит от размера виртуальной машины. 

Важно отслеживать использование диска по мере роста приложения. Если будет достигнута квота использования диска, это отрицательно повлияет на приложение. Пример: 

- В приложении может появиться сообщение об ошибке, уведомляющее о том, что на диске недостаточно места.
- При обзоре консоли Kudu могут отображаться ошибки диска.
- Развертывание из Azure DevOps или Visual Studio может завершиться с ошибкой `ERROR_NOT_ENOUGH_DISK_SPACE: Web deployment task failed. (Web Deploy detected insufficient space on disk)` .
- Производительность приложения может снизиться.

<a id="NetworkDrives"></a>

### <a name="network-drives-unc-shares"></a>Сетевые диски (UNC-общие папки)
Одно из уникальных свойств службы приложений, позволяющее упростить обслуживание и развертывание приложений, — это возможность хранения всего пользовательского содержимого на наборе общих UNC-ресурсов. Эта модель очень хорошо согласуется с распространенным шаблоном хранилища содержимого, который используется локальными средами размещения веб-сайтов, имеющими несколько серверов с балансировкой нагрузки. 

Внутри службы приложений присутствует определенное число общих UNC-ресурсов, созданных в каждом центре обработки данных. Процент пользовательского содержимого для всех клиентов в каждом центре обработки данных выделяется для каждого общего UNC-ресурса. Кроме того, все файловое содержимое для одной клиентской подписки всегда размещается в одном общем UNC-ресурсе. 

Из-за особенностей работы облачных служб Azure виртуальная машина, отвечающая за размещение общего UNC-ресурса, будет периодически меняться. Гарантируется, что общие UNC-ресурсы будут подключаться к различным виртуальным машинам во время их включения и отключения в рамках выполнения обычных операций Azure. По этой причине в приложениях никогда не следует жестко программировать предположение о том, что информация о машине в пути UNC со временем будет оставаться неизменной. Вместо этого они должны использовать удобный *искусственный* абсолютный путь **D:\home\site**, предоставляемый службой приложений. Ложный абсолютный путь предоставляет портативный и независимый от приложений и пользователей метод указания ссылки на свое приложение. С помощью пути **D:\home\site** можно переносить общие файлы из приложения в приложение без необходимости настраивать новый абсолютный путь для каждой передачи.

<a id="TypesOfFileAccess"></a>

### <a name="types-of-file-access-granted-to-an-app"></a>Типы доступа к файлам для приложения
В состав подписки каждого клиента входит зарезервированная структура каталогов на определенном общем UNC-ресурсе в центре обработки данных. У клиента может быть несколько приложений, созданных в конкретном центре обработки данных, поэтому все каталоги, относящиеся к одной клиентской подписке, создаются на одном общем UNC-ресурсе. Общий ресурс может содержать каталоги, например, для содержимого, журналов ошибок и диагностики, а также более ранних версий приложения, созданных системой управления версиями. Каталоги приложения клиента доступны для чтения и записи во время выполнения для кода приложения.

На локальных дисках, подключенных к виртуальной машине, где выполняется приложение, служба приложений резервирует часть места на диске C:\ под временное локальное хранилище для конкретного приложения. Хотя приложение имеет полный доступ к чтению и записи к собственному временному локальному хранилищу, код приложения не может использовать это хранилище напрямую. Наоборот, цель состоит в том, чтобы предоставить временное хранилище файлов для служб IIS и платформ веб-приложений. Служба приложений также ограничивает объем временного локального хранилища для каждого приложения, чтобы предотвратить использование чрезмерных объемов памяти отдельными приложениями.

Двумя примерами того, как служба приложений использует временное локальное хранилище, являются каталог для временных файлов ASP.NET и каталог для сжатых файлов IIS. Система компиляции ASP.NET использует каталог "Temporary ASP.NET Files" в качестве временного расположения кэша компиляции. Службы IIS используют каталог "IIS Temporary Compressed Files" для хранения сжатых выходных данных ответа. Оба эти типа использования файлов (а также и другие) в службе приложений переназначаются временному локальному хранилищу для конкретных приложений. Результатом такого переназначения является неизменная работа функциональных возможностей.

Каждое приложение в службе приложений выполняется как случайное уникальное удостоверение рабочего процесса с низким уровнем привилегий, называемое "удостоверение пула приложений", которое описывается [https://www.iis.net/learn/manage/configuring-security/application-pool-identities](https://www.iis.net/learn/manage/configuring-security/application-pool-identities) Далее. Код приложения использует это удостоверение в целях базового доступа только для чтения к диску операционной системы (диск D:\). Это означает, что код приложения может перечислять стандартные структуры каталогов и считывать стандартные файлы на диске операционной системы. Хотя такой уровень доступа может показаться довольно обширным, те же каталоги и файлы доступны при подготовке рабочей роли в размещенной службе Azure и считывании содержимого диска. 

<a name="multipleinstances"></a>

### <a name="file-access-across-multiple-instances"></a>Доступ к файлам в нескольких экземплярах
Содержимое приложения находится в домашнем каталоге, и код приложения может осуществлять в него запись. Если приложение выполняется в нескольких экземплярах, домашний каталог используется совместно всеми этими экземплярами, чтобы все они могли просматривать один и тот же каталог. Например, если приложение сохраняет отправленные файлы в домашний каталог, эти файлы сразу же становятся доступны всем экземплярам. 

<a id="NetworkAccess"></a>

## <a name="network-access"></a>Доступ к сети
Код приложения может использовать протоколы на базе TCP/IP и UDP для установки исходящих сетевых подключений к доступным из Интернета конечным точкам, предоставляющим внешние службы. Приложения могут использовать эти же протоколы для подключения к службам в Azure, например, установив HTTPS подключения к базе данных SQL.

Также у приложений есть ограниченная возможность установить одно локальное подключение с замыканием на себя и заставить приложение прослушивать этот локальный сокет замыкания на себя. Эта возможность предназначена главным образом для того, чтобы использовать приложения, прослушивающие локальные сокеты замыкания на себя. Каждое приложение видит "частное" подключение с замыканием на себя. Приложение А не может прослушивать локальный сокет замыкания на себя, созданный приложением Б.

Именованные каналы также поддерживаются в качестве механизма межпроцессного взаимодействия (IPC) между различными процессами, которые совместно обеспечивают работу приложения. Например, модуль FastCGI IIS использует именованные каналы для координации отдельных процессов, обеспечивающих работу страниц PHP.

<a id="Code"></a>

## <a name="code-execution-processes-and-memory"></a>Выполнение кода, процессы и память
Как отмечалось ранее, приложения выполняются внутри рабочих процессов с низкими привилегиями, используя случайное удостоверение пула приложений. Код приложения имеет доступ к области памяти, связанной с рабочим процессом, а также любыми дочерними процессами, которые могут порождаться процессами CGI или другими приложениями. Однако одно приложение не может получить доступ к памяти или данным другого приложения, даже если оно находится на той же виртуальной машине.

Приложения могут выполнять скрипты или страницы, созданные на базе поддерживаемых платформ веб-разработки. Служба приложений не настраивает параметры веб-платформ для получения более ограниченных режимов. Например, приложения ASP.NET, выполняемые в службе приложений, имеют полное доверие в отличие от режима более ограниченного доверия. Веб-платформы, в том числе классические ASP и ASP.NET, могут вызвать внутрипроцессные COM-компоненты (но не внепроцессные COM-компоненты), например ADO (объекты данных ActiveX), зарегистрированные по умолчанию в операционной системе Windows.

Приложения могут порождать и запускать произвольный код. Приложение может создать командную оболочку или запустить скрипт PowerShell. Тем не менее, хотя приложением могут порождаться процессы и произвольный код, исполняемые программы и скрипты по-прежнему требуют прав доступа, назначаемых родительскому пулу приложений. Например, приложение может породить исполняемый файл, который выполняет исходящий вызов HTTP, но тот же самый исполняемый файл не может попытаться отменить привязку IP-адреса виртуальной машины к его сетевой карте. Коду с низким уровнем привилегий разрешено выполнять исходящий сетевой вызов, но для перенастройки параметров сети на виртуальной машине требуются права администратора.

<a id="Diagnostics"></a>

## <a name="diagnostics-logs-and-events"></a>Журналы диагностики и события
Сведения журнала являются другим набором данных, к которому пытаются получить доступ некоторые приложения. Типы данных журнала, которые доступны коду, выполняемому в службе приложений, включают в себя диагностическую информацию и сведения журналов, создаваемые приложением и легко доступные приложению. 

Например, журналы HTTP W3C, созданные активным приложением, доступны либо в каталоге журнала в сетевой папке, созданной для данного приложения, либо в хранилище больших двоичных объектов, если клиент настроил ведение журналов W3C в этом хранилище. Последний вариант позволяет собирать больше журналов без риска превышения лимитов хранилища файлов, связанных с сетевой папкой.

Точно так же можно регистрировать диагностическую информацию реального времени из приложений .NET с помощью инфраструктуры трассировки и диагностики .NET, при этом имеется возможность записывать данные трассировки в сетевую папку приложения или в хранилище BLOB-объектов.

Приложениям недоступны следующие области ведения журналов диагностики и трассировки: события трассировки событий Windows и общие журналы событий Windows (например, журналы событий системы, приложений и безопасности). Поскольку данные трассировки событий Windows могут стать видимыми в рамках всей машины (при использовании подходящих ACL), доступ на чтение и запись к событиям трассировки событий Windows блокируется. Разработчики могут заметить, что вызовы API для чтения и записи событий трассировки событий Windows и общих журналов событий Windows работают, но это вызвано тем, что служба приложений "подделывает" такие вызовы, чтобы они выглядели успешными. На самом деле код приложения не имеет доступа к этим данным событий.

<a id="RegistryAccess"></a>

## <a name="registry-access"></a>Доступ к реестру
Приложения имеют доступ только для чтения к большей части реестра на виртуальной машине, где они выполняются. На практике это означает, что разделы реестра, которые предоставляют локальным группам "Пользователи" доступ только для чтения, доступны приложениям. Одной областью реестра, в настоящее время не поддерживающей доступ для чтения или записи, является куст HKEY\_CURRENT\_USER.

Запись в реестр заблокирована, включая доступ к разделам реестра для отдельных пользователей. С точки зрения приложения в среде Azure никогда не следует полагаться на возможность записи в реестр, так как приложения перемещаются между разными виртуальными машинами. Единственным постоянным хранилищем для записи, на которое может полагаться приложение, является структура каталогов содержимого для отдельных приложений, хранящаяся в общих UNC-ресурсах службы приложений. 

## <a name="remote-desktop-access"></a>Доступ к удаленному рабочему столу

Служба приложений не предоставляет доступ по протоколу удаленного рабочего стола к экземплярам виртуальных машин.

## <a name="more-information"></a>Дополнительные сведения

[Песочница Службы приложений Azure](https://github.com/projectkudu/kudu/wiki/Azure-Web-App-sandbox): последние сведения о среде выполнения Службы приложений. Эта страница поддерживается непосредственно командой разработчиков службы приложений.