---
title: Учебник. Фильтрация, анализ данных для расширенного развертывания с помощью вычислений в Azure Stack Edge Pro | Документация Майкрософт
description: Сведения о том, как настроить роль вычислений в Azure Stack Edge Pro и использовать ее для преобразования данных для процесса расширенного развертывания перед отправкой в Azure.
services: databox
author: alkohli
ms.service: databox
ms.subservice: edge
ms.topic: tutorial
ms.date: 01/06/2021
ms.author: alkohli
ms.openlocfilehash: 81953f573c47d229fcaccd7c11f62155acd2f119
ms.sourcegitcommit: 73fb48074c4c91c3511d5bcdffd6e40854fb46e5
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/31/2021
ms.locfileid: "106063650"
---
# <a name="tutorial-transform-data-with-azure-stack-edge-pro-for-advanced-deployment-flow"></a>Руководство по Преобразование данных с помощью Azure Stack Edge Pro для процесса расширенного развертывания

В этом учебнике описывается, как настроить роль вычислений для процесса расширенного развертывания в устройстве Azure Stack Edge Pro. Когда роль вычислений будет настроена, Azure Stack Edge Pro может преобразовывать данные перед их отправкой в ​​Azure.

Вычисления можно настроить для процесса простого или расширенного развертывания в устройстве.

| Критерии | Простое развертывание                                | Расширенное развертывание                   |
|------------------|--------------------------------------------------|---------------------------------------|
| Предполагаемое использование     | ИТ-администраторы                                | Разработчики                            |
| Тип             | Использование службы Azure Stack Edge для развертывания модулей      | Использование службы Центр Интернета вещей для развертывания модулей |
| Развернутые модули | Один                                           | Цепочка или несколько модулей           |


Эта процедура может занять от 20 до 30 минут.

В этом руководстве описано следующее:

> [!div class="checklist"]
> * настройка вычислений;
> * добавление общих папок;
> * Добавление триггера
> * Добавление модуля вычислений.
> * Проверка преобразования и передачи данных

 
## <a name="prerequisites"></a>Предварительные требования

Прежде чем вы настроите роль вычислений на устройстве Azure Stack Edge Pro, убедитесь, что:

- устройство Azure Stack Edge Pro активировано, как описано в статье [Подключение, настройка и активация Azure Stack Edge Pro](azure-stack-edge-deploy-connect-setup-activate.md).


## <a name="configure-compute"></a>настройка вычислений;

Чтобы настроить вычисления в Azure Stack Edge Pro, необходимо создать ресурс Центра Интернета вещей.

1. На портале Azure своего ресурса Azure Stack Edge перейдите к разделу **Обзор**. В области справа выберите плитку **IoT Edge**.

    ![Начало работы с вычислениями](./media/azure-stack-edge-deploy-configure-compute-advanced/configure-compute-1.png)

2. На плитке **Enable IoT Edge service** (Включение службы IoT Edge) выберите элемент **Добавить**. Будет активирована служба IoT Edge, которая позволяет локально развертывать модули IoT Edge на устройстве.

    ![Начало работы с вычислениями 2](./media/azure-stack-edge-deploy-configure-compute-advanced/configure-compute-2.png)

3. В разделе **Create IoT Edge service** (Создать службу IoT Edge) введите следующее:

   
    |Поле  |Значение  |
    |---------|---------|
    |Подписка     |Выберите подписку для своего ресурса Центра Интернета вещей. Вы можете выбрать ту же подписку, которую использует ресурс Azure Stack Edge.        |
    |Группа ресурсов     |Введите имя группы ресурсов для своего ресурса Центра Интернета вещей. Вы можете выбрать ту же группу ресурсов, которую использует ресурс Azure Stack Edge.         |
    |Центр Интернета вещей     | Выберите **Новый** или **Существующий**. <br> По умолчанию для создания ресурса Интернета вещей используется уровень служб "Стандартный" (S1). Чтобы использовать ресурс Интернета вещей уровня служб "Бесплатный", создайте его и выберите существующий ресурс.      |
    |Имя     |Оставьте значение по умолчанию или введите имя для своего ресурса Центра Интернета вещей.         |

    ![Начало работы с вычислениями 3](./media/azure-stack-edge-deploy-configure-compute-advanced/configure-compute-3.png)

4. Выберите **Review + Create** (Просмотреть и создать). Для создания ресурса Центра Интернета вещей нужно несколько минут. После создания ресурса Центра Интернета вещей сведения в разделе **Обзор** обновятся. Там будет указано, что служба IoT Edge запущена. 

    При настройке службы IoT Edge на пограничном устройстве создается два устройства — устройство Интернета вещей и устройство IoT Edge. Оба устройства можно просмотреть в ресурсе Центра Интернета вещей. На этом устройстве IoT Edge также запущена среда выполнения IoT Edge. На данный момент доступна только платформа Linux для устройства IoT Edge.

    Чтобы убедиться, что роль для пограничных вычислений настроена, выберите элементы **IoT Edge service (Служба IoT Edge) > Свойства** и просмотрите сведения об устройстве Интернета вещей и устройстве IoT Edge. 

    ![Начало работы с вычислениями 4](./media/azure-stack-edge-deploy-configure-compute-advanced/configure-compute-4.png)
    

## <a name="add-shares"></a>добавление общих папок;

Для расширенного развертывания, описанного в этом учебнике, вам понадобятся две общие папки: общая папка Edge и еще одна локальная общая папка Edge.

1. Добавьте общую папку Edge на устройство следующим образом:

    1. В ресурсе Azure Stack Edge перейдите к разделу **IoT Edge > Общие папки**.
    2. На странице **Общие папки** на панели команд выберите элемент **+ Добавить общую папку**.
    3. В колонке **Добавление общего файлового ресурса** укажите имя общей папки и выберите ее тип.
    4. Чтобы подключить общую папку Edge, установите флажок **Использовать общую папку с пограничными вычислениями**.
    5. Выберите **учетную запись хранения**, **службу хранилища**, существующего пользователя, а затем щелкните **Создать**.

        ![Добавление общей папки Edge](./media/azure-stack-edge-deploy-configure-compute-advanced/add-edge-share-1.png)

    После создания общей папки Edge вы получите уведомление об успешном создании. Список общих папок обновляется с учетом новых.

2. Добавьте локальную общую папку Edge на устройство Edge. Для этого повторите все шаги, описанные на предыдущем этапе, и установите флажок **Настройка в качестве локальной общей папки Edge**. Данные из локальной обшей папки остаются на устройстве.

    ![Добавление локальной общей папки Edge](./media/azure-stack-edge-deploy-configure-compute-advanced/add-edge-share-2.png)

3. В колонке **Общие папки** вы увидите обновленный список общих папок.

    ![Обновленный список общих папок](./media/azure-stack-edge-deploy-configure-compute-advanced/add-edge-share-3.png)

4. Выберите из списка созданную локальную общую папку, чтобы просмотреть ее свойства. Скопируйте значение, соответствующее этому ресурсу, в поле **Локальная точка подключения для модулей пограничных вычислений**.

    Эта локальная точка подключения используется при развертывании модуля.

    ![Поле "Локальная точка подключения для модулей пограничных вычислений"](./media/azure-stack-edge-deploy-configure-compute-advanced/add-edge-share-4.png)
 
5. Выберите из списка созданную общую папку Edge, чтобы просмотреть ее свойства. Скопируйте значение, соответствующее этому ресурсу, в поле **Локальная точка подключения для модулей пограничных вычислений**.

    Эта локальная точка подключения используется при развертывании модуля.

    ![Добавление настраиваемого модуля](./media/azure-stack-edge-deploy-configure-compute-advanced/add-edge-share-5.png)


## <a name="add-a-trigger"></a>Добавление триггера

1. Перейдите к ресурсу Azure Stack Edge, а затем — к разделу **IoT Edge > Триггеры**. Выберите **+ Добавить триггер**.

    ![Добавление триггера](./media/azure-stack-edge-deploy-configure-compute-advanced/add-trigger-1.png)

2. В колонке **Добавить триггер** введите следующие значения.

    |Поле  |Значение  |
    |---------|---------|
    |Имя триггера     | Уникальное имя триггера.         |
    |Тип триггера     | Выберите триггер **файла**. Триггер файла срабатывает, когда возникает событие файла, например файл записывается во входную общую папку. С другой стороны, запланированный триггер срабатывает в соответствии с определенным вами расписанием. В этом примере нам нужен триггер файла.    |
    |Входная общая папка     | Выберите входную общую папку. В этом случае входной общей папкой будет локальная общая папка Edge. Используемый здесь модуль позволяет переместить файлы из локальной общей папки Edge в общую папку Edge, из которой они передаются в облако.        |

    ![Добавление триггера (2)](./media/azure-stack-edge-deploy-configure-compute-advanced/add-trigger-2.png)

3. После создания триггера вы получите уведомление. Список триггеров обновляется, чтобы отобразить только что созданный триггер. Выберите только что созданный триггер.

    ![Добавление триггера (3)](./media/azure-stack-edge-deploy-configure-compute-advanced/add-trigger-3.png)

4. Скопируйте и сохраните пример маршрута. Вам предстоит изменить этот пример маршрута и использовать его позже в Центре Интернета вещей.

    `"sampleroute&quot;: &quot;FROM /* WHERE topic = 'mydbesmbedgelocalshare1' INTO BrokeredEndpoint(\"/modules/modulename/inputs/input1\")"`

    ![Добавление триггера (4)](./media/azure-stack-edge-deploy-configure-compute-advanced/add-trigger-4.png)

## <a name="add-a-module"></a>Добавление модуля

На этом устройстве Edge нет пользовательских модулей. Можно добавить пользовательский или готовый модуль. Чтобы узнать, как создать пользовательский модуль, ознакомьтесь со статьей [Разработка на C# модуля для устройства Azure Stack Edge Pro](azure-stack-edge-create-iot-edge-module.md).

В этом разделе объясняется, как добавить пользовательский модуль к устройству IoT Edge, которое было создано с помощью руководства [Разработка на C# модуля для Azure Stack Edge Pro](azure-stack-edge-create-iot-edge-module.md). Этот пользовательский модуль позволяет получить файлы из локальной общей папки Edge на устройстве Edge и перенести их в облачную общую папку Edge на устройстве. Затем облачный ресурс переносит файлы в учетную запись Azure, связанную с облачным ресурсом.

1. Перейдите к ресурсу Azure Stack Edge, а затем — к разделу **IoT Edge > Обзор**. На плитке **Модули** выберите элемент **Go to Azure IoT Hub** (Перейти к Центру Интернета вещей Azure).

    ![Выбор расширенного развертывания](./media/azure-stack-edge-deploy-configure-compute-advanced/add-module-1.png)

<!--2. In the **Configure and add module** blade, input the following values:  

    |Input share     | Select an input share. The Edge local share is the input share in this case. The module used here moves files from the Edge local share to an Edge share where they are uploaded into the cloud.        |
    |Output share     | Select an output share. The Edge share is the output share in this case.        |
-->

2. В ресурсе Центра Интернета вещей перейдите к **устройству IoT Edge**, а затем выберите устройство IoT Edge.

    ![Переход к устройству IoT Edge в Центре Интернета вещей](./media/azure-stack-edge-deploy-configure-compute-advanced/add-module-2.png)

3. В разделе **Сведения об устройстве** выберите **Задание модулей**.

    ![Ссылка "Задание модулей"](./media/azure-stack-edge-deploy-configure-compute-advanced/add-module-3.png)

4. В разделе **Добавить модули** выполните следующее:

    1. Введите имя, адрес, имя пользователя и пароль для параметров реестра контейнеров для настраиваемого модуля.
    Имя, адрес и перечисленные учетные данные используются для извлечения модулей с соответствующим URL-адресом. Чтобы развернуть этот модуль, в разделе **Модули развертывания** выберите **Модуль IoT Edge**. Этот модуль IoT Edge является контейнером Docker, который можно развернуть на устройстве IoT Edge, связанном с вашим устройством Azure Stack Edge Pro.

        ![Страница "Задание модулей"](./media/azure-stack-edge-deploy-configure-compute-advanced/add-module-4.png) 
 
    2. Укажите настройки для настраиваемого модуля IoT Edge. Введите следующие значения.
     
        |Поле  |Значение  |
        |---------|---------|
        |Имя     | Уникальное имя модуля. Этот модуль является контейнером Docker, который можно развернуть на устройстве IoT Edge, связанном с вашим устройством Azure Stack Edge Pro.        |
        |URI образа     | URI образа для соответствующего образа контейнера для модуля.        |
        |Требуются учетные данные     | Если установлен этот флажок, для получения модулей с соответствующим URL-адресом используются имя пользователя и пароль.        |
    
        В поле **Параметры создания контейнера** введите локальные точки подключения для модулей Edge, которые вы скопировали на предыдущих шагах для общей папки Edge и локальной общей папки Edge.

        > [!IMPORTANT]
        > Пути, используемые здесь, вставляются в контейнер, поэтому они должны соответствовать тому, какие ожидаются функциональные возможности в контейнере. Если вы [создаете пользовательский модуль](azure-stack-edge-create-iot-edge-module.md#update-the-module-with-custom-code), в код, указанный в этом модуле, нужно ввести скопированные пути. Не изменяйте эти пути.
    
        В поле **Параметры создания контейнера** можно вставить следующий пример:
    
        ```
        {
          "HostConfig": 
          {
           "Binds": 
            [
             "/home/hcsshares/mydbesmbedgelocalshare1:/home/input",
             "/home/hcsshares/mydbesmbedgeshare1:/home/output"
            ]
           }
        }
        ```

        Укажите все переменные среды, используемые в вашем модуле. Переменные среды предоставляют дополнительные сведения, которые помогают определить среду, где выполняется модуль.

        ![Поле "Параметры создания контейнера"](./media/azure-stack-edge-deploy-configure-compute-advanced/add-module-5.png) 
 
    4. При необходимости настройте расширенные параметры Edge, а затем нажмите кнопку **Далее**.

        ![Добавление настраиваемого модуля (2)](./media/azure-stack-edge-deploy-configure-compute-advanced/add-module-6.png)
 
5. В разделе **Укажите маршруты** настройте маршруты между модулями.  
   
   ![Указание маршрутов](./media/azure-stack-edge-deploy-configure-compute-advanced/add-module-7.png)

    *Маршрут* можно заменить следующей строкой маршрута, скопированной ранее. В этом случае введите имя локального общего ресурса, который будет отправлять данные в облачный общий ресурс. Замените `modulename` именем модуля. Выберите **Далее**.
        
    ```
    "route&quot;: &quot;FROM /* WHERE topic = 'mydbesmbedgelocalshare1' INTO BrokeredEndpoint(\"/modules/filemove/inputs/input1\")"
    ```

    ![Раздел "Укажите маршруты"](./media/azure-stack-edge-deploy-configure-compute-advanced/add-module-8.png)

6. В разделе **Проверка развертывания** просмотрите все параметры, а затем выберите **Отправить**, чтобы отправить модуль для развертывания.

   ![Страница "Задание модулей" (2)](./media/azure-stack-edge-deploy-configure-compute-advanced/add-module-9.png)
 
    Это действие запускает развертывание модуля. После завершения развертывания **состояние среды выполнения** модуля изменится на **Запущен**.

    ![Добавление настраиваемого модуля (3)](./media/azure-stack-edge-deploy-configure-compute-advanced/add-module-10.png)

## <a name="verify-data-transform-transfer"></a>Проверка преобразования и передачи данных

Последний шаг — убедиться, что модуль подключен и работает как ожидалось. Состояние выполнения модуля должно быть "Работает" для вашего устройства IoT Edge в ресурсе Центра Интернета вещей.

Для проверки преобразования и передачи данных в Azure сделайте следующее.
 
1. С помощью проводника подключитесь к локальным и облачным общим папкам Edge, созданным ранее.

   ![Проверка преобразования данных](./media/azure-stack-edge-deploy-configure-compute-advanced/verify-data-2.png)
 
1. Добавьте данные в локальную общую папку.

   ![Проверка преобразования данных (2)](./media/azure-stack-edge-deploy-configure-compute-advanced/verify-data-3.png)
 
    Данные переносятся в облачную общую папку.

    ![Проверка преобразования данных (3)](./media/azure-stack-edge-deploy-configure-compute-advanced/verify-data-4.png)  

    Затем данные переносятся из облачного ресурса в учетную запись хранения. Для просмотра данных перейдите в свою учетную запись хранения и выберите **Обозреватель службы хранилища Azure**. Вы можете просмотреть отправленные данные в своей учетной записи хранения.

    ![Проверка преобразования данных (4)](./media/azure-stack-edge-deploy-configure-compute-advanced/verify-data-5.png)
 
Вы завершили процесс проверки.

## <a name="next-steps"></a>Дальнейшие действия

В этом руководстве вы узнали, как выполнять следующие задачи:

> [!div class="checklist"]
> * настройка вычислений;
> * добавление общих папок;
> * Добавление триггера
> * Добавление модуля вычислений.
> * Проверка преобразования и передачи данных

Сведения об администрировании устройства Azure Stack Edge Pro см. в следующей статье:

> [!div class="nextstepaction"]
> [Использование локального пользовательского веб-интерфейса для администрирования Azure Stack Edge Pro](azure-stack-edge-manage-access-power-connectivity-mode.md)
