---
title: Создание образов виртуальных машин из обобщенного образа виртуального жесткого диска Windows для устройства Azure Stack ребра Pro GPU
description: Описывает, как образы виртуальных машин из обобщенных образов, начиная с VHD или VHDX с Windows. Используйте этот универсальный образ для создания образов виртуальных машин, которые можно использовать с виртуальными машинами, развернутыми на устройстве с Azure Stack ребра Pro GPU.
services: databox
author: alkohli
ms.service: databox
ms.subservice: edge
ms.topic: how-to
ms.date: 03/18/2021
ms.author: alkohli
ms.openlocfilehash: 978099accd57d15c750a27f77b2e220f569a2dd0
ms.sourcegitcommit: ac035293291c3d2962cee270b33fca3628432fac
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/24/2021
ms.locfileid: "104962610"
---
# <a name="use-generalized-image-from-windows-vhd-to-create-a-vm-image-for-your-azure-stack-edge-pro-device"></a>Использование обобщенного образа виртуального жесткого диска Windows для создания образа виртуальной машины для устройства Azure Stack ребра Pro

[!INCLUDE [applies-to-GPU-and-pro-r-and-mini-r-skus](../../includes/azure-stack-edge-applies-to-gpu-pro-r-mini-r-sku.md)]

Для развертывания виртуальных машин на устройстве Azure Stack Edge Pro требуется возможность создавать пользовательские образы виртуальных машин, которые можно использовать для создания виртуальных машин. В этой статье описываются шаги, необходимые для подготовки VHD или VHDX Windows к созданию обобщенного образа. Затем этот обобщенный образ используется для создания образа виртуальной машины для устройства Azure Stack ребра Pro. 

## <a name="about-preparing-windows-vhd"></a>О подготовке виртуального жесткого диска Windows

VHD или VHDX Windows можно использовать для создания *обобщенного* образа или *специализированного* образа. В следующей таблице приведены основные различия между *обобщенным* и *специализированным* образами.


|Тип образа  |Универсальный  |Специализированный  |
|---------|---------|---------|
|Целевой объект     |Развернуто в любой системе         | Нацелен на определенную систему        |
|Настройка после загрузки     | Программа установки необходима при первой загрузке виртуальной машины.          | Установка не требуется. <br> Платформа включает виртуальную машину.        |
|Конфигурация     |Требуются параметры имени узла, администратора и других виртуальных машин.         |Предварительно настроено.         |
|Используется при     |Создание нескольких новых виртуальных машин из одного образа.         |Перенос определенного компьютера или восстановление виртуальной машины из предыдущей резервной копии.         |


В этой статье описаны шаги, необходимые для развертывания из обобщенного образа. Сведения о развертывании из специализированного образа см. в статье [использование специализированного виртуального жесткого диска Windows](azure-stack-edge-placeholder.md) для устройства.

> [!IMPORTANT]
> Эта процедура не охватывает случаи, когда исходный виртуальный жесткий диск настроен с настраиваемыми конфигурациями и параметрами. Например, для подготовки виртуального жесткого диска, содержащего настраиваемые правила брандмауэра или параметры прокси-сервера, могут потребоваться дополнительные действия. Дополнительные сведения об этих дополнительных действиях см. в статье [Подготовка виртуального жесткого диска Windows к отправке в Azure — виртуальные машины Azure](../virtual-machines/windows/prepare-for-upload-vhd-image.md).


## <a name="vm-image-workflow"></a>Рабочий процесс создания образа виртуальной машины

Высокоуровневый рабочий процесс подготовки виртуального жесткого диска Windows для использования в качестве обобщенного образа включает следующие шаги.

1. Преобразуйте исходный VHD или VHDX в VHD фиксированного размера.
1. Создайте виртуальную машину в Hyper-V с помощью фиксированного виртуального жесткого диска.
1. Подключитесь к виртуальной машине Hyper-V.
1. Подготовьте виртуальный жесткий диск к использованию с помощью служебной программы *Sysprep* . 
1. Скопируйте обобщенный образ в хранилище BLOB-объектов.
1. Используйте обобщенный образ для развертывания виртуальных машин на устройстве. Дополнительные сведения см. в статье [развертывание виртуальной машины с помощью портал Azure](azure-stack-edge-gpu-deploy-virtual-machine-portal.md) или [развертывание виртуальной машины с помощью PowerShell](azure-stack-edge-gpu-deploy-virtual-machine-powershell.md).


## <a name="prerequisites"></a>Предварительные условия

Перед подготовкой виртуального жесткого диска Windows для использования в качестве обобщенного образа на Azure Stack пограничной системы убедитесь в том, что:

- У вас есть VHD или VHDX, содержащий поддерживаемую версию Windows. См. раздел [Поддерживаемые гостевые операционные системы]() для Azure Stack пограничных Pro. 
- У вас есть доступ к клиенту Windows с установленным диспетчером Hyper-V. 
- У вас есть доступ к учетной записи хранилища BLOB-объектов Azure для сохранения виртуального жесткого диска после его подготовки.

## <a name="prepare-a-generalized-windows-image-from-vhd"></a>Подготовка обобщенного образа Windows из виртуального жесткого диска

## <a name="convert-to-a-fixed-vhd"></a>Преобразовать в фиксированный виртуальный жесткий диск 

Для создания образов виртуальных машин для вашего устройства требуются виртуальные жесткие диски фиксированного размера. Вам потребуется преобразовать исходный VHD или VHDX-файл Windows в фиксированный виртуальный жесткий диск. Выполните указанные ниже действия.

1. Откройте диспетчер Hyper-V в клиентской системе. Перейдите к разделу **Изменение диска**.

    ![Открыть диспетчер Hyper-V](./media/azure-stack-edge-gpu-prepare-windows-vhd-generalized-image/convert-fixed-vhd-1.png)

1. На странице **перед началом** нажмите кнопку **Далее>**.

1. На странице **Поиск виртуального жесткого диска** перейдите к расположению исходного VHD-файла Windows или VHDX, который вы хотите преобразовать. Нажмите кнопку **далее>**.

    ![Страница «определение виртуального жесткого диска»](./media/azure-stack-edge-gpu-prepare-windows-vhd-generalized-image/convert-fixed-vhd-2.png)

1. На странице **Выбор действия** выберите **преобразовать** и нажмите кнопку **Далее>**.

    ![Страница выбора действия](./media/azure-stack-edge-gpu-prepare-windows-vhd-generalized-image/convert-fixed-vhd-3.png)

1. На странице **Выбор формата диска** выберите формат **VHD** , а затем нажмите кнопку **Далее>**.

   ![Страница «Выбор формата диска»](./media/azure-stack-edge-gpu-prepare-windows-vhd-generalized-image/convert-fixed-vhd-4.png)


1. На странице **Выбор типа диска** выберите **фиксированный размер** и нажмите кнопку **Далее>**.

   ![Страница «Выбор типа диска»](./media/azure-stack-edge-gpu-prepare-windows-vhd-generalized-image/convert-fixed-vhd-5.png)


1. На странице **Настройка диска** перейдите к расположению и укажите имя диска VHD фиксированного размера. Нажмите кнопку **далее>**.

   ![Страница настройки диска](./media/azure-stack-edge-gpu-prepare-windows-vhd-generalized-image/convert-fixed-vhd-6.png)


1. Проверьте параметры и выберите **Готово**. Преобразование VHD или VHDX занимает несколько минут. Время для преобразования зависит от размера исходного диска. 

<!--
1. Run PowerShell on your Windows client.
1. Run the following command:

    ```powershell
    Convert-VHD -Path <source VHD path> -DestinationPath <destination-path.vhd> -VHDType Fixed 
    ```
-->
Этот фиксированный виртуальный жесткий диск будет использоваться для всех последующих шагов в этой статье.


## <a name="create-a-hyper-v-vm-from-fixed-vhd"></a>Создание виртуальной машины Hyper-V из фиксированного виртуального жесткого диска

1. В **диспетчере Hyper-V** на панели область щелкните правой кнопкой мыши узел системы, чтобы открыть контекстное меню, и выберите пункт **создать**  >  **виртуальную машину**.

    ![Выбор новой виртуальной машины в области "область"](./media/azure-stack-edge-gpu-prepare-windows-vhd-generalized-image/create-virtual-machine-1.png)

1. На странице **перед началом** работы мастера создания виртуальной машины нажмите кнопку **Далее**.

1. На странице **Указание имени и расположения** укажите **имя** и **Расположение** виртуальной машины. Выберите **Далее**.

    ![Укажите имя и расположение виртуальной машины](./media/azure-stack-edge-gpu-prepare-windows-vhd-generalized-image/create-virtual-machine-2.png)

1. На странице **Указание поколения** выберите **поколение 1** для типа образа VHD-устройства, а затем нажмите кнопку **Далее**.    

    ![Указание поколения](./media/azure-stack-edge-gpu-prepare-windows-vhd-generalized-image/create-virtual-machine-3.png)

1. Назначьте требуемые конфигурации памяти и сети.

1. На странице **Подключение виртуального жесткого диска** выберите **использовать существующий виртуальный жесткий диск**, укажите расположение фиксированного виртуального жесткого диска Windows, созданного ранее, а затем нажмите кнопку **Далее**.

    ![Страница "Подключение виртуального жесткого диска"](./media/azure-stack-edge-gpu-prepare-windows-vhd-generalized-image/create-virtual-machine-4.png)

1. Просмотрите **сводку** и нажмите кнопку **Готово** , чтобы создать виртуальную машину.

Создание виртуальной машины занимает несколько минут.
     

## <a name="connect-to-the-hyper-v-vm"></a>Подключение к виртуальной машине Hyper-V

Виртуальная машина отобразится в списке виртуальных машин в клиентской системе. 


1. Выберите виртуальную машину, а затем щелкните ее правой кнопкой мыши и выберите **Пуск**. 

    ![Выберите виртуальную машину и запустите ее](./media/azure-stack-edge-gpu-prepare-windows-vhd-generalized-image/connect-virtual-machine-2.png)

2. На виртуальной машине отобразится значение **работает**. Выберите виртуальную машину, щелкните ее правой кнопкой мыши и выберите **подключить**.

    ![Подключение к виртуальной машине](./media/azure-stack-edge-gpu-prepare-windows-vhd-generalized-image/connect-virtual-machine-4.png)

После подключения к виртуальной машине завершите работу мастера настройки компьютера и войдите на ВИРТУАЛЬную машину.


## <a name="generalize-the-vhd"></a>Подготовка виртуального жесткого диска к использованию  

Используйте служебную программу *Sysprep* для подготовки виртуального жесткого диска к использованию. 

1. В виртуальной машине откройте командную строку.
1. Выполните следующую команду, чтобы подготовить виртуальный жесткий диск к использованию. 

    ```
    c:\windows\system32\sysprep\sysprep.exe /oobe /generalize /shutdown /mode:vm
    ```
    Дополнительные сведения см. в статье  [Обзор Sysprep (подготовка системы)](/windows-hardware/manufacture/desktop/sysprep--system-preparation--overview).
1.  После выполнения команды виртуальная машина завершит работу. **Не перезапускайте виртуальную машину**.

## <a name="upload-the-vhd-to-azure-blob-storage"></a>Отправка виртуального жесткого диска в хранилище BLOB-объектов Azure

Теперь виртуальный жесткий диск можно использовать для создания обобщенного образа на Azure Stack границе. 

1. Отправьте виртуальный жесткий диск в хранилище BLOB-объектов Azure. Подробные инструкции см. в разделе [Отправка виртуального жесткого диска с помощью обозреватель службы хранилища Azure](../devtest-labs/devtest-lab-upload-vhd-using-storage-explorer.md).
1. После завершения передачи можно использовать переданный образ для создания образов виртуальных машин и виртуальных машин. 

<!-- this should be added to deploy VM articles - If you experience any issues creating VMs from your new image, you can use VM console access to help troubleshoot. For information on console access, see [link].-->



## <a name="next-steps"></a>Дальнейшие действия

В зависимости от природы развертывания можно выбрать одну из следующих процедур.

- [Развертывание виртуальной машины из обобщенного образа с помощью портал Azure](azure-stack-edge-gpu-deploy-virtual-machine-portal.md)
- [Развертывание виртуальной машины из обобщенного образа с помощью Azure PowerShell](azure-stack-edge-gpu-deploy-virtual-machine-powershell.md)  
