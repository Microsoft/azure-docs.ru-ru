---
title: Руководство по миграции Azure Stack Edge Pro с ППВМ в физическое устройство с GPU
description: В этом кратком руководстве содержатся инструкции по переносу рабочих нагрузок с устройства Azure Stack Edge Pro с ППВМ на устройство Azure Stack Edge Pro с GPU.
services: databox
author: alkohli
ms.service: databox
ms.subservice: edge
ms.topic: tutorial
ms.date: 03/11/2021
ms.author: alkohli
ms.openlocfilehash: 430e34a1ca631be00ef46170affd4b56c79894a9
ms.sourcegitcommit: 32e0fedb80b5a5ed0d2336cea18c3ec3b5015ca1
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/30/2021
ms.locfileid: "105566410"
---
# <a name="migrate-workloads-from-an-azure-stack-edge-pro-fpga-to-an-azure-stack-edge-pro-gpu"></a>Миграция рабочих нагрузок с Azure Stack Edge Pro с ППВМ на Azure Stack Edge Pro с GPU

В этой статье содержатся сведения о переносе рабочих нагрузок с устройства Azure Stack Edge Pro с ППВМ на устройство Azure Stack Edge Pro с GPU. Процесс миграции начинается со сравнения двух устройств, плана миграции и проверки аспектов миграции. Процедура миграции содержит подробные инструкции, которые завершаются проверкой и очисткой устройств.

[!INCLUDE [Azure Stack Edge Pro FPGA end-of-life](../../includes/azure-stack-edge-fpga-eol.md)]

## <a name="about-migration"></a>Общие сведения о миграции

Миграция — это перемещение рабочих нагрузок и данных приложений из одного места хранения в другое. В результате создается точная копия текущих данных организации и перемещается с одного устройства хранения на другое, желательно без нарушения работы или отключения активных приложений, а затем все операции ввода-вывода перенаправляются на новое устройство. 

В этом руководстве по миграции представлены пошаговые инструкции по переносу данных с устройства Azure Stack Edge Pro с ППВМ на устройство Azure Stack Edge Pro с GPU. Этот документ предназначен для специалистов в области информационных технологий (ИТ) и информационных работников, ответственных за эксплуатацию, развертывание устройств Azure Stack Edge и управление ими в центре обработки данных.

В этой статье устройство Azure Stack Edge Pro с ППВМ будет называться *исходным* устройством, а устройство Azure Stack Edge Pro с GPU — *целевым*. 

## <a name="comparison-summary"></a>Сводка сравнения

В этом разделе приведена сводка сравнения возможностей устройств Azure Stack Edge Pro с GPU и Azure Stack Edge Pro с ППВМ. Оборудование на исходном и целевом устройствах является практически идентичным и может отличаться только картой аппаратного ускорения и емкостью хранилища.<!--Please verify: These components MAY, but need not necessarily, differ?-->

|    Функция  | Azure Stack Edge Pro с GPU (целевое устройство)  | Azure Stack Edge Pro с ППВМ (исходное устройство)|
|----------------|-----------------------|------------------------|
| Оборудование       | Аппаратное ускорение: 1 или 2 GPU для NVIDIA T4 <br> Ресурсы вычисления, памяти, сетевого интерфейса, блока питания и кабелей питания идентичны аналогичным характеристикам для устройства на основе ППВМ.  | Аппаратное ускорение: ППВМ Intel Arria 10 <br> Ресурсы вычислений, памяти, сетевого интерфейса, блока питания и кабелей питания идентичны аналогичным характеристикам для устройства с GPU.          |
| Доступное хранилище | 4,19 ТБ <br> После резервирования емкости для обеспечения устойчивости четности и внутреннего использования | 12,5 ТБ <br> После резервирования емкости для внутреннего использования |
| Безопасность       | Сертификаты |                                                     |
| Рабочие нагрузки      | Рабочие нагрузки IoT Edge <br> Рабочие нагрузки виртуальных машин <br> Рабочие нагрузки Kubernetes| Рабочие нагрузки IoT Edge |
| Цены        | [Цены](https://azure.microsoft.com/pricing/details/azure-stack/edge/) | [Цены](https://azure.microsoft.com/pricing/details/azure-stack/edge/)|

## <a name="migration-plan"></a>План миграции

Чтобы создать план миграции, примите во внимание следующие сведения.

- Разработайте расписание миграции. 
- При переносе данных вы можете столкнутся с простоем. Поэтому мы рекомендуем планировать миграцию во время периода обслуживания с простоем, поскольку этот процесс нарушает работу. Вы будете настраивать и восстанавливать конфигурации во время такого простоя, как описано далее в этом документе.
- Узнайте общую длительность простоя и сообщите о ней всем заинтересованным лицам.
- Определите локальные данные, которые необходимо перенести с исходного устройства. На всякий случай убедитесь, что у вас есть актуальные резервные копии данных в существующем хранилище. 


## <a name="migration-considerations"></a>Вопросы миграции 

Прежде чем продолжить миграцию, ознакомьтесь со следующими сведениями. 

- Устройство Azure Stack Edge Pro с GPU невозможно активировать с помощью ресурса Azure Stack Edge Pro с ППВМ. Для устройства Azure Stack Edge Pro с GPU следует создать новый ресурс, как описано в разделе [Создание нового ресурса](azure-stack-edge-gpu-deploy-prep.md#create-a-new-resource).
- Модели Машинного обучения, развернутые на исходном устройстве с ППВМ, нужно будет изменить для целевого устройства с GPU. Чтобы получить помощь при работе с моделями, обратитесь в службу поддержки Майкрософт. Пользовательские модели, развернутые на исходном устройстве и не использующие ППВМ (только ЦП), должны работать на целевом устройстве (используя ЦП) в исходном виде.
- Возможно, вам нужно будет немного изменить модули IoT Edge, развернутые на исходном устройстве, чтобы успешно развернуть их на целевом устройстве. 
- Исходное устройство поддерживает протоколы NFS 3.0 и 4.1. Когда же целевое устройство поддерживает только протокол NFS 3.0.
- Исходное устройство поддерживает протоколы SMB и NFS. Целевое устройство поддерживает управление хранилищем по протоколу REST, используя для общих ресурсов учетные записи хранения в дополнение к протоколам SMB и NFS.
- Доступ к общей папке на исходном устройстве осуществляется через IP-адрес, а на целевом устройстве — через имя устройства.

## <a name="migration-steps-at-a-glance"></a>Краткий обзор шагов по миграции

В этой таблице приведены общие сведения о потоке миграции с описанием шагов, которые позволят выполнить этот процесс, а также расположением для их осуществления.

| На этапе | Необходимо выполнить| На устройстве |
|---------------|-------------|----------------|
| Подготовка исходного устройства*       | 1. Запись данных конфигурации <br>2. Резервное копирование данных общей папки <br>3. Подготовка рабочих нагрузок IoT Edge| Исходное устройство  |
| Подготовка целевого устройства*       |1. Создание нового заказа <br>2. Настройка и активация| Целевое устройство  |
| Перенос данных       | 1. Перенос данных из общих папок <br>2. Повторное развертывание рабочих нагрузок IoT Edge| Целевое устройство  |
| Проверка данных            |Проверка перенесенных данных |Целевое устройство  |
| Очистка, возврат              |Удаление данных и возврат| Исходное устройство  |

**Исходное и целевое устройства можно подготавливать параллельно.*

## <a name="prepare-source-device"></a>Подготовка исходного устройства

На шаге подготовки вам нужно определить облачные общие папки Edge, локальные общие папки Edge и модули IoT Edge, развернутые на устройстве. 

### <a name="1-record-configuration-data"></a>1. Запись данных конфигурации

Выполните эти действия на исходном устройстве с помощью локального пользовательского интерфейса.

Запишите данные конфигурации на *исходном* устройстве. Ознакомьтесь с [контрольным списком действий при развертывании](azure-stack-edge-gpu-deploy-checklist.md), чтобы упростить запись конфигурации устройства. Во время миграции эти сведения о конфигурации будут использоваться для настройки нового целевого устройства. 

### <a name="2-back-up-share-data"></a>2. Резервное копирование данных общей папки

Различают следующие типы данных устройства:

- Данные в облачных общих папках Edge
- Данные в локальных общих папках

#### <a name="data-in-edge-cloud-shares"></a>Данные в облачных общих папках Edge

Данные уровня облачных общих папок Edge на устройстве в Azure. Выполните эти действия на *исходном* устройстве с помощью портала Azure. 

- Создайте список всех облачных общих папок Edge и пользователей на исходном устройстве.
- Создайте список всех графиков пропускной способности. Вы будете повторно создавать такие графики пропускной способности на целевом устройстве.
- Настройте графики пропускной способности на устройстве с учетом доступной пропускной способности сети, чтобы максимизировать объем перемещаемых в облако данных. Это сократит объем локальных данных на устройстве.
- Убедитесь, что ресурсы полностью распределены по уровням в облаке. В этом можно убедиться, проверив состояние общей папки на портале Azure.  

#### <a name="data-in-edge-local-shares"></a>Данные в локальных общих папках Edge

Данные из локальной общей папки Edge остаются на устройстве. Выполните эти действия на *исходном* устройстве с помощью портала Azure. 

- Создайте список локальных общих папок Edge на устройстве.
- Так как эта миграция данных является разовой, создайте копию данных локальной общей папки Edge на другом локальном сервере. Для копирования данных можно использовать средства копирования, такие как `robocopy` (SMB) или `rsync` (NFS). Возможно, вы уже развернули стороннее решение для защиты данных, чтобы создать резервные копии данных в локальных общих папках. Следующие решения сторонних производителей поддерживаются для устройств Azure Stack Edge Pro с ППВМ:

    | Стороннее программное обеспечение           | Ссылка на решение                               |
    |--------------------------------|---------------------------------------------------------|
    | Cohesity                       | [https://www.cohesity.com/solution/cloud/azure/](https://www.cohesity.com/solution/cloud/azure/) <br> Чтобы получить дополнительные сведения, обратитесь в службу поддержки Cohesity.          |
    | Commvault                      | [https://www.commvault.com/azure](https://www.commvault.com/azure) <br> Чтобы получить дополнительные сведения, обратитесь в службу поддержки Commvault.          |
    | Veritas                        | [http://veritas.com/azure](http://veritas.com/azure) <br> Чтобы получить дополнительные сведения, обратитесь в службу поддержки Veritas.   |
    | Veeam                          | [https://www.veeam.com/kb4041](https://www.veeam.com/kb4041) <br> Чтобы получить дополнительные сведения, обратитесь в службу поддержки Veeam. |


### <a name="3-prepare-iot-edge-workloads"></a>3. Подготовка рабочих нагрузок IoT Edge

- Если вы развернули модули IoT Edge и используете ускорение на основе ППВМ, возможно, для запуска на устройстве с GPU такие модули потребуется изменить. Следуйте инструкциям в статье [Изменение модулей IoT Edge](azure-stack-edge-gpu-modify-fpga-modules-gpu.md). 

<!--- If you have deployed IoT Edge workloads, the configuration data is shared on a share on the device. Back up the data in these shares.-->


## <a name="prepare-target-device"></a>Подготовка целевого устройства

### <a name="1-create-new-order"></a>1. Создание заказа

Создайте заказ (и ресурс) для *целевого* устройства. Целевое устройство должно быть активировано на основе ресурса GPU, а не ресурса ППВМ.

Чтобы разместить заказ, выполните действия, приведенные в разделе [Создание ресурса Azure Stack Edge](azure-stack-edge-gpu-deploy-prep.md#create-a-new-resource) на портале Azure.


### <a name="2-set-up-activate"></a>2. Настройка и активация

Настройте и активируйте *целевое устройство* на основе ресурса, созданного ранее. 

Выполните следующие действия, чтобы настроить *целевое устройство* с помощью портала Azure:

1. Соберите сведения, необходимые при выполнении требований, приведенных в [контрольном списке действий при развертывании](azure-stack-edge-gpu-deploy-checklist.md). Вы также можете использовать сведения, сохраненные из конфигурации исходного устройства. 
1. Выполните [распаковку](azure-stack-edge-gpu-deploy-install.md#unpack-the-device), [монтаж в стойку устройства](azure-stack-edge-gpu-deploy-install.md#rack-the-device) и [подключение кабелей к устройству](azure-stack-edge-gpu-deploy-install.md#cable-the-device). 
1. [Подключитесь к локальному пользовательскому интерфейсу устройства](azure-stack-edge-gpu-deploy-connect.md).
1. Настройте сеть, используя набор IP-адресов (если используется статический IP-адрес), которые отличаются от IP-адресов, использованных для старого устройства. Узнайте, как [настроить параметры сети](azure-stack-edge-gpu-deploy-configure-network-compute-web-proxy.md).
1. Присвойте устройству имя, аналогичное имени старого устройства, и укажите домен DNS. Узнайте, как [настроить параметры устройства](azure-stack-edge-gpu-deploy-set-up-device-update-time.md).
1. Настройте сертификаты на новом устройстве. Узнайте, как [настроить сертификаты](azure-stack-edge-gpu-deploy-configure-certificates.md).
1. Получите ключ активации на портале Azure и активируйте новое устройство. Узнайте, как [активировать устройство](azure-stack-edge-gpu-deploy-activate.md).

Теперь вы можете восстановить данные общей папки и развернуть рабочие нагрузки, которые выполнялись на старом устройстве.

## <a name="migrate-data"></a>Перенос данных

Теперь вам нужно скопировать данные с исходного устройства в облачные и локальные общие папки Edge на *целевом* устройстве.

### <a name="1-from-edge-cloud-shares"></a>1. Из облачных общих папок Edge

Выполните приведенные ниже действия, чтобы синхронизировать данные в облачных общих папках Edge на целевом устройстве.

1. [Добавьте общие папки](azure-stack-edge-j-series-manage-shares.md#add-a-share). Имена таких папок должны соответствовать именам общих папок, созданных на исходном устройстве. При создании общих папок в поле **Выбрать контейнер BLOB-объектов** укажите **Использовать существующий** и выберите контейнер, который использовался для предыдущего устройства.
1. [Добавьте пользователей](azure-stack-edge-j-series-manage-users.md#add-a-user), которые имели доступ к предыдущему устройству.
1. [Обновите данные общей папки](azure-stack-edge-j-series-manage-shares.md#refresh-shares) с помощью Azure. При обновлении общей папки все облачные данные из существующего контейнера будут переданы в общие папки.
1. Повторно создайте графики пропускной способности, которые будут связаны с вашими общими папками. Подробные инструкции см. в разделе [Добавление графика пропускной способности](azure-stack-edge-j-series-manage-bandwidth-schedules.md#add-a-schedule).


### <a name="2-from-edge-local-shares"></a>2. Из локальной общей папки Edge

Возможно, вы уже развернули стороннее решение для резервного копирования, чтобы защитить данные локальных общих папок для рабочих нагрузок Интернета вещей. Теперь нам понадобится восстановить эти данные.

Завершив настройку устройства, которое заменяет предыдущее устройство, настройте его таким образом, чтобы оно использовалось как локальное хранилище. 

Чтобы восстановить данные из локальных общих папок, выполните следующие действия.

1. [Настройте устройство, чтобы оно выполняло вычисления](azure-stack-edge-gpu-deploy-configure-compute.md).
1. Добавьте все локальные общие папки на целевое устройство. Подробные инструкции см. в разделе [Добавление локальной общей папки](azure-stack-edge-gpu-manage-shares.md#add-a-local-share).
1. При обращении к общим ресурсам SMB на исходном устройстве будут использоваться IP-адреса, когда же на целевом устройстве — имя устройства. См. раздел [Подключение к общей папке SMB с устройства Azure Stack Edge Pro с GPU](./azure-stack-edge-gpu-deploy-add-shares.md#connect-to-an-smb-share). Чтобы подключиться к общим папкам NFS с целевого устройства, необходимо использовать новые IP-адреса, связанные с устройством. См. раздел [Подключение к общей папке NFS с устройства Azure Stack Edge Pro с GPU](./azure-stack-edge-gpu-deploy-add-shares.md#connect-to-an-nfs-share). 

    Если вы копировали данные из общих папок на промежуточный сервер по протоколу SMB или NFS, теперь вы можете скопировать эти данные с промежуточного сервера в общие папки на целевом устройстве. Если исходное и целевое устройства *имеют подключение к Интернету*, данные можно скопировать напрямую.

    Если вы использовали стороннее программное обеспечение для резервного копирования данных в локальных общих папках, теперь вам нужно выполнить процедуру восстановления в используемом решении для защиты данных. См. ссылки в следующей таблице.

    | Стороннее программное обеспечение           | Ссылка на решение                               |
    |--------------------------------|---------------------------------------------------------|
    | Cohesity                       | [https://www.cohesity.com/solution/cloud/azure/](https://www.cohesity.com/solution/cloud/azure/) <br> Чтобы получить дополнительные сведения, обратитесь в службу поддержки Cohesity.          |
    | Commvault                      | [https://www.commvault.com/azure](https://www.commvault.com/azure) <br> Чтобы получить дополнительные сведения, обратитесь в службу поддержки Commvault. |
    | Veritas                        | [http://veritas.com/azure](http://veritas.com/azure) <br> Чтобы получить дополнительные сведения, обратитесь в службу поддержки Veritas.   |
    | Veeam                          | [https://www.veeam.com/kb4041](https://www.veeam.com/kb4041) <br> Чтобы получить дополнительные сведения, обратитесь в службу поддержки Veeam. |

### <a name="3-redeploy-iot-edge-workloads"></a>3. Повторное развертывание рабочих нагрузок IoT Edge

Подготовив модули IoT Edge, вам понадобится развернуть на целевом устройстве рабочие нагрузки IoT Edge. Если при развертывании модулей IoT Edge возникают ошибки, см. следующие статьи:

- [Распространенные проблемы в Azure IoT Edge и их решения.](../iot-edge/troubleshoot-common-errors.md) 
- [Ошибки среды выполнения IoT Edge.](azure-stack-edge-gpu-troubleshoot.md#troubleshoot-iot-edge-errors)

## <a name="verify-data"></a>Проверка данных

Выполнив миграцию, убедитесь, что на целевое устройство перенесены все данные, и что на нем развернуты рабочие нагрузки.

## <a name="erase-data-return"></a>Удаление данных, возврат

Завершив миграцию данных, удалите локальные данные и возвратите исходное устройство. Выполните действия, описанные в статье [Возврат устройства Azure Stack Edge Pro](azure-stack-edge-return-device.md).


## <a name="next-steps"></a>Дальнейшие действия

[Узнайте, как развертывать рабочие нагрузки IoT Edge на устройстве Azure Stack Edge Pro с GPU](azure-stack-edge-gpu-deploy-compute-module-simple.md)