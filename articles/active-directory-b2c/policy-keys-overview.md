---
title: Общие сведения о ключах политики — Azure Active Directory B2C
description: Сведения о типах ключей политики шифрования, которые можно использовать в Azure Active Directory B2C для подписывания и проверки маркеров, секретов клиента, сертификатов и паролей.
services: active-directory-b2c
author: msmimart
manager: celestedg
ms.service: active-directory
ms.workload: identity
ms.topic: conceptual
ms.date: 09/08/2020
ms.author: mimart
ms.subservice: B2C
ms.openlocfilehash: 30348d7ca12ded2d1f4b0522a7cabeadf0553a07
ms.sourcegitcommit: 867cb1b7a1f3a1f0b427282c648d411d0ca4f81f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "94953361"
---
# <a name="overview-of-policy-keys-in-azure-active-directory-b2c"></a>Общие сведения о ключах политики в Azure Active Directory B2C

Azure Active Directory B2C (Azure AD B2C) хранит секреты и сертификаты в виде ключей политики для установления отношений доверия со службами, с которыми он интегрируется. Эти отношения доверия состоят из следующих:

- Внешние поставщики удостоверений
- Подключение со [службами REST API Services](restful-technical-profile.md)
- Подписывание и шифрование маркеров

 В этой статье рассматриваются необходимые сведения о ключах политики, используемых Azure AD B2C.

> [!NOTE]
> Сейчас Настройка ключей политики ограничена только [пользовательскими политиками](./custom-policy-get-started.md) .

Вы можете настроить секреты и сертификаты для установления отношений доверия между службами в портал Azure в меню **ключи политики** . Ключи могут быть симметричными или асимметричными. *Симметричное* шифрование или шифрование с закрытым ключом — это место, где общий секрет используется для шифрования и расшифровки данных. *Асимметричная* криптография или шифрование с открытым ключом — это система шифрования, которая использует пары ключей, состоящие из открытых ключей, которые являются общими для приложения проверяющей стороны и закрытых ключей, известных только для Azure AD B2C.

## <a name="policy-keyset-and-keys"></a>Набор ключей и ключи политики

Ресурс верхнего уровня для ключей политики в Azure AD B2C является контейнером **набора ключей** . Каждый набор ключей содержит по крайней мере один **ключ**. Ключ имеет следующие атрибуты:

| Атрибут |  Обязательно | Remarks |
| --- | --- |--- |
| `use` | Да | Использование: определяет предполагаемое использование открытого ключа. Шифрование данных `enc` или проверка подписи данных `sig` .|
| `nbf`| Нет | Дата и время активации. |
| `exp`| Нет | Дата и время окончания срока действия. |

Рекомендуется установить ключевые значения активации и истечения срока действия в соответствии со стандартами PKI. Может потребоваться периодически менять эти сертификаты в целях безопасности или политик. Например, у вас может быть политика для смены всех сертификатов каждый год.

Чтобы создать ключ, можно выбрать один из следующих методов.

- Создание секрета **вручную** с помощью определяемой вами строки. Секретный ключ является симметричным. Можно задать даты активации и истечения срока действия.
- **Generated** — автоматическое создание ключа. Можно задать даты активации и истечения срока действия. Существует два варианта.
  - **Secret** — создает симметричный ключ.
  - **RSA** — создает пару ключей (асимметричные ключи).
- **Отправить** — отправить сертификат или ключ PKCS12. Сертификат должен содержать закрытые и открытые ключи (асимметричные ключи).

## <a name="key-rollover"></a>Смена ключей

В целях безопасности Azure AD B2C могут периодически переключаться на ключи или немедленно в случае аварии. Любое приложение, поставщик удостоверений или REST API, которое интегрируется с Azure AD B2C, должно быть подготовлено к обработке события смены ключа, независимо от того, насколько часто это может произойти. В противном случае, если приложение или Azure AD B2C пытается использовать ключ с истекшим сроком действия для выполнения криптографической операции, запрос на вход завершится ошибкой.

Если набор ключей Azure AD B2C имеет несколько ключей, в любой момент времени активен только один из них в зависимости от следующих условий.

- Ключ активации основан на **дате активации**.
  - Ключи сортируются по дате активации в возрастающем порядке. Ключи с датами активации далее в будущем будут отображаться ниже в списке. Ключи без даты активации находятся в нижней части списка.
  - Если текущая дата и время больше даты активации ключа, Azure AD B2C активирует ключ и прекращает использовать предшествующий активный ключ.
- По истечении времени истечения срока действия текущего ключа, если контейнер ключей содержит новый ключ с допустимым временем *не до и до* *истечения срока действия* , новый ключ станет активным автоматически.
- По истечении времени истечения срока действия текущего ключа, *Если контейнер ключей не содержит* новый ключ с допустимым временем *не до и до* *истечения срока действия* , Azure AD B2C не сможет использовать ключ с истекшим сроком действия. Azure AD B2C выдаст сообщение об ошибке в зависимом компоненте пользовательской политики. Чтобы избежать этой проблемы, можно создать ключ по умолчанию без активации и даты истечения срока действия в качестве средства обеспечения безопасности сети.
- Конечная точка ключа (URI JWKS) стандартной конечной точки конфигурации Connect OpenID Connect соответствует ключам, настроенным в контейнере ключей, при ссылке на ключ в [техническом профиле жвтиссуер](./jwt-issuer-technical-profile.md). Приложение, использующее библиотеку OIDC, автоматически извлекает эти метаданные, чтобы убедиться, что для проверки маркеров используются правильные ключи. Дополнительные сведения см. в статье Использование [библиотеки проверки подлинности Майкрософт](../active-directory/develop/msal-b2c-overview.md), которая всегда выбирает последние ключи подписывания маркера автоматически.

## <a name="policy-key-management"></a>Управление ключами политики

Чтобы получить текущий активный ключ в контейнере ключей, используйте конечную точку Microsoft Graph API [жетактивекэй](/graph/api/trustframeworkkeyset-getactivekey) .

Чтобы добавить или удалить ключи подписывания и шифрования, выполните следующие действия.

1. Войдите на [портал Azure](https://portal.azure.com).
1. Выберите значок **Каталог и подписка** в верхней панели инструментов портала, а затем выберите каталог, содержащий клиент Azure AD B2C.
1. На портале Azure найдите и выберите **Azure AD B2C**.
1. На странице "Обзор" в разделе **Политики** выберите **Identity Experience Framework**.
1. Выбор **ключей политики** 
    1. Чтобы добавить новый раздел, нажмите кнопку **Добавить**.
    1. Чтобы удалить новый ключ, выберите его и нажмите кнопку **Удалить**. Чтобы удалить ключ, введите имя контейнера ключа, который нужно удалить. Azure AD B2C удалит ключ и создаст копию ключа с суффиксом. bak.

### <a name="replace-a-key"></a>Замена ключа

Ключи в наборе ключей не могут быть заменяемыми или съемными. Если необходимо изменить существующий ключ, выполните следующие действия.

- Рекомендуется добавить новый ключ с **датой активации** , равным текущей дате и времени. Azure AD B2C активирует новый ключ и прекращает использовать прежний активный ключ.
- Кроме того, можно создать новый набор ключей с правильными ключами. Обновите политику, чтобы использовать новый набор ключей, а затем удалите старый набор ключей. 

## <a name="next-steps"></a>Дальнейшие действия

- Узнайте, как использовать Microsoft Graph для автоматизации развертывания [набора ключей](microsoft-graph-operations.md#trust-framework-policy-keyset) и [ключей политик](microsoft-graph-operations.md#trust-framework-policy-key) .