---
title: итсме OpenID Connect Connect with Azure Active Directory B2C
titleSuffix: Azure AD B2C
description: Узнайте, как интегрировать проверку подлинности Azure AD B2C с итсме OIDC с помощью политики потока пользователей client_secret. итсме — это приложение цифрового удостоверения. Она позволяет безопасно входить в систему без читателей карт, паролей, двухфакторной проверки подлинности и нескольких ПИН-кодов.
services: active-directory-b2c
author: msmimart
manager: celestedg
ms.service: active-directory
ms.workload: identity
ms.topic: how-to
ms.date: 07/30/2020
ms.author: mimart
ms.subservice: B2C
ms.openlocfilehash: ba7875caa6a1db7638bfeafcfea1efa7b2462152
ms.sourcegitcommit: 772eb9c6684dd4864e0ba507945a83e48b8c16f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "87489521"
---
# <a name="configure-itsme-openid-connect-oidc-with-azure-active-directory-b2c"></a>Настройка итсме OpenID Connect Connect (OIDC) с помощью Azure Active Directory B2C

Приложение Digital ID итсме позволяет безопасно выполнять вход без устройств чтения карт, паролей, двухфакторной проверки подлинности или нескольких ПИН-кодов. Приложение итсме обеспечивает надежную проверку подлинности клиента с проверенным удостоверением. Из этой статьи вы узнаете, как интегрировать проверку подлинности Azure AD B2C с итсме OpenID Connect Connect (OIDC) с помощью политики потока пользователя секрета клиента.

## <a name="prerequisites"></a>Предварительные требования

Чтобы приступить к работе, вам потребуется:

* Подписка Azure AD. Если у вас нет подписки, вы можете получить [бесплатную учетную запись](https://azure.microsoft.com/free/).
* [Клиент Azure AD B2C](tutorial-create-tenant.md) , связанный с вашей подпиской Azure.
* Идентификатор клиента, также известный как Партнерский код, предоставленный итсме.
* Код службы, предоставляемый итсме.
* Секрет клиента для учетной записи итсме.

## <a name="scenario-description"></a>Описание сценария

![Схема архитектуры итсме](media/partner-itsme/itsme-architecture-diagram.png)

<!--
Please clarify step 1 in the description below - we don't have steps in this tutorial for "adapting in the Azure AD B2C Custom Policy- User Journeys" - should this be added somewhere?
-->

| Шаг | Описание |
|------|------|
|1     | На веб-сайте или в приложении включите **Вход с помощью кнопки итсме** , адаптируя в потоке пользователя Azure AD B2C. Поток взаимодействия запускается, когда пользователь нажимает эту кнопку.  |
|2     | Azure AD B2C запускает поток подключения OpenID Connect, отправляя запрос авторизации в API секрета клиента итсме. Доступна хорошо известная конечная точка (OpenID Connect), содержащая сведения о конечных точках.  |
|3     | Среда итсме перенаправляет пользователя на страницу итсме Identify, что позволяет пользователю заполнить свой номер телефона.  |
|4     | Среда итсме получает номер телефона от пользователя и проверяет правильность.  |
|5     | Если номер телефона принадлежит активному пользователю итсме, для приложения итсме создается действие.  |
|6     | Пользователь открывает приложение итсме, проверяет запрос и подтверждает действие.  |
|7     |  Приложение информирует среду итсме о том, что действие было подтверждено. |
|8     |  Среда итсме возвращает код авторизации OAuth для Azure AD B2C. |
|9     |  Используя код авторизации, Azure AD B2C выполняет запрос маркера. |
| 10 | Среда итсме проверяет запрос маркера и, если он действителен, возвращает маркер доступа OAuth и маркер идентификации, содержащий запрошенные сведения о пользователе. |
| 11 | Наконец, пользователь перенаправляется на URL-адрес перенаправления в качестве пользователя, прошедшего проверку подлинности.  |
|   |   |

## <a name="onboard-with-itsme"></a>Подключение с помощью итсме

1. Чтобы создать учетную запись с помощью итсме, посетите итсме в [Azure Marketplace](https://azuremarketplace.microsoft.com/marketplace).

2. Активируйте учетную запись итсме, отправив сообщение электронной почты по адресу onboarding@itsme.be . Вы получите **код партнера** и **код службы** , которые понадобятся для настройки B2C.

3. После активации учетной записи партнера итсме вы получите сообщение электронной почты с одноразовой ссылкой на **секрет клиента**.

4. Выполните инструкции по адресу [итсме](https://business.itsme.be/en) , чтобы завершить настройку.

## <a name="integrate-with-azure-ad-b2c"></a>Интеграция с Azure AD B2C

### <a name="set-up-a-new-identity-provider-in-azure-ad-b2c"></a>Настройка нового поставщика удостоверений в Azure AD B2C

> [!NOTE]
> Если у вас еще нет клиента Azure AD B2C, [создайте](tutorial-create-tenant.md) его. Он должен быть связан с вашей подпиской Azure.

1. Убедитесь, что вы используете каталог, содержащий клиент Azure AD B2C. Выберите фильтр **Каталог и подписка** в верхнем меню, а затем каталог, содержащий клиент Azure AD B2C.

2. В разделе **службы Azure** выберите **Azure AD B2C** (или **другие службы** и используйте поле поиска **все службы** для поиска *Azure AD B2C*).

3. Щелкните элемент **Поставщики удостоверений**, а затем выберите **Новый поставщик OpenID Connect**.

4. Заполните форму следующими сведениями:

   |Свойство. | Значение |
   |------------ |------- |
   | Имя | itsme |
   | URL-адрес метаданных | `https://oidc.<environment>.itsme.services/clientsecret-oidc/csapi/v0.1/.well-known/openid-configuration` <br>где `<environment>` — это либо `e2e` (тестовая среда), либо `prd` (Рабочая)  |
   | ClientID     | **Идентификатор клиента**, также известный как **Партнерский код**  |
   | Секрет клиента | **Client_secret** |
   | Область  | Служба OpenID Connect: Электронная почта профиля ЙОУРСЕРВИЦЕКОДЕ [Телефон] [адрес]  |
   |Тип ответа | code |
   |Режим ответа | query |
   |Указание домена | *Вы можете оставить это поле пустым* |
   |UserID | sub |
   |Отображаемое имя | name |
   |Имя | given_name |
   |Surname | family_name |
   |Email | email|

5. Щелкните **Сохранить**.

### <a name="configure-a-user-flow"></a>Настройка потока пользователя

1. В клиенте Azure AD B2C в разделе **политики** выберите **потоки пользователей**.

2. Выберите **новый поток пользователей**.

3. Выберите **Регистрация и вход**, выберите версию и нажмите кнопку **создать**.

4. Введите **Имя**.

5. В разделе **поставщики удостоверений** выберите **итсме**.

6. Нажмите кнопку **создания**.

7. Откройте только что созданный поток пользователя, выбрав имя потока пользователя.

8. Выберите **Свойства** и измените следующие значения:

   * Измените **время существования маркера идентификатора & доступа (в минутах)** на **5**.
   * Измените **время существования маркера обновления** до **истечения срока действия**.

### <a name="register-an-application"></a>Регистрация приложения

1. В клиенте B2C в разделе **Управление** выберите **Регистрация приложений**  >  **Новая регистрация**.

2. Укажите **имя** приложения и введите **URI перенаправления**. В целях тестирования введите `https://jwt.ms` .

3. Убедитесь, что многофакторная проверка подлинности **отключена**.

4. Выберите **Зарегистрировать**.

   а. В целях тестирования выберите **Проверка подлинности** и в разделе **неявное предоставление** установите флажки **токены доступа** и **маркеры идентификации** .  

   b. Щелкните **Сохранить**.

## <a name="test-the-user-flow"></a>Тестирование потока пользователя

1. В клиенте B2C в разделе **политики** выберите **потоки пользователя**.

2. Выберите ранее созданный поток пользователя.

3. Выберите **Выполнить поток пользователя**.

   а. **Приложение**: *выберите зарегистрированное приложение* .

   b. **URL-адрес ответа**: *выберите URL-адрес перенаправления*

4. Откроется страница итсме **Identify (идентификация** пользователя).  

5. Введите номер мобильного телефона и нажмите кнопку **Отправить**.

6. Подтвердите действие в приложении итсме.

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения см. в следующих статьях:

* [Пользовательские политики в Azure AD B2C](custom-policy-overview.md)

* [Приступая к работе с пользовательскими политиками в Azure AD B2C](custom-policy-get-started.md?tabs=applications)