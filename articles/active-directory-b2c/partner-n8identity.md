---
title: Руководство по настройке N8 Identity с помощью Azure Active Directory B2C
titleSuffix: Azure AD B2C
description: Руководство по настройке средства администрирования Сеакцесшуб с Azure Active Directory B2C для решения миграции учетных записей клиентов и администрирования запросов на обслуживание клиентов (CSR).
services: active-directory-b2c
author: gargi-sinha
manager: martinco
ms.service: active-directory
ms.workload: identity
ms.topic: how-to
ms.date: 10/26/2020
ms.author: gasinh
ms.subservice: B2C
ms.openlocfilehash: 337275cef0f2159cb5fac40ac0435408baf3bbef
ms.sourcegitcommit: 910a1a38711966cb171050db245fc3b22abc8c5f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "96170928"
---
# <a name="tutorial-for-configuring-theaccesshub-admin-tool-with-azure-active-directory-b2c"></a>Руководство по настройке средства администрирования Сеакцесшуб с помощью Azure Active Directory B2C

В этом примере учебника мы представили рекомендации по интеграции Azure Active Directory (AD) B2C с [средством администрирования сеакцесшуб](https://n8id.com/products/theaccesshub-admintool/) из N8 Identity. Это решение предназначено для миграции учетных записей клиентов и администрирования запросов на обслуживание клиентов (CSR).  

Это решение подходит для вас, если у вас есть одна или несколько из следующих требований:

- У вас уже есть сайт, и вы хотите перейти на Azure AD B2C. Однако при переносе учетных записей клиентов, включая пароли, возникают трудности

- Вам потребуется средство для CSR, чтобы администрировать учетные записи Azure AD B2C.

- Вам необходимо использовать делегированное администрирование для ваших представителей.

- Вы хотите синхронизировать и объединить данные из нескольких репозиториев в Azure AD B2C.

## <a name="pre-requisites"></a>Предварительные требования

Чтобы приступить к работе, вам потребуется:

- Подписка Azure AD. Если у вас нет подписки, вы можете получить [бесплатную учетную запись](https://azure.microsoft.com/free/).

- [Клиент Azure AD B2C](./tutorial-create-tenant.md). Клиент должен быть связан с подпиской Azure.

- Среда средства администрирования Сеакцесшуб: обратитесь к [N8 Identity](https://n8id.com/contact/) для создания новой среды.

- Используемых Сведения о подключении и учетных данных для любых баз данных или протоколов LDAP, из которых требуется перенести данные клиента.

- Используемых Настроена Azure AD B2C среда для использования [настраиваемых политик](./custom-policy-get-started.md), если вы хотите интегрировать средство администрирования сеакцесшуб в поток политик регистрации.

## <a name="scenario-description"></a>Описание сценария

Средство администрирования Сеакцесшуб работает как любое другое приложение в Azure. Она может выполняться в подписке Azure N8 Identity или в подписке клиента. Реализация показана на следующей схеме архитектуры.

![Изображение, показывающее схему архитектуры n8identity](./media/partner-n8identity/n8identity-architecture-diagram.png)

|Шаг | Описание |
|:-----| :-----------|
| 1. | Пользователь прибывает на странице входа. Пользователи настроили регистрацию для создания новой учетной записи и ввода данных на странице. Azure AD B2C собирает атрибуты пользователя.
| 2. | Azure AD B2C вызывает средство администрирования Сеакцесшуб и передает атрибуты пользователя.
| 3. | Средство администрирования Сеакцесшуб проверяет существующую базу данных на наличие текущих сведений о пользователе.  
| 4. | Запись пользователя синхронизируется с базой данных в средство администрирования Сеакцесшуб.
| 5. | Средство администрирования Сеакцесшуб использует данные совместно с делегированным администратором CSR или службы поддержки.
| 6. | Средство администрирования Сеакцесшуб синхронизирует записи пользователя с Azure AD B2C.
| 7. |На основе отклика об успешном или неуспешном выполнении средства администрирования Сеакцесшуб Azure AD B2C отправляет пользователю настраиваемое приветственное сообщение.

## <a name="create-a-global-admin-in-your-azure-ad-b2c-tenant"></a>Создание глобального администратора в Azure AD B2C клиенте

Средству администрирования Сеакцесшуб требуются разрешения на выполнение от имени глобального администратора, чтобы считывать сведения о пользователе и выполнять изменения в клиенте Azure AD B2C. Изменения обычных администраторов выиграли; возможность взаимодействия с клиентом с помощью средства администрирования Сеакцесшуб.

Чтобы создать глобального администратора, выполните следующие действия.

1. В портал Azure Войдите в клиент Azure AD B2C с правами администратора. Переход к **Azure Active Directory**  >  **пользователям**
2. Выбор **нового пользователя**
3. Выберите **создать пользователя** , чтобы создать обычного пользователя каталога, а не для клиента.
4. Заполнение формы сведений об удостоверениях

   а. Введите имя пользователя, например "сеакцесшуб"

   b. Введите имя, например "Сеакцесшуб Service Account" (учетная запись службы).

5. Выберите параметр **Показывать пароль** и скопировать первоначальный пароль для последующего использования.
6. Назначение роли глобального администратора

   а. Выберите **пользователя** текущей роли пользователя, чтобы изменить его

   b. Проверка записи для глобального администратора

   c. **Выберите**  >  **Создание**

## <a name="connect-theaccesshub-admin-tool-with-your-azure-ad-b2c-tenant"></a>Подключение средства администрирования Сеакцесшуб к клиенту Azure AD B2C

Средство администрирования Сеакцесшуб использует API Graph Майкрософт для чтения и внесения изменений в ваш каталог. Он выступает в качестве глобального администратора в клиенте. Для средства администрирования Сеакцесшуб требуются дополнительные разрешения, которые можно предоставить в средстве.

Чтобы авторизовать средство администрирования Сеакцесшуб для доступа к каталогу, выполните следующие действия.

1. Войдите в средство администрирования Сеакцесшуб, используя предоставленные учетные данные для N8 Identity.

2. Перейдите к **системному администратору**  >  **Azure AD B2C config**

3. Выбор **авторизации подключения**

4. В новом окне Войдите в систему с помощью учетной записи глобального администратора. Возможно, вам будет предложено сбросить пароль, если вы впервые выполняете вход с новой учетной записью службы.

5. Следуйте инструкциям на экране и выберите **принять** , чтобы предоставить средству администрирования сеакцесшуб необходимые разрешения.

## <a name="configure-a-new-csr-user-using-your-enterprise-identity"></a>Настройка нового пользователя CSR с помощью удостоверения предприятия

Создайте пользователя CSR или поддержки, который обращается к средству администрирования Сеакцесшуб, используя существующие учетные данные предприятия Azure Active Directory.

Чтобы настроить пользователя CSR или службы поддержки с помощью единого входа (SSO), рекомендуется выполнить следующие действия.

1. Войдите в средство администрирования Сеакцесшуб, используя учетные данные, предоставленные удостоверением N8.

2. Переход к **средствам диспетчера**  >  **Управление коллегами**

3. Выберите **добавить коллегу**

4. Выберите **тип коллеги администратор Azure**

5. Введите сведения о профиле коллеги

   а. Выбор домашней Организации будет контролировать, кто имеет разрешение на управление этим пользователем.

   b. В поле Идентификатор входа или имя пользователя Azure AD укажите имя участника-пользователя из учетной записи Azure Active Directory пользователя.

   c. На вкладке роли Сеакцесшуб Проверьте службу поддержки управляемой роли. Это позволит пользователю получить доступ к представлению Управление коллегами. Пользователь по-прежнему должен быть помещен в группу или быть владельцем Организации для выполнения действий с клиентами.

6. Нажмите кнопку **Submit** (Отправить).

## <a name="configure-a-new-csr-user-using-a-new-identity"></a>Настройка нового пользователя CSR с помощью нового удостоверения

Создайте пользователя CSR или поддержки, который будет получать доступ к средству администрирования Сеакцесшуб, используя новые локальные учетные данные, уникальные для средства администрирования Сеакцесшуб. Они будут использоваться в основном организациями, которые не используют Azure AD для своего предприятия.

Чтобы [настроить пользователя CSR или службы поддержки](https://youtu.be/iOpOI2OpnLI) без единого входа, выполните следующие действия.

1. Войдите в средство администрирования Сеакцесшуб, используя учетные данные, предоставленные удостоверением N8.

2. Переход к **средствам диспетчера**  >  **Управление коллегами**

3. Выберите **добавить коллегу**

4. Выберите **тип коллеги локальный администратор**

5. Введите сведения о профиле коллеги

   а. Выбор домашней Организации будет контролировать, кто имеет разрешение на управление этим пользователем.

   b. На вкладке **роли сеакцесшуб** выберите **службу поддержки** управляемой роли. Это позволит пользователю получить доступ к представлению Управление коллегами. Пользователь по-прежнему должен быть помещен в группу или быть владельцем Организации для выполнения действий с клиентами.

6. Скопируйте атрибуты " **идентификатор входа** " и "Электронная почта" и " **один раз для пароля** ". Предоставьте его новому пользователю. Они будут использовать эти учетные данные для входа в средство администрирования Сеакцесшуб. Пользователю будет предложено ввести новый пароль при первом входе в систему.

7. Нажмите **Отправить**

## <a name="configure-partitioned-csr-administration"></a>Настройка секционированного администрирования CSR

Разрешения на управление пользователями и клиентами CSR и службой поддержки в средстве администрирования Сеакцесшуб управляются с помощью иерархии Организации. Все коллеги и клиенты имеют домашнюю организацию, в которой они находятся. Определенные коллеги или группы коллег могут быть назначены в качестве владельцев организаций.  Владельцы организации могут управлять (вносить изменения) коллегами и клиентами в организациях и в подразделениях, которыми они владеют. Чтобы разрешить нескольким коллегам управлять набором пользователей, можно создать группу с большим количеством членов. Группа может быть назначена в качестве владельца Организации, а все члены группы могут управлять коллегами и клиентами в Организации.

### <a name="create-a-new-group"></a>Создание группы

1. Войдите в средство администрирования Сеакцесшуб, используя предоставленные **учетные данные** для N8 Identity.

2. Переход к **организации > Управление группами**

3. Выберите > **Добавить группу**

4. Введите **имя группы**, **Описание группы** и **владельца группы**

5. Найдите и установите флажки для тех коллег, которые должны быть членами группы, а затем выберите >**Добавить** .

6. В нижней части страницы можно увидеть всех членов группы.

7. Если необходимо удалить элементы, нажмите кнопку **x** в конце строки.

8. Нажмите **Отправить**

### <a name="create-a-new-organization"></a>Создание организации

1. Войдите в средство администрирования Сеакцесшуб, используя предоставленные учетные данные для N8 Identity.

2. Переход к Организации > **Управление организациями**

3. Выберите > **Добавить организацию**

4. Укажите **название организации**, **владельца Организации** и **родительскую организацию**.

    а. Название организации в идеале представляет собой значение, соответствующее вашим данным клиента. При загрузке данных о коллегах и клиентах, если вы предоставляете имя Организации в процессе загрузки, коллега может быть автоматически помещен в организацию.

    b. Владелец представляет пользователя или группу, которые будут управлять клиентами и коллегами в этой Организации и в любой подорганизации в.

    c. Родительская организация указывает, какая другая организация по своей природе, также отвечает за эту организацию.

5. Нажмите кнопку **Submit** (Отправить).

### <a name="modify-the-hierarchy-via-the-tree-view"></a>Изменение иерархии с помощью представления в виде дерева

1. Войдите в средство администрирования Сеакцесшуб, используя предоставленные учетные данные для N8 Identity.

2. Перейти к   >  **представлению дерева** средств диспетчера

3. В этом представлении можно визуализировать, какие коллеги и группы могут управлять организациями.

4. Иерархии можно изменить, перетащив Организации овертоп Организации, которым они должны быть добавлены.

5. По завершении изменения иерархии нажмите кнопку **сохранить** .

## <a name="customize-welcome-notification"></a>Настроить приветственное уведомление

Хотя вы используете Сеакцесшуб для переноса пользователей из предыдущего решения проверки подлинности в Azure AD B2C, может потребоваться настроить уведомление пользователя, которое отправляется пользователю путем Сеакцесшуб во время миграции. Обычно это сообщение содержит ссылку для клиента, чтобы задать новый пароль в каталоге Azure AD B2C.

Чтобы настроить уведомление, выполните следующие действия.

1. Войдите в Сеакцесшуб, используя учетные данные, предоставленные вам с помощью N8 Identity.

2. Переход к   >  **уведомлениям** системного администратора

3. Выбор **шаблона "создать коллегу** "

4. Выберите **Изменить**

5. При необходимости измените поля сообщения и шаблона. Поле шаблона является совместимым с HTML и может отправлять уведомления в формате HTML в адреса электронной почты клиентов.

6. По завершении нажмите кнопку **сохранить** .

## <a name="migrate-data-from-external-data-sources-to-azure-ad-b2c"></a>Перенос данных из внешних источников данных в Azure AD B2C

С помощью средства администрирования Сеакцесшуб можно импортировать данные из различных баз данных, LDAPs и CSV-файлов, а затем отправить эти данные в клиент Azure AD B2C. Это выполняется путем загрузки данных в Azure AD B2C тип коллеги пользователя в средстве администрирования Сеакцесшуб.  Если источник данных не является самой Azure, данные будут помещены в средство администрирования Сеакцесшуб и Azure AD B2C. Если источник внешних данных не является простым CSV-файлом на компьютере, настройте источник данных перед выполнением загрузки данных. Приведенные ниже шаги описывают создание источника данных и выполнение загрузки данных.

### <a name="configure-a-new-data-source"></a>Настройка нового источника данных

1. Войдите в средство администрирования Сеакцесшуб, используя предоставленные учетные данные для N8 Identity.

2. Переход к   >  **источникам данных** системного администратора

3. Выберите **Добавить источник данных**

4. Укажите **имя** и **тип** для этого источника данных

5. Заполните данные формы в зависимости от типа источника данных:

   **Для баз данных**

   а. **Тип** — база данных

   b. **Тип базы данных** — выберите базу данных из одного из поддерживаемых типов базы данных.

   c. **URL-адрес подключения** — введите строку подключения JDBC с правильным форматом. Например: ``jdbc:postgresql://myhost.com:5432/databasename``.

   d. **Username** — введите имя пользователя для доступа к базе данных.

   д) **Пароль** — введите пароль для доступа к базе данных.

   е) **Запрос** — введите SQL-запрос для извлечения сведений о клиенте. Например: ``SELECT * FROM mytable;``.

   ж. Выберите **проверить подключение**. Вы увидите образец данных, чтобы убедиться, что подключение работает.

   **Для LDAPs**

   а. **Тип** — LDAP.

   b. **Узел** — введите имя узла или IP-адрес для компьютера, на котором выполняется сервер LDAP. Например: ``mysite.com``.

   c. **Порт** — введите номер порта, на котором сервер LDAP прослушивается.

   d. **SSL** — установите флажок, если средство администрирования сеакцесшуб должно безопасно взаимодействовать с LDAP с помощью SSL. Настоятельно рекомендуется использовать SSL.

   д) **Имя для входа** : Введите DN учетной записи пользователя для входа и выполните поиск LDAP.

   е) **Пароль** — введите пароль для пользователя.

   ж. **Base DN** — введите различающееся имя в верхней части иерархии, в которой требуется выполнить поиск.

   h. **Фильтр** — введите строку фильтра LDAP, которая будет получать записи о клиентах.

   i. **Атрибуты** — введите разделенный запятыми список атрибутов из записей клиента для передачи в средство администрирования сеакцесшуб.

   j. Выберите **проверить подключение**. Вы увидите образец данных, чтобы убедиться, что подключение работает.

   **Для OneDrive**

   а. **Тип** — OneDrive для бизнеса.

   b. Выбор **авторизации подключения**

   c. В новом окне появится запрос на вход в **onedrive**, войдите с помощью пользователя с доступом на чтение к вашей учетной записи onedrive. Средство администрирования Сеакцесшуб будет выполнять действия этого пользователя для чтения файлов загрузки CSV.

   d. Следуйте инструкциям на экране и выберите **принять** , чтобы предоставить средству администрирования сеакцесшуб необходимые разрешения.

6. По завершении нажмите кнопку **сохранить** .  

### <a name="synchronize-data-from-your-data-source-into-azure-ad-b2c"></a>Синхронизация данных из источника данных в Azure AD B2C

1. Войдите в средство администрирования Сеакцесшуб, используя предоставленные учетные данные для N8 Identity.

2. Перейдите к разделу  >  **Синхронизация данных** системного администратора.

3. Выбор **новой нагрузки**

4. Выберите **тип коллеги** Azure AD B2C пользователя

5. Выберите **источник**, во всплывающем диалоговом окне выберите источник данных. Если вы создали источник данных OneDrive, также выберите файл.

6. Если вы не хотите создавать новые учетные записи клиентов с этой нагрузкой, измените первую политику: **Если коллега не найден в сеакцесшуб, а затем** **ничего не делать** .

7. Если вы не хотите обновлять существующие учетные записи клиентов с этой нагрузкой, измените вторую политику, **если несоответствие исходных и сеакцесшуб данных** **не** выполняется.

8. Щелкните **Далее**.

9. В **конфигурации сопоставления поиска мы определяем**, как сопоставлять записи нагрузки с клиентами, уже загруженными в средство администрирования сеакцесшуб. Выберите один или несколько идентифицирующих атрибутов в источнике. Сопоставьте атрибуты с атрибутом в средстве администрирования Сеакцесшуб, который содержит одни и те же значения. Если совпадение найдено, существующая запись будет переопределена. в противном случае будет создан новый клиент. Вы можете последовательно выполнить ряд этих проверок. Например, можно сначала проверить электронную почту, а затем имя и фамилию.

10. В боковом меню слева выберите **сопоставление данных**.

11. В Data-Mapping конфигурации назначьте, какие атрибуты средства администрирования Сеакцесшуб должны быть заполнены исходными атрибутами. Не нужно сопоставлять все атрибуты. Несопоставленные атрибуты останутся неизменными для существующих клиентов.

12. При сопоставлении с атрибутом org_name со значением, которое является именем существующей организации, новые клиенты будут помещены в эту организацию.

13. Щелкните **Далее**.

14. Если эта нагрузка должна быть повторена, можно указать расписание ежедневного, еженедельного или ежемесячного выполнения. В противном случае не **Задавайте** значение по умолчанию.

15. Нажмите **Отправить**

16. Если выбрано немедленное **Расписание** , Новая запись будет добавлена на экран "Синхронизация данных" немедленно. После достижения этапа проверки 100% выберите **новую запись** , чтобы увидеть ожидаемый результат загрузки. Для запланированных нагрузок эти записи будут отображаться только после запланированного времени.

17. Если ошибок нет, нажмите кнопку **выполнить** , чтобы зафиксировать изменения. В противном случае выберите **Удалить** в меню **больше** , чтобы удалить загрузку. Затем можно исправить исходные данные или сопоставления загрузки и повторить попытку. Вместо этого, если количество ошибок мало, можно вручную обновить записи и выбрать **Обновить** для каждой записи, чтобы внести исправления. Наконец, можно продолжить работу с любыми ошибками и разрешить их позже в качестве **вмешательства в службу** Сеакцесшуб Admin Tool.

18. Когда запись **синхронизации данных** становится 100% на этапе загрузки, все изменения, внесенные в результате загрузки, будут инициированы. Клиенты должны начать появляться или получать изменения в Azure AD B2C.

## <a name="synchronize-azure-ad-b2c-customer-data"></a>Синхронизация данных клиента Azure AD B2C 

В качестве однократной или текущей операции средство администрирования Сеакцесшуб может синхронизировать всю информацию о клиенте с Azure AD B2C в средство администрирования Сеакцесшуб. Это гарантирует, что администраторы CSR/службы поддержки будут видеть актуальные сведения о клиентах.

Для синхронизации данных из Azure AD B2C в средство администрирования Сеакцесшуб:

1. Войдите в средство администрирования Сеакцесшуб, используя предоставленные учетные данные для N8 Identity.

2. Перейдите к разделу  >  **Синхронизация данных** системного администратора.

3. Выбор **новой нагрузки**

4. Выберите **тип коллеги** Azure AD B2C пользователя

5. Для шага **Параметры** оставьте значения по умолчанию.

6. Щелкните **Далее**.

7. Для шага **поиска & сопоставление данных** оставьте значения по умолчанию. За исключением случая, когда сопоставляется с атрибутом **org_name** со значением, которое является именем существующей организации, новые клиенты будут помещены в эту организацию.

8. Щелкните **Далее**.

9. Если эта нагрузка должна быть повторена, можно указать расписание ежедневного, еженедельного или ежемесячного выполнения. В противном случае используйте значение по умолчанию: **Now**. Рекомендуется регулярно выполнять синхронизацию с Azure AD B2C.

10. Нажмите **Отправить**

11. Если выбрано **немедленное расписание,** новая запись будет добавлена на экран "Синхронизация данных" немедленно. После достижения этапа проверки 100% выберите новую запись, чтобы увидеть ожидаемый результат загрузки. Для запланированных нагрузок эти записи будут отображаться только после запланированного времени.

12. Если ошибок нет, нажмите кнопку **выполнить** , чтобы зафиксировать изменения. В противном случае выберите **Удалить** в меню больше, чтобы удалить загрузку. Затем можно исправить исходные данные или сопоставления загрузки и повторить попытку. Вместо этого, если количество ошибок мало, можно вручную обновить записи и выбрать **Обновить** для каждой записи, чтобы внести исправления. Наконец, можно продолжить работу с любыми ошибками и разрешить их позже в качестве вмешательства в службу Сеакцесшуб Admin Tool.

13. Когда запись **синхронизации данных** становится 100% на этапе загрузки, все изменения, внесенные в результате загрузки, будут инициированы.

## <a name="configure-azure-ad-b2c-policies"></a>Настройка политик Azure AD B2C

Иногда синхронизация средства администрирования Сеакцесшуб ограничена возможностью обновления его состояния с Azure AD B2C. Мы можем использовать API-интерфейсы и политики Azure AD B2C средства администрирования Сеакцесшуб для информирования средства администрирования Сеакцесшуб об изменениях по мере их возникновения. Для этого решения требуются технические знания [Azure AD B2C пользовательских политик](./custom-policy-get-started.md). В следующем разделе мы предоставим вам пример действий политики и безопасный сертификат для уведомления средства администрирования Сеакцесшуб для новых учетных записей в Sign-Up пользовательских политик.

### <a name="create-a-secure-credential-to-invoke-theaccesshub-admin-tools-api"></a>Создание защищенных учетных данных для вызова API средства администрирования Сеакцесшуб

1. Войдите в средство администрирования Сеакцесшуб, используя предоставленные учетные данные для N8 Identity.

2. Перейдите к **системному администратору**  >    >  **Безопасность API** средства администрирования

3. Выберите **создать** .

4. Копирование **пароля сертификата**

5. Щелкните **скачать** , чтобы получить сертификат клиента.

6. Следуйте указаниям этого [руководства](./secure-rest-api.md#https-client-certificate-authentication ) , чтобы добавить сертификат клиента в Azure AD B2C.

### <a name="retrieve-your-custom-policy-examples"></a>Получение примеров пользовательской политики

1. Войдите в средство администрирования Сеакцесшуб, используя предоставленные учетные данные для N8 Identity.

2. Перейдите к **системному администратору**  >  **средства администрирования**  >  **Azure B2C политики** .

3. Укажите домен клиента Azure AD B2C и два идентификатора инфраструктуры процедур идентификации из конфигурации инфраструктуры взаимодействия с удостоверениями.

4. Нажмите кнопку **Сохранить**.

5. Выберите **скачать** , чтобы получить ZIP-файл с базовыми политиками, которые добавляют клиентов в средство администрирования сеакцесшуб при регистрации клиентов.

6. Следуйте указаниям этого [руководства](./custom-policy-get-started.md) , чтобы приступить к проектированию пользовательских политик в Azure AD B2C.

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения см. в следующих статьях:

- [Пользовательские политики в Azure AD B2C](./custom-policy-overview.md)

- [Приступая к работе с пользовательскими политиками в Azure AD B2C](./custom-policy-get-started.md?tabs=applications)