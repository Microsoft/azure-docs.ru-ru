---
title: Определение технического профиля проверки в пользовательской политике
titleSuffix: Azure AD B2C
description: Проверка утверждений с помощью технического профиля проверки в пользовательской политике в Azure Active Directory B2C.
services: active-directory-b2c
author: msmimart
manager: celestedg
ms.service: active-directory
ms.workload: identity
ms.topic: reference
ms.date: 03/16/2020
ms.author: mimart
ms.subservice: B2C
ms.openlocfilehash: 2d4c538a9292698fecc8b44c055ab201748e292c
ms.sourcegitcommit: 772eb9c6684dd4864e0ba507945a83e48b8c16f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "85202999"
---
# <a name="define-a-validation-technical-profile-in-an-azure-active-directory-b2c-custom-policy"></a>Определение технического профиля проверки в пользовательской политике в Azure Active Directory B2C

[!INCLUDE [active-directory-b2c-advanced-audience-warning](../../includes/active-directory-b2c-advanced-audience-warning.md)]

Технический профиль проверки — это обычный технический профиль любого протокола, такого как [Azure Active Directory](active-directory-technical-profile.md) или [REST API](restful-technical-profile.md). Технический профиль проверки Возвращает исходящие утверждения или возвращает код состояния HTTP 4xx со следующими данными. Дополнительные сведения см. в разделе [возврат сообщения об ошибке](restful-technical-profile.md#returning-validation-error-message)

```json
{
    "version": "1.0.0",
    "status": 409,
    "userMessage": "Your error message"
}
```

Область исходящих утверждений технического профиля проверки ограничена [автоматически подтвержденным техническим профилем](self-asserted-technical-profile.md) , который вызывает технический профиль проверки и его техническими профилями проверки. Если вы хотите использовать выходные утверждения на следующем шаге оркестрации, добавьте выходные утверждения в самостоятельно утвержденный технический профиль, который вызывает технический профиль проверки.

Технические профили проверки выполняются в той последовательности, в которой они расположены в элементе **ValidationTechnicalProfiles**. В техническом профиле проверки можно настроить, продолжать ли выполнение следующего технического профиля проверки, если технический профиль проверки вызвал ошибку или выполнен успешно.

Можно настроить условное выполнение технического профиля проверки на основе предварительных условий, определенных в элементе **ValidationTechnicalProfile**. Например, можно проверить, существует ли конкретное утверждение, или значение, если утверждение равно или не соответствует указанному значению.

Самоподтвержденный технический профиль может определить технический профиль проверки, используемый для проверки некоторых или всех исходящих утверждений. Все входящие утверждения указанного технического профиля должны присутствовать в списке выходных утверждений технического профиля проверки, в который включен этот элемент.

> [!NOTE]
> Только самостоятельно утвержденные технические профили могут использовать технические профили проверки. Если необходимо проверить выходные утверждения от несамостоятельных технических профилей, рассмотрите возможность использования дополнительного шага оркестрации в пути взаимодействия пользователя, чтобы обеспечить соответствие техническому профилю проверки.

## <a name="validationtechnicalprofiles"></a>ValidationTechnicalProfiles

Элемент **ValidationTechnicalProfiles** содержит следующие элементы:

| Элемент | Вхождения | Описание |
| ------- | ----------- | ----------- |
| ValidationTechnicalProfile | 1:n | Технический профиль используется для проверки некоторых или всех исходящих утверждений эталонного технического профиля. |

Элемент **ValidationTechnicalProfile** содержит следующий атрибут:

| Атрибут | Обязательно | Описание |
| --------- | -------- | ----------- |
| ReferenceId | Да | Идентификатор технического профиля, который уже определен в политике или родительской политике. |
|ContinueOnError|Нет| Указывает, следует ли продолжать проверку всех последующих технических профилей проверки, если этот технический профиль проверки порождает ошибку. Допустимые значения: `true` или `false` (значение по умолчанию, дальнейшая обработка профилей проверки будет остановлена, и будет возвращено сообщение об ошибке). |
|ContinueOnSuccess | Нет | Указывает, следует ли продолжать проверку всех последующих профилей проверки, если этот технический профиль проверки успешно завершился. Возможные значения: `true` или `false`. По умолчанию используется значение `true`, это значит, что обработка профилей проверки будет продолжена. |

Элемент **ValidationTechnicalProfile** содержит следующий элемент:

| Элемент | Вхождения | Описание |
| ------- | ----------- | ----------- |
| Preconditions | 0:1 | Список предварительных условий, которые необходимо соблюдать для выполнения технического профиля проверки. |

Элемент **Precondition** содержит следующий атрибут.

| Атрибут | Обязательно | Описание |
| --------- | -------- | ----------- |
| `Type` | Да | Тип выполняемой проверки или запроса для данного предварительного условия. Можно установить значение `ClaimsExist`, которое указывает, что действия должны выполняться, если указанные утверждения существуют в текущем наборе утверждений пользователя, или значение `ClaimEquals`, указывающее на то, что действия следует выполнить, если указанное утверждение существует и его значение соответствует указанному. |
| `ExecuteActionsIf` | Да | Указывает, следует ли выполнять действия в предварительном условии, если тест возвращает true или false. |

Элементы **Precondition** содержат следующие элементы:

| Элемент | Вхождения | Описание |
| ------- | ----------- | ----------- |
| Значение | 1:n | Данные, используемые при проверке. Если тип этой проверки равен `ClaimsExist`, то это поле задает ClaimTypeReferenceId для запроса. Если тип проверки равен `ClaimEquals`, то это поле задает ClaimTypeReferenceId для запроса. А другой элемент значения содержит значение, для которого необходимо выполнить проверку.|
| Действие | 1:1 | Действие, которое требуется выполнить, если в результате проверки предварительного условия в рамках шага оркестрации получено значение true. Значение **Action** установлено в `SkipThisValidationTechnicalProfile`. Указывает, что не следует выполнять связанный технический профиль проверки. |

### <a name="example"></a>Пример

Следующий пример использует эти технические профили проверки:

1. Первый технический профиль проверки проверяет учетные данные пользователя и не продолжает, если возникает ошибка, например недопустимое имя пользователя или неверный пароль.
2. Следующий технический профиль проверки не выполняется, если утверждение userType не существует или значение userType равно `Partner`. Технический профиль проверки пытается считать профиль пользователя из внутренней базы данных клиентов и продолжает работу при возникновении ошибки, например при недоступности службы REST API или при любой внутренней ошибке.
3. Последний технический профиль проверки не выполняется, если утверждение userType не существует или значение userType равно `Customer`. Технический профиль проверки пытается считать профиль пользователя из внутренней базы данных партнеров и продолжает работу при возникновении ошибки, например при недоступности службы REST API или при любой внутренней ошибке.

```xml
<ValidationTechnicalProfiles>
  <ValidationTechnicalProfile ReferenceId="login-NonInteractive" ContinueOnError="false" />
  <ValidationTechnicalProfile ReferenceId="REST-ReadProfileFromCustomertsDatabase" ContinueOnError="true" >
    <Preconditions>
      <Precondition Type="ClaimsExist" ExecuteActionsIf="false">
        <Value>userType</Value>
        <Action>SkipThisValidationTechnicalProfile</Action>
      </Precondition>
      <Precondition Type="ClaimEquals" ExecuteActionsIf="true">
        <Value>userType</Value>
        <Value>Partner</Value>
        <Action>SkipThisValidationTechnicalProfile</Action>
      </Precondition>
    </Preconditions>
  </ValidationTechnicalProfile>
  <ValidationTechnicalProfile ReferenceId="REST-ReadProfileFromPartnersDatabase" ContinueOnError="true" >
    <Preconditions>
      <Precondition Type="ClaimsExist" ExecuteActionsIf="false">
        <Value>userType</Value>
        <Action>SkipThisValidationTechnicalProfile</Action>
      </Precondition>
      <Precondition Type="ClaimEquals" ExecuteActionsIf="true">
        <Value>userType</Value>
        <Value>Customer</Value>
        <Action>SkipThisValidationTechnicalProfile</Action>
      </Precondition>
    </Preconditions>
  </ValidationTechnicalProfile>
</ValidationTechnicalProfiles>
```
