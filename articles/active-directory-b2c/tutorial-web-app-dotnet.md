---
title: Руководство по Включение проверки подлинности в веб-приложении
titleSuffix: Azure AD B2C
description: Руководство по предоставлению пользователю данных для входа в веб-приложение ASP.NET с помощью Azure Active Directory B2C.
services: active-directory-b2c
author: msmimart
manager: celestedg
ms.author: mimart
ms.date: 10/02/2020
ms.custom: devx-track-csharp, mvc
ms.topic: tutorial
ms.service: active-directory
ms.subservice: B2C
ms.openlocfilehash: 9c3c63b6116e02e8a742b69e90c11e182d72ab2e
ms.sourcegitcommit: f28ebb95ae9aaaff3f87d8388a09b41e0b3445b5
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/29/2021
ms.locfileid: "94953038"
---
# <a name="tutorial-enable-authentication-in-a-web-application-using-azure-active-directory-b2c"></a>Руководство по Включение в веб-приложении аутентификации с помощью Azure Active Directory B2C

В этом руководстве описано использование Azure Active Directory B2C (Azure AD B2C) для входа и регистрации пользователей в веб-приложении ASP.NET. Azure AD B2C позволяет приложениям выполнять проверку подлинности учетных записей социальных сетей, корпоративных учетных записей и учетных записей Azure Active Directory с помощью стандартных протоколов.

В этом руководстве описано следующее:

> [!div class="checklist"]
> * Обновление приложения в Azure AD B2C.
> * настройка примера для использования приложения;
> * регистрация с помощью потока пользователя.

[!INCLUDE [quickstarts-free-trial-note](../../includes/quickstarts-free-trial-note.md)]

> [!NOTE]
> В этом руководстве используется пример веб-приложения ASP.NET. Другие примеры приложений (в том числе ASP.NET Core, Node.js, Python и др.) см. в статье [Примеры кода Azure Active Directory B2C](code-samples.md).

## <a name="prerequisites"></a>Предварительные требования

* [Создайте потоки пользователя](tutorial-create-user-flows.md), чтобы обеспечить взаимодействие с пользователями в приложении.
* Установите [Visual Studio 2019](https://www.visualstudio.com/downloads/) с рабочей нагрузкой **ASP.NET и веб-разработка**.

## <a name="update-the-application-registration"></a>Обновление регистрации приложения

При прохождении учебника для выполнения предварительных условий вы зарегистрировали веб-приложение в Azure AD B2C. Для обеспечения взаимодействия с примером в этом учебнике необходимо добавить URI перенаправления и создать секрет клиента (ключ) для зарегистрированного приложения.

### <a name="add-a-redirect-uri-reply-url"></a>Добавление URI перенаправления (URL-адреса ответа)

Чтобы обновить приложение в клиенте Azure AD B2C, можно использовать новый унифицированный интерфейс **Регистрация приложений** или устаревший интерфейс **Приложения (прежняя версия)** . [См. дополнительные сведения о новом интерфейсе](./app-registrations-training-guide.md).

#### <a name="app-registrations"></a>[Регистрация приложений](#tab/app-reg-ga/)

1. Войдите на [портал Azure](https://portal.azure.com).
1. Выберите фильтр **Каталог и подписка** в верхнем меню, а затем выберите каталог, содержащий клиент Azure AD B2C.
1. В меню слева выберите **Azure AD B2C**. Либо щелкните **Все службы**, а затем найдите и выберите **Azure AD B2C**
1. Выберите **Регистрация приложений**, щелкните вкладку **Собственные приложения**, а затем выберите приложение *webapp1*.
1. В разделе **Интернет** выберите ссылку **Добавление URI**, введите `https://localhost:44316`, а затем нажмите кнопку **Сохранить**.
1. Щелкните **Обзор**.
1. Запишите значение параметра **Идентификатор приложения (клиент)** для использования на более позднем этапе при настройке веб-приложения.

#### <a name="applications-legacy"></a>[Приложения (прежние версии)](#tab/applications-legacy/)

1. Войдите на [портал Azure](https://portal.azure.com).
1. Убедитесь, что используете каталог с клиентом Azure AD B2C, выбрав фильтр **Каталог и подписка** в меню вверху и каталог с вашим клиентом.
1. Выберите **Все службы** в левом верхнем углу окна портала Azure, а затем найдите и выберите **Azure AD B2C**.
1. Щелкните пункт **Приложения (прежняя версия)** , а затем выберите приложение *webapp1*.
1. В разделе **URL-адрес ответа** добавьте `https://localhost:44316`.
1. Щелкните **Сохранить**.
1. На странице свойств запишите идентификатор приложения для использования в дальнейшем при настройке веб-приложения.

* * *

### <a name="create-a-client-secret"></a>Создание секрета клиента

Затем создайте секрет клиента для зарегистрированного веб-приложения. В примере кода веб-приложения он используется для подтверждения подлинности при запросе токенов.

[!INCLUDE [active-directory-b2c-client-secret](../../includes/active-directory-b2c-client-secret.md)]

## <a name="configure-the-sample"></a>Настройка примера

С помощью этого руководства вы настроите пример, который можно скачать из репозитория GitHub. В примере применяется ASP.NET для предоставления простого списка задач и используются [компоненты ПО промежуточного слоя OWIN](/aspnet/aspnet/overview/owin-and-katana/). [Скачайте ZIP-файл](https://github.com/Azure-Samples/active-directory-b2c-dotnet-webapp-and-webapi/archive/master.zip) или клонируйте пример с GitHub. Убедитесь, что вы извлекаете пример файла в папку, общая длина пути к которой меньше 260 символов.

```
git clone https://github.com/Azure-Samples/active-directory-b2c-dotnet-webapp-and-webapi.git
```

Пример решения состоит из следующих двух проектов:

* **TaskWebApp** — создание и изменение списка задач. Пример использует поток пользователя **регистрации или входа** для регистрации пользователей и входа в систему.
* **TaskService** — это веб-API, поддерживающий функции создания, чтения, обновления и удаления списка задач. API защищен с помощью Azure AD B2C и вызывается TaskWebApp.

Для использования приложения, зарегистрированного в клиенте, измените данные в примере, в частности укажите идентификатор приложения и ключ, записанные ранее. Кроме того, необходимо также настроить созданные потоки пользователя. Пример определяет значения конфигурации, такие как параметры, в файле *Web.config*.

Обновите параметры в файле Web.config для работы с пользовательским потоком:

1. Откройте решение **B2C-WebAPI-DotNet** в Visual Studio.
1. В проекте **TaskWebApp** откройте файл **Web.config**.
    1. Измените значение `ida:Tenant` и `ida:AadInstance` на имя созданного клиента Azure AD B2C. Например, замените `fabrikamb2c` на `contoso`.
    1. Замените значение `ida:TenantId` идентификатором каталога из свойств клиента Azure B2C (на портале Azure выберите **Azure Active Directory** > **Свойства** > **Идентификатор каталога**).
    1. Замените значение `ida:ClientId` идентификатором приложения, который вы записали.
    1. Замените значение `ida:ClientSecret` ключом, который вы записали. Если секрет клиента содержит какие-либо предопределенные сущности XML, например такие символы, как меньше (`<`), больше (`>`), амперсанд (`&`) или двойные кавычки (`"`), их необходимо экранировать, применив к секрету клиента кодировку XML перед его добавлением в файл Web.config.
    1. Замените значение `ida:SignUpSignInPolicyId` на `b2c_1_signupsignin1`.
    1. Замените значение `ida:EditProfilePolicyId` на `b2c_1_profileediting1`.
    1. Замените значение `ida:ResetPasswordPolicyId` на `b2c_1_passwordreset1`.

## <a name="run-the-sample"></a>Запуск примера

1. В обозревателе решений щелкните проект **TaskWebApp** правой кнопкой мыши, а затем выберите пункт **Назначить запускаемым проектом**.
1. Нажмите клавишу **F5**. Запустится браузер по умолчанию, и откроется адрес локального веб-сайта `https://localhost:44316/`.

### <a name="sign-up-using-an-email-address"></a>Регистрация с помощью адреса электронной почты

1. Выберите **Sign up / Sign in** (Вход в службу или регистрация), чтобы зарегистрироваться как пользователь приложения. Используется поток пользователя **b2c_1_signupsignin1**.
1. Появляется страница входа в Azure AD B2C со ссылкой для регистрации. Щелкните ссылку **Зарегистрироваться сейчас**, так как у вас нет учетной записи. В рамках рабочего процесса регистрации появляется страница для сбора данных и проверки личности пользователя с использованием адреса электронной почты. Рабочий процесс регистрации также собирает пароль пользователя и запрашиваемые атрибуты, определенные в потоке пользователя.
1. Используйте действительный адрес электронной почты и подтвердите его с помощью кода проверки. Задайте пароль. Введите значения запрашиваемых атрибутов.

    ![Страница регистрации, отображаемая как часть рабочего процесса входа и регистрации](./media/tutorial-web-app-dotnet/sign-up-workflow.PNG)

1. Выберите **Создать**, чтобы создать локальную учетную запись в клиенте Azure AD B2C.

Теперь пользователь может использовать свой адрес электронной почты для входа в веб-приложение и работы с ним.

Однако компонент **Список задач** не будет работать, пока вы не завершите работу со следующим руководством в серии, [Руководство: Использование Azure AD B2C для защиты веб-API ASP.NET](tutorial-web-api-dotnet.md).

## <a name="next-steps"></a>Дальнейшие действия

В этом руководстве вы узнали, как выполнять следующие задачи:

> [!div class="checklist"]
> * Обновление приложения в Azure AD B2C.
> * настройка примера для использования приложения;
> * регистрация с помощью потока пользователя.

Теперь перейдите к следующему руководству, чтобы включить компонент **Список задач** в веб-приложении. В нем вы зарегистрируете приложение веб-API в собственном клиенте Azure AD B2C, а затем измените пример кода, чтобы использовать клиент для проверки подлинности API.

> [!div class="nextstepaction"]
> [Руководство. Использование Azure Directory B2C для защиты веб-API ASP.NET >](tutorial-web-api-dotnet.md)