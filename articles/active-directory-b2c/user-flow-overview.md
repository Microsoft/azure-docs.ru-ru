---
title: Потоки пользователей в Azure Active Directory B2C | Документация Майкрософт
titleSuffix: Azure AD B2C
description: Сведения о расширяемой платформе политик Azure Active Directory B2C и создании различных потоков пользователей.
services: active-directory-b2c
author: msmimart
manager: celestedg
ms.service: active-directory
ms.workload: identity
ms.topic: conceptual
ms.date: 07/30/2020
ms.custom: project-no-code
ms.author: mimart
ms.subservice: B2C
ms.openlocfilehash: 06253b571fd71623501c27fd5b0d9d4013727fc2
ms.sourcegitcommit: 867cb1b7a1f3a1f0b427282c648d411d0ca4f81f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "94840199"
---
# <a name="user-flows-in-azure-active-directory-b2c"></a>Потоки пользователей в Azure Active Directory B2C

Чтобы вам было проще настроить наиболее распространенные задачи идентификации для приложений, на портале Azure AD B2C реализованы предопределенные настраиваемые политики, которые называются **потоками пользователей**. Пользовательская последовательность позволяет определить, как пользователи взаимодействуют с приложением, когда они выполняют такие действия, как вход, регистрация, изменение профиля или сброс пароля. С помощью пользовательских потоков можно управлять следующими возможностями:

- типы учетных записей, используемые для входа в систему, такие как учетные записи социальных сетей, например Facebook, или локальные учетные записи;
- атрибуты, которые нужно получить от пользователя, например имя, почтовый индекс и размер обуви;
- Многофакторная идентификация Azure AD
- настройка пользовательского интерфейса;
- сведения, которые приложение получает в виде утверждений в токене.

В своем клиенте вы можете создать много потоков пользователей различных типов и при необходимости использовать их в приложениях. Потоки пользователей могут повторно использоваться в разных приложениях. Такая гибкость позволяет определять и изменять процесс идентификации, внося лишь незначительные изменения в код или совсем не изменяя его. Приложение запускает поток пользователя с помощью стандартного HTTP-запроса на проверку подлинности, содержащего параметры потока пользователя. Настраиваемый [токен](tokens-overview.md) возвращается в качестве ответа.

Ниже приведены примеры, в которых используется параметр строки запроса "p", указывающий на поток пользователя для использования.

```
https://contosob2c.b2clogin.com/contosob2c.onmicrosoft.com/oauth2/v2.0/authorize?
client_id=2d4d11a2-f814-46a7-890a-274a72a7309e      // Your registered Application ID
&redirect_uri=https%3A%2F%2Flocalhost%3A44321%2F    // Your registered Reply URL, url encoded
&response_mode=form_post                            // 'query', 'form_post' or 'fragment'
&response_type=id_token
&scope=openid
&nonce=dummy
&state=12345                                        // Any value provided by your application
&p=b2c_1_siup                                       // Your sign-up user flow
```

```
https://contosob2c.b2clogin.com/contosob2c.onmicrosoft.com/oauth2/v2.0/authorize?
client_id=2d4d11a2-f814-46a7-890a-274a72a7309e      // Your registered Application ID
&redirect_uri=https%3A%2F%2Flocalhost%3A44321%2F    // Your registered Reply URL, url encoded
&response_mode=form_post                            // 'query', 'form_post' or 'fragment'
&response_type=id_token
&scope=openid
&nonce=dummy
&state=12345                                        // Any value provided by your application
&p=b2c_1_siin                                       // Your sign-in user flow
```

## <a name="user-flow-versions"></a>Версии потоков на уровне пользователя

Azure AD B2C включает несколько типов потоков пользователей:

- **Sign up and sign in** (Регистрация и вход) — регулирует процедуры регистрации и входа в систему в рамках одной конфигурации. Пользователи проходят через соответствующую процедуру в зависимости от контекста. Кроме того, сюда входят отдельные потоки для **регистрации** или **входа** пользователя. Но обычно мы советуем использовать объединенный поток пользователей для регистрации и входа.
- **Profile editing** (Изменение профиля) — позволяет пользователям изменять сведения профиля.
- **Password reset** (Сброс пароля) — позволяет настроить возможность и способ сброса паролей пользователями.

Большинство типов потоков пользователей имеют как **рекомендуемую** , так и **стандартную** версию. Дополнительные сведения см. в разделе [версии потока пользователя](user-flow-versions.md).

> [!IMPORTANT]
> Если вы работали с потоками пользователей в Azure AD B2C, то обратите внимание, что мы изменили способ ссылки на версии потока пользователей. Ранее мы предлагали версию 1 (готовая к выпуску) и версии 1.1 и 2 (предварительная версия). Теперь мы объединили потоки пользователей в две версии:
>
>- **Рекомендуемые** пользовательские потоки — это новые предварительные версии потоков пользователей. Они тщательно тестируются и объединяют все функции устаревших версий **v2** и **v 1.1** . После пересылки новые рекомендованные пользовательские потоки будут поддерживаться и обновляться. После перехода к этим новым рекомендуемым потокам пользователей у вас будет доступ к новым функциям по мере их выпуска.
>- **Стандартные** потоки пользователей, ранее известные как **v1**, являются общедоступными и готовыми к работе рабочими потоками пользователей. Если потоки пользователей являются критически важными и зависят от высокостабильных версий, вы можете продолжать использовать стандартные потоки пользователей, зная, что эти версии не будут поддерживаться и обновляться.
>
>Все пользовательские потоки предварительной версии (версии 1.1 и v2) имеют путь к нерекомендуемому состоянию на **1 августа 2021**. Везде, где это возможно, настоятельно рекомендуется [Перейти на новый **рекомендуемый** пользовательский поток](user-flow-versions.md#how-to-switch-to-a-new-recommended-user-flow) как можно скорее, чтобы вы всегда могли воспользоваться новейшими функциями и обновлениями.

## <a name="linking-user-flows"></a>Связывание потоков пользователей

При использовании потока пользователя **регистрации или входа** с локальными учетными записями на первой странице интерфейса отображается ссылка **Забыли пароль?**. При переходе по этой ссылке поток пользователя сброса паролей не активируется автоматически.

Вместо этого в приложение возвращается код ошибки `AADB2C90118`. Приложение должно обработать этот код ошибки, выполнив конкретный поток пользователя, который позволяет сбросить пароль. Чтобы увидеть пример, просмотрите [простой пример ASP.NET](https://github.com/AzureADQuickStarts/B2C-WebApp-OpenIDConnect-DotNet-SUSI), в котором демонстрируется связывание потоков пользователей.

## <a name="email-address-storage"></a>Место хранения адреса электронной почты

Адрес электронной почты может требоваться как часть потока пользователя. Если пользователь проходит проверку подлинности с помощью поставщика удостоверений социальных сетей, адрес электронной почты сохраняется в свойстве **otherMails**. Если локальная учетная запись основана на имени пользователя, адрес электронной почты сохраняется в свойстве сведений строгой проверки подлинности. Если локальная учетная запись основана на адресе электронной почты, адрес электронной почты сохраняется в свойстве **signInNames**.

Проверка адреса электронной почты не гарантируется в любом из этих вариантов. Администратор клиента может отключить проверку адреса электронной почты в базовых политиках для локальных учетных записей. Даже если проверка адреса электронной почты включена, адреса не проверяются, если они исходят от поставщика удостоверений социальных сетей и они еще не были изменены.

Через API Microsoft Graph доступны только свойства **осермаилс** и **signInNames** . Адрес электронной почты в свойстве сведений строгой проверки подлинности недоступен.

## <a name="next-steps"></a>Дальнейшие действия

Чтобы создать рекомендованные пользовательские потоки, следуйте инструкциям в разделе [учебник. Создание потока пользователя](tutorial-create-user-flows.md).
