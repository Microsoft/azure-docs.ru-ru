---
title: Настройка регистрации и входа с помощью OpenID Connect Connect
titleSuffix: Azure AD B2C
description: Настройте регистрацию и вход с помощью любого поставщика удостоверений OpenID Connect Connect (IdP) в Azure Active Directory B2C.
services: active-directory-b2c
author: msmimart
manager: celestedg
ms.service: active-directory
ms.workload: identity
ms.topic: how-to
ms.date: 03/08/2021
ms.author: mimart
ms.subservice: B2C
ms.openlocfilehash: 9434bd4042798dc05a33401e1884e11a73774936
ms.sourcegitcommit: 867cb1b7a1f3a1f0b427282c648d411d0ca4f81f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/20/2021
ms.locfileid: "102448342"
---
# <a name="set-up-sign-up-and-sign-in-with-openid-connect-using-azure-active-directory-b2c"></a>Настройка регистрации и входа с помощью OpenID Connect через Azure Active Directory B2C

[OpenID Connect Connect](openid-connect.md) — это протокол проверки подлинности, созданный на основе OAuth 2,0, который можно использовать для безопасного входа пользователя в систему. Большинство поставщиков удостоверений, использующих этот протокол, поддерживаются в Azure AD B2C. В этой статье объясняется, как можно добавить пользовательских поставщиков удостоверений OpenID Connect в потоки пользователя.

## <a name="add-the-identity-provider"></a>Добавление поставщика удостоверений

1. Войдите на [портал Azure](https://portal.azure.com/) с правами глобального администратора клиента Azure AD B2C.
1. Убедитесь, что вы используете каталог, содержащий клиент Azure AD B2C, щелкнув фильтр **каталогов и подписок** в верхнем меню и выбрав Каталог, содержащий ваш клиент.
1. Выберите **Все службы** в левом верхнем углу окна портала Azure, найдите службу **Azure AD B2C** и выберите ее.
1. Щелкните элемент **Поставщики удостоверений**, а затем выберите **Новый поставщик OpenID Connect**.
1. Введите **Имя**. Например, введите *contoso*.

## <a name="configure-the-identity-provider"></a>Настройка поставщика удостоверений

Каждый поставщик удостоверений OpenID Connect Connect описывает документ метаданных, который содержит большую часть сведений, необходимых для выполнения входа. Сюда входят такие сведения, как используемые URL-адреса и расположение открытых ключей подписывания службы. Документ метаданных OpenID Connect всегда находится в конечной точке, которая заканчивается на `.well-known/openid-configuration`. Для поставщика удостоверений OpenID Connect, которого требуется добавить, введите его URL-адрес метаданных.

## <a name="client-id-and-secret"></a>Идентификатор клиента и секрет

Чтобы разрешить пользователям выполнять вход, разработчики должны зарегистрировать приложение в своей службе, так как это требуется для поставщика удостоверений. Это приложение получит **идентификатор клиента** и **секрет клиента**. Скопируйте эти значения от поставщика удостоверений и введите их в соответствующие поля.

> [!NOTE]
> Секрет клиента не обязателен. Однако необходимо ввести секрет клиента, если вы хотите использовать [поток кода авторизации](https://openid.net/specs/openid-connect-core-1_0.html#CodeFlowAuth), который использует секрет для обмена кодом маркера.

## <a name="scope"></a>Область

Области определяют сведения и разрешения, которые требуется собрать от пользовательского поставщика удостоверений. Запросы OpenID Connect должны содержать значение области `openid`, чтобы получить маркер идентификатора от поставщика удостоверений. Без маркера идентификатора пользователи не смогут войти в Azure AD B2C с помощью пользовательского поставщика удостоверений. Можно присоединить другие области (разделяемые пробелом). Сведения о том, какие другие области могут быть доступны, см. в документации пользовательского поставщика удостоверений.

## <a name="response-type"></a>Тип ответа

Тип ответа описывает, какие сведения будут отправляться обратно в исходный вызов `authorization_endpoint` пользовательского поставщика удостоверений. Можно использовать следующие типы ответов:

* `code`: в соответствии с [потоком кода авторизации](https://openid.net/specs/openid-connect-core-1_0.html#CodeFlowAuth), код будет возвращаться обратно в Azure AD B2C. Azure AD B2C затем перейдет к вызову `token_endpoint` для обмена кода для маркера.
* `id_token`: маркер идентификатора возвращается обратно в Azure AD B2C от пользовательского поставщика удостоверений.

## <a name="response-mode"></a>Режим ответа

Режим ответа позволяет определить метод, который следует использовать для отправки данных обратно от пользовательского поставщика удостоверений в Azure AD B2C. Можно использовать следующие режимы ответов:

* `form_post`: этот режим ответа рекомендуется использовать для максимальной безопасности. Ответ передается через HTTP-метод `POST` с кодом или маркером, закодированным в тексте с использованием формата `application/x-www-form-urlencoded`.
* `query`: код или маркер возвращается в виде параметра запроса.

## <a name="domain-hint"></a>Указание домена

Используя указание домена, можно перейти непосредственно на страницу входа указанного поставщика удостоверений. Таким образом, пользователю не придется выбирать поставщика удостоверений из списка доступных. Чтобы разрешить такое поведение, введите значение для указания домена. Чтобы перейти к пользовательскому поставщику удостоверений, добавьте параметр `domain_hint=<domain hint value>` в конец запроса при вызове Azure AD B2C для входа.

## <a name="claims-mapping"></a>Сопоставление утверждений

После того как пользовательский поставщик удостоверений отправит маркер идентификатора обратно в службу Azure AD B2C, эта служба должна иметь возможность сопоставить утверждения из полученного маркера с утверждениями, которые Azure AD B2C распознает и использует. Ознакомьтесь со сведениями о каждом приведенном ниже сопоставлении в документации пользовательского поставщика удостоверений, чтобы понимать утверждения, которые возвращаются обратно в маркерах поставщика удостоверений.

* **Идентификатор пользователя**: введите утверждение, которое предоставляет *уникальный идентификатор* для пользователя, выполнившего вход.
* **Отображаемое имя**: введите утверждение, которое предоставляет пользователю *Отображаемое имя* или *полное имя* .
* **Заданное имя**: введите утверждение, которое предоставляет *имя* пользователя.
* **Фамилия**: введите утверждение, которое предоставляет *фамилию* пользователя.
* **Электронная почта**: введите утверждение, которое предоставляет *адрес электронной почты* пользователя.

## <a name="add-the-identity-provider-to-a-user-flow"></a>Добавление поставщика удостоверений в поток пользователя 

1. В клиенте Azure AD B2C выберите **Потоки пользователей**.
1. Щелкните поток пользователя, для которого требуется добавить поставщик удостоверений. 
1. В разделе **поставщики удостоверений социальных сетей** выберите добавленного поставщика удостоверений. Например, *contoso*.
1. Щелкните **Сохранить**.
1. Чтобы проверить политику, выберите пункт **выполнить пользовательскую последовательность**.
1. Для **приложения** выберите веб-приложение с именем *testapp1* , которое вы зарегистрировали ранее. В поле **URL-адрес ответа** должно содержаться значение `https://jwt.ms`.
1. Нажмите кнопку **запустить поток пользователя** .
1. На странице Регистрация или вход выберите поставщик удостоверений, который вы хотите войти. Например, *contoso*.

Если процесс входа прошел успешно, браузер перенаправляется на `https://jwt.ms` , который отображает содержимое маркера, возвращенного Azure AD B2C.
