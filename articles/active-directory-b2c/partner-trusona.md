---
title: Трусона и Azure Active Directory B2C
titleSuffix: Azure AD B2C
description: Узнайте, как добавить Трусона в качестве поставщика удостоверений на Azure AD B2C, чтобы включить проверку подлинности с помощью пароля.
services: active-directory-b2c
author: msmimart
manager: celestedg
ms.service: active-directory
ms.workload: identity
ms.topic: how-to
ms.date: 07/30/2020
ms.author: mimart
ms.subservice: B2C
ms.openlocfilehash: 99368da8b4018e93ad537e4722ffefd476e61291
ms.sourcegitcommit: 1f1d29378424057338b246af1975643c2875e64d
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/05/2021
ms.locfileid: "99573693"
---
# <a name="integrating-trusona-with-azure-active-directory-b2c"></a>Интеграция Трусона с Azure Active Directory B2C

Трусона — это независимый поставщик программного обеспечения (ISV), который обеспечивает безопасный вход, обеспечивая проверку подлинности без пароля, многофакторную проверку подлинности и проверку цифровых лицензий. В этой статье вы узнаете, как добавить Трусона в качестве поставщика удостоверений в Azure AD B2C, чтобы включить проверку подлинности с помощью пароля.

## <a name="prerequisites"></a>Предварительные требования

Чтобы приступить к работе, вам потребуется:

* Подписка Azure AD. Если у вас нет подписки, вы можете получить [бесплатную учетную запись](https://azure.microsoft.com/free/).
* [Клиент Azure AD B2C](tutorial-create-tenant.md) , связанный с вашей подпиской Azure.
* [Пробная учетная запись](https://www.trusona.com/) по адресу трусона

## <a name="scenario-description"></a>Описание сценария

В этом сценарии Трусона выступает в качестве поставщика удостоверений для Azure AD B2C включения проверки подлинности с помощью пароля. Решение состоит из следующих компонентов:

* Azure AD B2C объединенную политику входа и регистрации
* Трусона, добавленный в Azure AD B2C в качестве поставщика удостоверений
* Загружаемое приложение Трусона

![Схема архитектуры трусона](media/partner-trusona/trusona-architecture-diagram.png)

| Шаг | Описание |
|------|------|
|1     | Пользователь пытается войти в приложение или зарегистрироваться в нем. Пользователь проходит проверку подлинности с помощью Azure AD B2C политики регистрации и входа. Во время регистрации используется ранее проверенный адрес электронной почты пользователя из приложения Трусона.     |
|2     | Azure B2C перенаправляет пользователя к поставщику удостоверений Трусона OpenID Connect Connect (OIDC) с помощью неявного потока.     |
|3     | Для системных входов настольных ПК Трусона Отображает уникальный, анимированный и динамический QR-код для сканирования с помощью приложения Трусона. Для имен входа на основе мобильных устройств Трусона использует "глубокую ссылку", чтобы открыть приложение Трусона. Эти два метода используются для устройств и обнаружения пользователей в конечном итоге.     |
|4     | Пользователь сканирует отображаемый QR-код с помощью приложения Трусона.     |
|5     | Учетная запись пользователя находится в облачной службе Трусона, и подготавливается проверка подлинности.     |
|6     | Облачная служба Трусона выдает пользователю запрос проверки подлинности с помощью push-уведомления, отправленного в приложение Трусона:<br>a. Пользователю предлагается запрос проверки подлинности. <br> b. Пользователь решает принять или отклонить запрос. <br> c. Пользователю предлагается использовать безопасность операционной системы (например, биометрию, секретный код, ПИН-код или шаблон) для подтверждения и подписывания запроса с помощью закрытого ключа в безопасной среде выполнения анклава/Trusted. <br> d. Приложение Трусона создает динамические полезные данные для защиты от повторного воспроизведения на основе параметров проверки подлинности в режиме реального времени. <br> д) Весь ответ подписывается (во второй раз) закрытым ключом в безопасной анклава/доверенной среде выполнения и возвращается в облачную службу Трусона для проверки.      |
|7     |  Облачная служба Трусона перенаправляет пользователя в вызывающее приложение с помощью id_token. Azure AD B2C проверяет id_token с помощью конфигурации опубликованных OpenID Connect Трусона, настроенной во время настройки поставщика удостоверений.    |
|  |  |

## <a name="onboard-with-trusona"></a>Подключение с помощью Трусона

1. Заполните [форму](https://www.trusona.com/) , чтобы создать учетную запись трусона и начать работу.

2. Скачайте мобильное приложение Трусона из магазина приложений. Установите приложение и зарегистрируйте свой адрес электронной почты.

3. Проверьте свою электронную почту с помощью защищенной "волшебной ссылки", отправленной программным обеспечением.  

4. Перейдите на [панель мониторинга разработчика трусона](https://dashboard.trusona.com) для самообслуживания.

5. Выберите **я готов** и пройдите проверку подлинности в приложении трусона.

6. На левой навигационной панели выберите **интеграции OIDC**.

7. Выберите **создать OpenID Connect соединение интеграция**.

8. Укажите **имя** по своему усмотрению и используйте ранее предоставленные сведения о домене (например, Contoso) в **поле узел перенаправления клиента**.  

   > [!NOTE]
   > В качестве узла перенаправления клиента используется начальное имя домена Azure Active Directory.

9. Следуйте инструкциям в разделе [руководств по интеграции трусона](https://docs.trusona.com/integrations/aad-b2c-integration/). При появлении запроса используйте исходное доменное имя (например, Contoso), упомянутое на предыдущем шаге.  

## <a name="integrate-with-azure-ad-b2c"></a>Интеграция с Azure AD B2C

### <a name="add-a-new-identity-provider"></a>Добавление нового поставщика удостоверений

> [!NOTE]
> Если у вас еще нет клиента Azure AD B2C, [создайте](tutorial-create-tenant.md) его. Он должен быть связан с вашей подпиской Azure.

1. Войдите на [портал Azure](https://portal.azure.com/) с правами глобального администратора клиента Azure AD B2C.

2. Убедитесь, что используете каталог с клиентом Azure AD B2C, выбрав фильтр **Каталог и подписка** в меню вверху и каталог с вашим клиентом.

3. Выберите **Все службы** в левом верхнем углу окна портала Azure, найдите службу **Azure AD B2C** и выберите ее.

4. Перейдите к **панели мониторинга**  >  **Azure Active Directory B2C**  >  **поставщики удостоверений**.

3. Выберите **поставщики удостоверений**.

4. Выберите **Добавить**.

### <a name="configure-an-identity-provider"></a>Настройка поставщика удостоверений  

1. Выберите **тип поставщика удостоверений**  >  **OpenID Connect Подключить (Предварительная версия)**.

2. Заполните форму, чтобы настроить поставщик удостоверений:  

   | Свойство | Значение  |
   | :--- | :--- |
   | URL-адрес метаданных | `https://gateway.trusona.net/oidc/.well-known/openid-configuration`|
   | Идентификатор клиента | Будет отправлен вам по адресу от Трусона |
   | Область | Адрес электронной почты профиля OpenID Connect |
   | Тип ответа | Id_token |
   | Режим ответа  | Form_post |

3. Нажмите кнопку **ОК**.  

4. Установите флажок **сопоставлять утверждения поставщика удостоверений**.  

5. Заполните форму для отображения поставщика удостоверений:

   | Свойство | Значение  |
   | :--- | :--- |
   | UserID | Sub  |
   | Отображаемое имя | псевдоним |
   | Имя | given_name |
   | Surname | Family_name |
   | Режим ответа | email |

6. Нажмите кнопку **ОК** , чтобы завершить настройку нового поставщика удостоверений OIDC.

### <a name="create-a-user-flow-policy"></a>Создание политики потока пользователя

Теперь вы должны увидеть Трусона в качестве **нового поставщика удостоверений OpenID Connect Connect** , указанного в поставщиках удостоверений B2C.

1. В клиенте Azure AD B2C в разделе **политики** выберите **потоки пользователей**.

1. Выберите **новый поток пользователей**.

1. Выберите **Регистрация и вход**, выберите версию и нажмите кнопку **создать**.

1. Введите **имя** политики.

1. В разделе **поставщики удостоверений** выберите созданный **поставщик удостоверений трусона**.

   > [!NOTE]
   > Так как Трусона по своей природе является многофакторной, лучше оставить многофакторную проверку подлинности отключенной.

1. Щелкните **Создать**.

1. В разделе **атрибуты и утверждения пользователя** выберите пункт **показывать больше**. В форме выберите по крайней мере один атрибут, указанный во время установки поставщика удостоверений в предыдущем разделе.

1. Нажмите кнопку **ОК**.  

### <a name="test-the-policy"></a>Тестирование политики

1. Выберите созданную политику.

2. Выберите **Выполнить поток пользователя**.

3. В форме введите URL-адрес ответа.

4. Выберите **Выполнить поток пользователя**. Необходимо перенаправить шлюз Трусона OIDC. На шлюзе Трусона Просмотрите отображаемый защищенный QR-код с помощью приложения Трусона или пользовательского приложения, используя пакет SDK для Трусона Mobile.

5. После сканирования защищенного QR-кода необходимо перенаправить на адрес URL ответа, определенный на шаге 3.

## <a name="next-steps"></a>Следующие шаги  

Дополнительные сведения см. в следующих статьях:

- [Пользовательские политики в Azure AD B2C](custom-policy-overview.md)

- [Приступая к работе с пользовательскими политиками в AAD B2C](custom-policy-get-started.md?tabs=applications)
