---
title: Создание потока пользователя — Azure Active Directory B2C
description: Узнайте, как создавать потоки пользователей на портале Azure для регистрации, входа и редактирования профилей пользователей для приложений в Azure Active Directory B2C.
services: active-directory-b2c
author: msmimart
manager: celestedg
ms.service: active-directory
ms.workload: identity
ms.topic: tutorial
ms.date: 07/30/2020
ms.author: mimart
ms.subservice: B2C
ms.openlocfilehash: 9bd436b972dfb1549232831b1f07c3726ff459dd
ms.sourcegitcommit: 867cb1b7a1f3a1f0b427282c648d411d0ca4f81f
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "100556503"
---
# <a name="create-a-user-flow-in-azure-active-directory-b2c"></a>Создание потока пользователя в Azure Active Directory B2C

В своем арендаторе Azure Active Directory B2C (Azure AD B2C) вы можете создать [потоки пользователей](user-flow-overview.md) разных типов и при необходимости использовать их в приложениях. Потоки пользователей могут повторно использоваться в разных приложениях.

> [!IMPORTANT]
> Мы изменили способ обращения к версиям потока пользователей. Ранее мы предлагали версию 1 (готовая к выпуску) и версии 1.1 и 2 (предварительная версия). Теперь мы объединили потоки пользователей в **рекомендуемую** (предварительная версия следующего поколения) и **стандартную** (общедоступная версия) версии. Поддержка всех потоков пользователей версий 1.1 и 2 (предварительной версия) будет прекращена **1 августа 2021 г.** См. статью [Версии потоков пользователей в Azure Active Directory B2C](user-flow-versions.md).

## <a name="before-you-begin"></a>Перед началом

- **Зарегистрируйте приложение**, которое будет использоваться для проверки нового потока пользователя. Пример см. в разделе [Учебник. Регистрация веб-приложения в Azure AD B2C](tutorial-register-applications.md).
- **Добавьте внешние поставщики удостоверений**, если нужно включить вход пользователей с использованием таких поставщиков, как Azure AD, Amazon, Facebook, GitHub, LinkedIn, Microsoft или Twitter. См. статью [Добавление поставщиков удостоверений в приложения в Azure AD B2C](add-identity-provider.md).
- **Настройте поставщик удостоверений локальной учетной записи**, чтобы указать типы удостоверений (адрес электронной почты, имя пользователя, номер телефона), которые требуется поддерживать для локальных учетных записей в клиенте. Затем при создании отдельных пользовательских потоков можно выбирать среди этих поддерживаемых типов удостоверений. Когда пользователь завершает поток пользователя, в каталоге Azure AD B2C создается локальная учетная запись, а поставщик удостоверений **Локальная учетная запись** проверяет подлинность данных пользователя. Настройте поставщик удостоверений локальной учетной записи клиента, выполнив следующие действия.

   1. Войдите на [портал Azure](https://portal.azure.com/). 
   2. Выберите фильтр **Каталог и подписка** в верхнем меню, а затем каталог, содержащий клиент Azure AD B2C.
   3. На панели поиска в верхней части портала Azure найдите и выберите **Azure AD B2C**.
   4. В разделе **Управление** выберите **Поставщики удостоверений**.
   5. В списке поставщиков удостоверений выберите **Локальная учетная запись**.
   6. На странице **Настройка локального поставщика удостоверений** выберите все типы удостоверений, которые требуется поддерживать. Выбор параметров здесь просто делает их доступными для потоков пользователей, создаваемых позже:
      - **Телефон** (предварительная версия): Позволяет пользователю ввести номер телефона, который проверяется при регистрации и становится идентификатором пользователя.
      - **Электронная почта** (по умолчанию): Позволяет пользователю ввести адрес электронной почты, который проверяется при регистрации и становится идентификатором пользователя.
      - **Имя пользователя**. Позволяет пользователю создавать собственные уникальные идентификаторы пользователей. Адрес электронной почты собирается у пользователя и проверяется.
    7. Щелкните **Сохранить**.

## <a name="create-a-user-flow"></a>Создание потока пользователей

1. Войдите на [портал Azure](https://portal.azure.com).
2. Выберите значок **Каталог и подписка** в верхней панели инструментов портала, а затем выберите каталог, содержащий клиент Azure AD B2C.

    ![Арендатор B2C, область "Каталог и подписка", портал Azure](./media/create-user-flow/directory-subscription-pane.png)

3. На портале Azure найдите и выберите **Azure AD B2C**.
4. В разделе **Политики** выберите **Потоки пользователей** и щелкните **Создать поток пользователя**.

    ![Страница "Потоки пользователей" на портале с выделенной кнопкой "Создать поток пользователя"](./media/create-user-flow/signup-signin-user-flow.png)

5. На странице **Создание потока пользователя** выберите тип потока пользователя, который требуется создать (обзор см. в разделе [Потоки пользователей в Azure AD B2C](user-flow-overview.md)).

    ![Страница выбора потока пользователя с выделенным потоком "Регистрация и вход"](./media/create-user-flow/select-user-flow-type.png)

6. В разделе **Выбор версии**, выберите элемент **Рекомендуемая** и нажмите кнопку **Создать**. (См. сведения о [версиях потоков пользователей](user-flow-versions.md).)

    ![Страница создания потока пользователя на портале Azure с выделенными свойствами](./media/create-user-flow/select-version.png)

7. Введите **Имя** для потока пользователя (например, *signupsignin1*, *profileediting1*, *passwordreset1*).
8. В разделе **Поставщики удостоверений** выберите параметры в зависимости от типа создаваемого потока пользователя.

   - **Локальная учетная запись**. Если вы хотите разрешить пользователям создавать локальные учетные записи в клиенте Azure AD B2C, выберите тип идентификатора, который необходимо использовать (например, адрес электронной почты, идентификатор пользователя или телефон). Отображаются только те типы удостоверений, которые настроены в параметрах [поставщика удостоверений локальной учетной записи](#before-you-begin).

   - **Поставщики удостоверений в социальных сетях**. Если вы хотите разрешить вход пользователя с использованием [добавленных поставщиков удостоверений социальных сетей](add-identity-provider.md), например Azure AD, Amazon, Facebook, GitHub, LinkedIn, Microsoft или Twitter, выберите поставщиков в списке.

9. В разделе **Атрибуты пользователя и утверждения** выберите утверждения и атрибуты, которые вы хотите собирать и отправлять от пользователя во время регистрации. Выберите **Показать больше**. Выберите атрибуты и утверждения, а затем нажмите кнопку **ОК**.

    ![Страница выбора атрибутов и утверждений с тремя выбранными утверждениями](./media/create-user-flow/signup-signin-attributes.png)

10. Для добавления потока пользователя выберите команду **Создать**. Префикс *B2C_1* добавляется к имени автоматически.

### <a name="test-the-user-flow"></a>Тестирование потока пользователя

1. Выберите **Политики** > **Потоки пользователей**, а затем выберите созданный поток пользователя. На странице обзора потока пользователя выберите команду **Выполнить поток пользователя**.
1. Для параметра **Приложение** выберите веб-приложение, зарегистрированное на шаге 1. В поле **URL-адрес ответа** должно содержаться значение `https://jwt.ms`.
1. Выберите **Выполнить поток пользователя**.
2. В зависимости от типа тестируемого потока, подпишитесь с помощью действительного адреса электронной почты и выполните вход, используя учетную запись, созданную ранее.

    ![Страница выполнения потока пользователя на портале с выделенной кнопкой "Выполнить поток пользователя"](./media/create-user-flow/sign-up-sign-in-run-now.png)

1. Следуйте указаниям для потока пользователя. После завершения потока пользователя маркер возвращается в `https://jwt.ms` и должен отобразиться для вас.

> [!NOTE]
> Функция "Выполнить поток пользователя" в настоящее время не совместима с URL-адресом ответа типа SPA при использовании потока кода авторизации. Чтобы использовать эту функцию с приложениями таких типов, зарегистрируйте URL-адрес ответа с веб-переадресацией и включите неявный поток, как описано [здесь](tutorial-register-spa.md).

## <a name="next-steps"></a>Дальнейшие действия

- [Добавление условного доступа к потокам пользователей в Azure AD B2C](conditional-access-user-flow.md)
- [Настройка пользовательского интерфейса в потоке пользователя Azure AD B2C](customize-ui-with-html.md)
