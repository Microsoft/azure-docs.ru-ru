---
title: Руководство по настройке Azure Active Directory B2C с помощью Невис
titleSuffix: Azure AD B2C
description: Узнайте, как интегрировать проверку подлинности Azure AD B2C с Невис для проверки подлинности без пароля
services: active-directory-b2c
author: gargi-sinha
manager: martinco
ms.service: active-directory
ms.workload: identity
ms.topic: how-to
ms.date: 11/23/2020
ms.author: gasinh
ms.subservice: B2C
ms.openlocfilehash: 282ec6a25dc381dc51f28534d272bae57d2e792e
ms.sourcegitcommit: b39cf769ce8e2eb7ea74cfdac6759a17a048b331
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/22/2021
ms.locfileid: "98674999"
---
# <a name="tutorial-to-configure-nevis-with-azure-active-directory-b2c-for-passwordless-authentication"></a>Руководство по настройке Невис с Azure Active Directory B2C для проверки подлинности без пароля

В этом примере руководства вы узнаете, как расширить Azure AD B2C с помощью  [Невис](https://www.nevis.net/solution/authentication-cloud) , чтобы включить проверку подлинности без пароля. Невис предоставляет полноценное взаимодействие с конечным пользователем, полностью ориентированное на мобильные пользователи, и обеспечивает надежную проверку подлинности клиентов и соответствует требованиям к транзакциям директивы оплаты 2 (PSD2).

## <a name="prerequisites"></a>Предварительные условия

Чтобы приступить к работе, вам потребуется:

- Невис [пробная учетная запись](https://www.nevis-security.com/aadb2c/)

- Подписка Azure AD. Если у вас ее нет, получите [бесплатную учетную запись](https://azure.microsoft.com/free/).

- [Клиент Azure AD B2C](./tutorial-create-tenant.md) , связанный с вашей подпиской Azure.

- Настроена Azure AD B2C среда для использования [настраиваемых политик](./custom-policy-get-started.md), если вы хотите интегрировать в поток политик регистрации значение «Невис».

## <a name="scenario-description"></a>Описание сценария

В этом сценарии добавьте полностью фирменное приложение доступа к внутреннему приложению для проверки подлинности с паролем. Решение состоит из следующих компонентов:

- Клиент Azure AD B2C с Объединенной политикой входа и регистрации для серверной части.
- Невис экземпляр и его REST API для улучшения Azure AD B2C
- Собственное приложение для доступа с фирменной символикой

На схеме показана реализация.

![Высокоуровневый поток входа с использованием пароля с Azure AD B2C и Невис](./media/partner-nevis/nevis-architecture-diagram.png)

|Шаг | Описание |
|:-----| :-----------|
| 1. | Пользователь пытается войти в приложение или зарегистрироваться в приложении с помощью Azure AD B2C политики входа и регистрации.
| 2. | Во время регистрации приложение-Невис Access регистрируется на устройстве пользователя с помощью QR-кода. Закрытый ключ создается на устройстве пользователя и используется для подписания запросов пользователей.
| 3. |  Azure AD B2C использует технический профиль RESTFUL для запуска входа с помощью Невис решения.
| 4. | Запрос на вход отправляется в приложение Access либо в виде push-сообщения, либо в виде вложенного кода, либо в виде сквозной ссылки.
| 5. | Пользователь утверждает попытки входа с учетом своих биометрических учетных записей. Затем сообщение возвращается в значение «Невис», которое проверяет имя входа с помощью хранимого открытого ключа.
| 6. | Azure AD B2C отправляет один последний запрос в значение "Невис" для подтверждения успешного завершения входа.
| 7. |На основе сообщения об успешном или неуспешном выполнении от Azure AD B2C пользователя предоставлен или запрещен доступ к приложению.

## <a name="integrate-your-azure-ad-b2c-tenant"></a>Интеграция клиента Azure AD B2C

### <a name="onboard-to-nevis"></a>Подключение к Невис 

[Подпишитесь на учетную запись с Невис](https://www.nevis-security.com/aadb2c/).
Вы получите два сообщения электронной почты:

1. Уведомление учетной записи управления

2. Приглашение на мобильное приложение.

### <a name="add-your-azure-ad-b2c-tenant-to-your-nevis-account"></a>Добавление клиента Azure AD B2C в учетную запись "Невис"

1. В окне пробной версии учетной записи управления от Невис скопируйте ключ управления в буфер обмена.

2. Откройте https://console.nevis.cloud/ в браузере.

3. Войдите в консоль управления с помощью ключа.

4. Выберите **Добавить экземпляр**

5. Выберите только что созданный экземпляр, чтобы открыть его.

6. На боковой панели навигации выберите **пользовательские интеграции** .

7. Выберите **добавить пользовательскую интеграцию**.

8. В качестве имени для интеграции введите имя клиента Azure AD B2C.

9. В качестве URL-адреса или домена введите `https://yourtenant.onmicrosoft.com`

10. Щелкните **Далее**.

>[!NOTE]
>Вам потребуется Невис маркер доступа позже.

11. Нажмите кнопку **Готово**.

### <a name="install-the-nevis-access-app-on-your-phone"></a>Установка приложения "Невис Access" на телефоне

1. В сообщении с пробной версией приложения для мобильных устройств откройте предложение **Test рейс** .

2. Установите приложение.

3. Следуйте инструкциям по установке приложения, обращающегося к определенному приложению.

### <a name="integrate-azure-ad-b2c-with-nevis"></a>Интеграция Azure AD B2C с Невис

1. Откройте [портал Azure](https://portal.azure.com/).

2. Переключитесь на клиент Azure AD B2C. Убедитесь, что выбран правильный клиент, так как клиент Azure AD B2C обычно находится в отдельном клиенте.

3. В меню выберите инфраструктура процедур **идентификации (инфраструктура процедур идентификации)** .

4. Выбор **ключей политики**

5. Выберите **Добавить** и создайте новый ключ со следующими параметрами:

      а. Выбор параметра " **вручную** " в параметрах

      b. Задайте имя **аусклаудакцесстокен** .

      c. Вставьте ранее сохраненный **Невис маркер доступа** в поле секрета.

      d. Для параметра использование ключа выберите **Шифрование** .

      д) Выберите **Создать**.

### <a name="configure-and-upload-the-nevishtml-to-azure-blob-storage"></a>Настройка и отправка nevis.html в хранилище BLOB-объектов Azure

1. В среде вашей среды (IDE) перейдите в папку [**политики**](https://github.com/azure-ad-b2c/partner-integrations/tree/master/samples/Nevis/policy) .

2. Откройте файл  [**nevis.html**](https://github.com/azure-ad-b2c/partner-integrations/blob/master/samples/Nevis/policy/nevis.html) .

3. Замените  **authentication_cloud_url** URL-адресом своей серверной консоли администрирования `https://<instance_id>.mauth.nevis.cloud` .

4. **Сохраните** изменения в файле.

5. Следуйте [инструкциям](./customize-ui-with-html.md#2-create-an-azure-blob-storage-account) и передайте файл **nevis.html** в хранилище BLOB-объектов Azure.

6. Следуйте [инструкциям](./customize-ui-with-html.md#3-configure-cors) и включите общий доступ к ресурсам в разных источниках (CORS) для этого файла.

7. После завершения передачи и включения CORS выберите в списке файл **nevis.html** .

8. На вкладке **Обзор** рядом с **URL-адресом** щелкните значок **Копировать ссылку** .

9. Откройте ссылку на новой вкладке браузера, чтобы убедиться, что отображается серый прямоугольник.

>[!NOTE]
>Позже вам потребуется ссылка на BLOB-объект.

### <a name="customize-your-trustframeworkbasexml"></a>Настройка TrustFrameworkBase.xml

1. В интегрированной среде разработки перейдите в папку [**политики**](https://github.com/azure-ad-b2c/partner-integrations/tree/master/samples/Nevis/policy) .

2. Откройте файл [**TrustFrameworkBase.xml**](https://github.com/azure-ad-b2c/partner-integrations/blob/master/samples/Nevis/policy/TrustFrameworkBase.xml) .

3. Замените **йоуртенант** именем своей учетной записи клиента Azure в **TenantId**.

4. Замените **йоуртенант** именем своей учетной записи клиента Azure в **публикполициури**.

5. Замените все **authentication_cloud_url** экземпляры URL-адресом вашей Невис консоли администрирования

6. **Сохраните** изменения в файле.

### <a name="customize-your-trustframeworkextensionsxml"></a>Настройка TrustFrameworkExtensions.xml

1. В интегрированной среде разработки перейдите в папку [**политики**](https://github.com/azure-ad-b2c/partner-integrations/tree/master/samples/Nevis/policy) .

2. Откройте файл [**TrustFrameworkExtensions.xml**](https://github.com/azure-ad-b2c/partner-integrations/blob/master/samples/Nevis/policy/TrustFrameworkExtensions.xml) .

3. Замените **йоуртенант** именем своей учетной записи клиента Azure в **TenantId**.

4. Замените **йоуртенант** именем своей учетной записи клиента Azure в **публикполициури**.

5. В разделе **басеполици** в **TenantId** также замените _йоуртенант_ на имя учетной записи клиента Azure.

6. В разделе **BuildingBlocks** замените **LoadUri** URL-адресом ссылки на большой двоичный объект _nevis.html_ в вашей учетной записи хранилища больших двоичных объектов.

7. **Сохраните** файл.

### <a name="customize-your-signuporsigninxml"></a>Настройка SignUpOrSignin.xml

1. В интегрированной среде разработки перейдите в папку [**политики**](https://github.com/azure-ad-b2c/partner-integrations/tree/master/samples/Nevis/policy) .

2. Откройте файл [**SignUpOrSignin.xml**](https://github.com/azure-ad-b2c/partner-integrations/blob/master/samples/Nevis/policy/SignUpOrSignin.xml) .

3. Замените **йоуртенант** именем своей учетной записи клиента Azure в **TenantId**.

4. Замените **йоуртенант** именем своей учетной записи клиента Azure в **публикполициури**.

5. В разделе **басеполици** в **TenantId** также замените **йоуртенант** на имя учетной записи клиента Azure.

6. **Сохраните** файл.

### <a name="upload-your-custom-policies-to-azure-ad-b2c"></a>Отправка пользовательских политик в Azure AD B2C

1. Откройте домашнюю страницу [клиента Azure AD B2C](https://portal.azure.com/#blade/Microsoft_AAD_B2CAdmin/TenantManagementMenuBlade/overview) .

2. Выберите **Инфраструктура процедур идентификации**.

3. Выберите **Отправить настраиваемую политику**.

4. Выберите измененный файл **TrustFrameworkBase.xml** .

5. Установите флажок **Перезаписать пользовательскую политику, если она уже существует** .
6. Щелкните **Отправить**.

7. Повторите шаги 5 и 6 для **TrustFrameworkExtensions.xml**.

8. Повторите шаги 5 и 6 для **SignUpOrSignin.xml**.

## <a name="test-the-user-flow"></a>Тестирование потока пользователя

### <a name="test-account-creation-and-nevis-access-app-setup"></a>Создание тестовой учетной записи и установка приложения "Невис Access"

1. Откройте домашнюю страницу [клиента Azure AD B2C](https://portal.azure.com/#blade/Microsoft_AAD_B2CAdmin/TenantManagementMenuBlade/overview) .

2. Выберите **Инфраструктура процедур идентификации**.

3. Прокрутите вниз до раздела пользовательские политики и выберите **B2C_1A_signup_signin**.

4. Выберите **Запустить сейчас**.

5. Во всплывающем окне выберите **зарегистрироваться сейчас**.

6. Добавьте свой адрес электронной почты.

7. Выберите **Отправить проверочный код**.

8. Скопируйте код проверки из сообщения электронной почты.

9. Нажмите кнопку **Проверить**.

10. Заполните форму новым паролем и отображаемым именем.

11. Нажмите кнопку **создания**.

12. Вы перейдете на страницу сканирования QR-кода.

13. На телефоне откройте **приложение "Невис Access**".

14. Выберите **идентификатор лица**.

15. Когда на экране появится сообщение **Регистрация средства проверки подлинности прошла успешно**, нажмите кнопку **продолжить**.

16. На телефоне снова Пройдите проверку подлинности с помощью вашего лица.

17. Вы перейдете на целевую страницу [JWT.MS](https://jwt.ms) , на которой отображаются сведения о декодированном маркере.

### <a name="test-the-pure-passwordless-sign-in"></a>Тестирование чисто безпарольного входа в систему

1. В разделе **инфраструктура процедур идентификации** выберите **B2C_1A_signup_signin**.

2. Выберите **Запустить сейчас**.

3. Во всплывающем окне выберите **Проверка подлинности без пароля**.

4. Укажите свой адрес электронной почты.

5. Выберите **Continue** (Продолжить).

6. На телефоне в окне уведомления выберите " **Невис Access App Notification**".

7. Пройдите проверку подлинности с помощью лица.

8. Вы автоматически перейдете на целевую страницу [JWT.MS](https://jwt.ms) , на которой отображаются маркеры.

## <a name="next-steps"></a>Следующие шаги

Дополнительные сведения см. в следующих статьях.

- [Пользовательские политики в Azure AD B2C](./custom-policy-overview.md)

- [Приступая к работе с пользовательскими политиками в Azure AD B2C](./custom-policy-get-started.md?tabs=applications)