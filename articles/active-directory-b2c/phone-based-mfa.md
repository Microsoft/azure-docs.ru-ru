---
title: Защита MFA на основе телефона в Azure AD B2C
titleSuffix: Azure AD B2C
description: Ознакомьтесь с советами по защите многофакторной проверки подлинности на основе телефона (MFA) в Azure AD B2C клиенте с помощью Azure Monitor Log Analytics отчетов и оповещений. Используйте нашу книгу для идентификации мошеннических телефонных проверок подлинности и устранения мошеннических попыток входа. =
services: active-directory-b2c
author: msmimart
manager: celestedg
ms.service: active-directory
ms.topic: how-to
ms.workload: identity
ms.date: 02/01/2021
ms.author: mimart
ms.subservice: B2C
ms.openlocfilehash: 3ca73e020009817001f309ddf29c2984a8541026
ms.sourcegitcommit: ea822acf5b7141d26a3776d7ed59630bf7ac9532
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/03/2021
ms.locfileid: "99527736"
---
# <a name="securing-phone-based-multi-factor-authentication-mfa"></a>Защита многофакторной проверки подлинности на основе телефона (MFA)

[!INCLUDE [active-directory-b2c-public-preview](../../includes/active-directory-b2c-public-preview.md)]

При использовании многофакторной идентификации (MFA) Azure Active Directory (Azure AD) пользователи могут получить автоматический голосовой вызов по номеру телефона, который они зарегистрируют для проверки. Злоумышленники могут воспользоваться этим методом, создав несколько учетных записей и наведя телефонные звонки без завершения процесса регистрации MFA. Эти многочисленные неудачные попытки входа могут привести к исчерпанию разрешенных попыток регистрации, предотвращая регистрацию других пользователей для новых учетных записей в клиенте Azure AD B2C. Для защиты от таких атак можно использовать Azure Monitor для мониторинга сбоев проверки подлинности телефона и устранения мошеннических входов.

## <a name="prerequisites"></a>Предварительные требования

Прежде чем начать, создайте [рабочую область log Analytics](azure-monitor.md).

## <a name="create-a-phone-based-mfa-events-workbook"></a>Создание книги с событиями MFA на основе телефона

[Azure AD B2C отчеты & репозитории оповещений](https://github.com/azure-ad-b2c/siem#phone-authentication-failures) в GitHub содержит артефакты, которые можно использовать для создания и публикации отчетов, оповещений и панелей мониторинга на основе журналов Azure AD B2C. Черновик книги, показанной ниже, выделяет ошибки, связанные с телефоном.

### <a name="overview-tab"></a>Вкладка "Обзор"

На вкладке **Обзор** отображается следующая информация.

- Причины сбоев (общее число неудачных попыток проверки подлинности по телефону для каждой из указанных причин)
- Заблокировано из-за неправильной репутации
- IP-адрес с неудачными проверками подлинности телефона (общее число неудачных попыток проверки подлинности для каждого заданного IP-адреса)
- Номера телефонов с IP-адресом — неудачные проверки подлинности телефона
- Браузер (ошибок проверки подлинности телефона на клиентский браузер)
- Операционная система (ошибок проверки подлинности телефона на клиентскую операционную систему)

![Вкладка "Обзор"](media/phone-based-mfa/overview-tab.png)

### <a name="details-tab"></a>Вкладка "Подробные сведения"

На вкладке **сведения** отображается следующая информация.

- Политика Azure AD B2C — сбой проверки подлинности телефона
- Ошибки проверки подлинности телефона по номеру телефона — диаграмма времени (настраиваемая временная шкала)
- Сбои проверки подлинности телефона по Azure AD B2C политике — диаграмма времени (настраиваемая временная шкала)
- Ошибки проверки подлинности телефона по IP-адресу — диаграмма времени (настраиваемая временная шкала)
- Выберите номер телефона для просмотра сведений об ошибке (выберите номер телефона для подробного списка сбоев).

![Вкладка сведений 1 из 3](media/phone-based-mfa/details-tab-1.png)

![Вкладка "сведения" 2 из 3](media/phone-based-mfa/details-tab-2.png)

![Вкладка "сведения" 3 из 3](media/phone-based-mfa/details-tab-3.png)

## <a name="use-the-workbook-to-identify-fraudulent-sign-ups"></a>Использование книги для обнаружения мошеннических входов

Книгу можно использовать для анализа событий MFA на основе телефона и определения потенциально вредоносного использования службы телефонии.

1. Чтобы понять, что является нормальным для вашего клиента, ответьте на следующие вопросы:

   - Где находятся регионы, из которых предполагается наличие MFA на основе телефона?
   - Изучите причины, указанные для неудачных попыток MFA на основе телефона; считаются ли они нормальными или ожидаемыми?

2. Распознают характеристики мошеннической регистрации:

   - **На основе расположения**. Изучите **ошибки проверки подлинности телефона по IP-адресу** для всех учетных записей, связанных с расположениями, из которых вы не ожидаете регистрации пользователей.

   > [!NOTE]
   > Указанный IP-адрес является приблизительным регионом.

   - **На основе скорости**: Взгляните на **неудачные попытки проверки подлинности на телефоне (в день)**, которая указывает номера телефонов, которые задают необычное количество неудачных попыток проверки подлинности телефона в день, упорядоченные от самого высокого (слева) к наименьшему (правому).

3. Чтобы уменьшить количество поддельных входов, выполните действия, описанные в следующем разделе.
 

## <a name="mitigate-fraudulent-sign-ups"></a>Устранение мошеннических входов

Выполните следующие действия, чтобы снизить риск поддельного числа входов.

- Используйте **рекомендованные** версии потоков пользователей для выполнения следующих задач:
     
   - [Включите функцию одноразового секретного кода (OTP) электронной почты](phone-authentication-user-flows.md) для MFA (применяется как в потоках регистрации, так и при входе в систему).
   - [Настройте политику условного доступа](conditional-access-identity-protection-setup.md) , чтобы блокировать входы на основе расположения (применяется только к потокам входа, а не к потокам регистрации).
   - Используйте соединители API для [интеграции с решением Anti-Bot, например reCAPTCHA](https://github.com/Azure-Samples/active-directory-b2c-node-sign-up-user-flow-captcha) (применяется для потоков регистрации).

- Удалите коды стран, которые не относятся к вашей организации, из раскрывающегося меню, в котором пользователь проверяет свой номер телефона (это изменение будет применяться к последующим входам):
    
   1. Войдите на [портал Azure](https://portal.azure.com) с правами глобального администратора клиента Azure AD B2C.

   2. Убедитесь, что используете каталог с клиентом Azure AD B2C, выбрав фильтр **Каталог и подписка** в меню вверху и каталог с вашим клиентом.

   3. Выберите **Все службы** в левом верхнем углу окна портала Azure, найдите службу **Azure AD B2C** и выберите ее.

   4. Выберите поток пользователя, а затем выберите **языки**. Выберите язык географического расположения Организации, чтобы открыть панель сведений о языке. (В этом примере мы будем выбирать **английский EN** для США). Выберите **страницу многофакторная проверка подлинности** и нажмите кнопку **скачать значения по умолчанию (EN)**.
 
      ![Отправка новых переопределений для скачивания значений по умолчанию](media/phone-based-mfa/download-defaults.png)

   5. Откройте JSON файл, скачанный на предыдущем шаге. В файле найдите `DEFAULT` и замените строку на `"Value": "{\"DEFAULT\":\"Country/Region\",\"US\":\"United States\"}"` . Не забудьте задать `Overrides` значение `true` .

   > [!NOTE]
   > Список допустимых кодов стран можно настроить в `countryList` элементе (см. [пример страницы "телефонный фактор проверки подлинности](localization-string-ids.md#phone-factor-authentication-page-example)").

   7. Сохраните файл JSON. На панели сведения о языке в разделе **Отправка новых переопределений** выберите измененный файл JSON, чтобы передать его.

   8. Закройте панель и выберите **выполнить поток пользователя**. В этом примере убедитесь, что **США** является единственным доступным кодом страны в раскрывающемся списке:
 
      ![Раскрывающийся список кода страны](media/phone-based-mfa/country-code-drop-down.png)

## <a name="next-steps"></a>Следующие шаги

- Сведения об использовании [защиты идентификации и условного доступа для Azure AD B2C](conditional-access-identity-protection-overview.md) 

- Применение [условного доступа к потокам пользователей в Azure Active Directory B2C](conditional-access-user-flow.md)