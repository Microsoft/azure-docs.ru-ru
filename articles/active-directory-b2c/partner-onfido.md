---
title: Руководство по настройке Azure Active Directory B2C с помощью Онфидо
titleSuffix: Azure AD B2C
description: Узнайте, как интегрировать проверку подлинности Azure AD B2C в Онфидо для идентификатора документа и проверки биометрического лица
services: active-directory-b2c
author: gargi-sinha
manager: martinco
ms.service: active-directory
ms.workload: identity
ms.topic: how-to
ms.date: 08/03/2020
ms.author: gasinh
ms.subservice: B2C
ms.openlocfilehash: 46c6eac80ddbff73d99e05c070e66aa1700da174
ms.sourcegitcommit: 772eb9c6684dd4864e0ba507945a83e48b8c16f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "96928636"
---
# <a name="tutorial-for-configuring-onfido-with-azure-active-directory-b2c"></a>Руководство по настройке Онфидо с помощью Azure Active Directory B2C

В этом примере учебника мы предоставляем рекомендации по интеграции Azure AD B2C с [онфидо](https://onfido.com/). Онфидо — это приложение для проверки биометрических ИДЕНТИФИКАТОРов документов и лиц. Она позволяет компаниям соответствовать требованиям *клиентов* и удостоверений в режиме реального времени. Онфидо использует сложную проверку подлинности на основе искусственного интеллекта, которая сначала проверяет идентификатор фотографии, а затем сопоставляет ее с их биометрией. Это решение связывает цифровое удостоверение с реальным человеком и обеспечивает безопасность при адаптации, одновременно уменьшая мошенничество.

В этом примере мы подключимся к службе Онфидо в потоке регистрации или входа, чтобы выполнить проверку личности. Информированные решения о том, какой продукт и служба у пользователя могут получить доступ, создаются на основе результатов Онфидо.

## <a name="prerequisites"></a>Предварительные условия

Чтобы приступить к работе, вам потребуется:

- Подписка Azure AD. Если у вас нет подписки, вы можете получить [бесплатную учетную запись](https://azure.microsoft.com/free/).

- [Клиент Azure AD B2C](./tutorial-create-tenant.md) , связанный с вашей подпиской Azure.

- [Пробная учетная запись](https://onfido.com/signup/)онфидо.

## <a name="scenario-description"></a>Описание сценария

Интеграция Онфидо включает следующие компоненты:

- Azure AD B2C клиент — сервер авторизации, отвечающий за проверку учетных данных пользователя на основе пользовательских политик, определенных в клиенте. Он также известен как поставщик удостоверений. В нем размещается клиентское приложение Онфидо, которое собирает пользовательские документы и передает их в службу API Онфидо.

- Клиент онфидо — настраиваемая клиентская программа для сбора документов JavaScript, развернутая в других веб-страницах. Собирает документы и выполняет Предварительные проверки, например размер и качество документа.

- Промежуточный API-интерфейс RESTful — предоставляет конечные точки для клиента Azure AD B2C для взаимодействия со службой API Онфидо, обработки данных и соблюдения требований безопасности обоих служб.

- Служба API онфидо — серверная служба, предоставляемая Онфидо, которая сохраняет и проверяет документы, предоставленные пользователем.

Реализация показана на следующей схеме архитектуры.

![снимок экрана для онфидо — схема архитектуры](media/partner-onfido/onfido-architecture-diagram.png)

|Шаг | Описание |
|:-----| :-----------|
| 1. | Пользователь прибывает на странице входа. Пользователь регистрируется для создания новой учетной записи и ввода данных на страницу. Azure AD B2C собирает атрибуты пользователя. Клиентское приложение онфидо, размещенное в Azure AD B2C, выполняет предварительную проверку сведений о пользователе.
| 2. | Azure AD B2C вызывает API среднего уровня и передает атрибуты пользователя.
| 3. | API среднего уровня собирает атрибуты пользователя и преобразует их в формат, который может использовать API Онфидо. Затем отправляет его в Онфидо.
| 4. | Онфидо потребляет информацию и обрабатывает ее для проверки идентификации пользователя. Затем он возвращает результат в API среднего уровня.
| 5. | API среднего уровня обрабатывает сведения и отправляет соответствующие сведения в правильном формате JSON для Azure AD B2C.
| 6. | Azure AD B2C получает сведения от API среднего уровня. Если отображается ответ на сбой, пользователю выдается сообщение об ошибке. Если отображается ответ об успешном выполнении, пользователь проходит проверку подлинности и записывается в каталог.

## <a name="onboard-with-onfido"></a>Подключение с помощью Онфидо

1. Чтобы создать учетную запись Онфидо, обратитесь в [онфидо](https://onfido.com/signup/).

2. После создания учетной записи создайте [ключ API](https://documentation.onfido.com/). Ключи в режиме реального времени оплачиваются, однако вы можете использовать [ключи песочницы для тестирования](https://documentation.onfido.com/?javascript#sandbox-and-live-differences) решения. Ключи "песочницы" создают ту же структуру результатов, что и динамические ключи. Однако результаты всегда предварительно определены. Документы не обрабатываются или не сохраняются.

>[!NOTE]
> Этот ключ потребуется позже.

Дополнительные сведения о Онфидо см. в разделе [Документация по API онфидо](https://documentation.onfido.com) и [Центр разработчиков онфидо](https://developers.onfido.com).  

## <a name="configure-azure-ad-b2c-with-onfido"></a>Настройка Azure AD B2C с помощью Онфидо

### <a name="part-1---deploy-the-api"></a>Часть 1. Развертывание API

- Разверните предоставленный [код API](https://github.com/azure-ad-b2c/partner-integrations/tree/master/samples/OnFido-Combined/API/Onfido.Api) в службе Azure. Код можно опубликовать из Visual Studio, следуя этим [инструкциям](/visualstudio/deployment/quickstart-deploy-to-azure).
- Настройка CORS, добавление **разрешенного источника** как HTTPS://{your_tenant_name}. b2clogin. com

>[!NOTE]
>Вам потребуется URL-адрес развернутой службы, чтобы настроить Azure AD с использованием требуемых параметров.

#### <a name="adding-sensitive-configuration-settings"></a>Добавление конфиденциальных параметров конфигурации

Параметры приложения можно настроить в [службе приложений в Azure](../app-service/configure-common.md#configure-app-settings). Служба приложений позволяет безопасно настроить параметры, не проверяя их в репозитории. API-интерфейсу для остальных компонентов необходимо присвоить следующие параметры:

| Имя параметра приложения | Источник | Примечания |
|:-------------------------|:-------|:-------|
|Онфидосеттингс: AuthToken| Учетная запись онфидо |

### <a name="part-2---deploy-the-ui"></a>Часть 2. Развертывание пользовательского интерфейса

#### <a name="configure-your-storage-location"></a>Настройка расположения хранилища

1. Настройка [контейнера хранилища BLOB-объектов в учетной записи хранения](../storage/blobs/storage-quickstart-blobs-portal.md#create-a-container)

2. Храните файлы пользовательского интерфейса из [папки пользовательского интерфейса](https://github.com/azure-ad-b2c/partner-integrations/tree/master/samples/OnFido-Combined/UI) в контейнер больших двоичных объектов.

3. Разрешите доступ CORS к контейнеру хранилища, который вы создали, выполнив следующие инструкции:

   а. Выберите **Параметры**  > **разрешенный источник**, введите `https://{your_tenant_name}.b2clogin.com` . Замените имя клиента на имя клиента Azure AD B2C. Например, https://fabrikam.b2clogin.com . При вводе имени клиента используйте все строчные буквы.

   b. Для **разрешенных методов** выберите `GET` и `PUT` .

   В. Нажмите кнопку **Сохранить**.

#### <a name="update-ui-files"></a>Обновление файлов пользовательского интерфейса

1. В файлах пользовательского интерфейса перейдите в папку [ **ocean_blue**](https://github.com/azure-ad-b2c/partner-integrations/tree/master/samples/OnFido-Combined/UI/ocean_blue)

2. Откройте каждый HTML-файл.

3. Найдите и замените {My-UI-BLOB-Container-URL} URL-адресом расположения папок **ocean_blue**, **расп** и **Assets** пользовательского интерфейса.

4. Найдите и замените {ваш-Intermediate-API-URL} URL-адресом промежуточной службы приложений API.

#### <a name="upload-your-files"></a>Отправка файлов.

1. Храните файлы пользовательского интерфейса из папки пользовательского интерфейса в контейнер больших двоичных объектов.

2. Используйте [Обозреватель службы хранилища Azure](../virtual-machines/disks-use-storage-explorer-managed-disks.md) для управления файлами и разрешениями на доступ.

### <a name="part-3---configure-azure-ad-b2c"></a>Часть 3. Настройка Azure AD B2C

#### <a name="replace-the-configuration-values"></a>Замена значений конфигурации

В предоставленных [пользовательских политиках](https://github.com/azure-ad-b2c/partner-integrations/tree/master/samples/OnFido-Combined/Policies)найдите следующие заполнители и замените их соответствующими значениями из своего экземпляра.

| Заполнитель | Замена значением | Пример  |
|:---------------|:----------------|:-------------------|
| {your_tenant_name}  | Короткое имя вашего клиента |  "йоуртенант" из yourtenant.onmicrosoft.com |
| {your_tenantID} | ИД клиента Azure AD B2C | 01234567-89ab-cdef-0123-456789abcdef           |
| {your_tenant_IdentityExperienceFramework_appid}        | Идентификатор приложения IdentityExperienceFramework, настроенного в клиенте Azure AD B2C      | 01234567-89ab-cdef-0123-456789abcdef         |
| {your_tenant_ ProxyIdentityExperienceFramework _appid} | Идентификатор приложения ProxyIdentityExperienceFramework, настроенного в клиенте Azure AD B2C | 01234567-89ab-cdef-0123-456789abcdef         |
| {your_tenant_extensions_appid}                         | Идентификатор приложения для хранилища вашего клиента                                      | 01234567-89ab-cdef-0123-456789abcdef         |
| {your_tenant_extensions_app_objectid}                  | Идентификатор объекта приложения хранилища вашего клиента                                   | 01234567-89ab-cdef-0123-456789abcdef         |
| {your_app_insights_instrumentation_key} | Ключ инструментирования экземпляра App Insights *| 01234567-89ab-cdef-0123-456789abcdef|
|{your_ui_file_base_url}| URL-адрес расположения, в котором находятся папки пользовательского интерфейса **ocean_blue**, **расп** и **Assets** | https://yourstorage.blob.core.windows.net/UI/|
| {your_app_service_URL}                                 | URL-адрес настроенной службы приложений                                             | `https://yourapp.azurewebsites.net`          |

* App Insights может находиться в другом клиенте. Этот шаг является необязательным. Удалите соответствующие TechnicalProfiles и Орчестратионстепс, если они не требуются.

### <a name="part-4---configure-the-azure-ad-b2c-policy"></a>Часть 4. Настройка политики Azure AD B2C

Инструкции по настройке клиента Azure AD B2C и настройке политик см. в этом [документе](./custom-policy-get-started.md?tabs=applications#custom-policy-starter-pack) .

>[!NOTE]
> Рекомендуется, чтобы клиенты добавили уведомление о согласия на страницу коллекции атрибутов. Уведомлять пользователей о том, что сведения будут отправляться сторонним службам для проверки личности.

## <a name="test-the-user-flow"></a>Тестирование потока пользователя

1. Откройте клиент Azure AD B2C и в разделе политики выберите **инфраструктура процедур идентификации**.

2. Выберите ранее созданный **сигнупсигнин**.

3. Выберите **запустить поток пользователя** и выберите параметры:

   а. **Приложение**: выберите зарегистрированное приложение (пример — JWT)

   b. **URL-адрес ответа**: выберите **URL-адрес перенаправления**

   c. Выберите **Выполнить поток пользователя**.

4. Последовательно выберите процесс регистрации и создайте учетную запись.

5. Служба онфидо будет вызываться во время потока, после создания пользовательского атрибута. Если поток неполон, убедитесь, что пользователь не сохранен в каталоге.

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения см. в следующих статьях:

- [Пользовательские политики в Azure AD B2C](./custom-policy-overview.md)

- [Приступая к работе с пользовательскими политиками в Azure AD B2C](./custom-policy-get-started.md?tabs=applications)
