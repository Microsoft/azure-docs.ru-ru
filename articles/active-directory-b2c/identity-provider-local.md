---
title: Настройка поставщика удостоверений локальной учетной записи Azure AD B2C
titleSuffix: Azure AD B2C
description: Определение типов удостоверений может использоваться для регистрации или входа (адрес электронной почты, имя пользователя, номер телефона) в клиенте Azure Active Directory B2C.
services: active-directory-b2c
author: msmimart
manager: celestedg
ms.service: active-directory
ms.workload: identity
ms.topic: how-to
ms.date: 01/19/2021
ms.author: mimart
ms.subservice: B2C
zone_pivot_groups: b2c-policy-type
ms.openlocfilehash: b2baff33d9e91e1b5259d79eca0a22535c00f419
ms.sourcegitcommit: 867cb1b7a1f3a1f0b427282c648d411d0ca4f81f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "100555247"
---
# <a name="set-up-the-local-account-identity-provider"></a>Настройка поставщика удостоверений локальной учетной записи

[!INCLUDE [active-directory-b2c-choose-user-flow-or-custom-policy](../../includes/active-directory-b2c-choose-user-flow-or-custom-policy.md)]

Azure AD B2C предоставляет различные способы проверки подлинности пользователей. Пользователи могут войти в локальную учетную запись с помощью имени пользователя и пароля, проверки телефона (также известной как проверка подлинности без пароля) или поставщиков удостоверений социальных сетей. Регистрация электронной почты включена по умолчанию в параметрах поставщика удостоверений локальной учетной записи. 

В этой статье описывается, как пользователи создают учетные записи, локальные для этого клиента Azure AD B2C. Для социальных сетей или корпоративных удостоверений, где удостоверение пользователя управляется федеративным поставщиком удостоверений, например Facebook, и Google, см. статью [Добавление поставщика удостоверений](add-identity-provider.md).

## <a name="email-sign-in"></a>Вход в электронную почту

С помощью параметра электронная почта пользователи могут входить в систему, используя свой адрес электронной почты и пароль:

- При **входе в систему** пользователям предлагается ввести свои адреса электронной почты и пароли.
- **Зарегистрируйтесь**, пользователю будет предложено ввести адрес электронной почты, который будет проверен при регистрации (необязательно) и станет идентификатором входа. Затем пользователь вводит любые другие сведения, запрашиваемые на странице регистрации, например отображаемое имя, имя и фамилия. Затем нажмите кнопку продолжить, чтобы создать учетную запись.
- **Сброс пароля**. пользователи должны ввести и подтвердить свой адрес электронной почты, после чего пользователь может сбросить пароль.

![Регистрация или вход в электронную почту](./media/identity-provider-local/local-account-email-experience.png)

## <a name="username-sign-in"></a>Вход с именем пользователя

С помощью параметра User пользователи могут входить в систему, используя имя пользователя и пароль:

- **Вход**. пользователям предлагается ввести имя пользователя и пароль.
- **Регистрация**. пользователям будет предложено ввести имя пользователя, которое станет идентификатором входа. Кроме того, пользователям будет предложено ввести адрес электронной почты, который будет проверяться при регистрации. Адрес электронной почты будет использоваться во время потока сброса пароля. Пользователь вводит любые другие сведения, запрашиваемые на странице регистрации, например отображаемое имя, имя и фамилия. Затем пользователь выбирает продолжить создание учетной записи.
- **Сброс пароля**. пользователи должны ввести свое имя пользователя и связанный адрес электронной почты. Адрес электронной почты должен быть проверен, после чего пользователь может сбросить пароль.

![Регистрация имени пользователя или вход в систему](./media/identity-provider-local/local-account-username-experience.png)

## <a name="phone-sign-in-preview"></a>Вход с телефона (Предварительная версия)

Проверка подлинности без пароля — это тип проверки подлинности, в котором пользователю не нужно выполнять вход с паролем. При регистрации и входе с помощью телефона пользователь может зарегистрироваться в приложении, используя номер телефона в качестве основного идентификатора входа. Во время регистрации и входа пользователь будет иметь следующие возможности:

- **Вход**. Если у пользователя есть существующая учетная запись с номером телефона в качестве идентификатора, пользователь вводит свой номер телефона и выбирает *Вход*. Они подтверждают страну и номер телефона, выбирая *Continue (продолжить*) и отправляют одноразовый код проверки на свой телефон. Пользователь вводит код проверки и выбирает *продолжение* входа.
- **Регистрация**. Если у пользователя еще нет учетной записи для своего приложения, его можно создать, щелкнув ссылку *зарегистрироваться сейчас* . 
    1. Появится страница регистрации, где пользователь выбирает *страну*, вводит свой номер телефона и выбирает *отправить код*. 
    1. Одноразовый код проверки отправляется на номер телефона пользователя. Пользователь вводит *код проверки* на странице регистрации, а затем выбирает команду *проверить код*. (Если пользователь не может получить код, он может выбрать пункт *отправить новый код*). 
    1. Пользователь вводит любые другие сведения, запрашиваемые на странице регистрации, например отображаемое имя, имя и фамилия. Затем выберите Continue (Продолжить).
    1. Затем пользователю предлагается ввести **электронное сообщение для восстановления**. Пользователь вводит свой адрес электронной почты, а затем выбирает *отправить код проверки*. Код отправляется в папку "Входящие" электронной почты пользователя, которую они могут получить и ввести в поле код проверки. Затем пользователь выбирает команду проверить код.
    1. После проверки кода пользователь выбирает *создать* , чтобы создать свою учетную запись. 

![Регистрация или вход в телефон](./media/identity-provider-local/local-account-phone-experience.png)

### <a name="pricing"></a>Цены

Одноразовые пароли отправляются пользователям с помощью текстовых сообщений SMS. В зависимости от оператора мобильной сети может быть оплачено каждое отправленное сообщение. Сведения о ценах см. в разделе " **Специальные расходы** " статьи [Azure Active Directory B2C цены](https://azure.microsoft.com/pricing/details/active-directory-b2c/).

> [!NOTE]
> Многофакторная идентификация (MFA) отключена по умолчанию при настройке пользовательского потока с помощью регистрации телефона. MFA можно включить в потоках пользователей с помощью телефонной регистрации, но поскольку номер телефона используется в качестве основного идентификатора, единственным вариантом, доступным для второго фактора проверки подлинности, является одноразовый секретный код.

### <a name="phone-recovery"></a>Восстановление по телефону

При включении регистрации и входа с помощью телефона в потоке пользователя рекомендуется включить функцию восстановления электронной почты. С помощью этой функции пользователь может предоставить адрес электронной почты, который можно использовать для восстановления учетной записи, если у них нет телефона. Этот адрес электронной почты используется только для восстановления учетной записи. Его нельзя использовать для входа в систему.

- Когда запрос **на** восстановление по электронной почте включен, пользователь регистрируется в первый раз, и вам будет предложено проверить электронное письмо с резервной копией. Пользователь, который не предоставил электронное сообщение для восстановления, прежде чем получит запрос на проверку сообщения электронной почты при следующем входе в систему.

- Если электронная почта для восстановления **отключена**, регистрация пользователя или вход в систему не отображается в сообщении электронной почты о восстановлении.
 
На следующих снимках экрана показан поток восстановления телефона.

![Поток пользователя для восстановления телефона](./media/identity-provider-local/local-account-change-phone-flow.png)


## <a name="phone-or-email-sign-in-preview"></a>Вход по телефону или электронной почте (Предварительная версия)

Вы можете объединить вход с помощью [телефона](#phone-sign-in-preview)и [войти в электронную почту](#email-sign-in). На странице регистрации или входа пользователь может ввести номер телефона или адрес электронной почты. На основе введенных пользователем данных Azure AD B2C переводит пользователя в соответствующий поток. 

![Телефон или электронная почта для регистрации или входа в систему](./media/identity-provider-local/local-account-phone-and-email-experience.png)

::: zone pivot="b2c-user-flow"

## <a name="configure-local-account-identity-provider-settings"></a>Настройка параметров поставщика удостоверений локальной учетной записи

Можно настроить локальные поставщики удостоверений, доступные для использования в потоке пользователя, включив или отключив поставщиков (адрес электронной почты, имя пользователя или номер телефона).  На уровне клиента можно включить несколько локальных поставщиков удостоверений.

Пользовательский поток можно настроить на использование только одного из поставщиков удостоверений локальных учетных записей в любой момент времени. Для каждого потока пользователей может быть задан другой поставщик удостоверений локальной учетной записи, если на уровне клиента было включено более одного.

1. Войдите на [портал Azure](https://portal.azure.com).
1. Убедитесь, что вы используете каталог, содержащий клиент Azure AD B2C, выбрав фильтр " **каталог и подписка** " в верхнем меню и выбрав Каталог, содержащий ваш клиент Azure AD.
1. Выберите **Все службы** в левом верхнем углу окна портала Azure, а затем найдите и выберите **Azure AD B2C**.
1. В разделе **Управление** выберите **Поставщики удостоверений**.
1. В списке поставщиков удостоверений выберите **Локальная учетная запись**.
1. На странице **Настройка локальной IDP** выберите по крайней мере один из допустимых типов удостоверений, которые потребители могут использовать для создания локальных учетных записей в клиенте Azure AD B2C.
1. Щелкните **Сохранить**.

## <a name="configure-your-user-flow"></a>Настройка потока пользователей

1. В меню слева портал Azure выберите **Azure AD B2C**.
1. В разделе **Политики** выберите **Пользовательские потоки (политики)** .
1. Выберите поток пользователя, для которого вы хотите настроить процедуру регистрации и входа.
1. Выбор **поставщиков удостоверений**
1. В разделе **локальные учетные записи** выберите одну из следующих: **Регистрация по электронной почте**,  **идентификатор пользователя** **, регистрация, Телефон**, **Электронная почта** или **нет**.

### <a name="enable-the-recovery-email-prompt"></a>Включение запроса на восстановление по электронной почте

Если выбран вариант **Телефонная регистрация**, **Телефон или электронная почта** , включите запрос на восстановление по электронной почте.

1. Войдите на [портал Azure](https://portal.azure.com).
1. Выберите значок **Каталог и подписка** в верхней панели инструментов портала, а затем выберите каталог, содержащий клиент Azure AD B2C.
1. На портале Azure найдите и выберите **Azure AD B2C**.
1. В Azure AD B2C в разделе **политики** выберите **потоки пользователей**.
1. Выберите поток пользователя из списка.
1. В разделе **Параметры** выберите **Свойства**.
1. Рядом с **параметром Включить запрос электронной почты для восстановления по номеру телефона регистрация и вход (Предварительная версия)** выберите:
   - **Для отображения запроса на восстановление** по электронной почте во время регистрации и входа.
   - **Выкл** ., чтобы скрыть запрос на восстановление по электронной почте.
1. Щелкните **Сохранить**.

::: zone-end

::: zone pivot="b2c-custom-policy"

## <a name="get-the-starter-pack"></a>Получение начального пакета

Пользовательские политики — это набор XML-файлов, отправляемых в клиент Azure AD B2C для определения путей взаимодействия пользователя. Мы предоставляем начальные пакеты с несколькими предварительно созданными политиками. Скачайте соответствующий начальный пакет: 

- [Вход в электронную почту](https://github.com/Azure-Samples/active-directory-b2c-custom-policy-starterpack/tree/master/SocialAndLocalAccounts)
- [Вход с именем пользователя](https://github.com/azure-ad-b2c/samples/tree/master/policies/username-signup-or-signin)
- [Вход с телефона](https://github.com/Azure-Samples/active-directory-b2c-custom-policy-starterpack/tree/master/scenarios/phone-number-passwordless). Выберите [SignUpOrSignInWithPhone.xml](https://github.com/Azure-Samples/active-directory-b2c-custom-policy-starterpack/blob/master/scenarios/phone-number-passwordless/SignUpOrSignInWithPhone.xml) политику проверяющей стороны. 
- [Вход по телефону или электронной почте](https://github.com/Azure-Samples/active-directory-b2c-custom-policy-starterpack/tree/master/scenarios/phone-number-passwordless). Выберите [SignUpOrSignInWithPhone.xml](https://github.com/Azure-Samples/active-directory-b2c-custom-policy-starterpack/blob/master/scenarios/phone-number-passwordless/SignUpOrSignInWithPhoneOrEmail.xml) политику проверяющей стороны.

После загрузки начального пакета.

1. Замените строку `yourtenant` именем вашего клиента Azure AD B2C в каждом файле. Например, если имя вашего клиента B2C — *contosob2c*, все экземпляры `yourtenant.onmicrosoft.com` должны иметь вид `contosob2c.onmicrosoft.com`.

1. Выполните действия, описанные в разделе [Добавление идентификаторов приложений в пользовательскую политику](custom-policy-get-started.md#add-application-ids-to-the-custom-policy) статьи [Приступая к работе с пользовательскими политиками в Azure Active Directory B2C](custom-policy-get-started.md). Например, обновите `/phone-number-passwordless/` **`Phone_Email_Base.xml`** **идентификаторы приложения (клиента)** двух приложений, зарегистрированных при выполнении необходимых условий, *IdentityExperienceFramework* и *ProxyIdentityExperienceFramework*.
1. Отправка файлов политики

::: zone-end

## <a name="next-steps"></a>Дальнейшие действия

- [Добавление внешних поставщиков удостоверений](add-identity-provider.md)
- [Создание потока пользователей](tutorial-create-user-flows.md)
