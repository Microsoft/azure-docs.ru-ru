---
title: Настройка потока принудительного сброса пароля в Azure AD B2C
titleSuffix: Azure AD B2C
description: Узнайте, как настроить принудительный поток сброса пароля в Azure Active Directory B2C.
services: active-directory-b2c
author: msmimart
manager: celestedg
ms.service: active-directory
ms.workload: identity
ms.topic: how-to
ms.date: 03/03/2021
ms.author: mimart
ms.subservice: B2C
zone_pivot_groups: b2c-policy-type
ms.openlocfilehash: 0477153b466702bec0fa2d5221fee1e054d06314
ms.sourcegitcommit: f3ec73fb5f8de72fe483995bd4bbad9b74a9cc9f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/04/2021
ms.locfileid: "102033782"
---
# <a name="set-up-a-force-password-reset-flow-in-azure-active-directory-b2c"></a>Настройка потока принудительного сброса пароля в Azure Active Directory B2C

[!INCLUDE [active-directory-b2c-choose-user-flow-or-custom-policy](../../includes/active-directory-b2c-choose-user-flow-or-custom-policy.md)]

Администратор может [сбросить пароль пользователя](manage-users-portal.md#reset-a-users-password) , если пользователь забыл свой пароль. Или вы хотите принудительно сбросить пароль. В этой статье вы узнаете, как принудительно сбросить пароль в этих сценариях.

## <a name="overview"></a>Обзор

Когда администратор сбрасывает пароль пользователя с помощью портал Azure, для атрибута [форцечанжепассворднекстсигнин](user-profile-attributes.md#password-profile-property) устанавливается значение `true` .

В процессе [входа и регистрации](add-sign-up-and-sign-in-policy.md) проверяется значение этого атрибута. После того как пользователь завершит вход, если атрибут имеет значение `true` , пользователь должен сбросить пароль. Затем для атрибута устанавливается значение back `false` .

![Принудительное выполнение сброса пароля](./media/force-password-reset/force-password-reset-flow.png)

Поток сброса пароля применяется к локальным учетным записям в Azure AD B2C, которые используют [адрес электронной почты](identity-provider-local.md#email-sign-in) или [имя пользователя](identity-provider-local.md#username-sign-in) с паролем для входа.

### <a name="force-a-password-reset-after-90-days"></a>Принудительный сброс пароля через 90 дней

Как администратор вы можете задать срок действия пароля пользователя 90 дней с помощью [MS Graph](microsoft-graph-operations.md). Через 90 дней значение атрибута [форцечанжепассворднекстсигнин](user-profile-attributes.md#password-profile-property) автоматически устанавливается равным `true` . Дополнительные сведения о настройке политики срока действия паролей пользователей см. в разделе [атрибут политики паролей](user-profile-attributes.md#password-policy-attribute).

После установки политики истечения срока действия паролей необходимо также настроить принудительное выполнение сброса пароля, как описано в этой статье.  

## <a name="prerequisites"></a>Предварительные требования

[!INCLUDE [active-directory-b2c-customization-prerequisites](../../includes/active-directory-b2c-customization-prerequisites.md)]

## <a name="configure-your-policy"></a>Настройка политики

::: zone pivot="b2c-user-flow"

Чтобы включить параметр **принудительного сброса пароля** в потоке пользователя регистрации или входа, выполните следующие действия.

1. Войдите на [портал Azure](https://portal.azure.com).
1. Выберите значок **Каталог и подписка** в верхней панели инструментов портала, а затем выберите каталог, содержащий клиент Azure AD B2C.
1. На портале Azure найдите и выберите **Azure AD B2C**.
1. Выберите **Потоки пользователей**.
1. Выберите пользовательский поток регистрации и входа в систему ( **рекомендуемый** тип), который требуется настроить.
1. В меню слева в разделе **Параметры** выберите пункт **свойства**.
1. В разделе **сложность пароля** выберите **принудительный сброс пароля**.
1. Щелкните **Сохранить**.

### <a name="test-the-user-flow"></a>Тестирование потока пользователя

1. Войдите в [портал Azure](https://portal.azure.com) в качестве администратора пользователя или администратора паролей. Дополнительные сведения о доступных ролях см. в разделе [назначение ролей администратора в Azure Active Directory](../active-directory/roles/permissions-reference.md#all-roles).
1. Выберите значок **Каталог и подписка** в верхней панели инструментов портала, а затем выберите каталог, содержащий клиент Azure AD B2C.
1. На портале Azure найдите и выберите **Azure AD B2C**.
1. Выберите **Пользователи**. Найдите и выберите пользователя, который будет использоваться для проверки сброса пароля, а затем нажмите кнопку **Сброс пароля**.
1. На портале Azure найдите и выберите **Azure AD B2C**.
1. Выберите **Потоки пользователей**.
1. Выберите пользовательский поток регистрации или входа ( **рекомендуемый** тип), который необходимо протестировать.
1. Выберите **Выполнить поток пользователя**.
1. В разделе **Приложение** выберите зарегистрированное ранее веб-приложение с именем *webapp1*. В поле **URL-адрес ответа** должно содержаться значение `https://jwt.ms`.
1. Выберите **Выполнить поток пользователя**.
1. Выполните вход, используя учетную запись пользователя, для которой необходимо сбросить пароль.
1. Теперь необходимо изменить пароль для пользователя. Измените пароль и щелкните **Продолжить**. Токен должен вернуться по адресу `https://jwt.ms` и отобразиться пользователю.

::: zone-end

::: zone pivot="b2c-custom-policy"

1. Получите пример принудительного сброса пароля на [GitHub](https://github.com/azure-ad-b2c/samples/tree/master/policies/force-password-reset).
1. В каждом файле замените строку `yourtenant` именем клиента Azure AD B2C. Например, если имя клиента B2C — *contosob2c*, все экземпляры `yourtenant.onmicrosoft.com` станут `contosob2c.onmicrosoft.com` .
1. Отправьте файлы политики в следующем порядке: политику расширения `TrustFrameworkExtensionsCustomForcePasswordReset.xml` , а затем политику проверяющей стороны `SignUpOrSigninCustomForcePasswordReset.xml` .

### <a name="test-the-policy"></a>Проверка политики

1. Войдите в [портал Azure](https://portal.azure.com) в качестве администратора пользователя или администратора паролей. Дополнительные сведения о доступных ролях см. в разделе [назначение ролей администратора в Azure Active Directory](../active-directory/roles/permissions-reference.md#all-roles).
1. Выберите значок **Каталог и подписка** в верхней панели инструментов портала, а затем выберите каталог, содержащий клиент Azure AD B2C.
1. На портале Azure найдите и выберите **Azure AD B2C**.
1. Выберите **Пользователи**. Найдите и выберите пользователя, который будет использоваться для проверки сброса пароля, а затем нажмите кнопку **Сброс пароля**.
1. На портале Azure найдите и выберите **Azure AD B2C**.
1. В разделе **Политики** выберите **Identity Experience Framework**.
1. Выберите `B2C_1A_signup_signin_Custom_ForcePasswordReset` политику, чтобы открыть ее. 
1. Для **приложения** выберите [ранее зарегистрированное](troubleshoot-custom-policies.md#troubleshoot-the-runtime)веб-приложение. В поле **URL-адрес ответа** должно содержаться значение `https://jwt.ms`.
1. Нажмите кнопку **Запустить сейчас** .
1. Выполните вход, используя учетную запись пользователя, для которой необходимо сбросить пароль.
1. Теперь необходимо изменить пароль для пользователя. Измените пароль и щелкните **Продолжить**. Токен должен вернуться по адресу `https://jwt.ms` и отобразиться пользователю.

::: zone-end

## <a name="next-steps"></a>Дальнейшие действия

Настройка [самостоятельного сброса пароля](add-password-reset-policy.md).
