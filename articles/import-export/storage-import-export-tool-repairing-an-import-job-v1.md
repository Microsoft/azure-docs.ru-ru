---
title: Восстановление задания импорта инструмента импорта и экспорта Azure версии 1 | Документация Майкрософт
description: Узнайте, как восстановить задание импорта, созданное и выполняемое с помощью службы импорта и экспорта Azure.
author: alkohli
services: storage
ms.service: storage
ms.topic: how-to
ms.date: 01/19/2021
ms.author: alkohli
ms.subservice: common
ms.openlocfilehash: b0eeb73ffb5436284f4f23cef943db0a3307a2b2
ms.sourcegitcommit: f0a3ee8ff77ee89f83b69bc30cb87caa80f1e724
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/26/2021
ms.locfileid: "105564574"
---
# <a name="repairing-an-import-job"></a>Исправление задания импорта
Иногда службе импорта и экспорта Microsoft Azure не удается скопировать некоторые файлы или их части в службу BLOB-объектов Windows Azure. Это может происходить по следующим причинам:  
  
-   файлы повреждены;  
  
-   повреждение дисков;  
  
-   ключ учетной записи хранения изменен при передаче файла.  
  
Средство импорт и экспорт Microsoft Azure можно запустить с файлами журнала копирования задания импорта. Средство отправляет недостающие файлы или части файла в учетную запись хранения Windows Azure для завершения задания импорта.  
  
## <a name="repairimport-parameters"></a>Параметры RepairImport

Для команды **RepairImport** можно определить следующие параметры. 
  
| Параметр | Описание |  
|-|-|  
|**/r:**<репаирфиле\>|**Обязательный.** Путь к файлу восстановления для отслеживания восстановления и возобновления прерванной операции восстановления. Каждый диск должен быть связан с одним и только одним файлом восстановления. При запуске восстановления для данного диска передайте путь к файлу восстановления, который еще не существует. Чтобы возобновить прерванную операцию восстановления, необходимо передать имя существующего файла восстановления. Всегда указывайте файл восстановления, соответствующий целевому диску.|  
|**/logdir:**<logDirectory\>|**Необязательный элемент.** Каталог журналов. В этот каталог записываются файлы подробного журнала. Если каталог журнала не указан, вместо него используется текущий каталог.|  
|**/d:**<TargetDirectories\>|**Обязательный.** Один или несколько разделенных точкой с запятой каталогов, содержащих исходные импортированные файлы. Диск импорта также может использоваться, но не требуется, если доступны альтернативные расположения исходных файлов.|  
|**/bk:**<ключ_BitLocker\>|**Необязательный элемент.** Укажите ключ BitLocker, если требуется, чтобы средство разблокировало зашифрованный диск, где доступны исходные файлы.|  
|**/sn:**<StorageAccountName\>|**Обязательный.** Имя учетной записи хранения для задания импорта.|  
|**/sk:**<ключ_учетной_записи_хранения\>|**Требуется** только в том случае, если не указан SAS контейнера. Ключ учетной записи хранения для задания импорта.|  
|**/csas:**<ContainerSas\>|**Требуется** только в том случае, если не указан ключ учетной записи хранения. Контейнер SAS для доступа к большим двоичным объектам, связанным с заданием импорта.|  
|**/CopyLogFile:**<дривекопилогфиле\>|**Обязательный.** Путь к файлу журнала копирования диска (подробного журнала или журнала ошибок). Этот файл создается службой импорта и экспорта Windows Azure. Его можно скачать из хранилища BLOB-объектов, связанного с заданием. Файл журнала копирования содержит сведения о больших двоичных объектах или файлах с ошибками, которые требуется восстановить.|  
|**/PathMapFile:**<DrivePathMapFile\>|**Необязательный элемент.** Путь к текстовому файлу, который используется для разрешения неоднозначности при наличии нескольких файлов с одинаковым именем, которые были импортированы в одном задании. При первом запуске средства файл может быть заполнен всеми неоднозначными именами. Более поздние версии этого средства используют этот файл для устранения неоднозначностей.|  
  
## <a name="using-the-repairimport-command"></a>Использование команды RepairImport  
Чтобы восстановить импортируемые данные, используя потоковую передачу данных по сети, необходимо указать каталоги, которые содержат исходные файлы, импортированные с помощью параметра `/d`. Также укажите файл журнала копирования, скачанный из учетной записи хранения. Обычная командная строка для восстановления задания импорта с частичными повреждениями выглядит так:  
  
```  
WAImportExport.exe RepairImport /r:C:\WAImportExport\9WM35C2V.rep /d:C:\Users\bob\Pictures;X:\BobBackup\photos /sn:bobmediaaccount /sk:VkGbrUqBWLYJ6zg1m29VOTrxpBgdNOlp+kp0C9MEdx3GELxmBw4hK94f7KysbbeKLDksg7VoN1W/a5UuM2zNgQ== /CopyLogFile:C:\WAImportExport\9WM35C2V.log  
```  
  
В приведенном ниже примере файла журнала копирования одна его часть размером 64 КБ была повреждена на диске, который указан для задания импорта. Поскольку этот сбой является единственным указанным, остальные BLOB-объекты в задании были успешно импортированы.  
  
```xml
<?xml version="1.0" encoding="utf-8"?>  
<DriveLog>  
 <DriveId>9WM35C2V</DriveId>  
 <Blob Status="CompletedWithErrors">  
 <BlobPath>pictures/animals/koala.jpg</BlobPath>  
 <FilePath>\animals\koala.jpg</FilePath>  
 <Length>163840</Length>  
 <ImportDisposition Status="Overwritten">overwrite</ImportDisposition>  
 <PageRangeList>  
  <PageRange Offset="65536" Length="65536" Hash="AA2585F6F6FD01C4AD4256E018240CD4" Status="Corrupted" />  
 </PageRangeList>  
 </Blob>  
 <Status>CompletedWithErrors</Status>  
</DriveLog>  
```
  
Когда этот журнал копирования передается в средство импорта и экспорта Azure, средство выполняет попытку завершить импорт файла, копируя отсутствующее содержимое из сети. Как показано в примере выше, средство выполняет поиск исходного файла `\animals\koala.jpg` в двух каталогах: `C:\Users\bob\Pictures` и `X:\BobBackup\photos`. Если файл `C:\Users\bob\Pictures\animals\koala.jpg` существует, инструмент импорта и экспорта Azure копирует недостающие данные в соответствующий большой двоичный объект `http://bobmediaaccount.blob.core.windows.net/pictures/animals/koala.jpg`.  
  
## <a name="resolving-conflicts-when-using-repairimport"></a>Разрешение конфликтов при использовании RepairImport  
В некоторых случаях средство не может найти или открыть необходимый файл по одной из следующих причин: не удалось найти файл, файл недоступен, имя файла неоднозначно, или содержимое файла больше неверно.  
  
Неоднозначная ошибка может возникнуть, если средство пытается выполнить обнаружение `\animals\koala.jpg` , а файл с таким именем находится в `C:\Users\bob\pictures` и `X:\BobBackup\photos` . То есть этот файл доступен сразу в двух расположениях (`C:\Users\bob\pictures\animals\koala.jpg` и `X:\BobBackup\photos\animals\koala.jpg`) на дисках для задания импорта.  
  
Параметр `/PathMapFile` поможет вам устранить эту ошибку. Можно указать имя файла, который содержит список файлов, которые средство не смогло правильно определить. В следующем примере командной строки указывается файл `9WM35C2V_pathmap.txt`:  
  
```
WAImportExport.exe RepairImport /r:C:\WAImportExport\9WM35C2V.rep /d:C:\Users\bob\Pictures;X:\BobBackup\photos /sn:bobmediaaccount /sk:VkGbrUqBWLYJ6zg1m29VOTrxpBgdNOlp+kp0C9MEdx3GELxmBw4hK94f7KysbbeKLDksg7VoN1W/a5UuM2zNgQ== /CopyLogFile:C:\WAImportExport\9WM35C2V.log /PathMapFile:C:\WAImportExport\9WM35C2V_pathmap.txt  
```
  
Затем средство запишет пути к проблемному файлу в параметр `9WM35C2V_pathmap.txt` (по одному в каждой строке). Например, файл может содержать следующие записи после запуска команды:  
 
```
\animals\koala.jpg  
\animals\kangaroo.jpg  
```
  
 Для каждого файла в списке следует попытаться найти и открыть файл, чтобы убедиться, что он доступен для средства. Если вы хотите сообщить средству, где найти файл, измените файл схемы пути и добавьте путь к каждому файлу в той же строке, разделяя символ табуляции:  
  
```
\animals\koala.jpg           C:\Users\bob\Pictures\animals\koala.jpg  
\animals\kangaroo.jpg        X:\BobBackup\photos\animals\kangaroo.jpg  
```
  
Сделав доступными необходимые файлы для средства (или обновив файл сопоставления пути), вы можете повторно запустить средство для завершения импорта.  
  
## <a name="next-steps"></a>Дальнейшие действия
 
* [Настройка средства импорта и экспорта Azure](storage-import-export-tool-setup-v1.md)   
* [Подготовка жестких дисков для задания импорта](storage-import-export-data-to-blobs.md#step-1-prepare-the-drives)   
* [Просмотр состояния задания с помощью файлов журнала копирования](storage-import-export-tool-reviewing-job-status-v1.md)   
* [Подготовка задания экспорта](./storage-import-export-tool-repairing-an-export-job-v1.md)