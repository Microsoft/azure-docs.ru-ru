---
title: Как защитить иерархию ресурсов — система управления Azure
description: Сведения о том, как защитить иерархию ресурсов с помощью параметров иерархии, в том числе с настройкой группы управления по умолчанию.
ms.date: 02/05/2021
ms.topic: conceptual
ms.openlocfilehash: 0f0afb5401fc646d26598a211604790af191f156
ms.sourcegitcommit: 867cb1b7a1f3a1f0b427282c648d411d0ca4f81f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "99594592"
---
# <a name="how-to-protect-your-resource-hierarchy"></a>Как защитить иерархию ресурсов

В иерархию ресурсов входят сами ресурсы, группы ресурсов, подписки, группы управления и клиент. Параметры в корневой группе управления, такие как пользовательские роли Azure или назначения политик политики Azure, могут повлиять на все ресурсы в иерархии ресурсов. Важную роль играет защита иерархии ресурсов от изменений, которые могут отрицательно повлиять на все ресурсы.

Теперь для групп управления предоставляются параметры иерархии, которые позволяют администратору клиента управлять этим поведением. В этой статье рассматриваются все доступные параметры иерархии и способы их настройки.

## <a name="azure-rbac-permissions-for-hierarchy-settings"></a>Разрешения RBAC в Azure для параметров иерархии

Для настройки любого из параметров иерархии требуются следующие две операции поставщика ресурсов в корневой группе управления:

- `Microsoft.Management/managementgroups/settings/write`
- `Microsoft.Management/managementgroups/settings/read`

Эти операции позволяют пользователю только считывать и обновлять параметры иерархии. Эти операции не предоставляют иного доступа к иерархии группы управления или к ресурсам в этой иерархии. Обе эти операции доступны в встроенном **администраторе параметров иерархии** ролей Azure.

## <a name="setting---default-management-group"></a>Настройка — группа управления по умолчанию

По умолчанию каждая новая подписка, добавляемая в клиент, назначается членом корневой группы управления. Если назначения политик, управление доступом на основе ролей (Azure RBAC) и другие конструкции управления назначаются корневой группе управления, они сразу же вступают в силу с новыми подписками. По этой причине многие организации не применяют такие конструкции к корневой группе управления, даже если их целесообразно к ней применить. Также иногда для новых подписок требуется больше ограничений, которые не должны применяться ко всем подпискам. Этот параметр поддерживает оба варианта использования.

Разрешив определение группы управления по умолчанию для новых подписок, можно применить к корневой группе управления конструкции, относящиеся к всей Организации, а также определить отдельную группу управления с назначениями политик или назначениями ролей Azure, более подходящими для новой подписки.

### <a name="set-default-management-group-in-portal"></a>Задание группы управления по умолчанию на портале

Чтобы настроить этот параметр в портал Azure, выполните следующие действия.

1. Используйте панель поиска для поиска и выберите пункт "группы управления".

1. В корневой группе управления выберите **сведения** рядом с именем группы управления.

1. В разделе **Параметры** выберите **Параметры иерархии**.

1. Нажмите кнопку **изменить группу управления по умолчанию** .

   > [!NOTE]
   > Если кнопка **изменить группу управления по умолчанию** отключена, то либо просматриваемая группа управления не является корневой группой управления, либо у субъекта безопасности нет необходимых разрешений для изменения параметров иерархии.

1. Выберите группу управления из иерархии и нажмите кнопку **выбрать** .

### <a name="set-default-management-group-with-rest-api"></a>Задать группу управления по умолчанию с REST API

Чтобы настроить этот параметр с помощью REST API, вызывается конечная точка [параметров иерархии](/rest/api/resources/hierarchysettings) . Для этого вызова REST API применяются указанные ниже универсальный код ресурса (URI) и формат текста. Замените здесь заполнитель `{rootMgID}` идентификатором корневой группы управления, а `{defaultGroupID}` — идентификатором группы управления, которая должна стать группой управления по умолчанию.

- Универсальный код ресурса (URI) REST API

  ```http
  PUT https://management.azure.com/providers/Microsoft.Management/managementGroups/{rootMgID}/settings/default?api-version=2020-02-01
  ```

- Текст запроса

  ```json
  {
      "properties": {
          "defaultManagementGroup": "/providers/Microsoft.Management/managementGroups/{defaultGroupID}"
      }
  }
  ```

Чтобы снова сделать корневую группу управления группой управления по умолчанию, повторите вызов той же конечной точки, задав для параметра **defaultManagementGroup** значение `/providers/Microsoft.Management/managementGroups/{rootMgID}`.

## <a name="setting---require-authorization"></a>Настройка — обязательная авторизация

По умолчанию любой пользователь может создавать в клиенте новые группы управления. Администраторы клиента могут ограничить эти разрешения определенным кругом пользователей, чтобы поддерживать согласованность и единообразие в иерархии групп управления. Если этот параметр включен, для создания новых дочерних групп управления пользователю требуется операция `Microsoft.Management/managementGroups/write` в корневой группе управления.

### <a name="set-require-authorization-in-portal"></a>Задание требования авторизации на портале

Чтобы настроить этот параметр в портал Azure, выполните следующие действия.

1. Используйте панель поиска для поиска и выберите пункт "группы управления".

1. В корневой группе управления выберите **сведения** рядом с именем группы управления.

1. В разделе **Параметры** выберите **Параметры иерархии**.

1. Переключите параметр **требовать разрешения для создания новых групп управления.** значение Вкл.

   > [!NOTE]
   > Значение, если **требуются разрешения для создания новых групп управления.** переключатель отключен, либо просматриваемая группа управления не является корневой группой управления, либо у субъекта безопасности нет необходимых разрешений для изменения параметров иерархии.

### <a name="set-require-authorization-with-rest-api"></a>Set требовать авторизацию с помощью REST API

Чтобы настроить этот параметр с помощью REST API, вызывается конечная точка [параметров иерархии](/rest/api/resources/hierarchysettings) . Для этого вызова REST API применяются указанные ниже универсальный код ресурса (URI) и формат текста. Этот параметр является _логическим_, поэтому укажите значение **true** либо **false**. Значение **true** включает этот метод защиты для иерархии групп управления.

- Универсальный код ресурса (URI) REST API

  ```http
  PUT https://management.azure.com/providers/Microsoft.Management/managementGroups/{rootMgID}/settings/default?api-version=2020-02-01
  ```

- Текст запроса

  ```json
  {
      "properties": {
          "requireAuthorizationForGroupCreation": true
      }
  }
  ```

Чтобы отключить этот параметр, используйте ту же конечную точку и задайте для параметра **requireAuthorizationForGroupCreation** значение **false**.

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения о группах управления:

- [Создание групп управления для организации ресурсов Azure](../create-management-group-portal.md)
- [Изменение, удаление групп управления и управление ими](../manage.md)