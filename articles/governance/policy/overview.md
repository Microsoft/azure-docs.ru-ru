---
title: Общие сведения о Политике Azure
description: "\"Политика Azure\" — это служба в Azure, которая используется для создания, присваивания определений политик, а также управления ими в среде Azure."
ms.date: 01/14/2021
ms.topic: overview
ms.openlocfilehash: df430586af2e701ec2881f6ea760095fd2ca79d0
ms.sourcegitcommit: d59abc5bfad604909a107d05c5dc1b9a193214a8
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/14/2021
ms.locfileid: "98220734"
---
# <a name="what-is-azure-policy"></a>Что такое служба "Политика Azure"?

Политика Azure помогает применять организационные стандарты и оценивать соответствие в больших масштабах. На панели мониторинга "Соответствие требованиям" этой службы доступно агрегированное представление для оценки общего состояния среды с возможностью детализации до уровня конкретных ресурсов и политик. Также вы можете привести ресурсы в соответствие требованиям, используя средства пакетного исправления для существующих ресурсов и автоматического исправления для новых ресурсов.

Политика Azure широко применяется для реализации средств контроля за согласованностью ресурсов, соответствием нормативным требованиям, безопасностью, расходами и управлением. Определения политик для этих распространенных вариантов использования уже встроены в среду Azure, что облегчает работу.

Все данные и объекты службы "Политика Azure" шифруются при хранении. Дополнительные сведения см. в статье [Шифрование неактивных данных в Azure](../../security/fundamentals/encryption-atrest.md).

## <a name="overview"></a>Обзор

Политика Azure оценивает ресурсы в Azure, сравнивая их свойства с настроенными бизнес-правилами. Описания бизнес-правил в [формате JSON](./concepts/definition-structure.md) называются [определениями политик](#policy-definition). Чтобы упростить управление, можно объединить несколько бизнес-правил в группу, которая называется [инициативой политики](#initiative-definition) или _набором политик_ (policySet). Завершив создание бизнес-правил, вы можете [назначить](#assignments) определение или инициативу политики любой области ресурсов из числа поддерживаемых в Azure, например [группам управления](../management-groups/overview.md), подпискам, [группам ресурсов](../../azure-resource-manager/management/overview.md#resource-groups) или отдельным ресурсам. Такое назначение применяется ко всем ресурсам в пределах[области Resource Manager](../../azure-resource-manager/management/overview.md#understand-scope) назначения. При необходимости можно исключить подобласти. Дополнительные сведения см. в статье [Область в Политике Azure](./concepts/scope.md).

Политика Azure использует [формат JSON](./concepts/definition-structure.md), чтобы определять логику для процесса оценки соответствия ресурса требованиям. Определения включают метаданные и правило политики. В определении правила можно использовать функции, параметры, логические операторы, условия и [псевдонимы](./concepts/definition-structure.md#aliases) свойств в соответствии с нужным сценарием. Правило политики определяет, какие ресурсы оцениваются в области назначения.

### <a name="understand-evaluation-outcomes"></a>Анализ результатов оценки

Ресурсы оцениваются в определенные периоды жизненного цикла ресурса или назначения политики, а также для регулярной текущей оценки соответствия. Ниже перечислены периоды и события, которые могут запускать оценку ресурса.

- Ресурс создается, обновляется или удаляется в области, для которой назначена политика.
- Определенной области назначается новая политика или инициатива.
- Политика или инициатива, уже назначенная определенной области, является обновленной.
- В ходе стандартного цикла оценки соответствия, который выполняется каждые 24 часа.

См. сведения о том, когда и как происходит оценка политики, в руководстве по [триггерам оценки](./how-to/get-compliance-data.md#evaluation-triggers).

### <a name="control-the-response-to-an-evaluation"></a>Управление реакцией на оценку

Бизнес-правила обработки несоответствий для ресурсов могут сильно различаться между организациями. Вот некоторые примеры того, как платформа может реагировать на ресурс, не соответствующий требованиям:

- запрет изменения ресурса;
- запись изменений ресурса в журнал;
- корректировка изменений до применения к ресурсу;
- корректировка изменений после применения к ресурсу;
- развертывание связанных ресурсов для обеспечения соответствия.

Политика Azure позволяет реализовать любой из таких бизнес-ответов путем применения [эффектов](./concepts/effects.md). Эффекты задаются в разделе **правило политики** в [определении политики](./concepts/definition-structure.md).

### <a name="remediate-non-compliant-resources"></a>Исправление несоответствующих ресурсов

В первую очередь эти эффекты влияют на создаваемые или обновляемые ресурсы, но Политика Azure поддерживает также работу с существующими ресурсами, не соответствующими требованиям, без необходимости изменять эти ресурсы. См. сведения об обеспечении соответствия для существующих ресурсов в руководстве по [исправлению ресурсов](./how-to/remediate-resources.md).

### <a name="video-overview"></a>Видеообзор

Ниже приведен обзор службы "Политика Azure" с веб-сайта Microsoft Build 2018. Слайды или видеоролик для загрузки можно найти на странице [Govern your Azure environment through Azure Policy](https://channel9.msdn.com/events/Build/2018/THR2030) (Система управления средой Azure с помощью службы "Политика Azure") на канале Channel 9.

> [!VIDEO https://www.youtube.com/embed/dxMaYF2GB7o]

## <a name="getting-started"></a>Начало работы

### <a name="azure-policy-and-azure-rbac"></a>Политика Azure и Azure RBAC

Между возможностями Политики Azure и управления доступом на основе ролей Azure (Azure RBAC) есть ряд ключевых отличий. Служба "Политика Azure" оценивает состояние, проверяя свойства ресурсов, которые представлены в Resource Manager и свойства некоторых поставщиков ресурсов. Политика Azure не ограничивает действия (_операции_). Политика Azure гарантирует, что состояние ресурса всегда соответствует заданным бизнес-правилам, независимо от того, кто внес изменения и кто имеет разрешения на внесение изменений.

Azure RBAC контролирует [действия](../../role-based-access-control/resource-provider-operations.md) пользователей в разных областях. Если вам нужно управлять действиями, используйте Azure RBAC. Даже если у пользователя есть доступ на выполнение действия, Политика Azure может заблокирует операции создания или обновления, если полученный ресурс не будет соответствовать требованиям.

Использование Azure RBAC и Политики Azure обеспечивает полный контроль над областью действия в Azure.

### <a name="azure-rbac-permissions-in-azure-policy"></a>Разрешения Azure RBAC в Политике Azure

В службе "Политика Azure" предусмотрено несколько разрешений, известных как операции, двух разных поставщиков ресурсов:

- [Microsoft.Authorization](../../role-based-access-control/resource-provider-operations.md#microsoftauthorization)
- [Microsoft.PolicyInsights](../../role-based-access-control/resource-provider-operations.md#microsoftpolicyinsights).

Большинство встроенных ролей предоставляют разрешения на доступ к ресурсам службы "Политика Azure". Пользователь с ролью **Участник политики ресурсов** получает доступ к большинству операций службы "Политика Azure". Пользователь с ролью **владелец** имеет полные права. Роли **участника** и **читателя** имеют полный доступ _на чтение_ для операций Политики Azure. Роль **участника** может активировать исправление ресурсов, но не позволяет _создавать_ определения или назначения. Роль **администратора доступа пользователей** нужна для предоставления управляемому удостоверению необходимых разрешений в рамках назначений **deployIfNotExists** или **modify**.

Если ни в одной роли нет нужных разрешений, создайте [пользовательскую роль](../../role-based-access-control/custom-roles.md).

> [!NOTE]
> Управляемое удостоверение для назначения политики **deployIfNotExists** или **modify** должно иметь разрешения на создание или обновление целевых ресурсов. См. сведения о [настройке определений политики для исправления](./how-to/remediate-resources.md#configure-policy-definition).

### <a name="resources-covered-by-azure-policy"></a>Какие ресурсы охватывает Политика Azure

Политика Azure оценивает все ресурсы Azure на уровне подписки или ниже, включая ресурсы с поддержкой Arc. Для некоторых поставщиков ресурсов, таких как [гостевая конфигурация](./concepts/guest-configuration.md), [Служба Azure Kubernetes](../../aks/intro-kubernetes.md) и [Azure Key Vault](../../key-vault/general/overview.md), поддерживается более глубокая интеграция для управления параметрами и объектами. См. сведения о [режимах поставщиков ресурсов](./concepts/definition-structure.md).

### <a name="recommendations-for-managing-policies"></a>Рекомендации по управлению политиками

Ниже приведены несколько указателей и советов, которые следует учитывать.

- Начните с действия аудита вместо действия запрета, чтобы отслеживать влияние определения политики на ресурсы в вашей среде. При наличии сценария для автомасштабирования приложений установка результатов запрета может помешать таким задачам автоматизации.

- При создании определений и назначений необходимо учитывать организационные иерархии. Мы рекомендуем создавать определения на более высоких уровнях, таких как группа управления или уровень подписки. Затем создайте назначение на следующем дочернем уровне. Если вы создаете определение в группе управления, назначение можно ограничить до подписки или группы ресурсов в этой группе управления.

- Мы рекомендуем создавать и назначать определения инициатив даже для одного определения политики.
  Например, у вас есть определение политики _policyDefA_ и вы создаете его в качестве определения инициативы _initiativeDefC_. Если вы создадите другое определение политики _policyDefB_ с целями подобными _policyDefA_, его можно добавить к _initiativeDefC_, чтобы отслеживать их вместе.

- После создания назначения инициативы определения политики, добавленные к инициативе, также становятся частью этих назначений.

- Когда оценивается назначение инициативы, все политики этой инициативы также оцениваются.
  Если нужно оценить политику отдельно, то не включайте ее в инициативу.

## <a name="azure-policy-objects"></a>Объекты Политики Azure

### <a name="policy-definition"></a>Определение политики

Путь создания и реализации политики в службе "Политика Azure" начинается с создания определения политики. Каждое определение политики содержит условия, при которых она применяется, а также определенное действие, которое выполняется, если условия соблюдены.

В службе "Политика Azure" предлагается несколько встроенных политик, доступных по умолчанию. Пример:

- **Допустимые номера SKU учетных записей хранения** (запрет): определяет, была ли учетная запись хранения развернута в наборе размеров SKU. Действие политики — запрет всех учетных записей хранения, которые не соответствуют набору определенных размеров SKU.
- **Разрешенный тип ресурса** (запрет): определяет типы ресурсов, которые можно развернуть. Действие политики — запрет всех ресурсов, которые не являются частью определенного списка.
- **Допустимые расположения** (запрет): ограничивает доступные расположения для новых ресурсов. Эта политика используется для соблюдения географических требований.
- **Разрешенные номера SKU виртуальных машин** (запрет): задает набор SKU виртуальных машин, которые можно развернуть.
- **Добавление тегов к ресурсам** (изменение): применяет обязательный тег и его значение по умолчанию, если он не задан запросом развертывания.
- **Недопустимые типы ресурсов** (запрет): препятствует развертыванию списка типов ресурсов.

Чтобы реализовать эти определения политик (как встроенные, так и настраиваемые определения), необходимо будет их назначить. Любую из этих политик можно назначить с помощью портала Azure, PowerShell или Azure CLI.

Оценка политики происходит с помощью нескольких различных действий, таких как назначение или обновление политики. Полный список см. в разделе [Policy evaluation triggers](./how-to/get-compliance-data.md#evaluation-triggers) (Триггеры оценки политики).

Дополнительные сведения о структурах определений политик см. в [этой статье](./concepts/definition-structure.md).

Использование параметров политики помогает упростить управление политиками за счет сокращения числа определений политики, которые необходимо создать. Параметры можно определить при создании политики, чтобы сделать его более общим. Затем можно повторно использовать определение политики для различных сценариев. Для этого можно передавать различные значения при назначении определения политики. Например, можно указать один набор расположений для подписки.

Параметры определяются при создании определения политики. Когда параметр определен, ему присваивается имя и (необязательно) задается значение. Например, можно определить параметр политики, _location_. Затем при назначении политики ему можно присваивать различные значения, такие как _EastUS_ или _WestUS_.

Дополнительные сведения о параметрах политики см. в [этом разделе](./concepts/definition-structure.md#parameters).

### <a name="initiative-definition"></a>Определение инициативы

Определение инициативы — это совокупность определений политик, которые предназначены для достижения одной ключевой цели. Определение инициативы упрощает управление определениями политик и их назначение. Это достигается благодаря группированию набора политик в один отдельный элемент. Например, можно создать инициативу, называемую **Enable Monitoring in Azure Security Center** (Включение мониторинга в центре безопасности Azure) с целью мониторинга всех доступных рекомендаций безопасности в центре безопасности Azure.

> [!NOTE]
> Пакет SDK, например Azure CLI и Azure PowerShell, использует свойства и параметры с именем **PolicySet** для ссылки на инициативы.

В соответствии с этой инициативой будут доступны такие определения политики:

- **Monitor unencrypted SQL Database in Security Center** (Мониторинг незашифрованной базы данных в центре безопасности) для наблюдения за незашифрованными базами данных и серверами SQL.
- **Monitor OS vulnerabilities in Security Center** (Мониторинг уязвимостей ОС в Центре безопасности) для мониторинга серверов, не соответствующих настроенному базовому плану.
- **Monitor missing Endpoint Protection in Security Center** (Мониторинг отсутствующей защиты конечной точки в центре безопасности) для серверов мониторинга без установленного агента защиты конечной точки.

Как и параметры политики, параметры инициативы помогают упростить управление инициативой за счет сокращения избыточности. Параметры инициативы являются параметрами, используемыми определениями политик внутри инициативы.

Например, возьмем сценарий с определением инициативы — **initiativeC** и определениями политик — **policyA** и **policyB**, каждая из которых имеет различный тип параметра.

| Политика | Имя параметра |Тип параметра  |Примечание |
|---|---|---|---|
| policyA | allowedLocations | массиве  |Этот параметр ожидает список строк для значения, так как тип параметра был определен как массив. |
| policyB | allowedSingleLocation |строка |Этот параметр ожидает одно слово для значения, так как тип параметра был определен как строка. |

В этом случае при определении параметров инициативы **initiativeC** есть три варианта:

- Используйте параметры определений политик в рамках этой инициативы. В этом примере _allowedLocations_ и _allowedSingleLocation_ становятся параметрами для инициативы **initiativeC**.
- Укажите значения параметров определений политик в рамках этого определения инициативы. В этом примере вы можете предоставить список расположений для параметра **allowedLocations** политики **policyA** и параметра **allowedSingleLocation** политики **policyB**. Кроме того, можно указать значения при назначении этой инициативы.
- Предоставьте список _значений_ параметров, которые могут использоваться при присвоении этой инициативы. При назначении этой инициативы наследуемые параметры из определения политики в рамках инициативы могут иметь значения только из указанного списка.

При создании параметров значения в определении инициативы вы не можете ввести другое значение во время назначения инициативы, так как оно не является частью списка.

Дополнительные сведения см. в статье [Структура определения инициативы в службе "Политика Azure"](./concepts/initiative-definition-structure.md).

### <a name="assignments"></a>Назначения

Назначением называется определение или инициатива политики, предназначенные для выполнения в пределах определенной области. Эта область может варьироваться от [группы управления](../management-groups/overview.md) до отдельного ресурса. Термин _область_ означает все ресурсы, группы ресурсов, подписки или группы управления, которые указаны в определении. Назначения наследуются всеми дочерними ресурсами. Такой подход означает, что примененные к группе ресурсов назначения применяются в равной степени ко всем ресурсам в этой группе. Но вы можете исключить некоторую подобласть из назначения.

Например, для области действия подписки можно назначить определение, которое блокирует создание сетевых ресурсов. В этой подписке можно исключить группу ресурсов, предназначенную для сетевой инфраструктуры. Затем доступ к этой группе сетевых ресурсов предоставляется пользователям, которым вы доверяете создание сетевых ресурсов.

В другом примере, возможно, потребуется назначить определение списка разрешений для типов ресурсов на уровне группы управления. После этого назначьте менее строгую политику (которая разрешает дополнительные типы ресурсов) для дочерней группы управления или даже непосредственно для подписок. Но в нашем примере сделать это не удастся, так как Политика Azure использует систему явных запретов. Вместо этого исключите дочернюю группу управления или подписку из назначения, выполненного на уровне группы управления. Затем назначьте менее строгое определение на уровне дочерней группы управления или подписки. Если какое-то назначение приводит к запрету ресурса, доступность такого ресурса можно восстановить, только изменив это запрещающее назначение.

См. сведения о настройке назначений в руководстве по [созданию назначения политики для идентификации ресурсов, не соответствующих требованиям](./assign-policy-portal.md). Также доступны пошаговые инструкции для [PowerShell](./assign-policy-powershell.md) и [Azure CLI](./assign-policy-azurecli.md). Сведения о структуре назначений см. в статье [Структура назначения в службе "Политика Azure"](./concepts/assignment-structure.md).

## <a name="maximum-count-of-azure-policy-objects"></a>Максимальное количество объектов службы "Политика Azure"

[!INCLUDE [policy-limits](../../../includes/azure-policy-limits.md)]

## <a name="next-steps"></a>Дальнейшие действия

После знакомства с обзором службы "Политика Azure" и некоторыми представленными ключевыми концепциями можно выполнять следующие шаги.

- [См. сведения о структуре определения политик](./concepts/definition-structure.md).
- [Назначение определения политики на портале](./assign-policy-portal.md).
