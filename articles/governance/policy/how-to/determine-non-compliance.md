---
title: Определение причин несоответствия требованиям
description: Если ресурс не соответствует требованиям, возможных причин этого множество. Узнайте, как находить то, что привело к несоответствию.
ms.date: 09/30/2020
ms.topic: how-to
ms.openlocfilehash: a8168bf22aceaf5cbdec4b1346801aa62b7aa4ee
ms.sourcegitcommit: 5bbc00673bd5b86b1ab2b7a31a4b4b066087e8ed
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/07/2021
ms.locfileid: "102439839"
---
# <a name="determine-causes-of-non-compliance"></a>Определение причин несоответствия требованиям

Если ресурс Azure определен как не соответствующий правилу политики, полезно понять, какой части правила он не соответствует. Также полезно понять, какое изменение ранее соответствовавшего ресурса сделало его несоответствующим. Эту информацию можно найти через два источника:

- [Сведения о соответствии](#compliance-details)
- [Журнал изменений (предварительная версия)](#change-history)

## <a name="compliance-details"></a>Сведения о соответствии

Если ресурс не соответствует требованиям, сведения о соответствии для этого ресурса доступны на странице **Соответствия политике**. Область сведений о соответствии содержит следующие сведения:

- Сведения о ресурсе, такие как имя, тип, расположение и идентификатор ресурса.
- Состояние соответствия и отметка времени последней оценки для текущего назначения политики.
- Список _причин_ несоответствия ресурса.

> [!IMPORTANT]
> Так как сведения о соответствии для _Несоответствующего_ ресурса показывают текущее значение свойств этого ресурса, пользователь должен иметь операцию **чтения** для **типа** ресурса. Например, если _Несоответствующий_ ресурсом является **Microsoft.Compute/virtualMachines**, то пользователь должен иметь операцию **Microsoft.Compute/virtualMachines/read**. Если у пользователя нет необходимой операции, отображается ошибка доступа.

Чтобы просмотреть сведения о соответствии, выполните следующие действия.

1. Запустите службу "Политика Azure" на портале Azure. Для этого щелкните **Все службы**, выполните поиск по запросу **Политика** и выберите этот элемент.

1. На странице **Обзор** или **Соответствие** выберите политику, с **состоянием соответствия** _Не соответствует_.

1. На вкладке **Соответствие ресурса** страницы **Соответствие политике** щелкните правой кнопкой мыши или выберите многоточие ресурса с **состоянием соответствия** _Не соответствует_. Затем выберите **Просмотреть сведения о соответствии**.

   :::image type="content" source="../media/determine-non-compliance/view-compliance-details.png" alt-text="Снимок экрана со ссылкой &quot;Просмотр сведений о соответствии&quot; на вкладке &quot;соответствие ресурсов&quot;." border="false":::

1. Панель **Сведения о соответствии** отображает информацию от последней оценки ресурса до назначения текущей политики. В этом примере поле **Microsoft. SQL/Servers/Version** содержит _12.0_, в то время как определение политики ожидало _14.0_. Если ресурс не соответствует требованиям по нескольким причинам, каждая из них отображается на этой панели.

   :::image type="content" source="../media/determine-non-compliance/compliance-details-pane.png" alt-text="Снимок экрана с областью сведений о соответствии и причинами несоответствия, что текущее значение равно двенадцати, а целевое значение — четырнадцать." border="false":::

   Для определения политики **auditIfNotExists** или **deployIfNotExists** сведения включают в себя свойство **details.type** и любые дополнительные свойства. Список см. в разделах [свойства auditIfNotExists](../concepts/effects.md#auditifnotexists-properties) и [свойства deployIfNotExists](../concepts/effects.md#deployifnotexists-properties). **Последний оцененный ресурс** — это связанный ресурс из раздела **сведений** определения.

   Пример частичного определения **deployIfNotExists**:

   ```json
   {
       "if": {
           "field": "type",
           "equals": "[parameters('resourceType')]"
       },
       "then": {
           "effect": "DeployIfNotExists",
           "details": {
               "type": "Microsoft.Insights/metricAlerts",
               "existenceCondition": {
                   "field": "name",
                   "equals": "[concat(parameters('alertNamePrefix'), '-', resourcegroup().name, '-', field('name'))]"
               },
               "existenceScope": "subscription",
               "deployment": {
                   ...
               }
           }
       }
   }
   ```

   :::image type="content" source="../media/determine-non-compliance/compliance-details-pane-existence.png" alt-text="Снимок экрана области сведений о соответствии для Ифнотексистс, включая вычисленное количество ресурсов." border="false":::

> [!NOTE]
> Для защиты данных, если значение свойства является _секретом_, текущее значение отображает звездочки.

В этих сведениях объясняется, почему ресурс в настоящее время не соответствует требованиям, но не показывается, когда было внесено изменение в ресурс, вызвавшее это несоответствие. Информацию о последнем см. в разделе [Журнал изменений (предварительная версия)](#change-history) ниже.

### <a name="compliance-reasons"></a>Причины соответствия

Следующая матрица показывает каждую из возможных _причин_ вызвавшего несоответствие [условия](../concepts/definition-structure.md#conditions) в определении политики:

|Причина | Условие |
|-|-|
|Текущее значение должно содержать целевое значение в качестве ключа. |containsKey или **нет** notContainsKey |
|Текущее значение должно содержать целевое значение. |contains или **нет** notContains |
|Текущее значение должно быть равно целевому значению. |equals или **нет** notEquals |
|Текущее значение должно быть меньше целевого значения. |less или **нет** greaterOrEquals |
|Текущее значение должно быть не меньше целевого значения. |greaterOrEquals или **нет** less |
|Текущее значение должно быть больше целевого значения. |greater или **нет** lessOrEquals |
|Текущее значение должно быть не больше целевого значения. |lessOrEquals или **нет** greater |
|Текущее значение должно существовать. |exists (существует) |
|Текущее значение должно быть включено в целевое значение. |in или **нет** notIn |
|Текущее значение должно быть аналогично целевому значению. |Like или **нет** notLike |
|Текущее значение должно соответствовать целевому значению с учетом регистра. |match или **нет** notMatch |
|Текущее значение должно соответствовать целевому значению без учета регистра. |matchInsensitively или **нет** notMatchInsensitively |
|Текущее значение не должно содержать целевое значение в качестве ключа. |notContainsKey или **нет** containsKey|
|Текущее значение не должно содержать целевое значение. |notContains или **нет** contains |
|Текущее значение не должно быть равно целевому значению. |notEquals или **нет** equals |
|Текущее значение не должно существовать. |**нет** exists  |
|Текущее значение не должно быть включено в целевое значение. |notIn или **нет** in |
|Текущее значение не должно быть аналогично целевому значению. |notLike или **нет** like |
|Текущее значение не должно соответствовать целевому значению с учетом регистра. |notMatch или **нет** match |
|Текущее значение не должно соответствовать целевому значению без учета регистра. |notMatchInsensitively или **нет** matchInsensitively |
|Нет связанных ресурсов, соответствующих сведениям о воздействии в определении политики. |Ресурс типа, определенный в **then.details.type** и связанный с ресурсом, определенным в части **if** правила политики, не существует. |

## <a name="component-details-for-resource-provider-modes"></a>Сведения о компонентах для режимов поставщика ресурсов

Для назначений в [режиме поставщика ресурсов](../concepts/definition-structure.md#resource-manager-modes)выберите _несоответствующий_ ресурс, чтобы открыть более глубокое представление. На вкладке **соответствие компонентов** представлены дополнительные сведения, относящиеся к режиму поставщика ресурсов в назначенной политике, отображающей _несоответствующий_ **компонент** и **идентификатор компонента**.

:::image type="content" source="../media/getting-compliance-data/compliance-components.png" alt-text="Снимок экрана с вкладкой соответствия компонентов и сведениями о соответствии для назначения режима поставщика ресурсов." border="false":::

## <a name="compliance-details-for-guest-configuration"></a>Сведения о соответствии для гостевой конфигурации

Для политик _помощью параметров auditifnotexists_ в категории _конфигурации "гость_ " в виртуальной машине может быть определено несколько параметров, поэтому необходимо просмотреть подробные сведения о параметрах. Например, если вы выполняете аудит для списка политик паролей и только одна из них имеет состояние _Не соответствует_, необходимо знать, какие конкретные политики паролей не соответствуют требованиям и почему.

У вас также может не быть доступа для входа на виртуальную машину напрямую, но необходимо сообщить о том, почему виртуальная машина не _соответствует требованиям_.

### <a name="azure-portal"></a>Портал Azure

Сначала выполните действия, описанные в предыдущем разделе, чтобы просмотреть сведения о соответствии политике.

В области сведения о соответствии выберите ссылку **последний оцененный ресурс**.

:::image type="content" source="../media/determine-non-compliance/guestconfig-auditifnotexists-compliance.png" alt-text="Снимок экрана: Просмотр сведений о соответствии определения помощью параметров auditifnotexists." border="false":::

На странице **Назначение гостей** отображаются все доступные сведения о соответствии. Каждая строка в представлении представляет собой оценку выполненную внутри виртуальной машины. В столбце **Причина** отображается фраза, в которой описывается, почему назначение гостя _Не соответствует_ требованиям. Например, при аудите политик паролей в столбце **Причина** будет отображаться текст, включающий текущее значение для каждого параметра.

:::image type="content" source="../media/determine-non-compliance/guestconfig-compliance-details.png" alt-text="Снимок экрана сведений о соответствии для назначения гостей." border="false":::

## <a name="change-history-preview"></a><a name="change-history"></a>Журнал изменений (предварительная версия)

В рамках новой **общедоступной предварительной версии** последние 14 дней в журнале изменений теперь доступны для всех ресурсов Azure, поддерживающих [полное удаление режимов](../../../azure-resource-manager/templates/complete-mode-deletion.md). Журнал изменений содержит подробные сведения о том, когда было обнаружено изменение и _отличия между визуальными элементами_ для каждого изменения. Обнаружение изменений активируется при добавлении, удалении или изменении свойств Azure Resource Manager.

1. Запустите службу "Политика Azure" на портале Azure. Для этого щелкните **Все службы**, выполните поиск по запросу **Политика** и выберите этот элемент.

1. На странице **Обзор** или **Соответствие** выберите политику в любом **состоянии соответствия**.

1. На вкладке **Соответствие ресурсов** страницы **Соответствие политики** выберите ресурс.

1. На странице **Соответствие ресурсов** выберите вкладку **Журнал изменений (предварительная версия)** . После этого отобразится список обнаруженных изменений (при наличии).

   :::image type="content" source="../media/determine-non-compliance/change-history-tab.png" alt-text="Снимок экрана вкладки &quot;журнал изменений&quot; и обнаружено время изменения на странице соответствия ресурсов." border="false":::

1. Выберите одно из обнаруженных изменений. _Отличия между визуальными элементами_ для ресурса представлены на странице **Журнал изменений**.

   :::image type="content" source="../media/determine-non-compliance/change-history-visual-diff.png" alt-text="Снимок экрана: визуальное различие в журнале изменений для состояния &quot;до&quot; и &quot;после&quot; на странице &quot;журнал изменений&quot;." border="false":::

_Отличия между визуальными элементами_ позволяют обнаружить изменения ресурса. Обнаруженные изменения могут не быть связаны с текущим состоянием соответствия ресурса.

Данные журнала изменений предоставляются [Azure Resource Graph](../../resource-graph/overview.md). Чтобы запросить эти сведения за пределами портала Azure, см. [Получение изменений ресурсов](../../resource-graph/how-to/get-resource-changes.md).

## <a name="next-steps"></a>Дальнейшие действия

- Рассмотрите [примеры для службы "Политика Azure"](../samples/index.md).
- Изучите статью о [структуре определения Политики Azure](../concepts/definition-structure.md).
- Изучите [сведения о действии политик](../concepts/effects.md).
- Узнайте о [программном создании политик](programmatically-create.md).
- Узнайте, как [получать сведения о соответствии](get-compliance-data.md).
- Узнайте, как [исправлять несоответствующие ресурсы](remediate-resources.md).
- Дополнительные сведения о группе управления см. в статье [Упорядочивание ресурсов с помощью групп управления Azure](../../management-groups/overview.md).
