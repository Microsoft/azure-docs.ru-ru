---
title: Создание назначения политики с помощью портала
description: В этом кратком руководстве с помощью портала Azure вы создадите назначение в службе Политика Azure, позволяющее определить ресурсы, которые не соответствуют требованиям.
ms.date: 01/29/2021
ms.topic: quickstart
ms.openlocfilehash: e5cbf31e897b5be404327efa254eb90ead990f5f
ms.sourcegitcommit: 54e1d4cdff28c2fd88eca949c2190da1b09dca91
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/31/2021
ms.locfileid: "99220893"
---
# <a name="quickstart-create-a-policy-assignment-to-identify-non-compliant-resources"></a>Создание назначения политики для идентификации ресурсов, не соответствующих требованиям.

Чтобы понять, соответствуют ли ресурсы требованиям в Azure, прежде всего нужно определить их состояние.
В этом кратком руководстве описано, как создать назначение политики для определения виртуальных машин, которые не используют управляемые диски.

Завершив работу, вы узнаете, какие виртуальные машины не используют управляемые диски, так как _не соответствуют_ назначению политики.

## <a name="prerequisites"></a>Предварительные требования

Если у вас еще нет подписки Azure, создайте [бесплатную](https://azure.microsoft.com/free/) учетную запись Azure, прежде чем начинать работу.

## <a name="create-a-policy-assignment"></a>Создание назначения политики

С помощью этого краткого руководства вы создадите назначение политики и назначите определение политики _Аудит виртуальных машин, которые не используют управляемые диски_.

1. Запустите службу "Политика Azure" на портале Azure. Для этого щелкните **Все службы**, выполните поиск по запросу **Политика** и выберите этот элемент.

   :::image type="content" source="./media/assign-policy-portal/search-policy.png" alt-text="Снимок экрана: поиск пункта &quot;Политика&quot; в области &quot;Все службы&quot;." border="false":::

1. Выберите **Назначения** на странице службы Политики Azure слева. Назначение — это политика, которая назначена в рамках определенной области.

   :::image type="content" source="./media/assign-policy-portal/select-assignments.png" alt-text="Снимок экрана: открытие страницы &quot;Назначения&quot; со страницы &quot;Обзор политики&quot;." border="false":::

1. Выберите **Назначить политику** в верхней части страницы **Policy — Assignments** (Политика — назначения).

   :::image type="content" source="./media/assign-policy-portal/select-assign-policy.png" alt-text="Снимок экрана: выбор элемента &quot;Назначить политику&quot; на странице &quot;Назначения&quot;." border="false":::

1. На странице **Назначить политику** задайте **Область**, нажав кнопку с многоточием и выбрав либо группу управления, либо подписку. Либо выберите группу ресурсов. Она определяет, к каким ресурсам или группе ресурсов принудительно применяется назначение политики. В нижней части страницы **Область** нажмите кнопку **Выбрать**.

   В этом примере используется подписка **Contoso**. Ваша подписка будет отличаться.

1. Ресурсы можно исключить на основе параметра **Область**. **Исключения** начинаются на один уровень ниже уровня параметра **Область**. **Исключения** являются необязательными, поэтому пока оставьте это поле пустым.

1. Выберите многоточие рядом с пунктом **Определение политики**, чтобы открыть список доступных определений. Служба Политика Azure поставляется со встроенными определениями политик, которые можно использовать. Доступны многие политики, такие как:

   - Принудительное применение тега и его значения
   - применять тег и его значение;
   - наследование тега из группы ресурсов, если он отсутствует.

   См. [полный список всех доступных встроенных политик Azure](./samples/index.md).

1. Найдите определение политики в списке по строке _Аудит виртуальных машин, которые не используют управляемые диски_. Выберите эту политику и нажмите кнопку **Выбрать**.

   :::image type="content" source="./media/assign-policy-portal/select-available-definition.png" alt-text="Снимок экрана: фильтрация доступных определений." border="false":::

1. **Имя назначения** автоматически заполняется выбранным именем политики, но его можно изменить. Для нашего примера сохраните значение _Аудит виртуальных машин, которые не используют управляемые диски_. При желании вы можете добавить необязательное **описание**. Описание содержит сведения о назначении этой политики.
   Поле **Назначено** будет заполнено автоматически, в зависимости от текущего пользователя. Это поле не является обязательным, поэтому можно ввести произвольные значения.

1. Оставьте _включенным_ применение политик. Дополнительные сведения см. в разделе [Режим применения](./concepts/assignment-structure.md#enforcement-mode) статьи о назначении политик.

1. Щелкните **Далее** в нижней части страницы или вкладку **Параметры** в верхней части страницы, чтобы перейти к следующему сегменту мастера назначений.

1. Если в определении политики, выбранном на вкладке **Основные сведения**, были дополнительные параметры, их можно настроить на этой вкладке. Так как в политике _Аудит виртуальных машин, которые не используют управляемые диски,_ нет параметров, просто щелкните **Далее** в нижней части страницы или вкладку **Исправление** в верхней части страницы, чтобы перейти к следующему сегменту мастера назначений.

1. Оставьте флажок **Создать управляемое удостоверение** неустановленным. Его _необходимо_ устанавливать, если политика или инициатива содержит политику с эффектом [deployIfNotExists](./concepts/effects.md#deployifnotexists) или [modify](./concepts/effects.md#modify). Так как политика, используемая в этом кратком руководстве, не такая, оставьте соответствующее поле пустым. Дополнительные сведения см. в статье [Что такое управляемые удостоверения для ресурсов Azure?](../../active-directory/managed-identities-azure-resources/overview.md) и разделе [How remediation security works](./how-to/remediate-resources.md#how-remediation-security-works) (Как работает безопасность исправлений).

1. Щелкните **Далее** в нижней части страницы или вкладку **Сообщения о несоответствии** в верхней части страницы, чтобы перейти к следующему сегменту мастера назначений.

1. Для параметра **Сообщение о несоответствии** задайте значение _Виртуальные машины должны использовать управляемый диск_. Это пользовательское сообщение отображается, когда ресурс отклоняется или определяется как несоответствующий во время регулярной оценки.

1. Щелкните **Далее** в нижней части страницы или вкладку **Просмотреть и создать** в верхней части страницы, чтобы перейти к следующему сегменту мастера назначений.

1. Проверьте выбранные значения, затем щелкните **Создать** в нижней части страницы.

Теперь все готово к обнаружению ресурсов, которые не соответствуют требованиям, что позволит оценить состояние соответствия в среде.

## <a name="identify-non-compliant-resources"></a>Выявление несоответствующих ресурсов

Выберите **Соответствие** в левой части страницы и найдите ранее созданное назначение политики _Аудит виртуальных машин, которые не используют управляемые диски_.

:::image type="content" source="./media/assign-policy-portal/policy-compliance.png" alt-text="Снимок экрана: сведения о соответствии политике на странице &quot;Соответствие политике&quot;." border="false":::

Существующие ресурсы, которые не соответствуют новому назначению, отображаются в разделе **Несоответствующие ресурсы**.

Если условие применяется к существующим ресурсам и оказывается верным, такие ресурсы помечаются как несовместимые с настроенной политикой. В следующей таблице показано, как действуют разные политики в сочетании с оценкой условий для определения итогового состояния соответствия. Хотя логика оценки не отображается на портале Azure, там доступны результаты, полученные при оценке состояния соответствия. Они могут быть такими: Соответствует либо Не соответствует.

| Состояние ресурса | Действие | Вычисление политики | Состояние соответствия |
| --- | --- | --- | --- |
| Новая или обновленная | Audit, Modify, AuditIfNotExist | True | Не соответствует |
| Новая или обновленная | Audit, Modify, AuditIfNotExist | False | Соответствует |
| Exists | Deny, Audit, Append, Modify, DeployIfNotExist, AuditIfNotExist | True | Не соответствует |
| Exists | Deny, Audit, Append, Modify, DeployIfNotExist, AuditIfNotExist | False | Соответствует |

> [!NOTE]
> Для установки состояния несоответствия эффекты DeployIfNotExist и AuditIfNotExist требуют, чтобы оператор IF возвращал значение TRUE, а условие существования возвращало FALSE. Когда установлено значение TRUE, условие IF запускает оценку условия существования для связанных ресурсов.

## <a name="clean-up-resources"></a>Очистка ресурсов

Чтобы удалить созданное назначение, выполните следующие действия:

1. Выберите элемент **Соответствие** (или **Назначения**) в левой части страницы службы Политика Azure и найдите ранее созданное назначение политики _Аудит виртуальных машин, которые не используют управляемые диски_.

1. Щелкните правой кнопкой мыши назначение политики _Аудит виртуальных машин, которые не используют управляемые диски_ и выберите **Удалить назначение**.

   :::image type="content" source="./media/assign-policy-portal/delete-assignment.png" alt-text="Снимок экрана: использование контекстного меню для удаления назначения на странице &quot;Соответствие&quot;." border="false":::

## <a name="next-steps"></a>Дальнейшие действия

С помощью этого краткого руководства вы назначили определение политики для области и изучили отчет о соответствии.
Определение политики проверяет, все ли ресурсы в области соответствуют требованиям, и определяет, какие из них не соответствуют.

Следующее руководство серии содержит сведения о назначении политик для проверки новых ресурсов на соответствие требованиям:

> [!div class="nextstepaction"]
> [Создание политик и управление ими](./tutorials/create-and-manage.md)