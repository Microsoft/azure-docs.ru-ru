---
title: API-интерфейсы Фармбеатс Azure
description: Узнайте о API-интерфейсах Azure Фармбеатс, которые предоставляют сельскохозяйственное предприятиям стандартизированный интерфейс RESTFUL с ответами на основе JSON.
author: sunasing
ms.topic: article
ms.date: 11/04/2019
ms.author: sunasing
ms.openlocfilehash: 292374bcce90da042dc6bd672feaad3750759aa9
ms.sourcegitcommit: 910a1a38711966cb171050db245fc3b22abc8c5f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "92674511"
---
# <a name="azure-farmbeats-apis"></a>API-интерфейсы Фармбеатс Azure

В этой статье описываются интерфейсы API Фармбеатс для Azure. Интерфейсы API Фармбеатс для Azure предоставляют сельскохозяйственное предприятиям стандартизированный интерфейс RESTFUL с ответами на основе JSON, чтобы помочь вам воспользоваться преимуществами возможностей Azure Фармбеатс, например:

- API-интерфейсы для получения датчиков, камер, помощью Дронов, погоды, вспомогательных и проверенных данных о заземлении.
- Нормализация и контекстуальность данных в общих поставщиках данных.
- Схематизированных доступ и возможность запросов для всех полученных данных.
- Автоматическое создание метаданных, которые можно запрашивать на основе функций агрономик.
- Автоматически созданные статистические выражения последовательности времени для быстрого создания модели.
- Интегрированный механизм фабрики данных Azure, позволяющий легко создавать пользовательские конвейеры обработки данных.

## <a name="application-development"></a>Разработка приложений

API-интерфейсы Фармбеатс содержат техническую документацию по Swagger. Сведения обо всех API-интерфейсах и соответствующих запросах или ответах см. в разделе [Swagger](https://aka.ms/FarmBeatsDatahubSwagger).

В следующей таблице перечислены все объекты и ресурсы в Фармбеатс Датахуб.

| Объекты и ресурсы | Описание
--- | ---|
Farm | Ферма соответствует физическому расположению, представляющему интерес в системе Фармбеатс. Каждая ферма имеет имя фермы и уникальный идентификатор фермы. |
Устройство  | Устройство соответствует физическому устройству, присутствующему в ферме. Каждое устройство имеет уникальный идентификатор устройства. Устройство обычно подготавливается к ферме с ИДЕНТИФИКАТОРом фермы.
DeviceModel  | DeviceModel соответствует метаданным устройства, например изготовителю, и типу устройства, которое является либо шлюзом, либо узлом.
Sensor  | Датчик соответствует физическому датчику, записывающему значения. Датчик обычно подключается к устройству по идентификатору устройства.
SensorModel  | Сенсормодел соответствует метаданным датчика, например изготовителю, типу датчика, который является либо аналоговым, либо цифровым, а также измерением датчика, например окружающей температуры и нажимом.
Телеметрия  | Данные телеметрии позволяют читать сообщения телеметрии для определенного датчика и диапазона времени.
Задание  | Задание соответствует любому рабочему процессу действий, выполняемых в системе Фармбеатс для получения нужных выходных данных. Каждое задание связано с ИДЕНТИФИКАТОРом задания и типом задания.
JobType  | JobType соответствует различным типам заданий, поддерживаемым системой. Включены определенные системой и определяемые пользователем типы заданий.
ExtendedType  | ExtendedType соответствует списку системных и определяемых пользователем типов в системе. ExtendedType помогает настроить новый тип файла датчика, сцены или сцены в системе Фармбеатс.
Партнер  | Партнер соответствует партнеру по интеграции датчиков и образов для Фармбеатс.
Сцена  | Сцена соответствует всем созданным выходным данным в контексте фермы. Каждая сцена имеет идентификатор сцены, источник сцены, тип сцены и связанный с ним идентификатор фермы. С каждым ИДЕНТИФИКАТОРом сцены может быть связано несколько файлов сцены.
сценефиле |Сценефиле соответствует всем файлам, созданным для одной сцены. С одним ИДЕНТИФИКАТОРом сцены может быть связано несколько идентификаторов Сценефиле.
Правило  |Правило соответствует условию для данных, связанных с фермой, для активации предупреждения. Каждое правило находится в контексте данных фермы.
Оповещение  | Предупреждение соответствует уведомлению, которое создается при выполнении условия правила. Каждое оповещение находится в контексте правила.
RoleDefinition  | Определения роли определяет разрешенные и запрещенные действия для роли.
RoleAssignment  |RoleAssignment соответствует назначению роли пользователю или субъекту-службе.

### <a name="data-format"></a>Формат данных

JSON является стандартным не зависящим от языка форматом данных, предоставляющим простое текстовое представление произвольных структур данных. Дополнительные сведения см. на [веб-сайте JSON](https://www.json.org/).

## <a name="authentication-and-authorization"></a>Аутентификация и авторизация

HTTP-запросы к REST API защищены с помощью Azure Active Directory (Azure AD).
Чтобы выполнить запрос, прошедший проверку подлинности в API-интерфейсах, клиентский код требует проверки подлинности с действительными учетными данными перед вызовом API. Служба проверки подлинности координирует взаимодействие между различными субъектами в Azure AD. Он предоставляет клиенту маркер доступа в качестве подтверждения проверки подлинности. Затем маркер отправляется в заголовке авторизации HTTP запросов REST API. Дополнительные сведения о проверке подлинности Azure AD см. в статье [Azure Active Directory](https://portal.azure.com) для разработчиков.

Маркер доступа должен быть отправлен в последующих запросах API в разделе заголовка, как показано ниже.

```http
headers = {"Authorization": "Bearer " + **access_token**}
```

### <a name="http-request-headers"></a>Заголовки запросов HTTP

Ниже приведены наиболее распространенные заголовки запросов, которые необходимо указать при выполнении вызова API в Azure Фармбеатс Датахуб.


**Верхняя часть** | **Описание и пример**
--- | ---
Content-Type  | Формат запроса (Content-Type: application/<format>). Для API-интерфейсов Azure Фармбеатс Датахуб используется формат JSON. Content-Type: application/json
Авторизация  | Указывает маркер доступа, необходимый для выполнения вызова API. Авторизация: Bearer <маркер доступа>
Принять | Формат ответа. Для API-интерфейсов Azure Фармбеатс Датахуб используется формат JSON. Accept: application/json

### <a name="api-requests"></a>Запросы API

Чтобы выполнить запрос REST API, необходимо объединить метод HTTP (GET, POST, WHERE или DELETE), URL-адрес службы API, URI для запроса, отправить данные в, обновить или удалить, а затем добавить один или несколько заголовков HTTP-запроса.

URL-адрес службы API — это URL-адрес Датахуб, например https:// \<yourdatahub-website-name> . azurewebsites.NET.

При необходимости в вызовы GET можно включить параметры запроса для фильтрации, ограничения размера и сортировки данных в ответах.

Следующий пример запроса используется для получения списка устройств:

```bash
curl -X GET "https://microsoft-farmbeats.azurewebsites.net/Device" -H "Content-Type: application/json" -H "Authorization: Bearer <Access-Token>”
```

Для большинства вызовов GET, POST и PUT требуется текст запроса JSON.

Следующий пример запроса создает устройство. Этот запрос содержит входные данные JSON с текстом запроса.

```bash
curl -X POST "https://microsoft-farmbeats.azurewebsites.net/Device" -H  "accept: application/json" -H  "Content-Type: application/json" -H "Authorization: Bearer <Access-Token>" -d "{  \"deviceModelId\": \"ID123\",  \"hardwareId\": \"MHDN123\",  \"reportingInterval\": 900,  \"name\": \"Device123\",  \"description\": \"Test Device 123\",}"
```

### <a name="query-parameters"></a>Параметры запроса

Для вызовов GET RESTFUL можно фильтровать, ограничивать размер и отсортировать данные в ответе API, включив один или несколько параметров запроса в URI запроса. Сведения о параметрах запроса см. в документации по API и отдельных вызовах GET.
Например, при запросе списка устройств (вызов GET на/девице) можно указать следующие параметры запроса:

![Список устройств](./media/references-for-azure-farmbeats/query-parameters-device-1.png)

### <a name="error-handling"></a>Обработка ошибок

API-интерфейсы Azure Фармбеатс Датахуб возвращают стандартные ошибки HTTP. Ниже приведены наиболее распространенные коды ошибок.

 |Код ошибки             | Описание |
 |---                    | --- |
 |200                    | Успешно |
 |201                    | Создание (POST) успешно завершено |
 |400                    | Недопустимый запрос. Ошибка в запросе. |
 |401                    | Не авторизовано. Вызывающий интерфейс API не имеет прав доступа к ресурсу. |
 |404                    | Ресурс не найден |
 |5XX                    | Внутренняя ошибка сервера. Коды ошибок, начинающиеся с 5XX, означают наличие ошибки на сервере. Дополнительные сведения см. в журналах сервера и в следующем разделе. |


Помимо стандартных ошибок HTTP, API-интерфейсы Azure Фармбеатс Датахуб также возвращают внутренние ошибки в следующем формате:

```json
    {
      "message": "<More information on the error>",
      "status": "<error code>”,
      "code": "<InternalErrorCode>",
      "moreInfo": "<Details of the error>"
    }
```

В этом примере при создании фермы обязательное поле "имя" не было указано во входных данных. Полученное сообщение об ошибке будет выглядеть следующим образом:

 ```json    
    {
      "message": "Model validation failed",
      "status": 400,
      "code": "ModelValidationFailed",
      "moreInfo": "[\"The Name field is required.\"]"
    }
  ```

## <a name="add-users-or-app-registrations-to-azure-active-directory"></a>Добавление пользователей или регистраций приложений в Azure Active Directory

Доступ к API Фармбеатс для Azure может осуществляться пользователем или регистрацией приложения в Azure Active Directory. Чтобы создать регистрацию приложения в Azure Active Directory, выполните следующие действия.

1. Перейдите к [портал Azure](https://portal.azure.com)и выберите **Azure Active Directory**  >  **Регистрация приложений**  >  **Новая регистрация**. Кроме того, можно использовать существующую учетную запись.
2. Для новой учетной записи выполните следующие действия.

    - Введите имя.
    - Выберите **учетные записи только в этом каталоге организации (один клиент)**.
    - Используйте значения по умолчанию в остальных полях.
    - Выберите **Зарегистрировать**.

3. На панели новый и существующий **Обзор** регистрации приложений выполните следующие действия.

    - Запишите **идентификатор клиента** и **идентификатор** клиента.
    - Перейдите к разделу **Сертификаты и секреты** , чтобы создать новый секрет клиента и записать **секрет клиента**.
    - Вернитесь к разделу **Обзор** и выберите ссылку рядом с пунктом **Управление приложением в локальном каталоге**.
    - Перейдите в раздел **Свойства** , чтобы записать **идентификатор объекта**.

4. Перейдите к Датахуб Swagger (https:// <yourdatahub> . azurewebsites.net/swagger/index.html) и выполните следующие действия.
    - Перейдите к **API RoleAssignment**.
    - Выполните запись, чтобы создать объект **RoleAssignment** для только что созданного **идентификатора объекта** .
 
```json
{
  "roleDefinitionId": "a400a00b-f67c-42b7-ba9a-f73d8c67e433",
  "objectId": "objectId from step 3 above",
  "objectIdType": "ServicePrincipalId",
  "tenantId": "tenant id of your Azure subscription"
}
```

  > [!NOTE]
  > Дополнительные сведения о добавлении пользователей и регистрации Active Directory см. в разделе [Azure Active Directory](../../active-directory/develop/howto-create-service-principal-portal.md).

После выполнения описанных выше действий регистрация приложения (клиент) может вызывать API-интерфейсы Фармбеатс для Azure с помощью маркера доступа через проверку подлинности носителя.

Используйте маркер доступа, чтобы отправить его в последующих запросах API в разделе заголовка следующим образом:

```http
headers = {"Authorization": "Bearer " + **access_token**, "Content-Type" : "application/json" }
```