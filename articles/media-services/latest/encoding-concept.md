---
title: Кодирование видео и аудио с помощью служб мультимедиа
description: В этой статье объясняется, как кодировать видео и аудио с помощью служб мультимедиа Azure.
services: media-services
documentationcenter: ''
author: IngridAtMicrosoft
manager: femila
editor: ''
ms.service: media-services
ms.workload: ''
ms.topic: conceptual
ms.date: 08/31/2020
ms.author: inhenkel
ms.custom: seodec18
ms.openlocfilehash: 84caa287803fa64b12d9da4c2afb1f8dd1418e13
ms.sourcegitcommit: 6386854467e74d0745c281cc53621af3bb201920
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/08/2021
ms.locfileid: "102455286"
---
# <a name="encoding-video-and-audio-with-media-services"></a>Кодирование видео и аудио с помощью служб мультимедиа

[!INCLUDE [media services api v3 logo](./includes/v3-hr.md)]

Термин кодирование в службах мультимедиа применяется к процессу преобразования файлов, содержащих цифровые видео и (или) звук, из одного стандартного формата в другой, с целью уменьшения размера файлов и (б) создания формата, совместимого с широким спектром устройств и приложений. Этот процесс также называется сжатием видео или перекодировкой. Дополнительные сведения о концепциях см. в статье [Сжатие данных](https://en.wikipedia.org/wiki/Data_compression) и [кодирование и перекодирование](https://www.streamingmedia.com/Articles/Editorial/What-Is-/What-Is-Encoding-and-Transcoding-75025.aspx) .

Видеоролики обычно доставляются на устройства и приложения путем [последовательного скачивания](https://en.wikipedia.org/wiki/Progressive_download) или [потоковой передачи с адаптивной скоростью](https://en.wikipedia.org/wiki/Adaptive_bitrate_streaming).

> [!IMPORTANT]
> Службы мультимедиа не выставляются за отмененные или ошибочные задания. Например, задание, которое достигло времени выполнения 50% и отменено, не оплачивается по 50% минут выполнения задания. Вы платите только за завершенные задания.

* Для доставки с помощью последовательного скачивания можно использовать службы мультимедиа Azure для преобразования файла цифрового мультимедиа (Media) в [MP4](https://en.wikipedia.org/wiki/MPEG-4_Part_14) -файл, который содержит видео, закодированное с помощью кодека [H. 264](https://en.wikipedia.org/wiki/H.264/MPEG-4_AVC) , и звук, закодированный с помощью кодека [AAC](https://en.wikipedia.org/wiki/Advanced_Audio_Coding) . Этот MP4-файл записывается в ресурс в учетной записи хранения. Для непосредственного скачивания файла можно использовать API службы хранилища Azure или пакеты SDK (например, [REST API хранилища](../../storage/common/storage-rest-api-auth.md) или [пакет SDK для .NET](../../storage/blobs/storage-quickstart-blobs-dotnet.md)). Если вы создали выходной ресурс с заданным именем контейнера в хранилище, используйте это расположение. В противном случае можно использовать службы мультимедиа для [вывода списка URL-адресов контейнера ресурсов](/rest/api/media/assets/listcontainersas). 
* Чтобы подготовить содержимое для доставки с помощью потоковой передачи с адаптивной скоростью, файл подмножества должен быть закодирован с несколькими скоростями (от высокого до низкого). Чтобы обеспечить корректное качество, разрешение видео уменьшается по мере понижения скорости. Это приводит к последовательному вызову кодировки — таблице разрешений и скорости (см. раздел [автоматически созданная лестница с адаптивной скоростью](autogen-bitrate-ladder.md)). Службы мультимедиа можно использовать для кодирования файлов карт с несколькими скоростями. При этом вы получите набор MP4-файлов и связанные файлы конфигурации потоковой передачи, записанные в ресурс в учетной записи хранения. Затем можно использовать [динамическую упаковку](dynamic-packaging-overview.md) в службах мультимедиа для доставки видео через протоколы потоковой передачи, такие как [MPEG-тире](https://en.wikipedia.org/wiki/Dynamic_Adaptive_Streaming_over_HTTP) и [HLS](https://en.wikipedia.org/wiki/HTTP_Live_Streaming). Для этого необходимо создать [указатель потоковой передачи](streaming-locators-concept.md) и построить URL-адреса потоковой передачи, соответствующие поддерживаемым протоколам, которые затем можно передать на устройства или приложения в зависимости от их возможностей.

На следующей схеме показан рабочий процесс для кодирования по запросу с динамической упаковкой.

![Рабочий процесс для кодирования по запросу с динамической упаковкой](./media/dynamic-packaging-overview/media-services-dynamic-packaging.svg)

В этой статье содержатся рекомендации о том, как закодировать содержимое с помощью Служб мультимедиа версии 3.

## <a name="transforms-and-jobs"></a>Преобразования и задания

Для кодирования с помощью служб мультимедиа v3 необходимо создать [Преобразование](/rest/api/media/transforms) и [Задание](/rest/api/media/jobs). Преобразование определяет рецепт параметров кодирования и выходов. Задание является экземпляром рецепта. Дополнительные сведения см. в статье [Преобразования и задания](transforms-jobs-concept.md).

При кодировании с помощью Служб мультимедиа используются предустановки. На их основе кодировщик обрабатывает входные файлы мультимедиа. В службах мультимедиа v3 для кодирования файлов используется стандартный кодировщик. Например, можно указать разрешение видео и число аудиоканалов для закодированного содержимого.

Можно быстро приступить к работе, используя одну из рекомендуемых встроенных предустановок, основанных на передовых отраслевых рекомендациях. Можно также создать пользовательскую предустановку в соответствии с требованиями сценария или устройства. Дополнительные сведения см. в статье [Кодирование с помощью пользовательского преобразования](customize-encoder-presets-how-to.md).

Начиная с января 2019 при кодировании со стандартным кодировщиком для создания MP4-файлов создается новый MPI-файл, который добавляется в выходной ресурс. Этот MPI-файл предназначен для повышения производительности [динамической упаковки](dynamic-packaging-overview.md) и потоковой передачи.

> [!NOTE]
> Не следует изменять или удалять MPI-файл или зависеть от службы на наличие (или отсутствия) такого файла.

### <a name="creating-job-input-from-an-https-url"></a>Создание входных данных задания из URL-адреса HTTPS

При отправке заданий для обработки видео необходимо сообщить службам мультимедиа, где найти входное видео. Один из вариантов — указать URL-адрес HTTPS в качестве входных данных задания. В настоящее время службы мультимедиа v3 не поддерживают блочную кодировку для URL-адресов HTTPS.

#### <a name="examples"></a>Примеры

* [Кодирование из URL-адреса HTTPS с помощью .NET](stream-files-dotnet-quickstart.md)
* [Кодирование из URL-адреса HTTPS с помощью RESTFUL](stream-files-tutorial-with-rest.md)
* [Кодирование из URL-адреса HTTPS с помощью интерфейса командной строки](stream-files-cli-quickstart.md)
* [Кодирование из URL-адреса HTTPS с Node.js](stream-files-nodejs-quickstart.md)

### <a name="creating-job-input-from-a-local-file"></a>Создание входных данных задания из локального файла

Это видео может храниться как ресурс Служб мультимедиа. В этом случае необходимо создать входной ресурс на основе файла, который хранится локально в хранилище BLOB-объектов Azure.

#### <a name="examples"></a>Примеры

[Кодирование локального файла с помощью встроенных предустановок](job-input-from-local-file-how-to.md)

### <a name="creating-job-input-with-subclipping"></a>Создание входных данных задания с отсечением

При кодировании видео можно задать также усечение или обрезать исходный файл и выдать выходные данные, которые будут содержать только нужную часть входного видео. Эта функция работает с любыми [преобразованиями](/rest/api/media/transforms) , созданными с использованием предустановок [буилтинстандарденкодерпресет](/rest/api/media/transforms/createorupdate#builtinstandardencoderpreset) или [стандарденкодерпресет](/rest/api/media/transforms/createorupdate#standardencoderpreset) .

Можно указать, чтобы создать [Задание](/rest/api/media/jobs/create) с одним клипом видео по запросу или в динамическом архиве (записанное событие). Входным заданием может быть ресурс или URL-адрес HTTPS.

> [!TIP]
> Если вы хотите выполнить потоковую передачу сублип видео без повторной кодировки видео, рассмотрите возможность использования [предварительной фильтрации манифестов с динамическим упаковщиком](filters-dynamic-manifest-overview.md).

#### <a name="examples"></a>Примеры

См. примеры:

* [Создание субклипа из видео с помощью .NET](subclip-video-dotnet-howto.md)
* [Создание субклипа из видео с помощью REST](subclip-video-rest-howto.md)

## <a name="built-in-presets"></a>Встроенные предустановки

Службы мультимедиа поддерживают следующие встроенные предустановки кодирования:  

### <a name="builtinstandardencoderpreset"></a>BuiltInStandardEncoderPreset

[BuiltInStandardEncoderPreset](/rest/api/media/transforms/createorupdate#builtinstandardencoderpreset) задает встроенную предустановку для кодирования входящего видео с помощью кодировщика категории "Стандартный".

В настоящее время поддерживаются приведенные ниже предустановки.

- **Енкодернамедпресет. аакгудкуалитяудио**. создает один MP4-файл, содержащий только стерео аудио-кодирование с 192 кбит/с.
- **Енкодернамедпресет. адаптивестреаминг** (рекомендуется). Дополнительные сведения см. [в разделе Автоматическое создание лестницы с скоростью](autogen-bitrate-ladder.md).
- **Енкодернамедпресет. контентаваринкодинг**. предоставляет предустановку для кодирования с поддержкой содержимого. При наличии входного содержимого служба пытается автоматически определить оптимальное количество слоев и соответствующие параметры скорости и разрешения для доставки адаптивной потоковой передачей. С течением времени базовые алгоритмы продолжат развиваться. Выходные данные будут содержать файлы MP4 с чередованием видео и аудио. Дополнительные сведения см. в разделе [кодировка с учетом содержимого](content-aware-encoding.md).

  > [!NOTE]
  > Убедитесь, что используется **контентаваринкодинг** , а не контентаваринкодинжекспериментал.
- **Енкодернамедпресет. H264MultipleBitrate1080p**. создает набор из восьми файлов MP4 с поддержкой GOP, от 6000 кбит до 400 Кбит/с и стерео AAC Audio. Разрешение — 360–1080 пикселей.
- **Енкодернамедпресет. H264MultipleBitrate720p**. создает набор из шести файлов MP4 с поддержкой GOP, от 3400 кбит до 400 Кбит/с и стерео AAC Audio. Разрешение — 360–720 пикселей.
- **Енкодернамедпресет. H264MultipleBitrateSD**. создает набор из пяти файлов MP4 с поддержкой GOP, от 1600 кбит до 400 Кбит/с и стерео AAC Audio. Разрешение — 360–480 пикселей.
- **Енкодернамедпресет. H264SingleBitrate1080p**. создает MP4-файл, в котором видео кодируется с помощью микрокодека H. 264 с частотой 6750 кбит/с и высотой изображения в 1080 пикселей, а стерео аудио кодируется с помощью кодека AAC-LC в 64 кбит/с.
- **Енкодернамедпресет. H264SingleBitrate720p**. создает MP4-файл, в котором видео кодируется с помощью микрокодека H. 264 с частотой 4500 кбит/с и высотой изображения в 720 пикселей, а стерео аудио кодируется с помощью кодека AAC-LC в 64 кбит/с.
- **Енкодернамедпресет. H264SingleBitrateSD**. создает MP4-файл, в котором видео кодируется с помощью микрокодека H. 264 с частотой 2200 кбит/с и высотой изображения в 480 пикселей, а стерео аудио кодируется с помощью кодека AAC-LC в 64 кбит/с.

Чтобы просмотреть наиболее актуальный список предварительных настроек, ознакомьтесь со [статьей встроенные предустановки, которые будут использоваться для кодирования видео](/rest/api/media/transforms/createorupdate#encodernamedpreset).

Сведения об использовании предустановок см. в разделе [Отправка, кодирование и потоковая передача файлов](stream-files-tutorial-with-api.md).

### <a name="standardencoderpreset"></a>StandardEncoderPreset

[StandardEncoderPreset](/rest/api/media/transforms/createorupdate#standardencoderpreset) описывает параметры, используемые при кодировании входящего видео с помощью кодировщика категории "Стандартный". Эту предустановку следует использовать при настройке предустановок преобразования.

#### <a name="considerations"></a>Рекомендации

При создании пользовательских предустановок применяются следующие соображения.

- Все значения высоты и ширины в содержимом AVC должны быть кратными четырем.
- В службах мультимедиа Azure v3 все скорости кодирования находятся в битах в секунду. Это отличается от предустановок с помощью API v2, которые использовались в килобитах в секунду в качестве единицы измерения. Например, если скорость в v2 была указана как 128 (килобит в секунду), то в v3 будет установлено значение 128000 (бит/сек).

### <a name="customizing-presets"></a>Настройка предустановок

Службы мультимедиа полностью поддерживают настройку всех значений в предустановках в соответствии с конкретными требованиями к кодированию. Примеры, демонстрирующие, как настроить предустановки кодировщика, см. в следующем списке:

#### <a name="examples"></a>Примеры

- [Настройка предустановок с помощью .NET](customize-encoder-presets-how-to.md)
- [Настройка предустановок с помощью интерфейса командной строки](custom-preset-cli-howto.md)
- [Настройка предустановок с помощью ОСТАВШЕЙся](custom-preset-rest-howto.md)

## <a name="preset-schema"></a>Предустановленная схема

В службах мультимедиа v3 предустановки являются строго типизированными сущностями в самом API. Определение схемы для этих объектов можно найти в [спецификации Open API (или Swagger)](https://github.com/Azure/azure-rest-api-specs/tree/master/specification/mediaservices/resource-manager/Microsoft.Media/stable/2018-07-01). Предварительные определения (например, **стандарденкодерпресет**) можно также просмотреть в [REST API](/rest/api/media/transforms/createorupdate#standardencoderpreset), [пакете SDK для .NET](/dotnet/api/microsoft.azure.management.media.models.standardencoderpreset) (или в другой справочной документации по службам мультимедиа версии 3).

## <a name="scaling-encoding-in-v3"></a>Масштабирование кодирования в версии 3

Сведения об масштабировании обработки мультимедиа см. в разделе [масштабирование с помощью CLI](media-reserved-units-cli-how-to.md).

## <a name="billing"></a>Выставление счетов

Службы мультимедиа не выставляются за отмененные или ошибочные задания. Например, задание, которое достигло времени выполнения 50% и отменено, не оплачивается по 50% минут выполнения задания. Вы платите только за завершенные задания.

Дополнительные сведения см. в разделе [цены](https://azure.microsoft.com/pricing/details/media-services/).

## <a name="ask-questions-give-feedback-get-updates"></a>Получение справки, отправка отзывов, получение обновлений

Прочитайте статью [сообщества Служб мультимедиа Azure](media-services-community.md), чтобы узнать, как задавать вопросы, оставлять отзывы и получать новости о Службах мультимедиа.

## <a name="next-steps"></a>Дальнейшие действия

* [Отправка, кодирование и потоковая передача с помощью служб мультимедиа](stream-files-tutorial-with-api.md).
* [Кодирование из URL-адреса HTTPS с помощью встроенных предустановок](job-input-from-http-how-to.md).
* [Кодирование локального файла с помощью встроенных предустановок](job-input-from-local-file-how-to.md).
* [Создание пользовательской предустановки в соответствии с требованиями сценария или устройства](customize-encoder-presets-how-to.md).
