---
title: Предустановка для кодировки с учетом содержимого
description: В этой статье рассматривается кодировка с учетом содержимого в Cлужбы мультимедиа Microsoft Azure v3.
services: media-services
documentationcenter: ''
author: IngridAtMicrosoft
manager: femila
editor: ''
ms.service: media-services
ms.workload: ''
ms.topic: conceptual
ms.date: 08/31/2020
ms.author: inhenkel
ms.custom: devx-track-csharp
ms.openlocfilehash: ce18e71ced320c408933caeb39b469d5885bd6ba
ms.sourcegitcommit: 910a1a38711966cb171050db245fc3b22abc8c5f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "101095934"
---
# <a name="use-the-content-aware-encoding-preset-to-find-the-optimal-bitrate-value-for-a-given-resolution"></a>Используйте предустановку кодирования с поддержкой содержимого, чтобы найти оптимальное значение скорости для заданного разрешения.

[!INCLUDE [media services api v3 logo](./includes/v3-hr.md)]

Чтобы подготовить содержимое для доставки с помощью [потоковой передачи с адаптивной скоростью](https://en.wikipedia.org/wiki/Adaptive_bitrate_streaming), видео необходимо закодировать на несколько битовых ставок (от высокого до низкого). Это обеспечивает плавное ухудшение качества, так как скорость понижается, так что это разрешение видео. Такая многобитная кодировка позволяет использовать так называемую последовательность кодирования, а также таблицу разрешений и скорость, которые см. в разделе [встроенные предустановки кодирования](/rest/api/media/transforms/createorupdate#encodernamedpreset)служб мультимедиа.

Необходимо учитывать содержимое, которое вы обрабатываете, а также настраивать или настраивать кодирование на уровне сложности отдельного видео. При каждом решении скорость работы выше, чем увеличение качества, не перцептиве — кодировщик работает с этим оптимальным значением скорости. Следующий уровень оптимизации — выбор разрешений, основанных на содержимом. Например, видео презентации PowerPoint не имеет смысла переходить к следующему 720p. В дальнейшем кодировщик может быть назначен для оптимизации параметров для каждого снимка в видео. 

Предустановка [адаптивной потоковой передачи](autogen-bitrate-ladder.md) (Майкрософт) частично решает проблему изменчивости качества и разрешения исходных видеороликов. Наши клиенты имеют разную комбинацию содержимого, некоторые на 1080p, другие по адресу 720p и некоторые в SD и более низких решениях. Кроме того, не все содержимое источника — высококачественные системы на пленке или ТЕЛЕВИЗОРе Studios. Предустановка адаптивной потоковой передачи решает эти проблемы, гарантируя, что лестница с скоростью никогда не превысит разрешение или среднюю скорость входного набора. Однако эта Предустановка не проверяет свойства источника, отличные от разрешения и скорости.

## <a name="the-content-aware-encoding"></a>Кодировка с поддержкой содержимого

Конфигурация кодирования с поддержкой содержимого расширяет механизм потоковой передачи с адаптивной скоростью, включая пользовательскую логику, которая позволяет кодировщику найти оптимальное значение скорости для заданного разрешения, но без тщательного анализа вычислений. Эта Предустановка создает набор MP4 со множественной с GOP по подключу. Учитывая любое входное содержимое, служба выполняет исходный упрощенный анализ входного содержимого и использует результаты для определения оптимального количества слоев, соответствующих параметров скорости и разрешения для доставки с помощью адаптивной потоковой передачи. Эта Предустановка особенно эффективна для видеороликов с низким и средним уровнем сложности, где выходные файлы будут иметь меньшую скорость, чем Предустановка адаптивной потоковой передачи, но с качеством, которая по-прежнему обеспечивает хорошее удобство просмотра. Выходные данные будут содержать файлы MP4 с чередованием видео и аудио

На следующих образцах диаграмм показано сравнение с использованием метрик качества, таких как [пснр](https://en.wikipedia.org/wiki/Peak_signal-to-noise_ratio) и [вмаф](https://en.wikipedia.org/wiki/Video_Multimethod_Assessment_Fusion). Источник был создан путем сцепления коротких клипов с высоким уровнем сложности от фильмов и ТЕЛЕПЕРЕДАЧ, предназначенных для нагрузки кодировщика. По определению эта Предустановка позволяет получить результаты, отличающиеся от содержимого к содержимому — это также означает, что для некоторого содержимого может не быть существенного снижения скорости или улучшения качества.

![Кривая с частотой искажения (RD) с использованием ПСНР](media/content-aware-encoding/msrv1.png)

**Рисунок 1. кривая с интенсивным искажением (RD) с использованием метрики ПСНР для источника высокой сложности**

![Кривая с частотой искажения (RD) с использованием ВМАФ](media/content-aware-encoding/msrv2.png)

**Рисунок 2. кривая с частотой искажения (RD) с использованием метрики ВМАФ для источника высокой сложности**

Ниже приведены результаты для другой категории исходного содержимого, где кодировщику удалось определить, что входные данные были низким качеством (многие артефакты сжатия связаны с низкой скоростью). Обратите внимание, что при использовании предустановки с учетом содержимого кодировщик решил создать только один выходной слой с низкой скоростью, чтобы большинство клиентов могли воспроизводить поток без ожидания.

![Кривая удаленных рабочих столов с помощью ПСНР](media/content-aware-encoding/msrv3.png)

**Рис. 3. кривая удаленных рабочих столов с использованием ПСНР для ввода низкого качества (в 1080p)**

![Кривая удаленных рабочих столов с помощью ВМАФ](media/content-aware-encoding/msrv4.png)

**Рис. 4. кривая удаленных рабочих столов с использованием ВМАФ для ввода низкого качества (в 1080p)**

## <a name="how-to-use-the-content-aware-encoding-preset"></a>Использование предустановки кодировки с поддержкой содержимого 

Вы можете создать преобразования, использующие эту предустановку, как показано ниже. 

В разделе [дальнейшие действия](#next-steps) приведены учебники, в которых используются выходные данные преобразования. Выходной ресурс можно доставить из конечных точек потоковой передачи служб мультимедиа в таких протоколах, как MPEG-ТИРЕ и HLS (как показано в учебниках).

> [!NOTE]
> Обязательно используйте предустановку **контентаваринкодинг** , не контентаваринкодинжекспериментал.

```csharp
TransformOutput[] output = new TransformOutput[]
{
   new TransformOutput
   {
      // The preset for the Transform is set to one of Media Services built-in sample presets.
      // You can customize the encoding settings by changing this to use "StandardEncoderPreset" class.
      Preset = new BuiltInStandardEncoderPreset()
      {
         // This sample uses the new preset for content-aware encoding
         PresetName = EncoderNamedPreset.ContentAwareEncoding
      }
   }
};
```

> [!NOTE]
> Счета для заданий кодирования, использующих `ContentAwareEncoding` предустановку, выставляются на основе выходных минут. 
  
## <a name="next-steps"></a>Дальнейшие действия

* [Учебник. Отправка, кодирование и потоковая передача видео со службами мультимедиа v3](stream-files-tutorial-with-api.md)
* [Руководство. Кодирование удаленного файла на основе URL-адреса и потоковой передачи видео с помощью REST](stream-files-tutorial-with-rest.md)
* [Руководство. кодирование удаленного файла на основе URL-адреса и потока видео — CLI](stream-files-cli-quickstart.md)
* [Руководство по кодированию удаленного файла на основе URL-адреса и потоковой передачи видео с помощью .NET](stream-files-dotnet-quickstart.md)
* [Руководство по кодированию удаленного файла на основе URL-адреса и потоковой передачи видео с помощью Node.js](stream-files-nodejs-quickstart.md)
