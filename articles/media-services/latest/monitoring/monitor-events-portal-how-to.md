---
title: Мониторинг событий служб мультимедиа с помощью портала службы "Сетка событий"
description: В этой статье показано, как подписаться на Сетку событий для отслеживания событий Служб мультимедиа Azure.
services: media-services
documentationcenter: na
author: IngridAtMicrosoft
manager: femila
editor: ''
tags: ''
keywords: azure media services, stream, broadcast, live, offline
ms.service: media-services
ms.devlang: multiple
ms.topic: how-to
ms.tgt_pltfrm: multiple
ms.workload: media
ms.date: 03/17/2021
ms.author: inhenkel
ms.openlocfilehash: 3828d5288c730e8fc0595a0deb6f1cb3267e885e
ms.sourcegitcommit: 772eb9c6684dd4864e0ba507945a83e48b8c16f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "104609725"
---
# <a name="create-and-monitor-media-services-events-with-event-grid-using-the-azure-portal"></a>Создание и мониторинг событий Служб мультимедиа Azure с помощью Сетки событий и портала Azure

[!INCLUDE [media services api v3 logo](../includes/v3-hr.md)]

"Сетка событий Azure" — это служба обработки событий для облака. Эта служба использует [подписки на события](../../../event-grid/concepts.md#event-subscriptions) для маршрутизации сообщений о событиях подписчикам. События Служб мультимедиа содержат все сведения, необходимые для реагирования на изменения в данных. Событие Служб мультимедиа можно определить, так как свойство eventType начинается с Microsoft.Media. Дополнительные сведения см. в статье [Схемы службы "Сетка событий Azure" для событий Служб мультимедиа](media-services-event-schemas.md).

В этой статье выполняется подписка на события для учетной записи Служб мультимедиа Azure с помощью портала Azure. Затем можно активировать события, чтобы увидеть результат. Как правило, события отправляются на конечную точку, которая обрабатывает данные событий и выполняет соответствующие действия. В этой статье мы отправляем события в веб-приложение, которое собирает и отображает сообщения.

По завершении можно увидеть, что данные событий отправлены в веб-приложение.

## <a name="prerequisites"></a>Предварительные требования 

* Наличие активной подписки Azure.
* Создайте учетную запись Служб мультимедиа Azure, как описано в [этом руководстве](../create-account-howto.md).

## <a name="create-a-message-endpoint"></a>Создание конечной точки сообщения

Перед созданием подписки на события учетной записи Служб мультимедиа необходимо создать конечную точку для сообщения о событии. Обычно конечная точка выполняет действия на основе данных событий. В этой статье разверните [готовое веб-приложение](https://github.com/Azure-Samples/azure-event-grid-viewer), которое отображает сообщения о событиях. Развернутое решение содержит план службы приложений, веб-приложение службы приложений и исходный код из GitHub.

1. Выберите **Развернуть в Azure**, чтобы развернуть решение в своей подписке. На портале Azure укажите значения остальных параметров.

   [![Изображение с кнопкой "Развернуть в Azure".](https://azuredeploy.net/deploybutton.png)](https://portal.azure.com/#create/Microsoft.Template/uri/https%3A%2F%2Fraw.githubusercontent.com%2FAzure-Samples%2Fazure-event-grid-viewer%2Fmaster%2Fazuredeploy.json)

1. Завершение развертывания может занять несколько минут. Когда развертывание успешно завершится, откройте веб-приложение и убедитесь, что оно работает. Откройте браузер и перейдите по адресу `https://<your-site-name>.azurewebsites.net`.

При переходе на сайт "Средство просмотра Сетки событий Azure" вы увидите, что в нем пока нет событий.
   
[!INCLUDE [event-grid-register-provider-portal.md](../../../../includes/event-grid-register-provider-portal.md)]

## <a name="subscribe-to-media-services-events"></a>Подписка на события Служб мультимедиа Azure

Подпишитесь на раздел, чтобы определить в сетке событий Azure, какие из них необходимо отслеживать и куда их отправлять.

1. На портале выберите свою учетную запись Media Services и нажмите **Events** (События).
1. Чтобы отправить события в приложение для просмотра, используйте веб-перехватчик для конечной точки. 

   ![Выбор веб-перехватчика](../media/monitor-events-portal/select-web-hook.png)

1. Подписка на событие автоматически заполняется значениями для учетной записи служб мультимедиа. 
1. Выберите "веб-перехватчик" для **типа конечной точки**.
1. В этом разделе мы оставляем флажок **Подписка на все типы событий**. Тем не менее, можно его снять и отфильтровать определенные типы событий. 
1. Щелкните ссылку **Выбор конечной точки**.

    Для конечной точки веб-перехватчика укажите URL-адрес веб-приложения и добавьте `api/updates` к URL-адресу домашней страницы. 

1. Нажмите кнопку **Подтвердить выбор**.
1. Нажмите кнопку **Создать**.
1. Присвойте подписке имя.

   ![Выбор журналов](../media/monitor-events-portal/create-subscription.png)

1. Теперь снова откройте веб-приложение и убедитесь, что оно успешно получило отправленное событие подтверждения подписки. 

    Сетка событий отправляет событие подтверждения, чтобы конечная точка могла подтвердить, что она готова получать данные события. Конечная точка должна задать для `validationResponse` значение `validationCode`. Дополнительные сведения см. в разделе [Сетка событий: безопасность и проверка подлинности](../../../event-grid/security-authentication.md). Вы можете просмотреть код веб-приложения, чтобы увидеть, как он проверяет подписку.

Теперь необходимо активировать события, чтобы увидеть, как Сетка событий Azure распределяет сообщение к вашей конечной точке.

## <a name="send-an-event-to-your-endpoint"></a>Отправка события в конечную точку

Вы можете активировать события для учетной записи Служб мультимедиа, запустив задание кодирования. Чтобы закодировать файл и начать отправку событий, следуйте инструкциям [в этом кратком руководстве](../stream-files-dotnet-quickstart.md). Если вы подписаны на все события, появится экран следующего вида:

> [!TIP]
> Щелкните значок с изображением глаза, чтобы развернуть данные события. Не обновляйте страницу, если вы хотите просмотреть все события.

![Просмотр события подписки](../media/monitor-events-portal/view-subscription-event.png)

## <a name="next-steps"></a>Дальнейшие действия

[Отправка, кодирование и потоковая передача](../stream-files-tutorial-with-api.md)
