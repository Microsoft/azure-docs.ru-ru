---
title: Факторы, которые следует учитывать при использовании индексатора видео в масштабе в Azure
titleSuffix: Azure Media Services
description: В этом разделе объясняются факторы, которые следует учитывать при использовании индексатора видео в масштабе.
services: media-services
author: Juliako
manager: femila
ms.service: media-services
ms.subservice: video-indexer
ms.topic: how-to
ms.date: 11/13/2020
ms.author: juliako
ms.openlocfilehash: b955c0f494b757fd29c400194ef8b11314a89a03
ms.sourcegitcommit: 910a1a38711966cb171050db245fc3b22abc8c5f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "96483616"
---
# <a name="things-to-consider-when-using-video-indexer-at-scale"></a>Факторы, которые следует учитывать при использовании индексатора видео в масштабе

При использовании индексатора видео служб мультимедиа Azure для индексирования видео и роста архива видео рассмотрите возможность масштабирования. 

Эта статья содержит ответы на такие вопросы:

* Есть ли какие – либо технологические ограничения, которые мне нужно учитывать?
* Есть ли разумный и эффективный способ сделать это?
* Можно ли предотвратить превышение затрат в процессе?

В статье приводятся шесть рекомендаций по использованию индексатора видео в масштабе.

## <a name="when-uploading-videos-consider-using-a-url-over-byte-array"></a>При отправке видео рекомендуется использовать URL-адрес в массиве байтов

Индексатор видео позволяет отправлять видео по URL-адресу или напрямую, отправляя файл в виде массива байтов, а второй — с некоторыми ограничениями. Дополнительные сведения см. в разделе [Отправка рекомендаций и ограничений](upload-index-videos.md#uploading-considerations-and-limitations) .

Во первых, у него есть ограничения на размер файла. Размер файла массива байтов ограничен 2 ГБ по сравнению с ограничением объема передачи в 30 ГБ при использовании URL-адреса.

Во вторых, рассмотрим только некоторые проблемы, которые могут повлиять на производительность, и, следовательно, возможности масштабирования:

* Отправка файлов с использованием нескольких частей означает высокую зависимость от сети, 
* надежность службы, 
* установлен 
* скорость передачи, 
* потерянные пакеты в Интернете.

:::image type="content" source="./media/considerations-when-use-at-scale/first-consideration.png" alt-text="Первый вопрос об использовании индексатора видео в масштабе":::

При отправке видео с помощью URL-адреса необходимо просто указать путь к расположению файла мультимедиа, и индексатор видео позаботится о остальном (см `videoUrl` . поле в API [передачи видео](https://api-portal.videoindexer.ai/docs/services/Operations/operations/Upload-Video?&pattern=upload) ).

> [!TIP]
> Используйте `videoUrl` необязательный параметр API передачи видео.

Чтобы увидеть пример отправки видео с помощью URL-адреса, ознакомьтесь с [этим примером](upload-index-videos.md#code-sample). Кроме того, вы можете использовать [AzCopy](../../storage/common/storage-use-azcopy-v10.md) для быстрого и надежного способа получения содержимого в учетную запись хранения, из которой вы можете отправить его в индексатор видео с помощью [URL-адреса SAS](../../storage/common/storage-sas-overview.md).

## <a name="increase-media-reserved-units-if-needed"></a>Увеличение зарезервированных единиц мультимедиа при необходимости

Обычно на этапе подтверждения концепции, когда вы просто начинаете использовать индексатор видео, вам не требуется много вычислительных ресурсов. Если вы начинаете создавать большой архив видео, который необходимо индексировать, и вы хотите, чтобы процесс настроился в соответствии с вашим вариантом использования, необходимо увеличить масштаб использования индексатора видео. Поэтому следует подумать об увеличении количества вычислительных ресурсов, используемых, если текущий объем вычислительной мощности достаточно мал.

В службах мультимедиа Azure, когда требуется повысить вычислительную мощность и параллелизм, необходимо обратить внимание на [зарезервированные единицы](../latest/concept-media-reserved-units.md)мультимедиа (RUs). RUs — это единицы вычислений, которые определяют параметры задач обработки мультимедиа. Число RUs влияет на количество задач мультимедиа, которые могут обрабатываться параллельно в каждой учетной записи, и их тип определяет скорость обработки, и для одного видео может потребоваться несколько единиц запроса, если его индекс является сложным. Когда адрес для получения занят, новые задачи будут храниться в очереди до тех пор, пока не будет доступен другой ресурс.

Для эффективной работы и предотвращения неактивности ресурсов, которые остаются неактивными, индексатор видео предлагает систему автомасштабирования, которая переходит в режим ожидания, когда требуется меньшее количество операций обработки, а также пропускная плата RUs, когда вы найдете в течение периода ожидания (полностью используйте все свои возможности). Эту функцию можно включить, [включив Автомасштабирование](manage-account-connected-to-azure.md#autoscale-reserved-units) в параметрах учетной записи или используя [API-интерфейс Update-платной учетной записи Azure-Media-Services](https://api-portal.videoindexer.ai/docs/services/Operations/operations/Update-Paid-Account-Azure-Media-Services?&pattern=update).

:::image type="content" source="./media/considerations-when-use-at-scale/second-consideration.jpg" alt-text="Второе замечание при использовании индексатора видео в масштабе":::

:::image type="content" source="./media/considerations-when-use-at-scale/reserved-units.jpg" alt-text="Зарезервированные единицы AMS":::

Для снижения длительности индексирования и низкой пропускной способности рекомендуется начать с 10 RUs типа S3. Позже, если вы выполните масштабирование для поддержки большего объема содержимого или более высокого параллелизма и вам нужны дополнительные ресурсы, вы можете [связаться с нами с помощью системы поддержки](https://ms.portal.azure.com/#blade/Microsoft_Azure_Support/HelpAndSupportBlade/newsupportrequest) (только для платных учетных записей), чтобы запросить дополнительные сведения о выделении.

## <a name="respect-throttling"></a>Соблюдение регулирования

Индексатор видео разработан для работы с индексированием в масштабе, и если вы хотите максимально эффективно использовать его, вам также следует знать о возможностях системы и спроектировать интеграцию соответствующим образом. Вы не хотите отправлять запрос на отправку для пакета видео, чтобы обнаружить, что некоторые из фильмов не были отправлены, и вы получаете код ответа HTTP 429 (слишком много запросов). Это может произойти из-за того, что вы отправили больше запросов, чем [предельное число фильмов в минуту, которое мы поддерживаем](upload-index-videos.md#uploading-considerations-and-limitations). Индексатор видео добавляет `retry-after` заголовок в ответ HTTP. заголовок указывает, когда следует попытаться выполнить следующую попытку. Прежде чем пытаться выполнить следующий запрос, убедитесь, что вы в нем соблюдаем.

:::image type="content" source="./media/considerations-when-use-at-scale/respect-throttling.jpg" alt-text="Хорошо разрабатывать интеграцию, учитывать регулирование":::

## <a name="use-callback-url"></a>Использовать URL-адрес обратного вызова

Не рекомендуется постоянно опрашивать состояние запроса с второго отправленного запроса на отправку, можно добавить [URL-адрес обратного вызова](upload-index-videos.md#callbackurl)и дождаться, пока индексатор видео обновится. Как только в запросе на отправку изменится состояние, вы получите уведомление POST по указанному URL-адресу.

URL-адрес обратного вызова можно добавить в качестве одного из параметров [API передачи видео](https://api-portal.videoindexer.ai/docs/services/Operations/operations/Upload-Video?&pattern=upload). Ознакомьтесь с примерами кода в [репозитории GitHub](https://github.com/Azure-Samples/media-services-video-indexer/tree/master/). 

Для URL-адреса обратного вызова можно также использовать функции Azure — бессерверную платформу, управляемую событиями, которую можно активировать по протоколу HTTP и реализовать следующую последовательность.

### <a name="callback-url-definition"></a>Определение URL-адреса обратного вызова

[!INCLUDE [callback url](./includes/callback-url.md)]

## <a name="use-the-right-indexing-parameters-for-you"></a>Используйте правильные параметры индексирования.

При принятии решений, связанных с использованием индексатора видео в масштабе, изучите, как максимально использовать его с нужными параметрами. Подумайте о своем варианте использования, определив различные параметры. Вы можете сэкономить деньги и ускорить процесс индексирования видео.

Перед отправкой и индексированием видео ознакомьтесь с этой короткой [документацией](upload-index-videos.md), Познакомьтесь с [индексингпресет](upload-index-videos.md#indexingpreset) и [стреамингпресет](upload-index-videos.md#streamingpreset) , чтобы лучше понять, что такое параметры.

Например, не устанавливайте для предустановки значение Streaming, если вы не планируете смотреть видео, не индексируют видео, если вам нужны только сведения о звуках.

## <a name="index-in-optimal-resolution-not-highest-resolution"></a>Индекс в оптимальном разрешении, но не в самом верхнем разрешении

Возможно, вы запрашиваете, какое качество видео требуется для индексирования видео? 

Во многих случаях производительность индексирования практически не отличается от видео HD (720P) и 4-килобайтных видео. Со временем вы получите почти те же ценные сведения, что и та же уверенность. Чем выше качество отправляемого фильма, тем выше размер файла, тем больше вычислительной мощности и времени, необходимых для отправки видео.

Например, для функции обнаружения лиц более высокое разрешение может помочь в сценарии, где существует множество небольших, но контекстно важных лиц. Однако это повлечет за собой квадратичное увеличение времени выполнения и повышенный риск ложных срабатываний.

Поэтому рекомендуется убедиться, что вы получаете правильные результаты для вашего варианта использования и сначала протестируйте его локально. Отправьте одно и то же видео в 720P и 4 КБ и Сравните полученную информацию.

## <a name="next-steps"></a>Дальнейшие действия

[Изучите выходные данные индексатора видео Azure, созданные API](video-indexer-output-json-v2.md)