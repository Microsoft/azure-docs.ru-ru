---
title: Руководство по использованию соединителей Индексатора видео с приложением Logic Apps и Power Automate.
description: В этом руководстве показано, как получить новые возможности взаимодействия и монетизации, которые предоставляют соединители Индексатора видео в сочетании с приложением Logic Apps и Power Automate.
author: anzaman
manager: johndeu
ms.author: alzam
ms.service: media-services
ms.subservice: video-indexer
ms.topic: tutorial
ms.date: 09/21/2020
ms.openlocfilehash: f3504ca4a706e92081209f4eaaa86af9f71c52b3
ms.sourcegitcommit: 910a1a38711966cb171050db245fc3b22abc8c5f
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "98880916"
---
# <a name="tutorial-use-video-indexer-with-logic-app-and-power-automate"></a>Руководство по использованию Индексатора видео с приложением Logic Apps и Power Automate

[REST API Индексатора видео версии 2](https://api-portal.videoindexer.ai/docs/services/Operations/operations/Delete-Video?) в Службах мультимедиа Azure поддерживает передачу данных между серверами и от сервера к клиенту. Это позволяет пользователям Индексаторов видео интегрировать данные видео и аудио в логику приложений, что обеспечивает новые возможности взаимодействия и монетизации.

Чтобы еще больше упростить такую интеграцию, мы поддерживаем соединители для  [Logic Apps](https://azure.microsoft.com/services/logic-apps/)  и  [Power Automate](https://preview.flow.microsoft.com/connectors/shared_videoindexer-v2/video-indexer-v2/),  совместимые с нашим API. С помощью этих соединителей можно настроить пользовательские рабочие процессы для эффективного индексирования и извлечения полезных сведений из большого количества файлов видео и аудио без написания кода. Более того, применение соединителей для интеграции повышает точность оценки работоспособности рабочего процесса и упрощает его отладку.  

Чтобы быстро приступить к работе с соединителями Индексатора видео, выполните пошаговые инструкции по настройке примера решения, в котором используются приложение Logic Apps и Power Automate. В этом руководстве показано, как настроить потоки с помощью Logic Apps. Так как редакторы и возможности практически идентичны в обоих решениях, схемы и объяснения применимы и к Logic Apps, и к Power Automate.

Представленный в этом руководстве сценарий автоматической отправки и индексирования видео включает два совместно используемых потока. 
* Первый поток активируется при добавлении или изменении большого двоичного объекта в учетной записи хранения Azure. В Индексатор видео передается новый файл и URL-адрес обратного вызова, на который поступит уведомление по завершении индексирования. 
* Второй поток активируется запросом на URL-адрес обратного вызова и сохраняет извлеченные полезные данные обратно в JSON-файл, размещенный в службе хранилища Azure. Такой подход с двумя потоками позволяет эффективно выполнять асинхронные процессы передачи и индексирования больших файлов. 

В этом руководстве Logic App выполняет следующие функции:

> [!div class="checklist"]
> * настройка потока для отправки файла;
> * настройка потока для извлечения JSON.

[!INCLUDE [quickstarts-free-trial-note](../../../includes/quickstarts-free-trial-note.md)]

## <a name="prerequisites"></a>Предварительные требования

* Чтобы начать работу, вам потребуется учетная запись Индексатора видео, а также [доступ к API через ключ API](video-indexer-use-apis.md). 
* Кроме того, понадобится учетная запись хранения Azure. Сохраните ключ доступа к учетной записи хранения. Создайте два контейнера: один для хранения видео и другой для хранения полезных сведений, которые создаст Индексатор видео.  
* После этого нужно открыть два отдельных потока для Logic Apps или Power Automate (в зависимости от того, что вы предпочитаете использовать). 

## <a name="set-up-the-first-flow---file-upload"></a>Настройка первого потока — отправка файла   

Первый поток активируется при любом добавлении большого двоичного объекта в контейнер службы хранилища Azure. После активации создается подписанный URL-адрес, который можно использовать для отправки и индексирования видео в Индексаторе видео. В этом разделе показано, как создать следующий поток. 

![Поток отправки файлов](./media/logic-apps-connector-tutorial/file-upload-flow.png)

Чтобы настроить первый поток, нужно предоставить ключ API Индексатора видео и учетные данные службы хранилища Azure. 

![хранилище BLOB-объектов Azure.](./media/logic-apps-connector-tutorial/azure-blob-storage.png)

![Имя подключения и ключ API](./media/logic-apps-connector-tutorial/connection-name-api-key.png)

> [!TIP]
> Если ранее вы подключили учетную запись хранения Azure или учетную запись Индексатора видео к Logic App, это значит, что сведения о подключении сохранены и вы будете подключены автоматически. <br/>Чтобы изменить подключение, щелкните **Изменить подключение** в нижней части окна службы хранилища Azure (окно хранилища) или Индексатора видео (окно проигрывателя).

Когда вы настроите подключение к учетным записям службы хранилища Azure и Индексатора видео, найдите и выберите триггер "При добавлении или изменении BLOB-объекта" в **конструкторе Logic Apps**.

Выберите контейнер, в котором будут размещаться видеофайлы. 

![На снимке экрана показано диалоговое окно, которое открывается при добавлении или изменении BLOB-объекта, в котором можно выбрать контейнер.](./media/logic-apps-connector-tutorial/container.png)

Затем найдите и выберите действие "Создать URI SAS на основе пути". В диалоговом окне определения действия выберите "Список путей к файлам" в разделе параметров динамического содержимого.  

Также добавьте новый параметр "Протокол общего доступа". В качестве значения этого параметра укажите HttpsOnly.

![Создать URI SAS на основе пути](./media/logic-apps-connector-tutorial/sas-uri-by-path.jpg)

Укажите [расположение учетной записи](regions.md) и [идентификатор учетной записи](./video-indexer-use-apis.md#account-id) , чтобы получить маркер учетной записи Индексатора видео.

![Получение маркера доступа к учетной записи](./media/logic-apps-connector-tutorial/account-access-token.png)

В разделе Upload video and index (Отправить видео и индекс) введите обязательные параметры и URL-адрес видео. Щелкните "Добавить новый параметр" и выберите элемент "URL-адрес обратного вызова". 

![Отправка и индексирование](./media/logic-apps-connector-tutorial/upload-and-index.png)

URL-адрес обратного вызова пока не указывайте. Вы его добавите, когда будет готов второй поток, при создании которого создается сам URL-адрес обратного вызова. 

Для остальных параметров можно использовать значения по умолчанию или задать другие в соответствии с вашими потребностями. 

Щелкните **Сохранить** и переходите к настройке второго потока, который извлекает полезные сведения после завершения отправки и индексирования. 

## <a name="set-up-the-second-flow---json-extraction"></a>Настройка второго потока — извлечение JSON  

Завершение передачи и индексирования, запущенных из первого потока, приводит к созданию HTTP-запроса на правильный URL-адрес обратного вызова, который активирует второй поток. Этот поток получит полезные сведения, созданные Индексатором видео. В нашем примере он сохраняет выходные данные задания индексирования в службе хранилище Azure.  Но вы сами решаете, что нужно сделать с выходными данными.  

Создайте второй поток отдельно от первого. 

![Поток для извлечения JSON](./media/logic-apps-connector-tutorial/json-extraction-flow.png)

Чтобы настроить новый поток, нужно снова предоставить ключ API Индексатора видео и учетные данные службы хранилища Azure. Вам потребуется обновить те же параметры, что и для первого потока. 

Для триггера предлагается поле "URL-адрес HTTP POST". Этот URL-адрес не будет создан, пока вы не сохраните новый поток. Но для полной системы он является обязательным. Мы вернемся к нему немного позже. 

Укажите [расположение учетной записи](regions.md) и [идентификатор учетной записи](./video-indexer-use-apis.md#account-id) , чтобы получить маркер учетной записи Индексатора видео.  

Перейдите к действию получения индекса видео и укажите необходимые параметры. В качестве идентификатора видео введите следующее выражение: triggerOutputs()['queries']['id']. 

![Сведения о действии Индексатора видео](./media/logic-apps-connector-tutorial/video-indexer-action-info.jpg)

Это выражение сообщает соединителю, что нужно получить идентификатор видео из выходных данных триггера. В нашем примере выходными данными триггера является результат операции отправки видео и индекса из первого триггера. 

Перейдите к действию создания большого двоичного объекта и выберите путь к папке, в которой будут сохранены полезные сведения. Укажите имя большого двоичного объекта, который вы создаете. В качестве содержимого большого двоичного объекта вставьте следующее выражение: body(‘Get_Video_Index’). 

![Действие создания большого двоичного объекта](./media/logic-apps-connector-tutorial/create-blob-action.jpg)

Это выражение принимает выходные данные действия получения индекса видео из этого потока. 

Щелкните **Сохранить поток**. 

При сохранении потока в триггере создается URL-адрес HTTP POST. Скопируйте этот URL-адрес из триггера. 

![Сохранение триггера URL-адреса](./media/logic-apps-connector-tutorial/save-url-trigger.png)

Теперь вернитесь к первому потоку и вставьте URL-адрес в действие "Отправить видео и индекс" в качестве URL-адреса обратного вызова. 

Сохраните оба потока. На этом процесс будет завершен. 

Протестируйте вновь созданное приложение Logic Apps или Power Automate, добавив видео в контейнер BLOB-объектов Azure. Через несколько минут проверьте наличие полезных сведений в папке назначения. 

## <a name="generate-captions"></a>Создание субтитров

Инструкции по [созданию субтитров с помощью Индексатора видео и Logic Apps](https://techcommunity.microsoft.com/t5/azure-media-services/generating-captions-with-video-indexer-and-logic-apps/ba-p/1672198) см. в следующем блоге. 

В этой статье также показано, как автоматически индексировать видео путем копирования в OneDrive и хранить субтитры, созданные Индексатором видео в OneDrive.
 
## <a name="clean-up-resources"></a>Очистка ресурсов

После работы с этим руководством вы можете сохранить созданное решение на основе Logic Apps или Power Automate, используя его по мере необходимости. Но если вы не хотите продолжать работу и оплачивать использование решения, отключите оба потока (действие Turn Off в Power Automate или Disable в Logic Apps). 

## <a name="next-steps"></a>Дальнейшие действия

В этом руководстве вы увидели лишь один пример использования соединителей Индексатора видео. Вы можете применить соединители Индексатора видео для любого вызова API, поддерживаемого Индексатором видео. Например, для отправки и получения аналитических сведений, преобразования результатов, получения встраиваемых мини-приложений и даже настройки моделей. Кроме того, эти действия можно активировать по разным источникам, например по обновлениям репозиториев файлов или по отправлению сообщений электронной почты. Затем можно настроить обновление инфраструктуры или создание любого количества действий в приложении на основе полученных результатов.  

> [!div class="nextstepaction"]
> [Использование API Индексатора видео](video-indexer-use-apis.md)

Дополнительные ресурсы см. в [этом документе по индексатору видео](/connectors/videoindexer-v2/).