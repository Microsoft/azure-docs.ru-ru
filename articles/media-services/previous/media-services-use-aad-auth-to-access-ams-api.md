---
title: Доступ к API служб мультимедиа Azure с помощью аутентификации Azure Active Directory | Документация Майкрософт
description: Изучите основных понятия и действия, выполняемые для использования Azure Active Directory (Azure AD) для аутентификации доступа к API служб мультимедиа Azure.
services: media-services
documentationcenter: ''
author: IngridAtMicrosoft
manager: femila
editor: ''
ms.service: media-services
ms.workload: media
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 3/10/2021
ms.author: inhenkel
ms.openlocfilehash: 3688f0f9266844ce584f3f2d2e1a7c39ed3e4f70
ms.sourcegitcommit: 225e4b45844e845bc41d5c043587a61e6b6ce5ae
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/11/2021
ms.locfileid: "103009023"
---
# <a name="access-the-azure-media-services-api-with-azure-ad-authentication"></a>Доступ к API служб мультимедиа Azure с помощью аутентификации Azure AD 

[!INCLUDE [media services api v2 logo](./includes/v2-hr.md)] 

> [!NOTE]
> В Cлужбы мультимедиа версии 2 больше не добавляются новые компоненты или функциональные возможности. <br/>Ознакомьтесь с новейшей версией Служб мультимедиа — [версией 3](../latest/index.yml). Также изучите руководство по [миграции из версии 2 в версию 3](../latest/migrate-v-2-v-3-migration-introduction.md).

API служб мультимедиа Azure — это REST API. Его можно использовать для выполнения операций с ресурсами мультимедиа с помощью REST API или доступных клиентских пакетов SDK. Службы мультимедиа Azure предлагают клиентский пакет SDK служб мультимедиа для Microsoft .NET. Чтобы получить разрешение для доступа к ресурсам служб мультимедиа и API служб мультимедиа, вы должны пройти аутентификацию. 

Службы мультимедиа поддерживают [проверку подлинности на основе Azure Active Directory (Azure AD)](../../active-directory/fundamentals/active-directory-whatis.md). Служба REST служб мультимедиа Azure требует, чтобы у пользователя или приложения, выполняющего запросы REST API, была роль **участника** или **владельца** для доступа к ресурсам. Дополнительные сведения см. в статье [что такое управление доступом на основе ролей в Azure (Azure RBAC)](../../role-based-access-control/overview.md).  

В этом документе приводятся общие сведения о том, как получить доступ к API служб мультимедиа с помощью интерфейсов REST API или API .NET.

> [!NOTE]
> Авторизация контроля доступа устарела 1 июня 2018 г.

## <a name="access-control"></a>Управление доступом

Чтобы запрос REST служб мультимедиа Azure был успешно выполнен, у вызывающего пользователя должна быть роль владельца или участника для учетной записи служб мультимедиа, к которой он пытается получить доступ.  
Только пользователь с ролью владельца может предоставлять доступ к ресурсу мультимедиа (учетной записи) новым пользователям или приложениям. Роль участника может только обращаться к ресурсу мультимедиа.
Несанкционированные запросы завершаются сбоем с кодом состояния 401. Если вы видите этот код ошибки, проверьте, назначена ли пользователю роль владельца или участника для учетной записи служб мультимедиа. Это можно сделать на портале Azure. Найдите свою учетную запись служб мультимедиа и щелкните вкладку **Управление доступом**. 

![Вкладка "Управление доступом"](./media/media-services-use-aad-auth-to-access-ams-api/media-services-access-control.png)

## <a name="types-of-authentication"></a>Типы аутентификации 
 
При использовании аутентификации Azure AD со службами мультимедиа Azure доступны два метода аутентификации.

- **Проверка подлинности пользователя**. Аутентификация пользователя, который использует приложение для взаимодействия с ресурсами служб мультимедиа. Интерактивное приложение должно сначала запросить у пользователя учетные данные. Примером может послужить приложение консоли управления, которое используется авторизованными пользователями для мониторинга заданий кодирования или потоковой трансляции. 
- **Проверка подлинности субъекта-службы**. Аутентификация службы. Этот метод аутентификации обычно используют приложения, которые выполняют службы управляющей программы, службы среднего уровня или запланированные задания. Примеры: веб-приложения, приложения-функции, приложения логики, интерфейсы API и микрослужбы.

### <a name="user-authentication"></a>Аутентификация пользователей 

Метод аутентификации пользователя, как правило, используют приложения управления или мониторинга: мобильные приложения, приложения для Windows и консольные приложения. Этот тип решения удобен, когда требуется взаимодействие пользователя со службой в одном следующих случаев:

- панель мониторинга для заданий кодирования;
- панель мониторинга для потоковых трансляций;
- приложение управления для пользователей компьютеров и мобильных устройств, предназначенное для администрирования ресурсов в учетной записи служб мультимедиа.

> [!NOTE]
> Этот метод аутентификации не должен использоваться для потребительских приложений. 

Собственное приложение сначала должно получить маркер доступа из Azure AD, а затем использовать его при выполнении HTTP-запросов к REST API служб мультимедиа. Маркер доступа добавляется в заголовок запроса. 

На следующей схеме показан типичный поток аутентификации интерактивного приложения. 

![Схема собственных приложений](./media/media-services-use-aad-auth-to-access-ams-api/media-services-native-aad-app1.png)

На предыдущей схеме цифры обозначают поток запросов в хронологическом порядке.

> [!NOTE]
> При использовании аутентификации пользователя все приложения используют общий идентификатор клиента (по умолчанию) и универсальный код ресурса (URI) перенаправления собственного приложения. 

1. Запрос учетных данных пользователя.
2. Запрос маркер доступа Azure AD со следующими параметрами:  

   * Конечная точка клиента Azure AD.

       Информацию о клиенте можно получить на портале Azure. Наведите указатель мыши на имя пользователя, выполнившего вход, в верхнем правом углу.
   * Универсальный код ресурса (URI) для ресурса служб мультимедиа. 

       Этот универсальный код ресурса (URI) используется для учетных записей служб мультимедиа, которые находятся в одной среде Azure (например, HTTPS: \/ /REST.Media.Azure.NET).

   * Идентификатор клиента (собственного) приложения служб мультимедиа.
   * Универсальный код ресурса (URI) перенаправления (собственного) приложения служб мультимедиа.
   * Универсальный код ресурса (URI) для ресурса REST служб мультимедиа.
        
       URI представляет конечную точку REST API (например, https://test03.restv2.westus.media.azure.net/api/).

     Чтобы получить значения этих параметров ознакомьтесь с разделом статьи [Приступая к работе с аутентификацией Azure AD с помощью портала Azure](media-services-portal-get-started-with-aad.md), посвященным аутентификации пользователя.

3. Маркер доступа Azure AD отправляется клиенту.
4. Клиент отправляет запрос к REST API служб мультимедиа Azure с помощью маркера доступа Azure AD.
5. Клиент получает данные из служб мультимедиа.

Сведения о том, как использовать аутентификацию Azure AD для взаимодействия с запросами REST с помощью клиентского пакета SDK служб мультимедиа для .NET, см. в разделе [Использование аутентификации Azure AD для доступа к API служб мультимедиа Azure с помощью .NET](media-services-dotnet-get-started-with-aad.md). 

Если вы не используете клиентский пакет SDK служб мультимедиа для .NET, то вам необходимо вручную создать запрос маркера доступа Azure AD, указав параметры, описанные на шаге 2. Дополнительные сведения см. в разделе [Библиотеки проверки подлинности Azure Active Directory](../../active-directory/azuread-dev/active-directory-authentication-libraries.md).

### <a name="service-principal-authentication"></a>Проверка подлинности субъекта-службы

Этот метод аутентификации обычно используют приложения, которые выполняют службы среднего уровня и запланированные задания: веб-приложения, приложения-функции, приложения логики, интерфейсы API и микрослужбы. Этот метод аутентификации также подходит для интерактивных приложений, в которых может потребоваться использовать учетную запись службы для управления ресурсами.

При использовании аутентификации субъекта-службы для реализации потребительских сценариев аутентификация обычно осуществляется на среднем уровне (через API), а не непосредственно в мобильном или классическом приложении. 

Чтобы использовать этот метод, создайте приложение Azure AD и субъект-службу в собственном клиенте. После создания приложения назначьте ему роль владельца или участника для доступа к учетной записи служб мультимедиа. Это можно сделать с помощью портала Azure, Azure CLI или сценария PowerShell. Можно также использовать существующее приложение Azure AD. Вы можете зарегистрировать приложение Azure AD и субъект-службу и управлять ими [на портале Azure](media-services-portal-get-started-with-aad.md). Это можно также сделать с помощью [Azure CLI](media-services-use-aad-auth-to-access-ams-api.md) или [PowerShell](media-services-powershell-create-and-configure-aad-app.md). 

![Приложения среднего уровня](./media/media-services-use-aad-auth-to-access-ams-api/media-services-principal-service-aad-app1.png)

После создания приложения Azure AD следует получить значения приведенных ниже параметров. Это значения, необходимые для аутентификации.

- Идентификатор клиента 
- Секрет клиента 

На предыдущем рисунке цифры обозначают поток запросов в хронологическом порядке.
    
1. Приложение среднего уровня (веб-API или веб-приложение) запрашивает маркер доступа Azure AD, который содержит следующие параметры.  

   * Конечная точка клиента Azure AD.

       Информацию о клиенте можно получить на портале Azure. Наведите указатель мыши на имя пользователя, выполнившего вход, в верхнем правом углу.
   * Универсальный код ресурса (URI) для ресурса служб мультимедиа. 

       Этот универсальный код ресурса (URI) используется для учетных записей служб мультимедиа, размещенных в той же среде Azure (например, HTTPS: \/ /REST.Media.Azure.NET).

   * Универсальный код ресурса (URI) для ресурса REST служб мультимедиа.

       URI представляет конечную точку REST API (например, https://test03.restv2.westus.media.azure.net/api/).

   * Значения приложения Azure AD: идентификатор клиента и секрет клиента.
    
     Чтобы получить значения этих параметров ознакомьтесь с разделом статьи [Приступая к работе с аутентификацией Azure AD с помощью портала Azure](media-services-portal-get-started-with-aad.md), посвященным аутентификации субъекта-службы.

2. Маркер доступа Azure AD передается на средний уровень.
4. Средний уровень отправляет запрос к REST API служб мультимедиа Azure с помощью маркера Azure AD.
5. Средний уровень получает данные из служб мультимедиа.

Дополнительные сведения о том, как использовать аутентификацию Azure AD для взаимодействия с запросами REST с помощью клиентского пакета SDK служб мультимедиа для .NET, см. в разделе [Использование аутентификации Azure AD для доступа к API служб мультимедиа Azure с помощью .NET](media-services-dotnet-get-started-with-aad.md). 

Если вы не используете клиентский пакет SDK служб мультимедиа для .NET, то вам необходимо вручную создать запрос маркера Azure AD, указав параметры, описанные на шаге 1. Дополнительные сведения см. в разделе [Библиотеки проверки подлинности Azure Active Directory](../../active-directory/azuread-dev/active-directory-authentication-libraries.md).

## <a name="troubleshooting"></a>Устранение неполадок

Исключение: "Удаленный сервер возвратил ошибку: 401 - Не санкционировано"

Решение: чтобы запрос REST служб мультимедиа был успешно выполнен, у вызывающего пользователя должна быть роль владельца или участника для учетной записи служб мультимедиа, к которой он пытается получить доступ. Дополнительные сведения см. в разделе [Управление доступом](media-services-use-aad-auth-to-access-ams-api.md#access-control).

## <a name="resources"></a>Ресурсы

Ниже приведены обзорные статьи, посвященные понятиям аутентификации Azure AD: 

- [Основы проверки подлинности в Azure AD](../../active-directory/develop/authentication-vs-authorization.md)
- [Интеграция приложений с Azure Active Directory](../../active-directory/develop/quickstart-register-app.md)
- [Добавление и удаление назначений ролей Azure с помощью Azure PowerShell](../../role-based-access-control/role-assignments-powershell.md)

## <a name="next-steps"></a>Дальнейшие действия

* Узнайте, как использовать [аутентификацию Azure AD для работы с API служб мультимедиа Azure](media-services-portal-get-started-with-aad.md) с помощью портала Azure.
* Используйте аутентификацию Azure AD для [доступа к API служб мультимедиа Azure с помощью .NET](media-services-dotnet-get-started-with-aad.md).
