---
title: Потоковая трансляция с использованием служб мультимедиа Azure для создания потоков с разными скоростями | Документация Майкрософт
description: В этой статье описывается, как настроить канал, принимающий односкоростной динамический поток от локального кодировщика и кодирующий его в реальном времени в поток с адаптивной скоростью с помощью служб мультимедиа.
services: media-services
documentationcenter: ''
author: IngridAtMicrosoft
manager: femila
editor: ''
ms.assetid: 30ce6556-b0ff-46d8-a15d-5f10e4c360e2
ms.service: media-services
ms.workload: media
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 03/10/2021
ms.author: anilmur
ms.reviewer: juliako
ms.openlocfilehash: b9b4cd54375a13da95259e27da680255f785df45
ms.sourcegitcommit: 225e4b45844e845bc41d5c043587a61e6b6ce5ae
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/11/2021
ms.locfileid: "103013216"
---
# <a name="live-streaming-using-azure-media-services-to-create-multi-bitrate-streams"></a>Потоковая трансляция с использованием служб мультимедиа Azure для создания потоков с разными скоростями

[!INCLUDE [media services api v2 logo](./includes/v2-hr.md)]

> [!NOTE]
> С 12 мая 2018 г. динамические каналы больше не будут поддерживать протокол приема транспортного потока RTP/MPEG-2. Выполните миграцию из RTP/MPEG-2 в протокол приема RTMP или фрагментированный протокол MP4 (Smooth Streaming).

## <a name="overview"></a>Обзор
В службах мультимедиа Azure (AMS) **канал** представляет конвейер для обработки динамического потокового контента. **Канал** получает потоковые входные потоки одним из двух способов:

* Локальный динамический кодировщик передает односкоростной поток в канал, который может осуществлять кодирование в реальном времени с помощью Служб мультимедиа, в одном из следующих форматов: RTMP или Smooth Streaming (фрагментированный формат MP4). Затем канал кодирует входящий односкоростной поток в реальном времени в многоскоростной (адаптивный) видеопоток. При получении запроса службы мультимедиа предоставляют потоки клиентам.
* Локальный динамический кодировщик передает содержимое в формате **RTMP** или **Smooth Streaming** (фрагментированный MP4) с несколькими скоростями в канал, для которого не включена поддержка кодирования в реальном времени с помощью AMS. Полученные потоки передаются через **каналы** без дальнейшей обработки. Этот способ называется **сквозной передачей**. Вы можете использовать следующие динамические кодировщики, выдающие содержимое в формате потоковой передачи Smooth Streaming с несколькими скоростями: MediaExcel, Ateme, Imagine Communications, Envivio, Cisco и Elemental. Следующие динамические кодировщики выводят RTMP: [Wirecast](media-services-configure-wirecast-live-encoder.md), HaiVision, Teradek кодировщики.  Динамический кодировщик может также передавать односкоростной поток в канал, для которого не включено кодирование в реальном времени, но это не рекомендуется. При получении запроса службы мультимедиа предоставляют потоки клиентам.

  > [!NOTE]
  > Использование сквозной передачи является наиболее экономичным способом потоковой передачи в реальном времени.
  > 
  > 

Начиная с выпуска 2.10 служб мультимедиа, при создании канала можно указать, как он должен принимать входной поток и должен ли он выполнять его кодирование в реальном времени. Имеются две возможности.

* **Нет** — задайте это значение, если вы собираетесь использовать локальный динамический кодировщик, который будет выдавать многоскоростной (сквозной) поток. В этом случае входящий поток передается на выход без кодирования. Таким образом каналы работали до выпуска 2.10.  Более подробную информацию о работе с каналами такого типа см. в статье [Потоковая трансляция с помощью локальных кодировщиков, создающих потоки с разными скоростями](media-services-live-streaming-with-onprem-encoders.md).
* **Стандартный** — выберите это значение, если собираетесь использовать службы мультимедиа для кодирования односкоростного потока во многоскоростной. Помните о том, что за кодирование в реальном времени взимается плата, поэтому, если вы оставите канал кодирования в реальном времени в состоянии "Работает", вам будут выставлены соответствующие счета.  Рекомендуется сразу же прекращать работу канала после завершения потоковой передачи в реальном времени во избежание оплаты дополнительных часов.

> [!NOTE]
> В этом разделе рассматриваются атрибуты канала, с помощью которых обеспечивается кодирование в реальном времени (тип кодирования **Стандартный**). Информацию о работе с каналами, которые не выполняют кодирование в реальном времени, см. в статье [Потоковая трансляция с помощью локальных кодировщиков, создающих потоки с разными скоростями](media-services-live-streaming-with-onprem-encoders.md).
> 
> Обязательно изучите раздел [Рекомендации](media-services-manage-live-encoder-enabled-channels.md#Considerations) .
> 
> 

## <a name="billing-implications"></a>Процесс выставления счетов
Начисление платы за канал кодирования в реальном времени начинается, как только он переходит в состояние "Работает" с помощью API-интерфейса.   Вы также можете просмотреть это состояние на портале Azure или в обозревателе служб мультимедиа Azure (https://aka.ms/amse).

В следующей таблице показано, как состояния канала соотносятся с состояниями выставления счетов в API и на портале Azure. Состояния в API и на портале немного отличаются. Как только канал переходит в состояние "Работает" с помощью API либо в состояние "Готово" или "Потоковая передача" на портале Azure, начинается начисление оплаты.
Чтобы прекратить начисление оплаты за канал, необходимо остановить канал через API или на портале Azure.
Именно вы несете ответственность за остановку каналов после завершения кодирования в реальном времени.  Если вы не остановите работу канала, начисление оплаты будет продолжено.

### <a name="channel-states-and-how-they-map-to-the-billing-mode"></a><a id="states"></a>Состояния канала и их сопоставление с режимом выставления счетов
Текущее состояние канала. Возможные значения:

* **Остановлена**. Это начальное состояние канала после его создания (если автозапуск не выбран на портале). В этом состоянии выставление счетов не выполняется. В этом состоянии можно изменять свойства канала, но потоковая передача запрещена.
* **Идет запуск**. Канал запускается. В этом состоянии начисление оплаты не происходит. В этом состоянии обновление и потоковая передача запрещены. Если возникает ошибка, канал возвращается в состояние "Остановлен".
* **Работает**. Канал может обрабатывать динамические потоки. Теперь оплата начисляется. Необходимо остановить работу канала, чтобы избежать дальнейшего начисления оплаты. 
* **Идет остановка**. Канал останавливается. В этом переходном состоянии оплата не начисляется. В этом состоянии обновление и потоковая передача запрещены.
* **Идет удаление**. Канал удаляется. В этом переходном состоянии оплата не начисляется. В этом состоянии обновление и потоковая передача запрещены.

В таблице ниже показано, как состояния канала соотносятся с режимом выставления счетов. 

| Состояние канала | Индикаторы в пользовательском интерфейсе портала | Это начисление оплаты? |
| --- | --- | --- |
| Запуск |Запуск |Нет (переходное состояние) |
| Запущен |Готово (нет запущенных программ)<br/>или<br/>Потоковая передача (запущена по крайней мере одна программа) |YES |
| Остановка |Остановка |Нет (переходное состояние) |
| Остановлена |Остановлена |Нет |

### <a name="automatic-shut-off-for-unused-channels"></a>Автоматическое отключение неиспользуемых каналов
Начиная с 25 января 2016 г. службы мультимедиа развертывают обновление, которое автоматически останавливает канал (с включенным кодированием в режиме реального времени), не используемый в течение длительного периода. Это относится к каналам, в которых не выполняются никакие программы и которые не получают входящих данных в течение долгого времени.

Номинальная пороговая длительность периода простоя составляет 12 часов, но это значение может меняться.

## <a name="live-encoding-workflow"></a>Процесс кодирования в реальном времени
На схеме ниже представлен процесс потоковой передачи в реальном времени, при котором канал принимает односкоростной поток по протоколу RTMP или Smooth Streaming, а затем кодирует его в многоскоростной поток. 

![Динамический рабочий процесс][live-overview]

## <a name="common-live-streaming-scenario"></a><a id="scenario"></a>Общий сценарий динамической потоковой передачи
Ниже описываются основные этапы создания стандартных приложений, предназначенных для потоковой передачи в реальном времени.

> [!NOTE]
> Сейчас максимальная рекомендуемая продолжительность интерактивного события составляет 8 часов.
>
> За кодирование в реальном времени взимается плата, поэтому, если вы оставите канал кодирования в реальном времени в состоянии "Работает", вам будут выставлены соответствующие счета на почасовой основе. Рекомендуется сразу же прекращать работу канала после завершения потоковой передачи в реальном времени во избежание оплаты дополнительных часов. 

1. Подключите видеокамеру к компьютеру. Запустите и настройте локальный динамический кодировщик, который может выводить односкоростной поток **в одном из** следующих протоколов: RTMP или Smooth Streaming. 

    Это действие также можно выполнить после создания канала.
2. Создайте и запустите канал. 
3. Получите URL-адрес приема канала. 

    URL-адрес приема используется динамическим кодировщиком для отправки потока в канал.
4. Получите URL-адрес предварительного просмотра канала. 

    С его помощью можно убедиться в том, что канал надлежащим образом получает поток.
5. Создайте программу. 

    Если вы используете портал Azure, то при создании программы также создается ресурс-контейнер. 

    Если вы используете пакет .NET SDK или REST, необходимо создать ресурс и указать его при создании программы. 
6. Опубликуйте ресурс, связанный с программой.   

    >[!NOTE]
    >При создании учетной записи AMS в нее добавляется конечная точка потоковой передачи **по умолчанию** в состоянии **Остановлена**. Конечная точка потоковой передачи, из которой нужно передавать содержимое потоком, должна находиться в состоянии **Выполняется**. 

7. Когда вы будете готовы начать потоковую передачу и архивацию, запустите программу.
8. При необходимости динамическому кодировщику можно дать сигнал начать показ рекламы. Реклама вставляется в выходной поток.
9. Чтобы остановить потоковую передачу и архивацию содержимого мероприятия, завершите работу программы.
10. Удалите программу (и при необходимости ресурс).   

> [!NOTE]
> Крайне важно не забывать останавливать канал кодирования в реальном времени. Помните о том, что за кодирование в реальном времени взимается почасовая плата, поэтому, если вы оставите канал кодирования в реальном времени в состоянии "Работает", вам будут выставлены соответствующие счета.  Рекомендуется сразу же прекращать работу канала после завершения потоковой передачи в реальном времени во избежание оплаты дополнительных часов. 
> 
> 

## <a name="channels-input-ingest-configurations"></a><a id="channel"></a>Конфигурации приема канала
### <a name="ingest-streaming-protocol"></a><a id="Ingest_Protocols"></a>Протокол входного потока
Если в качестве **типа кодировщика** выбрано значение **Стандартный**, возможны следующие варианты:

* Односкоростной **RTMP**
* Односкоростной **фрагментированный MP4** (Smooth Streaming)

#### <a name="single-bitrate-rtmp"></a><a id="single_bitrate_RTMP"></a>односкоростной RTMP;
Рекомендации:

* Входящий поток не может содержать многоскоростное видео.
* Средняя скорость видеопотока должна быть не более 15 Мбит/с.
* Средняя скорость аудиопотока должна быть не более 1 Мбит/с.
* Поддерживаются следующие кодеки:
* видеокодек MPEG-4 AVC/H.264;
* базовый, основной, высокий профиль (8-битный 4:2:0);
* высокий профиль 10 (10-битный 4:2:0);
* высокий профиль 422 (10-битный 4:2:2);
* аудиокодек MPEG-2 AAC-LC;
* моно, стерео, окружающий звук (5.1, 7.1);
* Частота дискретизации 44,1 кГц
* упаковка ADTS в стиле MPEG-2;
* Рекомендуемые кодировщики:
* [Wirecast в телепотоке](media-services-configure-wirecast-live-encoder.md)
* Flash Media Live Encoder

#### <a name="single-bitrate-fragmented-mp4-smooth-streaming"></a>Односкоростной фрагментированный MP4 (Smooth Streaming)
Типичный случай использования:

Отправка входного потока через Интернет в ближайший центр обработки данных Azure с помощью локальных динамических кодировщиков от таких производителей, как Elemental Technologies, Ericsson, Ateme и Envivio.

Рекомендации:

Аналогичны рекомендациям для [односкоростного протокола RTMP](media-services-manage-live-encoder-enabled-channels.md#single_bitrate_RTMP).

#### <a name="other-considerations"></a>Другие замечания
* Во время работы канала или связанных с ним программ входной протокол изменить нельзя. Если вам нужны другие протоколы, создайте отдельный канал для каждого из них.
* Максимальное разрешение входящего видеопотока — 1920x1080; максимальное временное разрешение — 60 полей в секунду при использовании чередования строк или 30 кадров в секунду при использовании прогрессивной развертки.

### <a name="ingest-urls-endpoints"></a>URL-адреса (конечные точки) приема
Канал предоставляет входную конечную точку (URL-адрес приема), которая указывается в динамическом кодировщике, чтобы он мог передавать потоки в канал.

Получить URL-адреса приема можно сразу после создания канала. Для получения этих URL-адресов канал не должен находиться в состоянии **выполняется** . Чтобы начать передавать данные в канал, его нужно перевести в состояние **Выполняется** . Когда канал начнет принимать данные, вы можете просмотреть поток с помощью URL-адреса предварительного просмотра.

У вас есть возможность приема потока с фрагментированным MP4 (Smooth Streaming) через TLS-подключение. Для приема по протоколу TLS измените URL-адрес приема на HTTPS. В настоящее время AMS не поддерживает TLS с пользовательскими доменами.  

### <a name="allowed-ip-addresses"></a>Разрешенные IP-адреса
Вы можете определить IP-адреса, с которых разрешено публиковать видео в этом канале. Допустимые IP-адреса можно указать как отдельный IP-адрес (например, 10.0.0.1), как диапазон IP-адресов с использованием IP-адреса и маски подсети CIDR (например, 10.0.0.1/22) либо как диапазон IP-адресов с использованием IP-адреса и маски подсети в десятичной записи (например, 10.0.0.1(255.255.252.0)).

Если не указаны IP-адреса и не определено правило, разрешенных IP-адресов нет. Чтобы разрешить все IP-адреса, создайте правило и задайте адрес 0.0.0.0/0.

## <a name="channel-preview"></a>Предварительный просмотр канала
### <a name="preview-urls"></a>URL-адреса предварительного просмотра
Канал предоставляет конечную точку (URL-адрес) предварительного просмотра, с помощью которой можно проверить поток перед дальнейшей обработкой и доставкой.

Получить URL-адрес предварительного просмотра можно при создании канала. Для этого каналу не обязательно находиться в состоянии **Выполняется** .

После запуска канала можно выполнить предварительный просмотр потока.

> [!NOTE]
> В настоящее время поток предварительного просмотра может доставляться только в формате фрагментированного MP4 (Smooth Streaming) вне зависимости от указанного входного типа.  Для просмотра потока можно воспользоваться проигрывателем, размещенным на портале Azure.
> 
> 

### <a name="allowed-ip-addresses"></a>Разрешенные IP-адреса
Вы можете определить IP-адреса, которым разрешено подключаться к конечной точке предварительного просмотра. Если этого не сделать, будут разрешены все IP-адреса. Допустимые IP-адреса можно указать как отдельный IP-адрес (например, 10.0.0.1), как диапазон IP-адресов с использованием IP-адреса и маски подсети CIDR (например, 10.0.0.1/22) либо как диапазон IP-адресов с использованием IP-адреса и маски подсети в десятичной записи (например, 10.0.0.1(255.255.252.0)).

## <a name="live-encoding-settings"></a>Параметры кодирования в реальном времени
В этом разделе описывается настройка параметров динамического кодировщика канала в случае, если параметр **Тип кодирования** канала имеет значение **Стандартный**.

> [!NOTE]
> Входной поток данных может содержать только одну аудиодорожку. Прием нескольких аудиодорожек сейчас не поддерживается. При выполнении кодирования в реальном времени с помощью [локальных динамических кодировщиков](media-services-live-streaming-with-onprem-encoders.md) можно отправить входной канал по протоколу Smooth Streaming с несколькими аудиодорожками.
> 
> 

### <a name="ad-marker-source"></a>Источник маркера рекламы
Вы можете указать источник для сигналов маркера рекламы. Значение по умолчанию — **Api**. Оно означает, что динамический кодировщик канала должен ожидать передачи данных от асинхронного интерфейса **API маркеров рекламы**.

### <a name="cea-708-closed-captions"></a>Субтитры стандарта CEA-708
Необязательный флаг, который указывает динамическому кодировщику игнорировать данные подписей CEA-708, внедренные во входящее видео. Если этот флаг имеет значение false (по умолчанию), кодировщик обнаруживает данные CEA-708 и вставляет их в выходные видеопотоки.

#### <a name="index"></a>Индекс
Рекомендуется отправлять на вход однопрограммный транспортный поток (SPTS). Если входной поток содержит несколько программ, динамический кодировщик анализирует таблицу структуры программ (PMT), выявляет входные данные с именем типа потока "MPEG-2 AAC ADTS", "AC-3 System-A", "AC-3 System-B", "MPEG-2 Private PES", "MPEG-1 Audio" или "MPEG-2 Audio" и располагает их в порядке, указанном в таблице PMT. Затем с помощью отсчитываемого от нуля индекса выбирается n-ный элемент в этой последовательности.

#### <a name="language"></a>Язык
Идентификатор языка аудиопотока согласно стандарту ISO 639-2, например ENG. Если не указан, используется значение по умолчанию — UND (не определено).

### <a name="system-preset"></a><a id="preset"></a>Системная предустановка
Задает предустановку, которая должна использоваться динамическим кодировщиком в этом канале. В настоящее время единственное допустимое значение — **Default720p** (значение по умолчанию).

**Default720p** указывает, что видео кодируется в шесть слоев, перечисленных ниже.

#### <a name="output-video-stream"></a>Выходной видеопоток

| Скорость | Ширина | Высота: | Макс. кадров/с | Профиль | Имя выходного потока |
| --- | --- | --- | --- | --- | --- |
| 3500 |1280 |720 |30 |Высокий |Video_1280x720_3500kbps |
| 2200 |960 |540 |30 |Высокий |Video_960x540_2200kbps |
| 1350 |704 |396 |30 |Высокий |Video_704x396_1350kbps |
| 850 |512 |288 |30 |Высокий |Video_512x288_850kbps |
| 550 |384 |216 |30 |Высокий |Video_384x216_550kbps |
| 200 |340 |192 |30 |Высокий |Video_340x192_200kbps |

#### <a name="output-audio-stream"></a>Выходной аудиопоток

Звук кодируется в стереоформате AAC-LC со скоростью 128 Кбит/с и частотой выборки 48 кГц.

## <a name="signaling-advertisements"></a>Сигнализация о рекламе
Если для канала включено кодирование в реальном времени, в конвейере появляется компонент, который обрабатывает видео и может управлять им. Вы можете давать каналу сигналы о том, что в исходящий поток с адаптивной скоростью нужно вставить листы или рекламу. Листы — это неподвижные изображения, которые закрывают входной поток в определенных случаях (например, во время рекламной паузы). Рекламные сигналы — это синхронизированные во времени сигналы, которые добавляются в исходящий поток и сообщают видеопроигрывателю о том, что нужно выполнить специальные действия, например переключиться на рекламу в определенный момент. Общие сведения о механизме сигнализации SCTE-35, используемом в этих целях, см. в этой [записи блога](https://codesequoia.wordpress.com/2014/02/24/understanding-scte-35/). Ниже описан типичный сценарий, который можно реализовать в рамках трансляции.

1. Перед началом мероприятия зрители видят вступительное изображение.
2. По завершении мероприятия зрители видят заключительное изображение.
3. Если во время мероприятия возникла проблема (например, на стадионе пропал свет), зрители видят изображение с сообщением о неполадке.
4. Чтобы скрыть видеопоток трансляции во время рекламной паузы, выведите соответствующее изображение.

Ниже описываются свойства, которые можно задать при сигнализации о рекламе. 

### <a name="duration"></a>Duration
Длительность рекламной паузы в секундах. Чтобы рекламная пауза могла начаться, это должно быть положительное значение, отличное от нуля. Если установить длительность рекламной паузы, идущей в данным момент, равной нулю, эта пауза будет отменена.

### <a name="cueid"></a>CueId
Уникальный идентификатор рекламной паузы, используемый подчиненным приложением для выполнения соответствующих действий. Должен быть положительным целым числом. Вы можете присвоить этому свойству любое положительное целое число или использовать вышестоящую систему для отслеживания идентификаторов. Перед передачей идентификаторов через интерфейс API обязательно приводите их к положительным целочисленным значениям.

### <a name="show-slate"></a>Показать лист
Необязательный параметр. Дает динамическому кодировщику сигнал переключиться во время рекламной паузы на изображение [баннера по умолчанию](media-services-manage-live-encoder-enabled-channels.md#default_slate) , чтобы скрыть входящий видеопоток. Звук на это время также выключается. Значение по умолчанию — **false**. 

Используемое изображение определяется с помощью свойства идентификатора ресурса листа по умолчанию во время создания канала. Лист растягивается по размеру экрана. 

## <a name="insert-slate--images"></a>Вставка изображений баннеров
Динамическому кодировщику канала можно дать сигнал переключиться на изображение листа. Ему также можно дать сигнал завершить показ этого изображения. 

Динамический кодировщик можно настроить на переключение на изображение листа и скрытие входящего видеосигнала в определенных ситуациях, например во время рекламной паузы. Если лист не настроен, видео во время рекламной паузы не скрывается.

### <a name="duration"></a>Duration
Длительность показа листа в секундах. Чтобы показ листа мог начаться, это должно быть положительное значение, отличное от нуля. Если задать длительность равной нулю во время показа листа, его показ будет завершен.

### <a name="insert-slate-on-ad-marker"></a>Вставить лист при получении маркера рекламы
Если задано значение true, динамический кодировщик вставляет изображение листа во время рекламной паузы. Значение по умолчанию — true. 

### <a name="default-slate-asset-id"></a><a id="default_slate"></a>Идентификатор ресурс-контейнера баннера по умолчанию

Необязательный параметр. Задает идентификатор ресурса служб мультимедиа, который содержит изображение листа. Значением по умолчанию является NULL. 


> [!NOTE] 
> Перед созданием канала необходимо отправить изображение баннера с учетом следующих ограничений в качестве выделенного ресурса-контейнера (в этом ресурсе-контейнере не должно быть никаких других файлов). Это изображение используется только в том случае, когда динамический кодировщик вставляет баннер ввиду рекламной паузы или после явно заданного сигнала вставить баннер. В настоящее время нет возможности использовать настраиваемое изображение, когда кодировщик переходит в такое состояние. Вы можете проголосовать за данную функцию [здесь](https://feedback.azure.com/forums/169396-azure-media-services/suggestions/10190457-define-custom-slate-image-on-a-live-encoder-channel).

* Максимальное разрешение 1920 x 1080.
* Максимальный размер 3 МБ.
* Имя файла должно иметь расширение *.jpg.
* Изображение должно быть загружено в актив (Asset) в качестве единственного содержащегося в этом активе файла (AssetFile), и этот AssetFile должен быть помечен как основной файл. Актив должен храниться в незашифрованном виде.

Если **идентификатор файла баннера по умолчанию** не указан, а свойство **Вставлять баннер по маркеру рекламы** имеет значение **true**, то для скрытия входного видеопотока будет использоваться изображение служб мультимедиа Azure по умолчанию. Звук на это время также выключается. 

## <a name="channels-programs"></a>Программы канала
Канал связан с программами, с помощью которых вы можете управлять публикацией и хранением сегментов динамического потока. Каналы управляют программами. Связь между каналом и программой очень похожа на аналогичную взаимосвязь в традиционной мультимедийной отрасли, где по определенному каналу транслируется постоянный поток информации, а программа связана с определенным временным промежутком — мероприятием на этом канале.

Задать количество часов, в течение которых следует хранить записанное содержимое программы, можно с помощью параметра длины **окна архивирования** . Это значение может быть задано в диапазоне от 5 минут до 25 часов. Длина окна архивирования также определяет максимальный период, в пределах которого клиенты могут перемещаться назад во времени относительно текущей позиции в передаваемом потоке данных. Программы могут длиться в течение определенного времени, однако содержимое, выходящее за пределы окна указанной длины, теряется. Значение этого свойства также определяет максимальный размер манифестов клиентов.

Каждая программа связана с ресурсом, в котором хранится передаваемый в потоковом режиме контент. Ресурс сопоставляется с контейнером блочных BLOB-объектов в учетной записи хранения Azure. Файлы ресурса хранятся в этом контейнере как большие двоичные объекты. Чтобы опубликовать программу для просмотра потока клиентами, необходимо создать указатель OnDemand для соответствующего ресурса. С помощью этого указателя можно сформировать URL-адрес потоковой передачи данных, который предоставляется клиентам.

Канал поддерживает одновременную потоковую трансляцию до трех программ, поэтому можно создавать по несколько архивов одного и того же входящего потока. Благодаря этому можно публиковать и архивировать разные части транслируемого мероприятия. Например ваш бизнес-требование — архивировать 6 часов программы, но для передачи только оставить последние 10 минут. Для этого необходимо создать две одновременно работающие программы. Для одной из них настроено архивирование 6 часов транслируемого мероприятия, но без публикации. Для второй программы настроено архивирование 10 минут с публикацией.

Не используйте существующие программы повторно для новых мероприятий. Вместо этого создавайте и запускайте новую программу для каждого мероприятия, как описано в разделе "Программирование приложений потоковой трансляции".

Когда вы будете готовы начать потоковую передачу и архивацию, запустите программу. Чтобы остановить потоковую передачу и архивацию содержимого мероприятия, завершите работу программы. 

Чтобы удалить архивированное содержимое, остановите и удалите программу, а затем удалите связанный с ней ресурс. Ресурс невозможно удалить, пока он используется какой-либо программой: сначала нужно удалить ее. 

Даже после остановки и удаления программы пользователи смогут запрашивать потоковую передачу архивированного видеосодержимого, пока не удален соответствующий ресурс.

Если вы хотите сохранить заархивированное содержимое, но при этом заблокировать возможность его потоковой передачи, удалите указатель.

## <a name="getting-a-thumbnail-preview-of-a-live-feed"></a>Получение эскиза динамического канала
При включении кодирования в реальном времени вы можете предварительно просматривать входной поток канала. Это полезная функция, так как с ее помощью можно узнать, действительно ли поток поступает в канал. 

## <a name="channel-states-and-how-states-map-to-the-billing-mode"></a><a id="states"></a>Состояния канала и их сопоставление с режимом выставления счетов
Текущее состояние канала. Возможные значения:

* **Остановлена**. Это начальное состояние канала после его создания. В этом состоянии можно изменять свойства канала, но потоковая передача запрещена.
* **Идет запуск**. Канал запускается. В этом состоянии обновление и потоковая передача запрещены. Если возникает ошибка, канал возвращается в состояние "Остановлен".
* **Работает**. Канал может обрабатывать динамические потоки.
* **Идет остановка**. Канал останавливается. В этом состоянии обновление и потоковая передача запрещены.
* **Идет удаление**. Канал удаляется. В этом состоянии обновление и потоковая передача запрещены.

В таблице ниже показано, как состояния канала соотносятся с режимом выставления счетов. 

| Состояние канала | Индикаторы в пользовательском интерфейсе портала | Выставление счетов |
| --- | --- | --- |
| Запуск |Запуск |Нет (переходное состояние) |
| Запущен |Готово (нет запущенных программ)<br/>или<br/>Потоковая передача (запущена по крайней мере одна программа) |Да |
| Остановка |Остановка |Нет (переходное состояние) |
| Остановлена |Остановлена |Нет |

> [!NOTE]
> Сейчас среднее время запуска канала составляет примерно 2 минуты, но в отдельных случаях оно может составлять до 20 минут и более. Сброс канала может занимать до 5 минут.
> 
> 

## <a name="considerations"></a><a id="Considerations"></a>Рекомендации
* Если в канале со **стандартным** типом кодировки теряется веб-канал входного источника или участника, он заменяет источник видео или аудио баннером ошибки и тишиной. Канал продолжит передавать баннер, пока канал входного источника или участника не будет восстановлен. Мы не рекомендуем оставлять динамический канал в таком состоянии больше двух часов. После этого поведение канала при повторном подключении не гарантируется, как и его поведение в ответ на команду Reset. Необходимо остановить канал, удалить его и создать новый.
* Во время работы канала или связанных с ним программ входной протокол изменить нельзя. Если вам нужны другие протоколы, создайте отдельный канал для каждого из них.
* Каждый раз при повторной настройке динамического кодировщика вызывайте для канала метод **Reset** . Перед сбросом канала нужно остановить программу. После сброса канала перезапустите программу.
* Канал можно остановить, только если он находится в состоянии "Выполняется" и все передаваемые по нему программы остановлены.
* По умолчанию в учетную запись служб мультимедиа можно добавить не более 5 каналов. Это мягкая квота для всех новых учетных записей. Дополнительные сведения см. в разделе [квоты и ограничения](media-services-quotas-and-limitations.md).
* Во время работы канала или связанных с ним программ входной протокол изменить нельзя. Если вам нужны другие протоколы, создайте отдельный канал для каждого из них.
* Счета выставляются, только когда канал находится в состоянии **Выполняется**. Дополнительные сведения см. в [этом разделе](media-services-manage-live-encoder-enabled-channels.md#states).
* Сейчас максимальная рекомендуемая продолжительность интерактивного события составляет 8 часов. 
* Убедитесь, что конечная точка потоковой передачи, из которой нужно транслировать содержимое, находится в состоянии **Выполняется**.
* Предустановка кодирования считает "максимальной частотой кадров" 30 кадров в секунду. Поэтому, если входные данные — 60 кадров/с/59,94i, входные кадры удаляются или расперемежевываются на кадры с частотой 30/29,97 кадров/с. Если входные данные — 50 кадров/с/50i, входные кадры удаляются или расперемежевываются на кадры с частотой 25 кадров/с. Если входные данные — 25 кадров/с, выходные данные остаются на частоте 25 кадров/с.
* Не забудьте ОСТАНОВИТЬ ВАШ КАНАЛ после завершения работы. Если этого не сделать, плата продолжит начисляться.

## <a name="known-issues"></a>Известные проблемы
* Время запуска канала было сокращено примерно до 2 минут, однако в отдельных случаях оно может составлять до 20 минут и более.
* Изображения баннера должны соответствовать ограничениям, описанным [здесь](media-services-manage-live-encoder-enabled-channels.md#default_slate). Если вы попытаетесь создать канал с баннером по умолчанию, разрешение которого больше 1920x1080, запрос в конечном итоге завершится ошибкой.
* И еще раз, не забудьте ОСТАНОВИТЬ ВАШ КАНАЛ после завершения потоковой передачи. Если этого не сделать, плата продолжит начисляться.

## <a name="need-help"></a>Требуется помощь?

Вы можете открыть запрос в службу поддержки, перейдя к разделу [нового запроса на техническую поддержку](https://portal.azure.com/#blade/Microsoft_Azure_Support/HelpAndSupportBlade/newsupportrequest)

## <a name="next-step"></a>Дальнейшие действия

Просмотрите схемы обучения работе со службами мультимедиа.

[!INCLUDE [media-services-learning-paths-include](../../../includes/media-services-learning-paths-include.md)]

## <a name="provide-feedback"></a>Отзывы
[!INCLUDE [media-services-user-voice-include](../../../includes/media-services-user-voice-include.md)]

## <a name="related-topics"></a>Связанные темы
[Доставка событий потоковой трансляции с помощью служб мультимедиа Azure](media-services-overview.md)

[Потоковая трансляция с использованием служб мультимедиа Azure для создания потоков с несколькими скоростями на портале Azure](media-services-portal-creating-live-encoder-enabled-channel.md)

[Потоковая трансляция с использованием служб мультимедиа Azure для создания потоков с разными скоростями с помощью .NET](media-services-dotnet-creating-live-encoder-enabled-channel.md)

[Channel](/rest/api/media/operations/channel)

[Основные понятия служб мультимедиа](media-services-concepts.md)

[Спецификация приема фрагментированного MP4 в реальном времени в службах мультимедиа Azure](../media-services-fmp4-live-ingest-overview.md)

[live-overview]: ./media/media-services-manage-live-encoder-enabled-channels/media-services-live-streaming-new.png
