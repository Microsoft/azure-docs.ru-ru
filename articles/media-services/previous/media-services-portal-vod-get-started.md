---
title: Доставка видео по запросу с помощью портала Azure | Документация Майкрософт
description: В этом руководстве описано, как реализовать простую службу для доставки видео по запросу с помощью приложения служб мультимедиа Azure и портала Azure.
services: media-services
documentationcenter: ''
author: IngridAtMicrosoft
manager: femila
editor: ''
ms.assetid: 6c98fcfa-39e6-43a5-83a5-d4954788f8a4
ms.service: media-services
ms.workload: media
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: conceptual
ms.date: 03/10/2021
ms.author: inhenkel
ms.openlocfilehash: fc908f909cdb64e968db78b2c98b8f0edf1c61dd
ms.sourcegitcommit: 225e4b45844e845bc41d5c043587a61e6b6ce5ae
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/11/2021
ms.locfileid: "103009697"
---
# <a name="get-started-with-delivering-content-on-demand-by-using-the-azure-portal"></a>Доставка содержимого по запросу с помощью портала Azure

[!INCLUDE [media services api v2 logo](./includes/v2-hr.md)]

> [!NOTE]
> В Cлужбы мультимедиа версии 2 больше не добавляются новые компоненты или функциональные возможности. <br/>Ознакомьтесь с новейшей версией Служб мультимедиа — [версией 3](../latest/index.yml). Также изучите руководство по [миграции из версии 2 в версию 3](../latest/migrate-v-2-v-3-migration-introduction.md).

В этом руководстве описано, как реализовать простую службу для доставки видео по запросу с помощью приложения служб мультимедиа Azure и портала Azure.

## <a name="prerequisites"></a>Предварительные требования
Ниже перечислены необходимые условия для выполнения действий, описанных в этом руководстве:

* Учетная запись Azure. Дополнительные сведения см. в статье [Бесплатная пробная версия Azure](https://azure.microsoft.com/pricing/free-trial/). 
* Учетная запись служб мультимедиа. Сведения о создании учетной записи служб мультимедиа см. в разделе [Создание учетной записи служб мультимедиа](media-services-portal-create-account.md).

Учебник включает в себя следующие разделы:

1. Запуск конечной точки потоковой передачи.
2. Загрузка видеофайла.
3. Кодирование исходного файла в набор MP4-файлов с адаптивным битрейтом.
4. Публикация ресурса и получение URL-адресов потоковой передачи и поэтапной загрузки.  
5. Воспроизведение содержимого.

## <a name="start-the-streaming-endpoint"></a>Запуск конечной точки потоковой передачи

При работе со службами мультимедиа Azure один из самых частых сценариев — потоковая передача видео с переменной скоростью. Службы мультимедиа обеспечивают динамическую упаковку. Динамическая упаковка позволяет доставлять закодированное содержимое MP4 с переменной скоростью в форматах потока JIT, которые поддерживаются службами мультимедиа. Примеры: Apple HTTP Live Streaming (HLS), Microsoft Smooth Streaming и динамическая адаптивная потоковая передача по HTTP (DASH, также называется MPEG-DASH). Потоковая передача с переменной скоростью в службах мультимедиа позволяет доставлять видео, не сохраняя предварительно упакованные версии каждого из этих форматов потока.

> [!NOTE]
> Когда вы создаете учетную запись служб мультимедиа, в нее добавляется конечная точка потоковой передачи по умолчанию, которая находится в состоянии **Остановлена**. Чтобы начать потоковую передачу содержимого и воспользоваться динамической упаковкой и динамическим шифрованием, конечная точка потоковой передачи, из которой необходимо выполнять потоковую передачу содержимого, должна находиться в состоянии **Выполняется**. 

Запуск конечной точки потоковой передачи

1. Войдите на [портал Azure](https://portal.azure.com/).
2. Выберите **Параметры**  >  **конечные точки потоковой передачи**. 
3. Выберите конечную точку потоковой передачи по умолчанию. Откроется окно **сведений о КОНЕЧНОЙ точке потоковой передачи по умолчанию** .
4. Нажмите значок **Пуск**.
5. Нажмите кнопку **Сохранить**.

## <a name="upload-files"></a>Отправка файлов
Чтобы выполнить потоковую передачу видео с помощью служб мультимедиа, передайте и закодируйте исходные видео с использованием нескольких скоростей, а затем опубликуйте результат. В этом разделе описан первый шаг. 

1. Выберите учетную запись служб мультимедиа Azure на [портале Azure](https://portal.azure.com/).
2. Установите флажок **Параметры** > **Ресурсы-контейнеры**. Затем нажмите кнопку **Отправить**.
   
    ![Отправка файлов](./media/media-services-portal-vod-get-started/media-services-upload.png)
   
    Появится окно **загрузки видеоресурса** .
   
   > [!NOTE]
   > В службах мультимедиа нет ограничения на размер файла при отправке видео.
   > 
   > 
3. На компьютере перейдите к видео, которое нужно отправить. Выберите видео и нажмите кнопку **ОК**.  
   
    Начнется отправка. Ход отправки отображается под именем файла.  

Когда отправка завершится, в области **Ресурсы-контейнеры** появится новый ресурс. 

## <a name="encode-assets"></a>Кодирование ресурсов
Чтобы воспользоваться преимуществами динамического шифрования, закодируйте исходный файл в набор MP4-файлов с несколькими скоростями. Этапы кодирования описаны в этом разделе.

### <a name="encode-assets-in-the-portal"></a>Кодирование ресурсов на портале
Чтобы закодировать содержимое с помощью Media Encoder Standard на портале Azure:

1. Выберите учетную запись служб мультимедиа Azure на [портале Azure](https://portal.azure.com/).
2. Установите флажок **Параметры** > **Ресурсы-контейнеры**. Выберите ресурс, который требуется закодировать.
3. Нажмите кнопку **Кодировать**.
4. В области **кодирования ресурса** выберите обработчик **Кодировщик мультимедиа Standard** с предустановкой. Дополнительные сведения о предустановках см. в статьях [Использование стандартной версии кодировщика мультимедиа Azure для автоматического создания схемы скоростей](media-services-autogen-bitrate-ladder-with-mes.md) и [Предустановки задач для Media Encoder Standard](media-services-mes-presets-overview.md). Важно выбрать предустановку, которая больше всего подходит для входного видео. Например, если известно, что входное видео имеет разрешение 1920 &#215; 1080 пикселей, можно использовать предустановку **H264 Multiple Bitrate 1080p**. Если у вас видео с низким разрешением (640 &#215; 360), предустановку **H264 Multiple Bitrate 1080p** использовать не следует.
   
   Чтобы упростить управление ресурсами, вы можете изменить имена выходного ресурса и задания.
   
   ![Кодирование ресурсов](./media/media-services-portal-vod-get-started/media-services-encode1.png)
5. Нажмите кнопку **создания**.

### <a name="monitor-encoding-job-progress"></a>Мониторинг хода выполнения задания кодирования
Чтобы отслеживать выполнение задания кодирования, выберите **Параметры** в верхней части страницы и нажмите **Задания**.

![Задания](./media/media-services-portal-vod-get-started/media-services-jobs.png)

## <a name="publish-content"></a>Публикация содержимого
Чтобы предоставить пользователю URL-адрес, который можно использовать для потоковой передачи или загрузки содержимого, сначала опубликуйте ресурс, создав указатель. Указатели предоставляют доступ к файлам в ресурсе. Службы мультимедиа Azure поддерживают два типа указателей: 

* **Указатели потоковой передачи OnDemandOrigin.** Такие указатели используются для потоковой передачи с переменной скоростью. Примеры адаптивной потоковой передачи: HLS, Smooth Streaming и MPEG-DASH. Чтобы создать указатель потоковой передачи, в ресурсе должен быть ISM-файл. 
* **Последовательные указатели (подписанного URL-адреса).** Такие указатели используются для доставки видео при последовательном скачивании.

Чтобы создать URL-адрес потоковой передачи HLS, добавьте *(format=m3u8-aapl)* к URL-адресу:

`{streaming endpoint name-media services account name}.streaming.mediaservices.windows.net/{locator ID}/{file name}.ism/Manifest(format=m3u8-aapl)`

Чтобы создать URL-адрес потоковой передачи для воспроизведения ресурсов Smooth Streaming, используйте следующий формат:

`{streaming endpoint name-media services account name}.streaming.mediaservices.windows.net/{locator ID}/{file name}.ism/Manifest`

Чтобы создать URL-адрес для потоковой передачи в формате MPEG-DASH, добавьте к исходному адресу строку *(format=mpd-time-csf)*:

`{streaming endpoint name-media services account name}.streaming.mediaservices.windows.net/{locator ID}/{file name}.ism/Manifest(format=mpd-time-csf)`

Подписанный URL-адрес имеет следующий формат:

`{blob container name}/{asset name}/{file name}/{shared access signature}`

> [!NOTE]
> Срок действия указателей, которые были созданы на портале Azure до марта 2015 г., — два года.  
> 
> 

Чтобы обновить для указателя конечную дату срока действия, вы можете использовать [REST API](/rest/api/media/operations/locator#update_a_locator) или [.NET API](/dotnet/api/microsoft.windowsazure.mediaservices.client.ilocator). 

> [!NOTE]
> Когда вы обновляете срок действия последовательного указателя, URL-адрес изменяется.

### <a name="to-use-the-portal-to-publish-an-asset"></a>Публикация ресурса с помощью портала
1. Выберите учетную запись служб мультимедиа Azure на [портале Azure](https://portal.azure.com/).
2. Установите флажок **Параметры** > **Ресурсы-контейнеры**. Выберите ресурс, который требуется опубликовать.
3. Нажмите кнопку **Опубликовать**.
4. Выберите тип указателя.
5. Выберите **Добавить**.
   
    ![Публикация видео](./media/media-services-portal-vod-get-started/media-services-publish1.png)

URL-адрес будет добавлен в список **опубликованных URL-адресов**.

## <a name="play-content-from-the-portal"></a>Воспроизведение контента на портале
На портале Azure можно проверить видео с помощью проигрывателя содержимого.

Выберите видео и нажмите кнопку **Воспроизвести**.

![Воспроизведение видео на портале Azure](./media/media-services-portal-vod-get-started/media-services-play.png)

Важные особенности

* Чтобы начать потоковую передачу, запустите конечную точку потоковой передачи по умолчанию.
* Убедитесь, что видео опубликовано.
* Проигрыватель мультимедиа на портале Azure воспроизводит содержимое из конечной точки потоковой передачи по умолчанию. Если требуется воспроизвести содержимое из другой конечной точки потоковой передачи (не являющейся точкой по умолчанию), выберите URL-адрес, скопируйте его и вставьте другой проигрыватель. Например, можно проверить видео с помощью [проигрывателя мультимедиа Azure](https://aka.ms/azuremediaplayer).

## <a name="provide-feedback"></a>Отзывы
[!INCLUDE [media-services-user-voice-include](../../../includes/media-services-user-voice-include.md)]

## <a name="next-steps"></a>Дальнейшие действия
[!INCLUDE [media-services-learning-paths-include](../../../includes/media-services-learning-paths-include.md)]