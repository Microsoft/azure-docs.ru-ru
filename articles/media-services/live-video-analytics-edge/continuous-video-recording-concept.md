---
title: Непрерывная запись видео — Azure
description: Непрерывная запись видео (КВР) — это процесс постоянной записи видео из источника видео. В этом разделе обсуждается, что такое КВР.
ms.topic: conceptual
ms.date: 04/27/2020
ms.openlocfilehash: f8b25d74db279f8cfff68f08efeab2975484a0c5
ms.sourcegitcommit: 6386854467e74d0745c281cc53621af3bb201920
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/08/2021
ms.locfileid: "102453756"
---
# <a name="continuous-video-recording"></a>Непрерывная запись видео  

## <a name="suggested-pre-reading"></a>Рекомендуемые материалы для предварительного ознакомления  

* [Понятие графа мультимедиа](media-graph-concept.md)
* [Концепция записи видео](video-recording-concept.md)

## <a name="overview"></a>Обзор

Непрерывная запись видео (КВР) — это процесс постоянной записи видео из источника видео. Интерактивная аналитика видео на IoT Edge поддерживает непрерывную запись видео на постоянной основе с камеры ККТВ через [мультимедийный граф](media-graph-concept.md) , состоящий из ИСХОДНОГО узла RTSP и узла приемника ресурса. На схеме ниже показано графическое представление такого графа мультимедиа. Представление JSON [топологии графа](media-graph-concept.md#media-graph-topologies-and-instances) такого графа мультимедиа можно найти [здесь](https://github.com/Azure/live-video-analytics/tree/master/MediaGraph/topologies/cvr-asset).

> [!div class="mx-imgBorder"]
> :::image type="content" source="./media/continuous-video-recording/continuous-video-recording-overview.svg" alt-text="Непрерывная запись видео":::

Показанный выше граф мультимедиа можно запустить на пограничном устройстве с записью приемника ресурса в [ресурсе](terminology.md#asset)служб мультимедиа Azure. Видео будет записано до тех пор, пока граф мультимедиа остается в активном состоянии. Так как видео записывается как ресурс-контейнер, его можно воспроизводить с помощью существующих возможностей потоковой передачи служб мультимедиа. Дополнительные сведения см. в разделе [Воспроизведение записанного содержимого](video-playback-concept.md) .

## <a name="resilient-recording"></a>Отказоустойчивая запись

Интерактивная аналитика видео на IoT Edge поддерживает работу в условиях "меньше, чем" в сети, где пограничным устройством может быть потеряно подключение к облаку или использование свободной пропускной способности. Чтобы учитывать это, видео из источника записывается локально в кэш и автоматически синхронизируется с ресурсом на периодической основе. Если изучить [топологию Graph](https://github.com/Azure/live-video-analytics/tree/master/MediaGraph/topologies/cvr-asset/topology.json)в формате JSON, вы увидите, что в нем определены следующие свойства:

```
"segmentLength": "PT30S",
"localMediaCacheMaximumSizeMiB": "2048",
"localMediaCachePath": "/var/lib/azuremediaservices/tmp/",
```

Последние два свойства важны для отказоустойчивой записи (также требуются свойства для узла приемника ресурса). Свойство Локалмедиакачепас указывает приемнику ресурса использовать путь к папке для кэширования данных мультимедиа перед отправкой в ресурс. Вы можете увидеть [эту](../../iot-edge/how-to-access-host-storage-from-module.md) статью, чтобы понять, как модуль ребра может использовать локальное хранилище устройства. Свойство Локалмедиакачемаксимумсиземиб определяет, сколько места на диске может использоваться приемником ресурса в качестве кэша (1 MiB = 1024 * 1024 байт). 

Если ваш пограничная модуль теряет подключение в течение очень долгого времени, а содержимое, хранящееся в папке кэша, достигает значения Локалмедиакачемаксимумсиземиб, приемник ресурса начинает отменять данные из кэша, начиная с самых старых данных. Например, если устройство потеряло подключение в 10:00, а кэш достигает максимального ограничения в 18:00, приемник ресурса начинает удалять данные, записанные на 10:00. 

При восстановлении сетевого подключения приемник ресурса начнет отправку из кэша и снова начать с самых старых данных. В приведенном выше примере предположим, что в течение 5 минут необходимо было отброшено видео из кэша по времени восстановления подключения (скажем, в 6:02PM), а приемник ресурса начнет отправку с метки 10:05AM.

Если впоследствии вы изучите ресурс с помощью [этих](playback-recordings-how-to.md) API-интерфейсов, вы увидите, что в ресурсе есть зазор от приблизительно 10:00 до 10:05AM.

## <a name="segmented-recording"></a>Сегментированная запись  

Как упоминалось выше, узел приемника ресурса будет записывать видео в локальный кэш и периодически отправлять видео в облако. Свойство Сегментленгс (показанное в приведенном выше разделе) поможет контролировать стоимость транзакций записи, связанную с записью данных в учетную запись хранения, в которую записывается ресурс-контейнер. Например, если увеличить период отправки с 30 секунд до 5 минут, число транзакций хранилища будет уменьшено на 10 (5 * 60/30).

Свойство Сегментленгс гарантирует, что модуль пограничной передачи видео будет загружаться не чаще одного раза в течение Сегментленгс секунд. Это свойство имеет минимальное значение, равное 30 секундам (также значение по умолчанию), и его можно увеличить на 30 секунды до максимума в 5 минут.

> [!NOTE]
> В статье [записи о воспроизведении](playback-recordings-how-to.md) содержатся сведения о том, что сегментленгс имеет на воспроизведении.

## <a name="see-also"></a>См. также раздел

* [Запись видео на основе событий](event-based-video-recording-concept.md)
* [Воспроизведение записанного содержимого](video-playback-concept.md)

## <a name="next-steps"></a>Дальнейшие действия

[Учебник. запись непрерывного видео](continuous-video-recording-tutorial.md)
