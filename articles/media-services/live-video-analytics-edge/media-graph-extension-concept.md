---
title: Расширение графа мультимедиа — Azure
description: Аналитика видеотрансляций в IoT Edge позволяет расширить возможности обработки графов мультимедиа с помощью узла расширения графа.
ms.topic: overview
ms.date: 09/14/2020
ms.openlocfilehash: 66656690e4e53508253091134a67adeb899b3dbf
ms.sourcegitcommit: e6de1702d3958a3bea275645eb46e4f2e0f011af
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/20/2021
ms.locfileid: "102455845"
---
# <a name="media-graph-extension"></a>Расширение графа мультимедиа

Аналитика видеотрансляций в IoT Edge позволяет расширить возможности обработки графов мультимедиа с помощью узла расширения графа. Подключаемый модуль расширения аналитики может использовать традиционные методы обработки изображений или модели искусственного интеллекта для компьютерного зрения. Чтобы обеспечить возможность использования расширений графов, необходимо включить в граф мультимедиа узел обработчика расширений. Узел обработчика расширений передает видеокадры в настроенную конечную точку и выступает в качестве интерфейса для расширения. Подключение можно установить к локальной или удаленной конечной точке и при необходимости защитить с помощью проверки подлинности и шифрования TLS. Кроме того, узел обработчика расширений графа позволяет дополнительно масштабировать и кодировать видеокадры перед их отправкой в пользовательское расширение. 

Аналитика видеотрансляций поддерживает два типа обработчиков расширений графа мультимедиа:

* [обработчик расширений HTTP](media-graph-concept.md#http-extension-processor);
* [обработчик расширений gRPC](media-graph-concept.md#grpc-extension-processor).

Узел расширения графа ожидает, что подключаемый модуль расширения аналитики вернет результаты в формате JSON. В идеале результаты должны соответствовать [объектной модели схемы метаданных вывода](/azure/media-services/live-video-analytics-edge/inference-metadata-schema).

## <a name="http-extension-processor"></a>Обработчик расширений HTTP

Обработчик расширений HTTP позволяет реализовать сценарии расширения с использованием [протокола HTTP](/azure/media-services/live-video-analytics-edge/http-extension-protocol), в которых производительность и (или) оптимальное использование ресурсов не являются основной задачей. Вы можете предоставить для графа мультимедиа собственный искусственный интеллект через конечную точку HTTP REST. 

Узел обработчика расширений HTTP используется, если:

* требуется более эффективное взаимодействие с имеющимися системами формирования выводов по протоколу HTTP;
* приемлема низкая скорость передачи данных;
* необходимо использовать простой интерфейс запросов и ответов для Аналитики видеотрансляций.

## <a name="grpc-extension-processor"></a>Обработчик расширений gRPC

Обработчик расширений gRPC позволяет реализовать сценарии расширения с использованием высокопроизводительного [структурированного протокола](/azure/media-services/live-video-analytics-edge/grpc-extension-protocol) на основе gRPC. Он идеально подходит для сценариев, в которых приоритетом являются производительность и (или) оптимальное использование ресурсов. Обработчик расширений gRPC позволяет в полной мере реализовать преимущество определений структурированных данных. gRPC обеспечивает высокую производительность при передаче содержимого за счет:

* использования [встроенной общей памяти](https://en.wikipedia.org/wiki/Shared_memory) или 
* непосредственного внедрения содержимого в текст сообщений gRPC. 

Обработчик расширений gRPC можно использовать для отправки свойств мультимедиа вместе с сообщениями, используемыми для обмена выводами.
Поэтому узел обработчика расширений HTTP используется, если:

* необходимо использовать структурированный контракт (например, структурированные сообщения для запросов и ответов);
* необходимо использовать буферы протоколов ([protobuf](https://developers.google.com/protocol-buffers)) в качестве основного формата обмена сообщениями для взаимодействия;
* для взаимодействия с сервером gRPC вместо традиционной модели запросов и ответов необходимо использовать однопотоковый сеанс, для чего требуется, чтобы пользовательский обработчик запросов анализировал входящие запросы и вызывал правильные функции реализации; 
* для взаимодействия между службой "Аналитика видеотрансляций" и вашим модулем требуется низкая задержка и высокая пропускная способность.

## <a name="use-your-inferencing-model-with-live-video-analytics"></a>Использование модели формирования выводов для Аналитики видеотрансляций

Расширения графа мультимедиа позволяют выполнять модели формирования выводов по своему усмотрению в любой пригодной для этого среде выполнения, например ONNX, TensorFlow, PyTorch или какой-либо другой в вашем контейнере Docker. Для лучшей производительности пользовательское расширение формирования выводов должно быть развернуто вместе с модулем Edge службы "Аналитика видеотрансляций", а затем вызываться через обработчик расширений HTTP или gRPC, включенный в топологию графа. Кроме того, для регулирования частоты вызовов пользовательского расширения можно при необходимости добавить над обработчиком расширений мультимедиа обработчик [детекторов движения](media-graph-concept.md#motion-detection-processor).

На схеме ниже показана общая структура потока данных.

> [!div class="mx-imgBorder"]
> :::image type="content" source="./media/media-graph-extension/analyze-live-video-with-AI-inference-service.svg" alt-text="Служба вывода на базе ИИ":::

## <a name="samples"></a>Примеры

Вы можете начать работу с одного из наших кратких руководств, в которых продемонстрирована видеоаналитика в реальном времени с предварительно созданной службой расширения при низкой частоте кадров с [обработчиком расширения HTTP](/azure/media-services/live-video-analytics-edge/use-your-model-quickstart?pivots=programming-language-csharp) или с высокой частотой кадров с [обработчиком расширения gRPC](/azure/media-services/live-video-analytics-edge/analyze-live-video-use-your-grpc-model-quickstart?pivots=programming-language-csharp).

Опытные пользователи могут воспользоваться нашими примерами [записных книжек Jupyter](https://github.com/Azure/live-video-analytics/blob/master/utilities/video-analysis/notebooks/readme.md) для Аналитики видеотрансляций. Эти записные книжки содержат пошаговые инструкции по использованию **расширения графа мультимедиа** для выполнения следующих действий:

* создание образа контейнера Docker для службы расширений;
* развертывание службы расширений в качестве контейнера вместе с контейнером Аналитики видеотрансляций;
* использование графа мультимедиа Аналитики видеотрансляций с клиентом расширения и добавление в него ссылки на конечную точку (HTTP или gRPC) для расширения.
