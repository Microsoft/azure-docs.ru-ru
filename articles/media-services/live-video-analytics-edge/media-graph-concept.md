---
title: Понятие графа мультимедиа — Azure
description: Граф мультимедиа позволяет определить, откуда следует записывать носитель, как он должен обрабатываться и куда должны доставляться результаты. В этой статье приводится подробное описание концепции графа мультимедиа.
ms.topic: conceptual
ms.date: 05/01/2020
ms.openlocfilehash: ad23acbbbdd0c15e92e471ee22a229470a8a3a75
ms.sourcegitcommit: f0a3ee8ff77ee89f83b69bc30cb87caa80f1e724
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/26/2021
ms.locfileid: "105557672"
---
# <a name="media-graph"></a>Граф мультимедиа

## <a name="suggested-pre-reading"></a>Рекомендуемые материалы для предварительного ознакомления

* [Аналитика видеотрансляций в IoT Edge: обзор](overview.md)
* [Аналитика видеотрансляции в IoT Edge: терминология](terminology.md)

## <a name="overview"></a>Обзор

Граф мультимедиа позволяет определить, откуда следует записывать носитель, как он должен обрабатываться и куда должны доставляться результаты. Это достигается путем подключения компонентов или узлов нужным образом. На схеме ниже представлено графическое представление графа мультимедиа.  

> [!div class="mx-imgBorder"]
> :::image type="content" source="./media/media-graph/media-graph.svg" alt-text="Граф мультимедиа":::

Интерактивная аналитика видео на IoT Edge поддерживает различные типы источников, процессоров и приемников.

* **Исходные узлы** обеспечивают запись мультимедиа в граф мультимедиа. Носитель в этом контексте, по сути, может быть звуковым потоком, видеопотоком, потоком данных или потоком, в котором объединены аудио, видео и (или) данные в одном потоке.
* **Узлы процессора** позволяют обрабатывать носители в графе мультимедиа.
* **Узлы приемника** позволяют предоставлять результаты обработки службам и приложениям за пределами графа мультимедиа.

## <a name="media-graph-topologies-and-instances"></a>Топологии и экземпляры графа мультимедиа 

Интерактивная аналитика видео на IoT Edge позволяет управлять графами мультимедиа с помощью двух концепций: "топология графа" и "экземпляр Graph". Топология графа позволяет определить схему графа с параметрами в качестве заполнителей для значений. Топология определяет, какие узлы используются в графе мультимедиа, и как они соединяются в графе мультимедиа. Например, если вы хотите записать канал с камеры, потребуется граф с исходным узлом, который получает видео, и узел приемника, записывающий видео.

Значения параметров в топологии указываются при создании экземпляров графа, ссылающихся на топологию. Это позволяет создать несколько экземпляров, ссылающихся на одну и ту же топологию, но с разными значениями для параметров, указанных в топологии. В приведенном выше примере можно было использовать параметры для представления IP-адреса камеры и имя записанного видео. Можно создать несколько экземпляров графов с такой топологией — один экземпляр для каждой камеры в здании, возможно, каждый с конкретным IP-адресом и конкретным именем.

## <a name="media-graph-states"></a>Состояния графа мультимедиа  

Жизненный цикл топологий графов и экземпляров графов показан на следующей схеме состояний.

> [!div class="mx-imgBorder"]
> :::image type="content" source="./media/media-graph/graph-topology-lifecycle.svg" alt-text="Жизненный цикл топологии графа и экземпляра графа":::

Начнем с [создания топологии графа](direct-methods.md#graphtopologyset). Затем для каждого канала видео в реальном времени, который требуется обработать с помощью этой топологии, необходимо [создать экземпляр Graph](direct-methods.md#graphinstanceset). 

Экземпляр Graph будет находиться в `Inactive` состоянии (Idle).

Когда вы будете готовы отправить канал видео в реальном времени в экземпляр Graph, [активируйте](direct-methods.md#graphinstanceactivate) его. Экземпляр графа будет кратко проходить по переходному `Activating` состоянию, и в случае успеха переходит в `Active` состояние. В этом `Active` состоянии будет обрабатываться носитель (если экземпляр графа получает входные данные).

> [!NOTE]
>  Экземпляр Graph может быть активным без перебора данных (например, если камера переходит в автономный режим).
> Плата за использование подписки Azure будет взиматься, если экземпляр графа находится в активном состоянии.

Вы можете повторить процесс создания и активации других экземпляров графа для той же топологии, если у вас есть другие каналы Live Video для обработки.

Завершив обработку видеопотока в реальном времени, можно [деактивировать](direct-methods.md#graphinstancedeactivate) экземпляр Graph. Экземпляр графа будет кратко проходить по переходному `Deactivating` состоянию, сбрасывать все данные, а затем возвращаться к `Inactive` состоянию.

Экземпляр Graph можно [Удалить](direct-methods.md#graphinstancedelete) , только если он находится в `Inactive` состоянии.

После удаления всех экземпляров графов, ссылающихся на определенную топологию графа, [топологию графа можно удалить](direct-methods.md#graphtopologydelete).


## <a name="sources-processors-and-sinks"></a>Источники, процессоры и приемники  

Интерактивная аналитика видео на IoT Edge поддерживает следующие типы узлов в графе мультимедиа:

### <a name="sources"></a>Источники 

#### <a name="rtsp-source"></a>Источник RTSP 

Узел источника RTSP позволяет принимать носители с сервера [RTSP](https://tools.ietf.org/html/rfc2326) . С помощью наблюдения и камер на основе IP данные передаются по протоколу RTSP (в режиме реального времени — Streaming-Protocol), который отличается от устройств других типов, таких как телефоны и видеокамеры. Этот протокол используется для установки и управления сеансами мультимедиа между сервером (камерой) и клиентом. Узел источника данных RTSP в графе мультимедиа выступает в качестве клиента и может установить сеанс с сервером RTSP. Многие устройства, например большинство [IP-камер](https://en.wikipedia.org/wiki/IP_camera) , имеют встроенный сервер RTSP. [Онвиф](https://www.onvif.org/) требует, чтобы протокол RTSP поддерживался в определении [профилей G, S & T,](https://www.onvif.org/wp-content/uploads/2019/12/ONVIF_Profile_Feature_overview_v2-3.pdf) соответствующих требованиям. Исходный узел RTSP требует указать URL-адрес RTSP вместе с учетными данными, чтобы включить проверку подлинности подключения.

#### <a name="iot-hub-message-source"></a>Источник сообщения центра Интернета вещей 

Как и другие [модули IOT Edge](../../iot-fundamentals/iot-glossary.md#iot-edge), интерактивная аналитика видео в модуле IOT Edge может принимать сообщения через [центр IOT Edge](../../iot-fundamentals/iot-glossary.md#iot-edge-hub). Эти сообщения могут отправляться из других модулей или из приложений, выполняющихся на пограничном устройстве или в облаке. Такие сообщения доставляются (маршрутизируются) в [именованный вход](../../iot-edge/module-composition.md#sink) в модуле. Исходный узел сообщения центра Интернета вещей позволяет таким сообщениям достигать графа мультимедиа. Эти сообщения или сигналы могут использоваться внутренне в графе мультимедиа, как правило, для активации сигнальных шлюзов (см. [шлюзы сигналов](#signal-gate-processor) ниже). 

Например, у вас может быть модуль IoT Edge, создающий сообщение при открытии дверцы. Сообщение из этого модуля можно направить в центр IoT Edge, откуда его можно перенаправить в источник сообщений центра Интернета вещей в графе мультимедиа. В графе мультимедиа источник сообщения центра Интернета вещей может передать событие обработчику сигнального шлюза, который затем может включить запись видео из источника RTSP в файл. 

### <a name="processors"></a>Процессоры  

#### <a name="motion-detection-processor"></a>Процессор обнаружения движения 

Узел процессор обнаружения движения позволяет обнаруживать движение в реальном видео. Он проверяет входящие кадры видео и определяет, есть ли в видео перемещение. При обнаружении движения он передается на видеокадры в нисходящий компонент и создает событие. Узел процессора обнаружения движения (в сочетании с другими узлами) можно использовать для активации записи входящего видео при обнаружении движения.

#### <a name="frame-rate-filter-processor"></a>Обработчик фильтра частоты кадров  

Узел обработчика частоты кадров позволяет выполнять выборку кадров из входящего видеопотока с заданной скоростью. Это позволяет уменьшить число кадров, отправленных в компоненты нижнего уровня (например, узел процессора расширения HTTP) для дальнейшей обработки.
>[!WARNING]
> Этот процессор не **рекомендуется использовать** в последнем выпуске Live Video Analytics в модуле IOT Edge. Управление частотой кадров теперь поддерживается в самих обработчиках расширения графа.

#### <a name="http-extension-processor"></a>Обработчик расширений HTTP

Узел обработчика расширений HTTP позволяет подключать собственный модуль IoT Edge к графу мультимедиа. Этот узел принимает декодированные видеоматериалы в качестве входных данных и передает такие кадры в конечную точку HTTP, предоставляемую вашим модулем. При необходимости этот узел может проходить проверку подлинности с помощью конечной точки RESTFUL. Кроме того, узел имеет встроенный модуль форматирования изображений для масштабирования и кодирования видеокадров до их ретрансляции в конечную точку RESTFUL. Средство масштабирования может сохранять пропорции, заполнять или растягивать исходное изображение. Кодировщик изображений поддерживает форматы JPEG, PNG или BMP. Подробнее об этом обработчике см. [здесь](media-graph-extension-concept.md#http-extension-processor).

#### <a name="grpc-extension-processor"></a>Обработчик расширений gRPC

Узел процессора расширений gRPC принимает декодированные видеокадры в качестве входных данных и передает такие кадры в конечную точку [gRPC](terminology.md#grpc) , предоставляемую вашим модулем. Этот узел поддерживает передачу данных через [общую память](https://en.wikipedia.org/wiki/Shared_memory) или непосредственное внедрение содержимого в тело сообщения gRPC. Кроме того, этот узел имеет встроенный форматировщик изображений для масштабирования и кодирования видеокадров перед ретрансляцией в конечную точку gRPC. Средство масштабирования может сохранять пропорции, заполнять или растягивать исходное изображение. Кодировщик изображений поддерживает форматы JPEG, PNG и BMP. Подробнее об этом обработчике см. [здесь](media-graph-extension-concept.md#grpc-extension-processor).

#### <a name="signal-gate-processor"></a>Обработчик сигнальных шлюзов  

Узел сигнальный обработчик шлюза позволяет условно пересылать носители с одного узла на другой. Он также выступает в качестве буфера, что позволяет синхронизировать мультимедиа и события. Типичный вариант использования заключается в вставке узла процессора сигнального шлюза между исходным узлом RTSP и узлом приемника ресурса и использованием выходных данных узла процессора детектора движения для активации шлюза. Благодаря такому графу мультимедиа вы записываете видео только при обнаружении движения.

### <a name="sinks"></a>Приемники  

#### <a name="asset-sink"></a>Приемник актива  

Узел приемника актива позволяет записывать данные мультимедиа (видео и/или аудио) в ресурс служб мультимедиа Azure. В графе мультимедиа может быть только один узел приемника актива. Дополнительные сведения о ресурсах и их роли при записи и воспроизведении мультимедиа см. в разделе [ресурс](terminology.md#asset) . Чтобы узнать, как используются свойства этого узла, см. статью [Непрерывная запись видео](continuous-video-recording-concept.md) .

#### <a name="file-sink"></a>Приемник файла  

Узел приемника файлов позволяет записывать данные мультимедиа (видео и/или аудио) в расположение локальной файловой системы устройства IoT Edge. В графе мультимедиа может быть только один узел приемника файлов, который должен быть расположен в узле процессора сигнального шлюза. Это ограничивает продолжительность выходных файлов значениями, указанными в свойствах узла обработчика сигналов шлюза. Чтобы убедиться, что на пограничном устройстве не хватает места на диске, можно также задать максимальный размер, который модуль анализа видео в реальном времени может использовать для хранения данных в модуле IoT Edge.  
> [!NOTE]
Если приемник файла заполнен, в реальном времени для анализа видео на IoT Edge модуль будут удалены самые старые данные и заменен новый.
#### <a name="iot-hub-message-sink"></a>Приемник сообщений центра Интернета вещей  

Узел приемника сообщений центра Интернета вещей позволяет публиковать события в центре IoT Edge. Затем концентратор IoT Edge может перенаправлять данные в другие модули или приложения на пограничном устройстве или в центр Интернета вещей в облаке (на маршруты, указанные в манифесте развертывания). Узел приемника сообщений центра Интернета вещей может принимать события от вышестоящего обработчика, такого как узел процессора обнаружения движения, или из внешней службы вывода с помощью узла обработчика расширений HTTP.

## <a name="rules-on-the-use-of-nodes"></a>Правила использования узлов

Дополнительные правила использования различных узлов в графе мультимедиа см. в статье [ограничения в топологиях графов](quotas-limitations.md#limitations-on-graph-topologies-at-preview) .

## <a name="scenarios"></a>Сценарии

Используя сочетание источников, процессоров и приемников, определенных выше, можно создавать графы мультимедиа для различных сценариев, включающих анализ живого видео. Примеры сценариев:

* [Непрерывная запись видео](continuous-video-recording-concept.md)
* [Запись видео на основе событий](event-based-video-recording-concept.md)
* [Аналитика видеотрансляции без записи видео](analyze-live-video-concept.md)

## <a name="next-steps"></a>Дальнейшие действия

Сведения о том, как выполнить обнаружение движения в реальном видеоканале, см. в разделе [Краткое руководство. Запуск интерактивной аналитики видео с помощью собственной модели](use-your-model-quickstart.md).
