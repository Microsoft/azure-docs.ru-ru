---
title: Как запустить приложение с помощью Фортаникс конфиденциального диспетчера вычислительных систем
description: Узнайте, как использовать Фортаникс конфиденциальные вычислительные системы для преобразования контейнерных образов.
services: virtual-machines
author: JBCook
ms.service: virtual-machines
ms.subservice: workloads
ms.workload: infrastructure
ms.topic: how-to
ms.date: 8/12/2020
ms.author: JenCook
ms.openlocfilehash: 41e47e29553b3e4d9cd0e0e8f280b3648f224bf9
ms.sourcegitcommit: d1b0cf715a34dd9d89d3b72bb71815d5202d5b3a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/08/2021
ms.locfileid: "99832317"
---
# <a name="how-to-run-an-application-with-fortanix-confidential-computing-manager"></a>Как запустить приложение с помощью Фортаникс конфиденциального диспетчера вычислительных систем

Начните работу с приложением в конфиденциальных вычислениях Azure с помощью [Фортаникс конфиденциальных диспетчера вычислительных систем](https://azuremarketplace.microsoft.com/marketplace/apps/fortanix.enclave_manager?tab=Overview) и [агента Фортаникс node](https://azuremarketplace.microsoft.com/marketplace/apps/fortanix.rte_node_agent) из [фортаникс](https://www.fortanix.com/).


Фортаникс — это сторонний поставщик программного обеспечения с продуктами и службами, созданными на основе инфраструктуры Azure. Другие сторонние поставщики предлагают аналогичные конфиденциальные вычислительные службы в Azure.

> [!Note]
 > Продукты, упоминаемые в этом документе, не контролируются корпорацией Майкрософт. Корпорация Майкрософт предоставляет эти сведения только для удобства, а ссылки на эти продукты сторонних производителей не подразумевают подтверждения корпорацией Майкрософт.



В этом руководстве показано, как преобразовать образ приложения в конфиденциальный образ, защищенный с помощью вычислений. В этой среде используется программное обеспечение [фортаникс](https://www.fortanix.com/) , основанное на виртуальных машинах Azure DCsv2-Series с поддержкой Intel SGX. Это решение управляет критически важными политиками безопасности, такими как проверка личности и управление доступом к данным.

 Чтобы получить поддержку для Фортаникс, присоединитесь к [сообществу резервного времени фортаникс](https://fortanix.com/community/) и используйте #enclavemanager каналов.


## <a name="prerequisites"></a>Предварительные требования

1. Если у вас нет учетной записи Фортаникс конфиденциального диспетчера вычислительных систем, [Зарегистрируйтесь](https://em.fortanix.com/auth/sign-up) до начала.
1. Частный реестр [DOCKER](https://docs.docker.com/) для отправки преобразованных образов приложений.
1. Если у вас еще нет подписки Azure, [создайте учетную запись Azure](https://azure.microsoft.com/pricing/purchase-options/pay-as-you-go/), прежде чем начинать работу.

> [!NOTE]
> Учетные записи бесплатной пробной версии не предоставляют доступа к виртуальным машинам, которые используются в этом руководстве. Перейдите на подписку с оплатой по мере использования.

## <a name="add-an-application-to-fortanix-confidential-computing-manager"></a>Добавление приложения в Фортаникс конфиденциальный диспетчер вычислительных систем
1. Вход в [Фортаникс конфиденциальный диспетчер вычислительных систем (ФОРТАНИКС EM)](https://em.fortanix.com)
1. Перейдите на страницу **учетные записи** и выберите **Добавить учетную запись** , чтобы создать новую учетную запись.

![Создание учетной записи](media/how-to-fortanix-enclave-manager/create-account.png)

1. После создания учетной записи нажмите **кнопку Выбрать** , чтобы выбрать только что созданную учетную запись. Теперь мы можем начать регистрацию вычислений и создания приложений.
1. Нажмите кнопку **+ приложение** , чтобы добавить приложение. В этом примере мы добавим приложение Flask Server анклава OS.

1. Нажмите кнопку **Добавить** для приложения анклава OS.

    ![Добавить приложение](media/how-to-fortanix-enclave-manager/add-enclave-application.png)

    > [!NOTE]
    > В этом руководстве описывается добавление только приложений анклава OS. [Узнайте больше](https://support.fortanix.com/hc/en-us/articles/360044746932-Bringing-EDP-Rust-Apps-to-Confidential-Computing-Manager) о том, как присоединять приложения EDP Руст к фортаникс конфиденциальным вычислительным системам.

6. В этом руководстве мы будем использовать реестр DOCKER Фортаникс для примера приложения. Введите сведения из следующих сведений. Сохраните выходной образ с помощью частного реестра DOCKER.

    - **Имя приложения**: сервер приложений Python
    - **Описание**: Python Flask Server
    - **Имя входного образа**: фортаникс/Python-Flask
    - **Имя выходного образа**: фортанкс-Private/Python-Flask-SGX
    - **Исвпродид**: 1
    - **Исвсвм**: 1
    - Объем **памяти**: 1 ГБ
    - **Число потоков**: 128

    *Необязательно*: запустите приложение.
    - **Центр DOCKER**: [https://hub.docker.com/u/fortanix](https://hub.docker.com/u/fortanix)
    - **Приложение**: фортаникс/Python-Flask

        Выполните следующую команду:
         ```bash
            sudo docker run fortanix/python-flask
         ```

1. Добавьте сертификат. Введите сведения, используя приведенные ниже сведения, а затем нажмите кнопку **Далее**.
    - **Домен**: MyApp. домен. DOM
    - **Тип**: сертификат, выданный диспетчером конфиденциальных вычислений
    - **Путь к ключу**:/аппкэй.пем
    - **Тип ключа**: RSA
    - **Путь к сертификату**:/аппцерт.пем
    - **Размер ключа RSA**: 2048 бит


## <a name="create-an-image"></a>Создание образа
Образ CCM Фортаникс — это выпуск программного обеспечения или версия приложения. Каждое изображение связано с одним анклава хэшем (МРЕНКЛАВЕ).
1. На странице **Добавление образа** введите **учетные данные реестра** для **имени выходного образа**. Эти учетные данные используются для доступа к частному реестру DOCKER, в который будет помещен образ.

    ![создать изображение](media/how-to-fortanix-enclave-manager/create-image.png)
1. Укажите тег образа и выберите **создать**.

    ![добавить тег](media/how-to-fortanix-enclave-manager/add-tag.png)

## <a name="domain-and-image-allow-listing"></a>Список разрешений для домена и образа
Приложение, чей домен добавляется в список разрешений, будет получать сертификат TLS от диспетчера Фортаникс конфиденциальных компьютерных систем. Аналогично, когда приложение запускается из преобразованного образа, оно попытается связаться с диспетчером Фортаникс конфиденциальных компьютерных систем. Затем приложение запросит сертификат TLS.

Перейдите на вкладку **задачи** слева и утвердите ожидающие запросы, чтобы разрешить домен и образ.

## <a name="enroll-compute-node-agent-in-azure"></a>Регистрация агента кластерных узлов в Azure

### <a name="generate-and-copy-join-token"></a>Создать и скопировать токен Join
В диспетчере Фортаникс конфиденциальных компьютерных систем вы создадите маркер. Этот маркер позволяет кластерному узлу в Azure пройти проверку подлинности. Вам потребуется предоставить этот маркер виртуальной машине Azure.
1. В консоли управления нажмите кнопку **+ Регистрация узла** .
1. Выберите **создать токен** , чтобы создать маркер объединения. Скопируйте маркер.

### <a name="enroll-nodes-into-fortanix-node-agent-in-azure-marketplace"></a>Регистрация узлов в агенте узла Фортаникс в Azure Marketplace

При создании агента узла Фортаникс будет развернуто виртуальная машина, сетевой интерфейс, виртуальная сеть, группа безопасности сети и общедоступный IP-адрес в группе ресурсов Azure. Счет за подписку Azure будет взиматься по часам для виртуальной машины. Перед созданием агента узла Фортаникс ознакомьтесь со [страницей цен на виртуальные машины](https://azure.microsoft.com/pricing/details/virtual-machines/linux/) Azure для серии DCsv2. Удалите ресурсы Azure, если они не используются.

1. Перейдите в [Azure Marketplace](https://azuremarketplace.microsoft.com/marketplace/) и выполните вход с использованием учетных данных Azure.
1. В строке поиска введите **Фортаникс конфиденциальные вычисления узел Агент**. Выберите приложение, которое отображается в поле поиска под названием **Агент узла Фортаникс конфиденциальных вычислений** для перехода на домашнюю страницу предложения.
     ![Поиск в Marketplace](media/how-to-fortanix-enclave-manager/search-fortanix-marketplace.png)
1. Выберите **получить сейчас**, при необходимости введите сведения и нажмите кнопку **продолжить**. Вы будете перенаправлены на портал Azure.
1. Щелкните **создать** , чтобы перейти на страницу развертывания агента фортаникс конфиденциальных вычислений узла.
1. На этой странице вы будете вводить сведения для развертывания виртуальной машины. В частности, эта виртуальная машина является DCsv2-Series виртуальной машиной с поддержкой Intel SGX из Azure с установленным программным обеспечением агента node Фортаникс. Агент узла позволит безопасно работать с преобразованным образом на узлах Intel SGX в Azure.  Выберите **подписку** и **группу ресурсов** , в которых требуется развернуть виртуальную машину и связанные ресурсы.

    > [!NOTE]
    > Существуют ограничения при развертывании DCsv2-Series виртуальных машин в Azure. Может потребоваться запросить квоту для дополнительных ядер. Дополнительные сведения см. в статье о [конфиденциальных вычислительных решениях на виртуальных машинах Azure](./virtual-machine-solutions.md) .

1. Выберите доступный регион.
1. Введите имя виртуальной машины в поле **имя узла** .
1. Введите имя пользователя и пароль (или ключ SSH) для проверки подлинности на виртуальной машине.
1. Оставьте размер диска ОС по умолчанию 200 и выберите размер виртуальной машины (для этого руководства достаточно Standard_DC4s_v2).
1. Вставьте созданный ранее токен в поле **токен Join** .

     ![развертывание ресурсов](media/how-to-fortanix-enclave-manager/deploy-fortanix-node-agent1.png)

1. Выберите **Review + Create** (Просмотреть и создать). Убедитесь, что проверка пройдена, а затем нажмите кнопку **создать**. После развертывания всех ресурсов вычислительный узел теперь регистрируется в диспетчере Фортаникс конфиденциальных компьютерных систем.

## <a name="run-the-application-image-on-the-compute-node"></a>Запуск образа приложения на кластерном узле
Запустите приложение, выполнив следующую команду. Убедитесь, что в качестве входных данных для конкретного приложения вы изменили IP-адрес узла, порт и имя преобразованного образа.

В этом руководстве команда выполняется следующим образом:     

```bash
    sudo docker run `
        --device /dev/isgx:/dev/isgx `
        --device /dev/gsgx:/dev/gsgx `
        -v /var/run/aesmd/aesm.socket:/var/run/aesmd/aesm.socket `
        -e NODE_AGENT_BASE_URL=http://52.152.206.164:9092/v1/ fortanix-private/python-flask-sgx
```

где
- *52.152.206.164* — IP-адрес узла агента узла
- *9092* — порт, который прослушивает агент узла.
- *фортаникс-Private/Python-Flask-SGX* — это преобразованное приложение, которое можно найти на вкладке образы в столбце **имя образа** в таблице **образы** на веб-портале фортаникс конфиденциальных вычислений.

## <a name="verify-and-monitor-the-running-application"></a>Проверка и мониторинг выполняющегося приложения
1. Вернуться к [диспетчеру Фортаникс конфиденциальных компьютерных систем](https://em.fortanix.com/console)
1. Убедитесь, что вы работаете внутри **учетной записи** , в которой вы зарегистрировали узел.
1. Перейдите к **консоли управления** , щелкнув верхний значок в левой области навигации.
1. Перейдите на вкладку **приложение** .
1. Убедитесь в наличии работающего приложения со связанным вычисленным узлом.


## <a name="clean-up-resources"></a>Очистка ресурсов

Вы можете удалить группу ресурсов, виртуальную машину и связанные ресурсы, если они больше не нужны. Удаление группы ресурсов приведет к отмене регистрации узлов, связанных с преобразованным образом.

Выберите группу ресурсов для виртуальной машины и щелкните **Удалить**. Подтвердите имя группы ресурсов, чтобы завершить удаление ресурсов.

Чтобы удалить созданную учетную запись Фортаникс конфиденциального диспетчера вычислительных систем, перейдите на [страницу учетные записи](https://em.fortanix.com/accounts) в диспетчере фортаникс конфиденциальных компьютерных систем. Наведите указатель мыши на учетную запись, которую вы хотите удалить. Щелкните вертикальные черные точки в правом верхнем углу и выберите **удалить учетную запись**.

  ![удалить](media/how-to-fortanix-enclave-manager/delete-account.png)

## <a name="next-steps"></a>Дальнейшие действия

В этом кратком руководстве вы использовали Фортаникс Tools для преобразования образа приложения для выполнения на основе виртуальной машины с конфиденциальными компьютерами. Дополнительные сведения о виртуальных машинах конфиденциальных вычислений в Azure см. в [этой статье](virtual-machine-solutions.md).

Дополнительные сведения о конфиденциальных предложениях Azure см. в статье [Обзор конфиденциальных вычислений в Azure](overview.md) .

 Узнайте, как выполнять аналогичные задачи с помощью других сторонних предложений в Azure, например [Анжуна](https://azuremarketplace.microsoft.com/marketplace/apps/anjuna-5229812.aee-az-v1) [и.](https://sconedocs.github.io)
