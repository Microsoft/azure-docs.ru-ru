---
title: Проверка подлинности и авторизация Статических веб-приложений Azure
description: Сведения об использовании разных поставщиков авторизации для защиты статического приложения.
services: static-web-apps
author: craigshoemaker
ms.service: static-web-apps
ms.topic: conceptual
ms.date: 05/08/2020
ms.author: cshoe
ms.openlocfilehash: ab41a336c32a1827c23f4c4619f47dc294a4d2ea
ms.sourcegitcommit: df1930c9fa3d8f6592f812c42ec611043e817b3b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/13/2021
ms.locfileid: "103419292"
---
# <a name="authentication-and-authorization-for-azure-static-web-apps-preview"></a>Проверка подлинности и авторизация Статических веб-приложений Azure (предварительная версия)

Статические веб-приложения Azure упрощают процесс проверки подлинности, управляя ею с помощью следующих поставщиков:

- Azure Active Directory
- GitHub
- Facebook
- Google<sup>1</sup>
- Twitter

[Приглашения](#invitations) конкретного поставщика связывают пользователей с ролями, а полномочным пользователям предоставляется доступ к [маршрутам](routes.md) в соответствии с правилами, определенными в файле _routes.json_.

По умолчанию все поставщики проверки подлинности включены. Чтобы ограничить поставщика проверки подлинности, [заблокируйте доступ](#block-an-authorization-provider) с помощью настраиваемого правила маршрутизации.

Разделы о проверке подлинности и авторизации в значительной мере пересекаются с основными понятиями маршрутизации. Для работы с этой статьей ознакомьтесь с [руководством по маршрутизации](routes.md).

## <a name="roles"></a>Роли

Каждому пользователю, обращающемуся к Статическому веб-приложению, присваивается одна или несколько ролей.  Существует две встроенные роли, которые назначаются пользователям:

- **anonymous**: всем пользователям автоматически присваивается роль _anonymous_.
- **authenticated**: всем пользователям, вошедшим в систему, присваивается роль _authenticated_.

Помимо встроенных ролей можно создавать новые роли, присвоить их пользователям с помощью приглашений и ссылаться на них в файле _routes.json_.

## <a name="role-management"></a>Управление ролями

### <a name="add-a-user-to-a-role"></a>Добавление пользователя к роли

Чтобы добавить пользователей на веб-сайт, создайте приглашения, которые позволяют связать пользователей с конкретными ролями. Роли определяются и сохраняются в файле _routes.json_.

<a name="invitations" id="invitations"></a>

#### <a name="create-an-invitation"></a>Создание приглашения

Приглашения относятся к отдельным поставщикам авторизации, поэтому следует учитывать потребности приложения при выборе поставщиков для поддержки. Одни поставщики предоставляют адрес электронной почты пользователя, другие — только имя пользователя на сайте.

<a name="provider-user-details" id="provider-user-details"></a>

| Поставщик авторизации | Предоставляет следующие пользовательские данные  |
| ---------------------- | ----------------- |
| Azure Active Directory | Адрес электронной почты.     |
| Facebook               | Адрес электронной почты.     |
| GitHub                 | username          |
| Google<sup>1</sup>     | Адрес электронной почты.     |
| Twitter                | username          |

1. На [портале Azure](https://portal.azure.com) перейдите к ресурсу Статических веб-приложений.
1. В разделе _Параметры_ выберите **Управление ролями**.
1. Нажмите кнопку **Пригласить**.
1. В списке параметров выберите _поставщика авторизации_.
1. Добавьте имя пользователя или адрес электронной почты получателя в поле _сведений о приглашенном_.
    - Для GitHub и Twitter введите имя пользователя. Для остальных — адрес электронной почты получателя.
1. Выберите домен вашего статического сайта из раскрывающегося списка _Домен_.
    - Выбранный домен отображается в приглашении. Если у вас есть личный домен, связанный с сайтом, вероятно, вы захотите выбрать его.
1. Добавьте разделенный запятыми список имен ролей в поле _Роль_.
1. Введите максимальное количество часов, в течение которых приглашение будет действительным.
    - Максимально возможный предел — 168 часов (7 дней).
1. Нажмите кнопку **Generate** (Создать).
1. Скопируйте ссылку из поля _Invite link_ (Ссылка приглашения).
1. Отправьте приглашение по электронной почте пользователю, которому вы предоставляете доступ к приложению.

Когда пользователь щелкнет ссылку в приглашении, то получит предложение войти в систему с соответствующей учетной записью. После успешного входа пользователь связывается с выбранными ролями.

> [!CAUTION]
> Убедитесь, что правила маршрутизации не конфликтуют с выбранными поставщиками проверки подлинности. Блокировка поставщика с помощью правила маршрутизации не позволит пользователям принимать приглашения.

### <a name="update-role-assignments"></a>Обновление назначений ролей

1. На [портале Azure](https://portal.azure.com) перейдите к ресурсу Статических веб-приложений.
1. В разделе _Параметры_ выберите **Управление ролями**.
1. Щелкните имя пользователя в списке.
1. Измените список ролей в поле _Роль_.
1. Нажмите кнопку **Обновить**.

### <a name="remove-user"></a>Удаление пользователя

1. На [портале Azure](https://portal.azure.com) перейдите к ресурсу Статических веб-приложений.
1. В разделе _Параметры_ выберите **Управление ролями**.
1. Найдите пользователя в списке.
1. Установите флажок в строке пользователя.
1. Нажмите кнопку **Удалить** .

При удалении пользователя учитывайте следующие моменты:

1. Удаление пользователя сделает недействительными их разрешения.
1. Из-за широкого охвата территории, распространение может занять несколько минут.
1. При обратном добавлении пользователя в приложение [изменяется `userId`](user-information.md).

## <a name="remove-personal-identifying-information"></a>Удаление персональных идентификационных сведений

Если вы предоставляете приложению согласие как конечный пользователь, то приложение получает доступ к вашему адресу электронной почты или имени пользователя в зависимости от поставщика удостоверений. Когда эта информация будет предоставлена, владелец приложения определит, как управлять персональными идентификационными сведениями.

Конечные пользователи должны обратиться к администраторам отдельных веб-приложений, чтобы отозвать эти сведения из своих систем.

Чтобы удалить персональные данные на платформе Статических веб-приложений Azure и запретить этой платформе предоставлять эти сведения для будущих запросов, отправьте запрос по URL-адресу:

```url
https://identity.azurestaticapps.net/.auth/purge/<AUTHENTICATION_PROVIDER_NAME>
```

Чтобы платформа не предоставляла эти сведения при последующих запросах к отдельным приложениям, отправьте запрос по следующему URL-адресу:

```url
https://<WEB_APP_DOMAIN_NAME>/.auth/purge/<AUTHENTICATION_PROVIDER_NAME>
```

## <a name="system-folder"></a>Системная папка

Статические веб-приложения Azure используют системную папку `/.auth` для предоставления доступа к интерфейсам API, связанным с авторизацией. Вместо того чтобы предоставлять доступ к любым маршрутам в папке `/.auth` непосредственно конечным пользователям, рассмотрите возможность создания [правил маршрутизации](routes.md) для создания удобных URL-адресов.

## <a name="login"></a>Имя входа

Чтобы найти маршрут для входа определенного поставщика, воспользуйтесь сведениями из следующей таблицы.

| Поставщик авторизации | Маршрут для входа             |
| ---------------------- | ----------------------- |
| Azure Active Directory | `/.auth/login/aad`      |
| Facebook               | `/.auth/login/facebook` |
| GitHub                 | `/.auth/login/github`   |
| Google<sup>1</sup>     | `/.auth/login/google`   |
| Twitter                | `/.auth/login/twitter`  |

Например, для входа с помощью GitHub можно включить ссылку для входа, как в следующем фрагменте кода:

```html
<a href="/.auth/login/github">Login</a>
```

Если выбрана поддержка нескольких поставщиков, то для каждого из них необходимо предоставить ссылку конкретного поставщика на ваш веб-сайт.

Вы можете использовать [правило маршрутизации](./configuration.md#routes), чтобы связать поставщика по умолчанию с понятным маршрутом, например _/login_.

```json
{
  "route": "/login",
  "redirect": "/.auth/login/github"
}
```

### <a name="post-login-redirect"></a>Перенаправление после входа

Если вы хотите, чтобы после входа пользователь возвращался на определенную страницу, укажите URL-адрес в параметре строки запроса `post_login_redirect_uri`.

## <a name="logout"></a>Logout

Маршрут `/.auth/logout` выполняет выход пользователя с веб-сайта. Вы можете добавить ссылку для навигации по сайту, чтобы разрешить пользователю выполнить выход, как показано в следующем примере.

```html
<a href="/.auth/logout">Log out</a>
```

Вы можете использовать [правило маршрутизации](./configuration.md#routes), чтобы связать понятный маршрут, например _/logout_.

```json
{
  "route": "/logout",
  "redirect": "/.auth/logout"
}
```

### <a name="post-logout-redirect"></a>Перенаправление после выхода

Если вы хотите, чтобы после выхода пользователь возвращался на определенную страницу, укажите URL-адрес в параметре строки запроса `post_logout_redirect_uri`.

## <a name="block-an-authorization-provider"></a>Блокировка поставщика авторизации

Вам может потребоваться ограничить использование приложения поставщиком авторизации. Например, приложение может выполнить стандартизацию [поставщиков, которые предоставляют адреса электронной почты](#provider-user-details).

Чтобы заблокировать поставщика, можно создать [правила маршрутизации](routes.md), чтобы вернуть ошибку 404 для запросов к заблокированному маршруту конкретного поставщика. Например, чтобы ограничить доступ к Twitter в качестве поставщика, добавьте следующее правило маршрутизации.

```json
{
  "route": "/.auth/login/twitter",
  "statusCode": "404"
}
```

## <a name="restrictions"></a>Ограничения

Общие ограничения и ограничения см. в [статье о квотах](quotas.md) .

## <a name="next-steps"></a>Дальнейшие действия

> [!div class="nextstepaction"]
> [Доступ к данным пользователя в Статических веб-приложениях Azure (предварительная версия)](user-information.md)

<sup>1</sup> Ожидается внешняя сертификация.
