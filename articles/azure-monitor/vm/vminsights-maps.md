---
title: Просмотр зависимостей приложений с помощью VM Insights
description: Map — это функция аналитики VM. Он автоматически обнаруживает компоненты приложений в системах Windows и Linux и сопоставляет взаимодействие между службами. В этой статье приводятся сведения о том, как использовать функцию Map в различных сценариях.
ms.topic: conceptual
author: bwren
ms.author: bwren
ms.date: 03/20/2020
ms.openlocfilehash: 267ec0ed01fb85e9e29b0b8c9294d20d610db8fb
ms.sourcegitcommit: f3ec73fb5f8de72fe483995bd4bbad9b74a9cc9f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/04/2021
ms.locfileid: "102046573"
---
# <a name="use-the-map-feature-of-vm-insights-to-understand-application-components"></a>Использование функции Map из VM Insights для понимания компонентов приложения
В Application Insights можно просматривать обнаруженные компоненты приложений на виртуальных машинах Windows и Linux, работающих в Azure или в среде. Наблюдать за виртуальными машинами можно двумя способами. Просмотрите карту непосредственно из виртуальной машины или просмотрите карту из Azure Monitor, чтобы просмотреть компоненты по группам виртуальных машин. Эта статья поможет вам понять эти два метода просмотра и использовать функцию Map. 

Дополнительные сведения о настройке VM Insights см. в разделе [Включение АНАЛИТИКИ виртуальной](./vminsights-enable-overview.md)машины.

## <a name="sign-in-to-azure"></a>Вход в Azure
Войдите на [портал Azure](https://portal.azure.com).

## <a name="introduction-to-the-map-experience"></a>Введение в интерфейс Map
Прежде чем углубляться в работу с картой, необходимо понять, как она представляет и визуализирует информацию. Независимо от того, выбрана ли функция Map непосредственно с виртуальной машины или Azure Monitor, функция Map обеспечивает единообразную работу. Единственное отличие состоит в том, что из Azure Monitor на одной карте показаны все элементы многоуровневого приложения или кластера.

Функция Map визуализирует зависимости виртуальных машин путем обнаружения выполняющихся процессов, которые имеют следующие возможности. 

- Активные сетевые подключения между серверами.
- Задержка входящего и исходящего подключения.
- Порты в любой архитектуре, подключенной по протоколу TCP, за указанный диапазон времени.  
 
Разверните виртуальную машину, чтобы отобразить сведения о процессе и только те процессы, которые обмениваются данными с виртуальной машиной. Группа клиентов показывает количество клиентов переднего плана, подключающихся к виртуальной машине. Группы портов сервера показывают количество внутренних серверов, к которым подключается виртуальная машина. Разверните группу портов сервера, чтобы просмотреть подробный список серверов, которые подключаются через этот порт.  

При выборе виртуальной машины на панели **свойств** справа отображаются свойства виртуальной машины. Свойства включают сведения о системе, сообщаемые операционной системой, свойства виртуальной машины Azure и кольцевую диаграмму, в которой обобщены обнаруженные подключения. 

![Область свойств](./media/vminsights-maps/properties-pane-01.png)

В правой части панели выберите пункт **события журнала** , чтобы отобразить список данных, ОТПРАВЛЕННЫХ виртуальной машиной Azure Monitor. Эти данные доступны для запросов.  Выберите любой тип записи, чтобы открыть страницу **журналы** , где отображаются результаты для этого типа записи. Вы также видите предварительно настроенный запрос, который фильтруется по виртуальной машине.  

![Область событий журнала](./media/vminsights-maps/properties-pane-logs-01.png)

Закройте страницу **журналы** и вернитесь на панель **свойств** . Для просмотра предупреждений о работоспособности виртуальной машины выберите **оповещения** . Функция Map интегрируется с оповещениями Azure для отображения оповещений для выбранного сервера в выбранном диапазоне времени. Сервер отображает значок для текущих оповещений, а в области **оповещения машины** — список оповещений. 

![Панель "оповещения"](./media/vminsights-maps/properties-pane-alerts-01.png)

Чтобы функция Map отображала соответствующие оповещения, создайте правило генерации оповещений, которое применяется к определенному компьютеру.

- Включите предложение для группировки предупреждений по компьютерам (например, **с интервалом в 1 минуту**).
- Создать оповещение для метрики.

Дополнительные сведения об оповещениях Azure и создании правил оповещений см. [в разделе Объединенные оповещения в Azure Monitor](../alerts/alerts-overview.md).

В правом верхнем углу параметра **Условные обозначения** описываются символы и роли на карте. Чтобы более подробно рассмотреть карту и переместить ее, используйте элементы управления масштабом в правом нижнем углу. Можно задать уровень масштаба и вписать карту в размер страницы.  

## <a name="connection-metrics"></a>Метрики подключения
На панели **подключения** отображаются стандартные метрики для выбранного подключения из виртуальной машины через TCP-порт. Среди них имеются метрики времени отклика, количества запросов в минуту, пропускной способности трафика и каналов.  

![Диаграммы сетевого подключения в области подключения](./media/vminsights-maps/map-group-network-conn-pane-01.png)  

### <a name="failed-connections"></a>Неудачные подключения
На карте отображаются неудачные подключения для процессов и компьютеров. Пунктирная красная линия означает, что клиентская система не может связаться с процессом или портом. Для систем, использующих агент зависимостей, агент сообщает о неудачных попытках подключения. Функция Map отслеживает процесс, отслеживая TCP-сокеты, которые не могут установить соединение. Эта ошибка может быть вызвана брандмауэром, неудачной конфигурацией на клиенте или сервере или недоступной удаленной службой.

![Сбой подключения на карте](./media/vminsights-maps/map-group-failed-connection-01.png)

Основные сведения о неудачных подключениях могут помочь при устранении неполадок, проверке миграции, анализе безопасности и понимании общей архитектуры службы. Неудачные соединения иногда являются безвредными, но часто указывают на проблему. Подключения могут завершиться ошибкой, например, когда среда отработки отказа внезапно становится недоступной или когда два уровня приложения не могут взаимодействовать друг с другом после миграции в облако.

### <a name="client-groups"></a>Группы клиентов
На карте клиентские группы представляют клиентские компьютеры, подключающиеся к сопоставленному компьютеру. Одна группа клиентов представляет клиентов для отдельного процесса или компьютера.

![Группа клиентов на карте](./media/vminsights-maps/map-group-client-groups-01.png)

Чтобы просмотреть отслеживаемые клиенты и IP-адреса систем в группе клиентов, выберите группу. Содержимое группы отображается ниже.  

![Список IP-адресов в сопоставлении группы клиентов](./media/vminsights-maps/map-group-client-group-iplist-01.png)

Если группа включает отслеживаемые и Неотслеживаемые клиенты, можно выбрать соответствующий раздел кольцевой диаграммы группы для фильтрации клиентов.

### <a name="server-port-groups"></a>Серверы — группы портов
Группы портов сервера представляют порты на серверах с входящими подключениями из сопоставленного компьютера. Группа содержит порт сервера и количество серверов, которые имеют подключения к этому порту. Выберите группу, чтобы просмотреть отдельные серверы и подключения. 

![Группа портов сервера на карте](./media/vminsights-maps/map-group-server-port-groups-01.png)  

Если группа содержит отслеживаемые и Неотслеживаемые серверы, можно выбрать соответствующий раздел кольцевой диаграммы группы, чтобы отфильтровать серверы.

## <a name="view-a-map-from-a-vm"></a>Просмотр карт из виртуальной машины 

Чтобы получить доступ к VM Insights непосредственно с виртуальной машины, сделайте следующее:

1. На портале Azure выберите **Виртуальные машины**. 
2. В списке выберите виртуальную машину. В разделе **мониторинг** выберите **аналитика**.  
3. Откройте вкладку **Схема**.

Эта схема визуализирует зависимости виртуальной машины, обнаруживая выполняющиеся группы процессов и процессы с активными сетевыми подключениями за указанный диапазон времени.  

По умолчанию на схеме показаны последние 30 минут. Если вы хотите увидеть, как просмотрелись зависимости в прошлом, можно запросить исторические диапазоны времени вплоть до одного часа. Чтобы выполнить запрос, используйте селектор **TimeRange** в левом верхнем углу. Вы можете выполнить запрос, например во время инцидента, или просмотреть состояние перед изменением.  

![Снимок экрана вкладки "Map" (схема) в разделе "аналитика мониторинга" портал Azure показана схема зависимостей между виртуальными машинами.](./media/vminsights-maps/map-direct-vm-01.png)

## <a name="view-a-map-from-a-virtual-machine-scale-set"></a>Просмотр схемы из масштабируемого набора виртуальных машин

Чтобы получить доступ к VM Insights непосредственно из масштабируемого набора виртуальных машин, выполните следующие действия.

1. На портале Azure выберите **Масштабируемые наборы виртуальных машин**.
2. В списке выберите виртуальную машину. Затем в разделе **мониторинг** выберите **аналитика**.  
3. Откройте вкладку **Схема**.

На карте все экземпляры в масштабируемом наборе визуализируются как узел группы вместе с зависимостями группы. В развернутом узле перечислены экземпляры в масштабируемом наборе. Эти экземпляры можно прокручивать по 10 за раз. 

Чтобы загрузить карту для конкретного экземпляра, сначала выберите этот экземпляр на карте. Затем нажмите кнопку **с многоточием** (...) справа и выберите **загрузить карту сервера**. На появившейся карте отображаются группы процессов и процессы с активными сетевыми подключениями за указанный диапазон времени. 

По умолчанию на схеме показаны последние 30 минут. Если вы хотите увидеть, как просмотрелись зависимости в прошлом, можно запросить исторические диапазоны времени вплоть до одного часа. Чтобы выполнить запрос, используйте селектор **TimeRange** . Вы можете выполнить запрос, например во время инцидента, или просмотреть состояние перед изменением.

![Снимок экрана вкладки "Map" (схема) в разделе "аналитика мониторинга" портал Azure показана схема зависимостей между масштабируемыми наборами виртуальных машин.](./media/vminsights-maps/map-direct-vmss-01.png)

>[!NOTE]
>Вы также можете получить доступ к карте для конкретного экземпляра из представления **экземпляров** для масштабируемого набора виртуальных машин. В разделе **Параметры** перейдите к элементу **Instances**  >  **Insights**.

## <a name="view-a-map-from-azure-monitor"></a>Просмотр схемы с Azure Monitor

В Azure Monitor функция Map предоставляет глобальное представление о виртуальных машинах и их зависимостях. Для доступа к функции Map в Azure Monitor:

1. На портале Azure выберите **Монитор**. 
2. В разделе **аналитика** выберите **виртуальные машины**.
3. Откройте вкладку **Схема**.

   ![Azure Monitor обзор схемы нескольких виртуальных машин](./media/vminsights-maps/map-multivm-azure-monitor-01.png)

Выберите рабочую область с помощью селектора **рабочей области** в верхней части страницы. Если у вас есть несколько Log Analytics рабочей области, выберите рабочую область, которая включена с решением и в которой есть виртуальные машины, которые подотчетны. 

Селектор **групп** Возвращает подписки, группы ресурсов, [группы компьютеров](../logs/computer-groups.md)и масштабируемые наборы виртуальных машин, связанные с выбранной рабочей областью. Выбранные элементы применяются только к функции Map и не переносятся на производительность или работоспособность.

По умолчанию на схеме показаны последние 30 минут. Если вы хотите увидеть, как просмотрелись зависимости в прошлом, можно запросить исторические диапазоны времени вплоть до одного часа. Чтобы выполнить запрос, используйте селектор **TimeRange** . Вы можете выполнить запрос, например во время инцидента, или просмотреть состояние перед изменением.  

## <a name="next-steps"></a>Дальнейшие действия

Чтобы определить узкие места, проверить производительность и получить общее представление об использовании виртуальных машин, см. статью [Просмотр состояния производительности для VM Insights](vminsights-performance.md).
