---
title: Общие сведения о включении VM Insights
description: Узнайте, как развернуть и настроить VM Insights. Ознакомьтесь с требованиями к системе.
ms.topic: conceptual
author: bwren
ms.author: bwren
ms.date: 12/22/2020
ms.custom: references_regions
ms.openlocfilehash: bb2e12082b80c397eec27409b1177379a92fdd7d
ms.sourcegitcommit: 772eb9c6684dd4864e0ba507945a83e48b8c16f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/20/2021
ms.locfileid: "102634164"
---
# <a name="enable-vm-insights-overview"></a>Общие сведения о включении VM Insights

В этой статье содержатся общие сведения о параметрах, доступных для включения аналитики виртуальной машины для мониторинга работоспособности и производительности следующих элементов:

- Виртуальные машины Azure 
- Масштабируемые наборы виртуальных машин Azure
- Гибридные виртуальные машины, подключенные к службе "Дуга Azure"
- Локальные виртуальные машины
- Виртуальные машины, размещенные в другой облачной среде.  

Чтобы настроить VM Insights, сделайте следующее:

* Включите одну виртуальную машину Azure, масштабируемый набор виртуальных машин Azure или машину Arc Azure, выбрав **аналитику** непосредственно в меню портал Azure.
* Включите несколько виртуальных машин Azure, виртуальных машин Azure или машин Arc Azure с помощью политики Azure. Этот метод гарантирует, что на существующих и новых виртуальных машинах и масштабируемых наборах необходимые зависимости установлены и настроены правильно. Сообщается о несоответствующих виртуальных машинах и масштабируемых наборах, поэтому можно решить, следует ли их включить и исправить.
* Используйте PowerShell для включения нескольких виртуальных машин Azure, виртуальных машин Azure Arc, масштабируемых наборов виртуальных машин Azure или машин Arc Azure в указанной подписке или группе ресурсов.
* Включите аналитику виртуальной машины для мониторинга виртуальных машин или физических компьютеров, размещенных в корпоративной сети или в другой облачной среде.

## <a name="supported-machines"></a>Поддерживаемые компьютеры
VM Insights поддерживает следующие компьютеры:

- Виртуальная машина Azure
- Масштабируемый набор виртуальных машин Azure
- Гибридная виртуальная машина, подключенная к службе "Дуга Azure"


## <a name="supported-azure-arc-machines"></a>Поддерживаемые машины Azure Arc
Служба "аналитика Azure" доступна для серверов с поддержкой ARC в тех регионах, где доступно расширение ARC. Необходимо запустить агент Arc версии 0,9 или более поздней.

| Подключенный источник | Поддерживается | Описание |
|:--|:--|:--|
| Агенты Windows | Да | Вместе с [агентом log Analytics для Windows](../agents/log-analytics-agent.md)агентам Windows требуется агент зависимостей. Дополнительные сведения см. в разделе [Поддерживаемые операционные системы](../agents/agents-overview.md#supported-operating-systems). |
| Агенты Linux | Да | Вместе с [агентом log Analytics для Linux](../agents/log-analytics-agent.md)агентам Linux требуется агент зависимостей. Дополнительные сведения см. в разделе [Поддерживаемые операционные системы](#supported-operating-systems). |
| Группа управления System Center Operations Manager | Нет | |

## <a name="supported-operating-systems"></a>Поддерживаемые операционные системы

VM Insights поддерживает любую операционную систему, поддерживающую агент Log Analytics и агент зависимостей. Полный список см. в разделе [Общие сведения об агентах Azure Monitor ](../agents/agents-overview.md#supported-operating-systems) .

> [!IMPORTANT]
> Функция работоспособности гостевых систем VM Insights имеет более ограниченную поддержку операционной системы, пока она находится в общедоступной предварительной версии. Подробный список см. в разделе [Включение работоспособности гостевых систем для VM Insights (Предварительная версия)](../vm/vminsights-health-enable.md) .

### <a name="linux-considerations"></a>Рекомендации по Linux
См. следующий список вопросов, касающихся поддержки агента зависимостей, который поддерживает VM Insights, в Linux.

- Поддерживаются только версии ядра по умолчанию и SMP для Linux.
- Нестандартные версии ядра, такие как расширение физических адресов (PAE) и Xen, не поддерживаются ни в одном дистрибутиве Linux. Например, система со строкой версии *2.6.16.21-0.8-xen* не поддерживается.
- Пользовательские ядра, включая перекомпиляции стандартных ядер, не поддерживаются.
- Для Debian дистрибутивов, отличных от версии 9,4, функция Map не поддерживается, и функция производительности доступна только в меню Azure Monitor. Она недоступна непосредственно из левой панели виртуальной машины Azure.
- Поддерживается ядро Центосплус.

Ядро Linux должно быть исправлено для уязвимостей устранением рисков Spectre и Meltdown. Дополнительные сведения см. в поставщике дистрибутива Linux. Выполните следующую команду, чтобы проверить доступность, если устранением рисков Spectre/Meltdown был уменьшен.

```
$ grep . /sys/devices/system/cpu/vulnerabilities/*
```

Выходные данные для этой команды будут выглядеть примерно так, как показано ниже, и указать, является ли компьютер уязвимым для любой из проблем. Если эти файлы отсутствуют, компьютер будет исправлен.

```
/sys/devices/system/cpu/vulnerabilities/meltdown:Mitigation: PTI
/sys/devices/system/cpu/vulnerabilities/spectre_v1:Vulnerable
/sys/devices/system/cpu/vulnerabilities/spectre_v2:Vulnerable: Minimal generic ASM retpoline
```


## <a name="log-analytics-workspace"></a>Рабочая область Log Analytics
Для работы VM Insights требуется рабочая область Log Analytics. Дополнительные сведения и требования к этой рабочей области см. в разделе [Настройка рабочей области log Analytics для VM Insights](vminsights-configure-workspace.md) .
## <a name="agents"></a>Агенты
Для наблюдения за ВИРТУАЛЬНОЙ машиной необходимо установить следующие два агента на каждой виртуальной машине или в масштабируемом наборе виртуальных машин. Чтобы подключить ресурс, установите эти агенты и подключите их к рабочей области.  Требования к сети для этих агентов см. в разделе [требования к сети](../agents/log-analytics-agent.md#network-requirements) .

- [Агент log Analytics](../agents/log-analytics-agent.md). Сбор данных о событиях и производительности из масштабируемого набора виртуальных машин и их доставка в рабочую область Log Analytics. Методы развертывания для агента Log Analytics в ресурсах Azure используют расширение виртуальной машины для [Windows](../../virtual-machines/extensions/oms-windows.md) и [Linux](../../virtual-machines/extensions/oms-linux.md).
- Агент зависимостей. Собирает обнаруженные данные о процессах, выполняемых на виртуальной машине, и зависимостях внешних процессов, которые используются [функцией Map в службе "аналитика виртуальных машин](../vm/vminsights-maps.md)". Агент зависимостей использует агент Log Analytics для доставки данных в Azure Monitor. Методы развертывания для агента зависимостей в ресурсах Azure используют расширение виртуальной машины для [Windows](../../virtual-machines/extensions/agent-dependency-windows.md) и [Linux](../../virtual-machines/extensions/agent-dependency-linux.md).

> [!NOTE]
> Агент Log Analytics — это тот же агент, который используется System Center Operations Manager. VM Insights может отслеживать агенты, которые также отслеживаются, Operations Manager, если они подключены напрямую, и вы устанавливаете на них агент зависимостей. Агенты, подключенные к Azure Monitor через [группу управления](../tform/../agents/om-agents.md) , не могут отслеживаться с помощью VM Insights.

Ниже приведены несколько методов развертывания этих агентов. 

| Метод | Описание |
|:---|:---|
| [Портал Azure](../vm/vminsights-enable-portal.md) | Установите оба агента на одной виртуальной машине, масштабируемом наборе виртуальных машин или гибридных виртуальных машинах, подключенных к службе "Дуга Azure". |
| [Шаблоны Resource Manager](../vm/vminsights-enable-resource-manager.md) | Установите оба агента с помощью любого из поддерживаемых методов, чтобы развернуть шаблон диспетчер ресурсов, включая CLI и PowerShell. |
| [Политика Azure](../vm/vminsights-enable-policy.md) | Назначение инициативы политики Azure для автоматической установки агентов при создании виртуальной машины или масштабируемого набора виртуальных машин. |
| [Установка вручную](../vm/vminsights-enable-hybrid.md) | Установите агенты в гостевой операционной системе на компьютерах, размещенных за пределами Azure, включая в вашем центре обработки данных или в других облачных средах. |


## <a name="network-requirements"></a>Требования к сети

- Требования к сети для агента Log Analytics см. в разделе [требования к сети](../agents/log-analytics-agent.md#network-requirements) .
- Агенту зависимостей требуется подключение от виртуальной машины к адресу 169.254.169.254. Это конечная точка службы метаданных Azure. Убедитесь, что параметры брандмауэра разрешают подключения к этой конечной точке.


## <a name="management-packs"></a>Пакеты управления
Если для виртуальной машины настроена Log Analytics Рабочая область, то два пакета управления перенаправляются на все компьютеры Windows, подключенные к этой рабочей области. Пакеты управления называются *Microsoft. IntelligencePacks. ApplicationDependencyMonitor* и *Microsoft. IntelligencePacks. вминсигхтс* и записываются в *%ProgramFiles%\Microsoft Monitoring Agent\Agent\Health Service state\management Packs Packs*. 

Пакет управления *ApplicationDependencyMonitor* использует источник данных **% Program Files%\Microsoft Monitoring Agent\Agent\Health Service State\Resources \<AutoGeneratedID>\Microsoft.EnterpriseManagement.Advisor.ApplicationDependencyMonitorDataSource.dll*. Пакет управления *вминсигхтс* использует источник данных *% Program Files%\Microsoft Monitoring Agent\Agent\Health Service State\Resources \<AutoGeneratedID> \ Microsoft.VirtualMachineMonitoringModule.dll*.

## <a name="diagnostic-and-usage-data"></a>Данные диагностики и использования

Корпорация Майкрософт автоматически собирает данные об использовании и производительности при работе службы Azure Monitor. Корпорация Майкрософт использует эти данные для повышения качества, безопасности и целостности службы. 

Чтобы обеспечить точную и эффективную работу по устранению неполадок, функция Map включает данные о конфигурации программного обеспечения. Данные содержат такие сведения, как операционная система, версия, IP-адрес, DNS-имя и имя рабочей станции. Корпорация Майкрософт не собирает сведения об именах, адресах и другую контактную информацию.

Дополнительные сведения о сборе и использовании данных см. в [заявлении о конфиденциальности служб Microsoft Online Services](https://go.microsoft.com/fwlink/?LinkId=512132).

[!INCLUDE [GDPR-related guidance](../../../includes/gdpr-dsr-and-stp-note.md)]

## <a name="next-steps"></a>Следующие шаги

Сведения об использовании функции наблюдения за производительностью см. в статье [Просмотр производительности VM Insights](../vm/vminsights-performance.md). Чтобы просмотреть зависимости обнаруженных приложений, см. статью [Просмотр схемы VM Insights](../vm/vminsights-maps.md).
