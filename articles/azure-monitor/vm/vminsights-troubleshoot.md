---
title: Устранение неполадок с VM Insights
description: Устранение неполадок при установке VM Insights.
ms.topic: conceptual
author: bwren
ms.author: bwren
ms.date: 03/15/2021
ms.custom: references_regions
ms.openlocfilehash: 59b4f38efde2416687702647031d2b37553ff8ed
ms.sourcegitcommit: 4bda786435578ec7d6d94c72ca8642ce47ac628a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/16/2021
ms.locfileid: "103555653"
---
# <a name="troubleshoot-vm-insights"></a>Устранение неполадок с VM Insights
В этой статье содержатся сведения об устранении неполадок, связанных с включением или использованием VM Insights.

## <a name="cannot-enable-vm-insights-on-a-machine"></a>Не удается включить аналитику ВИРТУАЛЬНОЙ машины на компьютере
При подключении виртуальной машины Azure из портал Azure выполняются следующие действия.

- Если выбран этот параметр, создается рабочая область Log Analytics по умолчанию.
- Агент Log Analytics устанавливается на виртуальных машинах Azure с помощью расширения виртуальной машины, если агент уже установлен.
- Агент зависимостей устанавливается на виртуальных машинах Azure с помощью расширения, если это необходимо.
  
Во время процесса адаптации выполняется проверка каждого из этих шагов и отображается состояние уведомления на портале. Настройка рабочей области и установка агента обычно занимает 5–10 минут. Чтобы данные стали доступны для просмотра на портале, потребуется еще 5 – 10 минут.

Если появится сообщение о том, что виртуальная машина должна быть подключена после выполнения процесса адаптации, подождите до 30 минут для завершения процесса. Если проблема не исчезнет, см. Возможные причины в следующих разделах.

### <a name="is-the-virtual-machine-running"></a>Виртуальная машина работает?
 Если виртуальная машина была отключена в течение определенного времени, в настоящее время отключена или была включена только недавно, то данные не будут отображаться на несколько бит, пока данные не поступают.

### <a name="is-the-operating-system-supported"></a>Поддерживается ли операционная система?
Если операционная система отсутствует в списке [поддерживаемых операционных систем](vminsights-enable-overview.md#supported-operating-systems) , то расширение не будет установлено, и появится сообщение о том, что ожидается поступление данных.

### <a name="did-the-extension-install-properly"></a>Правильно ли установлено расширение?
Если вы по-прежнему видите сообщение о том, что виртуальная машина должна быть подключена, это может означать, что одно или оба расширения не удалось правильно установить. Проверьте страницу **расширения** для виртуальной машины в портал Azure, чтобы убедиться в том, что указаны следующие расширения.

| Операционная система | Агенты | 
|:---|:---|
| Windows | MicrosoftMonitoringAgent<br>Microsoft.Azure.Monitoring.DependencyAgent |
| Linux | OMSAgentForLinux<br>депенденциажентфорлинукс |

Если в списке установленных расширений не отображаются оба расширения операционной системы, их необходимо установить. Если расширения перечислены, но их состояние не отображается как *Подготовка*, то расширение следует удалить и переустановить.

### <a name="do-you-have-connectivity-issues"></a>У вас возникли проблемы с подключением?
Для компьютеров под Windows можно использовать средство  *тестклаудконнективити* для обнаружения проблем с подключением. Это средство устанавливается по умолчанию с агентом в папке *%Системрут%\програм Files\Microsoft Monitoring agent\agent.*. Запустите средство из командной строки с повышенными привилегиями. Он возвратит результаты и выделит, где тест не пройден. 

![Средство Тестклаудконнективити](media/vminsights-troubleshoot/test-cloud-connectivity.png)

### <a name="more-agent-troubleshooting"></a>Дополнительные сведения об устранении неполадок агента

Чтобы устранить неполадки с агентом Log Analytics, см. следующие статьи:

- [How to troubleshoot issues with the Log Analytics agent for Windows](../agents/agent-windows-troubleshoot.md) (Устранение проблем с агентом Log Analytics для Windows)
- [Устранение неполадок с агентом Log Analytics для Linux](../agents/agent-linux-troubleshoot.md)

## <a name="performance-view-has-no-data"></a>Представление производительности не содержит данных
Если агенты правильно установлены, но в представлении "производительность" не отображаются данные, см. сведения о возможных причинах в следующих разделах.

### <a name="has-your-log-analytics-workspace-reached-its-data-limit"></a>Достигнут ли объем данных рабочей области Log Analytics?
Проверьте [резервирования емкости и цены на прием данных](https://azure.microsoft.com/pricing/details/monitor/).

### <a name="is-your-virtual-machine-sending-log-and-performance-data-to-azure-monitor-logs"></a>Отправляет ли виртуальная машина данные журнала и производительности в журналы Azure Monitor?

Откройте Log Analytics из **журналов** в меню Azure Monitor в портал Azure. Выполните следующий запрос для компьютера:

```kuso
Usage 
| where Computer == "my-computer" 
| summarize sum(Quantity), any(QuantityUnit) by DataType
```

Если данные не отображаются, возможно, у вас возникнут проблемы с агентом. Сведения об устранении неполадок агента см. в разделе выше.

## <a name="virtual-machine-doesnt-appear-in-map-view"></a>Виртуальная машина не отображается в представлении карт

### <a name="is-the-dependency-agent-installed"></a>Установлен ли агент зависимостей?
 Используйте сведения в разделах выше, чтобы определить, правильно ли установлен и работает агент зависимостей.

### <a name="are-you-on-the-log-analytics-free-tier"></a>Вы на Log Analytics уровне "бесплатный"?
[Уровень log Analytics уровня "бесплатный](https://azure.microsoft.com/pricing/details/monitor/) " — это план с устаревшим тарифом, позволяющий до пяти уникальных сопоставление службных компьютеров. Все последующие компьютеры не будут показываться в решении "Сопоставление служб", даже если предыдущие пять больше не отправляют данные.

### <a name="is-your-virtual-machine-sending-log-and-performance-data-to-azure-monitor-logs"></a>Отправляет ли виртуальная машина данные журнала и производительности в журналы Azure Monitor?
Используйте запрос журнала в представлении " [производительность](#performance-view-has-no-data) ", чтобы определить, собираются ли данные для виртуальной машины. Если сбор данных не выполняется, используйте средство Тестклаудконнективити, описанное выше, чтобы определить, есть ли проблемы с подключением.


## <a name="virtual-machine-appears-in-map-view-but-has-missing-data"></a>Виртуальная машина отображается в представлении Map, но в ней отсутствуют данные
Если виртуальная машина находится в представлении Map, агент зависимостей установлен и выполняется, но драйвер ядра не был загружен. Проверьте файл журнала в следующих расположениях:

| Операционная система | Журнал | 
|:---|:---|
| Windows | C:\Program Files\Microsoft dependency Ажент\логс\враппер.лог |
| Linux | /вар/опт/микрософт/депенденци-ажент/лог/сервице.лог |

В последних строках файла должно быть указано, почему не удалось загрузить ядро. Например, если вы обновили ядро, оно может не поддерживаться в Linux.
## <a name="next-steps"></a>Дальнейшие действия

- Дополнительные сведения о подключении агентов VM Insights см. в разделе [Включение общих сведений о виртуальной машине](vminsights-enable-overview.md).
