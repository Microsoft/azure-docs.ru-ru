---
title: Начало работы с автомасштабированием в Azure
description: Узнайте, как масштабировать веб-приложение ресурсов, облачную службу, виртуальную машину или масштабируемый набор виртуальных машин в Azure.
ms.topic: conceptual
ms.date: 07/07/2017
ms.subservice: autoscale
ms.openlocfilehash: 6ac3ebb4cf007141967786f51243c741a6045c83
ms.sourcegitcommit: e559daa1f7115d703bfa1b87da1cf267bf6ae9e8
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/17/2021
ms.locfileid: "100623850"
---
# <a name="get-started-with-autoscale-in-azure"></a>Начало работы с автомасштабированием в Azure
В этой статье описывается, как настроить автомасштабирование для ресурса на портале Microsoft Azure.

Azure Monitor Автомасштабирование применяется только к [масштабируемым наборам виртуальных машин](https://azure.microsoft.com/services/virtual-machine-scale-sets/), [облачным службам](https://azure.microsoft.com/services/cloud-services/), [веб-приложениям](https://azure.microsoft.com/services/app-service/web/)и [службам управления API](../../api-management/api-management-key-concepts.md).

## <a name="discover-the-autoscale-settings-in-your-subscription"></a>Обнаружение параметров автомасштабирования в подписках

> [!VIDEO https://www.microsoft.com/en-us/videoplayer/embed/RE4u7ts]

Azure Monitor дает возможность обнаружить все ресурсы, для которых можно применить автомасштабирование. Для этой цели вам нужно выполнить следующие действия.

1. Откройте [портал Azure.][1]
1. Щелкните значок Azure на левой панели.
  ![Открытие Azure Monitor][2]
1. Выберите раздел **Автомасштабирование**, чтобы просмотреть все ресурсы, для которых применимо автомасштабирование, и текущее состояние этой настройки для них.
  ![Открытие раздела "Автомасштабирование" в Azure Monitor][3]

Панель фильтрации в верхней части страницы позволяет сузить список до определенной группы ресурсов, отдельных типов ресурсов или одного конкретного ресурса.

Для каждого ресурса вы увидите здесь текущее количество экземпляров и состояние автомасштабирования. Состояние автомасштабирования может принимать одно из перечисленных ниже значений.

- **Не настроено**. Автомасштабирование еще не настроено для этого ресурса.
- **Включено**. Автомасштабирование включено для этого ресурса.
- **Отключено**. Автомасштабирование отключено для этого ресурса.

## <a name="create-your-first-autoscale-setting"></a>Создание параметра автомасштабирования

Теперь выполним простые пошаговые инструкции для создания параметра автомасштабирования.

1. В Azure Monitor откройте колонку **Автомасштабирование** и выберите ресурс, который нужно масштабировать. (В примере ниже используется план службы приложений, связанный с веб-приложением. Вы можете [за пять минут создать первое веб-приложение ASP.NET в Azure][4]).
1. Как видите, текущее количество экземпляров имеет значение 1. Щелкните **Включить автомасштабирование**.
  ![Параметр масштабирования для нового веб-приложения][5]
1. Укажите имя для параметра масштабирования и щелкните **Добавить правило**. Параметры правила масштабирования откроются в виде контекстной области справа. По умолчанию устанавливается следующее правило: количество экземпляров увеличивается на 1, когда загрузка ЦП для ресурса превышает уровень 70 %. Не изменяйте эти значения по умолчанию, а просто нажмите **Добавить**.
  ![Создание параметра масштабирования для веб-приложения][6]
1. Итак, вы создали первое правило масштабирования. В этом же интерфейсе вы увидите некоторые рекомендация по настройке, например: "Рекомендуется настроить не меньше одного правила увеличения масштаба". Для этого:

    а. Щелкните **Добавить правило**.

    b. Для параметра **Оператор** установите значение **Меньше, чем**.

    c. Для параметра **Пороговое значение** задайте значение **20**.

    d. Для параметра **Операция** установите значение **Уменьшить счетчик на**.

   Теперь у вас есть параметр масштабирования, который изменяет масштаб в зависимости от показателей загрузки ЦП.
   ![Масштабирование на основе загрузки ЦП][8]
1. Выберите команду **Сохранить**.

Поздравляем! Вы успешно создали первый параметр масштабирования, который будет автомасштабировать веб-приложение, исходя из загрузки ЦП.

> [!NOTE]
> Эти действия можно применить для настройки масштабируемого набора виртуальных машин или ролей облачной службы.

## <a name="other-considerations"></a>Другие замечания
### <a name="scale-based-on-a-schedule"></a>Масштабирование на основе расписания
Помимо загрузки ЦП, в параметрах автомасштабирования можно учитывать определенные дни недели.

1. Щелкните **Add a scale condition** (Добавить условие масштабирования).
1. Настройка режима масштабирования и правил выполняется так же, как и для условий по умолчанию.
1. Выберите **Повторять в определенные дни**, чтобы настроить расписание.
1. Выберите дни и время для начала и окончания периода, в который будет применяться условие масштабирования.

![Условие масштабирования на основе расписания][9]
### <a name="scale-differently-on-specific-dates"></a>Масштабирование в определенные даты
Помимо загрузки ЦП, в параметрах автомасштабирования можно учитывать определенные даты.

1. Щелкните **Add a scale condition** (Добавить условие масштабирования).
1. Настройка режима масштабирования и правил выполняется так же, как и для условий по умолчанию.
1. Выберите **Укажите даты начала и окончания**, чтобы настроить расписание.
1. Выберите даты для начала и окончания периода, в который будет применяться условие масштабирования.

![Условие масштабирования на основе дат][10]

### <a name="view-the-scale-history-of-your-resource"></a>Просмотр журнала масштабирования ресурса
Каждый раз, когда масштабируется ресурс, в журнале действий регистрируется событие. Вы можете просмотреть журнал масштабирования ресурса за последние 24 часа, открыв вкладку **Журнал запусков**.

![Журнал выполнения][11]

Если вы хотите просмотреть полный журнал масштабирования (до 90 дней), выберите действие **Щелкните здесь, чтобы просмотреть дополнительные сведения**. Откроется журнал действий автомасштабирования, в котором уже выбраны нужный ресурс и категория.

### <a name="view-the-scale-definition-of-your-resource"></a>Просмотр определения масштабирования для ресурса
Автомасштабирование считается ресурсом Azure Resource Manager. Определение масштабирования можно просмотреть в формате JSON. Для этого откройте вкладку **JSON**.

![Определение масштабирования][12]

При необходимости можно внести изменения в JSON напрямую. Эти изменения будут применены, как только вы их сохраните.

### <a name="disable-autoscale-and-manually-scale-your-instances"></a>Отключение автомасштабирования и масштабирование экземпляров вручную
Иногда необходимо отключить действующий параметр масштабирования и масштабировать ресурс вручную.

Для этого нажмите **Отключить автомасштабирование** в верхней части страницы.
![Отключение автомасштабирования][13]

> [!NOTE]
> Это действие отключает настроенную конфигурацию. Вы всегда можете вернуть прежний режим, включив автомасштабирование.

При отключенном автомасштабировании вы можете вручную задать нужное количество экземпляров.

![Настройка масштабирования вручную][14]

Автомасштабирование можно возобновить в любой момент, щелкнув здесь же **Включить автомасштабирование**, а затем — **Сохранить**.

## <a name="route-traffic-to-healthy-instances-app-service"></a>Маршрутизация трафика в работоспособные экземпляры (служба приложений)

<a id="health-check-path"></a>

Когда веб-приложение Azure масштабируется до нескольких экземпляров, служба приложений может выполнять проверки работоспособности экземпляров для маршрутизации трафика к работоспособным экземплярам. Дополнительные сведения см. в [этой статье о проверке работоспособности службы приложений](../../app-service/monitor-instances-health-check.md).

## <a name="moving-autoscale-to-a-different-region"></a>Перемещение автомасштабирования в другой регион
В этом разделе описывается, как переместить Автомасштабирование Azure в другой регион в той же подписке и группе ресурсов. Для перемещения параметров автомасштабирования можно использовать REST API.
### <a name="prerequisite"></a>Предварительное требование
1. Убедитесь, что подписка и группа ресурсов доступны, а сведения в исходном и целевом регионах идентичны.
1. Убедитесь, что Автомасштабирование Azure доступно в [регионе Azure, который вы хотите переместить](https://azure.microsoft.com/global-infrastructure/services/?products=monitor&regions=all).

### <a name="move"></a>Переместить
Используйте [REST API](/rest/api/monitor/autoscalesettings/createorupdate) , чтобы создать параметр автомасштабирования в новой среде. Параметр автомасштабирования, созданный в целевом регионе, будет копией параметра автомасштабирования в исходном регионе.

Не удается переместить [параметры диагностики](../platform/diagnostic-settings.md) , созданные в связи с параметром автомасштабирования в исходном регионе. После завершения создания параметров автопродажи необходимо будет повторно создать параметры диагностики в целевом регионе. 

### <a name="learn-more-about-moving-resources-across-azure-regions"></a>Дополнительные сведения о перемещении ресурсов в регионах Azure
Дополнительные сведения о перемещении ресурсов между регионами и аварийным восстановлением в Azure см. в статье [Перемещение ресурсов в новую группу ресурсов или подписку](../../azure-resource-manager/management/move-resource-group-and-subscription.md) .

## <a name="next-steps"></a>Дальнейшие шаги
- [Создайте оповещение журнала действий, чтобы отслеживать все операции системы автомасштабирования в подписке](https://github.com/Azure/azure-quickstart-templates/tree/master/monitor-autoscale-alert).
- [Создайте оповещение журнала действий, чтобы отслеживать все сбои автомасштабирования в подписке](https://github.com/Azure/azure-quickstart-templates/tree/master/monitor-autoscale-failed-alert).

<!--Reference-->
[1]:https://portal.azure.com
[2]: ./media/autoscale-get-started/azure-monitor-launch.png
[3]: ./media/autoscale-get-started/discover-autoscale-azure-monitor.png
[4]: ../../app-service/quickstart-dotnetcore.md
[5]: ./media/autoscale-get-started/scale-setting-new-web-app.png
[6]: ./media/autoscale-get-started/create-scale-setting-web-app.png
[7]: ./media/autoscale-get-started/scale-in-recommendation.png
[8]: ./media/autoscale-get-started/scale-based-on-cpu.png
[9]: ./media/autoscale-get-started/scale-condition-schedule.png
[10]: ./media/autoscale-get-started/scale-condition-dates.png
[11]: ./media/autoscale-get-started/scale-history.png
[12]: ./media/autoscale-get-started/scale-definition-json.png
[13]: ./media/autoscale-get-started/disable-autoscale.png
[14]: ./media/autoscale-get-started/set-manualscale.png
