---
title: Часто задаваемые вопросы об Azure Monitor | Документация Майкрософт
description: Найдите ответы на некоторые часто задаваемые вопросы о службе Azure Monitor.
services: azure-monitor
ms.topic: conceptual
author: bwren
ms.author: bwren
ms.date: 10/08/2020
ms.openlocfilehash: fa91644eab9d28ffb20de8ec8c0fe00488922b67
ms.sourcegitcommit: f0a3ee8ff77ee89f83b69bc30cb87caa80f1e724
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/26/2021
ms.locfileid: "105563384"
---
# <a name="azure-monitor-frequently-asked-questions"></a>Azure Monitor: вопросы и ответы

В этом списке вопросов и ответов от Майкрософт приведены часто задаваемые вопросы об Azure Monitor. Если у вас есть дополнительные вопросы, перейдите на [дискуссионный форум](/answers/questions/topics/single/24223.html) и опубликуйте свои вопросы. Если вопрос задается часто, мы добавим его в эту статью, чтобы его можно было найти быстро и легко.


## <a name="general"></a>Общие сведения

### <a name="what-is-azure-monitor"></a>Общие сведения об Azure Monitor
[Azure Monitor](overview.md) — это служба в Azure, которая выполняет мониторинг производительности и доступности приложений и служб в Azure, локальной среде или других облачных средах. Azure Monitor собирает данные из нескольких источников на общую платформу данных для последующего анализа тенденций и аномалий. Широкие возможности Azure Monitor помогают быстро выявлять критические ситуации, которые могут повлиять на работу приложения, и реагировать на них.

### <a name="whats-the-difference-between-azure-monitor-log-analytics-and-application-insights"></a>В чем разница между Azure Monitor, Log Analytics и Application Insights?
В сентябре 2018 года корпорация Майкрософт объединила Azure Monitor, Log Analytics и Application Insights в одну службу, которая способна выполнять эффективный сквозной мониторинг приложений и компонентов, от которых зависит их работа. Функциональные возможности Log Analytics и Application Insights не изменились, хотя часть из них была перенесена в Azure Monitor, чтобы лучше соответствовать своему новому спектру задач. Обработчик данных журналов и язык запросов Log Analytics теперь называются журналами Azure Monitor. См. статью [Обновление терминологии Azure Monitor](terminology.md).

### <a name="what-does-azure-monitor-cost"></a>Сколько стоит использование Azure Monitor?
Все автоматически включенные функции Azure Monitor, например сбор метрик и журналов действий, предоставляются бесплатно. Пользователь службы несет расходы, которые связаны с другими функциями, такими как запросы к журналам и оповещения. Подробные сведения о ценах см. на странице [Цены на Azure Monitor](https://azure.microsoft.com/pricing/details/monitor/).

### <a name="how-do-i-enable-azure-monitor"></a>Как можно включить Azure Monitor?
Azure Monitor включается в тот момент, когда вы создаете новую подписку Azure, то есть [журналы действий](./essentials/platform-logs-overview.md) и [метрики](essentials/data-platform-metrics.md) платформы собираются автоматически. Создайте [параметры диагностики](essentials/diagnostic-settings.md), чтобы собирать более подробные сведения о ресурсах Azure, а также добавьте [решения для мониторинга](insights/solutions.md) и [службы аналитики](./monitor-reference.md) для дополнительного анализа собранных данных определенных служб. 

### <a name="how-do-i-access-azure-monitor"></a>Как получить доступ к Azure Monitor?
Все данные и функции Azure Monitor доступны в меню **Монитор** на портале Azure. Раздел **Мониторинг** в меню для служб Azure предоставляет доступ к этим же средствам, но с фильтрацией данных по соответствующему ресурсу. Данные Azure Monitor также доступны для многих сценариев использования интерфейса командной строки, PowerShell и REST API.

### <a name="is-there-an-on-premises-version-of-azure-monitor"></a>Существует ли локальная версия Azure Monitor?
Нет. Azure Monitor — это масштабируемая облачная служба, которая обрабатывает и хранит большие объемы данных, но при этом она способна отслеживать ресурсы в локальной среде и других облаках.

### <a name="can-azure-monitor-monitor-on-premises-resources"></a>Может ли Azure Monitor отслеживать локальные ресурсы?
Да. Помимо сбора данных мониторинга из ресурсов Azure, Azure Monitor может собирать данные из виртуальных машин и приложений в других облаках и локальной среде. См. статью [Источники данных мониторинга для Azure Monitor](agents/data-sources.md).

### <a name="does-azure-monitor-integrate-with-system-center-operations-manager"></a>Поддерживает ли Azure Monitor интеграцию с System Center Operations Manager?
Вы можете подключить существующую группу управления System Center Operations Manager к Azure Monitor для сбора данных от агентов в журналы Azure Monitor. Это позволит использовать запросы к журналам и другие решения для анализа данных, собранных из агентов. Для существующих агентов System Center Operations Manager можно также настроить отправку данных непосредственно в Azure Monitor. См. статью [Подключение Operations Manager к Azure Monitor](agents/om-agents.md).

### <a name="what-ip-addresses-does-azure-monitor-use"></a>Какие IP-адреса использует Azure Monitor?
Список IP-адресов и портов, используемых агентами и другими внешними ресурсами для доступа к Azure Monitor, см. в статье [IP-адреса, используемые Application Insights и Log Analytics](app/ip-addresses.md). 

## <a name="monitoring-data"></a>Данные мониторинга

### <a name="where-does-azure-monitor-get-its-data"></a>Откуда Azure Monitor получает данные?
Azure Monitor собирает данные из разных источников, включая журналы и метрики платформы и ресурсов Azure, пользовательские приложения и агенты на виртуальных машинах. Другие службы, например Центр безопасности Azure и Наблюдатель за сетями, собирают данные в рабочую область Log Analytics, что позволяет их анализировать совместно с данными Azure Monitor. Используя REST API, вы также можете отправлять в Azure Monitor специализированные данные для журналов или метрик. См. статью [Источники данных мониторинга для Azure Monitor](agents/data-sources.md).

### <a name="what-data-is-collected-by-azure-monitor"></a>Какие данные собирает Azure Monitor? 
Azure Monitor собирает данные из различных источников в форматах [журналов](logs/data-platform-logs.md) и [метрик](essentials/data-platform-metrics.md). Каждый тип данных имеет свои преимущества и поддерживает определенный набор функций в Azure Monitor. Для каждой подписки Azure создается единая база данных метрик, а рабочие области Log Analytics вы можете создавать в любом количестве для раздельного сбора журналов в соответствии со своими потребностями. См. статью [Платформа данных Azure Monitor](data-platform.md).

### <a name="is-there-a-maximum-amount-of-data-that-i-can-collect-in-azure-monitor"></a>Существует ли ограничение на объем данных, которые можно собирать в Azure Monitor?
Количество собираемых данных метрик никак не ограничено, но эти данные хранятся не более 93 дней. См. раздел [Хранение метрик](essentials/data-platform-metrics.md#retention-of-metrics). Объем собираемых данных журналов никак не ограничен, но он может зависеть от ценовой категории, выбранной для рабочей области Log Analytics. См. сведения о [ценах](https://azure.microsoft.com/pricing/details/monitor/).

### <a name="how-do-i-access-data-collected-by-azure-monitor"></a>Как получить доступ к данным, собранным в Azure Monitor?
Службы аналитики и решения для мониторинга предоставляют собственные интерфейсы для работы с данными, хранящимися в Azure Monitor. Вы можете работать с данными журналов напрямую, используя запросы к журналам на языке KQL (Kusto Query Language). На портале Azure вы можете создавать и выполнять запросы, а также интерактивно анализировать данные с помощью Log Analytics. Метрики доступны на портале Azure через обозреватель метрик. См. статьи [Общие сведения о запросах к журналам в Azure Monitor](logs/log-query-overview.md) и [Начало работы с обозревателем метрик Azure](essentials/metrics-getting-started.md).

## <a name="solutions-and-insights"></a>Решения для мониторинга и службы аналитики

### <a name="what-is-an-insight-in-azure-monitor"></a>Что такое службы аналитики в Azure Monitor?
Службы аналитики предоставляют настраиваемые интерфейсы мониторинга для определенных служб Azure. Они используют те же метрики и журналы, что и другие функции в Azure Monitor, но могут собирать дополнительные данные и создавать уникальные интерфейсы на портале Azure. См. статью [Обзор служб аналитики в Azure Monitor](./monitor-reference.md).

Чтобы просмотреть службы аналитики на портале Azure, откройте раздел **Аналитика** в меню **Монитор** или в меню **Мониторинг** определенной службы.

### <a name="what-is-a-solution-in-azure-monitor"></a>Что такое решение для мониторинга в Azure Monitor?
Решения для мониторинга — это пакеты с наборами логики для мониторинга определенного приложения или службы на основе функций Azure Monitor. Они собирают данные журналов в Azure Monitor и могут выполнять запросы к журналам и отображать данные для анализа с помощью единого интерфейса на портале Azure. См. статью [Решения мониторинга в Azure Monitor](insights/solutions.md).

Чтобы открыть решения для мониторинга на портале Azure, щелкните **Дополнительно** в разделе **Аналитика** меню **Монитор**. Щелкните **Добавить**, чтобы добавить решение в рабочую область.

## <a name="logs"></a>Журналы

### <a name="whats-the-difference-between-azure-monitor-logs-and-azure-data-explorer"></a>В чем разница между журналами Azure Monitor и Azure Data Explorer?
Обозреватель данных Azure — это быстрая и высокомасштабируемая служба для изучения данных журналов и телеметрии. Журналы Azure Monitor созданы на основе Azure Data Explorer и так же используют язык запросов Kusto (KQL) с незначительными отличиями. См. статью [Различия в языках запросов журнала Azure Monitor](/azure/data-explorer/kusto/query/).

### <a name="how-do-i-retrieve-log-data"></a>Как извлечь данные журналов?
Все данные из рабочей области Log Analytics извлекаются с помощью запросов к журналам, написанных на языке запросов Kusto (KQL). Вы можете создавать собственные запросы или использовать решения для мониторинга и службы аналитики, в которых есть готовые запросы к журналам для определенного приложения или службы. См. статью [Общие сведения о запросах к журналам в Azure Monitor](logs/log-query-overview.md).

### <a name="can-i-delete-data-from-a-log-analytics-workspace"></a>Можно ли удалить данные из рабочей области Log Analytics?
Данные удаляются из рабочей области в соответствии с сроком [хранения](logs/manage-cost-storage.md#change-the-data-retention-period). Вы можете удалить определенные данные в соответствии с требованиями к конфиденциальности или соответствию. Дополнительные сведения см. [в разделе Экспорт и удаление закрытых данных](logs/personal-data-mgmt.md#how-to-export-and-delete-private-data) .

### <a name="is-log-analytics-storage-immutable"></a>Log Analytics ли неизменяемое хранилище?
Данные в хранилище базы данных нельзя изменить после приема, но их можно удалить с помощью [пути API *очистки* для удаления закрытых данных](./logs/personal-data-mgmt.md#delete). Хотя данные не могут быть изменены, для некоторых сертификатов требуется, чтобы данные сохранялись как неизменяемые и не могут быть изменены или удалены в хранилище. Неизменность данных может быть достигнута с помощью [экспорта данных](./logs/logs-data-export.md) в учетную запись хранения, настроенную как [неизменяемое хранилище](../storage/blobs/storage-blob-immutability-policies-manage.md).

### <a name="what-is-a-log-analytics-workspace"></a>Что такое рабочая область Log Analytics?
Все данные журналов, собранные Azure Monitor, сохраняются в рабочей области Log Analytics. Рабочая область по сути является контейнером, в который собираются данные журналов из разных источников. Вы можете использовать одну рабочую область Log Analytics для всех данных мониторинга или создать несколько, если в этом есть потребность. См. статью [Разработка развертывания журналов Azure Monitor](logs/design-logs-deployment.md).

### <a name="can-you-move-an-existing-log-analytics-workspace-to-another-azure-subscription"></a>Можно ли переместить существующую рабочую область Log Analytics в другую подписку Azure?
Вы можете перемещать рабочую область между группами ресурсов и подписками, но только в пределах одного региона. См. статью [Перемещение рабочей области Log Analytics в другую подписку или группу ресурсов](logs/move-workspace.md).

### <a name="why-cant-i-see-query-explorer-and-save-buttons-in-log-analytics"></a>Почему я не вижу кнопок "Обозреватель запросов" и "Сохранить" в Log Analytics?

Кнопки **Обозреватель запросов**, **Сохранить** и **Новое правило генерации оповещений** недоступны, если в качестве [области запроса](logs/scope.md) указан конкретный ресурс. Чтобы создать оповещения, сохранить или загрузить запрос, областью действия для Log Analytics нужно указать рабочую область. Чтобы открыть Log Analytics в контексте рабочей области, выберите **Журналы** в меню **Azure Monitor**. Выбирается последняя использованная рабочая область, но вы можете выбрать и любую другую рабочую область. Подробные сведения см. в статье [Область запросов журнала и временной диапазон в Azure Monitor Log Analytics](logs/scope.md).

### <a name="why-am-i-getting-the-error-register-resource-provider-microsoftinsights-for-this-subscription-to-enable-this-query-when-opening-log-analytics-from-a-vm"></a>Почему я получаю ошибку? Почему при открытии Log Analytics на виртуальной машине я получаю сообщение об ошибке "Register resource provider 'Microsoft.Insights' for this subscription to enable this query" (Зарегистрируйте поставщик ресурсов Microsoft.Insights для этой подписки, чтобы выполнить этот запрос)? 
Многие поставщики ресурсов регистрируются автоматически, но иногда их приходится регистрировать вручную. Областью регистрации всегда является подписка. См. дополнительные сведения о [поставщиках и типах ресурсов](../azure-resource-manager/management/resource-providers-and-types.md#azure-portal).

### <a name="why-am-i-getting-no-access-error-message-when-opening-log-analytics-from-a-vm"></a>Почему при открытии Log Analytics из виртуальной машины не появляется сообщение об ошибке доступа? 
Чтобы просмотреть журналы виртуальных машин, необходимо предоставить разрешение на чтение рабочим областям, в которых хранятся журналы виртуальных машин. В таком случае администратору необходимо предоставить вам разрешения в Azure.

## <a name="metrics"></a>Метрики

### <a name="why-are-metrics-from-the-guest-os-of-my-azure-virtual-machine-not-showing-up-in-metrics-explorer"></a>Почему метрики из гостевой ОС виртуальной машины Azure не отображаются в обозревателе метрик?
[Метрики платформы](essentials/monitor-azure-resource.md#monitoring-data) автоматически собираются для ресурсов Azure. Но для сбора метрик из гостевой ОС виртуальной машины необходимо выполнить некоторую настройку. Для виртуальной машины Windows следует установить расширение системы диагностики и настроить Azure Monitor в качестве приемника данных, как описано в статье [Установка и настройка расширения "Диагностика Microsoft Azure" (WAD)](agents/diagnostics-extension-windows-install.md). Для Linux следует установить агент Telegraf, как описано в статье [Сбор пользовательских метрик для виртуальной машины Linux с помощью агента Telegraf InfluxData](essentials/collect-custom-metrics-linux-telegraf.md).

## <a name="alerts"></a>видны узлы

### <a name="what-is-an-alert-in-azure-monitor"></a>Что такое оповещение в Azure Monitor?
С помощью оповещений можно заранее получать уведомления о важных условиях, обнаруженных в ваших данных мониторинга. Они позволяют выявить и устранить проблемы, прежде чем пользователи системы обнаружат их. Оповещения бывают нескольких типов.

- Метрики — срабатывают в случае превышения порогового значения метрики.
- Запрос к журналам — результаты запроса к журналам соответствуют заданным условиям.
- Журнал действий — событие журнала действий соответствует заданным условиям.
- Веб-тест — результаты теста доступности соответствуют заданным условиям.


См. статью [Обзор оповещений в Microsoft Azure](alerts/alerts-overview.md).


### <a name="what-is-an-action-group"></a>Что такое группа действий?
Группа действий представляет собой коллекцию уведомлений и действий, которые активируются оповещением. Несколько оповещений могут использовать одну группу действий, что позволяет настроить общие наборы уведомлений и действий. См. статью [Создание групп действий и управление ими на портале Azure](alerts/action-groups.md).


### <a name="what-is-an-action-rule"></a>Что такое правило действия?
Правило действия позволяет изменить поведение набора оповещений, которые соответствуют определенным критериям. Это позволяет выполнять такие требования, как отключение действий оповещений в течение периода обслуживания. Вы также можете применить группу действий к набору оповещений, а не напрямую к правилам генерации оповещений. См. статью [Правила действий](alerts/alerts-action-rules.md).

## <a name="agents"></a>Агенты

### <a name="does-azure-monitor-require-an-agent"></a>Нужен ли специальный агент для Azure Monitor?
Агент требуется только для сбора данных из операционной системы и рабочих нагрузок на виртуальных машинах. Виртуальные машины могут размещаться в Azure, другой облачной среде или локально. См. статью [Общие сведения об агентах Azure Monitor](agents/agents-overview.md).


### <a name="whats-the-difference-between-the-azure-monitor-agents"></a>В чем различия между агентами Azure Monitor?
Расширение диагностики Azure предназначено для виртуальных машин Azure и собирает данные в метрики Azure Monitor, службу хранилища Azure и Центры событий Azure. Агент Log Analytics предназначен для виртуальных машин в Azure и других облачных и локальной средах. Он собирает данные в журналы Azure Monitor. Агент зависимостей работает только совместно с агентом Log Analytics и собирает данные и зависимости для процессов. См. статью [Общие сведения об агентах Azure Monitor](agents/agents-overview.md).


### <a name="does-my-agent-traffic-use-my-expressroute-connection"></a>Используется ли подключение ExpressRoute для трафика агента?
Трафик в Azure Monitor направляется по пиринговому каналу ExpressRoute. Различные типы трафика ExpressRoute описаны в [документации по ExpressRoute](../expressroute/expressroute-faqs.md#supported-services). 

### <a name="how-can-i-confirm-that-the-log-analytics-agent-is-able-to-communicate-with-azure-monitor"></a>Как проверить, что агент Log Analytics может взаимодействовать с Azure Monitor?
В панели управления на компьютере агента выберите **параметры & безопасности**, * * Microsoft Monitoring Agent. На вкладке **Azure Log Analytics (OMS)** должен присутствовать зеленый значок с галочкой, который подтверждает наличие связи агента с Azure Monitor. Если вместо него вы видите желтый значок предупреждения, значит в работе агента возникли неполадки. Одной из типичных причин может быть остановка службы **Microsoft Monitoring Agent**. Перезапустите службу с помощью диспетчера управления службами.

### <a name="how-do-i-stop-the-log-analytics-agent-from-communicating-with-azure-monitor"></a>Как остановить отправку данных в Azure Monitor из агента Log Analytics?
Для агентов, подключенных к Log Analytics напрямую, последовательно выберите "Панель управления", **Безопасность и параметры**, **Microsoft Monitoring Agent**. На вкладке **Azure Log Analytics (OMS)** удалите все рабочие области. В SCOM удалите компьютер из списка компьютеров, находящихся под управлением Log Analytics. Operations Manager обновит конфигурацию агента, чтобы больше не отправлять отчеты в Log Analytics. 

### <a name="how-much-data-is-sent-per-agent"></a>Какой объем данных отправляет каждый агент?
Объем данных, отправляемых каждым агентом, зависит от:

* решения, которое вы используете;
* количества журналов и счетчиков производительности, которые вы собираете;
* объема данных в журналах.

См. статью [Управление потреблением и затратами с помощью журналов Azure Monitor](logs/manage-cost-storage.md).

Для компьютеров, на которых может запускаться агент WireData, объем отправляемых данных можно просмотреть с помощью следующего запроса:

```Kusto
WireData
| where ProcessName == "C:\\Program Files\\Microsoft Monitoring Agent\\Agent\\MonitoringHost.exe" 
| where Direction == "Outbound" 
| summarize sum(TotalBytes) by Computer 
```

### <a name="how-much-network-bandwidth-is-used-by-the-microsoft-management-agent-mma-when-sending-data-to-azure-monitor"></a>Какую часть пропускной способности сети использует Microsoft Management Agent (MMA) при отправке данных в Azure Monitor?
Пропускная способность зависит от объема отправляемых данных. При передаче по сети данные сжимаются.


### <a name="how-can-i-be-notified-when-data-collection-from-the-log-analytics-agent-stops"></a>Как получать уведомления о прекращении сбора данных от агента Log Analytics?

Выполните действия, описанные в разделе о [создании оповещений журналов](alerts/alerts-metric.md), чтобы получать уведомления при прекращении сбора данных. Настройте следующие параметры для правила генерации оповещений.

- **Определение условия оповещения**. Укажите целевую рабочую область Log Analytics.
- **Критерии оповещений** 
   - **Название сигнала**: *Настраиваемый поиск по журналам*
   - **Поисковый запрос**: `Heartbeat | summarize LastCall = max(TimeGenerated) by Computer | where LastCall < ago(15m)`
   - **Логика оповещений.** **Основана на** *числе результатов*; **Условие**: *больше чем*; **Пороговое значение**: *0*
   - **Вычисляется на основе**. **Период (в минутах)** : *30*; **Частота (в минутах)** : *10*
- **Определение сведений об оповещении**. 
   - **Name** (Имя). *Сбор данных остановлен*
   - **Уровень серьезности**. *Предупреждение*

Укажите существующую или новую [группу действий](alerts/action-groups.md), чтобы получать уведомление о том, что пакеты пульса отсутствуют более 15 минут, когда будут выполняться критерии для оповещений.


### <a name="what-are-the-firewall-requirements-for-azure-monitor-agents"></a>Каковы требования к настройке брандмауэра для агентов Azure Monitor?
Дополнительные сведения о требованиях к настройке брандмауэра см. в разделе [Требования к сети](agents/log-analytics-agent.md#network-requirements).


## <a name="visualizations"></a>Визуализации

### <a name="why-cant-i-see-view-designer"></a>Почему я не вижу конструктор представлений?

Конструктор представлений доступен только для тех пользователей, которым назначены разрешения участника или более высокого уровня для рабочей области Log Analytics.

## <a name="application-insights"></a>Application Insights

### <a name="configuration-problems"></a>Проблемы с конфигурацией
*У меня не получается настроить компоненты, о которых идет речь в таких статьях:*

* [Troubleshooting no data - Application Insights for .NET](app/asp-net-troubleshoot-no-data.md)
* [раздел "Устранение неполадок"](app/monitor-performance-live-website-now.md#troubleshoot)
* [Настройка системы диагностики Azure для входа в Application Insights](agents/diagnostics-extension-to-application-insights.md)
* [Веб-приложение Java](app/java-troubleshoot.md)

*Я не получаю данные с моего сервера*

* [Настройка исключений брандмауэра](app/ip-addresses.md)
* [Настройка сервера ASP.NET](app/monitor-performance-live-website-now.md)
* [Настройка сервера Java](app/java-agent.md)

*Сколько Application Insights ресурсов следует развернуть:*

* [Выбор количества ресурсов Application Insights для развертывания ](app/separate-resources.md)

### <a name="can-i-use-application-insights-with-"></a>Можно ли использовать Application Insights с...?

* [Развертывание агента Azure Monitor Application Insights на виртуальных машинах Azure и в масштабируемых наборах виртуальных машин Azure](app/azure-vm-vmss-apps.md)
* [Веб-приложения на сервере IIS — локальном или в виртуальной машине](app/asp-net.md)
* [Веб-приложения Java](app/java-get-started.md)
* [Приложения Node.js](app/nodejs.md)
* [Веб-приложения в Azure](app/azure-web-apps.md)
* [Облачные службы в Azure](app/cloudservices.md)
* [Серверы приложений, работающие в Docker](./azure-monitor-app-hub.yml)
* [Одностраничные веб-приложения](app/javascript.md)
* [SharePoint](app/sharepoint.md)
* [Классические приложения Windows](app/windows-desktop.md)
* [другие платформы.](app/platforms.md)

### <a name="is-it-free"></a>Предоставляется ли бесплатно?

Да, для экспериментальных целей. По условиям тарифного плана "Базовый" приложение может отправлять определенный лимит данных каждый месяц бесплатно. Бесплатный лимит достаточен для разработки и публикации приложения для небольшого числа пользователей. Можно задать ограничение, запрещающее обработку данных сверх заданного лимита.

Оплата за большие объемы данных телеметрии взимается по ГБ. Мы даем ряд советов по тому, как [ограничить расходы](app/pricing.md).

В рамках плана "Корпоративный" оплата взимается за каждый день, в который каждый узел веб-сервера отправляет телеметрию. Он подходит для случаев, когда требуется использовать непрерывный экспорт в большом масштабе.

[Изучите тарифный план](https://azure.microsoft.com/pricing/details/application-insights/).

### <a name="how-much-does-it-cost"></a>Сколько это стоит?

* Откройте страницу **Usage and estimated costs** (Данные об использовании и предполагаемые расходы) для ресурса Application Insights. На ней приводится диаграмма недавнего использования. При желании можно задать ограничение на объем данных.
* Откройте [колонку подписок и выставления счетов Azure](https://portal.azure.com/#blade/Microsoft_Azure_Billing/BillingBlade/Overview), чтобы просмотреть счета за все ресурсы.

### <a name="what-does-application-insights-modify-in-my-project"></a><a name="q14"></a>Что Application Insights изменяет в моем проекте?
Подробности зависят от типа проекта. Для веб-приложения:

* Добавляет в проект следующие файлы:
  * ApplicationInsights.config
  * ai.js
* Устанавливает следующие пакеты NuGet:
  * *Application Insights API* — основной API
  * *API Application Insights для веб-приложений* — используется для отправки данных телеметрии со стороны сервера
  * *API Application Insights для приложений JavaScript* — используется для отправки данных телеметрии со стороны клиента
* Пакет включает эти сборки:
  * Microsoft.ApplicationInsights
  * Microsoft.ApplicationInsights.Platform
* Вставляет элементы в:
  * Web.config
  * packages.config
* (Только для новых проектов. Если вы [добавляете Application Insights в существующий проект][start], придется сделать это вручную.) Вставляет фрагменты кода в код клиента и сервера для их инициализации с идентификатором ресурса Application Insights. Например, в приложении MVC код вставляется в файл главной страницы Views/Shared/\_Layout.cshtml.

### <a name="how-do-i-upgrade-from-older-sdk-versions"></a>Как обновить предыдущие версии пакета SDK?
Информацию для пакета SDK, соответствующего типу вашего приложения, см. в статье с [заметками о выпуске](app/release-notes.md).

### <a name="how-can-i-change-which-azure-resource-my-project-sends-data-to"></a><a name="update"></a>Как изменить ресурс Azure, в который проект отправляет данные?
В обозревателе решений щелкните правой кнопкой мыши `ApplicationInsights.config` и выберите **Обновить Application Insights**. Данные можно отправлять на существующий или новый ресурс в Azure. Мастер обновления изменяет ключ инструментирования в файле ApplicationInsights.config, который определяет, куда сервер SDK должен отправлять ваши данные. Если отменить выбор параметра "Обновить все", это также приведет к изменению ключа, отображаемого на ваших веб-страницах.

### <a name="do-new-azure-regions-require-the-use-of-connection-strings"></a>Требуется ли использовать строки подключения для новых регионов Azure?

Новые регионы Azure **должны** использовать строки подключения вместо ключей инструментирования. [Строка подключения](./app/sdk-connection-string.md) определяет ресурс, с которым необходимо связать данные телеметрии. Она также позволяет изменить конечные точки, которые ресурс будет использовать в качестве назначения для данных телеметрии. Необходимо скопировать строку подключения и добавить ее в код приложения или переменную среды.

### <a name="can-i-use-providersmicrosoftinsights-componentsapiversions0-in-my-azure-resource-manager-deployments"></a>Можно ли использовать `providers('Microsoft.Insights', 'components').apiVersions[0]` в развертываниях Azure Resource Manager?

Мы не рекомендуем использовать этот метод получения версии API. Последняя версия может содержать предварительные выпуски с критическими изменениями. Даже если исключить предварительные выпуски, новые версии API не всегда обратно совместимы с существующими шаблонами, а в некоторых случаях версия API доступна не для всех подписок.

### <a name="what-is-status-monitor"></a>Что такое монитор состояния?

Это классическое приложение, которое можно использовать на веб-сервере IIS для настройки Application Insights в веб-приложениях. Оно не собирает телеметрию: его можно остановить, когда вы не настраиваете приложение. 

[Подробнее](app/monitor-performance-live-website-now.md#questions).

### <a name="what-telemetry-is-collected-by-application-insights"></a>Какую телеметрию собирает Application Insights?

Из серверных веб-приложений:

* HTTP-запросы;
* [зависимости](app/asp-net-dependencies.md); вызовы к базам данных SQL, Azure Cosmos DB, таблице, хранилищу BLOB-объектов и очереди; HTTP-вызовы к внешним службам; 
* [исключения](app/asp-net-exceptions.md) и трассировки стека;
* [счетчики производительности](app/performance-counters.md), если вы используете [монитор состояния](app/monitor-performance-live-website-now.md), [мониторинг Azure для служб приложений](app/azure-web-apps.md), [мониторинг Azure для виртуальных машин или масштабируемого набора виртуальных машин](app/azure-vm-vmss-apps.md) или [средство записи collectd из Application Insights](app/java-collectd.md);
* [пользовательские события и метрики](app/api-custom-events-metrics.md), которые вы создаете в коде;
* [журналы трассировки](app/asp-net-trace-logs.md), если вы настраиваете соответствующий сборщик.

С [клиентских веб-страниц](app/javascript.md):

* [число просмотров страниц](app/usage-overview.md);
* [вызовы AJAX](app/asp-net-dependencies.md) — запросы, выполняемые из запущенного скрипта;
* загрузка данных при просмотре страниц;
* количество пользователей и сеансов;
* [идентификаторы пользователей, прошедших проверку подлинности](app/api-custom-events-metrics.md#authenticated-users).

Из других источников, если они настроены:

* [Настройка системы диагностики Azure для входа в Application Insights](agents/diagnostics-extension-to-application-insights.md)
* [Импорт в службу аналитики](logs/data-collector-api.md)
* [Служба Log Analytics](logs/data-collector-api.md)
* [Logstash](logs/data-collector-api.md).

### <a name="can-i-filter-out-or-modify-some-telemetry"></a>Можно ли отфильтровать или изменить некоторые данные телеметрии?

Да, на сервере можно создать следующие компоненты:

* обработчик данных телеметрии для фильтрации или добавления свойств в выбранные элементы телеметрии перед их отправкой из приложения;
* инициализатор телеметрии для добавления свойств во все элементы телеметрии.

Дополнительные сведения об [ASP.NET](app/api-filtering-sampling.md) или [Java](app/java-filter-telemetry.md).

### <a name="how-are-city-countryregion-and-other-geo-location-data-calculated"></a>Как вычисляются данные о городе, стране, регионе и другие данные о географическом расположении?

Мы определяем IP-адрес (IPv4 или IPv6) веб-клиента с помощью [GeoLite2](https://dev.maxmind.com/geoip/geoip2/geolite2/).

* Телеметрия браузера: мы собираем сведения об IP-адресе отправителя.
* Телеметрия сервера: модуль Application Insights собирает сведения об IP-адресе клиента. Эти сведения не собираются, если задан заголовок `X-Forwarded-For`.
* Дополнительные сведения о сборе IP-адресов и данных географического расположения в Application Insights см. в этой [статье](./app/ip-collection.md).

Вы можете настроить `ClientIpHeaderTelemetryInitializer` для получения IP-адреса из другого заголовка. Например, в некоторых системах он переносится прокси-сервером, балансировщиком нагрузки или сетью CDN в `X-Originating-IP`. [Подробнее](https://apmtips.com/posts/2016-07-05-client-ip-address/).

Вы можете [использовать Power BI](app/export-power-bi.md ) для отображения данных телеметрии по запросам на карте.


### <a name="how-long-is-data-retained-in-the-portal-is-it-secure"></a><a name="data"></a>Как долго данные хранятся на портале? Защищены ли они?
Ознакомьтесь со статьей [Сбор и хранение данных в Application Insights][data].

### <a name="what-happens-to-application-insights-telemetry-when-a-server-or-device-loses-connection-with-azure"></a>Что происходит с данными телеметрии Application Insights, когда сервер или другое устройство теряет подключение к Azure?

Все наши пакеты SDK, включая веб-пакет SDK, содержат механизмы класса "надежный транспорт". Когда сервер или устройство теряет подключение к Azure, данные телеметрии [хранятся локально в файловой системе](./app/data-retention-privacy.md#does-the-sdk-create-temporary-local-storage) (пакеты SDK для сервера) или в хранилище сеансов HTML5 (веб-пакет SDK). Пакет SDK будет периодически повторять попытку отправки данных телеметрии до тех пор, пока служба приема не сочтет их "устаревшими" (48 часов для журналов или 30 минут для метрик). Устаревшие данные телеметрии удаляются. В некоторых случаях, например при заполнении локального хранилища, повторная попытка не выполняется.


### <a name="could-personal-data-be-sent-in-the-telemetry"></a>Могут ли персональные данные отправляться с данными телеметрии?

Это возможно, если ваш код отправляет такие данные. Это также может происходить, если переменные в трассировках стека содержат персональные данные. Ваша команда разработчиков должна произвести оценку рисков, чтобы обеспечить надлежащую обработку персональных данных. [Дополнительные сведения о хранении и конфиденциальности данных](app/data-retention-privacy.md).

Для **всех** октетов веб-адреса клиента всегда задается значение 0 после подстановки атрибутов географического расположения.

[Пакет SDK для Application Insights JavaScript](app/javascript.md) не включает персональные данные в автозавершение по умолчанию. Однако некоторые персональные данные, используемые в приложении, могут быть получены с помощью пакета SDK (например, полные имена в `window.title` или идентификаторы учетных записей в параметрах запроса URL-адреса XHR). Для пользовательского маскирования личных данных добавьте [инициализатор телеметрии](app/api-filtering-sampling.md#javascript-web-applications).

### <a name="my-instrumentation-key-is-visible-in-my-web-page-source"></a>Мой ключ инструментирования доступен в исходном коде веб-страницы.

* Это обычная ситуация в решениях для мониторинга.
* С его помощью нельзя похитить ваши данные.
* Он может использоваться для искажения данных или активации оповещений.
* Мы не получали сообщений от клиентов о возникновении таких проблем.

Вы можете:

* использовать два отдельных ключа инструментирования (разные ресурсы Application Insights) для данных клиента и сервера либо
* создать прокси-сервер, работающий на вашем сервере, и передавать данные веб-клиента через него.

### <a name="how-do-i-see-post-data-in-diagnostic-search"></a><a name="post"></a>Как просмотреть данные POST в колонке «Поиск по журналу диагностики»?
Данные POST не регистрируются автоматически, но можно использовать вызов TrackTrace. Для этого добавьте данные в параметр сообщения. В нем можно добавить больше символов, чем в свойствах строк, но по нему невозможно выполнить фильтрацию.

### <a name="should-i-use-single-or-multiple-application-insights-resources"></a>Следует ли использовать один или несколько ресурсов Application Insights?

Используйте один ресурс для всех компонентов или ролей в единой бизнес-системе. Используйте отдельные ресурсы для стадий разработки, тестирования и выпуска, а также для независимых приложений.

* [Ознакомьтесь с этим обсуждением](app/separate-resources.md)
* [Пример: облачная служба с рабочей ролью и веб-ролью](app/cloudservices.md)

### <a name="how-do-i-dynamically-change-the-instrumentation-key"></a>Как динамически изменить ключ инструментирования?

* [Ознакомьтесь с этим обсуждением](app/separate-resources.md)
* [Пример: облачная служба с рабочей ролью и веб-ролью](app/cloudservices.md)

### <a name="what-are-the-user-and-session-counts"></a>Что такое количество пользователей и сеансов?

* Пакет SDK для JavaScript создает файл cookie пользователя в веб-клиенте для определения возвращающихся пользователей и файл cookie сеанса для группировки действий.
* Если скрипт на стороне клиента отсутствует, вы можете [задать файлы cookie на сервере](https://apmtips.com/posts/2016-07-09-tracking-users-in-api-apps/).
* Если один реальный пользователь работает с вашим сайтом в разных браузерах, на разных компьютерах либо использует конфиденциальный режим просмотра или режим инкогнито, то он будет учитываться несколько раз.
* Для определения вошедшего в систему пользователя на разных компьютерах и в разных браузерах добавьте вызов [setAuthenticatedUserContext()](app/api-custom-events-metrics.md#authenticated-users).

### <a name="how-does-application-insights-generate-device-information-browser-os-language-model"></a>Как Application Insights создает сведения об устройстве (браузер, ОС, язык, модель)?

Браузер передает строку агента пользователя в HTTP-заголовке запроса, а служба приема Application Insights использует [средство синтаксического анализа UA](https://github.com/ua-parser/uap-core) для создания полей, отображаемых в таблицах данных и интерфейсах. В результате Application Insights пользователи не могут изменить эти поля.

Иногда эти данные могут отсутствовать или быть неточными, если пользователь или предприятие отключает отправку агента пользователя в параметрах браузера. Кроме того, [регулярное выражение средства синтаксического анализа UA](https://github.com/ua-parser/uap-core/blob/master/regexes.yaml) может не включать все сведения об устройстве или Application Insights может не использовать последние обновления.

### <a name="have-i-enabled-everything-in-application-insights"></a><a name="q17"></a> Все ли активировано в Application Insights?
| Что вы должны видеть | Как это получить | Для чего это нужно |
| --- | --- | --- |
| Диаграммы доступности |[Веб-тесты](app/monitor-web-app-availability.md) |Узнать, что ваше веб-приложение работает |
| Производительность приложения на сервере: время отклика и т.д. |[Добавить Application Insights в ваш проект](app/asp-net.md) или [установить монитор состояний Application Insights на сервере](app/monitor-performance-live-website-now.md) (или написать собственный код для [отслеживания зависимостей](app/api-custom-events-metrics.md#trackdependency)) |Выявить проблемы производительности |
| Телеметрия зависимостей |[Установить монитор состояний Application Insights на сервере](app/monitor-performance-live-website-now.md) |Выявить проблемы с базами данных или другими внешними компонентами |
| Получение данных трассировки стека из исключений |[Вставить вызовы TrackException в код](app/asp-net-exceptions.md) (некоторые выводятся автоматически) |Обнаружить и диагностировать исключения |
| Поиск по трассировкам журнала |[Добавить адаптер ведения журнала](app/asp-net-trace-logs.md) |Выявить исключения, проблемы производительности |
| Основная информация об использовании клиента: просмотр страниц, сеансы и т. д. |[Инициализатор JavaScript на веб-страницах](app/javascript.md) |Аналитика использования |
| Настраиваемые метрики клиента |[Трассировка вызовов на веб-страницах](app/api-custom-events-metrics.md) |Расширить возможности для пользователя |
| Настраиваемые метрики сервера |[Отслеживание вызовов на сервере](app/api-custom-events-metrics.md) |Бизнес-аналитика |

### <a name="why-are-the-counts-in-search-and-metrics-charts-unequal"></a>Почему счетчики в результатах поиска и на диаграммах метрик не совпадают?

[Выборка](app/sampling.md) сокращает число элементов телеметрии (запросов, пользовательских событий и т. д.), которые передаются из приложения на портал. В результатах поиска вы видите число фактически полученных элементов. На диаграммах метрик, на которых приводится число событий, вы видите количество исходных событий, которые произошли. 

Каждый передаваемый элемент имеет свойство `itemCount`, которое показывает, сколько исходных событий представляет этот элемент. Чтобы увидеть, как работает выборка, можно выполнить в Analytics следующий запрос:

```
    requests | summarize original_events = sum(itemCount), transmitted_events = count()
```

### <a name="how-do-i-move-an-application-insights-resource-to-a-new-region"></a>Разделы справки переместить ресурс Application Insights в новый регион?

Перемещение существующих Application Insights ресурсов из одного региона в другой **в настоящее время не поддерживается**. Собранные исторические данные **не могут быть перенесены** в новый регион. Единственное разделяемое решение:

1. Создайте новый ресурс Application Insights ([классический](app/create-new-resource.md) или [на основе рабочей области](./app/create-workspace-resource.md)) в новом регионе.
2. Повторное создание всех уникальных настроек, относящихся к исходному ресурсу в новом ресурсе.
3. Измените приложение для использования [ключа инструментирования](app/create-new-resource.md#copy-the-instrumentation-key) или [строки подключения](app/sdk-connection-string.md)для нового ресурса региона.  
4. Протестируйте, чтобы убедиться, что все продолжает работать должным образом с новым ресурсом Application Insights. 
5. На этом этапе можно либо удалить исходный ресурс, что приведет к **потере всех исторических данных**. Или же Храните исходный ресурс для формирования отчетов в течение срока хранения данных.

Уникальные настройки, которые обычно необходимо создать вручную или обновить для ресурса в новом регионе, включают в себя не только:

- Повторное создание настраиваемых панелей мониторинга и книг. 
- Повторное создание или обновление области пользовательских оповещений журнала или метрики. 
- Повторное создание оповещений о доступности.
- Повторно создайте все настраиваемые параметры управления доступом на основе ролей Azure (Azure RBAC), необходимые пользователям для доступа к новому ресурсу. 
- Репликация параметров, включающих выборку приема, хранение данных, ежедневное ограничение и включение пользовательских метрик. Эти параметры контролируются с помощью панели **использование и предполагаемые затраты** .
- Любая интеграция, основанная на ключах API, таких как [заметки к выпуску](./app/annotations.md), [динамические метрики канала безопасного управления](app/live-stream.md#secure-the-control-channel) и т. д. Вам потребуется создать новые ключи API и обновить связанную интеграцию. 
- Непрерывный экспорт в классических ресурсах потребуется настроить снова.
- Параметры диагностики в ресурсах на основе рабочей области необходимо настроить снова.

> [!NOTE]
> Если ресурс, создаваемый в новом регионе, заменит классический ресурс, мы рекомендуем ознакомиться с преимуществами [создания нового ресурса на основе рабочей области](app/create-workspace-resource.md) или [переноса существующего ресурса в рабочую область](app/convert-classic-resource.md). 

### <a name="automation"></a>Служба автоматизации

#### <a name="configuring-application-insights"></a>Настройка Application Insights

С помощью монитора ресурсов Azure можно [создавать скрипты PowerShell](app/powershell.md) для выполнения следующих задач:

* создание и обновление ресурсов Application Insights;
* задание ценового плана;
* получение ключа инструментирования;
* добавление оповещения метрики;
* добавление теста доступности.

Вы не можете настроить отчет обозревателя метрик или непрерывный экспорт.

#### <a name="querying-the-telemetry"></a>Запрос телеметрии

Используйте [REST API](https://dev.applicationinsights.io/) для выполнения запросов [аналитики](./logs/log-query-overview.md).

### <a name="how-can-i-set-an-alert-on-an-event"></a>Как можно настроить оповещение о событии?

Оповещения Azure настраиваются только для метрик. Создайте пользовательскую метрику, пороговое значение которой будет нарушаться при наступлении события. Затем настройте оповещение для метрики. Вы будете получать уведомление при достижении верхнего или нижнего порогового значения метрики. Вы не получите уведомление, пока этого не произойдет, независимо от того, верхнее это значение или нижнее. Уведомление отправляется с задержкой в несколько минут.

### <a name="are-there-data-transfer-charges-between-an-azure-web-app-and-application-insights"></a>Взимается ли плата за передачу данных между веб-приложением Azure и Application Insights?

* Если ваше веб-приложение Azure размещается в центре данных с конечной точкой сбора Application Insights, плата не взимается. 
* Если в центре данных размещения нет конечной точки сбора, то за передачу данных телеметрии приложения будет взиматься [плата за передачу исходящих данных Azure](https://azure.microsoft.com/pricing/details/bandwidth/).

Это не зависит от того, где размещается ресурс Application Insights. Значение имеет только распределение наших конечных точек.

### <a name="can-i-send-telemetry-to-the-application-insights-portal"></a>Можно ли отправлять данные телеметрии на портал Application Insights?

Мы рекомендуем использовать наши пакеты SDK, а также [API пакета SDK](app/api-custom-events-metrics.md). Существуют разновидности пакетов SDK для разных [платформ](app/platforms.md). Эти пакеты SDK управляют буферизацией, сжатием, регулированием, повторными попытками и другими операциями. Однако [схема приема](https://github.com/microsoft/ApplicationInsights-dotnet/tree/master/BASE/Schema/PublicSchema) и [протокол конечной точки](https://github.com/MohanGsk/ApplicationInsights-Home/blob/master/EndpointSpecs/ENDPOINT-PROTOCOL.md) являются открытыми.

### <a name="can-i-monitor-an-intranet-web-server"></a>Можно ли отслеживать веб-сервер в интрасети?

Да, но вам потребуется разрешить службам использовать трафик путем внесения их в исключения брандмауэра или использовав перенаправления прокси-сервера.
- QuickPulse `https://rt.services.visualstudio.com:443` 
- ApplicationIdProvider `https://dc.services.visualstudio.com:443` 
- TelemetryChannel `https://dc.services.visualstudio.com:443` 


[Здесь](app/ip-addresses.md) можно проверить полный список служб и IP-адресов.

#### <a name="firewall-exception"></a>Исключение брандмауэра

Разрешите веб-серверу отправлять данные телеметрии в наши конечные точки. 

#### <a name="gateway-redirect"></a>Перенаправление шлюза

Маршрутизация трафика с сервера в шлюз интрасети выполняется путем перезаписи конечных точек в конфигурации. Если эти свойства "Конечная точка" отсутствуют в вашей конфигурации, эти классы будут использовать значения по умолчанию, показанные в примере ApplicationInsights.config, приведенном ниже. 

Шлюз должен выполнять маршрутизацию трафика, который идет к базовому адресу конечных точек. В файле настроек замените значение по умолчанию следующими параметрами `http://<your.gateway.address>/<relative path>`.


##### <a name="example-applicationinsightsconfig-with-default-endpoints"></a>Пример ApplicationInsights.config со значением по умолчанию для конечных точек.
```xml
<ApplicationInsights>
  ...
  <TelemetryModules>
    <Add Type="Microsoft.ApplicationInsights.Extensibility.PerfCounterCollector.QuickPulse.QuickPulseTelemetryModule, Microsoft.AI.PerfCounterCollector">
      <QuickPulseServiceEndpoint>https://rt.services.visualstudio.com/QuickPulseService.svc</QuickPulseServiceEndpoint>
    </Add>
  </TelemetryModules>
    ...
  <TelemetryChannel>
     <EndpointAddress>https://dc.services.visualstudio.com/v2/track</EndpointAddress>
  </TelemetryChannel>
  ...
  <ApplicationIdProvider Type="Microsoft.ApplicationInsights.Extensibility.Implementation.ApplicationId.ApplicationInsightsApplicationIdProvider, Microsoft.ApplicationInsights">
    <ProfileQueryEndpoint>https://dc.services.visualstudio.com/api/profiles/{0}/appId</ProfileQueryEndpoint>
  </ApplicationIdProvider>
  ...
</ApplicationInsights>
```

> [!NOTE]
> ApplicationIdProvider доступен, начиная с версии 2.6.0



#### <a name="proxy-passthrough"></a>Транзитный прокси-сервер

Транзитный прокси-сервер создается путем настройки прокси-сервера на уровне компьютера или приложения.
Дополнительные сведения см. в статье о [DefaultProxy](/dotnet/framework/configure-apps/file-schema/network/defaultproxy-element-network-settings) из документации по .NET.
 
 Пример файла Web.config:
 ```xml
<system.net>
    <defaultProxy>
      <proxy proxyaddress="http://xx.xx.xx.xx:yyyy" bypassonlocal="true"/>
    </defaultProxy>
</system.net>
```
 

### <a name="can-i-run-availability-web-tests-on-an-intranet-server"></a>Можно ли выполнять веб-тесты доступности на сервере в интрасети?

Наши [веб-тесты](app/monitor-web-app-availability.md) выполняются в точках подключения, которые распределены по всему миру. Есть два решения.

* Разрешение в брандмауэре: разрешите передачу запросов к серверу от [агентов веб-тестирования из длинного меняющегося списка](app/ip-addresses.md).
* Напишите собственный код для периодической отправки запросов на сервер из интрасети. Для этой цели можно выполнять веб-тесты Visual Studio. Тест-инженер может отправлять результаты в Application Insights с помощью API TrackAvailability().

### <a name="how-long-does-it-take-for-telemetry-to-be-collected"></a>Сколько времени требуется для сбора данных телеметрии?

Как правило, время сбора данных Application Insights не превышает 5 минут. Сбор некоторых данных (например, крупных файлов журналов) может занять больше времени. Дополнительные сведения см. в статье, посвященной [соглашениям об уровне обслуживания для Application Insights](https://azure.microsoft.com/support/legal/sla/application-insights/v1_2/).



<!--Link references-->

[data]: app/data-retention-privacy.md
[platforms]: app/platforms.md
[start]: app/app-insights-overview.md
[windows]: app/app-insights-windows-get-started.md

### <a name="http-502-and-503-responses-are-not-always-captured-by-application-insights"></a>Ответы HTTP 502 и 503 не всегда фиксируются Application Insights

ошибки "502 шлюз" и "служба 503 недоступна" не всегда записываются Application Insights. Если для мониторинга используется только клиент JavaScript на стороне клиента, это ожидаемое поведение, так как ответ об ошибке возвращается до страницы, содержащей заголовок HTML с отображаемым фрагментом кода JavaScript для мониторинга. 

Если ответ 502 или 503 был отправлен с сервера с включенным наблюдением на стороне сервера, эти ошибки будут собираться пакетом SDK для Application Insights. 

Однако в некоторых случаях даже если на веб-сервере приложения включено наблюдение на стороне сервера, в Application Insights не будут записываться ошибки 502 или 503. Многие современные веб-серверы не позволяют клиенту обмениваться данными напрямую, а вместо этого используют такие решения, как обратный прокси-сервер, для передачи информации между клиентом и интерфейсными веб-серверами. 

В этом сценарии ответ 502 или 503 может быть возвращен клиенту из-за проблемы на уровне обратных прокси-серверов, который не будет захватываться Application Insights. Для обнаружения проблем на этом уровне может потребоваться пересылка журналов из обратного прокси-сервера в Log Analytics и создание настраиваемого правила для проверки ответов 502/503. Дополнительные сведения о распространенных причинах ошибок 502 и 503 см. в статье Устранение неполадок службы приложений Azure в разделе ["502 неверный шлюз" и "служба 503 недоступна"](../app-service/troubleshoot-http-502-http-503.md).     


## <a name="opentelemetry"></a>OpenTelemetry

### <a name="what-is-opentelemetry"></a>Что такое Опентелеметри

Новый стандарт с открытым кодом для наблюдаемых данных. Подробная информация собрана на странице [https://opentelemetry.io/](https://opentelemetry.io/).

### <a name="why-is-microsoft--azure-monitor-investing-in-opentelemetry"></a>Почему корпорация Майкрософт/Azure Monitor инвестиции в Опентелеметри?

Мы считаем, что ИТ лучше обслуживать наших клиентов по трем причинам:
   1. Включите поддержку для дополнительных сценариев клиентов.
   2. Инструмент, не опасаясь блокировки поставщика.
   3. Повышение прозрачности и сотрудничества клиентов.

Она также соответствует стратегии корпорации Майкрософт по работе с [открытым кодом](https://opensource.microsoft.com/).

### <a name="what-additional-value-does-opentelemetry-give-me"></a>Какое дополнительное значение Опентелеметри дает мне?

В дополнение к приведенным выше причинам Опентелеметри является более эффективным при масштабировании и обеспечивает единообразное проектирование и конфигурации на разных языках.

### <a name="how-can-i-test-out-opentelemetry"></a>Как можно протестировать Опентелеметри?

Зарегистрируйтесь, чтобы присоединиться к нашей Azure Monitor Application Insights сообществу раннего внедрения по адресу [https://aka.ms/AzMonOtel](https://aka.ms/AzMonOtel) .

### <a name="what-does-ga-mean-in-the-context-of-opentelemetry"></a>Что означает общедоступное значение в контексте Опентелеметри?

Сообщество Опентелеметри определяет общедоступную [версию.](https://medium.com/opentelemetry/ga-planning-f0f6d7b5302) Тем не менее, Опентелеметри "GA" не означает соответствие функций существующим пакетам SDK Application Insights. Azure Monitor продолжит использовать наши текущие пакеты SDK Application Insights для клиентов, которым требуются такие функции, как [предварительно агрегированные метрики](app/pre-aggregated-metrics-log-metrics.md#pre-aggregated-metrics), [динамические метрики](app/live-stream.md), [Адаптивная выборка](app/sampling.md#adaptive-sampling), [профилировщик](app/profiler-overview.md)и [отладчик моментальных снимков](app/snapshot-debugger.md) , до тех пор, пока опентелеметри пакеты SDK не станут доступны.

### <a name="can-i-use-preview-builds-in-production-environments"></a>Можно ли использовать предварительные сборки в рабочих средах?

Это не рекомендуется. Дополнительные сведения см. в разделе Дополнительные [условия использования для Microsoft Azure предварительных версий](https://azure.microsoft.com/support/legal/preview-supplemental-terms/) .

### <a name="whats-the-difference-between-opentelemetry-sdk-and-auto-instrumentation"></a>В чем разница между пакетом SDK для Опентелеметри и автоматической инструментированием?

Спецификация Опентелеметри определяет [пакет SDK](https://github.com/open-telemetry/opentelemetry-specification/blob/master/specification/glossary.md#telemetry-sdk). Вкратце, "SDK" — это пакет, зависящий от языка, который собирает данные телеметрии по различным компонентам приложения и отправляет данные в Azure Monitor через средство экспорта.

Концепция автоинструментирования (иногда называемая внедрением байт-кода, без кодирования или агентом) означает возможность инструментирования приложения без изменения кода. Например, ознакомьтесь с [файлом readme об автоматическом инструментировании Java опентелеметри](https://github.com/open-telemetry/opentelemetry-java-instrumentation/blob/master/README.md) для получения дополнительной информации.

### <a name="whats-the-opentelemetry-collector"></a>Что такое сборщик Опентелеметри?

Сборщик Опентелеметри описан в [файле сведений GitHub](https://github.com/open-telemetry/opentelemetry-collector#opentelemetry-collector). В настоящее время корпорация Майкрософт не использует сборщик Опентелеметри и зависит от прямых экспортов, которые отправляются в Application Insights Azure Monitor.

### <a name="whats-the-difference-between-opencensus-and-opentelemetry"></a>В чем разница между Опенценсус и Опентелеметри?

[Опенценсус](https://opencensus.io/) — это основы [опентелеметри](https://opentelemetry.io/). Корпорация Майкрософт помогла объединить [опентраЦинг](https://opentracing.io/) и опенценсус, чтобы создать опентелеметри, единый стандарт наблюдения для мира. Текущий [Рабочий пакет Python, рекомендуемый](app/opencensus-python.md) для Azure Monitor, основан на опенценсус, но в конечном итоге все пакеты SDK Azure Monitor будут основаны на опентелеметри.


## <a name="container-insights"></a>Аналитика контейнеров

### <a name="what-does-other-processes-represent-under-the-node-view"></a>Для чего нужен параметр *Другие процессы* в представлении узла?

**Другие процессы** позволяют ясно понять основную причину интенсивного использования ресурсов на узле. Благодаря ему вы сможете отличать потребление, связанное с контейнерными и неконтейнерными процессами.

Что собой представляют **Другие процессы**? 

Сюда относятся неконтейнерные процессы, выполняемые на этом узле.  

Как рассчитывается значение этого параметра?

**Другие процессы** = *Общее потребление по данным CAdvisor* - *Потребление контейнерными процессами*

В частности, к параметру **Другие процессы** относятся:

- самостоятельно управляемые или управляемые Kubernetes процессы, не являющиеся контейнерами; 

- процессы времени выполнения контейнера;  

- Kubelet  

- системные процессы, запущенные на узле; 

- другие, не относящиеся к Kubernetes рабочие нагрузки, которые выполняются на оборудовании узла или виртуальной машине. 

### <a name="i-dont-see-image-and-name-property-values-populated-when-i-query-the-containerlog-table"></a>У меня не заполняются значения свойств Image и Name, когда выполняется запрос к таблице ContainerLog.

Агент ciprod12042019 и более поздних версий не заполняет по умолчанию эти два свойства для каждой строки журнала. Это сделано для того, чтобы сократить затраты на сбор данных журналов. Существует два способа выполнения запроса к этой таблице, чтобы получить значения этих свойств.

#### <a name="option-1"></a>Вариант 1 

Выполните объединение с другими таблицами, чтобы получить нужные значения в результатах.

Измените запросы, добавив свойства Image и ImageTag из таблицы ```ContainerInventory``` и выполнив объединение с ней по свойству ContainerID. Можно включить свойство Name (как ранее оно было в ```ContainerLog``` таблице) из поля контаиненаме таблицы кубеподинвентори, объединив его со свойством ContainerID. Это желательно сделать.

Ниже приведен пример подробного запроса, где демонстрируется получение значений полей с помощью объединений.

```
//lets say we are querying an hour worth of logs
let startTime = ago(1h);
let endTime = now();
//below gets the latest Image & ImageTag for every containerID, during the time window
let ContainerInv = ContainerInventory | where TimeGenerated >= startTime and TimeGenerated < endTime | summarize arg_max(TimeGenerated, *)  by ContainerID, Image, ImageTag | project-away TimeGenerated | project ContainerID1=ContainerID, Image1=Image ,ImageTag1=ImageTag;
//below gets the latest Name for every containerID, during the time window
let KubePodInv  = KubePodInventory | where ContainerID != "" | where TimeGenerated >= startTime | where TimeGenerated < endTime | summarize arg_max(TimeGenerated, *)  by ContainerID2 = ContainerID, Name1=ContainerName | project ContainerID2 , Name1;
//now join the above 2 to get a 'jointed table' that has name, image & imagetag. Outer left is safer in-case there are no kubepod records are if they are latent
let ContainerData = ContainerInv | join kind=leftouter (KubePodInv) on $left.ContainerID1 == $right.ContainerID2;
//now join ContainerLog table with the 'jointed table' above and project-away redundant fields/columns and rename columns that were re-written
//Outer left is safer so you dont lose logs even if we cannot find container metadata for loglines (due to latency, time skew between data types etc...)
ContainerLog
| where TimeGenerated >= startTime and TimeGenerated < endTime 
| join kind= leftouter (
   ContainerData
) on $left.ContainerID == $right.ContainerID2 | project-away ContainerID1, ContainerID2, Name, Image, ImageTag | project-rename Name = Name1, Image=Image1, ImageTag=ImageTag1 

```

#### <a name="option-2"></a>Вариант 2

Снова включите сбор этих свойств для каждой строки в журналах контейнера.

Если первый вариант неудобен из-за необходимости изменять запросы, вы можете снова включить сбор этих полей, включив параметр ```log_collection_settings.enrich_container_logs``` в карте конфигурации агента, как описано в статье [Настройка сбора данных агентом для Azure Monitor для контейнеров](containers/container-insights-agent-config.md).

> [!NOTE]
> Мы не рекомендуем использовать второй вариант для больших кластеров (более 50 узлов), так как для этого обогащения создаются вызовы API сервера от каждого узла в кластере. Этот вариант также увеличивает размер данных для каждой собранной строки журнала.

### <a name="can-i-view-metrics-collected-in-grafana"></a>Можно ли просматривать собранные метрики в средстве Grafana?

Аналитика контейнеров поддерживает просмотр метрик, хранящихся в рабочей области Log Analytics, на панелях мониторинга Grafana. Мы создали шаблон, который можно скачать из [репозитория Grafana для панелей мониторинга](https://grafana.com/grafana/dashboards?dataSource=grafana-azure-monitor-datasource&category=docker), чтобы начать работу или уточнить, как выполнять запросы дополнительных данных из включенных в мониторинг кластеров для визуализации на пользовательских панелях мониторинга Grafana. 

### <a name="can-i-monitor-my-aks-engine-cluster-with-container-insights"></a>Можно ли отслеживать кластер AKS Engine с помощью Container Insights?

Служба "аналитика контейнеров" поддерживает мониторинг рабочих нагрузок контейнеров, развернутых в кластерах AKS Engine (ранее известных как ядро ACS), размещенных в Azure. Дополнительные сведения и общие сведения о шагах, необходимых для включения мониторинга в этом сценарии, см. в разделе [использование аналитики контейнеров для AKS-Engine](https://github.com/microsoft/OMS-docker/tree/aks-engine).

### <a name="why-dont-i-see-data-in-my-log-analytics-workspace"></a>Почему я не вижу данных в рабочей области Log Analytics?

Если данные в рабочей области Log Analytics отсутствуют в определенное время каждый день, возможно, срабатывает ежедневное ограничение по объему собираемых данных (500 МБ или другое настроенное значение). При достижении этого ограничения сбор данных прекращается и возобновляется только на следующий день. Инструкции о том, как просмотреть сведения об объемах потребления и с учетом этого изменить ценовую категорию, см. в статье [Управление потреблением и затратами с помощью журналов Azure Monitor](logs/manage-cost-storage.md). 

### <a name="what-are-the-container-states-specified-in-the-containerinventory-table"></a>Что означают состояния контейнеров, которые указаны в таблице ContainerInventory?

Таблица ContainerInventory содержит сведения об остановленных и запущенных контейнерах. Эта таблица заполняется рабочим процессом агента, который получает из docker полный список контейнеров (работающих и остановленных) и пересылает эти данные в рабочую область Log Analytics.
 
### <a name="how-do-i-resolve-missing-subscription-registration-error"></a>Как устранить ошибку *отсутствующей регистрации подписки*?

Если вы видите ошибку **Missing Subscription registration for Microsoft.OperationsManagement** (Отсутствует регистрация подписки для Microsoft.OperationsManagement), то для ее устранения зарегистрируйте поставщик ресурсов **Microsoft.OperationsManagement** в той подписке, где определена рабочая область. Документацию по этому процессу можно найти [здесь](../azure-resource-manager/templates/error-register-resource-provider.md).

### <a name="is-there-support-for-kubernetes-rbac-enabled-aks-clusters"></a>Поддерживается ли кластеры AKS с поддержкой Kubernetes RBAC?

Решение для мониторинга контейнеров не поддерживает Kubernetes RBAC, но поддерживается в контейнере аналитики. На странице сведений о решении может неправильно отображаться информация в колонках с данными о таких кластерах.

### <a name="how-do-i-enable-log-collection-for-containers-in-the-kube-system-namespace-through-helm"></a>Как включить сбор журналов для контейнеров в пространстве имен kube-system через Helm?

Сбор журналов из контейнеров в пространстве имен kube-system по умолчанию отключен. Вы можете включить сбор журналов, задав переменную среды для агента OMS. Дополнительные сведения см. на странице GitHub для [Container Insights](https://aka.ms/azuremonitor-containers-helm-chart) . 

### <a name="how-do-i-update-the-omsagent-to-the-latest-released-version"></a>Как обновить агент OMS до последней выпущенной версии?

Сведения об обновлении агента, см. в статье [Как управлять агентом Azure Monitor для контейнеров](containers/container-insights-manage-agent.md).

### <a name="why-are-log-lines-larger-than-16kb-split-into-multiple-records-in-log-analytics"></a>Почему строки журнала, превышающие 16 КБ, разбиваются на несколько записей Log Analytics?

Агент использует [драйвер регистрации файлов DOCKER JSON](https://docs.docker.com/config/containers/logging/json-file/) для записи stdout и stderr контейнеров. Этот драйвер ведения журнала разделяет строки журнала, [превышающие 16 КБ](https://github.com/moby/moby/pull/22982) , на несколько строк при копировании из stdout или stderr в файл.

### <a name="how-do-i-enable-multi-line-logging"></a>Как включить многострочное ведение журнала?

В настоящее время контейнерная аналитика не поддерживает многострочное ведение журнала, но Существуют обходные пути. Например, настройте вывод данных из всех служб в формате JSON, и тогда Docker/Moby будут сохранять эти данные в одну строку.

Следующий пример демонстрирует сохранение журнала в формате объекта JSON для тестового приложения node.js:

```
console.log(json.stringify({ 
      "Hello": "This example has multiple lines:",
      "Docker/Moby": "will not break this into multiple lines",
      "and you will receive":"all of them in log analytics",
      "as one": "log entry"
      }));
```

Когда вы запросите эти данные, в журналах Azure Monitor они будут выглядеть как в этом примере:

```
LogEntry : ({"Hello": "This example has multiple lines:","Docker/Moby": "will not break this into multiple lines", "and you will receive":"all of them in log analytics", "as one": "log entry"}

```

Подробное описание этого способа можно найти по [этой ссылке](https://github.com/moby/moby/issues/22920) на сайте GitHub.

### <a name="how-do-i-resolve-azure-ad-errors-when-i-enable-live-logs"></a>Как устранить ошибки AAD, возникающие при включении динамических журналов? 

Вы можете получать следующую ошибку: **The reply url specified in the request does not match the reply urls configured for the application: '<application ID\>'** . (Указанный в запросе URL-адрес ответа не соответствует URL-адресам ответа, настроенным для приложения: {идентификатор_приложения}). Решение для решения этой проблемы можно найти в статье [как просматривать данные контейнера в режиме реального времени с помощью Container Insights](containers/container-insights-livedata-setup.md#configure-ad-integrated-authentication). 

### <a name="why-cant-i-upgrade-cluster-after-onboarding"></a>Почему не удается обновить кластер после подключения?

Если после включения аналитики контейнера для кластера AKS вы удалите Log Analytics рабочую область, в которую кластер отправлял свои данные при попытке обновить кластер, произойдет сбой. Чтобы обойти эту проблему, придется сначала отключить мониторинг, а затем снова включить его с другой действующей рабочей областью в подписке. Тогда повторная попытка обновить кластер должна выполняться и завершаться успешно.  

### <a name="which-ports-and-domains-do-i-need-to-openallow-for-the-agent"></a>Какие порты и домены нужно открыть или разрешить для агента?

В разделе [Требования к брандмауэру в сети](containers/container-insights-onboard.md#network-firewall-requirements) указаны сведения о настройке прокси-сервера и брандмауэра, необходимой для использования контейнерного агента с облаками Azure, Azure для государственных организаций США и Azure для Китая (21Vianet).


## <a name="vm-insights"></a>Аналитика виртуальных машин

### <a name="can-i-onboard-to-an-existing-workspace"></a>Можно ли подключиться к существующей рабочей области?
Если виртуальные машины уже подключены к рабочей области Log Analytics, вы можете продолжать использовать эту рабочую область при подключении к службе "аналитика ВМ", если она находится в одном из [поддерживаемых регионов](vm/vminsights-configure-workspace.md#supported-regions).


### <a name="can-i-onboard-to-a-new-workspace"></a>Можно ли подключиться к новой рабочей области? 
Если на данный момент ваши виртуальные машины не подключены к существующей рабочей области Log Analytics, вам потребуется создать рабочую область для хранения ваших данных. Создание рабочей области по умолчанию выполняется автоматически, если вы настраиваете одну виртуальную машину Azure для получения сведений о виртуальной машине с помощью портал Azure.

Если вы решили использовать метод на основе сценария, эти действия описаны в статье [Включение аналитики виртуальной машины с помощью Azure PowerShell или диспетчер ресурсов шаблона](./vm/vminsights-enable-powershell.md) . 

### <a name="what-do-i-do-if-my-vm-is-already-reporting-to-an-existing-workspace"></a>Что делать, если виртуальная машина уже отправляет отчеты в существующую рабочую область?
Если вы уже собираете данные со своих виртуальных машин, возможно, вы уже настроили их для передачи отчетных данных в существующую рабочую область Log Analytics.  Пока эта Рабочая область находится в одном из наших поддерживаемых регионов, вы можете включить функцию "VM Insights" для уже существующей рабочей области.  Если Рабочая область, которую вы уже используете, не находится в одном из наших поддерживаемых регионов, вы не сможете подключиться к ней в настоящее время.  Мы активно работаем над поддержкой дополнительных регионов.


### <a name="why-did-my-vm-fail-to-onboard"></a>Почему не удалось подключить мою виртуальную машину?
При подключении виртуальной машины Azure на портале Azure выполняются указанные ниже действия.

* Система создает рабочую область Log Analytics, используемую по умолчанию, если был выбран соответствующий параметр.
* Если система определяет, что необходим агент Log Analytics, она устанавливает его на виртуальных машинах Azure, используя расширение виртуальной машины.  
* Агент зависимостей для карт VM Insights устанавливается на виртуальных машинах Azure с помощью расширения, если это необходимо. 

В процессе подключения мы проверяем состояние на каждом из указанных выше элементов, чтобы возвращать сведения о состоянии уведомления вам на портале. Настройка рабочей области и установка агента обычно занимает 5–10 минут. Просмотр данных мониторинга на портале потребует еще 5–10 минут.  

Если вы инициировали подключение, но после этого отображаются сообщения о том, что необходимо подключить виртуальную машину, подождите около 30 минут, пока виртуальная машина завершит процесс. 


### <a name="i-dont-see-some-or-any-data-in-the-performance-charts-for-my-vm"></a>На диаграммах производительности не отображаются некоторые или все данные для моей виртуальной машины
Наши диаграммы производительности были обновлены и теперь используют данные из таблицы *InsightsMetrics*.  Чтобы просмотреть данные на этих диаграммах, необходимо обновить систему для использования нового решения аналитики виртуальных машин.  Дополнительные сведения см. в статье [Часто задаваемые вопросы об Azure Monitor для виртуальных машин общедоступной версии](vm/vminsights-ga-release-faq.md).

Если данные о производительности не отображаются в таблице дисков или некоторых диаграммах производительности, возможно, в рабочей области не настроены счетчики производительности. Чтобы решить эту проблему, выполните указанный ниже [скрипт PowerShell](./vm/vminsights-enable-powershell.md).


### <a name="how-is-vm-insights-map-feature-different-from-service-map"></a>Чем функция Map Insights отличается от Сопоставление служб?
Функция карт VM Insights основана на Сопоставление служб, но имеет следующие отличия.

* Доступ к представлению "схема" можно получить в колонке "виртуальная машина" и "VM Insights" в разделе Azure Monitor.
* Теперь в функции "Схема" можно щелкать подключения и отображать представления с данными метрик подключений на боковой панели для выбранного подключения.
* Появился новый API, который используется для создания схем с целью улучшения поддержки сложных схем.
* Отслеживаемые виртуальные машины теперь включены в узел групп клиентов, а на кольцевой диаграмме показаны доли отслеживаемых и неотслеживаемых виртуальных машин в группе.  Теперь ее также можно использовать для фильтрации списка компьютеров при развертывании группы.
* Отслеживаемые виртуальные машины теперь включены в узлы групп портов серверов, а на кольцевой диаграмме показаны доли отслеживаемых и неотслеживаемых машин в группе.  Теперь ее также можно использовать для фильтрации списка компьютеров при развертывании группы.
* Стиль схем был обновлен, и теперь он больше соответствует схеме приложений в Application Insights.
* Боковые панели были обновлены и еще не обеспечивают интеграцию в той мере, в которой она поддерживалась в решении "Сопоставление служб" ("Управление обновлениями", "Отслеживание изменений", "Безопасность" и Service Desk). 
* Параметр для выбора групп и машин, которые необходимо сопоставить, был обновлен, и теперь поддерживает "Подписки", "Группы ресурсов", масштабируемые наборы виртуальных машин Azure и облачные службы.
* Вы не можете создать новые группы Сопоставление служб машины в функции карт VM Insights.  

### <a name="why-do-my-performance-charts-show-dotted-lines"></a>Почему диаграммы производительности отображаются пунктирными линиями?
Это может произойти по нескольким причинам.  В случаях, когда есть пробелы в собранных данных, мы отображаем строки пунктирной линией.  Если вы изменили частоту выборки данных для включенных счетчиков производительности (по умолчанию сбор данных выполняется каждые 60 секунд), на диаграмме могут отображаться пунктирные линии. Это происходит, если вы выбрали малый диапазон времени для диаграммы, а частота выборки меньше, чем размер сегмента, используемого в диаграмме (например, частота выборки составляет один раз в 10 минут, а каждый сегмент на диаграмме соответствует 5 минутам).  В этом случае, если вы выберете больший диапазон времени для отображения, линии диаграммы должны вновь стать сплошными.

### <a name="are-groups-supported-with-vm-insights"></a>Поддерживаются ли группы для VM Insights?
Да, после установки агента зависимостей мы собираем сведения с виртуальных машин для отображения групп в зависимости от подписки, группы ресурсов, масштабируемых наборов виртуальных машин и облачных служб.  Если вы используете Сопоставление служб и создали группы компьютеров, они также отображаются.  Группы компьютеров также появятся в фильтре групп, если они были созданы для просматриваемой рабочей области. 

### <a name="how-do-i-see-the-details-for-what-is-driving-the-95th-percentile-line-in-the-aggregate-performance-charts"></a>Как отобразить сведения о факторах, влияющих на линию 95-го процентиля на агрегированных диаграммах производительности?
По умолчанию список отсортирован так, что в нем отображаются виртуальные машины с самым большим значением для 95-го процентиля для выбранной метрики. Исключение составляет диаграмма "Доступная память", на которой показаны компьютеры с самым маленьким значением 5-го процентиля.  Если щелкнуть диаграмму, откроется представление со списком компьютеров с **лучшими параметрами**.

### <a name="how-does-the-map-feature-handle-duplicate-ips-across-different-vnets-and-subnets"></a>Как функция "Схема" обрабатывает дублирующиеся IP-адреса в разных виртуальных сетях и подсетях?
Если вы дублируете диапазоны IP-адресов с виртуальными машинами или масштабируемыми наборами виртуальных машин Azure в подсетях и виртуальных сетей, это может привести к отображению неправильных данных на карте аналитики VM. Это известная проблема, и мы работаем над ее решением.

### <a name="does-map-feature-support-ipv6"></a>Поддерживает ли функция "Схема" протокол IPv6?
На данный момент функция "Схема" поддерживает только протокол IPv4, но мы работаем над поддержкой протокола IPv6. Мы также поддерживаем протокол IPv4, туннелируемый через протокол IPv6.

### <a name="when-i-load-a-map-for-a-resource-group-or-other-large-group-the-map-is-difficult-to-view"></a>Когда я загружаю схему для группы ресурсов или другой большой группы, становится трудно просматривать схему
Несмотря на то что мы усовершенствовали функцию "Схема" в части отображения больших и сложных конфигураций, мы понимаем, что на схеме может быть много узлов, подключений и узлов, работающих как кластеры.  Мы намерены продолжать работу над улучшением функции масштабирования.   

### <a name="why-does-the-network-chart-on-the-performance-tab-look-different-than-the-network-chart-on-the-azure-vm-overview-page"></a>Почему внешний вид диаграммы сети на вкладке "Производительность" отличается от внешнего вида диаграммы сети на странице общих сведений о виртуальной машине Azure?

На странице общих сведений о виртуальной машине Azure отображаются диаграммы, основанные на измерениях активности гостевой виртуальной машины, выполняемых узлом.  На диаграмме сети на странице общих сведений о виртуальной машине Azure отображается только сетевой трафик, за который будет выставлен счет.  Здесь не учитывается трафик между виртуальными сетями.  Данные и диаграммы, показанные для Application Insights, основываются на данных, полученных от гостевой виртуальной машины, и на диаграмме сети отображается весь входящий и исходящий трафик TCP/IP для этой виртуальной машины, включая взаимную виртуальную сеть.

### <a name="how-is-response-time-measured-for-data-stored-in-vmconnection-and-displayed-in-the-connection-panel-and-workbooks"></a>Как измеряется время отклика для данных, хранящихся в VMConnection и отображаемых на панели подключения и в книгах?

Время отклика оценивается приближенно. Поскольку мы не инструментируем код приложения, то не имеем точных данных о времени начала запроса и поступления ответа. Вместо этого мы отслеживаем данные, отправляемые через подключение и поступающие обратно. Наш агент отслеживает операции отправки и получения и пытается сопоставлять их, то есть последовательность операций отправки и следующая за ней последовательность операций получения интерпретируется как пара "запрос — ответ". Интервал между этими операциями и принимается за время ответа. Он будет учитывать задержку в сети и время обработки на сервере.

Это приближение хорошо работает для протоколов, основанных на механизме запросов и ответов, когда через подключение отправляется ровно один запрос и получается ровно один ответ. Это справедливо для HTTP(S) (без конвейеризации), но не для других протоколов.

### <a name="are-there-limitations-if-i-am-on-the-log-analytics-free-pricing-plan"></a>Существуют ли ограничения, если я использую план бесплатного ценообразования Log Analytics?
Если вы настроили Azure Monitor с рабочей областью Log Analytics с помощью ценовой категории " *бесплатный* ", функция "Map Insights" будет поддерживать только пять подключенных компьютеров, подключенных к рабочей области. Если к бесплатной рабочей области подключено пять виртуальных машин, после отключения одной виртуальной машины и последующего подключения новой виртуальной машины эта новая виртуальная машина не будет отслеживаться и отображаться на странице сопоставления.  

В этом случае отобразится предложение **Попробовать сейчас** при открытии виртуальной машины и выборе функции **Аналитические сведения** в области слева, даже если эта функция ранее была установлена на виртуальной машине.  Однако в случае, если эта виртуальная машина не подключена к службе "аналитика ВИРТУАЛЬНЫХ машин", вы не получите запрос с параметрами. 

## <a name="sql-insights-preview"></a>SQL Insights (Предварительная версия)

### <a name="what-versions-of-sql-server-are-supported"></a>Какие версии SQL Server поддерживаются?
Мы поддерживаем SQL Server 2012 и все более новые версии. Дополнительные сведения см. в разделе [Поддерживаемые версии](insights/sql-insights-overview.md#supported-versions) .

### <a name="what-sql-resource-types-are-supported"></a>Какие типы ресурсов SQL поддерживаются?
- База данных SQL Azure
- Управляемый экземпляр SQL Azure
- SQL Server на виртуальных машинах Azure (SQL Server, работающих на виртуальных машинах, зарегистрированных с помощью поставщика [виртуальных машин SQL](../azure-sql/virtual-machines/windows/sql-agent-extension-manually-register-single-vm.md) )
- Виртуальные машины Azure (SQL Server, работающие на виртуальных машинах, не зарегистрированных в поставщике [виртуальных машин SQL](../azure-sql/virtual-machines/windows/sql-agent-extension-manually-register-single-vm.md) )

Дополнительные сведения см. в разделе [Поддерживаемые версии](insights/sql-insights-overview.md#supported-versions) . для получения дополнительных сведений о сценариях без поддержки или ограниченной поддержки.

### <a name="what-operating-systems-for-the-virtual-machine-running-sql-server-are-supported"></a>Какие операционные системы для виртуальной машины, на которой работает SQL Server, поддерживаются?
Мы поддерживаем все операционные системы, указанные в документации [Windows](../azure-sql/virtual-machines/windows/sql-server-on-azure-vm-iaas-what-is-overview.md#get-started-with-sql-server-vms) и [Linux](../azure-sql/virtual-machines/linux/sql-server-on-linux-vm-what-is-iaas-overview.md#create) , для SQL Server на виртуальных машинах Azure.

### <a name="what-operating-system-for-the-monitoring-virtual-machine-are-supported"></a>Какая операционная система для виртуальной машины мониторинга поддерживается?
Ubuntu 18,04 в настоящее время является единственной операционной системой, поддерживаемой для виртуальной машины мониторинга.

### <a name="where-will-the-monitoring-data-be-stored-in-log-analytics"></a>Где данные мониторинга будут храниться в Log Analytics?
Все данные мониторинга хранятся в таблице **инсигхтсметрикс** . **Исходный** столбец имеет значение `solutions.azm.ms/telegraf/SqlInsights` . Столбец **пространства имен** содержит значения, начинающиеся с `sqlserver_` .

### <a name="how-often-is-data-collected"></a>Как часто собираются данные? 
Периодичность сбора данных настраивается. Дополнительные сведения о частоте по умолчанию см. в разделе [данные, собранные SQL Insights](../insights/../azure-monitor/insights/sql-insights-overview.md#data-collected-by-sql-insights) , в статье [Создание профиля мониторинга SQL](../insights/../azure-monitor/insights/sql-insights-enable.md#create-sql-monitoring-profile) для получения инструкций по настройке частот. 

## <a name="next-steps"></a>Дальнейшие действия
Если вы не нашли ответа на свой вопрос в этой статье, поищите информацию на следующих форумах.

- [Служба Log Analytics](/answers/topics/azure-monitor.html)
- [Application Insights](/answers/topics/azure-monitor.html)

Поделиться общим впечатлением о службе Azure Monitor можно на [этом форуме](https://feedback.azure.com/forums/34192--general-feedback).
