---
title: Создание групп действий и управление ими на портале Azure
description: Узнайте, как создавать группы действий и управлять ими на портале Azure.
author: dkamstra
ms.topic: conceptual
ms.date: 01/28/2021
ms.author: dukek
ms.subservice: alerts
ms.openlocfilehash: 08cf66edaa67ab1853a3b246afb9364b431445c6
ms.sourcegitcommit: d1e56036f3ecb79bfbdb2d6a84e6932ee6a0830e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/29/2021
ms.locfileid: "99055116"
---
# <a name="create-and-manage-action-groups-in-the-azure-portal"></a>Создание групп действий и управление ими на портале Azure
Группа действий — это коллекция параметров уведомлений, которые определены владельцем подписки Azure. Оповещения служб Azure Monitor и "Работоспособность служб" используют группы действий для уведомления пользователей о том, что оповещение активировано. Для разных оповещений может использоваться как одна группа действий, так разные. Это зависит от требований пользователя. 

В этой статье показано, как создавать группы действий и управлять ими на портале Azure.

Каждое действие состоит из следующих свойств:

* **Тип**: уведомление или действие выполнено. Примеры включают отправку голосового звонка, текстовое сообщение, сообщение электронной почты или активацию различных типов автоматических действий. Типы приведены далее в этой статье.
* **Name** (Имя). уникальный идентификатор в группе действий.
* **Сведения**: соответствующие сведения, зависящие от *типа*.

Дополнительные сведения о настройке групп действий с помощью шаблонов Azure Resource Manager см. в статье [Создание группы действий с помощью шаблона Resource Manager](./action-groups-create-resource-manager-template.md).

## <a name="create-an-action-group-by-using-the-azure-portal"></a>Создание группы действий с помощью портала Azure

1. На [портале Azure](https://portal.azure.com) найдите и выберите область **Монитор**. В области **Монитор** объединены все параметры мониторинга и данные.

1. Выберите **оповещения**, а затем щелкните **Управление действиями**.

    ![Кнопка "Управление действиями"](./media/action-groups/manage-action-groups.png)
    
1. Выберите **Добавить группу действий** и заполните соответствующие поля в интерфейсе мастера.

    ![Команда Add action group (Добавить группу действий)](./media/action-groups/add-action-group.PNG)

### <a name="configure-basic-action-group-settings"></a>Настройка основных параметров группы действий

В разделе **сведения о проекте**:

Выберите **подписку** и **группу ресурсов** , в которых будет сохранена группа действий.

В разделе **Сведения об экземпляре**:

1. Введите **имя группы действий**.

1. Введите **Отображаемое имя**. Отображаемое имя используется вместо полного имени группы действий при отправке уведомлений с помощью этой группы.

      ![Диалоговое окно Add action group (Добавить группу действий)](./media/action-groups/action-group-1-basics.png)


### <a name="configure-notifications"></a>Настройка уведомлений

1. Нажмите кнопку **Далее: уведомления >** , чтобы перейти на вкладку **уведомления** , или выберите вкладку **уведомления** в верхней части экрана.

1. Определяет список уведомлений для отправки при срабатывании оповещения. Для каждого уведомления укажите следующие сведения:

    a. **Тип уведомления**: выберите тип уведомления, которое вы хотите отправить. Доступны следующие параметры:
      * Роль Azure Resource Manager электронной почты — отправка сообщения электронной почты пользователям, которым назначены определенные роли ARM уровня подписки.
      * Электронная почта, SMS/Push/Voice — отправка этих типов уведомлений конкретным получателям.
    
    b. **Имя**: введите уникальное имя для уведомления.

    c. **Сведения**: в зависимости от выбранного типа уведомления введите адрес электронной почты, номер телефона и т. д.
    
    d. **Общая схема оповещений** Можно включить [общую схему оповещений](./alerts-common-schema.md), которая дает преимущества единых расширяемых и унифицированных полезных данных оповещений во всех службах оповещений в Azure Monitor.

    ![Вкладка "уведомления"](./media/action-groups/action-group-2-notifications.png)
    
### <a name="configure-actions"></a>Настройка действий

1. Нажмите кнопку **Далее: действия >** , чтобы перейти на вкладку **действия** , или выберите вкладку **действия** в верхней части экрана.

1. Определите список действий, которые необходимо активировать при срабатывании оповещения. Для каждого действия укажите следующие сведения.

    a. **Тип действия**: выберите автоматизацию Runbook, функцию Azure, ITSM, приложение логики, безопасный веб-перехватчик, веб-перехватчик.
    
    b. **Имя**: введите уникальное имя для действия.

    c. **Сведения**: в зависимости от типа действия введите URI веб-перехватчика, приложение Azure, подключение ITSM или Runbook службы автоматизации. Для действия ITSM дополнительно укажите **рабочий элемент** и заполните другие поля, требуемые инструментом ITSM.
    
    d. **Общая схема оповещений** Можно включить [общую схему оповещений](./alerts-common-schema.md), которая дает преимущества единых расширяемых и унифицированных полезных данных оповещений во всех службах оповещений в Azure Monitor.
    
    ![Вкладка «действия»](./media/action-groups/action-group-3-actions.png)

### <a name="create-the-action-group"></a>Создание группы действий

1. При желании можно изучить параметр **Теги**. Это позволяет связать пары "ключ-значение" с группой действий для вашей классификации и является функцией, доступной для любого ресурса Azure.

    ![Вкладка «Теги»](./media/action-groups/action-group-4-tags.png)
    
1. Нажмите **Просмотр и создание**, чтобы просмотреть параметры. Это обеспечит быструю проверку входных данных, чтобы убедиться, что выбраны все обязательные поля. При наличии проблем здесь отобразятся сведения о них. После просмотра параметров нажмите кнопку **создать** для подготовки группы действий.
    
    ![Вкладка "Проверка и создание"](./media/action-groups/action-group-5-review.png)

> [!NOTE]
> Когда вы настраиваете действие для уведомления пользователя по электронной почте или SMS, оно получает подтверждение о том, что они были добавлены в группу действий.

## <a name="manage-your-action-groups"></a>Управление группами действий

После создания группы действий можно просмотреть **группы действий**, выбрав **Управление действиями** на целевой странице **Оповещения** в области **Монитор**. Выберите группу действий, которой необходимо управлять:

* добавлять, изменять или удалять действия;
* удалить группу действий.

## <a name="action-specific-information"></a>Сведения о конкретных действиях

> [!NOTE]
> Количественные ограничения для каждого из перечисленных ниже пунктов приведены в разделе [Ограничения Azure Monitor](../../azure-resource-manager/management/azure-subscription-service-limits.md#azure-monitor-limits).  

### <a name="automation-runbook"></a>Runbook автоматизации
Дополнительные сведения об ограничениях для полезных данных runbook см. в статье [Подписка Azure, границы, квоты и ограничения службы](../../azure-resource-manager/management/azure-subscription-service-limits.md).

В группе действий может быть ограниченное число действий runbook. 

### <a name="azure-app-push-notifications"></a>Push-уведомления приложения Azure
В группе действий может быть ограниченное число действий приложения Azure.

### <a name="email"></a>Email
Электронная почта будет отправляться на следующие адреса (правильно настройте фильтрацию электронной почты):
- azure-noreply@microsoft.com
- azureemail-noreply@microsoft.com
- alerts-noreply@mail.windowsazure.com

В группе действий может быть ограниченное число действий электронной почты. Дополнительные сведения см. в статье [Ограничение частоты отправки для голосовых сообщений, SMS-сообщений, сообщений электронной почты, push-уведомлений приложений Azure и записей веб-перехватчиков](./alerts-rate-limiting.md).

### <a name="email-azure-resource-manager-role"></a>Роль Azure Resource Manager по электронной почте
Электронное сообщение отправляется членам роли подписки. Электронное сообщение будет отправлено только членам роли **пользователя Azure AD**. Сообщение электронной почты будет отправлено группам или субъектам-служб Azure AD.

Уведомление по электронной почте отправляется только на *основной адрес электронной почты* .

Если вы не получаете уведомления по *основному адресу электронной почты*, то можете выполнить следующие действия.

1. В портал Azure перейдите в *Active Directory*.
2. Щелкните все пользователи (в левой области), и вы увидите список пользователей (в правой области).
3. Выберите пользователя, для которого необходимо ознакомиться с основной информацией *электронной почты* .

  :::image type="content" source="media/action-groups/active-directory-user-profile.png" alt-text="Пример проверки профиля пользователя."border="true":::

4. В профиле пользователя в разделе Контактные данные, если вкладка "Электронная почта" пуста, нажмите кнопку " *изменить* " вверху и добавьте *основной адрес электронной почты* и нажмите кнопку " *сохранить* " вверху.

  :::image type="content" source="media/action-groups/active-directory-add-primary-email.png" alt-text="Пример добавления основного адреса электронной почты."border="true":::

В группе действий может быть ограниченное число действий электронной почты. Дополнительные сведения см. в статье [Ограничение частоты отправки для голосовых сообщений, SMS-сообщений, сообщений электронной почты, push-уведомлений приложений Azure и записей веб-перехватчиков](./alerts-rate-limiting.md).

### <a name="function"></a>Компонент
Вызывает существующую конечную точку триггера HTTP в [Функциях Azure](../../azure-functions/functions-get-started.md).

В группе действий может быть ограниченное число действий Функций.

### <a name="itsm"></a>ITSM
Действие ITSM требует подключения ITSM. Дополнительные сведения о создании подключения ITSM см. в статье [Централизованное управление рабочими элементами ITSM с помощью соединителя управления ИТ-службами (предварительная версия)](./itsmc-overview.md).

В группе действий может быть ограниченное число действий ITSM. 

### <a name="logic-app"></a>приложение логики;
В группе действий может быть ограниченное число действий приложения логики.

### <a name="secure-webhook"></a>Безопасный веб-перехватчик

> [!NOTE]
> Для использования действия веб-перехватчика требуется, чтобы конечная точка веб-перехватчика не требовала успешного функционирования сведений о предупреждении или не была способна выполнить синтаксический анализ сведений о контексте предупреждения, предоставленных в ходе операции POST. Если конечная точка веб-перехватчика не может самостоятельно обрабатывать сведения о контексте предупреждения, можно использовать такое решение, как [действие приложения логики](./action-groups-logic-app.md) , для пользовательской обработки сведений о контексте предупреждения в соответствии с ожидаемым форматом данных веб-перехватчика.
> Чтобы убедиться, что безопасность не нарушена, пользователь должен быть **владельцем** субъекта-службы веб-перехватчика. Так как любой клиент Azure может получить доступ ко всем идентификаторам объектов через портал, не проверяя владельца, любой пользователь может добавить этот веб-перехватчик в собственную группу действий для уведомления об оповещениях Azure Monitor, что нарушает безопасность.

Действие веб-перехватчика группы действий позволяет воспользоваться преимуществами Azure Active Directory для защиты подключения между группой действий и защищенным веб-API (конечной точкой веб-перехватчика). Ниже описана общая процедура использования этой функции. Общие сведения о приложениях и субъектах-службах Azure AD см. в статье [Общие сведения о платформе удостоверений Майкрософт версии 2.0](../../active-directory/develop/v2-overview.md).

1. Создайте приложение Azure AD для защищенного веб-API. См. раздел [защищенный веб-API: регистрация приложения](../../active-directory/develop/scenario-protected-web-api-app-registration.md).
    - Настройте защищенный API, который будет [вызываться приложением демона](../../active-directory/develop/scenario-protected-web-api-app-registration.md#if-your-web-api-is-called-by-a-daemon-app).
    
2. Включите группы действий для использования приложения Azure AD.

    > [!NOTE]
    > Для выполнения этого сценария необходимо быть членом [роли администратора приложения Azure AD](../../active-directory/roles/permissions-reference.md#available-roles).
    
    - Измените вызов Connect-AzureAD в сценарии PowerShell, чтобы использовать свой идентификатор арендатора Azure AD.
    - Измените переменную скрипта PowerShell $myAzureADApplicationObjectId, чтобы использовать идентификатор объекта приложения Azure AD.
    - Запустите измененный сценарий.
    
3. Настройте действие безопасного веб-перехватчика группы действий.
    - Скопируйте значение $myApp.ObjectId из сценария и введите его в поле идентификатора объекта приложения в определении действия веб-перехватчика.
    
    ![Безопасное действие веб-перехватчика](./media/action-groups/action-groups-secure-webhook.png)

#### <a name="secure-webhook-powershell-script"></a>Сценарий PowerShell безопасного веб-перехватчика

```PowerShell
Connect-AzureAD -TenantId "<provide your Azure AD tenant ID here>"
    
# This is your Azure AD Application's ObjectId. 
$myAzureADApplicationObjectId = "<the Object Id of your Azure AD Application>"
    
# This is the Action Groups Azure AD AppId
$actionGroupsAppId = "461e8683-5575-4561-ac7f-899cc907d62a"
    
# This is the name of the new role we will add to your Azure AD Application
$actionGroupRoleName = "ActionGroupsSecureWebhook"
    
# Create an application role of given name and description
Function CreateAppRole([string] $Name, [string] $Description)
{
    $appRole = New-Object Microsoft.Open.AzureAD.Model.AppRole
    $appRole.AllowedMemberTypes = New-Object System.Collections.Generic.List[string]
    $appRole.AllowedMemberTypes.Add("Application");
    $appRole.DisplayName = $Name
    $appRole.Id = New-Guid
    $appRole.IsEnabled = $true
    $appRole.Description = $Description
    $appRole.Value = $Name;
    return $appRole
}
    
# Get my Azure AD Application, it's roles and service principal
$myApp = Get-AzureADApplication -ObjectId $myAzureADApplicationObjectId
$myAppRoles = $myApp.AppRoles
$actionGroupsSP = Get-AzureADServicePrincipal -Filter ("appId eq '" + $actionGroupsAppId + "'")

Write-Host "App Roles before addition of new role.."
Write-Host $myAppRoles
    
# Create the role if it doesn't exist
if ($myAppRoles -match "ActionGroupsSecureWebhook")
{
    Write-Host "The Action Groups role is already defined.`n"
}
else
{
    $myServicePrincipal = Get-AzureADServicePrincipal -Filter ("appId eq '" + $myApp.AppId + "'")
    
    # Add our new role to the Azure AD Application
    $newRole = CreateAppRole -Name $actionGroupRoleName -Description "This is a role for Action Groups to join"
    $myAppRoles.Add($newRole)
    Set-AzureADApplication -ObjectId $myApp.ObjectId -AppRoles $myAppRoles
}
    
# Create the service principal if it doesn't exist
if ($actionGroupsSP -match "AzNS AAD Webhook")
{
    Write-Host "The Service principal is already defined.`n"
}
else
{
    # Create a service principal for the Action Groups Azure AD Application and add it to the role
    $actionGroupsSP = New-AzureADServicePrincipal -AppId $actionGroupsAppId
}
    
New-AzureADServiceAppRoleAssignment -Id $myApp.AppRoles[0].Id -ResourceId $myServicePrincipal.ObjectId -ObjectId $actionGroupsSP.ObjectId -PrincipalId $actionGroupsSP.ObjectId
    
Write-Host "My Azure AD Application ($myApp.ObjectId): " + $myApp.ObjectId
Write-Host "My Azure AD Application's Roles"
Write-Host $myApp.AppRoles
```

### <a name="sms"></a>SMS
Дополнительные важные сведения см. в разделах [Ограничение частоты отправки для голосовых сообщений, SMS-сообщений, сообщений электронной почты, push-уведомлений приложений Azure и записей веб-перехватчиков](./alerts-rate-limiting.md) и [Поведение SMS-оповещений в группе действий](./alerts-sms-behavior.md). 

В группе действий может быть ограниченное число действий SMS.

> [!NOTE]
> Если пользовательский интерфейс группы действий на портале Azure не позволяет выбрать ваш код страны или региона, то функция отправки SMS для вашей страны или региона не поддерживается.  Если код страны или региона недоступен, можно проголосовать за добавление вашей страны или региона на портале [User Voice](https://feedback.azure.com/forums/913690-azure-monitor/suggestions/36663181-add-more-country-codes-for-sms-alerting-and-voice). А пока в качестве обходного пути можно настроить группу действий так, чтобы она вызывала веб-перехватчик для стороннего поставщика SMS, который поддерживает вашу страны или регион.  

Цены для поддерживаемых страны и регионов перечислены на [странице цен на Azure Monitor](https://azure.microsoft.com/pricing/details/monitor/).

**Список стран, в которых поддерживается SMS-уведомления**

| код страны; | Название страны |
|:---|:---|
| 61 | Австралия |
| 43 | Австрия |
| 32 | Бельгия |
| 55 | Бразилия |
| 1 |Канада |
| 56 | Чили |
| 86 | Китай |
| 420 | Чешская Республика |
| 45 | Дания |
| 372 | Эстония |
| 358 | Финляндия |
| 33 | Франция |
| 49 | Германия |
| 852 | Гонконг, САР |
| 91 | Индия |
| 353 | Ирландия |
| 972 | Израиль |
| 39 | Италия |
| 81 | Япония |
| 352 | Люксембург |
| 60 | Малайзия |
| 52 | Мексика |
| 31 | Нидерланды |
| 64 | Новая Зеландия |
| 47 | Норвегия |
| 351 | Португалия |
| 1 | Пуэрто-Рико |
| 40 | Румыния |
| 65 | Сингапур |
| 27 | ЮАР |
| 82 | Южная Корея |
| 34 | Испания |
| 41 | Швейцария |
| 886 | Тайвань |
| 44 | Соединенное Королевство |
| 1 | США |

### <a name="voice"></a>Голосовая связь
Дополнительные важные сведения о поведении см. в статье [Ограничение частоты отправки для голосовых сообщений, SMS-сообщений, сообщений электронной почты, push-уведомлений приложений Azure и записей веб-перехватчиков](./alerts-rate-limiting.md).

В группе действий может быть ограниченное число голосовых действий.

> [!NOTE]
> Если пользовательский интерфейс группы действий на портале Azure не позволяет выбрать ваш код страны или региона, то голосовые звонки для вашей страны или региона не поддерживаются. Если код страны или региона недоступен, можно проголосовать за добавление вашей страны или региона на портале [User Voice](https://feedback.azure.com/forums/913690-azure-monitor/suggestions/36663181-add-more-country-codes-for-sms-alerting-and-voice).  А пока в качестве обходного пути можно настроить группу действий так, чтобы она вызывала веб-перехватчик для стороннего поставщика голосовой связи, который поддерживает вашу страны или регион.  
> Только код страны, поддерживаемый сегодня в портал Azure группе действий для уведомления о Голосове, — + 1 (США). 

Цены для поддерживаемых страны и регионов перечислены на [странице цен на Azure Monitor](https://azure.microsoft.com/pricing/details/monitor/).

### <a name="webhook"></a>webhook

> [!NOTE]
> Для использования действия веб-перехватчика требуется, чтобы конечная точка веб-перехватчика не требовала успешного функционирования сведений о предупреждении или не была способна выполнить синтаксический анализ сведений о контексте предупреждения, предоставленных в ходе операции POST. Если конечная точка веб-перехватчика не может самостоятельно обрабатывать сведения о контексте предупреждения, можно использовать такое решение, как [действие приложения логики](./action-groups-logic-app.md) , для пользовательской обработки сведений о контексте предупреждения в соответствии с ожидаемым форматом данных веб-перехватчика.

Веб-перехватчики обрабатываются с использованием следующих правил
- Число попыток вызова веб-перехватчика не более 3 раз.
- Вызов будет повторен, если ответ не получен в течение периода ожидания или возвращен один из следующих кодов состояния HTTP: 408, 429, 503 или 504.
- Первый вызов будет ожидать ответа в течение 10 секунд.
- Вторая и третья попытки будут ожидать ответа в течение 30 секунд.
- После 3 попыток вызова веб-перехватчика группа действий не будет вызывать конечную точку в течение 15 минут.

См. раздел [IP-адреса группы действий](../app/ip-addresses.md) для диапазонов исходных IP-адресов.


## <a name="next-steps"></a>Дальнейшие действия
* Дополнительные сведения о поведении SMS-оповещений в группе действий см. в [этой статье](./alerts-sms-behavior.md).  
* Узнайте о [схеме веб-перехватчика для оповещений журнала действий](./activity-log-alerts-webhook.md).  
* Дополнительные сведения о [соединитель ITSM](./itsmc-overview.md).
* Дополнительные сведения о лимитах для оповещений см. в статье [Ограничение частоты отправки для SMS, сообщений электронной почты и вызовов Webhook](./alerts-rate-limiting.md).
* Изучите [обзор оповещений журнала действий](./alerts-overview.md) и узнайте, как получать оповещения.  
* Узнайте, как [настроить оповещения при поступлении уведомлений о работоспособности службы](../../service-health/alerts-activity-log-service-notifications-portal.md).
