---
title: Реагирование на события с помощью оповещений Azure Log Analytics | Документы Майкрософт
description: В этом руководстве вы ознакомитесь с основными принципами оповещений в Log Analytics, которые позволяют обнаружить важную информацию в рабочей области и уведомлять о возникших проблемах или вызывать автоматические действия для их устранения.
ms.subservice: logs
ms.topic: tutorial
author: bwren
ms.author: bwren
ms.date: 10/05/2018
ms.custom: mvc
ms.openlocfilehash: e790486758d6a5e3181df01f85e1213cca3fa12d
ms.sourcegitcommit: e559daa1f7115d703bfa1b87da1cf267bf6ae9e8
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/17/2021
ms.locfileid: "100598214"
---
# <a name="respond-to-events-with-azure-monitor-alerts"></a>Реагирование на события с помощью оповещений Azure Monitor
Оповещения Azure Monitor позволяют обнаружить важную информацию о репозитории Log Analytics. Они создаются правилами генерации оповещений, которые автоматически через регулярные интервалы выполняют поиск по журналам и, если результаты поиска по журналу соответствуют конкретным условиям, создают запись оповещения (для которой можно настроить автоматическое ответное действие).  Эта статья является продолжением руководства по [созданию и совместному использованию панелей мониторинга данных Log Analytics](../learn/tutorial-logs-dashboards.md).   

В этом руководстве описано следующее.

> [!div class="checklist"]
> * Создание правила оповещения
> * Настройка группы действий для отправки уведомлений по электронной почте

Для выполнения примера в этом руководстве требуется виртуальная машина [, подключенная к рабочей области Log Analytics](../vm/quick-collect-azurevm.md).  

## <a name="sign-in-to-azure-portal"></a>Вход на портал Azure
Войдите на портал Azure по адресу [https://portal.azure.com](https://portal.azure.com). 

## <a name="create-alerts"></a>Создание оповещений
Оповещения создаются в Azure Monitor с помощью правил генерации оповещений и позволяют автоматически через регулярные интервалы выполнять сохраненные запросы или настраиваемые поиски по журналам.  Можно создать оповещения, основанные на конкретных метках производительности, создании конкретных событий, отсутствии события или создании ряда событий за определенный период.  Например, оповещения могут содержать информацию о том, что средняя загрузка ЦП превышает определенный порог, существует неустановленное обновление или создано событие, свидетельствующее об отсутствии запущенной службы Windows или управляющей программы Linux.  Если результаты поиска по журналам соответствуют определенным условиям, создается оповещение. После этого правило может автоматически запустить одно или несколько действий, например уведомить вас об оповещении либо вызвать другой процесс. 

В следующем примере создается правило генерации оповещений по измерению метрик, основанное на запросе *Виртуальные машины Azure — загрузка процессора*, который вы сохранили при работе с [руководством по визуализации данных](../learn/tutorial-logs-dashboards.md).  Оповещение создается для каждой виртуальной машины, на которой превышено пороговое значение 90 %.  

1. На портале Azure щелкните **Все службы**. В списке ресурсов введите **Log Analytics**. Как только вы начнете вводить символы, список отфильтруется соответствующим образом. Выберите **Log Analytics**.
2. На панели слева выберите **Оповещения** и щелкните **Новое правило генерации оповещений** в верхней части страницы, чтобы создать оповещение.<br><br> ![Создание правила генерации оповещений](./media/tutorial-response/alert-rule-02.png)<br>
3. Сначала выберите в разделе **Создать оповещение** рабочую область Log Analytics в качестве ресурса, так как мы создаем сигнал оповещения на основе журналов.  Если у вас несколько подписок, отфильтруйте результаты, выбрав из раскрывающегося списка конкретную **подписку**, содержащую виртуальную машину и рабочую область Log Analytics, которые вы создали ранее.  Отфильтруйте по **типу ресурса**, выбрав **Log Analytics** из раскрывающегося списка.  Наконец, выберите **Ресурс** **DefaultLAWorkspace** и щелкните **Готово**.<br><br> ![Создание оповещения, шаг 1](./media/tutorial-response/alert-rule-03.png)<br>
4. В разделе **Критерии оповещения** щелкните **Добавить критерии**, чтобы выбрать сохраненный запрос, а затем настройте логику для этого правила генерации оповещений.  На панели **Настроить логику сигналов** выберите *Виртуальные машины Azure — загрузка процессора* из списка.  Панель обновится и на ней появятся параметры конфигурации для оповещения.  В верхней части отображаются результаты за последние 30 минут для выбранного сигнала и сам поисковый запрос.  
5. Настройте оповещение, указав следующие сведения:  
   а. В раскрывающемся списке **На основе** выберите **Измерение метрик**.  Измерение метрик позволяет создать оповещение для каждого объекта в запросе, для которого значение превышает указанное пороговое значение.  
   b. В поле **Условие** выберите **Больше чем** и введите **90** в поле **Пороговое значение**.  
   c. В поле "Условие срабатывания предупреждения" выберите **Последовательные бреши**, в раскрывающемся списке выберите **Больше чем** и введите значение 3.  
   d. В разделе "Вычисляется на основе" задайте для параметра **Период (в минутах)** значение **30**. Это правило будет запускаться каждые пять минут и возвращать все записи, созданные за последние тридцать минут.  Установка большего периода потенциально может привести к задержкам при передаче данных, но в то же время гарантирует, что запрос всегда будет возвращать данные. Это, в свою очередь, позволит избежать ложноотрицательных результатов, при которых оповещение не срабатывает.  
6. Щелкните **Готово**, чтобы завершить создание правила генерации оповещений.<br><br> ![Настройка сигнала оповещения](./media/tutorial-response/alert-signal-logic-02.png)<br> 
7. Теперь переходите ко второму шагу, на котором следует предоставить имя для оповещения в поле **Имя правила генерации оповещений**, например **Загрузка ЦП выше 90 процентов**.  Укажите подробное **описание** для оповещения и выберите уровень **Критический (уровень серьезности 0)** из представленных в поле **Серьезность** вариантов.<br><br> ![Указание подробных сведений об оповещении](./media/tutorial-response/alert-signal-logic-04.png)<br>
8. Чтобы правило генерации оповещений начало работать сразу после создания, сохраните установленный по умолчанию флажок **Включить правило при создании**.
9. На последнем, третьем, шаге укажите **группу действий**, которая позволит гарантировать выполнение одинаковых действий всякий раз, когда активируется это оповещение. Эту функцию можно использовать для каждого созданного правила.  Настройте новую группу действий со следующими параметрами:  
   а. Выберите **Новая группа действий**, чтобы открыть панель **Добавить группу действий**.  
   b. В поле **Имя группы действий** укажите имя, например **Уведомление ИТ-отдела**, и **короткое имя**, например **itops-n**.  
   c. Убедитесь, что в полях **Подписка** и **Группа ресурсов** заданы правильные значения по умолчанию. Если нет, выберите правильные варианты из раскрывающегося списка.   
   d. В разделе "Действия" укажите имя для этого действия, например **Отправить электронное письмо**, а в поле **Тип действия** выберите **Email/SMS/Push/Voice** (Электронная почта, SMS, push-уведомление, голосовой вызов) из раскрывающегося списка. Справа откроется панель свойств **Email/SMS/Push/Voice** (Электронная почта, SMS, push-уведомление, голосовой вызов) для дополнительных сведений.  
   д) На панели **Email/SMS/Push/Voice** (Электронная почта, SMS, push-уведомление, голосовой вызов) включите **Электронная почта** и укажите допустимый адрес электронной почты для доставки сообщения.  
   е) Нажмите кнопку **ОК** , чтобы сохранить внесенные изменения.<br><br> 

    ![Создание группы действий](./media/tutorial-response/action-group-properties-01.png)

10. Нажмите кнопку **ОК**, чтобы завершить создание группы действий. 
11. Щелкните **Создать правило генерации оповещений**, чтобы завершить создание этого правила. Оно начнет выполняться немедленно.<br><br> ![Завершение создания правила генерации оповещений](./media/tutorial-response/alert-rule-01.png)<br> 

## <a name="view-your-alerts-in-azure-portal"></a>Просмотр оповещений на портале Azure
Теперь, когда оповещение создано, вы можете просматривать все оповещения Azure в единой области и управлять правилами генерации оповещений для всех подписок Azure. На этой странице перечислены все правила генерации оповещений (включенные или отключенные), и на ней доступна фильтрация по целевым ресурсам, группам ресурсов, имени правила или состоянию. Здесь содержатся статистические сводки обо всех сработавших оповещениях, а также общее количество настроенных и включенных правил генерации оповещений.<br><br> ![Страница состояния оповещений Azure](./media/tutorial-response/azure-alerts-02.png)  

Когда активируется оповещение, в эту таблицу заносятся сведения об условии и количестве зарегистрированных срабатываний в течение определенного диапазона времени (по умолчанию — за последние шесть часов).  В вашу папку входящих писем должно поступить сообщение, как в примере ниже, в котором указана проблемная виртуальная машина и результаты, которые были обнаружены по поисковому запросу в конкретном случае.<br><br> ![Пример действия. Оповещение по электронной почте](./media/tutorial-response/azure-alert-email-notification-01.png)

## <a name="next-steps"></a>Дальнейшие действия
В этом руководстве вы узнали, как правила генерации оповещений позволяют своевременно выявлять проблемы и реагировать на них путем выполнения поиска по журналам через запланированные интервалы и обнаружения соответствия определенным условиям.

Чтобы увидеть готовые примеры сценариев Log Analytics, перейдите по ссылке ниже.  

> [!div class="nextstepaction"]
> [Примеры сценариев Log Analytics](../samples/powershell-samples.md)
