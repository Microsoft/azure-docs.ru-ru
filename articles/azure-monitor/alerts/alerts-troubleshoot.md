---
title: Устранение неполадок Azure Monitor оповещений и уведомлений
description: Распространенные проблемы с Azure Monitor оповещениями и возможными решениями.
author: ofirmanor
ms.author: ofmanor
ms.topic: reference
ms.date: 03/16/2020
ms.subservice: alerts
ms.openlocfilehash: d3f8da7e985e62ce0b40c6dddcd137cce8561e59
ms.sourcegitcommit: c27a20b278f2ac758447418ea4c8c61e27927d6a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/03/2021
ms.locfileid: "101717865"
---
# <a name="troubleshooting-problems-in-azure-monitor-alerts"></a>Устранение неполадок в Azure Monitor оповещениях

В этой статье обсуждаются распространенные проблемы в Azure Monitor предупреждениях и уведомлениях.

Оповещения Azure Monitor заблаговременно уведомляют вас при обнаружении важных условий в данных мониторинга. Они позволяют выявить и устранить проблемы, прежде чем пользователи системы обнаружат их. Дополнительные сведения о предупреждениях см. [в разделе Обзор оповещений в Microsoft Azure](./alerts-overview.md).

Если у вас возникла проблема, связанная с срабатыванием предупреждения или без срабатывания, см. следующие статьи. В портал Azure можно просмотреть оповещения, которые будут срабатывать.

- [Устранение неполадок Azure Monitor оповещений метрик в Microsoft Azure](alerts-troubleshoot-metric.md)  
- [Устранение неполадок Azure Monitor оповещений журнала в Microsoft Azure](alerts-troubleshoot-metric.md)

Если предупреждение срабатывает в соответствии с портал Azure но соответствующие уведомления не возникают, используйте сведения в оставшейся части этой статьи для устранения этой проблемы.

## <a name="action-or-notification-on-my-alert-did-not-work-as-expected"></a>Действие или уведомление по моему оповещению не работает должным образом

Если вы видите оповещение в портал Azure, но у вас возникли проблемы с некоторыми его действиями или уведомлениями, см. следующие разделы.

## <a name="did-not-receive-expected-email"></a>Не получал ожидаемый адрес электронной почты

Если на портале Azure отображается активированное оповещение, но вы не получили настроенное для него электронное сообщение, выполните следующие действия.

1. **Было ли сообщение подавлено [правилом действий](../alerts/alerts-action-rules.md)**?

    Для проверки щелкните на портале созданное оповещение и перейдите на вкладку "Журнал", чтобы просмотреть подавленные [группы действий](./action-groups.md):

    ![Журнал подавления правил для действий предупреждений](media/alerts-troubleshoot/history-action-rule.png)

1. **Тип действия "Azure Resource Managerная роль электронной почты"?**

    Это действие рассматривает только Azure Resource Manager назначения ролей, которые находятся в области действия подписки, и типа *User*.  Убедитесь, что роль назначена на уровне подписки, а не на уровне ресурса или группы ресурсов.

1. **Ваш почтовый сервер и почтовые ящики принимают внешние сообщения электронной почты?**

    Убедитесь, что сообщения с этих трех адресов не блокируются:
      - azure-noreply@microsoft.com  
      - azureemail-noreply@microsoft.com
      - alerts-noreply@mail.windowsazure.com

    Нередко внутренние списки рассылки или группы рассылки блокируют сообщения с внешних адресов электронной почты. Необходимо разрешить почту с указанных выше адресов электронной почты.  
    Чтобы протестировать конфигурацию, добавьте рабочий электронный адрес (не список рассылки) в группу действий и проверьте, приходят ли оповещения по этому адресу.

1. **Были ли сообщения электронной почты обработаны правилами папки "Входящие" или фильтром спама?**

    Убедитесь, что отсутствуют правила папки "Входящие", которые удаляют эти сообщения или перемещают их в папку нежелательной почты. Например, правила для входящих сообщений могут перехватывать определенные отправители или конкретные слова в теме.

    Кроме того, проверьте следующее:

   - параметры нежелательной почты почтового клиента (например, Outlook, Gmail);
      - Параметры ограничений отправителя/спама/карантина сервера электронной почты (например, Exchange, Microsoft 365, G-Suite)
      - Параметры устройства безопасности электронной почты (если таковые имеются) (например, Barracuda, Cisco).

1. **Вы случайно отменили подписывание группы действий?**

    В электронных сообщениях оповещений содержится ссылка для отмены подписки на группу действий. Чтобы проверить, не была ли случайно отменена подписка на эту группу действий, выполните одно из следующих действий.

    1. Откройте группу действий на портале и проверьте столбец "Состояние".

    ![Столбец состояния группы действий](media/alerts-troubleshoot/action-group-status.png)

    2. Выполните поиск сообщения о подтверждении отмены подписки.

    ![Отмена подписки на группу действий оповещения](media/alerts-troubleshoot/unsubscribe-action-group.png)

    Чтобы повторно подписаться, используйте ссылку в полученном сообщении о подтверждении отмены подписки или удалите адрес электронной почты из группы действий, а затем снова добавьте его. 
 
1. **Были ли вы ограничены из-за большого количества сообщений электронной почты по одному адресу?**

    Система позволяет получать [не более](alerts-rate-limiting.md) 100 писем в час. Если этот порог превышен, дополнительные уведомления по электронной почте удаляются.  Проверьте, не получали ли вы сообщение о том, что частота получения для вашего адреса электронной почты временно ограничена. 
 
   ![Частота получения электронной почты ограничена](media/alerts-troubleshoot/email-paused.png)

   Если вы хотите получать большое количество уведомлений без ограничения, попробуйте использовать другое действие, например веб-перехватчик, приложение логики, функцию Azure или модули Runbook службы автоматизации. Ни одна из этих функций не ограничена частотой срабатывания. 

## <a name="did-not-receive-expected-sms-voice-call-or-push-notification"></a>Не получил ожидаемый SMS, голосовое вызов или Push-уведомление

Если на портале отображается активированное оповещение, но вы не получали SMS, голосовой звонок или push-уведомление, которое вы настроили, выполните следующие действия. 

1. **Было ли действие подавлено [правилом действий](../alerts/alerts-action-rules.md)?**

    Для проверки щелкните на портале созданное оповещение и перейдите на вкладку "Журнал", чтобы просмотреть подавленные [группы действий](./action-groups.md): 

    ![Журнал подавления правил для действий предупреждений](media/alerts-troubleshoot/history-action-rule.png)

   Если это было непреднамеренно, вы можете изменить, отключить или удалить правило действия.
 
1. **SMS/Voice: правильный номер телефона?**

   Проверьте действие SMS на наличие опечаток в коде страны или номере телефона.
 
1. **SMS/Voice: вы получили ограниченную частоту?**

    Для SMS и голосовых звонков система позволяет получать не более одного уведомления каждые пять минут на каждый номер телефона. Если передать это пороговое значение, уведомления будут удалены.

      - Голосовой вызов — проверьте журнал звонков и убедитесь, что в течение предыдущих пяти минут не было других вызовов из Azure.
      - SMS — проверьте, нет ли в списке текстовых сообщений об установке ограничений для вашего номера телефона.

    Если вы хотите получать большое количество уведомлений без ограничения, попробуйте использовать другое действие, например веб-перехватчик, приложение логики, функцию Azure или модули Runbook службы автоматизации. Ни одна из этих функций не ограничена частотой срабатывания. 
 
1. **SMS: вы случайно отменили подписывание группы действий?**

    Откройте журнал SMS и проверьте, не отказался ли доставка SMS из этой конкретной группы действий (с помощью ответа "отключить action_group_short_name") или из всех групп действий (с помощью ответа "отменить"). Для повторной подписки отправьте соответствующую команду SMS (ENABLE (Активировать) краткое_имя_группы_действий или START (Запуск)) или удалите действие SMS из группы действий, а затем снова добавьте его.  Дополнительные сведения см. в статье [Поведение SMS-оповещений в группе действий](alerts-sms-behavior.md).

1. **Вы случайно заблокировали уведомления на телефоне?**

   Большинство мобильных телефонов позволяют блокировать вызовы или SMS с конкретных номеров телефонов или коротких кодов или блокировать push-уведомления от конкретных приложений (например, мобильное приложение Azure). Чтобы проверить, не были ли случайно заблокированы уведомления на телефоне, выполните поиск по документации, относящейся к операционной системе и модели телефона, или выполните проверку с использованием другого телефона и другого номера.

## <a name="expected-another-type-of-action-to-trigger-but-it-did-not"></a>Ожидался другой тип действия для активации, но он не 
   
Если на портале отображается активированное оповещение, но его настроенное действие не активировалось, выполните следующие действия.

1. **Было ли действие подавлено правилом действий?**

    Для проверки щелкните на портале созданное оповещение и перейдите на вкладку "Журнал", чтобы просмотреть подавленные [группы действий](./action-groups.md):

    ![Журнал подавления правил для действий предупреждений](media/alerts-troubleshoot/history-action-rule.png)
 
    Если это было непреднамеренно, вы можете изменить, отключить или удалить правило действия.

1. **Не активировали веб-перехватчик?**

    1. **Заблокированы ли исходные IP-адреса?**
    
       Добавьте [IP-адреса](./action-groups.md#action-specific-information) , из которых вызывается веб-перехватчик, в список разрешений.

    1. **Работает ли конечная точка веб-перехватчика правильно?**

       Проверьте, правильно ли указана и работает ли конечная точка веб-перехватчика, которую вы настроили. Проверьте журналы веб-перехватчика или выполните инструментирование кода, чтобы его можно было изучить (например, регистрировать входящие полезные данные).

    1. **Вы вызываете Slack или Microsoft Teams?**  
    Каждая из этих конечных точек принимает конкретный формат JSON. Выполните [эти инструкции](../alerts/action-groups-logic-app.md), чтобы настроить действие приложения логики.

    1. **Веб-перехватчик стал недоступным или возвращали ошибки?** 

        Период ожидания ответа веб-перехватчика — 10 секунд. Вызов веб-перехватчика будет повторен (но не более двух раз), если будут получены такие коды состояния HTTP: 408, 429, 503, 504 или если конечная точка HTTP не отвечает. Первый повторный вызов происходит через 10 секунд, второй (он же последний) — через 100 секунд. Если вторая повторная попытка не удалась, конечная точка больше не будет вызываться в течение 30 минут ни для одной из групп действий.

## <a name="action-or-notification-happened-more-than-once"></a>Действие или уведомление произошло несколько раз 

Если вы получили уведомление о предупреждении (например, по электронной почте или SMS) более одного раза или действие предупреждения (например, веб-перехватчик или функция Azure) было вызвано несколько раз, выполните следующие действия: 

1. **Действительно ли это предупреждение?** 

    В некоторых случаях несколько аналогичных оповещений срабатывают в одно и то же время. Таким образом, оно может выглядеть так же, как оповещение, запускающее действия несколько раз. Например, правило генерации оповещений журнала действий может быть настроено на срабатывание как при запуске события, так и после его завершения (успешно или неудачно), не выполняя фильтрацию по полю состояния события. 

    Чтобы проверить, появились ли эти действия или уведомления из разных оповещений, изучите сведения об оповещении, такие как метка времени и идентификатор оповещения или его идентификатор корреляции. Список запущенных оповещений можно также проверить на портале. Если это так, необходимо адаптировать логику правила оповещения или иным образом настроить источник оповещения. 

1. **Повторяется ли действие в нескольких группах действий?** 

    При срабатывании оповещения каждая из групп действий обрабатывается независимо. Таким образом, если действие (например, адрес электронной почты) появляется в нескольких активируемых группах действий, оно будет вызываться один раз для каждой группы действий. 

    Чтобы проверить, какие группы действий были активированы, перейдите на вкладку "Журнал оповещений". Вы увидите группы действий, определенные в правиле создания оповещений, и группы действий, добавленные в оповещение с помощью правил действий: 

    ![Действие повторяется в нескольких группах действий](media/alerts-troubleshoot/action-repeated-multi-action-groups.png)

## <a name="action-or-notification-has-an-unexpected-content"></a>Непредвиденное содержимое действия или уведомления

Если вы получили оповещение, но считаете, что некоторые из его полей отсутствуют или неправильные, выполните следующие действия. 

1. **Выбран правильный формат для действия?** 

    Каждый тип действия (электронная почта, веб-перехватчик и т. д.) имеет два формата: по умолчанию, устаревший формат и [более новый общий формат схемы](../alerts/alerts-common-schema.md). При создании группы действий вы указываете необходимый формат для каждого действия. Различные действия в группах действий могут иметь разные форматы. 

    Например, для действия веб-перехватчика: 

    ![параметр схемы действия веб-перехватчика](media/alerts-troubleshoot/webhook.png)

    Проверьте, соответствует ли формат, указанный на уровне действия, ожидаемому. Например, вы могли разработать код, реагирующий на оповещения (веб-перехватчик, функцию, приложение логики и т. д.), ожидая один формат, но позже в действии вы или другой пользователь могли указать другой формат.  

    Кроме того, проверьте формат полезных данных (JSON) для [оповещений журнала действий](../alerts/activity-log-alerts-webhook.md), [оповещений поиска по журналам](../alerts/alerts-log-webhook.md) (Application Insights и Log Analytics), [оповещений метрик](alerts-metric-near-real-time.md#payload-schema), [общей схемы оповещений](../alerts/alerts-common-schema-definitions.md) и устаревших [классических оповещений метрик](./alerts-webhooks.md).

 
1. **Оповещения журнала действий: сведения, доступные в журнале действий.** 

    [Оповещения журнала действий](./activity-log-alerts.md) — это оповещения, основанные на событиях, записываемых в журнал действий Azure, например о событиях создания, обновления или удаления ресурсов Azure, событий работоспособности службы и работоспособности ресурсов, а также результатов, полученных от помощника по Azure и политики Azure. Если вы получили оповещение на основе журнала действий, но некоторые необходимые вам поля отсутствуют или неправильные, сначала проверьте события в журнале действий. Если ресурс Azure не записал искомые поля в свое событие журнала действий, эти поля не добавляются в соответствующее оповещение. 

## <a name="action-rule-is-not-working-as-expected"></a>Правило действия не работает должным образом. 

Если на портале отображается вызванное оповещение, но связанное правило действий не работает должным образом, выполните следующие действия. 

1. **Включено ли правило действий?** 

    Проверьте столбец состояния правила действия, чтобы убедиться, что связанная роль действия включена. 

    ![графика](media/alerts-troubleshoot/action-rule-status.png) 

    Если оно не включено, правило действия можно включить, выбрав его и нажав кнопку "Включить". 

1. **Это предупреждение о работоспособности службы?** 

    Правила действий не влияют на оповещения о работоспособности службы (служба "Работоспособность служб" — это служба мониторинга). 

1. **Выполняется ли правило действия при возникновении оповещения?** 

    Для проверки щелкните на портале созданное оповещение и перейдите на вкладку "Журнал", чтобы просмотреть, обрабатывало ли правило действие.

    Ниже приведен пример правила действия, подавляющего все группы действий: 
 
     ![Журнал подавления правил для действий предупреждений](media/alerts-troubleshoot/history-action-rule.png)

    Ниже приведен пример правила действия, которое добавляет другую группу действий:

    ![Действие повторяется в нескольких группах действий](media/alerts-troubleshoot/action-repeated-multi-action-groups.png)
 

1. **Соответствуют ли область правила действия и фильтр активированному оповещению?** 

    Если вы считаете, что правило действия должно быть активировано, но этого не произошло или наоборот, изучите область правила действия и условия фильтра, а также свойства активированного оповещения. 


## <a name="how-to-find-the-alert-id-of-a-fired-alert"></a>Как найти идентификатор предупреждения об срабатывании предупреждения

При открытии обращения к конкретному запущенному оповещению (например, если вы не получили уведомление по электронной почте) необходимо указать идентификатор оповещения. 

Чтобы его выбрать, выполните следующие действия.

1. В портал Azure перейдите к списку запущенных предупреждений и найдите это конкретное оповещение. Фильтры можно использовать для их нахождение. 

1. Щелкните оповещение, чтобы открыть сведения о предупреждении. 

1. Прокрутите вниз в полях "предупреждение" на первой вкладке (вкладке "Сводка"), пока не обнаружите ее и не скопируйте. Это поле также содержит вспомогательную кнопку "Копировать в буфер обмена", которую можно использовать.  

    ![найти идентификатор оповещения](media/alerts-troubleshoot/get-alert-id.png)

## <a name="problem-creating-updating-or-deleting-action-rules-in-the-azure-portal"></a>Проблема при создании, обновлении или удалении правил действий в портал Azure

Если при попытке создать, обновить или удалить [правило действия](../alerts/alerts-action-rules.md)возникла ошибка, выполните следующие действия. 

1. **Вы получили ошибку разрешения?**  

    У вас должна быть [Встроенная роль участника мониторинга](../../role-based-access-control/built-in-roles.md#monitoring-contributor)или конкретные разрешения, связанные с правилами действий и оповещениями.

1. **Вы проверяли параметры правила действий?**  

    Проверьте [документацию по правилу действий](../alerts/alerts-action-rules.md)или команду [PowerShell Set-азактионруле в правиле действий](/powershell/module/az.alertsmanagement/set-azactionrule?view=azps-3.5.0) . 


## <a name="next-steps"></a>Дальнейшие действия
- Если используется оповещение журнала, см. также раздел [Устранение неполадок с оповещениями журнала](./alerts-troubleshoot-log.md).
- Вернитесь к [портал Azure](https://portal.azure.com) , чтобы проверить, решена ли ваша ошибка с помощью приведенных выше инструкций.