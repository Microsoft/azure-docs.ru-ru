---
title: Узнайте о работе оповещений о метриках в Azure Monitor.
description: Ознакомьтесь с обзором действий, применимых к оповещениям о метриках, а также узнайте о том, как они работают в Azure Monitor.
ms.date: 03/11/2021
ms.topic: conceptual
ms.openlocfilehash: 8a243f0a2130e0ec2ebafe726f48e07c148807c1
ms.sourcegitcommit: 772eb9c6684dd4864e0ba507945a83e48b8c16f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/20/2021
ms.locfileid: "103016089"
---
# <a name="understand-how-metric-alerts-work-in-azure-monitor"></a>Сведения о работе оповещений о метриках в Azure Monitor

Оповещения о метриках в Azure Monitor работают для основных многомерных метрик. Это могут быть [метрики платформы](alerts-metric-near-real-time.md#metrics-and-dimensions-supported), [пользовательские метрики](../essentials/metrics-custom-overview.md), [популярные журналы из Azure Monitor, преобразованные в метрики](./alerts-metric-logs.md), метрики Application Insights. Для оповещений о метриках регулярно выполняется анализ, чтобы проверить соответствие условий одного временного ряда метрик или более. Если зафиксированы правильные значения, отправляется соответствующее уведомление. Функция оповещений о метриках работает с отслеживанием состояния, то есть уведомления отправляются только при изменении состояния.

## <a name="how-do-metric-alerts-work"></a>Как работают оповещения о метриках?

Вы можете определить правило генерации оповещений о метрике, указав целевой ресурс, который нужно отслеживать, имя метрики, тип условия (статическое и динамическое) и условие (оператор и порог или конфиденциальность), а также группу действий, которую нужно активировать при срабатывании правила генерации оповещений. Типы условий влияют на способ определения пороговых значений. [Дополнительные сведения о типе условия "Динамические пороговые значения" и значениях параметра конфиденциальности](../alerts/alerts-dynamic-thresholds.md).

### <a name="alert-rule-with-static-condition-type"></a>Правило генерации оповещений со статическим типом условия

Предположим, что вы создали простое правило генерации оповещений о метрике со статическим пороговым значением следующим образом:

- Целевой ресурс (ресурс Azure, который требуется отслеживать): myVM.
- Метрика: загрузка ЦП
- Тип условия: статический
- Тип агрегирования (статистика, которая выполняется по необработанным значениям метрики. [Поддерживаются следующие типы агрегирования](../essentials/metrics-aggregation-explained.md#aggregation-types) : минимальное, максимальное, среднее, общее, число). среднее значение
- Период (окно просмотра, в котором проверяются значения метрики): за последние 5 минут
- Частота (частота, с которой оповещение метрики проверяет, выполнены ли условия): 1 мин
- Оператор: больше
- Пороговое значение: 70

С момента создания правила генерации оповещений мониторинг выполняется каждую минуту, просматриваются значения метрики за последние 5 минут и проверяется, превышает ли среднее значение этих значений 70. Если условие выполняется, то есть средняя загрузка ЦП за последние 5 минут превышает 70, правило генерации оповещений запускает активированное уведомление. Если вы настроили действие электронной почты или веб-перехватчика в группе действий, связанной с правилом генерации оповещений, вы получите активированное уведомление для настроенных параметров.

При использовании нескольких условий в одном правиле правило «and» условия вместе. Это значит, что предупреждение срабатывает, когда все условия в правиле генерации оповещений оцениваются как true и разрешаются, когда одно из условий больше не выполняется. Например, для этого типа правила генерации оповещений можно отслеживать виртуальную машину Azure и оповещать, когда "процент ЦП превышает 90%", а "Длина очереди превышает 300 элементов".

### <a name="alert-rule-with-dynamic-condition-type"></a>Правило генерации оповещений с динамическим типом условия

Предположим, что вы создали простое правило генерации оповещений о метрике с динамическим пороговым значением следующим образом:

- Целевой ресурс (ресурс Azure, который требуется отслеживать): myVM.
- Метрика: загрузка ЦП
- Тип условия: динамический.
- Тип агрегирования (статистика, которая выполняется по необработанным значениям метрики. [Поддерживаются следующие типы агрегирования](../essentials/metrics-aggregation-explained.md#aggregation-types) : минимальное, максимальное, среднее, общее, число). среднее значение
- Период (окно просмотра, в котором проверяются значения метрики): за последние 5 минут
- Частота (частота, с которой оповещение метрики проверяет, выполнены ли условия): 1 мин
- Оператор: больше
- Чувствительность: средний
- Периоды поиска: 4
- Число нарушений: 4

После создания правила генерации оповещений алгоритм машинного обучения с динамическими пороговыми значениями будет получать доступные исторические данные, вычислять порог, который наилучшим образом соответствует шаблону поведения ряда метрик, а также будет непрерывно обучаться на основе новых данных, чтобы сделать порог более точным.

С момента создания правила генерации оповещений мониторинг выполняется каждую минуту. При этом просматриваются значения метрик за последние 20 минут, сгруппированные в 5-минутные периоды, а также проверяется, превышает ли среднее значение за период ожидаемый порог в каждом из 4 периодов. Если условие выполняется, то есть средний процент загрузки ЦП за последние 20 минут (четыре 5-минутных периода) отклонялся от ожидаемого поведения четыре раза, правило генерации оповещений запускает активированное уведомление. Если вы настроили действие электронной почты или веб-перехватчика в группе действий, связанной с правилом генерации оповещений, вы получите активированное уведомление для настроенных параметров.

### <a name="view-and-resolution-of-fired-alerts"></a>Просмотр и разрешение сработавших оповещений

Представленные выше примеры выполнения правила генерации оповещений можно также просмотреть на портале Azure или в колонке **Все оповещения**.

Скажем, если показатели использования в ресурсе myVM продолжают превышать порог при последующих проверках, правило генерации оповещений не сработает повторно, пока не будут устранены условия.

Через некоторое время использование "myVM" переходит в нормальный режим (ниже порогового значения). Правило генерации оповещений отслеживает это условие еще два раза, чтобы отправить уведомление об устранении. Правило генерации оповещений отправляет сообщение об устранении или деактивации, когда условие оповещения не выполняется в течение трех последовательных периодов для сокращения отправки нежелательных оповещений в случае нестабильности условий.

По мере того как уведомление об устранении отправляется через веб-перехватчик или электронную почту, на портале Azure также обновляется состояние экземпляра оповещения (называемое состоянием мониторинга) на "Разрешено".

> [!NOTE]
>
> Когда правило генерации оповещений отслеживает несколько условий, выданное предупреждение будет разрешено, если хотя бы одно из условий больше не будет выполняться в течение трех последовательных периодов.

### <a name="using-dimensions"></a>Использование измерений

Оповещения о метриках в Azure Monitor также поддерживают отслеживание комбинаций значений нескольких измерений с одним правилом. Поясним на примере, почему вы можете использовать комбинации нескольких измерений.

Предположим, что у вас есть план службы приложений для веб-сайта. Вы хотите отследить использование ЦП на нескольких экземплярах, на которых запущен веб-сайт или приложение. Это можно сделать следующим образом, используя правило генерации оповещений о метрике.

- Целевой ресурс: myAppServicePlan
- Метрика: загрузка ЦП
- Тип условия: статический
- Измерения
  - Экземпляр = InstanceName1, InstanceName2
- Тип агрегирования: Среднее
- Период: за последние 5 минут
- Частота: 1 мин
- Оператор: GreaterThan
- Пороговое значение: 70

Как и раньше, это правило отслеживает, превышает ли среднее потребление ЦП за последние 5 минут 70 %. Тем не менее с помощью того же правила вы можете отслеживать два экземпляра, на которых запущен сайт. Каждый экземпляр будет отслеживаться индивидуально, и вы будете получать уведомления отдельно.

Скажем, у вас есть веб-приложение, которое очень часто используется, и вам нужно добавить больше экземпляров. Правило выше по-прежнему отслеживает только два экземпляра. Тем не менее можно создать правило следующим образом.

- Целевой ресурс: myAppServicePlan
- Метрика: загрузка ЦП
- Тип условия: статический
- Измерения
  - Экземпляр = *
- Тип агрегирования: Среднее
- Период: за последние 5 минут
- Частота: 1 мин
- Оператор: GreaterThan
- Пороговое значение: 70

Это правило будет автоматически отслеживать все значения для экземпляра, например вы можете отслеживать экземпляры по мере их появления без необходимости снова изменять правило генерации оповещений о метрике.

При мониторинге нескольких измерений правило генерации оповещений с динамическим пороговым значением позволяет создать точно настроенные пороги для нескольких сотен метрик одновременно. Динамические пороговые значения приводят к управлению меньшим количеством правил генерации оповещений и значительной экономии времени на управление и создание правил генерации оповещений.

Предположим, у вас есть веб-приложение со множеством экземпляров и вы не знаете, какой порог является наиболее подходящим. Приведенные выше правила всегда будут использовать порог 70 %. Тем не менее можно создать правило следующим образом.

- Целевой ресурс: myAppServicePlan
- Метрика: загрузка ЦП
- Тип условия: динамический.
- Измерения
  - Экземпляр = *
- Тип агрегирования: Среднее
- Период: за последние 5 минут
- Частота: 1 мин
- Оператор: GreaterThan
- Чувствительность: средний
- Искать периоды: 1
- Число нарушений: 1

Это правило отслеживает, превышает ли среднее потребление ЦП за последние 5 минут ожидаемое поведение для каждого экземпляра. По этому же правилу вы можете отслеживать экземпляры по мере их появления без необходимости снова изменять правило генерации оповещений о метрике. Каждый экземпляр получит пороговое значение, которое соответствует шаблону поведения ряда метрик, и будет постоянно меняться на основе новых данных, чтобы обеспечить более точное пороговое значение. Как и прежде, каждый экземпляр будет отслеживаться индивидуально и вы будете получать уведомления отдельно.

При увеличении периодов просмотра и числа нарушений также можно выполнить фильтрацию только до оповещения о вашем определении значительного отклонения. [Дополнительные сведения о расширенных параметрах динамических пороговых значений](../alerts/alerts-dynamic-thresholds.md#what-do-the-advanced-settings-in-dynamic-thresholds-mean).

> [!NOTE]
>
> Рекомендуется выбрать *гранулярность статистической обработки (период)* , превышающую *частоту вычисления*, чтобы уменьшить вероятность отсутствия первой оценки добавленного временного ряда в следующих случаях:
> - Правило оповещения метрики, отслеживающее несколько измерений — при добавлении нового сочетания значений измерений
> - Правило генерации оповещений метрик, которое наблюдает за несколькими ресурсами — при добавлении нового ресурса в область
> - Правило оповещения метрики, которое отслеживает метрику, которая не выдается непрерывно (разреженная метрика) — когда метрика создается по истечении более 24 часов, когда она не была выданы.



## <a name="monitoring-at-scale-using-metric-alerts-in-azure-monitor"></a>Мониторинг в масштабе с помощью оповещений о метриках в Azure Monitor

На данный момент вы узнали, как одно предупреждение метрики можно использовать для отслеживания одного или нескольких метрических временных рядов, связанных с одним ресурсом Azure. Во многих случаях вы можете захотеть, чтобы одно и то же правило генерации оповещений применялось ко многим ресурсам. Azure Monitor также поддерживает мониторинг нескольких ресурсов (одного типа) с одним правилом генерации оповещений метрики для ресурсов, которые существуют в одном регионе Azure. 

В настоящее время эта функция поддерживается для метрик платформы (не пользовательских метрик) для следующих служб в следующих облаках Azure:

| Служба | Public Azure (Общедоступные Azure) | Государственный сектор | Китай |
|:--------|:--------|:--------|:--------|
| Виртуальные машины<sup>1</sup>  | **Да** | **Да** | **Да** |
| Базы данных SQL Server | **Да** | **Да** | **Да** |
| Эластичные пулы SQL Server | **Да** | **Да** | **Да** |
| Пулы емкости NetApp файлов | **Да** | **Да** | **Да** |
| Тома NetApp Files | **Да** | **Да** | **Да** |
| Хранилища ключей | **Да** | **Да** | **Да** |
| Кэш Azure для Redis | **Да** | **Да** | **Да** |
| Устройства с пограничными ящиками данных | **Да** | **Да** | **Да** |

<sup>1</sup> не поддерживается для метрик сети виртуальной машины (общая сеть, общий объем сети, входящие потоки, исходящие потоки, максимальная частота создания входящих потоков, максимальная скорость создания исходящих потоков).

Область мониторинга можно указать одним из трех способов: по одному правилу генерации оповещений метрик. Например, с помощью виртуальных машин можно указать область следующим образом:  

- список виртуальных машин (в одном регионе Azure) в подписке.
- все виртуальные машины (в одном регионе Azure) в одной или нескольких группах одной подписки;
- все виртуальные машины (в одном регионе Azure) в подписке

> [!NOTE]
>
> Область правила генерации оповещений метрик нескольких ресурсов должна содержать по крайней мере один ресурс выбранного типа ресурса.

Создание правил генерации оповещений метрики, которые отслеживают несколько ресурсов, аналогично созданию [любого другого оповещения метрики](../alerts/alerts-metric.md), которое отслеживает один ресурс. Единственным отличием является то, что следует выбрать все ресурсы, которые вы хотите отслеживать. Эти правила также можно создать, используя [шаблоны Azure Resource Manager](./alerts-metric-create-templates.md#template-for-a-metric-alert-that-monitors-multiple-resources). Вы получите отдельные уведомления для каждого отслеживаемого ресурса.

> [!NOTE]
>
> В правиле оповещения метрики, отслеживающем несколько ресурсов, допускается только одно условие.

## <a name="typical-latency"></a>Обычная задержка

Для оповещений о метриках, как правило можно получить уведомление в течение 5 минут, если задать частоту правила генерации оповещений в 1 минуту. В случае серьезных нагрузок для систем отправки уведомлений может наблюдаться более длительная задержка.

## <a name="supported-resource-types-for-metric-alerts"></a>Поддерживаемые типы ресурсов оповещений о метриках

Полный список поддерживаемых типов ресурсов можно найти в этой [статье](./alerts-metric-near-real-time.md#metrics-and-dimensions-supported).


## <a name="next-steps"></a>Следующие шаги

- [Узнайте, как создавать, просматривать оповещения метрик и управлять ими в Azure.](../alerts/alerts-metric.md)
- [Узнайте, как создавать оповещения в Azure Монтиор обозреватель метрик](../essentials/metrics-charts.md#alert-rules)
- [Сведения о развертывании оповещений о метриках с помощью шаблонов Azure Resource Manager](./alerts-metric-create-templates.md)
- [Дополнительные сведения о группах действий](./action-groups.md)
- [Оповещения с динамическими пороговыми значениями в Azure Monitor (ограниченная закрытая предварительная версия)](../alerts/alerts-dynamic-thresholds.md)
- [Дополнительные сведения об устранении неполадок в оповещениях метрик](alerts-troubleshoot-metric.md)
