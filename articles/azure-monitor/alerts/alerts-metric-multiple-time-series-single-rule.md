---
title: Мониторинг нескольких временных рядов в одном правиле генерации оповещений метрик
description: Оповещение при масштабировании с помощью одного правила генерации оповещений для нескольких временных рядов
author: harelbr
ms.author: harelbr
ms.topic: conceptual
ms.date: 01/11/2021
ms.openlocfilehash: bc3e77b560a94b45acf1ae696551dbefbabbdf0a
ms.sourcegitcommit: 867cb1b7a1f3a1f0b427282c648d411d0ca4f81f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/20/2021
ms.locfileid: "102038209"
---
# <a name="monitor-multiple-time-series-in-a-single-metric-alert-rule"></a>Мониторинг нескольких временных рядов в одном правиле генерации оповещений метрик

Одно правило генерации оповещений метрик можно использовать для мониторинга одного или нескольких временных рядов метрик, что упрощает мониторинг масштабируемых ресурсов.

## <a name="metric-time-series"></a>Временная серия метрик

Метрика временных рядов — это ряд измерений (или значений метрик), захваченных за определенный период времени. 

Пример:

- Использование ЦП виртуальной машиной
- Входящие байты (входящий трафик) в учетную запись хранения
- Число неудачных запросов веб-приложения



## <a name="alert-rule-on-a-single-time-series"></a>Правило генерации оповещений в одном ряде времени
Правило генерации оповещений отслеживает один временный ряд, когда он отвечает всем следующим условиям.
-   Правило наблюдает за одним целевым ресурсом 
-   Содержит одно условие
-   Оценивает метрику без выбора измерений (предполагая, что метрика поддерживает измерения)

Пример такого правила генерации оповещений (с отображением только соответствующих свойств):
-   Целевой ресурс: *myVM1*
-   Метрика: *процент ЦП*
-   Оператор: *больше*
-   Пороговое значение: *70*


Для этого правила генерации оповещений отслеживается один ряд времени метрики:
-   Процент ЦП, где *Resource*= ' myVM1 ' > 70%

![Правило генерации оповещений для одного временного ряда](media/alerts-metric-multiple-time-series-single-rule/simple-alert-rule.png)

## <a name="alert-rule-on-multiple-time-series"></a>Правило генерации оповещений для нескольких временных рядов
Правило генерации оповещений отслеживает несколько временных рядов, если в нем используется хотя бы одна из следующих функций: 
-   Несколько ресурсов
-   Несколько условий 
-   Несколько измерений


## <a name="multiple-resources-multi-resource"></a>Несколько ресурсов (с несколькими ресурсами)

Одно правило генерации оповещений метрик может отслеживать несколько ресурсов, если ресурсы имеют один и тот же тип и находятся в одном регионе Azure. Использование этого типа правил сокращает сложность и общее число правил генерации оповещений, которые необходимо поддерживать. 

Пример такого правила генерации оповещений:
-   Целевой ресурс: *myVM1, myVM2*
-   Метрика: *процент ЦП*
-   Оператор: *больше*
-   Пороговое значение: *70*

Для этого правила генерации оповещений отслеживаются два временных ряда метрики отдельно:
-   Процент ЦП, где *Resource*= ' myVM1 ' > 70%
-   Процент ЦП, где *Resource*= ' myVM2 ' > 70%

![Правило генерации оповещений с несколькими ресурсами](media/alerts-metric-multiple-time-series-single-rule/multi-resource-alert-rule.png)
 
В правиле генерации оповещений с несколькими ресурсами условие вычисляется **отдельно** для каждого ресурса (или, точнее, для каждого временного ряда метрик, соответствующего каждому ресурсу). Это означает, что предупреждения также срабатывают для каждого ресурса отдельно.

Например, предположим, что мы установили правило генерации оповещений выше, чтобы отслеживать загрузку ЦП выше 70%. За вычисленный период (т. е. за последние 5 минут)
-   *Процент загрузки ЦП* *myVM1* превышает 70% 
-   *Процент загрузки ЦП* *myVM2* составляет 50%

Правило генерации оповещений срабатывает для *myVM1*, но не для *myVM2*. Эти активируемые предупреждения являются независимыми. Они также могут разрешаться в разное время в зависимости от конкретного поведения каждой из виртуальных машин.

Дополнительные сведения о правилах генерации оповещений с несколькими ресурсами и о типах ресурсов, поддерживаемых этой возможностью, см. [в разделе Мониторинг в масштабе с помощью оповещений метрик в Azure Monitor](alerts-metric-overview.md#monitoring-at-scale-using-metric-alerts-in-azure-monitor).

> [!NOTE] 
> В правиле оповещения метрики, отслеживающем несколько ресурсов, допускается только одно условие.

## <a name="multiple-conditions-multi-condition"></a>Несколько условий (множественное условие)

Одно правило генерации оповещений метрики также может отслеживать до пяти условий для каждого правила генерации оповещений. 

Пример:

- Целевой ресурс: *myVM1*
- Condition1
  - Метрика: *процент ЦП*
  - Оператор: *больше*
  - Пороговое значение: *70*
- Condition2
  - Метрика: *всего сетей*
  - Оператор: *больше*
  - Пороговое значение: *20 МБ*

Для этого правила генерации оповещений отслеживаются два временных ряда метрик:

- Процент ЦП, где *Resource*= ' myVM1 ' > 70%
- Общая сеть, где *Resource*= ' myVM1 ' > 20 МБ

![Правило генерации оповещений с несколькими условиями](media/alerts-metric-multiple-time-series-single-rule/multi-condition-alert-rule.png)
 
Между условиями используется оператор AND. Правило генерации оповещений выдает предупреждение, когда выполняются **все** условия. Вызванное предупреждение устраняется, если хотя бы одно из условий больше не выполняется. 

> [!NOTE]
> При использовании измерений в правиле генерации оповещений с несколькими условиями существуют ограничения. Дополнительные сведения см. [в разделе ограничения при использовании измерений в правиле генерации оповещений метрик с несколькими условиями](alerts-troubleshoot-metric.md#restrictions-when-using-dimensions-in-a-metric-alert-rule-with-multiple-conditions).


## <a name="multiple-dimensions-multi-dimension"></a>Несколько измерений (с несколькими измерениями)

Одно правило генерации оповещений метрик также может отслеживать несколько значений измерения метрики. Измерения метрик — это пары "имя-значение", которые содержат дополнительные данные для описания значения метрики. Например, метрика **транзакций** в учетной записи хранения имеет измерение **имя API**, описывающее имя API, вызываемого каждой транзакцией (например, большие двоичные объекты, DeleteBlob, помощью putpage). Использование измерений является необязательным, но позволяет фильтровать метрику и отслеживать только определенные временные ряды, а не контролировать метрику как совокупность всех значений измерений. 

Например, можно настроить оповещение о том, что число транзакций велико по всем именам API (которые являются агрегированными данными), или в дальнейшем разбивать его на предупреждения только в том случае, если число транзакций велико для конкретных имен API. 

Ниже приведен пример отслеживания нескольких измерений в правиле генерации оповещений.

- Целевой ресурс: *myStorage1*
- Метрика: *транзакции*
- Измерения
  * Имя API = *BLOB, DeleteBlob, помощью putpage*
- Оператор: *больше*
- Пороговое значение: *70*

Для этого правила генерации оповещений отслеживается три временных ряда метрик:

- Транзакции, в которых *Resource*= ' myStorage1 ' и *API Name*= ' BLOB ' > 70
- Транзакции, в которых *Resource*= "myStorage1" и *имя API*= "DeleteBlob" > 70
- Транзакции, в которых *Resource*= "myStorage1" и *имя API*= "помощью putpage" > 70

![Правило генерации оповещений с несколькими измерениями со значениями из одного измерения](media/alerts-metric-multiple-time-series-single-rule/multi-dimension-1.png)

Правило генерации оповещений с несколькими измерениями может также отслеживать несколько значений измерений из **разных** измерений метрики. В этом случае правило генерации оповещений по **отдельности** отслеживает все комбинации значений измерений выбранных значений измерений.

Пример этого типа правила генерации оповещений:

- Целевой ресурс: *myStorage1*
- Метрика: *транзакции*
- Измерения
  * Имя API = *BLOB, DeleteBlob, помощью putpage*
  * Authentication = *SAS, AccountKey*
- Оператор: *больше*
- Пороговое значение: *70*

Для этого правила генерации оповещений за шесть временных рядов отслеживается отдельно:

- Транзакции, в которых *Resource*= ' myStorage1 ' и *API Name*= ' BLOB ' и *Authentication*= ' SAS ' > 70
- Транзакции, в которых *Resource*= ' myStorage1 ' и *API Name*= ' BLOB ' и *Authentication*= ' AccountKey ' > 70
- Транзакции, в которых *Resource*= "myStorage1" и *имя API*= "DeleteBlob" и *Authentication*= "SAS" > 70
- Транзакции, в которых *Resource*= "myStorage1" и *имя API*= "DeleteBlob" и *Authentication*= "AccountKey" > 70
- Транзакции, в которых *Resource*= "myStorage1" и *имя API*= "помощью putpage" и *Authentication*= "SAS" > 70
- Транзакции, в которых *Resource*= "myStorage1" и *имя API*= "помощью putpage" и *Authentication*= "AccountKey" > 70

![Правило генерации оповещений с несколькими измерениями со значениями из нескольких измерений](media/alerts-metric-multiple-time-series-single-rule/multi-dimension-2.png)
 
### <a name="advanced-multi-dimension-features"></a>Расширенные функции с несколькими измерениями

1.  **Выбор всех текущих и будущих измерений** — можно выбрать мониторинг всех возможных значений измерения, включая будущие значения. Такое правило генерации оповещений автоматически масштабируется для отслеживания всех значений измерения без необходимости изменять правило генерации оповещений при каждом добавлении или удалении значения измерения.
2.  **Исключение измерений** — выбор оператора "≠" (Exclude) для значения измерения эквивалентен выбору всех остальных значений этого измерения, включая будущие значения.
3.  **Новые и пользовательские измерения** — значения измерений, отображаемые в портал Azure, основываются на данных метрик, собранных за последний день. Если искомое значение измерения еще не создано, можно добавить пользовательское значение измерения.
4. **Сопоставление измерений с префиксом** . можно выбрать отслеживание всех значений измерений, начинающихся с определенного шаблона, путем выбора оператора "начинается с" и ввода настраиваемого префикса.

![Расширенные функции с несколькими измерениями](media/alerts-metric-multiple-time-series-single-rule/advanced-features.png)


## <a name="metric-alerts-pricing"></a>Цены на оповещения метрик

Цены на правила генерации оповещений метрик доступны на [странице цен на Azure Monitor](https://azure.microsoft.com/pricing/details/monitor/).

При создании правила генерации оповещений метрика предоставленная Оценка цены основана на выбранных функциях и количестве отслеживаемых временных рядов, которое определяется на основе конфигурации правила и текущих значений метрик. Однако ежемесячная плата основана на фактических оценках временных рядов, и поэтому может отличаться от исходной оценки, если некоторые временные ряды не имеют данных для оценки или если правило генерации оповещений использует функции, которые могут сделать его динамически масштабируемым.

Например, в правиле генерации оповещений может отображаться Оценка высокой цены, если она использует функцию многомерных данных, и выбрано большое количество комбинаций значений измерений, что приводит к мониторингу множества временных рядов. Но фактическая плата за это правило генерации оповещений может быть ниже, если не все временные ряды, полученные из комбинаций значений измерений, фактически содержат данные для вычисления.

## <a name="number-of-time-series-monitored-by-a-single-alert-rule"></a>Число временных рядов, отслеживаемых одним правилом генерации оповещений

Во избежание чрезмерных затрат каждое правило генерации оповещений может отслеживать до 5000 временных рядов по умолчанию. Чтобы увеличить это ограничение в подписке, откройте запрос в службу поддержки.


## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения о мониторинге при масштабировании с помощью оповещений метрик и [динамических порогов](../alerts/alerts-dynamic-thresholds.md).
