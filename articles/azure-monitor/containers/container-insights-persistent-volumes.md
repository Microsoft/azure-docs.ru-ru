---
title: Настройка мониторинга PV с помощью Container Insights | Документация Майкрософт
description: В этой статье описывается, как настроить мониторинг кластеров Kubernetes с постоянными томами с помощью Container Insights.
ms.topic: conceptual
ms.date: 03/03/2021
ms.openlocfilehash: 16c87177a8911a7b88284606f54f7bf6e0e0daa3
ms.sourcegitcommit: a8ff4f9f69332eef9c75093fd56a9aae2fe65122
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/24/2021
ms.locfileid: "105026110"
---
# <a name="configure-pv-monitoring-with-container-insights"></a>Настройка мониторинга PV с помощью Container Insights

Начиная с версии агента *ciprod10052020*, Azure Monitor для интегрированного агента контейнеров теперь поддерживает мониторинг использования ПС (постоянный том). С помощью агента версии *ciprod01112021* агент поддерживает мониторинг инвентаризации ПС, включая сведения о состоянии, классе хранения, типе, режимах доступа и другие сведения.
## <a name="pv-metrics"></a>Метрики PV

Аналитика контейнеров автоматически начинает мониторинг использования PV, собирая следующие метрики за интервал 60-с и сохраняя их в таблице **инсигхтметрикс** .

| Имя метрики | Измерение метрики (Теги) | Описание метрики | | `pvUsedBytes`| подуид, поднаме, пвкнаме, пвкнамеспаце, капаЦитибитес, clusterId, имя_кластера | Занятое место в байтах для определенного постоянного тома с утверждением, используемым конкретным Pod. `capacityBytes` в виде измерения в поле Теги, чтобы уменьшить стоимость приема данных и упростить запросы. |

Дополнительные сведения о настройке собранных метрик ПС см. [здесь](./container-insights-agent-config.md).

## <a name="pv-inventory"></a>Инвентаризация PV

Azure Monitor для контейнеров автоматически запускает мониторинг постоянного хранилища версий, собирая следующие сведения с интервалом в 60 с и сохраняя их в таблице **кубепвинвентори** .

|Данные |Источник данных| Тип данных| Поля|
|-----|-----------|----------|-------|
|Инвентаризация постоянных томов в кластере Kubernetes |API KUBE |`KubePVInventory` | Пвнаме, ПвкапаЦитибитес, Пвкнаме, Пвкнамеспаце, Пвстатус, Пвакцессмодес, Пвтипе, Пвтипеинфо, PVStorageClassName, PVCreationTimestamp, TimeGenerated, ClusterId, имя_кластера, _ResourceId |

## <a name="monitor-persistent-volumes"></a>Мониторинг постоянных томов

Azure Monitor для контейнеров содержит предварительно настроенные диаграммы для этой метрики использования и сведения об инвентаризации в шаблонах книг для каждого кластера. Вы также можете включить рекомендуемое оповещение об использовании PV и запросить эти метрики в Log Analytics.  

### <a name="workload-details-workbook"></a>Книга сведений о рабочей нагрузке

Диаграммы использования для конкретных рабочих нагрузок можно найти на вкладке постоянные тома в книге **сведения о рабочей нагрузке** непосредственно из кластера AKS, выбрав пункт книги в области слева, из раскрывающегося списка **Просмотр книг** в области аналитика или на **вкладке отчеты (Предварительная версия)** в области аналитика.


:::image type="content" source="./media/container-insights-persistent-volumes/pv-workload-example.PNG" alt-text="Пример книги рабочей нагрузки Azure Monitor PV":::

### <a name="persistent-volume-details-workbook"></a>Книга сведений о постоянном томе

Общие сведения об инвентаризации постоянных томов можно найти в книге **сведения о постоянных** томах непосредственно из кластера AKS, выбрав пункт книги в области слева, из раскрывающегося списка **Просмотр книг** в области аналитика или на вкладке **отчеты (Предварительная версия)** в области аналитика.


:::image type="content" source="./media/container-insights-persistent-volumes/pv-details-workbook-example.PNG" alt-text="Пример книги сведений о Azure Monitor PV":::

### <a name="persistent-volume-usage-recommended-alert"></a>Рекомендуемое предупреждение об использовании постоянного тома
Вы можете включить рекомендуемое оповещение о том, что среднее использование ПС для Pod превышает 80%. Дополнительные сведения о предупреждениях [и](./container-insights-metric-alerts.md) переопределении порога по умолчанию см. [здесь](./container-insights-metric-alerts.md#configure-alertable-metrics-in-configmaps).
## <a name="next-steps"></a>Следующие шаги

- Дополнительные сведения о собранных метриках ПС см. [здесь](./container-insights-agent-config.md).