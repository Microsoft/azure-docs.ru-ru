---
title: Azure Monitor визуализаций схемы книги
description: Сведения о Azure Monitor визуализациях схемы книги.
services: azure-monitor
author: lgayhardt
ms.workload: tbd
ms.tgt_pltfrm: ibiza
ms.topic: conceptual
ms.date: 11/25/2020
ms.author: lagayhar
ms.openlocfilehash: dd9bafab982923785898b7f135e5c0408aa19a14
ms.sourcegitcommit: 867cb1b7a1f3a1f0b427282c648d411d0ca4f81f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "100622848"
---
# <a name="map-visualization"></a>Визуализация карты

Визуализация карт помогает в отслеживании проблем в конкретных регионах и показывает обобщенные статистические представления данных мониторинга, предоставляя возможность агрегирования всех данных, сопоставленных с каждым расположением, страной или регионом.

На следующем снимке экрана показаны общие транзакции и полная задержка для разных учетных записей хранения. Здесь размер определяется по общему количеству транзакций, а цветовые метрики на карте отображают сквозную задержку. При первом наблюдении число транзакций в регионе " **Западная часть США** " невелико по сравнению с регионом " **Восточная** часть США", но задержка в регионе " **Западная** часть США" выше, чем в регионе "Восточная часть **США** ". Это позволяет получить начальное представление о том, что что-то упущеноо для **западной части США**.

![Снимок экрана: схема расположения Azure](./media/workbooks-map-visualizations/map-performance-example.png)

## <a name="adding-a-map"></a>Добавление схемы

Карту можно отобразить, если базовые данные или метрики имеют сведения широты/долготы, сведения о ресурсах Azure, сведения о расположении Azure или страну или регион, имя или код страны или региона.

### <a name="using-azure-location"></a>Использование расположения Azure

1. Переключите книгу в режим редактирования, выбрав пункт **изменить** элемент на панели инструментов.
2. Выберите **Добавить** , а затем *Добавить запрос*.
3. Измените *источник данных* , чтобы `Azure Resource Graph` затем выбрать любую подписку с учетной записью хранения.
4. Введите следующий запрос для анализа и выберите **выполнить запрос**.

    ```kusto
    where  type =~ 'microsoft.storage/storageaccounts'
    | summarize count() by location
    ```

5. Задайте для параметра *Размер* значение `Large` .
6. Задайте для *визуализации* значение `Map` .
7. Все параметры будут заполнены автоматически. Для параметра пользовательские параметры нажмите кнопку **Параметры отображения** , чтобы открыть панель Параметры.
8. Ниже приведен снимок экрана с визуализацией карт, которая показывает учетные записи хранения для каждого региона Azure для выбранной подписки.

![Снимок экрана с картой расположения Azure с указанным выше запросом](./media/workbooks-map-visualizations/map-azure-location-example.png)

### <a name="using-azure-resource"></a>Использование ресурса Azure

1. Переключите книгу в режим редактирования, выбрав пункт **изменить** элемент на панели инструментов.
2. Выберите **Добавить** , а затем *Добавить метрику*.
3. Используйте подписку с учетными записями хранения.
4. Измените *тип ресурса* на `storage account` и в *ресурсе* выберите несколько учетных записей хранения.
5. Выберите **Добавить метрику** и добавьте метрику транзакции.
    1. Пространство имен: `Account`
    2. Шкал `Transactions`
    3. Статистической обработки `Sum`
    
    ![Снимок экрана: метрика транзакции](./media/workbooks-map-visualizations/map-transaction-metric.png)
1. Выберите **Добавить метрику** и добавить метрику задержки E2E.
    1. Пространство имен: `Account`
    1. Шкал `Success E2E Latency`
    1. Статистической обработки `Average`
    
    ![Снимок экрана: Метрика "сквозная задержка"](./media/workbooks-map-visualizations/map-e2e-latency-metric.png)
1. Задайте для параметра *Размер* значение `Large` .
1. Задайте для параметра размер *визуализации* значение `Map` .
1. В **параметрах Map** задайте следующие параметры.
    1. Сведения о расположении с помощью: `Azure Resource`
    1. Поле ресурса Azure: `Name`
    1. Размер по: `microsoft.storage/storageaccounts-Transaction-Transactions`
    1. Статистическая обработка для расположения: `Sum of values`
    1. Тип цвета: `Heatmap`
    1. Цвет: `microsoft.storage/storageaccounts-Transaction-SuccessE2ELatency`
    1. Статистическая обработка для цвета: `Sum of values`
    1. Цветовая палитра: `Green to Red`
    1. Минимальное значение: `0`
    1. Значение метрики: `microsoft.storage/storageaccounts-Transaction-SuccessE2ELatency`
    1. Объединить другие метрики: `Sum of values`
    1. Выбор **настраиваемого поля форматирования**
    1. Модульных `Milliseconds`
    1. Стиль `Decimal`
    1. Максимальное число цифр дробной части: `2`

### <a name="using-countryregion"></a>Использование страны или региона

1. Переключите книгу в режим редактирования, выбрав пункт **изменить** элемент на панели инструментов.
2. Выберите **Добавить*, а затем — *Добавить запрос*.
3. Измените *источник данных* на `Log` .
4. Выберите *тип ресурса* `Application Insights` , а затем выберите любой Application Insights ресурс с данными pageViews.
5. С помощью редактора запросов введите ККЛ для анализа и выберите **выполнить запрос**.

    ```kusto
    pageViews
    | project duration, itemCount, client_CountryOrRegion
    | limit 20
    ```

6. Задайте для параметра Размер значение `Large` .
7. Задайте для визуализации значение `Map` .
8. Все параметры будут заполнены автоматически. В качестве настраиваемых параметров выберите **Параметры карт**.

### <a name="using-latitudelocation"></a>Использование широты и расположения

1. Переключите книгу в режим редактирования, выбрав пункт **изменить** элемент на панели инструментов.
2. Выберите **Добавить*, а затем — *Добавить запрос*.
3. Измените *источник данных* на `JSON` .
1. Введите данные JSON ниже в редакторе запросов и выберите **выполнить запрос**.
1. Задайте для параметра *Размер* значение `Large` .
1. Задайте для *визуализации* значение `Map` .
1. В **параметрах схемы** в разделе "Параметры метрики" установите *метку метрики* , `displayName` а затем нажмите кнопку **сохранить и закрыть**.

На рисунке ниже показаны пользователи для каждой широты и долготы с выбранной меткой для метрик.

![Снимок экрана с визуализацией карт, которая показывает пользователей для каждой широты и долготы, с выбранной меткой для метрик](./media/workbooks-map-visualizations/map-latitude-longitude-example.png)

## <a name="map-settings"></a>Параметры карты

### <a name="layout-settings"></a>Параметры макета

| Параметр | Объяснение |
|:-------------|:-------------|
| `Location info using` | Выберите способ получения расположения элементов, отображаемых на карте. <br> **Широта/Долгота**: Выберите этот параметр, если имеются столбцы со сведениями широты и долготы. Каждая строка с данными широты и долготы будет отображаться на карте как отдельный элемент. <br> **Расположение Azure**. Выберите этот параметр, если имеется столбец, содержащий сведения о расположении Azure (eastus, westeurope, централиндиа и т. д.). Укажите этот столбец и выберет соответствующие широту и долготу для каждого расположения Azure, сгруппируйте одинаковые строки расположения (на основе указанной статистической обработки) вместе, чтобы отобразить расположения на карте. <br> **Ресурс Azure**. Выберите этот параметр, если имеется столбец со сведениями о ресурсах Azure (учетная запись хранения, учетная запись cosmosdb и т. д.). Укажите этот столбец, и он выберет соответствующие широту и долготу для каждого ресурса Azure, сгруппируйте одинаковые строки расположения (расположение Azure) (на основе указанной статистической обработки), чтобы отобразить расположения на карте. <br> **Страна или регион**: Выберите этот параметр, если имеется столбец, содержащий сведения о стране или регионе (сша, США, в, Индии, CN, Китае). Укажите этот столбец, и он выберет соответствующие широту и долготу для каждой страны, региона или кода и сгруппируйте строки вместе с тем же Country-Region названием "код/страна-регион", чтобы отобразить расположения на карте. Название страны и код страны не будут сгруппированы вместе в виде единой сущности на карте.
| `Latitude/Longitude` | Эти два параметра будут видны, если поле сведений о расположении имеет значение "Широта/Долгота". Выберите столбец с широтой в поле широты и долготу в поле Долгота соответственно. |
| `Azure location field` | Этот параметр будет отображаться, если поле сведений о расположении имеет значение "расположение Azure". Выберите столбец, сведения о расположении Azure. |
| `Azure resource field` | Этот параметр будет отображаться, если поле сведений о расположении имеет значение: ресурс Azure. Выберите столбец, в котором находятся сведения о ресурсах Azure. |
| `Country/Region field` | Этот параметр будет отображаться, если поле сведений о расположении имеет значение "страна" или "регион". Выберите столбец, сведения о стране или регионе. |
| `Size by` | Этот параметр управляет размером элементов, отображаемых на карте. Размер зависит от значения в столбце, указанном пользователем. В настоящее время радиус окружности прямо пропорционален квадратному корню значения столбца. Если "нет..." выбрано, все круги будут показывать размер области по умолчанию.|
| `Aggregation for location` | В этом поле указывается, как выполнить статистическую обработку **по** столбцам с одинаковым расположением Azure, ресурсом или страной-регионом. |
| `Minimum region size` | В этом поле указывается минимальный радиус элемента, отображаемого на карте. Это используется при значительной разнице между значениями по столбцу, поэтому небольшие элементы вряд ли будут видны на карте. |
| `Maximum region size` | В этом поле указывается максимальный радиус элемента, отображаемого на карте. Используется, когда значения размера столбца очень велики, и они охватывают огромную область на карте.|
| `Default region size` | В этом поле указывается значение радиуса по умолчанию для элемента, отображаемого на карте. Радиус по умолчанию используется, если для столбца Size задано значение None... или значение равно 0.|
| `Minimum value` | Минимальное значение, используемое для расчета размера области. Если значение не указано, минимальное значение будет минимальным значением после статистической обработки. |
| `Maximum value` | Максимальное значение, используемое для расчета размера региона. Если не указано, максимальное значение будет максимальным значением после статистической обработки.|
| `Opacity of items on Map` | В этом поле указывается, насколько прозрачными являются элементы, отображаемые на карте. Непрозрачность 1 означает отсутствие прозрачности, где степень прозрачности 0 означает, что элементы не будут видны на карте. Если на карте слишком много элементов, можно установить непрозрачность с низким значением, чтобы все перекрывающиеся элементы были видимы.|

### <a name="color-settings"></a>Параметры цвета

| Тип цвета | Пояснение |
|:------------- |:-------------|
| `None` | Все узлы имеют одинаковый цвет. |
| `Thresholds` | В этом типе цвета ячеек задаются правилами порога (например, _цп > 90% => Red, 60% > цп > 90% => желтый, цп < 60% => Green_). <ul><li> **Color by**: значение этого столбца будет использоваться пороговое значение или логику тепловой карты.</li> <li>**Статистическая обработка для цвета**. в этом поле указывается, как объединять **Цвет по** столбцам, имеющим то же расположение Azure, ресурс или страну-регион. </li> <ul> |
| `Heatmap` | В этом типе ячейки выделены цветом на основе цветовой палитры и поля цвета. Это также будет иметь тот же **цвет,** что и **для параметров цвета** в качестве пороговых значений. |

### <a name="metric-settings"></a>Параметры метрики
| Параметр | Объяснение |
|:------------- |:-------------|
| `Metric Label` | Этот параметр будет отображаться, если поле сведений о расположении имеет значение "Широта/Долгота". С помощью этой функции пользователь может выбрать метку для отображения метрик, показанных под картой. |
| `Metric Value` | В этом поле указывается значение метрики, которое должно отображаться под картой. |
| `Create 'Others' group after` | В этом поле указывается ограничение до создания группы "другие". |
| `Aggregate 'Others' metrics by` | В этом поле указывается Статистическая обработка, используемая для группы "другие", если она отображается. |
| `Custom formatting` | Используйте это поле, чтобы задать единицы измерения, стили и параметры форматирования для числовых значений. Это аналогично [пользовательскому форматированию сетки](../visualize/workbooks-grid-visualizations.md#custom-formatting).|

## <a name="next-steps"></a>Дальнейшие действия

- Узнайте, как создать [honeytoken объединение визуализаций в книгах](../visualize/workbooks-honey-comb.md).