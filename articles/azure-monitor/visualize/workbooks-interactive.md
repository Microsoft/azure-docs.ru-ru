---
title: Azure Monitor книг с пользовательскими параметрами
description: Упростите создание сложных отчетов с помощью готовых настраиваемых параметризованных книг
services: azure-monitor
manager: carmonm
ms.workload: tbd
ms.tgt_pltfrm: ibiza
ms.topic: conceptual
ms.date: 07/20/2020
ms.openlocfilehash: 2cb284e1978ad6c890835318c51c6095891397cd
ms.sourcegitcommit: 910a1a38711966cb171050db245fc3b22abc8c5f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/20/2021
ms.locfileid: "101723016"
---
# <a name="interactive-workbooks"></a>Интерактивные Workbooks

Книги позволяют авторам создавать интерактивные отчеты и взаимодействия с пользователями. Интерактивность поддерживается несколькими способами.

## <a name="parameter-changes"></a>Изменения параметров

Когда пользователь книги обновляет параметр, любой элемент управления, использующий этот параметр, автоматически обновляется и перерисовывается в соответствии с новым состоянием. В этом случае большинство отчетов портал Azure поддерживают интерактивность. Книги обеспечивают это прямым способом с минимальными усилиями пользователя.

Дополнительные сведения о [параметрах в книгах](workbooks-parameters.md)

## <a name="grid-tile-chart-selections"></a>Сетка, плитка, элементы диаграммы

Книги позволяют авторам создавать сценарии, в которых щелчок строки в сетке обновляет последующие диаграммы на основе содержимого строки.

Например, пользователь может иметь сетку, в которой отображается список запросов и определенная статистика, например количество сбоев. Они могут настроить таким образом, что при щелчке строки, соответствующей запросу, на приведенных ниже диаграммах будут обновлены данные для фильтрации только по этому запросу.

### <a name="setting-up-interactivity-on-grid-row-click"></a>Настройка интерактивности при щелчке по строке сетки

1. Переключите книгу в режим редактирования, щелкнув элемент панели инструментов _изменить_ .
2. Используйте ссылку _Добавить запрос_ , чтобы добавить в книгу элемент управления "запрос журнала".
3. Выберите тип запроса в поле _Журнал_, тип ресурса (например, Application Insights) и ресурсы для целевого объекта.
4. Использование редактора запросов для ввода ККЛ для анализа

    ```kusto
    requests
    | summarize AllRequests = count(), FailedRequests = countif(success == false) by Request = name
    | order by AllRequests desc
    ```

5. `Run query` Просмотр результатов
6. Щелкните значок _Дополнительные параметры_ в нижнем колонтитуле запроса (значок выглядит как шестеренка). Откроется область Дополнительные параметры.
7. Проверьте параметр: `When an item is selected, export a parameter` .
8. В разделе с установленным параметром выберите *Добавить параметр* и заполните его информацией ниже.
    1. Поле для экспорта: `Request`
    2. Имя параметра: `SelectedRequest`
    3. Значение по умолчанию — `All requests`.
9. Нажатие кнопки "Сохранить"

    ![Снимок экрана, показывающий Расширенный редактор с параметрами экспорта полей в качестве параметров.](./media/workbooks-interactive/export-parameters-add.png)

10. Выберите `Done Editing`.
11. Добавьте еще один элемент управления запроса, используя шаги 2 и 3.
12. Используйте редактор запросов, чтобы ввести ККЛ для анализа.
    ```kusto
    requests
    | where name == '{SelectedRequest}' or 'All Requests' == '{SelectedRequest}'
    | summarize ['{SelectedRequest}'] = count() by bin(timestamp, 1h)
    ```
13. `Run query` для просмотра результатов.
14. Измените _визуализацию_ на `Area chart` .
15. Выберите строку для выбора в первой сетке. Обратите внимание, что диаграмма с областями, приведенная ниже, фильтрует выбранный запрос.

Итоговый отчет будет выглядеть в режиме редактирования:

![Снимок экрана: первый два запроса в режиме редактирования.](./media/workbooks-interactive//interactivity-grid-create.png)

На рисунке ниже показан более сложный интерактивный отчет в режиме чтения, основанный на тех же принципах. В отчете используются щелчки сетки для экспорта параметров, которые, в свою очередь, используются в двух диаграммах и блоке текста.

![Снимок экрана: отчет, использующий щелчки сетки в режиме чтения.](./media/workbooks-interactive/interactivity-grid-read-mode.png)

### <a name="exporting-the-contents-of-an-entire-row"></a>Экспорт содержимого целой строки

Иногда желательно экспортировать все содержимое выбранной строки, а не только конкретный столбец. В таких случаях оставьте `Field to export` значение свойства на шаге 7,1 выше. Книга экспортирует содержимое строки целиком в виде JSON-файла в параметр.

В ссылающемся элементе управления ККЛ используйте `todynamic` функцию, чтобы проанализировать JSON и получить доступ к отдельным столбцам.

## <a name="grid-cell-clicks"></a>Щелчки ячеек сетки

Книги позволяют авторам добавлять интерактивные возможности с помощью специального типа модуля подготовки столбцов сетки, называемого `link renderer` . Модуль подготовки отчетов преобразует ячейку сетки в гиперссылку на основе содержимого ячейки. Книги поддерживают множество типов модулей подготовки отчетов, включая те, которые позволяют открывать колонки обзора ресурсов, средства просмотра контейнеров свойств, поиск в App Insights, использование, трассировку транзакций и т. д.

### <a name="setting-up-interactivity-using-grid-cell-clicks"></a>Настройка взаимодействия с помощью щелчков ячеек сетки

1. Переключите книгу в режим редактирования, щелкнув элемент панели инструментов _изменить_ .
2. Используйте ссылку _Добавить запрос_ , чтобы добавить в книгу элемент управления "запрос журнала".
3. Выберите тип запроса в поле _Журнал_, тип ресурса (например, Application Insights) и ресурсы для целевого объекта.
4. Использование редактора запросов для ввода ККЛ для анализа

    ```kusto
    requests
    | summarize Count = count(), Sample = any(pack_all()) by Request = name
    | order by Count desc
    ```

5. `Run query` Просмотр результатов
6. Выберите _Параметры столбца_ , чтобы открыть панель Параметры.
7. В разделе _столбцы_ задайте:
    1.  Модуль подготовки к `Link` просмотру столбцов:, представление для открытия: `Cell Details` , метка ссылки:`Sample`
    2. Визуализатор столбца _Count_ : `Bar` , цветовая палитра: `Blue` , минимальное значение:`0`
    3. Модуль подготовки столбцов _запросов_ :`Automatic`
    4. Нажмите кнопку _сохранить и закрыть_ , чтобы применить изменения.

    ![Снимок экрана вкладки параметра столбца.](./media/workbooks-interactive/column-settings.png)

8. Щелкните одну из `Sample` ссылок в сетке. Откроется панель с подробными сведениями о примере запроса.

    ![Снимок экрана: область сведений запроса выборки.](./media/workbooks-interactive/details.png)

### <a name="link-renderer-actions"></a>Действия модуля подготовки ссылок

| Действие ссылки | Действие по щелчку |
|:------------- |:-------------|
| `Generic Details` | Показывает значения строк на вкладке контекста сетки свойств |
| `Cell Details` | Показывает значение ячейки на вкладке контекста сетки свойств. Полезно, если ячейка содержит динамический тип со сведениями (например, JSON с такими свойствами запроса, как расположение, экземпляр роли и т. д.). |
| `Cell Details` | Показывает значение ячейки на вкладке контекста сетки свойств. Полезно, если ячейка содержит динамический тип со сведениями (например, JSON с такими свойствами запроса, как расположение, экземпляр роли и т. д.). |
| `Custom Event Details` | Открывает Application Insights сведения о поиске с ИДЕНТИФИКАТОРом настраиваемого события ( `itemId` ) в ячейке. |
| `* Details` | Аналогично пользовательским сведениям о событии, за исключением зависимостей, исключений, просмотров страниц, запросов и трассировок. |
| `Custom Event User Flows` | Открывает Application Insights Маршруты пользователей возможности, сведенные по имени пользовательского события в ячейке. |
| `* User Flows` | Аналогично Маршруты пользователей пользовательских событий, за исключением исключений, просмотров страниц и запросов |
| `User Timeline` | Открывает временную шкалу пользователя с ИДЕНТИФИКАТОРом пользователя (user_Id) в ячейке |
| `Session Timeline` | Открывает Application Insights поиска для значения в ячейке (например, Поиск текста "ABC", где ABC — это значение в ячейке). |
| `Resource overview` | Откройте Обзор ресурса на портале на основе значения идентификатора ресурса в ячейке. |

## <a name="conditional-visibility"></a>Условная видимость

Книга позволяет пользователям отображать или убирать определенные элементы управления в зависимости от значений параметров. Это позволяет авторам создавать различные отчеты в зависимости от состояния пользовательского ввода или телеметрии. Пример показывает, что пользователи представляют собой сводку, когда все хорошо, но показывают полные сведения, если что-то не так.

### <a name="setting-up-interactivity-using-conditional-visibility"></a>Настройка взаимодействия с помощью условной видимости

1. Чтобы настроить два интерактивных элемента управления, выполните действия, описанные в разделе [Настройка взаимодействия в строке сетки щелкните](#setting-up-interactivity-on-grid-row-click) раздел.
2. Добавьте новый параметр в начало:
    1. Имя: `ShowDetails`
    2. Тип параметра: `Drop down`
    3. Обязательно: `checked`
    4. Получить данные из: `JSON`
    5. Входные данные JSON: `["Yes", "No"]`
    6. Сохраните для фиксации изменений.

    ![После нажатия кнопки Добавить параметр отображается панель Изменение параметров.](./media/workbooks-interactive/edit-parameter.png)

3. Задайте для параметра значение `Yes`

    ![Над кнопкой завершено редактирование находится раскрывающийся список, позволяющий задать значение параметра.](./media/workbooks-interactive/set-parameter.png)

4. В элементе управления запросом с диаграммой с областями выберите значок _Дополнительные параметры_ (значок шестеренки).
5. Проверка параметра `Make this item conditionally visible`
    1. Этот элемент отображается, если `ShowDetails` значение `equals` параметра `Yes`
6. Выберите вариант _Готово_ к изменению, чтобы зафиксировать изменения.
7. Нажмите кнопку _Готово к редактированию_ на панели инструментов книги, чтобы перейти в режим чтения.
8. Переключить значение параметра `ShowDetails` на `No` . Обратите внимание, что приведенная ниже диаграмма исчезает.

На рисунке ниже показан видимый случай `ShowDetails` , где — `Yes`

![Снимок экрана, показывающий условную видимость, где отображается диаграмма](./media/workbooks-interactive/interactivity-conditional-visibility-visible.png)

На рисунке ниже показан скрытый случай, где `ShowDetails``No`

![Снимок экрана, показывающий условную видимость, когда диаграмма скрыта](./media/workbooks-interactive/interactivity-conditional-visibility-invisible.png)

## <a name="interactivity-with-multiple-selections-in-grids-and-charts"></a>Интерактивное взаимодействие с множественным выбором в сетках и диаграммах

Шаги запросов и метрик могут также экспортировать один или несколько параметров при выборе строки (или нескольких строк).

![Снимок экрана, показывающий параметры экспорта параметров с несколькими параметрами. ](./media/workbooks-interactive/interactivity-export-parameters.png)

1. На шаге запроса, отображающем сетку, перейдите к дополнительным параметрам.
2. Установите флажок `When items are selected, export parameters` . Отобразятся дополнительные элементы управления.
3. Установите флажок `allow selection of multiple values` .
    1. Отображаемая визуализация будет допускать значения множественного выбора и экспорта значений параметра будет массивом значений, например при использовании параметров раскрывающегося списка множественного выбора.
    2. Если флажок снят, Визуализация отображения будет учитывать только последний выбранный элемент. Экспорт только одного значения за раз.
4. Для каждого параметра, который вы хотите экспортировать, используйте кнопку *Добавить параметр* . Появится всплывающее окно с параметрами экспортируемого параметра.

Если включен один выбор, автор может указать, какое поле исходных данных следует экспортировать. Поля включают имя параметра, тип параметра и значение по умолчанию для использования, если ничего не выбрано (необязательно).

При включении множественного выбора автор указывает, какое поле исходных данных следует экспортировать. К полям относятся имя параметра, тип параметра, кавычка с разделителем и разделитель. Кавычки со значениями и разделителями используются при переворачивании значений стрелок в текст при замене в запросе. При выборе нескольких значений, если значения не выбраны, значение по умолчанию — пустой массив.

> [!NOTE]
> В случае множественного выбора будут экспортированы только уникальные значения. значения массива вывода, например "1, 1, 2, 1", будут отображаться как выходные значения "1, 2".

В параметрах экспорта можно оставить параметр "поле для экспорта" пустым. В этом случае все доступные поля в данных будут экспортированы как объект JSON переведенные пар "ключ: значение". Для сеток и заголовков это будут все поля в сетке. Для диаграмм доступные поля будут иметь вид x, y, рядов и меток (в зависимости от типа диаграммы).

Хотя в качестве поведения по умолчанию экспортируется параметр в виде текста, если известно, что это поле является подпиской или ИДЕНТИФИКАТОРом ресурса, используйте его в качестве типа параметра экспорта. Это позволит использовать параметр в местах, требующих таких типов параметров.

## <a name="next-steps"></a>Дальнейшие действия

* [Узнайте](./workbooks-overview.md#visualizations) больше о книгах с множеством разнообразных вариантов визуализации.
* [Управление](./workbooks-access-control.md) доступом к ресурсам книги и предоставление общего доступа к ним.