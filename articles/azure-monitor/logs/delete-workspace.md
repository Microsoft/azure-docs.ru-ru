---
title: Удаление и восстановление рабочей области Azure Log Analytics | Документация Майкрософт
description: Узнайте, как удалить рабочую область Log Analytics, если она была создана в личной подписке, или как изменить структуру модели рабочей области.
ms.topic: conceptual
author: bwren
ms.author: bwren
ms.date: 12/20/2020
ms.openlocfilehash: 83a64e3348d4af768c56609df3df5c9194ec5af1
ms.sourcegitcommit: 910a1a38711966cb171050db245fc3b22abc8c5f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/20/2021
ms.locfileid: "102030874"
---
# <a name="delete-and-recover-azure-log-analytics-workspace"></a>Удаление и восстановление рабочей области Azure Log Analytics

В этой статье объясняется понятие обратимого удаления в рабочей области Azure Log Analytics и восстановление удаленной рабочей области.

## <a name="considerations-when-deleting-a-workspace"></a>Важные моменты при удалении рабочей области

При удалении рабочей области Log Analytics выполняется операция обратимого удаления, позволяющая восстановить рабочую область, включая ее данные и подключенные агенты, в течение 14 дней. После периода обратимого удаления ресурс рабочей области и его данные не могут быть восстановлены и поставлены в очередь для очищения полностью в течение 30 дней. Имя рабочей области будет освобождено, и его можно будет использовать для создания новой области.

> [!NOTE]
> Если вы хотите переопределить поведение обратимого удаления и окончательно удалить рабочую область, выполните действия, описанные в статье [Удаление постоянной рабочей области](#permanent-workspace-delete).

Необходимо соблюдать осторожность при удалении рабочей области, так как в ней могут быть важные данные и настройки, удаление которых может отрицательно повлиять на работу службы. Проверьте, какие агенты, решения и другие службы Azure хранят свои данные в Log Analytics, например:

* Решения для управления
* Служба автоматизации Azure
* агенты, работающие на виртуальных машинах Windows и Linux;
* агенты, работающие на компьютерах Windows и Linux в вашей среде;
* System Center Operations Manager

Операция обратимого удаления удаляет ресурс рабочей области и тем самым повреждает настройки разрешений для пользователей. Если пользователи связаны с другими рабочими областями, они смогут продолжить использовать Log Analytics в этих рабочих областях.

## <a name="soft-delete-behavior"></a>Поведение обратимого удаления

Операция удаления рабочей области удаляет ресурс рабочей области диспетчера ресурсов, делая его внешне недоступным, но его конфигурация и данные хранятся в течение 14 дней. Все агенты и группы управления System Center Operations Manager, для которых настроена отправка отчетов в рабочую область, будут продолжать работу в потерянном состоянии во время периода обратимого удаления. Служба также предоставляет механизм восстановления удаленной рабочей области, включая все данные и связанные ресурсы, по сути отменяя удаление.

> [!NOTE] 
> Установленные решения и связанные службы, такие как учетная запись службы автоматизации Azure, окончательно удаляются из рабочей области в процессе удаления, и их невозможно восстановить. После процедуры восстановления их необходимо будет перенастроить, чтобы вернуть рабочую область в ранее настроенное состояние.

Удалить рабочую область можно с помощью [PowerShell](/powershell/module/azurerm.operationalinsights/remove-azurermoperationalinsightsworkspace), [REST API](/rest/api/loganalytics/workspaces/delete) или через [портал Azure](https://portal.azure.com).

### <a name="azure-portal"></a>Портал Azure

1. Войдите на [портал Azure](https://portal.azure.com). 
2. На портале Azure щелкните **Все службы**. В списке ресурсов введите **Log Analytics**. Как только вы начнете вводить символы, список отфильтруется соответствующим образом. Выберите **Рабочие области Log Analytics**.
3. В списке областей Log Analytics выберите нужную рабочую область, а затем щелкните **Удалить** вверху средней панели.
4. Появится страница подтверждения, на которой будет дана сводка приема данных в рабочей области за последнюю неделю. 
5. Если вы хотите удалить рабочую область без возможности восстановления, снимите флажок **удалить рабочую область без возможности восстановления** .
6. Введите название рабочей области для подтверждения и затем нажмите кнопку **Удалить**.

   ![Подтверждение удаления рабочей области](media/delete-workspace/workspace-delete.png)

### <a name="powershell"></a>PowerShell
```PowerShell
PS C:\>Remove-AzOperationalInsightsWorkspace -ResourceGroupName "resource-group-name" -Name "workspace-name"
```

## <a name="permanent-workspace-delete"></a>Удаление рабочей области без возможности восстановления
В определенных случаях метод обратимого удаления может быть неприменим, например при разработке и тестировании, когда необходимо повторять развертывание с теми же параметрами и именем рабочей области. Для этого вы можете проигнорировать обратимое удаление и удалить рабочую область окончательно. Операция удаления постоянной рабочей области освобождает имя рабочей области, и вы можете создать новую рабочую область с тем же именем.

> [!IMPORTANT]
> Используйте постоянную операцию удаления рабочей области с осторожностью, так как она необратима и вы не сможете восстановить рабочую область и ее данные.

Чтобы окончательно удалить рабочую область с помощью портал Azure, установите флажок **удалить рабочую область без возможности восстановления** , прежде чем нажать кнопку **Удалить** .

Чтобы окончательно удалить рабочую область с помощью PowerShell, добавьте тег "-Форцеделете", чтобы окончательно удалить рабочую область. Параметр "-Форцеделете" в настоящее время доступен с помощью AZ. OperationalInsights 2.3.0 или более поздней версии. 

```powershell
PS C:\>Remove-AzOperationalInsightsWorkspace -ResourceGroupName "resource-group-name" -Name "workspace-name" -ForceDelete
```

## <a name="recover-workspace"></a>Восстановление рабочей области
При случайном или намеренном удалении рабочей области Log Analytics служба помещает ее в состояние обратимого удаления, делая ее недоступной для операций. Имя рабочей области сохраняется во время процесса обратимого удаления и не может быть использовано для создания новой области. По окончании периода рабочая область становится недоступной для восстановления и переходит в очередь для необратимого удаления, а ее имя освобождается и в дальнейшем может быть использовано для создания новой области.

Рабочую область можно восстановить в течение периода обратимого удаления, включая ее данные, настройки и подключенные агенты. Для выполнения операции требуется права к подписке и группе ресурсов, с которыми рабочая область была связана до ее обратимого удаления, на уровне Участника. Восстановление рабочей области выполняется путем повторного создания рабочей области Log Analytics с подробными сведениями об удаленной рабочей области, в том числе:

- Идентификатор подписки
- Имя группы ресурсов
- имя рабочей области.
- Регион

> [!IMPORTANT]
> Если Рабочая область была удалена как часть операции удаления группы ресурсов, необходимо сначала повторно создать группу ресурсов.

### <a name="azure-portal"></a>Портал Azure

1. Войдите на [портал Azure](https://portal.azure.com). 
2. На портале Azure щелкните **Все службы**. В списке ресурсов введите **Log Analytics**. Как только вы начнете вводить символы, список отфильтруется соответствующим образом. Выберите **Рабочие области Log Analytics**. Отобразится список рабочих областей с выбранными фильтром параметрами.
3. Щелкните **Восстановить** в верхнем левом меню, чтобы открыть страницу с рабочими областями в состоянии обратимого удаления, которые можно восстановить.

   ![Снимок экрана Log Analytics рабочих областей в портал Azure с выделенным восстановлением в строке меню.](media/delete-workspace/recover-menu.png)

4. Выберите рабочую область и щелкните **Восстановить**, чтобы восстановить эту рабочую область.

   ![Снимок экрана: диалоговое окно восстановления удаленных Log Analytics рабочих областей в портал Azure с выделенной рабочей областью и выбранной кнопкой "восстановить".](media/delete-workspace/recover-workspace.png)


### <a name="powershell"></a>PowerShell
```PowerShell
PS C:\>Select-AzSubscription "subscription-name-the-workspace-was-in"
PS C:\>New-AzOperationalInsightsWorkspace -ResourceGroupName "resource-group-name-the-workspace-was-in" -Name "deleted-workspace-name" -Location "region-name-the-workspace-was-in"
```

После завершения операции восстановления рабочая область и все ее данные возвращаются обратно. Решения и связанные службы навсегда удаляются из рабочей области в момент процедуры удаления, и их нужно будет перенастроить, чтобы привести рабочую область в предыдущее состояние. Некоторые данные могут быть недоступны для запроса после восстановления рабочей области до тех пор, пока не будут повторно установлены связанные решения, а их схемы — добавлены в рабочую область.

## <a name="troubleshooting"></a>Устранение неполадок

Чтобы удалить рабочую область Log Analytics, необходимо иметь разрешение на уровне *участника Log Analytics*.

* Если вы не уверены в том, что удаленная рабочая область находится в состоянии обратимого удаления и может быть восстановлена, щелкните [Открыть корзину](#recover-workspace) на странице *log Analytics рабочие области* , чтобы просмотреть список рабочих областей с обратимым удалением на подписку. Окончательно удаленные рабочие области не включаются в список.
* При создании рабочей области вы можете получить сообщение о том, что *имя рабочей области уже используется* или же *совпадает*. Эта ошибка может происходить по ряду причин:
  * Имя рабочей области недоступно и используется кем-либо в вашей организации или другим клиентом.
  * Рабочая область была удалена в течение последних 14 дней, а ее имя зарезервировано на период обратимого удаления. Чтобы переопределить обратимое удаление и окончательно удалить рабочую область, чтобы создать рабочую область с тем же именем, выполните следующие действия, чтобы сначала восстановить рабочую область, а затем выполнить постоянное удаление:<br>
    1. [Восстановите](#recover-workspace) рабочую область.
    2. [Навсегда удалите](#permanent-workspace-delete) рабочую область.
    3. Создайте новую рабочую область, используя выбранное имя.
 
      После успешного завершения вызова удаления на серверной части можно восстановить рабочую область и выполнить операцию постоянного удаления в одном из методов, предложенных ранее.

* При получении кода ответа 204 с *ресурсом, который не найден* при удалении рабочей области, могут произойти последовательные попытки. 204 — это пустой ответ, который обычно означает, что ресурс не существует, поэтому Удаление завершено без выполнения каких-либо действий.
* Если удалить группу ресурсов и рабочую область, она отобразится на странице [Открыть корзину](#recover-workspace) , однако операция восстановления завершится ошибкой с кодом ошибки 404, так как группа ресурсов не существует — повторно создайте группу ресурсов и повторите восстановление.
