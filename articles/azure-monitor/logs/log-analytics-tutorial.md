---
title: Руководство по Log Analytics
description: В этом учебнике описано, как использовать функции Log Analytics в Azure Monitor, чтобы создать и выполнить запрос журнала и анализировать его результат на портале Azure.
ms.subservice: logs
ms.topic: tutorial
author: bwren
ms.author: bwren
ms.date: 10/07/2020
ms.openlocfilehash: 038663a6b8fe015f36f70b7bf13d25accb470903
ms.sourcegitcommit: e559daa1f7115d703bfa1b87da1cf267bf6ae9e8
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/17/2021
ms.locfileid: "100598283"
---
# <a name="log-analytics-tutorial"></a>Руководство по Log Analytics
Log Analytics — это средство на портале Azure для изменения и запуска запросов журнала из данных, собранных журналами Azure Monitor, и интерактивного анализа результатов. Запросы Log Analytics можно использовать для извлечения записей, соответствующих определенным условиям, определения тенденций, анализа шаблонов и предоставления разнообразных сведений о данных. 

В этом учебнике описан интерфейс Log Analytics, который позволяет приступить к работе с некоторыми базовыми запросами, и показано, как можно использовать результаты запросов. Вы узнаете следующее:

> [!div class="checklist"]
> * Изучение общей схемы данных журнала.
> * Создание и выполнение простых запросов и изменение диапазона времени для запросов.
> * Фильтрация, сортировка и группирование результатов запроса.
> * Просмотр, изменение и совместное использование визуальных элементов результатов запроса.
> * Загрузка, экспорт и копирование запросов и результатов.

> [!IMPORTANT]
> При работе с этим учебником используются функции Log Analytics для создания и запуска запроса, а не сам запрос. Вы будете использовать функции Log Analytics для создания одного запроса и использования другого примера запроса. Когда вы будете готовы к изучению синтаксиса запросов и непосредственному их редактированию, ознакомьтесь с учебником по [языку запросов Kusto](/azure/data-explorer/kusto/query/tutorial?pivots=azuremonitor). В этом учебнике рассматривается несколько примеров запросов, которые можно изменять и запускать в Log Analytics, используя несколько функций, с которыми вы ознакомитесь.


## <a name="prerequisites"></a>Обязательные условия
При работе с этим учебником можно использовать [демонстрационную среду Log Analytics](https://ms.portal.azure.com/#blade/Microsoft_Azure_Monitoring_Logs/DemoLogsBlade), которая включает в себя множество образцов данных, поддерживающих примеры запросов. Вы также можете использовать свою подписку Azure, но у вас может не быть данных в тех же таблицах.

## <a name="open-log-analytics"></a>Открытие Log Analytics
Откройте [демонстрационную среду Log Analytics](https://ms.portal.azure.com/#blade/Microsoft_Azure_Monitoring_Logs/DemoLogsBlade) или выберите **Журналы** в меню Azure Monitor в подписке. Начальная область будет задана в рабочей области Log Analytics. При выполнении запроса можно будет выбирать из всех данных в этой рабочей области. Если выбрать **Журналы** из меню ресурсов Azure, для области будут заданы только записи из этого ресурса. Дополнительные сведения об области см. в разделе [Область запросов журнала](../log-query/scope.md).

Область можно просмотреть в левом верхнем углу экрана. Если используется собственная среда, вам будет предоставлена возможность выбора другой области. Этот параметр недоступен в демонстрационной среде.

[![Область запроса](media/log-analytics-tutorial/scope.png)](media/log-analytics-tutorial/scope.png#lightbox)

## <a name="table-schema"></a>Схема таблицы
В левой части экрана содержится вкладка **Таблицы**, позволяющая просматривать таблицы, доступные в текущей области. По умолчанию они группируются по **решению**, но можно изменять их параметры группирования или выполнить фильтрацию. 

Разверните решение **Управление журналами** и найдите таблицу **AzureActivity**. Вы можете развернуть таблицу, чтобы просмотреть ее схему, или навести указатель мыши на ее имя, чтобы отобразить дополнительные сведения. 

[![Представление "Таблицы"](media/log-analytics-tutorial/table-details.png)](media/log-analytics-tutorial/table-details.png#lightbox)

Щелкните **Дополнительные сведения**, чтобы перейти по ссылке на таблицу с документацией по каждой таблице и ее столбцам. Щелкните **Просмотр данных**, чтобы быстро взглянуть на несколько последних записей в таблице. Это позволит убедиться, что указаны именно те ожидаемые данные, с которыми необходимо выполнить запрос.

[![Образцы данных](media/log-analytics-tutorial/sample-data.png)](media/log-analytics-tutorial/sample-data.png#lightbox)

## <a name="write-a-query"></a>Напишите запрос
Давайте создадим запрос, используя таблицу **AzureActivity**. Дважды щелкните имя таблицы, чтобы добавить ее в окно запроса. Вы также можете ввести текст непосредственно в окне и получить доступ к функции IntelliSense, которая поможет завершать ввод имен таблиц в текущей области и командах KQL.

Это простейший запрос, который можно написать. Он просто возвращает все записи в таблице. Выполните его, нажав кнопку **Запустить** или клавиши SHIFT+ВВОД (курсор может находиться в любом месте текста запроса).

[![Результаты запроса](media/log-analytics-tutorial/query-results.png)](media/log-analytics-tutorial/query-results.png#lightbox)

Отобразятся результаты. В правом нижнем углу будет показан счетчик количества записей, возвращенных запросом. 

## <a name="filter"></a>Filter

Давайте добавим фильтр к запросу, чтобы сократить количество возвращаемых записей. В области слева выберите вкладку **Фильтр**. В результатах запроса отобразятся различные столбцы, которые можно использовать для фильтрации результатов. Верхние значения в этих столбцах отображаются с количеством записей, которые содержат это значение. Щелкните **Административная** в разделе **CategoryValue**, а затем — **Применить и запустить**. 

[![Панель запросов](media/log-analytics-tutorial/query-pane.png)](media/log-analytics-tutorial/query-pane.png#lightbox)

Оператор **where** будет добавлен в запрос с выбранным значением. Теперь результаты содержат только записи с этим значением. Вы можете увидеть, что количество записей уменьшилось.

[![Отфильтрованы результаты запроса](media/log-analytics-tutorial/query-results-filter-01.png)](media/log-analytics-tutorial/query-results-filter-01.png#lightbox)


## <a name="time-range"></a>Диапазон времени
Все таблицы в рабочей области Log Analytics содержат столбец с именем **TimeGenerated**, который отображает время создания записи. Все запросы имеют диапазон времени, ограничивающий результаты записями со значением **TimeGenerated** в пределах этого диапазона. Диапазон времени может быть задан либо в запросе, либо с помощью селектора в верхней части экрана.

По умолчанию запрос возвратит записи, сформированные за последние 24 часа. Выберите раскрывающийся список **Диапазон времени** и измените значение на **7 дней**. Щелкните **Запустить** еще раз, чтобы возвратить результаты. Вы можете увидеть, что результаты возвращены. Однако появилось сообщение о том, что не все результаты отображены. Это связано с тем, что Log Analytics может возвращать не более 10 000 записей, а наш запрос вернул большее количество. 

[![Диапазон времени](media/log-analytics-tutorial/query-results-max.png)](media/log-analytics-tutorial/query-results-max.png#lightbox)


## <a name="multiple-query-conditions"></a>Несколько условий запросов
Давайте дополнительно сократим наши результаты, добавив еще одно условие фильтра. Запрос может включать любое количество фильтров, чтобы вы могли отобразить необходимый набор записей. Выберите **Успех** в разделе **ActivityStatusValue** и щелкните **Применить и запустить**. 

[![Результаты запроса с несколькими фильтрами](media/log-analytics-tutorial/query-results-filter-02.png)](media/log-analytics-tutorial/query-results-filter-02.png#lightbox)


## <a name="analyze-results"></a>Анализ результатов
Помимо поддержки при написании и выполнении запросов Log Analytics предоставляет функции для работы с результатами. Сначала разверните запись, чтобы просмотреть значения для всех ее столбцов.

[![Развертывание записи](media/log-analytics-tutorial/expand-record.png)](media/log-analytics-tutorial/expand-record.png#lightbox)

Щелкните имя любого столбца, чтобы отсортировать по нему результаты. Щелкните значок фильтра рядом с ним, чтобы указать условие фильтра. Это аналогично добавлению условия фильтра к самому запросу, за исключением того, что этот фильтр будет сброшен при повторном выполнении запроса. Используйте этот метод для быстрого анализа набора записей в ходе интерактивного анализа.

Например, задайте фильтр для столбца **CallerIpAddress**, чтобы ограничить записи до одного вызывающего объекта. 

[![Фильтр результатов запроса](media/log-analytics-tutorial/query-results-filter.png)](media/log-analytics-tutorial/query-results-filter.png#lightbox)

Вместо фильтрации результатов можно группировать записи по определенному столбцу. Очистите только что созданный фильтр, а затем активируйте ползунок **Группировать столбцы**. 

[![Группирование столбцов](media/log-analytics-tutorial/query-results-group-columns.png)](media/log-analytics-tutorial/query-results-group-columns.png#lightbox)

Теперь перетащите столбец **CallerIpAddress** в строку группирования. Результаты уже упорядочены по этому столбцу, а вы можете свернуть каждую группу, чтобы упростить анализ.

[![Сгруппированные результаты запроса](media/log-analytics-tutorial/query-results-grouped.png)](media/log-analytics-tutorial/query-results-grouped.png#lightbox)

## <a name="work-with-charts"></a>Работа с диаграммами
Давайте рассмотрим запрос, использующий числовые данные, которые можно просмотреть в диаграмме. Вместо создания запроса мы выберем пример запроса.

В левой области щелкните **Запросы**. Эта панель содержит примеры запросов, которые можно добавить в окно запроса. Если вы используете собственную рабочую область, у вас должно быть множество запросов в нескольких категориях, но если вы используете демонстрационную среду, будет доступна только одна категория **рабочих областей Log Analytics** . Разверните ее, чтобы просмотреть запросы в категории.

Щелкните запрос с именем **Число запросов по ResponseCode**. Запрос будет добавлен в окно запроса. Обратите внимание, что новый запрос отделен от другого пустой строкой. Запрос в KQL завершается, если обнаруживает пустую строку, поэтому он отображается как отдельный запрос. 

[![Новый запрос](media/log-analytics-tutorial/example-query.png)](media/log-analytics-tutorial/example-query.png#lightbox)

На текущем запросе будет расположен курсор. Вы можете видеть, что первый запрос выделен, тем самым указывая, что это текущий запрос. Щелкните в любом расположении нового запроса, чтобы выбрать его, а затем нажмите кнопку **Запустить**, чтобы его выполнить.

[![Диаграмма результатов запросов](media/log-analytics-tutorial/example-query-output-chart.png)](media/log-analytics-tutorial/example-query-output-chart.png#lightbox)

Обратите внимание, что эти выходные данные представляют собой диаграмму, а не таблицу, как в последнем запросе. Это обусловлено тем, что в примере запроса в конце используется команда [подготовки к просмотру](/azure/data-explorer/kusto/query/renderoperator?pivots=azuremonitor). Обратите внимание, что существуют различные варианты работы с диаграммой, например изменить ее тип.

Попробуйте выбрать **Результаты**, чтобы просмотреть выходные данные запроса в виде таблицы. 

[![Таблица результатов запроса](media/log-analytics-tutorial/example-query-output-table.png)](media/log-analytics-tutorial/example-query-output-table.png#lightbox)



## <a name="next-steps"></a>Дальнейшие действия

Теперь, когда вы умеете использовать Log Analytics, выполните инструкции из учебника по использованию запросов журнала.
> [!div class="nextstepaction"]
> [Написание запросов к журналам Azure Monitor](get-started-queries.md)
