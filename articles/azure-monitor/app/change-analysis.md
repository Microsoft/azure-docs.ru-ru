---
title: Использование анализа изменений приложений в Azure Monitor для поиска проблем с веб-приложениями | Документация Майкрософт
description: Используйте анализ изменений приложений в Azure Monitor для устранения проблем с приложениями на активных веб-сайтах в службе приложений Azure.
ms.topic: conceptual
author: cawams
ms.author: cawa
ms.date: 05/04/2020
ms.openlocfilehash: e59d4ecd238879eddb9d842245395d58aff28385
ms.sourcegitcommit: e972837797dbad9dbaa01df93abd745cb357cde1
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/14/2021
ms.locfileid: "100519428"
---
# <a name="use-application-change-analysis-preview-in-azure-monitor"></a>Использование анализа изменений приложений (Предварительная версия) в Azure Monitor

При возникновении проблем на рабочем сайте или в случае сбоя быстро определить основную причину очень важно. Стандартные решения для мониторинга могут сообщить о проблеме. Они могут даже указывать, какой компонент не работает. Но это предупреждение не всегда немедленно объясняет причину сбоя. Вы уверены, что ваш сайт работал пять минут назад, и теперь он нарушен. Что изменилось за последние пять минут? Это вопрос, что анализ изменений приложения предназначен для ответа в Azure Monitor.

Основываясь на возможностях [графа ресурсов Azure](../../governance/resource-graph/overview.md), анализ изменений позволяет получить ценные сведения об изменениях в приложении Azure, чтобы увеличить наблюдаемость и сократить MTTR (среднее время ремонта).

> [!IMPORTANT]
> Анализ изменений сейчас находится на этапе предварительной версии. Эта предварительная версия предоставляется без соглашения об уровне обслуживания. Эта версия не рекомендуется для рабочих нагрузок в рабочей среде. Некоторые функции могут не поддерживаться или иметь ограниченные возможности. Дополнительные сведения см. в статье [Дополнительные условия использования Предварительных версий Microsoft Azure](https://azure.microsoft.com/support/legal/preview-supplemental-terms/).

## <a name="overview"></a>Обзор

Средство анализа изменений обнаруживает различные типы изменений, от уровня инфраструктуры до развертывания приложений. Это поставщик ресурсов Azure уровня подписки, который проверяет изменения ресурсов в подписке. Анализ изменений предоставляет данные для различных диагностических средств, которые помогают пользователям понять, какие изменения могут вызвать проблемы.

На следующей схеме показана архитектура анализа изменений.

![Схема архитектуры, с которой средство анализа изменений получает данные об изменениях и предоставляет их клиентским средствам](./media/change-analysis/overview.png)

## <a name="supported-resource-types"></a>Поддерживаемые типы ресурсов

Служба анализа изменений приложений поддерживает изменения на уровне свойств ресурсов во всех типах ресурсов Azure, включая общие ресурсы, такие как:
- Виртуальная машина
- Набор масштабирования виртуальных машин
- Служба приложений
- Служба Kubernetes Azure
- функции Azure;
- Сетевые ресурсы: группа безопасности сети, виртуальная сеть, шлюз приложений и т. д.
- Службы данных: хранилище, SQL, кэш Redis, Cosmos DB и т. д.

## <a name="data-sources"></a>Источники данных

Запросы на анализ изменений приложений для Azure Resource Manager отслеживанию свойств, конфигураций с учетом прокси-сервера и изменений в гостевом приложении. Кроме того, служба отслеживает изменения зависимостей ресурсов для диагностики и отслеживания комплексного приложения.

### <a name="azure-resource-manager-tracked-properties-changes"></a>Изменения Azure Resource Managerных отслеживаний свойств

С помощью [графа ресурсов Azure](../../governance/resource-graph/overview.md)анализ изменений позволяет вести историю того, как ресурсы Azure, на которых размещены приложения, изменились с течением времени. Могут быть обнаружены такие параметры, как управляемые удостоверения, обновление ОС платформы и имена узлов.

### <a name="azure-resource-manager-proxied-setting-changes"></a>Изменения параметров Azure Resource Manager прокси-сервера

Такие параметры, как правило IP-конфигурации, параметры TLS и версии расширений, пока недоступны в графе ресурсов Azure, поэтому запросы на анализ изменений и повторное вычисление этих изменений позволяют получить дополнительные сведения о том, что изменилось в приложении.

### <a name="changes-in-web-app-deployment-and-configuration-in-guest-changes"></a>Изменения в развертывании и настройке веб-приложения (изменения в гостевой системе)

Анализ изменений отслеживает развертывание и состояние конфигурации приложения каждые 4 часа. Это может обнаружить, например, изменения в переменных среды приложения. Средство вычислит различия и повлечет за собой изменения. В отличие от диспетчер ресурсов изменения, сведения об изменении развертывания кода могут быть недоступны сразу же в средстве. Чтобы просмотреть последние изменения в анализе изменений, выберите **Обновить**.

![Снимок экрана: кнопка "проверить изменения сейчас"](./media/change-analysis/scan-changes.png)

### <a name="dependency-changes"></a>Изменения зависимостей

Изменения зависимостей ресурсов также могут вызвать проблемы в ресурсе. Например, если веб-приложение вызывает кэш Redis, номер SKU кэша Redis может повлиять на производительность веб-приложения. Другой пример: Если порт 22 был закрыт в группе безопасности сети виртуальной машины, это вызовет ошибки подключения.

#### <a name="web-app-diagnose-and-solve-problems-navigator-preview"></a>Навигатор по проблемам диагностики и устранения веб-приложений (Предварительная версия)

Для обнаружения изменений в зависимостях анализ изменений проверяет запись DNS веб-приложения. Таким образом, он определяет изменения во всех компонентах приложений, которые могут вызвать проблемы.
В настоящее время для **диагностики и устранения неполадок в веб-приложении поддерживаются следующие зависимости | Навигатор (Предварительная версия)**:

- Веб-приложения
- Хранилище Azure
- Azure SQL

#### <a name="related-resources"></a>Связанные ресурсы

Анализ изменений приложений обнаруживает связанные ресурсы. Распространенными примерами являются группа безопасности сети, виртуальная сеть, шлюз приложений и Load Balancer, связанные с виртуальной машиной.
Сетевые ресурсы обычно автоматически подготавливаются в той же группе ресурсов, в которой они используются, поэтому фильтрация изменений по группе ресурсов покажет все изменения для виртуальной машины и связанных сетевых ресурсов.

![Снимок экрана: изменения в сети](./media/change-analysis/network-changes.png)

## <a name="application-change-analysis-service-enablement"></a>Включение службы анализа изменений приложений

Служба анализа изменений приложений вычисляет и объединяет данные изменений из источников данных, упомянутых выше. Он предоставляет набор аналитиков для пользователей, позволяющих легко перемещаться по всем изменениям ресурсов и определить, какие изменения важны в контексте устранения неполадок или мониторинга.
Поставщик ресурсов Microsoft. Чанжеаналисис должен быть зарегистрирован в подписке для Azure Resource Manager отслеживанию свойств и изменение параметров прокси-сервера для доступа к данным. При вводе средства "Диагностика и устранение неполадок" веб-приложения или на автономной вкладке "анализ изменений" Этот поставщик ресурсов регистрируется автоматически.
Для изменений в гостевом веб-приложении требуется отдельное включение для сканирования файлов кода в веб-приложении. Дополнительные сведения см. в разделе [анализ изменений в средстве "Диагностика и устранение проблем"](change-analysis-visualizations.md#application-change-analysis-in-the-diagnose-and-solve-problems-tool) далее в этой статье.

## <a name="cost"></a>Стоимость

Анализ изменений приложений — это бесплатная служба. она не требует выставления счетов за подписку с включенным ИТ-отсчетом. Кроме того, эта служба не влияет на производительность при проверке изменений свойств ресурсов Azure. При включении анализа изменений для изменения файлов в гостевой системе (или включении средства "Диагностика и устранение неполадок") это приведет к незначительному снижению производительности веб-приложения и стоимости выставления счетов.

## <a name="enable-change-analysis-at-scale"></a>Включить анализ изменений в масштабе

Если ваша подписка включает множество веб-приложений, включение службы на уровне веб-приложения будет неэффективным. Выполните следующий скрипт, чтобы включить все веб-приложения в подписке.

Предварительные требования:

- Модуль PowerShell AZ. Следуйте инструкциям по [установке модуля Azure PowerShell](/powershell/azure/install-az-ps)

Выполните следующий сценарий:

```PowerShell
# Log in to your Azure subscription
Connect-AzAccount

# Get subscription Id
$SubscriptionId = Read-Host -Prompt 'Input your subscription Id'

# Make Feature Flag visible to the subscription
Set-AzContext -SubscriptionId $SubscriptionId

# Register resource provider
Register-AzResourceProvider -ProviderNamespace "Microsoft.ChangeAnalysis"

# Enable each web app
$webapp_list = Get-AzWebApp | Where-Object {$_.kind -eq 'app'}
foreach ($webapp in $webapp_list)
{
    $tags = $webapp.Tags
    $tags[“hidden-related:diagnostics/changeAnalysisScanEnabled”]=$true
    Set-AzResource -ResourceId $webapp.Id -Tag $tags -Force
}

```

## <a name="next-steps"></a>Дальнейшие шаги

- Сведения об [визуализациях в анализе изменений](change-analysis-visualizations.md)
- Сведения об [устранении неполадок в анализе изменений](change-analysis-troubleshoot.md)
- Включите Application Insights для [приложений служб приложений Azure](azure-web-apps.md).
- Включите Application Insights для [виртуальных машин Azure и масштабируемых наборов виртуальной машины Azure, размещенных в IIS](azure-vm-vmss-apps.md).
