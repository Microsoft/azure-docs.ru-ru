---
title: Когорты потребления Azure Application Insights | Документация Майкрософт
description: Анализ различных наборов пользователей, сеансов, событий и операций по общему критерию.
ms.topic: conceptual
author: NumberByColors
ms.author: daviste
ms.date: 04/10/2018
ms.reviewer: mbullwin
ms.openlocfilehash: 2c35356951560b11a605334aba4c26dbc38086de
ms.sourcegitcommit: 910a1a38711966cb171050db245fc3b22abc8c5f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "100583556"
---
# <a name="application-insights-cohorts"></a>Когорты Application Insights

Когорта — это набор пользователей, сеансов, событий и операций, имеющих общий критерий. В Azure Application Insights когорты определяются запросом Analytics. В случаях, когда необходимо проанализировать определенный набор пользователей или событий, с помощью когорт можно точно выразить интересующий вас набор.

![Область когорт](./media/usage-cohorts/001.png)

## <a name="cohorts-versus-basic-filters"></a>Сравнение когорт и базовых фильтров

Когорты во многом используются так же, как фильтры. Однако определения когорт создаются на основе пользовательских аналитических запросов, поэтому они гораздо более адаптируемые и сложные. В отличие от фильтров когорты можно сохранить, чтобы другие участники вашей команды могли повторно их использовать.

Можно определить когорту пользователей, которые пробовали новую функцию в приложении. Эту когорту можно сохранить в ресурсе Application Insights. В будущем можно легко проанализировать эту сохраненную группу конкретных пользователей.

> [!NOTE]
> После создания когорты будут доступны из средств пользователей, сеансов, событий и маршрутов пользователей.

## <a name="example-engaged-users"></a>Пример. Активные пользователи

Команда определяет активных пользователей как тех, кто использует приложение не менее пяти раз в месяц. В этом разделе определяется когорта этих активных пользователей.

1. Откройте средство "Когорты".

2. Перейдите на вкладку **Коллекция шаблонов** . Вы увидите коллекцию шаблонов для различных когорты.

3. Выберите **Engaged Users – by Days Used** (Активные пользователи — по дням пользования службой).

    В этой когорте есть три параметра:
    * **Действия**. Позволяют выбрать, какие события и просмотры страницы считаются "использованием".
    * **Период**. Определение месяца.
    * **UsedAtLeastCustom**, сколько раз пользователям приходится использовать что-то в течение периода, чтобы считаться вовлеченным.

4. Измените **UsedAtLeastCustom** на **5** и более дней и оставьте **период** по умолчанию 28 дней.

    ![Активные пользователи](./media/usage-cohorts/003.png)

    Теперь эта когорта представляет все идентификаторы пользователей, отправленные с любым пользовательским событием или просмотром страницы в течение 5 отдельных дней за последние 28 дней.

5. Щелкните **Сохранить**.

   > [!TIP]
   > Назовите свою когорту, например "Активные пользователи (5+ дней)". Сохраните ее в "Мои отчеты" или "Общие отчеты", в зависимости от того, хотите ли вы предоставить другим пользователям доступ к ресурсу Application Insights для просмотра этой когорты.

6. Выберите **Back to Gallery** (Обратно в коллекцию).

### <a name="what-can-you-do-by-using-this-cohort"></a>Что можно делать с помощью этой когорты

Откройте средство "Пользователи". В раскрывающемся списке **Показать**, выберите созданную когорту в разделе **Users who belong to** (Пользователи, которые принадлежат).

Теперь средство "Пользователи" выполнит фильтрацию по этой когорте пользователей:

![Область пользователей, отфильтрованная по определенной когорте](./media/usage-cohorts/004.png)

Обратите внимание на несколько важных моментов:

* Этот набор невозможно создать через обычные фильтры. Логика данных более сложная.
* Вы можете дополнительно фильтровать эту когорту, используя обычные фильтры в средстве "Пользователи". Поэтому пока когорта определена для 28-дневных окон, диапазон времени можно по прежнему изменить в средстве "Пользователи" на 30, 60 или 90 дней.

Эти фильтры поддерживают более сложные вопросы, которые невозможно выразить через конструктор запросов. Например, _люди, которые были вовлечены за последние 28 дней. Как работают эти же пользователи за последние 60 дней?_

## <a name="example-events-cohort"></a>Пример. Когорты событий

Вы также можете создать когорты событий. В этом разделе определяется когорта этих событий и просмотров страницы. Затем вы научитесь использовать их с помощью других средств. Когорта может определить набор событий, которые ваша команда считает _активным использованием_, или набор событий, связанных с определенной новой функцией.

1. Откройте средство "Когорты".

2. Перейдите на вкладку **Коллекция шаблонов** . Вы увидите коллекцию шаблонов для различных когорты.

3. Выберите **Events Picker** (Средство выбора событий).

    ![Снимок экрана со средством выбора событий](./media/usage-cohorts/006.png)

4. В раскрывающемся списке **Действия** выберите события, которые должны входить в когорту.

5. Сохраните когорту и присвойте ей имя.

## <a name="example-active-users-where-you-modify-a-query"></a>Пример. Активные пользователи (с изменением запроса)

Две предыдущие когорты были определены с помощью раскрывающихся списков. Однако для обеспечения полной гибкости их также можно определить с помощью запросов аналитики. Чтобы узнать как, создайте когорту пользователей из Соединенного Королевства.

![Анимированное пошаговое руководство по использованию средства "Когорты"](./media/usage-cohorts/cohorts0001.gif)

1. Откройте средство "Когорты", выберите вкладку **Коллекция шаблонов** и щелкните **Blank Users cohort** (Пустая когорта пользователей).

    ![Пустая когорта пользователей](./media/usage-cohorts/001.png)

    Доступно три раздела:
   * Раздел с текстом Markdown, в котором описана когорта для других участников команды.

   * Раздел параметров, где можно создать собственные параметры, например **Действия**, и другие раскрывающиеся списки из двух предыдущих примеров.

   * Раздел запросов, в котором можно определить когорту с помощью запроса аналитики.

     В разделе запроса [записывается запрос аналитики](/azure/kusto/query). Запрос выбирает определенный набор строк, описывающих когорту, которую необходимо определить. Затем средство "Когорты" неявно добавляет в запрос предложение "| summarize by user_Id" (| суммировать по ИД_пользователя). Данные можно просмотреть под запросом в таблице, чтобы убедиться, что ваш запрос возвращает результаты.

     > [!NOTE]
     > Если вы не видите запрос, попробуйте изменить размер раздела, чтобы сделать его больше. Анимированный GIF-файл в начале этого раздела демонстрирует поведение при изменении размера.

2. Скопируйте приведенный ниже текст и вставьте его в редактор запроса:

    ```KQL
    union customEvents, pageViews
    | where client_CountryOrRegion == "United Kingdom"
    ```

3. Снова выберите **Выполнение запроса**. Если в таблице не отображаются идентификаторы пользователей, перейдите в страну или регион, где у приложения есть пользователи.

4. Сохраните и назовите когорту.

## <a name="frequently-asked-questions"></a>Часто задаваемые вопросы

_Я определил когорту пользователей из определенной страны или региона. Когда я сравниваю этот когорту в средстве "Пользователи", чтобы просто установить фильтр по этой стране или региону, я вижу разные результаты. Важно?_

Когорты и фильтры отличаются. Предположим, что у вас есть когорта пользователей из Соединенного Королевства (определена, как в предыдущем примере) и ее результаты сравниваются с заданным фильтром "Страна или регион = Соединенное Королевство".

* Версия с когортой покажет все события пользователей, которые отправили одно или больше событий из Соединенного Королевства в текущем временном диапазоне. Если выполнить разделение по стране или региону, скорее всего, отобразится множество стран и регионов.
* В версии с фильтрами будут показаны только события из Соединенного Королевства. Но если выполнить разделение по стране или региону, отобразится только Соединенное Королевство.

## <a name="learn-more"></a>Дополнительные сведения

* [Язык запросов Analytics](../logs/log-analytics-tutorial.md?toc=%2fazure%2fazure-monitor%2ftoc.json)
* [Пользователи, сеансы, события](usage-segmentation.md)
* [Потоки пользователей](usage-flows.md)
* [Общие сведения об использовании](usage-overview.md)