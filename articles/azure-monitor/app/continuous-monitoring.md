---
title: Непрерывный мониторинг конвейера выпуска DevOps с помощью Azure Pipelines и Azure Application Insights | Документация Майкрософт
description: Содержит инструкции для быстрой настройки непрерывного мониторинга с помощью Application Insights
ms.topic: conceptual
ms.date: 05/01/2020
ms.openlocfilehash: fd7cd6a107ed45adb60167a57661b60be5dc8212
ms.sourcegitcommit: 772eb9c6684dd4864e0ba507945a83e48b8c16f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "86517133"
---
# <a name="add-continuous-monitoring-to-your-release-pipeline"></a>Добавление постоянного мониторинга к конвейеру выпуска

Azure Pipelines интегрируется с Application Insights Azure, чтобы обеспечить непрерывный мониторинг конвейера выпуска DevOps на протяжении всего жизненного цикла разработки программного обеспечения. 

Благодаря непрерывному мониторингу конвейеры выпуска могут включать данные мониторинга из Application Insights и других ресурсов Azure. Когда конвейер выпуска обнаруживает Application Insightsное оповещение, конвейер может выполнить откат развертывания, пока не будет устранено предупреждение. Если все проверки пройдены, развертывания могут автоматически протестировать все возможности рабочей среды, не требуя вмешательства вручную. 

## <a name="configure-continuous-monitoring"></a>Настройка непрерывного мониторинга

1. В [Azure DevOps](https://dev.azure.com)выберите организацию и проект.
   
1. В меню слева страницы проекта выберите **конвейеры**  >  **выпуски**. 
   
1. Раскройте стрелку рядом с полем **создать** и выберите **Новый конвейер выпуска**. Если у вас еще нет конвейера, на появившейся странице выберите **создать конвейер** .
   
1. На панели **Выбор шаблона** найдите и выберите **развертывание службы приложений Azure с непрерывным мониторингом**, а затем нажмите кнопку **Применить**. 

   ![Новый конвейер выпуска Azure Pipelines](media/continuous-monitoring/001.png)

1. В поле **этап 1** выберите гиперссылку, чтобы **просмотреть задачи этапа.**

   ![Просмотр задач этапа](media/continuous-monitoring/002.png)

1. В области конфигурации **этап 1** заполните следующие поля: 

    | Параметр        | Значение |
   | ------------- |:-----|
   | **Название этапа**      | Укажите имя этапа или оставьте его на **этапе 1**. |
   | **Подписка Azure.** | Раскрывающийся список и выберите связанную подписку Azure, которую хотите использовать.|
   | **Тип приложения** | Раскрывающийся список и выберите тип приложения. |
   | **Имя службы приложений** | Введите имя службы приложений Azure. |
   | **Имя группы ресурсов для Application Insights**    | Раскрывающийся список и выберите группу ресурсов, которую вы хотите использовать. |
   | **Имя ресурса Application Insights** | Раскрывающийся список и выберите ресурс Application Insights для выбранной группы ресурсов.

1. Чтобы сохранить конвейер со стандартными параметрами правил генерации оповещений, выберите **сохранить** в верхнем правом углу окна Azure DevOps. Введите описательный комментарий и нажмите кнопку **ОК**.

## <a name="modify-alert-rules"></a>Изменение правил генерации оповещений

Не заполнено. шаблон **развертывания службы приложений Azure с непрерывным мониторингом** имеет четыре правила генерации оповещений: **доступность**, **неудачные запросы**, **время ответа сервера** и **исключения сервера**. Можно добавить дополнительные правила или изменить параметры правил в соответствии с потребностями уровня обслуживания. 

Чтобы изменить параметры правила генерации оповещений, выполните следующие действия.

В левой области страницы конвейер выпуска выберите **настроить Application Insights оповещения**.

Четыре правила генерации оповещений по умолчанию создаются с помощью встроенного скрипта.

```bash
$subscription = az account show --query "id";$subscription.Trim("`"");$resource="/subscriptions/$subscription/resourcegroups/"+"$(Parameters.AppInsightsResourceGroupName)"+"/providers/microsoft.insights/components/" + "$(Parameters.ApplicationInsightsResourceName)";
az monitor metrics alert create -n 'Availability_$(Release.DefinitionName)' -g $(Parameters.AppInsightsResourceGroupName) --scopes $resource --condition 'avg availabilityResults/availabilityPercentage < 99' --description "created from Azure DevOps";
az monitor metrics alert create -n 'FailedRequests_$(Release.DefinitionName)' -g $(Parameters.AppInsightsResourceGroupName) --scopes $resource --condition 'count requests/failed > 5' --description "created from Azure DevOps";
az monitor metrics alert create -n 'ServerResponseTime_$(Release.DefinitionName)' -g $(Parameters.AppInsightsResourceGroupName) --scopes $resource --condition 'avg requests/duration > 5' --description "created from Azure DevOps";
az monitor metrics alert create -n 'ServerExceptions_$(Release.DefinitionName)' -g $(Parameters.AppInsightsResourceGroupName) --scopes $resource --condition 'count exceptions/server > 5' --description "created from Azure DevOps";
```

Можно изменить скрипт и добавить дополнительные правила генерации оповещений, изменить условия оповещения или удалить правила генерации оповещений, которые не имеют смысла в целях развертывания.

## <a name="add-deployment-conditions"></a>Добавление условий развертывания

При добавлении шлюзов развертывания в конвейер выпусков предупреждение, которое превышает установленные пороговые значения, предотвращает нежелательное повышение выпуска. После устранения этого предупреждения развертывание может быть продолжено автоматически.

Чтобы добавить шлюзы развертывания, выполните следующие действия.

1. На главной странице конвейера в разделе **этапы** выберите **условия до** или **после развертывания** условия, в зависимости от того, на каком этапе требуется непрерывный шлюз мониторинга.
   
   ![Условия перед развертыванием](media/continuous-monitoring/004.png)
   
1. В области Конфигурация **условий перед развертыванием** установите для параметра **шлюз** значение **включено**.
   
1. Рядом с полем **шлюз развертывания** выберите **Добавить**.
   
1. В раскрывающемся меню выберите **запрос Azure Monitor оповещения** . Этот параметр позволяет получить доступ к предупреждениям Azure Monitor и Application Insights.
   
   ![Предупреждения Azure Monitor запросов](media/continuous-monitoring/005.png)
   
1. В разделе **параметры оценки** введите нужные значения параметров, например **время между повторным вычислением шлюзов** и **временем ожидания, по истечении которого шлюз завершается сбоем**. 

## <a name="view-release-logs"></a>Просмотр журналов выпусков

Поведение шлюза развертывания и другие шаги выпуска можно просмотреть в журналах выпусков. Чтобы открыть журналы, выполните следующие действия.

1. В меню слева на странице конвейера выберите **выпуски** . 
   
1. Выберите любой выпуск. 
   
1. В разделе **этапы** выберите любой этап, чтобы просмотреть сводку по выпуску. 
   
1. Чтобы просмотреть журналы, выберите **Просмотреть журналы** в сводке по выпуску, выберите гиперссылку **успешно** или **неудачно** на любом этапе или наведите указатель на любую стадию и выберите **журналы**. 
   
   ![Просмотр журналов выпусков](media/continuous-monitoring/006.png)

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения о Azure Pipelines см. в [документации по Azure pipelines](/azure/devops/pipelines).
