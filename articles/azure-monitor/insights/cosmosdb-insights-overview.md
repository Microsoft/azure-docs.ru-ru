---
title: Отслеживание Azure Cosmos DB с помощью Azure Monitor для Cosmos DB | Документация Майкрософт
description: В этой статье описывается функция Azure Monitor для Cosmos DB, которая предоставляет владельцам Cosmos DB краткие сведения о проблемах с производительностью и использованием учетных записей CosmosDB.
author: lgayhardt
ms.author: lagayhar
ms.topic: conceptual
ms.date: 05/11/2020
ms.openlocfilehash: fdf482f5afc444aff77c2ab528a4e333a0282c3d
ms.sourcegitcommit: e559daa1f7115d703bfa1b87da1cf267bf6ae9e8
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/17/2021
ms.locfileid: "100582372"
---
# <a name="explore-azure-monitor-for-azure-cosmos-db"></a>Изучите Azure Monitor для Azure Cosmos DB

Azure Monitor для Azure Cosmos DB предоставляет единый интерактивный интерфейс, позволяющий получить обзор производительности, сбоев, емкости и работоспособности всех ваших ресурсов Azure Cosmos DB. Эта статья поможет вам узнать о преимуществах этого нового средства наблюдения, а также изменить и адаптировать интерфейс в соответствии с потребностями вашей организации.   

## <a name="introduction"></a>Введение

Прежде чем перейти к использованию, стоит разобраться в том, как эта функция представляет и визуализирует информацию. 

Отображаются следующие сведения.

* **Масштабный обзор** ресурсов Azure Cosmos DB во всех подписках из одного местоположения, с возможностью выбора только для тех подписок и ресурсов, которые вы заинтересованы рассмотреть.

* **Глубокий анализ** конкретного ресурса Azure CosmosDB для диагностики проблем или выполнения подробного анализа по категориям: сбои, емкости, операции. Выбор любого из этих параметров обеспечивает подробное представление соответствующих метрик Azure Cosmos DB.  

* **Пользовательская настройка**. Эта функция основана на шаблонах книг Azure Monitor, что позволяет изменять отображаемые метрики, устанавливать или изменять пороговые значения с учетом предельных предпочтений, а затем сохранять их в пользовательской книге. Диаграммы из книги можно закрепить на информационных панелях Azure.  

Эта функция не требует включения или настройки, данные метрики Azure Cosmos DB собираются по умолчанию.

>[!NOTE]
>Доступ к функции является бесплатным. Оплачиваются только ключевые возможности Azure Monitor, которые вы настраиваете или подключаете, в соответствии со сведениями о [ценах на Azure Monitor](https://azure.microsoft.com/pricing/details/monitor/).

## <a name="view-utilization-and-performance-metrics-for-azure-cosmos-db"></a>Ознакомьтесь с метриками потребления и производительности для Azure Cosmos DB

Чтобы получить данные об использовании и производительности по учетным записям хранения во всех подписках, сделайте следующее.

1. Войдите на [портал Azure](https://portal.azure.com).

2. Выполните поиск по слову **Monitor** и выберите **Monitor**.

    ![Поле поиска со словом Monitor и результатом поиска Monitor и символом спидометра](./media/cosmosdb-insights-overview/search-monitor.png)

3. Выберите **Cosmos DB**.

    ![Снимок экрана с книгой обзора Cosmos DB](./media/cosmosdb-insights-overview/cosmos-db.png)

### <a name="overview"></a>Обзор

На странице **Обзор** есть интерактивная таблица с метриками Azure Cosmos DB. Результаты можно фильтровать по параметрам, которые выбираются в следующих раскрывающихся списках.

* **Подписки** — перечислены только подписки, в которых присутствует ресурс Azure Cosmos DB.  

* **Cosmos DB** — позволяет выбрать все ресурсы, подтип ресурсов или один конкретный ресурс Azure Cosmos DB.

* **Диапазон времени** — по умолчанию отображаются данные за последние 4 часа с учетом выбранных параметров.

На счетчике под раскрывающимся списком отображается общее количество ресурсов Azure Cosmos DB в выбранных подписках. Для столбцов книги предусмотрены условные цветовые обозначения (так называемые карты цветов), используемые для отметки метрик транзакций. Самый темный цвет соответствует наибольшему значению, а самый светлый — наименьшему. 

Щелкнув стрелку раскрывающегося списка рядом с любым ресурсом Azure Cosmos DB, вы увидите разбивку по метрикам производительности на уровне отдельных контейнеров базы данных.

![Развернутый раскрывающийся список, показывающий отдельные контейнеры баз данных и связанную разбивку производительности](./media/cosmosdb-insights-overview/container-view.png)

Если выбрать имя ресурса Azure Cosmos DB, выделенное синим цветом, откроется **обзор по умолчанию** для связанной учетной записи Azure Cosmos DB. 

### <a name="failures"></a>Сбои

Щелкнув **Сбои** в верхней части страницы, вы увидите таблицу **Сбои** из шаблона книги. Она показывает общее количество запросов с распределением откликов, связанных с этими запросами:

![Снимок экрана со сведениями по сбоям, разбитыми по типу HTTP-запроса](./media/cosmosdb-insights-overview/failures.png)

| Код |  Описание       | 
|-----------|:--------------------|
| `200 OK`  | Одна из следующих REST-операций завершена успешно. </br>— GET на ресурсе. </br> — PUT на ресурсе. </br> — POST на ресурсе. </br> — POST на ресурсе хранимой процедуры для выполнения хранимой процедуры.|
| `201 Created` | Операция POST для создания ресурса завершена успешно. |
| `404 Not Found` | Операция пытается использовать ресурс, который уже не существует. Например, ресурс мог быть уже удален. |

С полным списком кодов состояния можно ознакомиться в статье [Коды состояния HTTP в Azure Cosmos DB](/rest/api/cosmos-db/http-status-codes-for-cosmosdb).

### <a name="capacity"></a>Capacity

Щелкнув **Емкость** в верхней части страницы, вы увидите таблицу **Емкость** из шаблона книги. В ней показано количество документов, рост этого количества с течением времени, использование данных и общий объем оставшегося пространства хранилища.  Это может помочь с выявлением потенциальных проблем с хранилищем и использованием данных.

![Книга емкости](./media/cosmosdb-insights-overview/capacity.png) 

Как и в случае с книгой обзора, выбор раскрывающегося списка рядом с ресурсом Azure Cosmos DB в столбце **Подписка** раскрывает разбивку по отдельным контейнерам, которые составляют базу данных.

### <a name="operations"></a>Операции 

Выберите пункт **Операции** в верхней части страницы, чтобы отобразить вкладку **операций** шаблона книги. Она дает возможность видеть запросы, разбитые по типам запросов. 

В приведенном ниже примере показано, что `eastus-billingint` в основном получает запросы на чтение, но также имеет небольшое количество запросов Upsert и запросов на создание. В то время как `westeurope-billingint` доступен только для чтения с точки запроса, по крайней мере за последние четыре часа, за которые в настоящий момент просматривается с помощью параметра временной области данная книга.

![Книга операций](./media/cosmosdb-insights-overview/operation.png) 

## <a name="pin-export-and-expand"></a>Закрепление, экспорт и развертывание

Вы можете закрепить любой раздел метрик на [панели мониторинга Azure](../../azure-portal/azure-portal-dashboards.md), щелкнув значок канцелярской кнопки в правом верхнем углу раздела.

![Пример закрепления раздела метрики на панели](./media/cosmosdb-insights-overview/pin.png)

Чтобы экспортировать данные в формате Excel, выберите значок в виде направленной вниз стрелки слева от значка закрепления.

![Значок книги экспорта](./media/cosmosdb-insights-overview/export.png)

Чтобы развернуть или свернуть все списки в книге, щелкните на значке "раскрыть" слева от значка экспорта:

![Значок раскрытия](./media/cosmosdb-insights-overview/expand.png)

## <a name="customize-azure-monitor-for-azure-cosmos-db"></a>Настройте Azure Monitor под свои нужды

Так как эта функция основана на шаблонах книг Azure Monitor, вы можете **Настроить** > , **Изменить** или **Сохранить** копию своего настроенного рабочего пространства в качестве собственной книги. 

![Строка настройки](./media/cosmosdb-insights-overview/customize.png)

Книги сохраняются внутри группы ресурсов, либо в разделе **Мои отчеты**, который является доступным только для вас, либо в разделе **Общие отчеты**, доступном всем пользователям внутри группы ресурсов. После сохранения собственной книги ее нужно запускать через галерею книг.

![Запуск книги из панели команд](./media/cosmosdb-insights-overview/gallery.png)

## <a name="troubleshooting"></a>Устранение неполадок

Инструкции по устранению неполадок см. в соответствующей [статье по устранению неполадок](troubleshoot-workbooks.md)на основе книги.

## <a name="next-steps"></a>Дальнейшие действия

* Настройте [оповещения метрики](../alerts/alerts-metric.md) и [уведомления о работоспособности служб](../../service-health/alerts-activity-log-service-notifications-portal.md), чтобы получать автоматизированные оповещения для обнаружения проблем.

* Узнайте, в каких ситуациях применяются книги, как создавать и настраивать отчеты и многое другое, изучив статью [Создание интерактивных отчетов с использованием книг Azure Monitor](../visualize/workbooks-overview.md).
