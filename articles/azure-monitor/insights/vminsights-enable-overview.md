---
title: Общие сведения о включении Azure Monitor для виртуальных машин
description: Узнайте, как развертывать и настраивать Azure Monitor для виртуальных машин. Ознакомьтесь с требованиями к системе.
ms.subservice: ''
ms.topic: conceptual
author: bwren
ms.author: bwren
ms.date: 12/22/2020
ms.custom: references_regions
ms.openlocfilehash: 18be0f7d1bd8622735f24bf20161d652846112f7
ms.sourcegitcommit: d4734bc680ea221ea80fdea67859d6d32241aefc
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/14/2021
ms.locfileid: "100373425"
---
# <a name="enable-azure-monitor-for-vms-overview"></a>Общие сведения о включении Azure Monitor для виртуальных машин

В этой статье представлен обзор доступных параметров, позволяющих Azure Monitor для виртуальных машин отслеживать работоспособность и производительность следующих элементов:

- Виртуальные машины Azure 
- Масштабируемые наборы виртуальных машин Azure
- Гибридные виртуальные машины, подключенные к службе "Дуга Azure"
- Локальные виртуальные машины
- Виртуальные машины, размещенные в другой облачной среде.  

Чтобы настроить Azure Monitor для виртуальных машин, выполните следующие действия.

* Включите одну виртуальную машину Azure, масштабируемый набор виртуальных машин Azure или машину Arc Azure, выбрав **аналитику** непосредственно в меню портал Azure.
* Включите несколько виртуальных машин Azure, виртуальных машин Azure или машин Arc Azure с помощью политики Azure. Этот метод гарантирует, что на существующих и новых виртуальных машинах и масштабируемых наборах необходимые зависимости установлены и настроены правильно. Сообщается о несоответствующих виртуальных машинах и масштабируемых наборах, поэтому можно решить, следует ли их включить и исправить.
* Используйте PowerShell для включения нескольких виртуальных машин Azure, виртуальных машин Azure Arc, масштабируемых наборов виртуальных машин Azure или машин Arc Azure в указанной подписке или группе ресурсов.
* Включите Azure Monitor для виртуальных машин для мониторинга виртуальных машин или физических компьютеров, размещенных в корпоративной сети или в другой облачной среде.

## <a name="supported-machines"></a>Поддерживаемые компьютеры
Azure Monitor для виртуальных машин поддерживает следующие компьютеры:

- Виртуальная машина Azure
- Масштабируемый набор виртуальных машин Azure
- Гибридная виртуальная машина, подключенная к службе "Дуга Azure"


## <a name="supported-azure-arc-machines"></a>Поддерживаемые машины Azure Arc
Azure Monitor для виртуальных машин доступен для серверов с поддержкой ARC в Azure в регионах, где доступна служба расширения ARC. Необходимо запустить агент Arc версии 0,9 или более поздней.

| Подключенный источник | Поддерживается | Описание |
|:--|:--|:--|
| Агенты Windows | Да | Вместе с [агентом log Analytics для Windows](../platform/log-analytics-agent.md)агентам Windows требуется агент зависимостей. Дополнительные сведения см. в разделе [Поддерживаемые операционные системы](../platform/agents-overview.md#supported-operating-systems). |
| Агенты Linux | Да | Вместе с [агентом log Analytics для Linux](../platform/log-analytics-agent.md)агентам Linux требуется агент зависимостей. Дополнительные сведения см. в разделе [Поддерживаемые операционные системы](#supported-operating-systems). |
| Группа управления System Center Operations Manager | Нет | |

## <a name="supported-operating-systems"></a>Поддерживаемые операционные системы

Azure Monitor для виртуальных машин поддерживает любую операционную систему, поддерживающую агент Log Analytics и агент зависимостей. Полный список см. в разделе [Общие сведения об агентах Azure Monitor ](../platform/agents-overview.md#supported-operating-systems) .

> [!IMPORTANT]
> Azure Monitor для виртуальных машин функция работоспособности гостевой ОС имеет более ограниченную поддержку операционной системы, пока она находится в общедоступной предварительной версии. Подробный список см. в разделе [включение Azure Monitor для виртуальных машин гостевой работоспособности (Предварительная версия)](vminsights-health-enable.md) .

См. следующий список вопросов, касающихся поддержки агента зависимостей в Linux, который поддерживает Azure Monitor для виртуальных машин:

- Поддерживаются только версии ядра по умолчанию и SMP для Linux.
- Нестандартные версии ядра, такие как расширение физических адресов (PAE) и Xen, не поддерживаются ни в одном дистрибутиве Linux. Например, система со строкой версии *2.6.16.21-0.8-xen* не поддерживается.
- Пользовательские ядра, включая перекомпиляции стандартных ядер, не поддерживаются.
- Для Debian дистрибутивов, отличных от версии 9,4, функция Map не поддерживается, и функция производительности доступна только в меню Azure Monitor. Она недоступна непосредственно из левой панели виртуальной машины Azure.
- Поддерживается ядро Центосплус.
- Для уязвимости устранением рисков Spectre необходимо исправление ядра Linux. Дополнительные сведения см. в поставщике дистрибутива Linux.
## <a name="log-analytics-workspace"></a>Рабочая область Log Analytics
Для Azure Monitor для виртуальных машин требуется рабочая область Log Analytics. Дополнительные сведения и требования к этой рабочей области см. в статье [настройка log Analytics рабочей области для Azure Monitor для виртуальных машин](vminsights-configure-workspace.md) .
## <a name="agents"></a>Агенты
Для Azure Monitor для виртуальных машин требуется установить следующие два агента на каждой виртуальной машине или масштабируемом наборе виртуальных машин, которые необходимо отслеживать. Чтобы подключить ресурс, установите эти агенты и подключите их к рабочей области.  

- [Агент log Analytics](../platform/log-analytics-agent.md). Сбор данных о событиях и производительности из масштабируемого набора виртуальных машин и их доставка в рабочую область Log Analytics. Методы развертывания для агента Log Analytics в ресурсах Azure используют расширение виртуальной машины для [Windows](../../virtual-machines/extensions/oms-windows.md) и [Linux](../../virtual-machines/extensions/oms-linux.md).
- Агент зависимостей. Собирает обнаруженные данные о процессах, выполняемых на виртуальной машине, и зависимостях внешних процессов, которые используются [функцией Map в Azure Monitor для виртуальных машин](vminsights-maps.md). Агент зависимостей использует агент Log Analytics для доставки данных в Azure Monitor. Методы развертывания для агента зависимостей в ресурсах Azure используют расширение виртуальной машины для [Windows](../../virtual-machines/extensions/agent-dependency-windows.md) и [Linux](../../virtual-machines/extensions/agent-dependency-linux.md).

> [!NOTE]
> Агент Log Analytics — это тот же агент, который используется System Center Operations Manager. Azure Monitor для виртуальных машин может отслеживать агенты, которые также отслеживаются Operations Manager, если они подключены напрямую, и вы устанавливаете на них агент зависимостей. Azure Monitor для виртуальных машин не наблюдает за агентами, подключенными к Azure Monitor через [группу управления](../tform/../platform/om-agents.md) .

Ниже приведены несколько методов развертывания этих агентов. 

| Метод | Описание |
|:---|:---|
| [Портал Azure](./vminsights-enable-portal.md) | Установите оба агента на одной виртуальной машине, масштабируемом наборе виртуальных машин или гибридных виртуальных машинах, подключенных к службе "Дуга Azure". |
| [Шаблоны диспетчер ресурсов](vminsights-enable-resource-manager.md) | Установите оба агента с помощью любого из поддерживаемых методов, чтобы развернуть шаблон диспетчер ресурсов, включая CLI и PowerShell. |
| [Политика Azure](./vminsights-enable-policy.md) | Назначение инициативы политики Azure для автоматической установки агентов при создании виртуальной машины или масштабируемого набора виртуальных машин. |
| [Установка вручную](./vminsights-enable-hybrid.md) | Установите агенты в гостевой операционной системе на компьютерах, размещенных за пределами Azure, включая в вашем центре обработки данных или в других облачных средах. |


## <a name="network-requirements"></a>Требования к сети

- Требования к сети для агента Log Analytics см. в разделе [требования к сети](../platform/log-analytics-agent.md#network-requirements) .
- Агенту зависимостей требуется подключение от виртуальной машины к адресу 169.254.169.254. Это конечная точка службы метаданных Azure. Убедитесь, что параметры брандмауэра разрешают подключения к этой конечной точке.


## <a name="management-packs"></a>Пакеты управления
При настройке Log Analytics рабочей области для Azure Monitor для виртуальных машин два пакета управления перенаправляются на все компьютеры Windows, подключенные к этой рабочей области. Пакеты управления называются *Microsoft. IntelligencePacks. ApplicationDependencyMonitor* и *Microsoft. IntelligencePacks. вминсигхтс* и записываются в *%ProgramFiles%\Microsoft Monitoring Agent\Agent\Health Service state\management Packs Packs*. 

Пакет управления *ApplicationDependencyMonitor* использует источник данных **% Program Files%\Microsoft Monitoring Agent\Agent\Health Service State\Resources \<AutoGeneratedID>\Microsoft.EnterpriseManagement.Advisor.ApplicationDependencyMonitorDataSource.dll*. Пакет управления *вминсигхтс* использует источник данных *% Program Files%\Microsoft Monitoring Agent\Agent\Health Service State\Resources \<AutoGeneratedID> \ Microsoft.VirtualMachineMonitoringModule.dll*.

## <a name="diagnostic-and-usage-data"></a>Данные диагностики и использования

Корпорация Майкрософт автоматически собирает данные об использовании и производительности при работе службы Azure Monitor. Корпорация Майкрософт использует эти данные для повышения качества, безопасности и целостности службы. 

Чтобы обеспечить точную и эффективную работу по устранению неполадок, функция Map включает данные о конфигурации программного обеспечения. Данные содержат такие сведения, как операционная система, версия, IP-адрес, DNS-имя и имя рабочей станции. Корпорация Майкрософт не собирает сведения об именах, адресах и другую контактную информацию.

Дополнительные сведения о сборе и использовании данных см. в [заявлении о конфиденциальности служб Microsoft Online Services](https://go.microsoft.com/fwlink/?LinkId=512132).

[!INCLUDE [GDPR-related guidance](../../../includes/gdpr-dsr-and-stp-note.md)]

## <a name="next-steps"></a>Следующие шаги

Сведения об использовании функции наблюдения за производительностью см. в разделе [View Azure Monitor для виртуальных машин Performance](vminsights-performance.md). Для просмотра обнаруженных зависимостей приложений см. статью о [просмотре схемы Azure Monitor для виртуальных машин](vminsights-maps.md).
