---
title: Включение Azure Monitor для виртуальных машин с помощью шаблонов Resource Manager
description: В этой статье описывается, как включить Azure Monitor для виртуальных машин для одной или нескольких виртуальных машин Azure или масштабируемых наборов виртуальных машин с помощью шаблонов Azure PowerShell или Azure Resource Manager.
ms.subservice: ''
ms.topic: conceptual
author: bwren
ms.author: bwren
ms.date: 07/27/2020
ms.openlocfilehash: cee7072f9bc844fb1f89168de3547dc726472b67
ms.sourcegitcommit: b6267bc931ef1a4bd33d67ba76895e14b9d0c661
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/19/2020
ms.locfileid: "97695912"
---
# <a name="enable-azure-monitor-for-vms-using-resource-manager-templates"></a>Включение Azure Monitor для виртуальных машин с помощью шаблонов Resource Manager
В этой статье описывается, как включить Azure Monitor для виртуальных машин для виртуальной машины или масштабируемого набора виртуальных машин с помощью шаблонов диспетчер ресурсов. Эту процедуру можно использовать для следующих действий:

- Виртуальная машина Azure
- Масштабируемый набор виртуальных машин Azure
- Гибридная виртуальная машина, подключенная к службе "Дуга Azure"

## <a name="prerequisites"></a>Предварительные требования

- [Создание и Настройка рабочей области log Analytics](vminsights-configure-workspace.md). 
- Ознакомьтесь с [поддерживаемыми операционными системами](vminsights-enable-overview.md#supported-operating-systems) , чтобы убедиться, что операционная система, которую вы включаете, поддерживается. 

## <a name="resource-manager-templates"></a>Шаблоны Resource Manager

Мы создали пример Azure Resource Manager шаблоны для адаптации виртуальных машин и масштабируемых наборов виртуальных машин. Эти шаблоны включают сценарии, которые можно использовать для включения наблюдения за существующим ресурсом и создания нового ресурса с включенным наблюдением.

>[!NOTE]
>Шаблон должен быть развернут в той же группе ресурсов, что и включенная виртуальная машина или масштабируемый набор виртуальных машин.


Шаблоны Azure Resource Manager предоставляются в файле архива (ZIP-файл), который можно [скачать](https://aka.ms/VmInsightsARMTemplates) из нашего репозитория GitHub. Содержимое файла включает папки, представляющие каждый сценарий развертывания с шаблоном и файлом параметров. Прежде чем запускать их, измените файл параметров и укажите необходимые значения. 

Загружаемый файл содержит следующие шаблоны для различных сценариев.

- Шаблон **ексистингвмонбоардинг** позволяет Azure Monitor для виртуальных машин, если виртуальная машина уже существует.
- Шаблон **неввмонбоардинг** создает виртуальную машину и позволяет Azure Monitor для виртуальных машин отслеживать ее.
- Шаблон **ексистингвмссонбоардинг** позволяет Azure Monitor для виртуальных машин, если масштабируемый набор виртуальных машин уже существует.
- Шаблон **неввмссонбоардинг** создает масштабируемые наборы виртуальных машин и позволяет Azure Monitor для виртуальных машин отслеживать их.
- Шаблон **конфигуреворкспаце** настраивает рабочую область log Analytics для поддержки Azure Monitor для виртуальных машин, включая решения и коллекцию счетчиков производительности операционных систем Linux и Windows.

>[!NOTE]
>Если масштабируемые наборы виртуальных машин уже присутствовали и для политики обновления задано значение **вручную**, Azure Monitor для виртуальных машин не будут включены для экземпляров по умолчанию после запуска шаблона Azure Resource Manager **ексистингвмссонбоардинг** . Экземпляры необходимо обновить вручную.

## <a name="deploy-templates"></a>Развертывание шаблонов
Шаблоны можно развернуть с помощью [любого метода развертывания для Диспетчер ресурсов шаблонов](../../azure-resource-manager/templates/deploy-powershell.md) , включая следующие примеры с помощью POWERSHELL и CLI.

```powershell
New-AzResourceGroupDeployment -Name OnboardCluster -ResourceGroupName <ResourceGroupName> -TemplateFile <Template.json> -TemplateParameterFile <Parameters.json>
```


```azurecli
az deployment group create --resource-group <ResourceGroupName> --template-file <Template.json> --parameters <Parameters.json>
```



## <a name="next-steps"></a>Дальнейшие действия

Теперь, когда наблюдение включено для виртуальных машин, эти сведения доступны для анализа с Azure Monitor для виртуальных машин.

- Для просмотра обнаруженных зависимостей приложений см. статью о [просмотре схемы Azure Monitor для виртуальных машин](vminsights-maps.md).

- Чтобы определить узкие места и общее использование с производительностью виртуальной машины, см. статью [Просмотр производительности виртуальной машины Azure](vminsights-performance.md).
