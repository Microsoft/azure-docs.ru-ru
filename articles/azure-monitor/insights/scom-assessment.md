---
title: Оценка System Center Operations Manager с помощью Azure Monitor
description: Использование проверки работоспособности System Center Operations Manager для оценки риска и состояния сред на регулярной основе.
ms.topic: conceptual
author: bwren
ms.author: bwren
ms.date: 06/25/2018
ms.openlocfilehash: 35ae1e09fd0a06014a747cef99631a7bfe2dee1c
ms.sourcegitcommit: 910a1a38711966cb171050db245fc3b22abc8c5f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/20/2021
ms.locfileid: "101731414"
---
# <a name="optimize-your-environment-with-the-system-center-operations-manager-health-check-preview-solution"></a>Оптимизация среды с помощью решения для проверки работоспособности System Center Operations Manager (предварительная версия)

![Значок проверки работоспособности System Center Operations Manager](./media/scom-assessment/scom-assessment-symbol.png)

Решение для проверки работоспособности System Center Operations Manager можно использовать для оценки риска и состояния группы управления SCOM на регулярной основе. Эта статья поможет вам установить, настроить и использовать данное решение таким образом, чтобы в случае проблем вы могли принять корректирующие меры.

Это решение предоставляет приоритетный список рекомендаций, относящихся к развернутой серверной инфраструктуре. Рекомендации сгруппированы в четырех приоритетных областях, помогающих быстро оценить риски и принять корректирующие меры.

В основу предлагаемых рекомендаций положены знания и опыт, приобретенные специалистами Майкрософт в результате многочисленных посещений клиентов. Каждая рекомендация является определенным руководством, поясняющим важность проблемы и приводящим действия по реализации предложенных изменений.

Можно выбрать приоритетные области, наиболее важные для организации, и отслеживать выполнение задач по формированию работоспособной и свободной от рисков среды.

После добавления решения и выполнения оценки сводная информация по приоритетным областям отображается на панели мониторинга **Проверка работоспособности System Center Operations Manager** для инфраструктуры. В следующих разделах описано, как использовать информацию на панели мониторинга **Проверка работоспособности System Center Operations Manager**, где можно увидеть и выполнить действия, рекомендованные для вашей среды Operations Manager.

![Заголовок решения System Center Operations Manager](./media/scom-assessment/log-analytics-scom-healthcheck-tile.png)

![Панель мониторинга проверки работоспособности System Center Operations Manager](./media/scom-assessment/log-analytics-scom-healthcheck-dashboard-01.png)

## <a name="installing-and-configuring-the-solution"></a>Установка и настройка решения

Решение работает с Microsoft System Center 2012 Operations Manager с пакетом обновления 1 (SP1), Microsoft System Center 2012 R2 Operations Manager, Microsoft System Center 2016 Operations Manager, Microsoft System Center 2016 Operations Manager и Microsoft System Center Operations Manager 1807. Поддерживаемая версия платформа .NET Framework 4.6.2 должна быть установлена на каждом сервере управления.

Для установки и настройки решений используйте указанные ниже данные.

- Чтобы использовать решение для проверки работоспособности в Log Analytics, его необходимо установить. Установите решение из [Azure Marketplace](https://azuremarketplace.microsoft.com/marketplace/apps/Microsoft.SCOMAssessmentOMS?tab=Overview).

- После добавления решения в рабочую область на плитке панели мониторинга **Проверка работоспособности System Center Operations Manager** отобразится сообщение о том, что требуется дополнительная настройка. Щелкните этот элемент и выполните инструкции по настройке, указанные на странице.

  ![Элемент "Оценка System Center Operations Manager" на панели мониторинга](./media/scom-assessment/scom-configrequired-tile.png)

> [!NOTE]
> Настроить System Center Operations Manager можно с помощью скрипта, выполнив действия, описанные на странице настройки решения в Log Analytics.

 Для настройки оценки с помощью консоли управления Operations Manager выполните следующие действия (в таком же порядке):
1. [Установите учетную запись запуска от имени для проверки работоспособности System Center Operations Manager](#operations-manager-run-as-accounts-for-log-analytics).  
2. Настройте правило Проверки работоспособности System Center Operations Manager.

## <a name="system-center-operations-manager-health-check-data-collection-details"></a>Сведения о сборе данных решения "Проверка работоспособности System Center Operations Manager"

Проверка работоспособности System Center Operations Manager решение собирает данные из следующих источников:

* Реестр
* Инструментарий управления Windows (WMI)
* Журнал событий
* данные файлов;
* непосредственно из Operations Manager, используя PowerShell и запросы SQL, с сервера управления, который вы указали.  

Данные собираются на сервере управления и перенаправляются в службу Log Analytics каждые семь дней.  

## <a name="operations-manager-run-as-accounts-for-log-analytics"></a>Учетные записи запуска от имени в Operations Manager для службы Log Analytics

Для предоставления качественных услуг служба Log Analytics основывается на пакетах управления для рабочих нагрузок. Каждой рабочей нагрузке требуются отдельные права для запуска пакетов управления в другом контексте безопасности, например в учетной записи пользователя домена. Настройте учетную запись запуска от имени Operations Manager с привилегированными учетными данными. Дополнительные сведения см. в разделе [Создание учетной записи запуска от имени](/previous-versions/system-center/system-center-2012-R2/hh321655(v=sc.12)) в документации по Operations Manager.

Для настройки учетной записи запуска от имени Operations Manager для проверки работоспособности System Center Operations Manager используйте сведения, указанные ниже.

### <a name="set-the-run-as-account"></a>Учетная запись запуска от имени

Прежде чем продолжать, убедитесь, что учетная запись запуска от имени соответствует следующим требованиям:

* Это должна быть учетная запись домена, входящая в группу локальных администраторов на всех серверах, поддерживающая любую роль Operations Manager: сервер управления, SQL Server, на котором выполняются рабочие нагрузки, содержится хранилище данных и база данных ACS, сервер отчетов, сервер веб-консоли, сервер шлюза.
* Это должна быть роль администратора Operations Manager для оцениваемой группы.
* Если учетная запись не имеет прав системного администратора SQL, выполните [этот скрипт](#sql-script-to-grant-granular-permissions-to-the-run-as-account), чтобы предоставить детализированные разрешения учетной записи для каждого экземпляра SQL Server, содержащего одну или все базы данных Operations Manager.

1. В консоли Operations Manager нажмите кнопку навигации **Администрирование**.
2. В разделе **Run As Configuration** (Конфигурация запуска от имени) щелкните **Учетные записи**.
3. В мастере **создания учетной записи запуска от имени** на странице **Краткое описание** нажмите кнопку **Далее**.
4. На странице **Общие свойства** выберите **Windows** в списке **Тип учетной записи запуска от имени**.
5. Введите отображаемое имя в текстовом поле **Отображаемое имя** и при необходимости описание в поле **Описание**, а затем нажмите кнопку **Далее**.
6. На странице **Безопасность распространения** выберите **Более безопасно**.
7. Нажмите кнопку **Создать**.  

Теперь, когда учетная запись запуска от имени создана, ее необходимо настроить для серверов управления, находящихся в группе управления, и связать с предопределенным профилем запуска от имени, чтобы бизнес-процессы выполнялись с использованием учетных данных.  

1. В разделе **Run As Configuration** (Конфигурация запуска от имени) > **Учетные записи** в области результатов дважды щелкните учетную запись, созданную ранее.
2. На вкладке **Distribution** (Распространение) щелкните **Добавить** для поля **Выбранные компьютеры** и добавьте сервер управления, на который нужно распространить учетную запись.  Нажмите кнопку **ОК** дважды для сохранения изменений.
3. В разделе **Run As Configuration** (Конфигурация запуска от имени) щелкните **Профили**.
4. Найдите *профиль оценки SCOM*.
5. Имя профиля должно быть: *Microsoft проверка работоспособности System Center Operations Manager профиль запуска от имени*.
6. Щелкните правой кнопкой мыши и обновите свойства профиля. Добавьте в него учетную запись запуска от имени, созданную ранее.

### <a name="sql-script-to-grant-granular-permissions-to-the-run-as-account"></a>Сценарий SQL для предоставления детализированных разрешений учетной записи запуска от имени

Выполните следующий скрипт SQL, чтобы предоставить необходимые разрешения для учетной записи запуска от имени экземпляра SQL Server, используемого Operations Manager, на котором размещены рабочие нагрузки, хранилище данных и база данных ACS.

```
-- Replace <UserName> with the actual user name being used as Run As Account.
USE master

-- Create login for the user, comment this line if login is already created.
CREATE LOGIN [UserName] FROM WINDOWS


--GRANT permissions to user.
GRANT VIEW SERVER STATE TO [UserName]
GRANT VIEW ANY DEFINITION TO [UserName]
GRANT VIEW ANY DATABASE TO [UserName]

-- Add database user for all the databases on SQL Server Instance, this is required for connecting to individual databases.
-- NOTE: This command must be run anytime new databases are added to SQL Server instances.
EXEC sp_msforeachdb N'USE [?]; CREATE USER [UserName] FOR LOGIN [UserName];'

Use msdb
GRANT SELECT To [UserName]
Go

--Give SELECT permission on all Operations Manager related Databases

--Replace the Operations Manager database name with the one in your environment
Use [OperationsManager];
GRANT SELECT To [UserName]
GO

--Replace the Operations Manager DatawareHouse database name with the one in your environment
Use [OperationsManagerDW];
GRANT SELECT To [UserName]
GO

--Replace the Operations Manager Audit Collection database name with the one in your environment
Use [OperationsManagerAC];
GRANT SELECT To [UserName]
GO

--Give db_owner on [OperationsManager] DB
--Replace the Operations Manager database name with the one in your environment
USE [OperationsManager]
GO
ALTER ROLE [db_owner] ADD MEMBER [UserName]

```

### <a name="configure-the-health-check-rule"></a>Настройка правила проверки работоспособности

Пакет управления Проверка работоспособности System Center Operations Managerного решения включает правило с именем *Microsoft System Center Operations Manager выполнение правила проверки работоспособности*. Это правило отвечает за проверку работоспособности. Чтобы включить правило и настроить частоту, используйте приведенные ниже процедуры.

По умолчанию правило проверки работоспособности запуска Microsoft System Center Operations Manager отключено. Чтобы выполнить проверку работоспособности, необходимо включить это правило на сервере управления. Выполните следующие действия.

#### <a name="enable-the-rule-for-a-specific-management-server"></a>Включение правила для определенного сервера управления

1. В рабочей области **Создание** и настройка консоли Operations Manager выполните поиск правила *Microsoft System Center Operations Manager запустить проверку работоспособности* на панели **правила** .
2. В результатах поиска выберите тот, который содержит текст *Тип: сервер управления*.
3. Щелкните правило правой кнопкой мыши и выберите пункт **переопределения**  >  **для конкретного объекта класса: сервер управления**.
4.  Из списка выберите сервер управления, на котором должно выполняться правило.  Это должен быть тот же сервер управления, настроенный ранее для связывания с учетной записью запуска от имени.
5.  Обязательно измените значение переопределения для параметра **Включено** на **True**.<br><br> ![Параметр переопределения](./media/scom-assessment/rule.png)

    Оставаясь в этом окне, настройте частоту выполнения, используя приведенную ниже процедуру.

#### <a name="configure-the-run-frequency"></a>Настройка частоты выполнения

По умолчанию оценка настроена для выполнения каждые 10 080 минут (или семь дней). Это значение можно переопределить, при этом минимальное значение составляет 1440 минут (или один день). Данное значение представляет минимальный интервал времени между последовательно выполняемыми оценками. Ниже приведены указания по переопределению данного интервала.

1. В рабочей области **Создание** и настройка консоли Operations Manager найдите правило *Microsoft System Center Operations Manager запустить проверку работоспособности* в разделе **правила** .
2. В результатах поиска выберите тот, который содержит текст *Тип: сервер управления*.
3. Щелкните правило правой кнопкой мыши и выберите пункт **переопределить правило**  >  **для всех объектов данного класса: сервер управления**.
4. Изменение значение параметра **Интервал**, указав нужное вам значение интервала. В следующем примере задано значение 1440 минут (один день).<br><br> ![Параметр интервала](./media/scom-assessment/interval.png)<br>  

    Если задать значение меньше 1440 минут, то правило работает с интервалом в один день. В этом примере правило не учитывает значение интервала и выполняется с частотой один день.


## <a name="understanding-how-recommendations-are-prioritized"></a>Основные сведения о приоритизации рекомендаций

Каждая рекомендация получает взвешенное значение, определяющее относительную важность рекомендаций. Отображаются только 10 наиболее важных рекомендаций.

### <a name="how-weights-are-calculated"></a>Процесс вычисления взвешенного значения

Взвешенные значения являются статистическими значениями, основанными на трех ключевых факторах.

- *Вероятность* возникновения проблемы. Более высокие значения вероятности приравниваются к более высокой общей оценке для рекомендации.
- *Влияние* на работу организации, если она является причиной проблемы. Более высокая степень влияния приравнивается к более высокой общей оценке для рекомендации.
- *Усилия* , необходимые для реализации рекомендации. Более высокое значение усилий приравнивается к меньшей общей оценке рекомендации.

Взвешенное значение для каждой рекомендации выражается в процентах от общей оценки, доступной для каждой приоритетной области. Например, если рекомендация из приоритетной области "Доступность и непрерывность бизнес-процессов" имеет показатель 5 %, то реализация этой рекомендации увеличит общий показатель доступности и непрерывности бизнес-процессов на 5 %.

### <a name="focus-areas"></a>Приоритетные области

**Доступность и непрерывность бизнес-процессов**. Эта область содержит рекомендации в отношении доступности служб, устойчивости инфраструктуры и защиты бизнеса.

**Производительность и масштабируемость**. В этой области содержатся рекомендации, которые помогут ИТ-инфраструктуре вашей организации расти, обеспечат соответствие ИТ-среды текущим требованиям к производительности и позволят ей адаптироваться к новым требованиям к инфраструктуре.

**Обновление, миграция и развертывание** . Эта область содержит рекомендации по обновлению, миграции и развертыванию SQL Server в существующей инфраструктуре.

**Операции и мониторинг**. В этой области содержатся рекомендации, которые позволят оптимизировать ИТ-операции, реализовать программу профилактического обслуживания и повысить эффективность бизнеса.

### <a name="should-you-aim-to-score-100-in-every-focus-area"></a>Следует ли стремиться к показателю 100 % в каждой приоритетной области?

Не обязательно. В основу предлагаемых рекомендаций положены знания и опыт, приобретенные специалистами Майкрософт в результате многочисленных посещений клиентов. Однако не существует двух одинаковых серверных инфраструктур, и конкретные рекомендации могут быть применимы к вам в большей или меньшей степени. Например, некоторые рекомендации по обеспечению безопасности могут быть менее значимыми, если виртуальные машины в организации не подключены к Интернету. Некоторые рекомендации о доступности могут иметь менее важное значение для служб, которые обеспечивают сбор низкоприоритетных данных. Проблемы, которые важны для зрелой организации, могут быть не так важны для начинающей компании. Можно определить приоритетные области и затем отследить изменение оценок с течением времени.

В каждой рекомендации указано, почему она важна. Эту рекомендацию следует использовать, чтобы определить целесообразность реализации рекомендации с учетом характера ИТ-служб и бизнес-потребностей организации.

## <a name="use-health-check-focus-area-recommendations"></a>Рекомендации по использованию приоритетной области проверки работоспособности

Чтобы использовать решение для проверки работоспособности в Log Analytics, его необходимо установить. Дополнительные сведения об установке решений см. в разделе [Установка решения по управлению](./solutions.md). После установки можно просматривать сводку рекомендаций с помощью плитки проверки работоспособности System Center Operations Manager на странице **Обзор** в рабочей области на портале Azure.

Вы можете посматривать сводку оценок соответствия для инфраструктуры, а затем глубже изучить рекомендации.

### <a name="to-view-recommendations-for-a-focus-area-and-take-corrective-action"></a>Просмотр рекомендаций для приоритетной области и выполнение действий по исправлению
1. Войдите на портал Azure по адресу [https://portal.azure.com](https://portal.azure.com).
2. На портале Azure щелкните **Другие службы** в нижнем левом углу. В списке ресурсов введите **Log Analytics**. Как только вы начнете вводить символы, список отфильтруется соответствующим образом. Выберите **Log Analytics**.
3. В области подписок Log Analytics выберите рабочую область, а затем пункт меню **Обзор рабочей области**.  
4. На странице **Обзор** щелкните плитку **Проверка работоспособности System Center Operations Manager**.
5. На странице **Проверка работоспособности System Center Operations Manager** просмотрите сводные данные в одной из колонок приоритетной области, а затем щелкните одну из колонок, чтобы просмотреть рекомендации для соответствующей области.
6. На всех страницах интересующей области можно просматривать приоритетные рекомендации для вашей среды. Щелкните рекомендацию в разделе **Затронутые объекты** , чтобы просмотреть сведения о причинах возникновения этой рекомендации.<br><br> ![Приоритетная область](./media/scom-assessment/log-analytics-scom-healthcheck-dashboard-02.png)<br>
7. В разделе **Предложенные действия** представлены действия по исправлению, которые вы можете предпринять. Когда проблема с этим элементом будет устранена, последующие оценки будут указывать, что рекомендованные действия были выполнены, и тогда оценка соответствия возрастет. Исправленные элементы отображаются как **Прошедшие проверку объекты**.

## <a name="ignore-recommendations"></a>Игнорирование рекомендаций

Если нужно проигнорировать определенные рекомендации, создайте текстовый файл, при помощи которого рекомендации будут удалены из результатов оценки в Log Analytics.

### <a name="to-identify-recommendations-that-you-want-to-ignore"></a>Указание рекомендаций, которые нужно игнорировать
1. На портале Azure на странице Log Analytics для выбранной рабочей области щелкните пункт меню **Поиск по журналам**.
2. Выполните следующий запрос, чтобы получить список рекомендаций, не выполненных на компьютерах в вашей среде.

    ```
    Type=SCOMAssessmentRecommendationRecommendationResult=Failed | select Computer, RecommendationId, Recommendation | sort Computer
    ```

    >[!NOTE]
    > Если ваша рабочая область переведена на [язык запросов Log Analytics](../logs/log-query-overview.md), приведенный выше запрос будет изменен следующим образом.
    >
    > `SCOMAssessmentRecommendationRecommendation | where RecommendationResult == "Failed" | sort by Computer asc | project Computer, RecommendationId, Recommendation`

    Ниже приведен снимок экрана, показывающий запрос поиска по журналам:<br><br> ![Поиск в журналах](./media/scom-assessment/scom-log-search.png)<br>

3. Выберите рекомендации, которые нужно проигнорировать. Эти значения будут использоваться для параметра RecommendationId в следующей процедуре.

### <a name="to-create-and-use-an-ignorerecommendationstxt-text-file"></a>Создание и использование текстового файла IgnoreRecommendations.txt

1. Создайте файл с именем IgnoreRecommendations.txt.
2. Вставьте или введите значение RecommendationId для каждой рекомендации, которую служба Log Analytics должна игнорировать, в отдельной строке, а затем сохраните и закройте файл.
3. Поместите файл в следующую папку на каждом компьютере, где служба Log Analytics должна игнорировать рекомендации:
4. На Operations Manager Management Server — *systemdrive*: \Program Files\Microsoft System Center 2012 R2\Operations манажер\сервер.

### <a name="to-verify-that-recommendations-are-ignored"></a>Контроль игнорирования рекомендаций

1. После выполнения следующей плановой оценки (по умолчанию выполняется раз в семь дней) указанные рекомендации помечаются как игнорируемые и больше не отображаются на панели мониторинга проверки работоспособности.
2. Для получения списка всех игнорируемых рекомендаций можно использовать следующие запросы поиска по журналам.

    ```
    Type=SCOMAssessmentRecommendationRecommendationResult=Ignored | select  Computer, RecommendationId, Recommendation | sort  Computer
    ```

    >[!NOTE]
    > Если ваша рабочая область переведена на [язык запросов Log Analytics](../logs/log-query-overview.md), приведенный выше запрос будет изменен следующим образом.
    >
    > `SCOMAssessmentRecommendationRecommendation | where RecommendationResult == "Ignore" | sort by Computer asc | project Computer, RecommendationId, Recommendation`

3. Если вы решите позже просмотреть игнорируемые рекомендации, удалите все файлы IgnoreRecommendations.txt или RecommendationIDs можно удалить из них.

## <a name="system-center-operations-manager-health-check-solution-faq"></a>Часто задаваемые вопросы по решению для проверки работоспособности System Center Operations Manager

*Решение "Проверка работоспособности" Добавлено в мою Log Analytics рабочую область. Но я не вижу рекомендации. Почему бы нет?* Добавив решение, используйте следующие шаги и просмотрите рекомендации на панели мониторинга Log Analytics.  

- [Установите учетную запись запуска от имени для проверки работоспособности System Center Operations Manager](#operations-manager-run-as-accounts-for-log-analytics).  
- [Настройте правило проверки работоспособности System Center Operations Manager](#configure-the-health-check-rule).


*Можно ли настроить частоту проверки?* Да. Ознакомьтесь с разделом [Настройка частоты выполнения](#configure-the-run-frequency).

*Если после добавления Проверка работоспособности System Center Operations Managerного решения обнаруживается другой сервер, будет ли он установлен?* Да, после обнаружения он будет проверяться в дальнейшем. По умолчанию это будет происходить каждые семь дней.

*Как называется процесс, который собирает данные?* AdvisorAssessment.exe

*Где запускается процесс AdvisorAssessment.exe?* AdvisorAssessment.exe выполняется в рамках процесса службы работоспособности сервера управления, на котором включено правило проверки работоспособности. С помощью этого процесса осуществляется обнаружение всей среды посредством удаленного сбора данных.

*Сколько времени требуется для сбора данных?* Время сбора данных на сервере составляет примерно 1 час. В средах, содержащих много экземпляров или баз данных Operations Manager, это может занять больше времени.

*Что делать, если мною установлен интервал оценки менее 1440 минут?* Оценка предварительно настроена для выполнение не реже, чем раз в день. Если переопределить значение интервала и указать значение меньше 1440 минут, то оценка будет выполняться с интервалом в 1440 минут.

*Как узнать о невыполненных предварительных условиях?* Если вы не видите результатов выполнения проверки работоспособности, скорее всего, причина в том, что некоторые ее предварительные требования не соблюдены. Можно выполнить запросы `Operation Solution=SCOMAssessment` и `SCOMAssessmentRecommendation FocusArea=Prerequisites` в службе поиска в журналах, чтобы увидеть невыполненные предварительные требования.

*Имеется `Failed to connect to the SQL Instance (….).` сообщение в случае сбоев необходимых компонентов. В чем заключается эта ошибка?* AdvisorAssessment.exe (процесс, собирающий данные) выполняется в рамках процесса службы работоспособности на сервере управления. В ходе проверки работоспособности этот процесс пытается подключиться к экземпляру SQL Server, на котором размещена база данных Operations Manager. Эта ошибка может возникать, когда правила брандмауэра блокируют подключение к экземпляру SQL Server.

*Данные какого типа собираются?* Собираются данные следующих типов: данные WMI, данные реестра, данные журнала событий, данные Operations Manager посредством Windows PowerShell, SQL-запросов и сборщика сведений о файлах.

*Почему необходимо настроить учетную запись «Запуск от имени»?* Для Operations Manager выполняются различные SQL-запросы. Чтобы они выполнялись, необходимо использовать учетную запись запуска от имени с необходимыми разрешениями. Кроме того, чтобы выполнять запросы к WMI, требуются учетные данные локального администратора.

*Почему отображаются только первые 10 рекомендаций?* Вместо отображения полного списка задач мы рекомендуем сконцентрироваться на приоритетных рекомендациях. После этого станут доступны дополнительные рекомендации. Если вы хотите просмотреть весь список, используйте функцию поиска по журналам.

*Можно ли игнорировать рекомендации?* Да, ознакомьтесь с разделом [Игнорирование рекомендаций](#ignore-recommendations).


## <a name="next-steps"></a>Дальнейшие действия

- Выполняйте [поиск по журналам](../logs/log-query-overview.md), чтобы просмотреть подробные данные проверки работоспособности System Center Operations Manager и соответствующие рекомендации.

