---
title: Мониторинг служб хранилища Azure с помощью Azure Monitor для службы хранилища | Документация Майкрософт
description: В этой статье описывается функция Azure Monitor для службы хранилища, которая позволяет администраторам хранилища быстро анализировать проблемы с производительностью и использованием учетных записей службы хранилища Azure.
ms.subservice: ''
ms.topic: conceptual
author: lgayhardt
ms.author: lagayhar
ms.date: 05/11/2020
ms.openlocfilehash: 47799898251923b327954c764dcccb8157ba5119
ms.sourcegitcommit: f5b8410738bee1381407786fcb9d3d3ab838d813
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/14/2021
ms.locfileid: "98208647"
---
# <a name="monitoring-your-storage-service-with-azure-monitor-for-storage"></a>Мониторинг службы хранилища с помощью Azure Monitor для службы хранилища

Azure Monitor для хранилища обеспечивает комплексный мониторинг учетных записей службы хранилища Azure через централизованное представление производительности, емкости и доступности таких служб. Отслеживать емкость и производительность можно двумя способами: напрямую из учетной записи хранения либо из Azure Monitor, чтобы просматривать сразу группы учетных записей. 

Эта статья поможет вам разобраться в работе Azure Monitor для службы хранилища и получить полезные сведения о работоспособности и производительности учетных записей хранения в большом масштабе, а также сосредоточиться на гиперобъектах и определить проблемы с задержкой, регулированием и доступностью.

## <a name="introduction-to-azure-monitor-for-storage"></a>Общие сведения об Azure Monitor для службы хранилища

Прежде чем перейти к использованию, стоит разобраться в том, как эта функция представляет и визуализирует информацию. Независимо от того, выбрана ли функция службы хранилища непосредственно в учетной записи хранения или в Azure Monitor, Azure Monitor для службы хранилища обеспечивает согласованное взаимодействие. 

Комбинированные функции предоставляют следующие возможности:

* **Представление в масштабе** — моментальный снимок со сведениями о доступности, основанный на работоспособности службы хранилища или операции API, использовании с отображением общего количества запросов, получаемых службой хранилища, и задержке с отображением среднего времени обработки запросов для службы хранилища или типа операции API. Кроме того, можно просматривать емкость большого двоичного объекта, файла, таблицы и очереди.

* **Глубокий анализ** конкретной учетной записи хранения для диагностики проблем или детального анализа по таким категориям: доступность, производительность, сбои и емкость. Выбор любого из этих параметров обеспечивает подробное представление метрик.  

* **Настраиваемые параметры** — место, где можно выбрать нужные метрики, изменить или установить пороговые значения, соответствующие вашим ограничениям, и сохранить в качестве собственной книги. Диаграммы из книги можно закрепить на панели мониторинга Azure.  

Эта функция не требует включения или настройки. Данные метрики хранилища из учетных записей хранения собираются по умолчанию. Если вы не знакомы с метриками, доступными в службе хранилища Azure, просмотрите их описание и определение в [этой статье](../../storage/blobs/monitor-blob-storage.md).

>[!NOTE]
>Доступ к функции является бесплатным. Оплачиваются только ключевые возможности Azure Monitor, которые вы настраиваете или подключаете, в соответствии со сведениями о [ценах на Azure Monitor](https://azure.microsoft.com/pricing/details/monitor/).


## <a name="view-from-azure-monitor"></a>Просмотр данных в Azure Monitor

В Azure Monitor можно просматривать сведения о транзакциях, задержках и емкости из нескольких учетных записей хранения в подписке, а также выявлять сбои и проблемы с производительностью и емкостью.

Чтобы просмотреть сведения об использовании и доступности учетных записей хранения во всех ваших подписках, выполните следующие действия:

1. Войдите на [портал Azure](https://portal.azure.com).

2. Выберите **Монитор** на панели слева на портале Azure, затем в разделе **Аналитика** выберите **Учетные записи хранения**.

    ![Представление нескольких учетных записей хранения](./media/storage-insights-overview/multiple-storage-accounts-view-01.png)

### <a name="overview-workbook"></a>Книга "Обзор"

В книге **Обзор** для выбранной подписки в таблице отображаются метрики интерактивного хранилища и состояние доступности службы для до 5 учетных записей хранения, сгруппированных в рамках подписки. Результаты можно фильтровать по параметрам, которые вы выбираете в следующих раскрывающихся списках:

* **Подписки** — отображаются только подписки с учетными записями хранения.  

* **Учетные записи хранения** . по умолчанию выбраны 5 учетных записей хранения. Если в селекторе области выбрать все или несколько учетных записей хранения, система выдаст до 200 учетных записей хранения. Например, если вы выберете в общей сложности 573 учетных записи хранения в трех выбранных подписках, будут показаны только 200 учетных записей. 

* **Диапазон времени** — по умолчанию отображаются данные за последние 4 часа с учетом выбранных параметров.

На плитке счетчика под раскрывающимся списком отображается общее количество учетных записей хранения в подписке, а также число выбранных. Для столбцов книги предусмотрены условные цветовые обозначения (так называемые тепловые карты), используемые для отметки метрик транзакций или ошибок. Самый темный цвет соответствует наибольшему значению, а самый светлый — наименьшему. Для столбцов, основанных на ошибках, значение выделяется красным цветом, а для столбцов на основе метрик — синим.

Выберите значение в столбцах **Доступность**, **E2E Latency** (Задержка E2E), **Задержка сервера** и **transaction error type/Errors** (тип ошибок транзакций/ошибки). Вы будете перенаправлены к отчету, предназначенному для конкретного типа метрик хранилища, соответствующих столбцу, выбранному для этой учетной записи хранения. Дополнительные сведения о книгах для каждой категории см. в разделе [Подробные сведения о книгах хранилища](#detailed-storage-workbooks) ниже. 

>[!NOTE]
>Дополнительные сведения о том, какие ошибки могут отображаться в отчете, см. в разделе о [схеме типов ответов](../../storage/blobs/monitor-blob-storage-reference.md#metrics-dimensions) (см. такие типы ответов, как **ServerOtherError**, **ClientOtherError**, **ClientThrottlingError**). В зависимости от выбранных учетных записей хранения, если обнаружено более трех типов ошибок, все остальные ошибки будут представлены в категории **Другие**.

Порог **доступности** по умолчанию:

* предупреждение — 99 %;
* критический — 90 %.

Чтобы установить пороговое значение доступности на основе результатов наблюдения или требований, ознакомьтесь со сведениями в разделе об [изменении порогового значения доступности](#modify-the-availability-threshold). 

### <a name="capacity-workbook"></a>Книга "Емкость"

Выберите **Емкость** в верхней части страницы, и откроется книга **Емкость**. Она отображает общий объем хранилища, используемый в учетной записи, и емкость, используемую каждой службой данных в учетной записи, чтобы определить интенсивность использования хранилища.

![Книга "Емкость" с несколькими учетными записями хранения](./media/storage-insights-overview/storage-account-capacity-02.png) 

Для столбцов книги предусмотрены условные тепловые карты с цветовыми обозначениями. Значения метрик емкости выделяются синим цветом. Самый темный цвет соответствует наибольшему значению, а самый светлый — наименьшему.

При выборе значения в одном из столбцов книги откроется книга **Емкость** для учетной записи хранения. Дополнительные сведения о подробном отчете см. в разделе [Подробные сведения о книгах хранилища](#detailed-storage-workbooks) ниже. 

## <a name="view-from-a-storage-account"></a>Просмотр из учетной записи хранения

Чтобы получить доступ к Azure Monitor для виртуальных машин непосредственно из учетной записи хранения, выполните следующие действия:

1. На портале Azure выберите "Учетные записи хранения".

2. В списке выберите учетную запись хранения. В разделе "Мониторинг" выберите "Аналитика".

    ![Снимок экрана, на котором показана страница "Обзор книги" для учетной записи хранения.](./media/storage-insights-overview/storage-account-direct-overview-01.png)

В книге **Обзор** для учетной записи хранения отображается несколько метрик производительности хранилища, которые помогут вам быстро оценить следующее:

* Работоспособность службы хранилища Позволяет немедленно определить, существует ли проблема вне вашего контроля, которая влияет на службу хранилища в регионе, в котором она развернута. Это указано в столбце **Сводка**.

* Интерактивные диаграммы производительности с самыми важными сведениями о емкости, доступности, транзакциях и задержках хранилища.  

* Плитки метрик и состояния, которые отображают доступность службы, общее число транзакций в службе хранилища, задержку E2E и задержку сервера.

Если нажать любую из кнопок **Сбои**, **Производительность**, **Доступность** и **Емкость**, открывается соответствующая книга. 

![Страница обзора выбранной учетной записи хранения](./media/storage-insights-overview/storage-account-capacity-01.png)

## <a name="detailed-storage-workbooks"></a>Подробные сведения о книгах хранилища

Независимо от того, выбрали ли вы значение в столбцах **Доступность**, **E2E Latency** (Задержка E2E), **Задержка сервера** и **transaction error type/Errors** (тип ошибок транзакций/Ошибки) из книги **Обзор** нескольких учетных записей хранения или нажали одну из кнопок **Сбои**, **Производительность**, **Доступность** и **Емкость** из книги **Обзор** в определенной учетной записи хранения, — в обоих случаях отобразится набор интерактивных сведений, связанных с хранилищем и адаптированных для этой категории.  

* При выборе столбца **Доступность** откроется книга **Доступность**. В ней отображаются сведения о текущем состоянии работоспособности службы хранилища Azure, таблица, показывающая доступное состояние работоспособности каждого объекта для службы данных, определенной в учетной записи хранения, с линией тренда для выбранного диапазона времени и диаграмма тренда доступности для каждой службы данных в учетной записи.  

    ![Пример отчета о доступности](./media/storage-insights-overview/storage-account-availability-01.png)

* В столбце **E2E Latency** (Задержка E2E) и **Задержка сервера** открывается книга **Производительность**. Она содержит плитку сводного состояния, отображающую задержку E2E и сервера, сравнительную диаграмму производительности E2E и задержки сервера, а также таблицу с разделением данных о задержке успешных вызовов по API для службы данных, определенной в учетной записи хранения.

    ![Пример отчета о производительности](./media/storage-insights-overview/storage-account-performance-01.png)

* При выборе любой из категорий ошибок, перечисленных в сетке, открывается книга **Сбой**. В отчете отображаются плитки метрик всех других ошибок на стороне клиента, за исключением описанных ошибок и успешных запросов, ошибок регулирования клиента, диаграмм производительности для метрики измерения транзакции **Тип ответа**, относящейся к атрибуту ClientOtherError, а также двух таблиц (**Транзакции по имени API** и **Транзакции по типу ответа**).

   ![Пример отчета о сбое](./media/storage-insights-overview/storage-account-failures-01.png)

* Если выбрать столбец **Емкость**, откроется книга **Емкость**. Она отображает сведения об общем объеме хранилища, используемом для каждого объекта данных хранилища в учетной записи, на плитках и в диаграмме, а также сведения о количестве объектов данных, хранящихся в учетной записи.  

    ![Страница емкости выбранной учетной записи хранения](./media/storage-insights-overview/storage-account-capacity-01.png) 

## <a name="pin-and-export"></a>Закрепление и экспорт

Вы можете закрепить любой раздел метрик на панели мониторинга Azure, щелкнув значок канцелярской кнопки в правом верхнем углу раздела.

![Пример закрепления раздела метрики на панели мониторинга](./media/storage-insights-overview/workbook-pin-example.png)

Книги **Обзор** или **Емкость** учетных записей хранения и нескольких подписок позволяют экспортировать результаты в таблицу Excel, щелкнув значок со стрелкой вниз справа от значка канцелярской кнопки.

![Пример экспорта результатов сетки книги](./media/storage-insights-overview/workbook-export-example.png)

## <a name="customize-azure-monitor-for-storage"></a>Настройка Azure Monitor для службы хранилища

В этом разделе описываются распространенные сценарии редактирования книги для выполнения настроек, необходимых для решения ваших задач по анализу данных:

* настройка книги на постоянный выбор определенной подписки, а также учетных записей хранения;
* изменение метрик в сетке;
* изменение порога доступности;
* изменение цветовых обозначений.

Настройки сохраняются в пользовательской книге, чтобы конфигурация по умолчанию в опубликованной книге не перезаписывалась. Книги хранятся в группе ресурсов либо в закрытом разделе **Мои отчеты**, либо в разделе **Общие отчеты**, доступном всем пользователям с доступом к группе ресурсов. После сохранения пользовательской книги перейдите в коллекцию книг и запустите эту книгу.

![Запуск книги из панели команд](./media/storage-insights-overview/workbook-command-bar-gallery.png)

### <a name="specifying-a-subscription-or-storage-account"></a>Указание подписки или учетной записи хранения

Вы можете настроить книги **Емкость** или **Обзор** подписок и учетной записи хранения на выбор определенных подписок или учетных записей хранения при каждом запуске. Для этого выполните следующие действия:

1. Выберите **Монитор** на портале, а затем в области слева щелкните **Учетные записи хранения**.

2. В книге **Обзор** на панели команд выберите **Изменить**.

3. В раскрывающемся списке **Подписки** выберите одну или несколько подписок, которые вы хотите использовать по умолчанию. Помните, что книга поддерживает в общей сложности до 10 подписок.  

4. В раскрывающемся списке **Учетные записи хранения** выберите одну или несколько учетных записей, которые вы хотите использовать по умолчанию. Помните, что книга поддерживает в общей сложности до 200 учетных записей хранения. 

5. Выберите **Сохранить как** на панели команд, чтобы сохранить копию книги с вашими настройками, а затем щелкните **Редактирование завершено**, чтобы вернуться в режим чтения.  

### <a name="modify-metrics-and-colors-in-the-workbook"></a>Изменение метрик и цветов в книге

Предварительно созданные книги содержат данные метрик. Вы можете изменять или удалять любую из визуализаций и выполнять настройки в соответствии с конкретными потребностями вашей команды.

В нашем примере мы работаем с книгой емкости нескольких подписок и учетных записей хранения, чтобы продемонстрировать, как выполнять следующие действия:

* удалять метрики;
* изменять цветовые обозначения.

Вы можете внести те же изменения в любую из предварительно созданных книг **сбоев**, **производительности**, **доступности** и **емкости**.

1. Выберите **Монитор** на портале, а затем в области слева щелкните **Учетные записи хранения**.

2. Выберите **Емкость**, чтобы перейти в книгу емкости, и на панели команд щелкните **Изменить**.

    ![Выбор параметра изменения книги](./media/storage-insights-overview/workbook-edit-workbook.png)

3. Рядом с разделом метрики выберите **Изменить**.

    ![Выбор параметра изменения метрики книги емкости](./media/storage-insights-overview/edit-metrics-capacity-workbook-01.png)

4. Мы собираемся удалить столбец **Account used capacity timeline** (Временная шкала использованной емкости учетной записи), поэтому выберите **Параметры столбца** в сетке метрик.

    ![Изменение настроек столбца](./media/storage-insights-overview/edit-capacity-workbook-resource-grid.png)

5. В области **Изменить настройки столбца** в разделе **Столбцы** выберите **microsoft.storage/storageaccounts-Capacity-UsedCapacity Timeline$|Account used capacity Timeline$** и в раскрывающемся списке **Средство визуализации столбца** щелкните **Скрытый**.

6. Чтобы сохранить изменения, выберите **Сохранить и закрыть**.

Теперь изменим цветовую тему для метрик емкости в отчете, чтобы использовать зеленый цвет вместо синего.

1. Выберите **Параметры столбцов** в сетке метрик.

2. В области **изменить параметры столбца** выберите в разделе **столбцы** **Microsoft. хранилище/storageaccounts-Capacity-используемая емкость составляет $ `|` Microsoft. хранилище/Storageaccounts/блобсервицес-Capacity-BlobCapacity $ `|` Microsoft. хранилище/storageaccounts/филесервицес-Capacity-филекапаЦити $ `|` Microsoft. Storage/storageaccounts/куеуесервицес-Capacity-куеуекапаЦити $ `|` Майкрософт. Storage/storageaccounts/таблесервицес-Capacity-TableCapacity $**. В раскрывающемся списке **Цветовая палитра** выберите **Зеленый**.

3. Чтобы сохранить изменения, выберите **Сохранить и закрыть**.

4. Выберите **Сохранить как** на панели команд, чтобы сохранить копию книги с вашими настройками, а затем щелкните **Редактирование завершено**, чтобы вернуться в режим чтения.  

### <a name="modify-the-availability-threshold"></a>Изменение порога доступности

В этом примере используется книга емкости учетной записи хранения и показано, как изменить пороговое значение доступности. По умолчанию для плитки и сетки отчетов о проценте доступности настроен минимальный порог в 90 и максимальный — в 99. Мы изменим минимальное пороговое значение **процента доступности** в сетке **Доступность по имени API** на 85 %, это означает, что состояние работоспособности будет иметь значение "Критическое", если пороговое значение будет меньше 85 %. 

1. Выберите **Учетные записи хранения** на портале, а затем — учетную запись хранения из списка.

2. В области слева выберите **Аналитика**.

3. В книге выберите **Доступность**, чтобы открыть книгу доступности, а затем щелкните **Изменить** на панели команд. 

4. Прокрутите страницу вниз и слева возле сетки **Availability by API** (Доступность по API) выберите **Изменить**.

    ![Изменение значения параметра сетки доступности по имени API](./media/storage-insights-overview/availability-workbook-avail-by-apiname.png)

5. Выберите **Параметры столбца**, а затем в области **Изменить настройки столбца** в разделе **Столбцы** щелкните **Availability (%) (Thresholds + Formatted)** (Доступность (%) (Пороговые значения + форматирование)).

6. Измените значение **критического** состояния работоспособности с **90** на **85**, а затем щелкните **Сохранить и закрыть**.

    ![Изменение порогового значения доступности для критического состояния](./media/storage-insights-overview/edit-column-settings-capacity-workbook-01.png)

7. Выберите **Сохранить как** на панели команд, чтобы сохранить копию книги с вашими настройками, а затем щелкните **Редактирование завершено**, чтобы вернуться в режим чтения.

## <a name="troubleshooting"></a>Устранение неполадок

Общие рекомендации по устранению неполадок см. в соответствующей [статье об устранении неполадок](troubleshoot-workbooks.md)на основе книги.

Сведения, приведенные в этом разделе, помогут вам диагностировать и устранять некоторые распространенные неполадки, которые могут возникнуть при использовании Azure Monitor для службы хранилища. Чтобы найти информацию о конкретной проблеме, просмотрите список ниже.

### <a name="resolving-performance-capacity-or-availability-issues"></a>Устранение проблем с производительностью, емкостью или доступностью

Сведения об устранении проблем, связанных с хранилищем, обнаруженных с помощью Azure Monitor для службы хранилища, см. в [руководстве по устранению неполадок службы хранилища Azure](../../storage/common/storage-monitoring-diagnosing-troubleshooting.md#troubleshooting-guidance).  

### <a name="why-can-i-only-see-200-storage-accounts"></a>Почему отображаются только 200 учетных записей хранения?

Независимо от количества выбранных подписок выбрать больше 200 учетных записей хранения невозможно.

### <a name="how-to-change-the-coloring-and-threshold-for-availability"></a>Как изменить цвет и пороговое значение для доступности?

Подробные инструкции по изменению цвета и пороговых значений для доступности см. в [этом разделе](#modify-the-availability-threshold).

### <a name="how-to-analyze-and-troubleshoot-the-data-shown-in-azure-monitor-for-storage"></a>Как анализировать данные и устранять связанные с ними проблемы в Azure Monitor для службы хранилища?

 Дополнительные сведения о том, как анализировать данные и устранять связанные с ними проблемы в Azure Monitor для службы хранилища, см. в статье [Мониторинг, диагностика и устранение неисправностей службы хранилища Microsoft Azure](../../storage/common/storage-monitoring-diagnosing-troubleshooting.md).

### <a name="why-dont-i-see-all-the-types-of-errors-in-metrics"></a>Почему в метриках отображаются не все типы ошибок?

В настоящее время отображаются до трех различных типов ошибок, а остальные ошибки объединены в одном контейнере. Он управляется с помощью splitByLimit и может быть модифицирован. Для изменения этого свойства выполните следующие действия:

1. Щелкните "Редактировать книгу".
2. Перейдите в раздел метрик, щелкните "Изменить", а затем выберите **Transactions, Sum** (Транзакции, сумма) или любые другие метрики, которые требуется изменить.

    ![Раздел метрик с выбранными параметрами "Изменить" и Transactions, Sum (Транзакции, суммы).](./media/storage-insights-overview/fqa7.png)

3. Затем измените значение "Число разбиений".

    ![Выбор параметров метрик](./media/storage-insights-overview/fqa7-2.png)

Если вы хотите просмотреть различные типы ошибок n, укажите splitByLimit как n+1 (1: дополнительно для остальных ошибок).

###  <a name="i-saved-my-workbook-while-on-some-storage-account-why-cant-i-find-it-now"></a>Книга сохранена в определенной учетной записи хранения. Почему я не могу найти ее сейчас?

Каждая книга сохраняется в указанной вами учетной записи хранения. Попробуйте найти конкретную учетную запись хранения, в которой сохранена книга. Нет другой возможности найти конкретную книгу, не зная ресурс (учетную запись хранения).

## <a name="next-steps"></a>Дальнейшие действия

* Настройте [оповещения метрики](../platform/alerts-metric.md) и [уведомления о работоспособности служб](../../service-health/alerts-activity-log-service-notifications-portal.md), чтобы получать автоматизированные оповещения для обнаружения проблем.

* Узнайте, в каких ситуациях применяются книги, как создавать и настраивать отчеты и многое другое, изучив статью [Создание интерактивных отчетов с использованием книг Azure Monitor](../platform/workbooks-overview.md).

* Дополнительные указания о функциях аналитики хранилища и других инструментах идентификации, диагностики и устранения неполадок, связанных со службой хранилища Azure, см. в статье [Мониторинг, диагностика и устранение неполадок службы хранилища Microsoft Azure](../../storage/common/storage-monitoring-diagnosing-troubleshooting.md).
