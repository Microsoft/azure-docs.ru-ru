---
title: Устранение неполадок Azure Monitor диаграмм метрик
description: Устранение проблем с созданием, настройкой или интерпретацией диаграмм метрик
author: vgorbenko
services: azure-monitor
ms.topic: conceptual
ms.date: 04/23/2019
ms.author: vitalyg
ms.openlocfilehash: bc1978f6ed0aa3e38f25fa03fc54ddc7d4efb9c3
ms.sourcegitcommit: f3ec73fb5f8de72fe483995bd4bbad9b74a9cc9f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/04/2021
ms.locfileid: "102033339"
---
# <a name="troubleshooting-metrics-charts"></a>Устранение неполадок с диаграммами метрик

Используйте эту статью, если возникли проблемы с созданием, настройкой или интерпретацией диаграмм в обозревателе метрик Azure. Если вы не знакомы с метриками, ознакомьтесь со сведениями о начале [работы с обозревателем метрик](metrics-getting-started.md) и [дополнительными функциями обозревателя метрик](../essentials/metrics-charts.md). Вы также можете просмотреть [примеры](../essentials/metric-chart-samples.md) настроенных диаграмм метрик.

## <a name="chart-shows-no-data"></a>На диаграмме не отображаются данные

Иногда диаграммы могут не показывать данные после выбора правильных ресурсов и метрик. Такое поведение может быть вызвано несколькими из следующих причин.

### <a name="microsoftinsights-resource-provider-isnt-registered-for-your-subscription"></a>Поставщик ресурсов Microsoft.Insights не зарегистрирован для подписки

Для обзора метрик необходимо зарегистрировать поставщика ресурсов *Microsoft.Insights* в вашей подписке. Во многих случаях он регистрируется автоматически (то есть после настройки правила генерации оповещений, настройки параметров диагностики для любого ресурса или настройки правила автомасштабирования). Если поставщик ресурсов Microsoft. Insights не зарегистрирован, его необходимо зарегистрировать вручную, выполнив действия, описанные в разделе [поставщики и типы ресурсов Azure](../../azure-resource-manager/management/resource-providers-and-types.md).

**Решение:** Откройте вкладку " **подписки**", " **поставщики ресурсов** " и убедитесь, что *Microsoft. Insights* зарегистрировано для вашей подписки.

### <a name="you-dont-have-sufficient-access-rights-to-your-resource"></a>У вас недостаточно прав для доступа к ресурсу

В Azure доступ к метрикам контролируется с помощью [управления доступом на основе ролей Azure (Azure RBAC)](../../role-based-access-control/overview.md). Вы должны иметь роль [читателя данных мониторинга](../../role-based-access-control/built-in-roles.md#monitoring-reader), [участника мониторинга](../../role-based-access-control/built-in-roles.md#monitoring-contributor) или [участника](../../role-based-access-control/built-in-roles.md#contributor) для просмотра метрик по любому ресурсу.

**Решение:** Убедитесь, что у вас есть необходимые разрешения для ресурса, с которого вы изучаете метрики.

### <a name="your-resource-didnt-emit-metrics-during-the-selected-time-range"></a>Ресурс не сгенерировал метрики для выбранного диапазона времени

Некоторые ресурсы генерируют метрики только в определенных случаях. Например, Azure не будет собирать метрики для остановленных виртуальных машин. Другие ресурсы могут генерировать свои метрики только при соблюдении некоторых условий. Например, метрика, отображающая время обработки транзакции, требует наличия по меньшей мере одной транзакции. При отсутствии транзакций в выбранном диапазоне времени диаграмма будет пуста. Кроме того, хотят большинство метрик в Azure собираются ежеминутно, частота сбора некоторых из них меньше. Подробные сведения о метриках и их просмотре см. в документации по метрикам.

**Решение:** Измените время диаграммы на более широкий диапазон. Вы можете начать с "последних 30 дней", используя более крупную гранулярность времени (или полагаться на параметр "Автоматическая детализация времени").

### <a name="you-picked-a-time-range-greater-than-30-days"></a>Вы выбрали диапазон времени более 30 дней

[Большинство метрик в Azure хранятся в течение 93 дней](../essentials/data-platform-metrics.md#retention-of-metrics). Но вы можете запрашивать для отображения на отдельной диаграмме данные не более чем за 30 дней. Это ограничение не применяется к [метрикам на основе журналов](../app/pre-aggregated-metrics-log-metrics.md#log-based-metrics).

**Решение:** Если отображается пустая диаграмма или на диаграмме отображается только часть данных метрик, убедитесь, что разница между датами начала и окончания в средстве выбора времени не превышает 30-дневного интервала.

### <a name="all-metric-values-were-outside-of-the-locked-y-axis-range"></a>Все значения метрик находились вне диапазона зафиксированной оси Y

[Зафиксировав границы оси Y в диаграмме](../essentials/metrics-charts.md#locking-the-range-of-the-y-axis), вы можете непреднамеренно создать условия, при которых линия диаграммы не будет отображаться. Например, если ось Y зафиксирована по диапазону от 0 % до 50 %, а метрика имеет постоянное значение 100 %, линия диаграммы всегда будет отрисовываться за пределами видимой области, а диаграмма будет пустой.

**Решение:** Убедитесь, что границы оси y диаграммы не заблокированы за пределами диапазона значений метрик. Если границы оси Y зафиксированы, возможно, вам потребуется временно сбросить их, чтобы значения метрик не выходили за пределы диапазона для диаграммы. Фиксирование диапазона оси Y не рекомендуется с включенной автоматической детализацией для диаграмм с агрегатами **sum**, **min** и **max**, так как их значения изменятся с заданной детализацией при изменении размеров окна браузера или разрешения экрана. А после выбора другого значения детализации область отображения диаграммы может стать пустой.

### <a name="you-are-looking-at-a-guest-os-metric-but-didnt-enable-azure-diagnostic-extension"></a>Вы просматриваете метрику гостевой ОС, но не включили расширение диагностики Azure

Сбор метрик **гостевой ОС** требует настройки расширения "Диагностика Azure" или его включения с помощью панели **Параметры диагностики** для вашего ресурса.

**Решение:** Если расширение система диагностики Azure включено, но метрики по-прежнему не отображаются, выполните действия, описанные в [руководстве по устранению неполадок расширений система диагностики Azure](../agents/diagnostics-extension-troubleshooting.md#metric-data-doesnt-appear-in-the-azure-portal). См. также шаги по устранению неполадок для [не удается выбрать пространство имен и метрики гостевой ОС](#cannot-pick-guest-os-namespace-and-metrics) .

## <a name="error-retrieving-data-message-on-dashboard"></a>Сообщение об ошибке при извлечении данных на панели мониторинга

Эта проблема может произойти при создании панели мониторинга с использованием устаревшей метрики, которая удалена из Azure. Чтобы убедиться в том, что это так, откройте вкладку **метрики** ресурса и проверьте доступные метрики в средстве выбора метрик. Если метрика не отображается, это значит, что она удалена из Azure. Как правило, устаревшие метрики заменяются новыми оптимизированными метриками, которые предоставляют аналогичные сведения о работоспособности ресурсов.

**Решение:** Обновите плитку со сбоем, выбрав альтернативную метрику для диаграммы на панели мониторинга. См. [список доступных метрик для служб Azure](./metrics-supported.md).

## <a name="chart-shows-dashed-line"></a>На диаграмме отображается пунктирная линия

На диаграммах метрик Azure используется пунктирный стиль линии, указывающий на наличие отсутствующего значения (также известного как "значение null") между двумя известными точками данных граней времени. Например, если в селекторе времени выбрана гранулярность времени "1 минута", а метрика была зарегистрирована в 07:26, 07:27, 07:29 и 07:30 (Обратите внимание на промежуток в минуту между секундами и третьими точками данных), пунктирная линия будет соединяться с 07:27 и 07:29, а сплошная линия будет подключаться ко всем остальным точкам данных. Пунктирная линия выпадает до нуля, когда метрика использует **Счетчик** и **сумму** агрегирования. Для агрегатов **AVG**, **min** или **Max** пунктирная линия соединяет две ближайшие известные точки данных. Также, если данные отсутствуют в крайней правой или левой части диаграммы, пунктирная линия расширяется в направлении отсутствующей точки данных.
  ![Снимок экрана, показывающий, как при отсутствии данных в крайней правой или левой части диаграммы пунктирная линия расширяется до направления отсутствующей точки данных.](./media/metrics-troubleshoot/dashed-line.png)

**Решение:** Это поведение характерно для разработки. Это удобно для определения отсутствующих точек данных. График является лучшим выбором для визуализации тенденций метрик высокой плотности, но может быть трудно интерпретировать для метрик с разреженными значениями, особенно если важны соотношение значений с гранями времени. Пунктирные линии упрощают чтение этих графиков, но если они все равно непонятны, попробуйте представить метрики на диаграмме другого типа. Например, точечная диаграмма с одинаковой метрикой четко отображает каждый промежуток времени, визуализируя точку только при наличии значения и пропуская точку данных вообще, когда отсутствует значение: снимок экрана, показывающий пункт ![ меню точечная диаграмма.](./media/metrics-troubleshoot/scatter-plot.png)

   > [!NOTE]
   > Если вы все равно хотите рассматривать метрику на линейном графике, вы можете оценить степень детализации времени, перемещая по графику курсор мыши и выделяя точки данных под указателем мыши.

## <a name="chart-shows-unexpected-drop-in-values"></a>На диаграмме присутствует непредвиденный спад значений

Во многих случаях кажущийся спад значений метрик объясняется некорректным толкованием отображаемых на диаграмме данных. Вас может ввести в заблуждение спад значений сумм или счетчиков, если диаграмма отображает данные за последние минуты, так как последние точки данных метрик еще не были получили или обработаны Azure. В зависимости от службы, задержка на обработку метрик может составлять две минуты. Для диаграмм с недавним диапазоном времени, степень детализации которого составляет 1 или 5 минут, удаляется значение за последние несколько минут: ![ снимок экрана, на котором показано удаление значения за последние несколько минут.](./media/metrics-troubleshoot/unexpected-dip.png)

**Решение:** Это поведение характерно для разработки. Мы считаем, что отображение данных сразу же после их получения полезно, даже если они *отрывочны* или *неполны*. Они позволяют вам быстрее принять важное решение и без задержек начать исследование. Например, для метрики, которая отображает число сбоев, отображение неполного значения X позволяет вам сделать вывод, что за конкретную минуту произошло по меньшей мере X сбоев. Благодаря этому вы можете немедленно начать исследование, а не ожидать получения точного значения сбоев для этой минуты, которое в итоге может быть не настолько важным. Диаграмма будет обновлена после получения полного набора данных, но при этом также могут быть отображены новые неполные точки данных для самых последних минут.

## <a name="cannot-pick-guest-os-namespace-and-metrics"></a>Не удается выбрать пространство имен и метрики гостевой ОС

Виртуальные машины и масштабируемые наборы виртуальных машин имеют две категории метрик: метрики **узла виртуальной машины** собираются средой размещения Azure, а метрики **гостевой ОС (классической)**  — [агентом мониторинга](../agents/agents-overview.md), который выполняется в ваших виртуальных машинах. Для установки агента мониторинга включите [расширение диагностики Azure](../agents/diagnostics-extension-overview.md).

По умолчанию метрики гостевой ОС сохраняются в учетной записи хранения Azure, которую можно выбрать на вкладке **Параметры диагностики** вашего ресурса. Если метрики гостевой ОС не собираются или обозреватель метрик не может получить к ним доступ, вам будет отображаться только пространство имен метрик для **узла виртуальной машины**:

![изображение метрики](./media/metrics-troubleshoot/vm.png)

**Решение:** Если в обозревателе метрик не отображается пространство имен **гостевой ОС (классическая версия)** и метрики, выполните следующие действия.

1. Убедитесь, что [расширение диагностики Azure](../agents/diagnostics-extension-overview.md) включено и настроено на сбор метрик.
    > [!WARNING]
    > Вы не можете использовать [агент Log Analytics](../agents/agents-overview.md#log-analytics-agent) (также называется Microsoft Monitoring Agent, или MMA) для отправки метрик **гостевой ОС** в учетную запись хранения.

1. Убедитесь, что поставщик ресурсов **Microsoft. Insights** [зарегистрирован для вашей подписки](#microsoftinsights-resource-provider-isnt-registered-for-your-subscription).

1. Убедитесь, что учетная запись хранения не защищена брандмауэром. Порталу Azure необходим доступ к учетной записи хранения для получения данных метрик и составления диаграмм.

1. Используйте [Обозреватель службы хранилища Azure](https://azure.microsoft.com/features/storage-explorer/) , чтобы проверить, что метрики передаются в учетную запись хранения. Если метрики не собираются, выполните инструкции из [руководства по устранению неполадок для расширения диагностики Azure](../agents/diagnostics-extension-troubleshooting.md#metric-data-doesnt-appear-in-the-azure-portal).

## <a name="next-steps"></a>Дальнейшие действия

* [Дополнительные сведения о начале работы с обозревателем метрик](metrics-getting-started.md)
* [Дополнительные сведения о дополнительных возможностях обозревателя метрик](../essentials/metrics-charts.md)
* [Список доступных метрик для служб Azure](./metrics-supported.md)
* [Примеры настроенных диаграмм](../essentials/metric-chart-samples.md)