---
title: Метрики в Azure Monitor | Документация Майкрософт
description: В этой статье описаны метрики в Azure Monitor, являющиеся данными для упрощенного мониторинга, которые можно использовать в сценариях почти в реальном времени.
documentationcenter: ''
author: bwren
manager: carmonm
ms.topic: conceptual
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 03/26/2019
ms.author: bwren
ms.openlocfilehash: bc2dc3fdb74819a923a3fc4dac89262c1f43ac98
ms.sourcegitcommit: e559daa1f7115d703bfa1b87da1cf267bf6ae9e8
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/17/2021
ms.locfileid: "100613220"
---
# <a name="azure-monitor-metrics-overview"></a>Обзор метрик Azure Monitor
Метрики Azure Monitor — это функция Azure Monitor, которая собирает числовые данные из [наблюдаемых ресурсов](../monitor-reference.md) в базу данных временных рядов. Метрики — это числовые значения, которые собираются с регулярными интервалами и описывают некоторые аспекты системы в определенное время. Метрики в Azure Monitor являются упрощенными. Их можно использовать в сценариях почти в реальном времени, что делает их особенно полезными для создания оповещений и быстрого обнаружения проблем. Вы можете анализировать их в интерактивном режиме с помощью обозревателя метрик, заранее получать оповещение при превышении порогового значения или визуализировать их в книге или на панели мониторинга.


> [!NOTE]
> Метрики Azure Monitor — это одна половина платформы данных, поддерживающая Azure Monitor. Второй — [Azure Monitor журналы](../platform/data-platform-logs.md) , собирающие и упорядочивающие данные журнала и производительности, и позволяющие анализировать их с помощью расширенного языка запросов. Метрики являются более легковесными по сравнению с данными в журналах Azure Monitor и поддерживают сценарии практически в реальном времени, что делает их особенно полезными для предупреждений и быстрого обнаружения проблем. Однако метрики могут хранить только числовые данные в определенной структуре, в то время как журналы могут хранить различные типы данных, каждая из которых имеет собственную структуру. Можно также выполнить сложный анализ данных журналов с помощью запросов к журналу, которые нельзя использовать для анализа данных метрик.


## <a name="what-can-you-do-with-azure-monitor-metrics"></a>Как можно использовать метрики Azure Monitor?
В следующей таблице перечислены различные способы использования метрик в Azure Monitor.

|  |  |
|:---|:---|
| **Анализ** | Используйте [обозреватель метрик](metrics-charts.md) для анализа собранных метрик на диаграмме и сравнения метрик из разных ресурсов. |
| **Оповещение** | Настройте [правило генерации оповещения по метрике](../alerts/alerts-metric.md), которое отправляет уведомление или выполняет [автоматическое действие](../alerts/action-groups.md), когда значение метрики переходит пороговое значение. |
| **Визуализация** | Закрепите диаграмму из обозревателя метрик на [панели мониторинга Azure](../learn/tutorial-app-dashboards.md).<br>Создайте [книгу](../visualize/workbooks-overview.md), чтобы объединить с несколькими наборами данных в интерактивном отчете. Экспортируйте результаты запроса в решение [Grafana](../platform/grafana-plugin.md), чтобы использовать его панель мониторинга и объединить с другими источниками данных. |
| **Автоматизация** |  С помощью [автомасштабирования](../autoscale/autoscale-overview.md) можно увеличивать или уменьшать ресурсы, когда метрика выходит за пороговое значение. |
| **Получение** | Доступ к значениям метрик из командной строки с помощью [командлетов PowerShell](/powershell/module/az.applicationinsights).<br>Доступ к значениям метрик из настраиваемого приложения посредством [REST API](../platform/rest-api-walkthrough.md).<br>Доступ к значениям метрик из командной строки с помощью [CLI](/cli/azure/monitor/metrics). |
| **Экспорт** | [Перенаправляйте метрики в журналы](../platform/resource-logs.md#send-to-azure-storage) для анализа данных в метриках Azure Monitor вместе с данными в журналах Azure Monitor и хранения значений метрик дольше 93 дней.<br>Организуйте потоковую передачу метрик в [концентратор событий](../platform/stream-monitoring-data-event-hubs.md) для их перенаправления во внешние системы. |
| **Архив** | [Архивация](../platform/platform-logs-overview.md) журнала производительности и работоспособности ресурса в целях соответствия требованиям, аудита или автономной отчетности. |

![Общие сведения о метриках](media/data-platform-metrics/metrics-overview.png)


## <a name="data-collection"></a>сбор данных
Существует три основных источника метрик, собираемых службой Azure Monitor. После сбора метрик в базе данных метрик Azure Monitor их можно оценить вместе, независимо от источников.

**Ресурсы Azure**. Метрики платформы создаются ресурсами Azure и наглядно отображают работоспособность и производительность этих ресурсов. Каждый тип ресурсов создает [отдельный набор метрик](../platform/metrics-supported.md), который не нужно настраивать. Метрики платформы собираются из ресурсов Azure с частотой раз в минуту, если в определении метрики не указано иное. 

**Приложения**. Метрики создаются Application Insights для наблюдаемых приложений и помогают выявить проблемы с производительностью и отслеживать тенденции использования приложения. Сюда входит ряд значений, в том числе значения _Время отклика сервера_ и _Исключения браузера_.

**Агенты виртуальной машины**. Метрики собираются из гостевой операционной системы виртуальной машины. Включите метрики гостевой ОС для виртуальных машин Windows с помощью [Windows Diagnostic Extension (WAD)](../agents/diagnostics-extension-overview.md), а для виртуальных машин Linux — с помощью [агента InfluxData Telegraf ](https://www.influxdata.com/time-series-platform/telegraf/).

**Пользовательские метрики**. Вы можете определить метрики в дополнение к стандартным метрикам, которые доступны автоматически. Вы можете [определить настраиваемые метрики в приложении](../app/api-custom-events-metrics.md), которое отслеживается с помощью Application Insights, или создать настраиваемые метрики для службы Azure с помощью[API настраиваемых метрик](../platform/metrics-store-custom-rest-api.md).

- Полный список источников данных, которые могут отсылать данные в метрики Azure Monitor, см. в разделе [что отслеживается Azure Monitor?](../monitor-reference.md) .

## <a name="metrics-explorer"></a>Обозреватель метрик
С помощью [обозревателя метрик](metrics-charts.md) можно интерактивно анализировать данные непосредственно в базе данных метрик и отображать на диаграмме изменение значений нескольких метрик во времени. Вы можете закрепить диаграммы на панели мониторинга, чтобы просматривать их с другими визуализациями. Кроме того, вы можете извлечь метрики с помощью [REST API мониторинга Azure](../platform/rest-api-walkthrough.md).

![Обозреватель метрик](media/data-platform-metrics/metrics-explorer.png)

- Чтобы приступить к работе с обозревателем метрик, см. раздел [Приступая к работе с Azure Monitor обозревателе метрик](../platform/metrics-getting-started.md) .

## <a name="data-structure"></a>Структура данных
Данные, собранные метриками Azure Monitor, хранятся в базе данных временных рядов, которая оптимизирована для анализа данных с отметками времени. Каждый набор значений метрик представляет собой временной ряд со следующими свойствами:

* время получения значения;
* ресурс, с которым сопоставлено значение;
* пространство имен, используемое в качестве категории метрики;
* имя метрики;
* само значение;
* некоторые метрики могут иметь несколько измерений, как будет рассказано в разделе [Многомерные метрики](#multi-dimensional-metrics). Пользовательские метрики могут иметь до 10 измерений.

## <a name="multi-dimensional-metrics"></a>Многомерные метрики
Одной из проблем при работе с метриками данных является то, что они часто содержат ограниченные сведения для предоставления контекста для собранных значений. Azure Monitor решает эту проблему благодаря многомерным метрикам. Измерения метрики — это пары имя-значение, которые используются для передачи дополнительных данных с описаниями значения метрики. Например, метрика _Доступное место на диске_ может иметь измерение с названием _Диск_ со значениями _C:_ и _D:_ . Это позволяет просматривать сведения о доступном месте на всех дисках или на отдельных дисках.

В примере ниже показаны два набора данных для гипотетической метрики с названием _Пропускная способность сети_. В первом наборе данных нет измерений. Во втором наборе данных показаны значения с двумя измерениями, _IP-адрес_ и _Направление_:

### <a name="network-throughput"></a>Пропускная способность сети

| Отметка времени     | Значение метрики |
| ------------- |:-------------|
| 8/9/2017 8:14 | 1331,8 Кбит/с |
| 8/9/2017 8:15 | 1141,4 Кбит/с |
| 8/9/2017 8:16 | 1110,2 Кбит/с |

Такая метрика без измерений поможет найти ответ только на простые вопросы, например о том, какой была пропускная способность в определенный момент времени.

### <a name="network-throughput--two-dimensions-ip-and-direction"></a>Пропускная способность сети и два измерения ("IP-адрес" и "Направление")

| Отметка времени     | Измерение "IP-адрес"   | Измерение "Направление" | Значение метрики|
| ------------- |:-----------------|:------------------- |:-----------|
| 8/9/2017 8:14 | IP-адрес — 192.168.5.2 | Направление — отправка    | 646,5 Кбит/с |
| 8/9/2017 8:14 | IP-адрес — 192.168.5.2 | Направление — получение | 420,1 Кбит/с |
| 8/9/2017 8:14 | IP-адрес — 10.24.2.15  | Направление — отправка    | 150,0 Кбит/с |
| 8/9/2017 8:14 | IP-адрес — 10.24.2.15  | Направление — получение | 115,2 Кбит/с |
| 8/9/2017 8:15 | IP-адрес — 192.168.5.2 | Направление — отправка    | 515,2 Кбит/с |
| 8/9/2017 8:15 | IP-адрес — 192.168.5.2 | Направление — получение | 371,1 Кбит/с |
| 8/9/2017 8:15 | IP-адрес — 10.24.2.15  | Направление — отправка    | 155,0 Кбит/с |
| 8/9/2017 8:15 | IP-адрес — 10.24.2.15  | Направление — получение | 100,1 Кбит/с |

Эта метрика поможет найти ответ на вопросы о том, какая пропускная способность для каждого IP-адреса и сколько данных было отправлено и получено. Многомерные метрики имеют дополнительные значения аналитики и диагностики в отличие от метрик без измерений.

## <a name="retention-of-metrics"></a>Хранение метрик
Для большинства ресурсов в Azure метрики хранятся в течение 93 дней. Существуют некоторые исключения.

**Метрики гостевой ОС**
-   **Классические метрики гостевой ОС.** Это счетчики производительности, которые собираются [Windows Diagnostic Extension (WAD)](../agents/diagnostics-extension-overview.md) или [Linux Diagnostic Extension (LAD)](../../virtual-machines/extensions/diagnostics-linux.md) и направляются в учетную запись хранения Azure. Период хранения этих метрик составляет 14 дней.
-   **Метрики гостевой ОС, отправляемые в метрики Azure Monitor.** Это счетчики производительности, которые собираются с помощью [Windows Diagnostic Extension (WAD)](../agents/diagnostics-extension-overview.md) и отправляются в [приемник данных Azure Monitor](../agents/diagnostics-extension-overview.md#data-destinations), или собираются с помощью [агента InfluxData Telegraf](https://www.influxdata.com/time-series-platform/telegraf/) на компьютерах Linux. Период хранения этих метрик составляет 93 дней.
-   **Метрики гостевой ОС, собираемые агентом Log Analytics.** Это счетчики производительности, собираемые агентом Log Analytics и отправляемые в рабочую область Log Analytics. Период хранения этих метрик составляет 31 день, но его можно увеличить до 2 лет.

**Метрики на основе журналов Application Insights.** 
- В фоновом режиме [метрики на основе журналов](../app/pre-aggregated-metrics-log-metrics.md) преобразовываются в запросы журналов. Период хранения для них соответствует периоду хранения событий в базовых журналах. Для ресурсов Application Insights журналы хранятся в течение 90 дней.


> [!NOTE]
> Вы можете [отправить метрики платформы для ресурсов Azure Monitor в рабочую область Log Analytics](../platform/resource-logs.md#send-to-azure-storage) для анализа долгосрочных тенденций.





## <a name="next-steps"></a>Дальнейшие действия

- Дополнительные сведения о [платформе данных Azure Monitor](../platform/data-platform.md).
- Дополнительные сведения о [данных журналов в Azure Monitor](../platform/data-platform-logs.md).
- Узнайте о [доступных данных мониторинга](../agents/data-sources.md) для различных источников в Azure.

