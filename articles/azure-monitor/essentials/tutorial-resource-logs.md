---
title: Сбор журналов ресурсов из ресурса Azure и их анализ в Azure Monitor
description: Узнайте, как настроить параметры диагностики для сбора журналов ресурсов из ресурса Azure в рабочую область Log Analytics для их анализа с помощью запросов к журналу.
ms.subservice: ''
ms.topic: tutorial
author: bwren
ms.author: bwren
ms.date: 12/15/2019
ms.openlocfilehash: 88138cc1366dcef68aeccf652af05704e72c8e15
ms.sourcegitcommit: e559daa1f7115d703bfa1b87da1cf267bf6ae9e8
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/17/2021
ms.locfileid: "100598035"
---
# <a name="tutorial-collect-and-analyze-resource-logs-from-an-azure-resource"></a>Руководство по Сбор и анализ журналов ресурсов из ресурса Azure

Журналы ресурсов содержат подробные сведения о работе ресурса в Azure. Их удобно использовать для мониторинга работоспособности и доступности ресурсов. Ресурсы Azure создают журналы ресурсов автоматически, но расположение для их сбора вам нужно настроить отдельно. В этом руководстве описано, как создать параметр диагностики для сбора журналов определенного ресурса в подписке Azure и их анализа с помощью запросов к журналам.

В этом руководстве описано следующее:

> [!div class="checklist"]
> * Создание рабочей области Log Analytics в Azure Monitor.
> * Создание параметра диагностики для сбора журналов ресурсов. 
> * Создание простого запроса к журналам для анализа журналов.


## <a name="prerequisites"></a>Предварительные требования

Для работы с этим руководством вам потребуется отслеживаемый ресурс Azure. Вы можете использовать любой ресурс в подписке Azure, который поддерживает параметры диагностики. Чтобы определить, поддерживает ли ресурс параметры диагностики, перейдите в меню этого ресурса на портале Azure и убедитесь, что в разделе **Мониторинг** присутствует элемент **Параметры диагностики**.


## <a name="log-in-to-azure"></a>Вход в Azure
Войдите на портал Azure по адресу [https://portal.azure.com](https://portal.azure.com).


## <a name="create-a-workspace"></a>Создание рабочей области
Рабочая область Log Analytics в Azure Monitor собирает и индексирует данные журналов из разных источников, а также позволяет выполнять расширенный анализ с помощью мощного языка запросов. Рабочая область Log Analytics должна существовать до того, как вы создадите параметр диагностики для отправки. Вы можете использовать существующую рабочую область в подписке Azure или создать новую с помощью следующей процедуры. 

> [!NOTE]
> Хотя работать с данными в рабочих областях Log Analytics можно с помощью меню **Azure Monitor**, создавать рабочие области и управлять ими вы будете в меню **Рабочие области Log Analytics**.

1. В разделе **Все службы** выберите **Рабочие области Log Analytics**.
2. Щелкните **Добавить** в верхней части экрана и укажите для рабочей области следующие сведения.
   - **Рабочая область Log Analytics**. Введите имя новой рабочей области. Это имя должно быть уникальным среди всех подписок Azure Monitor.
   - **Подписка**: Выберите подписку, в которой будет сохранена рабочая область. Не обязательно выбирать ту же подписку, в которой находится отслеживаемый ресурс.
   - **Группа ресурсов**. Выберите существующую группу ресурсов или щелкните **Создать**, чтобы создать новую. Не обязательно выбирать ту же группу ресурсов, в которой находится отслеживаемый ресурс.
   - **Расположение.** Выберите регион Azure или создайте новый. Не обязательно выбирать тот же регион, в которой находится отслеживаемый ресурс.
   - **Ценовая категория**. Выберите в качестве ценовой категории вариант *с оплатой по мере использования*. Ценовую категорию можно изменить позднее. Щелкните ссылку **Цены на Log Analytics**, чтобы узнать больше о ценовых категориях.

    ![Новая рабочая область](media/tutorial-resource-logs/new-workspace.png)

3. Щелкните **ОК**, чтобы создать рабочую область.

## <a name="create-a-diagnostic-setting"></a>Создание параметра диагностики
[Параметры диагностики](../essentials/diagnostic-settings.md) определяют, куда будут отправляться журналы ресурсов для определенного ресурса. Один параметр диагностики может определять несколько [назначений](../essentials/diagnostic-settings.md#destinations), но в этом руководстве мы будем использовать только рабочую область Log Analytics.

1. В меню параметров ресурса в разделе **Мониторинг** щелкните **Параметры диагностики**.
2. Отобразится сообщение "Параметры диагностики не определены". Щелкните **Добавить параметр диагностики**.

    ![Параметры диагностики](media/tutorial-resource-logs/diagnostic-settings.png)

3. Каждый параметр диагностики состоит из трех основных частей.
 
   - **Name** (Имя). эти имя, которое ни на что влияет и которое должно быть просто понятным для вас.
   - **Назначения**: здесь указываются одно или несколько назначений для отправки журналов. Для всех служб Azure используется одинаковый набор из трех возможных назначений. Каждый параметр диагностики может определять одно или несколько назначений, но не более одного назначения каждого типа. 
   - **Категории:** это категории журналов, которые будут отправляться в каждое из назначений. Набор категорий будет разным для каждой службы Azure.

4. Щелкните **Отправить в рабочую область Log Analytics** и выберите только что созданную рабочую область.
5. Выберите категории для сбора журналов. Определение доступных категорий вы найдете в документации по каждой службе.

    ![Параметр диагностики](media/tutorial-resource-logs/diagnostic-setting.png)

6. Щелкните **Сохранить**, чтобы сохранить параметры диагностики.

    
 
 ## <a name="use-a-log-query-to-retrieve-logs"></a>Использование запроса к журналам для получения журналов
Данные из рабочей области Log Analytics извлекаются с помощью запросов к журналам, написанных на языке KQL. Аналитические платформы и решения в Azure Monitor будут предоставлять запросы к журналам для получения данных о конкретной службе, но вы можете работать с запросами к журналам и полученными результатами прямо в Log Analytics на портале Azure. 

1. В меню параметров ресурса в разделе **Мониторинг** щелкните **Журналы**.
2. Откроется область Log Analytics с пустым окном для запроса и ресурсом, указанным в качестве области действия. Все введенные здесь запросы будут возвращать только записи, связанные с этим ресурсом.

    > [!NOTE]
    > Если вы открыли раздел "Журналы" в меню Azure Monitor, в качестве области будет выбрана рабочая область Log Analytics. В этом случае запросы будут возвращать все записи из рабочей области.
   
    ![Снимок экрана: журналы для приложения логики, в котором отображается новый запрос с выделенным именем приложения логики.](media/tutorial-resource-logs/logs.png)

4. Служба, представленная в нашем примере, записывает журналы ресурсов в таблицу **AzureDiagnostics**, но другие службы могут сохранять данные в другие таблицы. См. сведения о таблицах, используемых разными службами Azure в описании [поддерживаемых служб, схем и категорий для журналов ресурсов Azure](../essentials/resource-logs-schema.md).

    > [!NOTE]
    > Несколько служб записывают журналы ресурсов в таблицу AzureDiagnostics. Если Log Analytics запускается из меню Azure Monitor, необходимо добавить инструкцию `where` со столбцом `ResourceProvider`, чтобы указать конкретную службу. При запуске Log Analytics из меню ресурса автоматически задается область действия и возвращаются записи только из этого ресурса, а значит этот столбец не требуется. Примеры запросов вы найдете в документации по службе.


5. Введите запрос и щелкните **Выполнить**, чтобы просмотреть результаты. 
6. См. сведения о том, как [начать работу с запросами журналов в Azure Monitor](../log-query/get-started-queries.md).

    ![Запрос журнала](media/tutorial-resource-logs/log-query-1.png)




## <a name="next-steps"></a>Дальнейшие действия
Итак, вы узнали о том, как собирать журналы ресурсов в рабочую область Log Analytics. Теперь вы можете перейти к руководству по написанию запросов к журналам для анализа этих данных.

> [!div class="nextstepaction"]
> [Начало работы с запросами к журналам Azure Monitor](../log-query/get-started-queries.md)
