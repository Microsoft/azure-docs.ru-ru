---
title: Расширенные возможности обозревателя метрик Azure
description: Дополнительные сведения о расширенном использовании обозревателя метрик Azure.
author: vgorbenko
services: azure-monitor
ms.topic: conceptual
ms.date: 01/22/2019
ms.author: vitalyg
ms.openlocfilehash: 444185dc41532bfa55c271e2f0027eb8b71de42f
ms.sourcegitcommit: edc7dc50c4f5550d9776a4c42167a872032a4151
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/30/2021
ms.locfileid: "105959923"
---
# <a name="advanced-features-of-the-azure-metrics-explorer"></a>Расширенные возможности обозревателя метрик Azure

> [!NOTE]
> В этой статье предполагается, что вы знакомы с основными функциями обозревателя метрик Azure в Azure Monitor. Если вы новый пользователь и хотите узнать, как впервые создать диаграмму метрики, см. статью [Начало работы с обозревателем метрик](./metrics-getting-started.md).

[Метрики](data-platform-metrics.md) в Azure Monitor — это ряд измеренных и подсчитанных значений, которые собираются и сохраняются в течение определенного времени. Метрики могут быть стандартными (так называемая "платформа") или настраиваемыми. 

Стандартные метрики предоставляются платформой Azure. Они демонстрируют работоспособность ресурсов Azure и статистику их потребления. 

## <a name="resource-scope-picker"></a>Средство выбора области ресурсов
Средство выбора области ресурсов позволяет просматривать метрики по одному или нескольким ресурсам. В следующих разделах объясняется, как использовать средство выбора области ресурсов. 

### <a name="select-a-single-resource"></a>Выбор одного ресурса
Выберите **Метрики** в меню **Azure Monitor** или в разделе **Мониторинг** в меню ресурса. Затем щелкните **Выбрать область**, чтобы открыть средство выбора области. 

Используйте средство выбора области, чтобы выбрать ресурсы, метрики которых требуется просмотреть. Область заполняется автоматически, если вы открыли обозреватель метрик Azure из меню ресурса. 

![На снимке экрана показано, как открыть средство выбора области ресурсов.](./media/metrics-charts/scope-picker.png)

У некоторых ресурсов одновременно можно просматривать только метрики одного ресурса. Эти ресурсы отображаются в меню **Типы ресурсов** в разделе **Все типы ресурсов**.

![На снимке экрана показан один ресурс.](./media/metrics-charts/single-resource-scope.png)

Выбрав ресурс, вы увидите все подписки и группы ресурсов, к которым он относится.

![На снимке экрана показаны доступные ресурсы.](./media/metrics-charts/available-single-resource.png)

> [!TIP]
> Если вы хотите одновременно просматривать метрики для нескольких ресурсов или просматривать метрики подписки или группы ресурсов, нажмите кнопку **Проголосовать**.

Если вас устраивает ваш выбор, нажмите кнопку **Применить**.

### <a name="view-metrics-across-multiple-resources"></a>Просмотр метрик по нескольким ресурсам
Некоторые типы ресурсов могут запрашивать метрики по нескольким ресурсам. Эти ресурсы должны находиться в одной и той же подписке и расположении. Найдите эти типы ресурсов в верхней части меню **Типы ресурсов**. 

Подробнее см. в статье [Выбор нескольких ресурсов](./metrics-dynamic-scope.md#select-multiple-resources).

![На снимке экрана показаны типы ресурсов для одновременного просмотра.](./media/metrics-charts/multi-resource-scope.png)

Если тип поддерживает просмотр нескольких ресурсов, можно запросить метрики для подписки или нескольких групп ресурсов. Подробнее см. в статье [Выбор группы ресурсов или подписки](./metrics-dynamic-scope.md#select-a-resource-group-or-subscription).

## <a name="multiple-metric-lines-and-charts"></a>Кривые и диаграммы с несколькими метриками

В обозревателе метрик Azure можно создавать диаграммы с несколькими кривыми метрик или отображать несколько диаграмм метрик одновременно. Эта функция позволяет:

- Сопоставлять связанные метрики в одном графе, чтобы увидеть, как одно значение связано с другим.
- Отображать рядом метрики, использующие различные единицы измерения.
- Визуально агрегировать и сравнивать метрики из нескольких ресурсов.

Например, предположим, что у вас есть пять учетных записей хранения и вы хотите понять, сколько места они занимают в целом. Можно создать (нормированную) диаграмму с областями, которая покажет отдельные значения и сумму всех значений в определенные моменты времени.

### <a name="multiple-metrics-on-the-same-chart"></a>Несколько метрик на одной диаграмме

Чтобы просмотреть несколько метрик на одной диаграмме, сначала [создайте новую диаграмму](./metrics-getting-started.md#create-your-first-metric-chart). Выберите **Добавить метрику**. Повторите этот шаг, чтобы добавить еще одну метрику к той же диаграмме.

> [!NOTE]
> Как правило, на диаграммах не должны вместе отображаться метрики, использующие различные единицы измерения. Например, старайтесь не объединять метрики, одна из которых использует миллисекунды, а другая — килобайты. Также старайтесь не совмещать метрики, у которых существенно различается масштаб. 
>
> В таких случаях рекомендуется использовать несколько диаграмм. В обозревателе метрик выберите **Добавить диаграмму**, чтобы создать новую диаграмму.

### <a name="multiple-charts"></a>Несколько диаграмм

Чтобы создать другую диаграмму с другой метрикой, выберите **Добавить диаграмму**.

Чтобы изменить порядок или удалить несколько диаграмм, откройте меню диаграммы, нажав кнопку с многоточием ( **...** ). Затем выберите **Переместить вверх**, **Переместить вниз** или **Удалить**.

## <a name="time-range-controls"></a>Элементы управления диапазоном времени

Вы можете изменять диапазон времени с помощью [панели выбора времени](metrics-getting-started.md#select-a-time-range), а также сдвигать и масштабировать его с помощью элементов управления в области диаграммы.
### <a name="pan"></a>Сдвиг

Для сдвига щелкайте стрелки влево и вправо на границе диаграммы.  Выбранный диапазон времени будет перемещаться назад и вперед на половину интервала времени диаграммы.  Например, если вы просматриваете последние 24 часа, щелчок стрелки влево приведет к смещению суточного диапазона времени на 12 часов назад.

Большинство метрик могут храниться в течение 93 дней, но при просмотре за раз выдаются сведения лишь за 30 дней.  Элементы управления сдвигом позволяют просмотреть метрики за последние 30 дней, а затем легко сдвинуться на 15 дней назад, чтобы просмотреть оставшуюся часть периода хранения.

![GIF с анимацией демонстрирует элементы управления сдвигом вправо и влево.](./media/metrics-charts/metrics-pan-controls.gif)

### <a name="zoom"></a>Масштабирование

Чтобы масштабировать раздел на диаграмме, щелкните его и перетащите указатель мыши.  При масштабировании диапазон времени диаграммы обновляется, чтобы охватить выделенный фрагмент, а интервал времени уменьшается, если для него задан параметр "Автоматически".  Новый диапазон времени будет применяться ко всем диаграммам в метриках.

![GIF с анимацией демонстрирует функцию масштабирования метрик.](./media/metrics-charts/metrics-zoom-control.gif)

## <a name="aggregation"></a>Агрегирование

При добавлении метрики в диаграмму обозреватель метрик автоматически применяет агрегирование по умолчанию. Умолчание имеет смысл применять в основных сценариях. Но вы можете использовать другое агрегирование, чтобы получить более подробные сведения о метрике. 

Перед использованием различных методов агрегирования на диаграмме необходимо понять, как их обрабатывает обозреватель метрик. Метрики — это ряд измерений (или “значений метрик”), полученных за определенный период времени. При построении диаграммы значения выбранной метрики агрегируются отдельно за конкретный *интервал времени*. 

Интервал времени можно установить с помощью [панели выбора времени](./metrics-getting-started.md#select-a-time-range)обозревателя метрик. Если интервал времени не задан явно, по умолчанию будет использоваться текущий диапазон времени. Если интервал времени установлен, значения метрик, полученные в каждом интервале времени, на диаграмме агрегируются, при этом каждому интервалу времени соответствует одна точка данных.

Например, предположим, что на диаграмме показана метрика *Время ответа сервера*. Диаграмма использует агрегирование по *среднему значению* для промежутка времени, равного *последним 24 часам*. В этом примере:

- Если степень детализации времени составляет 30 минут, диаграмма будет содержать 48 агрегированных точек данных. Это значит, что кривая в области построения диаграммы пройдет через 48 точек (24 часа, умноженные на 2 точки данных в час). Одна точка данных представляет собой *среднее значение* всех зарегистрированных показателей, характеризующих время ответа сервера на запрос и полученных в течение каждого из соответствующих 30-минутных периодов времени.
- Если переключить уровень детализации времени на 15 минут, вы получите 96 агрегированных точек данных.  То есть, 24 часа, умноженные на 4 точки данных в час.

Обозреватель метрик использует пять основных типов агрегирования: сумма, подсчет, а также минимальное, максимальное и среднее значение. Агрегирование типа *сумма* иногда называют *общим*. Для многих метрик обозреватель скрывает неподходящие типы агрегирования, которые нельзя использовать.

* **Сумма**: сумма всех значений, полученных в течение интервала агрегирования.

    ![На снимке экрана показан запрос на суммирование.](./media/metrics-charts/request-sum.png)

* **Подсчет**: количество измерений, полученных в течение интервала агрегирования. 
    
    Если полученная метрика всегда имеет значение 1, агрегирование подсчета равно суммарному агрегированию. Этот сценарий часто используется, когда метрика отслеживает количество различных событий, а каждое измерение представляет собой одно событие. Код выдает запись метрики каждый раз, когда поступает новый запрос.

    ![На снимке экрана показан запрос на подсчет.](./media/metrics-charts/request-count.png)

* **Среднее значение**: среднее значение метрик, полученных в течение интервала агрегирования.

    ![На снимке экрана показан запрос среднего значения.](./media/metrics-charts/request-avg.png)

* **Минимальное значение**: наименьшее значение, полученное в течение интервала агрегирования.

    ![На снимке экрана показан запрос минимального значения.](./media/metrics-charts/request-min.png)

* **Максимальное значение**: наибольшее значение, полученное в течение интервала агрегирования.

    ![На снимке экрана показан запрос максимального значения.](./media/metrics-charts/request-max.png)

## <a name="filters"></a>фильтры;

К диаграммам, метрики которых имеют измерения, можно применять фильтры. Например, представьте метрику "Подсчет проводок" с измерением "Тип отклика". Это измерение показывает тип отклика на транзакцию: успешная или неудачная. При фильтрации по этому измерению на диаграмме отображается кривая только для успешных (или только для неудачных) транзакций. 

### <a name="add-a-filter"></a>Добавление фильтра

1. Выберите команду **Добавить фильтр** над диаграммой.

2. Выберите измерение (свойство) для фильтрации.

   ![На снимке экрана показаны измерения (свойства), которые можно отфильтровать.](./media/metrics-charts/028.png)

3. Выберите оператор, который нужно применить к измерению (свойству). По умолчанию применяется оператор равенства (=).

   ![На снимке экрана показан оператор, который можно использовать с фильтром.](./media/metrics-charts/filter-operator.png)

4. Выберите значения измерения, к которым нужно применить фильтр при создании диаграммы (в этом примере показаны отфильтрованные успешные транзакции с хранилищем).

   ![На снимке экрана показаны отфильтрованные успешные транзакции с хранилищем.](./media/metrics-charts/029.png)

5. Выбрав значения фильтра, щелкните за пределами средства выбора фильтра, чтобы закрыть его. Теперь на диаграмме показано, сколько транзакций с хранилищем не удалось выполнить:

   ![На снимке экрана показано, сколько транзакций с хранилищем не удалось выполнить.](./media/metrics-charts/030.png)

6. Шаги 1–5 можно повторить, чтобы применить несколько фильтров к одной диаграмме.


## <a name="metric-splitting"></a>Разделение метрик

Метрики можно разделять по измерению, чтобы наглядно сравнить различные сегменты метрик. Разделение также помогает выявить пиковые сегменты измерения.

### <a name="apply-splitting"></a>Применение разделения

1. Щелкните команду **Применить разделение** над диаграммой.
 
   > [!NOTE]
   > Диаграммы с несколькими метриками не могут использовать функцию разделения. Кроме того, хотя к диаграмме можно применить несколько фильтров, в ней может быть только одно разделенное измерение.

2. Выберите измерение, по которому диаграмма будет делиться на сегменты.

   ![На снимке экрана показано измерение, выбранное для сегментирования диаграммы.](./media/metrics-charts/031.png)

   Теперь на диаграмме отображаются несколько кривых, по одной для каждого сегмента измерения.

   ![На снимке экрана показаны несколько строк, по одной для каждого сегмента измерения.](./media/metrics-charts/segment-dimension.png)
   
3. Выберите предельное число значений, отображаемых после разделения по выбранному измерению. Ограничение по умолчанию — 10, как показано на приведенной выше диаграмме. Диапазон ограничений: 1–50.
   
   ![На снимке экрана показан предел, ограничивающий число значений после разделения.](./media/metrics-charts/segment-dimension-limit.png)
   
4. Выберите порядок сортировки сегментов: по возрастанию или по убыванию. По умолчанию используется сортировка по убыванию.
   
   ![На снимке экрана показан порядок сортировки разделенных значений.](./media/metrics-charts/segment-dimension-sort.png)

5. Щелкните за пределами **селектора группирования**, чтобы закрыть его.
   

   > [!NOTE]
   > С помощью фильтрации и разделения одного измерения можно скрыть сегменты, которые не имеют значения для сценария, и облегчить анализ диаграмм.

## <a name="locking-the-range-of-the-y-axis"></a>Блокировка диапазона оси Y

Блокировка диапазона оси значений (Y) важна на диаграммах, которые показывают небольшие колебания больших значений. 

Например, снижение объема успешных запросов с 99,99 % до 99,5% может сигнализировать о значительном снижении качества обслуживания. Тем не менее будет трудно или даже невозможно заметить небольшое отклонение числового значения, если диаграмма использует параметры по умолчанию. В этом случае можно зафиксировать самую нижнюю границу диаграммы на уровне 99%, в результате чего небольшой спад будет более очевидным. 

Еще одним примером колебаний может служить объем доступной памяти. В этом сценарии технически значение никогда не будет равно 0. Но если зафиксировать диапазон на уровне более высокого значения, обнаружить уменьшение объема доступной памяти будет легче. 

Чтобы управлять диапазоном оси Y, откройте меню диаграммы ( **...** ) и выберите **Параметры диаграммы**, чтобы получить доступ к дополнительным параметрам диаграммы.

![На снимке экрана выделены выбранные параметры диаграммы.](./media/metrics-charts/033.png)

Измените значения в разделе **Диапазон оси Y** или выберите значение **Автоматически**, чтобы вернуться к значениям по умолчанию.
 
 ![На снимке экрана выделен раздел "Диапазон оси Y".](./media/metrics-charts/034.png)

> [!WARNING]
> Если необходимо заблокировать границы оси Y для диаграмм, которые отслеживают подсчеты или суммы за определенный период времени (с помощью агрегирования типа “сумма”, “подсчет”, “минимальное значение” или “максимальное значение”), обычно рекомендуется указать фиксированную степень детализации времени. В этом случае не следует полагаться на автоматические параметры, заданные по умолчанию. 
>
> Необходимо выбрать фиксированную степень детализации времени, так как значения диаграммы меняются при автоматическом изменении степени детализации, когда пользователь увеличивает или уменьшает размер окна браузера или разрешение экрана. В таких случаях изменение степени детализации времени влияет на внешний вид диаграммы, из-за чего сбивается текущий выбранный диапазон оси Y.

## <a name="line-colors"></a>Цвета линий

После настройки диаграммы ее линиям автоматически назначается заданный по умолчанию цвет из палитры. Эти цвета можно изменить.

Чтобы изменить цвет линии диаграммы, выберите цветную полосу в условных обозначениях, соответствующих диаграмме. Откроется диалоговое окно палитры. Используйте палитру для настройки цвета линии.

![На снимке экрана показано, как изменить цвет.](./media/metrics-charts/035.png)

При закреплении диаграммы на панели мониторинга настроенные цвета сохраняются. В следующем разделе показано, как закрепить диаграмму.

## <a name="pinning-to-dashboards"></a>Закрепление на панелях мониторинга 

После настройки вам может потребоваться добавить диаграмму на панель мониторинга. Если вы закрепите диаграмму на панели мониторинга, она будет доступна вашей команде. Вы также можете получать аналитические сведения, просмотрев их в контексте других данных телеметрии мониторинга.

Чтобы закрепить настроенную диаграмму на панели мониторинга, в правом верхнем углу диаграммы выберите **Закрепить на панели мониторинга**.

![На снимке экрана показано, как закрепить диаграмму на панели мониторинга.](./media/metrics-charts/036.png)

## <a name="alert-rules"></a>Правила оповещения

Чтобы создать правило генерации оповещений на основе метрик, можно использовать критерии визуализации. В новом правиле генерации оповещений будут указаны целевой ресурс, метрика, разделение и измерения фильтров для диаграммы. Эти параметры можно изменить с помощью панели создания правил генерации оповещений.

Чтобы начать работу, щелкните **Создать новое правило генерации оповещений**.

![На снимке экрана показана кнопка "Создать новое правило генерации оповещений", выделенная красным цветом.](./media/metrics-charts/042.png)

Откроется панель создания правила генерации оповещений. На ней вы увидите измерения метрик диаграммы. Поля в области предварительно заполнены, чтобы облегчить настройку правила.

![На снимке экрана показана панель создания правила.](./media/metrics-charts/041.png)

Подробнее см. в статье [Создание и просмотр оповещений метрик, а также управление ими](../alerts/alerts-metric.md).

## <a name="correlate-metrics-to-logs"></a>Сопоставление метрик с журналами
Чтобы помочь клиенту диагностировать основную причину аномалий на диаграмме метрик, мы создали журналы детализации. Журналы детализации позволяют клиентам сопоставлять пики на диаграмме метрик с журналами и запросами. 

Прежде чем говорить об использовании, предлагаем сначала ознакомиться с различными типами журналов и запросов. 

| Термин             | Определение  | 
|------------------|-------------|
| Журналы действий    | Предоставляет аналитические сведения об операциях с каждым ресурсом Azure в подписке, инициированных извне (плоскость управления), а также обновления событий Работоспособности служб. Журнала действий позволяет ответить на вопросы "что? кто? когда?", касающиеся любой операции записи (PUT, POST, DELETE) для ресурсов в вашей подписке. Для каждой подписки Azure существует один журнал действий.  |   
| Журнал диагностики   | Дает представление об операциях, которые были выполнены с ресурсом Azure (плоскость данных), например о получении секрета из Key Vault или о запросе к базе данных. Содержимое журналов ресурсов зависит от типа ресурса и конкретной службы Azure. **Примечание.** Должен предоставляться службой и включаться клиентом  | 
| Рекомендуемый журнал | Запросы на основе сценариев, которые клиент может использовать для исследования аномалий в обозревателе метрик.  |

Сейчас доступны журналы детализации для избранных поставщиков ресурсов. Полноценные журналы детализации имеют следующие поставщики ресурсов: 

* Application Insights 
* Автомасштабирование 
* Службы приложений  
* Память  

Ниже приведен пример такого журнала для поставщика ресурсов Application Insights.

![Пик ошибок в колонке метрик App Insights](./media/metrics-charts/drill-into-log-ai.png)

Чтобы диагностировать пик неудачных запросов, щелкните "Журналы детализации".

![На снимке экрана показан раскрывающийся список журналов детализации](./media/metrics-charts/drill-into-logs-dropdown.png)

Если щелкнуть пункт “Отказы”, вы увидите колонку настраиваемых отказов, которая содержит сведения о невыполненных операциях, типах основных исключений и зависимостях. 

![На снимке экрана показана колонка отказов App Insights](./media/metrics-charts/ai-failure-blade.png)

### <a name="common-problems-with-drill-into-logs"></a>Распространенные проблемы с журналами детализации

* Журналы и запросы отключены. Для просмотра рекомендуемых журналов и запросов необходимо указать маршрут к журналам диагностики в Log Analytics. Ознакомьтесь с [этим документом](./diagnostic-settings.md), чтобы узнать, как это сделать. 
* Предоставляются только журналы действий. Журналы детализации доступны только для избранных поставщиков ресурсов. По умолчанию предоставляются журналы действий. 

 
## <a name="troubleshooting"></a>Устранение неполадок

Если на диаграмме не отображаются данные, ознакомьтесь со следующими сведениями об устранении неполадок.

* Фильтры применяются ко всем диаграммам на панели. При фокусировке на диаграмме убедитесь, что не установлен фильтр, исключающий все данные из другой диаграммы.

* Чтобы задать разные фильтры для разных диаграмм, создайте диаграммы в разных колонках. Затем сохраните диаграммы в отдельных папках “Избранное”. При необходимости можно закрепить диаграммы на панели мониторинга, чтобы вы могли просматривать их вместе.

* При сегментировании диаграммы по свойству, которое не определяется метрикой, на диаграмме не отображается содержимое. Попробуйте очистить сегментацию (разбиение) или выберите другое свойство.

## <a name="next-steps"></a>Дальнейшие действия

Сведения о создании практически полезных панелей мониторинга с помощью метрик см. в разделе [Создание настраиваемых панелей мониторинга ключевых показателей эффективности](../app/tutorial-app-dashboards.md).