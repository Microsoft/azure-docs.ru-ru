---
title: Дополнительные возможности обозревателя метрик Azure
description: Дополнительные сведения о расширенном использовании обозревателя метрик Azure.
author: vgorbenko
services: azure-monitor
ms.topic: conceptual
ms.date: 01/22/2019
ms.author: vitalyg
ms.openlocfilehash: a8a4f84db140ca442371cb71886bebf9214d3e43
ms.sourcegitcommit: a8ff4f9f69332eef9c75093fd56a9aae2fe65122
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/24/2021
ms.locfileid: "105026544"
---
# <a name="advanced-features-of-the-azure-metrics-explorer"></a>Дополнительные возможности обозревателя метрик Azure

> [!NOTE]
> В этой статье предполагается, что вы знакомы с основными функциями функции обозревателя метрик Azure Azure Monitor. Если вы являетесь новым пользователем и хотите узнать, как создать свою первую диаграмму метрики, см. статью [Приступая к работе с обозревателем метрик](./metrics-getting-started.md).

В Azure Monitor [метрики](data-platform-metrics.md) представляют собой ряд измеренных значений и счетчиков, которые собираются и сохраняются с течением времени. Метрики могут быть стандартными (также называемыми "платформой") или настраиваемыми. 

Стандартные метрики предоставляются платформой Azure. Они соответствуют статистике работоспособности и использования ресурсов Azure. 

## <a name="resource-scope-picker"></a>Выбор области ресурсов
Средство выбора области ресурсов позволяет просматривать метрики по отдельным ресурсам и нескольким ресурсам. В следующих разделах объясняется, как использовать средство выбора области ресурсов. 

### <a name="select-a-single-resource"></a>Выберите один ресурс
Выберите **Метрики** в меню **Azure Monitor** или в разделе **Мониторинг** в меню ресурса. Затем выберите **выбрать область** , чтобы открыть средство выбора области. 

Используйте средство выбора области, чтобы выбрать ресурсы, метрики которых требуется просмотреть. Область должна быть заполнена, если вы открыли обозреватель метрик Azure из меню ресурса. 

![Снимок экрана, показывающий, как открыть средство выбора области ресурсов.](./media/metrics-charts/scope-picker.png)

Для некоторых ресурсов за один раз можно просматривать только метрики одного ресурса. В меню **типы ресурсов** эти ресурсы находятся в разделе **все типы ресурсов** .

![Снимок экрана, показывающий один ресурс.](./media/metrics-charts/single-resource-scope.png)

После выбора ресурса отображаются все подписки и группы ресурсов, содержащие этот ресурс.

![Снимок экрана, показывающий доступные ресурсы.](./media/metrics-charts/available-single-resource.png)

> [!TIP]
> Если вы хотите, чтобы возможность одновременно просматривать метрики для нескольких ресурсов, а также просматривать метрики в подписке или группе ресурсов, выберите параметр **проголосовать**.

Завершив выбор, нажмите кнопку **Применить**.

### <a name="view-metrics-across-multiple-resources"></a>Просмотр метрик по нескольким ресурсам
Некоторые типы ресурсов могут запрашивать метрики по нескольким ресурсам. Ресурсы должны находиться в одной и той же подписке и расположении. Найдите эти типы ресурсов в верхней части меню **типы ресурсов** . 

Дополнительные сведения см. в разделе [Выбор нескольких ресурсов](./metrics-dynamic-scope.md#select-multiple-resources).

![Снимок экрана, показывающий типы перекрестных ресурсов.](./media/metrics-charts/multi-resource-scope.png)

Для типов, совместимых с несколькими ресурсами, можно запросить метрики в подписке или нескольких группах ресурсов. Дополнительные сведения см. [в разделе Выбор группы ресурсов или подписки](./metrics-dynamic-scope.md#select-a-resource-group-or-subscription).

## <a name="multiple-metric-lines-and-charts"></a>Несколько линий и диаграмм метрик

В обозревателе метрик Azure можно создавать диаграммы, отображающие несколько линий метрик, или одновременно отображать несколько диаграмм метрик. Эта функция позволяет выполнять следующие задачи:

- Сопоставьте связанные метрики на том же графе, чтобы увидеть, как одно значение связано с другим.
- Отображение метрик, использующих различные единицы измерения, в близком близком отношении.
- Визуальное агрегирование и сравнение метрик из нескольких ресурсов.

Например, предположим, что у вас есть пять учетных записей хранения и вы хотите понять, сколько места они используются вместе. Можно создать диаграмму с областями с накоплением, отображающую отдельные значения и сумму всех значений в определенные моменты времени.

### <a name="multiple-metrics-on-the-same-chart"></a>Несколько метрик на одной диаграмме

Чтобы просмотреть несколько метрик на одной диаграмме, сначала [Создайте новую диаграмму](./metrics-getting-started.md#create-your-first-metric-chart). Затем выберите **Добавить метрику**. Повторите этот шаг, чтобы добавить еще одну метрику на той же диаграмме.

> [!NOTE]
> Как правило, диаграммы не должны смешивать метрики, использующие различные единицы измерения. Например, старайтесь не смешивать одну метрику, в которой используется миллисекунда, а другая — килобайты. Также Избегайте смешивания метрик, масштаб которых существенно различается. 
>
> В таких случаях рекомендуется использовать сразу несколько диаграмм. В обозревателе метрик выберите **Добавить диаграмму** , чтобы создать новую диаграмму.

### <a name="multiple-charts"></a>Несколько диаграмм

Чтобы создать другую диаграмму, использующую другую метрику, выберите **Добавить диаграмму**.

Чтобы изменить порядок или удалить несколько диаграмм, нажмите кнопку с многоточием (**...**), чтобы открыть меню диаграммы. Затем выберите **переместить вверх**, **Переместить вниз** или **Удалить**.

## <a name="aggregation"></a>Агрегирование

При добавлении метрики в диаграмму обозреватель метрик автоматически применяет агрегирование по умолчанию. Значение по умолчанию имеет смысл в основных сценариях. Но вы можете использовать другую статистическую обработку, чтобы получить более подробные сведения о метрике. 

Прежде чем использовать различные агрегаты на диаграмме, необходимо понять, как они обрабатываются обозревателем метрик. Метрики — это ряд измерений (или «значений метрик»), которые записываются за период времени. При построении диаграммы значения выбранной метрики обрабатываются отдельно по *времени*. 

Размер Грана времени выбирается с помощью [панели выбора времени](./metrics-getting-started.md#select-a-time-range)обозревателя метрик. Если вы не выберете явно этот промежуток времени, по умолчанию используется выбранный в данный момент диапазон времени. После определения Грана времени значения метрик, записанные во время каждого показателя времени, суммируются на диаграмме, по одной точке данных за определенный промежуток времени.

Например, предположим, что на диаграмме показана метрика *времени ответа сервера* . Он использует *Среднее* агрегирование за период времени за *последние 24 часа*. В этом примере:

- Если для интервала времени задано значение 30 минут, то диаграмма будет выводиться с 48 агрегированных точек данных. Это значит, что график подключается к 48 точкам в области построения диаграммы (24 часа x 2 точки данных в час). Каждая точка данных представляет собой *среднее значение* всех зарегистрированных значений времени ответа для запросов сервера, произошедших в течение каждого из соответствующих 30-минутных периодов времени.
- Если вы переключаете гранулярность времени на 15 минут, вы получаете 96 агрегированных точек данных.  То есть, вы получаете 24 часа по 4 точки данных в час.

Обозреватель метрик имеет пять базовых статистических типов статистической обработки: Sum, Count, min, Max и Average. Статистическое вычисление *сумм* иногда называют *общим* агрегатом. Для многих метрик обозреватель метрик скрывает несущественные агрегаты и не может использоваться.

* **Sum**: сумма всех значений, захваченных в течение интервала агрегирования.

    ![Снимок экрана запроса на суммирование.](./media/metrics-charts/request-sum.png)

* **Количество**: количество измерений, захваченных в течение интервала агрегирования. 
    
    Если метрика всегда захватывается со значением 1, статистическое вычисление количества равно сумме агрегата. Этот сценарий часто используется, когда метрика отслеживает количество различных событий, а каждое измерение представляет одно событие. Код создает запись метрики каждый раз, когда поступает новый запрос.

    ![Снимок экрана запроса на подсчет.](./media/metrics-charts/request-count.png)

* **Среднее**: среднее значение метрик, захваченное в течение интервала статистической обработки.

    ![Снимок экрана среднего запроса.](./media/metrics-charts/request-avg.png)

* **Min**: наименьшее значение, захваченное в течение интервала статистической обработки.

    ![Снимок экрана минимального запроса.](./media/metrics-charts/request-min.png)

* **Max**: наибольшее значение, захваченное в течение интервала статистической обработки.

    ![Снимок экрана максимального запроса.](./media/metrics-charts/request-max.png)

## <a name="filters"></a>фильтры;

К диаграммам, метрики которых имеют измерения, можно применять фильтры. Например, представьте метрику "число транзакций" с измерением "тип ответа". Это измерение указывает, успешно ли завершился ответ из транзакции. При фильтрации по этому измерению отображается линия диаграммы только для успешных (или только неудачных) транзакций. 

### <a name="add-a-filter"></a>Добавление фильтра

1. Над диаграммой нажмите кнопку **Добавить фильтр**.

2. Выберите измерение (свойство) для фильтрации.

   ![Снимок экрана, на котором показаны измерения (свойства), которые можно отфильтровать.](./media/metrics-charts/028.png)

3. Выберите оператор, который нужно применить к измерению (свойству). Оператор по умолчанию — = (Equals)

   ![Снимок экрана, на котором показан оператор, который можно использовать с фильтром.](./media/metrics-charts/filter-operator.png)

4. Выберите значения измерений, которые необходимо применить к фильтру при построении диаграммы (в этом примере показано, как фильтровать успешные транзакции в хранилище):

   ![Снимок экрана, на котором показаны успешные отфильтрованные транзакции хранилища.](./media/metrics-charts/029.png)

5. Выбрав значения фильтра, щелкните за пределами средства выбора фильтра, чтобы закрыть его. Теперь на диаграмме показано, сколько транзакций с хранилищем не удалось выполнить:

   ![Снимок экрана, показывающий, сколько транзакций в хранилище завершилось сбоем.](./media/metrics-charts/030.png)

6. Вы можете повторить шаги 1-5, чтобы применить несколько фильтров к одной диаграмме.


## <a name="metric-splitting"></a>Разделение метрик

Можно разделить метрику по измерению, чтобы визуализировать различные сегменты сравнения метрик. Разделение также может помочь определить внешние сегменты измерения.

### <a name="apply-splitting"></a>Применение разделения

1. Над диаграммой выберите **Применить разделение**.
 
   > [!NOTE]
   > Диаграммы с несколькими метриками не могут использовать функцию разбиения. Кроме того, несмотря на то, что диаграмма может иметь несколько фильтров, она может иметь только одно разделенное измерение.

2. Выберите измерение для сегментирования диаграммы:

   ![Снимок экрана, на котором показано выбранное измерение для сегментирования диаграммы.](./media/metrics-charts/031.png)

   Теперь на диаграмме показано несколько строк, по одной для каждого сегмента измерения:

   ![Снимок экрана, на котором показаны несколько линий, по одному для каждого сегмента измерения.](./media/metrics-charts/segment-dimension.png)
   
3. Выберите предельное число значений, отображаемых после разделения по выбранному измерению. Ограничение по умолчанию — 10, как показано на приведенной выше диаграмме. Диапазон ограничений — 1-50.
   
   ![Снимок экрана, на котором показан предел разбиения, ограничивающий число значений после разделения.](./media/metrics-charts/segment-dimension-limit.png)
   
4. Выберите порядок сортировки для сегментов: по возрастанию или по убыванию. По умолчанию выбрано по убыванию.
   
   ![Снимок экрана, показывающий порядок сортировки значений разделения.](./media/metrics-charts/segment-dimension-sort.png)

5. Щелкните за пределами **селектора группирования**, чтобы закрыть его.
   

   > [!NOTE]
   > Чтобы скрыть сегменты, которые не имеют значения для вашего сценария, и сделать диаграммы более удобными для чтения, используйте как фильтрацию, так и разбиение в одном измерении.

## <a name="locking-the-range-of-the-y-axis"></a>Блокировка диапазона оси y

Блокировка диапазона оси значений (y) важна на диаграммах, которые показывают небольшие колебания больших значений. 

Например, Удаление тома успешных запросов с 99,99 процента на 99,5% может привести к значительному снижению качества обслуживания. Но если вы используете параметры диаграммы по умолчанию, то, однако, зачисление небольшого числового значения было бы затруднительным или даже невозможным. В этом случае можно заблокировать наименьшую границу диаграммы до 99 процентов, чтобы сделать небольшое перетаскивание более очевидным. 

Другим примером является колебание доступной памяти. В этом сценарии значение будет технически не равно 0. Исправление диапазона до более высокого значения может значительно сократить объем доступной памяти. 

Чтобы управлять диапазоном оси y, откройте меню диаграммы (..**.**). Затем выберите **Параметры диаграммы** , чтобы получить доступ к дополнительным параметрам диаграммы.

![Снимок экрана, на котором выделены выбранные параметры диаграммы.](./media/metrics-charts/033.png)

Измените значения в разделе **Диапазон оси Y** или выберите значение **Авто** , чтобы вернуться к значениям по умолчанию.
 
 ![Снимок экрана, в котором выделяется раздел диапазона оси Y.](./media/metrics-charts/034.png)

> [!WARNING]
> Если необходимо заблокировать границы оси y для диаграмм, которые отправляют подсчеты или суммы за определенный период времени (с использованием функций Count, Sum, min или Max), обычно следует указать фиксированную гранулярность времени. В этом случае не следует полагаться на автоматические значения по умолчанию. 
>
> Вы выбираете фиксированную гранулярность времени, так как значения диаграммы изменяются при автоматическом изменении степени детализации после того, как пользователь изменяет размер окна браузера или меняет разрешение экрана. Полученное изменение гранулярности по времени влияет на внешний вид диаграммы, что приводит к недействительности выбранного диапазона оси y.

## <a name="line-colors"></a>Цвета линий

После настройки диаграмм линии диаграммы автоматически назначаются цветом из палитры по умолчанию. Эти цвета можно изменить.

Чтобы изменить цвет линии диаграммы, выберите цветную полосу в условных обозначениях, соответствующих диаграмме. Откроется диалоговое окно «Палитра цветов». Используйте палитру цветов для настройки цвета линии.

![Снимок экрана, показывающий, как изменить цвет.](./media/metrics-charts/035.png)

При закреплении диаграммы на панели мониторинга настроенные цвета сохраняются. В следующем разделе показано, как закрепить диаграмму.

## <a name="pinning-to-dashboards"></a>Закрепление на панелях мониторинга 

После настройки диаграммы может потребоваться добавить ее на панель мониторинга. Закрепление диаграммы на панели мониторинга позволяет сделать ее доступной для вашей команды. Вы также можете получить аналитические сведения, просмотрев их в контексте других данных телеметрии мониторинга.

Чтобы закрепить настроенную диаграмму на панели мониторинга, в правом верхнем углу диаграммы выберите **закрепить на панели мониторинга**.

![Снимок экрана, показывающий, как закрепить диаграмму на панели мониторинга.](./media/metrics-charts/036.png)

## <a name="alert-rules"></a>Правила оповещения

Чтобы создать правило генерации оповещений на основе метрик, можно использовать критерии визуализации. Новое правило генерации оповещений будет включать целевой ресурс диаграммы, метрику, разделение и измерения фильтра. Эти параметры можно изменить с помощью панели создания правил генерации оповещений.

Чтобы начать, выберите **новое правило генерации оповещений**.

![Снимок экрана, на котором отображается кнопка "новое правило генерации оповещений", выделенная красным цветом.](./media/metrics-charts/042.png)

Откроется панель создания правила генерации оповещений. На панели отобразятся измерения метрик диаграммы. Поля в области предварительно заполнены, чтобы помочь в настройке правила.

![Снимок экрана, показывающий панель создания правил.](./media/metrics-charts/041.png)

Дополнительные сведения см. в статье [Создание, просмотр и Управление оповещениями метрик](../alerts/alerts-metric.md).

## <a name="correlate-metrics-to-logs"></a>Сопоставление метрик с журналами
Чтобы помочь клиенту диагностировать основную причину аномалий на диаграмме метрик, мы создали подробные журналы. Журналы детализации позволяют клиентам сопоставлять пики на диаграмме метрик с журналами и запросами. 

Прежде чем углубляться в опыт, мы хотим сначала ознакомиться с различными типами журналов и запросов. 

| Термин             | Определение  | 
|------------------|-------------|
| Журналы действий    | Предоставляет подробные сведения об операциях с каждым ресурсом Azure в подписке извне (плоскость управления) в дополнение к обновлениям событий работоспособности службы. Используйте журнал действий, чтобы определить, кто и когда для любых операций записи (размещение, публикация, удаление), выполненных с ресурсами в вашей подписке. Для каждой подписки Azure существует один журнал действий.  |   
| Журнал диагностики   | Предоставьте сведения об операциях, которые выполнялись в ресурсе Azure (плоскость данных), например получение секрета из Key Vault или выполнение запроса к базе данных. Содержимое журналов ресурсов зависит от типа ресурса и конкретной службы Azure. **Примечание.** Должен предоставляться службой и включаться клиентом  | 
| Рекомендуемый журнал | Запросы на основе сценариев, которые клиент может использовать для исследования аномалий в их обозревателе метрик.  |

Сейчас доступны подробные журналы для выбора поставщиков ресурсов. Поставщики ресурсов, имеющие полную детализацию журналов, имеют следующие возможности. 

* Application Insights 
* Автомасштабирование 
* Службы приложений  
* Память  

Ниже приведен пример возможностей для поставщика ресурсов Application Insights.

![Пиковая ошибка в колонке метрик App Insights](./media/metrics-charts/drill-into-log-ai.png)

Чтобы диагностировать пик неудачных запросов, щелкните "перейти к журналам".

![Снимок экрана: раскрывающийся список подробных журналов](./media/metrics-charts/drill-into-logs-dropdown.png)

Если щелкнуть параметр "сбой", вы увидите колонку настраиваемого сбоя, которая содержит операции невыполненной операции, типы основных исключений и зависимости. 

![Снимок экрана: колонка ошибок App Insights](./media/metrics-charts/ai-failure-blade.png)

### <a name="common-problems-with-drill-into-logs"></a>Распространенные проблемы с журналами детализации

* Журналы и запросы отключены. для просмотра рекомендуемых журналов и запросов необходимо направить журналы диагностики в Log Analytics. Ознакомьтесь с [этим документом](./diagnostic-settings.md) , чтобы узнать, как это сделать. 
* Предоставляются только журналы действий. функция детализации журналов доступна только для поставщиков ресурсов SELECT. По умолчанию предоставляются журналы действий. 

 
## <a name="troubleshooting"></a>Устранение неполадок

Если на диаграмме не отображаются данные, ознакомьтесь со следующими сведениями об устранении неполадок:

* Фильтры применяются ко всем диаграммам на панели. При фокусе на диаграмме убедитесь, что не установлен фильтр, исключающий все данные из другой диаграммы.

* Чтобы задать различные фильтры на разных диаграммах, создайте диаграммы в разных колонках. Затем сохраните диаграммы в отдельном избранном. При необходимости можно закрепить диаграммы на панели мониторинга, чтобы их можно было видеть вместе.

* При сегментировании диаграммы по свойству, которое не определяется метрикой, на диаграмме не отображается содержимое. Попробуйте очистить сегментацию (разбиение) или выберите другое свойство.

## <a name="next-steps"></a>Следующие шаги

Сведения о создании панелей мониторинга с помощью метрик см. в разделе [Создание настраиваемых панелей мониторинга ключевых показателей эффективности](../app/tutorial-app-dashboards.md).