---
title: Запуск экспорта путем вызова команды $export в API Azure для FHIR
description: В этой статье описывается, как экспортировать данные FHIR с помощью $export
author: caitlinv39
ms.service: healthcare-apis
ms.subservice: fhir
ms.topic: reference
ms.date: 2/19/2021
ms.author: cavoeg
ms.openlocfilehash: 675030ac47cb26e817a9ef7ee51999f25020f292
ms.sourcegitcommit: c27a20b278f2ac758447418ea4c8c61e27927d6a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/03/2021
ms.locfileid: "101712708"
---
# <a name="how-to-export-fhir-data"></a>Экспорт данных FHIR


Функция полного экспорта позволяет экспортировать данные с сервера FHIR в соответствии со [спецификацией FHIR](https://hl7.org/fhir/uv/bulkdata/export/index.html). 

Перед использованием $export необходимо убедиться, что API Azure для FHIR настроен для использования. Сведения о настройке параметров экспорта и создании учетной записи хранения Azure см. на [странице Настройка экспорта данных](configure-export-data.md).

## <a name="using-export-command"></a>Использование команды $export

После настройки API Azure для FHIR для экспорта можно использовать команду $export, чтобы экспортировать данные из службы. Данные будут храниться в учетной записи хранения, указанной при настройке экспорта. Чтобы узнать, как вызвать команду $export на сервере FHIR, ознакомьтесь с документацией по [спецификации HL7 FHIR $Export](https://hl7.org/Fhir/uv/bulkdata/export/index.html). 

API Azure для FHIR поддерживает $export на следующих уровнях:
* [Система](https://hl7.org/Fhir/uv/bulkdata/export/index.html#endpoint---system-level-export): `GET https://<<FHIR service base URL>>/$export>>`
* [Пациент](https://hl7.org/Fhir/uv/bulkdata/export/index.html#endpoint---all-patients): `GET https://<<FHIR service base URL>>/Patient/$export>>`
* [Группа пациентов *](https://hl7.org/Fhir/uv/bulkdata/export/index.html#endpoint---group-of-patients) — API Azure для FHIR экспортирует все связанные ресурсы, но не экспортирует характеристики группы: `GET https://<<FHIR service base URL>>/Group/[ID]/$export>>`

При экспорте данных создается отдельный файл для каждого типа ресурсов. Чтобы убедиться, что экспортируемые файлы не станут слишком большими, мы создаем новый файл после того, как размер одного экспортируемого файла становится больше 64 МБ. В результате вы можете получить несколько файлов для каждого типа ресурса, который будет перечисляться (например, пациент-1. нджсон, пациент-2. нджсон). 


> [!Note] 
> `Patient/$export` и `Group/[ID]/$export` могут экспортировать дублирующиеся ресурсы, если ресурс находится в секции более чем одного ресурса или находится в нескольких группах.

Кроме того, проверка состояния экспорта через URL-адрес, возвращенный заголовком Location во время очереди, поддерживается вместе с отменой фактического задания экспорта.



## <a name="settings-and-parameters"></a>Параметры и параметры

### <a name="headers"></a>Заголовки
Для $export заданий необходимо задать два обязательных параметра заголовка. Значения определяются текущей [спецификацией $Export](https://hl7.org/Fhir/uv/bulkdata/export/index.html#headers).
* **Accept** -Application/fhir + JSON
* **Предпочитать** -ответить-Async

### <a name="query-parameters"></a>Параметры запроса
API Azure для FHIR поддерживает следующие параметры запроса. Все эти параметры являются необязательными:

|Параметр запроса        | Определяется спецификацией FHIR?    |  Описание|
|------------------------|---|------------|
| \_outputFormat | Да | В настоящее время поддерживает три значения для согласования со спецификацией FHIR: Application/FHIR + нджсон, Application/нджсон или просто нджсон. Все задания экспорта будут возвращены `ndjson` , а переданное значение не повлияет на поведение кода. |
| \_since | Да | Позволяет экспортировать только ресурсы, которые были изменены с момента указанного времени. |
| \_Тип | Да | Позволяет указать, какие типы ресурсов будут включаться. Например, \_ введите = пациент будет возвращать только ресурсы пациента|
| \_типефилтер | Да | Чтобы запросить детализированную фильтрацию, можно использовать \_ типефилтер вместе с \_ параметром типа. Значение параметра _typeFilter представляет собой разделенный запятыми список запросов FHIR, которые еще больше ограничивают результаты. |
| \_контейнера | Нет |  Указывает контейнер в настроенной учетной записи хранения, куда должны быть экспортированы данные. Если контейнер указан, данные будут экспортированы в этот контейнер в новой папке с именем. Если контейнер не указан, он будет экспортирован в новый контейнер с использованием метки времени и идентификатора задания. |

## <a name="secure-export-to-azure-storage"></a>Безопасный экспорт в службу хранилища Azure

API Azure для FHIR поддерживает операцию безопасного экспорта. Один из вариантов для запуска безопасного экспорта — предоставить доступ к учетной записи хранения Azure для конкретных IP-адресов, связанных с API Azure для FHIR. В зависимости от того, находится ли учетная запись хранения в том же или другом расположении из интерфейса API Azure для FHIR, конфигурации различаются.

### <a name="when-the-azure-storage-account-is-in-a-different-region"></a>Если учетная запись хранения Azure находится в другом регионе

Выберите колонку сети учетной записи хранения Azure на портале. 

   :::image type="content" source="media/export-data/storage-networking.png" alt-text="Параметры сети службы хранилища Azure." lightbox="media/export-data/storage-networking.png":::
   
Выберите "выбранные сети" и укажите IP-адрес в поле **диапазон адресов** в разделе Брандмауэр \| добавить диапазоны IP-адресов, чтобы разрешить доступ из Интернета или локальных сетей. IP-адрес можно найти в следующей таблице для региона Azure, в котором подготовлена служба API Azure для FHIR.

|**Регион Azure**         |**Общедоступный IP-адрес** |
|:----------------------|:-------------------|
| Восточная Австралия       | 20.53.44.80       |
| Центральная Канада       | 20.48.192.84      |
| Центральная часть США           | 52.182.208.31     |
| Восточная часть США              | 20.62.128.148     |
| восточная часть США 2            | 20.49.102.228     |
| Восточная часть США 2 (EUAP)       | 20.39.26.254      |
| Северная Германия        | 51.116.51.33      |
| Центрально-Западная Германия | 51.116.146.216    |
| Japan East           | 20.191.160.26     |
| Республика Корея, центральный регион        | 20.41.69.51       |
| Центрально-северная часть США     | 20.49.114.188     |
| Северная Европа         | 52.146.131.52     |
| Северная часть ЮАР;   | 102.133.220.197   |
| Центрально-южная часть США     | 13.73.254.220     |
| Юго-Восточная Азия       | 23.98.108.42      |
| Северная Швейцария    | 51.107.60.95      |
| южная часть Соединенного Королевства             | 51.104.30.170     |
| западная часть Соединенного Королевства              | 51.137.164.94     |
| центрально-западная часть США      | 52.150.156.44     |
| Западная Европа          | 20.61.98.66       |
| Западная часть США 2            | 40.64.135.77      |

### <a name="when-the-azure-storage-account-is-in-the-same-region"></a>Если учетная запись хранения Azure находится в том же регионе

Процесс настройки аналогичен указанному выше, за исключением определенного диапазона IP-адресов в формате CIDR, вместо этого используется 100.64.0.0/10. Причина, по которой диапазон IP-адресов, включающий 100.64.0.0 – 100.127.255.255, должен быть указан, так как фактический IP-адрес, используемый службой, изменяется, но будет находиться в пределах диапазона для каждого $export запроса.

> [!Note] 
> Возможно, вместо этого может использоваться частный IP-адрес в диапазоне 10.0.2.0/24. В этом случае операция $export не будет выполнена. Можно повторить запрос $export, но не гарантируется, что IP-адрес в диапазоне 100.64.0.0/10 будет использоваться в следующий раз. Это известное поведение сети по проектированию. Альтернативой является настройка учетной записи хранения в другом регионе.
    
## <a name="next-steps"></a>Дальнейшие действия

Из этой статьи вы узнали, как экспортировать ресурсы FHIR с помощью команды $export. Далее вы узнаете, как экспортировать неидентифицированные данные:
 
>[!div class="nextstepaction"]
>[Экспорт неидентифицированных данных](de-identified-export.md)
