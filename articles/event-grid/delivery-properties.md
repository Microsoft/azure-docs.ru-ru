---
title: Сетка событий Azure — Установка пользовательских заголовков для доставленных событий
description: Описывает, как можно задать пользовательские заголовки (или свойства доставки) для доставленных событий.
ms.topic: conceptual
ms.date: 03/24/2021
ms.openlocfilehash: e2eff6b0d1dc78f0d558bb8e4e1ad79c62c52657
ms.sourcegitcommit: a9ce1da049c019c86063acf442bb13f5a0dde213
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/27/2021
ms.locfileid: "105630528"
---
# <a name="delivery-with-custom-headers"></a>Доставка с пользовательскими заголовками
Подписки на события позволяют настроить заголовки HTTP, которые включены в доставленные события. Эта возможность позволяет задавать пользовательские заголовки, необходимые для назначения. При создании подписки на события можно задать до 10 заголовков. Значение заголовка не должно превышать 4 096 (4 КБ) байт.

Можно задать пользовательские заголовки для событий, которые доставляются в следующие места назначения:

- Веб-перехватчики
- Разделы и очереди служебной шины Azure
- Центры событий Azure
- гибридные подключения ретранслятора

При создании подписки на события в портал Azure можно использовать вкладку **Свойства доставки** для установки настраиваемых заголовков HTTP. Эта страница позволяет задать значения фиксированного и динамического заголовка.

## <a name="setting-static-header-values"></a>Задание значений статического заголовка
Чтобы задать для заголовков фиксированное значение, укажите имя заголовка и его значение в соответствующих полях:

:::image type="content" source="./media/delivery-properties/static-header-property.png" alt-text="Свойства доставки — статический":::

Возможно, вы хотите, чтобы проверка **была секретной?** при предоставлении конфиденциальных данных. Конфиденциальные данные не будут отображаться на портал Azure. 

## <a name="setting-dynamic-header-values"></a>Установка динамических значений заголовка
Можно задать значение заголовка на основе свойства во входящем событии. Используйте синтаксис JsonPath для ссылки на значение свойства входящего события, которое будет использоваться как значение заголовка в исходящих запросах. Например, чтобы задать значение заголовка с именем **Channel** , используя значение **системы** свойств входящих событий в данных события, настройте подписку на события следующим образом:

:::image type="content" source="./media/delivery-properties/dynamic-header-property.png" alt-text="Свойства доставки — динамические":::

## <a name="examples"></a>Примеры
В этом разделе приводится несколько примеров использования свойств доставки.

### <a name="setting-the-authorization-header-with-a-bearer-token-non-normative-example"></a>Настройка заголовка авторизации с помощью токена носителя (ненормативный пример)

Задайте значение для заголовка авторизации, чтобы определить запрос к обработчику веб-перехватчика. Если вы не [защищаете веб-перехватчик с помощью Azure Active Directory](secure-webhook-delivery.md), можно задать заголовок авторизации.

| Имя заголовка   | Тип заголовка | Значение заголовка |
| :--           | :--         | :--            |
|`Authorization` | Статические | `BEARER SlAV32hkKG...`|

Исходящие запросы теперь должны содержать заголовок, заданный для подписки на события:

```console
GET /home.html HTTP/1.1

Host: acme.com

User-Agent: <user-agent goes here>

Authorization: BEARER SlAV32hkKG...
```

> [!NOTE]
> Определение заголовков авторизации является разумным вариантом, если назначением является веб-перехватчик. Его не следует использовать для [функций, подписанных с помощью идентификатора ресурса](/rest/api/eventgrid/eventsubscriptions/createorupdate#azurefunctioneventsubscriptiondestination), служебной шины, концентраторов событий и гибридные подключения, так как эти места назначения поддерживают собственные схемы проверки подлинности при использовании службы "Сетка событий".

### <a name="service-bus-example"></a>Пример служебной шины
Служебная шина Azure поддерживает использование [HTTP-заголовка брокерпропертиес](/rest/api/servicebus/message-headers-and-properties#message-headers) для определения свойств сообщения при отправке отдельных сообщений. Значение `BrokerProperties` заголовка должно быть указано в формате JSON. Например, если необходимо задать свойства сообщения при отправке одного сообщения в служебную шину, задайте заголовок следующим образом:

| Имя заголовка | Тип заголовка | Значение заголовка |
| :-- | :-- | :-- |
|`BrokerProperties` | Статические     | `BrokerProperties:  { "MessageId": "{701332E1-B37B-4D29-AA0A-E367906C206E}", "TimeToLive" : 90}` |


### <a name="event-hubs-example"></a>Пример концентраторов событий

Если необходимо опубликовать события в определенной секции в концентраторе событий, определите [заголовок HTTP брокерпропертиес](/rest/api/eventhub/event-hubs-runtime-rest#common-headers) в подписке на события, чтобы указать ключ секции, определяющий целевой раздел концентратора событий.

| Имя заголовка | Тип заголовка | Значение заголовка                                  |
| :-- | :-- | :-- |
|`BrokerProperties` | Статические | `BrokerProperties: {"PartitionKey": "0000000000-0000-0000-0000-000000000000000"}`  |


### <a name="configure-time-to-live-on-outgoing-events-to-azure-storage-queues"></a>Настройка срока жизни исходящих событий в очередях службы хранилища Azure
Для назначения очереди службы хранилища Azure можно настроить только время ожидания исходящего сообщения после его доставки в очередь службы хранилища Azure. Если время не указано, срок жизни сообщения по умолчанию составляет 7 дней. Можно также задать бессрочный срок действия события.

:::image type="content" source="./media/delivery-properties/delivery-properties-storage-queue.png" alt-text="Свойства доставки — очередь хранилища":::

## <a name="next-steps"></a>Дальнейшие шаги
Дополнительные сведения о доставке событий см. в следующей статье:

- [Доставка и повторные попытки доставки](delivery-and-retry.md)
- [Доставка событий веб-перехватчика](webhook-event-delivery.md)
- [Фильтрация событий](event-filtering.md)
