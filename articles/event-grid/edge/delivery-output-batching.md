---
title: Пакетная обработка выходных данных в службе "Сетка событий Azure" IoT Edge | Документация Майкрософт
description: Пакетная обработка в сетке событий IoT Edge.
author: HiteshMadan
manager: rajarv
ms.author: himad
ms.reviewer: spelluru
ms.date: 07/08/2020
ms.topic: article
ms.openlocfilehash: 0ae2261f8278c4d5e1944b01a9731afd293df20b
ms.sourcegitcommit: 772eb9c6684dd4864e0ba507945a83e48b8c16f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "86171641"
---
# <a name="output-batching"></a>Пакетная обработка выходных данных

Сетка событий поддерживает доставку более одного события в одном запросе доставки. Эта функция позволяет увеличить общую пропускную способность доставки, не обращаясь к переголовкам HTTP по запросам. Пакетная обработка по умолчанию отключена и может быть включена для каждой подписки.

> [!WARNING]
> Максимально допустимая продолжительность обработки каждого запроса на доставку не меняется, даже если код подписчика потенциально должен выполнять дополнительные действия в пакетном запросе. Время ожидания доставки по умолчанию — 60 секунд.

## <a name="batching-policy"></a>Политика пакетной обработки

Поведение пакетирования в сетке событий можно настроить для каждого подписчика, настройкой следующих двух параметров:

* Максимальное число событий в пакете

  Этот параметр задает верхний предел числа событий, которые могут быть добавлены в пакетный запрос на доставку.

* Предпочтительный размер пакета в килобайтах

  Эта ручка используется для дальнейшего управления максимальным числом килобайт, которое может быть отправлено по запросу на доставку.

## <a name="batching-behavior"></a>Поведение пакетной обработки

* Все или нет

  Сетка событий работает с семантикой ALL-или None. Она не поддерживает частичное выполнение пакетной доставки. Подписчики должны быть внимательны, чтобы запрашивать столько событий на пакет, которое может потребовать обработки в течение 60 секунд.

* Оптимистическая пакетирование

  Параметры политики пакетной обработки не имеют ограничений в отношении поведения пакетной обработки, и их следует учитывать в большинстве усилий. При низкой частоте событий вы часто Следите за тем, чтобы размер пакета был меньше запрошенного максимального количества событий на пакет.

* Значение по умолчанию — OFF

  По умолчанию сетка событий добавляет только одно событие в каждый запрос доставки. Чтобы включить пакетную обработку, установите либо один из параметров, упомянутых ранее в статье в формате JSON подписки на события.

* Значения по умолчанию

  При создании подписки на события не нужно указывать оба параметра (максимальное количество событий на пакет и приблизительный размер пакета в килобайтах байт). Если задан только один параметр, сетка событий использует значения по умолчанию (настраиваемые). В следующих разделах приведены значения по умолчанию и способы их переопределения.

## <a name="turn-on-output-batching"></a>Включение пакетной обработки данных

```json
{
    "properties":
    {
        "destination":
        {
            "endpointType": "WebHook",
            "properties":
             {
                "endpointUrl": "<your_webhook_url>",
                "maxEventsPerBatch": 10,
                "preferredBatchSizeInKilobytes": 64
             }
        },
    }
}
```

## <a name="configuring-maximum-allowed-values"></a>Настройка максимального числа допустимых значений

Следующие параметры времени развертывания контролируют максимальное значение, допустимое при создании подписки на события.

| Имя свойства | Описание |
| ------------- | ----------- | 
| `api__deliveryPolicyLimits__maxpreferredBatchSizeInKilobytes` | Максимальное значение, допустимое для `PreferredBatchSizeInKilobytes` регулятора. По умолчанию `1033` .
| `api__deliveryPolicyLimits__maxEventsPerBatch` | Максимальное значение, допустимое для `MaxEventsPerBatch` регулятора. По умолчанию `50` .

## <a name="configuring-runtime-default-values"></a>Настройка значений времени выполнения по умолчанию

Следующие параметры времени развертывания управляют значением времени выполнения по умолчанию для каждого регулятора, если он не указан в подписке на события. Для выполнения итерации необходимо установить по крайней мере один регулятор для подписки на события, чтобы включить пакетную обработку.

| Имя свойства | Описание |
| ------------- | ----------- |
| `broker__defaultMaxBatchSizeInBytes` | Максимальный размер запроса на доставку `MaxEventsPerBatch` , если указан только. По умолчанию `1_058_576` .
| `broker__defaultMaxEventsPerBatch` | Максимальное число событий, добавляемых в пакет, если `MaxBatchSizeInBytes` указано только значение. По умолчанию `10` .
