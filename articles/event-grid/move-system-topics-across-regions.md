---
title: Перемещение разделов системы службы "Сетка событий Azure" в другой регион
description: В этой статье показано, как переместить разделы системы "Сетка событий Azure" из одного региона в другой.
ms.topic: how-to
ms.custom: subject-moving-resources
ms.date: 08/28/2020
ms.openlocfilehash: eb6029b206e7d47789371ee81e75c4e05c69ee65
ms.sourcegitcommit: 772eb9c6684dd4864e0ba507945a83e48b8c16f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "89086188"
---
# <a name="move-azure-event-grid-system-topics-to-another-region"></a>Перемещение разделов системы службы "Сетка событий Azure" в другой регион
Вам может потребоваться переместить ресурсы в другой регион по ряду причин. Например, чтобы воспользоваться преимуществами нового региона Azure, чтобы удовлетворить внутренние требования к политике и управлению, а также в ответ на требования к планированию емкости. 

Ниже приведены общие действия, описанные в этой статье. 

- **Экспортируйте группу ресурсов** , содержащую учетную запись хранения Azure и связанный с ней системный раздел, в шаблон диспетчер ресурсов. Кроме того, шаблон можно экспортировать только для системного раздела. Если вы перейдете по этому маршруту, не забудьте переместить источник событий Azure (в этом примере — учетную запись хранения Azure) в другой регион, прежде чем перемещать системный раздел. Затем в разделе экспортированного шаблона для системы обновите внешний идентификатор учетной записи хранения в целевом регионе. 
- **Измените шаблон** , добавив `endpointUrl` свойство для указания веб-перехватчика, который подписывается на системный раздел. При экспорте системного раздела его подписка (в данном случае это веб-перехватчик) также экспортируется в шаблон, но `endpointUrl` свойство не включается. Поэтому необходимо обновить его, чтобы он указывал на конечную точку, подписанную на раздел. Кроме того, измените значение `location` Свойства на новое расположение или регион. Для других типов обработчиков событий необходимо обновить только расположение. 
- **Используйте шаблон для развертывания ресурсов** в целевом регионе. Вы укажете имена учетной записи хранения и системного раздела, который будет создан в целевом регионе. 
- **Проверка развертывания**. Убедитесь, что веб-перехватчик вызывается при отправке файла в хранилище BLOB-объектов в целевом регионе. 
- Чтобы **завершить перемещение**, удалите ресурсы (источник события и системный раздел) из исходного региона. 

## <a name="prerequisites"></a>Предварительные требования
- Выполните инструкции из [краткого руководства: маршрутизация событий хранилища BLOB-объектов в веб конечную точку с портал Azure](blob-event-quickstart-portal.md) в исходном регионе. Этот шаг **не является обязательным**. Протестируйте шаги, описанные в этой статье. Учетная запись хранения хранится в отдельной группе ресурсов из службы приложений и плана службы приложений. 
- Убедитесь, что служба "Сетка событий" доступна в целевом регионе. См. страницу [Доступность продуктов по регионам](https://azure.microsoft.com/global-infrastructure/services/?products=event-grid&regions=all).

## <a name="prepare"></a>Подготовка
Чтобы приступить к работе, экспортируйте шаблон диспетчер ресурсов для группы ресурсов, содержащей источник системных событий (учетная запись хранения Azure), и соответствующий системный раздел. 

1. Войдите на [портал Azure](https://portal.azure.com).
1. В меню слева выберите **группы ресурсов** . Затем выберите группу ресурсов, содержащую источник событий, для которого был создан системный раздел. В следующем примере это учетная запись **хранения Azure** . Группа ресурсов содержит учетную запись хранения и связанную с ней системную тему. 

    :::image type="content" source="./media/move-system-topics-across-regions/resource-group-page.png" alt-text="Страница &quot;Группа ресурсов&quot;":::        
3. В меню слева выберите **Экспорт шаблона** в разделе **Параметры**, а затем на панели инструментов выберите **скачать** . 

    :::image type="content" source="./media/move-system-topics-across-regions/export-template-menu.png" alt-text="Страница &quot;Экспорт шаблона&quot; учетной записи размер хранилища":::        
5. Выберите **ZIP** -файл, скачанный с портала, и распакуйте его в выбранную папку. Этот ZIP-файл содержит шаблонные и параметры JSON-файлы. 
1. Откройте **template.js** в любом редакторе по своему усмотрению. 
1. URL веб-перехватчика не экспортируется в шаблон. Поэтому выполните следующие действия.
    1. В файле шаблона найдите **веб-перехватчик**. 
    1. В разделе **Properties (свойства** ) добавьте символ запятой ( `,` ) в конце последней строки. В нашем примере он выглядит следующим образом: `"preferredBatchSizeInKilobytes": 64`. 
    1. Добавьте `endpointUrl` свойство со значением, заданным для URL-адреса веб перехватчика, как показано в следующем примере. 

        ```json
        "destination": {
            "properties": {
                "maxEventsPerBatch": 1,
                "preferredBatchSizeInKilobytes": 64,
                "endpointUrl": "https://mysite.azurewebsites.net/api/updates"
            },
            "endpointType": "WebHook"
        }
        ```

        > [!NOTE]
        > Для других типов обработчиков событий все свойства экспортируются в шаблон. Необходимо только обновить `location` свойство до целевой области, как показано на следующем шаге. 
7. Обновите `location` ресурс **учетной записи хранения** до целевого региона или расположения. Чтобы получить коды расположения, см. раздел [расположения Azure](https://azure.microsoft.com/global-infrastructure/locations/). Код для региона — это имя региона без пробелов, например, `West US` равно `westus` .

    ```json
    "type": "Microsoft.Storage/storageAccounts",
    "apiVersion": "2019-06-01",
    "name": "[parameters('storageAccounts_spegridstorage080420_name')]",
    "location": "westus",
    ```
8. Повторите шаг, чтобы обновить `location` ресурс **раздела System** в шаблоне. 

    ```json
    "type": "Microsoft.EventGrid/systemTopics",
    "apiVersion": "2020-04-01-preview",
    "name": "[parameters('systemTopics_spegridsystopic080420_name')]",
    "location": "westus",
    ```
1. **Сохраните** шаблон. 

## <a name="recreate"></a>Повторно создать 
Разверните шаблон, чтобы создать учетную запись хранения и системный раздел для учетной записи хранения в целевом регионе. 

1. На портале Azure выберите **Создать ресурс**.
2. В **поле Поиск в Marketplace** введите **шаблон развертывание** и нажмите клавишу **Ввод**.
3. Выберите **шаблоны развертывания**.
4. Нажмите кнопку **создания**.
5. Выберите **Создать собственный шаблон в редакторе**.
6. Выберите **загрузить файл** и следуйте инструкциям по загрузке **template.jsв** файл, скачанный в предыдущем разделе.
7. Нажмите кнопку **сохранить** , чтобы сохранить шаблон. 
8. На странице **Настраиваемое развертывание** выполните следующие действия. 
    1. Выберите **подписку** Azure. 
    1. Выберите существующую **группу ресурсов** в целевом регионе или создайте ее. 
    1. В поле **регион** выберите целевой регион. Если выбрана существующая группа ресурсов, этот параметр доступен только для чтения.
    1. В поле **имя системного раздела** введите имя системного раздела, который будет связан с учетной записью хранения.  
    1. В поле **имя учетной записи хранения** введите имя учетной записи хранения, которая будет создана в целевом регионе. 

        :::image type="content" source="./media/move-system-topics-across-regions/deploy-template.png" alt-text="Развертывание шаблона диспетчер ресурсов":::
    5. В нижней части страницы выберите **Review + create** (Проверить и создать). 
    1. На странице **Проверка и создание** проверьте параметры и нажмите кнопку **создать**. 

## <a name="verify"></a>Проверка
1. После завершения развертывания выберите команду Перейти к **группе ресурсов**. 
1. На странице **Группа ресурсов** убедитесь, что источник событий (в этом примере, учетная запись хранения Azure) и системный раздел созданы. 
1. Отправьте файл в контейнер в хранилище BLOB-объектов Azure и убедитесь, что веб-перехватчик получил событие. Дополнительные сведения см. в статье [Отправка события в конечную точку](blob-event-quickstart-portal.md#send-an-event-to-your-endpoint).

## <a name="discard-or-clean-up"></a>Отмена или очистка
Чтобы завершить перемещение, удалите группу ресурсов, содержащую учетную запись хранения, и связанную с ней системную тему в исходном регионе.  

Если вы хотите начать заново, удалите группу ресурсов в целевом регионе и повторите действия, описанные в разделах [Подготовка](#prepare) и [Повторное создание](#recreate) этой статьи.

Чтобы удалить группу ресурсов (исходную или целевую) с помощью портал Azure, выполните следующие действия.

1. В окне поиска в верхней части портал Azure введите **группы ресурсов** и выберите **группы ресурсов** из результатов поиска. 
2. Выберите группу ресурсов для удаления и щелкните **Удалить** на панели инструментов. 

    Удаление группы ресурсов
3. На странице Подтверждение введите имя группы ресурсов и выберите **Удалить**.  

## <a name="next-steps"></a>Дальнейшие действия
Вы узнали, как переместить источник событий Azure и связанный с ним системный раздел из одного региона в другой. Сведения о перемещении пользовательских разделов, доменов и пространств имен партнеров в регионах см. в следующих статьях.

- [Перемещение пользовательских разделов по регионам](move-custom-topics-across-regions.md). 
- [Перемещение доменов между регионами](move-domains-across-regions.md). 
- [Перемещение пространств имен партнеров между регионами](move-partner-namespaces-across-regions.md). 

Дополнительные сведения о перемещении ресурсов между регионами и аварийным восстановлением в Azure см. в следующей статье: [Перемещение ресурсов в новую группу ресурсов или подписку](../azure-resource-manager/management/move-resource-group-and-subscription.md).
