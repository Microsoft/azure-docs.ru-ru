---
title: Добавление управляемого удостоверения в роль в назначении службы "Сетка событий Azure"
description: В этой статье описывается, как добавить управляемое удостоверение в роли Azure в таких местах назначения, как служебная шина Azure и концентраторы событий Azure.
ms.topic: how-to
ms.date: 03/25/2021
ms.openlocfilehash: 1bcef878c982122d80980dd7194fae2de6fc8762
ms.sourcegitcommit: a9ce1da049c019c86063acf442bb13f5a0dde213
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/27/2021
ms.locfileid: "105630457"
---
# <a name="add-an-identity-to-azure-roles-on-azure-event-grid-destinations"></a>Добавление удостоверения в роли Azure в назначениях сетки событий Azure
В этом разделе описывается, как добавить удостоверение для системного раздела, пользовательского раздела или домена в роль Azure. 

## <a name="prerequisites"></a>Предварительные условия
Назначьте управляемое системой удостоверение с помощью инструкций из следующих статей:

- [Пользовательские разделы или домены](enable-identity-custom-topics-domains.md)
- [Системные разделы](enable-identity-system-topics.md)

## <a name="supported-destinations-and-azure-roles"></a>Поддерживаемые назначения и роли Azure
После включения удостоверения для пользовательского раздела или домена сетки событий Azure автоматически создает удостоверение в Azure Active Directory. Добавьте это удостоверение в соответствующие роли Azure, чтобы пользовательский раздел или домен мог пересылать события в поддерживаемые места назначения. Например, добавьте удостоверение в роль **отправителя данных концентраторов событий Azure** для пространства имен концентраторов событий Azure, чтобы Пользовательская тема сетки событий могла пересылать события в концентраторы событий в этом пространстве имен. 

В настоящее время служба "Сетка событий Azure" поддерживает настраиваемые разделы или домены, для которых назначено управляемое системой удостоверение для перенаправления событий в следующие места назначения. Эта таблица также предоставляет роли, в которых должно быть удостоверение, чтобы Пользовательская тема могла переслать события.

| Назначение | Роль Azure | 
| ----------- | --------- | 
| Очереди и разделы служебной шины Azure | [Отправитель данных служебной шины Azure](../service-bus-messaging/authenticate-application.md#azure-built-in-roles-for-azure-service-bus) |
| Центры событий Azure | [Отправитель данных центров событий Azure](../event-hubs/authorize-access-azure-active-directory.md#azure-built-in-roles-for-azure-event-hubs) | 
| Хранилище BLOB-объектов Azure | [участник данных BLOB-объектов хранилища](../storage/common/storage-auth-aad-rbac-portal.md#azure-roles-for-blobs-and-queues); |
| Хранилище очередей Azure |[Отправитель сообщений данных в очередь хранилища](../storage/common/storage-auth-aad-rbac-portal.md#azure-roles-for-blobs-and-queues) | 


## <a name="use-the-azure-portal"></a>Использование портала Azure
С помощью портал Azure можно назначить для соответствующей роли пользовательский раздел или удостоверение домена, чтобы пользовательский раздел или домен мог пересылать события в назначение. 

В следующем примере показано, как добавить управляемое удостоверение для пользовательского раздела сетки событий с именем **мситесттопик** в роль **отправителя данных служебной шины Azure** для пространства имен служебной шины, содержащего ресурс очереди или раздела. При добавлении к роли на уровне пространства имен настраиваемый раздел "Сетка событий" может пересылать события во все сущности в пространстве имен. 

1. Перейдите к **пространству имен служебной шины** в [портал Azure](https://portal.azure.com). 
1. На левой панели выберите пункт **Управление доступом** . 
1. В разделе **Добавление назначения роли** выберите **Добавить**. 
1. На странице **Добавление назначения роли** выполните следующие действия.
    1. Выберите роль. В этом случае используется роль **Отправитель данных служебной шины Azure**. 
    1. Выберите **удостоверение** для пользовательского раздела или предметной области сетки событий. 
    1. Нажмите кнопку **сохранить** , чтобы сохранить конфигурацию.

Эти действие аналогично добавлению удостоверения для других ролей, упомянутых в таблице. 

## <a name="use-the-azure-cli"></a>Использование Azure CLI
В примере в этом разделе показано, как с помощью Azure CLI добавить удостоверение в роль Azure. Примеры команд предназначены для пользовательских разделов сетки событий. Для доменов сетки событий используются похожие команды. 

### <a name="get-the-principal-id-for-the-custom-topics-system-identity"></a>Получение идентификатора субъекта для удостоверения системы пользовательского раздела 
Сначала получите идентификатор субъекта для управляемого системой удостоверения пользовательского раздела и назначьте удостоверение соответствующим ролям.

```azurecli-interactive
topic_pid=$(az ad sp list --display-name "$<TOPIC NAME>" --query [].objectId -o tsv)
```

### <a name="create-a-role-assignment-for-event-hubs-at-various-scopes"></a>Создание назначения роли для центров событий в различных областях 
В следующем примере интерфейса командной строки показано, как добавить удостоверение пользовательского раздела в роль **отправителя данных концентраторов событий Azure** на уровне пространства имен или на уровне концентратора событий. При создании назначения роли на уровне пространства имен настраиваемый раздел может пересылать события во все концентраторы событий в этом пространстве имен. При создании назначения роли на уровне концентратора событий пользовательский раздел может пересылать события только в этот конкретный концентратор событий. 


```azurecli-interactive
role="Azure Event Hubs Data Sender" 
namespaceresourceid=$(az eventhubs namespace show -n $<EVENT HUBS NAMESPACE NAME> -g <RESOURCE GROUP of EVENT HUB> --query "{I:id}" -o tsv) 
eventhubresourceid=$(az eventhubs eventhub show -n <EVENT HUB NAME> --namespace-name <EVENT HUBS NAMESPACE NAME> -g <RESOURCE GROUP of EVENT HUB> --query "{I:id}" -o tsv) 

# create role assignment for the whole namespace 
az role assignment create --role "$role" --assignee "$topic_pid" --scope "$namespaceresourceid" 

# create role assignment scoped to just one event hub inside the namespace 
az role assignment create --role "$role" --assignee "$topic_pid" --scope "$eventhubresourceid" 
```

### <a name="create-a-role-assignment-for-a-service-bus-topic-at-various-scopes"></a>Создание назначения роли для раздела служебной шины в различных областях 
В следующем примере интерфейса командной строки показано, как добавить удостоверение пользовательского раздела "Сетка событий" в роль " **отправитель данных" служебной шины Azure** на уровне пространства имен или на уровне разделов служебной шины. Если вы создаете назначение роли на уровне пространства имен, раздел "Сетка событий" может пересылать события во все сущности (очереди или разделы служебной шины) в пределах этого пространства имен. Если вы создаете назначение ролей на уровне очереди или раздела служебной шины, пользовательский раздел "Сетка событий" может пересылать события только в эту конкретную очередь или раздел служебной шины. 

```azurecli-interactive
role="Azure Service Bus Data Sender" 
namespaceresourceid=$(az servicebus namespace show -n $RG\SB -g "$RG" --query "{I:id}" -o tsv 
sbustopicresourceid=$(az servicebus topic show -n topic1 --namespace-name $RG\SB -g "$RG" --query "{I:id}" -o tsv) 

# create role assignment for the whole namespace 
az role assignment create --role "$role" --assignee "$topic_pid" --scope "$namespaceresourceid" 

# create role assignment scoped to just one hub inside the namespace 
az role assignment create --role "$role" --assignee "$topic_pid" --scope "$sbustopicresourceid" 
```

## <a name="next-steps"></a>Дальнейшие шаги
Теперь, когда вы назначили системному разделу, пользовательскому разделу или домену удостоверение, назначенное системой, и добавили удостоверение в соответствующие роли в местах назначения, см. раздел [события девлиер с использованием удостоверения](managed-service-identity.md) для доставки событий в назначения с помощью удостоверения.


