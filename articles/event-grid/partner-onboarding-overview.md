---
title: Обзор адаптации партнера (сетка событий Azure)
description: В этой статье представлен обзор того, как можно подключить партнера по службе "Сетка событий".
ms.topic: conceptual
ms.date: 10/29/2020
ms.openlocfilehash: 2a2e33395cabd368d5d5d870dd0461e4cbd37e0d
ms.sourcegitcommit: 910a1a38711966cb171050db245fc3b22abc8c5f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "93081201"
---
# <a name="partner-onboarding-overview-azure-event-grid"></a>Обзор адаптации партнера (сетка событий Azure)

В этой статье описывается, как в частном порядке использовать ресурсы партнера по службе "Сетка событий Azure" и как стать общедоступным типом тематического раздела.

Для использования типов ресурсов Сетки событий, связанных с публикацией событий в качестве партнера Сетки событий, не требуется специального разрешения. На самом деле вы можете использовать их сегодня для публикации событий в собственных подписках Azure и для тестирования модели ресурсов, если вы собираетесь стать партнером.

> [!NOTE]
> Пошаговые инструкции по подключению к партнеру по сетке событий с помощью портал Azure см. в статье как подключить [партнера по сетке событий (портал Azure)](onboard-partner.md). 

## <a name="how-partner-events-work"></a>Как работают события партнеров
Функция "партнерские мероприятия" использует существующую архитектуру, которая уже используется службой "Сетка событий" для публикации событий из ресурсов Azure, таких как служба хранилища Azure и центр Интернета вещей Azure, и делает эти инструменты общедоступными для всех пользователей. Использование этих средств по умолчанию является частным только для подписки Azure. Чтобы сделать события общедоступными, заполните форму и [обратитесь к группе "Сетка событий"](mailto:gridpartner@microsoft.com).

Функция "события партнера" позволяет публиковать события в службе "Сетка событий Azure" для использования клиентами.

## <a name="onboarding-and-event-publishing-overview"></a>Общие сведения о подключении и публикации событий

### <a name="partner-flow"></a>Партнерский поток

1. Создайте клиент Azure, если он еще не создан.
1. Используйте Azure CLI, чтобы создать новую сетку событий `partnerRegistration` . Этот ресурс включает такие сведения, как отображаемое имя, описание, URI настройки и т. д.

    ![Создание раздела партнера](./media/partner-onboarding-how-to/create-partner-registration.png)

1. Создайте одно или несколько пространств имен партнеров в каждом регионе, где необходимо опубликовать события. Служба "Сетка событий" подготавливает конечную точку публикации (например, `https://contoso.westus-1.eventgrid.azure.net/api/events` ) и ключи доступа.

    ![Создание пространства имен партнеров](./media/partner-onboarding-how-to/create-partner-namespace.png)

1. Предоставьте клиентам возможность регистрироваться в системе, в которой они хотят создать партнерский раздел.
1. Свяжитесь с группой по службе "Сетка событий", чтобы сообщить им о том, что ваш тип раздела партнера должен стать общедоступным.

### <a name="customer-flow"></a>Поток клиента

1. Ваш клиент посещает портал Azure, чтобы отметить идентификатор подписки Azure и группу ресурсов, в которых они хотят создать партнерский раздел.
1. Клиент запрашивает Партнерский раздел через вашу систему. В ответ вы создаете туннель события для пространства имен партнера.
1. Служба "Сетка событий" создает в подписке Azure и группе ресурсов раздел, **ожидающий** партнера.

    ![Создание канала событий](./media/partner-onboarding-how-to/create-event-tunnel-partner-topic.png)

1. Клиент активирует раздел Partner с помощью портал Azure. Теперь события могут передаваться из службы в подписку Azure клиента.

    ![Активация раздела партнера](./media/partner-onboarding-how-to/activate-partner-topic.png)

## <a name="resource-model"></a>Модель ресурсов
Следующая модель ресурсов предназначена для партнерских событий.

### <a name="partner-registrations"></a>Регистрация партнеров
* Ресурс: `partnerRegistrations`.
* Кем используется. Участники
* Описание: захватывает глобальные метаданные партнера SaaS (например, имя, отображаемое имя, описание, URI установки).
    
    Создание или обновление регистрации партнера — это самостоятельная операция для партнеров. Эта возможность самостоятельно позволяет партнерам создавать и тестировать комплексную последовательность.
    
    Только одобренные корпорацией Майкрософт регистрации партнеров обнаруживаются клиентами.
* Область: создается в подписке Azure партнера. Метаданные видны клиентам после того, как они станут общедоступными.

### <a name="partner-namespaces"></a>Пространства имен партнеров
* Ресурс: `partnerNamespaces`.
* Кем используется. Участники
* Описание. Предоставляет региональный ресурс для публикации событий клиентов. Каждое пространство имен партнера имеет конечную точку публикации и ключи проверки подлинности. Пространство имен — это также то, как партнер запрашивает Партнерский раздел для данного клиента и получает список активных клиентов.
* Область: живет в подписке партнера.

### <a name="event-channel"></a>Канал событий
* Ресурс: `partnerNamespaces/eventChannels`.
* Кем используется. Участники
* Описание. каналы событий являются зеркалом раздела партнера клиента. Создав канал событий и указав подписку Azure клиента и группу ресурсов в метаданных, вы сообщаете службе "Сетка событий" о создании партнерской темы для клиента. Служба "Сетка событий" выдает Azure Resource Manager вызов, чтобы создать соответствующий Партнерский раздел в подписке клиента. Раздел партнера создан в состоянии ожидания. Между каждым каналом событий и партнером существует связь «один к одному».
* Область: живет в подписке партнера.

### <a name="partner-topics"></a>Партнерские разделы
* Ресурс: `partnerTopics`.
* Кем используется. Клиенты
* Описание. темы партнеров аналогичны пользовательским темам и системным темам в сетке событий. Каждый раздел партнера связан с конкретным источником (например, `Contoso:myaccount` ) и конкретным типом тематического раздела (например, Contoso). Клиенты создают подписки на события в разделе партнера для маршрутизации событий в различные обработчики событий.

    Клиенты не могут напрямую создать этот ресурс. Единственный способ создать раздел партнера — это операция партнера, которая создает канал событий.
* Область: живет в подписке клиента.

### <a name="partner-topic-types"></a>Типы тематических разделов
* Ресурс: `partnerTopicTypes`.
* Кем используется. Клиенты
* Описание. типы тематических разделов — это типы ресурсов на уровне клиента, позволяющие клиентам обнаруживать список утвержденных типов разделов партнеров. URL-адрес выглядит следующим образом: https://management.azure.com/providers/Microsoft.EventGrid/partnerTopicTypes)
* Область. Global

## <a name="publish-events-to-event-grid"></a>Опубликовать события в сетке событий
При создании пространства имен партнера в регионе Azure вы получаете региональную конечную точку и соответствующие ключи проверки подлинности. Опубликуйте пакеты событий в этой конечной точке для всех каналов событий клиентов в этом пространстве имен. На основе поля источника в событии служба "Сетка событий Azure" сопоставляет каждое событие с соответствующими темам партнеров.

### <a name="event-schema-cloudevents-v10"></a>Схема событий: Клаудевентс v 1.0
Опубликуйте события в службе "Сетка событий Azure" с помощью схемы Клаудевентс 1,0. Сетка событий поддерживает как структурированный, так и пакетный режим. Клаудевентс 1,0 — единственная поддерживаемая схема событий для пространств имен партнеров.

### <a name="example-flow"></a>Пример потока

1.  Служба публикации выполняет запрос HTTP POST к `https://contoso.westus2-1.eventgrid.azure.net/api/events?api-version=2018-01-01`.
1.  Добавьте в запрос значение заголовка aeg-sas-key, содержащее ключ для проверки подлинности. Этот ключ подготавливается во время создания пространства имен партнера. Например, допустимое значение заголовка — aeg-sas-key: VXbGWce53249Mt8wuotr0GPmyJ/nDT4hgdEj9DpBeRr38arnnm5OFg==.
1.  Задайте для заголовка Content-Type значение "Application/клаудевентс-Batch + JSON; charset = UTF-8A ".
1.  Выполните запрос HTTP POST к URL-адресу публикации с пакетом событий, который соответствует этому региону. Пример:

``` json
[
{
    "specversion" : "1.0-rc1",
    "type" : "com.contoso.ticketcreated",
    "source" : " com.contoso.account1",
    "subject" : "tickets/123",
    "id" : "A234-1234-1234",
    "time" : "2019-04-05T17:31:00Z",
    "comexampleextension1" : "value",
    "comexampleothervalue" : 5,
    "datacontenttype" : "application/json",
    "data" : {
          object-unique-to-each-publisher
    }
},
{
    "specversion" : "1.0-rc1",
    "type" : "com.contoso.ticketclosed",
    "source" : "https://contoso.com/account2",
    "subject" : "tickets/456",
    "id" : "A234-1234-1234",
    "time" : "2019-04-05T17:31:00Z",
    "comexampleextension1" : "value",
    "comexampleothervalue" : 5,
    "datacontenttype" : "application/json",
    "data" : {
          object-unique-to-each-publisher
    }
}
]
```

После отправки в конечную точку пространства имен партнера вы получаете ответ. Ответ — это стандартный код ответа HTTP. Ниже приведены некоторые распространенные ответы:

| Результат                             | Ответ              |
|------------------------------------|-----------------------|
| Успешно                            | 200 ОК                |
| Неправильный формат данных события    | 400 — недопустимый запрос       |
| Недопустимый ключ доступа                 | 401 — недостаточно прав      |
| Неправильная конечная точка                 | 404 — не найдено         |
| Массив или событие превышает допустимый размер | 413 (слишком большой объем полезных данных) |

## <a name="references"></a>Ссылки

  * [Swagger](https://github.com/ahamad-MS/azure-rest-api-specs/blob/master/specification/eventgrid/resource-manager/Microsoft.EventGrid/preview/2020-04-01-preview/EventGrid.json)
  * [Шаблон ARM](/azure/templates/microsoft.eventgrid/allversions)
  * [Схема шаблона ARM](https://github.com/Azure/azure-resource-manager-schemas/blob/master/schemas/2020-04-01-preview/Microsoft.EventGrid.json)
  * [REST API](/rest/api/eventgrid/version2020-04-01-preview/partnernamespaces);
  * [Расширение CLI](/cli/azure/ext/eventgrid/)

### <a name="sdks"></a>Пакеты SDK
  * [.NET](https://www.nuget.org/packages/Microsoft.Azure.Management.EventGrid/5.3.1-preview)
  * [Python](https://pypi.org/project/azure-mgmt-eventgrid/3.0.0rc6/)
  * [Java](https://search.maven.org/artifact/com.microsoft.azure.eventgrid.v2020_04_01_preview/azure-mgmt-eventgrid/1.0.0-beta-3/jar)
  * [Ruby](https://rubygems.org/gems/azure_mgmt_event_grid/versions/0.19.0)
  * [JS](https://www.npmjs.com/package/@azure/arm-eventgrid/v/7.0.0)
  * [GO](https://github.com/Azure/azure-sdk-for-go)


## <a name="next-steps"></a>Дальнейшие действия
- [Общие сведения о партнерских разделах](partner-events-overview.md)
- [Форма адаптации разделов партнеров](https://aka.ms/gridpartnerform)
- [Auth0 Партнерский раздел](auth0-overview.md)
- [Использование Auth0 Partner](auth0-how-to.md)
