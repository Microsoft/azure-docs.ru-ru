---
title: Устранение неполадок с Кэшем Azure для Redis на стороне сервера
description: Узнайте, как устранять распространенные проблемы на стороне сервера в кэше Azure для Redis, такие как нехватка памяти, высокая загрузка ЦП, длительные команды или ограничения пропускной способности.
author: yegu-ms
ms.author: yegu
ms.service: cache
ms.topic: conceptual
ms.date: 10/18/2019
ms.openlocfilehash: 12d78846f5892e71388de6e6e76b868f9b14d4de
ms.sourcegitcommit: 772eb9c6684dd4864e0ba507945a83e48b8c16f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "88008922"
---
# <a name="troubleshoot-azure-cache-for-redis-server-side-issues"></a>Устранение неполадок с Кэшем Azure для Redis на стороне сервера

В этом разделе обсуждаются проблемы, возникающие из-за состояния кэша Azure для Redis или виртуальных машин, на которых размещается.

- [Нехватка памяти на сервере Redis](#memory-pressure-on-redis-server)
- [Высокая загрузка ЦП или нагрузка на сервер](#high-cpu-usage-or-server-load)
- [Долго выполняющиеся команды](#long-running-commands)
- [Ограничение пропускной способности на стороне сервера](#server-side-bandwidth-limitation)

> [!NOTE]
> Шаги по устранению проблем в этой статье также включают в себя указания по выполнению команд Redis и мониторингу различных метрик производительности. Дополнительные сведения и указания см. в разделе [Дополнительные сведения](#additional-information).
>

## <a name="memory-pressure-on-redis-server"></a>Нехватка памяти на сервере Redis

Нехватка памяти на сервере кэширования служит причиной всевозможных проблем с производительностью, которые вызывают задержку обработки запросов. При попадании в нехватку памяти система может выполнить страничную загрузку данных на диск. Именно _ошибки страниц_ существенно замедляют работу системы. Нехватка памяти может возникнуть по следующим причинам.

- Кэш заполняется данными рядом с максимальной емкостью.
- Redis представляет большую фрагментацию памяти. Эта фрагментация чаще всего вызывается хранением больших объектов, так как Redis оптимизирован для небольших объектов.

Redis предоставляет две статистики через команду [info](https://redis.io/commands/info) , которая поможет определить эту ошибку: "used_memory" и "used_memory_rss". [Эти метрики можно просмотреть](cache-how-to-monitor.md#view-metrics-with-azure-monitor) с помощью портала.

Настроить оптимальное использование памяти можно несколькими способами.

- [Настройте политику памяти](cache-configure.md#maxmemory-policy-and-maxmemory-reserved) и задайте время истечения срока действия ключей. Этой политики может быть недостаточно, если используется фрагментация.
- [Настройте зарезервированное MaxMemory значение](cache-configure.md#maxmemory-policy-and-maxmemory-reserved) , которое достаточно велико для компенсации фрагментации памяти.
- Разбейте большие кэшированные объекты на меньшие связанные объекты.
- [Создайте оповещения](cache-how-to-monitor.md#alerts) на таких метриках, как объем используемой памяти, чтобы заранее получать уведомления о возможных влияниях.
- [Масштабирование](cache-how-to-scale.md) до большего размера кэша с большим объемом памяти.

## <a name="high-cpu-usage-or-server-load"></a>Высокая загрузка ЦП или нагрузка на сервер

Высокая нагрузка на сервер или использование ЦП означает, что сервер не может своевременно обрабатывать запросы. Сервер может медленно реагировать на запросы и не может поддерживать скорость запросов.

[Отслеживайте метрики](cache-how-to-monitor.md#view-metrics-with-azure-monitor) , такие как загрузка ЦП или сервера. Понаблюдайте за пиками загрузки ЦП, которые соответствуют времени ожидания.

Существует несколько изменений, которые можно выполнить для снижения высокой нагрузки на сервер:

- Выясните, что вызывает пиковые выпуски ЦП, такие как [длительные команды](#long-running-commands) , указанные ниже, или сбой страницы из-за высокой нехватки памяти.
- [Создавайте оповещения](cache-how-to-monitor.md#alerts) о таких метриках, как загрузка ЦП или сервера, чтобы получать уведомления о возможных последствиях.
- [Масштабирование](cache-how-to-scale.md) до большего размера кэша с большим объемом ресурсов ЦП.

## <a name="long-running-commands"></a>Долго выполняющиеся команды

Некоторые команды Redis больше затрат на выполнение, чем другие. В [документации по командам Redis](https://redis.io/commands) показано время сложности каждой команды. Так как обработка команд Redis является однопотоковой, команда, которая занимает время выполнения, блокирует все остальные, которые поступают после него. Вы должны ознакомиться с командами, которые вы выдаете серверу Redis, чтобы понять их влияние на производительность. Например, команда [Keys](https://redis.io/commands/keys) часто используется, не зная, что это операция O (N). Вы можете избежать ключей с помощью [сканирования](https://redis.io/commands/scan) , чтобы уменьшить пиковые пики.

С помощью команды [SLOWLOG](https://redis.io/commands/slowlog) можно измерять ресурсоемкие команды, выполняемые на сервере.

## <a name="server-side-bandwidth-limitation"></a>Ограничение пропускной способности на стороне сервера

Различные размеры кэша имеют разную пропускную способность сети. Если сервер превышает доступную пропускную способность, данные не будут отправляться клиенту как можно быстрее. Время ожидания запросов клиентов истекло, так как сервер не может быстро отправить данные на клиент.

Метрики "чтение кэша" и "запись в кэш" можно использовать для просмотра объема используемой пропускной способности на стороне сервера. [Эти метрики можно просмотреть](cache-how-to-monitor.md#view-metrics-with-azure-monitor) на портале.

Чтобы устранить ситуации, в которых использование пропускной способности сети близко к максимальной емкости:

- Измените поведение вызова клиента, чтобы снизить потребность в сети.
- [Создавайте оповещения](cache-how-to-monitor.md#alerts) для таких метрик, как "чтение кэша" или "запись в кэш", чтобы заранее получать уведомления о возможных влияниях.
- [Масштабирование](cache-how-to-scale.md) до большего размера кэша с большей емкостью пропускной способности сети.

## <a name="additional-information"></a>Дополнительные сведения

- [Устранение неполадок с Кэшем Azure для Redis на стороне клиента](cache-troubleshoot-client.md)
- [Выбор подходящего уровня](cache-overview.md#choosing-the-right-tier)
- [Как измерить и протестировать производительность моего кэша?](cache-management-faq.md#how-can-i-benchmark-and-test-the-performance-of-my-cache)
- [Как отслеживать кэш Redis для Azure?](cache-how-to-monitor.md)
- [Как выполнять команды Redis?](cache-development-faq.md#how-can-i-run-redis-commands)
