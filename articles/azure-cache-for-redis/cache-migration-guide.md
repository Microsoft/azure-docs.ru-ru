---
title: Миграция в службу "Кэш Azure для Redis"
description: Узнайте, как перенести существующий кэш в кэш Azure для Redis
author: yegu-ms
ms.service: cache
ms.topic: conceptual
ms.date: 07/22/2020
ms.author: yegu
ms.openlocfilehash: d63cafb32dc1db0a901ed3e6004446b450db10c7
ms.sourcegitcommit: 6386854467e74d0745c281cc53621af3bb201920
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/08/2021
ms.locfileid: "102451529"
---
# <a name="migrate-to-azure-cache-for-redis"></a>Миграция в службу "Кэш Azure для Redis"
В этой статье описывается ряд подходов к переносу существующего кэша Redis, работающего локально или в другой облачной службе, в кэш Azure для Redis.

## <a name="migration-scenarios"></a>Сценарии миграции
Redis с открытым исходным кодом может выполняться во многих вычислительных средах. Ниже приведены распространенные примеры.

- **Локальные** — кэши Redis, выполняющиеся в частных центрах обработки данных.
- **Облачные виртуальные машины** — кэши Redis, работающие на виртуальных машинах Azure, AWS EC2 и т. д.
- Службы **размещения** — управляемые службы Redis, такие как AWS еластикаче.
- **Различные регионы** — кэши Redis, расположенные в другом регионе Azure.

При наличии такого кэша вы можете переместить его в кэш Azure для Redis с минимальным перерывом или простоем.

## <a name="migration-options"></a>Варианты переноса

Существует несколько способов переключения из одного кэша в другой. В зависимости от того, где находится кэш и как приложение взаимодействует с ним, один метод будет более полезным, чем другие. Ниже описаны некоторые из часто используемых стратегий миграции.

   | Параметр       | Преимущества | Недостатки |
   | ------------ | ---------- | ------------- |
   | Создать новый кэш | Простейший способ реализации. | Необходимо повторно заполнить данные в новом кэше, который может не работать с множеством приложений. |
   | Экспорт и импорт данных через файл RDB | Совместимо с любым кэшем Redis, обычно. | Некоторые данные могут быть потеряны, если они записываются в существующий кэш после создания файла RDB. | 
   | Двойное запись данных в два кэша | Не приводит к потерям данных и простоям. Непрерывные операции существующего кэша. Упрощенное тестирование нового кэша. | Требуется два кэша в течение продолжительного периода времени. | 
   | Программная миграция данных | Полный контроль над перемещением данных. | Требуется пользовательский код. | 

### <a name="create-a-new-azure-cache-for-redis"></a>Создание нового кэша Azure для Redis

Этот подход технически не является переносом. Если потеря данных не является проблемой, самый простой способ переместиться в кэш Azure для Redis — это создать экземпляр кэша и подключить приложение к нему. Например, если в качестве кэша записей базы данных используется Redis, можно легко перестроить кэш с нуля.

Ниже приведены общие действия для реализации этого параметра.

1. Создайте новый кэш Azure для экземпляра Redis.

2. Обновите приложение, чтобы оно использовало новый экземпляр.

3. Удалите старый экземпляр Redis.

### <a name="export-data-to-an-rdb-file-and-import-it-into-azure-cache-for-redis"></a>Экспорт данных в файл RDB и их импорт в кэш Azure для Redis

Redis с открытым исходным кодом определяет стандартный механизм создания моментального снимка набора данных в памяти кэша и сохранения его в файле. Этот файл, называемый RDB, может быть прочитан другим кэшем Redis. [Кэш Azure для уровня "Премиум" для Redis](cache-overview.md#service-tiers) поддерживает импорт данных в экземпляр кэша через файлы RDB. Файл RDB можно использовать для перемещения данных из существующего кэша в кэш Azure для Redis.

> [!IMPORTANT]
> Формат файлов RDB может изменяться между версиями Redis и не поддерживать обратную совместимость. Версия Redis кэша, из которой выполняется экспорт, должна быть больше или равна версии, указанной в кэше Azure для Redis.
>

Ниже приведены общие действия для реализации этого параметра.

1. Создайте новый кэш Azure для экземпляра Redis на уровне Premium, который имеет тот же размер, что и (или больше) существующего кэша.

2. Сохранение моментального снимка существующего кэша Redis. Можно [настроить Redis для периодического сохранения моментальных снимков](https://redis.io/topics/persistence) или запустить процесс вручную с помощью команд [Save](https://redis.io/commands/save) или [бгсаве](https://redis.io/commands/bgsave) . Файл RDB по умолчанию имеет имя "dump. RDB" и будет находиться по пути, указанному в файле конфигурации *Redis. conf* .

    > [!NOTE]
    > Если вы выполняете миграцию данных в кэше Azure для Redis, см. [инструкции по экспорту файла RDB](cache-how-to-import-export-data.md) или использованию [командлета PowerShell Export](/powershell/module/azurerm.rediscache/export-azurermrediscache) .
    >

3. Скопируйте файл RDB в учетную запись хранения Azure в регионе, где находится новый кэш. Для этой задачи можно использовать AzCopy.

4. Импортируйте файл RDB в новый кэш, используя [инструкции импорта](cache-how-to-import-export-data.md) или [командлет PowerShell Import](/powershell/module/azurerm.rediscache/import-azurermrediscache).

5. Обновите приложение, чтобы использовать новый экземпляр кэша.

### <a name="write-to-two-redis-caches-simultaneously-during-migration-period"></a>Запись в два кэша Redis одновременно в течение периода миграции

Вместо перемещения данных между кэшами вы можете использовать приложение для записи данных в существующий кэш и в новый. Приложение будет по-прежнему считывать данные из существующего кэша изначально. Когда новый кэш содержит необходимые данные, приложение переключается в этот кэш и снимается с учета старого. Предположим, например, что вы используете Redis в качестве хранилища сеансов, а сеансы приложения действительны в течение семи дней. После записи в два кэша в течение недели вы увидите, что новый кэш содержит все сведения о сеансе с неистекшим сроком действия. Вы можете безопасно полагаться на него с этого момента, не заботясь о потери данных.

Ниже приведены общие действия для реализации этого параметра.

1. Создайте новый кэш Azure для экземпляра Redis на уровне Premium, который имеет тот же размер, что и (или больше) существующего кэша.

2. Измените код приложения для записи как в новый, так и в исходный экземпляр.

3. Продолжайте считывать данные из исходного экземпляра, пока новый экземпляр не будет заполнен данными.

4. Обновите код приложения для чтения и записи только из нового экземпляра.

5. Удалите исходный экземпляр.

### <a name="migrate-programmatically"></a>Миграция программными средствами

Вы можете создать пользовательский процесс миграции, программно считывая данные из существующего кэша и записывая их в кэш Azure для Redis. С помощью этого [средства с открытым кодом](https://github.com/deepakverma/redis-copy) можно копировать данные из одного кэша Azure для экземпляра Redis в другой. Это средство полезно для перемещения данных между экземплярами кэша в разных регионах кэша Azure. Также доступна [скомпилированная версия](https://github.com/deepakverma/redis-copy/releases/download/alpha/Release.zip) . Вы также можете найти исходный код, который будет полезным руководством по написанию собственного средства миграции.

> [!NOTE]
> Это средство официально не поддерживается корпорацией Майкрософт. 
>

Ниже приведены общие действия для реализации этого параметра.

1. Создайте виртуальную машину в регионе, где находится существующий кэш. Если набор данных большой, выберите относительно мощную виртуальную машину, чтобы сократить время копирования.

2. Создайте новый кэш Azure для экземпляра Redis.

3. Очистите данные из нового кэша, чтобы убедиться, что они пусты. Этот шаг является обязательным, поскольку само средство копирования не перезаписывает существующий ключ в целевом кэше.

    > [!IMPORTANT]
    > НЕ забудьте выполнить очистку из исходного кэша.
    >

4. Используйте приложение, такое как средство с открытым исходным кодом, чтобы автоматизировать копирование данных из исходного кэша в целевой объект. Помните, что процесс копирования может занять некоторое время в зависимости от размера набора данных.

## <a name="next-steps"></a>Дальнейшие действия
Дополнительные сведения о кэше Azure для функций Redis.

* [Кэш Azure для уровней служб Redis](cache-overview.md#service-tiers)
* [Импорт данных](cache-how-to-import-export-data.md#import)