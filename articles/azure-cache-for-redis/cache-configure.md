---
title: Настройка кэша Azure для Redis
description: Обзор конфигурации Redis по умолчанию для кэша Azure для Redis и описание способов настройки экземпляров кэша Azure для Redis
author: yegu-ms
ms.service: cache
ms.topic: conceptual
ms.date: 08/22/2017
ms.author: yegu
ms.openlocfilehash: ba021d280f71504ad5c1e1aea0dc1c8c6b507b1e
ms.sourcegitcommit: 910a1a38711966cb171050db245fc3b22abc8c5f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "100581077"
---
# <a name="how-to-configure-azure-cache-for-redis"></a>Настройка кэша Azure для Redis
В этом разделе описаны конфигурации, доступные для экземпляров кэша Azure для Redis. В этом разделе также описывается конфигурация сервера Redis по умолчанию для экземпляров кэша Azure для Redis.

> [!NOTE]
> Дополнительные сведения о настройке и использовании функций кэша уровня "Премиум" см. в статьях [Настройка постоянного хранения для кэша Redis для Azure уровня Премиум](cache-how-to-premium-persistence.md), [Настройка кластеризации для кэша Redis для Azure уровня Премиум](cache-how-to-premium-clustering.md) и [Настройка поддержки виртуальной сети для кэша Redis для Azure уровня Премиум](cache-how-to-premium-vnet.md).
>
>

## <a name="configure-azure-cache-for-redis-settings"></a>Настройка параметров кэша Azure для Redis
[!INCLUDE [redis-cache-create](../../includes/redis-cache-browse.md)]

Параметры кэша Azure для Redis можно просмотреть и настроить в колонке **Azure Cache for Redis** (Кэш Azure для Redis) с помощью **меню ресурсов**.

![Параметры кэша Azure для Redis](./media/cache-configure/redis-cache-settings.png)

Просмотреть и настроить следующие параметры можно с помощью **меню ресурсов**.

* [Обзор](#overview)
* [Журнал действий](#activity-log)
* [Управление доступом (IAM)](#access-control-iam)
* [Теги](#tags)
* [Диагностика и устранение проблем](#diagnose-and-solve-problems)
* [Параметры](#settings)
    * [Ключи доступа](#access-keys)
    * [Дополнительные настройки](#advanced-settings)
    * [Помощник по кэшу Azure для Redis](#azure-cache-for-redis-advisor)
    * [Масштабирование](#scale)
    * [Размер кластера](#cluster-size)
    * [Сохраняемость данных](#redis-data-persistence)
    * [Планирование обновлений](#schedule-updates)
    * [Георепликация](#geo-replication)
    * [Виртуальная сеть](#virtual-network)
    * [Брандмауэр](#firewall)
    * [Свойства](#properties)
    * [Блокировки](#locks)
    * [Скрипт автоматизации](#automation-script)
* Администрирование
    * [Импорт данных](#importexport)
    * [Экспорт данных](#importexport)
    * [Перезагрузка](#reboot)
* [Мониторинг](#monitoring)
    * [Метрики Redis](#redis-metrics)
    * [Правила оповещения](#alert-rules)
    * [Error Handling](#diagnostics)
* Настройки поддержки и устранения неполадок
    * [Работоспособность ресурса](#resource-health)
    * [Новый запрос на поддержку](#new-support-request)


## <a name="overview"></a>Обзор

В разделе **Обзор** содержатся основные сведения о кэше, такие как имя, порты, ценовая категория, и выбранные метрики кэша.

### <a name="activity-log"></a>Журнал действий

Щелкните **Журнал действий**, чтобы просмотреть выполненные с кэшем действия. Также можно использовать фильтрацию, чтобы развернуть это представление, включив в него другие ресурсы. Дополнительные сведения об использовании журналов аудита см. в статье [Просмотр журналов действий для аудита действий с ресурсами](../azure-resource-manager/management/view-activity-logs.md). Дополнительные сведения о мониторинге событий кэша Azure для Redis см. в разделе [Оповещения](cache-how-to-monitor.md#operations-and-alerts).

### <a name="access-control-iam"></a>Управление доступом (IAM)

В разделе **Управление доступом (IAM)** представлена поддержка управления доступом на основе ролей Azure (Azure RBAC) в портал Azure. Эта конфигурация помогает организациям просто и точно выполнять требования к управлению доступом. Дополнительные сведения см. [в разделе Управление доступом на основе ролей Azure в портал Azure](../role-based-access-control/role-assignments-portal.md).

### <a name="tags"></a>Теги

В разделе **Теги** вы можете упорядочить свои ресурсы. Дополнительные сведения см. в статье [Использование тегов для организации ресурсов в Azure](../azure-resource-manager/management/tag-resources.md).


### <a name="diagnose-and-solve-problems"></a>Диагностика и решение проблем

Щелкните **Диагностика и решение проблем** , чтобы узнать об основных проблемах и способах их устранения.



## <a name="settings"></a>Параметры
В разделе **Параметры** можно открыть и настроить следующие параметры кэша.

* [Ключи доступа](#access-keys)
* [Дополнительные настройки](#advanced-settings)
* [Помощник по кэшу Azure для Redis](#azure-cache-for-redis-advisor)
* [Масштабирование](#scale)
* [Размер кластера](#cluster-size)
* [Сохраняемость данных](#redis-data-persistence)
* [Планирование обновлений](#schedule-updates)
* [Георепликация](#geo-replication)
* [Виртуальная сеть](#virtual-network)
* [Брандмауэр](#firewall)
* [Свойства](#properties)
* [Блокировки](#locks)
* [Скрипт автоматизации](#automation-script)



### <a name="access-keys"></a>Ключи доступа
Щелкните **Ключи доступа** для отображения или повторного создания ключей доступа для кэша. Эти ключи используются клиентами, которые подключаются к кэшу.

![Ключи доступа кэша Azure для Redis](./media/cache-configure/redis-cache-manage-keys.png)

### <a name="advanced-settings"></a>Дополнительные настройки
Приведенные ниже параметры доступны в колонке **Дополнительные параметры**.

* [Порты доступа](#access-ports)
* [Политики памяти](#memory-policies)
* [Уведомления пространства ключей (дополнительные параметры)](#keyspace-notifications-advanced-settings)

#### <a name="access-ports"></a>Порты доступа
По умолчанию доступ без TLS/SSL отключен для новых кэшей. Чтобы включить порт без TLS, выберите **нет** для параметра **Разрешить доступ только через SSL** в колонке **Дополнительные параметры** , а затем нажмите кнопку **сохранить**.

> [!NOTE]
> Доступ TLS к кэшу Azure для Redis поддерживает TLS 1,0, 1,1 и 1,2 в настоящее время, но версии 1,0 и 1,1 скоро будут прекращены.  Дополнительные сведения см. на [странице Удаление TLS 1,0 и 1,1](cache-remove-tls-10-11.md) .

![Порты доступа кэша Azure для Redis](./media/cache-configure/redis-cache-access-ports.png)

<a name="maxmemory-policy-and-maxmemory-reserved"></a>
#### <a name="memory-policies"></a>Политики памяти
Параметры **Политика максимальной памяти**, **maxmemory-reserved** и **maxfragmentationmemory-reserved** в колонке **Дополнительные параметры** позволяют настроить политики памяти для кэша.

![Политика максимального объема памяти кэша Azure для Redis](./media/cache-configure/redis-cache-maxmemory-policy.png)

**Политика максимальной памяти** используется для настройки политики вытеснения для кэша и позволяет выбрать следующие политики вытеснения:

* `volatile-lru` — это политика вытеснения по умолчанию.
* `allkeys-lru`
* `volatile-random`
* `allkeys-random`
* `volatile-ttl`
* `noeviction`

Дополнительные сведения о политиках `maxmemory` см. в разделе [Eviction policies](https://redis.io/topics/lru-cache#eviction-policies) (Политики вытеснения) на сайте Redis.

Параметр **MaxMemory-reserved** позволяет настроить объем памяти (в МБ на экземпляр в кластере), зарезервированный для операций без кэша, таких как репликация во время отработки отказа. Установка этого значения обеспечивает более согласованную работу сервера Redis при изменении нагрузки. Это значение должно быть выше при рабочих нагрузках с преобладанием записи. При резервировании памяти для таких операций она недоступна для хранения кэшированных данных.

Параметр **maxfragmentationmemory-reserved** позволяет настроить объем памяти (в МБ на экземпляр в кластере), зарезервированный для обеспечения фрагментации памяти. Установка этого значения дает возможность более согласованно использовать сервер Redis, когда кэш заполнен или почти заполнен, а также при высоком соотношении фрагментации. При резервировании памяти для таких операций она недоступна для хранения кэшированных данных.

При выборе нового значения резервирования памяти (**maxmemory-reserved** или **maxfragmentationmemory-reserved**) также необходимо учитывать, как это изменение может повлиять на кэш, в котором уже выполняется обработка больших объемов данных. Например, если в кэше емкостью 53 ГБ находится 49 ГБ данных, а вы измените значение параметра резервирования на 8 ГБ, то максимальный объем доступной памяти для системы будет снижен до 45 ГБ. Если текущие значения `used_memory` или `used_memory_rss` выше, чем новое ограничение в 45 ГБ, то системе придется вытеснять данные до тех пор, пока оба значения `used_memory` и `used_memory_rss` не станут меньше 45 ГБ. Вытеснение может увеличить нагрузку на сервер и фрагментацию памяти. Дополнительные сведения о доступных метриках кэша, таких как `used_memory` и `used_memory_rss`, см. в разделе [Доступные метрики и интервалы отчетности](cache-how-to-monitor.md#available-metrics-and-reporting-intervals).

> [!IMPORTANT]
> Параметры **maxmemory-reserved** и **maxfragmentationmemory-reserved** доступны только для кэшей уровней "Стандартный" и "Премиум".
>
>

#### <a name="keyspace-notifications-advanced-settings"></a>Уведомления пространства ключей (дополнительные параметры)
В колонке **Дополнительные параметры** можно настроить уведомления пространства ключей Redis. Уведомления пространства ключей позволяют клиентам получать уведомления при возникновении определенных событий.

![Дополнительные параметры кэша Azure для Redis](./media/cache-configure/redis-cache-advanced-settings.png)

> [!IMPORTANT]
> Уведомления пространства ключей и параметр **notify-keyspace-events** доступны только для кэшей уровней Standard и Premium.
>
>

Дополнительные сведения см. в статье [Redis Keyspace Notifications](https://redis.io/topics/notifications) (Уведомления пространства ключей Redis). Пример кода см. в файле [KeySpaceNotifications.cs](https://github.com/rustd/RedisSamples/blob/master/HelloWorld/KeySpaceNotifications.cs) в примере [Здравствуй, мир!](https://github.com/rustd/RedisSamples/tree/master/HelloWorld).


<a name="recommendations"></a>
## <a name="azure-cache-for-redis-advisor"></a>Помощник по кэшу Azure для Redis
В колонке **Azure Cache for Redis Advisor** (Помощник по кэшу Azure для Redis) отображаются рекомендации для кэша. Во время обычной работы не отображается никаких рекомендаций.

![Снимок экрана, на котором показано, где отображаются рекомендации.](./media/cache-configure/redis-cache-no-recommendations.png)

При возникновении во время работы кэша любого из таких условий, как интенсивное использование памяти, пропускной способности сети или сервера, в колонке **Azure Cache for Redis** (Кэш Azure для Redis) отображается предупреждение.

![Снимок экрана, на котором показано, где отображаются оповещения в разделе "кэш Azure для Redis".](./media/cache-configure/redis-cache-recommendations-alert.png)

Дополнительные сведения можно найти в колонке **Рекомендации** .

![Рекомендации](./media/cache-configure/redis-cache-recommendations.png)

Эти метрики можно отслеживать в колонке **Azure Cache for Redis** (Кэш Azure для Redis) в разделах [Monitoring charts](cache-how-to-monitor.md#monitoring-charts) (Диаграммы мониторинга) и [Usage charts](cache-how-to-monitor.md#usage-charts) (Диаграммы использования).

Каждая ценовая категория имеет различные ограничения для количества клиентских подключений, памяти и пропускной способности. Если в течение продолжительного периода времени кэш приближается к максимальной емкости для этих метрик, создается рекомендация. Дополнительные сведения о метриках и ограничениях, проверенных средством **рекомендаций** , см. в следующей таблице:

| Метрики кэша Azure для Redis | Дополнительные сведения |
| --- | --- |
| Пропускная способность сети |[Производительность кэша — доступная пропускная способность](cache-planning-faq.md#azure-cache-for-redis-performance) |
| Подключенные клиенты |[Конфигурация сервера Redis по умолчанию — максимальное количество клиентов](#maxclients) |
| Загрузка сервера |[Диаграммы использования — загрузка сервера Redis](cache-how-to-monitor.md#usage-charts) |
| Использование памяти |[Производительность кэша — размер](cache-planning-faq.md#azure-cache-for-redis-performance) |

Чтобы обновить кэш, щелкните " **Обновить сейчас** ", чтобы изменить ценовую категорию и [масштабировать](#scale) кэш. Дополнительные сведения о выборе ценовой категории см. в разделе [Выбор правильного уровня](cache-overview.md#choosing-the-right-tier) .


### <a name="scale"></a>Масштабирование
Щелкните **Масштаб**, чтобы просмотреть или изменить ценовую категорию для кэша. Дополнительные сведения о масштабировании см. в статье [Масштабирование кэша Azure для Redis](cache-how-to-scale.md).

![Ценовая категория кэша Azure для Redis](./media/cache-configure/pricing-tier.png)

<a name="cluster-size"></a>

### <a name="redis-cluster-size"></a>Размер кластера Redis
Щелкните **Размер кластера** , чтобы изменить размер кластера для работающего кэша уровня "Премиум" с включенной кластеризацией.

![Размер кластера](./media/cache-configure/redis-cache-redis-cluster-size.png)

Чтобы изменить размер кластера, воспользуйтесь ползунком или введите число от 1 до 10 в текстовом поле **Shard count** (Количество сегментов), а затем нажмите кнопку **ОК** для сохранения изменений.

> [!IMPORTANT]
> Кластеризация Redis доступна только для кэша категории «Премиум». Дополнительные сведения см. в статье [How to configure clustering for a Premium Azure Cache for Redis](cache-how-to-premium-clustering.md) (Настройка кластеризации кэша Azure для Redis категории "Премиум").
>
>


### <a name="redis-data-persistence"></a>Сохраняемость данных Redis
Щелкните **сохраняемость данных** , чтобы включить, отключить или настроить сохраняемость данных для кэша уровня "Премиум". Кэш Azure для Redis обеспечивает сохраняемость Redis на основе RDB или AOF.

Дополнительные сведения см. в статье [How to configure persistence for a Premium Azure Cache for Redis](cache-how-to-premium-persistence.md) (Как настроить сохраняемость для кэша Azure для Redis категории "Премиум").


> [!IMPORTANT]
> Сохраняемость данных Redis доступна только для кэшей категории «Премиум».
>
>

### <a name="schedule-updates"></a>Планирование обновлений
В колонке **Schedule updates** (Планирование обновлений) можно указать период обслуживания для обновления сервера кэша Redis.

> [!IMPORTANT]
> Данный период обслуживания относится только к обновлениям сервера Redis, а не ко всем обновлениям Azure или операционной системы виртуальных машин, на которых размещен кэш.
>
>

![Планирование обновлений](./media/cache-configure/redis-schedule-updates.png)

Чтобы задать период обслуживания, отметьте необходимые дни и укажите, когда будет начинаться период обслуживания в каждый из дней, а затем нажмите кнопку **ОК**. Время периода обслуживания указывается в формате UTC.

Дополнительные сведения и инструкции см. в статье " [кэш Azure для администрирования Redis: планирование обновлений](cache-administration.md#schedule-updates) ".

### <a name="geo-replication"></a>Георепликация

Колонка **Георепликация** предоставляет механизм связывания двух экземпляров кэша Azure для Redis категории "Премиум". Один кэш используется в качестве основного связанного кэша, а другой — как дополнительный связанный кэш. Дополнительный связанный кэш становится доступным только для чтения, и в него реплицируются данные, записанные в основной кэш. Эту функцию можно использовать для репликации кэша в разные регионы Azure.

> [!IMPORTANT]
> **Георепликация** доступна только для кэшей категории "Премиум". Дополнительные сведения и инструкции см. в статье [How to configure Geo-replication for Azure Cache for Redis](cache-how-to-geo-replication.md) (Как настроить георепликацию для кэша Azure для Redis).
>
>

### <a name="virtual-network"></a>Виртуальная сеть
В разделе **Виртуальная сеть** можно настроить параметры виртуальной сети для кэша. Дополнительные сведения о создании кэша категории "Премиум" с поддержкой виртуальной сети и обновлении ее параметров см. в статье [How to configure Virtual Network Support for a Premium Azure Cache for Redis](cache-how-to-premium-vnet.md) (Настройка поддержки виртуальной сети для кэша Azure для Redis категории "Премиум").

> [!IMPORTANT]
> Параметры виртуальной сети доступны только для кэшей уровня Премиум, которые были настроены с поддержкой виртуальной сети во время создания кэша.
>
>

### <a name="firewall"></a>Брандмауэр

Настройка правил брандмауэра доступна для всех уровней кэша Azure для Redis.

Щелкните **Брандмауэр**, чтобы просмотреть и настроить правила брандмауэра для кэша.

![Брандмауэр](./media/cache-configure/redis-firewall-rules.png)

В правилах брандмауэра можно указать начало и конец диапазона IP-адресов. Когда правила брандмауэра будут настроены, подключения к кэшу будут доступны только для клиентов из указанного диапазона IP-адресов. После сохранения правила брандмауэра существует небольшая задержка, прежде чем правило начинает действовать. Обычно эта задержка не длится более одной минуты.

> [!IMPORTANT]
> Подключения из систем мониторинга кэша Azure для Redis всегда разрешены, даже если настроены правила брандмауэра.
>
>

### <a name="properties"></a>Свойства
Щелкните **Свойства** для просмотра информации о кэше, включая конечные точки и порты кэша.

![Свойства кэша Azure для Redis](./media/cache-configure/redis-cache-properties.png)

### <a name="locks"></a>Блокировки
Раздел **блокировки** позволяет заблокировать подписку, группу ресурсов или ресурс, чтобы другие пользователи в Организации не могли случайно удалить или изменить критически важные ресурсы. Дополнительные сведения см. [в разделе Блокировка ресурсов с помощью Azure Resource Manager](../azure-resource-manager/management/lock-resources.md).

### <a name="automation-script"></a>Сценарий автоматизации

Щелкните **Сценарий автоматизации**, чтобы создать и экспортировать шаблон развернутых ресурсов для использования в будущих развертываниях. Дополнительные сведения о работе с шаблонами см. в статье [Развертывание ресурсов с использованием шаблонов Azure Resource Manager](../azure-resource-manager/templates/deploy-powershell.md).

## <a name="administration-settings"></a>Параметры администрирования
Параметры в разделе **Администрирование** позволяют выполнить следующие задачи администрирования для кэша.

![Администрирование](./media/cache-configure/redis-cache-administration.png)

* [Импорт данных](#importexport)
* [Экспорт данных](#importexport)
* [Перезагрузка](#reboot)


### <a name="importexport"></a>Импорт и экспорт
Функция импорта и экспорта является операцией управления данными в кэше Azure для Redis, которая позволяет импортировать данные в кэш и экспортировать их оттуда путем импорта и экспорта моментального снимка базы данных кэша Azure для Redis (RDB) из кэша категории "Премиум" в страничный BLOB-объект в учетной записи службы хранилища Azure. Функция импорта и экспорта дает возможность переключаться между различными экземплярами кэша Azure для Redis или заполнять кэш данными перед использованием.

Импорт можно использовать для переноса RDB-файлов, совместимых с Redis, с сервера Redis, запущенного в любом облаке или любой среде, включая Redis в Linux, Windows, или у любого поставщика облачных служб, такого как Amazon Web Services или другого. Импорт данных позволяет легко создать кэш, предварительно заполненный данными. Во время импорта кэш Azure для Redis загружает RDB-файлы из службы хранилища Azure в память, а затем вставляет в кэш ключи.

Экспорт позволяет экспортировать данные, хранящиеся в кэше Azure для Redis, в RDB-файлы, совместимые с Redis. Эту функцию можно использовать для перемещения данных из одного экземпляра кэша Azure для Redis в другой или на другой сервер Redis. Во время экспорта на виртуальной машине, где размещается экземпляр сервера кэша Azure для Redis, создается временный файл, который отправляется в заданную учетную запись хранения. После успешного или неудачного завершения операции экспорта этот временный файл удаляется.

> [!IMPORTANT]
> Функция импорта и экспорта доступна только для кэшей категории "Премиум". Дополнительные сведения и указания см. в статье [Import and Export data in Azure Cache for Redis](cache-how-to-import-export-data.md) (Импорт и экспорт данных в кэше Azure для Redis).
>
>

### <a name="reboot"></a>Перезагрузка
Колонка **Перезагрузка** позволяет перезагрузить узлы кэша. Функция перезагрузки дает возможность протестировать приложение на устойчивость в случае сбоя узла кэша.

![Перезагрузка](./media/cache-configure/redis-cache-reboot.png)

Если у вас кэш уровня "Премиум" с включенной кластеризацией, то вы можете выбрать сегменты кэша для перезагрузки.

![Снимок экрана, на котором показано, где выбрать сегменты кэша для перезагрузки.](./media/cache-configure/redis-cache-reboot-cluster.png)

Чтобы перезагрузить один или несколько узлов кэша, выберите необходимые узлы и нажмите кнопку **Перезагрузить**. Если у вас кэш уровня "Премиум" с включенной кластеризацией, выберите сегменты для перезагрузки и нажмите кнопку **Перезагрузить**. Через несколько минут выбранные узлы перезагрузятся, а еще через несколько минут — возобновят работу.

> [!IMPORTANT]
> Перезагрузка теперь доступна для всех ценовых категорий. Дополнительные сведения и указания см. в разделе о [перезагрузке](cache-administration.md#reboot) статьи, посвященной администрированию кэша Azure для Redis.
>
>


## <a name="monitoring"></a>Мониторинг

В разделе **Мониторинг** можно настроить диагностику и мониторинг для кэша Azure для Redis.
Дополнительные сведения о мониторинге и диагностике кэша Azure для Redis см. в статье [How to monitor Azure Cache for Redis](cache-how-to-monitor.md) (Как отслеживать кэш Azure для Redis).

![Диагностика](./media/cache-configure/redis-cache-diagnostics.png)

* [Метрики Redis](#redis-metrics)
* [Правила оповещения](#alert-rules)
* [Error Handling](#diagnostics)

### <a name="redis-metrics"></a>Метрики Redis
Щелкните **Метрики Redis**, чтобы [просмотреть метрики](cache-how-to-monitor.md#view-cache-metrics) кэша.

### <a name="alert-rules"></a>Правила оповещения

Щелкните **Правила оповещения**, чтобы настроить оповещения на основе метрик кэша Azure для Redis. Дополнительные сведения см. в статье [Оповещения](cache-how-to-monitor.md#alerts).

### <a name="diagnostics"></a>Диагностика

По умолчанию в Azure Monitor метрики кэша [хранятся в течение 30 дней](../azure-monitor/essentials/data-platform-metrics.md), а затем удаляются. Чтобы сохранить метрики кэша дольше, чем на 30 дней, щелкните **Диагностика**, чтобы [настроить учетную запись хранения](cache-how-to-monitor.md#export-cache-metrics), используемую для хранения диагностических данных кэша.

>[!NOTE]
>Помимо архивации метрик кэша в хранилище, их также можно передать [в концентратор событий или отправить в журналы Azure Monitor](../azure-monitor/essentials/stream-monitoring-data-event-hubs.md).
>
>

## <a name="support--troubleshooting-settings"></a>Настройки поддержки и устранения неполадок
Параметры в разделе **Поддержка и устранение неполадок** дают возможности для устранения проблем с кэшем.

![Поддержка и устранение неполадок](./media/cache-configure/redis-cache-support-troubleshooting.png)

* [Работоспособность ресурса](#resource-health)
* [Новый запрос на поддержку](#new-support-request)

### <a name="resource-health"></a>Работоспособность ресурса
Служба **работоспособности ресурсов** отслеживает ресурс и сообщает, работает ли он как ожидалось. Дополнительные сведения о службе работоспособности ресурсов Azure см. [здесь](../service-health/resource-health-overview.md).

> [!NOTE]
> Сейчас служба работоспособности ресурсов не поддерживает отправку сведений о работоспособности экземпляров кэша Azure для Redis, размещенных в виртуальной сети. Дополнительные сведения см. в разделе [Все ли функции кэша работают, когда он размещен в виртуальной сети?](cache-how-to-premium-vnet.md#do-all-cache-features-work-when-a-cache-is-hosted-in-a-virtual-network).
>
>

### <a name="new-support-request"></a>Новый запрос на поддержку
Щелкните **Новый запрос на получение поддержки** , чтобы создать запрос по своему кэшу.





## <a name="default-redis-server-configuration"></a>Конфигурация сервера Redis по умолчанию
Новые экземпляры кэша Azure для Redis имеют следующие значения конфигурации Redis по умолчанию.

> [!NOTE]
> Параметры в этом разделе не удастся изменить с помощью метода `StackExchange.Redis.IServer.ConfigSet`. При вызове этого метода одной из команд в данном разделе, выдается исключение, аналогичное приведенному ниже примеру.  
>
> `StackExchange.Redis.RedisServerException: ERR unknown command 'CONFIG'`
>
> Все настраиваемые значения, такие как **max-memory-policy**, настраиваются на портале Azure или с помощью программ командной строки, таких как Azure CLI или PowerShell.
>
>

| Параметр | Значение по умолчанию | Описание |
| --- | --- | --- |
| `databases` |16 |Количество баз данных по умолчанию — 16. Тем не менее можно указать другое количество в зависимости от ценовой категории<sup>1</sup>. По умолчанию используется база данных DB 0. Вы можете выбрать другую базу данных для отдельных подключений с помощью `connection.GetDatabase(dbid)`, где `dbid` — это число от `0` до `databases - 1`. |
| `maxclients` |Зависит от ценовой категории.<sup>2</sup> |Это значение представляет собой максимально допустимое количество одновременно подключенных клиентов. После достижения предела Redis закрывает все новые подключения, возвращая сообщение об ошибке "max number of clients reached" (достигнуто максимальное количество клиентов). |
| `maxmemory-policy` |`volatile-lru` |Политика максимальной памяти — это параметр, определяющий то, как Redis выбирает, что следует удалить при достижении `maxmemory` (размера кэша, выбранного вами при создании кэша). В случае с кэшем Azure для Redis значением по умолчанию является `volatile-lru`, когда удаляются ключи со сроком действия, устанавливаемым с помощью алгоритма LRU. Этот параметр можно настроить на портале Azure. Дополнительные сведения см. в разделе [Политики памяти](#memory-policies). |
| `maxmemory-samples` |3 |Для экономии памяти алгоритмы LRU и минимальный TTL являются не точными, а аппроксимированными алгоритмами. По умолчанию Redis проверяет три ключа и выбирает один, использовавшийся наиболее давно. |
| `lua-time-limit` |5 000 |Максимальное время выполнения сценария Lua в миллисекундах. При достижении максимального времени выполнения Redis делает запись в журнале о нахождении данного сценария в процессе выполнения по истечении максимально допустимого времени и начинает отвечать на запросы ошибкой. |
| `lua-event-limit` |500 |Максимальный размер очереди событий сценариев. |
| `client-output-buffer-limit` `normalclient-output-buffer-limit` `pubsub` |0 0 032mb 8mb 60 |Ограничения буферов вывода клиентов можно использовать для принудительного отключения клиентов, по каким-либо причинам недостаточно быстро считывающим данные с сервера (распространенной причиной является неспособность клиента Pub/Sub поглощать сообщения так же быстро, как их производит издатель). Дополнительные сведения см. на веб-сайте [https://redis.io/topics/clients](https://redis.io/topics/clients). |

<a name="databases"></a>
<sup>1</sup> Для различных ценовых категорий кэша Azure для Redis предельное значение `databases` будет разным. Его можно указать при создании кэша. Если при создании кэша значение `databases` не указано, то используется значение по умолчанию — 16.

* Кэши уровней Basic и Standard
  * кэш C0 (250 МБ) — до 16 баз данных;
  * кэш C1 (1 ГБ) — до 16 баз данных;
  * кэш C2 (2,5 ГБ) — до 16 баз данных;
  * кэш C3 (6 ГБ) — до 16 баз данных;
  * кэш C4 (13 ГБ) — до 32 баз данных;
  * кэш C5 (26 ГБ) — до 48 баз данных;
  * кэш C6 (53 ГБ) — до 64 баз данных.
* Кэши уровня Premium
  * кэш P1 (6–60 ГБ) — до 16 баз данных;
  * кэш P2 (13–130 ГБ) — до 32 баз данных;
  * кэш P3 (26–260 ГБ) — до 48 баз данных;
  * кэш P4 (53–530 ГБ) — до 64 баз данных.
  * Для всех кэшей уровня Премиум включен кластер Redis. Он поддерживает только базу данных 0, поэтому предельное значение `databases` для любого кэша уровня Премиум с включенным кластером Redis равно 1, а использование команды [Select](https://redis.io/commands/select) не допускается. Дополнительные сведения см. в разделе [Нужно ли вносить изменения в клиентское приложение, чтобы использовать кластеризацию?](cache-how-to-premium-clustering.md#do-i-need-to-make-any-changes-to-my-client-application-to-use-clustering).

Дополнительные сведения о базах данных см. в разделе [Что такое базы данных Redis?](cache-development-faq.md#what-are-redis-databases)

> [!NOTE]
> Параметр `databases` можно настроить только во время создания кэша и только с помощью PowerShell, интерфейса командной строки или других клиентов управления. Пример настройки `databases` во время создания кэша с помощью PowerShell см. в разделе о командлете [New-AzRedisCache](cache-how-to-manage-redis-cache-powershell.md#databases).
>
>

<a name="maxclients"></a>
<sup>2</sup>`maxclients` отличается для каждой ценовой категории кэша Azure для Redis.

* Кэши уровней Basic и Standard
  * кэш C0 (250 МБ) — до 256 подключений;
  * кэш C1 (1 ГБ) — до 1000 подключений;
  * кэш C2 (2.5 ГБ) — до 2000 подключений;
  * кэш C3 (6 ГБ) — до 5000 подключений;
  * кэш C4 (13 ГБ) — до 10 000 подключений;
  * кэш C5 (26 ГБ) — до 15 000 подключений;
  * кэш C6 (53 ГБ) — до 20 000 подключений.
* Кэши уровня Premium
  * P1 (6–60 ГБ): до 7500 подключений
  * P2 (13–130 ГБ): до 15 000 подключений
  * P3 (26–260 ГБ): до 30 000 подключений
  * P4 (53–530 ГБ): до 40 000 подключений

> [!NOTE]
> Хотя каждый размер кэша *допускает* определенное число подключений, с каждым подключением к Redis связаны накладные расходы. Примером таких накладных расходов могут служить загрузка ЦП и использование памяти в результате шифрования TLS/SSL. Максимальное число подключений для данного размера кэша предполагает низкую загрузку кэша. Если *суммарная* нагрузка, связанная с подключениями и клиентскими операциями, превышает емкость системы, могут возникнуть проблемы с работой кэша, даже если максимальное число подключений для его текущего размера не превышено.
>
>



## <a name="redis-commands-not-supported-in-azure-cache-for-redis"></a>Команды Redis не поддерживаются в кэше Azure для Redis
> [!IMPORTANT]
> Так как настройка и управление экземплярами кэша Azure для Redis осуществляется корпорацией Майкрософт, следующие команды отключены. При попытке их вызвать появляется сообщение об ошибке примерно следующего содержания: `"(error) ERR unknown command"`.
>
> * BGREWRITEAOF
> * BGSAVE
> * CONFIG
> * DEBUG
> * MIGRATE
> * SAVE
> * SHUTDOWN
> * SLAVEOF
> * CLUSTER — команды записи для кластера отключены, однако допускается использование кластерных команд только для чтения.
>
>

Дополнительные сведения о командах Redis см. в разделе [https://redis.io/commands](https://redis.io/commands) .

## <a name="redis-console"></a>Консоль Redis
В экземплярах кэша Azure для Redis можно безопасно выполнять команды с помощью **консоли Redis**, доступной на портале Azure для всех категорий кэшей.

> [!IMPORTANT]
> - Консоль Redis не работает с [VNET](cache-how-to-premium-vnet.md). Если кэш является частью виртуальной сети, то к нему могут обращаться только клиенты в этой виртуальной сети. Так как консоль Redis работает в локальном браузере вне виртуальной сети, она не может подключиться к кэшу.
> - В кэше Azure для Redis поддерживаются не все команды Redis. Список команд Redis, отключенных в кэше Azure для Redis, см. в предыдущем разделе — [Команды Redis не поддерживаются в кэше Azure для Redis](#redis-commands-not-supported-in-azure-cache-for-redis). Дополнительные сведения о командах Redis см. в разделе [https://redis.io/commands](https://redis.io/commands) .
>
>

Чтобы иметь доступ к консоли Redis, в колонке **Azure Cache for Redis** (Кэш Azure для Redis) щелкните **Консоль**.

![Снимок экрана, на котором выделена кнопка консоли.](./media/cache-configure/redis-console-menu.png)

Чтобы выполнить команду в своем экземпляре кэша, введите нужную команду в консоль.

![Снимок экрана САС отображает консоль Redis с командой ввода и результатами.](./media/cache-configure/redis-console.png)


### <a name="using-the-redis-console-with-a-premium-clustered-cache"></a>Использование консоли Redis с кластеризированным кэшем категории "Премиум"

При использовании консоли Redis с кластеризированным кэшем категории "Премиум" можно выполнять команды для одного сегмента кэша. Чтобы выполнить команду для конкретного сегмента, сначала подключитесь к нужному сегменту, щелкнув его в окне выбора сегментов.

![Консоль Redis](./media/cache-configure/redis-console-premium-cluster.png)

При попытке получить доступ к ключу, который хранится в другом сегменте, вы получите следующее сообщение об ошибке.

```
shard1>get myKey
(error) MOVED 866 13.90.202.154:13000 (shard 0)
```

В предыдущем примере выбран сегмент 1, но `myKey` находится в сегменте 0, как указано в части `(shard 0)` сообщения об ошибке. В этом примере для доступа к `myKey` выберите сегмент 0 с помощью средства выбора сегментов, а затем выполните необходимую команду.


## <a name="move-your-cache-to-a-new-subscription"></a>Перемещение кэша в новую подписку
Для перемещения кэша в новую подписку щелкните **Переместить**.

![Перемещение кэша Azure для Redis](./media/cache-configure/redis-cache-move.png)

Сведения о перемещении ресурсов из одной группы ресурсов в другую, а также из одной подписки в другую см. в статье [Перемещение ресурсов в новую группу ресурсов или подписку](../azure-resource-manager/management/move-resource-group-and-subscription.md).

## <a name="next-steps"></a>Дальнейшие действия
* Дополнительные сведения о работе с командами Redis см. в разделе [как выполнять команды Redis?](cache-development-faq.md#how-can-i-run-redis-commands)
