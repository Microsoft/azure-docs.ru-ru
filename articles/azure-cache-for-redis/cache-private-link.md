---
title: Кэш Azure для Redis с помощью частной связи Azure (Предварительная версия)
description: Частная конечная точка Azure — это сетевой интерфейс, который обеспечивает безопасное подключение к кэшу Azure для Redis с помощью частной ссылки Azure. В этой статье вы узнаете, как создать кэш Azure, виртуальную сеть Azure и закрытую конечную точку с помощью портал Azure.
author: curib
ms.author: cauribeg
ms.service: cache
ms.topic: conceptual
ms.date: 10/14/2020
ms.openlocfilehash: 22bdf93e7236ae5220a6bb7c6ead898628bb51a1
ms.sourcegitcommit: 772eb9c6684dd4864e0ba507945a83e48b8c16f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "97007591"
---
# <a name="azure-cache-for-redis-with-azure-private-link-public-preview"></a>Кэш Azure для Redis с помощью частной связи Azure (общедоступная Предварительная версия)
В этой статье вы узнаете, как создать виртуальную сеть и кэш Azure для экземпляра Redis с помощью частной конечной точки, используя портал Azure. Вы также узнаете, как добавить частную конечную точку в существующий кэш Azure для экземпляра Redis.

Частная конечная точка Azure — это сетевой интерфейс, который обеспечивает безопасное подключение к кэшу Azure для Redis с помощью частной ссылки Azure. 

## <a name="prerequisites"></a>Предварительные требования
* Подписка Azure — [создайте бесплатную учетную запись](https://azure.microsoft.com/free/).

> [!IMPORTANT]
> Чтобы использовать частные конечные точки, необходимо создать кэш Azure для экземпляра Redis после 28 июля 2020.
> В настоящее время Георепликация, правила брандмауэра, поддержка консоли портала, несколько конечных точек на кластеризованный кэш, сохранение в брандмауэре и внедренные кэши не поддерживаются. 
>
>

## <a name="create-a-private-endpoint-with-a-new-azure-cache-for-redis-instance"></a>Создание частной конечной точки с новым кэшем Azure для экземпляра Redis 

В этом разделе вы создадите новый кэш Azure для экземпляра Redis с закрытой конечной точкой.

### <a name="create-a-virtual-network"></a>Создание виртуальной сети 

1. Войдите на [портал Azure](https://portal.azure.com) и выберите **Создать ресурс**.

    :::image type="content" source="media/cache-private-link/1-create-resource.png" alt-text="Выберите Создать ресурс.":::

2. На странице **Создание** выберите **сети** и щелкните **Виртуальная сеть**.

3. Нажмите кнопку **Добавить** , чтобы создать виртуальную сеть.

4. В подменю **Создать виртуальную сеть** введите или выберите следующую информацию на вкладке **Основные сведения**:

   | Параметр      | Рекомендуемое значение  | Описание |
   | ------------ |  ------- | -------------------------------------------------- |
   | **Подписка** | Раскройте список и выберите нужную подписку. | Подписка, в которой будет создана эта виртуальная сеть. | 
   | **Группа ресурсов** | Раскройте список и выберите группу ресурсов или нажмите **Создать** и введите имя для новой группы ресурсов. | Имя группы ресурсов, в которой будет создана виртуальная сеть и другие ресурсы. Поместив все ресурсы приложения в одну группу ресурсов, вы сможете легко управлять ими и/или удалить их вместе. | 
   | **имя**; | Введите имя виртуальной сети. | Имя должно начинаться с буквы или цифры, заканчиваться буквой, цифрой или символом подчеркивания и может содержать только буквы, цифры, символы подчеркивания, точки или дефисы. | 
   | **Регион** | Раскрывающийся список и выберите регион. | Выберите [регион](https://azure.microsoft.com/regions/) рядом с другими службами, которые будут использовать виртуальную сеть. |

5. Перейдите на вкладку **IP-адреса** или нажмите кнопку **Далее: IP-адреса** в нижней части страницы.

6. На вкладке **IP-адреса** укажите **адресное пространство IPv4** в виде одного или нескольких префиксов адресов в нотации CIDR (например, 192.168.1.0/24).

7. В разделе **имя подсети** щелкните **по умолчанию** , чтобы изменить свойства подсети.

8. В области **Изменение подсети** укажите **имя** подсети, а также **диапазон адресов подсети**. Диапазон адресов подсети должен быть в нотации CIDR (например, 192.168.1.0/24). Он должен содержаться в адресном пространстве виртуальной сети.

9. Щелкните **Сохранить**.

10. Перейдите на вкладку " **Проверка и создание** " или нажмите кнопку " **проверить и создать** ".

11. Убедитесь, что все сведения указаны правильно, и нажмите кнопку **создать** , чтобы подготавливает виртуальную сеть.

### <a name="create-an-azure-cache-for-redis-instance-with-a-private-endpoint"></a>Создание кэша Azure для экземпляра Redis с закрытой конечной точкой
Чтобы создать экземпляр кэша, выполните следующие действия.

1. Вернитесь на домашнюю страницу портал Azure или откройте меню боковой панели, а затем выберите **создать ресурс**. 
   
1. На странице **Создание** выберите **Базы данных**, а затем **Кэш Azure для Redis**.

    :::image type="content" source="media/cache-private-link/2-select-cache.png" alt-text="Выбор элемента &quot;Кэш Azure для Redis&quot;.":::
   
1. На странице **Новый кэш Redis** настройте параметры для нового кэша.
   
   | Параметр      | Рекомендуемое значение  | Description |
   | ------------ |  ------- | -------------------------------------------------- |
   | **DNS-имя** | Введите глобально уникальное имя | Имя кэша должно быть строкой длиной от 1 до 63 символов и содержать только цифры, буквы и дефисы. Имя должно начинаться и заканчиваться цифрой или буквой и не может содержать более одного дефиса подряд. *Имя узла* для экземпляра кэша получит значение *\<DNS name>.redis.cache.windows.net*. | 
   | **подписка** | Раскройте список и выберите нужную подписку. | В этой подписке будет создан новый экземпляр кэша Redis для Azure. | 
   | **Группа ресурсов** | Раскройте список и выберите группу ресурсов или нажмите **Создать** и введите имя для новой группы ресурсов. | Имя группы ресурсов, в которой будут созданы кэш и другие ресурсы. Поместив все ресурсы приложения в одну группу ресурсов, вы сможете легко управлять ими и/или удалить их вместе. | 
   | **Местоположение** | Откройте список и выберите расположение. | Выберите оптимальный [регион](https://azure.microsoft.com/regions/) для других служб, которые будут использовать кэш. |
   | **Ценовая категория** | Откройте список и выберите [ценовую категорию](https://azure.microsoft.com/pricing/details/cache/). |  Ценовая категория определяет размер, производительность и функции, доступные для кэша. Дополнительные сведения см. в [обзоре предложения "Кэш Redis для Azure"](cache-overview.md). |

1. Выберите вкладку **Сети** или нажмите кнопку **Сети** в нижней части страницы.

1. На вкладке " **сеть** " выберите **Частная конечная точка** для метода подключения.

1. Нажмите кнопку **Добавить** , чтобы создать закрытую конечную точку.

    :::image type="content" source="media/cache-private-link/3-add-private-endpoint.png" alt-text="В области Сетевые подключения добавьте закрытую конечную точку.":::

1. На странице **Создание частной конечной точки** настройте параметры частной конечной точки с помощью виртуальной сети и подсети, созданной в последнем разделе, и нажмите кнопку **ОК**. 

1. Нажмите кнопку **Далее: дополнительно** в нижней части страницы или выберите вкладку **Далее: дополнительно**.

1. На вкладке **Дополнительно** для экземпляра кэша уровня "Базовый" или "Стандартный" установите переключатель, чтобы включить порт, отличный от TLS.

1. На вкладке **Дополнительно** для экземпляра кэша уровня "Премиум" настройте параметры для портов, отличных от TLS, а также кластеризацию и сохраняемость данных.

1. Нажмите кнопку **Далее: теги** или нажмите кнопку **Далее: теги** в нижней части страницы.

1. При необходимости на вкладке **Теги** введите имя и значение, чтобы классифицировать ресурс. 

1. Выберите **Проверить и создать**. Вы будете перенаправлены на вкладку "Просмотр и создание", где Azure проверит вашу конфигурацию.

1. Когда отобразится сообщение "Проверка пройдена" зеленого цвета, выберите **Создать**.

На создание кэша требуется некоторое время. Вы можете отслеживать ход выполнения на странице **обзорных сведений** кэша Azure для Redis. Когда **Состояние** примет значение **Running** (Выполняется), кэш будет готов к использованию. 
    
> [!IMPORTANT]
> 
> Существует флаг, `publicNetworkAccess` который `Disabled` по умолчанию имеет значение. 
> Этот флаг позволяет разрешить доступ к кэшу как к открытым, так и к частным конечным точкам, если он имеет значение `Enabled` . Если задано значение `Disabled` , доступ к закрытой конечной точке разрешен только для частных конечных точек. Можно задать значение `Disabled` или `Enabled` с помощью следующего запроса исправления. Измените значение, чтобы отразить нужный флаг для кэша.
> ```http
> PATCH  https://management.azure.com/subscriptions/{subscription}/resourceGroups/{resourcegroup}/providers/Microsoft.Cache/Redis/{cache}?api-version=2020-06-01
> {    "properties": {
>        "publicNetworkAccess":"Disabled"
>    }
> }
> ```
>

> [!IMPORTANT]
> 
> Для подключения к кластеризованному кэшу необходимо `publicNetworkAccess` задать значение, `Disabled` и может существовать только одно подключение к частной конечной точке. 
>

## <a name="create-a-private-endpoint-with-an-existing-azure-cache-for-redis-instance"></a>Создание частной конечной точки с существующим кэшем Azure для экземпляра Redis 

В этом разделе вы добавите закрытую конечную точку в существующий кэш Azure для экземпляра Redis. 

### <a name="create-a-virtual-network"></a>Создание виртуальной сети 
Чтобы создать виртуальную сеть, выполните следующие действия.

1. Войдите на [портал Azure](https://portal.azure.com) и выберите **Создать ресурс**.

2. На странице **Создание** выберите **сети** и щелкните **Виртуальная сеть**.

3. Нажмите кнопку **Добавить** , чтобы создать виртуальную сеть.

4. В подменю **Создать виртуальную сеть** введите или выберите следующую информацию на вкладке **Основные сведения**:

   | Параметр      | Рекомендуемое значение  | Описание |
   | ------------ |  ------- | -------------------------------------------------- |
   | **Подписка** | Раскройте список и выберите нужную подписку. | Подписка, в которой будет создана эта виртуальная сеть. | 
   | **Группа ресурсов** | Раскройте список и выберите группу ресурсов или нажмите **Создать** и введите имя для новой группы ресурсов. | Имя группы ресурсов, в которой будет создана виртуальная сеть и другие ресурсы. Поместив все ресурсы приложения в одну группу ресурсов, вы сможете легко управлять ими и/или удалить их вместе. | 
   | **имя**; | Введите имя виртуальной сети. | Имя должно начинаться с буквы или цифры, заканчиваться буквой, цифрой или символом подчеркивания и может содержать только буквы, цифры, символы подчеркивания, точки или дефисы. | 
   | **Регион** | Раскрывающийся список и выберите регион. | Выберите [регион](https://azure.microsoft.com/regions/) рядом с другими службами, которые будут использовать виртуальную сеть. |

5. Перейдите на вкладку **IP-адреса** или нажмите кнопку **Далее: IP-адреса** в нижней части страницы.

6. На вкладке **IP-адреса** укажите **адресное пространство IPv4** в виде одного или нескольких префиксов адресов в нотации CIDR (например, 192.168.1.0/24).

7. В разделе **имя подсети** щелкните **по умолчанию** , чтобы изменить свойства подсети.

8. В области **Изменение подсети** укажите **имя** подсети, а также **диапазон адресов подсети**. Диапазон адресов подсети должен быть в нотации CIDR (например, 192.168.1.0/24). Он должен содержаться в адресном пространстве виртуальной сети.

9. Щелкните **Сохранить**.

10. Перейдите на вкладку " **Проверка и создание** " или нажмите кнопку " **проверить и создать** ".

11. Убедитесь, что все сведения указаны правильно, и нажмите кнопку **создать** , чтобы подготавливает виртуальную сеть.

### <a name="create-a-private-endpoint"></a>Создание частной конечной точки 

Чтобы создать частную конечную точку, выполните следующие действия.

1. В портал Azure найдите **кэш Azure для Redis** и нажмите клавишу ВВОД или выберите его из вариантов поиска.

    :::image type="content" source="media/cache-private-link/4-search-for-cache.png" alt-text="Найдите кэш Azure для Redis.":::

2. Выберите экземпляр кэша, в который нужно добавить закрытую конечную точку.

3. В левой части экрана выберите **(Предварительная версия) частная конечная точка**.

4. Нажмите кнопку **закрытая конечная точка** , чтобы создать закрытую конечную точку.

    :::image type="content" source="media/cache-private-link/5-add-private-endpoint.png" alt-text="Добавьте закрытую конечную точку.":::

5. На **странице Создание частной конечной точки** настройте параметры частной конечной точки.

   | Параметр      | Рекомендуемое значение  | Описание |
   | ------------ |  ------- | -------------------------------------------------- |
   | **Подписка** | Раскройте список и выберите нужную подписку. | Подписка, в которой создается эта частная конечная точка. | 
   | **Группа ресурсов** | Раскройте список и выберите группу ресурсов или нажмите **Создать** и введите имя для новой группы ресурсов. | Имя группы ресурсов, в которой будет создана частная конечная точка и другие ресурсы. Поместив все ресурсы приложения в одну группу ресурсов, вы сможете легко управлять ими и/или удалить их вместе. | 
   | **имя**; | Введите имя частной конечной точки. | Имя должно начинаться с буквы или цифры, заканчиваться буквой, цифрой или символом подчеркивания и может содержать только буквы, цифры, символы подчеркивания, точки или дефисы. | 
   | **Регион** | Раскрывающийся список и выберите регион. | Выберите [регион](https://azure.microsoft.com/regions/) рядом с другими службами, которые будут использовать вашу закрытую конечную точку. |

6. Нажмите кнопку **Далее: ресурс** в нижней части страницы.

7. На вкладке **ресурс** выберите свою подписку, выберите тип ресурса `Microsoft.Cache/Redis` , а затем выберите кэш, к которому нужно подключить закрытую конечную точку.

8. Нажмите кнопку **Далее: Настройка** в нижней части страницы.

9. На вкладке **Конфигурация** выберите виртуальную сеть и подсеть, созданные в предыдущем разделе.

10. Нажмите кнопку **Далее: Теги** в нижней части страницы.

11. При необходимости на вкладке **Теги** введите имя и значение, чтобы классифицировать ресурс.

12. Выберите **Проверить и создать**. Вы перейдете на вкладку " **Проверка и создание** ", где Azure проверяет конфигурацию.

13. После появления сообщения "Зеленая **Проверка пройдена** " выберите **создать**.

## <a name="faq"></a>Вопросы и ответы

### <a name="why-cant-i-connect-to-a-private-endpoint"></a>Почему не удается подключиться к частной конечной точке?
Если кэш уже является внедренным кэшем виртуальной сети, закрытые конечные точки нельзя использовать с экземпляром кэша. Если экземпляр кэша использует неподдерживаемую функцию (перечислены ниже), вы не сможете подключиться к закрытому экземпляру конечной точки. Кроме того, экземпляры кэша необходимо создавать после июля 27 использовать частные конечные точки.

### <a name="what-features-are-not-supported-with-private-endpoints"></a>Какие функции не поддерживаются с частными конечными точками?
Георепликация, правила брандмауэра, поддержка консоли портала, несколько конечных точек на кластеризованный кэш, сохранение правил брандмауэра и избыточности зоны. 

### <a name="how-can-i-change-my-private-endpoint-to-be-disabled-or-enabled-from-public-network-access"></a>Как изменить мою закрытую конечную точку, чтобы она была отключена или включена с доступом к общедоступной сети?
Существует флаг, `publicNetworkAccess` который `Disabled` по умолчанию имеет значение. Этот флаг позволяет разрешить доступ к кэшу как к открытым, так и к частным конечным точкам, если он имеет значение `Enabled` . Если задано значение `Disabled` , доступ к закрытой конечной точке разрешен только для частных конечных точек. Можно задать значение `Disabled` или `Enabled` с помощью следующего запроса исправления. Измените значение, чтобы отразить нужный флаг для кэша.

```http
PATCH  https://management.azure.com/subscriptions/{subscription}/resourceGroups/{resourcegroup}/providers/Microsoft.Cache/Redis/{cache}?api-version=2020-06-01
{    "properties": {
       "publicNetworkAccess":"Disabled"
   }
}
```

### <a name="are-network-security-groups-nsg-enabled-for-private-endpoints"></a>Включены ли группы безопасности сети (NSG) для частных конечных точек?
Нет, они отключены для частных конечных точек. Несмотря на то что подсети, содержащие частную конечную точку, могут иметь связанные NSG, правила не будут действовать для трафика, обрабатываемого частной конечной точкой. Для развертывания частных конечных точек в подсети необходимо [отключить принудительное применение политик сети](../private-link/disable-private-endpoint-network-policy.md). NSG по-прежнему действуют по отношению к другим рабочим нагрузкам, размещенным в той же подсети. Маршруты в любой подсети клиента будут использовать префикс/32, изменение поведения маршрутизации по умолчанию требует аналогичного UDR. 

Управление трафиком с помощью правил NSG для исходящего трафика на клиентах источника. Разверните отдельные маршруты с префиксом /32 для переопределения маршрутов частных конечных точек. Журналы потоков NSG и данные мониторинга для исходящих подключений по-прежнему поддерживаются и могут использоваться.

### <a name="can-i-use-firewall-rules-with-private-endpoints"></a>Можно ли использовать правила брандмауэра с частными конечными точками?
Нет, это текущее ограничение для частных конечных точек. Частная конечная точка не будет работать должным образом, если в кэше настроены правила брандмауэра.

### <a name="how-can-i-connect-to-a-clustered-cache"></a>Как подключиться к кластеризованному кэшу?
`publicNetworkAccess` необходимо задать значение `Disabled` , и может быть только одно подключение к частной конечной точке.

### <a name="since-my-private-endpoint-instance-is-not-in-my-vnet-how-is-it-associated-with-my-vnet"></a>Так как мой экземпляр частной конечной точки не находится в моей виртуальной сети, как он связан с моей виртуальной сетью?
Он связан только с вашей виртуальной сетью. Так как он не находится в виртуальной сети, для зависимых конечных точек не нужно изменять правила NSG.

### <a name="how-can-i-migrate-my-vnet-injected-cache-to-a-private-endpoint-cache"></a>Как перенести внедренный кэш виртуальной сети в кэш частной конечной точки?
Необходимо удалить внедренный кэш виртуальной сети и создать новый экземпляр кэша с закрытой конечной точкой.

## <a name="next-steps"></a>Дальнейшие действия

* Дополнительные сведения о частной ссылке Azure см. в [документации по частной ссылке Azure](../private-link/private-link-overview.md).
* Чтобы сравнить различные параметры сетевой изоляции для экземпляра кэша, см. [документацию по параметрам сетевой изоляции Redis в Azure](cache-network-isolation.md).