---
title: Мониторинг операций, событий и счетчиков для общедоступной подсистемы балансировки нагрузки
titleSuffix: Azure Load Balancer
description: Узнайте, как включить ведение журнала для Azure Load Balancer.
services: load-balancer
documentationcenter: na
author: asudbring
ms.service: load-balancer
ms.devlang: na
ms.topic: how-to
ms.custom: seodec18
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 05/05/2020
ms.author: allensu
ms.openlocfilehash: 36937ace82d2bd8d4317f90a375042de10fe719f
ms.sourcegitcommit: 910a1a38711966cb171050db245fc3b22abc8c5f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/20/2021
ms.locfileid: "101709824"
---
# <a name="azure-monitor-logs-for-azure-standard-load-balancer"></a>Журналы Azure Monitor для Azure Load Balancer (цен. категория "Стандартный")

Для управления Load Balancer (цен. категория "Стандартный")ми Azure и устранения неполадок можно использовать различные типы журналов Azure Monitor. Журналы можно передавать в концентратор событий или в рабочую область Log Analytics. Вы можете извлечь все журналы из хранилища BLOB-объектов Azure и просматривать их в таких средствах, как Excel и Power BI. 

Существуют следующие типы журналов.

* **Журналы действий:** Вы можете просмотреть все действия, отправляемые в ваши подписки Azure, а также их состояние. Дополнительные сведения см. [в статье Просмотр журналов действий для отслеживания действий с ресурсами](../azure-resource-manager/management/view-activity-logs.md). Журналы действий включены по умолчанию, и их можно просмотреть в портал Azure. Эти журналы доступны как для Azure Basic Load Balancer, так и для Load Balancer (цен. категория "Стандартный").
* **Метрики Load Balancer (цен. Категория "Стандартный"):** Этот журнал можно использовать для запроса метрик, экспортированных в качестве журналов для Load Balancer (цен. категория "Стандартный"). Эти журналы доступны только для Load Balancer (цен. категория "Стандартный").

> [!IMPORTANT]
> Журналы событий проверки работоспособности и Load Balancer предупреждений в настоящее время не работают и перечислены в [известных проблемах для Azure Load Balancer](whats-new.md#known-issues). 

> [!IMPORTANT]
> Журналы доступны только для ресурсов, развернутых в модели развертывания с помощью Azure Resource Manager. Нельзя использовать журналы для ресурсов в классической модели развертывания. Дополнительные сведения о моделях развертывания см. в статье, посвященной [развертыванию с помощью Resource Manager и классическому развертыванию](../azure-resource-manager/management/deployment-models.md).

## <a name="enable-logging"></a>Включение ведения журналов

Ведение журнала действий автоматически включается для каждого ресурса Resource Manager. Включите ведение журнала событий и проверки работоспособности, чтобы начать сбор данных, доступных в этих журналах. Выполните указанные ниже действия.

1. Войдите на [портал Azure](https://portal.azure.com). Если у вас еще нет балансировщика нагрузки, [создайте балансировщик нагрузки](./quickstart-load-balancer-standard-public-portal.md) перед продолжением.
1. На портале выберите **группы ресурсов**.
2. Выберите **\<resource-group-name>** , где находится балансировщик нагрузки.
3. Выберите подсистему балансировки нагрузки.
4. Выберите   >  **параметры диагностики** журнала действий.
5. В области **параметры диагностики** в разделе **параметры диагностики** выберите **+ Добавить параметр диагностики**.
6. В области создание **параметров диагностики** введите **Милбдиагностикс** в поле **имя** .
7. У вас есть три варианта **параметров диагностики**. Вы можете выбрать один, два или все три и настроить каждый из них в соответствие с вашими требованиями:

   * **Archive to a storage account** (Архивировать в учетной записи хранения). Для этого процесса потребуется учетная запись хранения, созданная ранее. Чтобы создать учетную запись хранения, см. раздел [Создайте учетную запись хранения](../storage/common/storage-account-create.md?tabs=azure-portal).
     1. Установите флажок **архивировать в учетную запись хранения** .
     2. Щелкните **настроить** , чтобы открыть панель **Выбор учетной записи хранения** .
     3. В раскрывающемся списке **Подписка** выберите подписку, в которой была создана учетная запись хранения.
     4. В раскрывающемся списке **учетная запись хранения** выберите имя учетной записи хранения.
     5. Щелкните **ОК**.

   * **Stream to an event hub** (Потоковая передача в концентратор событий). Вам потребуется концентратор событий, уже созданный для этого процесса. Сведения о создании концентратора событий см. [в разделе Краткое руководство. Создание концентратора событий с помощью портал Azure](../event-hubs/event-hubs-create.md).
     1. Установите флажок **Передать в концентратор событий**.
     2. Щелкните **настроить** , чтобы открыть панель **Выбор концентратора событий** .
     3. В раскрывающемся списке **Подписка** выберите подписку, в которой был создан концентратор событий.
     4. В раскрывающемся списке **выберите пространство имен концентратора событий** выберите пространство имен.
     5. В раскрывающемся списке **выберите имя политики концентратора событий** выберите имя.
     6. Щелкните **ОК**.

   * **Отправить на log Analytics**. Для этого процесса необходимо, чтобы Рабочая область log Analytics была создана и настроена. Сведения о создании рабочей области Log Analytics см. в разделе [создание log Analytics рабочей области на портал Azure](../azure-monitor/logs/quick-create-workspace.md).
     1. Установите флажок **Отправить в Log Analytics**.
     2. В раскрывающемся списке **Подписка** выберите подписку, в которой находится рабочая область log Analytics.
     3. В раскрывающемся списке **log Analytics Workspace (Рабочая область** ) выберите рабочую область.

8. В разделе **Метрика** панели **параметры диагностики** установите флажок **аллметрикс** .

9. Убедитесь, что все выглядит правильно, а затем выберите **сохранить** в верхней части панели создания **параметров диагностики** .

## <a name="view-and-analyze-the-activity-log"></a>Просмотр и анализ журнала действий

Журнал действий создается по умолчанию. Его можно настроить для экспорта на уровне подписки, следуя [инструкциям в этой статье](../azure-monitor/essentials/activity-log.md). Дополнительные сведения об этих журналах см. в статье [Просмотр журналов действий для отслеживания действий с ресурсами](../azure-resource-manager/management/view-activity-logs.md) .

Просмотреть и проанализировать данные журнала действий можно одним из следующих способов.

* **Средства Azure:** Получите сведения из журнала действий, выAzure PowerShell, Azure CLI, REST API Azure или портал Azure. [Операции аудита с диспетчер ресурсовной](../azure-resource-manager/management/view-activity-logs.md) статьей содержат пошаговые инструкции для каждого метода.
* **Power BI.** Если у вас еще нет учетной записи [Power BI](https://powerbi.microsoft.com/pricing) , ее можно опробовать бесплатно. С помощью [интеграции журналов аудита Azure для Power BI](https://powerbi.microsoft.com/integrations/azure-audit-logs/)можно анализировать данные с помощью предварительно настроенных панелей мониторинга. Или можно настроить представления в соответствии с вашими требованиями.

## <a name="view-and-analyze-metrics-as-logs"></a>Просмотр и анализ метрик в качестве журналов
С помощью функции экспорта в Azure Monitor можно экспортировать метрики Load Balancer. Эти метрики будут создавать запись журнала для каждого интервала выборки в минуту.

Экспорт метрик в журналы включен на уровне каждого ресурса. Чтобы включить эти журналы, сделайте следующее:

1. Перейдите в область **параметры диагностики** .
1. Выполните фильтрацию по группе ресурсов, а затем выберите экземпляр Load Balancer, для которого необходимо включить экспорт метрик. 
1. Когда страница параметры диагностики для Load Balancer работает, выберите **аллметрикс** , чтобы экспортировать допустимые метрики в качестве журналов.

Сведения об ограничениях экспорта метрик см. в разделе [ограничения](#limitations) этой статьи.

После включения **аллметрикс** в параметрах диагностики Load Balancer (цен. Категория "Стандартный"), если вы используете концентратор событий или log Analytics рабочую область, эти журналы будут заполнены в таблице **азуремонитор** . 

При экспорте в хранилище подключитесь к учетной записи хранения и получите записи журнала JSON для журналов событий и проверки работоспособности. После скачивания JSON-файлов их можно преобразовать в формат CSV и просмотреть в Excel, Power BI или любом другом средстве визуализации данных. 

> [!TIP]
> Если вы знакомы с Visual Studio и основные понятия изменения значений констант и переменных в C#, можно использовать [средства преобразования журналов](https://github.com/Azure-Samples/networking-dotnet-log-converter) , доступные на сайте GitHub.

## <a name="stream-to-an-event-hub"></a>"Передать в концентратор событий";
Когда диагностические данные передаются в концентратор событий, их можно использовать для централизованного анализа журналов в средстве Partner SIEM Tool с интеграцией Azure Monitor. Дополнительные сведения см. [в статье потоковая передача данных мониторинга Azure в концентратор событий](../azure-monitor/essentials/stream-monitoring-data-event-hubs.md#partner-tools-with-azure-monitor-integration).

## <a name="send-to-log-analytics"></a>Отправка в Log Analytics
Диагностические данные для ресурсов в Azure можно отправить непосредственно в Log Analytics рабочую область. В этой рабочей области можно выполнять сложные запросы к сведениям для устранения неполадок и анализа. Дополнительные сведения см. в разделе [Получение журналов ресурсов Azure в log Analytics рабочей области в Azure Monitor](../azure-monitor/essentials/resource-logs.md#send-to-log-analytics-workspace).

## <a name="limitations"></a>Ограничения
Функция экспорта метрик в журналы для Azure Load Balancer имеет следующие ограничения.
* Метрики в настоящее время отображаются с помощью внутренних имен при экспорте в виде журналов. Сопоставление можно найти в таблице ниже.
* Размерность метрик не сохраняется. Например, с такими метриками, как **дипаваилабилити** (состояние проверки работоспособности), вы не сможете разбивать или просматривать по внутреннему IP-адресу.
* Метрики для используемых портов SNAT и выделенных портов SNAT в настоящее время недоступны для экспорта в качестве журналов.

## <a name="next-steps"></a>Дальнейшие действия
* [Проверка доступных метрик для балансировщика нагрузки](./load-balancer-standard-diagnostics.md)
* [Создавайте и тестируйте запросы, следуя инструкциям Azure Monitor](../azure-monitor/logs/log-query-overview.md)