---
title: Компоненты Azure Load Balancer
description: Общие сведения о компонентах Azure Load Balancer
services: load-balancer
documentationcenter: na
author: asudbring
ms.service: load-balancer
ms.devlang: na
ms.topic: conceptual
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 06/04/2020
ms.author: allensu
ms.openlocfilehash: 6bf090cde7262fdae9c98ef55227bf2925937dbf
ms.sourcegitcommit: 910a1a38711966cb171050db245fc3b22abc8c5f
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/20/2021
ms.locfileid: "101739837"
---
# <a name="azure-load-balancer-components"></a>Компоненты Azure Load Balancer

Azure Load Balancer включает несколько важных компонентов. Эти компоненты можно настроить в подписке с помощью таких инструментов:

* Портал Azure
* Azure CLI
* Azure PowerShell
* Шаблоны Resource Manager

## <a name="frontend-ip-configuration"></a>Конфигурация IP внешнего интерфейса <a name = "frontend-ip-configurations"></a>

IP-адрес Azure Load Balancer. Это точка взаимодействия с клиентами. Эти IP-адреса могут относиться к следующим категориям:

- **Общедоступный IP-адрес**
- **Частные IP-адреса**

Тип IP-адреса определяет **тип** создаваемой подсистемы балансировки нагрузки. Если выбрать частный IP-адрес, создается внутренняя подсистема балансировки нагрузки. Если выбрать общедоступный IP-адрес, создается общедоступная подсистема балансировки нагрузки.

|  | Общедоступная подсистема балансировки нагрузки  | Внутренняя подсистема балансировки нагрузки |
| ---------- | ---------- | ---------- |
| **Конфигурация IP внешнего интерфейса**| Общедоступный IP-адрес | Частный IP-адрес|
| **Описание** | Общедоступная подсистема балансировки нагрузки сопоставляет общедоступный IP-адрес и порт входящего трафика с частным IP-адресом и портом виртуальной машины. Ответный трафик от виртуальной машины сопоставляется подсистемой балансировки нагрузки обратным образом. Применяя правила балансировки нагрузки, можно распределять определенные типы трафика между несколькими различными виртуальными машинами или службами. Например, можно распределить нагрузку от трафика веб-запросов на несколько веб-серверов.| Внутренняя подсистема балансировки нагрузки распределяет трафик между ресурсами, находящимися в виртуальной сети. Azure ограничивает доступ к интерфейсным IP-адресам виртуальной сети, к которым применяется балансировка нагрузки. IP-адреса внешнего интерфейса и виртуальные сети никогда не предоставляются напрямую конечной точке Интернета. Внутренние бизнес-приложения выполняются в Azure и доступны из Azure или из локальных ресурсов. |
| **Поддерживаемые номера SKU** | "Базовый", "Стандартный" | "Базовый", "Стандартный" |

![Пример многоуровневой подсистемы балансировки нагрузки](./media/load-balancer-overview/load-balancer.png)

Подсистема балансировки нагрузки может иметь несколько интерфейсных IP-адресов. Дополнительные сведения о [нескольких внешних интерфейсах](load-balancer-multivip-overview.md).

## <a name="backend-pool"></a>Серверный пул

Группа виртуальных машин или экземпляров в масштабируемом наборе виртуальных машин, которая обрабатывает входящий запрос. Для экономичного масштабирования до больших объемов входящего трафика обычно рекомендуется добавить дополнительные экземпляры в серверный пул.

Load Balancer мгновенно изменяет свою конфигурацию при вертикальном увеличении или уменьшении масштаба для числа экземпляров. Добавление или удаление виртуальных машин из серверного пула перенастраивает подсистему балансировки нагрузки без дополнительных операций. Область серверного пула — это любая виртуальная машина в виртуальной сети.

Вы можете спроектировать серверный пул, содержащий наименьшее количество ресурсов, чтобы оптимизировать длительность операций управления. Нет никаких различий в производительности или масштабировании плоскости данных.

## <a name="health-probes"></a>Пробы работоспособности

Пробы работоспособности помогают определить работоспособность экземпляров во внутреннем пуле. При создании подсистемы балансировки нагрузки настройте проверку работоспособности для использования этой подсистемой.  Эта проба работоспособности будет определять, является ли экземпляр работоспособным и может ли он принимать трафик.

Вы можете настроить для проб работоспособности пороговое значение состояния неработоспособности. Если проверка не отвечает, балансировщик нагрузки Azure прекращает отправлять новое подключение неработоспособным экземплярам. Сбой пробы не влияет на существующие подключения. Подключение будет продолжаться до следующего приложения:

- завершает последовательность;
- появляется время ожидания простоя;
- виртуальная машина завершает работу.

Подсистема балансировки нагрузки предоставляет разные типы проб работоспособности для конечных точек: TCP, HTTP и HTTPS. [Подробнее о пробах работоспособности Load Balancer](load-balancer-custom-probe-overview.md).

Подсистема балансировки нагрузки (номер SKU "Базовый") не поддерживает пробы работоспособности по протоколу HTTPS. Кроме того, подсистема балансировки нагрузки (номер SKU "Базовый") будет закрывать все TCP-подключения (включая установленные).

## <a name="load-balancing-rules"></a>Правила балансировки нагрузки

Правило подсистемы балансировки нагрузки позволяет определить метод распределения входящего трафика между **всеми** экземплярами внутреннего пула. Правило балансировки нагрузки сопоставляет каждую отдельную интерфейсную IP-конфигурацию и порт с несколькими внутренними IP-адресами и портами.

Например, чтобы направить трафик с интерфейсного IP-адреса на порт 80 внутренних экземпляров, следует использовать правило балансировки нагрузки для порта 80.

:::image type="content" source="./media/load-balancer-components/lbrules.png" alt-text="Схема правила подсистемы балансировки нагрузки" border="false":::

*Рисунок. Правила балансировки нагрузки*

## <a name="high-availability-ports"></a>Порты с высоким уровнем доступности

Правило подсистемы балансировки нагрузки, для которого настроены значения **protocol — all и port — 0**. 

Это позволяет указать единое правило балансировки нагрузки для всех потоков TCP и UDP, поступающих на все порты внутренней подсистемы Load Balancer (цен. категория "Стандартный"). 

Решение о распределении нагрузки принимается отдельно для каждого потока. Это действие основано на следующем соединении с пятью кортежами: 

1. Исходный IP-адрес
2. Исходный порт
3. Конечный IP-адрес
4. Порт назначения
5. protocol

Правила балансировки нагрузки портов с высоким уровнем доступности помогают в критически важных сценариях. Например, они обеспечивают высокий уровень доступности и масштабирование для виртуальных сетевых модулей в виртуальных сетях. Они позволяют распределять нагрузку между большим количеством портов.

<p align="center">
  <img src="./media/load-balancer-components/harules.svg" alt="Figure depicts how Azure Load Balancer directs all frontend ports to three instances of all backend ports" width="512" title="Правила для портов с высоким уровнем доступности">
</p>

*Рисунок. Правила для портов с высоким уровнем доступности*

См. дополнительные сведения о [портах с высоким уровнем доступности](load-balancer-ha-ports-overview.md).

## <a name="inbound-nat-rules"></a>Правила преобразования сетевых адресов для входящих подключений

Правило NAT для входящего трафика обеспечивает перенаправление входящего трафика, отправленного на определенную пару интерфейсного IP-адреса и порта. Трафик отправляется в **конкретную** виртуальную машину или экземпляр внутреннего пула. К перенаправлению портов применяется такое же распределение на основе хэша, что и для балансировки нагрузки.

:::image type="content" source="./media/load-balancer-components/inboundnatrules.png" alt-text="Схема правила NAT для входящего трафика" border="false":::

*Рисунок. Правила NAT для входящего трафика*

Правила NAT для входящего трафика в контексте Масштабируемых наборов виртуальных машин являются входящими пулами NAT. Узнайте больше о [компонентах Load Balancer и масштабируемых наборах виртуальных машин](../virtual-machine-scale-sets/virtual-machine-scale-sets-networking.md#azure-virtual-machine-scale-sets-with-azure-load-balancer).

## <a name="outbound-rules"></a>Правила для исходящего трафика

Правило для исходящего трафика позволяет настроить преобразование сетевых адресов (NAT) для всех виртуальных машин или экземпляров, которые входят в серверный пул. Это правило позволяет экземплярам серверной части отправлять запросы в Интернет или другие конечные точки.

Дополнительные сведения об [исходящих подключениях и правилах](load-balancer-outbound-connections.md).

Подсистема балансировки нагрузки ценовой категории "Базовый" не поддерживает правила для исходящего трафика.

:::image type="content" source="./media/load-balancer-components/outbound-rules.png" alt-text="Схема правила для исходящего трафика" border="false":::

*Рисунок. Правила для исходящего трафика*

## <a name="limitations"></a>Ограничения

- См. дополнительные сведения об [ограничениях](../azure-resource-manager/management/azure-subscription-service-limits.md) подсистемы балансировки нагрузки. 
- Подсистема балансировки нагрузки обеспечивает балансировку нагрузки и перенаправление портов для конкретных протоколов TCP или UDP. Правила балансировки нагрузки и правила NAT для входящего трафика поддерживают TCP и UDP, но не другие протоколы IP, включая ICMP.
- Перенаправление исходящего потока от внутренней виртуальной машины к внешнему интерфейсу внутреннего экземпляра Load Balancer завершится сбоем.
- Правило подсистемы балансировки нагрузки не может охватывать две виртуальные сети.  Внешние интерфейсы и их внутренние экземпляры должны быть расположены в одной виртуальной сети.  
- Перенаправление фрагментов IP-адресов не поддерживается в правилах балансировки нагрузки. В правилах балансировки нагрузки не поддерживается фрагментация IP-пакетов UDP и TCP. Для перенаправления существующих IP-фрагментов можно использовать правила балансировки нагрузки портов с высоким уровнем доступности. Дополнительные сведения см. в разделе [Обзор портов высокой доступности](load-balancer-ha-ports-overview.md).
- На каждую группу доступности может быть только одна общедоступная подсистема балансировки нагрузки и одна внутренняя подсистема балансировки нагрузки.

## <a name="next-steps"></a>Дальнейшие действия

- Сведения о том, как приступить к работе с подсистемой балансировки нагрузки, см. в статье [Краткое руководство. Создание общедоступной подсистемы балансировки нагрузки с помощью портала Azure для распределения нагрузки между виртуальными машинами](quickstart-load-balancer-standard-public-portal.md).
- [Дополнительные сведения об Azure Load Balancer](load-balancer-overview.md).
- Сведения об [общедоступном IP-адресе](../virtual-network/virtual-network-public-ip-address.md).
- Сведения о [частном IP-адресе](../virtual-network/private-ip-addresses.md).
- Дополнительные сведения об использовании [подсистемы балансировки нагрузки (цен. категория "Стандартный") и зон доступности](load-balancer-standard-availability-zones.md).
- Дополнительные сведения о [диагностике подсистемы балансировки нагрузки (цен. категория "Стандартный")](load-balancer-standard-diagnostics.md).
- Сведения о [сбросе TCP-подключений при простое](load-balancer-tcp-reset.md).
- Дополнительные сведения об [использовании подсистемы балансировки нагрузки (цен. категория "Стандартный") с правилами балансировки нагрузки для портов высокого уровня доступности](load-balancer-ha-ports-overview.md).
- Узнайте больше о [группах безопасности сети](../virtual-network/network-security-groups-overview.md).
- Дополнительные сведения об [ограничениях подсистемы балансировки нагрузки](../azure-resource-manager/management/azure-subscription-service-limits.md#load-balancer).
- Сведения об использовании [перенаправления портов](./tutorial-load-balancer-port-forwarding-portal.md).
