---
title: Устранение распространенных проблем Azure Load Balancer
description: Узнайте, как устранять распространенные проблемы с Azure Load Balancer.
services: load-balancer
documentationcenter: na
author: asudbring
manager: dcscontentpm
ms.custom: seodoc18
ms.service: load-balancer
ms.devlang: na
ms.topic: troubleshooting
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 01/28/2020
ms.author: allensu
ms.openlocfilehash: cddaf1bde84d7e60eb59bd4c58c65fa889e06ae3
ms.sourcegitcommit: 910a1a38711966cb171050db245fc3b22abc8c5f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "98028817"
---
# <a name="troubleshoot-azure-load-balancer"></a>Устранение неполадок Azure Load Balancer

На этой странице представлены сведения об устранении распространенных неполадок Azure Load Balancer уровня "Стандартный" и "Базовый". См. дополнительные сведения в статье [Обзор Azure Load Balancer уровня "Стандартный" (предварительная версия)](load-balancer-standard-diagnostics.md).

Когда подключение к подсистеме балансировки нагрузки недоступно, наиболее распространенными симптомами являются следующие:

- Виртуальные машины за Load Balancer не отвечают зондам работоспособности 
- Виртуальные машины за Load Balancer не отвечают на трафик в настроенном порте

Когда внешние клиенты на внутренних виртуальных машинах проходят через подсистему балансировки нагрузки, для связи будут использоваться IP-адреса клиентов. Убедитесь, что IP-адреса клиентов добавлены в список разрешений NSG.

## <a name="no-outbound-connectivity-from-standard-internal-load-balancers-ilb"></a>Нет исходящих подключений из стандартных внутренних подсистем балансировки нагрузки (ILB)

**Проверка и способы устранения**

Стандартные Илбс по **умолчанию защищены**. Базовый Илбс разрешено подключаться к Интернету через *скрытый* общедоступный IP-адрес. Это не рекомендуется для рабочих нагрузок, так как IP-адрес не является ни статическим, ни заблокированным через группы безопасности сети. Если вы недавно перешли с базовой ILB на стандартный ILB, то следует явно создать общедоступный IP-адрес через конфигурацию [только для исходящего трафика](egress-only.md) , которая блокирует IP-адрес через группы безопасности сети. Вы также можете использовать [шлюз NAT](../virtual-network/nat-overview.md) в подсети.

## <a name="cant-change-backend-port-for-existing-lb-rule-of-a-load-balancer-that-has-virtual-machine-scale-set-deployed-in-the-backend-pool"></a>Не удается изменить внутренний порт для существующего правила балансировки нагрузки в подсистеме пула, в которой развернут масштабируемый набор виртуальных машин во внутреннем пуле.

### <a name="cause-the-backend-port-cannot-be-modified-for-a-load-balancing-rule-thats-used-by-a-health-probe-for-load-balancer-referenced-by-virtual-machine-scale-set"></a>Причина: внутренний порт не может быть изменен для правила балансировки нагрузки, которое используется зондом проверки работоспособности для балансировщика нагрузки, на которую ссылается масштабируемый набор виртуальных машин

**Решение** Чтобы изменить порт, можно удалить пробу работоспособности, обновив масштабируемый набор виртуальных машин, обновив порт, а затем снова настроив проверку работоспособности.

## <a name="small-traffic-is-still-going-through-load-balancer-after-removing-vms-from-backend-pool-of-the-load-balancer"></a>После удаления виртуальных машин из серверного пула подсистемы балансировки нагрузки проходящий трафик по-прежнему проходит через балансировщик нагрузки.

### <a name="cause-vms-removed-from-backend-pool-should-no-longer-receive-traffic-the-small-amount-of-network-traffic-could-be-related-to-storage-dns-and-other-functions-within-azure"></a>Причина: виртуальные машины, удаленные из серверного пула, не должны передавать трафик. Передача небольшого объема сетевого трафика может осуществляться из-за хранилища, DNS и других функций в Azure.

Для проверки можно выполнить трассировку сети. Полное доменное имя, используемое для учетных записей хранения BLOB-объектов, указано в свойствах каждой учетной записи хранения.  С виртуальной машины в подписке Azure можно выполнить команду nslookup, чтобы определить IP-адрес Azure, назначенный этой учетной записи хранения.

## <a name="additional-network-captures"></a>Запись дополнительных сетевых данных

Если вы решили обратиться в службу поддержки, то соберите следующие сведения, чтобы ускорить устранение проблемы. Выберите одну виртуальную машину внутреннего пула, чтобы выполнить следующие проверки:

- Используйте команду PS ping с одной из внутренних виртуальных машин в виртуальной сети, чтобы проверить ответ порта пробы (пример: PS ping 10.0.0.4:3389) и записать результаты. 
- Если в результате этих проверок связи ответ не получен, то одновременно с выполнением команды PsPing запустите команду netsh trace на виртуальной машине внутреннего пула и тестовой виртуальной машине в виртуальной сети, а затем остановите команду netsh trace.

## <a name="load-balancer-in-failed-state"></a>Load Balancer в состоянии сбоя

**Решение**

- Определив ресурс, который находится в состоянии сбоя, перейдите к [Обозреватель ресурсов Azure](https://resources.azure.com/) и найдите ресурс в этом состоянии.
- Обновите переключатель в правом верхнем углу для чтения и записи.
- Щелкните Edit (изменить) для ресурса в состоянии Failed (сбой).
- Чтобы убедиться, что состояние подготовки изменено на успешно, нажмите кнопку "поместить", а затем — "получить".
- Затем можно продолжить работу с другими действиями, так как ресурс выходит из состояния сбоя.

## <a name="next-steps"></a>Дальнейшие действия

Если описанные выше действия не помогли устранить проблему, отправьте запрос в [службу поддержки](https://azure.microsoft.com/support/options/).
