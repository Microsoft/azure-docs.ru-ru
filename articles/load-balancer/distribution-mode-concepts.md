---
title: Режимы распространения Azure Load Balancer
description: Приступите к изучению различных режимов распространения Azure Load Balancer.
author: asudbring
ms.author: allensu
ms.service: load-balancer
ms.topic: article
ms.date: 02/04/2021
ms.custom: template-concept
ms.openlocfilehash: fcea2e962722773f59e73df898e0188c3f6454b6
ms.sourcegitcommit: 5b926f173fe52f92fcd882d86707df8315b28667
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/04/2021
ms.locfileid: "99551444"
---
# <a name="azure-load-balancer-distribution-modes"></a>Режимы распространения Azure Load Balancer

Azure Load Balancer поддерживает два режима распространения для маршрутизации подключений к приложению с балансировкой нагрузки:

* Hash based
* Сходство исходного IP-адреса

## <a name="hash-based"></a>Hash based

По умолчанию в качестве режима распределения в Azure Load Balancer используется хэш с пятью кортежами. 

Кортеж состоит из следующих элементов:
* **Исходный IP-адрес**
* **Исходный порт**
* **Конечный IP-адрес**
* **Порт назначения**
* **"Protocol type" (Тип протокола).**

Хэш используется для отображения трафика на доступные серверы. Алгоритм обеспечивает прикрепление только в рамках транспортного сеанса. Пакеты, находящиеся в одном сеансе, направляются в один и тот же IP-адрес центра обработки данных за конечную точку с балансировкой нагрузки. Когда клиент запускает новый сеанс из того же исходного IP-адреса, исходный порт изменяется и вызывает переход трафика в другую конечную точку центра обработки данных.

![Режим распределения с использованием хэша из пяти кортежей](./media/distribution-mode-concepts/load-balancer-distribution.png)

В режиме хэширования имеется один тип конфигурации:

* **Нет (на основе хэша)** . указывает, что последовательные запросы от одного клиента могут обрабатываться любой виртуальной машиной.

## <a name="source-ip-affinity"></a>Сходство исходного IP-адреса

Он также известен как соответствие сеансу или соответствие клиентскому IP-адресу. В режиме используется хэш с двумя кортежами (исходный IP-адрес и IP-адрес назначения) или с тремя кортежами (исходный IP-адрес, IP-адрес назначения и тип протокола) для отображения трафика на доступные серверы. 

При использовании сходства исходного IP-адреса подключения, запущенные с одного клиентского компьютера, отправляются в одну конечную точку центра обработки данных.

На следующем рисунке показана конфигурация из двух кортежей. Обратите внимание, как два кортежа выполняются через подсистему балансировки нагрузки к виртуальной машине 1 (VM1). Затем VM1 архивируется на виртуальных машинах VM2 и VM3.

![Режим распределения сходства сеансов с двумя кортежами](./media/load-balancer-distribution-mode/load-balancer-session-affinity.png)

Режим сходства исходного IP-адреса имеет два типа конфигурации:

* **IP-адрес клиента (сопоставление ИСХОДНОГО IP-адреса 2 — кортеж)** . указывает, что последовательные запросы с одного и того же IP-адресов клиента будут обрабатываться одной и той же виртуальной машиной.
* **IP-адрес клиента и протокол (сходство исходного IP-адреса 3 — кортеж)** . указывает, что последовательные запросы с одинаковой КОМБИНАЦИЕЙ IP-адресов и протоколов клиента будут обрабатываться одной и той же виртуальной машиной.

## <a name="use-cases"></a>Варианты использования

Сопоставление исходного IP-адреса с IP-адресом клиента и протоколом (сопоставление исходного IP-адреса 3 — кортеж) позволяет устранить несовместимость между Azure Load Balancer и удаленный рабочий стол шлюзом (шлюз удаленных рабочих столов). 

Другой сценарий использования — передача мультимедиа. В этом случае передача данных осуществляется по протоколу UDP, а управление — по протоколу TCP.

* Клиент запускает сеанс TCP для общедоступного адреса с балансировкой нагрузки и направляется на конкретный DIP. Сам канал остается активным, чтобы контролировать состояние подключения.
* Новый сеанс UDP с того же клиентского компьютера запускается на той же общедоступной конечной точке с балансировкой нагрузки. Подключение направляется на ту же конечную точку DIP, что и предыдущее TCP-подключение. Таким образом можно передавать мультимедиа с более высокой пропускной способностью, поддерживая при этом канал управления по TCP.

> [!NOTE]
> При изменении набора балансировки нагрузки (при добавлении или удалении виртуальной машины) распределение запросов клиента вычисляется заново. Нельзя полагаться на то, что новые подключения от существующих клиентов будут направлены на один сервер. Кроме того, использование режима распределения соответствия исходному IP-адресу может привести к неравномерному распределению трафика. Клиенты, работающие на прокси-серверах, могут рассматриваться как одно уникальное клиентское приложение.


## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения о настройке режима распределения для Azure Load Balancer см. в разделе [Настройка режима распределения для Azure Load Balancer](load-balancer-distribution-mode.md).

