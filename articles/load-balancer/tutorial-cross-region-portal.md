---
title: Руководство. Создание подсистемы балансировки нагрузки в нескольких регионах с помощью портала Azure
titleSuffix: Azure Load Balancer
description: Узнайте, как развернуть Azure Load Balancer в нескольких регионах с помощью портала Azure.
author: asudbring
ms.author: allensu
ms.service: load-balancer
ms.topic: tutorial
ms.date: 02/24/2021
ms.openlocfilehash: c16123fae63b89eff57b5c91864d9a947e01b386
ms.sourcegitcommit: f28ebb95ae9aaaff3f87d8388a09b41e0b3445b5
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/30/2021
ms.locfileid: "104576923"
---
# <a name="tutorial-create-a-cross-region-azure-load-balancer-using-the-azure-portal"></a>Руководство. Создание Azure Load Balancer в нескольких регионах с помощью портала Azure

Подсистема балансировки нагрузки в нескольких регионах обеспечивает глобальную доступность службы в разных регионах Azure. В случае сбоя одного региона его трафик направляется на подсистему балансировки нагрузки в ближайшем работоспособном регионе.  

В этом руководстве описано следующее.

> [!div class="checklist"]
> * создание подсистемы балансировки нагрузки в нескольких регионах;
> * создание серверного пула с двумя региональными подсистемами балансировки нагрузки;
> * Создайте правило балансировщика нагрузки.
> * тестирование подсистемы балансировки нагрузки.

Если у вас еще нет подписки Azure, [создайте бесплатную учетную запись Azure](https://azure.microsoft.com/free/?WT.mc_id=A261C142F), прежде чем начинать работу.

> [!IMPORTANT]
> Azure Load Balancer в нескольких регионах в настоящее время предоставляется в общедоступной предварительной версии.
> Эта предварительная версия предоставляется без соглашения об уровне обслуживания и не рекомендована для использования рабочей среде. Некоторые функции могут не поддерживаться или их возможности могут быть ограничены. Дополнительные сведения см. в статье [Дополнительные условия использования предварительных выпусков Microsoft Azure](https://azure.microsoft.com/support/legal/preview-supplemental-terms/).

## <a name="prerequisites"></a>Предварительные требования

- Подписка Azure.
- Два Azure Load Balancer ценовой категории **Стандартный**, серверные пулы которых развернуты в двух разных регионах Azure.
    - Сведения о том, как создать региональную подсистему балансировки нагрузки ценовой категории "Стандартный" и виртуальные машины для серверных пулов см. в кратком руководстве [ Создание общедоступной подсистемы балансировки нагрузки с помощью портала Azure для распределения нагрузки между виртуальными машинами](quickstart-load-balancer-standard-public-portal.md).
        - К именам подсистем балансировки нагрузки, виртуальных машин и других ресурсов в разных регионах добавьте **-R1** и **-R2**. 

## <a name="sign-in-to-azure-portal"></a>Вход на портал Azure

[Войдите](https://portal.azure.com) на портал Azure.

## <a name="create-cross-region-load-balancer"></a>Создание подсистемы балансировки нагрузки в нескольких регионах

В этом разделе показано, как создать подсистему балансировки нагрузки в нескольких регионах и общедоступный IP-адрес.

1. Выберите **Создать ресурс**. 
2. В поле поиска введите **подсистема балансировки нагрузки**. В результатах поиска выберите **Подсистема балансировки нагрузки**.
3. На странице **Подсистема балансировки нагрузки** щелкните **Создать**.
4. На странице **Создание подсистемы балансировки нагрузки** на вкладке **Основные сведения** укажите следующее. 

    | Параметр                 | Значение                                              |
    | ---                     | ---                                                |
    | Подписка               | Выберите свою подписку.    |    
    | Группа ресурсов         | Выберите **Создать** и введите **CreateCRLBTutorial-rg** в текстовое поле.|
    | Имя                   | Введите **myLoadBalancer-CR**.                                   |
    | Регион         | Выберите **(США) Западная часть США 2**.                                        |
    | Тип          | Щелкните **Общедоступный**.                                        |
    | номер SKU           | Оставьте значение по умолчанию **Стандартный**. |
    | Уровень           | Выберите **Глобальный**. |
    | Общедоступный IP-адрес | Выберите **Создать**.|
    | Имя общедоступного IP-адреса | Введите **myPublicIP-CR** в текстовое поле.|
    | Предпочтение маршрутизации| Выберите **Сеть Майкрософт**. </br> Дополнительные сведения о предпочтительном варианте маршрутизации см. в статье [Что такое предпочтение маршрутизации?](../virtual-network/routing-preference-overview.md) |

    > [!NOTE]
    > Систему балансировки нагрузки в нескольких регионах можно развернуть только в следующих домашних регионах: **Восточная часть США 2, Западная часть США, Западная Европа, Юго-Восточная Азия, Центральная часть США, Северная Европа, Азиатско-Тихоокеанский регион, Восточная Азия**. Дополнительные сведения см. в разделе **https://aka.ms/homeregionforglb**.


3. Оставьте значения по умолчанию для остальных параметров и нажмите кнопку **Просмотр и создание**.

4. На вкладке **Отзыв и создание** выберите **Создать**.   

    :::image type="content" source="./media/tutorial-cross-region-portal/create-cross-region.png" alt-text="Создание подсистемы балансировки нагрузки в нескольких регионах" border="true":::

## <a name="create-backend-pool"></a>Создание внутреннего пула

В этом разделе показано, как добавить в серверный пул две подсистемы балансировки нагрузки ценовой категории "Стандартный".

> [!IMPORTANT]
> Чтобы выполнить эти действия, в подписке должны быть развернуты две региональные подсистемы балансировки нагрузки с серверными пулами.  Дополнительные сведения см. в кратком руководстве **[ Создание общедоступной подсистемы балансировки нагрузки с помощью портала Azure для распределения нагрузки между виртуальными машинами](quickstart-load-balancer-standard-public-portal.md)** .

Создайте серверный пул адресов **myBackendPool-CR**, чтобы включить в него региональные подсистемы балансировки нагрузки ценовой категории "Стандартный".

1. В меню слева щелкните **Все службы**, выберите **Все ресурсы**, а затем в списке ресурсов выберите **myLoadBalancer-CR**.

2. В разделе **Параметры** выберите **Серверные пулы**, затем щелкните **Добавить**.

3. На странице **Добавление серверного пула** введите имя **myBackendPool-CR**.

4. Выберите **Добавить**.

4. Выберите **myBackendPool-CR**.

5. В разделе **Подсистемы балансировки нагрузки** щелкните раскрывающийся список **Подсистема балансировки нагрузки**.

5. Выберите **myLoadBalancer-R1** или другое имя, которое вы присвоили подсистеме балансировки нагрузки в регионе 1.

6. Щелкните раскрывающийся список в разделе **Конфигурация IP-адресов серверной части**. Выберите **LoadBalancerFrontend**.

7. Повторите шаги 4–6, чтобы добавить **myLoadBalancer-R2**.

8. Выберите **Добавить**.

    :::image type="content" source="./media/tutorial-cross-region-portal/add-to-backendpool.png" alt-text="Добавление региональных подсистем балансировки нагрузки в серверный пул" border="true":::

## <a name="create-a-health-probe"></a>Создание пробы работоспособности

В этом разделе показано, как создать пробу работоспособности для правила балансировки нагрузки со следующими характеристиками:

* имеет имя **myHealthProbe**;
* использует протокол **TCP**;
* интервал **5** секунд;
* пороговое значение неработоспособности **два** сбоя.

1. В меню слева щелкните **Все службы**, выберите **Все ресурсы**, а затем в списке ресурсов выберите **myLoadBalancer-CR**.

2. В разделе **Параметры** выберите **Зонды работоспособности**.

3. Для пробы работоспособности настройте следующие значения:

    | Параметр | Значение |
    | ------- | ----- |
    | Имя | Введите **myHealthProbe**. |
    | Протокол | Выберите **TCP**. |
    | Порт | Введите **80**. |
    | Интервал | Введите **5**. |
    | Пороговое значение сбоя | Введите **2**. |

4. Щелкните **ОК**.

    > [!NOTE]
    > Подсистема балансировки нагрузки в нескольких регионах имеет встроенную пробу работоспособности. Эта проба подставляется автоматически для создания правила балансировки нагрузки.  Дополнительные сведения см. в статье **[Ограничения подсистемы балансировки нагрузки в нескольких регионах](cross-region-overview.md#limitations)** .

## <a name="create-a-load-balancer-rule"></a>Создание правила балансировщика нагрузки

В этом разделе показано, как создать правило подсистемы балансировки нагрузки, которая имеет следующие характеристики:

* имеет имя **myHTTPRule**;
* находится в интерфейсной части с именем **LoadBalancerFrontEnd**;
* ожидает передачи данных на **порт 80**;
* отправляет трафик балансировки нагрузки в серверную часть с именем **myBackendPool-CR** через **порт 80**.

    > [!NOTE]
    > Интерфейсный порт должен соответствовать серверному порту и интерфейсному порту региональных подсистем балансировки нагрузки в серверном пуле.

1. В меню слева щелкните **Все службы**, выберите **Все ресурсы**, а затем в списке ресурсов выберите **myLoadBalancer-CR**.

2. В разделе **Параметры** выберите **Правила балансировки нагрузки**, а затем щелкните **Добавить**.

3. Для настройки правила балансировки нагрузки используйте следующие значения.
    
    | Параметр | Значение |
    | ------- | ----- |
    | Имя | Введите **myHTTPRule**. |
    | Версия IP-адреса | Выберите **IPv4**. |
    | Интерфейсный IP-адрес | Выберите **LoadBalancerFrontEnd**. |
    | Протокол | Выберите **TCP**. |
    | Порт | Введите **80**.|
    | Серверный порт | Введите **80**. |
    | Серверный пул | Выберите **myBackendPool**.|
    | Проверка работоспособности | Выберите **myHealthProbe**. |
    | Время ожидания простоя (в минутах) | Переместите ползунок на значение **15**. |
    | Сброс TCP | Щелкните **Включено**. |

4. Сохраните остальные значения по умолчанию и нажмите кнопку **ОК**.

    :::image type="content" source="./media/tutorial-cross-region-portal/create-lb-rule.png" alt-text="Создание правила подсистемы балансировки нагрузки" border="true":::

## <a name="test-the-load-balancer"></a>Тестирование подсистемы балансировки нагрузки

В этом разделе вы проверите подсистему балансировки нагрузки в нескольких регионах. С помощью веб-браузера вы подключитесь к общедоступному IP-адресу.  Вы остановите работу виртуальных машин в одном из серверных пулов подсистемы балансировки нагрузки, а затем отследите выполнение отработки отказа.

1. Найдите общедоступный IP-адрес для подсистемы балансировки нагрузки на экране **обзора**. В меню слева щелкните **Все службы**, выберите **Все ресурсы**, а затем — **myPublicIP-CR**.

2. Скопируйте общедоступный IP-адрес и вставьте его в адресную строку браузера. В браузере отобразится страница по умолчанию веб-сервера IIS.

    :::image type="content" source="./media/tutorial-cross-region-portal/test-cr-lb-1.png" alt-text="Проверка балансировщика нагрузки" border="true":::

3. Остановите все виртуальные машины в серверном пуле одной из региональных подсистем балансировки нагрузки.

4. Обновите страницу в веб-браузере и убедитесь, что отработка отказа в другую региональную подсистему балансировки нагрузки выполнена успешно.

    :::image type="content" source="./media/tutorial-cross-region-portal/test-cr-lb-2.png" alt-text="Тестовая подсистема балансировки нагрузки после отработки отказа" border="true":::

## <a name="clean-up-resources"></a>Очистка ресурсов

Ставшие ненужными группу ресурсов, подсистему балансировки нагрузки и все связанные ресурсы можно удалить. 

Для этого выберите группу ресурсов **CreateCRLBTutorial-rg**, которая содержит все эти ресурсы, и щелкните **Удалить**.

## <a name="next-steps"></a>Дальнейшие действия

Изучив это руководство, вы:

* создали подсистему балансировки нагрузки в нескольких регионах;
* добавили региональные подсистемы балансировки нагрузки в серверный пул подсистемы балансировки нагрузки в нескольких регионах;
* создали правило балансировки нагрузки;
* тестировать подсистему балансировки нагрузки.

Дополнительные сведения см. в следующей статье:
> [!div class="nextstepaction"]
> [Подсистема балансировки нагрузки между регионами (предварительная версия)](cross-region-overview.md)
