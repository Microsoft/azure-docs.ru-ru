---
title: Анализ данных с помощью машинного обучения Azure
description: Создание прогнозной модели машинного обучения с помощью Машинного обучения Azure и данных из Azure Synapse.
services: synapse-analytics
author: mlee3gsd
manager: craigg
ms.service: synapse-analytics
ms.topic: conceptual
ms.subservice: machine-learning
ms.date: 07/15/2020
ms.author: martinle
ms.reviewer: igorstan
ms.custom: seo-lt-2019
tag: azure-Synapse
ms.openlocfilehash: 76a154d3a137017f374247308a3980d598698246
ms.sourcegitcommit: b39cf769ce8e2eb7ea74cfdac6759a17a048b331
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/22/2021
ms.locfileid: "98678665"
---
# <a name="analyze-data-with-azure-machine-learning"></a>Анализ данных с помощью машинного обучения Azure

В этом руководстве для создания модели прогнозирования машинного обучения используется [конструктор машинное обучение Azure](../../machine-learning/concept-designer.md) . Модель основана на данных, хранящихся в Azure синапсе. Сценарий для учебника состоит в том, чтобы предсказать, что клиент, скорее всего, купит велосипед или не так, что компания Adventure Works, велосипед, может создать целевую маркетинговую кампанию.

## <a name="prerequisites"></a>Предварительные требования

Для пошагового изучения этого учебника потребуется следующее:

* пул SQL, предварительно загруженный с образцом данных AdventureWorksDW. Сведения о подготовке этого пула SQL см. в разделе [Создание пула SQL](create-data-warehouse-portal.md) и выборка загрузки демонстрационных данных. Если у вас уже есть хранилище данных, но нет демонстрационных данных, можно [загрузить образцы данных вручную](./load-data-from-azure-blob-storage-using-copy.md).
* Рабочая область машинного обучения Azure. Следуйте указаниям [этого учебника](../../machine-learning/how-to-manage-workspace.md) , чтобы создать новый.

## <a name="get-the-data"></a>Получение данных

Используемые данные находятся в представлении dbo. vTargetMail в AdventureWorksDW. Чтобы использовать хранилище данных в этом учебнике, данные сначала экспортируются в Azure Data Lake Storage учетной записи, так как Azure синапсе в настоящее время не поддерживает набор данных. Фабрику данных Azure можно использовать для экспорта данных из хранилища данных в Azure Data Lake Storage с помощью [действия копирования](../../data-factory/copy-activity-overview.md). Используйте следующий запрос для импорта:

```sql
SELECT [CustomerKey]
  ,[GeographyKey]
  ,[CustomerAlternateKey]
  ,[MaritalStatus]
  ,[Gender]
  ,cast ([YearlyIncome] as int) as SalaryYear
  ,[TotalChildren]
  ,[NumberChildrenAtHome]
  ,[EnglishEducation]
  ,[EnglishOccupation]
  ,[HouseOwnerFlag]
  ,[NumberCarsOwned]
  ,[CommuteDistance]
  ,[Region]
  ,[Age]
  ,[BikeBuyer]
FROM [dbo].[vTargetMail]
```

Когда данные доступны в Azure Data Lake Storage, хранилища данных в Машинное обучение Azure используются для [подключения к службам хранилища Azure](../../machine-learning/how-to-access-data.md). Выполните следующие действия, чтобы создать хранилище данных и соответствующий DataSet.

1. Запустите Машинное обучение Azure Studio из портал Azure или войдите в [машинное обучение Azure Studio](https://ml.azure.com/).

1. Щелкните **хранилища данных** в левой области в разделе **Управление** , а затем щелкните **создать хранилище данных**.

    :::image type="content" source="./media/sql-data-warehouse-get-started-analyze-with-azure-machine-learning/datastores-tab.png" alt-text="Снимок экрана левой панели интерфейса Машинное обучение Azure":::

1. Укажите имя хранилища данных, выберите тип "хранилище BLOB-объектов Azure", укажите расположение и учетные данные. Затем нажмите кнопку **Создать**.

1. Затем щелкните **наборы данных** в левой области в разделе **активы** . Выберите **создать набор данных** с параметром **из хранилища данных**.

1. Укажите имя набора данных и выберите тип, который будет **табличным**. Затем нажмите кнопку **Далее** , чтобы перейти вперед.

1. В **разделе Выбор или создание хранилища данных** выберите параметр **ранее созданное хранилище данных**. Выберите хранилище данных, которое было создано ранее. Нажмите кнопку Далее и укажите параметры пути и файла. Обязательно укажите заголовок столбца, если файлы содержат один из них.

1. Наконец, нажмите кнопку **создать** , чтобы создать набор данных.

## <a name="configure-designer-experiment"></a>Настройка эксперимента с конструктором

Затем выполните следующие действия для конфигурации конструктора:

1. Щелкните вкладку **конструктор** на левой панели в разделе **Автор** .

1. Выберите **простые в использовании готовые модули** для создания нового конвейера.

1. На панели Параметры справа укажите имя конвейера.

1. Кроме того, выберите целевой кластер вычислений для всего эксперимента на кнопке "Параметры" с ранее подготовленным кластером. Закройте панель Параметры.

## <a name="import-the-data"></a>Импорт данных

1. На левой панели под полем поиска выберите вкладку **наборы данных** .

1. Перетащите созданный ранее набор данных в холст.

    :::image type="content" source="./media/sql-data-warehouse-get-started-analyze-with-azure-machine-learning/import-dataset.png" alt-text="Снимок экрана модуля набора данных на холсте.":::

## <a name="clean-the-data"></a>Очистка данных

Для очистки данных удалите столбцы, которые не относятся к модели. Выполните инструкции, описанные ниже.

1. Выберите на левой панели вкладку **модули** .

1. В разделе **Data Transformation < Manipulation** (Преобразование данных < Манипуляции) перетащите модуль **Select Columns in Dataset** (Выбор столбцов в наборе данных) на холст. Подключите этот модуль к модулю **набора данных** .

    :::image type="content" source="./media/sql-data-warehouse-get-started-analyze-with-azure-machine-learning/select-columns-zoomed-in.png" alt-text="Снимок экрана: Модуль выбора столбцов на холсте." lightbox="./media/sql-data-warehouse-get-started-analyze-with-azure-machine-learning/select-columns-zoomed-out.png":::

1. Щелкните модуль, чтобы открыть панель свойств. Щелкните Изменить столбец, чтобы указать столбцы, которые нужно удалить.

1. Исключите два столбца. CustomerAlternateKey и GeographyKey. Щелкните **Сохранить**.

    :::image type="content" source="./media/sql-data-warehouse-get-started-analyze-with-azure-machine-learning/drop-columns.png" alt-text="Снимок экрана, показывающий удаленные столбцы.":::

## <a name="build-the-model"></a>Создание модели

Данные разбиваются на 80-20:80% для обучения модели машинного обучения и 20% для тестирования модели. В этой задаче двоичной классификации используются алгоритмы с двумя классами.

1. Перетащите модуль **Split Data (разделение данных** ) на холст.

1. На панели свойств введите 0,8 для **целой части строк в первом выходном наборе данных**.

    :::image type="content" source="./media/sql-data-warehouse-get-started-analyze-with-azure-machine-learning/split-data.png" alt-text="Снимок экрана, показывающий соотношение разбиения 0,8.":::

1. Перетащите на холст модуль **Двухклассовое увеличивающееся дерево принятия решений** .

1. Перетащите модуль **обучение модели** на холст. Укажите входные данные, подключив их к **высококлассному дереву принятия решений** (алгоритм машинного обучения) и **Разделите данные** (данные для обучения алгоритма).

1. Для модели обучение модели в параметре **столбец метки** на панели Свойства выберите Изменить столбец. Выберите столбец **BikeBuyer** в качестве прогнозируемого столбца и нажмите кнопку **сохранить**.

    :::image type="content" source="./media/sql-data-warehouse-get-started-analyze-with-azure-machine-learning/label-column.png" alt-text="Снимок экрана с выбранным столбцом меток BikeBuyer.":::

    :::image type="content" source="./media/sql-data-warehouse-get-started-analyze-with-azure-machine-learning/train-model.png" alt-text="Снимок экрана: модуль обучения модели, подключенный к Two-Class увеличивающегося дерева принятия решений и модулей разбиения данных.":::

## <a name="score-the-model"></a>Оценка модели

Теперь протестируйте, как модель выполняет тестовые данные. Два разных алгоритма будут сравниваться, чтобы увидеть, какой из них работает лучше. Выполните инструкции, описанные ниже.

1. Перетащите модуль **Score Model** (Оценка модели) на холст и подключите его к модулям **Обучение модели** и **Split Data** (Разделение данных).

1. Перетащите **перцептрона алгоритм Байеса с двумя классами** на холст эксперимента. Вы сравните, как этот алгоритм выполняет сравнение с Two-Class увеличивающимся деревом принятия решений.

1. Скопируйте и вставьте модули **обучение модели** и **оценки** на холст.

1. Перетащите на холст модуль **Оценка модели** для сравнения двух алгоритмов.

1. Нажмите кнопку **Отправить** , чтобы настроить выполнение конвейера.

    :::image type="content" source="./media/sql-data-warehouse-get-started-analyze-with-azure-machine-learning/algo-comparison-zoomed-in.png" alt-text="Снимок экрана всех оставшихся модулей на холсте." lightbox="./media/sql-data-warehouse-get-started-analyze-with-azure-machine-learning/algo-comparison-zoomed-out.png":::

1. После завершения выполнения щелкните правой кнопкой мыши модуль **Анализ модели** и выберите команду **визуализировать результаты оценки**.

    :::image type="content" source="./media/sql-data-warehouse-get-started-analyze-with-azure-machine-learning/result-visualize-zoomed-out.png" alt-text="Снимок экрана результатов.":::

Отображенные метрики представляют собой ROC-кривую, lift-кривую, а также диаграмму соотношения полноты и точности. Взгляните на эти метрики, чтобы убедиться, что первая модель выполнена лучше, чем вторая. Чтобы просмотреть прогнозы первой модели, щелкните правой кнопкой мыши модуль оценка модели и выберите команду визуализировать показательный набор данных, чтобы увидеть прогнозируемые результаты.

В тестовом наборе данных будут добавлены еще два столбца.

* Оценка вероятности: вероятность того, что клиент является покупателем велосипеда.
* Метка оценки: выполненная моделью классификация — покупатель велосипеда (1) или нет (0). Порог вероятности для маркировки равен 50 % и может быть изменен.

Сравните столбец BikeBuyer (фактический) с оцененными метками (прогноз), чтобы увидеть, насколько хорошо была выполнена модель. Затем эту модель можно использовать для прогнозирования новых клиентов. Вы можете [опубликовать эту модель как веб-службу](../../machine-learning/tutorial-designer-automobile-price-deploy.md) или записать результаты обратно в Azure синапсе.

## <a name="next-steps"></a>Следующие шаги

Дополнительные сведения о Машинное обучение Azure см. в статье [Введение в машинное обучение в Azure](../../machine-learning/overview-what-is-azure-ml.md).

Дополнительные сведения о встроенных оценках в хранилище данных см. [здесь](/sql/t-sql/queries/predict-transact-sql?view=azure-sqldw-latest&preserve-view=true).