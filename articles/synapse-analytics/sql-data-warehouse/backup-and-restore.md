---
title: Резервное копирование и восстановление — моментальные снимки, геоизбыточные
description: Узнайте, как работает резервное копирование и восстановление в выделенном пуле SQL Azure синапсе Analytics. Используйте резервные копии для восстановления хранилища данных в точку восстановления в основном регионе. Геоизбыточные резервные копии можно использовать для восстановления в другом географическом регионе.
services: synapse-analytics
author: kevinvngo
manager: craigg
ms.service: synapse-analytics
ms.topic: conceptual
ms.subservice: sql-dw
ms.date: 11/13/2020
ms.author: joanpo
ms.reviewer: igorstan
ms.custom: seo-lt-2019"
ms.openlocfilehash: b033fd9c0a7f752cf08d6e679facc9fa27b44037
ms.sourcegitcommit: aacbf77e4e40266e497b6073679642d97d110cda
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/12/2021
ms.locfileid: "98120212"
---
# <a name="backup-and-restore-in-azure-synapse-dedicated-sql-pool"></a>Резервное копирование и восстановление в выделенном пуле SQL Azure синапсе

Узнайте, как использовать резервное копирование и восстановление в выделенном пуле SQL Azure синапсе. Используйте выделенные точки восстановления пула SQL для восстановления или копирования хранилища данных в предыдущее состояние в основном регионе. а для восстановления в другом географическом регионе — геоизбыточные резервные копии хранилища данных.

## <a name="what-is-a-data-warehouse-snapshot"></a>Что такое моментальный снимок хранилища данных

*Моментальный снимок хранилища данных* создает точку восстановления, которую можно использовать для восстановления или копирования хранилища до предыдущего состояния.  Поскольку выделенный пул SQL является распределенной системой, моментальный снимок хранилища данных состоит из множества файлов, расположенных в службе хранилища Azure. Моментальные снимки фиксируют добавочные изменения в данных, содержащихся в хранилище данных.

*Восстановление хранилища данных* означает создание хранилища данных из точки восстановления существующего или удаленного хранилища данных. Восстановление хранилища данных является важной частью любой стратегии непрерывности бизнес-процессов и аварийного восстановления, так как позволяет воссоздать данные после случайного повреждения или удаления. Хранилище данных также является эффективном механизмом для создания копий вашего хранилища данных в целях тестирования или разработки. Выделенные скорости восстановления пула SQL могут различаться в зависимости от размера и расположения базы данных источника и целевого хранилища данных.

## <a name="automatic-restore-points"></a>Точки автоматического восстановления

Моментальные снимки — это встроенная функция, которая создает точки восстановления. Ее не нужно включать специально. Однако выделенный пул SQL должен находиться в активном состоянии для создания точки восстановления. Если она часто приостанавливается, то автоматическое создание точек восстановления может не быть создана, поэтому перед приостановкой выделенного пула SQL обязательно создайте определяемую пользователем точку восстановления. Пользователи в настоящее время не могут удалять точки автоматического восстановления, так как служба использует эти точки восстановления для обслуживания соглашений об уровне обслуживания для восстановления.

Моментальные снимки хранилища данных создаются в течение дня, создавая точки восстановления, доступные в течение семи дней. Этот срок нельзя изменить. Выделенный пул SQL поддерживает целевую точку восстановления в 8 часов (RPO). Вы можете восстановить хранилище данных в основном регионе до любого из моментальных снимков, доступных за последние семь дней.

Чтобы увидеть время запуска последнего моментального снимка, выполните этот запрос в выделенном сетевом пуле SQL.

```sql
select   top 1 *
from     sys.pdw_loader_backup_runs
order by run_id desc
;
```

## <a name="user-defined-restore-points"></a>Определяемые пользователем точки восстановления

Эта функция позволяет вручную активировать моментальные снимки для создания точек восстановления хранилища данных до и после больших изменений. Эта возможность обеспечивает логическую целостность точек восстановления, что обеспечивает дополнительную защиту данных в случае прерываний рабочей нагрузки или ошибок пользователя для быстрого восстановления. Пользовательские точки восстановления доступны в течение семи дней и автоматически удаляются от вашего имени. Пользователь не может самостоятельно изменить срок хранения пользовательских точек восстановления. Только **42 пользовательские точки восстановления** предоставляются в любой момент времени, поэтому лишние точки восстановления должны быть [удалены](/powershell/module/azurerm.sql/remove-azurermsqldatabaserestorepoint?viewFallbackFrom=azurermps-6.2.0) перед созданием новой точки. Вы можете активировать моментальные снимки для создания пользовательских точек восстановления с помощью [PowerShell](/powershell/module/az.sql/new-azsqldatabaserestorepoint?toc=/azure/synapse-analytics/sql-data-warehouse/toc.json&bc=/azure/synapse-analytics/sql-data-warehouse/breadcrumb/toc.jsont#examples) или портала Azure.

> [!NOTE]
> Если вам требуется хранить точки восстановления более 7 дней, проголосуйте за эту возможность [здесь](https://feedback.azure.com/forums/307516-sql-data-warehouse/suggestions/35114410-user-defined-retention-periods-for-restore-points). Вы также можете создать пользовательскую точку восстановления и восстановить ее из вновь созданной точки в новом хранилище данных. После восстановления вы получите выделенный пул SQL в сети и можете приостановить его на неопределенное время, чтобы сэкономить затраты на вычисление. Хранение приостановленной базы данных оплачивается по расценкам службы хранилища Azure уровня "Премиум". Если вам нужна активная копия восстановленного хранилища данных, вы можете возобновить ее, что займет всего несколько минут.

### <a name="restore-point-retention"></a>Хранение точки восстановления

Ниже приведены сведения о периодах хранения точек восстановления.

1. Выделенный пул SQL удаляет точку восстановления, когда она достигает 7-дневного срока хранения **и** если имеется по крайней мере 42 общих точек восстановления (включая как пользовательские, так и автоматические).
2. Моментальные снимки не выполняются при приостановке выделенного пула SQL.
3. Возраст точки восстановления измеряется в виде абсолютных календарных дней со времени, когда была сделана точка восстановления, включая время приостановки пула SQL.
4. В любой момент времени выделенный пул SQL гарантированно может хранить до 42 точек восстановления 42, определенных пользователем, и автоматических точек восстановления, если эти точки восстановления не достигли периода хранения в течение 7 дней.
5. При создании моментального снимка выделенный пул SQL затем приостанавливается в течение более 7 дней, а затем возобновляется, точка восстановления сохраняется до тех пор, пока не будет 42 общих точек восстановления (включая как пользовательские, так и автоматические).

### <a name="snapshot-retention-when-a-sql-pool-is-dropped"></a>Хранение моментальных снимков при удалении пула SQL

При удалении выделенного пула SQL создается окончательный моментальный снимок, который сохраняется в течение семи дней. Выделенный пул SQL можно восстановить в финальной точке восстановления, созданной при удалении. Если выделенный пул SQL сбрасывается в приостановленном состоянии, моментальный снимок не создается. В этом сценарии перед удалением выделенного пула SQL обязательно создайте определенную пользователем точку восстановления.

> [!IMPORTANT]
> При удалении сервера или рабочей области, в которой размещен выделенный пул SQL, все базы данных, принадлежащие серверу или рабочей области, также удаляются и не могут быть восстановлены. Удаленный сервер восстановить невозможно.

## <a name="geo-backups-and-disaster-recovery"></a>Геоархивы и аварийное восстановление

Географическое резервное копирование создается один раз в день в [парный центр обработки данных](../../best-practices-availability-paired-regions.md?toc=/azure/synapse-analytics/sql-data-warehouse/toc.json&bc=/azure/synapse-analytics/sql-data-warehouse/breadcrumb/toc.json). Целевая точка восстановления для геовосстановления составляет 24 часа. Геоархивацию можно восстановить на сервере в любом другом регионе, где поддерживается выделенный пул SQL. Геоархивация гарантирует, что вы сможете восстановить хранилище данных даже при отсутствии доступа к точкам восстановления, размещенным в основном регионе.

> [!NOTE]
> Если требуется более короткий интервал для геоархивации, [проголосуйте за эту возможность](https://feedback.azure.com/forums/307516-sql-data-warehouse). Вы также можете создать пользовательскую точку восстановления и восстановить ее из вновь созданной точки в новом хранилище данных в другом регионе. После восстановления вы получаете хранилище данных в сети и можете приостановить его на неограниченное время для экономии вычислительных ресурсов. Хранение приостановленной базы данных оплачивается по расценкам службы хранилища Azure уровня "Премиум". Если вам нужна активная копия хранилища данных, вы можете возобновить ее, что займет всего несколько минут.

## <a name="backup-and-restore-costs"></a>Стоимость резервного копирования и восстановления

Можно заметить, что в счете на оплату Azure содержится строка для обычного хранилища и хранилища аварийного восстановления. Плата за хранение — это общая стоимость хранения данных в основном регионе вместе с добавочными изменениями, захваченными моментальными снимками. Дополнительные сведения о том, как начисляется плата за моментальные снимки, см. [в этом разделе](/rest/api/storageservices/Understanding-How-Snapshots-Accrue-Charges?toc=/azure/synapse-analytics/sql-data-warehouse/toc.json&bc=/azure/synapse-analytics/sql-data-warehouse/breadcrumb/toc.json). Плата за использование геоизбыточного хранилища охватывает стоимость хранения геоархивов.  

Общая стоимость основного хранилища данных и изменений моментальных снимков за последние семь дней округляется до ближайшего терабайта. Например, если объем хранилища данных составляет 1,5 ТБ, а под моментальные снимки задействовано 100 ГБ, плата взимается за 2 ТБ данных по тарифам хранилища Azure класса Premium.

При использовании геоизбыточного хранилища плата за хранилище взимается отдельно. Геоизбыточное хранилище оплачивается по стандартному тарифу для географически избыточного хранилища с доступом на чтение (RA-GRS).

Дополнительные сведения о ценах на Azure синапсе см. на странице [цен на Azure синапсе](https://azure.microsoft.com/pricing/details/sql-data-warehouse/gen2/). При восстановлении между регионами не производится плата за исходящие данные.

## <a name="restoring-from-restore-points"></a>Восстановление из точек восстановления

Каждый моментальный снимок создает точку восстановления, которая представляет время начала создания моментального снимка. Для восстановления хранилища данных следует выбрать точку восстановления и выполнить команду restore.  

Можно сохранить восстановленное и текущее хранилища данных либо удалить один из них. Если вы хотите заменить текущее хранилище данных восстановленным хранилищем данных, его можно переименовать с помощью [инструкции ALTER DATABASE](/sql/t-sql/statements/alter-database-transact-sql?toc=/azure/synapse-analytics/sql-data-warehouse/toc.json&bc=/azure/synapse-analytics/sql-data-warehouse/breadcrumb/toc.json&view=azure-sqldw-latest) с параметром MODIFY Name.

Сведения о восстановлении хранилища данных см. в разделе [Восстановление выделенного пула SQL](sql-data-warehouse-restore-points.md#create-user-defined-restore-points-through-the-azure-portal).

Чтобы восстановить удаленное или приостановленное хранилище данных, вы можете [создать запрос в службу поддержки](sql-data-warehouse-get-started-create-support-ticket.md).

## <a name="cross-subscription-restore"></a>Восстановление между подписками

Если вам нужно напрямую восстановить по подписке, проголосовать за эту возможность [здесь](https://feedback.azure.com/forums/307516-sql-data-warehouse/suggestions/36256231-enable-support-for-cross-subscription-restore). Выполните восстановление на другой сервер и [Переместите](../../azure-resource-manager/management/move-resource-group-and-subscription.md?toc=/azure/synapse-analytics/sql-data-warehouse/toc.json&bc=/azure/synapse-analytics/sql-data-warehouse/breadcrumb/toc.json) сервер между подписками, чтобы выполнить восстановление между подписками.

## <a name="geo-redundant-restore"></a>Геоизбыточное восстановление

Вы можете [восстановить выделенный пул SQL](sql-data-warehouse-restore-from-geo-backup.md#restore-from-an-azure-geographical-region-through-powershell) в любом регионе, поддерживающем выделенный пул SQL на выбранном уровне производительности.

> [!NOTE]
> Чтобы выполнить географически избыточное восстановление, необходимо отказаться от этой функции.

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения о точках восстановления см. в разделе пользовательские [точки восстановления](sql-data-warehouse-restore-points.md) .