---
title: Мониторинг синапсе Analytics с помощью Azure Monitor
description: Узнайте, как отслеживать рабочую область синапсе Analytics с помощью метрик, оповещений и журналов Azure Monitor.
services: synapse-analytics
author: matt1883
ms.service: synapse-analytics
ms.topic: how-to
ms.subservice: monitoring
ms.date: 11/30/2020
ms.author: mahi
ms.reviewer: mahi
ms.openlocfilehash: ac5b1df5ff246623b73dbc41d18216396e6ed7ef
ms.sourcegitcommit: 7edadd4bf8f354abca0b253b3af98836212edd93
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/10/2021
ms.locfileid: "102549861"
---
# <a name="use-azure-monitor-with-your-azure-synapse-analytics-workspace"></a>Использование Azure Monitor с рабочей областью Azure синапсе Analytics

Облачные приложения являются сложными и имеют много движущихся частей. Мониторы предоставляют данные, помогающие обеспечить работоспособность приложений. Мониторы также помогают избежать потенциальных проблем и устранять неполадки в прошлом. Данные мониторинга можно использовать для получения глубокой информации о приложениях. Эти знания помогут повысить производительность и удобство обслуживания приложений. Она также помогает автоматизировать действия, которые в противном случае требуется вмешательство вручную.

Azure Monitor предоставляет метрики инфраструктуры базового уровня, оповещения и журналы для большинства служб Azure. Журналы диагностики Azure выдаются ресурсом. Они содержат подробные и своевременные данные о работе этого ресурса. Azure синапсе Analytics может записывать журналы диагностики в Azure Monitor.

Дополнительные сведения см. в статье [Общие сведения о службе Azure Monitor](../../azure-monitor/overview.md).

## <a name="metrics"></a>Метрики

С помощью монитора можно получить представление о производительности и работоспособности рабочих нагрузок Azure. Наиболее важным типом данных монитора является метрика, которая также называется счетчиком производительности. Метрики создаются большинством ресурсов Azure. Монитор предоставляет несколько способов настройки и использования этих метрик для мониторинга и устранения неполадок.

Чтобы получить доступ к этим метрикам, выполните инструкции в разделе [Azure Monitor Data Platform](../../azure-monitor/data-platform.md).

### <a name="workspace-level-metrics"></a>Метрики уровня рабочей области

Ниже приведены некоторые метрики, созданные рабочими областями.

| **Метрика**                           | **Категория метрик, отображаемое имя**                  | **Единица измерения** | **Типы агрегата** | **Описание**                |
|--------------------------------------|------------------------------------------|----------|----------------------|--------------------------------|
| интегратионактивитирунсендед         | Интеграция, метрика выполнения действий                     | Count    | Sum (по умолчанию), количество                | Общее число выполнений действий, произошедших или завершенных в течение 1 минуты. </br></br> Используйте измерение результата этой метрики для фильтрации по успешному, неудачному или отмененному конечному состоянию.|
| интегратионпипелинерунсендед         | Интеграция, метрика запуска конвейера                     | Count    | Sum (по умолчанию), количество                | Общее число выполнений конвейера, произошедших или завершенных в течение 1 минуты. </br></br> Используйте измерение результата этой метрики для фильтрации по успешному, неудачному или отмененному конечному состоянию. |
| интегратионтригжеррунсендед          | Интеграция, метрика запуска триггера                      | Count    | Sum (по умолчанию), количество                | Общее число запусков триггеров, произошедших или завершенных в течение 1 минуты. </br></br> Используйте измерение результата этой метрики для фильтрации по успешному, неудачному или отмененному конечному состоянию. |
| буилтинсклпулдатапроцесседбитес     | Встроенный пул SQL, обработанные данные (байты) | Byte | Sum (по умолчанию) | Объем данных, обработанных встроенным неиспользуемым сервером пулом SQL. |
| буилтинсклпуллогинаттемптс          | Встроенный пул SQL, попытки входа | Count | Sum (по умолчанию) | Число попыток входа для встроенного несерверного пула SQL. |
| буилтинсклпулдатарекуестсендед      | Встроенный пул SQL, завершено запросов (байт) | Count | Sum (по умолчанию) | Количество завершенных запросов SQL для встроенного несерверного пула SQL. </br></br> Используйте измерение результата этой метрики для фильтрации по конечному состоянию. |

### <a name="dedicated-sql-pool-metrics"></a>Метрики выделенного пула SQL

Ниже приведены некоторые метрики, созданные выделенными пулами SQL:

| **Метрика**                           | **Отображаемое имя**                  | **Единица измерения** | **Типы агрегата** | **Описание**                |
|--------------------------------------|------------------------------------------|----------|----------------------|--------------------------------|
| двулимит                            | Лимит DWU                       | Count   | Max (по умолчанию), min, AVG | Настроенный размер пула SQL |
| двуусед                             | DWU used                        | Count   | Max (по умолчанию), min, AVG | Представляет высокоуровневое представление использования в пуле SQL. Измеряется ограничением DWU * процент DWU |
| двууседперцент                      | Процент использованных DWU             | Процент | Max (по умолчанию), min, AVG | Представляет высокоуровневое представление использования в пуле SQL. Измеряется путем получения максимального значения в процентах между ЦП и операциями ввода-вывода данных |
| коннектионсблоккедбифиревалл        | Подключения, заблокированные брандмауэром | Count   | Sum (по умолчанию)   | Число подключений, заблокированных правилами брандмауэра. Повторное посещение политик управления доступом для пула SQL и отслеживание этих подключений при высоком числе |
| адаптивекачехитперцент             | Процент попаданий адаптивного кэша   | Процент | Max (по умолчанию), min, AVG | Измеряет, насколько хорошо работают рабочие нагрузки с адаптивным кэшем. Используйте эту метрику с метрикой Процент попадания в кэш, чтобы определить, следует ли масштабировать дополнительные ресурсы или перезапускать рабочие нагрузки для расконсервации кэша. |
| адаптивекачеуседперцент            | Используемый адаптивный кэш в процентах  | Процент | Max (по умолчанию), min, AVG | Измеряет, насколько хорошо работают рабочие нагрузки с адаптивным кэшем. Используйте эту метрику в процентах от метрики для определения необходимости масштабирования для дополнительной емкости или повторного запуска рабочих нагрузок для расконсервации кэша. |
| локалтемпдбуседперцент              | Процент использования локальной базы данных tempdb    | Процент | Max (по умолчанию), min, AVG | Использование локальной базы данных tempdb для всех вычислений-узлов — значения создаются каждые пять минут. |
| меморюседперцент                   | Процент используемой памяти          | Процент | Max (по умолчанию), min, AVG | Использование памяти на всех узлах в пуле SQL |
| Cpupercent присутствуют                          | Процент использования ЦП             | Процент | Max (по умолчанию), min, AVG | Загрузка ЦП на всех узлах в пуле SQL |
| Соединения                         | Соединения                     | Count   | Sum (по умолчанию)  | Общее число входов в пул SQL |
| активекуериес                      | Активные запросы                 | Count   | Sum (по умолчанию)   | Активные запросы. Использование этой метрики без фильтрации и без разделения отображает все активные запросы, выполняющиеся в системе |
| куеуедкуериес                      | Запросы в очереди                  | Count   | Sum (по умолчанию)   | Совокупное количество запросов, поставленных в очередь после достижения максимального предела параллелизма |
| влгактивекуериес                   | Активные запросы группы рабочей нагрузки   | Count   | Sum (по умолчанию)   | Активные запросы в группе рабочей нагрузки. Использование этой метрики без фильтрации и без разделения отображает все активные запросы, выполняющиеся в системе |
| влгактивекуериестимеаутс           | Время ожидания запросов группы рабочей нагрузки   | Count   | Sum (по умолчанию)   | Запросы для группы рабочей нагрузки, время ожидания которых истекло. Время ожидания запросов, сообщаемое этой метрикой, происходит только после начала выполнения запроса (он не включает время ожидания в связи с блокировкой или ожиданиями ресурсов). |
| влгкуеуедкуериес                   | Запросы в очереди группы рабочей нагрузки   | Count   | Sum (по умолчанию)   | Совокупное количество запросов, поставленных в очередь после достижения максимального предела параллелизма |
| влгаллокатионбисистемперцент        | Распределение группы рабочей нагрузки по процентам системы | Процент | Max (по умолчанию), min, AVG, Sum | Процент выделения ресурсов относительно всей системы |
| влгаллокатионбеффективекапресаурцеперцент   | Распределение группы рабочей нагрузки по максимальному проценту ресурсов | Процент | Max (по умолчанию), min, AVG | Отображает процент выделения ресурсов относительно эффективного процента ресурсов на группу рабочей нагрузки. Эта метрика обеспечивает эффективное использование группы рабочей нагрузки. |
| влжеффективекапресаурцеперцент      | Действующее ограничение процента ресурсов  | Процент | Max (по умолчанию), min, AVG | Процент эффективных ресурсов ограничения для группы рабочей нагрузки. Если имеются другие группы рабочей нагрузки с min_percentage_resource > 0, effective_cap_percentage_resource меньше пропорционально |
| влжеффективеминресаурцеперцент      | Действующий минимальный процент ресурсов  | Процент | Max (по умолчанию), min, AVG, Sum | Допустимый параметр в процентах для минимального ресурса min, учитывая уровень обслуживания и параметры группы рабочей нагрузки. Эффективный min_percentage_resource можно изменить выше на более низких уровнях обслуживания. |

### <a name="apache-spark-pool-metrics"></a>Метрики пула Apache Spark

Ниже приведены некоторые метрики, созданные пулами Apache Spark.

| **Метрика**                           | **Категория метрик, отображаемое имя**                  | **Единица измерения** | **Типы агрегата** | **Описание**                |
|--------------------------------------|------------------------------------------|----------|----------------------|--------------------------------|
| бигдатапулаппликатионсендед  | Завершенные Apache Spark приложения  | Count | Sum (по умолчанию) | Число завершенных приложений пула Apache Spark |
| бигдатапулаллокатедкорес     | Число виртуальных ядер, выделенных для пула Apache Spark                 | Count | Max (по умолчанию), min, AVG | Выделенный виртуальных ядер для пула Apache Spark |
| бигдатапулаллокатедмемори    | Объем памяти (в ГБ), выделенной для пула Apache Spark            | Count | Max (по умолчанию), min, AVG | Выделенная память для пула Apache Spark (ГБ) |
| бигдатапулаппликатионсактиве | Активные Apache Spark приложения | Count | Max (по умолчанию), min, AVG | Число активных приложений пула Apache Spark |

## <a name="alerts"></a>видны узлы

Войдите в портал Azure и выберите **Monitor**  >  **Alerts (монитор оповещений** ), чтобы создать оповещения.

### <a name="create-alerts"></a>Создание предупреждений

1. Нажмите кнопку **+ Новое правило генерации оповещений**, чтобы создать оповещение.

1. Определите **условие оповещения** , определяющее, когда должно срабатывать предупреждение.

    > [!NOTE]
    > Убедитесь, что в раскрывающемся списке **Фильтровать по типу ресурсов** выбрано значение **все** .

1. Укажите **сведения о предупреждении** , чтобы дополнительно указать, как должно быть настроено оповещение.

1. Определите **группу действий** , чтобы определить, кто должен получить оповещения (и как).

## <a name="logs"></a>Журналы

### <a name="workspace-level-logs"></a>Журналы уровня рабочей области

Ниже приведены журналы, созданные рабочими областями Azure синапсе Analytics:

| Имя таблицы Log Analytics | Имя категории журнала                 | Описание |
|-------------------------------|-------------------------------------------------|-------------|
| SynapseGatewayApiRequests     | гатевайапирекуестс             | Запросы API шлюза Azure синапсе. |
| SynapseRbacOperations         | SynapseRbacOperations          | Операции управления доступом на основе ролей (СРБАК) в Azure синапсе. |

### <a name="dedicated-sql-pool-logs"></a>Журналы выделенного пула SQL

Ниже приведены журналы, созданные выделенными пулами SQL:

| Имя таблицы Log Analytics        | Имя категории журнала             | Описание |
|----------------------|--------------------------------------|-------------|
| SynapseSqlPoolExecRequests  | ExecRequests | Сведения о запросах SQL и запросах в выделенном пуле SQL Azure синапсе.
| SynapseSqlPoolDmsWorkers    | DmsWorkers   | Сведения о сотрудниках, выполняющих шаги DMS в выделенном пуле SQL Azure синапсе.
| SynapseSqlPoolRequestSteps  | RequestSteps | Сведения о шагах запроса, которые составляют данный запрос или запрос SQL в выделенном пуле SQL Azure синапсе.
| SynapseSqlPoolSqlRequests   | SqlRequests  | Сведения о распределениях запросов шагов SQL-запросов и запросов в выделенном пуле SQL Azure синапсе.
| SynapseSqlPoolWaits         | Ожидания        | Сведения о состояниях ожидания, возникших при выполнении запроса или запроса SQL в выделенном пуле SQL Azure синапсе, включая блокировки и ожидание в очередях передачи.

Дополнительные сведения об этих журналах см. в следующих сведениях:
- [sys.dm_pdw_exec_requests](/sql/relational-databases/system-dynamic-management-views/sys-dm-pdw-exec-requests-transact-sql?view=azure-sqldw-latest&preserve-view=true)
- [sys.dm_pdw_request_steps](/sql/relational-databases/system-dynamic-management-views/sys-dm-pdw-request-steps-transact-sql?view=azure-sqldw-latest&preserve-view=true)
- [sys.dm_pdw_dms_workers](/sql/relational-databases/system-dynamic-management-views/sys-dm-pdw-dms-workers-transact-sql?view=azure-sqldw-latest&preserve-view=true)
- [sys.dm_pdw_waits](/sql/relational-databases/system-dynamic-management-views/sys-dm-pdw-waits-transact-sql?view=azure-sqldw-latest&preserve-view=true)
- [sys.dm_pdw_sql_requests](/sql/relational-databases/system-dynamic-management-views/sys-dm-pdw-sql-requests-transact-sql?view=azure-sqldw-latest&preserve-view=true)

### <a name="apache-spark-pool-log"></a>Журнал Apache Spark пула

Ниже приведен журнал, созданный пулами Apache Spark:

| Имя таблицы Log Analytics               | Имя категории журнала              | Описание                 |
|-----------------------------|---------------------------------------|-----------------------------|
| SynapseBigDataPoolApplicationsEnded | бигдатапулаппсендед | Сведения о завершенных Apache Spark приложениях |

### <a name="diagnostic-settings"></a>Параметры диагностики

Используйте параметры диагностики, чтобы настроить журналы диагностики для нерасчетных ресурсов. Параметры для элемента управления ресурсами имеют следующие характеристики.

* Они указывают, куда отправляются журналы диагностики. Примеры включают учетную запись хранения Azure, концентратор событий Azure или журналы мониторинга.
* Они указывают, какие категории журналов отправляются.
* Они определяют, как долго каждая категория журнала должна храниться в учетной записи хранения.
* Срок хранения 0 дней означает, что журналы хранятся неограниченно долго. В противном случае значение может быть любым числом дней от 1 до 2 147 483 647.
* Если политики хранения заданы, но хранение журналов в учетной записи хранения отключено, политики хранения не будут действовать. Например, это может произойти, если выбраны только параметры концентраторов событий или мониторинга журналов.
* Политики хранения применяются в день. Граница между днями выполняется в полночь в формате UTC. В конце дня журналы удаляются из числа дней, которые выходят за пределы политики хранения. Например, если у вас есть политика хранения на один день, то в начале текущей версии журналы с до вчерашнего дня удаляются.

С помощью Azure Monitor параметров диагностики можно направить журналы диагностики для анализа в несколько разных целевых объектов.

* **Учетная запись хранения**. сохраняйте журналы диагностики в учетную запись хранения для аудита или проверки вручную. Параметры диагностики можно использовать для указания времени хранения в днях.
* **Концентратор событий**: потоковая передача журналов в концентраторы событий Azure. Журналы становятся входными данными для партнерской службы или пользовательского аналитического решения, например Power BI.
* **Рабочая область log Analytics**: анализ журналов с помощью log Analytics. Интеграция Azure синапсе с Log Analytics полезна в следующих сценариях:
  * Вы хотите писать сложные запросы на обширный набор метрик, опубликованных Azure синапсе для Log Analytics. Вы можете создавать пользовательские предупреждения для этих запросов с помощью Azure Monitor.
  * Требуется отслеживать между рабочими областями. Данные из нескольких рабочих областей можно направить в одну рабочую область Log Analytics.

Вы также можете использовать учетную запись хранения или пространство имен концентратора событий, не подписку на ресурс, который создает журналы. Пользователь, который настраивает этот параметр, должен иметь доступ к обеим подпискам с помощью управления доступом на основе ролей Azure (Azure RBAC).

#### <a name="configure-diagnostic-settings"></a>Настройка параметров диагностики

Создайте или добавьте параметры диагностики для рабочей области, выделенного пула SQL или пула Apache Spark.

1. На портале перейдите к разделу монитор. Выберите **Параметры** параметры  >  **диагностики**.

1. Выберите рабочую область синапсе, выделенный пул SQL или пул Apache Spark, для которого требуется создать параметр диагностики.

1. Если в выбранной рабочей области не существует параметров диагностики, вам будет предложено создать параметр. Выберите **Включить диагностику**.

   Если в рабочей области есть параметры диагностики, вы увидите список параметров, уже настроенных для ресурса. Выберите **Добавить параметр диагностики**.

1. Присвойте параметру имя, выберите **отправить log Analytics**, а затем выберите рабочую область из **log Analytics рабочей области**.

    > [!NOTE]
    > Так как таблица журналов Azure не может содержать более 500 столбцов, мы **настоятельно рекомендуем** выбрать _режим для конкретного ресурса_. Дополнительные сведения см. в разделе [Справочник по журналам AzureDiagnostics](/azure-monitor/reference/tables/azurediagnostics#additionalfields-column).

1. Щелкните **Сохранить**.

Через несколько секунд новый параметр появится в списке параметров для рабочей области, выделенного пула SQL или пула Apache Spark. Журналы диагностики передаются в эту рабочую область, как только создаются новые данные о событиях. Между созданием события и его отображением в Log Analytics может пройти до 15 минут.

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения о выполнении конвейера мониторинга см. в статье [конвейер мониторинга, выполняемый в синапсе Studio](how-to-monitor-pipeline-runs.md) . 

Дополнительные сведения о мониторинге Apache Spark приложений см. в статье [мониторинг Apache Spark приложений в синапсе Studio](apache-spark-applications.md) .

Дополнительные сведения о мониторинге запросов SQL см. в статье [мониторинг запросов SQL в синапсе Studio](how-to-monitor-sql-requests.md) .
