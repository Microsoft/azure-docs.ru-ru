---
title: О проектировании VPN-шлюза Azure
description: Узнайте о способах проектирования топологии VPN-шлюза для подключения к виртуальным сетям Azure.
services: vpn-gateway
author: cherylmc
Customer intent: As someone with a basic network background, but is new to Azure, I want to understand the capabilities of Azure VPN Gateway so that I can securely connect to my Azure virtual networks.
ms.service: vpn-gateway
ms.topic: article
ms.date: 09/03/2020
ms.author: cherylmc
ms.openlocfilehash: 61732f66aef58f5a9edcb9e095782e19e8aaffdd
ms.sourcegitcommit: 772eb9c6684dd4864e0ba507945a83e48b8c16f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "91397221"
---
# <a name="vpn-gateway-design"></a>Структура VPN-шлюза

Важно знать, что существуют различные конфигурации подключения к VPN-шлюзу. Вам нужно определить, какая из конфигураций наилучшим образом соответствует вашим требованиям. В следующих разделах можно просмотреть сведения о проекте и схемах топологии по следующим подключениям VPN-шлюза. Представленные здесь схемы и описания помогут вам выбрать топологию подключения в соответствии со своими требованиями. На схемах показаны основные базовые топологии, но можно создавать более сложные конфигурации, используя схемы как рекомендации.

## <a name="site-to-site-and-multi-site-ipsecike-vpn-tunnel"></a><a name="s2smulti"></a>"Сеть — сеть" и "несколько сайтов" (VPN-туннель IPsec/IKE)

### <a name="site-to-site"></a><a name="S2S"></a>Сеть — сеть

Подключение типа "сеть — сеть" (S2S) через VPN-шлюз — это подключение через туннель VPN по протоколу IPsec/IKE (IKEv1 или IKEv2). Подключения типа "сеть — сеть" можно использовать для распределенных и гибридных конфигураций. Для подключения типа "сеть — сеть" требуется локальное VPN-устройство, которому назначен общедоступный IP-адрес. Дополнительные сведения о выборе VPN-устройства см. в [этом разделе](vpn-gateway-vpn-faq.md#s2s).

![Пример подключения типа "сеть — сеть" через VPN-шлюз Azure](./media/design/vpngateway-site-to-site-connection-diagram.png)

VPN-шлюз можно настроить в активном режиме, используя один общедоступный IP-адрес или в режиме "активный — активный", используя два общедоступных адреса. В режиме "активный — ждущий режим" активен один туннель IPsec, а другой — в режиме ожидания. В этой настройке трафик проходит через активный туннель, и если проблема возникает с этим туннелем, трафик переключается на резервный туннель. Настройка VPN-шлюза в режиме "активный — активный" *рекомендуется* в том случае, если оба туннеля IPsec одновременно активны, с одновременной передачей данных через оба туннеля. Дополнительное преимущество режима "активный — активный" заключается в том, что клиенты имеют более высокую пропускную способность.

### <a name="multi-site"></a><a name="Multi"></a>Несколько сайтов

Такой тип подключения является вариантом подключения типа "сеть — сеть". В шлюзе виртуальной сети создается несколько VPN-подключений, как правило, к разным локальным сайтам. При работе с несколькими подключениями следует использовать тип VPN "RouteBased" (динамический шлюз для работы с классическими виртуальными сетями). Так как каждая виртуальная сеть может иметь только один VPN-шлюз, доступную пропускную способность шлюза используют все подключения. Этот тип подключения часто называется многосайтовым.

![Пример многосайтового подключения через VPN-шлюз Azure](./media/design/vpngateway-multisite-connection-diagram.png)

### <a name="deployment-models-and-methods-for-site-to-site-and-multi-site"></a>Модели и методы развертывания для подключений "сеть — сеть" и многосайтовых подключений

[!INCLUDE [site-to-site and multi-site table](../../includes/vpn-gateway-table-site-to-site-include.md)]

## <a name="point-to-site-vpn"></a><a name="P2S"></a>VPN-подключение типа "точка — сеть"

Подключение типа "точка — сеть" через VPN-шлюз позволяет создать безопасное подключение к виртуальной сети с отдельного клиентского компьютера. Подключение типа "точка — сеть" сначала устанавливается на клиентском компьютере. Это эффективное решение для сотрудников, которым нужно подключаться к виртуальным сетям Azure из удаленного расположения, например, если они находятся дома или на конференции. Такую конфигурацию также удобно использовать вместо VPN-подключения типа "сеть — сеть" при наличии небольшого числа клиентов, которым требуется подключение к виртуальной сети.

В отличие от подключений типа "сеть — сеть", для подключений типа "точка — сеть" локальный общедоступный IP-адрес или VPN-устройство не требуются. Подключения типа "точка — сеть" можно использовать с подключениями "сеть — сеть" через один и тот же VPN-шлюз при условии совместимости всех требований к конфигурации для обоих типов подключений. См. дополнительные сведения о [подключениях типа "точка — сеть"](point-to-site-about.md).

![Пример подключения типа "точка — сеть" через VPN-шлюз Azure](./media/design/point-to-site.png)

### <a name="deployment-models-and-methods-for-p2s"></a>Модели и методы развертывания для типа подключения "точка — сеть"

[!INCLUDE [vpn-gateway-table-site-to-site](../../includes/vpn-gateway-table-point-to-site-include.md)]

## <a name="vnet-to-vnet-connections-ipsecike-vpn-tunnel"></a><a name="V2V"></a>Подключение между виртуальными сетями (через VPN-туннель IPsec/IKE)

Подключение типа "виртуальная сеть — виртуальная сеть" похоже на подключение виртуальной сети к локальному сайту. В обоих типах подключений используется VPN-шлюз для создания защищенного туннеля, использующего IPsec/IKE. Можно даже комбинировать подключение между виртуальными сетями с конфигурациями многосайтовых подключений. Это позволяет настраивать топологии сети, совмещающие распределенные подключения с подключениями между виртуальными сетями.

Подключаемые виртуальные сети могут относиться:

* к одному или разным регионам;
* к одной или разным подпискам; 
* к одной или разным моделям развертывания.

![Пример подключения типа "виртуальная сеть — виртуальная сеть" через VPN-шлюз Azure](./media/design/vpngateway-vnet-to-vnet-connection-diagram.png)

### <a name="connections-between-deployment-models"></a>Подключения между моделями развертывания

Сейчас в Azure доступны два режима развертывания: классический и Resource Manager. Если вы использовали Azure какое-то время, вероятно, у вас есть виртуальные машины и роли экземпляров Azure, выполняемые в классической виртуальной сети. А более новые виртуальные машины и экземпляры ролей могут выполняться в виртуальной сети, созданной Resource Manager. Вы можете создать подключение между виртуальными сетями, чтобы ресурсы в одной виртуальной сети непосредственно взаимодействовали с ресурсами в другой.

### <a name="vnet-peering"></a>Пиринговая связь между виртуальными сетями

Для создания подключения можно использовать пиринговую связь между виртуальными сетями, если виртуальная сеть соответствует определенным требованиям. При пиринговой связи между виртуальными сетями шлюз виртуальной сети не используется. Дополнительную информацию см. в статье [Пиринговая связь между виртуальными сетями](../virtual-network/virtual-network-peering-overview.md).

### <a name="deployment-models-and-methods-for-vnet-to-vnet"></a>Модели и методы развертывания для подключения между виртуальными сетями

[!INCLUDE [vpn-gateway-table-vnet-to-vnet](../../includes/vpn-gateway-table-vnet-to-vnet-include.md)]

## <a name="expressroute-private-connection"></a><a name="ExpressRoute"></a>ExpressRoute (частное подключение)

ExpressRoute позволяет переносить локальные сети в Microsoft Cloud по частному подключению, которое обеспечивается поставщиком услуг подключения. ExpressRoute позволяет устанавливать подключения к облачным службам Майкрософт, таким как Microsoft Azure, Microsoft 365 и CRM Online. Это может быть подключение типа "любой к любому" (IP VPN), подключение Ethernet типа "точка-точка" или виртуальное кросс-подключение через поставщика услуг подключения на совместно используемом сервере.

Подключения ExpressRoute не проходят через общедоступный Интернет. Это обеспечивает повышенный уровень безопасности, надежности и быстродействия подключений ExpressRoute и более низкий уровень задержки по сравнению с типовыми подключениями через Интернет.

При подключениях с помощью ExpressRoute используется шлюз виртуальной сети, который является частью его базовой конфигурации. В подключении ExpressRoute для шлюза виртуальной сети задается тип шлюза "ExpressRoute", а не "Vpn". Хотя трафик, который передается по каналу ExpressRoute, не зашифрован по умолчанию, вы можете создать решение, которое позволяет отправить зашифрованный трафик по каналу ExpressRoute. Дополнительные сведения об ExpressRoute см. в [техническом обзоре ExpressRoute](../expressroute/expressroute-introduction.md).

## <a name="site-to-site-and-expressroute-coexisting-connections"></a><a name="coexisting"></a>Параллельные подключения "сеть — сеть" и ExpressRoute

ExpressRoute — это прямое частное подключение из глобальной сети (а не через общедоступное подключение к Интернету) к службам Майкрософт, включая Azure. Трафик подключения VPN типа "сеть — сеть" проходит через общедоступный Интернет в зашифрованном виде. Возможность настраивать VPN-подключения типа "сеть — сеть" и ExpressRoute для одной виртуальной сети дает целый ряд преимуществ.

VPN типа "сеть — сеть" можно настроить как защищенный путь отработки отказа для ExpressRoute или использовать для подключения к сайтам, которые не входят в вашу сеть, но подключены через ExpressRoute. Обратите внимание, что в рамках такой конфигурации для одной виртуальной сети требуются два шлюза виртуальной сети: с типом "VPN" и типом "ExpressRoute".

![Пример параллельных подключений через ExpressRoute и VPN-шлюз](./media/design/expressroute-vpngateway-coexisting-connections-diagram.png)

### <a name="deployment-models-and-methods-for-s2s-and-expressroute-coexist"></a>Модели и методы развертывания для параллельных подключений "сеть — сеть" и ExpressRoute

[!INCLUDE [vpn-gateway-table-coexist](../../includes/vpn-gateway-table-coexist-include.md)]

## <a name="highly-available-connections"></a><a name="highly-available"></a>Высокодоступные подключения

Сведения о планировании и проектировании высокодоступных подключений см. в статье [подключения высокой](vpn-gateway-highlyavailable.md)надежности.

## <a name="next-steps"></a>Дальнейшие действия

* Дополнительные сведения см. в статье [VPN-шлюз: вопросы и ответы](vpn-gateway-vpn-faq.md).

* Дополнительные сведения о [параметрах конфигурации VPN-шлюза](vpn-gateway-about-vpn-gateway-settings.md).

* Рекомендации по BGP для VPN-шлюза см. в разделе [About BGP](vpn-gateway-bgp-overview.md).

* См. дополнительные сведения об [ограничениях подписки и службы](../azure-resource-manager/management/azure-subscription-service-limits.md#networking-limits).

* Дополнительные сведения о некоторых других ключевых [сетевых возможностях](../networking/networking-overview.md) Azure.
