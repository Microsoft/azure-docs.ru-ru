---
title: Основные понятия, связанные с Аттестацией Azure
description: Основные понятия, связанные с Аттестацией Azure.
services: attestation
author: msmbaldwin
ms.service: attestation
ms.topic: overview
ms.date: 08/31/2020
ms.author: mbaldwin
ms.openlocfilehash: c6c09dc771692cb2fc2f36840e729874cfaf2d09
ms.sourcegitcommit: 65cef6e5d7c2827cf1194451c8f26a3458bc310a
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/19/2021
ms.locfileid: "98572822"
---
# <a name="basic-concepts"></a>Основные понятия

Ниже перечислены некоторые основные понятия, связанные с Аттестацией Microsoft Azure.

## <a name="json-web-token-jwt"></a>JSON Web Token (JWT)

[JSON Web Token](https://jwt.io/) (JWT) — это открытый метод, соответствующий стандарту [RFC7519](https://tools.ietf.org/html/rfc7519), для безопасной передачи информации между сторонами в формате JSON (нотация объектов JavaScript). Эти сведения можно проверить и считать доверенными благодаря наличию цифровой подписи. Токены JWT можно подписывать с помощью секрета или пары открытого и закрытого ключей.

## <a name="json-web-key-jwk"></a>JSON Web Key (JWK)

[JSON Web Key](https://tools.ietf.org/html/rfc7517) (JWK) — это структура данных в формате JSON для представления криптографических ключей. Также эта спецификация определяет структуру данных JSON для представления набора ключей JWK.

## <a name="attestation-provider"></a>Поставщик аттестации

Поставщик аттестации относится к поставщику ресурсов Azure с именем Microsoft.Attestation. Поставщик ресурсов — это конечная точка службы, которая предоставляет контракт Аттестации Azure с поддержкой REST и развертывается с помощью [Azure Resource Manager](../azure-resource-manager/management/overview.md). Каждый поставщик аттестации обеспечивает соблюдение определенной политики с поддержкой обнаружения. Поставщики аттестации с политикой по умолчанию создаются для каждого типа аттестации (обратите внимание, что для анклав VBS не имеет политики по умолчанию). Дополнительные сведения о политике по умолчанию для SGX см. в разделе с [примерами политик аттестации](policy-examples.md).

### <a name="regional-default-provider"></a>Региональный поставщик по умолчанию

Аттестация Azure предоставляет поставщик по умолчанию в каждом регионе. Клиенты могут применять для аттестации поставщик по умолчанию или создавать собственные поставщики с настраиваемыми политиками. Поставщики по умолчанию доступны для любого пользователя Azure AD, а связанные с ними политики нельзя изменять.

| Регион | URI для аттестации | 
|--|--|
| Восточная часть США | `https://sharedeus.eus.attest.azure.net` | 
| западная часть США | `https://sharedwus.wus.attest.azure.net` | 
| южная часть Соединенного Королевства | `https://shareduks.uks.attest.azure.net` | 
| западная часть Соединенного Королевства| `https://sharedukw.ukw.attest.azure.net  ` | 
| Восточная Канада | `https://sharedcae.cae.attest.azure.net` | 
| Центральная Канада | `https://sharedcac.cac.attest.azure.net` | 
| Северная Европа | `https://sharedneu.neu.attest.azure.net` | 
| Западная Европа| `https://sharedweu.weu.attest.azure.net` | 
| Восточная часть США 2 | `https://sharedeus2.eus2.attest.azure.net` | 
| Центральная часть США | `https://sharedcus.cus.attest.azure.net` | 

## <a name="attestation-request"></a>Запрос на аттестацию

Запрос на аттестацию — это сериализованный объект JSON, который отправляется от клиентского приложения поставщику аттестации. Объект запроса для анклава SGX содержит два свойства: 
- свойство Quote, значение которого — это строковое представление предложения на аттестацию в кодировке Base64URL;
- свойство EnclaveHeldData, значение которого — это строковое представление Enclave Held Data в кодировке Base64URL.

Аттестация Azure проверяет значение Quote, полученное, а затем проверяет наличие хэш-кода SHA256 для Enclave Held Data в первых 32 байтах поля reportData в предложении на аттестацию. 

## <a name="attestation-policy"></a>Политика аттестации

Политика аттестации применяется для обработки свидетельства аттестации и доступна для изменения клиентами. В основе Аттестации Azure лежит обработчик политик, который обрабатывает все утверждения, входящие в свидетельство. Политики определяют, должна ли Аттестация Azure выдать токен аттестации на основе свидетельства, подтверждая доверие к аттестуемому. Соответственно, если не все политики соблюдаются, токен JWT не выдается.

Если политика по умолчанию в поставщике аттестации не соответствует требованиям, клиенты смогут создавать пользовательские политики в любом из регионов, поддерживаемых Аттестацией Azure. Управление политиками — это ключевая возможность для клиентов, предоставляемая Аттестацией Azure. Политики зависят от конкретного типа аттестации и могут применяться для идентификации анклавов, добавления утверждений в исходящие токены или изменения уже включенных в них утверждений. 

Примеры политик см. в статье [Примеры политики аттестации](policy-examples.md).

## <a name="benefits-of-policy-signing"></a>Преимущества подписывания политик

Политика аттестации в конечном итоге определяет, будет ли выдан токен аттестации Аттестацией Azure. Эта же политика определяет, какие утверждения будут включены в токен аттестации. Таким образом, крайне важно, чтобы политика, оцениваемая службой, фактически являлась политикой, написанной администратором, и не была подделана или изменена внешними сущностями. 

Модель доверия определяет модель авторизации поставщика аттестации для определения и обновления политики.  Здесь поддерживаются две модели. Одна из них основана на авторизации AAD, а вторая — на владении управляемыми клиентом криптографическими ключами (изолированная модель).  Изолированная модель позволяет Аттестации Azure гарантировать оригинальность политики, предоставленной клиентом.

При использовании изолированной модели администратор создает поставщик аттестации путем определения и размещения в файле набора доверенных сертификатов X.509. Затем в созданный поставщик аттестации администратор добавляет подписанную политику. При обработке запроса на аттестацию Аттестация Azure проверяет подпись этой политики, используя открытый ключ, который определен в параметре заголовка jwk или x5c.  Также Аттестация Azure проверяет, включен ли этот открытый ключ в список доверенных сертификатов для подписи, связанных с поставщиком аттестации. Этот механизм позволяет Аттестации Azure как проверяющей стороне доверять политике, подписанной с использованием известного ей сертификата X.509. 

Примеры использования сертификата для подписи политик см. [здесь](policy-signer-examples.md).

## <a name="attestation-token"></a>Токен аттестации

Ответ, создаваемый Аттестацией Azure, — это строка в формате JSON с токеном JWT. Аттестация Azure упаковывает в токен JWT все необходимые утверждения и подписывает его. Операция подписывания выполняется с использованием самозаверяющего сертификата, имя субъекта в котором совпадает с элементом AttestUri поставщика аттестации.

API получения метаданных OpenID возвращает ответ в формате конфигурации OpenID в соответствии с [протоколом обнаружения OpenID Connect](https://openid.net/specs/openid-connect-discovery-1_0.html#ProviderConfig). Этот API получает метаданные сертификатов для подписи, которые используются Аттестацией Azure.

Ниже представлен пример токена JWT, созданного для анклава SGX:

```
{
  "alg": "RS256",
  "jku": "https://tradewinds.us.attest.azure.net/certs",
  "kid": <self signed certificate reference to perform signature verification of attestation token,
  "typ": "JWT"
}.{
  "aas-ehd": <input enclave held data>,
  "exp": 1568187398,
  "iat": 1568158598,
  "is-debuggable": false,
  "iss": "https://tradewinds.us.attest.azure.net",
  "maa-attestationcollateral": 
    {
      "qeidcertshash": <SHA256 value of QE Identity issuing certs>,
      "qeidcrlhash": <SHA256 value of QE Identity issuing certs CRL list>,
      "qeidhash": <SHA256 value of the QE Identity collateral>,
      "quotehash": <SHA256 value of the evaluated quote>, 
      "tcbinfocertshash": <SHA256 value of the TCB Info issuing certs>, 
      "tcbinfocrlhash": <SHA256 value of the TCB Info issuing certs CRL list>, 
      "tcbinfohash": <SHA256 value of the TCB Info collateral>
     },
  "maa-ehd": <input enclave held data>,
  "nbf": 1568158598,
  "product-id": 4639,
  "sgx-mrenclave": <SGX enclave mrenclave value>,
  "sgx-mrsigner": <SGX enclave msrigner value>,
  "svn": 0,
  "tee": "sgx"
  "x-ms-attestation-type": "sgx", 
  "x-ms-policy-hash": <>,
  "x-ms-sgx-collateral": 
    {
      "qeidcertshash": <SHA256 value of QE Identity issuing certs>,
      "qeidcrlhash": <SHA256 value of QE Identity issuing certs CRL list>,
      "qeidhash": <SHA256 value of the QE Identity collateral>,
      "quotehash": <SHA256 value of the evaluated quote>, 
      "tcbinfocertshash": <SHA256 value of the TCB Info issuing certs>, 
      "tcbinfocrlhash": <SHA256 value of the TCB Info issuing certs CRL list>, 
      "tcbinfohash": <SHA256 value of the TCB Info collateral>
     },
  "x-ms-sgx-ehd": <>, 
  "x-ms-sgx-is-debuggable": true,
  "x-ms-sgx-mrenclave": <SGX enclave mrenclave value>,
  "x-ms-sgx-mrsigner": <SGX enclave msrigner value>, 
  "x-ms-sgx-product-id": 1, 
  "x-ms-sgx-svn": 1,
  "x-ms-ver": "1.0"
}.[Signature]
```
Некоторые из использованных выше утверждений считаются нерекомендуемыми, но полностью поддерживаются.  Но мы не советуем в будущем коде и инструментах использовать нерекомендуемые имена утверждений. См. [описание утверждений, создаваемых Аттестацией Azure](claim-sets.md).

## <a name="encryption-of-data-at-rest"></a>Шифрование неактивных данных

Для защиты данных клиента служба "Аттестация Azure" хранит свои данные в службе хранилища Azure. Служба хранилища Azure обеспечивает шифрование неактивных данных при их записи в центры обработки данных и расшифровывает их, чтобы клиенты могли получить к ним доступ. Это шифрование выполняется с помощью ключа шифрования, которым управляет корпорация Майкрософт. 

Кроме защиты данных в службе хранилища Azure, Аттестация Azure также использует Шифрование дисков Azure (ADE) для шифрования виртуальных машин служб. Для службы "Аттестация Azure", выполняемой в анклаве в конфиденциальных вычислительных средах Azure, расширение ADE в настоящее время не поддерживается. В таких случаях, чтобы предотвратить хранение данных в памяти, отключается файл подкачки. 

Данные клиента не сохраняются на локальных жестких дисках экземпляра Аттестации Azure.


## <a name="next-steps"></a>Дальнейшие действия

- [Как создать и подписать файл политики аттестации](author-sign-policy.md)
- [Настройка службы "Аттестация Azure" с помощью PowerShell](quickstart-powershell.md)
