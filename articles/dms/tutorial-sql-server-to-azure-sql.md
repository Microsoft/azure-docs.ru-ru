---
title: Руководство по миграции c SQL Server в Базу данных SQL Azure в автономном режиме
titleSuffix: Azure Database Migration Service
description: Узнайте, как перенести базы данных из SQL Server в Базу данных SQL Azure в автономном режиме с помощью Azure Database Migration Service.
services: dms
author: pochiraju
ms.author: rajpo
manager: craigg
ms.reviewer: craigg
ms.service: dms
ms.workload: data-services
ms.custom: seo-lt-2019
ms.topic: tutorial
ms.date: 01/03/2021
ms.openlocfilehash: 9c3fa0d8ac4540495e8580fd208507a2c1aaa7ce
ms.sourcegitcommit: 24a12d4692c4a4c97f6e31a5fbda971695c4cd68
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/05/2021
ms.locfileid: "102180790"
---
# <a name="tutorial-migrate-sql-server-to-azure-sql-database-using-dms"></a>Руководство по миграции с SQL Server в Базу данных SQL Azure с помощью DMS

Azure Database Migration Service позволяет переносить базы данных из экземпляра SQL Server в [Базу данных SQL Azure](/azure/sql-database/). Из этого руководства вы узнаете, как перенести базу данных [Adventureworks2016](/sql/samples/adventureworks-install-configure#download-backup-files), восстановленную в локальном экземпляре SQL Server 2016 (или более поздней версии), в отдельную базу данных или базу данных в пуле в службе "База данных SQL Azure" с помощью Azure Database Migration Service.

Вы научитесь:
> [!div class="checklist"]
>
> - оценивать свою локальную базу данных на наличие проблем, мешающих переносу, с помощью Помощника по миграции данных;
> - использовать Помощник по миграции данных для переноса примера схемы для базы данных; 
> - регистрировать поставщик ресурсов Azure DataMigration.
> - Создайте экземпляр Azure Database Migration Service.
> - создание проекта миграции с использованием Azure Database Migration Service.
> - выполнение миграции.
> - Мониторинг миграции.


## <a name="prerequisites"></a>Предварительные требования

Для работы с этим руководством вам потребуется следующее:

- Скачайте и установите [SQL Server 2016 или более поздней версии](https://www.microsoft.com/sql-server/sql-server-downloads).
- При установке SQL Server Express протокол TCP/IP отключен по умолчанию. Включите его, выполнив инструкции в статье [Включение или отключение сетевого протокола сервера](/sql/database-engine/configure-windows/enable-or-disable-a-server-network-protocol#SSMSProcedure).
- Создайте базу данных в службе "База данных SQL Azure", следуя инструкциям из статьи [Создание базы данных в Базе данных SQL Azure с помощью портала Azure](../azure-sql/database/single-database-create-quickstart.md). В рамках этого руководства для базы данных SQL Azure используется имя **AdventureWorksAzure**, но вы можете назвать ее иначе.

    > [!NOTE]
    > Если вы используете SQL Server Integration Services (SSIS) и вам нужно перенести базу данных каталога для проектов и пакетов служб SSIS (SSISDB) из SQL Server в Базу данных SQL Azure, создание и администрирование целевой базы данных SSISDB будет происходить автоматически от вашего имени, когда вы подготовите к работе SSIS в Фабрике данных Azure (ADF). Дополнительные сведения о миграции пакетов SSIS см. в статье [Перенос пакетов SQL Server Integration Services в Azure](./how-to-migrate-ssis-packages.md).
  
- Скачайте и установите последнюю версию [Помощника по миграции данных](https://www.microsoft.com/download/details.aspx?id=53595).
- Создайте виртуальную сеть Microsoft Azure для Azure Database Migration Service с помощью модели развертывания Azure Resource Manager. Она обеспечивает подключение "сеть — сеть" к локальным исходным серверам через [ExpressRoute](../expressroute/expressroute-introduction.md) или [VPN](../vpn-gateway/vpn-gateway-about-vpngateways.md). Дополнительные сведения о создании виртуальной сети приведены в [документации по виртуальным сетям](../virtual-network/index.yml). В частности, уделите внимание кратким руководствам с пошаговыми инструкциями.

    > [!NOTE]
    > Если вы используете ExpressRoute с пиринговым подключением к сети, управляемой Майкрософт, во время настройки виртуальной сети добавьте в подсеть, в которой будет подготовлена служба, следующие [конечные точки](../virtual-network/virtual-network-service-endpoints-overview.md):
    >
    > - целевую конечную точку базы данных (например, конечная точка SQL, конечная точка Cosmos DB и т. д.);
    > - конечную точку службы хранилища;
    > - конечную точку служебной шины.
    >
    > Такая конфигурация вызвана тем, что у Azure Database Migration Service нет подключения к Интернету.
    >
    >Если у вас нет подключения типа "сеть — сеть" между локальной сетью и Azure, или если пропускная способность подключения "сеть — сеть" ограничена, рекомендуется использовать Azure Database Migration Service в гибридном режиме (Предварительная версия). Гибридный режим использует локальный рабочий процесс миграции вместе с экземпляром Azure Database Migration Service, который работает в облаке. Сведения о создании экземпляра Azure Database Migration Service в гибридном режиме см. в статье [Создание экземпляра Azure Database Migration Service в гибридном режиме с помощью портала Azure](./quickstart-create-data-migration-service-hybrid-portal.md).

- Убедитесь, что правила безопасности для исходящего трафика в группе безопасности сети для виртуальной сети не блокируют исходящий порт 443 ServiceTag для Служебной шины, службы хранилища и Azure Monitor. См. дополнительные сведения о [фильтрации трафика, предназначенного для виртуальной сети Azure, с помощью групп безопасности сети](../virtual-network/virtual-network-vnet-plan-design-arm.md).
- Настройте [брандмауэр Windows для доступа к ядру СУБД](/sql/database-engine/configure-windows/configure-a-windows-firewall-for-database-engine-access).
- Откройте брандмауэр Windows, чтобы предоставить Azure Database Migration Service доступ к исходному серверу SQL Server. По умолчанию это TCP-порт 1433. Если ваш экземпляр по умолчанию прослушивает какой-либо другой порт, добавьте его в брандмауэр.
- Если вы запустили несколько именованных экземпляров SQL Server, использующих динамические порты, вы можете включить службу обозревателя SQL и разрешить доступ к UDP-порту 1434 через брандмауэры. Это позволит службе Azure Database Migration Service подключиться к именованному экземпляру на исходном сервере.
- Если перед исходными базами данных развернуто устройство брандмауэра, вам может понадобиться добавить правила брандмауэра, чтобы позволить службе Azure Database Migration Service обращаться к исходным базам данных для выполнения миграции.
- Создайте [правило брандмауэра](../azure-sql/database/firewall-configure.md) для IP-адресов в Базе данных SQL Azure, чтобы предоставить службе Azure Database Migration Service доступ к целевым базам данных. Задайте диапазон подсети в виртуальной сети, которая используется для Azure Database Migration Service.
- Убедитесь, что учетные данные, используемые для подключения к исходному экземпляру SQL Server, имеют разрешения [CONTROL SERVER](/sql/t-sql/statements/grant-server-permissions-transact-sql).
- Убедитесь, что учетные данные для подключения к целевому экземпляру Базы данных SQL Azure имеют разрешения [CONTROL DATABASE](/sql/t-sql/statements/grant-database-permissions-transact-sql) в целевых базах данных.

## <a name="assess-your-on-premises-database"></a>Оценка локальной базы данных

Перед переносом данных из экземпляра SQL Server в отдельную базу данных или базу данных в составе пула в Базе данных SQL Azure необходимо проверить базу данных SQL Server на наличие любых проблем, связанных с блокировкой, которые могут помешать миграции. В Помощнике по миграции данных выполните инструкции по [оценке миграции SQL Server](/sql/dma/dma-assesssqlonprem), чтобы завершить оценку локальной базы данных. Ниже приведена сводка необходимых действий:

1. В помощнике по миграции данных выберите значок "Создать" (+), а затем выберите тип проекта **Оценка**.
2. Укажите имя проекта. В раскрывающемся списке **Тип оценки** выберите **Ядро СУБД**, в текстовом поле **Тип исходного сервера** выберите **SQL Server**, в текстовом поле **Тип целевого сервера** — **База данных SQL Azure**, а затем нажмите кнопку **Создать**, чтобы создать проект.

    При оценке исходной базы данных SQL Server, переносимой в отдельную базу данных или базу данных в составе пула в Базе данных SQL Azure, можно выбрать один или несколько следующих типов отчетов об оценке:

   - проверка совместимости базы данных;
   - проверка четности компонентов.

    По умолчанию выбраны оба типа отчетов.

3. В помощнике по миграции данных на экране **Параметры** выберите **Далее**.
4. На экране **Выберите источники** в диалоговом окне **Соединение с сервером** предоставьте сведения о подключении к SQL Server, а затем выберите **Подключить**.
5. В диалоговом окне **Добавление источников** выберите **Adventureworks2016**, а затем щелкните **Добавить** и выберите **Начать оценку**.

    > [!NOTE]
    > Если вы используете службы SSIS, обратите внимание, что сейчас DMA не поддерживает оценку базы данных-источника SSISDB. Но проекты и пакеты служб SSIS пройдут оценку и проверку, как только они будут повторно развернуты в целевую базу данных SSISDB, размещенную в Базе данных SQL Azure. Дополнительные сведения о миграции пакетов SSIS см. в статье [Перенос пакетов SQL Server Integration Services в Azure](./how-to-migrate-ssis-packages.md).

    После завершения оценки результаты будут показаны, как на следующем рисунке:

    ![Оценка миграции данных](media/tutorial-sql-server-to-azure-sql/dma-assessments.png)

    Для баз данных в Базе данных SQL Azure при оценке выявляются проблемы с четностью компонентов и проблемы, блокирующие миграцию, для развертывания в одной из таких баз данных.

    - Для категории **четности компонентов SQL Server** доступны разные рекомендации, а также описание альтернативных механизмы, используемых в Azure, и мер по устранению, которые помогут вам рассчитать трудозатраты для выполнения миграции.
    - Категория **проблем совместимости** определяет частично поддерживаемые или неподдерживаемые возможности, связанные с проблемами совместимости, которые могут блокировать перенос баз данных SQL Server в Базу данных SQL Azure. Также предлагаются рекомендации, которые помогут вам решить эти проблемы.

6. Просмотрите результаты оценки проблем, блокирующих миграцию, и проблем с четностью компонентов, выбрав конкретные параметры.

## <a name="migrate-the-sample-schema"></a>Перенос примера схемы

Если результаты оценки вас устраивают и выбранная база данных подходит для переноса в отдельную базу данных или базу данных в пуле в Базе данных SQL Azure, воспользуйтесь Помощником по миграции данных для переноса схемы в Базу данных SQL Azure.

> [!NOTE]
> Прежде чем создавать проект миграции в Data Migration Assistant, убедитесь, что база данных в Azure уже подготовлена, как описано выше. 

> [!IMPORTANT]
> Если вы используете службы SSIS, обратите внимание, что сейчас DMA не поддерживает перенос базы данных-источника SSISDB, но вы можете повторно развернуть проекты и пакеты служб SSIS в целевую базу данных SSISDB, размещенную в Базе данных SQL Azure. Дополнительные сведения о миграции пакетов SSIS см. в статье [Перенос пакетов SQL Server Integration Services в Azure](./how-to-migrate-ssis-packages.md).

Чтобы перенести схему базы данных **Adventureworks2016** в отдельную базу данных или базу данных в пуле в службе "База данных SQL Azure", выполните следующие действия:

1. В Помощнике по миграции данных щелкните значок New (+) (Создать (+)), а затем в разделе **Project type** (Тип проекта) выберите **Migration** (Миграция).
2. Укажите имя проекта в текстовом поле **Source server type** (Тип исходного сервера), выберите **SQL Server**, а затем в текстовом поле **Target server type** (Тип целевого сервера) выберите **База данных SQL Azure**.
3. В разделе **Migration Scope** (Область переноса) выберите **Schema only** (Только схема).

    После выполнения предыдущих действий интерфейс помощника по миграции данных должен выглядеть, как показано на следующем рисунке:

    ![Создание проекта в помощнике по миграции данных](media/tutorial-sql-server-to-azure-sql/dma-create-project.png)

4. Выберите **Создать**, чтобы создать проект.
5. В Помощнике по миграции данных укажите сведения о подключении к источнику для SQL Server, щелкните **Подключить**, а затем выберите базу данных **Adventureworks2016**.

    ![Сведения о подключении к источнику в помощнике по миграции данных](media/tutorial-sql-server-to-azure-sql/dma-source-connect.png)

6. В разделе **Подключение к целевому серверу** выберите **Далее**, укажите сведения о подключении к целевому объекту для базы данных SQL Azure, нажмите **Подключить**, а затем выберите базу данных **AdventureWorksAzure**, предварительно подготовленную в Базе данных SQL Azure.

    ![Сведения о подключении к целевому объекту в помощнике по миграции данных](media/tutorial-sql-server-to-azure-sql/dma-target-connect.png)

7. Выберите **Далее**, чтобы перейти на экран **Выбор объектов**, на котором можно указать объекты схемы в базе данных **Adventureworks2016**, которую нужно развернуть в службе "База данных SQL Azure".

    По умолчанию выбраны все объекты.

    ![Создание сценариев SQL](media/tutorial-sql-server-to-azure-sql/dma-assessment-source.png)

8. Выберите **Создать скрипт SQL**, чтобы создать скрипт SQL, а затем просмотрите его на наличие ошибок.

    ![Скрипт схемы](media/tutorial-sql-server-to-azure-sql/dma-schema-script.png)

9. Выберите **Deploy schema** (Развернуть схему), чтобы развернуть схему в Базе данных SQL Azure, а затем проверьте целевой сервер на наличие аномалий.

    ![Развертывание схемы](media/tutorial-sql-server-to-azure-sql/dma-schema-deploy.png)

## <a name="register-the-microsoftdatamigration-resource-provider"></a>Регистрация поставщика ресурсов Microsoft.DataMigration

1. Войдите на портал Azure. Выполните поиск по запросу **Подписки** и выберите этот пункт.

   ![Отображение подписок на портале](media/tutorial-sql-server-to-azure-sql/portal-select-subscription-1.png)

2. Выберите подписку, в которой нужно создать экземпляр Azure Database Migration Service, а затем щелкните **Поставщики ресурсов**.

    ![Отображение поставщиков ресурсов](media/tutorial-sql-server-to-azure-sql/portal-select-resource-provider.png)

3. В поле поиска введите migration, а затем щелкните элемент **Зарегистрировать** рядом с **Microsoft.DataMigration**.

    ![Регистрация поставщика ресурсов](media/tutorial-sql-server-to-azure-sql/portal-register-resource-provider.png)    

## <a name="create-an-instance"></a>Создание экземпляра

1. На **домашней странице** или в меню портала Azure щелкните элемент **Создать ресурс**. Найдите и выберите элемент **Azure Database Migration Service**.

    ![Azure Marketplace](media/tutorial-sql-server-to-azure-sql/portal-marketplace.png)

2. На экране **Azure Database Migration Service** выберите **Создать**.

    ![Создание экземпляра Azure Database Migration Service](media/tutorial-sql-server-to-azure-sql/dms-create-1.png)
  
3. На экране основных сведений **Создание Migration Service** сделайте следующее:

     - Выберите подписку.
     - Создайте группу ресурсов или выберите существующую.
     - Укажите имя для экземпляра Azure Database Migration Service.
     - Выберите расположение, в котором нужно создать экземпляр Azure Database Migration Service.
     - Выберите **Azure** в качестве режима службы.
     - Выберите ценовую категорию. Дополнительные сведения о ценовых категориях и затратах см. на [странице с описанием цен](https://aka.ms/dms-pricing).

    ![Настройка основных параметров экземпляра Azure Database Migration Service](media/tutorial-sql-server-to-azure-sql/dms-settings-2.png)

     - Нажмите **Далее: сеть**.

4. На экране сети **Создание Migration Service** сделайте следующее:

    - Выберите существующую виртуальную сеть или создайте новую. Виртуальная сеть предоставляет Azure Database Migration Service доступ к исходному экземпляру SQL Server и целевому экземпляру Базы данных SQL Azure. См. статью [Краткое руководство. Создание виртуальной сети с помощью портала Azure](../virtual-network/quick-create-portal.md).

    ![Настройка параметров сети экземпляра Azure Database Migration Service](media/tutorial-sql-server-to-azure-sql/dms-settings-3.png)

    - Щелкните **Просмотреть и создать**, чтобы создать службу.

## <a name="create-a-migration-project"></a>Создание проекта миграции

После создания службы найдите ее на портале Azure, откройте и создайте проект миграции.

1. В меню портала Azure выберите **Все службы**. Найдите и выберите элемент **Службы Azure Database Migration Service**.

     ![Поиск всех экземпляров Azure Database Migration Service](media/tutorial-sql-server-to-azure-sql/dms-search.png)

2. На экране **Службы Azure Database Migration Service** выберите созданный экземпляр Azure Database Migration Service.

3. Щелкните элемент **Новый проект миграции**.

     ![Поиск экземпляра службы Azure Database Migration Service](media/tutorial-sql-server-to-azure-sql/dms-instance-search.png)

4. На экране **Новый проект миграции** задайте имя для проекта, в текстовом поле **Тип исходного сервера** выберите **SQL Server**, в текстовом поле **Тип целевого сервера** выберите **База данных SQL Azure**, а затем для параметра **Выберите тип действия миграции** установите значение **Миграция данных**.

    ![Создание проекта Database Migration Service](media/tutorial-sql-server-to-azure-sql/dms-create-project-2.png)

5. Выберите **Создать и выполнить действие**, чтобы создать проект и выполнить действие миграции.

## <a name="specify-source-details"></a>Указание сведений об источнике

1. На экране **Выбор источника** укажите сведения о подключении для исходного экземпляра SQL Server.

    Используйте для имени исходного экземпляра SQL Server полное доменное имя (FQDN). Если разрешение DNS-имен невозможно, можно использовать IP-адрес.

2. Если на исходном сервере доверенный сертификат не установлен, установите флажок **Доверять сертификату сервера**.

    Если доверенный сертификат не установлен, SQL Server создает самозаверяющий сертификат при запуске экземпляра. Этот сертификат используется с целью шифрования учетных данных для клиентских подключений.

    > [!CAUTION]
    > TLS-соединения, шифруемые с помощью самозаверяющего сертификата, не обеспечивают надежной защиты. Они уязвимы для атак "злоумышленник в середине". Не следует надеяться на защиту TLS с самозаверяющими сертификатами в рабочей среде или на серверах, подключенных к Интернету.

    > [!IMPORTANT]
    > Если вы используете службы SSIS, обратите внимание, что сейчас DMS не поддерживает перенос базы данных-источника SSISDB, но вы можете повторно развернуть проекты и пакеты служб SSIS в целевую базу данных SSISDB, размещенную в Базе данных SQL Azure. Дополнительные сведения о миграции пакетов SSIS см. в статье [Перенос пакетов SQL Server Integration Services в Azure](./how-to-migrate-ssis-packages.md).

   ![Сведения об источнике](media/tutorial-sql-server-to-azure-sql/dms-source-details-2.png)
   
3. Нажмите **Далее: выбор баз данных**.

## <a name="select-databases-for-migration"></a>Выбор баз данных для миграции

Выберите базы данных, которые нужно перенести в Базу данных SQL Azure. Служба DMS предоставит вам информацию об ожидаемом времени миграции для выбранных баз данных. Если такое время простоя приемлемо, продолжайте миграцию. Если же это время простоя неприемлемо, рассмотрите возможность миграции на [Управляемый экземпляр SQL с минимальным простоем](tutorial-sql-server-managed-instance-online.md) или свяжитесь со специалистами [команды DMS](mailto:DMSFeedback@microsoft.com) для получения информации о других вариантах. 

1. Из списка доступных баз данных выберите те, которые необходимо перенести. 
1. Обратите внимание на ожидаемое время простоя. Если оно вас устраивает, нажмите **Далее: выбор целевого объекта**.

   ![Базы данных-источники](media/tutorial-sql-server-to-azure-sql/select-database.png)



## <a name="specify-target-details"></a>Указание сведений о цели

1. На экране **Выбор целевого объекта** укажите параметры проверки подлинности для Базы данных SQL Azure. 

   ![Выбор цели](media/tutorial-sql-server-to-azure-sql/select-target.png)

1. По завершении выберите **Next: Сопоставить с целевыми базами данных** и сопоставьте исходную и целевую базы данных для миграции.

    Если в целевой базе данных содержится база данных с тем же именем, что у исходной базы данных, Azure Database Migration Service по умолчанию выберет целевую базу данных.

    ![Сопоставление с целевыми базами данных](media/tutorial-sql-server-to-azure-sql/dms-map-targets-activity-2.png)

1. По завершении выберите **Next: Настройка параметров миграции**, разверните список таблиц и просмотрите список затронутых полей.

    Azure Database Migration Service автоматически выбирает все пустые исходные таблицы в целевом экземпляре Базы данных SQL. Чтобы повторно перенести таблицы, уже содержащие данные, необходимо явным образом выбрать их в этой колонке.

    ![Выбор таблиц](media/tutorial-sql-server-to-azure-sql/dms-configure-setting-activity-2.png)

1. По завершении выберите **Next: Сводка**, просмотрите настройки миграции и в текстовом поле **Имя действия** укажите имя для действия переноса.

    ![Выбор варианта проверки](media/tutorial-sql-server-to-azure-sql/dms-configuration-2.png)

## <a name="run-the-migration"></a>Выполнение миграции

- Выберите **Начать миграцию**.

    Появится окно действия миграции, в котором будет указано **состояние** действия **Ожидание**.

    ![Состояние действия](media/tutorial-sql-server-to-azure-sql/dms-activity-status-1.png)

## <a name="monitor-the-migration"></a>Мониторинг миграции

1. На экране действия миграции нажимайте кнопку **Обновить**, чтобы обновить содержимое экрана, пока **состояние** миграции не поменяется на **Завершено**.

    ![Состояние действия "Завершено"](media/tutorial-sql-server-to-azure-sql/dms-completed-activity-1.png)

2. Проверьте целевые базы данных в целевой **Базе данных SQL Azure**.

### <a name="additional-resources"></a>Дополнительные ресурсы

- См. дополнительные сведения о [службе Azure Database Migration Service](./dms-overview.md).
- Дополнительные сведения о службе "База данных SQL Azure" см. в [этой статье](../azure-sql/database/sql-database-paas-overview.md).
