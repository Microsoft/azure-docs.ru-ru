---
title: Известные проблемы и ограничения при оперативной миграции в Azure SQL Управляемый экземпляр
description: Узнайте об известных проблемах и ограничениях миграции, связанных с оперативными миграциями в Azure SQL Управляемый экземпляр.
services: database-migration
author: pochiraju
ms.author: rajpo
manager: craigg
ms.reviewer: craigg
ms.service: dms
ms.workload: data-services
ms.custom: mvc
ms.topic: troubleshooting
ms.date: 02/20/2020
ms.openlocfilehash: 46c5f5995c7a1d4eb074f6c1b25ecaad7e2da37e
ms.sourcegitcommit: 77afc94755db65a3ec107640069067172f55da67
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/22/2021
ms.locfileid: "98695545"
---
# <a name="known-issuesmigration-limitations-with-online-migrations-to-azure-sql-managed-instance"></a>Известные проблемы и ограничения миграции при оперативной миграции на Azure SQL Управляемый экземпляр

Ниже описаны известные проблемы и ограничения, связанные с миграцией в сети с SQL Server на Управляемый экземпляр SQL Azure.

> [!IMPORTANT]
> Миграция SQL Server в базу данных SQL Azure в сети, перенос SQL_variant типов данных не поддерживается.

## <a name="backup-requirements"></a>Требования к резервному копированию

- **Резервные копии с контрольной суммой**

    Azure Database Migration Service использует метод резервного копирования и восстановления для переноса локальных баз данных в Управляемый экземпляр SQL. Azure Database Migration Service поддерживает только резервные копии, созданные с использованием контрольной суммы.

    [Включение или отключение контрольных сумм резервных копий во время резервного копирования или восстановления (SQL Server)](/sql/relational-databases/backup-restore/enable-or-disable-backup-checksums-during-backup-or-restore-sql-server).

    > [!NOTE]
    > Если вы передаете резервные копии базы данных с помощью сжатия, контрольная сумма является поведением по умолчанию, если явно не отключено.

    При использовании автономных миграций, если выбрать параметр **я буду позволять Azure Database Migration Service...**, после чего Azure Database Migration Service будет использовать резервную копию базы данных с включенной контрольной суммой.

- **Тип носителя резервной копии**

    Обязательно выполните каждую резервную копию на отдельном носителе резервных копий (файлы резервных копий). Azure Database Migration Service не поддерживает резервные копии, добавляемые в один файл резервной копии. Создание полных резервных копий и резервные копии журналов для отдельных файлов резервных копий.

## <a name="data-and-log-file-layout"></a>Макет файла данных и журнала

- **Число файлов журнала**

    Azure Database Migration Service не поддерживает базы данных с несколькими файлами журналов. Если у вас есть несколько файлов журналов, сократите их и выполните их реорганизацию в один файл журнала транзакций. Так как вы не можете удаленно записывать в журнал непустые файлы, необходимо сначала создать резервную копию файла журнала.

## <a name="sql-server-features"></a>функции SQL Server

- **Файловый поток/таблицы FileTable**

    SQL Управляемый экземпляр в настоящее время не поддерживает FileStream и таблицы FileTable. Для рабочих нагрузок, зависящих от этих функций, рекомендуется использовать серверы SQL Server, работающие на виртуальных машинах Azure, в качестве цели Azure.

- **Таблицы в памяти**

    Выполняющаяся в памяти OLTP доступна на уровнях Premium и критически важный для бизнеса для SQL Управляемый экземпляр; уровень общего назначения не поддерживает выполняющуюся в памяти OLTP.

## <a name="migration-resets"></a>Сбросы миграции

- **Развернутые приложения**

    SQL Управляемый экземпляр — это служба PaaS с автоматической установкой исправлений и обновлениями версий. Во время миграции Управляемый экземпляр SQL некритические обновления удерживаются до 36 часов. Затем (и для критических обновлений) в случае нарушения миграции процесс сбрасывается в состояние полного восстановления.

    Прямую миграцию миграции можно вызвать только после восстановления полной резервной копии и обнаружения всех резервных копий журналов. При кутоверсии рабочей миграции обратитесь к [псевдониму обратной связи Azure DMS](mailto:dmsfeedback@microsoft.com).

## <a name="smb-file-share-connectivity"></a>Подключение к общей папке SMB

Проблемы с подключением к файловому ресурсу SMB, скорее всего, вызваны проблемами с разрешениями. 

Чтобы проверить подключение к общей папке SMB, выполните следующие действия. 

1. Сохраните резервную копию в файловый ресурс SMB. 
1. Проверьте сетевое подключение между подсетью Azure Database Migration Service и исходным SQL Server. Самый простой способ сделать это — развернуть SQL Server виртуальную машину в подсети DMS и подключиться к исходной SQL Server с помощью SQL Server Management Studio. 
1. Восстановите заголовок исходного SQL Server из резервной копии в общей папке: 

   ```sql
   RESTORE HEADERONLY   
   FROM DISK = N'\\<SMB file share path>\full.bak'
   ```

Если не удается подключиться к общему файловому ресурсу, настройте разрешения следующим образом. 

1. Перейдите в файловый ресурс с помощью проводника. 
1. Щелкните правой кнопкой мыши общую папку и выберите пункт Свойства. 
1. Перейдите на вкладку **Общий** доступ и выберите **Расширенный общий доступ**. 
1. Добавьте учетную запись Windows, используемую для миграции, и назначьте ей полный контроль доступа. 
1. Добавьте учетную запись службы SQL Server и назначьте ей полный контроль доступа. Если вы не уверены, какая учетная запись используется, проверьте **Диспетчер конфигурации SQL Server** учетной записи службы SQL Server. 

   :::image type="content" source="media/known-issues-azure-sql-db-managed-instance-online/assign-fileshare-permissions.png" alt-text="Предоставьте полный доступ к учетным записям Windows, используемым для миграции, а также для учетной записи службы SQL Server. ":::

