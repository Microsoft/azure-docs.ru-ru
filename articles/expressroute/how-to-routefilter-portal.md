---
title: Руководство по настройке фильтров маршрутов для пиринга Майкрософт с помощью портала Azure
description: В этом руководстве показано, как настраивать фильтры маршрутов для пиринга Майкрософт с помощью портала Azure.
services: expressroute
author: duongau
ms.service: expressroute
ms.topic: tutorial
ms.date: 10/15/2020
ms.author: duau
ms.custom: seodec18
ms.openlocfilehash: d142028d197f9e279b5f1e05757946dc40d2c153
ms.sourcegitcommit: 772eb9c6684dd4864e0ba507945a83e48b8c16f0
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "92109142"
---
# <a name="tutorial-configure-route-filters-for-microsoft-peering-using-the-azure-portal"></a>Руководство по настройке фильтров маршрутов для пиринга Майкрософт с помощью портала Azure

> [!div class="op_single_selector"]
> * [портале Azure](how-to-routefilter-portal.md)
> * [Azure PowerShell](how-to-routefilter-powershell.md)
> * [Azure CLI](how-to-routefilter-cli.md)
> 

Фильтры маршрутов — это способ использовать подмножество поддерживаемых служб через пиринг Майкрософт. Действия, описанные в этой статье, помогут настроить фильтры маршрутов для каналов ExpressRoute и управлять ими.

Службы Microsoft 365, такие как Exchange Online, SharePoint Online и Skype для бизнеса, доступны через пиринг Майкрософт. При настройке пиринга Майкрософт в канале ExpressRoute все префиксы, которые относятся к этим службам, объявляются через установленные сеансы BGP. Значение сообщества BGP подключается к каждому префиксу для идентификации службы, предлагаемой через него. Список значений сообщества BGP и служб, с которыми они сопоставляются, см. в разделе [Поддержка сообществ BGP](expressroute-routing.md#bgp).

Подключение ко всем службам Azure и Microsoft 365 приводит к объявлению большого количества префиксов через BGP. Это значительно увеличивает размер таблиц маршрутов, которые обслуживают маршрутизаторы в вашей сети. Если вы планируете использовать только подмножество служб, предлагаемых через пиринг Майкрософт, размер таблиц маршрутизации можно уменьшить двумя способами. Вы можете:

* Отфильтровывать нежелательные префиксы путем применения фильтров маршрутов к сообществам BGP. Это стандартный подход, который часто используется при работе со многими сетями.

* Определять фильтры маршрутов и применять их к каналу ExpressRoute. Фильтр маршрутов — это новый ресурс, который позволяет выбрать список служб, которые вы собираетесь использовать через пиринг Майкрософт. Маршрутизаторы ExpressRoute отправляют только список префиксов, которые принадлежат службам, определяемым в фильтре маршрутов.

В этом руководстве описано следующее:
> [!div class="checklist"]
> - получение значений сообщества BGP;
> - создание фильтра маршрутов и правила фильтрации;
> - связывание фильтра маршрутов с каналом ExpressRoute.

### <a name="about-route-filters"></a><a name="about"></a>О фильтрах маршрута

При настроенном пиринге Майкрософт для канала ExpressRoute пограничные маршрутизаторы Майкрософт устанавливают пару сеансов BGP с пограничными маршрутизаторами через ваш поставщик услуг подключения. В вашей сети маршруты не объявляются. Чтобы включить объявление маршрутов в своей сети, необходимо связать с ней фильтр маршрутов.

Фильтр маршрутов позволяет вам идентифицировать службы, которые можно использовать через пиринг Майкрософт по каналу ExpressRoute. Это фактически список разрешений для всех значений сообщества BGP. После определения ресурса фильтра маршрутов и его подключения к каналу ExpressRoute все префиксы, которые сопоставляются со значениями сообщества BGP, объявляются в сети.

Чтобы подключить фильтры маршрутов к службам Microsoft 365, у вас должно быть разрешение на использование этих служб через ExpressRoute. Если у вас нет такого разрешения, подключение фильтров маршрутов завершится сбоем. Дополнительные сведения о получении разрешения см. в статье [Azure ExpressRoute для Microsoft 365](/microsoft-365/enterprise/azure-expressroute).

> [!IMPORTANT]
> Пиринг Майкрософт для каналов ExpressRoute, которые были настроены до 1 августа 2017 г., позволяет объявлять все префиксы служб, даже если не настроены фильтры маршрутов. Пиринг Майкрософт для каналов ExpressRoute, настроенных 1 августа 2017 г. или позднее, не будет объявлять префиксы, пока к каналу не будет присоединен фильтр маршрутов.
> 

## <a name="prerequisites"></a>Предварительные требования

- Изучите [предварительные требования](expressroute-prerequisites.md) и [рабочие процессы](expressroute-workflows.md), прежде чем приступить к настройке.

- Необходимо иметь активный канал ExpressRoute с подготовленным пирингом Майкрософт. Для выполнения этих задач можно использовать следующие инструкции:
  - [Создайте канал ExpressRoute](expressroute-howto-circuit-portal-resource-manager.md). Он должен быть включен на стороне поставщика услуг подключения. Канал ExpressRoute должен находиться в подготовленном и включенном состоянии.
  - [Создайте пиринг Майкрософт](expressroute-howto-routing-portal-resource-manager.md), если вы управляете сеансом BGP напрямую или если у вашего поставщика услуг подключения подготовлен пиринг Майкрософт для вашего канала.

## <a name="get-a-list-of-prefixes-and-bgp-community-values"></a><a name="prefixes"></a>Получение списка префиксов и значений сообщества BGP

### <a name="get-a-list-of-bgp-community-values"></a>Получение списка значений сообщества BGP

Значения BGP сообщества, связанные со службами, доступными через пиринг Майкрософт, приведены на странице [Требования к маршрутизации ExpressRoute](expressroute-routing.md).

### <a name="make-a-list-of-the-values-that-you-want-to-use"></a>Создание списка значений, которые можно использовать

Создайте список [значений сообщества BGP](expressroute-routing.md#bgp), которые хотите использовать в фильтре маршрутов. 

## <a name="create-a-route-filter-and-a-filter-rule"></a><a name="filter"></a>Создание фильтра маршрута и правила фильтрации

Фильтр может иметь только одно правило, и оно должно иметь тип "Разрешить". С этим правилом может быть связан список значений сообщества BGP.

1. Выберите **Создать ресурс**, а затем выполнять поиск по запросу *Фильтр маршрутов*, как показано на следующем рисунке:

    :::image type="content" source="./media/how-to-routefilter-portal/create-route-filter.png" alt-text="Снимок экрана со страницей фильтра маршрутов":::

1. Поместите фильтр маршрутов в группу ресурсов. Убедитесь, что его расположение совпадает с расположением канала ExpressRoute. Выберите **Просмотр и создание**, а затем щелкните **Создать**.

    :::image type="content" source="./media/how-to-routefilter-portal/create-route-filter-basic.png" alt-text="Снимок экрана, на котором показана страница создания фильтра маршрутов с введенными примерами значений":::

### <a name="create-a-filter-rule"></a>Создание правила фильтрации

1. Чтобы добавить или обновить правила, выберите вкладку "Управление правилом" для фильтра маршрутов.

    :::image type="content" source="./media/how-to-routefilter-portal/manage-route-filter.png" alt-text="Снимок экрана со страницей обзора, где выделено действие &quot;Управление правилом&quot;":::

1. В раскрывающемся списке выберите службы, к которым необходимо подключиться, и сохраните правило.

    :::image type="content" source="./media/how-to-routefilter-portal/add-route-filter-rule.png" alt-text="Снимок экрана с окном &quot;Управление правилом&quot;, где в раскрывающемся списке &quot;Разрешенные сообщества служб&quot; выбраны нужные службы":::

## <a name="attach-the-route-filter-to-an-expressroute-circuit"></a><a name="attach"></a>Подключения фильтра маршрута к каналу ExpressRoute

Присоедините фильтр маршрутов к каналу, нажав кнопку **Add circuit** (Добавить канал) и выбрав канал ExpressRoute в раскрывающемся списке.

:::image type="content" source="./media/how-to-routefilter-portal/add-circuit-to-route-filter.png" alt-text="Снимок экрана со страницей &quot;Параметры&quot;, где выбрано действие добавления канала":::

Если пиринг для вашего канала ExpressRoute настраивает поставщик услуг подключения, обновите канал на колонке канала ExpressRoute, прежде чем нажать кнопку **Add circuit** (Добавить канал).

:::image type="content" source="./media/how-to-routefilter-portal/refresh-express-route-circuit.png" alt-text="Снимок экрана со страницей &quot;Параметры&quot;, где выбрано действие &quot;Обновить&quot;":::

## <a name="common-tasks"></a><a name="tasks"></a>Стандартные задачи

### <a name="to-get-the-properties-of-a-route-filter"></a><a name="getproperties"></a>Получение свойств фильтра маршрута

Открыв ресурс на портале, можно просмотреть свойства фильтра маршрута.

:::image type="content" source="./media/how-to-routefilter-portal/view-route-filter.png" alt-text="Снимок экрана: страница &quot;Обзор&quot;":::

### <a name="to-update-the-properties-of-a-route-filter"></a><a name="updateproperties"></a>Обновление свойств фильтра маршрутов

1. Нажав кнопку **Управление правилом**, можно обновить список значений сообщества BGP, присоединенных к каналу.

    :::image type="content" source="./media/how-to-routefilter-portal/update-route-filter.png" alt-text="Обновление фильтров маршрутов с помощью действия &quot;Управление правилом&quot;":::

1. Выберите нужные сообщества служб и щелкните **Сохранить**.

    :::image type="content" source="./media/how-to-routefilter-portal/add-route-filter-rule.png" alt-text="Снимок экрана, на котором показано окно &quot;Управление правилом&quot; и выбраны службы":::

### <a name="to-detach-a-route-filter-from-an-expressroute-circuit"></a><a name="detach"></a>Отсоединение фильтра маршрутов от канала ExpressRoute

Чтобы отсоединить канал от фильтра маршрутов, щелкните этот канал правой кнопкой мыши и выберите **Отменить связь**.

:::image type="content" source="./media/how-to-routefilter-portal/detach-route-filter.png" alt-text="Снимок экрана со страницей обзора, где выделено действие &quot;Отменить связь&quot;":::


## <a name="clean-up-resources"></a>Очистка ресурсов

Фильтр маршрута можно удалить, нажав кнопку **Удалить**. Перед этим убедитесь, что фильтр маршрутов не связан ни с одним из каналов.

:::image type="content" source="./media/how-to-routefilter-portal/delete-route-filter.png" alt-text="Удаление фильтра маршрутов":::

## <a name="next-steps"></a>Next Steps

Дополнительные сведения о примерах конфигурации маршрутизаторов см. в следующих статьях:

> [!div class="nextstepaction"]
> [Примеры конфигурации маршрутизатора для настройки и управления маршрутизацией](expressroute-config-samples-routing.md)
