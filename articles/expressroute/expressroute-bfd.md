---
title: 'Azure ExpressRoute: Настройка БФД'
description: Эта статья содержит инструкции по настройке обнаружения двунаправленной передачи (BFD) через частный пиринг по каналу ExpressRoute.
services: expressroute
author: duongau
ms.service: expressroute
ms.topic: article
ms.date: 12/14/2020
ms.author: duau
ms.openlocfilehash: 254f5909e7ed8db4dc18ade2677a3213b268cf41
ms.sourcegitcommit: 772eb9c6684dd4864e0ba507945a83e48b8c16f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "97511269"
---
# <a name="configure-bfd-over-expressroute"></a>Настройка обнаружения двунаправленной передачи через ExpressRoute

ExpressRoute поддерживает обнаружение двунаправленной переадресации (БФД) как через частный, так и через пиринг Майкрософт. При включении БФД через ExpressRoute можно ускорить обнаружение сбоев ссылок между устройствами Microsoft Enterprise (MSEE) и маршрутизаторами, настроенными для канала ExpressRoute (CE/PE). Вы можете настроить ExpressRoute на устройствах маршрутизации пограничных устройств или на устройствах маршрутизации пограничных услуг (если вы перешли в службу подключения управляемого уровня 3). В этом документе рассматривается необходимость в BFD и включение BFD через ExpressRoute.

## <a name="need-for-bfd"></a>Необходимость обнаружения двунаправленной передачи

На следующей схеме показаны преимущества включения BFD через канал ExpressRoute: [![1]][1]

Вы можете установить канал ExpressRoute, используя подключения второго уровня или управляемые подключения третьего уровня. В обоих случаях, если в пути подключения ExpressRoute имеется несколько устройств уровня 2, ответственность за обнаружение сбоев ссылок в пути заключается в использовании сеанса BGP с превышением доверия.

На устройствах MSEE, как правило, протоколы и время хранения BGP настраиваются как 60 и 180 секунд соответственно. По этой причине при сбое ссылки может пройти до трех минут, чтобы обнаружить ошибки связи и переключить трафик на альтернативное подключение.

Вы можете управлять таймерами BGP, настроив более низкий уровень активности и времени ожидания BGP на устройстве с пограничным пирингом. Если таймеры BGP не одинаковы между двумя одноранговыми устройствами, сеанс BGP будет установлен с использованием меньшего значения времени. Для параметра Проверка активности по протоколу BGP можно задать значение меньше трех секунд, а время ожидания — 10 секунд. Тем не менее, не рекомендуется устанавливать очень агрессивный таймер BGP, так как этот протокол требует интенсивного выполнения процессов.

BFD может помочь в этом сценарии. BFD обеспечивает обнаружение сбоя связи с минимальными затратами в течение доли секунды. 


## <a name="enabling-bfd"></a>Включение BFD

BFD настроен по умолчанию во всех новых частных пиринговых интерфейсах ExpressRoute, созданных на устройствах MSEE. Таким образом, чтобы включить БФД, необходимо настроить только БФД на основном и на вторичном устройствах. Настройка БФД выполняется в два этапа. Настройте БФД в интерфейсе, а затем свяжите его с сеансом BGP.

Ниже приведен пример конфигурации CE/PE (с использованием Cisco IOS XE). 

```console
interface TenGigabitEthernet2/0/0.150
   description private peering to Azure
   encapsulation dot1Q 15 second-dot1q 150
   ip vrf forwarding 15
   ip address 192.168.15.17 255.255.255.252
   bfd interval 300 min_rx 300 multiplier 3


router bgp 65020
   address-family ipv4 vrf 15
      network 10.1.15.0 mask 255.255.255.128
      neighbor 192.168.15.18 remote-as 12076
      neighbor 192.168.15.18 fall-over bfd
      neighbor 192.168.15.18 activate
      neighbor 192.168.15.18 soft-reconfiguration inbound
   exit-address-family
```

>[!NOTE]
>Чтобы включить BFD в существующей частной пиринговой связи, необходимо выполнить сброс пиринга. Дополнительные сведения о сбросе пиринга для канала ExpressRoute см. [здесь][ResetPeering].
>

## <a name="bfd-timer-negotiation"></a>Согласование таймера BFD

Между одноранговыми узлами BFD скорость передачи определяет более медленный узел. Для интервалов передачи и получения BFD для MSEE установлено значение 300 миллисекунд. В некоторых случаях интервал может задаваться с более высоким значением в 750 миллисекунд. Настроив более высокое значение, можно задать для этих интервалов больше времени, но невозможно сделать их короче.

>[!NOTE]
>Если вы настроили геоизбыточные каналы ExpressRoute или используете VPN-подключение типа "сеть — сеть" в качестве резервной копии. Включение БФД может ускорить отработку отказа после сбоя подключения ExpressRoute. 
>

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения доступны в следующих источниках:

- [Создание и изменение канала ExpressRoute][CreateCircuit]
- [Создание и изменение маршрутизации для канала ExpressRoute][CreatePeering]

<!--Image References-->
[1]: ./media/expressroute-bfd/BFD_Need.png "BFD ускоряет время обнаружения сбоя связи"

<!--Link References-->
[CreateCircuit]: ./expressroute-howto-circuit-portal-resource-manager.md
[CreatePeering]: ./expressroute-howto-routing-portal-resource-manager.md
[ResetPeering]: ./expressroute-howto-reset-peering.md