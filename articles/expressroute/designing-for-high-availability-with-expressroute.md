---
title: 'Azure ExpressRoute: проектирование для обеспечения высокой доступности'
description: На этой странице приведены рекомендации по архитектуре для обеспечения высокого уровня доступности при использовании Azure ExpressRoute.
services: expressroute
author: duongau
ms.service: expressroute
ms.topic: article
ms.date: 06/28/2019
ms.author: duau
ms.openlocfilehash: 3602c3944e8731263fbb55f024c276783950329f
ms.sourcegitcommit: 772eb9c6684dd4864e0ba507945a83e48b8c16f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "92202367"
---
# <a name="designing-for-high-availability-with-expressroute"></a>Проектирование для обеспечения высокого уровня доступности с помощью ExpressRoute

ExpressRoute обеспечивает высокий уровень доступности для обеспечения возможности подключения частной сети к ресурсам Майкрософт на несущей категории. Иными словами, в пути ExpressRoute в сети Microsoft нет единой точки отказа. Чтобы максимально увеличить доступность, необходимо также разработать архитектуру клиента и поставщика услуг для канала ExpressRoute, чтобы обеспечить высокий уровень доступности. В этой статье мы рассмотрим рекомендации по архитектуре сети для создания надежного сетевого подключения с помощью ExpressRoute, а затем рассмотрим функции тонкой настройки, которые помогут улучшить высокий уровень доступности канала ExpressRoute.

>[!NOTE]
>Основные понятия, описанные в этой статье, справедливы при создании канала ExpressRoute в виртуальной глобальной сети или за ее пределами.
>

## <a name="architecture-considerations"></a>Рекомендации по архитектуре

На следующем рисунке показан рекомендуемый способ подключения с помощью канала ExpressRoute для максимизации доступности канала ExpressRoute.

 [![1]][1]

Для обеспечения высокого уровня доступности важно поддерживать избыточность канала ExpressRoute во всей сети. Иными словами, необходимо обеспечить избыточность в локальной сети и не нарушать избыточность в сети поставщика услуг. Поддержание избыточности минимума подразумевает отсутствие единой точки отказов в сети. Наличие избыточного питания и охлаждения для сетевых устройств повышает уровень доступности.

### <a name="first-mile-physical-layer-design-considerations"></a>Рекомендации по проектированию физического уровня в первую очередь

 Если вы завершите первичное и вторичное подключения каналов ExpressRoute на одном клиентском оборудовании (CPE), вы помешаете высокий уровень доступности в локальной сети. Кроме того, если настроить первичное и вторичное подключения через один и тот же порт CPE (путем завершения двух подключений в разных подинтерфейсах или слияния двух подключений в рамках сети партнера), то вы вынуждены заставить партнера нарушить высокий уровень доступности в своем сегменте сети. Этот компромисс показан на следующем рисунке.

[![2]][2]

С другой стороны, если вы завершите первичное и вторичное подключения каналов ExpressRoute в разных географических расположениях, вы можете порушить производительность сетевого подключения. Если трафик активно распределяется между основным и дополнительным подключениями, которые прерываются в разных географических расположениях, потенциально существенное различие в сетевой задержке между двумя путями приведет к неоптимальной производительности сети. 

Сведения о геоизбыточном проектировании см. [в статье Разработка для аварийного восстановления с помощью ExpressRoute][DR].

### <a name="active-active-connections"></a>Активные — активные подключения

Сеть Майкрософт настроена для работы основного и дополнительного подключений каналов ExpressRoute в режиме "активный — активный". Однако с помощью объявлений маршрутов можно принудительно применить избыточные подключения канала ExpressRoute к активному и пассивному режимам. Объявление более конкретных маршрутов и ожидаемого пути BGP — это распространенные методы, позволяющие сделать один путь предпочтительнее другого.

Для повышения высокого уровня доступности рекомендуется работать как с подключением канала ExpressRoute в режиме "активный — активный". Если вы разрешите, что подключения работают в режиме "активный — активный", сеть Майкрософт будет распределять трафик по подключениям на основе каждого потока.

При запуске основного и дополнительного подключения канала ExpressRoute в режиме "активный — пассивный" возникает риск сбоя обоих подключений после сбоя в активном пути. Распространенные причины сбоя при переключении — отсутствие активного управления пассивным подключением, а пассивное подключение объявляет устаревшие маршруты.

Кроме того, выполнение основного и дополнительного подключения канала ExpressRoute в режиме "активный — активный" приводит к неудачному выполнению всех потоков и их перенаправлению после сбоя подключения ExpressRoute. Таким же режим "активный — активный" поможет улучшить среднее время восстановления (MTTR).

### <a name="nat-for-microsoft-peering"></a>NAT для пиринга Майкрософт 

Пиринг Майкрософт предназначен для обмена данными между общедоступными конечными точками. Таким образом, локальные частные конечные точки — это преобразование сетевых адресов (с использованием общедоступного IP-адреса) в сеть клиента или партнера до того, как они обмениваются данными через пиринг Майкрософт. Если вы используете как основное, так и вторичное подключения в режиме "активный — активный", где и как вы повлияете на то, как быстро восстанавливаться после сбоя в одном из подключений ExpressRoute. На следующем рисунке показаны два различных варианта NAT.

[![3-5]][3]

В варианте 1 NAT применяется после разделения трафика между основным и дополнительным подключениями ExpressRoute. Для удовлетворения требований к состоянию NAT, независимые пулы NAT используются между основным и дополнительным устройствами, чтобы возвращаемый трафик поступал на то же самое пограничное устройство, через которое поток егрессед.

В варианте 2 используется общий пул NAT перед разделением трафика между основным и дополнительным подключениями ExpressRoute. Важно отметить, что общий пул NAT перед разделением трафика не означает наличие единой точки отказа, тем самым нарушая высокий уровень доступности.

При выборе варианта 1 после сбоя подключения ExpressRoute возможность достижения соответствующего пула NAT будет нарушена. Таким образом, все неработающие потоки должны быть восстановлены на уровне TCP или приложения после соответствующего времени ожидания окна. Если какой-либо из пулов NAT используется для внешнего интерфейса любого из локальных серверов и если соответствующее подключение было бы неудачным, то локальные серверы не могут быть доступны из Azure до тех пор, пока подключение не будет устранено.

В то время как с параметром 2, NAT доступен даже после сбоя первичного или вторичного подключения. Таким образом, сетевой уровень может перенаправлять пакеты и ускорить восстановление после сбоя. 

> [!NOTE]
> Если вы используете вариант NAT 1 (независимые пулы NAT для основного и дополнительного подключения ExpressRoute) и сопоставляете порт IP-адреса из одного из пулов NAT с локальным сервером, сервер не будет доступен через канал ExpressRoute при сбое соответствующего подключения.
> 

## <a name="fine-tuning-features-for-private-peering"></a>Тонкая настройка функций для частного пиринга

В этом разделе мы рассмотрим дополнительные возможности (в зависимости от вашего развертывания Azure и того, насколько конфиденциальны ваши MTTR), которые помогают повысить высокий уровень доступности канала ExpressRoute. В частности, давайте рассмотрим развертывание шлюзов виртуальной сети ExpressRoute с учетом зоны и обнаружение двунаправленной переадресации (БФД).

### <a name="availability-zone-aware-expressroute-virtual-network-gateways"></a>Шлюзы виртуальной сети ExpressRoute с учетом зоны доступности

Зона доступности в регионе Azure — это сочетание домена сбоя и домена обновления. Если вы хотите выбрать избыточное в зону развертывание Azure IaaS, вы также можете настроить шлюзы виртуальной сети, избыточные в зонах, которые завершают частный пиринг ExpressRoute. Дополнительные сведения см. [в разделе сведения о шлюзах виртуальной сети, избыточных в зонах, в зоны доступности Azure][zone redundant vgw]. Сведения о настройке шлюза виртуальной сети, избыточного в зоне, см. [в разделе Создание шлюза виртуальной сети с избыточностью в зоны доступности Azure][conf zone redundant vgw].

### <a name="improving-failure-detection-time"></a>Улучшение времени обнаружения сбоев

ExpressRoute поддерживает БФД через частный пиринг. БФД сокращает время обнаружения сбоя по сети уровня 2 между Microsoft Enterprise (MSEE) и соседями BGP на локальной стороне от 3 минут (по умолчанию) до секунды. Время быстрого обнаружения сбоев помогает хастенинг восстановление после сбоя. Дополнительные сведения см. в разделе [Настройка бфд через ExpressRoute][BFD].

## <a name="next-steps"></a>Дальнейшие действия

В этой статье мы рассмотрели разработку для обеспечения высокого уровня доступности подключения канала ExpressRoute. Пиринг канала ExpressRoute закрепляется в географическом расположении и поэтому может повлиять на выполнение катастрофического сбоя, влияющего на все расположение. 

Рекомендации по проектированию для создания геоизбыточного сетевого подключения к магистрали Майкрософт, которые могут выдерживать катастрофические сбои, которые влияют на весь регион, см. [в разделе Разработка для аварийного восстановления с помощью частного пиринга ExpressRoute][DR].

<!--Image References-->
[1]: ./media/designing-for-high-availability-with-expressroute/exr-reco.png "рекомендуемый способ подключения с помощью ExpressRoute"
[2]: ./media/designing-for-high-availability-with-expressroute/suboptimal-lastmile-connectivity.png "неоптимальное подключение в последнюю очередь"
[3]: ./media/designing-for-high-availability-with-expressroute/nat-options.png "варианта NAT"


<!--Link References-->
[zone redundant vgw]: ../vpn-gateway/about-zone-redundant-vnet-gateways.md
[conf zone redundant vgw]: ../vpn-gateway/create-zone-redundant-vnet-gateway.md
[Configure Global Reach]: ./expressroute-howto-set-global-reach.md
[BFD]: ./expressroute-bfd.md
[DR]: ./designing-for-disaster-recovery-with-expressroute-privatepeering.md