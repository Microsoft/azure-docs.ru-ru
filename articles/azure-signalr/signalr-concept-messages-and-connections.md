---
title: Сообщения и подключения в службе Azure SignalR
description: Обзор основных понятий, касающихся сообщений и подключений в службе Azure SignalR.
author: sffamily
ms.service: signalr
ms.topic: conceptual
ms.date: 08/05/2020
ms.author: zhshang
ms.openlocfilehash: 3c4d28addac0ecfc9605678582562550a1c96b8d
ms.sourcegitcommit: 4bda786435578ec7d6d94c72ca8642ce47ac628a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/16/2021
ms.locfileid: "103491951"
---
# <a name="messages-and-connections-in-azure-signalr-service"></a>Сообщения и подключения в службе Azure SignalR

Модель выставления счетов службы Azure SignalR основана на количестве подключений и сообщений. В этой статье объясняется, как сообщения и подключения определяются и учитываются при выставлении счетов.


## <a name="message-formats"></a>Форматы сообщений 

Служба Azure SignalR поддерживает те же форматы, что и ASP.NET Core SignalR: [JSON](https://www.json.org/) и [MessagePack](/aspnet/core/signalr/messagepackhubprotocol).

## <a name="message-size"></a>Размер сообщения

В службе Azure SignalR нет ограничений на размер сообщений.

Большие сообщения разбиваются на меньшие размером не более 2 КБ и передаются в виде отдельных сообщений. Разбиение и соединение сообщений обрабатываются с помощью пакетов SDK. При этом усилия со стороны разработчиков не требуются.

Большие сообщения снижают производительность обмена сообщениями. Используйте сообщения меньшего размера всегда, когда это возможно, и выполняйте тестирование, чтобы выбрать оптимальный размер сообщения для каждого сценария использования.

## <a name="how-messages-are-counted-for-billing"></a>Подсчет сообщений для выставления счетов

При выставлении счетов учитываются только исходящие сообщения службы Azure SignalR. Сообщения проверки связи, которыми обмениваются клиенты и серверы, в расчет не берутся.

Сообщения размером более 2 КБ считаются как несколько сообщений по 2 КБ. Диаграмма числа сообщений на портале Azure обновляется при поступлении каждых 100 сообщений на концентратор.

Например, представьте, что у вас есть один сервер приложений и три клиента:

Сервер приложений передает сообщение размером 1 КБ на все подключенные клиенты. сообщение от сервера приложений к службе считается свободным входящим сообщением. Только три сообщения, отправляемые из службы на каждый клиент, выставляются как исходящие сообщения.

Клиент A отправляет сообщение размером 1 КБ на другой клиент б, не пробегая через сервер приложений. Сообщение от клиента а к службе — бесплатное входящее сообщение. Сообщение от службы к клиенту б оплачивается как исходящее сообщение.

Если у вас есть три клиента и один сервер приложений. Один клиент отправляет одно сообщение размером 4 КБ, чтобы сервер передал данные всем клиентам. Число сообщений с оплатой составляет восемь: одно сообщение от службы к серверу приложений и три сообщения от службы к клиентам. Каждое сообщение считается как два сообщения по 2 КБ.

## <a name="how-connections-are-counted"></a>Подсчет подключений

Существуют подключения к серверу и клиентские подключения со службой Azure SignalR. По умолчанию каждый сервер приложений запускается с пятью начальными подключениями на каждый концентратор, и каждый клиент имеет одно клиентское соединение.

Например, предположим, что у вас есть два сервера приложений и вы определили пять концентраторов в коде. Число подключений к серверу будет 50:2 сервера приложений * 5 концентраторов * 5 подключений на концентратор.

Число подключений, показанное в портал Azure, включает подключения к серверу, подключения клиентов, диагностические подключения и динамические подключения трассировки. Типы подключения определены в следующем списке:

- **Подключение к серверу**: подключает службу Azure SignalR и сервер приложений.
- **Клиентское подключение**: подключает службу Azure SignalR и клиентское приложение.
- **Диагностическое соединение**: особый тип клиентского соединения, который может создать более подробный журнал, что может повлиять на производительность. Этот тип клиента предназначен для устранения неполадок.
- **Динамическое подключение трассировки**: подключается к конечной точке трассировки в режиме реального времени и получает динамические трассировки службы Azure SignalR. 
 
Обратите внимание, что активное соединение трассировки не учитывается как клиентское соединение или как соединение с сервером. 

Служба SignalR для ASP.NET подсчитывает подключения к серверу по-другому. Она добавляет один стандартный концентратор к уже определенным вами концентраторам. По умолчанию каждому серверу приложений требуется пять первых серверных подключений. Начальное число подключений для концентратора по умолчанию остается согласованным с другими центрами.

Служба и сервер приложений сохраняют состояние подключения и осуществляют настройку подключений к серверу, чтобы повысить производительность и стабильность службы.  Так что вы можете увидеть, что количество подключений к серверу изменяется с момента времени.

## <a name="how-inboundoutbound-traffic-is-counted"></a>Подсчет входящего и исходящего трафика

Сообщение, отправленное в службу, является входящим сообщением. Сообщение, отправленное из службы, является исходящим сообщением. Трафик вычисляется в байтах.

## <a name="related-resources"></a>Связанные ресурсы

- [Метрики, поддерживаемые Azure Monitor](../azure-monitor/essentials/metrics-supported.md#microsoftsignalrservicesignalr )
- [Конфигурация SignalR для ASP.NET Core](/aspnet/core/signalr/configuration)
- [JSON](https://www.json.org/)
- [MessagePack](/aspnet/core/signalr/messagepackhubprotocol)
