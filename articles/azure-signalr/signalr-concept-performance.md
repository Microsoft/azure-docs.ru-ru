---
title: Руководство по производительности для Службы Azure SignalR
description: Общие сведения о производительности и тестовом проходе службы Azure SignalR. Ключевые метрики, которые следует учитывать при планировании емкости.
author: sffamily
ms.service: signalr
ms.topic: conceptual
ms.date: 11/13/2019
ms.author: zhshang
ms.openlocfilehash: 68cad32be177fa20794399157fca89e87c2f8f59
ms.sourcegitcommit: 867cb1b7a1f3a1f0b427282c648d411d0ca4f81f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "74157667"
---
# <a name="performance-guide-for-azure-signalr-service"></a>Руководство по производительности для Службы Azure SignalR

Одним из основных преимуществ использования службы Azure SignalR является простота масштабирования приложений SignalR. В крупномасштабном сценарии производительность является важным фактором. 

В этом разделе описываются факторы, влияющие на производительность приложения SignalR. Мы расскажем о типичной производительности в различных сценариях использования. В итоге мы рассмотрим среду и средства, которые можно использовать для создания отчета о производительности.

## <a name="term-definitions"></a>Определения терминов

*Входящий трафик*: входящее сообщение в службу Azure SignalR.

*Исходящий трафик*: исходящее сообщение от службы Azure SignalR.

*Пропускная способность*: общий размер всех сообщений в 1 секунду.

*Режим по умолчанию*: рабочий режим по умолчанию при создании экземпляра службы Azure SignalR. Служба Azure SignalR требует, чтобы сервер приложений установил подключение к нему, прежде чем будет принимать подключения клиентов.

*Бессерверный режим*: режим, в котором служба Azure SignalR принимает только клиентские подключения. Подключение к серверу не разрешено.

## <a name="overview"></a>Обзор

Служба Azure SignalR определяет семь уровней уровня "Стандартный" для разных уровней производительности. Это руководство содержит ответы на следующие вопросы:

-   Какова типичная производительность службы SignalR Azure для каждого уровня?

-   Соответствует ли служба Azure SignalR требованиям к пропускной способности сообщений (например, отправка 100 000 сообщений в секунду)?

-   Какой уровень подходит для моего конкретного сценария? Как выбрать нужный уровень?

-   Какой сервер приложений (размер виртуальной машины) подходит для меня? Сколько из них следует развернуть?

Чтобы ответить на эти вопросы, в этом руководством дается подробное описание факторов, влияющих на производительность. Затем он иллюстрирует максимальное количество входящих и исходящих сообщений для каждого уровня для типичных вариантов использования: **эхо**, **вещание**, **Отправка в группу** и **Подключение к** сети (одноранговые беседы).

В этом руководством не рассматриваются все сценарии (и различные варианты использования, размеры сообщений, шаблоны отправки сообщений и т. д.). Но он предоставляет ряд методов, которые помогут вам:

- Оцените приблизительные требования для входящих или исходящих сообщений.
- Найдите нужные уровни, проверив таблицу производительности.

## <a name="performance-insight"></a>Аналитика производительности

В этом разделе описаны методологии оценки производительности, а затем перечислены все факторы, влияющие на производительность. В итоге он предоставляет методы, помогающие оценить требования к производительности.

### <a name="methodology"></a>Методика

*Пропускная способность* и *Задержка* — это два типичных аспекта проверки производительности. Для службы Azure SignalR каждый уровень SKU имеет собственную политику регулирования пропускной способности. Политика определяет максимально допустимую пропускную способность *(входящая и исходящая* пропускная способность) в качестве максимальной пропускной способности, когда 99 процентов сообщений имеют задержку менее 1 секунды.

Задержка — это интервал времени от подключения, с которого отправляется сообщение для получения ответного сообщения от службы Azure SignalR. Давайте **рассмотрим пример** . Каждое клиентское соединение добавляет в сообщение метку времени. Концентратор сервера приложений отправляет исходное сообщение обратно клиенту. Поэтому задержка распространения легко вычисляется каждым клиентским соединением. Метка времени прикрепляется для каждого сообщения в **широковещательной рассылке**, **отправки в группу** и **отправки в соединение**.

Для имитации тысяч одновременных клиентских подключений в виртуальной частной сети Azure создаются несколько виртуальных машин. Все эти виртуальные машины подключаются к одному и тому же экземпляру службы Azure SignalR.

В режиме по умолчанию службы SignalR Azure виртуальные машины сервера приложений развертываются в той же виртуальной частной сети, что и клиентские виртуальные машины. Все клиентские виртуальные машины и виртуальные машины сервера приложений развертываются в одной сети одного региона, чтобы избежать задержки между регионами.

### <a name="performance-factors"></a>Факторы производительности

Теоретически емкость службы SignalR Azure ограничена вычислительными ресурсами: ЦП, памятью и сетью. Например, дополнительные подключения к службе Azure SignalR приводят к тому, что служба использует больше памяти. Для трафика с большим количеством сообщений (например, размер каждого сообщения превышает 2 048 байт) служба Azure SignalR должна тратить больше циклов ЦП на обработку трафика. В то же время, пропускная способность сети Azure также накладывает ограничение на максимальный объем трафика.

Тип транспорта является еще одним фактором, влияющим на производительность. Три типа — это [WebSocket](https://en.wikipedia.org/wiki/WebSocket), [Серверная передача событий](https://en.wikipedia.org/wiki/Server-sent_events)и [длительный опрос](https://en.wikipedia.org/wiki/Push_technology). 

WebSocket — это двунаправленный и дуплексный протокол связи по одному TCP-соединению. Server-Sentd-Event — это однонаправленный протокол для отправки сообщений с сервера на клиент. Long-Polling требует, чтобы клиенты периодически опрашивают данные с сервера через HTTP-запрос. Для одного и того же API в одном и том же состоянии WebSocket имеет лучшую производительность, серверное событие — медленный, а Long-Polling является самым медленным. По умолчанию служба Azure SignalR рекомендует WebSocket.

Стоимость маршрутизации сообщений также ограничивает производительность. Служба Azure SignalR играет роль в качестве маршрутизатора сообщений, который направляет сообщение от набора клиентов или серверов другим клиентам или серверам. Для другого сценария или API требуется другая политика маршрутизации. 

Для **echo** клиент отправляет сообщение самому себе, а назначение маршрутизации также является самим собой. Этот шаблон имеет наименьшую стоимость маршрутизации. Но для **вещания**, **отправки в группу** и **отправки в подключение** служба Azure SignalR должна выполнять поиск целевых подключений с помощью внутренней распределенной структуры данных. Эта дополнительная обработка использует больше ресурсов ЦП, памяти и пропускной способности сети. В результате производительность снижается.

В режиме по умолчанию сервер приложений также может стать узким местом для некоторых сценариев. Пакет SDK для Azure SignalR должен вызывать концентратор, в то время как он поддерживает динамическое подключение к каждому клиенту через сигналы пульса.

В режиме без сервера клиент отправляет сообщение по протоколу HTTP POST, что не так эффективно, как WebSocket.

Другой фактор — протокол: JSON и [MessagePack](https://msgpack.org/index.html). Размер MessagePack меньше и доставляется быстрее JSON. Однако MessagePack может не повысить производительность. Производительность службы Azure SignalR не важна для протоколов, так как она не расшифровывает полезные данные сообщения во время пересылки сообщений от клиентов на серверы и наоборот.

В сводке ниже перечислены факторы, влияющие на входящую и исходящий объемы.

-   Уровень SKU (ЦП/память)

-   Количество подключений.

-   Размер сообщения

-   Скорость отправки сообщений

-   Тип транспорта (WebSocket, сервер-отправка-событие или длительное опрос)

-   Сценарий варианта использования (стоимость маршрутизации)

-   Сервер приложений и подключения к службам (в режиме сервера)


### <a name="finding-a-proper-sku"></a>Поиск подходящего номера SKU

Как можно оценить объем входящей или исходящей мощности или определить, какой уровень подходит для конкретного варианта использования?

Предположим, что сервер приложений достаточно мощный и не является узким местом производительности. Затем проверьте максимальную пропускную способность входящего и исходящего трафика для каждого уровня.

#### <a name="quick-evaluation"></a>Быстрая оценка

Сначала Упростите оценку, предполагаю некоторые параметры по умолчанию: 

- Тип транспорта — WebSocket.
- Размер сообщения составляет 2 048 байт.
- Сообщение отправляется каждые 1 секунду.
- Служба Azure SignalR находится в режиме по умолчанию.

Для каждого уровня предусмотрена собственная максимальная пропускная способность и исходящая пропускная способность. При превышении предельного значения для входящего или исходящего подключения не гарантируется удобство работы пользователя.

**Echo** обеспечивает максимальную пропускную способность входящего трафика, так как она имеет наименьшую стоимость маршрутизации. **Широковещательная рассылка** определяет максимальную пропускную способность исходящего сообщения.

*Не* превышайте выделенные значения в следующих двух таблицах.

|       Echo                        | Unit1 | Unit2 | Unit5 | Unit10 | Unit20 | Unit50 | Unit100 |
|-----------------------------------|-------|-------|-------|--------|--------|--------|---------|
| Соединения                       | 1000 | 2 000 | 5 000 | 10 000 | 20 000 | 50 000 | 100 000 |
| **Входящая пропускная способность** | **2 Мбит/с**    | **4 Мбит/с**    | **10 Мбит/с**   | **20 Мбит/с**    | **40 Мбит/с**    | **100 Мбит/с**   | **200 Мбит/с**    |
| Исходящая пропускная способность | 2 Мбит/с   | 4 Мбит/с   | 10 Мбит/с  | 20 Мбит/с   | 40 Мбит/с   | 100 Мбит/с  | 200 Мбит/с   |


|     Широковещательное             | Unit1 | Unit2 | Unit5  | Unit10 | Unit20 | Unit50  | Unit100 |
|---------------------------|-------|-------|--------|--------|--------|---------|---------|
| Соединения               | 1000 | 2 000 | 5 000  | 10 000 | 20 000 | 50 000  | 100 000 |
| Входящая пропускная способность  | 4 кбит/с   | 4 кбит/с   | 4 кбит/с    | 4 кбит/с    | 4 кбит/с    | 4 кбит/с     | 4 кбит/с    |
| **Исходящая пропускная способность** | **4 Мбит/с**    | **8 Мбит/с**    | **20 Мбит/с**    | **40 Мбит/с**    | **80 Мбит/с**    | **200 Мбит/с**    | **400 Мбит/с**   |

*Входящая пропускная способность* и *Исходящая пропускная способность* — это общий размер сообщений в секунду.  Ниже приведены формулы для них.
```
  inboundBandwidth = inboundConnections * messageSize / sendInterval
  outboundBandwidth = outboundConnections * messageSize / sendInterval
```

- *инбаундконнектионс*: число подключений, отправляющих сообщение.

- *аутбаундконнектионс*: количество подключений, получающих сообщение.

- *мессажесизе*: размер одного сообщения (среднее значение). Небольшое сообщение, размер которого меньше 1 024 байт, влияет на производительность, аналогичную 1 024-байтному сообщению.

- *сендинтервал*: время отправки одного сообщения. Обычно это 1 секунда на сообщение, что означает отправку одного сообщения каждую секунду. Меньший интервал означает отправку дополнительных сообщений за период времени. Например, 0,5 секунд на сообщение означает отправку двух сообщений каждую секунду.

- *Подключения*: максимальное пороговое значение фиксации для службы Azure SignalR для каждого уровня. Если номер подключения больше не используется, регулирование подключения будет отрицательным.

#### <a name="evaluation-for-complex-use-cases"></a>Оценка сложных вариантов использования

##### <a name="bigger-message-size-or-different-sending-rate"></a>Больший размер сообщения или разная скорость отправки

Реальный вариант использования более сложен. Он может отправлять сообщения размером более 2 048 байт или скорость отправки сообщений — не одно сообщение в секунду. Давайте Unit100's вещание в качестве примера, чтобы узнать, как оценить его производительность.

В следующей таблице показан реальный вариант использования **вещания**. Но скорость передачи сообщений, число подключений и частота отправки сообщений отличаются от того, что мы предполагали в предыдущем разделе. Вопрос заключается в том, как можно вычислить любые из этих элементов (размер сообщения, число подключений или скорость отправки сообщений), если мы понимаем только два из них.

| Широковещательное  | Размер сообщения | Входящих сообщений в секунду | Соединения | Интервалы отправки |
|---|---------------------|--------------------------|-------------|-------------------------|
| 1 | 20 КБ                | 1                        | 100 000     | 5 секунд                      |
| 2 | 256 КБ               | 1                        | 8000       | 5 секунд                      |

Следующую формулу легко определить на основе предыдущей формулы:

```
outboundConnections = outboundBandwidth * sendInterval / messageSize
```

Для Unit100 максимальная исходящая пропускная способность составляет 400 МБ из предыдущей таблицы. Для сообщений размером 20 КБ максимальное количество исходящих подключений должно составлять 400 МБ \* 5/20 КБ = 100 000, что соответствует реальному значению.

##### <a name="mixed-use-cases"></a>Смешанные варианты использования

Реальный вариант использования обычно объединяет четыре основных варианта использования: **эхо**, **вещание**, **Отправка в группу** и **Отправка в соединение**. Ниже приведена методология, используемая для вычисления емкости.

1. Разделите смешанные сценарии использования на четыре основных варианта использования.
1. Вычислите максимальную пропускную способность входящего и исходящего трафика, используя приведенные выше формулы отдельно.
1. Суммировать вычисления пропускной способности, чтобы получить общую максимальную пропускную способность входящего и исходящего трафика. 

Затем выберите нужный уровень в списке Максимальное количество входящих и исходящих таблиц пропускной способности.

> [!NOTE]
> Для отправки сообщения сотням или тысячам небольших групп или для тысяч клиентов, отправляющих сообщения друг другу, стоимость маршрутизации станет главным. Примите это воздействие на учетную запись.

В случае отправки сообщения клиентам убедитесь, что сервер приложений *не* является узким местом. В следующем разделе "пример внедрения" приводятся рекомендации по количеству требуемых серверов приложений и количеству подключений к серверу, которые необходимо настроить.

## <a name="case-study"></a>Пример

В следующих разделах рассматриваются четыре типичных варианта использования транспорта WebSocket: **эхо**, **вещание**, **Отправка в группу** и **Отправка в соединение**. Для каждого сценария в разделе перечислены текущие входящие и исходящие мощности службы SignalR Azure. В нем также объясняются основные факторы, влияющие на производительность.

В режиме по умолчанию сервер приложений создает пять подключений к серверу со службой Azure SignalR. Сервер приложений использует пакет SDK службы SignalR для Azure по умолчанию. В следующих результатах теста производительности серверные соединения увеличиваются до 15 (или больше для вещания и отправки сообщения в большую группу).

Разные варианты использования имеют разные требования к серверам приложений. Для **вещания** требуется небольшое количество серверов приложений.  **Для передачи сообщений или отправки в подключение** требуется много серверов приложений.

Во всех вариантах использования размер сообщения по умолчанию составляет 2 048 байт, а интервал отправки сообщений — 1 секунда.

### <a name="default-mode"></a>Режим по умолчанию

Клиенты, серверы веб-приложений и служба SignalR Azure включены в режим по умолчанию. Каждый клиент означает одно подключение.

#### <a name="echo"></a>Echo

Сначала веб-приложение подключается к службе Azure SignalR. Во вторых, многие клиенты подключаются к веб-приложению, которое перенаправляет клиентов в службу Azure SignalR с помощью маркера доступа и конечной точки. Затем клиенты устанавливают подключения WebSocket к службе Azure SignalR.

После того как все клиенты установили соединения, они начинают отправлять сообщения, содержащие отметку времени, в конкретный центр каждую секунду. Концентратор выводит сообщение обратно на первоначальный клиент. Каждый клиент вычисляет задержку при получении Эхо-сообщения.

На схеме ниже 5 – 8 (выделенный красным цветом трафик) находится в цикле. Цикл выполняется для длительности по умолчанию (5 минут) и получает статистику всех задержек сообщений.

![Трафик для варианта использования эха](./media/signalr-concept-performance/echo.png)

Поведение **эха** определяет максимальную пропускную способность, равную максимальной исходящей пропускной способности. Дополнительные сведения см. в приведенной ниже таблице.

|       Echo                        | Unit1 | Unit2 | Unit5 | Unit10 | Unit20 | Unit50 | Unit100 |
|-----------------------------------|-------|-------|-------|--------|--------|--------|---------|
| Соединения                       | 1000 | 2 000 | 5 000 | 10 000 | 20 000 | 50 000 | 100 000 |
| Входящих и исходящих сообщений в секунду | 1000 | 2 000 | 5 000 | 10 000 | 20 000 | 50 000 | 100 000 |
| Пропускная способность входящего и исходящего трафика | 2 Мбит/с   | 4 Мбит/с   | 10 Мбит/с  | 20 Мбит/с   | 40 Мбит/с   | 100 Мбит/с  | 200 Мбит/с   |

В этом варианте использования каждый клиент вызывает концентратор, определенный на сервере приложений. Концентратор просто вызывает метод, определенный в исходной стороне клиента. Этот центр является самым простым концентратором для **эха**.

```
        public void Echo(IDictionary<string, object> data)
        {
            Clients.Client(Context.ConnectionId).SendAsync("RecordLatency", data);
        }
```

Даже для этого простого концентратора нагрузка на трафик на сервере приложений заметна при увеличении нагрузки **для входящих сообщений** . Эта нагрузка на трафик требует большого количества серверов приложений для крупных уровней SKU. В следующей таблице перечислены числа серверов приложений для каждого уровня.


|    Echo          | Unit1 | Unit2 | Unit5 | Unit10 | Unit20 | Unit50 | Unit100 |
|------------------|-------|-------|-------|--------|--------|--------|---------|
| Соединения      | 1000 | 2 000 | 5 000 | 10 000 | 20 000 | 50 000 | 100 000 |
| Число серверов приложений | 2     | 2     | 2     | 3      | 3      | 10     | 20      |

> [!NOTE]
> Номер подключения клиента, размер сообщения, скорость отправки сообщений, уровень SKU, а также ЦП и память сервера приложений влияют на общую производительность **эха**.

#### <a name="broadcast"></a>Широковещательное

Для **вещания**, когда веб-приложение получает сообщение, оно рассылается всем клиентам. Чем больше клиентов нужно транслировать, тем больше трафика сообщений нужно для всех клиентов. Рассмотрим схему ниже.

![Трафик для варианта использования вещания](./media/signalr-concept-performance/broadcast.png)

Небольшое количество клиентов — вещание. Пропускная способность входящего сообщения мала, но исходящая пропускная способность очень велика. Пропускная способность исходящего сообщения увеличивается по мере увеличения количества подключений клиентов или широковещательной передачи.

В следующей таблице перечислены максимальные клиентские подключения, количество входящих и исходящих сообщений, а также пропускная способность.

|     Широковещательное             | Unit1 | Unit2 | Unit5  | Unit10 | Unit20 | Unit50  | Unit100 |
|---------------------------|-------|-------|--------|--------|--------|---------|---------|
| Соединения               | 1000 | 2 000 | 5 000  | 10 000 | 20 000 | 50 000  | 100 000 |
| Входящих сообщений в секунду  | 2     | 2     | 2      | 2      | 2      | 2       | 2       |
| Исходящих сообщений в секунду | 2 000 | 4000 | 10 000 | 20 000 | 40 000 | 100 000 | 200 000 |
| Входящая пропускная способность  | 4 кбит/с   | 4 кбит/с   | 4 кбит/с    | 4 кбит/с    | 4 кбит/с    | 4 кбит/с     | 4 кбит/с     |
| Исходящая пропускная способность | 4 Мбит/с   | 8 Мбит/с   | 20 Мбит/с   | 40 Мбит/с   | 80 Мбит/с   | 200 Мбит/с   | 400 Мбит/с   |

Широковещательные клиенты, передающие сообщения, имеют не более четырех. Им требуется меньшее число серверов приложений по сравнению с **эхо** , так как объем входящего сообщения является небольшим. Для соглашения об уровне обслуживания и производительности достаточно двух серверов приложений. Но следует увеличить подключения к серверу по умолчанию, чтобы избежать дисбаланса, особенно для Unit50 и Unit100.

|   Широковещательное      | Unit1 | Unit2 | Unit5 | Unit10 | Unit20 | Unit50 | Unit100 |
|------------------|-------|-------|-------|--------|--------|--------|---------|
| Соединения      | 1000 | 2 000 | 5 000 | 10 000 | 20 000 | 50 000 | 100 000 |
| Число серверов приложений | 2     | 2     | 2     | 2      | 2      | 2      | 2       |

> [!NOTE]
> Увеличьте количество подключений к серверу по умолчанию с 5 до 40 на каждом сервере приложений, чтобы избежать возможных несбалансированных подключений к службе Azure SignalR.
>
> Номер подключения клиента, размер сообщения, скорость отправки сообщений и уровень SKU влияют на общую производительность **вещания**.

#### <a name="send-to-group"></a>Отправить в группу

Вариант использования " **отправить в группу** " имеет похожий шаблон трафика для **вещания**. Разница заключается в том, что после того, как клиенты устанавливают подключения WebSocket к службе Azure SignalR, они должны присоединиться к группам, прежде чем они смогут отправить сообщение в определенную группу. На следующей схеме показан поток трафика.

![Трафик для варианта использования "Отправка в группу"](./media/signalr-concept-performance/sendtogroup.png)

Число групп и членов групп — это два фактора, влияющих на производительность. Для упрощения анализа мы определим два типа групп:

- **Небольшая группа**: у каждой группы есть 10 подключений. Номер группы равен (максимальное число подключений)/10. Например, для UNIT1, если количество соединений 1 000, то у нас есть 1000/10 = 100 групп.

- **Большая группа**: номер группы всегда равен 10. Число членов группы равно (максимальное число соединений)/10. Например, для UNIT1, если количество соединений 1 000, то каждая группа имеет 1000/10 = 100 членов.

**Send to Group (отправка в группу** ) выводит стоимость маршрутизации в службу Azure SignalR, так как она должна находить целевые подключения через распределенную структуру данных. При увеличении числа отправляемых подключений увеличивается стоимость.

##### <a name="small-group"></a>Небольшая группа

Стоимость маршрутизации важна для отправки сообщения нескольким небольшим группам. В настоящее время реализация службы Azure SignalR достигает предельной стоимости маршрутизации по адресу Unit50. Добавление дополнительных ресурсов ЦП и памяти не помогает, поэтому Unit100 не может улучшить дальнейшее проектирование. Если требуется дополнительная пропускная способность, обратитесь в службу поддержки пользователей.

|   Отправить в маленькую группу     | Unit1 | Unit2 | Unit5  | Unit10 | Unit20 | Unit50 | Unit100 |
|---------------------------|-------|-------|--------|--------|--------|--------|---------|
| Соединения               | 1000 | 2 000 | 5 000  | 10 000 | 20 000 | 50 000 | 100 000
| Число участников группы        | 10    | 10    | 10     | 10     | 10     | 10     | 10 
| Число групп               | 100   | 200   | 500    | 1000  | 2 000  | 5 000  | 10 000 
| Входящих сообщений в секунду  | 200   | 400   | 1000  | 2500  | 4000  | 7000  | 7000   |
| Входящая пропускная способность  | 400 Кбит/с  | 800 кбит/с  | 2 Мбит/с     | 5 Мбит/с     | 8 Мбит/с     | 14 Мбит/с    | 14 Мбит/с     |
| Исходящих сообщений в секунду | 2 000 | 4000 | 10 000 | 25 000 | 40 000 | 70 000 | 70 000  |
| Исходящая пропускная способность | 4 Мбит/с    | 8 Мбит/с    | 20 Мбит/с    | 50 Мбит/с     | 80 Мбит/с    | 140 Мбит/с   | 140 Мбит/с    |

Многие клиентские соединения вызывают концентратор, поэтому для повышения производительности также важен номер сервера приложений. В следующей таблице перечислены рекомендуемые количества серверов приложений.

|  Отправить в маленькую группу   | Unit1 | Unit2 | Unit5 | Unit10 | Unit20 | Unit50 | Unit100 |
|------------------|-------|-------|-------|--------|--------|--------|---------|
| Соединения      | 1000 | 2 000 | 5 000 | 10 000 | 20 000 | 50 000 | 100 000 |
| Число серверов приложений | 2     | 2     | 2     | 3      | 3      | 10     | 20      |

> [!NOTE]
> Номер подключения клиента, размер сообщения, скорость отправки сообщений, стоимость маршрутизации, уровень SKU, а также ЦП и память сервера приложений влияют на общую производительность **отправки в маленькую группу**.

##### <a name="big-group"></a>Большая группа

Для **отправки в большую группу** исходящая пропускная способность становится узким местом перед достижением предельной стоимости маршрутизации. В следующей таблице приведена максимальная пропускная способность исходящего трафика, которая почти аналогична **широковещательной**.

|    Отправить в большую группу      | Unit1 | Unit2 | Unit5  | Unit10 | Unit20 | Unit50  | Unit100 |
|---------------------------|-------|-------|--------|--------|--------|---------|---------|
| Соединения               | 1000 | 2 000 | 5 000  | 10 000 | 20 000 | 50 000  | 100 000
| Число участников группы        | 100   | 200   | 500    | 1000  | 2 000  | 5 000   | 10 000 
| Число групп               | 10    | 10    | 10     | 10     | 10     | 10      | 10
| Входящих сообщений в секунду  | 20    | 20    | 20     | 20     | 20     | 20      | 20      |
| Входящая пропускная способность  | 80 кбит/с   | 40 кбит/с   | 40 кбит/с    | 20 кбит/с    | 40 кбит/с    | 40 кбит/с     | 40 кбит/с     |
| Исходящих сообщений в секунду | 2 000 | 4000 | 10 000 | 20 000 | 40 000 | 100 000 | 200 000 |
| Исходящая пропускная способность | 8 Мбит/с    | 8 Мбит/с    | 20 Мбит/с    | 40 Мбит/с    | 80 Мбит/с    | 200 Мбит/с    | 400 Мбит/с    |

Число отправляемых соединений не превышает 40. Нагрузка на сервер приложений невелика, поэтому предлагаемое число веб-приложений невелико.

|  Отправить в большую группу  | Unit1 | Unit2 | Unit5 | Unit10 | Unit20 | Unit50 | Unit100 |
|------------------|-------|-------|-------|--------|--------|--------|---------|
| Соединения      | 1000 | 2 000 | 5 000 | 10 000 | 20 000 | 50 000 | 100 000 |
| Число серверов приложений | 2     | 2     | 2     | 2      | 2      | 2      | 2       |

> [!NOTE]
> Увеличьте количество подключений к серверу по умолчанию с 5 до 40 на каждом сервере приложений, чтобы избежать возможных несбалансированных подключений к службе Azure SignalR.
> 
> Номер подключения клиента, размер сообщения, скорость отправки сообщений, стоимость маршрутизации и уровень SKU влияют на общую производительность **отправки в большую группу**.

#### <a name="send-to-connection"></a>Отправить в подключение

В варианте использования " **отправить к подключению** ", когда клиенты устанавливают подключения к службе Azure SignalR, каждый клиент вызывает Специальный концентратор для получения своего идентификатора подключения. Тест производительности собирает все идентификаторы подключений, переведет их в случайном порядке и переназначит их всем клиентам как цель отправки. Клиенты отправляют сообщение на целевое подключение до завершения теста производительности.

![Трафик для варианта использования "Send-to-Client"](./media/signalr-concept-performance/sendtoclient.png)

Стоимость маршрутизации для **подключения «отправка к** » аналогична стоимости **отправки небольшой группе**.

По мере увеличения числа подключений стоимость маршрутизации ограничивается общей производительностью. Unit50 достиг предела. В результате Unit100 не может улучшить работу.

Следующая таблица представляет собой статистическую сводку после множества циклов выполнения теста " **отправить на подключение** ".

|   Отправить в подключение   | Unit1 | Unit2 | Unit5 | Unit10 | Unit20 | Unit50          | Unit100         |
|------------------------------------|-------|-------|-------|--------|--------|-----------------|-----------------|
| Соединения                        | 1000 | 2 000 | 5 000 | 10 000 | 20 000 | 50 000          | 100 000         |
| Входящих и исходящих сообщений в секунду | 1000 | 2 000 | 5 000 | 8000  | 9000  | 20 000 | 20 000 |
| Пропускная способность входящего и исходящего трафика | 2 Мбит/с    | 4 Мбит/с    | 10 Мбит/с   | 16 Мбит/с    | 18 Мбит/с    | 40 Мбит/с       | 40 Мбит/с       |

Этот вариант использования требует высокой нагрузки на стороне сервера приложений. См. Рекомендуемое число серверов приложений в следующей таблице.

|  Отправить в подключение  | Unit1 | Unit2 | Unit5 | Unit10 | Unit20 | Unit50 | Unit100 |
|------------------|-------|-------|-------|--------|--------|--------|---------|
| Соединения      | 1000 | 2 000 | 5 000 | 10 000 | 20 000 | 50 000 | 100 000 |
| Число серверов приложений | 2     | 2     | 2     | 3      | 3      | 10     | 20      |

> [!NOTE]
> Номер подключения клиента, размер сообщения, скорость отправки сообщений, стоимость маршрутизации, уровень SKU, а также ЦП и память для сервера приложений влияют на общую производительность при **отправке соединения**.

#### <a name="aspnet-signalr-echo-broadcast-and-send-to-small-group"></a>ASP.NET SignalR эхо, вещание и отправка в маленькую группу

Служба Azure SignalR предоставляет такую же производительность для ASP.NET SignalR. 

Тест производительности использует веб-приложения Azure из [стандартного плана обслуживания S3](https://azure.microsoft.com/pricing/details/app-service/windows/) для ASP.NET SignalR.

В следующей таблице приводится рекомендуемое число веб-приложений для ASP.NET **SignalR.**

|   Echo           | Unit1 | Unit2 | Unit5 | Unit10 | Unit20 | Unit50 | Unit100 |
|------------------|-------|-------|-------|--------|--------|--------|---------|
| Соединения      | 1000 | 2 000 | 5 000 | 10 000 | 20 000 | 50 000 | 100 000 |
| Число серверов приложений | 2     | 2     | 4     | 4      | 8      | 32      | 40       |

В следующей таблице приведено предлагаемое число веб-приложений для **вещания** ASP.NET SignalR.

|  Широковещательное       | Unit1 | Unit2 | Unit5 | Unit10 | Unit20 | Unit50 | Unit100 |
|------------------|-------|-------|-------|--------|--------|--------|---------|
| Соединения      | 1000 | 2 000 | 5 000 | 10 000 | 20 000 | 50 000 | 100 000 |
| Число серверов приложений | 2     | 2     | 2     | 2      | 2      | 2      | 2       |

В следующей таблице приведено предлагаемое количество веб-приложений для ASP.NET SignalR **в маленькую группу**.

|  Отправить в маленькую группу     | Unit1 | Unit2 | Unit5 | Unit10 | Unit20 | Unit50 | Unit100 |
|------------------|-------|-------|-------|--------|--------|--------|---------|
| Соединения      | 1000 | 2 000 | 5 000 | 10 000 | 20 000 | 50 000 | 100 000 |
| Число серверов приложений | 2     | 2     | 4     | 4      | 8      | 32      | 40       |

### <a name="serverless-mode"></a>Бессерверный режим

Клиенты и служба Azure SignalR включены в бессерверный режим. Каждый клиент означает одно подключение. Клиент отправляет сообщения через REST API на другой клиент или широковещательные сообщения всем.

Отправка сообщений высокой плотности через REST API не так эффективна, как использование WebSocket. Он требует создания нового HTTP-подключения каждый раз, и это дополнительные затраты в бессерверном режиме.

#### <a name="broadcast-through-rest-api"></a>Вещание через REST API
Все клиенты устанавливают подключения WebSocket к службе Azure SignalR. Затем некоторые клиенты начинают вещание через REST API. Отправка сообщения (входящий трафик) осуществляется через HTTP POST, что не является эффективным по сравнению с WebSocket.

|   Вещание через REST API     | Unit1 | Unit2 | Unit5  | Unit10 | Unit20 | Unit50  | Unit100 |
|---------------------------|-------|-------|--------|--------|--------|---------|---------|
| Соединения               | 1000 | 2 000 | 5 000  | 10 000 | 20 000 | 50 000  | 100 000 |
| Входящих сообщений в секунду  | 2     | 2     | 2      | 2      | 2      | 2       | 2       |
| Исходящих сообщений в секунду | 2 000 | 4000 | 10 000 | 20 000 | 40 000 | 100 000 | 200 000 |
| Входящая пропускная способность  | 4 кбит/с    | 4 кбит/с    | 4 кбит/с     | 4 кбит/с     | 4 кбит/с     | 4 кбит/с      | 4 кбит/с      |
| Исходящая пропускная способность | 4 Мбит/с    | 8 Мбит/с    | 20 Мбит/с    | 40 Мбит/с    | 80 Мбит/с    | 200 Мбит/с    | 400 Мбит/с    |

#### <a name="send-to-user-through-rest-api"></a>Отправка пользователю через REST API
Тест производительности назначает имена пользователей всем клиентам, прежде чем они начнут подключаться к службе Azure SignalR. После того как клиенты устанавливают подключения WebSocket к службе Azure SignalR, они начинают отправлять сообщения другим пользователям по протоколу HTTP POST.

|   Отправка пользователю через REST API | Unit1 | Unit2 | Unit5  | Unit10 | Unit20 | Unit50  | Unit100 |
|---------------------------|-------|-------|--------|--------|--------|---------|---------|
| Соединения               | 1000 | 2 000 | 5 000  | 10 000 | 20 000 | 50 000  | 100 000 |
| Входящих сообщений в секунду  | 300   | 600   | 900    | 1 300  | 2 000  | 10 000  | 18 000  |
| Исходящих сообщений в секунду | 300   | 600   | 900    | 1 300  | 2 000  | 10 000  | 18 000 |
| Входящая пропускная способность  | 600 кбит/с  | 1,2 Мбит/с  | 1,8 Мбит/с   | 2,6 Мбит/с   | 4 Мбит/с     | 10 Мбит/с     | 36 Мбит/с    |
| Исходящая пропускная способность | 600 кбит/с  | 1,2 Мбит/с  | 1,8 Мбит/с   | 2,6 Мбит/с   | 4 Мбит/с     | 10 Мбит/с     | 36 Мбит/с    |

## <a name="performance-test-environments"></a>Среды тестирования производительности

Для всех перечисленных выше вариантов использования мы провели тесты производительности в среде Azure. В большинстве случаев мы использовали 50 клиентских виртуальных машин и 20 виртуальных машин сервера приложений. Вот несколько советов:

- Размер виртуальной машины клиента: StandardDS2V2 (2 виртуальных ЦП, память 7G)

- Размер виртуальной машины сервера приложений: StandardF4sV2 (4 виртуальных ЦП, память 8G)

- Подключения к серверу SDK Azure SignalR: 15

## <a name="performance-tools"></a>Средства производительности

Средства оценки производительности для службы Azure SignalR можно найти на сайте [GitHub](https://github.com/Azure/azure-signalr-bench/).

## <a name="next-steps"></a>Дальнейшие действия

В этой статье вы получите обзор производительности службы Azure SignalR в типичных сценариях использования.

Чтобы получить подробные сведения о внутренних компонентах службы и ее масштабировании, ознакомьтесь со следующими руководствами:

* [Внутренние компоненты службы Azure SignalR](signalr-concept-internals.md)
* [Масштабирование службы Azure SignalR](signalr-howto-scale-multi-instances.md)
