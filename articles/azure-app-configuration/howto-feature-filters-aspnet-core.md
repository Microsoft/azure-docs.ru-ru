---
title: Использование фильтров компонентов для включения условных флагов функций
titleSuffix: Azure App Configuration
description: Узнайте, как использовать фильтры компонентов для включения условных флагов функций
ms.service: azure-app-configuration
ms.custom: devx-track-csharp
author: AlexandraKemperMS
ms.author: alkemper
ms.topic: conceptual
ms.date: 3/9/2020
ms.openlocfilehash: 39455c4bc193cce036bd169c702b5c020d53d2f6
ms.sourcegitcommit: fc401c220eaa40f6b3c8344db84b801aa9ff7185
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/20/2021
ms.locfileid: "98602266"
---
# <a name="use-feature-filters-to-enable-conditional-feature-flags"></a>Использование фильтров компонентов для включения условных флагов функций

Флаги компонентов позволяют активировать или деактивировать функциональные возможности в приложении. Простой флаг функции имеет значение ON или OFF. Приложение всегда ведет себя таким же образом. Например, можно развернуть новую функцию, которая находится за функциональным флагом. При включении флага компонента все пользователи видят новую функцию. Отключение флага компонента скрывает новую функцию.

Напротив, _Условный флаг функции_ позволяет динамически включать или отключать флаг функции. Приложение может вести себя по-разному в зависимости от условий флага компонента. Предположим, что вы хотите, чтобы новая функция отображалась небольшому числу пользователей. Условный флаг функции позволяет включить флаг компонента для некоторых пользователей, одновременно отключив его для других. _Фильтры компонентов_ определяют состояние флага компонента каждый раз, когда он оценивается.

`Microsoft.FeatureManagement`Библиотека включает три фильтра компонентов:

- `PercentageFilter` включает флаг компонента на основе процента.
- `TimeWindowFilter` включает флаг компонента в течение указанного периода времени.
- `TargetingFilter` включает флаг компонента для указанных пользователей и групп.

Можно также создать собственный фильтр компонентов, реализующий [интерфейс Microsoft. феатуреманажемент. ифеатурефилтер](/dotnet/api/microsoft.featuremanagement.ifeaturefilter).

## <a name="registering-a-feature-filter"></a>Регистрация фильтра компонентов

Вы регистрируете фильтр компонентов, вызывая `AddFeatureFilter` метод, указывая имя типа требуемого фильтра компонентов. Например, регистрируется следующий код `PercentageFilter` :

```csharp
public void ConfigureServices(IServiceCollection services)
{
    services.AddControllersWithViews();
    services.AddFeatureManagement().AddFeatureFilter<PercentageFilter>();
}
```

## <a name="configuring-a-feature-filter-in-azure-app-configuration"></a>Настройка фильтра компонентов в конфигурации приложения Azure

Некоторые фильтры компонентов имеют дополнительные параметры. Например, `PercentageFilter` активирует функцию на основе процента. Он имеет параметр, определяющий процент использования.

Эти параметры можно настроить для флагов компонентов, определенных в конфигурации приложения Azure. Например, выполните следующие действия, чтобы `PercentageFilter` включить флаг компонента для 50% запросов к веб-приложению:

1. Следуйте инструкциям в [кратком руководстве: Добавление флагов компонентов в ASP.NET Core приложение](./quickstart-feature-flag-aspnet-core.md) для создания веб-приложения с флагом функции.

1. В портал Azure перейдите к хранилищу конфигураций и щелкните **Диспетчер компонентов**.

1. Щелкните контекстное меню для флага *бета-версии* , созданного в кратком руководстве. Нажмите кнопку **Изменить**.

    > [!div class="mx-imgBorder"]
    > ![Изменение флага бета-версии компонента](./media/edit-beta-feature-flag.png)

1. На экране **редактирования** установите флажок **включить флаг функции** , если он еще не включен. Установите флажок **использовать фильтр компонентов** и выберите **Пользовательский**. 

1. В поле **имя** выберите *Microsoft. Percentage*.

    > [!div class="mx-imgBorder"]
    > ![Добавить фильтр компонентов](./media/feature-flag-add-filter.png)

1. Щелкните контекстное меню рядом с именем фильтра компонентов. Нажмите кнопку **изменить параметры фильтра**.

    > [!div class="mx-imgBorder"]
    > ![Изменение параметров фильтра компонентов](./media/feature-flags-edit-filter-parameters.png)

1. Введите **имя** *и* **значение** 50. В поле **значение** указывается процент запросов, для которых включается фильтр компонентов.

    > [!div class="mx-imgBorder"]
    > ![Настройка параметров фильтра компонентов](./media/feature-flag-set-filter-parameters.png)

1. Нажмите кнопку **Применить** , чтобы вернуться на экран **изменение флага функции** . Затем нажмите кнопку **Применить** еще раз, чтобы сохранить настройки флага функции.

1. На странице **Диспетчер компонентов** флаг функции теперь имеет значение **Фильтр компонентов** *Custom*. 

    > [!div class="mx-imgBorder"]
    > ![Список флагов компонентов со значением "Custom" для фильтра компонентов](./media/feature-flag-filter-custom.png)

## <a name="feature-filters-in-action"></a>Фильтры компонентов в действии

Чтобы увидеть влияние этого флага функции, запустите приложение и нажмите кнопку **Обновить** в браузере несколько раз. Вы увидите, что *бета-версия* элемента отображается на панели инструментов около 50% времени. Он скрывает оставшуюся часть времени, так как `PercentageFilter` компонент деактивирует *бета-версию* для подмножества запросов. В следующем видео показано это поведение в действии.

> [!div class="mx-imgBorder"]
> ![Таржетингфилтер в действии](./media/feature-flags-percentagefilter.gif)

## <a name="next-steps"></a>Следующие шаги

> [!div class="nextstepaction"]
> [Включение поэтапного развертывания функций для определенных аудиторий](./howto-targetingfilter-aspnet-core.md)
