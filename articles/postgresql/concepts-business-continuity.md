---
title: Непрерывность бизнес-процессов — база данных Azure для PostgreSQL — один сервер
description: В этой статье описывается непрерывность бизнес-процессов (восстановление на момент времени, сбой центра обработки данных, геовосстановление, реплики) при использовании базы данных Azure для PostgreSQL.
author: sr-msft
ms.author: srranga
ms.service: postgresql
ms.topic: conceptual
ms.date: 08/07/2020
ms.openlocfilehash: f8d8547c2d4900e6258f7360c50d8dfc17157832
ms.sourcegitcommit: e972837797dbad9dbaa01df93abd745cb357cde1
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/14/2021
ms.locfileid: "100517250"
---
# <a name="overview-of-business-continuity-with-azure-database-for-postgresql---single-server"></a>Общие сведения о непрерывности бизнес-процессов с помощью базы данных Azure для PostgreSQL — один сервер

Здесь описываются возможности службы "База данных Azure для PostgreSQL" по обеспечению непрерывности бизнес-процессов и аварийного восстановления. Вы узнаете о способах восстановления после аварийных событий, которые могут приводить к потере данных или недоступности базы данных и приложений. Здесь также содержатся сведения о том, как действовать в ситуациях, когда ошибка пользователя или приложения нарушает целостность данных, происходит сбой региона Azure или приложение требует обслуживания.

## <a name="features-that-you-can-use-to-provide-business-continuity"></a>Функции, которые можно использовать для обеспечения непрерывности бизнес-процессов

При разработке плана обеспечения непрерывности бизнес-процессов нужно понимать, какое максимальное время до полного восстановления приложения после аварийного события допустимо. Это целевое время восстановления (RTO). Необходимо также понимать, какой максимальный объем потери последних обновлений данных (т. е. за какой интервал времени) в приложении допустим при восстановлении после аварийного события. Это целевая точка восстановления (RPO).

База данных Azure для PostgreSQL предоставляет возможности обеспечения непрерывности бизнес-процессов, включающие геоизбыточные резервные копии с возможностью запуска геовосстановления и развертывания реплик для чтения в другом регионе. Каждый из них имеет различные характеристики для времени восстановления и возможной потери данных. С помощью функции [геовосстановления](concepts-backup.md) создается новый сервер с данными резервных копий, которые реплицируются из другого региона. Общее время, затрачиваемое на восстановление и восстановление, зависит от размера базы данных и объема восстанавливаемых журналов. Общее время установки сервера может варьироваться от нескольких минут до нескольких часов. С [репликами чтения](concepts-read-replicas.md)журналы транзакций из первичного потока асинхронно передаются в реплику. В случае сбоя базы данных-источника из-за сбоя уровня зоны или уровня области, отработка отказа в реплике обеспечивает более короткое значение RTO и сокращает потерю данных.

> [!NOTE]
> Задержка между первичной и репликой зависит от задержки между сайтами, объема передаваемых данных и наиболее важным в рабочей нагрузке записи сервера-источника. Большие рабочие нагрузки записи могут вызвать значительную задержку. 
>
> Из-за асинхронной природы репликации, используемой для чтения и создания реплик, они **не должны** рассматриваться как высокодоступное решение с высокой степенью доступности, так как выше задержка может означать более высокие значения RTO и RPO. Только для рабочих нагрузок, в которых запаздывание остается меньше, чем пиковое время рабочей нагрузки, реплики чтения могут действовать в качестве альтернативы высокой доступности. В противном случае чтение реплик предназначено для фактической масштабируемости чтения для готовых рабочих нагрузок и сценариев аварийного восстановления (аварийное восстановление).

В следующей таблице сравниваются значения RTO и RPO в **типичном сценарии рабочей нагрузки** .

| **Возможность** | **Основной** | **Общего назначения** | **Оптимизированные для операций в памяти** |
| :------------: | :-------: | :-----------------: | :------------------: |
| Восстановление до точки во времени из резервной копии | Любая точка восстановления в пределах срока хранения <br/> RTO — зависит от <br/>RPO < 15 мин| Любая точка восстановления в пределах срока хранения <br/> RTO — зависит от <br/>RPO < 15 мин | Любая точка восстановления в пределах срока хранения <br/> RTO — зависит от <br/>RPO < 15 мин |
| Геовосстановление из геореплицированных резервных копий | Не поддерживается | RTO — зависит от <br/>RPO < 1 ч | RTO — зависит от <br/>RPO < 1 ч |
| Реплики чтения | RTO — минуты * <br/>RPO < 5 мин * | RTO — минуты * <br/>RPO < 5 мин *| RTO — минуты * <br/>RPO < 5 мин *|

 \* В некоторых случаях RTO и RPO **могут быть намного выше** в зависимости от различных факторов, включая задержку между сайтами, объем передаваемых данных и важность записи базы данных-источника. 

## <a name="recover-a-server-after-a-user-or-application-error"></a>Восстановление сервера после ошибки пользователя или приложения

Резервные копии сервера позволяют восстановить его после различных аварийных событий. Например, пользователь может случайно удалить данные, важную таблицу или даже всю базу данных, приложение может случайно перезаписать важные данные неверной информацией из-за внутренней ошибки, и т. д.

Чтобы создать копию сервера до известного момента времени, можно выполнить **восстановление на момент времени** . Этот момент должен находиться в пределах срока хранения резервной копии, который был настроен для сервера. После восстановления данных на новый сервер можно либо заменить исходный сервер только что восстановленным, либо скопировать необходимые данные с восстановленного сервера на исходный.

> [!IMPORTANT]
> Удаленные серверы **нельзя** восстановить. Если вы удалите сервер, все связанные с ним базы данных также будут удалены без возможности восстановления. Используйте [блокировку ресурсов Azure](../azure-resource-manager/management/lock-resources.md) , чтобы предотвратить случайное удаление сервера.

## <a name="recover-from-an-azure-data-center-outage"></a>Восстановление после сбоя центра обработки данных Azure

В редких случаях возможен сбой центра обработки данных Azure. Такой сбой вызывает нарушение работы компании, которое может длиться от нескольких минут до нескольких часов.

Один из вариантов — дождаться возобновления работы сервера после того, как сбой центра обработки данных будет устранен. Это работает для приложений, сервер которых можно отключить на некоторое время, например для среды разработки. В случае сбоя центра обработки данных вы не узнаете, как долго происходит сбой, поэтому этот вариант работает только в том случае, если сервер не нужен в течение определенного времени.

## <a name="geo-restore"></a>Геовосстановление

Функция геовосстановления восстанавливает сервер с помощью геоизбыточных резервных копий. Резервные копии размещаются в [парном регионе](../best-practices-availability-paired-regions.md)сервера. Можно выполнить восстановление из этих резервных копий в любой другой регион. Геовосстановление создает новый сервер с данными из резервных копий. Дополнительные сведения о географическом восстановлении см. в [статье основные понятия резервного копирования и восстановления](concepts-backup.md).

> [!IMPORTANT]
> Геовосстановление возможно только в том случае, если сервер был подготовлен с геоизбыточным хранилищем резервных копий. Если вы хотите переключиться с локально избыточных на геоизбыточные резервные копии на существующем сервере, необходимо с помощью pg_dump сделать дамп имеющегося сервера и восстановить его на только что созданном сервере, где настроено геоизбыточное резервное копирование.

## <a name="cross-region-read-replicas"></a>Реплики чтения между регионами
Для повышения непрерывности бизнес-процессов и планирования аварийного восстановления можно использовать реплики чтения в разных регионах. Реплики чтения обновляются асинхронно с помощью технологии физической репликации PostgreSQL и могут отставать от основного. Дополнительные сведения о репликах чтения, доступных регионах и отработки отказа см. в [статье основные понятия чтения реплик](concepts-read-replicas.md). 

## <a name="faq"></a>ВОПРОСЫ И ОТВЕТЫ
### <a name="where-does-azure-database-for-postgresql-store-customer-data"></a>Где база данных Azure для PostgreSQL хранит данные клиента?
По умолчанию база данных Azure для PostgreSQL не перемещает и не хранит данные клиента вне региона, в котором они развернуты. Тем не менее клиенты могут дополнительно включить [геоизбыточные резервные копии](concepts-backup.md#backup-redundancy-options) или создать [реплику чтения между регионами](concepts-read-replicas.md#cross-region-replication) для хранения данных в другом регионе.


## <a name="next-steps"></a>Дальнейшие шаги
- Дополнительные сведения об автоматическом создании резервных копий см. в [этой статье](concepts-backup.md). 
- Дополнительные сведения см. в статьях [Как заархивировать и восстановить сервер в базе данных Azure для PostgreSQL с помощью портала Azure](howto-restore-server-portal.md) или [Как выполнить резервное копирование и восстановление сервера в базе данных Azure для PostgreSQL с помощью Azure CLI](howto-restore-server-cli.md).
- См. дополнительные сведения в статье [Реплики чтения в Базе данных Azure для PostgreSQL](concepts-read-replicas.md).
