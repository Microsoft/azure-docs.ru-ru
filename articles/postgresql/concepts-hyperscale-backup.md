---
title: Резервное копирование и восстановление — масштабирование (Цитус) — база данных Azure для PostgreSQL
description: Защита данных от случайного повреждения или удаления
author: jonels-msft
ms.author: jonels
ms.service: postgresql
ms.subservice: hyperscale-citus
ms.topic: conceptual
ms.date: 04/28/2020
ms.openlocfilehash: 9656e6ab608665e325ac5f772e06df9ac296c521
ms.sourcegitcommit: 910a1a38711966cb171050db245fc3b22abc8c5f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "92485381"
---
# <a name="backup-and-restore-in-azure-database-for-postgresql---hyperscale-citus"></a>Резервное копирование и восстановление в базе данных Azure для PostgreSQL — масштабирование (Цитус)

Служба "база данных Azure для PostgreSQL — масштабирование" (Цитус) автоматически создает резервные копии каждого узла и сохраняет их в локально избыточном хранилище. Резервные копии можно использовать для восстановления кластера Цитус в указанное время. Резервное копирование и восстановление данных являются важной частью любой стратегии непрерывности бизнес-процессов. Таким образом данные защищаются от случайного повреждения или удаления.

## <a name="backups"></a>Резервные копии

По крайней мере один раз в день база данных Azure для PostgreSQL выполняет резервное копирование моментальных снимков файлов данных и журнала транзакций базы данных. Резервные копии позволяют восстановить сервер до любой точки во времени в течение срока хранения. (Срок хранения в настоящее время составляет 35 дней для всех кластеров.) Все резервные копии шифруются с использованием алгоритма шифрования AES 256-bit.

В регионах Azure, поддерживающих зоны доступности, моментальные снимки резервных копий хранятся в трех зонах доступности. Если по крайней мере одна зона доступности находится в сети, кластер Цитус (масштабирование) restorable.

Невозможно экспортировать файлы резервной копии. Их можно использовать только для операций восстановления в базе данных Azure для PostgreSQL.

### <a name="backup-storage-cost"></a>Стоимость хранилищ резервных копий

Сведения о текущих ценах на хранилище резервных копий см. на [странице с ценами](https://azure.microsoft.com/pricing/details/postgresql/hyperscale-citus/)на базу данных Azure для PostgreSQL-Scale (Цитус).

## <a name="restore"></a>Восстановить

В базе данных Azure для PostgreSQL при восстановлении кластера (Цитус) создается новый кластер из резервных копий исходных узлов. 

> [!IMPORTANT]
>Восстановить кластер Цитус можно только в пределах одной и той же подписки и группы ресурсов, а также с другим именем кластера.


> [!IMPORTANT]
> Невозможно восстановить удаленные кластеры с масштабированием (Цитус). При удалении кластера все узлы, принадлежащие к кластеру, удаляются и не могут быть восстановлены. Для защиты ресурсов кластера, после случайного удаления или непредвиденных изменений администраторы могут использовать [блокировки управления](../azure-resource-manager/management/lock-resources.md).

### <a name="point-in-time-restore-pitr"></a>Восстановление до точки во времени (PITR)

Кластер можно восстановить в любой момент времени за последние 35 дней.
Восстановление до точки во времени подходит для большинства сценариев. Например, от случая, когда пользователь случайно удаляет данные, удаляет важную таблицу или базу данных, или если приложение случайно перезаписывает правильные данные неправильными.

Процесс восстановления создает новый кластер в том же регионе Azure, подписке и группе ресурсов, что и исходная. В кластере имеется исходная конфигурация: то же количество узлов, количество виртуальных ядер, размер хранилища, роли пользователей, версия PostgreSQL и версия расширения Цитус.

Параметры брандмауэра и параметры сервера PostgreSQL не сохраняются в исходной группе серверов, они сбрасываются в значения по умолчанию. Брандмауэр блокирует все подключения. Эти параметры необходимо будет настроить вручную после восстановления.

> [!IMPORTANT]
> Вам потребуется открыть запрос в службу поддержки, чтобы выполнить восстановление на момент времени для кластера Цитус.

### <a name="post-restore-tasks"></a>Действия, выполняемые после восстановления

После восстановления из любого механизма восстановления необходимо выполнить следующие действия, чтобы сделать резервную копию и запуск пользователей и приложений.

* Если новый сервер заменит исходный, перенаправьте клиенты и клиентские приложения на новый сервер.
* Чтобы пользователи могли подключаться, убедитесь, что установлены соответствующие правила брандмауэра на уровне сервера и виртуальной сети. Эти правила не копируются из исходной группы серверов.
* При необходимости настройте параметры сервера PostgreSQL. Параметры не копируются из исходной группы серверов.
* Убедитесь, что заданы соответствующие данные для входа и разрешений уровня базы данных.
* Настройте оповещения соответствующим образом.

## <a name="next-steps"></a>Дальнейшие действия

* Сведения о [зонах доступности Azure](../availability-zones/az-overview.md).
* Установка [рекомендуемых оповещений](./howto-hyperscale-alert-on-metric.md#suggested-alerts) для групп серверов с горизонтальным масштабированием (Цитус).