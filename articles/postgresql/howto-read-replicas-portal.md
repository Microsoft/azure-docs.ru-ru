---
title: Управление репликами чтения — портал Azure — база данных Azure для PostgreSQL — один сервер
description: Узнайте, как управлять репликами чтения базы данных Azure для PostgreSQL-Single Server из портал Azure.
author: sr-msft
ms.author: srranga
ms.service: postgresql
ms.topic: how-to
ms.date: 11/05/2020
ms.openlocfilehash: 9fdef187e9bdf77b29c548f767a4b4edfeb62f44
ms.sourcegitcommit: 867cb1b7a1f3a1f0b427282c648d411d0ca4f81f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "93422184"
---
# <a name="create-and-manage-read-replicas-in-azure-database-for-postgresql---single-server-from-the-azure-portal"></a>Создание реплик чтения и управление ими в базе данных Azure для PostgreSQL — один сервер из портал Azure

В этой статье описано, как создавать реплики чтения и управлять ими в службе "База данных Azure для PostgreSQL" с помощью портала Azure. Дополнительные сведения о репликах чтения см. в [этой статье](concepts-read-replicas.md).


## <a name="prerequisites"></a>Предварительные условия
[Сервер базы данных Azure для PostgreSQL](quickstart-create-server-database-portal.md) , который будет основным сервером.

## <a name="azure-replication-support"></a>Поддержка репликации Azure

[Считывание реплик](concepts-read-replicas.md) и [логического декодирования](concepts-logical.md) зависит от postgres журнала упреждающего записи (WAL) для получения сведений. Для этих двух функций требуется разный уровень ведения журнала от postgres. Для логического декодирования требуется более высокий уровень ведения журнала, чем считывание реплик.

Чтобы настроить правильный уровень ведения журнала, используйте параметр поддержки репликации Azure. Поддержка репликации в Azure имеет три параметра:

* **Off** — накладывает наименьшую информацию в Wal. Этот параметр недоступен на большинстве серверов базы данных Azure для PostgreSQL.  
* **Реплика** — более подробная, чем **Off**. Это минимальный уровень ведения журнала, необходимый для работы [реплик чтения](concepts-read-replicas.md) . Этот параметр используется по умолчанию на большинстве серверов.
* **Логический** — более подробный, чем **реплика**. Это минимальный уровень ведения журнала для работы логического декодирования. Реплики чтения также работают с этим параметром.


> [!NOTE]
> При развертывании реплик чтения для устойчивых основных рабочих нагрузок с большим количеством операций записи, задержка репликации может продолжать расти и никогда не сможет быть перехватываться с базой данных-источником. Это также может увеличить использование хранилища на основном сайте, так как файлы WAL не удаляются до тех пор, пока они не будут получены в реплике.

## <a name="prepare-the-primary-server"></a>Подготовка сервера источника

1. В портал Azure выберите существующий сервер базы данных Azure для PostgreSQL, который будет использоваться в качестве главного.

2. В меню сервера выберите **репликация**. Если для службы репликации Azure задана по крайней мере **реплика**, можно создать реплики чтения. 

3. Если для службы репликации Azure не задана хотя бы **реплика**, установите ее. Щелкните **Сохранить**.

   :::image type="content" source="./media/howto-read-replicas-portal/set-replica-save.png" alt-text="База данных Azure для PostgreSQL — репликация — установка реплики и сохранение":::

4. Перезапустите сервер, чтобы применить изменение, выбрав **Да**.

   :::image type="content" source="./media/howto-read-replicas-portal/confirm-restart.png" alt-text="База данных Azure для PostgreSQL-Replication-подтверждение перезапуска":::

5. После завершения операции вы получите два портал Azure уведомлений. Для обновления параметра сервера существует одно уведомление. Еще одно уведомление о перезапуске сервера следует сразу же.

   :::image type="content" source="./media/howto-read-replicas-portal/success-notifications.png" alt-text="Уведомления об успешном выполнении":::

6. Обновите страницу портал Azure, чтобы обновить панель инструментов репликации. Теперь можно создавать реплики чтения для этого сервера.
   

## <a name="create-a-read-replica"></a>Создание реплики чтения
Чтобы создать реплику чтения, выполните следующие действия:

1. Выберите существующий сервер базы данных Azure для PostgreSQL для использования в качестве сервера источника. 

2. На боковой панели сервера в разделе **Параметры** выберите **репликация**.

3. Выберите **Добавить реплику**.

   :::image type="content" source="./media/howto-read-replicas-portal/add-replica.png" alt-text="Добавление реплики":::

4. Введите имя реплики чтения. 

    :::image type="content" source="./media/howto-read-replicas-portal/name-replica.png" alt-text="Присвоение имени реплике":::

5. Выберите расположение для реплики. Расположение по умолчанию совпадает с местоположением сервера-источника.

    :::image type="content" source="./media/howto-read-replicas-portal/location-replica.png" alt-text="Выберите расположение":::

   > [!NOTE]
   > Дополнительные сведения о том, в каких регионах можно создать реплику, см. в статье [об основных понятиях реплики чтения](concepts-read-replicas.md). 

6. Нажмите кнопку **ОК**, чтобы подтвердить создание реплики.

Созданную реплику чтения можно просмотреть в окне **Репликация**:

:::image type="content" source="./media/howto-read-replicas-portal/list-replica.png" alt-text="Просмотр новой реплики в окне &quot;Репликация&quot;":::
 

> [!IMPORTANT]
> Ознакомьтесь с [разделом рекомендации в обзоре реплики чтения](concepts-read-replicas.md#considerations).
>
> Перед обновлением параметра сервера-источника до нового значения измените значение параметра реплики на равное или большее. Это действие помогает реплике справиться с изменениями, внесенными в главную базу.

## <a name="stop-replication"></a>Остановка репликации
Можно отключить репликацию между сервером-источником и репликой чтения.

> [!IMPORTANT]
> После того как репликация будет прервана на сервере-источнике и реплике чтения, ее нельзя будет отменить. Реплика чтения становится отдельным сервером, который поддерживает операции чтения и записи. Это сервер нельзя снова преобразовать в реплику.

Чтобы предотвратить репликацию между сервером-источником и репликой чтения из портал Azure, выполните следующие действия.

1. В портал Azure выберите основной сервер базы данных Azure для PostgreSQL.

2. В меню сервера в разделе **Параметры** выберите **Репликация**.

3. Выберите сервер-реплику, на котором нужно остановить репликацию.

   :::image type="content" source="./media/howto-read-replicas-portal/select-replica.png" alt-text="Выбор реплики":::
 
4. Щелкните **Остановить репликацию**.

   :::image type="content" source="./media/howto-read-replicas-portal/select-stop-replication.png" alt-text="Выберите пункт &quot;отменить репликацию&quot;":::
 
5. Нажмите кнопку **ОК**, чтобы подтвердить остановку репликации.

   :::image type="content" source="./media/howto-read-replicas-portal/confirm-stop-replication.png" alt-text="Подтверждение остановки репликации":::
 

## <a name="delete-a-primary-server"></a>Удаление сервера-источника
Чтобы удалить сервер-источник, выполните те же действия, что и для удаления автономной базы данных Azure для сервера PostgreSQL. 

> [!IMPORTANT]
> При удалении сервера-источника репликация на все реплики чтения останавливается. Реплики чтения становятся автономными серверами, которые начинают поддерживать операции чтения и записи.

Чтобы удалить сервер на портале Azure, сделайте следующе:

1. В портал Azure выберите основной сервер базы данных Azure для PostgreSQL.

2. Откройте страницу **Обзор** сервера. Нажмите кнопку **Удалить**.

   :::image type="content" source="./media/howto-read-replicas-portal/delete-server.png" alt-text="На странице Обзор сервера выберите, чтобы удалить сервер-источник.":::
 
3. Введите имя сервера, который нужно удалить. Выберите **Удалить** , чтобы подтвердить удаление сервера источника.

   :::image type="content" source="./media/howto-read-replicas-portal/confirm-delete.png" alt-text="Подтвердите удаление сервера источника":::
 

## <a name="delete-a-replica"></a>Удаление реплики
Реплику чтения можно удалить аналогично удалению сервера-источника.

- На портале Azure откройте страницу **Обзор** реплики чтения. Нажмите кнопку **Удалить**.

   :::image type="content" source="./media/howto-read-replicas-portal/delete-replica.png" alt-text="Удаление реплики на странице &quot;Обзор&quot;":::
 
Кроме того, реплику можно удалить из окна **Репликация**, выполнив следующие действия:

1. В портал Azure выберите основной сервер базы данных Azure для PostgreSQL.

2. В меню сервера в разделе **Параметры** выберите **Репликация**.

3. Выберите реплику чтения, которую нужно удалить.

   :::image type="content" source="./media/howto-read-replicas-portal/select-replica.png" alt-text="Выбор реплики, которую нужно удалить.":::
 
4. Выберите **удалить реплику**.

   :::image type="content" source="./media/howto-read-replicas-portal/select-delete-replica.png" alt-text="Выбор удаления реплики":::
 
5. Введите имя реплики, которую нужно удалить. Нажмите кнопку **Удалить**, чтобы подтвердить удаление реплики.

   :::image type="content" source="./media/howto-read-replicas-portal/confirm-delete-replica.png" alt-text="Подтверждение удаления реплики":::
 

## <a name="monitor-a-replica"></a>Мониторинг реплики
Выполнять мониторинг реплик чтения можно на основе двух метрик.

### <a name="max-lag-across-replicas-metric"></a>Метрика Max Lag Across Replicas (Максимальная задержка между репликами)
Метрика " **Максимальная задержка между репликами** " показывает задержку в байтах между сервером-источником и задержкой репликой. 

1.  В портал Azure выберите основной сервер базы данных Azure для PostgreSQL.

2.  Выберите **Метрики**. В окне **Метрики** выберите **Max Lag Across Replicas** (Максимальная задержка между репликами).

    :::image type="content" source="./media/howto-read-replicas-portal/select-max-lag.png" alt-text="Отслеживание максимальной задержки между репликами":::
 
3.  Для параметра **агрегирования** установите значение **Макс.**


### <a name="replica-lag-metric"></a>Метрика Replica Lag (Задержка реплики)
Метрика **Replica Lag** (Задержка реплики) показывает время с момента последнего воспроизведения транзакций по реплике. Если на главном сервере не выполняются транзакции, метрика будет отображать соответствующее время задержки.

1. На портале Azure выберите реплику чтения службы "База данных Azure для PostgreSQL".

2. Выберите **Метрики**. В окне **Метрики** выберите **Replica Lag** (Задержка реплики).

   :::image type="content" source="./media/howto-read-replicas-portal/select-replica-lag.png" alt-text="Отслеживание задержки реплики":::
 
3. Для параметра **агрегирования** установите значение **Макс.** 
 
## <a name="next-steps"></a>Дальнейшие действия
* См. дополнительные сведения о [репликах чтения в Базе данных Azure для PostgreSQL](concepts-read-replicas.md).
* Узнайте, как [создавать реплики чтения и управлять ими в Azure CLI и REST API](howto-read-replicas-cli.md).