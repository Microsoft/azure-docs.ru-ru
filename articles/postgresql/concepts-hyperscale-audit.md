---
title: Ведение журнала аудита — база данных Azure для PostgreSQL — масштабирование (Цитус)
description: Основные понятия для ведения журнала аудита Пгаудит в базе данных Azure для PostgreSQL-Scale (Цитус).
author: jonels-msft
ms.author: jonels
ms.service: postgresql
ms.topic: conceptual
ms.date: 01/29/2021
ms.openlocfilehash: 8a36062a2d29bcec10279d73211526a0dcba619e
ms.sourcegitcommit: 910a1a38711966cb171050db245fc3b22abc8c5f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/20/2021
ms.locfileid: "101702119"
---
# <a name="audit-logging-in-azure-database-for-postgresql---hyperscale-citus"></a>Ведение журнала аудита в базе данных Azure для PostgreSQL — масштабирование (Цитус)

Ведение журнала аудита действий базы данных в базе данных Azure для PostgreSQL-Scale (Цитус) доступно через расширение аудита PostgreSQL: [пгаудит](https://www.pgaudit.org/). Пгаудит предоставляет подробные сведения о сеансе и (или) ведении журнала аудита объектов.

> [!IMPORTANT]
> Пгаудит находится на этапе предварительной версии в базе данных Azure для PostgreSQL-Scale (Цитус)

Если вы хотите, чтобы журналы уровня ресурсов Azure для таких операций, как вычисление и масштабирование хранилища, см. в [журнале действий Azure](../azure-monitor/essentials/platform-logs-overview.md).

## <a name="usage-considerations"></a>Особенности использования
По умолчанию выписки из журналов pgAudit создаются вместе с регулярными выписками с использованием стандартного средства ведения журнала Postgres. В базе данных Azure для PostgreSQL-Scale (Цитус) можно настроить отправку всех журналов в Azure Monitor хранилище журналов для последующей аналитики в Log Analytics. Если вы включаете Azure Monitor ведение журнала ресурсов, журналы автоматически отправляются (в формате JSON) в хранилище Azure, концентраторы событий и (или) Azure Monitor журналы в зависимости от вашего выбора.

## <a name="enabling-pgaudit"></a>Включение Пгаудит

Расширение Пгаудит предварительно установлено и включено на всех узлах группы серверов с горизонтальным масштабированием (Цитус). Для включения действий не требуется.

## <a name="pgaudit-settings"></a>Параметры Пгаудит

Пгаудит позволяет настроить ведение журнала аудита для сеанса или объекта. [Ведение журнала аудита сеансов](https://github.com/pgaudit/pgaudit/blob/master/README.md#session-audit-logging) создает подробные журналы выполненных инструкций. [Ведение журнала аудита объектов](https://github.com/pgaudit/pgaudit/blob/master/README.md#object-audit-logging) — это область аудита для конкретных связей. Можно выбрать один или оба типа ведения журнала. 

> [!NOTE]
> Параметры Пгаудит задаются глобально и не могут быть указаны на уровне базы данных или роли.
>
> Кроме того, параметры Пгаудит указываются для каждого узла в группе серверов. Чтобы внести изменения на всех узлах, необходимо применить его к каждому узлу по отдельности.

Необходимо настроить параметры Пгаудит, чтобы начать ведение журнала. В [документации по пгаудит](https://github.com/pgaudit/pgaudit/blob/master/README.md#settings) содержится определение каждого параметра. Сначала проверьте параметры и убедитесь, что вы получаете ожидаемое поведение.

> [!NOTE]
> Если задано значение `pgaudit.log_client` On, журналы перенаправляются в клиентский процесс (например, psql), а не записываются в файл. Этот параметр обычно следует отключать. <br> <br>
> Параметр `pgaudit.log_level` будет включен, только если включен `pgaudit.log_client`.

> [!NOTE]
> В базе данных Azure для PostgreSQL-Scale (Цитус) `pgaudit.log` не может быть задано с помощью `-` сочетания знака (минус), как описано в документации по пгаудит. Все обязательные классы инструкций (чтение, запись и т. д.) должны указываться отдельно.

## <a name="audit-log-format"></a>Формат журналов аудита
Каждая запись аудита обозначается `AUDIT:` рядом с началом строки журнала. Формат остальной части записи подробно описан в [документации по пгаудит](https://github.com/pgaudit/pgaudit/blob/master/README.md#format).

## <a name="getting-started"></a>Начало работы
Чтобы быстро приступить к работе, присвойте параметру значение `pgaudit.log` `WRITE` и откройте журналы сервера для просмотра выходных данных. 

## <a name="viewing-audit-logs"></a>Просмотр журналов аудита
Способ доступа к журналам зависит от выбранной конечной точки. Сведения о службе хранилища Azure см. в статье [учетная запись хранения журналов](../azure-monitor/essentials/resource-logs.md#send-to-azure-storage) . Сведения о концентраторах событий см. в статье [Streaming Azure Logs](../azure-monitor/essentials/resource-logs.md#send-to-azure-event-hubs) .

Для журналов Azure Monitor журналы отправляются в выбранную рабочую область. Журналы postgres используют режим сбора **AzureDiagnostics** , поэтому их можно запрашивать из таблицы AzureDiagnostics. Поля в таблице описаны ниже. Дополнительные сведения о запросах и предупреждениях см. в статье о [запросах Azure Monitor журналов](../azure-monitor/logs/log-query-overview.md) .

Этот запрос можно использовать для начала работы. Можно настроить оповещения на основе запросов.

Поиск всех записей Пгаудит в журналах postgres для определенного сервера за последний день
```kusto
AzureDiagnostics
| where LogicalServerName_s == "myservername"
| where TimeGenerated > ago(1d) 
| where Message contains "AUDIT:"
```

## <a name="next-steps"></a>Дальнейшие действия

- [Узнайте, как настроить ведение журнала в базе данных Azure для PostgreSQL-Scale (Цитус) и как получить доступ к журналам.](howto-hyperscale-logging.md)