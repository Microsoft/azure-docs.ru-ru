---
title: Устранение неполадок шифрования данных — база данных Azure для PostgreSQL — один сервер
description: Узнайте, как устранить неполадки шифрования данных в базе данных Azure для PostgreSQL — один сервер.
author: mksuni
ms.author: sumuth
ms.service: postgresql
ms.topic: how-to
ms.date: 02/13/2020
ms.openlocfilehash: c315e1df473f3d23bab7e2a78ce166f22272ee70
ms.sourcegitcommit: 910a1a38711966cb171050db245fc3b22abc8c5f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "93242251"
---
# <a name="troubleshoot-data-encryption-in-azure-database-for-postgresql---single-server"></a>Устранение неполадок шифрования данных в базе данных Azure для PostgreSQL — один сервер

Эта статья поможет вам определить и устранить распространенные проблемы, которые могут возникнуть в развертывании базы данных Azure для PostgreSQL с одним сервером при настройке шифрования данных с помощью управляемого клиентом ключа.

## <a name="introduction"></a>Введение

При настройке шифрования данных для использования управляемого клиентом ключа в Azure Key Vault серверу требуется постоянный доступ к ключу. Если сервер теряет доступ к ключу, управляемому клиентом, в Azure Key Vault, он блокирует все подключения, возвращает соответствующее сообщение об ошибке и изменяет его состояние на ***недоступное*** в портал Azure.

Если вам больше не нужна недоступная база данных Azure для сервера PostgreSQL, вы можете удалить ее, чтобы приостанавливаться на небольшую стоимость. Никакие другие действия на сервере не разрешены, пока доступ к хранилищу ключей не будет восстановлен и сервер будет доступен. Также невозможно изменить параметр шифрования данных с (управляемый `Yes` клиентом) на `No` недоступный сервер, если он зашифрован с помощью управляемого клиентом ключа. Необходимо будет повторно проверить ключ вручную, прежде чем снова получить доступ к серверу. Это действие необходимо для защиты данных от несанкционированного доступа во время отзыва разрешений для управляемого клиентом ключа.

## <a name="common-errors-causing-server-to-become-inaccessible"></a>Распространенные ошибки, вызывающие недоступность сервера

Следующие нетипичные настройки приводят к возникновению большинства проблем с шифрованием данных, в которых используются ключи Azure Key Vault:

- Хранилище ключей недоступно или не существует:
  - Хранилище ключей случайно удалено.
  - Временная ошибка сети, которая приводит к недоступности хранилища ключей.

- У вас нет разрешений на доступ к хранилищу ключей, или ключ не существует:
  - Срок действия ключа истек или он был случайно удален или отключен.
- Управляемое удостоверение экземпляра базы данных Azure для PostgreSQL было случайно удалено.
  - Управляемое удостоверение экземпляра базы данных Azure для PostgreSQL имеет недостаточные разрешения ключа. Например, разрешения не включают получение, перенос и распаковку.
  - Разрешения управляемого удостоверения для экземпляра базы данных Azure для PostgreSQL были отозваны или удалены.

## <a name="identify-and-resolve-common-errors"></a>Определение и исправление распространенных ошибок

### <a name="errors-on-the-key-vault"></a>Ошибки в хранилище ключей

#### <a name="disabled-key-vault"></a>Отключенное хранилище ключей

- `AzureKeyVaultKeyDisabledMessage`
- **Объяснение**: не удалось выполнить операцию на сервере, так как ключ Azure Key Vault отключен.

#### <a name="missing-key-vault-permissions"></a>Отсутствуют разрешения хранилища ключей

- `AzureKeyVaultMissingPermissionsMessage`
- **Объяснение**. у сервера нет необходимых разрешений на получение, перенос и распаковку для Azure Key Vault. Предоставьте всем отсутствующим разрешениям субъекта-службы с ИДЕНТИФИКАТОРом.

### <a name="mitigation"></a>Меры по снижению риска

- Убедитесь, что ключ, управляемый клиентом, имеется в хранилище ключей.
- Определите хранилище ключей и перейдите к нему на портале Azure.
- Убедитесь, что URI ключа определяет имеющийся ключ.

## <a name="next-steps"></a>Дальнейшие действия

[Использование портал Azure для настройки шифрования данных с помощью управляемого клиентом ключа в базе данных Azure для PostgreSQL](howto-data-encryption-portal.md)
