---
title: Устранение неполадок подключений — база данных Azure для PostgreSQL — один сервер
description: Узнайте, как устранять проблемы с подключением к базе данных Azure для PostgreSQL-Single Server.
keywords: подключение postgresql,строка подключения,проблемы с подключением, временная ошибка,ошибка подключения
author: niklarin
ms.author: nlarin
ms.service: postgresql
ms.topic: how-to
ms.date: 5/6/2019
ms.openlocfilehash: bff930153dc8941fbfe561edf963d5b1c1e7811f
ms.sourcegitcommit: 910a1a38711966cb171050db245fc3b22abc8c5f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "96014624"
---
# <a name="troubleshoot-connection-issues-to-azure-database-for-postgresql---single-server"></a>Устранение проблем с подключением к базе данных Azure для PostgreSQL — один сервер

Проблемы с подключением могут возникнуть в связи с ниже перечисленными причинами.

* Параметры брандмауэра
* Время ожидания подключения.
* Неправильные сведения для входа.
* Достигнуто максимальное ограничение для некоторых ресурсов Базы данных Azure для PostgreSQL.
* Проблемы с инфраструктурой службы.
* Обслуживание выполняется в службе.
* Распределение вычислительных ресурсов сервера изменяется путем масштабирования количества виртуальных ядер или перехода на другой уровень служб.

В общих чертах проблемы подключения к Базе данных Azure для PostgreSQL можно классифицировать следующим образом:

* временные ошибки (кратковременные или возникающие периодически);
* постоянные или регулярно возникающие ошибки.

## <a name="troubleshoot-transient-errors"></a>Устранение временных ошибок

Временные ошибки возникают при выполнении обслуживания, если система сталкивается с ошибкой оборудования или программного обеспечения, или при смене виртуальных ядер или уровня служб сервера. Служба "База данных Azure для PostgreSQL" изначально предлагает высокий уровень доступности и позволяет автоматически устранить эти проблемы. Тем не менее приложение теряет подключение к серверу на некоторое время (не более чем на 60 секунд). Устранение неполадок некоторых событий иногда требует больше времени, например, когда большая транзакция приводит к длительному восстановлению.

### <a name="steps-to-resolve-transient-connectivity-issues"></a>Порядок устранения временных проблем подключения

1. Проверьте [панель мониторинга Microsoft Azure](https://azure.microsoft.com/status) на наличие каких-либо известных сбоев, произошедших в то время, когда приложение сообщало об ошибках.
2. Приложения, подключающиеся к облачной службе, например, База данных Azure для Postgre SQL, должны ожидать временные ошибки и реализовывать логику повторов для обработки этих ошибок, а не отображать их как ошибки приложения для пользователей. Рекомендации и руководство об обработке временных ошибок см. в статье [Handling of transient connectivity errors for Azure Database for PostgreSQL](concepts-connectivity.md) (Обработка временных ошибок подключения для Базы данных Azure для PostgreSQL).
3. Если база данных близка к исчерпанию доступных ресурсов, ошибки могут быть временными проблемами подключения. Ознакомьтесь со статьей [Ограничения в базе данных Azure для PostgreSQL](concepts-limits.md).
4. Если проблемы подключения остаются или интервал, во время которого приложение обнаруживает ошибку, превышает 60 секунд, а также если в определенный день такая ошибка возникает многократно, зарегистрируйте запрос на поддержку Azure, нажав **Получить поддержку** на сайте [Поддержка Azure](https://azure.microsoft.com/support/options) .

## <a name="troubleshoot-persistent-errors"></a>Устранение постоянных ошибок

Если при подключении к Базе данных Azure для PostgreSQL в приложении постоянно возникают сбои, их причины перечислены ниже:

* Конфигурация брандмауэра сервера. Убедитесь, что брандмауэр сервера базы данных Azure для PostgreSQL настроен на разрешение подключений от клиента, включая прокси-серверы и шлюзы.
* Конфигурация брандмауэра клиента. брандмауэр на клиенте должен разрешать подключения к серверу базы данных. В некоторых брандмауэрах необходимо разрешить IP-адреса и порты сервера, к которым нельзя подключиться, а также приложения, например PostgreSQL.
* Ошибка пользователя: могут быть заданы недопустимые параметры подключения, такие как имя сервера в строке подключения или пропущенный суффикс *\@ ServerName* в имени пользователя.
* Если _сервер ошибок не настроен на разрешение IPv6-подключений_, обратите внимание, что базовый уровень не поддерживает конечные точки службы виртуальной сети. Необходимо удалить конечную точку Microsoft. SQL из подсети, которая пытается подключиться к базовому серверу.
* Если отображается ошибка подключения _sslmode значение "* * *" является недопустимым, если поддержка SSL не была скомпилирована с_ ошибкой, это означает, что клиент PostgreSQL не поддерживает SSL. Скорее всего, либпк на стороне клиента не был скомпилирован с флагом "--with-OpenSSL". Попробуйте подключиться с помощью клиента PostgreSQL с поддержкой SSL. 

### <a name="steps-to-resolve-persistent-connectivity-issues"></a>Порядок устранения постоянных проблем подключения

1. Настройте [правила брандмауэра](howto-manage-firewall-using-portal.md) , чтобы разрешить IP-адрес клиента. Для временных целей тестирования настройте правило брандмауэра, используя 0.0.0.0 как начало диапазона IP-адресов и 255.255.255.255 как завершение. Откроется сервер для всех IP-адресов. Если это позволяет устранить проблемы с подключением, удалите это правило и создайте правило брандмауэра для надлежащим образом ограниченных IP-адресов или диапазона адресов.
2. На всех брандмауэрах между клиентом и Интернетом убедитесь, что порт 5432 открыт для исходящих соединений.
3. Проверьте строку подключения и другие параметры подключения.
4. Проверьте работоспособность службы на панели мониторинга. Если присутствует региональный сбой, см. статью [Обзор обеспечения непрерывности бизнес-процессов с помощью службы "База данных Azure для MySQL"](concepts-business-continuity.md), чтобы выполнить инструкции по восстановлению в новом регионе.

## <a name="next-steps"></a>Дальнейшие действия

* [Handling of transient connectivity errors for Azure Database for PostgreSQL](concepts-connectivity.md) (Обработка временных ошибок подключения для Базы данных Azure для PostgreSQL)
