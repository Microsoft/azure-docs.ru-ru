---
title: Проверка подлинности Azure Active Directory. База данных Azure для PostgreSQL на отдельном сервере
description: Изучите принципы проверки подлинности Azure Active Directory в Базе данных Azure для PostgreSQL на отдельном сервере
author: lfittl
ms.author: lufittl
ms.service: postgresql
ms.topic: conceptual
ms.date: 07/23/2020
ms.openlocfilehash: 0a19bd9d1547c16937ee575c08ea15a52589ccd0
ms.sourcegitcommit: 772eb9c6684dd4864e0ba507945a83e48b8c16f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "87171053"
---
# <a name="use-azure-active-directory-for-authenticating-with-postgresql"></a>Использование проверки подлинности Azure Active Directory с PostgreSQL

Проверка подлинности Microsoft Azure Active Directory — это механизм подключения к Базе данных Azure для PostgreSQL с помощью удостоверений, определенных в Azure Active Directory.
С помощью проверки подлинности Azure AD можно централизованно управлять удостоверениями пользователей базы данных и другими службами Майкрософт, что упрощает работу с разрешениями.

Преимущества использования Azure AD:

- единая проверка подлинности пользователей в службах Azure;
- централизованное управление политиками паролей и сменой паролей;
- Azure Active Directory поддерживает несколько видов проверки подлинности, что позволяет избавиться от необходимости хранить пароли;
- клиенты могут управлять разрешениями базы данных с помощью внешних групп (Azure AD);
- в службе проверки подлинности Azure AD для проверки подлинности удостоверений на уровне базы данных используются роли базы данных PostgreSQL;
- для приложений, подключающихся к Базе данных Azure для PostgreSQL, поддерживается проверка подлинности на основе маркеров.

Для настройки и использования проверки подлинности Azure Active Directory применяется приведенный ниже процесс.

1. При необходимости создайте удостоверения пользователей и передайте их в Azure Active Directory.
2. Если нужно, привяжите или измените каталог Active Directory, который сейчас связан с вашей подпиской Azure.
3. Создайте администратора Azure AD для сервера Базы данных Azure для PostgreSQL.
4. Создайте учетные записи пользователей базы данных в базе данных, сопоставленной с удостоверениями Azure AD.
5. Подключитесь к базе данных, получив маркер для удостоверения Azure AD и выполнив вход.

> [!NOTE]
> Узнайте, как создать и заполнить каталог Azure AD, а также настроить Azure AD с помощью Базы данных Azure для PostgreSQL, ознакомившись со статьей [Использование Azure Active Directory для проверки подлинности с помощью PostgreSQL](howto-configure-sign-in-aad-authentication.md).

## <a name="architecture"></a>Architecture

На следующей общей схеме показано, как действует проверка подлинности Azure AD с использованием Базы данных Azure для PostgreSQL. Стрелки обозначают пути обмена данными.

![Процедура проверки подлинности][1]

## <a name="administrator-structure"></a>Структура администраторов

При использовании проверки подлинности Azure AD существуют две учетные записи администратора для сервера PostgreSQL: учетная запись первоначального администратора PostgreSQL и учетная запись администратора Azure AD. Создать в пользовательской базе данных первого пользователя автономной базы данных Azure AD может только администратор с учетной записью Azure AD. Администратор Azure AD может использовать для входа имя пользователя Azure AD или имя группы Azure AD. Если учетная запись администратора является учетной записью группы, ее может использовать любой участник группы. По этой причине для одного сервера PostgreSQL может существовать несколько администраторов Azure AD. Использование учетной записи группы в качестве учетной записи администратора повышает управляемость. Это позволяет централизованно добавлять и удалять членов группы в Azure AD, не изменяя пользователей или разрешения на сервере PostgreSQL. За один раз можно настроить только одного администратора Azure AD (пользователя или группу).

![структура администраторов][2]

## <a name="permissions"></a>Разрешения

Чтобы создать пользователей, которые могут проходить проверку подлинности в Azure AD, необходима роль `azure_ad_admin` в базе данных. Эта роль назначается путем настройки учетной записи администратора Azure AD для конкретного сервера Базы данных Azure для PostgreSQL.

Чтобы создать пользователя базы данных Azure AD, необходимо подключиться с правами администратора Azure AD. Это продемонстрировано в статье [Использование Azure Active Directory для проверки подлинности с помощью PostgreSQL](howto-configure-sign-in-aad-authentication.md).

Любая проверка подлинности Azure AD возможна только в том случае, если для Базы данных Azure для PostgreSQL создана учетная запись администратора Azure AD. Если учетная запись администратора Azure Active Directory удалена с сервера, то существующие пользователи Azure Active Directory, учетные записи которых были созданы ранее, больше не смогут подключаться к базе данных, используя свои текущие учетные данные Azure Active Directory.

## <a name="connecting-using-azure-ad-identities"></a>Подключение с использованием удостоверений Azure AD

Проверка подлинности Azure Active Directory поддерживает следующие способы подключения к базе данных с помощью удостоверений Azure AD:

- Пароль Azure Active Directory.
- Встроенная служба Azure Active Directory.
- Универсальная служба Azure Active Directory с поддержкой MFA.
- Использование сертификатов приложений или секретов клиента Active Directory.
- [Управляемое удостоверение](howto-connect-with-managed-identity.md)

После проверки подлинности в Active Directory выдается маркер. Этот маркер является вашим паролем для входа в систему.

Обратите внимание, что операции управления, такие как добавление новых пользователей, поддерживаются только для ролей пользователей Azure AD на этом этапе.

> [!NOTE]
> Дополнительные сведения о подключении с помощью маркера Active Directory см. в статье [Использование Azure Active Directory для проверки подлинности с помощью PostgreSQL](howto-configure-sign-in-aad-authentication.md).

## <a name="additional-considerations"></a>Дополнительные сведения

- Для повышения управляемости рекомендуем подготовить специальную группу Azure AD от имени администратора.
- Для сервера Базы данных Azure для PostgreSQL одновременно может быть настроен только один администратор Azure AD (пользователь или группа).
- Изначально только администратор Azure AD для PostgreSQL может подключаться к Базе данных Azure для PostgreSQL, используя учетную запись Azure Active Directory. Затем администратор Active Directory может настроить других пользователей базы данных Azure AD.
- Если пользователь удален из Azure AD, он больше не сможет проходить проверку подлинности в Azure AD, поэтому получить маркер доступа для этого пользователя будет невозможно. В этом случае, хотя соответствующая роль по-прежнему будет присутствовать в базе данных, к серверу с этой ролью подключиться не получится.
> [!NOTE]
> Вход удаленного пользователя Azure AD возможен до истечения срока действия маркера (максимум 60 минут после выдачи маркера).  Если вы также удалите пользователя из Базы данных Azure для PostgreSQL, доступ будет немедленно отменен.
- Если администратор Azure AD удален с сервера, этот сервер больше не будет связан с клиентом Azure AD, поэтому для этого сервера будут отключены все имена для входа Azure AD. Добавление нового администратора Azure AD из того же клиента позволит повторно включить имена для входа Azure AD.
- База данных Azure для PostgreSQL сопоставляет маркеры доступа с ролью Базы данных Azure для PostgreSQL, используя уникальный идентификатор пользователя Azure AD, а не имя пользователя. Это означает, что при удалении пользователя Azure AD из Azure AD и создании нового пользователя с тем же именем База данных Azure для PostgreSQL будет считать, что это другой пользователь. Таким образом, если пользователь был удален из Azure AD, а затем был добавлен новый пользователь с тем же именем, этот новый пользователь не сможет подключиться с использованием существующей роли. Чтобы обеспечить возможность подключения, администратор Azure AD Базы данных Azure для PostgreSQL должен отменить, а затем предоставить пользователю роль azure_ad_user, чтобы обновить идентификатор пользователя Azure AD.

## <a name="next-steps"></a>Дальнейшие действия

- Узнайте, как создать и заполнить каталог Azure AD, а также настроить Azure AD с помощью Базы данных Azure для PostgreSQL, ознакомившись со статьей [Использование Azure Active Directory для проверки подлинности с помощью PostgreSQL](howto-configure-sign-in-aad-authentication.md).
- Общие сведения об именах для входа, пользователях и ролях базы данных для Базы данных Azure для PostgreSQL см. в разделе [Создание пользователей в Базе данных Azure для PostgreSQL на отдельном сервере](howto-create-users.md).

<!--Image references-->

[1]: ./media/concepts-aad-authentication/authentication-flow.png
[2]: ./media/concepts-aad-authentication/admin-structure.png
