---
title: Руководство по разработке базы данных в службе "База данных Azure для PostgreSQL — отдельный сервер" с помощью портала Azure
description: Это руководство содержит сведения о проектировании первой базы данных в службе "База данных Azure для PostgreSQL — отдельный сервер" с помощью портала Azure.
author: lfittl-msft
ms.author: lufittl
ms.service: postgresql
ms.custom: tutorial, mvc
ms.topic: tutorial
ms.date: 06/25/2019
ms.openlocfilehash: 179d4124e28abfffa83b16cfdb418d8e860192d8
ms.sourcegitcommit: 910a1a38711966cb171050db245fc3b22abc8c5f
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "93337138"
---
# <a name="tutorial-design-an-azure-database-for-postgresql---single-server-using-the-azure-portal"></a>Руководство по Разработка базы данных в службе "База данных Azure для PostgreSQL — отдельный сервер" с помощью портала Azure

База данных Azure для PostgreSQL является управляемой службой, которая позволяет запускать и масштабировать высокодоступные базы данных PostgreSQL, а также управлять ими в облаке. С помощью портала Azure можно легко управлять сервером и проектировать базы данных.

Из этого руководства вы узнаете, как с помощью портала Azure выполнять следующие операции:
> [!div class="checklist"]
> * Создание сервера Базы данных Azure для PostgreSQL
> * настройка брандмауэра сервера;
> * использование служебной программы [**psql**](https://www.postgresql.org/docs/9.6/static/app-psql.html) для создания базы данных;
> * Загрузка примера данных
> * Данные запросов
> * Обновление данных
> * восстановление данных.

## <a name="prerequisites"></a>Предварительные требования
Если у вас еще нет подписки Azure, создайте [бесплатную](https://azure.microsoft.com/free/) учетную запись Azure, прежде чем начинать работу.

## <a name="create-an-azure-database-for-postgresql"></a>Создание базы данных Azure для PostgreSQL

Сервер базы данных Azure для PostgreSQL создается с определенным набором [вычислительных ресурсов и ресурсов хранения](./concepts-pricing-tiers.md). Он создается в [группе ресурсов Azure](../azure-resource-manager/management/overview.md).

Чтобы создать базу данных Azure для сервера PostgreSQL, сделайте следующее:
1. Щелкните **Создать ресурс** в верхнем левом углу окна портала Azure.
2. На странице **создания** выберите **Базы данных**, а на странице **Базы данных** щелкните **Azure Database for PostgreSQL** (База данных Azure для PostgreSQL).
   :::image type="content" source="./media/tutorial-design-database-using-azure-portal/1-create-database.png" alt-text="База данных Azure для PostgreSQL. Создание базы данных":::

3. Выберите вариант развертывания **Отдельный сервер**.

   :::image type="content" source="./media/tutorial-design-database-using-azure-portal/select-deployment-option.png" alt-text="Выбор варианта развертывания &quot;Отдельный сервер&quot; для службы &quot;База данных Azure для PostgreSQL&quot;":::

4. Заполните форму **Основные данные** , указав следующую информацию:

    :::image type="content" source="./media/tutorial-design-database-using-azure-portal/create-basics.png" alt-text="Создание сервера":::

    Параметр|Рекомендуемое значение|Описание
    ---|---|---
    Подписка|Имя вашей подписки|Подписка Azure, которую вы хотите использовать для сервера. Если у вас есть несколько подписок, выберите ту, в которой взимается плата за использование ресурса.
    Группа ресурсов|*myresourcegroup*| Новое имя группы ресурсов или уже имеющееся из подписки.
    Имя сервера |*mydemoserver*|Уникальное имя, идентифицирующее базу данных Azure для сервера PostgreSQL. Имя домена *postgres.database.azure.com* добавляется к указанному имени сервера. Сервер может содержать только строчные буквы, цифры и знак дефиса (-). Его длина должна составлять от 3 до 63 символов.
    Источник данных | *None* | Чтобы создать сервер с нуля, выберите *Нет*. Если вы создаете сервер из геоизбыточной резервной копии существующего сервера службы "База данных Azure для PostgreSQL", выберите *Резервная копия*.
    Имя администратора |*myadmin*| Собственная учетная запись входа, используемая при подключении к серверу. Не используйте для имени учетной записи администратора такие варианты: **azure_superuser**, **azure_pg_admin**, **admin**, **administrator**, **root**, **guest** или **public**. Оно не может начинаться с **pg_** .
    Пароль |Ваш пароль| Новый пароль для учетной записи администратора сервера. Пароль должен содержать от 8 до 128 символов. Пароль должен содержать символы из таких трех категорий: прописные латинские буквы, строчные латинские буквы, цифры (0–9) и небуквенно-цифровые символы (!, $, #, % и т. д.).
    Расположение|Ближайший к пользователям регион| Ближайшее к пользователям расположение.
    Версия|Последний основной номер версии| Последний основной номер версии PostgreSQL, если нет особых требований.
    Вычисления и хранилище | **Общего назначения**, **Поколение 5**, **2 виртуальных ядра**, **5 ГБ**, **7 дней**, **Геоизбыточное хранилище** | Конфигурации вычислительных ресурсов, хранилища и резервного копирования для нового сервера. Щелкните **Настройка сервера**. Затем выберите вкладку **Общего назначения**. *Поколение 5*, *4 виртуальных ядра*, *100 ГБ* и *7 дней* — это значения по умолчанию для параметров **Поколение вычислительных ресурсов**, **Виртуальное ядро**, **Хранилище** и **Срок хранения резервных копий**. Вы можете оставить эти ползунки как есть или же настроить их. Чтобы включить резервное копирование сервера в геоизбыточном хранилище, выберите **Геоизбыточное** в разделе **параметров избыточности резервного копирования**. Щелкните **ОК**, чтобы сохранить ценовую категорию. На следующем снимке экрана показаны выбранные параметры.

   > [!NOTE]
   > Используйте ценовую категорию "Базовый", если для вашей рабочей нагрузки не требуется большое количество вычислительных ресурсов и операций ввода-вывода. Обратите внимание, что серверы, созданные в ценовой категории "Базовый", нельзя масштабировать до ценовых категорий "Общего назначения" или "Оптимизировано для памяти". Дополнительные сведения см. на [странице с ценами](https://azure.microsoft.com/pricing/details/postgresql/).
   > 

    :::image type="content" source="./media/quickstart-create-database-portal/2-pricing-tier.png" alt-text="Область &quot;Ценовая категория&quot;":::

    > [!TIP]
    > Функция **автоматического увеличения** позволяет серверу нарастить объем хранения при приближении к предельному значению без последствий для рабочей нагрузки.

5. Выберите **Просмотр и создание** , чтобы просмотреть выбранные элементы. Щелкните **Создать**, чтобы подготовить сервер. Это может занять несколько минут.

6. На панели инструментов щелкните значок **Уведомления** (колокольчик), чтобы отслеживать процесс развертывания. По завершении развертывания можно выбрать **Закрепить на панели мониторинга**. После этого на панели мониторинга на портале Azure отобразится плитка, которая будет служить ярлыком страницы **Обзор** для этого сервера. Если выбрать **Перейти к ресурсу**, откроется страница сервера **Обзор**.

    :::image type="content" source="./media/quickstart-create-database-portal/3-notifications.png" alt-text="Область &quot;Уведомления&quot;":::
   
   По умолчанию на сервере создается база данных **postgres**. База данных [postgres](https://www.postgresql.org/docs/9.6/static/app-initdb.html) — это база данных по умолчанию, предназначенная для использования пользователями, служебными программами и сторонними приложениями. (Другая база данных по умолчанию — **azure_maintenance**. Ее функция заключается в отделении процессов управляемой службы от действий пользователей. У вас нет доступа к этой базе данных.)


## <a name="configure-a-server-level-firewall-rule"></a>Настройка правила брандмауэра на уровне сервера

База данных Azure для службы PostgreSQL использует брандмауэр на уровне сервера. По умолчанию он не позволяет внешним приложениям и средствам подключаться к серверу и к любой базе данных на сервере, если не создано правило брандмауэра, открывающее брандмауэр для определенного диапазона IP-адресов. 

1. По завершении развертывания щелкните **Все ресурсы** в меню слева и введите имя **mydemoserver**, чтобы найти созданный сервер. Щелкните имя сервера в результатах поиска. После этого откроется страница **обзора** сервера с параметрами для дальнейшей конфигурации.

   :::image type="content" source="./media/tutorial-design-database-using-azure-portal/4-locate.png" alt-text="База данных Azure для PostgreSQL. Поиск сервера":::

2. На странице сервера выберите **Безопасность подключения**. 

3. Щелкните текстовое поле раздела **Имя правила** и добавьте новое правило брандмауэра, чтобы указать диапазон IP-адресов для подключения. Введите диапазон IP-адресов. Выберите команду **Сохранить**.

   :::image type="content" source="./media/tutorial-design-database-using-azure-portal/5-firewall-2.png" alt-text="База данных Azure для PostgreSQL. Создание правила брандмауэра":::

4. Щелкните **Сохранить**, а затем **X**, чтобы закрыть страницу **Безопасность подключения**.

   > [!NOTE]
   > Сервер PostgreSQL Azure обменивается данными через порт 5432. Если вы пытаетесь подключиться из корпоративной сети, исходящий трафик через порт 5432 может быть запрещен сетевым брандмауэром. В таком случае вы не сможете подключиться к серверу Базы данных SQL Azure, пока ваш ИТ-отдел не откроет порт 5432.
   >

## <a name="get-the-connection-information"></a>Получение сведений о подключении

При создании базы данных Azure для сервера PostgreSQL была также создана база данных по умолчанию **postgres**. Чтобы подключиться к серверу базы данных, необходимо указать сведения об узле и учетные данные для доступа.

1. На портале Azure в меню слева щелкните **Все ресурсы** и найдите только что созданный сервер.

   :::image type="content" source="./media/tutorial-design-database-using-azure-portal/4-locate.png" alt-text="База данных Azure для PostgreSQL. Поиск сервера":::

2. Щелкните имя сервера **mydemoserver**.

3. Выберите страницу **обзора** сервера. Запишите значения **имени сервера** и **имени для входа администратора сервера**.

   :::image type="content" source="./media/tutorial-design-database-using-azure-portal/6-server-name.png" alt-text="База данных Azure для PostgreSQL. Учетные данные администратора сервера для входа":::


## <a name="connect-to-postgresql-database-using-psql"></a>Подключение к базе данных PostgreSQL с помощью psql
Если на клиентском компьютере установлено PostgreSQL, вы можете использовать локальный экземпляр [psql](https://www.postgresql.org/docs/9.6/static/app-psql.html) или консоль облачной службы Azure, чтобы подключиться к серверу Azure PostgreSQL. Теперь подключимся к серверу базы данных Azure для PostgreSQL с помощью служебной программы командной строки psql.

1. Чтобы подключиться к базе данных Azure для базы данных PostgreSQL, выполните следующую команду psql:
   ```
   psql --host=<servername> --port=<port> --username=<user@servername> --dbname=<dbname>
   ```

   Например, следующая команда устанавливает подключение к базе данных по умолчанию **postgres** на сервере PostgreSQL **mydemoserver.postgres.database.azure.com**, используя учетные данные для доступа. Введите `<server_admin_password>`, указанный при появлении запроса на ввод пароля.
  
   ```
   psql --host=mydemoserver.postgres.database.azure.com --port=5432 --username=myadmin@mydemoserver --dbname=postgres
   ```

   > [!TIP]
   > Если вы предпочитаете использовать URL-путь для подключения к Postgres, закодируйте с помощью URL-адреса знак @ в имени пользователя с использованием `%40`. Например, строка подключения для psql будет выглядеть так:
   > ```
   > psql postgresql://myadmin%40mydemoserver@mydemoserver.postgres.database.azure.com:5432/postgres
   > ```

2. Подключившись к серверу, создайте пустую базу данных с помощью командной строки:
   ```sql
   CREATE DATABASE mypgsqldb;
   ```

3. Чтобы подключиться к созданной базе данных **mypgsqldb**, выполните следующую команду в командной строке:
   ```sql
   \c mypgsqldb
   ```

## <a name="create-tables-in-the-database"></a>Создание таблиц в базе данных
Теперь, когда вы знаете, как подключиться к базе данных Azure для PostgreSQL, можно выполнить некоторые основные задачи.

Сначала создайте таблицу и заполните ее некоторыми данными. Давайте создадим таблицу, с помощью которой можно отслеживать данные инвентаризации, используя код SQL.
```sql
CREATE TABLE inventory (
    id serial PRIMARY KEY, 
    name VARCHAR(50), 
    quantity INTEGER
);
```

Вы можете просмотреть созданную таблицу в списке таблиц, введя:
```sql
\dt
```

## <a name="load-data-into-the-tables"></a>Загрузка данных в таблицу
Теперь, когда таблица создана, мы можем вставить в нее данные. Чтобы вставить некоторые строки данных, в открытом окне командной строки выполните следующий запрос:
```sql
INSERT INTO inventory (id, name, quantity) VALUES (1, 'banana', 150); 
INSERT INTO inventory (id, name, quantity) VALUES (2, 'orange', 154);
```

Итак, в созданной ранее таблице inventory содержится две строки данных.

## <a name="query-and-update-the-data-in-the-tables"></a>Запрос и обновление данных в таблицах
Чтобы извлечь сведения из таблицы inventory базы данных, выполните приведенный ниже запрос. 
```sql
SELECT * FROM inventory;
```

Вы можете также обновить данные в таблице, выполнив следующую команду:
```sql
UPDATE inventory SET quantity = 200 WHERE name = 'banana';
```

При извлечении данных вы увидите обновленные значения.
```sql
SELECT * FROM inventory;
```

## <a name="restore-data-to-a-previous-point-in-time"></a>Восстановление данных до предшествующей точки во времени
Представьте, что вы случайно удалили таблицу. Восстановить ее будет непросто. База данных Azure для PostgreSQL позволяет вернуть состояние до любой точки времени при наличии резервных копий сервера (определяется по настроенному сроку хранения резервной копии) и восстановить данные до этой точки на новом сервере. Вы можете восстановить удаленные данные с помощью нового сервера. Следующие шаги позволяют восстановить сервер **mydemoserver** до точки во времени перед добавлением таблицы inventory.

1. На странице **Обзор** сервера базы данных Azure для PostgreSQL на панели инструментов щелкните **Восстановить**. Откроется страница **Восстановление**.

   :::image type="content" source="./media/tutorial-design-database-using-azure-portal/9-azure-portal-restore.png" alt-text="Снимок экрана, на котором показана страница &quot;Обзор&quot; сервера базы данных Azure для PostgreSQL с выделенной кнопкой &quot;Восстановить&quot;.":::

2. Заполните форму **Восстановление**, указав следующие сведения.

   :::image type="content" source="./media/tutorial-design-database-using-azure-portal/10-azure-portal-restore.png" alt-text="Портал Azure. Параметры формы восстановления":::

   - **Точка восстановления.** Выберите время до того момента, когда был изменен сервер.
   - **Целевой сервер.** Укажите новое имя сервера, который нужно восстановить.
   - **Расположение.** Регион выбрать нельзя. По умолчанию он совпадает с исходным сервером.
   - **Ценовая категория**. Это значение нельзя изменить при восстановлении сервера. Она совпадает с ценовой категорией исходного сервера. 
3. Чтобы [восстановить сервер до точки во времени](./howto-restore-server-portal.md) перед удалением таблицы, нажмите кнопку **OК**. При восстановлении сервера до точки во времени создается копия исходного сервера с состоянием на момент указанной точки во времени (в пределах срока хранения, установленного для вашей [ценовой категории](./concepts-pricing-tiers.md)).

## <a name="clean-up-resources"></a>Очистка ресурсов

На предыдущих шагах вы создали ресурсы Azure в группе серверов. Если эти ресурсы вам больше не нужны, удалите группу серверов. Нажмите кнопку *Удалить* на странице *Обзор*, чтобы удалить группу серверов. При появлении запроса на всплывающей странице проверьте имя группы серверов и нажмите кнопку *Удалить*.

## <a name="next-steps"></a>Дальнейшие действия
Из этого руководства вы узнали, как с помощью портала Azure и других служебных программ выполнить следующие операции:
> [!div class="checklist"]
> * Создание сервера Базы данных Azure для PostgreSQL
> * настройка брандмауэра сервера;
> * использование служебной программы **psql** для создания базы данных;
> * Загрузка примера данных
> * Данные запросов
> * Обновление данных
> * восстановление данных.

> [!div class="nextstepaction"]
>[Проектирование первой базы данных Azure для PostgreSQL с помощью Azure CLI](tutorial-design-database-using-azure-cli.md)