---
title: Правила брандмауэра — масштабирование (Цитус) — база данных Azure для PostgreSQL
description: В этой статье описываются правила брандмауэра для базы данных Azure для PostgreSQL-Scale (Цитус).
author: jonels-msft
ms.author: jonels
ms.service: postgresql
ms.subservice: hyperscale-citus
ms.topic: conceptual
ms.date: 9/12/2019
ms.openlocfilehash: 559c5eca6fa8a6eceb37ade003d4f1983c0a1a1b
ms.sourcegitcommit: 772eb9c6684dd4864e0ba507945a83e48b8c16f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "90902082"
---
# <a name="firewall-rules-in-azure-database-for-postgresql---hyperscale-citus"></a>Правила брандмауэра в базе данных Azure для PostgreSQL — масштабирование (Цитус)
Брандмауэр сервера базы данных Azure для PostgreSQL предотвращает доступ к узлу координатора масштабирования (Цитус), пока вы не укажете, какие компьютеры имеют разрешение. Брандмауэр предоставляет доступ к серверу на основе исходного IP-адреса каждого запроса.
Для настройки брандмауэра можно создать правила брандмауэра, которые указывают диапазон допустимых IP-адресов. Правила брандмауэра можно создавать на уровне сервера.

**Правила брандмауэра:** Эти правила позволяют клиентам получать доступ к узлу координатора Цитус, то есть ко всем базам данных в пределах одного логического сервера. Правила брандмауэра уровня сервера можно настроить с помощью портал Azure. Для создания правил брандмауэра уровня сервера необходимо быть владельцем или участником подписки.

## <a name="firewall-overview"></a>Общие сведения о брандмауэре
По умолчанию доступ ко всем базам данных к узлу координатора блокируется брандмауэром. Чтобы использовать сервер с другого компьютера, сначала необходимо указать одно или несколько правил брандмауэра уровня сервера для обеспечения доступа к этому серверу. Используйте правила брандмауэра, чтобы определить разрешенные диапазоны IP-адресов из Интернета. Правила брандмауэра не повлияют на доступ к самому веб-сайту портала Azure.
Запросы на подключение из Интернета и Azure должны сначала обрабатываться брандмауэром и только потом достигать базы данных PostgreSQL, как показано на следующей схеме:

:::image type="content" source="media/concepts-hyperscale-firewall-rules/1-firewall-concept.png" alt-text="Пример рабочего потока брандмауэра":::

## <a name="connecting-from-the-internet-and-from-azure"></a>Подключение из Интернета и из Azure

Брандмауэр группы серверов Цитус, который может подключаться к узлу координатора группы. Брандмауэр определяет доступ путем консультации по настраиваемому списку правил. Каждое правило представляет собой IP-адрес или диапазон адресов, которые допускаются в.

Если брандмауэр блокирует подключения, это может привести к ошибкам в приложении. Например, при использовании драйвера JDBC PostgreSQL возникает ошибка следующего вида:

> java.util.concurrent.ExeКутионексцептион: Java. lang. RuntimeException: org. PostgreSQL. util. Псклексцептион: Неустранимая: отсутствует \_ запись PG HBA. conf для узла "123.45.67.890", пользователь "Цитус", база данных "Цитус", SSL

Сведения об определении правил см. в статье [Создание правил брандмауэра и управление ими](howto-hyperscale-manage-firewall-using-portal.md) .

## <a name="troubleshooting-the-database-server-firewall"></a>Устранение неполадок брандмауэра сервера базы данных
Если доступ к Microsoft Azure базе данных для службы PostgreSQL-Цитус не работает так, как вы ожидаете, рассмотрите следующие моменты:

* **Изменения в списке разрешений еще не вступили в действие:** Для вступления в силу изменений конфигурации брандмауэра Цитус может потребоваться 5-минутная задержка.

* **Пользователь не является полномочным или был использован неверный пароль:** Если у пользователя нет разрешений на сервере или используемый пароль неверен, подключение к серверу отклоняется. Создание параметра брандмауэра только предоставляет клиентам возможность подключения к серверу. Каждый клиент должен предоставить необходимые учетные данные безопасности.

Например, при использовании клиента JDBC может возникать следующая ошибка:
> java.util.concurrent.ExecutionException: java.lang.RuntimeException: org.postgresql.util.PSQLException: FATAL: password authentication failed for user "yourusername"

* **Динамический IP-адрес:** при наличии подключения к Интернету с динамическим предоставлением IP-адресов и возникновении проблем с прохождением через брандмауэр попробуйте одно из описанных ниже решений.

* Обратитесь к поставщику услуг Интернета (ISP) за диапазоном IP-адресов, назначенным клиентским компьютерам, которые обращаются к узлу координатора Цитус (), а затем добавьте диапазон IP-адресов в качестве правила брандмауэра.

* Получите статические IP-адреса для клиентских компьютеров, а затем добавьте статические IP-адреса как правила брандмауэра.

## <a name="next-steps"></a>Дальнейшие действия
Ниже перечислены статьи о создании правил брандмауэра уровня сервера и уровня базы данных.
* [Создание правил брандмауэра базы данных Azure для PostgreSQL и управление ими с помощью портала Azure](howto-hyperscale-manage-firewall-using-portal.md)
