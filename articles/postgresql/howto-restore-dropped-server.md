---
title: Восстановление удаленной базы данных Azure для сервера PostgreSQL
description: В этой статье описывается, как восстановить удаленный сервер в базе данных Azure для PostgreSQL с помощью портал Azure.
author: Bashar-MSFT
ms.author: bahusse
ms.service: postgresql
ms.topic: how-to
ms.date: 11/03/2020
ms.openlocfilehash: 591f01004cfba247112f702625ab05ddc0aaede3
ms.sourcegitcommit: 772eb9c6684dd4864e0ba507945a83e48b8c16f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "97652931"
---
# <a name="restore-a-dropped-azure-database-for-postgresql-server"></a>Восстановление удаленной базы данных Azure для сервера PostgreSQL

При удалении сервера резервная копия сервера базы данных может храниться в службе до пяти дней. Доступ к резервной копии базы данных можно получить и восстановить только из подписки Azure, в которой изначально находился сервер. Следующие Рекомендуемые действия могут быть выполнены для восстановления удаленного ресурса сервера PostgreSQL в течение 5 дней с момента удаления сервера. Рекомендуемые действия сработают, только если резервная копия сервера по-прежнему доступна и не удалена из системы. 

## <a name="pre-requisites"></a>Предварительные требования
Чтобы восстановить удаленную базу данных Azure для сервера PostgreSQL, вам потребуется следующее:
- Имя подписки Azure, в которой размещен исходный сервер
- Расположение, в котором был создан сервер

## <a name="steps-to-restore"></a>Действия по восстановлению

1. Перейдите на [портал Azure](https://portal.azure.com/#blade/Microsoft_Azure_ActivityLog/ActivityLogBlade). Выберите службу **Azure Monitor** , а затем выберите **Журнал действий**.

2. В журнале действий щелкните **Добавить фильтр** , как показано, и установите следующие фильтры для следующих

    - **Subscription** = ваша подписка, в которой размещен удаленный сервер
    - **Тип ресурса** = база данных Azure для серверов PostgreSQL (Microsoft. дбфорпостгрескл/Servers)
    - **Операция** = удаление сервера PostgreSQL (Microsoft. дбфорпостгрескл/Servers/Delete)
 
    ![Журнал действий отфильтрован для операции удаления сервера PostgreSQL](./media/howto-restore-dropped-server/activity-log-azure.png)

3. Выберите событие **удалить сервер PostgreSQL** , а затем выберите **вкладку JSON**. Скопируйте `resourceId` атрибуты и `submissionTimestamp` в выходных данных JSON. Значение resourceId имеет следующий формат: `/subscriptions/ffffffff-ffff-ffff-ffff-ffffffffffff/resourceGroups/TargetResourceGroup/providers/Microsoft.DBforPostgreSQL/servers/deletedserver` .


 4. Перейдите на страницу PostgreSQL [CREATE Server REST API](/rest/api/PostgreSQL/servers/create) и выберите вкладку **пробная** работа, выделенная зеленым цветом. Войдите в систему с использованием учетной записи Azure.

 5. Укажите **resourceGroupName**, **ServerName** (имя удаленного сервера), свойства **SubscriptionId** на основе значения JSON атрибута resourceId, захваченного на предыдущем шаге 3. Свойство API-Version предварительно заполняется и может быть оставлено как есть, как показано на следующем рисунке.

    ![Создание сервера с помощью REST API](./media/howto-restore-dropped-server/create-server-from-rest-api-azure.png)
  
 6. Прокрутите страницу ниже в разделе текст запроса и вставьте следующую замену "Удаленные расположения сервера", "Субмиссионтиместамп" и "resourceId". Для параметра "Ресторепоинтинтиме" укажите значение "Субмиссионтиместамп" минус **15 минут** , чтобы команда не выдает ошибку.
    
    ```json
    {
      "location": "Dropped Server Location",  
      "properties": 
      {
        "restorePointInTime": "submissionTimestamp - 15 minutes",
        "createMode": "PointInTimeRestore",
        "sourceServerId": "resourceId"
      }
    }
    ```

    Например, если текущее время — 2020-11-02T23:59:59.0000000 Z, мы рекомендуем не менее 15 минут до точки восстановления во времени 2020-11-02T23:44:59.0000000 Z.

    > [!Important]
    > На время удаления сервера существует ограничение в 5 дней. Через пять дней ожидается ошибка, так как не удается найти файл резервной копии.
    
7. Если вы видите код ответа 201 или 202, запрос на восстановление успешно отправлен. 

    Создание сервера может занять некоторое время в зависимости от размера базы данных и вычислительных ресурсов, подготовленных на исходном сервере. Состояние восстановления можно отслеживать из журнала действий путем фильтрации для 
   - **Subscription** = ваша подписка
   - **Тип ресурса** = база данных Azure для серверов PostgreSQL (Microsoft. дбфорпостгрескл/Servers) 
   - **Операция** = обновление PostgreSQL Server CREATE

## <a name="next-steps"></a>Дальнейшие действия
- Если вы пытаетесь восстановить сервер в течение пяти дней и по-прежнему выдается сообщение об ошибке, выполнив описанные выше действия, откройте обращение в службу поддержки. Если вы пытаетесь восстановить удаленный сервер через пять дней, ожидается ошибка, так как не удается найти файл резервной копии. Не открывайте запрос в службу поддержки в этом сценарии. Группа поддержки не может предоставить помощь в случае удаления резервной копии из системы. 
- Чтобы предотвратить случайное удаление серверов, мы настоятельно рекомендуем использовать [блокировки ресурсов](https://techcommunity.microsoft.com/t5/azure-database-for-PostgreSQL/preventing-the-disaster-of-accidental-deletion-for-your-PostgreSQL/ba-p/825222).
