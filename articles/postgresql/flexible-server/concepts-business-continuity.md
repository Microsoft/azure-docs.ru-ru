---
title: Общие сведения о непрерывности бизнес-процессов с помощью базы данных Azure для PostgreSQL-гибкого сервера
description: Узнайте о принципах обеспечения непрерывности бизнес-процессов с помощью базы данных Azure для PostgreSQL-гибкого сервера
author: sr-msft
ms.author: srranga
ms.service: postgresql
ms.topic: conceptual
ms.date: 09/22/2020
ms.openlocfilehash: 341d3c6f0a2d84c2b7b725959db9f7e5dd80d3ff
ms.sourcegitcommit: 910a1a38711966cb171050db245fc3b22abc8c5f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "92542970"
---
# <a name="overview-of-business-continuity-with-azure-database-for-postgresql---flexible-server"></a>Общие сведения о непрерывности бизнес-процессов с помощью базы данных Azure для PostgreSQL-гибкого сервера

> [!IMPORTANT]
> Гибкий сервер Базы данных Azure для PostgreSQL предоставляется в режиме предварительной версии

**Непрерывность бизнес-процессов** в базе данных Azure для PostgreSQL — гибкий сервер — это механизмы, политики и процедуры, позволяющие бизнесу продолжать работу в случае нарушения работы, особенно в вычислительной инфраструктуре. В большинстве случаев гибкий сервер будет обрабатывать критические события, которые могут возникать в облачной среде и поддерживать работу приложений и бизнес-процессов. Однако существуют некоторые события, которые не могут быть обработаны автоматически, например:

- Пользователь случайно удаляет или обновляет строку в таблице.
- Землетрясения вызывает сбой питания и временно отключает центр обработки данных или зону доступности.
- Исправление базы данных, необходимое для исправления ошибки или проблемы безопасности.

Гибкие серверы предоставляют функции, защищающие данные и снижающие время простоя для критически важных баз данных в случае запланированных и незапланированных событий простоя. На основе инфраструктуры Azure, которая уже обеспечивает устойчивую устойчивость и доступность, гибкие серверы имеют функции обеспечения непрерывности бизнес-процессов, которые обеспечивают дополнительную защиту от сбоев, требования к времени восстановления и снижают вероятность потери данных. При проектировании приложений следует учитывать отклонения времени простоя — целевое время восстановления (RTO) и вероятность потери данных — это Целевая точка восстановления (RPO). Например, критическая для вашей компании база данных требует значительно более строгих требований к бесперебойной работе по сравнению с тестовой базой данных.  

> [!IMPORTANT]
> Время работоспособности% соглашения об уровне обслуживания (SLA) не предлагается в предварительной версии. 

В таблице ниже показаны функции, предлагаемые гибким сервером.


| **Компонент** | **Описание** | **Рекомендации** |
| ---------- | ----------- | ------------ |
| **Автоматическое резервное копирование** | Гибкий сервер автоматически выполняет ежедневное резервное копирование файлов базы данных и постоянно создает резервные копии журналов транзакций. Резервные копии могут храниться в течение 7 дней до 35 дней. Вы сможете восстановить сервер базы данных до любой точки во времени в течение срока хранения резервной копии. RTO зависит от размера восстанавливаемых данных и времени на восстановление журнала. Это может быть от нескольких минут до 12 часов. Дополнительные сведения см. в разделе [Основные понятия — резервное копирование и восстановление](./concepts-backup-restore.md). |Данные резервного копирования остаются в пределах региона. |
| **Высокий уровень доступности с избыточностью в пределах зоны** | Гибкий сервер может быть развернут с конфигурацией высокого уровня доступности, избыточной в пределах зоны, где основной и резервный серверы развертываются в двух разных зонах доступности в регионе. Эта конфигурация высокой доступности защищает базы данных от сбоев на уровне зоны, а также помогает сократить время простоя приложения во время запланированных и незапланированных событий простоя. Данные с сервера-источника реплицируются в резервную реплику в синхронном режиме. В случае любого нарушения работы сервера-источника сервер автоматически переключается на резервную реплику. В большинстве случаев ожидается, что в 60s-120S. Значение RPO должно быть равно нулю (без потери данных). Дополнительные сведения см. в разделе [Основные понятия — высокий уровень доступности](./concepts-high-availability.md). | Поддерживается в уровнях вычислений "общий назначение" и "оптимизировано для памяти". Доступно только в регионах, где доступны несколько зон. |
| **Управляемые диски уровня "Премиум"** | Файлы базы данных хранятся в хранилище с высокой степенью устойчивости и надежной управляемой системой. Это обеспечивает избыточность данных с помощью трех копий реплики, хранящихся в зоне доступности с возможностью автоматического восстановления данных. Дополнительные сведения см. в [документации по управляемым дискам](../../virtual-machines/managed-disks-overview.md). | Данные, хранящиеся в зоне доступности. |
| **Избыточная резервная копия зоны** | Гибкие резервные копии сервера автоматически и безопасно хранятся в хранилище, избыточном в пределах зоны. Во время сбоя уровня зоны, когда сервер подготавливается, и если на сервере не настроена избыточность зоны, базу данных можно восстановить с помощью последней точки восстановления в другой зоне. Дополнительные сведения см. в разделе [Основные понятия — резервное копирование и восстановление](./concepts-backup-restore.md).| Применимо только в регионах, где доступны несколько зон.|


## <a name="planned-downtime-events"></a>Запланированные события простоя
Ниже приведены некоторые сценарии планового обслуживания. Эти события обычно вызывают несколько минут простоя и без потери данных.

| **Сценарий** | **Процесс**|
| ------------------- | ----------- | 
| <b>Масштабирование вычислений (инициировано пользователем)| При выполнении операции масштабирования вычислений активные контрольные точки могут быть завершены, клиентские соединения преобразуются, все незафиксированные транзакции отменяются, хранилище отсоединяется, а затем завершает работу. Новый гибкий сервер с тем же именем сервера базы данных подготавливается с масштабированной конфигурацией вычислений. Затем хранилище прикрепляется к новому серверу и запускается база данных, которая выполняет восстановление, если это необходимо, прежде чем принимать клиентские подключения. |
| <b>Масштабирование хранилища (инициированные пользователем) | Когда инициируется масштабирование операции с хранилищем, активные контрольные точки могут быть завершены, клиентские подключения прерывается, все незафиксированные транзакции отменяются, а затем завершается. Хранилище масштабируется до нужного размера, а затем прикрепляется к новому серверу. При необходимости выполняется восстановление перед принятием клиентских подключений. Обратите внимание, что масштабирование уменьшения размера хранилища не поддерживается. |
| <b>Новое развертывание программного обеспечения (инициировано Azure) | Новые компоненты или исправления ошибок автоматически происходят в рамках планового обслуживания службы, и вы можете запланировать выполнение этих действий. Дополнительные сведения см. на [портале](https://aka.ms/servicehealthpm). | 
| <b>Дополнительные обновления версий (инициированные Azure) | База данных Azure для PostgreSQL автоматически запланирует серверы баз данных до дополнительной версии, определенной Azure. Это происходит в рамках планового обслуживания службы. Сервер базы данных автоматически перезапускается с новой дополнительной версией. Дополнительные сведения см. в [этой документации](../concepts-monitoring.md#planned-maintenance-notification). Вы также можете проверить [портал](https://aka.ms/servicehealthpm).| 

 Если гибкий сервер настроен на **высокий уровень доступности с избыточностью зоны**, гибкий сервер сначала выполняет операции масштабирования и обслуживания на резервном сервере. Дополнительные сведения см. в разделе [Основные понятия — высокий уровень доступности](./concepts-high-availability.md).

##  <a name="unplanned-downtime-mitigation"></a>Незапланированное снижение времени простоя

Незапланированные простои могут возникнуть в результате непредвиденных нарушений, таких как сбой оборудования, проблемы с сетью и программные ошибки. Если сервер базы данных, настроенный с высокой доступностью, неожиданно выходит из строя, резервная реплика активируется и клиенты могут возобновить свои операции. Если не настроена высокая доступность (HA), то при неудачной попытке перезапуска новый сервер базы данных автоматически подготавливается. Хотя незапланированные простои не могут быть устранены, гибкий сервер помогает уменьшить время простоя за счет автоматического выполнения операций восстановления без вмешательства человека. 
   
### <a name="unplanned-downtime-failure-scenarios-and-service-recovery"></a>Незапланированный простой: сценарии сбоя и восстановление службы
Ниже приведены некоторые незапланированные сценарии сбоя и процесс восстановления. 

| **Сценарий** | **Процесс восстановления [non-HA]** | **Процесс восстановления [HA]** |
| ---------- | ---------- | ------- |
| <B>Сбой сервера базы данных | Если сервер базы данных не работает, Azure попытается перезапустить сервер базы данных. В случае сбоя сервер базы данных будет перезапущен на другом физическом узле.  <br /> <br /> Время восстановления (RTO) зависит от различных факторов, включая активность во время сбоя, таких как большие транзакции, и объема операций восстановления, выполняемых в процессе запуска сервера базы данных. <br /> <br /> Приложения, использующие базы данных PostgreSQL, должны быть созданы таким образом, чтобы они определяли и повторно пропустили соединения и неудачные транзакции. | При обнаружении сбоя сервера базы данных сервер переключается на резервный сервер, что сокращает время простоя. Дополнительные сведения см. на [странице концепции высокой доступности](./concepts-high-availability.md). Ожидается значение RTO, равное 60-120S, с нулевой потерей данных. |
| <B>Сбой хранилища | Приложения не видят никакого влияния на связанные с хранилищем проблемы, такие как сбой диска или повреждение физического блока. Поскольку данные хранятся в трех копиях, копия данных обрабатывается оставшимся хранилищем. Поврежденный блок данных автоматически восстанавливается, и автоматически создается новая копия данных. | Для любых редких и неустранимых ошибок, таких как все хранилище недоступно, гибкий сервер выполняет отработку отказа на резервную реплику, чтобы уменьшить время простоя. Дополнительные сведения см. на [странице концепции высокой доступности](./concepts-high-availability.md). |
| <b> Ошибки логических или пользовательских пользователей | Для восстановления после ошибок пользователя, например случайного удаления таблиц или неправильно обновленных данных, необходимо выполнить восстановление на [момент времени](../concepts-backup.md) (PITR). При выполнении операции восстановления указывается пользовательская точка восстановления, которая является временем до возникновения ошибки.<br> <br>  Если вы хотите восстановить только подмножество баз данных или определенные таблицы, а не все базы данных на сервере базы данных, можно восстановить сервер базы данных в новом экземпляре, экспортировать таблицы с помощью [pg_dump](https://www.postgresql.org/docs/11/app-pgdump.html), а затем использовать [pg_restore](https://www.postgresql.org/docs/11/app-pgrestore.html) для восстановления этих таблиц в базе данных. | Эти ошибки пользователей не защищаются с высокой доступностью, так как все изменения реплицируются в резервную реплику синхронно. Для восстановления после таких ошибок необходимо выполнить восстановление на момент времени. |
| <b> Сбой зоны доступности | Для восстановления после сбоя на уровне зоны можно выполнить восстановление на момент времени с помощью резервной копии и выбрать пользовательскую точку восстановления с последним временем восстановления последних данных. В другой нетронутой зоне будет развернут новый гибкий сервер. Время, затраченное на восстановление, зависит от предыдущей резервной копии и объема восстанавливаемых журналов транзакций. | Гибкий сервер автоматически переключается на резервный сервер в течение 60-120S с нулевой потерей данных. Дополнительные сведения см. на [странице концепции высокой доступности](./concepts-high-availability.md). | 
| <b> Сбой региона | В предварительной версии еще не поддерживаются реплики чтения в разных регионах и геовосстановление функций резервного копирования. | |


> [!IMPORTANT]
> Удаленные серверы **нельзя** восстановить. Если вы удалите сервер, все связанные с ним базы данных также будут удалены без возможности восстановления. Используйте [блокировку ресурсов Azure](../../azure-resource-manager/management/lock-resources.md) , чтобы предотвратить случайное удаление сервера.


## <a name="next-steps"></a>Дальнейшие действия

-   Сведения о [высокой доступности с избыточностью зоны](./concepts-high-availability.md)
-   Сведения о [резервном копировании и восстановлении](./concepts-backup-restore.md)