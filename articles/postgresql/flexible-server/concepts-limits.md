---
title: Ограничения — база данных Azure для PostgreSQL — гибкий сервер
description: В этой статье описываются ограничения в базе данных Azure для PostgreSQL-гибкого сервера, например число параметров подключения и подсистемы хранилища.
author: lfittl-msft
ms.author: lufittl
ms.service: postgresql
ms.topic: conceptual
ms.date: 09/22/2020
ms.openlocfilehash: 0221022c342735744d59f956d6047b4abf23b5cf
ms.sourcegitcommit: e972837797dbad9dbaa01df93abd745cb357cde1
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/14/2021
ms.locfileid: "100516521"
---
# <a name="limits-in-azure-database-for-postgresql---flexible-server"></a>Ограничения в базе данных Azure для PostgreSQL-гибкого сервера

> [!IMPORTANT]
> Гибкий сервер Базы данных Azure для PostgreSQL предоставляется в режиме предварительной версии

В следующих разделах описываются действующие ограничения емкости и функциональных возможностей в службе базы данных. Если вы хотите узнать о уровнях ресурсов (вычислений, памяти, хранилища), см. статью о средах [вычислений и хранения](concepts-compute-storage.md) .

## <a name="maximum-connections"></a>Максимальное количество соединений

Ниже показаны максимальное число подключений на ценовую категорию и виртуальных ядер. В системе Azure требуются три подключения для мониторинга базы данных Azure для PostgreSQL-гибкого сервера.

| Имя SKU             | Виртуальные ядра | Размер памяти | Максимальное число подключений | Максимальное число пользовательских соединений |
|----------------------|--------|-------------|-----------------|----------------------|
| **Накапливаемыми ресурсами**        |        |             |                 |                      |
| B1ms                 | 1      | 2 гиб       | 50              | 47                   |
| B2s                  | 2      | 4 гиб       | 100             | 97                   |
| **Общего назначения**  |        |             |                 |                      |
| D2s_v3               | 2      | 8 гиб       | 214             | 211                  |
| D4s_v3               | 4      | 16 гиб      | 429             | 426                  |
| D8s_v3               | 8      | 32 ГиБ      | 859             | 856                  |
| D16s_v3              | 16     | 64 ГиБ      | 1718            | 1715                 |
| D32s_v3              | 32     | 128 ГиБ     | 3437            | 3434                 |
| D48s_v3              | 48     | 192 ГиБ     | 5000            | 4997                 |
| D64s_v3              | 64     | 256 Гиб     | 5000            | 4997                 |
| **Оптимизированная для памяти** |        |             |                 |                      |
| E2s_v3               | 2      | 16 гиб      | 1718            | 1715                 |
| E4s_v3               | 4      | 32 ГиБ      | 3437            | 3434                 |
| E8s_v3               | 8      | 64 ГиБ      | 5000            | 4997                 |
| E16s_v3              | 16     | 128 ГиБ     | 5000            | 4997                 |
| E32s_v3              | 32     | 256 Гиб     | 5000            | 4997                 |
| E48s_v3              | 48     | 384 гиб     | 5000            | 4997                 |
| E64s_v3              | 64     | 432 ГиБ     | 5000            | 4997                 |

При превышении предельного количества подключений может появиться следующая ошибка:
> FATAL: sorry, too many clients already (Неустранимая ошибка: уже подключено слишком много клиентов)

> [!IMPORTANT]
> Для обеспечения оптимальной работы рекомендуется использовать пул подключений, например Пгбаунцер, для эффективного управления подключениями.

PostgreSQL подключение, даже бездействующее, может занять около 10 МБ памяти. Кроме того, создание новых соединений занимает некоторое время. Большинство приложений запрашивают много кратковременных соединений, из-за которых и возникает такая ситуация. В результате для реальной рабочей нагрузки будет меньше доступных ресурсов, что приведет к снижению производительности. Пул соединений можно использовать для уменьшения бездействующих соединений и повторного использования существующих подключений. Дополнительные сведения см. в этой [записи блога](https://techcommunity.microsoft.com/t5/azure-database-for-postgresql/not-all-postgres-connection-pooling-is-equal/ba-p/825717).

## <a name="functional-limitations"></a>Ограничения функциональных возможностей

### <a name="scale-operations"></a>Операции масштабирования

- Для масштабирования хранилища сервера требуется перезагрузка сервера.
- Хранилище сервера можно масштабировать только на 2 шагах. Дополнительные сведения см. в разделе о [вычислении и хранении](concepts-compute-storage.md) .
- Уменьшение размера хранилища сервера в настоящее время не поддерживается.

### <a name="server-version-upgrades"></a>Обновления версии сервера

- В настоящее время автоматический переход между основными версиями ядра СУБД не поддерживается. Чтобы выполнить обновление до следующей основной версии, [восстановите дамп](../howto-migrate-using-dump-and-restore.md) на сервере, который был создан с новой версией ядра.

### <a name="storage"></a>Служба хранилища

- После настройки размер хранилища нельзя уменьшить.
- В настоящее время функция автоматического увеличения хранилища недоступна. Отслеживайте использование и увеличьте размер хранилища до более высокого. 
- Когда уровень использования хранилища достигнет 95% или если доступная емкость меньше 5 гиб, сервер автоматически переключится в **режим только для чтения** , чтобы избежать ошибок, связанных с ситуациями с диском. 
- Рекомендуется настроить правила генерации оповещений для `storage used` или `storage percent` , если они превышают определенные пороговые значения, чтобы можно было заранее предпринять такие действия, как увеличение размера хранилища. Например, можно настроить оповещение, если процент использования хранилища превышает 80%.
  
### <a name="networking"></a>Сеть

- В настоящее время перемещение и выход из виртуальной сети не поддерживается.
- Объединение общего доступа с развертыванием в виртуальной сети в настоящее время не поддерживается.
- Правила брандмауэра не поддерживаются в виртуальной сети, вместо них можно использовать группы безопасности сети.
- Серверы базы данных с открытым доступом могут подключаться к общедоступному Интернету, например через `postgres_fdw` , и этот доступ не может быть ограничен. Серверы, основанные на виртуальной сети, могут иметь ограниченный исходящий доступ с помощью групп безопасности сети.

### <a name="high-availability-ha"></a>Высокий уровень доступности (HA)

- Zone-Redundant HA сейчас не поддерживается для пакетных серверов.
- IP-адрес сервера базы данных изменяется при отработки отказа сервера в режим высокой доступности. Убедитесь, что вместо IP-адреса сервера используется запись DNS.
- Если логическая репликация настроена с помощью гибкого сервера с высоким уровнем доступности, то в случае отработки отказа на резервный сервер, логические слоты репликации не копируются на резервный сервер. 
- Дополнительные сведения о доступности с избыточностью в зонах, включая ограничения, см. на странице с описанием [принципов и высокой доступности](concepts-high-availability.md) .

### <a name="availability-zones"></a>Зоны доступности

- Вручную переместить серверы в другую зону доступности сейчас не поддерживается.
- Зону доступности резервного сервера с высоким уровнем доступности нельзя настроить вручную.

### <a name="postgres-engine-extensions-and-pgbouncer"></a>Postgres Engine, расширения и Пгбаунцер

- Postgres 10 и более ранние версии не поддерживаются. Если требуются более старые версии postgres, рекомендуется использовать параметр [Single Server](../overview-single-server.md) .
- В настоящее время поддержка расширения ограничена `contrib` расширениями postgres.
- Встроенный пул подключений Пгбаунцер в настоящее время недоступен для серверов баз данных в виртуальной сети или для пакетных серверов.

### <a name="stopstart-operation"></a>Операция завершения или запуска

- Сервер не может быть остановлен более семи дней.

### <a name="scheduled-maintenance"></a>Запланированное обслуживание

- Изменение периода обслуживания менее чем за пять дней до уже запланированного обновления не повлияет на это обновление. Изменения вступают в силу только при следующем запланированном обслуживании.

### <a name="backing-up-a-server"></a>Резервное копирование сервера

- Резервные копии управляются системой, в настоящее время выполнять эти резервные копии вручную невозможно. `pg_dump`Вместо этого рекомендуется использовать.
- Резервные копии всегда являются полными резервными копиями на основе моментальных снимков (без разностных резервных копий), что может привести к более высокой загрузке хранилища Обратите внимание, что журналы транзакций (журналы упреждающего хранения — WAL) отделены от полных или разностных резервных копий и архивируются непрерывно.

### <a name="restoring-a-server"></a>Восстановление сервера

- При использовании функции восстановления до точки во времени создается новый сервер с теми же конфигурациями вычислений и хранилища, что и у сервера, на котором он основан.
- Серверы баз данных на основе виртуальной сети восстанавливаются в одной виртуальной сети при восстановлении из резервной копии.
- На новом сервере, созданном во время восстановления, нет правил брандмауэра, которые были настроены на сервере-источнике. Правила брандмауэра должны создаваться отдельно для нового сервера.
- Восстановление удаленного сервера не поддерживается.
- Восстановление между регионами не поддерживается.

### <a name="other-features"></a>Другие возможности

* Проверка подлинности Azure AD пока не поддерживается. Если требуется проверка подлинности Azure AD, рекомендуется использовать параметр [Single Server](../overview-single-server.md) .
* Реплики чтения пока не поддерживаются. Если требуются реплики Read, рекомендуется использовать параметр [Single Server](../overview-single-server.md) .
* Перемещение ресурсов в другую подписку не поддерживается. 


## <a name="next-steps"></a>Дальнейшие шаги

- Сведения [о доступных параметрах вычислений и хранилища](concepts-compute-storage.md)
- См. [поддерживаемые версии базы данных PostgreSQL](concepts-supported-versions.md).
- Узнайте [Как выполнить резервное копирование и восстановление сервера в службе "База данных Azure для PostgreSQL" с помощью портала Azure](how-to-restore-server-portal.md).
