---
title: Настройка оповещений — изменение масштаба (Цитус) — база данных Azure для PostgreSQL
description: В этой статье описывается, как настроить оповещения метрик для базы данных Azure для PostgreSQL-Scale (Цитус) и получить доступ к ним.
author: jonels-msft
ms.author: jonels
ms.service: postgresql
ms.subservice: hyperscale-citus
ms.topic: how-to
ms.date: 3/16/2020
ms.openlocfilehash: f5557140d77865a6d4c44316cecd512f877736e0
ms.sourcegitcommit: 867cb1b7a1f3a1f0b427282c648d411d0ca4f81f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "100577085"
---
# <a name="use-the-azure-portal-to-set-up-alerts-on-metrics-for-azure-database-for-postgresql---hyperscale-citus"></a>Использование портал Azure для настройки оповещений в метриках для базы данных Azure для PostgreSQL-Scale (Цитус)

В этой статье показано, как настроить оповещения для базы данных Azure для PostgreSQL с помощью портала Azure. Вы можете получать оповещения на основе [метрик мониторинга](concepts-hyperscale-monitoring.md) для служб Azure.

Мы назовем оповещение, которое будет срабатывать, когда значение указанной метрики пересекает пороговое. Оповещение активируется при первом выполнении условия и затем активируется.

Оповещения можно настроить для выполнения следующих действий при его активации:
* Отправка уведомлений по электронной почте администратору службы и соадминистраторам.
* отправка уведомления на указанные дополнительные электронные адреса;
* вызов веб-перехватчика.

Для настройки правил генерации оповещений и получения сведений о них можно использовать:
* [Портал Azure](../azure-monitor/alerts/alerts-metric.md#create-with-azure-portal)
* [Azure CLI](../azure-monitor/alerts/alerts-metric.md#with-azure-cli)
* [REST API Azure Monitor](/rest/api/monitor/metricalerts)

## <a name="create-an-alert-rule-on-a-metric-from-the-azure-portal"></a>Создание правила генерации оповещений на основе метрики на портале Azure
1. На [портале Azure](https://portal.azure.com/) выберите сервер базы данных Azure для PostgreSQL, который нужно отследить.

2. В разделе боковой панели **Мониторинг** выберите **Оповещения**, как показано ниже:

   :::image type="content" source="./media/howto-hyperscale-alert-on-metric/2-alert-rules.png" alt-text="Выбор правил оповещений":::

3. Выберите **новое правило генерации оповещений** (+ значок).

4. Откроется страница **Создание правила**, как показано ниже. Заполните необходимые сведения:

   :::image type="content" source="./media/howto-hyperscale-alert-on-metric/4-add-rule-form.png" alt-text="Форма добавления оповещения для метрики":::

5. В разделе **условие** выберите **Добавить**.

6. Выберите из списка сигналов метрику, для которой необходимо создать оповещение. В этом примере выберите Storage percent (Процент хранилища).
   
   :::image type="content" source="./media/howto-hyperscale-alert-on-metric/6-configure-signal-logic.png" alt-text="На снимке экрана показана страница Настройка логики сигнала, на которой можно просмотреть несколько сигналов.":::

7. Настройте логику оповещения.

    * **Оператор** (например, "Больше чем")
    * **Пороговое значение** (например, 85 процентов)
    * Степень **детализации статистической обработки** , в течение которого правило метрики должно быть удовлетворено перед срабатыванием предупреждения (например, "За последние 30 минут")
    * и **частоту оценки** (например, "1 минута")
   
   По завершении нажмите кнопку **Готово**.

   :::image type="content" source="./media/howto-hyperscale-alert-on-metric/7-set-threshold-time.png" alt-text="На снимке экрана показана панель, на которой можно настроить логику оповещения.":::

8. В разделе **Группы действий** выберите **Создать**, чтобы создать группу для получения уведомлений об оповещении.

9. Заполните форму "Добавить группу действий", указав имя, короткое имя, подписку и группу ресурсов.

    :::image type="content" source="./media/howto-hyperscale-alert-on-metric/9-add-action-group.png" alt-text="На снимке экрана показана форма добавления группы действий, в которой можно ввести описанные значения.":::

10. Настройте тип действия **Электронная почта, SMS, push-уведомление, голосовой вызов**.
    
    Выберите "роль электронной почты Azure Resource Manager", чтобы отправлять уведомления владельцам, участникам и читателям подписки.
   
    По завершении нажмите кнопку **ОК**.

    :::image type="content" source="./media/howto-hyperscale-alert-on-metric/10-action-group-type.png" alt-text="На снимке экрана показана панель адреса электронной почты/S/Push/Voice.":::

11. Укажите имя правила генерации оповещений, описание и уровень серьезности.

    :::image type="content" source="./media/howto-hyperscale-alert-on-metric/11-name-description-severity.png" alt-text="На снимке экрана показана панель сведений о предупреждении."::: 

12. Выберите **Создать правило генерации оповещений**, чтобы создать оповещение.

    Через несколько минут оповещение включится и будет активироваться, как было описано выше.

### <a name="managing-alerts"></a>Управление оповещениями

Создав оповещение, можно выбрать его и выполнить следующие действия.

* просмотреть диаграмму, отображающую пороговое и фактическое значения метрики за предыдущий день, относящиеся к этому оповещению;
* **изменить** или **удалить** правило генерации оповещений;
* **отключить** или **включить** его, если нужно временно остановить или возобновить получение уведомлений.

## <a name="suggested-alerts"></a>Предлагаемые оповещения

### <a name="disk-space"></a>Пространство на диске

Мониторинг и оповещения важны для каждой группы серверов рабочей среды Цитус. Для правильной работы базовой базы данных PostgreSQL требуется свободное место на диске. Если диск заполнен, узел сервера базы данных переходит в режим «вне сети» и отклоняется, пока не появится свободное место. На этом этапе для решения этой проблемы требуется запрос в службу поддержки Майкрософт.

Рекомендуется устанавливать оповещения о дисковом пространстве на каждом узле в каждой группе серверов даже при нерабочем использовании. Оповещения об использовании места на диске обеспечивают предварительное предупреждение, необходимое для обеспечения работоспособности узлов. Для получения лучших результатов используйте серию оповещений на 75%, 85% и 95% использования. Выбираемые процентные значения зависят от скорости приема данных, так как быстрый прием данных быстрее заполняет диск.

Так как диск приближается к максимальному объему пространства, попробуйте использовать эти методы, чтобы получить больше свободного места:

* Проверьте политику хранения данных. Если возможно, переместите старые данные в холодное хранилище.
* Рассмотрите возможность [добавления узлов](howto-hyperscale-scale-grow.md#add-worker-nodes) в группу серверов и перераспределения сегментов. При перераспределении данные распределяются между несколькими компьютерами.
* Рекомендуется [увеличивать емкость](howto-hyperscale-scale-grow.md#increase-or-decrease-vcores-on-nodes) рабочих узлов. У каждого работника может быть до 2 Тиб хранилища. Однако следует попытаться добавить узлы перед изменением размеров узлов, так как Добавление узлов выполняется быстрее.

### <a name="cpu-usage"></a>Загрузка ЦП

Наблюдение за использованием ЦП полезно для создания базовых показателей производительности. Например, вы можете заметить, что загрузка ЦП обычно составляет около 40-60%. Если загрузка ЦП внезапно начинает навести указатель на 95%, можно распознать аномалию. Использование ЦП может отражать приростства, но может также обнаружить недопустимый запрос. При создании предупреждения о ЦП задайте большую степень гранулярности статистической обработки для перехвата длительных увеличений и пропуска пиковых скачков.

## <a name="next-steps"></a>Дальнейшие действия
* Узнайте больше о [настройке веб-перехватчиков webhook в оповещениях](../azure-monitor/alerts/alerts-webhooks.md).
* Прочитайте [обзор сбора метрики](../azure-monitor/data-platform.md) и узнайте, как можно обеспечить, чтобы служба была доступна и отвечала на запросы.
