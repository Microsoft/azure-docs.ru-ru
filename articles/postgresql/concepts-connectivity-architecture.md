---
title: Архитектура подключения — база данных Azure для PostgreSQL — один сервер
description: Описывает архитектуру подключения базы данных Azure для PostgreSQL-Single Server.
author: Bashar-MSFT
ms.author: bahusse
ms.service: postgresql
ms.topic: conceptual
ms.date: 2/11/2021
ms.openlocfilehash: 97778951777677ce02adec59d906c1246494457a
ms.sourcegitcommit: d4734bc680ea221ea80fdea67859d6d32241aefc
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/14/2021
ms.locfileid: "100369413"
---
# <a name="connectivity-architecture-in-azure-database-for-postgresql"></a>Архитектура подключения в базе данных Azure для PostgreSQL
В этой статье описывается архитектура подключения к базе данных Azure для PostgreSQL, а также сведения о том, как трафик направляется в базу данных Azure для экземпляра базы данных PostgreSQL из клиентов как внутри, так и за пределами Azure.

## <a name="connectivity-architecture"></a>Архитектура подключения
Подключение к базе данных Azure для PostgreSQL устанавливается через шлюз, который отвечает за маршрутизацию входящих подключений к физическому расположению сервера в наших кластерах. На следующей схеме показан поток трафика.

:::image type="content" source="./media/concepts-connectivity-architecture/connectivity-architecture-overview-proxy.png" alt-text="Обзор архитектуры подключения":::


Когда клиент подключается к базе данных, строка подключения к серверу разрешается в IP-адрес шлюза. Шлюз прослушивает IP-адрес порта 5432. В кластере базы данных трафик перенаправляется в соответствующую базу данных Azure для PostgreSQL. Поэтому для подключения к серверу, например из корпоративных сетей, необходимо открыть **брандмауэр на стороне клиента, чтобы разрешить исходящий трафик для доступа к нашим шлюзам**. Ниже приведен полный список IP-адресов, используемых нашими шлюзами в каждом регионе.

## <a name="azure-database-for-postgresql-gateway-ip-addresses"></a>IP-адреса шлюза базы данных Azure для PostgreSQL

Служба шлюза размещается в группе вычислений без отслеживания состояния, расположенных за IP-адресом, который при попытке подключения к серверу базы данных Azure для PostgreSQL будет достигнут первый клиент. 

В рамках текущего обслуживания службы мы периодически обновляем вычисление оборудования, в котором размещаются шлюзы, чтобы обеспечить наиболее безопасное и производительное подключение. При обновлении оборудования шлюза сначала создается новое кольцо для таких кластерных узлов. Это новое кольцо обслуживает трафик всех недавно созданных серверов базы данных Azure для PostgreSQL, и он будет иметь другой IP-адрес из старых колец шлюзов в том же регионе, чтобы отличать трафик. Старое оборудование шлюза остается в обслуживании существующих серверов, но планируется списать в будущем. Перед списанием оборудования шлюза клиенты, работающие с серверами и подключающиеся к старым кольцам шлюза, будут уведомлены по электронной почте и в портал Azure за три месяца перед списанием. Списание шлюзов может повлиять на подключение к серверам, если 

* IP-адреса шлюза жестко заменяются в строке подключения приложения. Это **не рекомендуется**. В строке подключения для приложения следует использовать полное доменное имя (FQDN) сервера в формате <servername> . postgres.Database.Azure.com. 
* Вы не обновляете более новые IP-адреса шлюза в брандмауэре на стороне клиента, чтобы разрешить исходящему трафику доступ к нашим новым кольцам шлюза.

В следующей таблице перечислены IP-адреса шлюзов для шлюза базы данных Azure для PostgreSQL для всех областей данных. Наиболее актуальные сведения об IP-адресах шлюза для каждого региона см. в таблице ниже. В таблице ниже представлены следующие столбцы.

* **IP-адреса шлюза:** В этом столбце перечислены текущие IP-адреса шлюзов, размещенных на последнем поколение оборудования. При подготовке нового сервера рекомендуется открыть брандмауэр на стороне клиента, чтобы разрешить исходящий трафик для IP-адресов, перечисленных в этом столбце.
* **IP-адреса шлюза (списание):** В этом столбце перечислены IP-адреса шлюзов, размещенных в старом поколении оборудования, которое сейчас выводится из эксплуатации. При подготовке нового сервера эти IP-адреса можно игнорировать. Если у вас есть существующий сервер, продолжайте хранить правило исходящего трафика для брандмауэра для этих IP-адресов, так как мы еще не списаны. При удалении правил брандмауэра для этих IP-адресов могут возникнуть ошибки подключения. Вместо этого вы должны заранее добавить новые IP-адреса, указанные в столбце IP-адреса шлюза, в правило исходящего брандмауэра, как только вы получите уведомление об списании. Это гарантирует, что при миграции сервера на новейшее оборудование шлюза нет перерывов в подключении к серверу.
* **IP-адреса шлюза (списанные):** В этих столбцах перечислены IP-адреса колец шлюзов, которые списаны и больше не находятся в операциях. Эти IP-адреса можно безопасно удалить из правила брандмауэра для исходящего трафика. 


| **Имя региона** | **IP-адреса шлюза** |**IP-адреса шлюза (списание)** | **IP-адреса шлюза (списанные)** |
|:----------------|:-------------------------|:-------------------------------------------|:------------------------------------------|
| Центральная Австралия| 20.36.105.0  | | |
| Central2 Австралия     | 20.36.113.0  | | |
| Восточная Австралия | 13.75.149.87, 40.79.161.1     |  | |
| Юго-Восточная Австралия |191.239.192.109, 13.73.109.251   |  | |
| Brazil South |191.233.201.8, 191.233.200.16    |  | 104.41.11.5|
| Центральная Канада |40.85.224.249  | | |
| Восточная Канада | 40.86.226.166    | | |
| Центральная часть США | 23.99.160.139, 52.182.136.37, 52.182.136.38 | 13.67.215.62 | |
| Восточный Китай | 139.219.130.35    | | |
| Восточный Китай 2 | 40.73.82.1  | | |
| Северный Китай | 139.219.15.17    | | |
| Северный Китай 2 | 40.73.50.0     | | |
| Восточная Азия | 191.234.2.139, 52.175.33.150, 13.75.33.20, 13.75.33.21     | | |
| Восточная часть США |40.71.8.203, 40.71.83.113 |40.121.158.30|191.238.6.43 |
| восточная часть США 2 | 40.70.144.38, 52.167.105.38  | 52.177.185.181 | |
| Центральная Франция | 40.79.137.0, 40.79.129.1  | | |
| Южная Франция | 40.79.177.0     | | |
| Центральная Германия | 51.4.144.100     | | |
| Северо-восточная Германия | 51.5.144.179  | | |
| Центральная Индия | 104.211.96.159     | | |
| Южная Индия | 104.211.224.146  | | |
| Западная Индия | 104.211.160.80    | | |
| Japan East | 40.79.192.23 | 13.78.61.196 | |
| Западная Япония | 191.238.68.11, 40.74.96.6, 40.74.96.7     | 104.214.148.156 | |
| Республика Корея, центральный регион | 52.231.17.13   | 52.231.32.42 | |
| Республика Корея, южный регион | 52.231.145.3     | 52.231.200.86 | |
| Центрально-северная часть США | 52.162.104.35, 52.162.104.36    | 23.96.178.199 | |
| Северная Европа | 52.138.224.6, 52.138.224.7  | 40.113.93.91 |191.235.193.75 |
| Северная часть ЮАР;  | 102.133.152.0    | | |
| Западная часть ЮАР | 102.133.24.0   | | |
| Центрально-южная часть США |104.214.16.39, 20.45.120.0  |13.66.62.124  |23.98.162.75 |
| Юго-Восточная Азия | 40.78.233.2, 23.98.80.12     | 104.43.15.0 | |
| Центральная часть ОАЭ. | 20.37.72.64  | | |
| Северная часть ОАЭ; | 65.52.248.0    | | |
| южная часть Соединенного Королевства | 51.140.184.11   | | |
| западная часть Соединенного Королевства | 51.141.8.11  | | |
| центрально-западная часть США | 13.78.145.25     | | |
| Западная Европа |13.69.105.208, 104.40.169.187 | 40.68.37.158 | 191.237.232.75 |
| Западная часть США |13.86.216.212, 13.86.217.212 |104.42.238.205  | 23.99.34.75|
| Западная часть США 2 | 13.66.226.202  | | |
||||

## <a name="next-steps"></a>Дальнейшие действия

* [Создание правил брандмауэра базы данных Azure для PostgreSQL и управление ими с помощью портала Azure](./howto-manage-firewall-using-portal.md)
* [Создание правил брандмауэра базы данных Azure для PostgreSQL и управление ими с помощью Azure CLI](./howto-manage-firewall-using-cli.md)