---
title: Руководство. Общие сведения о криптографии и сертификатах X.509 для Центра Интернета вещей Azure | Документация Майкрософт
description: Руководство. Общие сведения о криптографии и PKI X.509 для Центра Интернета вещей Azure
author: v-gpettibone
manager: philmea
ms.service: iot-hub
services: iot-hub
ms.topic: tutorial
ms.date: 02/25/2021
ms.author: robinsh
ms.custom:
- mvc
- 'Role: Cloud Development'
- 'Role: Data Analytics'
ms.openlocfilehash: 2c375a02f534572826e1ebd6b8549e59f6e83640
ms.sourcegitcommit: 2654d8d7490720a05e5304bc9a7c2b41eb4ae007
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/13/2021
ms.locfileid: "107378386"
---
# <a name="tutorial-understanding-public-key-cryptography-and-x509-public-key-infrastructure"></a>Руководство. Общие сведения о шифровании с открытым ключом и инфраструктуре открытых ключей X.509

Вы можете использовать сертификаты X.509 для проверки подлинности устройств в Центре Интернета вещей Azure. Сертификат — это цифровой документ, который содержит открытый ключ устройства и может применяться для проверки того, является ли устройство тем, за кого себя выдает. Сертификаты X.509 и списки отзыва сертификатов (CRL) определены в [RFC 5280](https://tools.ietf.org/html/rfc5280). Но сертификаты — это лишь один из элементов инфраструктуры открытых ключей X.509 (PKI). Чтобы разобраться в PKI X.509, нужно иметь представление об алгоритмах шифрования, криптографических ключах, сертификатах и центрах сертификации (ЦС).

* **Алгоритмы** определяют правила преобразования исходных данных в формате открытого текста в зашифрованные данные и обратно.
* **Ключи** содержат случайные и псевдослучайные строки данных, используемые в качестве входных данных для этих алгоритмов.
* **Сертификаты** — это цифровые документы, которые содержат открытый ключ сущности и позволяют определить, действительно ли субъект сертификата является той сущностью, за которую себя выдает.
* **Центры сертификации** подтверждают подлинность субъектов сертификата.

Сертификат можно приобрести в центре сертификации (ЦС). Для разработки и тестирования или при работе в полностью автономной среде вы можете создать самозаверяющий корневой ЦС. Например, если вы настраиваете проверку подлинности в центре Интернета вещей для работы с одним или несколькими устройствами, вы можете создать самозаверяющий корневой ЦС, чтобы выпускать сертификаты для устройств. Также можно выпускать самозаверяющие сертификаты устройств. Это обсуждается в следующих статьях серии.

Прежде чем описывать сертификаты X.509 и о способы их применения для проверки подлинности в Центре Интернета вещей, мы рассмотрим базовую концепцию криптографии.

## <a name="cryptography"></a>Шифрование

Криптография широко применяется для защиты информации и обмена данными. Типичные методы криптографии включают преобразование обычного (открытого) текста в закодированные (зашифрованные) данные и обратно. Этот процесс преобразования называется шифрованием. Обратный процесс называется расшифровкой. Задачи криптографии заключаются в обеспечении следующих аспектов:

* **Конфиденциальность** — информация должна быть понятна только для целевой аудитории.
* **Целостность** — информация не должна изменяться при хранении или передаче.
* **Неотрекаемость** — создатель информации не может впоследствии отказаться от своего авторства.
* **Проверка подлинности** — как отправитель, так и получатель могут идентифицировать друг друга.

## <a name="encryption"></a>Шифрование

Для шифрования требуются алгоритм и ключ. Алгоритм определяет, как выполняется преобразование открытого текста в зашифрованные данные и обратно. Ключ содержит случайную строку данных, которая передается в качестве входных данных алгоритму. Этот ключ обеспечивает безопасность всего процесса. Это означает, что ключ важно надежно хранить. При этом сведения о популярных алгоритмах шифрования находятся в открытом доступе.

Есть два типа шифрования. Симметричное шифрование подразумевает использование одного и того же ключа для шифрования и расшифровки. Асимметричное шифрование подразумевает использование для шифрования и расшифровки разных, но математически связанных ключей.

### <a name="symmetric-encryption"></a>Симметричное шифрование

При симметричном шифровании один и тот же ключ применяется как для шифрования открытого текста в зашифрованные данные, так и для расшифровки текста. Длина ключа, выраженная в количестве битов, определяется алгоритмом. После применения ключа для шифрования открытого текста полученный результат отправляется получателю, который выполняет расшифровку. Для этого получателю необходимо передать симметричный ключ. При использовании симметричных алгоритмов наибольшим риском безопасности является именно отправка ключа.

![Пример симметричного шифрования](media/tutorial-x509-introduction/symmetric-keys.png)

### <a name="asymmetric-encryption"></a>Асимметричное шифрование

Если используется только симметричное шифрование, проблема заключается в том, что всем участникам обмена данными должен быть предоставлен закрытый ключ. При этом есть вероятность того, что неполномочные лица перехватят этот ключ в процессе его передачи полномочным пользователям. Для устранения этой проблемы следует использовать асимметричное шифрование с открытым ключом.

При этом каждый пользователь получает пару математически связанных ключей. Один из этих ключей является открытым, а второй — закрытым. Использование такой пары ключей гарантирует, что у получателя всегда будет доступ к открытому ключу для расшифровки данных. На следующей иллюстрации показана схема асимметричного шифрования.

![Пример асимметричного шифрования](media/tutorial-x509-introduction/asymmetric-keys.png)

1. Получатель создает пару открытого и закрытого ключей, а затем отсылает открытый ключ в ЦС. ЦС помещает этот открытый ключ в сертификат X.509.

1. Отправляющая сторона извлекает открытый ключ получателя из этого ЦС.

1. Отправитель шифрует данные из открытого текста, используя алгоритм шифрования. Для шифрования применяется открытый ключ получателя.

1. Затем отправитель передает зашифрованные данные получателю. Отправлять ключ не нужно, так как у получателя уже есть закрытый ключ, требуемый для расшифровки.

1. Получатель расшифровывает сообщение в открытый текст, используя указанный отправителем асимметричный алгоритм и свой закрытый ключ.

### <a name="combining-symmetric-and-asymmetric-encryption"></a>Сочетание симметричного и асимметричного шифрования

Вы можете комбинировать симметричное и асимметричное шифрование, чтобы получить преимущества обоих подходов. Симметричное шифрование выполняется намного быстрее, но является менее безопасным из-за необходимости отправлять закрытые ключи другим лицам. Чтобы объединить эти два типа, открытый текст преобразуется в зашифрованные данные с использованием симметричного шифрования. А симметричный ключ шифруется с использованием асимметричного шифрования. Этот процесс показан на следующей схеме.

![Симметричное и асимметричное шифрование](media/tutorial-x509-introduction/symmetric-asymmetric-encryption.png)

1. Отправитель получает открытый ключ получателя.

1. Отправитель создает симметричный ключ и применяет его для шифрования исходных данных.

1. Отправитель шифрует сам симметричный ключ с помощью открытого ключа получателя.

1. Отправитель передает зашифрованный симметричный ключ и зашифрованные данные получателю.

1. Получатель применяет свой закрытый ключ, который соответствует его же открытому ключу, чтобы расшифровать симметричный ключ отправителя.

1. Получатель применяет этот симметричный ключ для расшифровки зашифрованного текста.

### <a name="asymmetric-signing"></a>Асимметричное подписывание

Асимметричные алгоритмы помогают защищать данные от изменения и подтверждать личность создателя данных. На следующей иллюстрации показано, как асимметричное подписывание позволяет подтвердить личность отправителя.

![Пример асимметричного подписывания](media/tutorial-x509-introduction/asymmetric-signing.png)

1. Отправитель пропускает данные в открытом тексте через алгоритм асимметричного шифрования, применяя закрытый ключ. Обратите внимание, что этот сценарий является обратным тому, который мы описывали в предыдущем разделе, где открытый и закрытый ключи использовались для асимметричного шифрования.

1. Полученные зашифрованные данные отправляются получателю.

1. Получатель извлекает из каталога открытый ключ отправителя.

1. Получатель расшифровывает зашифрованные данные, применяя открытый ключ отправителя. Полученный открытый текст подтверждает личность отправителя, так как только отправитель имеет доступ к закрытому ключу, который применялся для шифрования исходного текста.

## <a name="signing"></a>Сертификат для подписи маркера

Цифровое подписывание позволяет определить, изменялись ли данные при хранении или передаче. Данные пропускаются через односторонний хэш-алгоритм, который возвращает для сообщения математическое значение. Этот результат называется *значением хэша*, *хэш-кодом*, *хэшем*, *сигнатурой* или *отпечатком*. Из этого значения невозможно восстановить исходное сообщение. Так как любое минимальное изменение в исходном сообщении приводит к значительному изменению *отпечатка*, такой хэш-код можно использовать для проверки того, изменялось ли сообщение. На следующей иллюстрации показано применение асимметричного шифрования и хэш-алгоритмов для проверки того, что сообщение не изменялось.

![Пример подписывания](media/tutorial-x509-introduction/signing.png)

1. Отправитель создает сообщение в формате открытого текста.

1. Отправитель хэширует это сообщение, получая хэш-код.

1. Отправитель шифрует хэш-код, применяя закрытый ключ.

1. Отправитель передает сообщение в формате открытого текста и зашифрованный хэш-код получателю.

1. Получатель расшифровывает хэш-код, используя применяя открытый ключ отправителя.

1. Получатель выполняет тот же хэш-алгоритм с сообщением, который использовал отправитель.

1. Получатель сравнивает полученную при хэшировании сигнатуру с расшифрованным значением. Если эти хэш-коды совпадают, значит сообщение не изменялось при передаче.

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения о полях, входящих в сертификат, см. в статье [Общие сведения о сертификатах X.509 с открытым ключом](tutorial-x509-certificates.md).

Если вы уже разбираетесь в сертификатах X.509 и готовы создавать тестовые версии для проверки подлинности в Центре Интернета вещей, переходите к следующим руководствам:

* [Использование скриптов, предоставляемых корпорацией Майкрософт для создания тестовых сертификатов](tutorial-x509-scripts.md)
* [Использование OpenSSL для создания тестовых сертификатов](tutorial-x509-openssl.md)
* [Использование OpenSSL для создания самозаверяющих тестовых сертификатов](tutorial-x509-self-sign.md)

Если у вас есть сертификат корневого или подчиненного центра сертификации (ЦС), который вы хотите отправить в центр Интернета вещей и подтвердить права владения, см. руководство [Подтверждение принадлежности сертификата ЦС](tutorial-x509-prove-possession.md).
