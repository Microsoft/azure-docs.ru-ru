---
title: Общие сведения о безопасности при использовании ЦС X.509 Центра Интернета вещей | Документация Майкрософт
description: 'Обзор: проверка подлинности устройств в Центре Интернета вещей с помощью центров сертификации X.509.'
author: eustacea
manager: arjmands
ms.service: iot-hub
services: iot-hub
ms.topic: conceptual
ms.date: 09/18/2017
ms.author: eustacea
ms.custom:
- 'Role: Cloud Development'
- 'Role: IoT Device'
- 'Role: System Architecture'
ms.openlocfilehash: 455f1f3e1c8181646fbe165d0f1aea6a2fb2fb13
ms.sourcegitcommit: 772eb9c6684dd4864e0ba507945a83e48b8c16f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "92150705"
---
# <a name="device-authentication-using-x509-ca-certificates"></a>Проверка подлинности устройства с помощью сертификатов ЦС X.509

В этой статье описано использование сертификатов центра сертификации X.509 для проверки подлинности устройств, которые подключаются к Центру Интернета вещей.  В этой статье мы затронем следующие вопросы:

* Как получить сертификат ЦС X.509
* Как зарегистрировать сертификат ЦС X.509 в Центре Интернета вещей
* подпись устройств с помощью сертификата ЦС X.509;
* способ проверки подлинности устройств, подписанных центром сертификации X.509.

[!INCLUDE [iot-hub-include-x509-ca-signed-support-note](../../includes/iot-hub-include-x509-ca-signed-support-note.md)]

## <a name="overview"></a>Обзор

Возможность использования ЦС X.509 позволяет выполнять проверку подлинности устройства в Центре Интернета вещей с помощью центра сертификации (ЦС). Это значительно упрощает процесс регистрации устройств и логистику цепочки поставок во время изготовления устройства. Дополнительные сведения об использовании сертификатов ЦС X.509 для проверки подлинности устройств см. в статье [Conceptual understanding of X.509 CA certificates in the IoT industry](iot-hub-x509ca-concept.md) (Общие сведения о сертификатах ЦС X.509 в Центре Интернета вещей).  Мы рекомендуем ознакомиться с этой статьей, прежде чем продолжить, так как в ней объясняется, почему существуют описанные ниже шаги.

## <a name="prerequisite"></a>Предварительное требование

Чтобы использовать возможность ЦС X.509, требуется учетная запись Центра Интернета вещей.  [Узнайте, как создать экземпляр Центра Интернета вещей](quickstart-send-telemetry-dotnet.md), если он еще не создан.

## <a name="how-to-get-an-x509-ca-certificate"></a>Как получить сертификат ЦС X.509

Сертификат ЦС X.509 находится в верхней части цепочки сертификатов для каждого из устройств.  Его можно приобрести или создать в зависимости от того, как вы планируете его использовать.

Для рабочей среды рекомендуется приобрести сертификат ЦС X.509 у общедоступного корневого центра сертификации. Приобретение сертификата ЦС имеет преимущество — корневой ЦС выступает в качестве доверенной третьей стороны для подтверждения легитимности ваших устройств. Рекомендуется использовать этот вариант, если устройства будут частью открытой сети Центра Интернета вещей, в которой они будут взаимодействовать со сторонними продуктами или службами.

Можно также создать самозаверяющийся сертификат ЦС X.509 для экспериментов или использования в закрытых сетях Центра Интернета вещей.

Независимо от того, как вы получаете сертификат ЦС X. 509, обязательно сохраните его секрет и защищенный закрытый ключ.  Это необходимо для создания отношений доверия при проверке подлинности на основе ЦС X.509.

Узнайте, как создать [самозаверяющийся сертификат ЦС](https://github.com/Azure/azure-iot-sdk-c/blob/master/tools/CACertificates/CACertificateOverview.md), который можно использовать для экспериментов, приведенных в описании этой возможности.

## <a name="sign-devices-into-the-certificate-chain-of-trust"></a>Подпись устройств в цепочке доверия сертификатов

Владелец сертификата ЦС X.509 может криптографически подписать промежуточной ЦС, который, в свою очередь, может подписать другой промежуточный ЦС и т. д. до последнего промежуточного ЦС, который завершает этот процесс, подписывая устройство. Результатом является каскадная цепочка сертификатов, известная как цепочка доверия сертификатов. В реальной жизни это работает как делегирование доверия устройствам подписи. Это делегирование важно, так как оно устанавливает криптографически переменную цепочку поставок и позволяет избежать совместного использования ключей подписи.

![img-generic-cert-chain-of-trust](./media/generic-cert-chain-of-trust.png)

Сертификат устройства (также называемый конечным сертификатом) должен иметь  **идентификатор устройства** ( `CN=deviceId` ), который использовался при регистрации устройства IOT в центре Интернета вещей Azure. Этот параметр требуется для проверки подлинности.

Узнайте, как [создать цепочку сертификатов](https://github.com/Azure/azure-iot-sdk-c/blob/master/tools/CACertificates/CACertificateOverview.md), как это было сделано при подписи устройств.

## <a name="how-to-register-the-x509-ca-certificate-to-iot-hub"></a>Как зарегистрировать сертификат ЦС X.509 в Центре Интернета вещей

Зарегистрируйте сертификат ЦС X.509 в Центре Интернета вещей, где он будет использоваться для проверки подлинности устройств во время регистрации и подключения.  Регистрация сертификата ЦС X.509 — это двухэтапный процесс, который включает передачу сертификата и подтверждение владения им.

Процесс отправки подразумевает отправку файла, содержащего сертификат.  Этот файл не должен содержать какие-либо закрытые ключи.

Шаг подтверждения владения включает в себя криптографический запрос и ответ между вами и Центром Интернета вещей.  Учитывая, что содержимое цифрового сертификата является общедоступным и поэтому уязвимо для перехвата, Центру Интернета вещей нужно убедиться, что вы действительно владеете сертификатом ЦС.  Это можно сделать путем формирования случайных запросов, которые необходимо подписать с помощью соответствующего закрытого ключа сертификата ЦС.  Если секрет закрытого ключа был сохранен и защищен, как мы советовали ранее, то только вы сможете завершить этот шаг. Секретность закрытых ключей выступает источником доверия в этом методе.  После подписания запроса выполните этот шаг, отправив файл, содержащий результаты.

Узнайте, как [зарегистрировать сертификат ЦС](iot-hub-security-x509-get-started.md#register-x509-ca-certificates-to-your-iot-hub)

## <a name="how-to-create-a-device-on-iot-hub"></a>Как создать устройство в Центре Интернета вещей

Чтобы исключить олицетворение устройства, Центр Интернета вещей требует, чтобы вы знали, какие устройства ожидать.  Для этого необходимо создать запись устройства в реестре устройств Центра Интернета вещей.  При использовании [Службы подготовки устройств](https://azure.microsoft.com/blog/azure-iot-hub-device-provisioning-service-preview-automates-device-connection-configuration/) Центра Интернета вещей этот процесс выполняется автоматически. 

Дополнительные сведения о создании устройства в Центре Интернета вещей вручную см. в [этой статье](iot-hub-security-x509-get-started.md#create-an-x509-device-for-your-iot-hub).

Создание устройства X.509 для Центра Интернета вещей

## <a name="authenticating-devices-signed-with-x509-ca-certificates"></a>Проверка подлинности устройств, подписанных с помощью сертификатов ЦС X.509

Когда сертификат ЦС X.509 зарегистрирован и устройства входят в цепочку доверия сертификатов, остается только проверка подлинности устройства при подключении, даже при первом.  При подключении подписанного сертификатом ЦС X.509 устройства оно отправляет свою цепочку сертификатов для проверки. Цепочка включает все промежуточные сертификаты ЦС и сертификаты устройств.  С помощью этой информации Центр Интернета вещей выполняет проверку подлинности устройства в два этапа.  Центр Интернета вещей криптографически проверяет цепочку сертификатов на внутреннюю согласованность, а затем выдает подтверждение владения устройству.  Центр Интернета вещей объявляет устройство подлинным при успешном ответе на запрос подтверждения владения от устройства.  Это объявление предполагает, что закрытый ключ устройства защищен и что только устройство может успешно ответить на этот запрос.  Мы советуем использовать безопасные микросхемы, такие как аппаратные модули безопасности (HSM), на устройствах для защиты закрытых ключей.

Успешное подключение устройства к Центру Интернета вещей завершает процесс проверки подлинности и является индикатором надлежащей настройки.

Дополнительные сведения о завершении подключения устройства см. в [этой статье](iot-hub-security-x509-get-started.md#authenticate-your-x509-device-with-the-x509-certificates).

## <a name="next-steps"></a>Дальнейшие действия

Узнайте о [значении проверки подлинности на основе ЦС X.509 в Центре Интернета вещей](iot-hub-x509ca-concept.md).

Приступите к работе со [службой подготовки устройств](../iot-dps/index.yml) Центра Интернета вещей.