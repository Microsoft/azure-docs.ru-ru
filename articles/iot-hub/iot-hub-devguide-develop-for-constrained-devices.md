---
title: Разработка центра Интернета вещей Azure для ограниченных устройств с помощью пакета SDK для центра Интернета вещей C
description: Руководство разработчика. Сведения о разработке приложений для устройств с ограниченным ресурсами с помощью пакетов SDK для Azure IoT.
author: robinsh
ms.service: iot-hub
services: iot-hub
ms.topic: conceptual
ms.date: 05/24/2018
ms.author: robinsh
ms.custom:
- amqp
- mqtt
ms.openlocfilehash: 5a43eb2537ebc09ffcb524a4426d7a8c9bec560b
ms.sourcegitcommit: 910a1a38711966cb171050db245fc3b22abc8c5f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "96500008"
---
# <a name="develop-for-constrained-devices-using-azure-iot-c-sdk"></a>Разработка устройств с ограниченными ресурсами с помощью пакета SDK Azure IoT для C

Пакет SDK для Центра Интернета вещей для C написан в соответствии со стандартом ANSI C (C99), благодаря чему он подходит для использования с разными платформами с низким объемом памяти и маленьким размером диска. Рекомендуемый объем ОЗУ составляет 64 КБ, но точный объем памяти зависит от используемого протокола, количества открытых подключений и целевой платформы.
> [!NOTE]
> * Пакет Azure IoT C SDK регулярно публикует сведения о потреблении ресурсов, чтобы помочь в разработке.  Посетите наш [репозиторий GitHub](https://github.com/Azure/azure-iot-sdk-c/blob/master/doc/c_sdk_resource_information.md) и просмотрите последнюю версию теста производительности.
>

SDK для C доступен в форме пакета от apt-get, NuGet и MBED. Чтобы создавать приложения для устройств с ограниченным ресурсами, вы, возможно, захотите выполнить сборку пакета SDK локально для целевой платформы. В этой статье описано, как с помощью средства [CMake](https://cmake.org/) удалить некоторые компоненты, чтобы сжать пакет SDK для C. Кроме того, здесь рассматриваются рекомендованные модели программирования, с которыми следует работать на устройствах с ограниченными ресурсами.

## <a name="building-the-c-sdk-for-constrained-devices"></a>Сборка пакета SDK для C для устройств с ограниченными ресурсами

Создайте пакет SDK для C для устройств с ограниченными ресурсами.

> [!NOTE]
> Встроенный пакет C SDK — это альтернатива ограниченным устройствам, поддерживающим подход "использовать собственную сеть" (БЙОН). Разработчики Интернета вещей имеют свободу выбора клиента MQTT, TLS и сокетов для создания решения устройства. Дополнительные [сведения о встроенном пакете C SDK](https://github.com/Azure/azure-sdk-for-c/tree/master/sdk/docs/iot).

### <a name="prerequisites"></a>Предварительные условия

Чтобы подготовить среду разработки к сборке пакета SDK для C, следуйте указаниям из этого [руководства по настройке пакета SDK для C](https://github.com/Azure/azure-iot-sdk-c/blob/master/doc/devbox_setup.md). До перехода к шагу сборки с помощью CMake вы можете вызвать флаги CMake и удалить неиспользуемые компоненты.

### <a name="remove-additional-protocol-libraries"></a>Удаление дополнительных библиотек протоколов

Пакет SDK для C поддерживает пять протоколов: MQTT, MQTT через WebSocket, AMQPS, AMQP через WebSocket и HTTPS. В большинстве случаев в клиенте требуется один или несколько протоколов, поэтому вы можете удалить из пакета SDK неиспользуемую библиотеку протокола. Дополнительные сведения о выборе соответствующего протокола связи см. в статье [Справочник — выбор протокола связи](iot-hub-devguide-protocols.md). Например, MQTT — это упрощенный протокол, который лучше подходит для устройств с ограниченными ресурсами.

Вы можете удалить библиотеки AMQP и HTTP с помощью следующей команды CMake:

```
cmake -Duse_amqp=OFF -Duse_http=OFF <Path_to_cmake>
```

### <a name="remove-sdk-logging-capability"></a>Удаление возможности ведения журналов пакета SDK

Пакет SDK для C предоставляет журнал с подробными сведениями, что помогает в процессе отладки. Вы можете удалить возможность ведения журналов рабочих устройств с помощью следующей команды CMake:

```
cmake -Dno_logging=OFF <Path_to_cmake>
```

### <a name="remove-upload-to-blob-capability"></a>Удаление возможности отправки в хранилище BLOB-объектов

Большие файлы можно передавать в службу хранилища Azure с помощью встроенной в пакет SDK возможности. Центр Интернета вещей Azure выступает в качестве диспетчера связанной учетной записи хранения Azure. С помощью этой функции вы можете отправлять файлы мультимедиа, большие пакеты данных телеметрии и журналы. Дополнительные сведения см. в статье [Отправка файлов с помощью Центра Интернета вещей](iot-hub-devguide-file-upload.md). Если приложению не требуется такая функциональная возможность, вы можете удалить ее с помощью следующей команды CMake:

```
cmake -Ddont_use_uploadtoblob=ON <Path_to_cmake>
```

### <a name="running-strip-on-linux-environment"></a>Выполнение команды strip в среде Linux

Если в системе Linux выполняются двоичные файлы, вы можете уменьшить размер окончательного приложения после компиляции с помощью [команды strip](https://en.wikipedia.org/wiki/Strip_(Unix)).

```
strip -s <Path_to_executable>
```

## <a name="programming-models-for-constrained-devices"></a>Модели программирования для устройств с ограниченными ресурсами

Затем просмотрите модели программирования для устройств с ограниченными ресурсами

### <a name="avoid-using-the-serializer"></a>Избегайте использования сериализатора

Пакет SDK для C имеет дополнительный [сериализатор](https://github.com/Azure/azure-iot-sdk-c/tree/master/serializer), позволяющий с помощью декларативных таблиц сопоставления определять методы и свойства двойника устройства. Этот сериализатор упрощает разработку, но он создает нагрузку, которая не подходит для устройств с ограниченными ресурсами. В этом случае рекомендуется использовать примитивные клиентские API-интерфейсы и анализировать JSON с помощью упрощенного средства синтаксического анализа, такого как [Parson](https://github.com/kgabis/parson).

### <a name="use-the-lower-layer-_ll_"></a>Используйте более низкий слой (_LL_)

Пакет SDK для C поддерживает две модели программирования. Один набор имеет интерфейсы API с инфиксным индексом _LL_, который означает более низкий слой. Этот набор API-интерфейсов более простой и не запускает рабочие потоки, что означает, что пользователь должен вручную управлять планированием. Например, API-интерфейсы с инфиксным оператором _LL_ для клиента устройства можно найти в этом [файле заголовка](https://github.com/Azure/azure-iot-sdk-c/blob/master/iothub_client/inc/iothub_device_client_ll.h). 

Другой набор API-интерфейсов без индекса _LL_ называется удобным слоем, на котором автоматически запускается рабочий поток. Например, API-интерфейсы удобного слоя для клиента устройства можно найти в этом [файле заголовка клиентского пакета для устройств Интернета вещей](https://github.com/Azure/azure-iot-sdk-c/blob/master/iothub_client/inc/iothub_device_client.h). Для устройств с ограниченными ресурсами, на которых поток может потреблять значительный объем системных ресурсов, советуем использовать API-интерфейсы с индексом _LL_.

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения об архитектуре пакетов SDK для Azure IoT для C см. в следующих источниках:
-    [Исходный код пакета SDK для Интернета вещей Azure для C](https://github.com/Azure/azure-iot-sdk-c/)
-    [Пакет SDK для устройств Azure IoT для C](iot-hub-device-sdk-c-intro.md)
