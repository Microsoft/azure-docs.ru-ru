---
title: Справочник по API для центра Интернета вещей Azure MQTT 5 (Предварительная версия)
description: Сведения о справочнике по API MQTT 5 центра Интернета вещей
services: iot-hub
author: jlian
ms.service: iot-fundamentals
ms.topic: reference
ms.date: 11/19/2020
ms.author: jlian
ms.openlocfilehash: 5f0af7d6bf16a05fad1ca9df5db1729abd088010
ms.sourcegitcommit: 867cb1b7a1f3a1f0b427282c648d411d0ca4f81f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "96603562"
---
# <a name="iot-hub-data-plane-mqtt-5-api-reference"></a>Справочник по API для плоскости данных центра Интернета вещей MQTT 5

Этот документ определяет операции, доступные в версии 2,0 (API-Version: `2020-10-01-preview` ) API плоскости данных центра Интернета вещей.

## <a name="operations"></a>Операции

### <a name="get-twin"></a>Получить двойника

Получение состояния двойника

#### <a name="request"></a>Запрос

**Имя раздела:**`$iothub/twin/get`

**Свойства**: нет

**Полезные данные**: пустые

#### <a name="success-response"></a>Успешный ответ

**Свойства**: нет

**Полезные данные**: двойника

#### <a name="alternative-responses"></a>Альтернативные ответы

| Состояние | Имя | Описание |
| :----- | :--- | :---------- |
| 0100 |  Ошибка запроса | Сообщение операции имеет неправильный формат и не может быть обработано. |
| 0101 |  Не санкционировано | У клиента нет разрешений на выполнение этой операции. |
| 0102 |  Не разрешено | Операция не разрешена. |
| 0501 |  Ожидает повтора | слишком высокая частота запросов на номер SKU |
| 0502 |  Превышена квота | превышена дневная квота на текущий номер SKU |
| 0601 |  Ошибка сервера | Внутренняя ошибка сервера |
| 0602 |  Время ожидания | время ожидания операции истекло до ее завершения |
| 0603 |  Сервер занят | сервер занят |

#### <a name="pseudo-code-sample"></a>Пример псевдо-кода

```

-> PUBLISH
    QoS: 0
    Topic: $iothub/twin/get
<- PUBLISH
    QoS: 0
    Topic: $iothub/responses

```

### <a name="patch-twin-reported"></a>Отчет о двойника исправлений

Состояние двойника исправлений

#### <a name="request"></a>Запрос

**Имя раздела:**`$iothub/twin/patch/reported`

**Свойства**:

| Имя | Type | Обязательно | Описание |
| :--- | :--- | :------- | :---------- |
| If-Version | u64 | Нет |  |

**Полезные данные**: твинстате

#### <a name="success-response"></a>Успешный ответ

**Свойства**:

| Имя | Type | Обязательно | Описание |
| :--- | :--- | :------- | :---------- |
| version | u64 | да | Версия сообщаемого состояния после применения исправления |

**Полезные данные**: пустые

#### <a name="alternative-responses"></a>Альтернативные ответы

| Состояние | Имя | Описание |
| :----- | :--- | :---------- |
| 0104 |  Необходимое условие не выполнено | предусловие не выполнено, что привело к отмене запроса |
| 0100 |  Ошибка запроса | Сообщение операции имеет неправильный формат и не может быть обработано. |
| 0101 |  Не санкционировано | У клиента нет разрешений на выполнение этой операции. |
| 0102 |  Не разрешено | Операция не разрешена. |
| 0501 |  Ожидает повтора | слишком высокая частота запросов на номер SKU |
| 0502 |  Превышена квота | превышена дневная квота на текущий номер SKU |
| 0601 |  Ошибка сервера | Внутренняя ошибка сервера |
| 0602 |  Время ожидания | время ожидания операции истекло до ее завершения |
| 0603 |  Сервер занят | сервер занят |

#### <a name="pseudo-code-sample"></a>Пример псевдо-кода

```

-> PUBLISH
    QoS: 0
    Topic: $iothub/twin/patch/reported
    [if-version: <u64>]
<- PUBLISH
    QoS: 0
    Topic: $iothub/responses

```

### <a name="receive-commands"></a>Команды Receive

Команды получения и обработки

#### <a name="message"></a>Сообщение

**Имя раздела:**`$iothub/commands`

**Свойства**:

| Имя | Type | Обязательно | Описание |
| :--- | :--- | :------- | :---------- |
| Sequence — нет | u64 | да | Порядковый номер сообщения |
| время в очереди | time | да | Метка времени, когда сообщение поступило в систему |
| delivery-count | u32 | да | Количество попыток доставки сообщения |
| creation-time | time | Нет | Метка времени создания сообщения (предоставляется отправителем) |
| message-id | строка | Нет | Удостоверение сообщения (предоставляется отправителем) |
| user-id | строка | Нет | Удостоверение пользователя (предоставляется отправителем) |
| correlation-id | строка | Нет | Удостоверение корреляции (предоставляется отправителем) |
| Тип содержимого | строка | Нет | Определяет тип содержимого полезных данных |
| content-encoding | строка | Нет | Определяет кодировку содержимого полезных данных |

**Полезные данные**: любая последовательность байтов

#### <a name="success-acknowledgment"></a>Подтверждение успеха

Показывает, что команда была принята для обработки клиентом

**Свойства**: нет

**Полезные данные**: пустые

#### <a name="alternative-acknowledgments"></a>Альтернативные подтверждения

| Код причины | Состояние | Имя | Описание |
| :---------- | :----- | :--- | :---------- |
| 131 | 0603 | Abandon | Указывает, что команда не будет обработана в данный момент и должна быть повторно доставлена в будущем. |
| 131 | 0100 | Reject | Указывает, что команда отклонена клиентом, и ее не следует пытаться снова. |

#### <a name="pseudo-code-sample"></a>Пример псевдо-кода

```

-> SUBSCRIBE
    - Topic: $iothub/commands
      QoS: 1
<- PUBLISH
    QoS: 1
    Topic: $iothub/commands
    sequence-no: <u64>enqueued-time: <time>delivery-count: <u32>[creation-time: <time>][message-id: <string>][user-id: <string>][correlation-id: <string>][Content Type: <string>][content-encoding: <string>]
    Payload: ...

-> PUBACK

```

### <a name="receive-direct-methods"></a>Получить прямые методы

Получение и обработку вызовов прямых методов

#### <a name="request"></a>Запрос

**Имя раздела:**`$iothub/methods/{name}`

**Свойства**: нет

**Полезные данные**: любая последовательность байтов

#### <a name="success-response"></a>Успешный ответ

**Свойства**:

| Имя | Type | Обязательно | Описание |
| :--- | :--- | :------- | :---------- |
| код ответа | u32 | да |  |

**Полезные данные**: любая последовательность байтов

#### <a name="alternative-responses"></a>Альтернативные ответы

| Состояние | Имя | Описание |
| :----- | :--- | :---------- |
| 06A0 |  Недоступно | Указывает, что клиент недоступен через это подключение. |

#### <a name="pseudo-code-sample"></a>Пример псевдо-кода

```

-> SUBSCRIBE
    - Topic: methods/{name}
      QoS: 0
<- SUBACK
<- PUBLISH
    QoS: 0
    Topic: $iothub/methods/{name}
-> PUBLISH
    QoS: 0
    Topic: $iothub/responses

```

### <a name="receive-twin-desired-state-changes"></a>Получение изменений требуемого состояния двойника

Получение обновлений для желаемого состояния двойника

#### <a name="message"></a>Сообщение

**Имя раздела:**`$iothub/twin/patch/desired`

**Свойства**:

| Имя | Type | Обязательно | Описание |
| :--- | :--- | :------- | :---------- |
| version | u64 | да | Версия требуемого состояния, соответствующая этому обновлению |

**Полезные данные**: твинстате

#### <a name="pseudo-code-sample"></a>Пример псевдо-кода

```

-> SUBSCRIBE
    - Topic: $iothub/twin/patch/desired
      QoS: 0
<- PUBLISH
    QoS: 0
    Topic: $iothub/twin/patch/desired
    version: <u64>
    Payload: ...

```

### <a name="send-telemetry"></a>Отправить телеметрию

Отправить сообщение в канал телеметрии — EventHubs по умолчанию или другую конечную точку через конфигурацию маршрутизации.

#### <a name="message"></a>Сообщение

**Имя раздела:**`$iothub/telemetry`

**Свойства**:

| Имя | Type | Обязательно | Описание |
| :--- | :--- | :------- | :---------- |
| Тип содержимого | строка | Нет | Преобразует в `content-type` системное свойство в отправленном сообщении |
| content-encoding | строка | Нет | Преобразует в `content-encoding` системное свойство в отправленном сообщении |
| message-id | строка | Нет | Преобразует в `message-id` системное свойство в отправленном сообщении |
| user-id | строка | Нет | Преобразует в `user-id` системное свойство в отправленном сообщении |
| correlation-id | строка | Нет | Преобразует в `correlation-id` системное свойство в отправленном сообщении |
| creation-time | time | Нет | Преобразует в `iothub-creation-time-utc` свойство отправленного сообщения |

**Полезные данные**: любая последовательность байтов

#### <a name="success-acknowledgment"></a>Подтверждение успеха

Сообщение успешно Опубликовано в канал телеметрии

**Свойства**: нет

**Полезные данные**: пустые

#### <a name="alternative-acknowledgments"></a>Альтернативные подтверждения

| Код причины | Состояние | Имя | Описание |
| :---------- | :----- | :--- | :---------- |
| 131 | 0100 | Ошибка запроса | Сообщение операции имеет неправильный формат и не может быть обработано. |
| 135 | 0101 | Не санкционировано | У клиента нет разрешений на выполнение этой операции. |
| 131 | 0102 | Не разрешено | Операция не разрешена. |
| 131 | 0601 | Ошибка сервера | Внутренняя ошибка сервера |
| 151 | 0501 | Ожидает повтора | слишком высокая частота запросов на номер SKU |
| 151 | 0502 | Превышена квота | превышена дневная квота на текущий номер SKU |
| 131 | 0602 | Время ожидания | время ожидания операции истекло до ее завершения |
| 131 | 0603 | Сервер занят | сервер занят |

#### <a name="pseudo-code-sample"></a>Пример псевдо-кода

```
-> PUBLISH
    QoS: 1
    Topic: $iothub/telemetry
    [Content Type: <string>]
    [content-encoding: <string>]
    [message-id: <string>]
    [user-id: <string>]
    [correlation-id: <string>]
    [creation-time: <time>]

<- PUBACK

```

## <a name="responses"></a>Ответы

### <a name="bad-request"></a>Ошибка запроса

Сообщение операции имеет неправильный формат и не может быть обработано.

**Код причины:**`131`

**Состояние:**`0100`

**Свойства**:

| Имя | Type | Обязательно | Описание |
| :--- | :--- | :------- | :---------- |
| reason | строка | Нет | содержит сведения о том, что конкретно не является допустимым сообщением |

**Полезные данные**: пустые

### <a name="conflict"></a>Conflict

Операция конфликтует с другой текущей операцией.

**Код причины:**`131`

**Состояние:**`0103`

**Свойства**:

| Имя | Type | Обязательно | Описание |
| :--- | :--- | :------- | :---------- |
| Идентификатор трассировки | строка | Нет | Идентификатор трассировки для корреляции с дополнительной диагностикой для ошибки |
| reason | строка | Нет | содержит сведения о том, что конкретно не является допустимым сообщением |

**Полезные данные**: пустые

### <a name="not-allowed"></a>Не разрешено

Операция не разрешена.

**Код причины:**`131`

**Состояние:**`0102`

**Свойства**:

| Имя | Type | Обязательно | Описание |
| :--- | :--- | :------- | :---------- |
| reason | строка | Нет | содержит сведения о том, что конкретно не является допустимым сообщением |

**Полезные данные**: пустые

### <a name="not-authorized"></a>Не санкционировано

У клиента нет разрешений на выполнение этой операции.

**Код причины:**`135`

**Состояние:**`0101`

**Свойства**:

| Имя | Type | Обязательно | Описание |
| :--- | :--- | :------- | :---------- |
| Идентификатор трассировки | строка | Нет | Идентификатор трассировки для корреляции с дополнительной диагностикой для ошибки |

**Полезные данные**: пустые

### <a name="not-found"></a>Не найдено

запрошенный ресурс не существует

**Код причины:**`131`

**Состояние:**`0504`

**Свойства**:

| Имя | Type | Обязательно | Описание |
| :--- | :--- | :------- | :---------- |
| reason | строка | Нет | содержит сведения о том, что конкретно не является допустимым сообщением |

**Полезные данные**: пустые

### <a name="not-modified"></a>Не изменено

Ресурс не был изменен на основе предоставленного предусловия.

**Код причины:**`0`

**Состояние:**`0001`

**Свойства**: нет

**Полезные данные**: пустые

### <a name="precondition-failed"></a>Необходимое условие не выполнено

Предусловие не выполнено, что привело к отмене запроса

**Код причины:**`131`

**Состояние:**`0104`

**Свойства**: нет

**Полезные данные**: пустые

### <a name="quota-exceeded"></a>Превышена квота

превышена дневная квота на текущий номер SKU

**Код причины:**`151`

**Состояние:**`0502`

**Свойства**: нет

**Полезные данные**: пустые

### <a name="resource-exhausted"></a>Ресурс исчерпан

ресурс не имеет емкости для завершения операции

**Код причины:**`131`

**Состояние:**`0503`

**Свойства**:

| Имя | Type | Обязательно | Описание |
| :--- | :--- | :------- | :---------- |
| reason | строка | Нет | содержит сведения о том, что конкретно не является допустимым сообщением |

**Полезные данные**: пустые

### <a name="server-busy"></a>Сервер занят

сервер занят

**Код причины:**`131`

**Состояние:**`0603`

**Свойства**:

| Имя | Type | Обязательно | Описание |
| :--- | :--- | :------- | :---------- |
| Идентификатор трассировки | строка | Нет | Идентификатор трассировки для корреляции с дополнительной диагностикой для ошибки |

**Полезные данные**: пустые

### <a name="server-error"></a>Ошибка сервера

Внутренняя ошибка сервера

**Код причины:**`131`

**Состояние:**`0601`

**Свойства**:

| Имя | Type | Обязательно | Описание |
| :--- | :--- | :------- | :---------- |
| Идентификатор трассировки | строка | Нет | Идентификатор трассировки для корреляции с дополнительной диагностикой для ошибки |

**Полезные данные**: пустые

### <a name="target-failed"></a>Сбой целевого объекта

Целевой объект ответил, но ответ был недопустимым или неправильно сформирован

**Код причины:**`131`

**Состояние:**`06A2`

**Свойства**:

| Имя | Type | Обязательно | Описание |
| :--- | :--- | :------- | :---------- |
| reason | строка | Нет | содержит сведения о том, что конкретно не является допустимым сообщением |

**Полезные данные**: пустые

### <a name="target-timeout"></a>Время ожидания целевого объекта

истекло время ожидания завершения запроса целевым объектом

**Код причины:**`131`

**Состояние:**`06A1`

**Свойства**:

| Имя | Type | Обязательно | Описание |
| :--- | :--- | :------- | :---------- |
| Идентификатор трассировки | строка | Нет | Идентификатор трассировки для корреляции с дополнительной диагностикой для ошибки |
| reason | строка | Нет | содержит сведения о том, что конкретно не является допустимым сообщением |

**Полезные данные**: пустые

### <a name="target-unavailable"></a>Целевой объект недоступен

Целевой объект недоступен для завершения запроса

**Код причины:**`131`

**Состояние:**`06A0`

**Свойства**: нет

**Полезные данные**: пустые

### <a name="throttled"></a>Ожидает повтора

слишком высокая частота запросов на номер SKU

**Код причины:**`151`

**Состояние:**`0501`

**Свойства**: нет

**Полезные данные**: пустые

### <a name="timeout"></a>Время ожидания

время ожидания операции истекло до ее завершения

**Код причины:**`131`

**Состояние:**`0602`

**Свойства**:

| Имя | Type | Обязательно | Описание |
| :--- | :--- | :------- | :---------- |
| Идентификатор трассировки | строка | Нет | Идентификатор трассировки для корреляции с дополнительной диагностикой для ошибки |

**Полезные данные**: пустые

