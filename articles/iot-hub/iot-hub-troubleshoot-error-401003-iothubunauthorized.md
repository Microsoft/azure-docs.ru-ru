---
title: Устранение неполадок центра Интернета вещей Azure 401003 Иосубунаусоризед
description: Сведения об исправлении ошибки 401003 Иосубунаусоризед
author: jlian
manager: briz
ms.service: iot-hub
services: iot-hub
ms.topic: troubleshooting
ms.date: 11/06/2020
ms.author: jlian
ms.custom:
- amqp
- mqtt
ms.openlocfilehash: 8fb891d5a47203c9905a7def9d04199d24327f70
ms.sourcegitcommit: 867cb1b7a1f3a1f0b427282c648d411d0ca4f81f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "94357255"
---
# <a name="401003-iothubunauthorized"></a>401003 IoTHubUnauthorized

В этой статье описываются причины и решения для ошибок **401003 иосубунаусоризед** .

## <a name="symptoms"></a>Симптомы

### <a name="symptom-1"></a>Симптом 1

В журналах вы увидите шаблон устройств, которые отключаются с **401003 иосубунаусоризед**, а затем **404104 девицеконнектионклоседремотели**, а затем успешно подключаются вскоре после.

### <a name="symptom-2"></a>Симптом 2

Запросы к центру Интернета вещей завершаются с одним из следующих сообщений об ошибке:

* Отсутствует заголовок авторизации
* IotHub " \* " не содержит указанное устройство " \* "
* Правило авторизации " \* " не разрешает доступ для " \* "
* Сбой проверки подлинности для этого устройства, продление маркера или сертификата и повторное подключение
* Отпечаток не соответствует конфигурации: Thumbprint: SHA1Hash = \* , SHA2Hash = \* ; Конфигурация: Примарисумбпринт = \* , секондарисумбпринт =\*

## <a name="cause"></a>Причина

### <a name="cause-1"></a>Причина 1

Для MQTT некоторые пакеты SDK используют центр Интернета вещей для выпуска отключения, если срок действия маркера SAS истек, чтобы получить сведения об обновлении. Таким образом,

1. Срок действия маркера SAS истекает
1. Центр Интернета вещей заметит срок действия и отключится к устройству с помощью **401003 иосубунаусоризед**
1. Устройство завершает отключение с помощью **404104 девицеконнектионклоседремотели**
1. Пакет SDK для IoT создает новый маркер SAS
1. Устройство успешно подключится к центру Интернета вещей

### <a name="cause-2"></a>Причина 2

Центру Интернета вещей не удалось проверить подлинность заголовка, правила или ключа проверки подлинности. Это может быть вызвано любой из причин, указанных в описании симптомов.

## <a name="solution"></a>Решение

### <a name="solution-1"></a>Решение 1

При использовании пакета SDK для IoT для подключения с использованием строки подключения устройства никаких действий не требуется. Пакет SDK для IoT повторно создает новый токен для повторного подключения по истечении срока действия маркера SAS.

Срок жизни токена по умолчанию составляет 60 минут между пакетами SDK; Однако для некоторых пакетов SDK время существования маркера и пороговое значение обновления маркера можно настроить. Кроме того, ошибки, формируемые при отключении устройства и повторном подключении к обновлению токена, различаются для каждого пакета SDK. Дополнительные сведения и сведения о том, как определить, какой пакет SDK используется устройством в журналах, см. в разделе [поведение отключения устройства MQTT с помощью пакетов SDK для Azure IOT](iot-hub-troubleshoot-connectivity.md#mqtt-device-disconnect-behavior-with-azure-iot-sdks).

Для разработчиков устройств, если возникает проблема с объемом ошибок, переключитесь на пакет SDK C, который обновляет маркер SAS до истечения срока его действия. Для AMQP маркер SAS может обновляться без подключения.

### <a name="solution-2"></a>Решение 2

Как правило, представленное сообщение об ошибке должно объяснить, как исправить ошибку. Если по какой бы то ни было причине у вас нет доступа к сведениям о сообщении об ошибке, убедитесь, что:

- Срок действия SAS или другого маркера безопасности, который вы используете, не истек.
- Для проверки подлинности сертификата X. 509 сертификат устройства или сертификат ЦС, связанный с устройством, не просрочен. Чтобы узнать, как зарегистрировать сертификаты ЦС X. 509 в центре Интернета вещей, см. статью [Настройка безопасности x. 509 в центре Интернета вещей Azure](iot-hub-security-x509-get-started.md).
- Для проверки подлинности отпечатка сертификата X. 509 отпечаток сертификата устройства регистрируется в центре Интернета вещей.
- Учетные данные авторизации правильно сформированы для используемого протокола. Дополнительные сведения см. в разделе [Управление доступом к центру Интернета вещей](iot-hub-devguide-security.md).
- Используемое правило авторизации имеет разрешение для запрошенной операции.

## <a name="next-steps"></a>Дальнейшие действия

- Чтобы упростить проверку подлинности в центре Интернета вещей, мы рекомендуем использовать [пакеты SDK для Azure IOT](iot-hub-devguide-sdks.md).
- Дополнительные сведения о проверке подлинности в центре Интернета вещей см. в статье [Управление доступом к центру Интернета вещей](iot-hub-devguide-security.md).
