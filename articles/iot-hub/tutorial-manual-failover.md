---
title: Учебник. Отработка отказа центра Интернета вещей Azure вручную | Документация Майкрософт
description: Из этого учебника вы узнаете, как вручную перенести свой центр Интернета вещей в другой регион и убедиться, что центр работает, а затем вернуть его в исходный регион и снова проверить.
author: robinsh
manager: timlt
ms.service: iot-hub
services: iot-hub
ms.topic: tutorial
ms.date: 07/24/2019
ms.author: robinsh
ms.custom:
- mvc
- mqtt
ms.openlocfilehash: 3b6bc972f5c26c78ffff81f5bab8c2812cf2cb11
ms.sourcegitcommit: 910a1a38711966cb171050db245fc3b22abc8c5f
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "98622918"
---
# <a name="tutorial-perform-manual-failover-for-an-iot-hub"></a>Руководство по выполнению отработки отказа вручную для Центра Интернета вещей

Ручная отработка отказа — это функция службы Центра Интернета вещей, которая позволяет клиентам [отрабатывать отказ](https://en.wikipedia.org/wiki/Failover) концентратора операций из основного региона в соответствующий географически связанный регион Azure. Ручная отработка отказа может выполняться в случае региональной аварии или при длительном сбое службы. Также можно выполнять плановую отработку отказа для проверки возможности аварийного восстановления, но рекомендуется использовать тестовый Центр Интернета вещей вместо рабочего. Функция ручной отработки отказа предоставляется клиентам бесплатно для их центров Интернета вещей, созданных после 18 мая 2017 года.

Вот какие шаги выполняются в этом руководстве:

> [!div class="checklist"]
> * Создание центра Интернета вещей с помощью портала Azure. 
> * Выполнение отработки отказа. 
> * Запуск концентратора в дополнительном расположении.
> * Восстановление размещения для возврата операций центра Интернета вещей в основное расположение. 
> * Подтверждение правильной работы концентратора в нужном расположении.

Дополнительные сведения о переходе на другой ресурс вручную и о отработке отказа, инициированной Майкрософт, с использованием Центра Интернета вещей см. в разделе [Обеспечение возможности аварийного восстановления между регионами](iot-hub-ha-dr.md#cross-region-dr).

## <a name="prerequisites"></a>Предварительные требования

* Подписка Azure. Если у вас еще нет подписки Azure, [создайте бесплатную учетную запись](https://azure.microsoft.com/free/?WT.mc_id=A261C142F), прежде чем начинать работу.

* Убедитесь, что в брандмауэре открыт порт 8883. Пример устройства в этом руководстве использует протокол MQTT, который передает данные через порт 8883. В некоторых корпоративных и академических сетях этот порт может быть заблокирован. Дополнительные сведения и способы устранения этой проблемы см. в разделе о [подключении к Центру Интернета вещей по протоколу MQTT](iot-hub-mqtt-support.md#connecting-to-iot-hub).

## <a name="create-an-iot-hub"></a>Создание Центра Интернета вещей

1. Войдите на [портал Azure](https://portal.azure.com). 

2. Щелкните **+ Создать ресурс** и выберите **Интернет вещей**, затем **Центр Интернета вещей**.

   ![Снимок показывающий создание центра Интернета вещей](./media/tutorial-manual-failover/create-hub-01.png)

3. Выберите вкладку **Основы**. Заполните следующие поля.

    **Подписка**. Выберите подписку Azure, которую необходимо использовать.

    **Группа ресурсов**. Щелкните **Создать** и укажите в поле для имени группы ресурсов **ManlFailRG**.

    **Регион**. Выберите ближайший регион. В этом учебнике используется `West US 2`. Отработка отказа может выполняться только между географически связанными регионами Azure. Регион, географически связанный с регионом "Западная часть США 2" — это WestCentralUS.
    
   **Имя центра IoT**. Укажите имя Центра Интернета вещей. Имя концентратора должно быть глобально уникальным. 

   ![Снимок экрана, показывающий основные сведения для создания Центра Интернета вещей](./media/tutorial-manual-failover/create-hub-02-basics.png)

   Щелкните **Review + create** (Просмотреть и создать). (Значения для размера и масштаба используются по умолчанию.) 

4. Просмотрите информацию, затем щелкните **Создать**, чтобы создать центр Интернета вещей. 

   ![Снимок экрана, показывающий последний шаг для создания центра Интернета вещей](./media/tutorial-manual-failover/create-hub-03-create.png)

## <a name="perform-a-manual-failover"></a>Выполнение ручной отработки отказа

Обратите внимание, что для центра Интернета вещей установлено ограничение: две отработки отказа и два восстановления размещений в день.

1. Щелкните **Группы ресурсов** и выберите группу ресурсов **ManlFailRG**. В списке ресурсов выберите концентратор. 

1. В разделе **Параметры** в области Центра Интернета вещей щелкните **Отработка отказа**.

   ![Снимок экрана, показывающий область свойств Центра Интернета вещей](./media/tutorial-manual-failover/trigger-failover-01.png)

1. В области "Отработка отказа вручную" отображается **текущее расположение** и **расположение отработки отказа**. Текущим расположением всегда является расположение, в котором центр активен в данный момент. Расположение отработки отказа — это стандартный [географически связанный регион Azure](../best-practices-availability-paired-regions.md), который находится в паре с основным расположением. Расположение изменить невозможно. В этом учебнике текущее расположение — `West US 2`, а расположение отработки отказа — `West Central US`.

   ![Снимок экрана, показывающий панель ручной отработки отказа](./media/tutorial-manual-failover/trigger-failover-02.png)

1. В верхней части области "Отработка отказа вручную" щелкните **Запустить отработку отказа**. 

1. В области подтверждения введите имя Центра Интернета вещей, который нужно использовать для отработки отказа. Затем, чтобы начать отработку отказа, щелкните **Отработка отказа**.

   Время, необходимое для выполнения ручной отработки отказа, пропорционально количеству устройств, зарегистрированных для концентратора. Например, для 100 000 устройств понадобится 15 минут, но если имеется пять миллионов устройств, отработка отказа может занять час или больше.

   ![Снимок экрана, на котором показана панель подтверждения перехода на другой ресурс вручную](./media/tutorial-manual-failover/trigger-failover-03-confirm.png)

   Пока выполняется процесс отработки отказа вручную, отображается баннер с соответствующей надписью. 

   ![Снимок, показывающий процесс выполнения ручной отработки отказа](./media/tutorial-manual-failover/trigger-failover-04-in-progress.png)

   Если вы закроете область Центра Интернета вещей и снова откроете ее, щелкнув ее в области "Группа ресурсов", появится баннер, сообщающий, что для Центра выполняется отработка отказа вручную. 

   ![Снимок экрана с баннером, сообщающим о выполнении отработки отказа Центра Интернета вещей](./media/tutorial-manual-failover/trigger-failover-05-hub-inactive.png)

   После завершения текущий регион и регион отработки отказа на странице "Отработка отказа вручную" поменяются местами и центр снова активируется. В этом примере теперь текущее расположение — это `WestCentralUS`, а расположение отработки отказа — `West US 2`. 

   ![Снимок, показывающий завершение отработки отказа](./media/tutorial-manual-failover/trigger-failover-06-finished.png)

   На странице обзора также отображается баннер, указывающий, что отработка отказа завершена, а Центр Интернета вещей работает в регионе `West Central US`.

   ![Снимок экрана с баннером, сообщающим о завершении отработки отказа, на странице обзора](./media/tutorial-manual-failover/trigger-failover-06-finished-overview.png)


## <a name="perform-a-failback"></a>Восстановление размещения 

После выполнения отработки отказа вручную можно переключить операции концентратора обратно в исходную основную область. Это называется восстановлением размещения. Если отработка отказа была выполнена только что, прежде чем запросить восстановление размещения, необходимо подождать около часа. Если же выполнить восстановление размещения не подождав это время, появится сообщение об ошибке.

Восстановление размещения выполняется так же, как ручная отработка отказа. Шаги описаны ниже. 

1. Чтобы выполнить восстановление размещения, вернитесь на панель центра Интернета вещей.

2. В разделе **Параметры** в области Центра Интернета вещей щелкните **Отработка отказа**. 

3. В верхней части области "Отработка отказа вручную" щелкните **Запустить отработку отказа**. 

4. На панели подтверждения введите имя Центра Интернета вещей, который нужно использовать для восстановления размещения. Чтобы начать восстановление размещения, нажмите OK. 

   ![Снимок, показывающий запрос на ручное восстановление размещения](./media/tutorial-manual-failover/trigger-failover-03-confirm.png)

   Баннеры отображаются, как описано в разделе о выполнении отработки отказа. После завершения восстановления размещения текущим расположением снова станет `West US 2`, а расположением отработки отказа — `West Central US`, как установлено изначально.

## <a name="clean-up-resources"></a>Очистка ресурсов 

Чтобы удалить все ресурсы, которые были созданы в этом руководстве, удалите группу ресурсов. При этом будут также удалены все ресурсы, содержащиеся в группе. В этом случае происходит удаление центра Интернета вещей и самой группы ресурсов. 

1. Щелкните раздел **Группа ресурсов**. 

2. Найдите и выберите группу ресурсов **ManlFailRG**. Щелкните ее, чтобы открыть. 

3. Щелкните **Удалить группу ресурсов**. Когда появится запрос, введите имя группы ресурсов и нажмите кнопку **Удалить**. 

## <a name="next-steps"></a>Дальнейшие действия

Из этого руководства вы узнали, как настроить и выполнить ручную отработку отказа и как запросить восстановление размещения, выполнив следующие задачи.

> [!div class="checklist"]
> * Создание центра Интернета вещей с помощью портала Azure. 
> * Выполнение отработки отказа. 
> * Запуск концентратора в дополнительном расположении.
> * Восстановление размещения для возврата операций центра Интернета вещей в основное расположение. 
> * Подтверждение правильной работы концентратора в нужном расположении.

Перейдите к следующему руководству, чтобы узнать, как управлять состоянием устройств IoT. 

> [!div class="nextstepaction"]
> [Руководство. Настройка устройств из внутренней службы](tutorial-device-twins.md)
