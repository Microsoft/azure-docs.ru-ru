---
title: Общие сведения о формате сообщений Центра Интернета вещей Azure | Документы Майкрософт
description: Руководство разработчика — сведения о формате и ожидаемом содержимом сообщений Центра Интернета вещей.
author: ash2017
manager: briz
ms.service: iot-hub
services: iot-hub
ms.topic: conceptual
ms.date: 07/22/2019
ms.author: asrastog
ms.custom:
- 'Role: Cloud Development'
- 'Role: IoT Device'
ms.openlocfilehash: 6d6b7122963b51619f26b8d02a8be4ad39261afb
ms.sourcegitcommit: 772eb9c6684dd4864e0ba507945a83e48b8c16f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "92147702"
---
# <a name="create-and-read-iot-hub-messages"></a>Создание и чтение сообщений Центра Интернета вещей

Для поддержки эффективного взаимодействия, независимого от протоколов, Центр Интернета вещей задает общий формат сообщений для всех протоколов для устройств. Этот формат сообщения используется для сообщений, передаваемых [с устройства в облако](iot-hub-devguide-messages-d2c.md) и [наоборот](iot-hub-devguide-messages-c2d.md). 

[!INCLUDE [iot-hub-basic](../../includes/iot-hub-basic-partial.md)]

Для реализация отправки сообщений с устройства в облако Центр Интернета вещей использует модель потоковой передачи сообщений. Сообщения Центра Интернета вещей, отправляемые с устройства в облако, больше похожи на *события*[Центров событий](../event-hubs/index.yml), чем на *сообщения*[служебной шины](../service-bus-messaging/index.yml), где большое количество событий проходит через службу и может считываться несколькими модулями чтения.

Сообщение Центра Интернета вещей состоит из следующих компонентов.

* Предварительно определенный набор *системных свойств*, которые приведены ниже.

* Набор *свойств приложения*. Словарь свойств строки, которые приложение может задать и использовать без необходимости десериализации текста сообщения. Центр Интернета вещей никогда не изменяет эти свойства.

* Непрозрачная двоичная основная часть.

При отправке сообщений с устройства в облако с помощью протокола HTTPS или отправке сообщений из облака на устройство имена и значения свойств могут содержать только буквенно-цифровые знаки ASCII и знаки ``{'!', '#', '$', '%, '&', ''', '*', '+', '-', '.', '^', '_', '`', '|', '~'}``.

Отправка сообщений с устройства в облако с помощью Центра Интернета вещей имеет следующие характеристики:

* Сообщения, отправляемые с устройства в облако, устойчивы и хранятся в конечной точке по умолчанию **messages/events** Центра Интернета вещей до семи дней.

* Размер сообщений, поступающих с устройства в облако, не может превышать 256 КБ, и их можно объединять в пакеты, чтобы оптимизировать отправку. Размер пакетов не может превышать 256 КБ.

* Центр Интернета вещей не позволяет выполнять произвольное секционирование. Сообщения, отправляемые с устройства в облако, секционируются по исходному идентификатору **deviceId**.

* Как поясняется в статье [Управление доступом к Центру Интернета вещей](iot-hub-devguide-security.md), Центр Интернета вещей обеспечивает аутентификацию и контроль доступа для каждого устройства.

* Можно пометить сообщения данными, которые будут передаваться в свойства приложения. Дополнительные сведения см. в разделе, посвященном [обогащению сообщений](iot-hub-message-enrichments-overview.md).

Дополнительные сведения о способах кодировки и декодирования сообщений, отправляемых с помощью разных протоколов, см. в статье [Понимание и использование пакетов SDK для Центра Интернета вещей Azure](iot-hub-devguide-sdks.md).

## <a name="system-properties-of-d2c-iot-hub-messages"></a>Системные свойства сообщений Центра Интернета вещей **D2C**

| Свойство | Описание  |Задается пользователем?|Ключевое слово "for" </br>запрос маршрутизации|
| --- | --- | --- | --- |
| message-id |Задаваемый пользователем идентификатор сообщения, используемый для шаблонов типа "запрос-ответ". Формат: Строка с учетом регистра (длиной до 128 символов), состоящая из букв и цифр в 7-битовом формате ASCII + `{'-', ':', '.', '+', '%', '_', '#', '*', '?', '!', '(', ')', ',', '=', '@', ';', '$', '''}`.  | Да | messageId |
| iothub-enqueuedtime |Дата и время получения сообщения, отправленного [с устройства в облако](iot-hub-devguide-d2c-guidance.md), Центром Интернета вещей. | нет | enqueuedTime |
| user-id |Идентификатор, используемый для указания источника сообщений. Если сообщения создает центр Интернета вещей, для этого параметра задается значение `{iot hub name}`. | Да | userId |
| iothub-connection-device-id |Центр Интернета вещей устанавливает этот идентификатор в сообщениях, отправляемых с устройства в облако. Содержит идентификатор **deviceId** устройства, отправившего сообщение. | нет | connectionDeviceId |
| iothub-connection-module-id |Центр Интернета вещей устанавливает этот идентификатор в сообщениях, отправляемых с устройства в облако. Содержит идентификатор **moduleId** устройства, с которого было отправлено сообщение. | нет | connectionModuleId |
| iothub-connection-auth-generation-id |Центр Интернета вещей устанавливает этот идентификатор в сообщениях, отправляемых с устройства в облако. Содержит идентификатор **generationId** устройства, с которого было отправлено сообщение (согласно разделу [Свойства удостоверений устройств](iot-hub-devguide-identity-registry.md#device-identity-properties)). | нет |connectionDeviceGenerationId |
| iothub-connection-auth-method |Центр Интернета вещей устанавливает этот метод проверки подлинности в сообщениях, отправляемых с устройства в облако. Это свойство содержит сведения о методе проверки подлинности, используемом для аутентификации устройства, отправляющего сообщение.| нет | connectionAuthMethod |
| DT — схема схемы | Это значение задается центром Интернета вещей в сообщениях, отправляемых с устройства в облако. Он содержит идентификатор модели устройства, заданный в подключении устройства. | Нет | Н/Д |
| DT-subject | Имя компонента, отправляющего сообщения, отправляемые с устройства в облако. | Да | Н/Д |

## <a name="system-properties-of-c2d-iot-hub-messages"></a>Системные свойства сообщений Центра Интернета вещей **C2D**

| Свойство | Описание  |Задается пользователем?|
| --- | --- | --- |
| message-id |Задаваемый пользователем идентификатор сообщения, используемый для шаблонов типа "запрос-ответ". Формат: Строка с учетом регистра (длиной до 128 символов), состоящая из букв и цифр в 7-битовом формате ASCII + `{'-', ':', '.', '+', '%', '_', '#', '*', '?', '!', '(', ')', ',', '=', '@', ';', '$', '''}`.  |Да|
| sequence-number |Число (уникальное для каждой очереди устройства), которое Центр Интернета вещей назначает каждому сообщению, отправленному из облака на устройство. |нет|
| значение |Место назначения, которое указывается в сообщениях, отправляемых [из облака на устройство](iot-hub-devguide-c2d-guidance.md) . |нет|
| absolute-expiry-time |Дата и время истечения срока действия сообщения. |нет|   |
| correlation-id |Строковое свойство в сообщении ответа, которое обычно содержит идентификатор сообщения запроса в шаблонах "запрос-ответ". |Да|
| user-id |Идентификатор, используемый для указания источника сообщений. Если сообщения создает центр Интернета вещей, для этого параметра задается значение `{iot hub name}`. |Да|
| iothub-ack |Генератор отзывов на сообщения. Это свойство используется в сообщениях, отправляемых из облака в устройство, чтобы запросить у Центра Интернета вещей отправку отзыва после того, как сообщение будет использовано устройством. Возможные значения: **none** (по умолчанию) — отзывы не создаются, **positive** — отзыв будет получен, когда исходное сообщение будет передано, **negative** — отзыв будет получен, когда истечет срок действия исходного сообщения (или будет превышен лимит доставок) и при этом устройство его не примет, **full** — активированы значения positive и negative. |Да|

### <a name="system-property-names"></a>Имена системных свойств

Имена системных свойств различаются в зависимости от конечной точки, на которую отправляются сообщения. Информация об этих именах приведена в таблице ниже.

|Имя системного свойства|Центры событий|Хранилище Azure|Служебная шина|Сетка событий Azure|
|--------------------|----------|-------------|-----------|----------|
|Идентификатор сообщения|message-id|messageId|MessageId|message-id|
|Идентификатор пользователя|user-id|userId|UserId|user-id|
|Идентификатор устройства подключения|iothub-connection-device-id| connectionDeviceId|iothub-connection-device-id|iothub-connection-device-id|
|Идентификатор модуля подключения|iothub-connection-module-id|connectionModuleId|iothub-connection-module-id|iothub-connection-module-id|
|Идентификатор создания проверки подлинности подключения|iothub-connection-auth-generation-id|connectionDeviceGenerationId| iothub-connection-auth-generation-id|iothub-connection-auth-generation-id|
|Метод проверки подлинности подключения|iothub-connection-auth-method|connectionAuthMethod|iothub-connection-auth-method|iothub-connection-auth-method|
|сontentType|content-type|сontentType|ContentType|iothub-content-type|
|contentEncoding|content-encoding|contentEncoding|ContentEncoding|iothub-content-encoding|
|iothub-enqueuedtime|iothub-enqueuedtime|enqueuedTime| Н/Д |iothub-enqueuedtime|
|CorrelationId|correlation-id|correlationId|CorrelationId|correlation-id|
|DT — схема схемы|DT — схема схемы|DT — схема схемы|DT — схема схемы|DT — схема схемы|
|DT-subject|DT-subject|DT-subject|DT-subject|DT-subject|

## <a name="message-size"></a>Размер сообщения

Центр Интернета вещей измеряет размер сообщения вне зависимости от протокола, учитывая только фактический объем полезных данных. Размер в байтах вычисляется как сумма следующих значений:

* размер текста в байтах;
* размер в байтах всех значений свойств системы сообщений;
* размер в байтах всех имен и значений свойств пользователей.

Имена и значения свойств ограничены символами ASCII, то есть длина строк равна размеру в байтах.

## <a name="anti-spoofing-properties"></a>Свойства для защиты от спуфинга

Чтобы избежать спуфинга устройств при работе с сообщениями, отправляемыми с устройства в облако, Центр Интернета вещей отмечает все сообщения такими свойствами:

* **iothub-connection-device-id**
* **iothub-connection-auth-generation-id**
* **iothub-connection-auth-method**

Первые два свойства содержат параметры **deviceId** и **generationId** исходного устройства согласно разделу о [свойствах удостоверений устройств](iot-hub-devguide-identity-registry.md#device-identity-properties).

Свойство **iothub-connection-auth-method** содержит сериализованный объект JSON, имеющий следующие свойства.

```json
{
  "scope": "{ hub | device }",
  "type": "{ symkey | sas | x509 }",
  "issuer": "iothub"
}
```

## <a name="next-steps"></a>Дальнейшие действия

* Сведения об ограничениях на размер сообщений в Центре Интернета вещей см. в статье [Руководство. Квоты и регулирование в Центре Интернета вещей](iot-hub-devguide-quotas-throttling.md).

* Узнайте, как создавать и читать сообщения Центра Интернета вещей на разных языках программирования, из [этих кратких руководств](quickstart-send-telemetry-node.md).