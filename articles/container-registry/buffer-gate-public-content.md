---
title: Управление общедоступным содержимым в частном реестре контейнеров
description: Рекомендации и рабочие процессы в реестре контейнеров Azure для управления зависимостями в общедоступных образах из DOCKER HUB и других общедоступных материалов
author: dlepow
ms.topic: article
ms.author: danlep
ms.date: 11/20/2020
ms.openlocfilehash: 0c92899528d417f9c91f8f8930ca4932dc74e850
ms.sourcegitcommit: 867cb1b7a1f3a1f0b427282c648d411d0ca4f81f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "95024744"
---
# <a name="manage-public-content-with-azure-container-registry"></a>Управление общедоступным содержимым с помощью реестра контейнеров Azure

В этой статье представлен обзор методик и рабочих процессов для использования локального реестра, такого как [Реестр контейнеров Azure](container-registry-intro.md) , для хранения копий общедоступного содержимого, например образов контейнеров в DOCKER Hub. 


## <a name="risks-with-public-content"></a>Риски с общедоступным содержимым

В вашей среде могут быть зависимости от общедоступного содержимого, такого как общедоступные образы контейнеров, [Helm диаграммы](https://helm.sh/), политики [Open Policy Agent](https://www.openpolicyagent.org/) (непрозра) или другие артефакты. Например, вы можете запустить [nginx](https://hub.docker.com/_/nginx) для маршрутизации службы или `docker build FROM alpine` путем извлечения образов непосредственно из DOCKER HUB или другого общедоступного реестра. 

Без соответствующих элементов управления наличие зависимостей от общедоступного содержимого реестра может привести к угрозам, связанных с разработкой и развертыванием образов. Чтобы снизить риски, по возможности обновляйте локальные копии общедоступного содержимого. Дополнительные сведения см. в [блоге по открытому инициативе по контейнеру](https://opencontainers.org/posts/blog/2020-10-30-consuming-public-content/). 

## <a name="authenticate-with-docker-hub"></a>Проверка подлинности с помощью DOCKER HUB

В качестве первого шага, если сейчас вы извлекаете открытые образы из DOCKER Hub как часть рабочего процесса сборки или развертывания, рекомендуется выполнить [проверку подлинности с помощью учетной записи DOCKER Hub](https://docs.docker.com/docker-hub/download-rate-limit/#how-do-i-authenticate-pull-requests) вместо анонимного запроса на включение внесенных изменений.

При частом анонимных запросах на включение внесенных изменений могут возникнуть ошибки DOCKER, аналогичные `ERROR: toomanyrequests: Too Many Requests.` или `You have reached your pull rate limit.` прошедшие проверку подлинности в концентраторе DOCKER, чтобы предотвратить эти ошибки.

> [!NOTE]
> Начиная с 2 ноября 2020 г. [ограничения скорости загрузки](https://docs.docker.com/docker-hub/download-rate-limit) применяются к анонимным и прошедшим проверку подлинности запросам к концентратору DOCKER из учетных записей бесплатных планов DOCKER и применяются соответственно IP-адресу и идентификатору DOCKER. 
>
> При оценке количества запросов на вытягивание следует учитывать, что при использовании облачных служб поставщика или работе с корпоративным NAT в качестве подмножества IP-адресов будет представлено несколько пользователей. Добавление аутентификации платной учетной записи DOCKER в запросы, отправленные в центр DOCKER, позволит избежать возможных нарушений в работе служб из-за регулирования скорости.
>
> Дополнительные сведения см. в разделе [цены на DOCKER и подписки](https://www.docker.com/pricing) и [условия предоставления услуг DOCKER](https://www.docker.com/legal/docker-terms-service).

### <a name="docker-hub-access-token"></a>Маркер доступа к концентратору DOCKER

Центр DOCKER поддерживает [Личные маркеры доступа](https://docs.docker.com/docker-hub/access-tokens/) в качестве альтернативы паролю DOCKER при проверке подлинности в центре DOCKER. Токены рекомендуются для автоматических служб, которые извлекают образы из DOCKER Hub. Можно создать несколько маркеров для разных пользователей или служб и отозвать маркеры, если они больше не нужны.

Чтобы выполнить проверку подлинности с `docker login` помощью токена, не указывайте пароль в командной строке. При запросе пароля введите маркер. Если вы включили двухфакторную проверку подлинности для учетной записи центра DOCKER, необходимо использовать личный маркер доступа при входе из интерфейса командной строки DOCKER.

### <a name="authenticate-from-azure-services"></a>Аутентификация из служб Azure

Несколько служб Azure, включая службу приложений и экземпляры контейнеров Azure, поддерживают извлечение образов из общедоступных реестров, таких как DOCKER Hub для развертываний контейнеров. Если необходимо развернуть образ из DOCKER Hub, рекомендуется настроить параметры для проверки подлинности с помощью учетной записи DOCKER Hub. Примеры:

**Служба приложений**

* **Источник образа**: DOCKER HUB
* **Доступ к репозиторию**: частный
* **Имя входа**: \<Docker Hub username>
* **Пароль**: \<Docker Hub token>

Дополнительные сведения см. [в статье опрашивающие концентраторы DOCKER с проверкой подлинности в службе приложений](https://azure.github.io/AppService/2020/10/15/Docker-Hub-authenticated-pulls-on-App-Service.html).

**Экземпляры контейнеров Azure**;

* **Источник образа**: DOCKER HUB или другой реестр
* **Тип изображения**: частный
* **Сервер входа в реестр изображений**: DOCKER.IO
* **Имя пользователя реестра образа**: \<Docker Hub username>
* **Пароль реестра образа**: \<Docker Hub token>
* **Изображение**: DOCKER.IO/ \<repo name\> :\<tag>

## <a name="import-images-to-an-azure-container-registry"></a>Импорт изображений в реестр контейнеров Azure
 
Чтобы начать Управление копиями общедоступных образов, можно создать реестр контейнеров Azure, если у вас его еще нет. Создайте реестр с помощью [Azure CLI](container-registry-get-started-azure-cli.md), [портал Azure](container-registry-get-started-portal.md), [Azure PowerShell](container-registry-get-started-powershell.md)или других средств. 

В качестве рекомендуемого однократного выполнения [импортируйте](container-registry-import-images.md) базовые образы и другое общедоступное содержимое в реестр контейнеров Azure. Команда [AZ запись контроля](/cli/azure/acr#az_acr_import) доступа в Azure CLI поддерживает импорт изображений из общедоступных реестров, таких как DOCKER HUB и реестра контейнеров Microsoft, а также из других закрытых реестров контейнеров. 

`az acr import` не требуется локальная установка DOCKER. Его можно запустить с помощью локальной установки Azure CLI или непосредственно в Azure Cloud Shell. Он поддерживает образы любых типов ОС, образов с несколькими архитектурами и артефактов OCI, таких как диаграммы Helm.

Пример

```azurecli-interactive
az acr import \
  --name myregistry \
  --source docker.io/library/hello-world:latest \
  --image hello-world:latest \
  --username <Docker Hub username> \
  --password <Docker Hub token>
```

В зависимости от потребностей Организации можно импортировать в выделенный реестр или репозиторий в общем реестре.

## <a name="automate-application-image-updates"></a>Автоматизация обновления образа приложения

Разработчики образов приложений должны обеспечить, чтобы их код ссылался на локальное содержимое под их контролем. Например, `Docker FROM` инструкция в Dockerfile должна ссылаться на образ в частном базовом реестре образов вместо общедоступного реестра. 

Расширение импорта изображений. Настройка [задачи реестра контейнеров Azure](container-registry-tasks-overview.md) для автоматизации сборок образа приложения при обновлении базовых образов. Автоматизированная задача сборки может вести мониторинг как [обновлений базовых образов](container-registry-tasks-base-images.md) , так и [обновлений исходного кода](container-registry-tasks-overview.md#trigger-task-on-source-code-update).

Подробный пример см. в статье Использование [и обслуживание общедоступного содержимого с помощью задач реестра контейнеров Azure](tasks-consume-public-content.md). 

> [!NOTE]
> Одна предварительно настроенная задача может автоматически перестраивать каждый образ приложения, который ссылается на зависимый базовый образ. 
 
## <a name="next-steps"></a>Дальнейшие действия
 
* Дополнительные сведения о [задачах контроля](container-registry-tasks-overview.md) доступа для создания, запуска, отправки и исправления образов контейнеров в Azure см. здесь.
* Сведения [об использовании и обслуживании общедоступного содержимого с помощью задач реестра контейнеров Azure](tasks-consume-public-content.md) для рабочего процесса автоматической ограничения для обновления базовых образов в вашей среде. 
* Дополнительные примеры автоматизации сборок и обновлений образа см. в [руководствах по задачам контроля](container-registry-tutorial-quick-task.md) доступа.
