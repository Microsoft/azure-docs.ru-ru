---
title: Сведения о реестрах, репозиториях, изображениях и артефактах
description: Введение в ключевые понятия реестра контейнеров Azure, репозиториев, образов контейнеров и других артефактов.
ms.topic: article
ms.date: 01/29/2021
ms.openlocfilehash: 991be79b10b6061f2034eb19e4e139af65aef3cf
ms.sourcegitcommit: e559daa1f7115d703bfa1b87da1cf267bf6ae9e8
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/17/2021
ms.locfileid: "100578080"
---
# <a name="about-registries-repositories-and-artifacts"></a>Сведения о реестрах, репозиториях и артефактах

В этой статье приводятся основные понятия реестра контейнеров, репозиториев, образов контейнеров и связанных артефактов. 

:::image type="content" source="media/container-registry-concepts/registry-elements.png" alt-text="Реестр, репозитории и артефакты":::

## <a name="registry"></a>Реестр

*Реестр* контейнеров — это служба, которая хранит и распространяет образы контейнеров и связанные артефакты. Концентратор DOCKER — это пример общедоступного реестра контейнеров, который служит общим каталогом образов контейнеров DOCKER. Реестр контейнеров Azure предоставляет пользователям прямой контроль над содержимым контейнеров с интегрированной проверкой подлинности, [георепликацией](container-registry-geo-replication.md) , поддерживающей глобальное распределение и надежность для развертываний в сети, [конфигурации виртуальной сети с закрытой связью](container-registry-private-link.md), [блокировкой тегов](container-registry-image-lock.md)и многими другими расширенными функциями. 

Помимо образов контейнеров, совместимых с DOCKER, реестр контейнеров Azure поддерживает ряд [артефактов содержимого](container-registry-image-formats.md) , включая диаграммы Helm и форматы изображений Open Container INITIATIVE (OCI).

## <a name="repository"></a>Хранилище

*Репозиторий* — это коллекция образов контейнеров или других артефактов в реестре с одинаковыми именами, но разными тегами. Например, в репозитории находятся следующие три изображения `acr-helloworld` :

- *запись контроля доступа — HelloWorld: Последняя*
- *запись контроля доступа — HelloWorld: v1*
- *запись контроля доступа — HelloWorld: v2*

Имена репозиториев также могут включать [пространство имен](container-registry-best-practices.md#repository-namespaces). Пространства имен позволяют выделять связанные репозитории и владение артефактами в Организации, используя имена, разделенные косой чертой. Однако реестр управляет всеми репозиториями независимо друг от друга, а не в виде иерархии. Пример.

- *Маркетинговый/campaign10-18/Web: v2*
- *маркетинг или campaign10-18/API: V3*
- *маркетинг или campaign10-18/Электронная почта — Отправитель: v2*
- *Product-Returns/Web-Отправка: 20180604*
- *Product-Returns/Legacy-Integrator: 20180715*

Имена репозиториев могут содержать только буквы в нижнем регистре, точки, тире, символы подчеркивания и символы косой черты. 

Полные правила именования репозитория см. в статье [Спецификация распространения в рамках инициативы Open Container](https://github.com/docker/distribution/blob/master/docs/spec/api.md#overview).

## <a name="artifact"></a>Артефакт

Образ контейнера или другой артефакт в реестре связан с одним или несколькими тегами, имеет один или несколько слоев и определяется манифестом. Понимание того, как эти компоненты связаны друг с другом, может помочь эффективно управлять реестром.

### <a name="tag"></a>Тег

*Тег* для изображения или другого артефакта указывает его версию. Одному артефакту в репозитории может быть назначен один или несколько тегов, а также может быть "без тегов". То есть можно удалить все теги из изображения, в то время как данные изображения (его слои) остаются в реестре.

Репозиторий (или репозиторий и пространство имен) вместе с тегом определяют имя образа. Образ можно отправлять и получать. Для этого в операции передачи или получения необходимо указать его имя. Тег `latest` используется по умолчанию, если вы не предоставляете его в командах DOCKER.

Создание тегов для образов контейнеров осуществляется с помощью сценариев для разработки или развертывания. Например, стабильными тегами рекомендуется поддерживать базовые образы и уникальные теги для развертывания образов. Дополнительные сведения см. в разделе [рекомендации по отстановке тегов и управление версиями для образов контейнеров](container-registry-image-tag-version.md).

Правила именования тегов см. в [документации по DOCKER](https://docs.docker.com/engine/reference/commandline/tag/).

### <a name="layer"></a>Уровень

Образы контейнеров и артефакты состоят из одного или нескольких *слоев*. Различные типы артефактов определяют слои по-разному. Например, в образе контейнера DOCKER каждый слой соответствует строке в Dockerfile, определяющей изображение:

:::image type="content" source="media/container-registry-concepts/container-image-layers.png" alt-text="Слои образа контейнера":::

Артефакты в реестре используют общие слои, повышая эффективность хранения. Например, несколько образов в разных репозиториях могут иметь общий ASP.NET Core базовом уровне, но в реестре хранится только одна копия этого слоя. Совместное использование уровней также оптимизирует распределение слоев на узлах с несколькими артефактами, совместно использующих общие слои. Если изображение, которое уже находится на узле, включает слой ASP.NET Core в качестве базового, последующее извлечение другого изображения, ссылающегося на тот же слой, не переносит слой на узел. Вместо этого он ссылается на слой, который уже существует на узле.

Чтобы обеспечить безопасную изоляцию и защиту от потенциальных манипуляций с слоями, уровни не являются общими для реестров.

### <a name="manifest"></a>манифеста

Каждый образ контейнера или артефакт, отправленный в реестр контейнеров, связан с *манифестом*. Манифест, созданный реестром при передаче содержимого, уникально идентифицирует артефакты и задает слои. Список манифестов для репозитория можно получить с помощью команды Azure CLI [AZ контроля учетных][az-acr-repository-show-manifests]записей. 

Базовый манифест `hello-world` образа Linux выглядит следующим образом:

  ```json
  {
    "schemaVersion": 2,
    "mediaType": "application/vnd.docker.distribution.manifest.v2+json",
    "config": {
        "mediaType": "application/vnd.docker.container.image.v1+json",
        "size": 1510,
        "digest": "sha256:fbf289e99eb9bca977dae136fbe2a82b6b7d4c372474c9235adc1741675f587e"
      },
    "layers": [
        {
          "mediaType": "application/vnd.docker.image.rootfs.diff.tar.gzip",
          "size": 977,
          "digest": "sha256:2c930d010525941c1d56ec53b97bd057a67ae1865eebf042686d2a2d18271ced"
        }
      ]
  }
  ```

С помощью команды Azure CLI [az acr repository show-manifests][az-acr-repository-show-manifests] можно получить список манифестов репозитория.

```azurecli
az acr repository show-manifests --name <acrName> --repository <repositoryName>
```

Например, перечислите манифесты для репозитория "запись контроля доступа".

```azurecli
az acr repository show-manifests --name myregistry --repository acr-helloworld
```

```output
[
  {
    "digest": "sha256:0a2e01852872580b2c2fea9380ff8d7b637d3928783c55beb3f21a6e58d5d108",
    "tags": [
      "latest",
      "v3"
    ],
    "timestamp": "2018-07-12T15:52:00.2075864Z"
  },
  {
    "digest": "sha256:3168a21b98836dda7eb7a846b3d735286e09a32b0aa2401773da518e7eba3b57",
    "tags": [
      "v2"
    ],
    "timestamp": "2018-07-12T15:50:53.5372468Z"
  },
  {
    "digest": "sha256:7ca0e0ae50c95155dbb0e380f37d7471e98d2232ed9e31eece9f9fb9078f2728",
    "tags": [
      "v1"
    ],
    "timestamp": "2018-07-11T21:38:35.9170967Z"
  }
]
```

### <a name="manifest-digest"></a>Дайджест манифеста

Манифесты идентифицируются с помощью уникального хэша SHA-256 или *дайджеста манифеста*. Каждое изображение или артефакт — указывает, определяется ли его дайджест-тегом или нет. Значение дайджеста уникально, даже если данные слоя артефакта идентичны другим артефактам. Данный механизм позволяет многократно отправлять образы с идентичными тегами в реестр. Например, можно многократно отправлять `myimage:latest` в реестр, при этом не получая сообщений об ошибке. Это происходит из за того, что каждый образ идентифицируется по уникальному дайджесту.

Можно извлечь артефакт из реестра, указав его дайджест в операции извлечения. Некоторые системы могут быть настроены на извлечение по дайджесту, поскольку это гарантирует, что версия образа будет извлечена даже в том случае, если изображение с идентичным тегом помещается в реестр позднее.

> [!IMPORTANT]
> При многократной отправке измененных артефактов с одинаковыми тегами можно создать "потерянные" — артефакты, не имеющие тегов, но по-прежнему использующие место в реестре. Образы без тегов не отображаются в Azure CLI или на портале Azure при просмотре списка или образов по тегу. Тем не менее их слои по-прежнему существуют и занимают место в реестре. Удаление изображения без тегов освобождает место в реестре, когда манифест является единственным или последним, указывая на определенный слой. Сведения об освобождении пространства, используемого изображениями без тегов, см. [в статье Удаление образов контейнеров в реестре контейнеров Azure](container-registry-delete.md).

## <a name="addressing-an-artifact"></a>Обращение к артефакту

Чтобы устранить артефакты реестра для принудительной отправки и операций Pull с помощью DOCKER или других клиентских средств, объедините полное имя реестра, имя репозитория (включая путь к пространству имен, если применимо), а также тег артефакта или дайджест манифеста. В предыдущих разделах приводятся объяснения этих терминов.

  **Адрес по тегу**: `[loginServerUrl]/[repository][:tag]`
    
  **Адрес по дайджесту**: `[loginServerUrl]/[repository@sha256][:digest]`  

При использовании DOCKER или других клиентских средств для извлечения артефактов в реестр контейнеров Azure или их отправки используйте полный URL-адрес реестра, называемый также именем *сервера входа* . В облаке Azure полный URL-адрес реестра контейнеров Azure имеет формат `myregistry.azurecr.io` (все строчные буквы).

> [!NOTE]
> * Нельзя указать номер порта в URL-адресе сервера входа в реестр, например `myregistry.azurecr.io:443` . 
> * Тег `latest` используется по умолчанию, если в команде не указан тег.  

   
### <a name="push-by-tag"></a>Отправить по тегу

Примеры: 

   `docker push myregistry.azurecr.io/samples/myimage:20210106`

   `docker push myregistry.azurecr.io/marketing/email-sender`

### <a name="pull-by-tag"></a>Подвинуть по тегу

Пример 

  `docker pull myregistry.azurecr.io/marketing/campaign10-18/email-sender:v2`

### <a name="pull-by-manifest-digest"></a>Извлечь по дайджесту манифеста


Пример

  `docker pull myregistry.azurecr.io/acr-helloworld@sha256:0a2e01852872580b2c2fea9380ff8d7b637d3928783c55beb3f21a6e58d5d108`



## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения о [хранилище реестра](container-registry-storage.md) и [поддерживаемых форматах содержимого](container-registry-image-formats.md) см. в разделе реестр контейнеров Azure.

Узнайте, как [отправлять и извлекать образы](container-registry-get-started-docker-cli.md) из реестра контейнеров Azure.

<!-- LINKS - Internal -->
[az-acr-repository-show-manifests]: /cli/azure/acr/repository#az-acr-repository-show-manifests


