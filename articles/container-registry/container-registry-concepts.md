---
title: О репозиториях & изображений
description: Введение в ключевые понятия реестра контейнеров Azure, репозиториев и образов контейнеров.
ms.topic: article
ms.date: 06/16/2020
ms.openlocfilehash: 0cc7df22236c60bd473385d92c8db563be68f688
ms.sourcegitcommit: 49ea056bbb5957b5443f035d28c1d8f84f5a407b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/09/2021
ms.locfileid: "100008525"
---
# <a name="about-registries-repositories-and-images"></a>Сведения о реестрах, репозиториях и образах

В этой статье приводятся основные понятия реестра контейнеров, репозиториев, образов контейнеров и связанных артефактов. 

## <a name="registry"></a>Реестр

*Реестр* контейнера — служба, которая хранит и распределяет образы контейнеров. DOCKER Hub — это общедоступный реестр контейнеров, который поддерживает сообщество с открытым исходным кодом и служит общим каталогом образов. Реестр контейнеров Azure предоставляет пользователям возможность прямого управления своими образами с помощью встроенной проверки подлинности, [георепликации](container-registry-geo-replication.md) , поддерживающей глобальное распределение и надежность, для развертываний в сети, [настройки виртуальной сети и брандмауэра](container-registry-vnet.md), [блокировки тегов](container-registry-image-lock.md)и многих других улучшенных функций. 

В дополнение к образам контейнеров DOCKER, реестр контейнеров Azure поддерживает связанные [артефакты содержимого](container-registry-image-formats.md) , включая форматы образов для инициативы Open Container (OCI).

## <a name="content-addressable-elements-of-an-artifact"></a>Сведения об адресных элементах артефакта

Адрес артефакта в реестре контейнеров Azure включает следующие элементы. 

`[loginUrl]/[repository:][tag]`

* **логинурл** — полное имя узла реестра. Узел реестра в реестре контейнеров Azure имеет формат *myregistry*. azurecr.IO (все строчные буквы). При использовании DOCKER или других клиентских средств для извлечения артефактов в реестр контейнеров Azure необходимо указать Логинурл. 
* **репозиторий** — имя логической группы из одного или нескольких связанных образов или артефактов, например изображений для приложения или базовой операционной системы. Может содержать путь к *пространству имен* . 
* **Tag** — идентификатор определенной версии образа или артефакта, хранящегося в репозитории.

Например, полное имя образа в реестре контейнеров Azure может выглядеть следующим образом:

*myregistry.azurecr.io/marketing/campaign10-18/email-sender:v2*

Дополнительные сведения об этих элементах см. в следующих разделах.

## <a name="repository-name"></a>Имя репозитория

*Репозиторий* — это коллекция образов контейнеров или других артефактов с тем же именем, но разными тегами. Например, следующие три образа находятся в репозитории acr-helloworld.


- *запись контроля доступа — HelloWorld: Последняя*
- *запись контроля доступа — HelloWorld: v1*
- *запись контроля доступа — HelloWorld: v2*

Имена репозиториев также могут включать [пространство имен](container-registry-best-practices.md#repository-namespaces). Пространства имен позволяют выделять связанные репозитории и владение артефактами в Организации, используя имена, разделенные косой чертой. Однако реестр управляет всеми репозиториями независимо друг от друга, а не в виде иерархии. Пример:

- *Маркетинговый/campaign10-18/Web: v2*
- *маркетинг или campaign10-18/API: V3*
- *маркетинг или campaign10-18/Электронная почта — Отправитель: v2*
- *Product-Returns/Web-Отправка: 20180604*
- *Product-Returns/Legacy-Integrator: 20180715*

Имена репозиториев могут содержать только буквы в нижнем регистре, точки, тире, символы подчеркивания и символы косой черты. 

Полные правила именования репозитория см. в статье [Спецификация распространения в рамках инициативы Open Container](https://github.com/docker/distribution/blob/master/docs/spec/api.md#overview).

## <a name="image"></a>Образ —

Образ контейнера или другой артефакт в реестре связан с одним или несколькими тегами, имеет один или несколько слоев и определяется манифестом. Понимание того, как эти компоненты связаны друг с другом, может помочь эффективно управлять реестром.

### <a name="tag"></a>Тег

*Тег* для изображения или другого артефакта указывает его версию. Одному артефакту в репозитории может быть назначен один или несколько тегов, а также может быть "без тегов". То есть можно удалить все теги из изображения, в то время как данные изображения (его слои) остаются в реестре.

Репозиторий (или репозиторий и пространство имен) вместе с тегом определяют имя образа. Образ можно отправлять и получать. Для этого в операции передачи или получения необходимо указать его имя. Тег `latest` используется по умолчанию, если вы не предоставляете его в командах DOCKER.

Создание тегов для образов контейнеров осуществляется с помощью сценариев для разработки или развертывания. Например, стабильными тегами рекомендуется поддерживать базовые образы и уникальные теги для развертывания образов. Дополнительные сведения см. в разделе [рекомендации по отстановке тегов и управление версиями для образов контейнеров](container-registry-image-tag-version.md).

Правила именования тегов см. в [документации по DOCKER](https://docs.docker.com/engine/reference/commandline/tag/).

### <a name="layer"></a>Уровень

Образы контейнеров состоят из одного или нескольких *слоев*, каждый из которых соответствует строке в Dockerfile, определяющей изображение. Образы в реестре используют слои совместно, что позволяет увеличить эффективность хранилища. Например, несколько образов, которые находятся в разных репозиториях, могут совместно использовать базовый слой Alpine Linux, но только одна копия из этого слоя может хранится в реестре.

Совместное использование слоя также оптимизирует распределение слоев для узлов с несколькими образами, совместно использующих общие слои. Например, если образ уже находится в узле, который включает в себя уровень Alpine Linux в качестве основы, последующее притяжение другого образа, ссылающегося на один и тот же слой, не переносит его слой на узел. Вместо этого он ссылается на слой, который уже существует на узле.

Чтобы обеспечить безопасную изоляцию и защиту от потенциальных манипуляций с слоями, уровни не являются общими для реестров.

### <a name="manifest"></a>манифеста

Каждый образ контейнера или артефакт, отправленный в реестр контейнеров, связан с *манифестом*. Манифест создается реестром во время отправки образа, уникально идентифицирует образ и указывает его слой. 

Базовый манифест `hello-world` образа Linux выглядит следующим образом:

  ```json
  {
    "schemaVersion": 2,
    "mediaType": "application/vnd.docker.distribution.manifest.v2+json",
    "config": {
        "mediaType": "application/vnd.docker.container.image.v1+json",
        "size": 1510,
        "digest": "sha256:fbf289e99eb9bca977dae136fbe2a82b6b7d4c372474c9235adc1741675f587e"
      },
    "layers": [
        {
          "mediaType": "application/vnd.docker.image.rootfs.diff.tar.gzip",
          "size": 977,
          "digest": "sha256:2c930d010525941c1d56ec53b97bd057a67ae1865eebf042686d2a2d18271ced"
        }
      ]
  }
  ```

С помощью команды Azure CLI [az acr repository show-manifests][az-acr-repository-show-manifests] можно получить список манифестов репозитория.

```azurecli
az acr repository show-manifests --name <acrName> --repository <repositoryName>
```

Например, перечислите манифесты для репозитория "запись контроля доступа".

```azurecli
az acr repository show-manifests --name myregistry --repository acr-helloworld
```

```output
[
  {
    "digest": "sha256:0a2e01852872580b2c2fea9380ff8d7b637d3928783c55beb3f21a6e58d5d108",
    "tags": [
      "latest",
      "v3"
    ],
    "timestamp": "2018-07-12T15:52:00.2075864Z"
  },
  {
    "digest": "sha256:3168a21b98836dda7eb7a846b3d735286e09a32b0aa2401773da518e7eba3b57",
    "tags": [
      "v2"
    ],
    "timestamp": "2018-07-12T15:50:53.5372468Z"
  },
  {
    "digest": "sha256:7ca0e0ae50c95155dbb0e380f37d7471e98d2232ed9e31eece9f9fb9078f2728",
    "tags": [
      "v1"
    ],
    "timestamp": "2018-07-11T21:38:35.9170967Z"
  }
]
```

### <a name="manifest-digest"></a>Дайджест манифеста

Манифесты идентифицируются с помощью уникального хэша SHA-256 или *дайджеста манифеста*. Каждое изображение или артефакт — указывает, определяется ли его дайджест-тегом или нет. Значение дайджеста уникально, даже если данные слоя образа идентичны данным другого образа. Данный механизм позволяет многократно отправлять образы с идентичными тегами в реестр. Например, можно многократно отправлять `myimage:latest` в реестр, при этом не получая сообщений об ошибке. Это происходит из за того, что каждый образ идентифицируется по уникальному дайджесту.

Чтобы извлечь образ из реестра, необходимо указать его дайджест в операции передачи. Некоторые системы можно настроить на извлечения с помощью дайджеста, так как он гарантирует, что будет извлечена запрашиваемая версия образа. Операция будет выполнена, даже если образы, которые были идентично помечены, впоследствии будут перенесены в реестр.

Например, можно извлечь изображение из репозитория "запись контроля доступа" с помощью дайджеста манифеста:

`docker pull myregistry.azurecr.io/acr-helloworld@sha256:0a2e01852872580b2c2fea9380ff8d7b637d3928783c55beb3f21a6e58d5d108`

> [!IMPORTANT]
> Если многократно отправлять измененные образы с идентичными тегами, можно создать потерянные образы, которые остались без тегов, но все еще потребляют пространство реестра. Образы без тегов не отображаются в Azure CLI или на портале Azure при просмотре списка или образов по тегу. Тем не менее их слои по-прежнему существуют и занимают место в реестре. Удаление изображения без тегов освобождает место в реестре, когда манифест является единственным или последним, указывая на определенный слой. Сведения об освобождении пространства, используемого изображениями без тегов, см. [в статье Удаление образов контейнеров в реестре контейнеров Azure](container-registry-delete.md).

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения о [хранении образов](container-registry-storage.md) и [поддерживаемых форматах содержимого](container-registry-image-formats.md) в реестре контейнеров Azure.

<!-- LINKS - Internal -->
[az-acr-repository-show-manifests]: /cli/azure/acr/repository#az-acr-repository-show-manifests


