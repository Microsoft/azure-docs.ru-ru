---
title: Рекомендации по использованию реестра
description: Узнайте, как эффективно использовать реестр контейнеров Azure, следуя приведенным ниже рекомендациям.
ms.topic: article
ms.date: 01/07/2021
ms.openlocfilehash: 01c8c7f547be9dd225022fb3315a4bdecc48c2bf
ms.sourcegitcommit: e559daa1f7115d703bfa1b87da1cf267bf6ae9e8
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/17/2021
ms.locfileid: "100578142"
---
# <a name="best-practices-for-azure-container-registry"></a>Рекомендации по использованию реестра контейнеров Azure

Следуя этим рекомендациям, вы сможете повысить производительность и экономичное использование частного реестра в Azure для хранения и развертывания образов контейнеров и других артефактов.

Основные сведения о реестрах см. в статье о реестрах [, репозиториях и образах](container-registry-concepts.md). См. также [рекомендации по созданию тегов и управлению версиями для образов контейнеров](container-registry-image-tag-version.md), чтобы ознакомиться со стратегиями создания тегов и управления версиями образов в реестре. 

## <a name="network-close-deployment"></a>Развертывание в ближайшей сети

Создайте реестр контейнеров в том же регионе Azure, в котором выполняется развертывание контейнеров. Размещение реестра в сети региона, расположенной близко к узлам контейнеров, поможет снизить как задержки, так и затраты.

Развертывание в ближайшей сети — одна из основных причин использования частного реестра контейнеров. Образы Docker обладают эффективной [многоуровневой конструкцией](https://docs.docker.com/engine/userguide/storagedriver/imagesandcontainers/), позволяющей выполнять добавочное развертывание. Тем не менее новым узлам требуется извлекать все уровни, необходимые для заданного образа. Эта начальная команда `docker pull` может быстро добавить в развертывание до нескольких гигабайтов. Размещение частного реестра близко к развертыванию сводит к минимуму задержку сети.
Кроме того, исходящий сетевой трафик во всех общедоступных облаках, включая Azure, является платным. Извлечение образов из одного центра обработки данных в другой увеличивает затраты на исходящий сетевой трафик, как и задержку.

## <a name="geo-replicate-multi-region-deployments"></a>Георепликация развертываний в нескольких регионах

Используйте функцию [георепликации](container-registry-geo-replication.md) реестра контейнеров Azure, если вы развертываете контейнеры в нескольких регионах. Будь то обслуживание глобальных клиентов из локальных центров обработки данных или совместная работа команды разработчиков, находящихся в разных расположениях, можно упростить управление реестром и свести к минимуму задержку, выполняя георепликацию реестра. Также можно настроить региональные [веб-перехватчики](container-registry-webhook.md) для уведомления о событиях в конкретных репликах, например при отправке изображений.

Георепликация доступна в реестрах уровня " [премиум](container-registry-skus.md) ". Чтобы узнать, как использовать георепликацию, ознакомьтесь с руководством, состоящим из трех частей, [Подготовка геореплицированного реестра контейнеров Azure](container-registry-tutorial-prepare-registry.md).

## <a name="maximize-pull-performance"></a>Максимальное повышение производительности извлечения

Помимо размещения изображений, близкого к вашим развертываниям, характеристики самих образов могут повлиять на производительность извлечения.

* **Размер изображения** — Минимизируйте размеры изображений, удаляя ненужные [слои](container-registry-concepts.md#manifest) или уменьшая размер слоев. Одним из способов уменьшения размера образа является использование подхода [многоэтапной сборки DOCKER](https://docs.docker.com/develop/develop-images/multistage-build/) для включения только необходимых компонентов среды выполнения. 

  Также проверьте, может ли образ содержать более светлый базовый образ ОС. Если вы используете среду развертывания, например, службу "экземпляры контейнеров Azure", которая кэширует определенные базовые образы, проверьте, можно ли переключить слой изображений для одного из кэшированных образов. 
* **Количество слоев** — балансировка количества используемых слоев. Если у вас слишком мало, вы не получите преимущество при повторном использовании слоя и кэшировании на узле. Слишком много, и ваша среда развертывания тратит больше времени на извлечение и распаковку. Оптимальным является пять и 10 уровней.

Также выберите [уровень служб](container-registry-skus.md) реестра контейнеров Azure, который соответствует вашим требованиям к производительности. Уровень "Премиум" обеспечивает наибольшую пропускную способность и максимальную скорость параллельных операций чтения и записи при наличии крупномасштабных развертываний.

## <a name="repository-namespaces"></a>Пространства имен репозитория

С помощью пространств имен репозитория можно разрешить общий доступ к одному реестру для нескольких групп в Организации. Реестры могут совместно использоваться в различных развертываниях и разными командами. Реестр контейнеров Azure поддерживает вложенные пространства имен, включая изоляцию групп. Однако реестр управляет всеми репозиториями независимо друг от друга, а не в виде иерархии.

Например, рассмотрим следующие теги образа контейнера. Образы, используемые во всей в организации, например `aspnetcore`, помещаются в корневое пространство имен, тогда как образы контейнеров, принадлежащие группе по эксплуатации и обслуживанию (Products) и группе по маркетингу (Marketing), используют собственные пространства имен.

- *contoso.azurecr.io/aspnetcore:2.0*
- *contoso.azurecr.io/products/widget/web:1*
- *contoso.azurecr.io/products/bettermousetrap/refundapi:12.3*
- *contoso.azurecr.io/marketing/2017-fall/concertpromotions/campaign:218.42*

## <a name="dedicated-resource-group"></a>Выделенная группа ресурсов

Так как реестры контейнеров — это ресурсы, используемые на нескольких узлах контейнера, реестр должен находиться в собственной группе ресурсов.

Хотя вы можете экспериментировать с конкретным типом узла, например со [службой "экземпляры контейнеров Azure](../container-instances/container-instances-overview.md)", скорее всего, потребуется удалить экземпляр контейнера по завершении. Однако вы можете также хранить коллекцию образов, отправленных в реестр контейнеров Azure. Поместив реестр в собственную группу ресурсов, можно свести к минимуму риск случайного удаления коллекции образов из реестра при удалении группы ресурсов экземпляра контейнера.

## <a name="authentication-and-authorization"></a>Аутентификация и авторизация

При аутентификации с помощью реестра контейнеров Azure существуют два основных сценария: отдельная аутентификация и аутентификация службы (или "автономная"). В таблице ниже приводится краткий обзор этих сценариев и рекомендуемый метод аутентификации для каждого из них.

| Тип | Пример сценария | Рекомендуемый метод |
|---|---|---|
| Отдельное удостоверение | Разработчик извлекает образы на свой компьютер для разработки или отправляет образы с него. | [az acr login](/cli/azure/acr#az-acr-login) |
| Удостоверение службы или автономное удостоверение | Конвейеры сборки и развертывания, в которых пользователь не участвует напрямую. | [Субъект-служба](container-registry-authentication.md#service-principal) |

Подробные сведения об этих и других сценариях проверки подлинности в реестре контейнеров Azure см. в статье [Проверка подлинности с помощью реестра контейнеров Azure](container-registry-authentication.md).

Реестр контейнеров Azure поддерживает методы обеспечения безопасности в Организации для распространения обязанностей и привилегий для различных удостоверений. Используя [Управление доступом на основе ролей](container-registry-roles.md), назначьте соответствующие разрешения различным пользователям, субъектам-службам или другим удостоверениям, которые выполняют различные операции с реестром. Например, назначьте разрешения Push для субъекта-службы, используемого в конвейере сборки, и назначьте разрешения на вытягивание для другого удостоверения, используемого для развертывания. Создание [маркеров](container-registry-repository-scoped-permissions.md) для детального доступа к конкретным репозиториям с ограниченным временем ожидания.

## <a name="manage-registry-size"></a>Управление размером реестра      

Ограничения хранилища для каждого [уровня службы реестра контейнеров][container-registry-skus] предназначены для согласования с типичным сценарием: **базовый** для начала работы, **стандартный** для большинства рабочих приложений и **Premium** для производительности Hyper-Scale и [георепликации][container-registry-geo-replication]. На протяжении жизненного цикла вашего реестра вам необходимо управлять его размером, периодически удаляя неиспользуемое содержимое.

Используйте команду Azure CLI [az acr show-usage][az-acr-show-usage] для отображения текущего размера реестра.

```azurecli
az acr show-usage --resource-group myResourceGroup --name myregistry --output table
```

```output
NAME      LIMIT         CURRENT VALUE    UNIT
--------  ------------  ---------------  ------
Size      536870912000  185444288        Bytes
Webhooks  100                            Count
```

Также можно найти текущее хранилище, используемое в **обзоре** реестра на портале Azure.

![Сведения об использовании реестра на портале Azure][registry-overview-quotas]

### <a name="delete-image-data"></a>Удаление данных образа

Реестр контейнеров Azure поддерживает несколько методов для удаления данных образа из реестра контейнеров. Можно удалить образы с использованием тега или манифеста хэш-кода или удалить весь репозиторий.

Дополнительные сведения об удалении данных образа из реестра, включая немаркированные (иногда называемые "висячие" или "потерянные") образы, см. [здесь](container-registry-delete.md).

## <a name="next-steps"></a>Дальнейшие действия

Реестр контейнеров Azure доступен на нескольких уровнях (также называемых SKU), которые предоставляют различные возможности. Дополнительные сведения об уровнях служб см. в статье [Уровни служб реестра контейнеров Azure](container-registry-skus.md).

Рекомендации по улучшению безопасности реестров контейнеров см. в статье [базовый план безопасности Azure для реестра контейнеров Azure](security-baseline.md).

<!-- IMAGES -->
[delete-repository-portal]: ./media/container-registry-best-practices/delete-repository-portal.png
[registry-overview-quotas]: ./media/container-registry-best-practices/registry-overview-quotas.png

<!-- LINKS - Internal -->
[az-acr-repository-delete]: /cli/azure/acr/repository#az-acr-repository-delete
[az-acr-show-usage]: /cli/azure/acr#az-acr-show-usage
[azure-cli]: /cli/azure
[azure-portal]: https://portal.azure.com
[container-registry-geo-replication]: container-registry-geo-replication.md
[container-registry-skus]: container-registry-skus.md