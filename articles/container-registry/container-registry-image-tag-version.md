---
title: Рекомендации по тегу образа
description: Рекомендации по созданию тегов и управлению версиями для образов контейнеров DOCKER при помещении образов в реестр контейнеров Azure и получении образов из него
author: stevelasker
ms.topic: article
ms.date: 07/10/2019
ms.author: stevelas
ms.openlocfilehash: b483317960409fe1fbea181706f12375606fe659
ms.sourcegitcommit: 867cb1b7a1f3a1f0b427282c648d411d0ca4f81f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "75445738"
---
# <a name="recommendations-for-tagging-and-versioning-container-images"></a>Рекомендации по отстановке тегов и управления версиями для образов контейнеров

При принудительной отправке образов контейнеров в реестр контейнеров и последующем их развертывании необходима стратегия для добавления тегов в образы и управления версиями. В этой статье обсуждаются два подхода и каждый из них помещается во время жизненного цикла контейнера:

* **Стабильные Теги** — теги, которые можно повторно использовать, например, чтобы указать основную или дополнительную версию, например *миконтаинеримаже: 1.0*.
* **Уникальные Теги** — отдельный тег для каждого изображения, которое вы отправляете в реестр, например *миконтаинеримаже: abc123*.

## <a name="stable-tags"></a>Стабильные Теги

**Рекомендация**: используйте стабильные теги для обслуживания **базовых образов** для сборок контейнера. Избегайте развертываний с стабильными тегами, так как эти теги продолжают принимать обновления и могут привести к несогласованности в рабочих средах.

*Стабильные Теги* означают, что разработчик или система сборки могут продолжить извлекать конкретный тег, который продолжает получать обновления. Стабильность не означает, что содержимое заморожено. Напротив, stable означает, что образ должен быть стабильным в целях этой версии. Чтобы остаться "стабильным", он может обслуживаться для применения исправлений безопасности или обновлений платформы.

### <a name="example"></a>Пример

Группа разработчиков поставляет версию 1,0. Они узнают, что они поставляют обновления, включая незначительные обновления. Для поддержки стабильных тегов для заданной основной и дополнительной версий они имеют два набора стабильных тегов.

* `:1` — стабильный тег для основной версии. `1` представляет самую новую или последнюю версию 1. *.
* `:1.0`— стабильный тег для версии 1,0, позволяющий разработчику выполнять привязку к обновлениям 1,0, а также не выполнять накат до 1,1 при его освобождении.

Группа также использует `:latest` тег, который указывает на последний стабильный тег независимо от текущей основной версии.

Если доступны базовые обновления образа или любой тип выпуска обслуживания платформы, образы с стабильными тегами обновляются до последнего дайджеста, представляющего самую последнюю версию стабильного выпуска этой версии.

В этом случае постоянно обслуживаются как основной, так и дополнительный Теги. В сценарии базового образа это позволяет владельцу образа предоставлять обслуживаемые образы.

### <a name="delete-untagged-manifests"></a>Удалить манифесты без тегов

При обновлении образа с стабильным тегом ранее помеченное изображение не маркируется, что приводит к возникновению потерянного изображения. Манифест предыдущего изображения и данные уникального слоя остаются в реестре. Чтобы сохранить размер реестра, можно периодически удалять манифесты без тегов, полученные из стабильных обновлений образов. Например, [Автоматическая очистка](container-registry-auto-purge.md) манифестов без тегов старше заданной длительности или установка [политики хранения](container-registry-retention-policy.md) для манифестов без тегов.

## <a name="unique-tags"></a>Уникальные Теги

**Рекомендация**: Используйте уникальные теги для **развертываний**, особенно в среде, которая может масштабироваться на нескольких узлах. Вам, скорее всего, потребуется преднамеренное развертывание одинаковой версии компонентов. Если контейнер перезапускается или Orchestrator масштабирует больше экземпляров, узлы не будут случайно получать более новую версию, несовместимую с другими узлами.

Уникальное Добавление тегов означает, что каждое изображение, отправленное в реестр, имеет уникальный тег. Теги не используются повторно. Существует несколько шаблонов, которые можно использовать для создания уникальных тегов, включая:

* **Метка даты и времени** . Этот подход довольно распространен, так как вы можете четко определить, когда образ был построен. Но как снова сопоставить его с системой сборки? Нужно ли найти сборку, которая была выполнена одновременно? В каком часовом поясе вы используете? Откалиброваны ли все системы сборки в формате UTC?
* **Фиксация git**  — этот подход работает до начала поддержки базовых обновлений образов. Если происходит обновление базового образа, система сборки начинается с той же фиксацией Git, что и в предыдущей сборке. Однако базовый образ содержит новое содержимое. Как правило, фиксация Git предоставляет *частично* стабильный тег.
* **Дайджест манифеста** — каждый образ контейнера, отправленный в реестр контейнеров, связан с манифестом, определяемым уникальным хэшем SHA-256 или дайджестом. В то время как уникальный дайджест является длинным, сложным для чтения и не связан с средой сборки.
* **Идентификатор сборки** . Этот параметр может быть лучше, так как он, скорее всего, будет добавочным, и он позволяет сопоставить его с конкретной сборкой, чтобы найти все артефакты и журналы. Однако, как и в случае с дайджестом манифеста, может быть трудно читать человека.

  Если в вашей организации есть несколько систем сборки, в этом параметре можно добавить префикс с именем системы `<build-system>-<build-id>` сборки. Например, можно отличить сборки от системы сборки Jenkins, созданной группой API, и системы сборки Azure Pipelines в веб-группе.

### <a name="lock-deployed-image-tags"></a>Заблокировать развернутые Теги изображений

Рекомендуется [заблокировать](container-registry-image-lock.md) любой развернутый тег Image, задав `write-enabled` для его атрибута значение `false` . Такой подход не позволяет случайно удалить образ из реестра и, возможно, нарушить работу ваших развертываний. Вы можете включить шаг блокировки в конвейер выпуска.

Блокировка развернутого образа по-прежнему позволяет удалять другие неразвертываемые образы из реестра с помощью функций реестра контейнеров Azure для обслуживания реестра. Например, [Автоматическая очистка](container-registry-auto-purge.md) манифестов без тегов или незаблокированных образов старше заданной длительности или установка [политики хранения](container-registry-retention-policy.md) для манифестов без тегов.

## <a name="next-steps"></a>Дальнейшие действия

Более подробное описание концепций в этой статье см. в записи блога [Добавление тегов в теги docker: рекомендации по разметке и управлению версиями образов DOCKER](https://stevelasker.blog/2018/03/01/docker-tagging-best-practices-for-tagging-and-versioning-docker-images/).

Чтобы максимально повысить производительность и экономично использовать реестр контейнеров Azure, ознакомьтесь со статьей [рекомендации по использованию реестра контейнеров Azure](container-registry-best-practices.md).

<!-- IMAGES -->


<!-- LINKS - Internal -->

