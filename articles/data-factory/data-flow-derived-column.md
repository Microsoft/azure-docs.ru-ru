---
title: Преобразование "Производный столбец" в потоке данных для сопоставления
description: Узнайте, как преобразовать данные в большом масштабе в Фабрике данных Azure с помощью преобразования "Производный столбец" в потоке данных для сопоставления.
author: kromerm
ms.author: makromer
ms.service: data-factory
ms.topic: conceptual
ms.custom: seo-lt-2019
ms.date: 09/14/2020
ms.openlocfilehash: 2e90a8779322cf8967ca9a194c6cc760f7c8b8f5
ms.sourcegitcommit: 772eb9c6684dd4864e0ba507945a83e48b8c16f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "90532024"
---
# <a name="derived-column-transformation-in-mapping-data-flow"></a>Преобразование "Производный столбец" в потоке данных для сопоставления

[!INCLUDE[appliesto-adf-asa-md](includes/appliesto-adf-asa-md.md)]

Для создания новых столбцов в потоке данных или для изменения существующих полей используйте преобразование "Производный столбец".

## <a name="create-and-update-columns"></a>Создание и обновление столбцов

При создании производного столбца можно либо создать новый столбец, либо обновить существующий. В текстовом поле **столбец** введите в создаваемом столбце. Чтобы переопределить существующий столбец в схеме, можно использовать раскрывающийся список столбцов. Чтобы построить выражение производного столбца, щелкните текстовое поле **введите выражение** . Можно либо начать вводить выражение, либо открыть построитель выражений для создания логики.

![Параметры производного столбца](media/data-flow/create-derive-column.png "Параметры производного столбца")

Чтобы добавить дополнительные производные столбцы, щелкните **Добавить** над списком столбцов или значок "плюс" рядом с существующим производным столбцом. Выберите **Добавить столбец** или **Добавить шаблон столбца**.

![Выбор нового производного столбца](media/data-flow/add-derived-column.png "Выбор нового производного столбца")

### <a name="column-patterns"></a>Шаблоны столбцов

В тех случаях, когда схема не определена явно или требуется обновить набор столбцов, необходимо создать столбец шаблонов. Шаблоны столбцов позволяют сопоставлять столбцы с помощью правил, основанных на метаданных столбца, и создавать производные столбцы для каждого соответствующего столбца. Дополнительные сведения см. в статье [Создание шаблонов столбцов](concepts-data-flow-column-pattern.md#column-patterns-in-derived-column-and-aggregate) в преобразовании «Производный столбец».

![Шаблоны столбцов](media/data-flow/column-pattern-derive.png "Шаблоны столбцов")

## <a name="building-schemas-using-the-expression-builder"></a>Построение схем с помощью построителя выражений

При использовании [построителя выражений](concepts-data-flow-expression-builder.md)потока данных сопоставления можно создавать, изменять и управлять производными столбцами в разделе **производные столбцы** . Перечисляются все столбцы, созданные или измененные при преобразовании. Выберите изменяемый столбец или шаблон в интерактивном режиме, щелкнув имя столбца. Чтобы добавить дополнительный столбец, выберите **создать** и укажите, нужно ли добавить один столбец или шаблон.

![Создать новый столбец](media/data-flow/derive-add-column.png "Создать новый столбец")

При работе со сложными столбцами можно создавать подстолбцы. Для этого щелкните значок «плюс» рядом с любым столбцом и выберите **Добавить подстолбец**. Дополнительные сведения об обработке сложных типов в потоке данных см. в разделе [Обработка JSON в потоке данных для сопоставления](format-json.md#mapping-data-flow-properties).

![Добавление подчиненного столбца](media/data-flow/derive-add-subcolumn.png "Добавление подчиненного столбца")

Дополнительные сведения об обработке сложных типов в потоке данных см. в разделе [Обработка JSON в потоке данных для сопоставления](format-json.md#mapping-data-flow-properties).

![Добавление сложного столбца](media/data-flow/derive-complex-column.png "Добавление столбцов")

### <a name="locals"></a>Локальные

Если вы используете логику совместно с несколькими столбцами или хотите компартментализе логику, можно создать локальную в преобразовании «Производный столбец». Локаль — это набор логики, который не передается дальше в следующее преобразование. Локальные переменные можно создать в построителе выражений, перейдя к **элементу выражения** и выбрав **локальные**. Создайте новый, выбрав **создать**.

![Создать локальный](media/data-flow/create-local.png "Создать локальный")

Локальные переменные могут ссылаться на любой элемент выражения, включая функции, входную схему, параметры и другие локальные переменные. При ссылке на другие локальные переменные порядок важен, так как указанный локальный язык должен быть "выше текущего".

![Создать локальный 2](media/data-flow/create-local-2.png "Создать локальный 2")

Чтобы сослаться на локальный объект в производном столбце, щелкните локальный элемент в представлении **элементов выражения** или укажите в нем двоеточие перед его именем. Например, на локальный объект с именем local1 будет ссылаться `:local1` . Чтобы изменить локальное определение, наведите на него указатель мыши в представлении элементы выражения и щелкните значок карандаша.

![Использование локальных переменных](media/data-flow/using-locals.png "Использование локальных переменных")

## <a name="data-flow-script"></a>Скрипт потока данных

### <a name="syntax"></a>Синтаксис

```
<incomingStream>
    derive(
           <columnName1> = <expression1>,
           <columnName2> = <expression2>,
           each(
                match(matchExpression),
                <metadataColumn1> = <metadataExpression1>,
                <metadataColumn2> = <metadataExpression2>
               )
          ) ~> <deriveTransformationName>
```

### <a name="example"></a>Пример

Ниже приведен производный столбец с именем `CleanData`, который принимает входящий поток `MoviesYear` и создает два производных столбца. Первый производный столбец заменяет столбец `Rating` значением рейтинга в виде целочисленного типа. Второй производный столбец — это шаблон, который соответствует каждому столбцу, имя которого начинается с "movies". Для каждого сопоставленного столбца создается столбец `movie`, равный значению сопоставленного столбца с префиксом "movie_". 

В интерфейсе Фабрики данных это преобразование выглядит следующим образом:

![Пример производного](media/data-flow/derive-script.png "Пример производного")

Скрипт потока данных для этого преобразования представлен в следующем фрагменте кода:

```
MoviesYear derive(
                Rating = toInteger(Rating),
                each(
                    match(startsWith(name,'movies')),
                    'movie' = 'movie_' + toString($$)
                )
            ) ~> CleanData
```

## <a name="next-steps"></a>Дальнейшие действия

- Узнайте подробнее о языке [выражений потока данных для сопоставления](data-flow-expression-functions.md).
