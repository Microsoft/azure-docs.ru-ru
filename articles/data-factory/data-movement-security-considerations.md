---
title: Вопросы безопасности
description: В этой статье описывается базовая инфраструктура безопасности, используемая службами перемещения данных в фабрике данных Azure для помощи в защите информации.
services: data-factory
ms.author: abnarain
author: nabhishek
manager: shwang
ms.reviewer: douglasl
ms.service: data-factory
ms.workload: data-services
ms.topic: conceptual
ms.custom: seo-lt-2019
ms.date: 05/26/2020
ms.openlocfilehash: cefbdce88d49598998e8f985821088778eee3ae8
ms.sourcegitcommit: aacbf77e4e40266e497b6073679642d97d110cda
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/12/2021
ms.locfileid: "98117662"
---
#  <a name="security-considerations-for-data-movement-in-azure-data-factory"></a>Вопросы безопасности при перемещении данных в фабрике данных Azure
> [!div class="op_single_selector" title1="Выберите используемую версию службы "Фабрика данных":"]
>
> * [Версия 1](v1/data-factory-data-movement-security-considerations.md)
> * [Текущая версия](data-movement-security-considerations.md)

 [!INCLUDE[appliesto-adf-xxx-md](includes/appliesto-adf-xxx-md.md)]

В этой статье описывается базовая инфраструктура безопасности, используемая службами перемещения данных в фабрике данных Azure для помощи в защите данных. Ресурсы управления фабрики данных созданы на основе инфраструктуры безопасности Azure и используют все возможные меры безопасности, предлагаемые Azure.

С помощью фабрики данных можно создать один или несколько [конвейеров](concepts-pipelines-activities.md)данных. Конвейер — это логическая группа действий, которые совместно выполняют определенный блок задач. Эти конвейеры реализуются в регионе, где была создана фабрика данных. 

Хотя служба "Фабрика данных" доступна только в нескольких регионах, служба перемещения данных [доступна глобально](concepts-integration-runtime.md#integration-runtime-location) для обеспечения соответствия данным и эффективности, а также снижения затрат на исходящий трафик. 

Фабрика данных Azure, в том числе Azure Integration Runtime и автономные Integration Runtime, не хранит временные данные, данные кэша или журналы, кроме учетных данных связанной службы для облачных хранилищ данных, которые шифруются с помощью сертификатов. Используя фабрику данных, можно создать управляемые данными рабочие процессы, чтобы организовать перемещение данных между [поддерживаемыми хранилищами данных](copy-activity-overview.md#supported-data-stores-and-formats) и обработку данных с помощью [служб вычислений](compute-linked-services.md) в других регионах или локальной среде. Кроме того, можно отслеживать рабочие процессы и управлять ими с помощью пакетов SDK и Azure Monitor.

Фабрика данных прошла такую сертификацию: 

| **[Сертификация CSA STAR](https://www.microsoft.com/trustcenter/compliance/csa-star-certification)** |
| :----------------------------------------------------------- |
| **[ISO 20000-1:2011](https://www.microsoft.com/trustcenter/Compliance/ISO-20000-1)** |
| **[ISO 22301:2012](/compliance/regulatory/offering-iso-22301)** |
| **[ISO 27001:2013](https://www.microsoft.com/trustcenter/compliance/iso-iec-27001)** |
| **[ISO 27017:2015](https://www.microsoft.com/trustcenter/compliance/iso-iec-27017)** |
| **[ISO 27018:2014](https://www.microsoft.com/trustcenter/compliance/iso-iec-27018)** |
| **[ISO 9001:2015](https://www.microsoft.com/trustcenter/compliance/iso-9001)** |
| **[SOC 1, 2, 3](https://www.microsoft.com/trustcenter/compliance/soc)** |
| **[HIPAA BAA](/compliance/regulatory/offering-hipaa-hitech)** |

Если вас интересует, как Azure обеспечивает соответствие требованиям и защищает собственную инфраструктуру, посетите [центр управления безопасностью Майкрософт](https://microsoft.com/en-us/trustcenter/default.aspx). Самый актуальный список всех предложений для соответствия требованиям Azure см. на странице https://aka.ms/AzureCompliance.

В этой статье мы рассмотрим вопросы безопасности в следующих двух сценариях перемещения данных: 

- **Облачный сценарий**, в котором источник и приемник являются общедоступными через Интернет. К ним относятся управляемые службы облачного хранилища, такие как служба хранилища Azure, Azure синапсе Analytics, база данных SQL Azure, Azure Data Lake Store, Amazon S3, Amazon RedShift, службы SaaS, такие как Salesforce, и веб-протоколы, такие как FTP и OData. Полный список поддерживаемых источников данных можно найти в разделе [Поддерживаемые хранилища данных и форматы](copy-activity-overview.md#supported-data-stores-and-formats).
- **Гибридный сценарий**, в котором источник или приемник находится за брандмауэром или внутри локальной корпоративной сети. Или хранилище данных находится в частной или виртуальной сети (чаще всего это актуально для источника) и не является общедоступным. Этот сценарий также охватывает серверы базы данных, расположенные на виртуальных машинах.

[!INCLUDE [updated-for-az](../../includes/updated-for-az.md)]

## <a name="cloud-scenarios"></a>Облачные сценарии

### <a name="securing-data-store-credentials"></a>Защита учетных данных хранилища данных

- **Хранение зашифрованных учетных данных в управляемом хранилище фабрики данных Azure**. Фабрика данных помогает защитить учетные данные хранилища данных, выполняя их шифрование с помощью сертификатов, управляемых корпорацией Майкрософт. Эти сертификаты меняются каждые два года. Изменения включают продление сертификата и перемещение учетных данных. Дополнительные сведения о безопасности службы хранилища Azure см. в [этой статье](../storage/blobs/security-recommendations.md).
- **Храните учетные данные в Azure Key Vault**. Учетные данные хранилища также можно хранить в [Azure Key Vault](https://azure.microsoft.com/services/key-vault/). Фабрика данных получает учетные данные во время выполнения действия. Дополнительные сведения см. в статье [Хранение учетных данных в Azure Key Vault](store-credentials-in-key-vault.md).

### <a name="data-encryption-in-transit"></a>Шифрование данных при передаче
Если облачное хранилище данных поддерживает протоколы HTTPS или TLS, то передача всех данных между службами перемещения данных в фабрике данных и облачным хранилищем данных выполняется через эти защищенные каналы.

> [!NOTE]
> Для всех подключений к базе данных SQL Azure и Azure синапсе Analytics требуется шифрование (SSL/TLS), во время передачи данных в базу данных и из нее. Разрабатывая конвейер с помощью JSON, добавьте свойство "encryption" и в строке подключения задайте для него значение **true**. Для службы хранилища Azure можно использовать **протокол HTTPS** в строке подключения.

> [!NOTE]
> Чтобы включить шифрование при передаче данных из Oracle, следуйте одному из следующих вариантов:
> 1. На сервере Oracle перейдите к Oracle Advanced Security (OAS) и задайте настройки шифрования, которые поддерживают шифрование Triple-DES (3DES) и Advanced Encryption Standard (AES). Подробности см. [здесь](https://docs.oracle.com/cd/E11882_01/network.112/e40393/asointro.htm#i1008759). ADF автоматически согласовывает метод шифрования таким образом, чтобы при установлении соединения с Oracle использовался тот метод шифрования, который вы настроили в OAS.
> 2. В ADF вы можете добавить EncryptionMethod = 1 в строке подключения (в связанной службе). В таком случае в качестве метода шифрования будут использоваться протоколы SSL/TLS. Чтобы использовать эту функцию, необходимо отключить параметры шифрования без SSL в OAS на стороне сервера Oracle, чтобы избежать конфликтов шифрования.

> [!NOTE]
> Для TLS используется версия 1.2.

### <a name="data-encryption-at-rest"></a>Шифрование неактивных данных
Некоторые хранилища данных поддерживают шифрование неактивных данных. Мы рекомендуем включить механизм шифрования данных для этих хранилищ данных. 

#### <a name="azure-synapse-analytics"></a>Azure Synapse Analytics
Прозрачное шифрование данных (TDE) в Azure синапсе Analytics помогает защититься от угроз вредоносных действий, выполняя шифрование и расшифровку неактивных данных в режиме реального времени. Этот процесс является прозрачным для клиента. Дополнительные сведения см. [в статье Защита базы данных в Azure синапсе Analytics](../synapse-analytics/sql-data-warehouse/sql-data-warehouse-overview-manage-security.md).

#### <a name="azure-sql-database"></a>База данных SQL Azure
База данных SQL Azure также поддерживает прозрачное шифрование данных, которое помогает защитить от угрозы вредоносных атак за счет шифрования и расшифровки данных в реальном времени, не внося изменения в само приложение. Этот процесс является прозрачным для клиента. Дополнительные сведения см. в статье [Прозрачное шифрование данных для хранилища данных и базы данных SQL Azure](/sql/relational-databases/security/encryption/transparent-data-encryption-azure-sql).

#### <a name="azure-data-lake-store"></a>Хранилище озера данных Azure
В Azure Data Lake Store можно также включить шифрование данных, хранящихся в учетной записи. При включении Data Lake Store автоматически шифрует данные перед сохранением и расшифровывает их до извлечения. Таким образом данные полностью прозрачны для клиента, который получает к ним доступ. Дополнительные сведения см. в статье [Обеспечение безопасности в хранилище озера данных Azure](../data-lake-store/data-lake-store-security-overview.md). 

#### <a name="azure-blob-storage-and-azure-table-storage"></a>Хранилище BLOB-объектов Azure и хранилище таблиц Azure
Хранилище BLOB-объектов Azure и хранилище таблиц Azure поддерживают функцию шифрования службы хранилища, которая автоматически шифрует данные перед их сохранением в хранилище и расшифровывает их до извлечения. Дополнительные сведения см. в статье [Шифрование службы хранилища Azure для неактивных данных (предварительная версия)](../storage/common/storage-service-encryption.md).

#### <a name="amazon-s3"></a>Amazon S3
Amazon S3 поддерживает шифрование неактивных данных для сервера и клиента. Дополнительные сведения см. в документации [Protecting Data Using Encryption](https://docs.aws.amazon.com/AmazonS3/latest/dev/UsingEncryption.html) (Защита данных с помощью шифрования).

#### <a name="amazon-redshift"></a>Amazon Redshift
Amazon Redshift поддерживает шифрование неактивных данных кластера. Дополнительные сведения см. в документации [Amazon Redshift Database Encryption](https://docs.aws.amazon.com/redshift/latest/mgmt/working-with-db-encryption.html) (Шифрование базы данных Amazon Redshift). 

#### <a name="salesforce"></a>Salesforce
Salesforce поддерживает шифрование Shield Platform Encryption, которое позволяет зашифровать все файлы, вложения и настраиваемые поля. Дополнительные сведения см. в статье [Understanding the Web Server OAuth Authentication Flow](https://developer.salesforce.com/docs/atlas.en-us.api_rest.meta/api_rest/intro_understanding_web_server_oauth_flow.htm) (Основные сведения о потоке проверки подлинности OAuth веб-сервера).  

## <a name="hybrid-scenarios"></a>Гибридные сценарии
Для реализации гибридных сценариев необходимо установить локальную среду выполнения интеграции в локальной сети, виртуальной сети (Azure) или виртуальном частном облаке (Amazon). У локальной среды выполнения интеграции должен быть доступ к локальным хранилищам данных. Дополнительные сведения о локальной среде выполнения интеграции см. в статье [Создание и настройка локальной среды выполнения интеграции](./create-self-hosted-integration-runtime.md). 

![Каналы локальной среды выполнения интеграции](media/data-movement-security-considerations/data-management-gateway-channels.png)

Канал команд обеспечивает взаимодействие между службами перемещения данных в фабрике данных и локальной среде выполнения интеграции. Этот коммуникационный канал содержит сведения, связанные с действиями. Канал данных используется для передачи данных между локальными хранилищами данных и облачными хранилищами.    

### <a name="on-premises-data-store-credentials"></a>Учетные данные локального хранилища данных
Учетные данные могут храниться в фабрике данных или [ссылаться на фабрику данных](store-credentials-in-key-vault.md) во время выполнения из Azure Key Vault. Если учетные данные хранятся в фабрике данных, они всегда хранятся в зашифрованном виде в локальной среде выполнения интеграции. 
 
- **Хранение учетных данных в локальной среде**. Если вы напрямую используете командлет **Set-AzDataFactoryV2LinkedService** со строками подключения и учетными данными, встроенными в JSON, связанная служба шифруется и сохраняется в локальной среде выполнения интеграции.  В этом случае учетные данные проходят через серверную службу Azure, которая чрезвычайно безопасна, на компьютере с локальным размещением, где он в итоге шифруется и сохраняется. Локальная среда выполнения интеграции использует Windows [DPAPI](/previous-versions/ms995355(v=msdn.10)) для шифрования конфиденциальных данных и учетных данных.

- **Храните учетные данные в Azure Key Vault**. Учетные данные хранилища также можно хранить в [Azure Key Vault](https://azure.microsoft.com/services/key-vault/). Фабрика данных получает учетные данные во время выполнения действия. Дополнительные сведения см. в статье [Хранение учетных данных в Azure Key Vault](store-credentials-in-key-vault.md).

- **Храните учетные данные локально, не перевлекая учетные данные через серверную часть Azure в локальную среду выполнения интеграции**. Если вы хотите зашифровать и хранить учетные данные локально в локальной среде выполнения интеграции без передачи учетных данных через серверную часть фабрики данных, выполните действия, описанные в разделе [Шифрование учетных данных для локальных хранилищ данных в фабрике данных Azure](encrypt-credentials-self-hosted-integration-runtime.md). Этот вариант поддерживают все соединители. Локальная среда выполнения интеграции использует Windows [DPAPI](/previous-versions/ms995355(v=msdn.10)) для шифрования конфиденциальных данных и учетных данных. 

   Используйте командлет **New-AzDataFactoryV2LinkedServiceEncryptedCredential** для шифрования учетных данных связанной службы и конфиденциальных сведений в связанной службе. Затем можно использовать возвращенный JSON (с элементом **EncryptedCredential** в строке подключения) для создания связанной службы с помощью командлета **Set-AzDataFactoryV2LinkedService** .  


#### <a name="ports-used-when-encrypting-linked-service-on-self-hosted-integration-runtime"></a>Порты, используемые для шифрования связанной службы в локальной среде выполнения интеграции
По умолчанию PowerShell использует порт 8060 на компьютере с локальной средой выполнения интеграции для безопасной связи. При необходимости этот порт можно изменить.  

![HTTPS-порт для шлюза](media/data-movement-security-considerations/https-port-for-gateway.png)

 


### <a name="encryption-in-transit"></a>Шифрование при передаче
Все передачи данных выполняются через защищенный канал HTTPS и TLS через TCP, чтобы предотвратить атаки "злоумышленник в середине" во время взаимодействия со службами Azure.

Вы также можете использовать [VPN-подключение IPSec](../vpn-gateway/vpn-gateway-about-vpn-devices.md) или [Azure ExpressRoute](../expressroute/expressroute-introduction.md), чтобы в дальнейшем обеспечить безопасность коммуникационного канала между локальной сетью и Azure.

Виртуальная сеть Azure— это логическое представление сети в облаке. Вы можете подключить локальную сеть к виртуальной сети, настроив VPN-подключение IPSec "сеть — сеть" или ExpressRoute (частный пиринг).    

В таблице ниже представлены общие рекомендации для настройки локальной среды выполнения интеграции и сети на основе различных комбинаций исходного и целевого расположений для гибридного перемещения данных.

| Источник      | Назначение                              | Сетевая конфигурация                    | Настройка среды выполнения интеграции                |
| ----------- | ---------------------------------------- | ---------------------------------------- | ---------------------------------------- |
| В локальной среде | Виртуальные машины и облачные службы, развернутые в виртуальных сетях | VPN-подключение IPSec (типа "точка — сеть" или "сеть — сеть") | Локальная среда выполнения интеграции должна быть установлена на виртуальной машине Azure в виртуальной сети.  |
| В локальной среде | Виртуальные машины и облачные службы, развернутые в виртуальных сетях | ExpressRoute (частный пиринг)           | Локальная среда выполнения интеграции должна быть установлена на виртуальной машине Azure в виртуальной сети.  |
| В локальной среде | Службы на базе Azure, у которых есть общедоступная конечная точка | ExpressRoute (пиринг Майкрософт)            | Локальную среду выполнения интеграции можно установить локально или на виртуальной машине Azure. |

На изображениях ниже показано, как использовать локальную среду выполнения интеграции для перемещения данных между локальной базой данных и службами Azure с помощью ExpressRoute и VPN-подключения IPSec (с помощью виртуальной сети Azure).

**ExpressRoute**

![Использование ExpressRoute со шлюзом](media/data-movement-security-considerations/express-route-for-gateway.png) 

**VPN-подключение IPSec**

![VPN-подключение IPSec со шлюзом](media/data-movement-security-considerations/ipsec-vpn-for-gateway.png)

### <a name="firewall-configurations-and-allow-list-setting-up-for-ip-addresses"></a><a name="firewall-configurations-and-allow-list-setting-up-for-ip-address-of-gateway"></a> Настройки брандмауэра и разрешения для списка разрешений для IP-адресов

> [!NOTE] 
> Возможно, потребуется управлять портами или настроить список разрешений для доменов на уровне корпоративного брандмауэра согласно требованиям соответствующих источников данных. В этой таблице используется только база данных SQL Azure, Azure синапсе Analytics и Azure Data Lake Store в качестве примеров.

> [!NOTE] 
> Дополнительные сведения о стратегиях доступа к данным с помощью фабрики данных Azure см. в [этой статье](./data-access-strategies.md#data-access-strategies-through-azure-data-factory).

#### <a name="firewall-requirements-for-on-premisesprivate-network"></a>Требования к брандмауэру для локальной или частной сети    
На предприятии корпоративный брандмауэр работает на центральном маршрутизаторе организации. Брандмауэр Windows работает как управляющая программа на локальном компьютере, на котором установлена локальная среда выполнения интеграции. 

В таблице ниже представлены исходящий порт и требования к домену для корпоративных брандмауэров.

[!INCLUDE [domain-and-outbound-port-requirements](../../includes/domain-and-outbound-port-requirements.md)]

> [!NOTE] 
> Возможно, потребуется управлять портами или настроить список разрешений для доменов на уровне корпоративного брандмауэра согласно требованиям соответствующих источников данных. В этой таблице используется только база данных SQL Azure, Azure синапсе Analytics и Azure Data Lake Store в качестве примеров.   

В следующей таблице представлены требования к входящему порту для брандмауэра Windows.

| Входящие порты | Описание                              |
| ------------- | ---------------------------------------- |
| 8060 (TCP)    | Требуется для командлета шифрования PowerShell, как описано в статье [Шифрование учетных данных для локальных хранилищ данных в фабрике данных Azure](encrypt-credentials-self-hosted-integration-runtime.md), или для приложения диспетчера учетных данных, чтобы обеспечить безопасную настройку учетных данных для локальных хранилищ данных в локальной среде выполнения интеграции. |

![Требования к порту шлюза](media/data-movement-security-considerations/gateway-port-requirements.png) 

#### <a name="ip-configurations-and-allow-list-setting-up-in-data-stores"></a>Настройки IP-адресов и разрешения списка в хранилищах данных
Для некоторых хранилищ данных в облаке также требуется разрешить IP-адрес компьютера, обращающегося к хранилищу. Убедитесь, что IP-адрес компьютера локальной среды выполнения интеграции разрешен или настроен в брандмауэре соответствующим образом.

Для следующих облачных хранилищ данных требуется разрешить IP-адрес компьютера, на котором размещена локальная среда выполнения интеграции. Некоторые из этих хранилищ данных по умолчанию могут не требовать наличия списка разрешений. 

- [База данных SQL Azure](../azure-sql/database/firewall-configure.md) 
- [Azure Synapse Analytics](../synapse-analytics/sql-data-warehouse/create-data-warehouse-portal.md)
- [Azure Data Lake Storage](../data-lake-store/data-lake-store-secure-data.md#set-ip-address-range-for-data-access)
- [Azure Cosmos DB](../cosmos-db/how-to-configure-firewall.md)
- [Amazon Redshift](https://docs.aws.amazon.com/redshift/latest/gsg/rs-gsg-authorize-cluster-access.html) 

## <a name="frequently-asked-questions"></a>Часто задаваемые вопросы

**Может ли локальная среда выполнения интеграции совместно использоваться разными фабриками данных?**

Да. Дополнительные сведения см. [здесь](https://azure.microsoft.com/blog/sharing-a-self-hosted-integration-runtime-infrastructure-with-multiple-data-factories/).

**Каковы требования к портам для работы локальной среды выполнения интеграции?**

Локальная среда выполнения интеграции устанавливает HTTP-подключения для доступа к Интернету. Для установки этих подключений для локальной среды выполнения интеграции должны быть открыты исходящие порты 443. Откройте входящий порт 8060 только на уровне компьютера (не на уровне корпоративного брандмауэра) для приложения диспетчера учетных данных. Если база данных SQL Azure или Azure синапсе Analytics используется в качестве источника или назначения, необходимо также открыть порт 1433. Дополнительные сведения см. в разделе [конфигурации брандмауэра и Настройка списка разрешений для IP-адресов](#firewall-configurations-and-allow-list-setting-up-for-ip-address-of-gateway) . 


## <a name="next-steps"></a>Дальнейшие действия
Дополнительные сведения о производительности действия копирования для фабрики данных Azure см. в статье [Руководство по настройке производительности действия копирования](copy-activity-performance.md).

