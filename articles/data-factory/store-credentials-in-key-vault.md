---
title: Хранение учетных данных в Azure Key Vault
description: Узнайте, как хранить учетные данные для хранилищ данных, используемых в Azure Key Vault, которые фабрика данных Azure может автоматически извлекать в среду выполнения.
author: linda33wj
ms.service: data-factory
ms.topic: conceptual
ms.date: 04/13/2020
ms.author: jingwang
ms.openlocfilehash: 00c28a9ede01a74f4ae64109d277276050047461
ms.sourcegitcommit: 910a1a38711966cb171050db245fc3b22abc8c5f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "100653770"
---
# <a name="store-credential-in-azure-key-vault"></a>Хранение учетных данных в Azure Key Vault

[!INCLUDE[appliesto-adf-asa-md](includes/appliesto-adf-asa-md.md)]

Учетные данные для хранилищ данных и вычислительных ресурсов можно хранить в [Azure Key Vault](../key-vault/general/overview.md). Фабрика данных Azure извлекает учетные данные при выполнении действия, которое использует хранилище данных или вычислительный ресурс.

Сейчас эта функция поддерживается для всех видов действий, кроме пользовательских действий. Дополнительные сведения о настройке соединителя см. в разделе "Свойства связанной службы" [в статьях, посвященных каждому типу соединителей](copy-activity-overview.md#supported-data-stores-and-formats).

## <a name="prerequisites"></a>Предварительные условия

Эта функция основана на управляемом удостоверении фабрики данных. Узнайте, как это работает из [управляемого удостоверения для фабрики данных](data-factory-service-identity.md) и убедитесь, что фабрика данных имеет связанную с ней.

## <a name="steps"></a>Шаги

Чтобы указать учетные данные, хранимые в Azure Key Vault, необходимо:

1. **Получите управляемое удостоверение фабрики данных** путем копирования значения "идентификатор управляемого объекта удостоверения", созданного вместе с фабрикой. Если вы используете пользовательский интерфейс для создания ADF, идентификатор управляемого объекта удостоверения будет отображаться в окне Azure Key Vault создание связанной службы. его также можно получить из портал Azure. см. статью [Получение управляемого удостоверения фабрики данных](data-factory-service-identity.md#retrieve-managed-identity).
2. **Предоставьте управляемому удостоверению доступ к вашей Azure Key Vault.** В хранилище ключей — > политики доступа — > добавить политику доступа, найдите это управляемое удостоверение, чтобы предоставить разрешение **Get** в раскрывающемся списке разрешения секрета. Это позволит указанной фабрике получить доступ к секрету в хранилище ключей.
3. **Создайте связанную службу, указывающую на Azure Key Vault.** Дополнительные сведения см. в разделе [Связанная служба Azure Key Vault](#azure-key-vault-linked-service).
4. **Создайте связанную службу хранилища данных, в которой содержится ссылка на соответствующий секрет, хранящийся в хранилище ключей.** См. дополнительные сведения об [указании секрета, хранящегося в хранилище ключей](#reference-secret-stored-in-key-vault).

## <a name="azure-key-vault-linked-service"></a>Связанная служба Azure Key Vault

Для связанной службы Azure Key Vault поддерживаются следующие свойства:

| Свойство. | Описание | Обязательно |
|:--- |:--- |:--- |
| type | Для свойства type необходимо задать значение **AzureKeyVault**. | Да |
| BaseUrl | Укажите URL-адрес Azure Key Vault. | Да |

**С помощью пользовательского интерфейса для создания:**

Выберите **подключения**  ->  **связанные службы**  ->  **создать**. В окне Новая связанная служба найдите и выберите "Azure Key Vault":

![Поиск Azure Key Vault](media/store-credentials-in-key-vault/search-akv.png)

Выберите подготовленное хранилище ключей Azure, в котором хранятся ваши учетные данные. Вы можете выполнить **тестовое подключение**, чтобы убедиться, что ваше подключение AKV действительно. 

![Настройка Azure Key Vault](media/store-credentials-in-key-vault/configure-akv.png)

**Пример JSON:**

```json
{
    "name": "AzureKeyVaultLinkedService",
    "properties": {
        "type": "AzureKeyVault",
        "typeProperties": {
            "baseUrl": "https://<azureKeyVaultName>.vault.azure.net"
        }
    }
}
```

## <a name="reference-secret-stored-in-key-vault"></a>Указание секрета, хранящегося в хранилище ключей

Следующие свойства поддерживаются при настройке поля в связанной службе, указывающей секрет хранилища ключей:

| Свойство. | Описание | Обязательно |
|:--- |:--- |:--- |
| type | Для свойства type поля необходимо задать значение **AzureKeyVaultSecret**. | Да |
| secretName | Имя секрета в Azure Key Vault. | Да |
| secretVersion | Версия секрета в Azure Key Vault.<br/>Если не указано, используется последняя версия секрета.<br/>Если указано, то он придерживается указанной версии.| Нет |
| store | Ссылается на связанную службу Azure Key Vault, которая используется для хранения учетных данных. | Да |

**С помощью пользовательского интерфейса для создания:**

Выберите **Azure Key Vault** для секретных полей при создании подключения к своему хранилищу данных или вычислительному ресурсу. Выберите подготовленную связанную службу Azure Key Vault и укажите **имя секрета**. Вы также можете предоставить версию секрета. 

>[!TIP]
>Для соединителей, использующих строку подключения в связанной службе, например SQL Server, хранилище BLOB-объектов и т. д., можно выбрать либо сохранение только поля секрета, например пароля в AKV, либо сохранение всей строки подключения в AKV. В пользовательском интерфейсе можно найти оба варианта.

![Настройка секрета Azure Key Vault](media/store-credentials-in-key-vault/configure-akv-secret.png)

**Пример JSON: (см. раздел "пароль")**

```json
{
    "name": "DynamicsLinkedService",
    "properties": {
        "type": "Dynamics",
        "typeProperties": {
            "deploymentType": "<>",
            "organizationName": "<>",
            "authenticationType": "<>",
            "username": "<>",
            "password": {
                "type": "AzureKeyVaultSecret",
                "secretName": "<secret name in AKV>",
                "store":{
                    "referenceName": "<Azure Key Vault linked service>",
                    "type": "LinkedServiceReference"
                }
            }
        }
    }
}
```

## <a name="next-steps"></a>Дальнейшие действия
В таблице [Поддерживаемые хранилища данных](copy-activity-overview.md#supported-data-stores-and-formats) приведен список хранилищ данных, которые поддерживаются в качестве источников и приемников для действия копирования в фабрике данных Azure.
