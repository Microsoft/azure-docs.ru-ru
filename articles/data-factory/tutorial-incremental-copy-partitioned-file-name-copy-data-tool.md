---
title: Добавочное копирование новых файлов на основе времени секционированного файла
description: Создайте фабрику данных Azure, а затем используйте средство Копирование данных для последовательной загрузки новых файлов только на основе временного секционированного имени файла.
author: dearandyxu
ms.author: yexu
ms.service: data-factory
ms.topic: conceptual
ms.custom: seo-lt-2019
ms.date: 02/18/2021
ms.openlocfilehash: 26703920fda8746badf085f96686f922ee250513
ms.sourcegitcommit: 772eb9c6684dd4864e0ba507945a83e48b8c16f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "104606639"
---
# <a name="incrementally-copy-new-files-based-on-time-partitioned-file-name-by-using-the-copy-data-tool"></a>Добавочное копирование новых файлов на основе временного секционированного файла с помощью средства Копирование данных

[!INCLUDE[appliesto-adf-asa-md](includes/appliesto-adf-asa-md.md)]

В этом руководстве вы создадите фабрику данных с помощью портала Azure. Затем вы используете средство Копирование данных для создания конвейера, который постепенно копирует новые файлы на основе временного секционированного имени из хранилища BLOB-объектов Azure в хранилище BLOB-объектов Azure.

> [!NOTE]
> Если вы еще не работали с фабрикой данных Azure, ознакомьтесь со статьей [Введение в фабрику данных Azure](introduction.md).

Вот какие шаги выполняются в этом учебнике:

> [!div class="checklist"]
> * Создали фабрику данных.
> * Создание конвейера с помощью средства копирования данных.
> * Мониторинг конвейера и выполнения действий.

## <a name="prerequisites"></a>Предварительные требования

* **Подписка Azure**: Если у вас еще нет подписки Azure, [создайте бесплатную учетную запись](https://azure.microsoft.com/free/), прежде чем начинать работу.
* **Учетная запись хранения Azure**. Используйте хранилище BLOB-объектов в качестве _источника_  и _приемника_ хранилища данных. Если у вас нет учетной записи хранения Azure, см. инструкции по [ее созданию](../storage/common/storage-account-create.md).

### <a name="create-two-containers-in-blob-storage"></a>Создание двух контейнеров в хранилище BLOB-объектов

Подготовьте хранилище BLOB-объектов для учебника, выполнив следующие действия.

1. Создайте контейнер с именем **Source**.  Создайте путь к папке в контейнере как **2020/03/17/03** . Создайте пустой текстовый файл и присвойте ему имя **file1.txt**. Отправьте file1.txt в папку с **исходным путем/2020/03/17/03** в учетной записи хранения.  Это можно сделать при помощи таких средств, как [обозреватель службы хранилища Azure](https://storageexplorer.com/).

    ![Передача файлов](./media/tutorial-incremental-copy-partitioned-file-name-copy-data-tool/upload-file.png)

    > [!NOTE]
    > Измените имя папки, указав время в формате UTC.  Например, если текущее время в формате UTC — 3:38 AM 17 марта 2020, можно создать путь к папке в формате **Source/2020/03/17/03/** согласно правилу **Source/{year}/{month}/{day}/{Hour}/**.

2. Создайте контейнер с именем **Destination**. Это можно сделать при помощи таких средств, как [обозреватель службы хранилища Azure](https://storageexplorer.com/).

## <a name="create-a-data-factory"></a>Создание фабрики данных

1. В меню слева выберите **Создать ресурс** > **Интеграция** > **Фабрика данных**:

   ![Выбор фабрики данных в области "Создать"](./media/doc-common-process/new-azure-data-factory-menu.png)

2. На странице **Новая фабрика данных** в поле **Имя** введите **ADFTutorialDataFactory**.

    Имя фабрики данных должно быть _глобально уникальным_. Вы можете получить следующее сообщение об ошибке.

   :::image type="content" source="./media/doc-common-process/name-not-available-error.png" alt-text="Новое сообщение об ошибке фабрики данных для повторяющегося имени.":::

   Если вы увидите следующую ошибку касательно значения имени, введите другое имя фабрики данных. Например,**_ваше_имя_** **ADFTutorialDataFactory**. Правила именования артефактов службы "Фабрика данных" см. в [этой](naming-rules.md) статье.
3. Выберите **подписку** Azure, в которой нужно создать фабрику данных.
4. Для **группы ресурсов** выполните одно из следующих действий:

    а. Выберите **Использовать существующую** и укажите существующую группу ресурсов в раскрывающемся списке.

    b. Выберите **Создать новую** и укажите имя группы ресурсов. 
         
    Сведения о группах ресурсов см. в статье [Общие сведения об Azure Resource Manager](../azure-resource-manager/management/overview.md).

5. В качестве **версии** выберите **V2**.
6. В качестве **расположения** выберите расположение фабрики данных. В раскрывающемся списке отображаются только поддерживаемые расположения. Хранилища данных (например, служба хранилища Azure и база данных SQL) и вычислительные ресурсы (например, Azure HDInsight), используемые фабрикой данных, могут располагаться в других регионах или расположениях.
7. Нажмите кнопку **создания**.
8. Когда создание завершится, откроется домашняя страница **Фабрика данных**.
9. Щелкните плитку **Author & Monitor** (Создание и мониторинг), чтобы запустить на отдельной вкладке пользовательский интерфейс фабрики данных Azure.

    :::image type="content" source="./media/doc-common-process/data-factory-home-page.png" alt-text="Домашняя страница фабрики данных Azure с плиткой &quot;автор & монитор&quot;.":::

## <a name="use-the-copy-data-tool-to-create-a-pipeline"></a>Создание конвейера с помощью средства копирования данных

1. На странице Приступая к **работе** выберите заголовок **копирование данных** , чтобы запустить средство копирование данных.

   ![Плитка средства копирования данных](./media/doc-common-process/get-started-page.png)

2. На странице **Свойства** выполните следующие действия.

    а. В разделе **имя задачи** введите **делтакопифромблобпипелине**.

    b. В разделе " **ритмичность задач" или "Расписание задач**" выберите **регулярное выполнение по расписанию**.

    c. В разделе **тип триггера** выберите **окно "переворачивающегося"**.

    d. В разделе **повторение** введите **1 час**.

    д) Выберите **Далее**.

    Пользовательский интерфейс фабрики данных создаст конвейер с указанным именем задачи.

    ![Страница свойств](./media/tutorial-incremental-copy-partitioned-file-name-copy-data-tool/copy-data-tool-properties-page.png)
3. На странице **Исходное хранилище данных** сделайте следующее:

    а. Щелкните **+Создать подключение**, чтобы добавить подключение.
    
    b. В коллекции выберите Хранилище BLOB-объектов Azure и щелкните Продолжить.
    
    c. На странице **Новая связанная служба (хранилище BLOB-объектов Azure)** введите имя связанной службы. Выберите подписку Azure и выберите учетную запись хранения из списка **имя учетной записи хранения** . Проверьте подключение и выберите **Создать**.

    ![Страница исходного хранилища данных](./media/tutorial-incremental-copy-partitioned-file-name-copy-data-tool/source-data-store-page-linkedservice.png)

    d. Выберите созданную связанную службу на странице **исходное хранилище данных** и нажмите кнопку **Далее**.

4. На странице **Choose the output file or folder** (Выбор файла или папки входных данных) выполните следующие действия.

    а. Найдите и выберите **Исходный** контейнер, а затем нажмите **кнопку Выбрать**.

    ![На снимке экрана показано диалоговое окно Выбор входного файла или папки.](./media/tutorial-incremental-copy-partitioned-file-name-copy-data-tool/choose-input-file-folder.png)

    b. В разделе **поведение при загрузке файлов** выберите **добавочная загрузка: временная секционированная папка или имена файлов**.

    c. Запишите путь динамической папки в формате " **источник/{год}/{месяц}/{день}/{час}/**" и измените формат, как показано на следующем снимке экрана. Проверьте **двоичное копирование** и нажмите кнопку **Далее**.

    ![На снимке экрана показано диалоговое окно Выбор входного файла или папки с выбранной папкой.](./media/tutorial-incremental-copy-partitioned-file-name-copy-data-tool/check-binary-copy.png)     

5. На странице **целевое хранилище данных** выберите **AzureBlobStorage**, которая является той же учетной записью хранения, что и хранилище источников данных, и нажмите кнопку **Далее**.

    ![Страница целевого хранилища данных](./media/tutorial-incremental-copy-partitioned-file-name-copy-data-tool/destination-data-store-page-select-linkedservice.png)
6. На странице **Выбор выходного файла или папки** выполните следующие действия.

    а. Найдите и выберите папку **назначения** , а затем нажмите кнопку **выбрать**.

    b. Запишите путь к динамическим папкам в качестве **места назначения/{year}/{month}/{день}/{Hour}/** и измените формат следующим образом:

    ![На снимке экрана показано диалоговое окно Выбор выходного файла или папки.](./media/tutorial-incremental-copy-partitioned-file-name-copy-data-tool/output-file-name.png)

    в. Нажмите кнопку **Далее**.

    ![На снимке экрана показано диалоговое окно Выбор выходного файла или папки со следующим выбранным.](./media/tutorial-incremental-copy-partitioned-file-name-copy-data-tool/click-next-after-output-folder.png)
7. На странице **Параметры** выберите **Далее**.

8. Просмотрите параметры на странице **Сводка**, а затем нажмите кнопку **Далее**.

    ![Страница "Сводка"](./media/tutorial-incremental-copy-partitioned-file-name-copy-data-tool/summary-page.png)

9. На **странице развертывания** выберите **Мониторинг**, чтобы отслеживать созданный конвейер (задачу).
    ![Страница развертывания](./media/tutorial-incremental-copy-partitioned-file-name-copy-data-tool/deployment-page.png)

10. Обратите внимание, что слева автоматически выбирается вкладка **Мониторинг**.  Необходимо дождаться выполнения конвейера при автоматическом запуске (примерно через один час). При запуске щелкните ссылку имя конвейера **делтакопифромблобпипелине** , чтобы просмотреть сведения о выполнении действия или перезапустить конвейер. Щелкните **Обновить**, чтобы обновить список.

    ![На снимке экрана показана панель запусков конвейеров.](./media/tutorial-incremental-copy-partitioned-file-name-copy-data-tool/monitor-pipeline-runs-1.png)
11. В этом конвейере определено только одно действие (действие копирования), поэтому вы увидите только одну запись. Настройка ширины столбца **исходных** и **целевых** столбцов (при необходимости) для просмотра дополнительных сведений можно увидеть исходный файл (file1.txt), скопированный из  *Source/2020/03/17/03/* to *Destination/2020/03/17/03/* с тем же именем файла. 

    ![На снимке экрана показаны сведения о выполнении конвейера.](./media/tutorial-incremental-copy-partitioned-file-name-copy-data-tool/monitor-pipeline-runs2.png)

    Вы также можете проверить это же с помощью Обозреватель службы хранилища Azure ( https://storageexplorer.com/) для сканирования файлов.

    ![На снимке экрана показаны сведения о выполнении конвейера для назначения.](./media/tutorial-incremental-copy-partitioned-file-name-copy-data-tool/monitor-pipeline-runs3.png)

12. Создайте другой пустой текстовый файл с новым именем в виде **file2.txt**. Передайте файл file2.txt в папку с **исходным путем/2020/03/17/04** в учетной записи хранения. Это можно сделать при помощи таких средств, как [обозреватель службы хранилища Azure](https://storageexplorer.com/).

    > [!NOTE]
    > Возможно, вы знаете, что требуется создать новый путь к папке. Измените имя папки, указав время в формате UTC.  Например, если текущее время UTC равно 4:20 AM. 17, 2020, можно создать путь к папке в виде **Source/2020/03/17/04/** в соответствии с правилом **{year}/{Монс}/{дай}/{Хаур}/**.

13. Чтобы вернуться к представлению **запусков конвейеров** , выберите **все конвейеры** и дождитесь автоматического запуска одного и того же конвейера через час.  

    ![На снимке экрана показана ссылка все запуски конвейера для возврата на эту страницу.](./media/tutorial-incremental-copy-partitioned-file-name-copy-data-tool/monitor-pipeline-runs5.png)

14. Выберите ссылку New **делтакопифромблобпипелине** (создать) для второго запуска конвейера, когда он поступает, и сделайте то же самое для просмотра подробностей. Вы увидите, что исходный файл (file2.txt) скопирован из  **Source/2020/03/17/04/**  to **Destination/2020/03/17/04/** с тем же именем файла. Это также можно проверить с помощью Обозреватель службы хранилища Azure ( https://storageexplorer.com/) для сканирования файлов в **целевом** контейнере.


## <a name="next-steps"></a>Дальнейшие действия
Перейдите к следующему руководству, чтобы узнать о преобразовании данных с помощью кластера Spark в Azure:

> [!div class="nextstepaction"]
>[Transform data in the cloud by using Spark activity in Azure Data Factory](tutorial-transform-data-spark-portal.md) (Преобразование данных в облаке с помощью действий Spark в фабрике данных Azure)
