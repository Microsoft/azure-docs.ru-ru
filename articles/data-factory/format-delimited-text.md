---
title: Текстовый формат с разделителями в фабрике данных Azure
description: В этом разделе описывается, как работать с текстовым форматом с разделителями в фабрике данных Azure.
author: linda33wj
ms.service: data-factory
ms.topic: conceptual
ms.date: 12/07/2020
ms.author: jingwang
ms.openlocfilehash: 5b6367d2765277493ea34a4f7a23cae4b24c4dc4
ms.sourcegitcommit: 867cb1b7a1f3a1f0b427282c648d411d0ca4f81f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "100386600"
---
# <a name="delimited-text-format-in-azure-data-factory"></a>Текстовый формат с разделителями в фабрике данных Azure

[!INCLUDE[appliesto-adf-asa-md](includes/appliesto-adf-asa-md.md)]

Если нужно **проанализировать текстовые файлы с разделителями или записать данные в текстовый формат с разделителями**, следуйте этой статье. 

Формат текста с разделителями поддерживается для следующих соединителей: [Amazon S3](connector-amazon-simple-storage-service.md), [большой двоичный объект Azure](connector-azure-blob-storage.md), [Azure Data Lake Storage 1-го поколения](connector-azure-data-lake-store.md), [Azure Data Lake Storage 2-го поколения](connector-azure-data-lake-storage.md), [хранилище файлов Azure](connector-azure-file-storage.md), [Файловая система](connector-file-system.md), [FTP](connector-ftp.md), [Google Cloud Storage](connector-google-cloud-storage.md), [HDFS](connector-hdfs.md), [http](connector-http.md)и [SFTP](connector-sftp.md).

## <a name="dataset-properties"></a>Свойства набора данных

Полный список разделов и свойств, доступных для определения наборов данных, см. в статье о [наборах данных](concepts-datasets-linked-services.md). В этом разделе содержится список свойств, поддерживаемых текстовым набором данных с разделителями.

| Свойство.         | Описание                                                  | Обязательно |
| ---------------- | ------------------------------------------------------------ | -------- |
| type             | Свойство Type набора данных должно иметь значение **DelimitedText**. | Да      |
| location         | Параметры расположения файлов. Каждый файловый соединитель имеет собственный тип расположения и поддерживаемые свойства в разделе `location` .  | Да      |
| columnDelimiter  | Символы, используемые для разделения столбцов в файле. <br>Значение по умолчанию **— `,` запятая**. Если разделитель столбцов определен как пустая строка, что означает отсутствие разделителя, вся строка принимается как один столбец.<br>В настоящее время разделитель столбцов как пустая строка или Multi-char поддерживается только для потока данных сопоставления, но не для действия копирования.  | Нет       |
| rowDelimiter     | Отдельный символ или "\r\n", используемый для разделения строк в файле. <br>Значение по умолчанию — любое из следующих значений **при чтении: ["\r\n", "\r", "\n"]** и **"\n" или "\r\n" при записи** с сопоставлением потока данных и действия копирования соответственно. <br>Если разделителю строк присвоено значение No разделитель (пустая строка), то разделитель столбцов должен быть также установлен в качестве разделителя (пустая строка), что означает, что все содержимое обрабатывается как одно значение.<br>В настоящее время разделитель строк как пустая строка поддерживается только для потока данных сопоставления, но не для действия копирования. | Нет       |
| quoteChar        | Одиночный символ для заключения в кавычки значений столбца, если он содержит разделитель столбцов. <br>Значение по умолчанию — **двойные кавычки** `"` . <br>Если параметр `quoteChar` определен как пустая строка, это означает, что кавычки не существуют, а значение столбца не заключено в кавычки и `escapeChar` используется для экранирования разделителя столбцов и самого себя. | Нет       |
| escapeChar       | Одиночный символ для экранирования кавычек внутри значения в кавычках.<br>Значение по умолчанию **— `\` обратная косая черта**. <br>Если `escapeChar` определен как пустая строка, то параметр `quoteChar` должен быть задан как пустая строка. в этом случае убедитесь, что все значения столбца не содержат разделители. | Нет       |
| firstRowAsHeader | Указывает, следует ли обрабатывать или делать первую строку в виде строки заголовка с именами столбцов.<br>Допустимые значения: **true** и **false** (по умолчанию).<br>Если первая строка в качестве заголовка имеет значение false, то обратите внимание, что функция предварительного просмотра и поиска данных пользовательского интерфейса автоматически создает имена столбцов как Prop_ {n} (начиная с 0), действие копирования требует [явного сопоставления](copy-activity-schema-and-type-mapping.md#explicit-mapping) от источника к приемнику и находит столбцы по порядковому номеру (начиная с 1) и находит столбцы с именем в виде Column_ {n} (начиная с 1).  | Нет       |
| nullValue        | Задает строковое представление значения NULL. <br>Значение по умолчанию — **пустая строка**. | Нет       |
| encodingName     | Тип кодировки, используемый для чтения и записи тестовых файлов. <br>Допустимы следующие значения: "UTF-8", "UTF-16", "UTF-16BE", "UTF-32", "UTF-32BE", "US-ASCII", "UTF-7", "BIG5", "EUC-JP", "EUC-KR", "GB2312", "GB18030", "JOHAB", "SHIFT-JIS", "CP875", "CP866", "IBM00858", "IBM037", "IBM273", "IBM437", "IBM500", "IBM737", "IBM775", "IBM850", "IBM852", "IBM855", "IBM857", "IBM860", "IBM861", "IBM863", "IBM864", "IBM865", "IBM869", "IBM870", "IBM01140", "IBM01141", "IBM01142", "IBM01143", "IBM01144", "IBM01145", "IBM01146", "IBM01147", "IBM01148", "IBM01149", "ISO-2022-JP", "ISO-2022-KR", "ISO-8859-1", "ISO-8859-2", "ISO-8859-3", "ISO-8859-4", "ISO-8859-5", "ISO-8859-6", "ISO-8859-7", "ISO-8859-8", "ISO-8859-9", "ISO-8859-13" , "ISO-8859-15", "WINDOWS-874", "WINDOWS-1250", "WINDOWS-1251", "WINDOWS-1252", "WINDOWS-1253", "WINDOWS-1254", "WINDOWS-1255", "WINDOWS-1256", "WINDOWS-1257", "WINDOWS-1258".<br>Примечание. поток данных сопоставления не поддерживает кодировку UTF-7. | Нет       |
| компрессионкодек | Кодек сжатия, используемый для чтения и записи текстовых файлов. <br>Допустимые значения: **bzip2**, **gzip**, **Deflate**, **ZipDeflate**, **таргзип**, **tar**, **привязки** или **lz4**. Значение по умолчанию не сжато. <br>**Примечание** . в настоящее время действие копирования не поддерживает "привязку" & "lz4", а поток данных сопоставления не поддерживает "ZipDeflate", "таргзип" и "tar". <br>**Обратите внимание** , что при использовании действия копирования для распаковки файлов **ZipDeflate** / **таргзип** / **tar** и записи в файловый приемник данных файлы по умолчанию извлекаются в папку: `<path specified in dataset>/<folder named as source compressed file>/` , `preserveZipFileNameAsFolder` / `preserveCompressionFileNameAsFolder` чтобы указать, следует ли сохранять имена сжатых файлов в виде структуры папок, используйте параметр [Источник действия копирования](#delimited-text-as-source) . | Нет       |
| compressionLevel | Коэффициент сжатия. <br>Допустимые значения: **оптимальный** или **самый быстрый**.<br>- **Самый быстрый:** Операция сжатия должна завершиться как можно быстрее, даже если итоговый файл не сжимается оптимально.<br>- **Оптимально**. операция сжатия должна быть оптимально сжата, даже если выполнение операции займет больше времени. Дополнительные сведения см. в разделе [Уровень сжатия](/dotnet/api/system.io.compression.compressionlevel). | Нет       |

Ниже приведен пример текстового набора данных с разделителями в хранилище BLOB-объектов Azure.

```json
{
    "name": "DelimitedTextDataset",
    "properties": {
        "type": "DelimitedText",
        "linkedServiceName": {
            "referenceName": "<Azure Blob Storage linked service name>",
            "type": "LinkedServiceReference"
        },
        "schema": [ < physical schema, optional, retrievable during authoring > ],
        "typeProperties": {
            "location": {
                "type": "AzureBlobStorageLocation",
                "container": "containername",
                "folderPath": "folder/subfolder",
            },
            "columnDelimiter": ",",
            "quoteChar": "\"",
            "escapeChar": "\"",
            "firstRowAsHeader": true,
            "compressionCodec": "gzip"
        }
    }
}
```

## <a name="copy-activity-properties"></a>Свойства действия копирования

Полный список разделов и свойств, используемых для определения действий, см. в статье [Конвейеры и действия в фабрике данных Azure](concepts-pipelines-activities.md). В этом разделе содержится список свойств, поддерживаемых источником и приемником текста с разделителями.

### <a name="delimited-text-as-source"></a>Текст с разделителями в качестве источника 

В разделе ***\* Источник \**** действия копирования поддерживаются следующие свойства.

| Свойство.       | Описание                                                  | Обязательно |
| -------------- | ------------------------------------------------------------ | -------- |
| type           | Свойство Type источника действия копирования должно иметь значение **делимитедтекстсаурце**. | Да      |
| форматсеттингс | Группа свойств. См. таблицу **параметров чтения текста с разделителями** ниже. |  Нет       |
| сторесеттингс  | Группа свойств для чтения данных из хранилища данных. Каждый файловый соединитель имеет собственные Поддерживаемые параметры чтения в разделе `storeSettings` . | Нет       |

Поддерживаемые **параметры чтения текста с разделителями** в разделе `formatSettings` :

| Свойство.      | Описание                                                  | Обязательно |
| ------------- | ------------------------------------------------------------ | -------- |
| type          | Для типа Форматсеттингс должно быть задано значение **делимитедтекстреадсеттингс**. | Да      |
| skipLineCount | Указывает количество **непустых** строк, которые нужно пропустить при чтении данных из входных файлов. <br>Если указаны skipLineCount и firstRowAsHeader, то сначала пропускаются строки, а затем считываются данные заголовка из входного файла. | Нет       |
| компрессионпропертиес | Группа свойств для распаковки данных для данного кодека сжатия. | Нет       |
| пресервезипфиленамеасфолдер<br>(*под `compressionProperties` -> `type` именем `ZipDeflateReadSettings`*) |  Применяется, когда для входного набора данных настроено сжатие **ZipDeflate** . Указывает, следует ли сохранять имя исходного zip-файла в виде структуры папок во время копирования.<br>— Если задано значение **true (по умолчанию)**, фабрика данных записывает распакованные файлы в `<path specified in dataset>/<folder named as source zip file>/` .<br>— Если задано значение **false**, фабрика данных записывает несжатые файлы непосредственно в `<path specified in dataset>` . Убедитесь, что у вас нет повторяющихся имен файлов в разных файлах ZIP-файлов, чтобы избежать перегонки или непредвиденного поведения.  | Нет |
| пресервекомпрессионфиленамеасфолдер<br>(*в `compressionProperties` -> `type` виде `TarGZipReadSettings` или `TarReadSettings`*)  | Применяется, когда для входного набора данных настроено сжатие **таргзип** / **tar** . Указывает, следует ли сохранять имя исходного сжатого файла в виде структуры папок во время копирования.<br>— Если задано значение **true (по умолчанию)**, фабрика данных записывает распакованные файлы в `<path specified in dataset>/<folder named as source compressed file>/` . <br>— Если задано значение **false**, фабрика данных записывает распакованные файлы непосредственно в `<path specified in dataset>` . Убедитесь, что у вас нет повторяющихся имен файлов в разных исходных файлах, чтобы избежать перегонки или непредвиденного поведения. | Нет |

```json
"activities": [
    {
        "name": "CopyFromDelimitedText",
        "type": "Copy",
        "typeProperties": {
            "source": {
                "type": "DelimitedTextSource",
                "storeSettings": {
                    "type": "AzureBlobStorageReadSettings",
                    "recursive": true
                },
                "formatSettings": {
                    "type": "DelimitedTextReadSettings",
                    "skipLineCount": 3,
                    "compressionProperties": {
                        "type": "ZipDeflateReadSettings",
                        "preserveZipFileNameAsFolder": false
                    }
                }
            },
            ...
        }
        ...
    }
]
```

### <a name="delimited-text-as-sink"></a>Текст с разделителями в качестве приемника

В разделе ***\* приемника \**** действия копирования поддерживаются следующие свойства.

| Свойство.       | Описание                                                  | Обязательно |
| -------------- | ------------------------------------------------------------ | -------- |
| type           | Свойство Type источника действия копирования должно иметь значение **делимитедтекстсинк**. | Да      |
| форматсеттингс | Группа свойств. См. таблицу **параметров записи текста с разделителями** ниже. |    Нет      |
| сторесеттингс  | Группа свойств для записи данных в хранилище данных. Каждый соединитель на основе файлов имеет собственные Поддерживаемые параметры записи в `storeSettings` .  | Нет       |

Поддерживаемые **Параметры записи текста с разделителями** в разделе `formatSettings` :

| Свойство.      | Описание                                                  | Обязательно                                              |
| ------------- | ------------------------------------------------------------ | ----------------------------------------------------- |
| type          | Для типа Форматсеттингс должно быть задано значение **делимитедтекствритесеттингс**. | Да                                                   |
| fileExtension | Расширение файла, используемое для именования выходных файлов, например, `.csv` `.txt` . Он должен быть указан, если `fileName` не указан в выходном наборе данных DelimitedText. Если имя файла настроено в выходном наборе данных, оно будет использоваться в качестве имени файла приемника, а параметр расширения файла будет проигнорирован.  | Да, если имя файла не указано в выходном наборе данных |
| максровсперфиле | При записи данных в папку можно выбрать запись в несколько файлов и указать максимальное число строк на файл.  | Нет |
| филенамепрефикс | Применяется `maxRowsPerFile` , если настроено.<br> Укажите префикс имени файла при записи данных в несколько файлов в результате этого шаблона: `<fileNamePrefix>_00000.<fileExtension>` . Если не указано, то префикс имени файла будет создан автоматически. Это свойство не применяется, если источником является хранилище на основе файлов или [хранилище данных с поддержкой параметров разделов](copy-activity-performance-features.md).  | Нет |

## <a name="mapping-data-flow-properties"></a>Свойства потока данных для сопоставления

В разделе сопоставление потоков данных можно выполнять чтение и запись в текстовый формат с разделителями в следующих хранилищах данных: [хранилище BLOB-объектов Azure](connector-azure-blob-storage.md#mapping-data-flow-properties), [Azure Data Lake Storage 1-го поколения](connector-azure-data-lake-store.md#mapping-data-flow-properties)и [Azure Data Lake Storage 2-го поколения](connector-azure-data-lake-storage.md#mapping-data-flow-properties).

### <a name="source-properties"></a>Свойства источника

В таблице ниже перечислены свойства, поддерживаемые источником текста с разделителями. Эти свойства можно изменить на вкладке **Параметры источника** .

| Имя | Описание | Обязательно | Допустимые значения | Свойство сценария потока данных |
| ---- | ----------- | -------- | -------------- | ---------------- |
| Подстановочные пути | Будут обработаны все файлы, соответствующие пути с подстановочными знаками. Переопределяет папку и путь к файлу, заданные в наборе данных. | Нет | String[] | вилдкардпасс |
| Корневой путь раздела | Для секционированных файловых данных можно ввести корневой путь к разделу, чтобы считывать секционированные папки в виде столбцов. | Нет | Строка | партитионрутпас |
| Список файлов | Указывает, указан ли источник на текстовый файл, в котором перечислены обрабатываемые файлы | Нет | `true` или `false` | fileList |
| Многострочные строки | Содержит ли исходный файл строки, охватывающие несколько строк. Многострочные значения должны быть в кавычках. | нет `true` или `false` | мултилинеров |
| Столбец для хранения имени файла | Создать новый столбец с именем и путем к исходному файлу | Нет | Строка | ровурлколумн |
| После завершения | Удалите или переместите файлы после обработки. Путь к файлу начинается с корня контейнера | Нет | Delete: `true` или `false` <br> Поместить `['<from>', '<to>']` | пуржефилес <br> мовефилес |
| Фильтровать по дате последнего изменения | Выберите фильтр файлов в зависимости от времени последнего изменения | Нет | Отметка времени | modifiedAfter <br> modifiedBefore |
| Разрешить не найдены файлы | Если значение — true, ошибка не возникает, если файлы не найдены | Нет | `true` или `false` | игноренофилесфаунд |

### <a name="source-example"></a>Пример исходного кода

Приведенный ниже рисунок представляет собой пример конфигурации исходного текста с разделителями в потоке сопоставления данных.

![Источник DelimitedText](media/data-flow/delimited-text-source.png)

Связанный сценарий потока данных:

```
source(
    allowSchemaDrift: true,
    validateSchema: false,
    multiLineRow: true,
    wildcardPaths:['*.csv']) ~> CSVSource
```

> [!NOTE]
> Источники потока данных поддерживают ограниченный набор глобализации Linux, поддерживающий файловые системы Hadoop.

### <a name="sink-properties"></a>Свойства приемника

В таблице ниже перечислены свойства, поддерживаемые приемником текста с разделителями. Эти свойства можно изменить на вкладке **Параметры** .

| Имя | Описание | Обязательно | Допустимые значения | Свойство сценария потока данных |
| ---- | ----------- | -------- | -------------- | ---------------- |
| Очистить папку | Если конечная папка будет удалена перед записью | Нет | `true` или `false` | truncate |
| Параметр имени файла | Формат имени записанных данных. По умолчанию по одному файлу на раздел в формате `part-#####-tid-<guid>` | Нет | Шаблон: строка <br> На секцию: String [] <br> Как данные в столбце: строка <br> Вывод в один файл: `['<fileName>']`  | filePattern <br> партитионфиленамес <br> ровурлколумн <br> партитионфиленамес |
| Цитата все | Заключить все значения в кавычки | Нет | `true` или `false` | куотеалл |

### <a name="sink-example"></a>Пример приемника

Приведенный ниже рисунок представляет собой пример конфигурации приемника текста с разделителями в потоках данных сопоставления.

![Приемник DelimitedText](media/data-flow/delimited-text-sink.png)

Связанный сценарий потока данных:

```
CSVSource sink(allowSchemaDrift: true,
    validateSchema: false,
    truncate: true,
    skipDuplicateMapInputs: true,
    skipDuplicateMapOutputs: true) ~> CSVSink
```

## <a name="next-steps"></a>Дальнейшие действия

- [Действие копирования в фабрике данных Azure](copy-activity-overview.md)
- [Поток данных для сопоставления](concepts-data-flow-overview.md)
- [Действие поиска](control-flow-lookup-activity.md)
- [Действие получения метаданных в Фабрике данных Azure](control-flow-get-metadata-activity.md)
