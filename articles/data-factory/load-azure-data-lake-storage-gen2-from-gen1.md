---
title: Копирование данных из Azure Data Lake Storage 1-го поколения в Gen2
description: Использование Фабрики данных Azure для копирования данных из Azure Data Lake Storage 1-го поколения в Azure Data Lake Storage 2-го поколения
ms.author: jingwang
author: linda33wj
ms.service: data-factory
ms.topic: conceptual
ms.custom: seo-lt-2019
ms.date: 02/18/2021
ms.openlocfilehash: 4a4bc0b55928fcaa40cd1cb03ca0522e611df476
ms.sourcegitcommit: c27a20b278f2ac758447418ea4c8c61e27927d6a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/03/2021
ms.locfileid: "101727725"
---
# <a name="copy-data-from-azure-data-lake-storage-gen1-to-gen2-with-azure-data-factory"></a>Копирование данных из Azure Data Lake Storage 1-го поколения в Azure Data Lake Storage 2-го поколения с помощью Фабрики данных Azure

[!INCLUDE[appliesto-adf-asa-md](includes/appliesto-adf-asa-md.md)]

Azure Data Lake Storage 2-го поколения — это набор возможностей, предназначенных для аналитики больших данных, встроенных в [хранилище BLOB-объектов Azure](../storage/blobs/storage-blobs-introduction.md). С его помощью можно работать с данными с использованием парадигмы файловой системы или хранилища объектов.

Если вы в настоящее время используете Azure Data Lake Storage 1-го поколения, вы можете оценить Azure Data Lake Storage 2-го поколения, скопировав данные из Data Lake Storage 1-го поколения в Gen2 с помощью фабрики данных Azure.

Фабрика данных Azure — это полностью управляемая облачная служба интеграции данных. Службу можно использовать для заполнения данных из обширного набора локальных и облачных хранилищ данных, а также для экономии времени при создании решений аналитики. Список поддерживаемых соединителей см. в таблице [поддерживаемых хранилищ данных](copy-activity-overview.md#supported-data-stores-and-formats).

Фабрика данных Azure предлагает масштабируемое и управляемое решение для перемещения данных. Из-за масштабируемой архитектуры фабрики данных она может принимать данные с высокой пропускной способностью. Дополнительные сведения см. в разделе [производительность действия копирования](copy-activity-performance.md).

В этой статье показано, как использовать средство копирования данных фабрики данных для копирования данных из Azure Data Lake Storage 1-го поколения в Azure Data Lake Storage 2-го поколения. Чтобы копировать данные из других типов хранилищ, необходимо выполнить аналогичные шаги.

## <a name="prerequisites"></a>Предварительные требования

* Подписка Azure. Если у вас еще нет подписки Azure, [создайте бесплатную учетную запись](https://azure.microsoft.com/free/), прежде чем начинать работу.
* Учетная запись Azure Data Lake Storage 1-го поколения с сохраненными в ней данными.
* Учетная запись хранения Azure с включенным Data Lake Storage 2-го поколения. Если у вас нет учетной записи хранения, [Создайте учетную запись](https://ms.portal.azure.com/#create/Microsoft.StorageAccount-ARM).

## <a name="create-a-data-factory"></a>Создание фабрики данных

1. В меню слева выберите **создать ресурс**  >  **данные и аналитика**  >  **фабрика данных**.
   
   ![Выбор фабрики данных в новой панели](./media/quickstart-create-data-factory-portal/new-azure-data-factory-menu.png)

2. На странице **Новая фабрика данных** укажите значения для полей, показанных на следующем рисунке: 
      
   ![Страница "Создание фабрики данных"](./media/load-azure-data-lake-storage-gen2-from-gen1/new-azure-data-factory.png)
 
    * **Name** (Имя). Введите глобальное уникальное имя фабрики данных Azure. Если отобразится сообщение об ошибке "Имя \"LoadADLSDemo\" фабрики данных недоступно", введите другое имя. Например,**_ваше_имя_** **ADFTutorialDataFactory**. Создайте фабрику данных еще раз. Правила именования артефактов службы "Фабрика данных" см. в [этой](naming-rules.md) статье.
    * **Подписка**: Выберите подписку Azure, в рамках которой нужно создать фабрику данных. 
    * **Группа ресурсов**. Выберите имеющуюся группу ресурсов из раскрывающегося списка. Можно также выбрать параметр **создать** и ввести имя группы ресурсов. Сведения о группах ресурсов см. в статье [Общие сведения об Azure Resource Manager](../azure-resource-manager/management/overview.md). 
    * **Версия.** Выберите **V2**.
    * **Расположение.** Укажите расположение фабрики данных. В раскрывающемся списке отображаются только поддерживаемые расположения. Хранилища данных, используемые в фабрике данных, могут находиться в других расположениях и регионах. 

3. Нажмите кнопку **создания**.
4. После завершения создания перейдите к фабрике данных. Вы увидите домашнюю страницу **фабрики данных**, как показано на следующем изображении: 
   
   ![Домашняя страница фабрики данных](./media/load-azure-data-lake-storage-gen2-from-gen1/data-factory-home-page.png)

5. Щелкните плитку " **автор & монитор** ", чтобы запустить приложение интеграции данных на отдельной вкладке.

## <a name="load-data-into-azure-data-lake-storage-gen2"></a>Загрузка данных в Azure Data Lake Storage Gen2

1. На странице Начало **работы** выберите плитку **копирование данных** , чтобы запустить средство копирования данных. 

   ![Плитка копирования данных](./media/load-azure-data-lake-storage-gen2-from-gen1/copy-data-tool-tile.png)
2. На странице **Свойства** укажите **CopyFromADLSGen1ToGen2** в поле **имя задачи** . Выберите **Далее**.

    ![Страница свойств](./media/load-azure-data-lake-storage-gen2-from-gen1/copy-data-tool-properties-page.png)
3. На странице **исходное хранилище данных** выберите **+ создать новое соединение**.

    ![Страница исходного хранилища данных](./media/load-azure-data-lake-storage-gen2-from-gen1/source-data-store-page.png)
    
4. Выберите **Azure Data Lake Storage 1-го поколения** из коллекции соединителей и нажмите кнопку **продолжить**.
    
    ![Страница настройки Azure Data Lake Storage 1-го поколения в качестве исходного хранилища данных](./media/load-azure-data-lake-storage-gen2-from-gen1/source-data-store-page-adls-gen1.png)
    
5. На странице **Указание подключения Azure Data Lake Storage 1-го поколения** выполните следующие действия.

   а. Выберите имя учетной записи Data Lake Storage 1-го поколения и укажите или подтвердите имя **клиента**.
  
   b. Выберите **проверить подключение** , чтобы проверить параметры. Выберите **Готово**.
  
   c. Вы увидите, что создано новое соединение. Выберите **Далее**.
   
   > [!IMPORTANT]
   > В этом пошаговом руководстве вы используете управляемое удостоверение для ресурсов Azure для проверки подлинности Azure Data Lake Storage 1-го поколения. Чтобы предоставить управляемому удостоверению соответствующие разрешения в Azure Data Lake Storage 1-го поколения, выполните следующие [инструкции](connector-azure-data-lake-store.md#managed-identity).
   
   ![Выбор учетной записи Data Lake Storage 1-го поколения](./media/load-azure-data-lake-storage-gen2-from-gen1/specify-adls-gen1-account.png)
      
6. На странице **Выбор входного файла или папки** перейдите к папке и файлу, которые необходимо скопировать. Выберите папку или файл и нажмите **кнопку Выбрать**.

    ![Выбор файла или папки входных данных](./media/load-azure-data-lake-storage-gen2-from-gen1/choose-input-folder.png)

7. Укажите поведение копирования, выбрав параметр **Копировать файлы рекурсивно** и **Двоичные параметры копирования** . Выберите **Далее**.

    ![На снимке экрана показан выбор входного файла или папки, где можно выбрать параметр Копировать файл рекурсивно и двоичное копирование.](./media/load-azure-data-lake-storage-gen2-from-gen1/specify-binary-copy.png)
    
8. На странице **целевое хранилище данных** выберите **+ создать новое подключение**  >  **Azure Data Lake Storage 2-го поколения**  >  **продолжить**.

    ![Страница целевого хранилища данных](./media/load-azure-data-lake-storage-gen2-from-gen1/destination-data-storage-page.png)

9. На странице **Указание подключения Azure Data Lake Storage 2-го поколения** выполните следующие действия.

   а. Выберите учетную запись с поддержкой Data Lake Storage 2-го поколения из раскрывающегося списка **имя учетной записи хранения** .
   
   b. Выберите **Готово**, чтобы создать подключение. Выберите **Далее**.
   
   ![Выбор учетной записи Data Lake Storage 2-го поколения](./media/load-azure-data-lake-storage-gen2-from-gen1/specify-adls-gen2-account.png)

10. На странице **Выбор выходного файла или папки** введите **copyfromadlsgen1** в качестве имени выходной папки и нажмите кнопку **Далее**. Фабрика данных создает соответствующую Azure Data Lake Storage 2-го поколения файловую систему и вложенные папки во время копирования, если они не существуют.

    ![На снимке экрана показан введенный путь к папке.](./media/load-azure-data-lake-storage-gen2-from-gen1/specify-adls-gen2-path.png)

11. На странице **Параметры** нажмите кнопку **Далее**, подтверждая использование параметров по умолчанию.

12. На странице **Сводка** проверьте параметры и нажмите кнопку **Далее**.

    ![Страница "Сводка"](./media/load-azure-data-lake-storage-gen2-from-gen1/copy-summary.png)
13. На **странице Развертывание** выберите **мониторинг** , чтобы отслеживать конвейер.

    ![Страница развертывания](./media/load-azure-data-lake-storage-gen2-from-gen1/deployment-page.png)
14. Обратите внимание, что слева автоматически выбирается вкладка **Мониторинг**. Столбец **действия** содержит ссылки для просмотра сведений о выполнении действия и для повторного запуска конвейера.

    ![Мониторинг выполнений конвейера](./media/load-azure-data-lake-storage-gen2-from-gen1/monitor-pipeline-runs.png)

15. Щелкните ссылку **View Activity Runs** (Просмотр выполнений действий) в столбце **Actions** (Действия), чтобы просмотреть выполнения действий, связанные с этим запуском конвейера. В этом конвейере определено только одно действие (действие копирования), поэтому вы увидите только одну запись. Чтобы вернуться к представлению запусков конвейера, щелкните ссылку **Конвейеры** в верхней части окна. Щелкните **Обновить**, чтобы обновить список. 

    ![Мониторинг выполнений действий](./media/load-azure-data-lake-storage-gen2-from-gen1/monitor-activity-runs.png)

16. Чтобы отслеживать сведения о выполнении каждого действия копирования, щелкните ссылку **Сведения** (изображение очков) в разделе **Действия** в представлении мониторинга действия. Вы можете отслеживать такие сведения, как объем данных, копируемых из источника в приемник, пропускная способность данных, шаги выполнения с длительностью и используемые параметры.

    ![Мониторинг сведений о выполнении действия](./media/load-azure-data-lake-storage-gen2-from-gen1/monitor-activity-run-details.png)

17. Убедитесь, что данные скопированы в учетную запись Azure Data Lake Storage 2-го поколения.

## <a name="best-practices"></a>Рекомендации

Чтобы оценить обновление Azure Data Lake Storage 1-го поколения до Azure Data Lake Storage 2-го поколения в целом, см. статью [Обновление решений аналитики больших данных с Azure Data Lake Storage 1-го поколения на Azure Data Lake Storage 2-го поколения](../storage/blobs/data-lake-storage-migrate-gen1-to-gen2.md). В следующих разделах представлены рекомендации по использованию фабрики данных для обновления данных с Data Lake Storage 1-го поколения до Data Lake Storage 2-го поколения.

### <a name="data-partition-for-historical-data-copy"></a>Раздел данных для копирования исторических данных

- Если общий размер данных в Data Lake Storage 1-го поколения меньше 30 ТБ, а число файлов меньше 1 000 000, можно скопировать все данные в одном действии копирования.
- Если требуется копировать данные большого объема или требуется гибкое управление переносом данных в пакетах и выполнение каждого из них в течение определенного промежутка времени, разбейте данные на секции. Секционирование также сокращает риск возникновения любой непредвиденной проблемы.

Используйте эксперимент, чтобы проверить комплексное решение и протестировать пропускную способность копирования в вашей среде. Основные шаги для подтверждения концепции: 

1. Создайте один конвейер фабрики данных с одним действием копирования, чтобы скопировать несколько TBs данных из Data Lake Storage 1-го поколения в Data Lake Storage 2-го поколения для получения базовых показателей производительности копирования. Начните с [единиц интеграции данных (диус)](copy-activity-performance-features.md#data-integration-units) как 128. 
2. В зависимости от пропускной способности копирования, которую вы получаете на шаге 1, вычислите предполагаемое время, необходимое для всей миграции данных. 
3. Используемых Создайте управляющую таблицу и определите фильтр файлов, чтобы секционировать переносимые файлы. Способ секционирования файлов: 

    - Раздел по имени папки или имени папки с фильтром с подстановочными знаками. Рекомендуется использовать этот метод.
    - Секционирование по времени последнего изменения файла.

### <a name="network-bandwidth-and-storage-io"></a>Пропускная способность сети и операции ввода-вывода хранилища 

Можно управлять параллелизмом заданий копирования фабрики данных, которые считывают данные из Data Lake Storage 1-го поколения и записывают данные в Data Lake Storage 2-го поколения. Таким образом вы можете управлять использованием операций ввода-вывода хранилища, чтобы не влиять на нормальную бизнес-работу на Data Lake Storage 1-го поколения во время миграции.

### <a name="permissions"></a>Разрешения 

В фабрике данных [соединитель Data Lake Storage 1-го поколения](connector-azure-data-lake-store.md) поддерживает субъект-службу и управляемое удостоверение для проверки подлинности ресурсов Azure. [Соединитель Data Lake Storage 2-го поколения](connector-azure-data-lake-storage.md) поддерживает проверку подлинности ресурсов Azure с помощью ключа учетной записи, субъекта-службы и управляемого удостоверения. Чтобы фабрика данных могла перемещаться и копировать все необходимые файлы или списки управления доступом (ACL), предоставьте достаточно высокий уровень разрешений для учетной записи, которую вы предоставляете для доступа, чтения или записи всех файлов и настройки списков управления доступом при выборе. Предоставьте ему роль суперпользователя или владельца в течение периода миграции. 

### <a name="preserve-acls-from-data-lake-storage-gen1"></a>Сохранение списков управления доступом из Data Lake Storage 1-го поколения

Если вы хотите реплицировать списки ACL вместе с файлами данных при обновлении с Data Lake Storage 1-го поколения до Data Lake Storage 2-го поколения, см. раздел [сохранение списков управления доступом из Data Lake Storage 1-го поколения](connector-azure-data-lake-storage.md#preserve-acls). 

### <a name="incremental-copy"></a>Добавочное копирование 

Можно использовать несколько подходов для загрузки только новых или обновленных файлов из Data Lake Storage 1-го поколения:

- Загрузка новых или обновленных файлов по времени секционированной папке или имени файла. Например,/2019/05/13/*.
- Загрузка новых или обновленных файлов по LastModifiedDate.
- Выявление новых или обновленных файлов с помощью любого стороннего средства или решения. Затем передайте имя файла или папки конвейеру фабрики данных с помощью параметра или таблицы или файла. 

Правильная частота выполнения добавочной загрузки зависит от общего числа файлов в Azure Data Lake Storage 1-го поколения и объема новых или обновленных файлов, которые будут загружаться каждый раз. 

## <a name="next-steps"></a>Дальнейшие действия

> [!div class="nextstepaction"]
> [Обзор](copy-activity-overview.md) 
>  действия копирования [Соединитель Azure Data Lake Storage 1-го поколения](connector-azure-data-lake-store.md) 
>  [Соединитель Azure Data Lake Storage 2-го поколения](connector-azure-data-lake-storage.md)