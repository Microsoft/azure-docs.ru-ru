---
title: Формат Common Data Model
description: Преобразование данных с помощью общей системы метаданных модели данных
author: kromerm
ms.service: data-factory
ms.workload: data-services
ms.topic: conceptual
ms.date: 02/04/2021
ms.author: makromer
ms.openlocfilehash: a08457ba041fa39fda367976498a4a89930c56e3
ms.sourcegitcommit: 2817d7e0ab8d9354338d860de878dd6024e93c66
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/05/2021
ms.locfileid: "99585166"
---
# <a name="common-data-model-format-in-azure-data-factory"></a>Формат общей модели данных в фабрике данных Azure
[!INCLUDE[appliesto-adf-asa-md](includes/appliesto-adf-asa-md.md)]

Система метаданных общей модели данных (CDM) позволяет легко совместно использовать данные и их значения для разных приложений и бизнес-процессов. Дополнительные сведения см. в обзоре [общих моделей данных](/common-data-model/) .

В фабрике данных Azure пользователи могут преобразовывать данные из сущностей CDM как в model.js, так и на форму манифеста, хранящуюся в [Azure Data Lake Store Gen2](connector-azure-data-lake-storage.md) (ADLS 2-го поколения) с помощью сопоставления потоков данных. Вы также можете передавать данные в формате CDM с помощью ссылок на сущности CDM, которые будут использовать данные в формате CSV или Parquet в секционированных папках. 

## <a name="mapping-data-flow-properties"></a>Свойства потока данных для сопоставления

Общая модель данных доступна в виде [встроенного набора](data-flow-source.md#inline-datasets) данных при сопоставлении потоков данных в качестве источника и приемника.

> [!NOTE]
> При записи сущностей CDM необходимо иметь существующее определение сущности CDM (схема метаданных), которое уже определено для использования в качестве ссылки. Приемник потока данных ADF считывает этот файл сущности CDM и импортирует схему в приемник для сопоставления полей.

### <a name="source-properties"></a>Свойства источника

В таблице ниже перечислены свойства, поддерживаемые источником CDM. Эти свойства можно изменить на вкладке **Параметры источника** .

| Имя | Описание | Обязательно | Допустимые значения | Свойство сценария потока данных |
| ---- | ----------- | -------- | -------------- | ---------------- |
| Формат | Формат должен быть `cdm` | да | `cdm` | format |
| Формат метаданных | Где находятся ссылки на сущности на данные. Если используется CDM версии 1,0, выберите манифест. Если используется версия CDM до 1,0, выберите model.jsв. | Да | `'manifest'` либо `'model'` | манифесттипе |
| Корневое расположение: контейнер | Имя контейнера папки CDM | да | Строка | fileSystem |
| Корневое расположение: путь к папке | Расположение корневой папки папки CDM | да | Строка | folderPath |
| Файл манифеста: путь сущности | Путь к папке сущности в корневой папке | нет | Строка | entityPath |
| Файл манифеста: имя манифеста | Имя файла манифеста. Значение по умолчанию — "default"  | нет | Строка | manifestName |
| Фильтровать по дате последнего изменения | Выберите фильтр файлов в зависимости от времени последнего изменения | нет | Отметка времени | modifiedAfter <br> modifiedBefore | 
| Связанная служба схемы | Связанная служба, в которой находится совокупности | Да, при использовании манифеста | `'adlsgen2'` либо `'github'` | корпуссторе | 
| Контейнер ссылки на сущность | Контейнер совокупности находится в | Да, если использовать манифест и совокупности в ADLS 2-го поколения | Строка | adlsgen2_fileSystem |
| Репозиторий ссылок на сущности | Имя репозитория GitHub | Да, если использовать манифест и совокупности в GitHub | Строка | github_repository |
| Ветвь ссылки на сущность | Ветвь репозитория GitHub | Да, если использовать манифест и совокупности в GitHub | Строка |  github_branch |
| Папка совокупности | корневое расположение совокупности | Да, при использовании манифеста | Строка | корпуспас |
| Сущность совокупности | Путь к ссылке на сущность | да | Строка | сущность |
| Разрешить не найдены файлы | Если значение — true, ошибка не возникает, если файлы не найдены | нет | `true` либо `false` | игноренофилесфаунд |

При выборе "ссылка на сущность" в исходных и Приемниковых преобразованиях можно выбрать следующие три параметра расположения ссылки на сущность:

* Local использует сущность, определенную в файле манифеста, который уже используется ADF
* Настраиваемый запрос указывает на файл манифеста сущности, отличный от использования ADF-файла манифеста
* Standard будет использовать ссылку на сущность из стандартной библиотеки сущностей CDM, поддерживаемых в ```Github``` .

### <a name="sink-settings"></a>Параметры приемника

* Укажите файл ссылки на сущность CDM, содержащий определение сущности, которую вы хотите написать.

![Параметры сущности](media/data-flow/common-data-model-111.png "Ссылка на сущность")

* Определите путь к разделу и формат выходных файлов, которые должны использоваться ADF для записи сущностей.

![формат сущности](media/data-flow/common-data-model-222.png "Формат сущности")

* Задайте расположение выходного файла и расположение и имя файла манифеста.

![Расположение CDM](media/data-flow/common-data-model-333.png "Расположение CDM")


#### <a name="import-schema"></a>Импорт схемы

CDM доступен только в качестве встроенного набора данных и по умолчанию не имеет связанной схемы. Чтобы получить метаданные столбца, нажмите кнопку **Импорт схемы** на вкладке **проекция** . Это позволит сослаться на имена столбцов и типы данных, заданные параметром совокупности. Чтобы импортировать схему, [сеанс отладки потока данных](concepts-data-flow-debug-mode.md) должен быть активным и иметь существующий файл определения сущности CDM для указания.

При сопоставлении столбцов потока данных со свойствами сущности в преобразовании приемника перейдите на вкладку "сопоставление" и выберите "Импорт схемы". ADF считывает ссылку на сущность, на которую вы указали в параметрах приемника, что позволяет сопоставлять целевую схему CDM.

![Параметры приемника CDM](media/data-flow/common-data-model-444.png "Сопоставление CDM")

> [!NOTE]
>  При использовании model.jsв исходном типе, который создается из потоков данных Power BI или платформы питания, может возникнуть ошибка «совокупности path null или Empty» из преобразования «источник». Скорее всего, это связано с проблемами форматирования пути к расположению секции в model.jsфайла. Чтобы устранить эту проблему, выполните следующие действия. 

1. Открытие файла model.jsв текстовом редакторе
2. Найдите секции. Свойство Location 
3. Изменить "blob.core.windows.net" на "dfs.core.windows.net"
4. Исправление любой кодировки "% 2F" в URL-адресе на "/"
5. При использовании потоков данных ADF специальные символы в пути к файлу секции должны быть заменены буквенно-цифровыми значениями или переключаться на потоки данных синапсе

### <a name="cdm-source-data-flow-script-example"></a>Пример сценария потока исходных данных CDM

```
source(output(
        ProductSizeId as integer,
        ProductColor as integer,
        CustomerId as string,
        Note as string,
        LastModifiedDate as timestamp
    ),
    allowSchemaDrift: true,
    validateSchema: false,
    entity: 'Product.cdm.json/Product',
    format: 'cdm',
    manifestType: 'manifest',
    manifestName: 'ProductManifest',
    entityPath: 'Product',
    corpusPath: 'Products',
    corpusStore: 'adlsgen2',
    adlsgen2_fileSystem: 'models',
    folderPath: 'ProductData',
    fileSystem: 'data') ~> CDMSource
```

### <a name="sink-properties"></a>Свойства приемника

В таблице ниже перечислены свойства, поддерживаемые приемником CDM. Эти свойства можно изменить на вкладке **Параметры** .

| Имя | Описание | Обязательно | Допустимые значения | Свойство сценария потока данных |
| ---- | ----------- | -------- | -------------- | ---------------- |
| Формат | Формат должен быть `cdm` | да | `cdm` | format |
| Корневое расположение: контейнер | Имя контейнера папки CDM | да | Строка | fileSystem |
| Корневое расположение: путь к папке | Расположение корневой папки папки CDM | да | Строка | folderPath |
| Файл манифеста: путь сущности | Путь к папке сущности в корневой папке | нет | Строка | entityPath |
| Файл манифеста: имя манифеста | Имя файла манифеста. Значение по умолчанию — "default" | нет | Строка | manifestName |
| Связанная служба схемы | Связанная служба, в которой находится совокупности | да | `'adlsgen2'` либо `'github'` | корпуссторе | 
| Контейнер ссылки на сущность | Контейнер совокупности находится в | Да, если совокупности в ADLS 2-го поколения | Строка | adlsgen2_fileSystem |
| Репозиторий ссылок на сущности | Имя репозитория GitHub | Да, если совокупности в GitHub | Строка | github_repository |
| Ветвь ссылки на сущность | Ветвь репозитория GitHub | Да, если совокупности в GitHub | Строка |  github_branch |
| Папка совокупности | корневое расположение совокупности | да | Строка | корпуспас |
| Сущность совокупности | Путь к ссылке на сущность | да | Строка | сущность |
| Путь к секции | Расположение, в котором будет записана Секция | нет | Строка | партитионпас |
| Очистить папку | Если конечная папка будет удалена перед записью | нет | `true` либо `false` | truncate |
| Тип формата | Выберите, чтобы указать формат Parquet | нет | `parquet` Если указано | подформат |
| Разделитель столбцов | При записи в DelimitedText, как разделить столбцы | Да, при записи в DelimitedText | Строка | columnDelimiter |
| Первая строка в качестве заголовка | Если используется DelimitedText, добавляются ли имена столбцов в качестве заголовка | нет | `true` либо `false` | колумннамесашеадер |

### <a name="cdm-sink-data-flow-script-example"></a>Пример скрипта потока данных приемника CDM

Связанный сценарий потока данных:

```
CDMSource sink(allowSchemaDrift: true,
    validateSchema: false,
    entity: 'Product.cdm.json/Product',
    format: 'cdm',
    entityPath: 'ProductSize',
    manifestName: 'ProductSizeManifest',
    corpusPath: 'Products',
    partitionPath: 'adf',
    folderPath: 'ProductSizeData',
    fileSystem: 'cdm',
    subformat: 'parquet',
    corpusStore: 'adlsgen2',
    adlsgen2_fileSystem: 'models',
    truncate: true,
    skipDuplicateMapInputs: true,
    skipDuplicateMapOutputs: true) ~> CDMSink

```

## <a name="next-steps"></a>Дальнейшие действия

Создайте [Преобразование «источник](data-flow-source.md) » в потоке данных сопоставления.
