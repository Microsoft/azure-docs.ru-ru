---
title: Преобразование «Сведение» в потоке данных для сопоставления
description: Преобразование данных из строк в столбцы с использованием преобразования «Сведение» потока данных для сопоставления Фабрики данных Azure
author: kromerm
ms.author: makromer
ms.service: data-factory
ms.topic: conceptual
ms.custom: seo-lt-2019
ms.date: 07/17/2020
ms.openlocfilehash: e098182c000cbe05df533434a41c55b797ef876f
ms.sourcegitcommit: f28ebb95ae9aaaff3f87d8388a09b41e0b3445b5
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/29/2021
ms.locfileid: "87086665"
---
# <a name="pivot-transformation-in-mapping-data-flow"></a>Преобразование «Сведение» в потоке данных для сопоставления


[!INCLUDE[appliesto-adf-asa-md](includes/appliesto-adf-asa-md.md)]

Используйте преобразование «Сведение», чтобы создать несколько столбцов из уникальных значений строк одного столбца. «Сведение» — это преобразование статистической обработки, с группировкой по столбцам и созданием столбцов сведения с помощью [агрегатных функций](data-flow-expression-functions.md#aggregate-functions).

> [!VIDEO https://www.microsoft.com/en-us/videoplayer/embed/RE4C4YN]

## <a name="configuration"></a>Конфигурация

Преобразование «Сведение» требует трех различных входных данных: группировки по столбцам, ключа сведения и способа создания сведенных столбцов.

### <a name="group-by"></a>Group by

![Группировка по параметрам](media/data-flow/pivot2.png "Группировка по параметрам")

Выберите столбцы для статистической обработки сведенных столбцов. Выходные данные будут группировать все строки с одинаковыми значениями «группировать по» в одну строку. Статистическая обработка, выполненная в сведенном столбце, будет выполняться для каждой группы.

Это необязательный раздел. Если не выбрано столбцов для «группировать по», то весь поток данных будет обработан и будет выведена только одна строка.

### <a name="pivot-key"></a>Ключ сведения

![Ключ сведения](media/data-flow/pivot3.png "Ключ сведения")

Ключ сведения — это столбец, значения строк которого сводятся в новые столбцы. По умолчанию преобразование «Сведение» создает новый столбец для каждого уникального значения строки.

В разделе **Значение** можно ввести конкретные значения строк, которые следует свести. Будут сведены только значения строк, указанные в этом разделе. Включение **Значение NULL** создаст сводный столбец для значений NULL в столбце.

### <a name="pivoted-columns"></a>Сведенные столбцы

![Сведенные столбцы](media/data-flow/pivot4.png "Сведенные столбцы")

Для каждого уникального значения ключа сведения, которое преобразуется в столбец, формируется вычисленное значение строки для каждой группы. Можно создать несколько столбцов для каждого ключа сведения. Каждый столбец сведения должен содержать по крайней мере одну [агрегатную функцию](data-flow-expression-functions.md#aggregate-functions).

**Шаблон имени столбца:** Выберите способ форматирования имени столбца для каждого столбца сведения. Имя столбца выводимых данных будет представлять собой комбинацию значения ключа сведения, префикса столбца и необязательного префикса, а также достаточного среднего числа символов. 

**Упорядочение столбцов:** Если для каждого ключа сведения создается более одного сводного столбца, выберите способ упорядочивания столбцов. 

**Префикс столбца:** Если для каждого ключа сведения создается более одного столбца сведения, введите префикс столбца для каждого столбца. Этот параметр является необязательным, если имеется только один сведенный столбец.

## <a name="help-graphic"></a>Рисунок справки

На приведенном ниже рисунке справки показано, как различные компоненты сводной таблицы взаимодействуют друг с другом.

![Рисунки справки по сведению](media/data-flow/pivot5.png "Рисунки справки по сведению")

## <a name="pivot-metadata"></a>Метаданные сведения

Если в конфигурации ключа сведения не указаны значения, сводные столбцы будут динамически создаваться во время выполнения. Число сведенных столбцов будет равным числу уникальных значений ключа сведения, умноженному на число столбцов сведения. Так как это может быть меняющееся число, пользовательский интерфейс не будет отображать метаданные столбца на вкладке **Проверить** и не будет распространять столбец. Чтобы преобразовать эти столбцы, используйте возможности [шаблона столбца](concepts-data-flow-column-pattern.md) потока данных для сопоставления. 

Если заданы конкретные значения ключа сведения, то в метаданных отобразятся сведенные столбцы. Имена столбцов будут доступны в сопоставлениях «Проверка» и «Приемник».

### <a name="generate-metadata-from-drifted-columns"></a>Создание метаданных из смещенных столбцов

Сведение динамически создает имена новых столбцов на основе значений строк. Эти новые столбцы можно добавить в метаданные, на которым можно будет ссылаться далее в потоке данных. Для этого используйте быстрое действие [сопоставить смещенные](concepts-data-flow-schema-drift.md#map-drifted-columns-quick-action) в предварительной версии данных. 

![Столбцы сведения](media/data-flow/newpivot1.png "Сопоставление смещенных столбцов сведения")

### <a name="sinking-pivoted-columns"></a>Прием сведенных столбцов

Хотя сведенные столбцы являются динамическими, они все же могут быть записаны в целевое хранилище данных. Включите **Разрешить смещение схемы** в параметрах приемника. Это позволит создавать столбцы, не включаемые в метаданные. Новые динамические имена не будут отображаться в метаданных столбца, но параметр «смещение схемы» позволит разместить данные.

### <a name="rejoin-original-fields"></a>Повторное присоединение исходных полей

Преобразование «Сведение» будет проецировать только «группировать по» и сведенные столбцы. Если вы хотите, чтобы выходные данные включали другие входные столбцы, используйте шаблон [самосоединение](data-flow-join.md#self-join).

## <a name="data-flow-script"></a>Скрипт потока данных

### <a name="syntax"></a>Синтаксис

```
<incomingStreamName>
    pivot(groupBy(Tm),
        pivotBy(<pivotKeyColumn, [<specifiedColumnName1>,...,<specifiedColumnNameN>]),
        <pivotColumnPrefix> = <pivotedColumnValue>,
        columnNaming: '< prefix >< $N | $V ><middle >< $N | $V >< suffix >',
        lateral: { 'true' | 'false'}
    ) ~> <pivotTransformationName
```
### <a name="example"></a>Пример

Экраны, показанные в разделе конфигурации, имеют следующий сценарий потока данных:

```
BasketballPlayerStats pivot(groupBy(Tm),
    pivotBy(Pos),
    {} = count(),
    columnNaming: '$V$N count',
    lateral: true) ~> PivotExample

```

## <a name="next-steps"></a>Дальнейшие действия

Попробуйте использовать [преобразование «Отмена сведения»](data-flow-unpivot.md), чтобы преобразовать значения столбцов в значения строк. 
