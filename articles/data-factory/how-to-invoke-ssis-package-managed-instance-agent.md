---
title: Запуск пакетов служб SSIS с помощью агента Управляемый экземпляр Azure SQL
description: Узнайте, как запускать пакеты служб SSIS с помощью агента Управляемый экземпляр Azure SQL.
services: data-factory
documentationcenter: ''
ms.service: data-factory
ms.workload: data-services
ms.topic: conceptual
ms.author: lle
author: lle
ms.date: 04/14/2020
ms.openlocfilehash: 5f8b18375c517ab5b620b2d6d897f5133b14705d
ms.sourcegitcommit: 6628bce68a5a99f451417a115be4b21d49878bb2
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/18/2021
ms.locfileid: "98556466"
---
# <a name="run-ssis-packages-by-using-azure-sql-managed-instance-agent"></a>Запуск пакетов служб SSIS с помощью агента Управляемый экземпляр Azure SQL

В этой статье описывается, как запустить пакет SQL Server Integration Services (SSIS) с помощью агента Управляемый экземпляр SQL Azure. Эта функция обеспечивает поведение, аналогичное планированию пакетов служб SSIS с помощью агент SQL Server в локальной среде.

С помощью этой функции можно запускать пакеты служб SSIS, хранящиеся в SSISDB, в Управляемый экземпляр SQL, в файловой системе, например в службе файлов Azure, или в хранилище пакетов среды выполнения интеграции Azure SSIS.

## <a name="prerequisites"></a>Предварительные требования

Чтобы использовать эту функцию, [Скачайте](/sql/ssms/download-sql-server-management-studio-ssms) и установите последнюю версию SQL Server Management Studio (SSMS). Сведения о поддержке версий приведены ниже:

- Чтобы запустить пакеты в SSISDB или файловой системе, установите SSMS версии 18,5 или более поздней.
- Чтобы запустить пакеты в хранилище пакетов, установите SSMS версии 18,6 или более поздней.

Также необходимо выполнить [инициализацию среды выполнения интеграции Azure SSIS](./tutorial-deploy-ssis-packages-azure.md) в фабрике данных Azure. Он использует Управляемый экземпляр SQL в качестве сервера конечных точек.

## <a name="run-an-ssis-package-in-ssisdb"></a>Запуск пакета служб SSIS в SSISDB

В этой процедуре для вызова пакета служб SSIS, хранящегося в SSISDB, используется агент SQL Управляемый экземпляр.

1. В последней версии SSMS подключитесь к SQL Управляемый экземпляр.
1. Создайте новое задание агента и новый шаг задания. В разделе **Агент SQL Server** щелкните правой кнопкой мыши папку **задания** и выберите команду **создать задание**.

   ![Параметры для создания нового задания агента](./media/how-to-invoke-ssis-package-managed-instance-agent/new-agent-job.png)

1. На странице **Создание шага задания** выберите **SQL Server Integration Services пакет** в качестве типа.

   ![Параметры для создания нового шага задания служб SSIS](./media/how-to-invoke-ssis-package-managed-instance-agent/new-ssis-job-step.png)

1. На вкладке **пакет** выберите **Каталог служб SSIS** в качестве расположения пакета.
1. Поскольку SSISDB находится в Управляемый экземпляр SQL, указывать проверку подлинности не нужно.
1. Укажите пакет служб SSIS из SSISDB.

   ![Вкладка "пакет" с выбранными параметрами для типа источника пакета](./media/how-to-invoke-ssis-package-managed-instance-agent/package-source-ssisdb.png)

1. На вкладке **Конфигурация** можно выполнить следующие действия.
  
   - Укажите значения параметров в разделе **Параметры**.
   - Переопределите значения в разделе **Диспетчеры соединений**.
   - Переопределите свойство и выберите уровень ведения журнала в разделе **Дополнительно**.

   ![Вкладка "Конфигурация" с выбранными параметрами для типа источника пакета](./media/how-to-invoke-ssis-package-managed-instance-agent/package-source-ssisdb-configuration.png)

1. Нажмите кнопку **ОК** , чтобы сохранить конфигурацию задания агента.
1. Запустите задание агента для запуска пакета служб SSIS.

## <a name="run-an-ssis-package-in-the-file-system"></a>Запуск пакета служб SSIS в файловой системе

В этой процедуре для запуска пакета служб SSIS, хранящегося в файловой системе, используется агент SQL Управляемый экземпляр.

1. В последней версии SSMS подключитесь к SQL Управляемый экземпляр.
1. Создайте новое задание агента и новый шаг задания. В разделе **Агент SQL Server** щелкните правой кнопкой мыши папку **задания** и выберите команду **создать задание**.

   ![Параметры для создания нового задания агента](./media/how-to-invoke-ssis-package-managed-instance-agent/new-agent-job.png)

1. На странице **Создание шага задания** выберите **SQL Server Integration Services пакет** в качестве типа.

   ![Параметры для создания нового шага задания служб SSIS](./media/how-to-invoke-ssis-package-managed-instance-agent/new-ssis-job-step.png)

1. На вкладке **пакет** выполните следующие действия.

   1. В качестве **расположения пакета** выберите **Файловая система**.

   1. Для **типа источника файла**:

      - Если пакет отправляется в службу файлов Azure, выберите **файловый ресурс Azure**.

        ![Параметры для типа источника файла](./media/how-to-invoke-ssis-package-managed-instance-agent/package-source-file-system.png)

        Путь к пакету — **`\\<storage account name>.file.core.windows.net\<file share name>\<package name>.dtsx`** .

        В разделе **учетные данные для доступа к файлу пакета** введите имя учетной записи и ключ учетной записи Azure, чтобы получить доступ к файлу Azure. Домен задается как **Azure**.

      - Если пакет передается в общую сетевую папку, выберите **Сетевая папка**.

        Путь к пакету — это UNC-путь к файлу пакета с расширением DTSX.

        Введите соответствующий домен, имя пользователя и пароль для доступа к файлу пакета сетевой папки.
   1. Если файл пакета зашифрован с помощью пароля, выберите **Шифрование пароль** и введите пароль.
1. На вкладке **конфигурации** введите путь к файлу конфигурации, если для запуска пакета служб SSIS требуется файл конфигурации.
   Если вы храните конфигурацию в службе файлов Azure, ее путь конфигурации будет иметь значение **`\\<storage account name>.file.core.windows.net\<file share name>\<configuration name>.dtsConfig`** .
1. На вкладке **Параметры выполнения** можно выбрать, следует ли использовать **проверку подлинности Windows** или **32-разрядную среду выполнения** для запуска пакета служб SSIS.
1. На вкладке **ведение журнала** можно выбрать путь к журналу и соответствующие учетные данные для доступа к журналу для хранения файлов журнала. 
   По умолчанию путь к журналу совпадает с путем к папке пакета, а учетные данные для доступа к нему совпадают с учетными данными для доступа к пакету.
   Если вы храните журналы в службе файлов Azure, ваш путь к журналу будет иметь значение **`\\<storage account name>.file.core.windows.net\<file share name>\<log folder name>`** .
1. На вкладке **задать значения** можно ввести путь и значение свойства, чтобы переопределить свойства пакета.

   Например, чтобы переопределить значение пользовательской переменной, введите ее путь в следующем формате: **`\Package.Variables[User::<variable name>].Value`** .
1. Нажмите кнопку **ОК** , чтобы сохранить конфигурацию задания агента.
1. Запустите задание агента для запуска пакета служб SSIS.

## <a name="run-an-ssis-package-in-the-package-store"></a>Запуск пакета служб SSIS в хранилище пакетов

В этой процедуре для запуска пакета служб SSIS, хранящегося в хранилище пакетов Azure-SSIS IR, используется агент SQL Управляемый экземпляр.

1. В последней версии SSMS подключитесь к SQL Управляемый экземпляр.
1. Создайте новое задание агента и новый шаг задания. В разделе **Агент SQL Server** щелкните правой кнопкой мыши папку **задания** и выберите команду **создать задание**.

   ![Параметры для создания нового задания агента](./media/how-to-invoke-ssis-package-managed-instance-agent/new-agent-job.png)

1. На странице **Создание шага задания** выберите **SQL Server Integration Services пакет** в качестве типа.

   ![Параметры для создания нового шага задания служб SSIS](./media/how-to-invoke-ssis-package-managed-instance-agent/new-ssis-job-step.png)

1. На вкладке **пакет** выполните следующие действия.

   1. В качестве **расположения пакета** выберите **хранилище пакетов**.

   1. Для **пути к пакету**:

      Путь к пакету — **`<package store name>\<folder name>\<package name>`** .

      ![Параметры для типа хранилища пакетов](./media/how-to-invoke-ssis-package-managed-instance-agent/package-source-package-store.png)

   1. Если файл пакета зашифрован с помощью пароля, выберите **Шифрование пароль** и введите пароль.
1. На вкладке **конфигурации** введите путь к файлу конфигурации, если для запуска пакета служб SSIS требуется файл конфигурации.
   Если вы храните конфигурацию в службе файлов Azure, ее путь конфигурации будет иметь значение **`\\<storage account name>.file.core.windows.net\<file share name>\<configuration name>.dtsConfig`** .
1. На вкладке **Параметры выполнения** можно выбрать, следует ли использовать **проверку подлинности Windows** или **32-разрядную среду выполнения** для запуска пакета служб SSIS.
1. На вкладке **ведение журнала** можно выбрать путь к журналу и соответствующие учетные данные для доступа к журналу для хранения файлов журнала.
   По умолчанию путь к журналу совпадает с путем к папке пакета, а учетные данные для доступа к нему совпадают с учетными данными для доступа к пакету.
   Если вы храните журналы в службе файлов Azure, ваш путь к журналу будет иметь значение **`\\<storage account name>.file.core.windows.net\<file share name>\<log folder name>`** .
1. На вкладке **задать значения** можно ввести путь и значение свойства, чтобы переопределить свойства пакета.

   Например, чтобы переопределить значение пользовательской переменной, введите ее путь в следующем формате: **`\Package.Variables[User::<variable name>].Value`** .
1. Нажмите кнопку **ОК** , чтобы сохранить конфигурацию задания агента.
1. Запустите задание агента для запуска пакета служб SSIS.

## <a name="cancel-ssis-package-execution"></a>Отмена выполнения пакета служб SSIS

Чтобы отменить выполнение пакета из задания агента SQL Управляемый экземпляр, выполните следующие действия вместо непосредственной остановки задания агента.

1. Найдите агент SQL Server **JOBID** из **заданийmsdb.dbo.sys**.
1. Найдите соответствующую **executionId** служб SSIS на основе идентификатора задания, используя следующий запрос:
   ```sql
   select * from '{table for job execution}' where  parameter_value = 'SQL_Agent_Job_{jobId}' order by execution_id desc
   ```
   Если пакеты служб SSIS находятся в SSISDB, используйте **ssisdb.internal.execution_parameter_values** в качестве таблицы для выполнения задания. Если пакеты служб SSIS находятся в файловой системе, используйте **ssisdb.internal.execution_parameter_values_noncatalog**.
1. Щелкните правой кнопкой мыши каталог SSISDB и выберите **Активные операции**.

   !["Активные операции" в контекстном меню для каталога SSISDB](./media/how-to-invoke-ssis-package-managed-instance-agent/catalog-active-operations.png)

1. Останавливает соответствующую операцию на основе **executionId**.

## <a name="next-steps"></a>Дальнейшие действия
Вы также можете планировать пакеты служб SSIS с помощью фабрики данных Azure. Пошаговые инструкции см. в разделе [триггер событий фабрики данных Azure](how-to-create-event-trigger.md).