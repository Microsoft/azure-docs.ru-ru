---
title: Планирование затрат и управление ими для Фабрики данных Azure
description: В этой статье описано планирование затратами и управление ими для Фабрики данных Azure.
author: shirleywangmsft
ms.author: shwang
ms.service: data-factory
ms.topic: conceptual
ms.date: 05/14/2020
ms.openlocfilehash: d89275acdb8e13a792ea3166d874fabf911bb686
ms.sourcegitcommit: d4734bc680ea221ea80fdea67859d6d32241aefc
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/14/2021
ms.locfileid: "100372898"
---
# <a name="plan-and-manage-costs-for-azure-data-factory"></a>Планирование затрат и управление ими для Фабрики данных Azure

[!INCLUDE[appliesto-adf-asa-md](includes/appliesto-adf-asa-md.md)]

Фабрика данных Azure — это бессерверная и эластичная служба интеграции данных, предназначенная для применения в облаке.  Это означает, что нет вычислений фиксированного размера, которые необходимо спланировать для пиковой нагрузки. Вместо этого вы указываете, сколько ресурсов следует выделить по запросу для каждой операции, что позволяет проектировать процессы извлечения, преобразования и загрузки с гораздо более обширными возможностями масштабирования. Кроме того, Фабрика данных Azure оплачивается по плану, основанному на потреблении, что означает, что вы платите только за то, что используете.

В этой статье описывается планирование затрат и управление ими для Фабрики данных Azure.

*   Во-первых, в начале проекта извлечения, преобразования и загрузки вы проводите эксперимент и используете сочетание данных потребления на конвейер и калькулятора цен для оценки затрат.
*   После развертывания конвейеров в рабочей среде вы можете использовать функции управления затратами для задания бюджетов и отслеживания затрат. Вы также можете просматривать прогнозируемые затраты и выявлять тренды расходов.
*   Кроме того, вы можете просмотреть сведения о потреблении на каждый конвейер и на каждое действие, чтобы понять, какие конвейеры и какие действия являются наиболее затратными, и определить кандидатов на снижение затрат.

## <a name="estimate-costs-using-pipeline-and-activity-run-consumption-and-pricing-calculator"></a>Оценка затрат с помощью потребления для конвейеров и действий, а также калькулятора цен

Чтобы оценить стоимость выполнения рабочей нагрузки извлечения, преобразования и загрузки в Фабрике данных Azure, можно использовать [калькулятор цен Фабрики данных Azure](https://azure.microsoft.com/pricing/calculator/?service=data-factory).  Для использования калькулятора необходимо ввести такие сведения, как число запусков действий, количество часов по единицам интеграции данных, тип вычисления, используемый для потока данных, число ядер, число экземпляров, длительность выполнения и т. п.

Одним из часто задаваемых вопросов для калькулятора цен заключается в том, какие значения следует использовать в качестве входных данных.  На этапе эксперимента вы можете выполнять пробные запуски с помощью образцов наборов данных, чтобы понять потребление для различных единиц измерения Фабрики данных Azure.  Затем, основываясь на потреблении для образца набора данных, можно спроецировать потребление для полного набора данных и расписания ввода в эксплуатацию.

> [!NOTE]
> Цены, используемые в приведенных ниже примерах, являются гипотетическими и не отражают фактическую цену.

Например, предположим, что вам нужно ежедневно перемещать 1 ТБ данных из AWS S3 в Azure Data Lake 2-го поколения.  Вы можете провести эксперимент с перемещением 100 ГБ данных, чтобы измерить пропускную способность приема данных и оценить соответствующее потребление.

Ниже приведены сведения о примере выполнения действия копирования (фактические показатели зависят от формы конкретного набора данных, скорости сети, ограничений исходящего трафика для учетной записи S3, ограничений входящего трафика для ADLS 2-го поколения и других факторов).

![Запуск действия копирования S3](media/plan-manage-costs/s3-copy-run-details.png)

Используя [наблюдение за потреблением на уровня выполнения конвейера](#monitor-consumption-at-pipeline-run-level), можно увидеть соответствующие показатели потребления единиц измерения перемещения данных:

![Потребление конвейера копирования S3](media/plan-manage-costs/s3-copy-pipeline-consumption.png)

Таким образом, общее число DIU-часов, затрачиваемых на перемещение 1 ТБ в день за весь месяц, равно:

1,2667 (DIU-часы) * (1 ТБ/100 ГБ) * 30 (дни в месяце) = 380 DIU-часов

Теперь вы можете ввести 30 выполнений действий и 380 DIU-часов в калькулятор цен для Фабрики данных Azure, чтобы получить оценку ежемесячного счета:

![Калькулятор цен на копирование для S3](media/plan-manage-costs/s3-copy-pricing-calculator.png)

## <a name="use-budgets-and-cost-alerts"></a>Использование оповещений о бюджете и затратах

Вы можете создать [бюджеты](../cost-management-billing/costs/tutorial-acm-create-budgets.md), чтобы управлять затратами и создавать оповещения, которые автоматически уведомляют заинтересованные лица о нетипичных и чрезмерных затратах.  Оповещения основываются на расходах по сравнению с пороговыми значениями бюджета и затрат.  Создавая бюджет, вы можете сделать это на уровне подписки или с более низкой степенью детализации, добавив дополнительные фильтры, такие как идентификатор ресурса и имя единицы измерения.  Но вы не можете создавать бюджеты для отдельных конвейеров в пределах фабрики.

## <a name="monitor-costs-at-factory-level"></a>Мониторинг затрат на уровне фабрики

Начав использовать Фабрику данных Azure, вы можете просмотреть затраты в области [анализа затрат](../cost-management-billing/costs/quick-acm-cost-analysis.md) на портале Azure.

1. Чтобы просмотреть [анализ затрат](../cost-management-billing/costs/quick-acm-cost-analysis.md), откройте окно **Управление затратами + выставление счетов**, выберите **Управление затратами** в меню, а затем выберите **Открыть анализ затрат**.
2. Представление по умолчанию показывает накопленные затраты за текущий месяц.  Можно переключиться на другой диапазон времени и другую степень детализации, например по дням или месяцам.
3. Чтобы уменьшить затраты на отдельную службу, например Фабрику данных Azure, выберите **Добавить фильтр** и **Имя службы**.  Затем в списке выберите **Фабрика данных Azure версии 2**.
4. Можно добавить дополнительные фильтры для анализа затрат для конкретного экземпляра фабрики и определенной степени детализации единицы измерения Фабрики данных Azure.

   ![Анализ затрат](media/plan-manage-costs/cost-analysis.png)

## <a name="monitor-consumption-at-pipeline-run-level"></a>Мониторинг потребления на уровне выполнения конвейера

В зависимости от типов действий в конвейере, объема перемещаемых и преобразуемых данных, а также сложности такого преобразования выполнение конвейера приводит к тому, что в Фабрике данных Azure будут применяться разные единицы измерения оплаты.

Вы можете просмотреть объем потребления для разных единиц измерения для отдельных запусков конвейера в пользовательском интерфейсе Фабрики данных Azure. Чтобы открыть интерфейс мониторинга, выберите плитку **Мониторинг и управление** в колонке фабрики данных на [портале Azure](https://portal.azure.com/). Если вы уже находитесь в интерфейсе Фабрики данных Azure, щелкните значок **Монитор** на левой боковой панели. Представление мониторинга по умолчанию представляет собой список запусков конвейеров.

При нажатии кнопки **Потребление** рядом с именем конвейера отображается всплывающее окно, показывающее потребление для запуска конвейера, агрегированное по всем действиям в конвейере.

![Потребление запуска конвейера](media/plan-manage-costs/pipeline-run-consumption.png)

![Сведения о потреблении конвейера](media/plan-manage-costs/pipeline-consumption-details.png)

В представлении потребления запуска конвейера отображается сумма, потребляемая для каждой единицы измерения Фабрики данных Azure для конкретного запуска конвейера, но не отображается фактическая взимаемая цена, так как сумма счета зависит от типа учетной записи Azure и типа используемой валюты.  Полный список поддерживаемых типов учетных записей см. в статье [Understand Cost Management data](../cost-management-billing/costs/understand-cost-mgt-data.md) (Интерпретация данных службы "Управление затратами").

## <a name="monitor-consumption-at-activity-run-level"></a>Мониторинг потребления на уровне выполнения действий
Если вы изучили агрегированное потребление на уровне выполнения конвейера, существуют сценарии, в которых необходимо выполнить дальнейшую детализацию и определить, какое из действий в конвейере является наиболее дорогостоящим.

Чтобы просмотреть потребление на уровне выполнения действий, перейдите в раздел **Создание и мониторинг** пользовательского интерфейса фабрики данных. На вкладке **Монитор**, где отображается список запусков конвейера, щелкните ссылку с **именем конвейера**, чтобы получить доступ к списку выполнения действий в рамках выполнения конвейера.  Нажмите кнопку **Вывод** рядом с именем действия и найдите свойство **billableDuration** в выходных данных JSON:

Ниже приведен пример выполнения действия копирования:

![Выходные данные копирования](media/plan-manage-costs/copy-output.png)

Ниже приведен пример из выполнения действия потока данных для сопоставления.

![Выходные данные потока данных](media/plan-manage-costs/dataflow-output.png)

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения о том, как работает ценообразование в Фабрике данных Azure, см. в следующих статьях:

- [Страница цен на Фабрику данных Azure](https://azure.microsoft.com/pricing/details/data-factory/ssis/)
- [Изучение ценообразования Фабрики данных Azure посредством примеров](./pricing-concepts.md)
- [Калькулятор цен на Фабрику данных Azure](https://azure.microsoft.com/pricing/calculator/?service=data-factory)