---
title: Шаблоны столбцов в потоке данных сопоставления фабрики данных Azure
description: Создание обобщенных шаблонов преобразования данных с помощью шаблонов столбцов в потоках данных сопоставления фабрики данных Azure
author: kromerm
ms.author: makromer
ms.reviewer: daperlov
ms.service: data-factory
ms.topic: conceptual
ms.date: 11/17/2020
ms.openlocfilehash: 68c211608cfceedaa9d13a595be6d1e5de17f1d5
ms.sourcegitcommit: 867cb1b7a1f3a1f0b427282c648d411d0ca4f81f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "94845012"
---
# <a name="using-column-patterns-in-mapping-data-flow"></a>Использование шаблонов столбцов в потоке данных сопоставления

[!INCLUDE[appliesto-adf-asa-md](includes/appliesto-adf-asa-md.md)]

Несколько преобразований потока данных сопоставления позволяют ссылаться на столбцы шаблонов на основе шаблонов, а не жестко запрограммированных имен столбцов. Это сопоставление называется *шаблонами столбцов*. Можно определить закономерности для сопоставления столбцов по имени, типу данных, потоку, источнику или положению вместо того, чтобы вводить точные имена полей. Существуют два сценария, в которых шаблоны столбцов полезны:

* Если входящие поля источника изменяются часто, например в случае изменения столбцов в текстовых файлах или базах данных NoSQL. Этот сценарий называется [смещением схемы](concepts-data-flow-schema-drift.md).
* Если вы хотите выполнить общую операцию над большой группой столбцов. Например, необходимо привести каждый столбец, имеющий в имени столбца "Total", к типу Double.

> [!VIDEO https://www.microsoft.com/videoplayer/embed/RE4Iui1]

## <a name="column-patterns-in-derived-column-and-aggregate"></a>Шаблоны столбцов в производном столбце и агрегатной функции

Чтобы добавить шаблон столбца в производный столбец, статистическое выражение или преобразование «окно», щелкните **Добавить** над списком столбцов или значок «плюс» рядом с существующим производным столбцом. Выберите пункт **Добавить шаблон столбца**.

![На снимке экрана показан значок "плюс" для добавления шаблона столбца.](media/data-flow/add-column-pattern.png "Шаблоны столбцов")

Используйте [Построитель выражений](concepts-data-flow-expression-builder.md) для ввода условия соответствия. Создайте логическое выражение, которое сопоставляет столбцы, основанные `name` на `type` `stream` столбцах,,, `origin` и `position` . Шаблон будет влиять на любой столбец, смещенное или определенное, где условие возвращает значение true.

Два поля выражений под условием соответствия указывают новые имена и значения затронутых столбцов. Используйте `$$` для ссылки на существующее значение соответствующего поля. Поле левое выражение определяет имя, а поле правого выражения определяет значение.

![На снимке экрана показана вкладка параметров производного столбца.](media/data-flow/edit-column-pattern.png "Шаблоны столбцов")

Шаблон приведенного выше столбца соответствует каждому столбцу типа Double и создает один производный столбец для каждого соответствия. Указывая в `$$` качестве поля имя столбца, каждый сопоставленный столбец обновляется с тем же именем. Значение каждого столбца — это существующее значение, округленное до двух десятичных позиций.

Чтобы проверить правильность условия сопоставления, можно проверить схему вывода определенных столбцов на вкладке **Проверка** или получить моментальный снимок данных на вкладке **Предварительный просмотр данных** . 

![На снимке экрана показана вкладка выходная схема.](media/data-flow/columnpattern3.png "Шаблоны столбцов")

### <a name="hierarchical-pattern-matching"></a>Иерархическое сопоставление шаблонов

Можно также создать сопоставление шаблонов внутри сложных иерархических структур. Разверните раздел, `Each MoviesStruct that matches` в котором будет предложено указать каждую иерархию в потоке данных. Затем можно создать совпадающие шаблоны для свойств в этой выбранной иерархии.

![На снимке экрана показан шаблон иерархического столбца.](media/data-flow/patterns-hierarchy.png "Шаблоны столбцов в иерархиях")

## <a name="rule-based-mapping-in-select-and-sink"></a>Сопоставление на основе правил в выборе и приемнике

При сопоставлении столбцов в источнике и выборе преобразований можно добавить фиксированные сопоставления или сопоставления на основе правил. Соответствие, основанное `name` на `type` `stream` столбцах,,, `origin` и `position` . Можно использовать любое сочетание фиксированных и основанных на правилах сопоставлений. По умолчанию все проекции с более чем 50 столбцами по умолчанию будут сопоставлены на основе правил, которые соответствуют каждому столбцу и выводят выводимое имя. 

Чтобы добавить сопоставление на основе правил, нажмите кнопку **Добавить сопоставление** и выберите **сопоставление на основе правил**.

![На снимке экрана показана привязка на основе правил, выбранная из добавления сопоставления.](media/data-flow/rule2.png "Rule-based mapping (Выбор преобразования: сопоставление на основе правил)")

Каждое сопоставление на основе правил требует двух входных данных: условия, по которым производится сопоставление, и имя каждого сопоставленного столбца. Оба значения выводятся с помощью [построителя выражений](concepts-data-flow-expression-builder.md). В поле левое выражение введите логическое условие соответствия. В поле справа укажите, с каким столбцом будет сопоставляться сопоставленный столбец.

![На снимке экрана показано сопоставление.](media/data-flow/rule-based-mapping.png "Rule-based mapping (Выбор преобразования: сопоставление на основе правил)")

Используйте `$$` синтаксис для ссылки на входное имя сопоставленного столбца. Используя приведенное выше изображение в качестве примера, предположим, что пользователь хочет сопоставить все строковые столбцы, имена которых короче шести символов. Если один входящий столбец был именован `test` , выражение `$$ + '_short'` будет переименовывать столбец `test_short` . Если это единственное сопоставление, все столбцы, которые не соответствуют условию, будут удалены из выведенных данных.

Закономерности совпадают с смещенными и определенными столбцами. Чтобы узнать, какие определенные столбцы сопоставляются правилу, щелкните значок очков рядом с правилом. Проверьте выходные данные с помощью предварительной версии данных.

### <a name="regex-mapping"></a>Сопоставление регулярного выражения

Если щелкнуть значок шеврона вниз, можно указать условие сопоставления регулярного выражения. Условие сопоставления регулярного выражения сопоставляет все имена столбцов, соответствующие указанному условию Regex. Это можно использовать в сочетании со стандартными сопоставлениями на основе правил.

![На снимке экрана показано условие сопоставления регулярного выражения с уровнем иерархии и совпадением имен.](media/data-flow/regex-matching.png "Rule-based mapping (Выбор преобразования: сопоставление на основе правил)")

Приведенный выше пример соответствует шаблону регулярного выражения `(r)` или любому имени столбца, в котором содержится нижний регистр r. Как и в стандартном сопоставлении на основе правил, все сопоставленные столбцы изменяются с помощью условия справа с использованием `$$` синтаксиса.

### <a name="rule-based-hierarchies"></a>Иерархии на основе правил

Если определенная проекция имеет иерархию, можно использовать сопоставление на основе правил для сопоставления подстолбцов иерархии. Укажите условие сопоставления и сложный столбец, для которого нужно выполнить сопоставление. Каждый сопоставленный подстолбец будет выведен с помощью правила "Name AS", указанного справа.

![На снимке экрана показано сопоставление на основе правил с помощью для иерархии.](media/data-flow/rule-based-hierarchy.png "Rule-based mapping (Выбор преобразования: сопоставление на основе правил)")

Приведенный выше пример соответствует всем подстолбцам сложного столбца `a` . `a` содержит два подстолбца `b` и `c` . Выходная схема будет содержать два столбца `b` , а `c` в качестве условия "Name AS" — `$$` .

## <a name="pattern-matching-expression-values"></a>Значения выражения сопоставления шаблонов.

* `$$` преобразуется в имя или значение каждого совпадения во время выполнения. Представьте себе `$$` как эквивалент `this` .
* `name` представляет имя каждого входящего столбца
* `type` представляет тип данных каждого входящего столбца
* `stream` представляет имя, связанное с каждым потоком, или преобразование в последовательности
* `position` порядковый номер столбца в потоке данных
* `origin` Преобразование источника или последнего обновления столбца

## <a name="next-steps"></a>Дальнейшие действия
* Дополнительные сведения о [языке выражений](data-flow-expression-functions.md) потока данных сопоставления для преобразований данных
* Использование шаблонов столбцов в [преобразовании приемника](data-flow-sink.md) и [Выбор преобразования](data-flow-select.md) с сопоставлением на основе правил
