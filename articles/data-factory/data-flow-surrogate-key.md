---
title: Преобразование суррогатного ключа в потоке данных сопоставления
description: Как использовать преобразование суррогатного ключа потока данных сопоставления фабрики данных Azure для создания последовательных значений ключей
author: kromerm
ms.author: makromer
ms.reviewer: daperlov
ms.service: data-factory
ms.topic: conceptual
ms.custom: seo-lt-2019
ms.date: 10/30/2020
ms.openlocfilehash: d1f8993b1adc297b1bfadba114df76a66e59afa2
ms.sourcegitcommit: 910a1a38711966cb171050db245fc3b22abc8c5f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "93147190"
---
# <a name="surrogate-key-transformation-in-mapping-data-flow"></a>Преобразование суррогатного ключа в потоке данных сопоставления 

[!INCLUDE[appliesto-adf-asa-md](includes/appliesto-adf-asa-md.md)]

Используйте преобразование «суррогатный ключ», чтобы добавить значение ключа приращения к каждой строке данных. Это полезно при проектировании таблиц измерений в модели аналитических данных схемы типа «звезда». В схеме типа «звезда» каждому элементу в таблицах измерений требуется уникальный ключ, который является небизнесным ключом.

## <a name="configuration"></a>Конфигурация

![Преобразование суррогатного ключа](media/data-flow/surrogate.png "Преобразование суррогатного ключа")

**Ключевой столбец:** Имя созданного ключевого столбца суррогатного ключа.

**Начальное значение:** Наименьшее значение ключа, которое будет создано.

## <a name="increment-keys-from-existing-sources"></a>Увеличение ключей из существующих источников

Чтобы начать последовательность из значения, существующего в источнике, рекомендуется использовать приемник кэша для сохранения этого значения и использовать преобразование «Производный столбец» для сложения двух значений. Используйте кэшированный поиск для получения выходных данных и добавьте его в созданный ключ. Дополнительные сведения см. в статье о [приемниках кэша](data-flow-sink.md#cache-sink) и [кэшированных уточняющих запросах](concepts-data-flow-expression-builder.md#cached-lookup).

![Поиск суррогатного ключа](media/data-flow/cached-lookup-example.png "Поиск суррогатного ключа")

### <a name="increment-from-existing-maximum-value"></a>Приращение из существующего максимального значения

Чтобы заполнить значение ключа предыдущим максимальным, существует два метода, которые можно использовать в зависимости от источника данных.

#### <a name="database-sources"></a>Источники базы данных

Используйте параметр SQL-запроса, чтобы выбрать MAX () из источника. Например, `Select MAX(<surrogateKeyName>) as maxval from <sourceTable>`.

![Запрос суррогатного ключа](media/data-flow/surrogate-key-max-database.png "Запрос на преобразование суррогатного ключа")

#### <a name="file-sources"></a>Источники файлов

Если предыдущее максимальное значение находится в файле, используйте `max()` функцию преобразования «Статистическая обработка», чтобы получить предыдущее максимальное значение:

![Файл суррогатного ключа](media/data-flow/surrogate-key-max-file.png "Файл суррогатного ключа")

В обоих случаях необходимо будет записать в приемник кэша и найти значение. 


## <a name="data-flow-script"></a>Скрипт потока данных

### <a name="syntax"></a>Синтаксис

```
<incomingStream> 
    keyGenerate(
        output(<surrogateColumnName> as long),
        startAt: <number>L
    ) ~> <surrogateKeyTransformationName>
```

### <a name="example"></a>Пример

![Преобразование суррогатного ключа](media/data-flow/surrogate.png "Преобразование суррогатного ключа")

Сценарий потока данных для приведенной выше конфигурации суррогатного ключа приведен в следующем фрагменте кода.

```
AggregateDayStats
    keyGenerate(
        output(key as long),
        startAt: 1L
    ) ~> SurrogateKey1
```

## <a name="next-steps"></a>Дальнейшие действия

В этих примерах используются преобразования « [соединение](data-flow-join.md) » и « [производный столбец](data-flow-derived-column.md) ».
