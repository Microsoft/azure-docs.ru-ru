---
title: Создание конвейера фабрики данных с помощью портала Azure
description: В этом руководстве описано, как с помощью портала Azure создать фабрику данных с конвейером. Этот конвейер использует действие копирования для копирования данных из Хранилища BLOB-объектов Azure в Базу данных SQL Azure.
author: linda33wj
ms.service: data-factory
ms.topic: tutorial
ms.custom: seo-lt-2019
ms.date: 12/14/2020
ms.author: jingwang
ms.openlocfilehash: ca3250fb54440d6b68a808a3b1b3800bdcfd14eb
ms.sourcegitcommit: d4734bc680ea221ea80fdea67859d6d32241aefc
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/14/2021
ms.locfileid: "100375771"
---
# <a name="copy-data-from-azure-blob-storage-to-a-database-in-azure-sql-database-by-using-azure-data-factory"></a>Копирование данных из Хранилища BLOB-объектов Azure в базу данных в службе "База данных SQL Azure" с помощью Фабрики данных Azure

[!INCLUDE[appliesto-adf-xxx-md](includes/appliesto-adf-xxx-md.md)]

В этом руководстве вы создадите фабрику данных с помощью пользовательского интерфейса фабрики данных Azure. Конвейер этой фабрики данных копирует данные из Хранилища BLOB-объектов Azure в базу данных в службе "База данных SQL Azure". Шаблон конфигурации в этом руководстве применяется к копированию из файлового в реляционное хранилище данных. Список хранилищ данных, которые поддерживаются в качестве источников и приемников, см. в таблице [Поддерживаемые хранилища данных и форматы](copy-activity-overview.md#supported-data-stores-and-formats).

> [!NOTE]
> Если вы еще не работали с фабрикой данных, ознакомьтесь со статьей [Введение в фабрику данных Azure](introduction.md).

Вот какие шаги выполняются в этом учебнике:

> [!div class="checklist"]
> * Создали фабрику данных.
> * создание конвейера с действием копирования;
> * тестовый запуск конвейера;
> * активация конвейера вручную;
> * запуск конвейера по расписанию;
> * Мониторинг конвейера и выполнения действий.

## <a name="prerequisites"></a>Предварительные требования
* **Подписка Azure**. Если у вас еще нет подписки Azure, создайте [бесплатную учетную запись](https://azure.microsoft.com/free/) Azure, прежде чем начинать работу.
* **Учетная запись хранения Azure**. В этом руководстве в качестве *источника* будет использоваться хранилище BLOB-объектов. Если у вас нет учетной записи хранения, создайте ее, следуя действиям в [этом разделе](../storage/common/storage-account-create.md).
* **База данных SQL Azure**. Используйте базу данных как хранилище данных-*приемник*. Если у вас нет базы данных в службе "База данных SQL Azure", вы можете создать ее, выполнив инструкции из краткого руководства [Создание отдельной базы данных в Базе данных SQL Azure](../azure-sql/database/single-database-create-quickstart.md).

### <a name="create-a-blob-and-a-sql-table"></a>Создание большого двоичного объекта и таблицы SQL

Теперь подготовьте хранилище больших двоичных объектов и базу данных SQL к изучению этого руководства, выполнив следующие действия.

#### <a name="create-a-source-blob"></a>Создание исходного большого двоичного объекта

1. Запустите Блокнот. Скопируйте следующий текст и сохраните его в файл **emp.txt** на диске.

    ```
    FirstName,LastName
    John,Doe
    Jane,Doe
    ```

1. Создайте контейнер с именем **adftutorial** в хранилище BLOB-объектов. Создайте папку **input** в этом контейнере. Затем отправьте файл **emp.txt** в папку **input**. Эти задачи можно выполнить с помощью портала Azure или специальных средств, таких как [Обозреватель службы хранилища Azure](https://storageexplorer.com/).

#### <a name="create-a-sink-sql-table"></a>Создание таблицы-приемника SQL

1. Чтобы создать в своей базе данных таблицу **dbo.emp**, используйте следующий скрипт SQL:

    ```sql
    CREATE TABLE dbo.emp
    (
        ID int IDENTITY(1,1) NOT NULL,
        FirstName varchar(50),
        LastName varchar(50)
    )
    GO

    CREATE CLUSTERED INDEX IX_emp_ID ON dbo.emp (ID);
    ```

1. Предоставьте службам Azure доступ к серверу SQL Server. Убедитесь, что параметр **Разрешить доступ к службам Azure** имеет состояние **Вкл.** для вашего сервера SQL Server, чтобы фабрика данных могла записывать данные на него. Чтобы проверить и при необходимости включить этот параметр, перейдите к логическому серверу SQL Server, выберите "Обзор" > "Настройка брандмауэра для сервера", а затем задайте для параметра **Разрешить доступ к службам Azure** значение **Вкл.**

## <a name="create-a-data-factory"></a>Создание фабрики данных
На этом этапе вы создадите фабрику данных и запустите пользовательский интерфейс службы "Фабрика данных" для создания конвейера в фабрике данных.

1. Откройте **Microsoft Edge** или **Google Chrome**. Сейчас только эти браузеры поддерживают пользовательский интерфейс фабрики данных.
2. В меню слева последовательно выберите элементы **Создать ресурс** > **Интеграция** > **Фабрика данных**.
3. На странице **Создание фабрики данных** на вкладке **Основные сведения** выберите **подписку** Azure, в рамках которой вы хотите создать фабрику данных.
4. Для **группы ресурсов** выполните одно из следующих действий:

    а. Выберите существующую группу ресурсов из раскрывающегося списка.

    b. Выберите **Создать новую** и укажите имя новой группы ресурсов.
    
    Сведения о группах ресурсов см. в статье [Общие сведения об Azure Resource Manager](../azure-resource-manager/management/overview.md). 
5. В поле **Регион** выберите расположение фабрики данных. В раскрывающемся списке отображаются только поддерживаемые расположения. Хранилища данных (например, служба хранилища Azure и база данных SQL) и вычислительные ресурсы (например, Azure HDInsight), используемые фабрикой данных, могут располагаться в других регионах.
6. В поле **Имя** введите **ADFTutorialDataFactory**.

   Имя фабрики данных Azure должно быть *глобально уникальным*. Если вы увидите следующую ошибку касательно значения имени, введите другое имя фабрики данных. (Например, используйте yournameADFTutorialDataFactory.) Дополнительные сведения о правилах именования артефактов фабрики данных см. в статье [Фабрика данных Azure — правила именования](naming-rules.md).

     ![Новая фабрика данных](./media/doc-common-process/name-not-available-error.png)

7. В качестве **версии** выберите **V2**.
8. Выберите вкладку **Git configuration** (Конфигурация Git) в верхней части экрана и установите флажок **Configure Git later** (Настроить Git позже).
9. Щелкните **Просмотр и создание** и выберите **Создать** после прохождения проверки.
10. После завершения создания вы увидите уведомление в центре уведомлений. Нажмите кнопку **Перейти к ресурсу**, чтобы открыть страницу фабрики данных.
11. Выберите **Создание и мониторинг**, чтобы запустить на отдельной вкладке пользовательский интерфейс Фабрики данных Azure.


## <a name="create-a-pipeline"></a>Создание конвейера
На этом шаге вы создадите в фабрике данных конвейер с действием копирования. Это действие копирования копирует данные из хранилища BLOB-объектов в базу данных SQL. В предыдущем [руководстве](quickstart-create-data-factory-portal.md) вы создали конвейер, выполнив следующие действия:

1. Создание связанной службы.
1. Создание входных и выходных наборов данных.
1. Создали конвейер.

В этом руководстве вы сразу приступите к созданию конвейера, а связанные службы и наборы данных будете создавать по мере необходимости для настройки конвейера.

1. На странице **Начало работы** выберите **Create pipeline** (Создать конвейер).

   ![Создание конвейера](./media/doc-common-process/get-started-page.png)

1. На общей панели в разделе **Свойства** укажите значение **CopyPipeline** для параметра **Имя**. Затем сверните панель, щелкнув значок "Свойства" в правом верхнем углу.

1. На панели элементов **Действия** разверните категорию **Move and Transform** (Переместить и преобразовать) и перетащите действие **Копирование данных** из панели элементов в область конструктора конвейера. Введите **CopyFromBlobToSql** в поле **Имя**.

    ![Действие копирования](./media/tutorial-copy-data-portal/drag-drop-copy-activity.png)

### <a name="configure-source"></a>Настройка источника

>[!TIP]
>В этом учебнике аутентификация в хранилище данных выполняется с помощью *ключа учетной записи*, но при необходимости можно выбрать другие поддерживаемые инструменты проверки подлинности для хранилища исходных данных, такие как: *универсальный код ресурса SAS*,*субъект-служба* и *управляемое удостоверение*. Дополнительные сведения см. в соответствующих разделах [этой статьи](./connector-azure-blob-storage.md#linked-service-properties).
>Чтобы безопасно хранить секреты для хранилищ данных, также рекомендуется использовать Azure Key Vault. Дополнительные сведения см. в [этой статье](./store-credentials-in-key-vault.md).

1. Перейдите на вкладку **Источник**. Выберите **+ Создать**, чтобы создать исходный набор данных.

1. В диалоговом окне **Новый набор данных** выберите **Хранилище BLOB-объектов Azure** и щелкните **Продолжить**. Выберите **Хранилище BLOB-объектов** для исходного набора данных, потому что именно там находится источник данных.

1. В диалоговом окне **Выбор формата** выберите тип формата ваших данных, а затем нажмите кнопку **Продолжить**.

1. В диалоговом окне **Установка свойств** введите **SourceBlobDataset** в качестве имени. Установите флажок **Использовать первую строку в качестве заголовка**. В текстовом поле **Связанная служба** выберите **+ Создать**.

1. В окне **New Linked Service (Azure Blob Storage)** (Новая связанная служба (хранилище BLOB-объектов)) в качестве имени введите **AzureStorageLinkedService** и выберите учетную запись хранения в списке **Имя учетной записи хранения**. Проверьте подключение и нажмите кнопку **Создать**, чтобы развернуть связанную службу.

1. После создания связанной службы откроется страница **Установка свойств**. Рядом с полем **Путь к файлу** выберите **Обзор**.

1. Перейдите к папке **adftutorial/input**, выберите файл **emp.txt** и нажмите кнопку **ОК**.

1. Щелкните **ОК**. Автоматически откроется страница конвейера. Убедитесь, что на вкладке **Источник** выбрано значение **SourceBlobDataset**. Чтобы просмотреть данные на этой странице, выберите **Просмотр данных**.

    ![Исходный набор данных](./media/tutorial-copy-data-portal/source-dataset-selected.png)

### <a name="configure-sink"></a>Настройка приемника
>[!TIP]
>В этом учебнике аутентификация в хранилище данных выполняется с помощью *Проверки подлинности SQL*, но при необходимости для хранилища данных, выступающего в роли приемника, можно выбрать другие поддерживаемые инструменты проверки подлинности, такие как: *субъект-служба* и *управляемое удостоверение*. Дополнительные сведения см. в соответствующих разделах [этой статьи](./connector-azure-sql-database.md#linked-service-properties).
>Чтобы безопасно хранить секреты для хранилищ данных, также рекомендуется использовать Azure Key Vault. Дополнительные сведения см. в [этой статье](./store-credentials-in-key-vault.md).

1. Перейдите на вкладку **Приемник** и выберите **+ Создать**, чтобы создать целевой набор данных.

1. В диалоговом окне **Новый набор данных** введите SQL в окне поиска, чтобы отфильтровать соединители, а затем выберите **База данных SQL Azure** и нажмите кнопку **Продолжить**. В этом руководстве вы будете копировать данные в базу данных SQL.

1. В диалоговом окне **Установка свойств** введите **OutputSqlDataset** в качестве имени. В раскрывающемся списке **Связанная служба** выберите **+ Создать**. Связанную службу нужно сопоставить с набором данных. Связанная служба содержит строку подключения, которая потребуется фабрике данных для подключения к Базе данных SQL во время выполнения. Набор данных определяет контейнер, папку и (необязательно) файл, куда копируются данные.

1. В диалоговом окне **New Linked Service (Azure SQL Database)** (Новая связанная служба (База данных SQL Azure)) сделайте следующее:

    а. В поле **Имя** введите **AzureSqlDatabaseLinkedService**.

    b. В списке **Имя сервера** выберите необходимый экземпляр SQL Server.

    c. В списке **Имя базы данных** выберите нужную базу данных.

    d. В поле **Имя пользователя** введите имя пользователя.

    д) В поле **Пароль** введите пароль для этого пользователя.

    е) Выберите **Проверить подключение**, чтобы проверить подключение.

    ж. Выберите **Создать**, чтобы развернуть связанную службу.

    ![Сохранение связанной службы](./media/tutorial-copy-data-portal/new-azure-sql-linked-service-window.png)

1. Автоматически откроется диалоговое окно **Установка свойств**. В поле **Таблица** выберите **[dbo].[emp]** . Нажмите кнопку **ОК**.

1. Перейдите на вкладку с конвейером и убедитесь, что в поле **Sink Dataset** (Целевой набор данных) выбрано значение **OutputSqlDataset**.

    ![Вкладка конвейера](./media/tutorial-copy-data-portal/pipeline-tab-2.png)       

При необходимости вы можете сопоставить схему источника с соответствующей схемой назначения, выполнив действия в статье [Сопоставление схемы в действии копирования](copy-activity-schema-and-type-mapping.md).

## <a name="validate-the-pipeline"></a>Проверка конвейера
Чтобы проверить параметры конвейера, на панели инструментов выберите **Проверить**.

Чтобы отобразить код JSON, соответствующий конвейеру, щелкните **Код** в правом верхнем углу.

## <a name="debug-and-publish-the-pipeline"></a>Отладка и публикация конвейера
Вы можете отладить работу конвейера, прежде чем публиковать артефакты (связанные службы, наборы данных и конвейер) в фабрике данных или вашем собственном репозитории Git Azure Repos.

1. Чтобы выполнить отладку конвейера, на панели инструментов щелкните **Отладка**. Состояние выполнения конвейера вы можете найти на вкладке **Выходные данные** в нижней части окна.

1. После успешного запуска конвейера в верхней панели инструментов выберите **Опубликовать все**. Это действие опубликует созданные сущности (наборы данных и конвейеры) в фабрике данных.

1. Дождитесь сообщения **Successfully published** (Публикация выполнена). Чтобы отобразить уведомления, щелкните **Показать уведомления** в правом верхнем углу (кнопка в виде колокольчика).

## <a name="trigger-the-pipeline-manually"></a>Aктивация конвейера вручную
На этом шаге вы вручную запустите конвейер, опубликованный ранее.

1. Выберите **Trigger** (Запустить) на панели инструментов, а затем **Trigger Now** (Запустить сейчас). На странице **Запуск конвейера** щелкните **ОК**.  

1. Перейдите на вкладку **Мониторинг** слева. Вы увидите выполнение конвейера, которое вы только что активировали вручную. Ссылки в столбце **Имя конвейера** позволят вам просмотреть подробные сведения о действиях и повторно выполнить конвейер.

    [![Мониторинг выполнений конвейера](./media/tutorial-copy-data-portal/monitor-pipeline-inline-and-expended.png)](./media/tutorial-copy-data-portal/monitor-pipeline-inline-and-expended.png#lightbox)

1. Чтобы просмотреть выполнение действий, связанных с выполнением конвейера, выберите ссылку **CopyPipeline** в столбце **Имя конвейера**. В нашем примере определено только одно действие, поэтому в списке вы увидите только одну запись. Чтобы увидеть сведения об операции копирования, щелкните ссылку **Сведения** (значок очков) в столбце **Название действия**. Выберите **Все запуски конвейеров** в верхней части окна, чтобы вернуться к представлению "Выполнения конвейеров". Чтобы обновить список, нажмите кнопку **Обновить**.

    [![Мониторинг выполнений действий](./media/tutorial-copy-data-portal/view-activity-runs-inline-and-expended.png)](./media/tutorial-copy-data-portal/view-activity-runs-inline-and-expended.png#lightbox)

1. Убедитесь, что в таблицу **emp** в базе данных добавлены две новые строки.

## <a name="trigger-the-pipeline-on-a-schedule"></a>запуск конвейера по расписанию;
В этом разделе вы создадите триггер планировщика для выполнения конвейера. Этот триггер запускает конвейер по определенному расписанию (каждый час или каждый день). В этом разделе вы настроите триггер, который выполняется каждую минуту до указанного времени окончания.

1. Перейдите на вкладку **Автор** слева над вкладкой монитора.

1. Перейдите в конвейер, щелкните **Триггер** на панели инструментов и выберите **Создать/изменить**.

1. В диалоговом окне **Add Trigger** (Добавление триггеров) выберите **+ Создать** в области **Выберите триггер**.

1. В окне **New Trigger** (Создание триггера) выполните следующие действия.

    а. В поле **Имя** введите **RunEveryMinute**.

    b. Обновите **дату начала** для своего триггера. Если дата предшествует текущему значению даты и времени, триггер начнет действовать после публикации изменения. 

    c. Разверните раскрывающийся список в поле **Часовой пояс**.

    d. Установите для параметра **Повторение** значение **Каждые 1 мин**.

    д) Установите флажок для параметра **Укажите дату окончания** и обновите элемент **Окончание в**, задав значение на несколько минут позднее текущего значения даты и времени. Триггер начнет работу только после публикации изменений. Если вы настроите разницу всего в одну-две минуты и не успеете за это время опубликовать триггер, он не будет выполнен.

    е) Для параметра **Активировать** выберите **Да**.

    ж. Щелкните **ОК**.

    > [!IMPORTANT]
    > Каждое выполнение конвейера оплачивается. Поэтому здесь важно правильно указать дату окончания.

1. Прочитайте предупреждение на странице **Изменение триггера** и выберите **Готово**. Конвейер в этом примере не принимает параметры.

1. Щелкните **Опубликовать все**, чтобы опубликовать изменения.

1. Перейдите на вкладку **Мониторинг** слева, чтобы увидеть активированные выполнения конвейера.

    [![Активированные выполнения конвейера](./media/tutorial-copy-data-portal/triggered-pipeline-runs-inline-and-expended.png)](./media/tutorial-copy-data-portal/triggered-pipeline-runs-inline-and-expended.png#lightbox)

1. Чтобы перейти от представления **запусков конвейера** к представлению **запусков триггера**, выберите **Trigger Runs** (Запуски триггера) в левой области окна.

1. Вы увидите в списке выполнения своего триггера.

1. Проследите, как в таблицу **emp** добавляются по две строки в минуту (для каждого выполнения конвейера) вплоть до указанного времени окончания.

## <a name="next-steps"></a>Дальнейшие действия
В этом примере конвейер копирует данные из одного расположения в другое в хранилище BLOB-объектов. Вы ознакомились с выполнением следующих задач:

> [!div class="checklist"]
> * Создали фабрику данных.
> * создание конвейера с действием копирования;
> * тестовый запуск конвейера;
> * активация конвейера вручную;
> * запуск конвейера по расписанию;
> * Мониторинг конвейера и выполнения действий.


Перейдите к следующему руководству, чтобы узнать о копировании данных из локальной среды в облако:

> [!div class="nextstepaction"]
>[Копирование данных из локальной базы данных SQL Server в хранилище BLOB-объектов Azure с помощью средства копирования данных](tutorial-hybrid-copy-portal.md)
