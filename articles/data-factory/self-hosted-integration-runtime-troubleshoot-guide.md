---
title: Устранение неполадок с локальной средой выполнения интеграции в Фабрике данных Azure
description: Узнайте, как устранять неполадки с локальной средой выполнения интеграции в Фабрике данных Azure.
author: lrtoyou1223
ms.service: data-factory
ms.topic: troubleshooting
ms.date: 01/25/2021
ms.author: lle
ms.openlocfilehash: 2cb0e0870b32270340e37d54dc54a43b22ee014a
ms.sourcegitcommit: d4734bc680ea221ea80fdea67859d6d32241aefc
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/14/2021
ms.locfileid: "100376468"
---
# <a name="troubleshoot-self-hosted-integration-runtime"></a>Устранение неполадок с локальной средой выполнения интеграции

[!INCLUDE[appliesto-adf-asa-md](includes/appliesto-adf-asa-md.md)]

В этой статье рассматриваются распространенные методы устранения неполадок для локальной среды выполнения интеграции (IR) в фабрике данных Azure.

## <a name="gather-self-hosted-ir-logs-from-azure-data-factory"></a>Сбор собственных IR-журналов из фабрики данных Azure

Для неудачных действий, выполняемых на автономной или общей IR, фабрика данных Azure поддерживает просмотр и отправку журналов ошибок. Чтобы получить идентификатор отчета об ошибках, следуйте приведенным здесь инструкциям, а затем введите идентификатор отчета для поиска связанных известных проблем.

1. В окне фабрика данных выберите **запуски конвейера**.

1. В разделе **запуски действий** в столбце **Ошибка** выберите выделенную кнопку для отображения журналов действий, как показано на следующем снимке экрана:

    ![Снимок экрана: раздел "запуски действий" на панели "все запуски конвейера".](media/self-hosted-integration-runtime-troubleshoot-guide/activity-runs-page.png)

    Журналы действий отображаются для невыполненного действия.

    ![Снимок экрана журналов действий для действия, завершившееся сбоем.](media/self-hosted-integration-runtime-troubleshoot-guide/send-logs.png) 
    
1. Для получения дополнительной помощи выберите **отправить журналы**.
 
   Откроется **общий доступ к локальным журналам среды выполнения интеграции (IR) с помощью окна Microsoft** .

    ![Снимок экрана: "совместное использование локальной среды выполнения интеграции (IR) журналов с Майкрософт".](media/self-hosted-integration-runtime-troubleshoot-guide/choose-logs.png)

1. Выберите журналы, которые требуется отправить. 
    * Для *автономных IR*-файлов можно передать журналы, связанные с невыполненными действиями, или все журналы на узле с поддержкой саморазмещения. 
    * Для *общего IR-порта* можно передать только те журналы, которые относятся к неудачному действию.

1. После отправки журналов следует сохранить запись идентификатора отчета для последующего использования, если требуется дополнительная помощь по устранению проблемы.

    ![Снимок экрана с ИДЕНТИФИКАТОРом отображаемого отчета в окне "Ход отправки" для журналов IR.](media/self-hosted-integration-runtime-troubleshoot-guide/upload-logs.png)

> [!NOTE]
> Просмотр журнала и отправка запросов выполняются во всех подключенных к сети экземплярах для самостоятельного размещения. Если какие-либо журналы отсутствуют, убедитесь, что все локальные ИК-экземпляры находятся в оперативном режиме. 


## <a name="self-hosted-ir-general-failure-or-error"></a>Общая неисправность или ошибка в локальной среде IR

### <a name="out-of-memory-issue"></a>Проблемы с нехваткой памяти

#### <a name="symptoms"></a>Симптомы

Ошибка OutOfMemoryException (сообщение об ошибке) возникает при попытке выполнить операцию поиска со связанным IR или с локальным IR.

#### <a name="cause"></a>Причина

Новое действие может вызвать ошибку с сообщением о невозможности, если на IR-компьютере используется интенсивное использование памяти. Эта неполадка может быть вызвана большим объемом одновременных действий, и эта ошибка связана с проектированием.

#### <a name="resolution"></a>Решение

Проверьте использование ресурсов и выполнение параллельных действий на узле IR. Настройте внутреннее и активируемое время выполнения действий, чтобы избежать слишком большого количества одновременного выполнения на одном IR-узле.

### <a name="concurrent-jobs-limit-issue"></a>Проблема с ограничением количества параллельных заданий

#### <a name="symptoms"></a>Симптомы

При попытке увеличить ограничение одновременных заданий от интерфейса фабрики данных Azure процесс *обновления* состояния зависает.

Пример сценария. Максимальное количество одновременных заданий в настоящее время равно 24, и вы хотите увеличить число, чтобы задания могли выполняться быстрее. Минимальное значение, которое можно ввести, равно 3, а максимальное значение — 32. Вы увеличиваете значение с 24 до 32, а затем наберете кнопку **Обновить** . Процесс зависает при *обновлении* состояния, как показано на снимке экрана ниже. Вы обновите страницу, и значение по-прежнему отображается как 24. Он не был обновлен до 32, как ожидалось.

![Снимок экрана: панель "узлы" среды выполнения интеграции с отображением процесса в состоянии "обновление".](media/self-hosted-integration-runtime-troubleshoot-guide/updating-status.png)

#### <a name="cause"></a>Причина

Ограничение на количество параллельных заданий зависит от логического ядра и памяти компьютера. Попробуйте изменить значение вниз на значение 24, а затем просмотрите результат.

> [!TIP] 
> -    Дополнительные сведения о количестве логических ядер и определении числа логических ядер компьютера см. в статье [четыре способа определения количества ядер в ЦП в Windows 10](https://www.top-password.com/blog/find-number-of-cores-in-your-cpu-on-windows-10/).
> -    Чтобы узнать, как вычислить Math. log, перейдите к [калькулятору логарифма](https://www.rapidtables.com/calc/math/Log_Calculator.html).


### <a name="self-hosted-ir-high-availability-ha-ssl-certificate-issue"></a>Неисправность SSL-сертификата в локальной среде с высоким уровнем доступности

#### <a name="symptoms"></a>Симптомы

В узле "Автономная рабочая среда IR" обнаружена следующая ошибка:

"Не удалось извлечь общие состояния из основного узла net. TCP://АБК.Клауд.корп.Микрософт.ком: 8060/Екстерналсервице. svc/. Идентификатор действия: XXXXX. сертификат X. 509 CN = ABC. Cloud. Corp. Microsoft. com, OU = Test, O = сбой построения цепочки Майкрософт. Используемый сертификат имеет цепочку доверия, которую невозможно проверить. Замените сертификат или измените certificateValidationMode. Функции отзыва не удалось проверить отзыв, так как сервер отзыва был отключен ".

#### <a name="cause"></a>Причина

При обработке вариантов, связанных с подтверждением SSL/TLS, могут возникать некоторые проблемы, связанные с проверкой цепочки сертификатов. 

#### <a name="resolution"></a>Решение

- Вот краткий и понятный способ устранения неполадок при сборке цепочки сертификатов X. 509:
 
    1. Экспортируйте сертификат, который необходимо проверить. Для этого выполните следующее.
    
       а. В Windows нажмите кнопку **Пуск**, начните ввод **сертификатов**, а затем выберите **Управление сертификатами компьютеров**.
       
       b. В проводнике в левой области найдите сертификат, который требуется проверить, щелкните его правой кнопкой мыши и выберите **все задачи**  >  **Экспорт**.
    
        ![Снимок экрана элемента управления "все задачи" > "экспорт" для сертификата на панели "Управление сертификатами компьютера".](media/self-hosted-integration-runtime-troubleshoot-guide/export-tasks.png)

    2. Скопируйте экспортированный сертификат на клиентский компьютер. 
    3. На стороне клиента в окне командной строки выполните следующую команду. Обязательно замените *\<certificate path>* и *\<output txt file path>* фактическими путями.
    
        ```
        Certutil -verify -urlfetch    <certificate path>   >     <output txt file path> 
        ```

        Пример:

        ```
        Certutil -verify -urlfetch c:\users\test\desktop\servercert02.cer > c:\users\test\desktop\Certinfo.txt
        ```
    4. Проверьте наличие ошибок в выходном TXT файле. Сводку ошибок можно найти в конце файла TXT.

        Пример: 

        ![Снимок экрана сводки ошибок в конце файла TXT.](media/self-hosted-integration-runtime-troubleshoot-guide/error-summary.png)

        Если в конце файла журнала отсутствует ошибка, как показано на следующем снимке экрана, можно считать, что цепочка сертификатов успешно построена на клиентском компьютере.
        
        ![Снимок экрана файла журнала, в котором отсутствуют ошибки.](media/self-hosted-integration-runtime-troubleshoot-guide/log-file.png)      

- Если в файле сертификата настраивается расширение AIA (доступ к информации о центре сертификации), CDP (точка распространения списка отзыва сертификатов) или имя файла OCSP (Online Certificate Status Protocol), его можно проверить с помощью более интуитивно понятного способа:
 
    1. Получите эти сведения, проверив сведения о сертификате, как показано на следующем снимке экрана:
    
        ![Снимок экрана со сведениями о сертификате.](media/self-hosted-integration-runtime-troubleshoot-guide/certificate-detail.png)
    
    1. Выполните следующую команду. Не забудьте заменить *\<certificate path>* фактическим путем к сертификату.
    
        ```
          Certutil   -URL    <certificate path> 
        ```
    
        Откроется средство извлечения URL-адресов. 
        
    1. Чтобы проверить сертификаты с расширениями AIA, CDP и имен файлов OCSP, выберите **получить**.

        ![Снимок экрана средства получения URL-адреса и кнопки "получить".](media/self-hosted-integration-runtime-troubleshoot-guide/retrieval-button.png)
 
        Цепочка сертификатов успешно создана, если *Проверено* состояние сертификата из AIA и *Проверено* состояние сертификата из CDP или OCSP.

        Если при попытке получения AIA или CDP произошел сбой, обратитесь к команде сети, чтобы подготовить клиентский компьютер к подключению к целевому URL-адресу. Он будет достаточно, если можно проверить путь HTTP или путь LDAP.

### <a name="self-hosted-ir-could-not-load-file-or-assembly"></a>Локальной среде IR не удалось загрузить файл или сборку

#### <a name="symptoms"></a>Симптомы

Возникает следующее сообщение об ошибке:

"Не удалось загрузить файл или сборку" КСКСКСКСКСКСКСКСКСКСКСКСКСКСКСКС, Version = 4.0.2.0, Culture = Neutral, PublicKeyToken = XXXXXXXXX "или одну из его зависимостей. Системе не удается найти указанный файл. Идентификатор действия: 92693b45-b4bf-4fc8-89da-2d3dc56f27c3 "
 
Вот более конкретное сообщение об ошибке: 

«Не удалось загрузить файл или сборку System. ValueTuple, Version = 4.0.2.0, Culture = Neutral, PublicKeyToken = XXXXXXXXX» или одну из ее зависимостей. Системе не удается найти указанный файл. Идентификатор действия: 92693b45-b4bf-4fc8-89da-2d3dc56f27c3 "

#### <a name="cause"></a>Причина

В мониторе процессов можно просмотреть следующий результат:

[![Снимок экрана: список путей в мониторе процессов.](media/self-hosted-integration-runtime-troubleshoot-guide/process-monitor.png)](media/self-hosted-integration-runtime-troubleshoot-guide/process-monitor.png#lightbox)

> [!TIP] 
> В мониторе процессов можно задать фильтры, как показано на следующем снимке экрана.
>
> Приведенное выше сообщение об ошибке говорит о том, что библиотека DLL System. ValueTuple не находится в связанной папке *глобального кэша сборок* (GAC), в папке *C:\Program Files\Microsoft Integration Runtime\4.0\Gateway* или в папке *c:\Program Files\Microsoft Integration Runtime\4.0\Shared* .
>
> По сути, процесс загружает библиотеку DLL сначала из папки *GAC* , затем из *общей* папки и, наконец, из папки *шлюза* . Таким образом, можно загрузить библиотеку DLL из любого удобного пути.

<br>

![Снимок экрана со страницей "фильтр монитора", в которой перечислены фильтры для библиотеки DLL.](media/self-hosted-integration-runtime-troubleshoot-guide/set-filters.png)

#### <a name="resolution"></a>Решение

Файл *System.ValueTuple.dll* находится в папке *C:\Program Files\Microsoft Integration Runtime\4.0\Gateway\DataScan* . Чтобы устранить эту проблему, скопируйте файл *System.ValueTuple.dll* в папку *C:\Program Files\Microsoft Integration Runtime\4.0\Gateway* .

Один и тот же метод можно использовать для устранения проблем с отсутствующими файлами или сборками.

#### <a name="more-information-about-this-issue"></a>Дополнительные сведения об этой ошибке

Причина, по которой вы видите *System.ValueTuple.dll* в разделе *%WINDIR%\Microsoft.NET\assembly* и *%виндир%\ассембли* , заключается в том, что это поведение .NET. 

В следующей ошибке видно, что отсутствует сборка *System. ValueTuple* . Эта проблема возникает, когда приложение пытается проверить сборку *System.ValueTuple.dll* .
 
" \<LogProperties> \<ErrorInfo> [{" Код ": 0," сообщение ":" инициализатор типа для "Npgsql. пулманажер" вызвал исключение. "," EventType ": 0," Category ": 5," Data ": {} ," msgid ": NULL," ExceptionType ":" System. TypeInitializationException "," Source ":" Npgsql "," StackTrace ":" "," иннеревентинфос ": [{" код ": 0," Message ":" не удалось загрузить файл или сборку "System. ValueTuple, версия = 4.0.2.0, культура = Neutral, PublicKeyToken = XXXXXXXXX" или одну из ее зависимостей. Системе не удается найти указанный файл. "," EventType ": 0," Категория ": 5," Data ": {} ," мсгид":Нулл,"Ексцептионтипе":"систем. IO. FileNotFoundException "," Source ":" Npgsql "," StackTrace ":" "," иннеревентинфос ": []}]}] \</ErrorInfo> \</LogProperties> "
 
Дополнительные сведения о ГЛОБАЛЬном кэше сборок см. в разделе [глобальный кэш сборок](/dotnet/framework/app-domains/gac).


### <a name="self-hosted-integration-runtime-authentication-key-is-missing"></a>Отсутствует ключ проверки подлинности локальной среды выполнения интеграции

#### <a name="symptoms"></a>Симптомы

Локальная среда выполнения интеграции внезапно переходит в режим «вне сети» без ключа проверки подлинности, а в журнале событий отображается следующее сообщение об ошибке: 

"Ключ проверки подлинности еще не назначен"

![Снимок экрана: панель событий среды выполнения интеграции, показывающая, что ключ проверки подлинности еще не назначен.](media/self-hosted-integration-runtime-troubleshoot-guide/key-missing.png)

#### <a name="cause"></a>Причина

- Локально размещенный IR-узел или логический саморазмещаемый IR-объект в портал Azure был удален.
- Было выполнено чистое удаление.

#### <a name="resolution"></a>Решение

Если ни одна из описанных выше причин не будет применена, перейдите в папку *%Програмдата%\микрософт\дата трансфер\датаманажементгатевай* , чтобы узнать, был ли удален файл *конфигураций* . Если он был удален, следуйте инструкциям, приведенным в статье Нетврикс, чтобы [определить, кто удалил файл с файловых серверов Windows](https://www.netwrix.com/how_to_detect_who_deleted_file.html).

![Снимок экрана: панель сведений журнала событий для проверки файла конфигураций.](media/self-hosted-integration-runtime-troubleshoot-guide/configurations-file.png)


### <a name="cant-use-self-hosted-ir-to-bridge-two-on-premises-datastores"></a>Не удается использовать локально размещенное IR для моста двух локальных хранилищ данных

#### <a name="symptoms"></a>Симптомы

После создания самостоятельно размещенной IRs для исходных и целевых хранилищ данных необходимо подключить две IRs для завершения действия копирования. Если хранилища данных настроены в разных виртуальных сетях или хранилища данных не могут понять механизм шлюза, вы получаете одну из следующих ошибок: 

* "Не удается найти драйвер источника в назначении IR"
* "Источник недоступен для целевого IR"
 
#### <a name="cause"></a>Причина

Локальная среда IR разработана как центральный узел действия копирования, а не агент клиента, который необходимо установить для каждого хранилища данных.
 
В этом случае необходимо создать связанную службу для каждого хранилища данных с одним и тем же IR, а IR будет иметь возможность доступа к хранилищу данных через сеть. Не имеет значения, установлено ли значение IR в исходное хранилище данных или в целевое хранилище данных или на третьем компьютере. Если две связанные службы создаются с разными IRs, но используются в одном и том же действии копирования, используется целевой IR и необходимо установить драйверы для обоих хранилищ данных на целевом IR-компьютере.

#### <a name="resolution"></a>Решение

Установите драйверы для исходных и целевых хранилищ данных на целевом IR и убедитесь, что они имеют доступ к исходному хранилищу данных.
 
Если трафик не может пройти через сеть между двумя хранилищами данных (например, они настроены в двух виртуальных сетях), вы можете не завершать копирование в одно действие даже при установленном IR. Если не удается завершить копирование одного действия, можно создать два действия копирования с двумя IRs, каждое в вентиляционном канале: 
* Копирование одного IR-объекта из хранилища данных 1 в хранилище BLOB-объектов Azure
* Скопируйте еще один IR-объект из хранилища BLOB-объектов Azure в хранилище данных 2. 

Это решение может имитировать требование использования IR для создания моста, соединяющего два отсоединенные хранилища данных.


### <a name="credential-sync-issue-causes-credential-loss-from-ha"></a>Ошибка синхронизации учетных данных приводит к утрате учетных данных из высокой доступности

#### <a name="symptoms"></a>Симптомы

Если учетные данные источника данных "КСКСКСКСКСКСКСКСКСКС" удалены из текущего узла среды выполнения интеграции с полезной нагрузкой, появится следующее сообщение об ошибке:

"При удалении службы Link на портал Azure или если задача содержит неправильные полезные данные, создайте новую службу компоновки с вашими учетными данными."

#### <a name="cause"></a>Причина

Локальная среда IR встроена в режим высокой доступности с двумя узлами, но узлы не находятся в состоянии синхронизации учетных данных. Это означает, что учетные данные, хранящиеся в узле Dispatcher, не синхронизируются с другими рабочими узлами. Если отработка отказа происходит от узла Dispatcher к рабочему узлу, а учетные данные существуют только в предыдущем узле Dispatcher, задача завершится ошибкой, если вы пытаетесь получить доступ к учетным данным, и вы получите предыдущую ошибку.

#### <a name="resolution"></a>Решение

Единственный способ избежать этой проблемы — убедиться, что два узла находятся в состоянии синхронизации учетных данных. Если они не синхронизированы, необходимо повторно ввести учетные данные для нового Dispatcher.


### <a name="cant-choose-the-certificate-because-the-private-key-is-missing"></a>Не удается выбрать сертификат, поскольку отсутствует закрытый ключ

#### <a name="symptoms"></a>Симптомы

* Вы импортировали PFX-файл в хранилище сертификатов.
* При выборе сертификата через пользовательский интерфейс Configuration Manager IR вы получили следующее сообщение об ошибке:

   "Не удалось изменить режим шифрования связи в интрасети. Вероятно, у сертификата " \<*certificate name*> " не может быть закрытого ключа, который поддерживает обмен ключами, или процесс не имеет прав доступа к закрытому ключу. Дополнительные сведения см. в описании внутреннего исключения ".

    ![Снимок экрана: область параметров Integration Runtime Configuration Manager, в которой отображается сообщение об ошибке "закрытый ключ отсутствует".](media/self-hosted-integration-runtime-troubleshoot-guide/private-key-missing.png)

#### <a name="cause"></a>Причина

- Учетная запись пользователя имеет низкий уровень привилегий и не может получить доступ к закрытому ключу.
- Сертификат был создан как подпись, но не является обменом ключами.

#### <a name="resolution"></a>Решение

* Для работы с пользовательским интерфейсом используйте учетную запись с соответствующими привилегиями для доступа к закрытому ключу.  
* Импортируйте сертификат, выполнив следующую команду:
    
    ```
    certutil -importpfx FILENAME.pfx AT_KEYEXCHANGE
    ```

## <a name="self-hosted-ir-setup"></a>Настройка самостоятельно размещенного IR

### <a name="integration-runtime-registration-error"></a>Ошибка регистрации в среде выполнения интеграции 

#### <a name="symptoms"></a>Симптомы

Иногда может потребоваться выполнить локально размещенное IR-соединение в другой учетной записи по одной из следующих причин:
- Политика компании запрещает учетную запись службы.
- Требуется проверка подлинности.

После изменения учетной записи службы на панели службы может оказаться, что среда выполнения интеграции перестанет работать и появится следующее сообщение об ошибке:

Во время регистрации произошла ошибка узла Integration Runtime (Self-hosted). Не удается подключиться к службе узла Integration Runtime (Self-hosted) ".

![Снимок экрана: окно Integration Runtime Configuration Manager, в котором отображается ошибка регистрации IR.](media/self-hosted-integration-runtime-troubleshoot-guide/ir-registration-error.png)

#### <a name="cause"></a>Причина

Многие ресурсы предоставляются только учетной записи службы. При изменении учетной записи службы на другую учетную запись разрешения всех зависимых ресурсов остаются без изменений.

#### <a name="resolution"></a>Решение

Чтобы проверить ошибку, перейдите в журнал событий среды выполнения интеграции.

![Снимок экрана журнала событий IR, показывающий, что произошла ошибка времени выполнения.](media/self-hosted-integration-runtime-troubleshoot-guide/ir-event-log.png)

* Если ошибка в журнале событий "UnauthorizedAccessException", выполните следующие действия.

    1. Проверьте учетную запись службы входа *DIAHostService* на панели служб Windows.

        ![Снимок экрана: панель свойств учетной записи службы входа.](media/self-hosted-integration-runtime-troubleshoot-guide/logon-service-account.png)

    1. Проверьте, имеет ли учетная запись службы входа разрешения на чтение и запись для папки *%програмдата%\микрософт\дататрансфер\датаманажементгатевай* .

        - По умолчанию, если учетная запись для входа в службу не была изменена, она должна иметь разрешения на чтение и запись.

            ![Снимок экрана: панель разрешений службы.](media/self-hosted-integration-runtime-troubleshoot-guide/service-permission.png)

        - Если вы изменили учетную запись входа в службу, постарайтесь устранить ее, выполнив следующие действия.
 
            а. Выполните чистую отмену установки текущего саморазмещенного IR.   
            b. Установите собственные IR-биты.  
            c. Измените учетную запись службы, выполнив следующие действия.  

             и. Перейдите в папку с локальной ИНФРАКРАСной установкой и перейдите в папку *Microsoft Integration Runtime\4.0\Shared* .  
             ii. Откройте окно командной строки с повышенными привилегиями. Замените *\<user>* и *\<password>* собственным именем пользователя и паролем, а затем выполните следующую команду:   
                `dmgcmd.exe -SwitchServiceAccount "<user>" "<password>"`  
             iii. Если вы хотите перейти на учетную запись LocalSystem, убедитесь, что для этой учетной записи используется правильный формат: `dmgcmd.exe -SwitchServiceAccount "NT Authority\System" ""`  
                *Не* используйте следующий формат:`dmgcmd.exe -SwitchServiceAccount "LocalSystem" ""`     
             iv. Кроме того, поскольку локальная система имеет более высокий уровень привилегий, чем администратор, вы можете изменить ее в "службах" напрямую.  
             v. Для учетной записи входа в службу IR можно использовать локальную систему или пользователя домена.            

            d. Зарегистрируйте среду выполнения интеграции.

* Если произошла ошибка "Service" Integration Runtime Service "(DIAHostService) не удалось запуститься. Убедитесь, что у вас достаточно прав для запуска системных служб, и выполните следующие действия.

    1. Проверьте учетную запись службы входа *DIAHostService* на панели служб Windows.
    
        ![Снимок экрана: панель "вход" для учетной записи службы.](media/self-hosted-integration-runtime-troubleshoot-guide/logon-service-account.png)

    1. Проверьте, имеет ли учетная запись службы входа разрешение **на вход в качестве службы** для запуска службы Windows:

        ![Снимок экрана: панель свойств "вход в качестве службы".](media/self-hosted-integration-runtime-troubleshoot-guide/logon-as-service.png)

#### <a name="more-information"></a>Дополнительные сведения

Если в вашем случае не применяется ни один из двух предыдущих шаблонов разрешения, попробуйте получить следующие журналы событий Windows: 
- Журналы приложений и служб > Integration Runtime
- > приложение журналов Windows

### <a name="cant-find-the-register-button-to-register-a-self-hosted-ir"></a>Не удается найти кнопку регистрации, чтобы зарегистрировать локальное IR-соединение    

#### <a name="symptoms"></a>Симптомы

При регистрации локальной среды IR кнопка **Регистрация** не отображается в области Configuration Manager.

![Снимок экрана панели Configuration Manager, в котором отображается сообщение о том, что узел среды выполнения интеграции не зарегистрирован.](media/self-hosted-integration-runtime-troubleshoot-guide/no-register-button.png)

#### <a name="cause"></a>Причина

Начиная с версии Integration Runtime 3,0, кнопка **зарегистрировать** на существующих узлах среды выполнения интеграции была удалена, чтобы обеспечить более надежную и безопасную среду. Если узел был зарегистрирован в среде выполнения интеграции независимо от того, подключен он к сети или нет, повторно зарегистрируйте его в другой среде выполнения интеграции путем удаления предыдущего узла, а затем установите и зарегистрируйте узел.

#### <a name="resolution"></a>Решение

1. В панели управления удалите существующую среду выполнения интеграции.

    > [!IMPORTANT] 
    > В следующем процессе выберите **Да**. Не оставляйте данные во время процесса удаления.

    ![Снимок экрана кнопки "Да" для удаления всех пользовательских данных из среды выполнения интеграции.](media/self-hosted-integration-runtime-troubleshoot-guide/delete-data.png)

1. Если у вас нет MSI файла установщика среды выполнения интеграции, перейдите в [Центр загрузки](https://www.microsoft.com/en-sg/download/details.aspx?id=39717) , чтобы скачать последнюю версию среды выполнения интеграции.
1. Установите MSI файл и зарегистрируйте среду выполнения интеграции.


### <a name="unable-to-register-the-self-hosted-ir-because-of-localhost"></a>Не удалось зарегистрировать локальное IR-соединение из-за localhost    

#### <a name="symptoms"></a>Симптомы

Вы не можете зарегистрировать локальную IR на новом компьютере при использовании get_LoopbackIpOrName.

**Отладка:** Произошла ошибка времени выполнения.
Инициализатор типа "Microsoft.DataTransfer.DIAgentHost.DataSourceCache" выдал исключение.
Во время поиска базы данных произошла неустранимая ошибка.
 
**Сведения об исключении:** System. TypeInitializationException: инициализатор типа для "Microsoft. передает. Диаженсост. Датасаурцекаче" вызвал исключение. ---> System .NET. Sockets. SocketException: Неустранимая ошибка произошла во время поиска в базе данных в System .NET. DNS. функцию getaddrinfo (строковое имя).

#### <a name="cause"></a>Причина

Проблема обычно возникает при разрешении localhost.

#### <a name="resolution"></a>Решение

Чтобы разместить файл и устранить проблему, используйте IP-адрес localhost 127.0.0.1.

### <a name="self-hosted-setup-failed"></a>Сбой установки в автономном размещении    

#### <a name="symptoms"></a>Симптомы

Невозможно удалить существующий IR-объект, установить новый IR или обновить существующий IR на новый IR.

#### <a name="cause"></a>Причина

Установка среды выполнения интеграции зависит от службы установщик Windows. Проблемы установки могут возникать по следующим причинам.
- Недостаточно свободного места на диске.
- Отсутствие разрешений.
- Служба Windows NT заблокирована.
- Загрузка ЦП слишком высока.
- Файл MSI размещается в низком сетевом расположении.
- Некоторые системные файлы или реестры были непреднамеренно затронуты.

### <a name="the-ir-service-account-failed-to-fetch-certificate-access"></a>Учетной записи службы IR не удалось получить доступ к сертификату

#### <a name="symptoms"></a>Симптомы

При установке локальной среды IR через Microsoft Integration Runtime Configuration Manager создается сертификат с доверенным центром сертификации (ЦС). Не удалось применить сертификат для шифрования обмена данными между двумя узлами, и отображается следующее сообщение об ошибке: 

"Не удалось изменить режим шифрования связи в интрасети: не удалось предоставить учетной записи службы Integration Runtime доступ к сертификату" \<*certificate name*> ". Код ошибки 103 "

![Снимок экрана, отображающий сообщение об ошибке: "... Не удалось предоставить Integration Runtime доступа к сертификату учетной записи службы ".](media/self-hosted-integration-runtime-troubleshoot-guide/integration-runtime-service-account-certificate-error.png)

#### <a name="cause"></a>Причина

Сертификат использует хранилище поставщика хранилища ключей (KSP), которое пока не поддерживается. На сегодняшний день, локально размещенное IR поддерживает только хранилище поставщика служб шифрования (CSP).

#### <a name="resolution"></a>Решение

В этом случае рекомендуется использовать сертификаты CSP.

**Решение 1** 

Чтобы импортировать сертификат, выполните следующую команду:

`Certutil.exe -CSP "CSP or KSP" -ImportPFX FILENAME.pfx`

![Снимок экрана команды Certutil для импорта сертификата.](media/self-hosted-integration-runtime-troubleshoot-guide/use-certutil.png)

**Решение 2** 

Чтобы преобразовать сертификат, выполните следующие команды:

`openssl pkcs12 -in .\xxxx.pfx -out .\xxxx_new.pem -password pass: <EnterPassword>`
`openssl pkcs12 -export -in .\xxxx_new.pem -out xxxx_new.pfx`

До и после преобразования:

![Снимок экрана результата перед преобразованием сертификата.](media/self-hosted-integration-runtime-troubleshoot-guide/before-certificate-change.png)

![Снимок экрана результата преобразования сертификата.](media/self-hosted-integration-runtime-troubleshoot-guide/after-certificate-change.png)

### <a name="self-hosted-integration-runtime-version-5x"></a>Локальная среда выполнения интеграции версии 5. x
Для обновления до версии 5. x локальной среды выполнения интеграции фабрики данных Azure требуется **платформа .NET Framework Runtime 4.7.2** или более поздней версии. На странице загрузки вы найдете ссылки для скачивания последней версии 4. x и последних двух версий 5. x. 

Для клиентов фабрики данных Azure версии 2:
- Если автоматическое обновление включено и вы уже обновили среду выполнения платформа .NET Framework до 4.7.2 или более поздней версии, то локальная среда выполнения интеграции будет автоматически обновлена до последней версией 5. x.
- Если автоматическое обновление включено и вы еще не обновили среду выполнения платформа .NET Framework до 4.7.2 или более поздней версии, то локальная среда выполнения интеграции не будет автоматически обновлена до последней версией 5. x. Локальная среда выполнения интеграции останется в текущей версии 4. x. Вы видите предупреждение об обновлении среды выполнения платформа .NET Framework на портале и в клиенте локальной среды выполнения интеграции.
- Если автоматическое обновление отключено и вы уже обновили среду выполнения платформа .NET Framework до 4.7.2 или более поздней версии, вы можете вручную скачать последнюю версию 5. x и установить ее на компьютере.
- Если автоматическое обновление отключено и вы не обновили среду выполнения платформа .NET Framework до 4.7.2 или более поздней версии. При попытке вручную установить локальную среду выполнения интеграции 5. x и зарегистрировать ключ вам потребуется сначала обновить версию среды выполнения платформа .NET Framework.


Для клиентов фабрики данных Azure версии 1:
- Локальная среда выполнения интеграции 5. X не поддерживает фабрику данных Azure версии 1.
- Локальная среда выполнения интеграции будет автоматически обновлена до последней версии 4. x. И последняя версия 4. x не будет иметь срок действия. 
- Если вы попытаетесь вручную установить локальную среду выполнения интеграции 5. x и зарегистрировать ключ, вы получите уведомления о том, что локальная среда выполнения интеграции 5. x не поддерживает фабрику данных Azure версии 1.


## <a name="self-hosted-ir-connectivity-issues"></a>Проблемы с подключением к локальной среде IR

### <a name="self-hosted-integration-runtime-cant-connect-to-the-cloud-service"></a>Локальной среде выполнения интеграции не удается подключиться к облачной службе

#### <a name="symptoms"></a>Симптомы

При попытке регистрации локальной среды выполнения интеграции Configuration Manager отображает следующее сообщение об ошибке:

"При регистрации произошла ошибка узла Integration Runtime (Self-hosted)".

![Снимок экрана: сообщение об ошибке "узел Integration Runtime (Self-hosted) обнаружил ошибку во время регистрации".](media/self-hosted-integration-runtime-troubleshoot-guide/unable-to-connect-to-cloud-service.png)

#### <a name="cause"></a>Причина 

Локально размещенное IR не может подключиться к серверной части службы фабрики данных Azure. Эта проблема обычно связана с параметрами сети в брандмауэре.

#### <a name="resolution"></a>Решение

1. Проверьте, запущена ли служба среды выполнения интеграции. Если это так, перейдите к шагу 2.
    
   ![Снимок экрана, показывающий, что локальная служба IR работает.](media/self-hosted-integration-runtime-troubleshoot-guide/integration-runtime-service-running-status.png)
    
1. Если прокси-сервер не настроен на автономной среде IR, которая является значением по умолчанию, выполните следующую команду PowerShell на компьютере, где установлена локальная среда выполнения интеграции:

    ```powershell
    (New-Object System.Net.WebClient).DownloadString("https://wu2.frontend.clouddatahub.net/")
    ```
        
   > [!NOTE]     
   > URL-адрес службы может отличаться в зависимости от расположения экземпляра фабрики данных. Чтобы найти URL-адрес службы, выберите элемент **Пользовательский интерфейс ADF**  >    >  **среды выполнения интеграция**  >  **изменить локальные IR**  >  **узлы**  >  **Просмотр URL-адресов служб**.
            
    Ожидается примерно такой ответ:
            
    ![Снимок экрана: ответ команды PowerShell.](media/self-hosted-integration-runtime-troubleshoot-guide/powershell-command-response.png)
            
1. Если вы не получаете ожидаемый ответ, используйте один из следующих методов:
            
    * Если вы получаете сообщение Remote name could not be resolved (Не удалось разрешить удаленное имя), это указывает на проблему в службе доменных имен (DNS). Чтобы устранить эту проблему, обратитесь к команде сети.
    * Если появляется сообщение "сертификат SSL/TLS не является доверенным", [Проверьте сертификат](https://wu2.frontend.clouddatahub.net/) , чтобы узнать, является ли он доверенным на компьютере, а затем установите общедоступный сертификат с помощью диспетчера сертификатов. Это действие должно устранить проблему.
    * Перейдите в   >  **окно просмотра событий Windows (журналы)**  >  **журналы приложений и служб**  >  **Integration Runtime** и проверьте наличие ошибок, вызванных DNS, правилом брандмауэра или корпоративными параметрами сети. Если вы обнаружите такой сбой, принудительно Закройте подключение. Так как для каждой компании настроены собственные параметры сети, обратитесь к группе сети, чтобы устранить эти проблемы.

1. Если для локальной среды выполнения интеграции настроен прокси-сервер, убедитесь, что этот прокси-сервер имеет доступ к конечной точке службы. Пример команды для такой проверки см. [здесь](https://stackoverflow.com/questions/571429/powershell-web-requests-and-proxies).    
                
    ```powershell
    $user = $env:username
    $webproxy = (get-itemproperty 'HKCU:\Software\Microsoft\Windows\CurrentVersion\Internet
    Settings').ProxyServer
    $pwd = Read-Host "Password?" -assecurestring
    $proxy = new-object System.Net.WebProxy
    $proxy.Address = $webproxy
    $account = new-object System.Net.NetworkCredential($user,[Runtime.InteropServices.Marshal]::PtrToStringAuto([Runtime.InteropServices.Marshal]::SecureStringToBSTR($pwd)), "")
    $proxy.credentials = $account
    $url = "https://wu2.frontend.clouddatahub.net/"
    $wc = new-object system.net.WebClient
    $wc.proxy = $proxy
    $webpage = $wc.DownloadData($url)
    $string = [System.Text.Encoding]::ASCII.GetString($webpage)
    $string
    ```

Ожидается примерно такой ответ:
            
![Снимок экрана: ожидаемый ответ команды PowerShell.](media/self-hosted-integration-runtime-troubleshoot-guide/powershell-command-response.png)

> [!NOTE] 
> Рекомендации по использованию прокси-сервера:
> * Убедитесь, что прокси-сервер должен быть размещен в списке надежных получателей. Если это так, включите в список надежных получателей [эти домены](./data-movement-security-considerations.md#firewall-requirements-for-on-premisesprivate-network).
> * Проверьте, является ли сертификат SSL/TLS "wu2.frontend.clouddatahub.net/" доверенным на прокси-сервере.
> * Если вы используете в прокси-сервере проверку подлинности Active Directory, укажите в поле "Служба среды выполнения интеграции" вместо учетной записи службы учетную запись пользователя с доступом к прокси-серверу.

### <a name="error-message-self-hosted-integration-runtime-nodelogical-self-hosted-ir-is-in-inactive-running-limited-state"></a>Сообщение об ошибке: узел локальной среды выполнения интеграции/логический саморазмещаемый IR находится в неактивном состоянии (с ограничением)

#### <a name="cause"></a>Причина 

Изолированный узел интегрированной среды выполнения может иметь состояние **неактивно**, как показано на следующем снимке экрана:

![Снимок экрана: узел интегрированной среды выполнения с неактивным состоянием](media/self-hosted-integration-runtime-troubleshoot-guide/inactive-self-hosted-ir-node.png)

Такое может происходить, если узлы не могут нормально взаимодействовать.

#### <a name="resolution"></a>Решение

1. Войдите на виртуальную машину, размещенную на узле. В разделе **журналы приложений и служб**  >  **Integration Runtime** Откройте Просмотр событий и отфильтруйте журналы ошибок.

1. Проверьте, содержит ли журнал ошибок следующую ошибку: 
    
    ```
    System.ServiceModel.EndpointNotFoundException: Could not connect to net.tcp://xxxxxxx.bwld.com:8060/ExternalService.svc/WorkerManager. The connection attempt lasted for a time span of 00:00:00.9940994. TCP error code 10061: No connection could be made because the target machine actively refused it 10.2.4.10:8060. 
    System.Net.Sockets.SocketException: No connection could be made because the target machine actively refused it. 
    10.2.4.10:8060
    at System.Net.Sockets.Socket.DoConnect(EndPoint endPointSnapshot, SocketAddress socketAddress)
    at System.Net.Sockets.Socket.Connect(EndPoint remoteEP)
    at System.ServiceModel.Channels.SocketConnectionInitiator.Connect(Uri uri, TimeSpan timeout)
    ```
       
1. Если вы видите эту ошибку, выполните следующую команду в окне командной строки: 

   ```
   telnet 10.2.4.10 8060
   ```
   
1. Если появится сообщение об ошибке "не удается открыть подключение к узлу", которое показано на следующем снимке экрана, обратитесь к ИТ-отделу за помощью в устранении этой проблемы. После успешной установки Telnet обратитесь в служба поддержки Майкрософт, если у вас по-прежнему возникают проблемы с состоянием узла среды выполнения интеграции.
        
   ![Снимок экрана: Ошибка командной строки "не удалось открыть подключение к узлу".](media/self-hosted-integration-runtime-troubleshoot-guide/command-line-error.png)
        
1. Проверьте, содержит ли журнал ошибок следующую запись:

    ```
    Error log: Cannot connect to worker manager: net.tcp://xxxxxx:8060/ExternalService.svc/ No DNS entries exist for host azranlcir01r1. No such host is known Exception detail: System.ServiceModel.EndpointNotFoundException: No DNS entries exist for host xxxxx. ---> System.Net.Sockets.SocketException: No such host is known at System.Net.Dns.GetAddrInfo(String name) at System.Net.Dns.InternalGetHostByName(String hostName, Boolean includeIPv6) at System.Net.Dns.GetHostEntry(String hostNameOrAddress) at System.ServiceModel.Channels.DnsCache.Resolve(Uri uri) --- End of inner exception stack trace --- Server stack trace: at System.ServiceModel.Channels.DnsCache.Resolve(Uri uri)
    ```
    
1. Чтобы устранить эту проблему, попробуйте один из следующих методов или оба.
    - Разместите все узлы в одном домене.
    - Добавьте сопоставление IP и узлов во все файлы узлов размещенной виртуальной машины.

### <a name="connectivity-issue-between-the-self-hosted-ir-and-your-data-factory-instance-or-the-self-hosted-ir-and-the-data-source-or-sink"></a>Проблемы с подключением между локальным IR и экземпляром фабрики данных либо с помощью самостоятельно размещенного IR, источника данных или приемника

Чтобы устранить неполадки с сетевым подключением, необходимо знать, как получить трассировку сети, понять, как ее использовать, и [проанализировать трассировку Microsoft Network Monitor (Netmon)](#analyze-the-netmon-trace) перед применением средств NetMon в реальных случаях из локальной среды IR.

#### <a name="symptoms"></a>Симптомы

Иногда может потребоваться устранение некоторых проблем с подключением между локальным IR и экземпляром фабрики данных, как показано на следующем снимке экрана, или между локальным IR и источником данных или приемником. 

![Снимок экрана сообщения об ошибке "обработанный HTTP-запрос"](media/self-hosted-integration-runtime-troubleshoot-guide/http-request-error.png)

В любом из этих экземпляров могут возникать следующие ошибки.

* "Сбой копирования с ошибкой: Type = Microsoft. Хибридделиверексцептион. Common. Shared., сообщение = не удается подключиться к SQL Server:" IP-адрес ""

* "Произошла одна или несколько ошибок. An error occurred while sending the request. Базовое соединение закрыто: произошла непредвиденная ошибка при получении. Не удалось считать данные из транспортного соединения: существующее подключение было принудительно закрыто удаленным узлом. Существующее подключение было принудительно закрыто ИДЕНТИФИКАТОРом действия удаленного узла. "

#### <a name="resolution"></a>Решение

При возникновении предыдущих ошибок устраните их, следуя инструкциям в этом разделе.

- Получение трассировки Netmon для анализа: 

    1. Вы можете настроить фильтр для просмотра сброса с сервера на стороне клиента. На снимке экрана ниже показан пример, на котором сервер является сервером фабрики данных.

        ![Снимок экрана: сервер фабрики данных.](media/self-hosted-integration-runtime-troubleshoot-guide/data-factory-server.png)

    1. При получении пакета сброса этот диалог можно найти по протоколу TCP.

        ![Снимок экрана диалога TCP.](media/self-hosted-integration-runtime-troubleshoot-guide/find-conversation.png)

    1. Получите диалог между клиентом и сервером фабрики данных ниже, удалив фильтр.

        ![Снимок экрана с подробными сведениями о диалоге.](media/self-hosted-integration-runtime-troubleshoot-guide/get-conversation.png)

- Анализ собираемой трассировки Netmon показывает, что сумма срока жизни (TTL)) составляет 64. В соответствии со значениями, указанными в статье [основы IP-срока жизни и предельного числа прыжков](https://packetpushers.net/ip-time-to-live-and-hop-limit-basics/) , извлеченной в следующем списке, можно увидеть, что это система Linux, которая сбрасывает пакет и вызывает отключение.

    Значения TTL и предельного числа прыжков по умолчанию различаются в разных операционных системах, как показано ниже:
    - Ядро Linux 2,4 (приблизительно 2001): 255 для TCP, UDP и протокола ICMP (Internet Control Protocol)
    - Ядро Linux 4,10 (2015): 64 для TCP, UDP и ICMP
    - Windows XP (2001): 128 для TCP, UDP и ICMP
    - Windows 10 (2015): 128 для TCP, UDP и ICMP
    - Windows Server 2008:128 для TCP, UDP и ICMP
    - Windows Server 2019 (2018): 128 для TCP, UDP и ICMP
    - macOS (2001): 64 для TCP, UDP и ICMP

    ![Снимок экрана, показывающий значение TTL, равное 61.](media/self-hosted-integration-runtime-troubleshoot-guide/ttl-61.png)
    
    В предыдущем примере TTL отображается как 61 вместо 64, так как когда сетевой пакет достигает назначения, он должен пройти через различные прыжки, например маршрутизаторы или сетевые устройства. Число маршрутизаторов или сетевых устройств вычитается для получения окончательного срока жизни.
    
    В этом случае можно увидеть, что сброс может быть отправлен из системы Linux с TTL 64.

-  Чтобы подтвердить, откуда может быть сброшено устройство, проверьте четвертый прыжок с локальной среды IR.
 
    *Сетевой пакет из Linux, система A с TTL 64-> B TTL 64 минус 1 = 63-> C TTL 63 минус 1 = 62-> TTL 62 минус 1 = 61 локальная среда IR*

- В идеальной ситуации номер прыжка TTL будет 128, что означает, что операционная система Windows выполняет экземпляр фабрики данных. Как показано в следующем примере, *128 минус 107 = 21 прыжков*, что означает, что 21 прыжки для пакета были отправлены из экземпляра фабрики данных в локальную ИК-среду во время подтверждения TCP 3.
 
    ![Снимок экрана, показывающий значение TTL, равное 107.](media/self-hosted-integration-runtime-troubleshoot-guide/ttl-107.png)

    Поэтому необходимо привлечь сетевую команду к проверке того, что четвертый прыжок относится к локальной среде IR. Если это брандмауэр, как в системе Linux, проверьте все журналы, чтобы узнать, почему устройство сбрасывает пакет после подтверждения TCP 3. 
    
    Если вы не знаете, где следует исследовать, попытайтесь получить трассировку Netmon из локальной среды IR и брандмауэра во время проблемного времени. Этот подход поможет вам определить, какое устройство может сбросить пакет и что привело к отсоединению. В этом случае необходимо также привлечь вас к группе по сети.

### <a name="analyze-the-netmon-trace"></a>Анализ трассировки Netmon

> [!NOTE] 
> Приведенные ниже инструкции относятся к трассировке Netmon. Так как трассировка NetMon в настоящее время не поддерживается, для этой цели можно использовать Wireshark.

При попытке выполнить Telnet **8.8.8.8 888** с собранной трассировкой Netmon вы увидите трассировку на следующих снимках экрана:

![Снимок экрана: сообщение об ошибке "не удалось открыть подключение к узлу через порт 888".](media/self-hosted-integration-runtime-troubleshoot-guide/netmon-trace-1.png)

![Снимок экрана, показывающий описание трассировки Netmon.](media/self-hosted-integration-runtime-troubleshoot-guide/netmon-trace-2.png)
 

На приведенных выше изображениях показано, что не удалось установить TCP-подключение к серверу **8.8.8.8** на порту **888**, поэтому в нем можно увидеть два **синретрансмит** дополнительных пакета. Поскольку источнику **Self-HOST2** не удалось подключиться к **8.8.8.8** с помощью первого пакета, он будет пытаться установить соединение.

> [!TIP]
> Чтобы установить это подключение, попробуйте следующее решение:
> 1. Выберите **загрузить фильтр** по  >  **стандарту**  >  **адреса**  >  **IPv4** адреса.
> 1. Чтобы применить фильтр, введите **IPv4. Address = = 8.8.8.8**, а затем нажмите кнопку **Применить**. После этого вы увидите связь между локальным компьютером и назначением **8.8.8.8**.

![Снимок экрана, показывающий адреса фильтра.](media/self-hosted-integration-runtime-troubleshoot-guide/filter-addresses-1.png)
        
![Снимок экрана с дополнительными адресами фильтра.](media/self-hosted-integration-runtime-troubleshoot-guide/filter-addresses-2.png)

В следующих примерах показаны успешные сценарии. 

- Если вы можете установить Telnet **8.8.8.8 53** без каких-либо проблем, то будет выполнено успешное подтверждение TCP 3, и сеанс завершится с помощью подтверждения TCP 4.

    ![Снимок экрана, иллюстрирующий успешный сценарий подключения.](media/self-hosted-integration-runtime-troubleshoot-guide/good-scenario-1.png)
     
    ![Снимок экрана с подробными сведениями о случае успешного подключения.](media/self-hosted-integration-runtime-troubleshoot-guide/good-scenario-2.png)

- Предыдущее подтверждение TCP 3 создает следующий рабочий процесс:

    ![Схема рабочего процесса подтверждения TCP 3.](media/self-hosted-integration-runtime-troubleshoot-guide/tcp-3-handshake-workflow.png)
 
- Подтверждение TCP 4 для завершения сеанса проиллюстрировано следующими рабочими процессами:

    ![Снимок экрана с подробными сведениями о подтверждении TCP 4.](media/self-hosted-integration-runtime-troubleshoot-guide/tcp-4-handshake.png)

    ![Схема рабочего процесса подтверждения TCP 4.](media/self-hosted-integration-runtime-troubleshoot-guide/tcp-4-handshake-workflow.png) 

### <a name="microsoft-email-notification-about-updating-your-network-configuration"></a>Уведомление по электронной почте Майкрософт об обновлении конфигурации сети

Вы можете получить следующее уведомление по электронной почте, которое рекомендует обновить конфигурацию сети, чтобы разрешить обмен данными с новыми IP-адресами для фабрики данных Azure на 8 ноября 2020:

   ![Снимок экрана уведомления Майкрософт по электронной почте, запрашивающего обновление конфигурации сети.](media/self-hosted-integration-runtime-troubleshoot-guide/email-notification.png)

#### <a name="determine-whether-this-notification-affects-you"></a>Определите, влияет ли это уведомление на вас

Это уведомление относится к следующим сценариям.

##### <a name="scenario-1-outbound-communication-from-a-self-hosted-integration-runtime-thats-running-on-premises-behind-a-corporate-firewall"></a>Сценарий 1. исходящий трафик из локальной среды выполнения интеграции, которая работает локально за корпоративным брандмауэром

Как определить, затрагивается ли ваш компьютер:

- При определении правил брандмауэра на основе полных доменных имен (FQDN), которые используют подход, описанный в разделе [Настройка конфигурации брандмауэра и списка разрешений для IP-адресов](data-movement-security-considerations.md#firewall-configurations-and-allow-list-setting-up-for-ip-addresses), это *не* повлияет.

- При явном включении списка разрешений для исходящих IP-адресов в корпоративном брандмауэре *возникает проблема.*

   Если вы затронйте это, выполните следующее действие: до 8 ноября 2020. Сообщите команде сетевой инфраструктуры, чтобы обновить конфигурацию сети для использования последних IP-адресов фабрики данных. Чтобы скачать последние IP-адреса, перейдите к разделу [Обнаружение тегов службы с помощью загружаемых файлов JSON](../virtual-network/service-tags-overview.md#discover-service-tags-by-using-downloadable-json-files).

##### <a name="scenario-2-outbound-communication-from-a-self-hosted-integration-runtime-thats-running-on-an-azure-vm-inside-a-customer-managed-azure-virtual-network"></a>Сценарий 2. исходящий трафик из локальной среды выполнения интеграции, которая выполняется на виртуальной машине Azure в управляемой клиентом виртуальной сети Azure

Как определить, затрагивается ли ваш компьютер:

- Проверьте, есть ли у вас правила исходящей группы безопасности сети (NSG) в частной сети, содержащей локальную среду выполнения интеграции. Если ограничения для исходящего трафика отсутствуют, это не повлияет.

- Если у вас есть ограничения на исходящие правила, проверьте, используются ли Теги служб. Если вы используете Теги службы, это не повлияет. Нет необходимости изменять или добавлять ничего, так как новый диапазон IP-адресов находится под существующими тегами службы. 

  ![Снимок экрана: Проверка назначения, показывающая, что в качестве места назначения указан факт.](media/self-hosted-integration-runtime-troubleshoot-guide/destination-check.png)

- Вы *задействуете, если* вы явно включаете список разрешений для исходящих IP-адресов в параметре правил NSG в виртуальной сети Azure.

   Если вы затронйте это, выполните следующее действие: до 8 ноября 2020. Сообщите команде сетевой инфраструктуры, чтобы обновить правила NSG в конфигурации виртуальной сети Azure, чтобы использовать последние IP-адреса фабрики данных. Чтобы скачать последние IP-адреса, перейдите к разделу [Обнаружение тегов службы с помощью загружаемых файлов JSON](../virtual-network/service-tags-overview.md#discover-service-tags-by-using-downloadable-json-files).

##### <a name="scenario-3-outbound-communication-from-ssis-integration-runtime-in-a-customer-managed-azure-virtual-network"></a>Сценарий 3. исходящий трафик из служб SSIS Integration Runtime в виртуальной сети Azure, управляемой клиентом

Как определить, затрагивается ли ваш компьютер:

- Проверьте, имеются ли правила исходящего трафика NSG в частной сети, содержащей Integration Runtime SQL Server Integration Services (SSIS). Если ограничения для исходящего трафика отсутствуют, это не повлияет.

- Если у вас есть ограничения на исходящие правила, проверьте, используются ли Теги служб. Если вы используете Теги службы, это не повлияет. Нет необходимости изменять или добавлять ничего, так как новый диапазон IP-адресов находится под существующими тегами службы.

- Вы *задействуете, если* вы явно включаете список разрешений для исходящих IP-адресов в параметре правил NSG в виртуальной сети Azure.

  Если вы затронйте это, выполните следующее действие: до 8 ноября 2020. Сообщите команде сетевой инфраструктуры, чтобы обновить правила NSG в конфигурации виртуальной сети Azure, чтобы использовать последние IP-адреса фабрики данных. Чтобы скачать последние IP-адреса, перейдите к разделу [Обнаружение тегов службы с помощью загружаемых файлов JSON](../virtual-network/service-tags-overview.md#discover-service-tags-by-using-downloadable-json-files).

### <a name="couldnt-establish-a-trust-relationship-for-the-ssltls-secure-channel"></a>Не удалось установить отношение доверия для защищенного канала SSL/TLS 

#### <a name="symptoms"></a>Симптомы

Локальной среде IR не удалось подключиться к службе фабрики данных Azure.

При проверке самостоятельно размещенного журнала событий IR или журналов уведомлений клиента в таблице Кустомложевент вы увидите следующее сообщение об ошибке:

"Базовое соединение закрыто: не удалось установить доверительные отношения для защищенного канала SSL/TLS. Удаленный сертификат недопустим согласно процедуре проверки".

Самый простой способ проверить сертификат сервера службы фабрики данных — открыть URL-адрес службы фабрики данных в браузере. Например, откройте [ссылку проверить сертификат сервера](https://eu.frontend.clouddatahub.net/) на компьютере, где установлена локальная среда IR, и просмотрите сведения о сертификате сервера.

  ![Снимок экрана с панелью проверки сертификата сервера в службе фабрики данных Azure.](media/self-hosted-integration-runtime-troubleshoot-guide/server-certificate.png)

  ![Снимок экрана окна для проверки пути сертификации сервера.](media/self-hosted-integration-runtime-troubleshoot-guide/certificate-path.png)

#### <a name="cause"></a>Причина

Эта проблема может быть вызвана двумя причинами.

- Причина 1. корневой ЦС сертификата сервера службы фабрики данных не является доверенным на компьютере, где установлена локальная среда IR. 
- Причина 2. вы используете прокси-сервер в своей среде, сертификат сервера службы фабрики данных заменяется прокси-сервером, а замененный сертификат сервера не является доверенным для компьютера, на котором установлена локальная среда IR.

#### <a name="resolution"></a>Решение

- Причина 1: Убедитесь, что сертификат сервера фабрики данных и его цепочка сертификатов являются доверенными для компьютера, на котором установлена локальная среда IR.
- Причина 2: либо следует доверять замененному корневому центру сертификации на собственном IR-компьютере, либо настроить прокси-сервер так, чтобы он не заменил сертификат сервера фабрики данных.

Дополнительные сведения о доверии сертификатов в Windows см. [в разделе Установка доверенного корневого сертификата](/skype-sdk/sdn/articles/installing-the-trusted-root-certificate).

#### <a name="additional-information"></a>Дополнительные сведения
Мы разработали новый SSL-сертификат, который подписывается из DigiCert. Проверьте, находится ли глобальная корневая папка G2 DigiCert в доверенном корневом ЦС.

  ![Снимок экрана с глобальной корневой папкой G2 DigiCert в каталоге доверенных корневых центров сертификации.](media/self-hosted-integration-runtime-troubleshoot-guide/trusted-root-ca-check.png)

Если он не находится в доверенном корневом ЦС, [скачайте его здесь](http://cacerts.digicert.com/DigiCertGlobalRootG2.crt ). 


## <a name="self-hosted-ir-sharing"></a>Предоставление общего доступа к локальной среде IR

### <a name="sharing-a-self-hosted-ir-from-a-different-tenant-is-not-supported"></a>Совместное использование автономного IR из другого клиента не поддерживается 

#### <a name="symptoms"></a>Симптомы

Вы можете заметить другие фабрики данных (в разных клиентах), так как вы пытаетесь предоставить доступ к локальным IR с помощью пользовательского интерфейса фабрики данных Azure, но вы не можете поделиться им в фабриках данных, находящиеся в разных клиентах.

#### <a name="cause"></a>Причина

Локальная среда IR не может совместно использоваться несколькими клиентами.

## <a name="next-steps"></a>Следующие шаги

Для получения дополнительных сведений об устранении неполадок воспользуйтесь следующими ресурсами:

*  [Блог о Фабрике данных](https://azure.microsoft.com/blog/tag/azure-data-factory/)
*  [Запросы на добавление функции в Фабрику данных](https://feedback.azure.com/forums/270578-data-factory)
*  [Видео по Azure](https://azure.microsoft.com/resources/videos/index/?sort=newest&services=data-factory)
*  [Microsoft Q&странице](/answers/topics/azure-data-factory.html)
*  [Форум о переполнении стека для фабрики данных](https://stackoverflow.com/questions/tagged/azure-data-factory)
*  [Сведения о Фабрике данных в Twitter](https://twitter.com/hashtag/DataFactory)
*  [Пошаговое руководств по производительности потоков данных сопоставления](concepts-data-flow-performance.md)
