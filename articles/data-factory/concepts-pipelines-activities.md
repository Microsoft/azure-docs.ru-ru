---
title: Конвейеры и действия в фабрике данных Azure
description: Узнайте о конвейерах и действиях в фабрике данных Azure.
author: dcstwh
ms.author: weetok
ms.service: data-factory
ms.topic: conceptual
ms.date: 11/19/2019
ms.openlocfilehash: 870c812a68f765f987cfd3d1b953e0afeb3e9055
ms.sourcegitcommit: d4734bc680ea221ea80fdea67859d6d32241aefc
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/14/2021
ms.locfileid: "100364534"
---
# <a name="pipelines-and-activities-in-azure-data-factory"></a>Конвейеры и действия в фабрике данных Azure

> [!div class="op_single_selector" title1="Выберите используемую версию службы "Фабрика данных":"]
> * [Версия 1](v1/data-factory-create-pipelines.md)
> * [Текущая версия](concepts-pipelines-activities.md)
[!INCLUDE[appliesto-adf-asa-md](includes/appliesto-adf-asa-md.md)]

В этой статье вы ознакомитесь с принципом работы конвейеров и действий в фабрике данных Azure и узнаете, как с их помощью создавать комплексные рабочие процессы, управляемые данными, для сценариев перемещения и обработки данных.

## <a name="overview"></a>Обзор
Фабрика данных может иметь один или несколько конвейеров. Конвейер — это логическая группа действий, которые совместно выполняют определенный блок задач. Например, конвейер может содержать набор действий, вставляющих и очищающих данные журнала, а затем запускающий поток данных сопоставления для анализа данных журнала. Конвейер позволяет управлять действиями в наборе, а не каждым из них в отдельности. Вы развертываете и планируете конвейер, а не действия отдельно.

Действия в конвейере определяют действия, выполняемые с данными. Например, действие копирования можно использовать для копирования данных из SQL Server в хранилище BLOB-объектов Azure. Затем используйте действие потока данных или записной книжки "данные о модулях" для обработки и преобразования данных из хранилища BLOB-объектов в пул Azure синапсе Analytics на основе построений решений для создания отчетов.

Фабрика данных включает три группы действий: [действия перемещения данных](copy-activity-overview.md), [действия преобразования данных](transform-data.md)и [действия управления](#control-flow-activities). Действие может принимать нулевые или более входных [набора](concepts-datasets-linked-services.md) данных и создавать один или несколько выходных [наборов](concepts-datasets-linked-services.md)данных. На следующей схеме показана связь между конвейером, действием и набором данных в фабрике данных:

![Связь между набором данных, действием и конвейером](media/concepts-pipelines-activities/relationship-between-dataset-pipeline-activity.png)

Входной набор данных представляет входные данные для действия в конвейере, а выходной набор данных — выходные данные для действия. Наборы данных представляют данные в разных хранилищах, например в таблицах, файлах, папках и документах. Созданные наборы данных можно использовать для действий в конвейере. Например, можно указать входной или выходной набор данных для действия HDInsightHive или действия копирования. Дополнительные сведения о наборах данных см. в статье [Наборы данных в фабрике данных Azure](concepts-datasets-linked-services.md).

## <a name="data-movement-activities"></a>Действия перемещения данных

Действие копирования в фабрике данных копирует данные из хранилища-источника в хранилище-приемник. Фабрика данных поддерживает хранилища данных, перечисленные в таблице в этом разделе. Данные из любого источника можно записывать в любой приемник. Щелкните название хранилища, чтобы узнать, как скопировать данные из него или в него.

[!INCLUDE [data-factory-v2-supported-data-stores](../../includes/data-factory-v2-supported-data-stores.md)]

Дополнительные сведения см. в статье [Действие копирования в фабрике данных Azure](copy-activity-overview.md).

## <a name="data-transformation-activities"></a>Действия преобразования данных
Фабрика данных Azure поддерживает указанные ниже действия преобразования, которые вы можете добавлять в конвейеры как по отдельности, так и в связи с другим действием.

Действия по преобразованию данных | Вычислительная среда
---------------------------- | -------------------
[Поток данных](control-flow-execute-data-flow-activity.md) | Azure Databricks под управлением фабрики данных Azure
[Функция Azure](control-flow-azure-function-activity.md) | Функции Azure
[Hive](transform-data-using-hadoop-hive.md) | HDInsight [Hadoop]
[Pig](transform-data-using-hadoop-pig.md) | HDInsight [Hadoop]
[MapReduce](transform-data-using-hadoop-map-reduce.md) | HDInsight [Hadoop]
[Потоковая передача Hadoop](transform-data-using-hadoop-streaming.md) | HDInsight [Hadoop]
[Spark](transform-data-using-spark.md) | HDInsight [Hadoop]
[Действия Машинного обучения Azure Studio (классическая модель): машинного обучения Azure и фабрики данных Azure](transform-data-using-machine-learning.md) | Azure
[Хранимая процедура](transform-data-using-stored-procedure.md) | Azure SQL, Azure Synapse Analytics или SQL Server
[U-SQL](transform-data-using-data-lake-analytics.md) | Аналитика озера данных Azure
[Настраиваемое действие](transform-data-using-dotnet-custom-activity.md) | Пакетная служба Azure
[Записная книжка Databricks](transform-data-databricks-notebook.md) | Azure Databricks
[Действие JAR в Databricks](transform-data-databricks-jar.md) | Azure Databricks
[Действие Python в Databricks](transform-data-databricks-python.md) | Azure Databricks

Дополнительные сведения см. в статье [Преобразование данных в фабрике данных Azure](transform-data.md).

## <a name="control-flow-activities"></a>Действия потока управления
Поддерживаются следующие действия потока управления:

Действие управления | Описание
---------------- | -----------
[Добавить переменную](control-flow-append-variable-activity.md) | Добавьте значение в существующую переменную массива.
[Выполнить конвейер](control-flow-execute-pipeline-activity.md) | Действие выполнения конвейера позволяет конвейеру фабрики данных вызвать другой конвейер.
[Фильтр](control-flow-filter-activity.md) | Применение критерия фильтра к входному массиву
[Для каждого](control-flow-for-each-activity.md) | Действие ForEach определяет повторяющийся поток управления в конвейере. Это действие используется для выполнения итерации коллекции и выполняет указанные в цикле действия. Реализация цикла этого действия аналогична структуре цикла Foreach на языках программирования.
[Получение метаданных](control-flow-get-metadata-activity.md) | Действие GetMetadata можно использовать для получения метаданных любых данных в фабрике данных Azure.
[Действие условия If](control-flow-if-condition-activity.md) | Это действие можно использовать для создания ветви на основе условия, результатом расчета которого является значение True или False. Действие условия If предоставляет те же функциональные возможности, что и инструкция if в языках программирования. Он оценивает набор действий, когда условие принимает значение `true` , и другой набор действий, когда условие принимает значение `false.`
[Действие поиска](control-flow-lookup-activity.md) | Действие поиска можно использовать для считывания или поиска записи, имени таблицы и значения из внешних источников. На эти выходные данные можно затем ссылаться в последующих действиях.
[Задать переменную](control-flow-set-variable-activity.md) | Задает значение существующей переменной.
[Действие Until](control-flow-until-activity.md) | Реализует цикл Do Until, который аналогичен циклической структуре Do-Until в языках программирования. Оно выполняет набор действий в цикле, пока условие, связанное с действием, не получит значение true. Можно указать значение времени ожидания для действия until в фабрике данных.
[Действие проверки](control-flow-validation-activity.md) | Убедитесь, что конвейер будет продолжать выполнение только в том случае, если ссылочный набор данных существует, соответствует заданному критерию или достигнуто время ожидания.
[Действие Wait](control-flow-wait-activity.md) | При использовании действия Wait в конвейере конвейер ожидает указанное время, прежде чем продолжить выполнение последующих действий.
[Веб-действие](control-flow-web-activity.md) | Веб-действие можно использовать для вызова из конвейера фабрики данных пользовательской конечной точки REST. Вы можете передать наборы данных и связанные службы, которые будет использовать это действие и к которым оно будет обращаться.
[Действие веб-перехватчика](control-flow-webhook-activity.md) | С помощью действия веб-перехватчика вызовите конечную точку и передайте URL-адрес обратного вызова. Перед переходом к следующему действию конвейер выполняет ожидание вызова метода callback.

## <a name="pipeline-json"></a>Конвейер JSON
Вот, как конвейер определяется в формате JSON:

```json
{
    "name": "PipelineName",
    "properties":
    {
        "description": "pipeline description",
        "activities":
        [
        ],
        "parameters": {
        },
        "concurrency": <your max pipeline concurrency>,
        "annotations": [
        ]
    }
}
```

Тег | Описание | Type | Обязательно
--- | ----------- | ---- | --------
name | Имя конвейера. Укажите имя, представляющее действие, которое выполняет конвейер. <br/><ul><li>Максимальное количество знаков: 140</li><li>Должно начинаться с буквы, цифры или символа подчеркивания (\_).</li><li>Следующие символы не допускаются: ".", "+", "?", "/", "<", ">", "*", "%", "&", ":", " \" </li></ul> | Строка | Да
description | Укажите текст, описывающий, для чего используется конвейер. | Строка | Нет
Действия | В разделе **activities** можно определить одно или несколько действий. Дополнительные сведения об элементе JSON действий см. в разделе [JSON действия](#activity-json). | Array | Да
parameters | В разделе **Параметры** может быть задан один или несколько параметров, определенных в конвейере, которые делают конвейер гибким для повторного использования. | List | Нет
параллелизм | Максимальное количество параллельных запусков конвейера. По умолчанию максимальное значение отсутствует. Если достигнут предел параллелизма, дополнительные запуски конвейера помещаются в очередь до завершения предыдущих версий. | Число | Нет 
annotations | Список тегов, связанных с конвейером | Массив | Нет

## <a name="activity-json"></a>Действие JSON
В разделе **activities** можно определить одно или несколько действий. Существует два основных типа действий: действия выполнения и действия управления.

### <a name="execution-activities"></a>Действия выполнения
Действия выполнения включают в себя действия [перемещения данных](#data-movement-activities) и [преобразования данных](#data-transformation-activities). Они имеют следующую структуру верхнего уровня:

```json
{
    "name": "Execution Activity Name",
    "description": "description",
    "type": "<ActivityType>",
    "typeProperties":
    {
    },
    "linkedServiceName": "MyLinkedService",
    "policy":
    {
    },
    "dependsOn":
    {
    }
}
```

В приведенной ниже таблице описаны свойства, используемые в определениях JSON действия:

Тег | Описание | Обязательно
--- | ----------- | ---------
name | Имя действия. Укажите имя, представляющее операцию, которую выполняет действие. <br/><ul><li>Максимальное количество знаков: 55</li><li>Должно начинаться с буквы или цифры или символа подчеркивания ( \_ )</li><li>Следующие символы не допускаются: ".", "+", "?", "/", "<", ">", "*", "%", "&", ":", " \" | Да</li></ul>
description | Текст, описывающий, для чего используется действие | Да
type | Тип действия. Разные типы действий описаны в разделах, посвященных [действиям перемещения данных](#data-movement-activities), [действиям преобразования данных](#data-transformation-activities) и [действиям управления](#control-flow-activities). | Да
linkedServiceName | Имя связанной службы, используемой действием.<br/><br/>Для действия может потребоваться указать службу, связанную с обязательной вычислительной средой. | Да для действия HDInsight, действия пакетной оценки Машинное обучение Azure Studio (классическая модель), действие хранимой процедуры. <br/><br/>Нет — для всех остальных
typeProperties | Свойства в разделе typeProperties зависят от каждого типа действия. Чтобы просмотреть свойства типа для действия, щелкните ссылки на действие в предыдущем разделе. | Нет
policy | Политики, которые влияют на поведение во время выполнения действия. Это свойство включает время ожидания и поведение повтора. Если он не указан, используются значения по умолчанию. Дополнительные сведения см. в разделе [Политика действий](#activity-policy). | Нет
Свойство dependsOn | Это свойство используется для определения зависимостей между последующими и предыдущими действиями. Дополнительные сведения см. в разделе [Зависимости действий](#activity-dependency). | Нет

### <a name="activity-policy"></a>Политика действий
Политики влияют на поведение действия во время его выполнения, предоставляя возможность настройки параметров. Они доступны только для действий выполнения.

### <a name="activity-policy-json-definition"></a>Определение JSON политики действия

```json
{
    "name": "MyPipelineName",
    "properties": {
      "activities": [
        {
          "name": "MyCopyBlobtoSqlActivity",
          "type": "Copy",
          "typeProperties": {
            ...
          },
         "policy": {
            "timeout": "00:10:00",
            "retry": 1,
            "retryIntervalInSeconds": 60,
            "secureOutput": true
         }
        }
      ],
        "parameters": {
           ...
        }
    }
}
```

Имя JSON | Описание | Допустимые значения | Обязательно
--------- | ----------- | -------------- | --------
timeout | Указывает время ожидания для выполнения действия. | Временной диапазон | Нет. Время ожидания по умолчанию — 7 дней.
retry | Максимальное количество повторных попыток | Целое число | Нет. Значение по умолчанию — 0.
retryIntervalInSeconds | Задержка между повторными попытками (в секундах) | Целое число | Нет. Значение по умолчанию — 30 секунд
secureOutput | Если задано значение true, выходные данные действия считаются безопасными и не регистрируются для мониторинга. | Логическое | Нет. Значение по умолчанию — false.

### <a name="control-activity"></a>Действие управления
Действие управления имеет следующую структуру верхнего уровня:

```json
{
    "name": "Control Activity Name",
    "description": "description",
    "type": "<ActivityType>",
    "typeProperties":
    {
    },
    "dependsOn":
    {
    }
}
```

Тег | Описание | Обязательно
--- | ----------- | --------
name | Имя действия. Укажите имя, представляющее операцию, которую выполняет действие.<br/><ul><li>Максимальное количество знаков: 55</li><li>Должно начинаться с буквы, цифры или символа подчеркивания (\_).</li><li>Следующие символы не допускаются: ".", "+", "?", "/", "<", ">", "*", "%", "&", ":", " \" | Да</li><ul>
description | Текст, описывающий, для чего используется действие | Да
type | Тип действия. Различные типы действий см. в разделах [действия перемещения данных](#data-movement-activities), [действия преобразования данных](#data-transformation-activities)и [Управление действиями](#control-flow-activities) . | Да
typeProperties | Свойства в разделе typeProperties зависят от каждого типа действия. Чтобы просмотреть свойства типа для действия, щелкните ссылки на действие в предыдущем разделе. | Нет
Свойство dependsOn | Это свойство используется для определения зависимостей между последующими и предыдущими действиями. Дополнительные сведения см. в разделе [зависимость действия](#activity-dependency). | Нет

### <a name="activity-dependency"></a>Зависимость действий
Зависимость действия определяет, как последующие действия зависят от предыдущих действий, определяя условие, следует ли продолжать выполнение следующей задачи. Действие может зависеть от одного или нескольких предыдущих действий с разными условиями зависимости.

Различные условия зависимости: "Выполнено", "Сбой", "Пропущено", "Завершено".

Например, если в конвейере есть действие A -> действие B, возможны различные сценарии:

- Действие B имеет условие зависимости от действия А с условием **Выполнено**: действие B выполняется, только если действие А имеет конечное состояние "Выполнено".
- Действие B имеет условие зависимости от действия А с условием **Сбой**: действие B выполняется, только если действие А имеет конечное состояние "Сбой".
- Действие Б имеет условие зависимости от действия А с условием **Завершено**: действие B выполняется, если действие А имеет конечное состояние "Выполнено" или "Сбой".
- Действие б имеет условие зависимости для действия A с **пропущенным**: действие б выполняется, если действие a имеет конечное состояние пропущено. Конечное состояние "Пропущено" происходит в таком сценарии: действие X -> действие Y -> действие Z, где каждое действие выполняется, только если предыдущее действие завершается успешно. Если действие X завершается ошибкой, то действие Y имеет состояние "пропущено", так как оно никогда не выполняется. Аналогично, действие Z имеет состояние "пропущено".

#### <a name="example-activity-2-depends-on-the-activity-1-succeeding"></a>Пример. Действие 2 зависит от успешного завершения действия 1

```json
{
    "name": "PipelineName",
    "properties":
    {
        "description": "pipeline description",
        "activities": [
         {
            "name": "MyFirstActivity",
            "type": "Copy",
            "typeProperties": {
            },
            "linkedServiceName": {
            }
        },
        {
            "name": "MySecondActivity",
            "type": "Copy",
            "typeProperties": {
            },
            "linkedServiceName": {
            },
            "dependsOn": [
            {
                "activity": "MyFirstActivity",
                "dependencyConditions": [
                    "Succeeded"
                ]
            }
          ]
        }
      ],
      "parameters": {
       }
    }
}

```

## <a name="sample-copy-pipeline"></a>Пример конвейера копирования
В следующем примере конвейера содержится одно действие типа **Copy** in the **действий** . В этом примере [действие копирования](copy-activity-overview.md) копирует данные из хранилища BLOB-объектов Azure в базу данных в базе данных SQL Azure.

```json
{
  "name": "CopyPipeline",
  "properties": {
    "description": "Copy data from a blob to Azure SQL table",
    "activities": [
      {
        "name": "CopyFromBlobToSQL",
        "type": "Copy",
        "inputs": [
          {
            "name": "InputDataset"
          }
        ],
        "outputs": [
          {
            "name": "OutputDataset"
          }
        ],
        "typeProperties": {
          "source": {
            "type": "BlobSource"
          },
          "sink": {
            "type": "SqlSink",
            "writeBatchSize": 10000,
            "writeBatchTimeout": "60:00:00"
          }
        },
        "policy": {
          "retry": 2,
          "timeout": "01:00:00"
        }
      }
    ]
  }
}
```
Обратите внимание на следующие моменты.

- В разделе действий доступно только одно действие, параметр **type** которого имеет значение **Copy**.
- Для этого действия параметру input присвоено значение **InputDataset**, а параметру output — значение **OutputDataset**. Сведения об определении наборов данных в JSON см. в статье [Наборы данных](concepts-datasets-linked-services.md).
- В разделе **typeProperties** в качестве типа источника указано **BlobSource**, а в качестве типа приемника — **SqlSink**. В разделе [действия перемещения данных](#data-movement-activities) щелкните хранилище данных, которое необходимо использовать в качестве источника или приемника, чтобы узнать больше о перемещении данных в хранилище данных и из него.

Полное пошаговое руководство по созданию этого конвейера см. в статье [Создание фабрики данных и конвейера с помощью PowerShell](quickstart-create-data-factory-powershell.md).

## <a name="sample-transformation-pipeline"></a>Пример конвейера преобразования
В следующем примере конвейера содержится одно действие типа **HDInsightHive** in the **действий** . В этом примере [действие HDInsight Hive](transform-data-using-hadoop-hive.md) преобразовывает данные из хранилища BLOB-объектов Azure, запуская файл сценария Hive в кластере Azure HDInsight Hadoop.

```json
{
    "name": "TransformPipeline",
    "properties": {
        "description": "My first Azure Data Factory pipeline",
        "activities": [
            {
                "type": "HDInsightHive",
                "typeProperties": {
                    "scriptPath": "adfgetstarted/script/partitionweblogs.hql",
                    "scriptLinkedService": "AzureStorageLinkedService",
                    "defines": {
                        "inputtable": "wasb://adfgetstarted@<storageaccountname>.blob.core.windows.net/inputdata",
                        "partitionedtable": "wasb://adfgetstarted@<storageaccountname>.blob.core.windows.net/partitioneddata"
                    }
                },
                "inputs": [
                    {
                        "name": "AzureBlobInput"
                    }
                ],
                "outputs": [
                    {
                        "name": "AzureBlobOutput"
                    }
                ],
                "policy": {
                    "retry": 3
                },
                "name": "RunSampleHiveActivity",
                "linkedServiceName": "HDInsightOnDemandLinkedService"
            }
        ]
    }
}
```
Обратите внимание на следующие моменты.

- В разделе activities есть только одно действие, параметр **type** которого имеет значение **HDInsightHive**.
- Файл скрипта Hive **partitionweblogs. HQL** хранится в учетной записи хранения Azure (указанной в scriptLinkedService, именуемой AzureStorageLinkedService) и в папке script в контейнере `adfgetstarted` .
- Раздел `defines` используется, чтобы указать параметры среды выполнения, передаваемые скрипту Hive в качестве значений конфигурации Hive (например, `{hiveconf:inputtable}`, $`${hiveconf:partitionedtable}`).

Разделы **typeProperties** для каждого действия преобразования отличаются. Для получения дополнительных сведений о свойствах типа, поддерживаемых для действия преобразования, щелкните такое действие в таблице [Действия по преобразованию данных](#data-transformation-activities).

Полное пошаговое руководство по созданию этого конвейера см. в статье [Преобразование данных в облаке с помощью действия Spark в фабрике данных Azure](tutorial-transform-data-spark-powershell.md).

## <a name="multiple-activities-in-a-pipeline"></a>Несколько действий в конвейере
В двух предыдущих примерах конвейеров присутствует только одно действие. Конвейер может содержать сразу несколько действий. Действия могут выполняться параллельно при наличии нескольких действий в конвейере и последующих действий, которые не зависят от предыдущих.

Два действия можно соединить с помощью [зависимости действий](#activity-dependency), определяющей зависимость последующих действий от предыдущих, а также то, следует ли продолжать выполнение следующей задачи. Действие может зависеть от одного или нескольких предыдущих действий с разными условиями зависимости.

## <a name="scheduling-pipelines"></a>Планирование конвейеров
Конвейеры планируются триггерами. Существуют различные типы триггеров (триггер планировщика, которые позволяют активировать конвейеры в расписании с часами, а также ручной триггер, который запускает конвейеры по требованию). Дополнительные сведения см. в статье [Pipeline execution and triggers in Azure Data Factory](concepts-pipeline-execution-triggers.md) (Выполнение конвейера и триггеры в фабрике данных Azure).

Чтобы триггер выполнял конвейер, включите в определении триггера ссылку на нужный конвейер. Конвейеры и триггеры имеют связь n-m. Несколько триггеров могут запускать один конвейер, и один и тот же триггер может запускать несколько конвейеров. После определения триггера необходимо активировать его, чтобы он начал запуск конвейера. Дополнительные сведения см. в статье [Pipeline execution and triggers in Azure Data Factory](concepts-pipeline-execution-triggers.md) (Выполнение конвейера и триггеры в фабрике данных Azure).

Например, предположим, что у вас есть триггер планировщика, «триггер A», который я хочу запустить в моем конвейере «Микопипипелине». Вы определяете триггер, как показано в следующем примере:

### <a name="trigger-a-definition"></a>Определение триггера А

```json
{
  "name": "TriggerA",
  "properties": {
    "type": "ScheduleTrigger",
    "typeProperties": {
      ...
      }
    },
    "pipeline": {
      "pipelineReference": {
        "type": "PipelineReference",
        "referenceName": "MyCopyPipeline"
      },
      "parameters": {
        "copySourceName": "FileSource"
      }
    }
  }
}
```

## <a name="next-steps"></a>Следующие шаги
Пошаговые инструкции по созданию конвейеров с помощью действий приведены в следующих руководствах:

- [Создание фабрики данных и конвейера с помощью PowerShell](quickstart-create-data-factory-powershell.md)
- [Учебник. Создание первого конвейера для преобразования данных с помощью кластера Hadoop](tutorial-transform-data-spark-powershell.md)
