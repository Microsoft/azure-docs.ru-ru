---
title: Преобразование источника в потоке данных сопоставления
description: Узнайте, как настроить преобразование источника в потоке данных сопоставления.
author: kromerm
ms.author: makromer
ms.service: data-factory
ms.topic: conceptual
ms.custom: seo-lt-2019
ms.date: 03/10/2021
ms.openlocfilehash: 310a062a8600539750935c93c7d10a1cf17a885d
ms.sourcegitcommit: 225e4b45844e845bc41d5c043587a61e6b6ce5ae
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/11/2021
ms.locfileid: "103016395"
---
# <a name="source-transformation-in-mapping-data-flow"></a>Преобразование источника в потоке данных сопоставления

[!INCLUDE[appliesto-adf-asa-md](includes/appliesto-adf-asa-md.md)]

Преобразование «источник» настраивает источник данных для потока данных. При проектировании потоков данных первым шагом всегда является настройка преобразования источника. Чтобы добавить источник, выберите поле **Добавить источник** в холсте потока данных.

Для каждого потока данных требуется по крайней мере одно преобразование источника, но при необходимости можно добавить столько источников, сколько необходимо для выполнения преобразований данных. Вы можете объединить эти источники вместе с преобразованием «соединение», «уточняющий запрос» или «объединение».

Каждое преобразование источника связано только с одним набором данных или связанной службой. Набор данных определяет форму и расположение данных, которые необходимо записать или прочитать. При использовании файлового набора данных можно использовать подстановочные знаки и списки файлов в источнике, чтобы работать с несколькими файлами за один раз.

## <a name="inline-datasets"></a>Встроенные наборы данных

Первое решение, которое вы создаете при создании преобразования источника, — это определение того, определены ли сведения об источнике внутри объекта DataSet или в преобразовании источника. Большинство форматов доступны только в одном или другом. Чтобы узнать, как использовать конкретный соединитель, см. соответствующий документ соединителя.

Если формат поддерживается как для встроенного, так и для объекта DataSet, то оба имеют преимущества. Объекты DataSet — это многократно используемые сущности, которые можно использовать в других потоках данных и действиях, таких как копирование. Эти многократно используемые сущности особенно полезны при использовании зафиксированной схемы. Наборы данных не основаны на Spark. Иногда может потребоваться переопределить некоторые параметры или проекцию схемы в преобразовании «источник».

Встроенные наборы данных рекомендуются при использовании гибких схем, одноразовых экземпляров источника или параметризованных источников. Если источник сильно параметризован, встроенные наборы данных позволяют не создавать фиктивные объекты. Встроенные наборы данных основаны на Spark, а их свойства являются собственными для потока данных.

Чтобы использовать встроенный набор данных, выберите нужный формат в селекторе **типа источника** . Вместо выбора исходного набора данных выберите связанную службу, к которой необходимо подключиться.

![Снимок экрана, на котором отображаются встроенные выбранные.](media/data-flow/inline-selector.png "Снимок экрана, на котором отображаются встроенные выбранные.")

##  <a name="supported-source-types"></a><a name="supported-sources"></a> Поддерживаемые типы источников

Поток данных сопоставления следует подходу извлечения, загрузки и преобразования (ELT) и работает с *промежуточными* наборами данных, которые находятся в Azure. Сейчас в преобразовании источника могут использоваться следующие наборы данных.

| Соединитель | Формат | Набор данных или встраивание |
| --------- | ------ | -------------- |
| [Хранилище BLOB-объектов Azure](connector-azure-blob-storage.md#mapping-data-flow-properties) | [Avro](format-avro.md#mapping-data-flow-properties)<br>[Текст с разделителями](format-delimited-text.md#mapping-data-flow-properties)<br>[Разностная версия](format-delta.md)<br>[Excel](format-excel.md#mapping-data-flow-properties)<br>[JSON](format-json.md#mapping-data-flow-properties) <br>[ORC](format-orc.md#mapping-data-flow-properties)<br/>[Parquet](format-parquet.md#mapping-data-flow-properties)<br>[XML](format-xml.md#mapping-data-flow-properties) | ✓/✓<br>✓/✓<br>✓/✓<br>✓/✓<br/>✓/-<br>✓/✓<br/>✓/-<br>✓/✓ |
| [Azure Cosmos DB (SQL API)](connector-azure-cosmos-db.md#mapping-data-flow-properties) | | ✓/- |
| [Azure Data Lake Storage 1-го поколения](connector-azure-data-lake-store.md#mapping-data-flow-properties) | [Avro](format-avro.md#mapping-data-flow-properties)<br>[Текст с разделителями](format-delimited-text.md#mapping-data-flow-properties)<br>[Excel](format-excel.md#mapping-data-flow-properties)<br>[JSON](format-json.md#mapping-data-flow-properties)<br>[ORC](format-orc.md#mapping-data-flow-properties)<br/>[Parquet](format-parquet.md#mapping-data-flow-properties)<br>[XML](format-xml.md#mapping-data-flow-properties) | ✓/✓<br>✓/✓<br>✓/✓<br/>✓/-<br>✓/✓<br/>✓/-<br>✓/✓ |
| [Azure Data Lake Storage 2-го поколения](connector-azure-data-lake-storage.md#mapping-data-flow-properties) | [Avro](format-avro.md#mapping-data-flow-properties)<br>[Модель общих данных](format-common-data-model.md#source-properties)<br>[Текст с разделителями](format-delimited-text.md#mapping-data-flow-properties)<br>[Разностная версия](format-delta.md)<br>[Excel](format-excel.md#mapping-data-flow-properties)<br>[JSON](format-json.md#mapping-data-flow-properties)<br>[ORC](format-orc.md#mapping-data-flow-properties)<br/>[Parquet](format-parquet.md#mapping-data-flow-properties)<br>[XML](format-xml.md#mapping-data-flow-properties) | ✓/✓<br/>-/✓<br>✓/✓<br>✓/✓<br>✓/✓<br>✓/-<br/>✓/✓<br/>✓/-<br>✓/✓ |
| [База данных Azure для MySQL](connector-azure-database-for-mysql.md) |  | ✓/✓ |
| [База данных Azure для PostgreSQL](connector-azure-database-for-postgresql.md) |  | ✓/✓ |
| [База данных SQL Azure](connector-azure-sql-database.md#mapping-data-flow-properties) | | ✓/- |
| [Управляемый экземпляр SQL Azure](connector-azure-sql-managed-instance.md#mapping-data-flow-properties) | | ✓/- |
| [Azure Synapse Analytics](connector-azure-sql-data-warehouse.md#mapping-data-flow-properties) | | ✓/- |
| [Hive](connector-hive.md#mapping-data-flow-properties) | | -/✓ |
| [Snowflake](connector-snowflake.md) | | ✓/✓ |

Параметры, относящиеся к этим соединителям, находятся на вкладке **Параметры источника** . Сведения и примеры сценариев потока данных для этих параметров находятся в документации по соединителю.

Фабрика данных Azure имеет доступ к более чем [90 собственным соединителям](connector-overview.md). Чтобы включить данные из других источников в потоке данных, используйте действие копирования для загрузки этих данных в одну из поддерживаемых промежуточных областей.

## <a name="source-settings"></a>Параметры источника

После добавления источника настройте его с помощью вкладки **Параметры источника** . Здесь можно выбрать или создать набор данных, на котором находятся исходные точки. Можно также выбрать схему и параметры выборки для данных.

Значения разработки для параметров набора данных можно настроить в [параметрах отладки](concepts-data-flow-debug-mode.md). (Режим отладки должен быть включен.)

![Снимок экрана, на котором показана вкладка "Параметры источника".](media/data-flow/source1.png "Снимок экрана, на котором показана вкладка "Параметры источника".")

**Имя выходного потока**: имя преобразования источника.

**Тип источника**: выберите, следует ли использовать встроенный набор данных или существующий объект DataSet.

**Проверка соединения**. Проверьте, может ли служба потока данных Spark успешно подключаться к связанной службе, используемой в исходном наборе данных. Для включения этой функции необходимо включить режим отладки.

**Смещение схемы**. [смещение схемы](concepts-data-flow-schema-drift.md) — это способность фабрики данных в собственном коде управлять гибкими схемами в потоках данных без необходимости явно определять изменения столбцов.

* Установите флажок **Разрешить смещение схемы** , если исходные столбцы будут изменяться часто. Этот параметр позволяет всем входящим полям источника проходить через преобразования в приемник.

* Выбор **типовых столбцов** с пересечением дает фабрике данных возможность обнаруживать и определять типы данных для каждого обнаруженного нового столбца. Если эта функция отключена, все смещенные столбцы будут иметь строковый тип.

**Проверить схему:** Если выбран параметр **проверить схему** , поток данных не будет выполняться, если входящие исходные данные не соответствуют определенной схеме набора данных.

**Пропустить число строк**: поле **пропустить число строк** указывает, сколько строк следует игнорировать в начале набора данных.

**Выборка**. Включите **выборку** , чтобы ограничить количество строк в источнике. Используйте этот параметр при тестировании или выборки данных из источника для отладки. Это очень полезно при выполнении потоков данных в режиме отладки из конвейера.

Чтобы проверить правильность настройки источника, включите режим отладки и получите предварительную версию данных. Дополнительные сведения см. в разделе [режим отладки](concepts-data-flow-debug-mode.md).

> [!NOTE]
> Когда режим отладки включен, конфигурация ограничения строк в параметрах отладки будет перезаписывать параметр выборки в источнике при предварительном просмотре данных.

## <a name="source-options"></a>Параметры источника

Вкладка **Параметры источника** содержит параметры, относящиеся к выбранному соединителю и формату. Дополнительные сведения и примеры см. в соответствующей [документации по соединителю](#supported-sources).

## <a name="projection"></a>Прогнозирование

Подобно схемам в наборах данных, проекция в источнике определяет столбцы данных, типы и форматы из исходных. Для большинства типов наборов данных, таких как SQL и Parquet, проекция в источнике исправлена в соответствии со схемой, определенной в наборе данных. Если исходные файлы не являются строго типизированными (например, плоскими CSV-файлами, а не файлами Parquet), можно определить типы данных для каждого поля в преобразовании «источник».

![Снимок экрана, на котором показаны параметры на вкладке "Проекция".](media/data-flow/source3.png "Снимок экрана, на котором показаны параметры на вкладке "Проекция".")

Если в текстовом файле не определена схема, выберите команду **определить тип данных** , чтобы фабрика данных выработала выборку и вывести типы данных. Выберите параметр **определить формат по умолчанию** , чтобы автоматически определить форматы данных по умолчанию.

**Сброс схемы** сбрасывает проекцию до того, что определено в наборе данных, на который указывает ссылка.

Типы данных столбцов можно изменять в нисходящем преобразовании «Производный столбец». Используйте преобразование SELECT, чтобы изменить имена столбцов.

### <a name="import-schema"></a>Импорт схемы

Нажмите кнопку **Импорт схемы** на вкладке **проекция** , чтобы использовать активный кластер отладки для создания проекции схемы. Он доступен в каждом типе источника. Импорт схемы здесь приведет к переопределению проекции, определенной в наборе данных. Объект DataSet не будет изменен.

Импорт схемы полезен в таких наборах данных, как Avro и Azure Cosmos DB, которые поддерживают сложные структуры, не требующие существования определений схем в наборе данных. Для встроенных наборов данных импорт схемы является единственным способом ссылки на метаданные столбца без смещения схемы.

## <a name="optimize-the-source-transformation"></a>Оптимизация преобразования источника

Вкладка **оптимизировать** позволяет изменять сведения о секциях на каждом шаге преобразования. В большинстве случаев **использование текущего секционирования** будет оптимизировано для идеальной структуры секционирования для источника.

При чтении из источника базы данных SQL **Azure пользовательское** секционирование, скорее всего, будет считывать данные быстрее. Фабрика данных будет считывать большие запросы, делая подключения к базе данных в параллельном режиме. Это исходное секционирование можно выполнить для столбца или с помощью запроса.

![Снимок экрана, на котором показаны параметры исходной секции.](media/data-flow/sourcepart3.png "Снимок экрана, на котором показаны параметры исходной секции.")

Дополнительные сведения о оптимизации в потоке данных сопоставления см. на [вкладке "оптимизация"](concepts-data-flow-overview.md#optimize).

## <a name="next-steps"></a>Дальнейшие действия

Начните создавать поток данных с помощью [преобразования «Производный столбец](data-flow-derived-column.md) » и [преобразования «выбор](data-flow-select.md)».
