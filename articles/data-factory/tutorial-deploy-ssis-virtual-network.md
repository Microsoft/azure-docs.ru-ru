---
title: Руководство по настройке среды выполнения интеграции Azure SSIS для приподключения к виртуальной сети
description: Узнайте, как присоединить среду выполнения интеграции Azure SSIS к виртуальной сети Azure.
author: chugugrace
ms.author: chugu
ms.service: data-factory
ms.topic: conceptual
ms.date: 1/10/2020
ms.openlocfilehash: 3dbbce4adc44696fdd12f6ce948b48b34caaed75
ms.sourcegitcommit: 867cb1b7a1f3a1f0b427282c648d411d0ca4f81f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "100391241"
---
# <a name="configure-an-azure-sql-server-integration-services-ssis-integration-runtime-ir-to-join-a-virtual-network"></a>Настройка среды выполнения интеграции Azure-SQL Server Integration Services (SSIS) для приподключения к виртуальной сети

[!INCLUDE[appliesto-adf-asa-md](includes/appliesto-adf-asa-md.md)]

В этом учебнике приводятся основные шаги по использованию портал Azure для настройки среды выполнения интеграции Azure-SQL Server Integration Services (SSIS) для приподключения к виртуальной сети.

Для этого нужно выполнить следующие действия:

- Настройте виртуальную сеть.
- Присоедините Azure-SSIS IR к виртуальной сети на портале фабрики данных Azure.

## <a name="prerequisites"></a>Предварительные условия

- **Среда выполнения интеграции Azure SSIS**. Если у вас нет среды выполнения интеграции Azure SSIS, перед началом работы [подготавливаете среду выполнения интеграции Azure SSIS в фабрике данных Azure](tutorial-deploy-ssis-packages-azure.md) .

- **Разрешение пользователя**. У пользователя, создающего Azure-SSIS IR, должна быть [назначена роль](../role-based-access-control/role-assignments-list-portal.md#list-role-assignments-for-a-user-at-a-scope) по крайней мере в ресурсе Фабрики данных Azure с одним из следующих вариантов:

    - Использовать встроенную роль "Участник сетей". Эта роль предоставляет разрешение _Microsoft.Network/\*_ , область применения которого намного шире, чем требуется для этой задачи.
    - Создать настраиваемую роль, которая включает только нужное разрешение _Microsoft.Network/virtualNetworks/\*/join/action_. Если вы хотите также использовать собственные общедоступные IP-адреса для Azure-SSIS IR при присоединении к Azure Resource Manager виртуальной сети, включите в эту роль разрешение _Microsoft. Network/publicIPAddresses/*/Жоин/Актион_ .

- **Виртуальная сеть**.

    - Если у вас нет виртуальной сети, [Создайте виртуальную сеть с помощью портал Azure](../virtual-network/quick-create-portal.md).

    - Убедитесь, что группа ресурсов виртуальной сети может создавать и удалять определенные ресурсы сети Azure.
    
        Среда выполнения интеграции Azure SSIS должна создать определенные сетевые ресурсы в той же группе ресурсов, в которой находится виртуальная сеть. К этим ресурсам относятся:
        - Балансировщик нагрузки Azure с именем *\<Guid> -azurebatch-клаудсервицелоадбаланцер*
        - Группа безопасности сети с именем * \<Guid> -azurebatch-клаудсервиценетворксекуритиграуп
        - общедоступный IP-адрес Azure с именем -azurebatch-cloudservicepublicip.
    
        Эти ресурсы будут созданы при запуске Azure-SSIS IR. Они будут удалены после остановки Azure-SSIS IR. Чтобы предотвратить блокировку остановки Azure-SSIS IR, не используйте повторно эти сетевые ресурсы в других ресурсах.

    - Убедитесь в отсутствии [блокировки ресурсов](../azure-resource-manager/management/lock-resources.md) в группе ресурсов и подписке, к которым принадлежит виртуальная сеть. Если вы настроили блокировку только для чтения или удаления, запуск и остановка среды Azure-SSIS IR завершатся ошибкой или она перестанет отвечать на запросы.

    - Убедитесь, что у вас нет назначения политики Azure, которое предотвращает создание следующих ресурсов в группе ресурсов или подписке, к которой принадлежит виртуальная сеть.
        - Microsoft.Network/LoadBalancers
        - Microsoft.Network/NetworkSecurityGroups

- В этом учебнике не рассматриваются сценарии **конфигурации сети** .
    - Если вы предместит собственные общедоступные IP-адреса для Azure-SSIS IR.
    - Если используется собственный сервер системы доменных имен (DNS).
    - Если в подсети используется группа безопасности сети (NSG).
    - При использовании Azure ExpressRoute или определяемого пользователем маршрута (UDR).
    - При использовании настраиваемого Azure-SSIS IR.
    
    Для получения дополнительных сведений проверьте [конфигурацию виртуальной сети](join-azure-ssis-integration-runtime-virtual-network.md#virtual-network-configuration).

## <a name="configure-a-virtual-network"></a>Настройка виртуальной сети

Используйте портал Azure, чтобы настроить виртуальную сеть, прежде чем пытаться присоединить к ней Azure-SSIS IR.

1. Запустите Microsoft Edge или Google Chrome. В настоящее время пользовательский интерфейс фабрики данных поддерживается только в этих веб-браузерах.

1. Войдите на [портал Azure](https://portal.azure.com).

1. Выберите **больше служб**. Примените фильтр и выберите **Виртуальные сети**.

1. Примените фильтр и выберите в списке свою виртуальную сеть.

1. На странице **Виртуальная сеть** выберите **Свойства**.

1. Нажмите кнопку копирования напротив поля **Идентификатор ресурса**, чтобы скопировать идентификатор ресурса для виртуальной сети в буфер обмена. Сохраните идентификатор из буфера обмена в OneNote или в файле.

1. В меню слева выберите **подсети**.

    - Убедитесь, что выбранная подсеть имеет достаточно свободного адресного пространства для использования Azure-SSIS IR. Оставлять доступные IP-адреса как минимум в два раза больше, чем номер ИНФРАКРАСного узла. Azure резервирует некоторые IP-адреса в каждой подсети. Эти адреса нельзя использовать. Первый и последний IP-адреса подсетей зарезервированы для соответствия протоколу, и для служб Azure используются три адреса. Дополнительные сведения см. в разделе [Существуют ли ограничения на использование IP-адресов в пределах этих подсетей?](../virtual-network/virtual-networks-faq.md#are-there-any-restrictions-on-using-ip-addresses-within-these-subnets)
    - Не выбирайте GatewaySubnet для развертывания Azure-SSIS IR. Он выделен для шлюзов виртуальной сети.
    - Не используйте подсеть, предназначенную исключительно для других служб Azure (например, SQL Database Управляемый экземпляр, служба приложений и т. д.).

1. Убедитесь, что поставщик пакетной службы Azure зарегистрирован в подписке Azure, которая содержит виртуальную сеть. Или зарегистрируйте поставщик пакетной службы Azure. Если у вас уже есть учетная запись пакетной службы Azure в вашей подписке, ваша подписка будет зарегистрирована в пакетной службе Azure. (При создании Azure-SSIS IR на портале фабрики данных поставщик пакетной службы Azure регистрируется автоматически.)

   1. В портал Azure в меню слева выберите **подписки**.

   1. Выберите свою подписку.

   1. В левой части выберите **поставщики ресурсов** и убедитесь, что **Microsoft.BatCH** является зарегистрированным поставщиком.

   ![Подтверждение состояния "Зарегистрировано"](media/join-azure-ssis-integration-runtime-virtual-network/batch-registered-confirmation.png)

   Если поставщик **Microsoft.Batch** не отображается в списке, то для его регистрации [создайте в своей подписке пустую учетную запись пакетной службы Azure](../batch/batch-account-create-portal.md). Затем ее можно будет удалить.

## <a name="join-the-azure-ssis-ir-to-a-virtual-network"></a>Присоединение среды выполнения интеграции Azure SSIS к виртуальной сети

После настройки Azure Resource Manager виртуальной сети или классической виртуальной сети можно присоединить Azure-SSIS IR к виртуальной сети.

1. Запустите Microsoft Edge или Google Chrome. В настоящее время пользовательский интерфейс фабрики данных поддерживается только в этих веб-браузерах.

1. В [портал Azure](https://portal.azure.com)в меню слева выберите **фабрики данных**. Если в меню не отображаются **фабрики данных** , выберите **больше служб**, а затем в разделе **аналитики и аналитика** выберите **фабрики данных**.

   ![Список фабрик данных](media/join-azure-ssis-integration-runtime-virtual-network/data-factories-list.png)

1. Выберите фабрику данных с Azure-SSIS IR в списке. После этого откроется домашняя страница фабрики данных. Щелкните плитку **Создание и мониторинг**. На отдельной вкладке откроется пользовательский интерфейс фабрики данных.

   ![Домашняя страница фабрики данных](media/join-azure-ssis-integration-runtime-virtual-network/data-factory-home-page.png)

1. В пользовательском интерфейсе фабрики данных перейдите на вкладку **Правка**, щелкните **Подключения**, а затем выберите вкладку **сред выполнения интеграции**.

   ![Вкладка сред выполнения интеграции](media/join-azure-ssis-integration-runtime-virtual-network/integration-runtimes-tab.png)

1. Если Azure-SSIS IR выполняется, в списке **среды выполнения интеграции** в столбце **действия** нажмите кнопку " **Отключить** " для Azure-SSIS IR. Вы не сможете изменить Azure-SSIS IR, пока не завершите ее.

   ![Остановка среды выполнения интеграции](media/join-azure-ssis-integration-runtime-virtual-network/stop-ir-button.png)

1. В списке **среды выполнения интеграции** в столбце **действия** нажмите кнопку **изменить** для Azure-SSIS IR.

   ![Изменение среды выполнения интеграции](media/join-azure-ssis-integration-runtime-virtual-network/integration-runtime-edit.png)

1. На панели настройки среды выполнения интеграции перейдите к разделу **Общие параметры** и **параметры SQL** , нажав кнопку **Далее** .

1. В разделе **Дополнительные параметры** :
   1. Выберите **вариант выбрать виртуальную сеть для присоединиться к Azure-SSIS Integration Runtime, разрешить ADF-файл для создания определенных сетевых ресурсов и при необходимости установить собственный статический список общедоступных IP-адресов** .

   1. В поле **Подписка** выберите подписку Azure, в которой расположена виртуальная сеть.

   1. В поле **Расположение** введите то же расположение среды выполнения интеграции.

   1. В поле **тип** выберите тип виртуальной сети: классический или Azure Resource Manager. Рекомендуется выбрать виртуальную сеть Azure Resource Manager, так как классические виртуальные сети скоро будут считаться устаревшими.

   1. В поле **Имя виртуальной сети** выберите имя вашей виртуальной сети. Он должен быть тем же, что используется для базы данных SQL с конечными точками службы виртуальной сети или SQL Управляемый экземпляр с частной конечной точкой для размещения SSISDB. Он должен быть тем же, что и подключение к локальной сети. В противном случае может быть любая виртуальная сеть, чтобы использовать собственные статические общедоступные IP-адреса для Azure-SSIS IR.

   1. В поле **Имя подсети** выберите имя подсети в виртуальной сети. Он должен совпадать с тем, который используется для SQL данные с конечными точками службы виртуальной сети для размещения SSISDB. Кроме того, он должен быть другой подсетью, используемой для Управляемый экземпляр SQL с частной конечной точкой для размещения SSISDB. В противном случае она может быть любой подсетью, чтобы использовать собственные статические общедоступные IP-адреса для Azure-SSIS IR.

   1. Выберите **Проверка виртуальной сети**. Если проверка прошла успешно, нажмите кнопку **продолжить**.

   ![Дополнительные параметры с использованием виртуальной сети](./media/tutorial-create-azure-ssis-runtime-portal/advanced-settings-vnet.png)

1. В разделе **Сводка** проверьте все параметры для Azure-SSIS IR. Затем выберите **Обновить**.

1. Запустите Azure-SSIS IR, нажав кнопку **Пуск** в столбце **действия** для Azure-SSIS IR. Запуск Azure-SSIS IR, который присоединяется к виртуальной сети, займет от 20 до 30 минут.

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения о [присоединении Azure-SSIS IR к виртуальной сети](join-azure-ssis-integration-runtime-virtual-network.md).