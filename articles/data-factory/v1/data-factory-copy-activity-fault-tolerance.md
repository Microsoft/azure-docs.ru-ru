---
title: Добавление отказоустойчивости в действие копирования фабрики данных Azure путем пропуска несовместимых строк
description: Обеспечение отказоустойчивости для действия копирования в фабрике данных Azure с помощью пропуска несовместимых строк во время копирования
author: linda33wj
ms.service: data-factory
ms.topic: conceptual
ms.date: 03/27/2018
ms.author: jingwang
robots: noindex
ms.openlocfilehash: 10e4bedae5b7c429152a3503fff2cb2769d66eb5
ms.sourcegitcommit: d4734bc680ea221ea80fdea67859d6d32241aefc
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/14/2021
ms.locfileid: "100377182"
---
# <a name="add-fault-tolerance-in-copy-activity-by-skipping-incompatible-rows"></a>Обеспечение отказоустойчивости для действия копирования с помощью пропуска несовместимых строк

> [!div class="op_single_selector" title1="Выберите используемую версию службы "Фабрика данных":"]
> * [Версия 1](data-factory-copy-activity-fault-tolerance.md)
> * [Версия 2 (текущая)](../copy-activity-fault-tolerance.md)

> [!NOTE]
> В этой статье рассматривается служба "Фабрика данных Azure" версии 1. Если вы используете текущую версию службы "Фабрика данных", см. руководство по [обеспечению отказоустойчивости действий копирования в службе "Фабрика данных"](../copy-activity-fault-tolerance.md).

Для [действия копирования](data-factory-data-movement-activities.md) фабрики данных Azure предусмотрены разные способы устранения несовместимых строк при копировании данных между хранилищами данных источника и приемника.

- Вы можете прервать и отменить действие копирования при обнаружении несовместимых данных (действие по умолчанию).
- Вы можете продолжать копировать все данные, обеспечив отказоустойчивость с помощью пропуска несовместимых строк данных. Кроме того, вы можете записать несовместимые строки в журнал и сохранить его в хранилище BLOB-объектов Azure. Этот журнал затем можно просмотреть, чтобы узнать причину сбоя, исправить данные в источнике данных и повторить действие копирования.

## <a name="supported-scenarios"></a>Поддерживаемые сценарии
Действие копирования поддерживает три сценария для обработки несовместимых данных: обнаружение, пропуск и запись в журнал.

- **Несовместимость между исходным типом данных и собственным типом приемника**

    Пример. копирование данных из CSV-файла в хранилище BLOB-объектов в базу данных SQL с определением схемы, содержащим три столбца типа **int** . Строки CSV-файла, которые содержат числовые данные, например `123,456,789`, успешно копируются в хранилище приемника. А строки, которые содержат нечисловые значения, например `123,456,abc`, определяются как несовместимые и пропускаются.

- **Несоответствие количества столбцов между источником и приемником**

    Пример: выполняется копирование данных из CSV-файла в хранилище BLOB-объектов в базу данных SQL с использованием определения схемы, которое содержит шесть столбцов. Строки CSV-файла, которые содержат шесть столбцов, успешно копируются в хранилище приемника. Строки CSV-файла, которые содержат больше или меньше шести столбцов, определяются как несовместимые и пропускаются.

- **Нарушение первичного ключа при записи в SQL Server/базу данных SQL Azure или Azure Cosmos DB**

    Пример: выполняется копирование данных из SQL Server в базу данных SQL. Определен первичный ключ в базе данных SQL приемников, но такой первичный ключ не определен на исходном сервере SQL Server. Повторяющиеся строки, которые существуют в источнике, не удается скопировать в приемник. Действие копирования копирует только первую строку из источника данных в приемник. Последующие строки в источнике, которые содержат повторяющиеся значения первичного ключа, определяются как несовместимые и пропускаются.

>[!NOTE]
>Эта функция не применяется, если действие копирования настроено для вызова механизма загрузки внешних данных, включая [Azure синапсе Analytics polybase](data-factory-azure-sql-data-warehouse-connector.md#use-polybase-to-load-data-into-azure-synapse-analytics) или [Amazon RedShift Unload](data-factory-amazon-redshift-connector.md#use-unload-to-copy-data-from-amazon-redshift). Для загрузки данных в Azure синапсе Analytics с помощью Polybase используйте собственную поддержку отказоустойчивости Polybase, указав "[polyBaseSettings](data-factory-azure-sql-data-warehouse-connector.md#sqldwsink)" в действии копирования.

## <a name="configuration"></a>Конфигурация
В следующем примере приводится определение JSON для настройки пропуска несовместимых строк в действии копирования:

```json
"typeProperties": {
    "source": {
        "type": "BlobSource"
    },
    "sink": {
        "type": "SqlSink",
    },
    "enableSkipIncompatibleRow": true,
    "redirectIncompatibleRowSettings": {
        "linkedServiceName": "BlobStorage",
        "path": "redirectcontainer/erroroutput"
    }
}
```

| Свойство | Описание | Допустимые значения | Обязательно |
| --- | --- | --- | --- |
| **enableSkipIncompatibleRow** | Включить или отключить пропуск несовместимых строк во время копирования. | True<br/>False (по умолчанию) | Нет |
| **redirectIncompatibleRowSettings** | Группа свойств, которые можно указать, если вы хотите записать несовместимые строки в журнал. | &nbsp; | нет |
| **linkedServiceName** | Связанная служба хранилища Azure, в которой будет храниться журнал, содержащий пропущенные строки. | Имя связанной службы [AzureStorage](data-factory-azure-blob-connector.md#azure-storage-linked-service) или [AzureStorageSas](data-factory-azure-blob-connector.md#azure-storage-sas-linked-service), которая будет ссылаться на экземпляр хранилища, используемый для хранения файла журнала. | Нет |
| **path** | Путь к файлу журнала, который содержит пропущенные строки. | Укажите путь к хранилищу BLOB-объектов, в котором будут храниться несовместимые данные. Если путь не указан, служба создаст контейнер самостоятельно. | нет |

## <a name="monitoring"></a>Наблюдение
Когда действие копирования будет завершено, вы увидите число пропущенных строк в разделе мониторинга:

![Мониторинг пропущенных несовместимых строк](./media/data-factory-copy-activity-fault-tolerance/skip-incompatible-rows-monitoring.png)

Если вы настроите запись несовместимых строк в журнал, файл журнала можно найти по этому пути: `https://[your-blob-account].blob.core.windows.net/[path-if-configured]/[copy-activity-run-id]/[auto-generated-GUID].csv`. В этом файле вы можете увидеть, какие строки пропущены и в чем причина несовместимости.

В файл журнала записываются как исходные данные, так и соответствующая ошибка. Ниже приведен пример содержимого файла журнала:
```
data1, data2, data3, UserErrorInvalidDataValue,Column 'Prop_2' contains an invalid value 'data3'. Cannot convert 'data3' to type 'DateTime'.,
data4, data5, data6, Violation of PRIMARY KEY constraint 'PK_tblintstrdatetimewithpk'. Cannot insert duplicate key in object 'dbo.tblintstrdatetimewithpk'. The duplicate key value is (data4).
```

## <a name="next-steps"></a>Дальнейшие действия
Дополнительные сведения о действии копирования фабрики данных Azure см. в статье [Перемещение данных с помощью действия копирования](data-factory-data-movement-activities.md).
