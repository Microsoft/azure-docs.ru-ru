---
title: Загрузка данных из SAP Business Warehouse
description: Использование фабрики данных Azure для копирования данных из SAP Business Warehouse (BW)
author: linda33wj
ms.author: jingwang
ms.service: data-factory
ms.topic: conceptual
ms.custom: seo-lt-2019
ms.date: 05/22/2019
ms.openlocfilehash: 3dabb6d5df0a74cc7ae2fb8b381ad9e0dfe04e63
ms.sourcegitcommit: d4734bc680ea221ea80fdea67859d6d32241aefc
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/14/2021
ms.locfileid: "100370705"
---
# <a name="copy-data-from-sap-business-warehouse-by-using-azure-data-factory"></a>Копирование данных из SAP Business Warehouse с помощью фабрики данных Azure
[!INCLUDE[appliesto-adf-asa-md](includes/appliesto-adf-asa-md.md)]

В этой статье показано, как использовать фабрику данных Azure для копирования данных из SAP Business Warehouse (BW) через открытый центр для Azure Data Lake Storage 2-го поколения. Аналогичную процедуру можно использовать для копирования данных в другие [Поддерживаемые хранилища данных-приемники](copy-activity-overview.md#supported-data-stores-and-formats).

> [!TIP]
> Общие сведения о копировании данных из SAP BW, включая SAP BW интеграция с открытым центром и поток извлечения изменений, см. в статье [копирование данных из SAP Business Warehouse через открытый центр с помощью фабрики данных Azure](connector-sap-business-warehouse-open-hub.md).

## <a name="prerequisites"></a>Предварительные требования

- **Фабрика данных Azure**. Если у вас ее нет, выполните действия по [созданию фабрики данных](quickstart-create-data-factory-portal.md#create-a-data-factory).

- **SAP BW открыть назначение концентратора (ОХД) с типом назначения "таблица базы данных"**: чтобы создать ОХД или проверить правильность настройки ОХД для интеграции фабрики данных, см. раздел [SAP BW открытие конфигураций назначения концентратора](#sap-bw-open-hub-destination-configurations) этой статьи.

- **SAP BW пользователь должен иметь следующие разрешения**:

  - Авторизация для удаленных вызовов функций (RFC) и SAP BW.
  - Разрешения на действие "выполнение" объекта авторизации **S_SDSAUTH** .

- Локальная **[Среда выполнения интеграции (IR)](concepts-integration-runtime.md#self-hosted-integration-runtime) с соединителем SAP .NET 3,0**. Выполните следующие действия по установке:

  1. Установите и зарегистрируйте локальную среду выполнения интеграции версии 3,13 или более поздней. (Этот процесс описан далее в этой статье.)

  2. Скачайте [64-разрядный соединитель SAP для Microsoft .NET 3,0](https://support.sap.com/en/product/connectors/msnet.html) с веб-сайта SAP и установите его на том же компьютере, где размещена локальная среда IR. Во время установки убедитесь, что выбран параметр **установить сборки в глобальный кэш сборок** в диалоговом окне **необязательные шаги установки** , как показано на следующем рисунке.

     ![Диалоговое окно "Настройка соединителя SAP .NET"](media/connector-sap-business-warehouse-open-hub/install-sap-dotnet-connector.png)

## <a name="do-a-full-copy-from-sap-bw-open-hub"></a>Выполнить полную копию SAP BW открытом концентраторе

На портале Azure перейдите в фабрику данных. Выберите **Создать монитор &** , чтобы открыть пользовательский интерфейс фабрики данных на отдельной вкладке.

1. На странице Приступая к **работе** выберите **копирование данных** , чтобы открыть средство копирование данных.

2. На странице **Свойства** укажите **имя задачи**, а затем нажмите кнопку **Далее**.

3. На странице **исходное хранилище данных** выберите **+ создать новое соединение**. Выберите **SAP BW открыть концентратор** из коллекции соединителей, а затем нажмите кнопку **продолжить**. Для фильтрации соединителей в поле поиска можно ввести **SAP** .

4. На странице **укажите SAP BW открыть подключение к концентратору** выполните следующие действия, чтобы создать новое соединение.

   ![Создание SAP BW открыть страницу связанной службы в центре](media/load-sap-bw-data/create-sap-bw-open-hub-linked-service.png)

   1. В списке **подключение через среду выполнения интеграции** выберите существующий собственный IR. Или выберите вариант, если он еще не создан.

      Чтобы создать локальную среду IR, выберите **+ создать**, а затем — локальное **Размещение**. Введите **имя**, а затем нажмите кнопку **Далее**. Выберите **экспресс установки** для установки на текущем компьютере или следуйте приведенным вручную инструкциям по **настройке** .

      Как упоминалось в [предварительных требованиях](#prerequisites), убедитесь, что на том же компьютере, где выполняется локальное IR-приложение, установлен соединитель SAP для Microsoft .NET 3,0.

   2. Введите **имя сервера** SAP BW, **номер системы**, **идентификатор клиента,** **язык** (если он отличается от **EN**), **имя пользователя** и **пароль**.

   3. Выберите **проверить подключение** , чтобы проверить параметры, а затем нажмите кнопку **Готово**.

   4. Создается новое соединение. Выберите **Далее**.

5. На странице **Выбор открытых узлов концентраторов** просмотрите назначения центра, доступные в SAP BW. Выберите ОХД, из которого нужно скопировать данные, а затем нажмите кнопку **Далее**.

   ![Выберите SAP BW открыть целевую таблицу концентратора](media/load-sap-bw-data/select-sap-bw-open-hub-table.png)

6. Укажите фильтр, если он требуется. Если ОХД содержит данные только из одного выполнения процесса перемещения данных (DTP) с одним ИДЕНТИФИКАТОРом запроса или если вы уверены, что DTP завершено и хотите скопировать данные, снимите флажок **исключить последний запрос** .

   Дополнительные сведения об этих параметрах см. в разделе [SAP BW открытая конфигурация назначений концентратора](#sap-bw-open-hub-destination-configurations) этой статьи. Выберите **проверить** , чтобы дважды проверить, какие данные будут возвращены. Выберите **Далее**.

   ![Настройка SAP BW открытие фильтра центра](media/load-sap-bw-data/configure-sap-bw-open-hub-filter.png)

7. На странице **целевое хранилище данных** выберите **+ создать новое подключение**  >  **Azure Data Lake Storage 2-го поколения**  >  **продолжить**.

8. На странице **Указание подключения Azure Data Lake Storage** выполните следующие действия, чтобы создать подключение.

   ![Создание страницы связанной службы ADLS 2-го поколения](media/load-sap-bw-data/create-adls-gen2-linked-service.png)

   1. Выберите учетную запись с поддержкой Data Lake Storage 2-го поколения из раскрывающегося списка **имя** .
   2. Выберите **Готово**, чтобы создать подключение. Выберите **Далее**.

9. На странице **Выбор выходного файла или папки** введите **копифромопенхуб** в качестве имени выходной папки. Выберите **Далее**.

   ![Страница «Выбор выходной папки»](media/load-sap-bw-data/choose-output-folder.png)

10. На странице Параметры **формата файла** нажмите кнопку **Далее** , чтобы использовать параметры по умолчанию.

    ![Страница «указание формата приемника»](media/load-sap-bw-data/specify-sink-format.png)

11. На странице **Параметры** разверните узел **Параметры производительности**. Введите значение для **степени параллелизма копирования** , например 5, чтобы загрузить из SAP BW параллельно. Выберите **Далее**.

    ![Настройка параметров копирования](media/load-sap-bw-data/configure-copy-settings.png)

12. Проверьте параметры на странице **Сводка** . Выберите **Далее**.

13. На странице **развертывание** выберите **мониторинг** , чтобы отслеживать конвейер.

    ![Страница развертывания](media/load-sap-bw-data/deployment.png)

14. Обратите внимание, что вкладка **монитор** в левой части страницы выбрана автоматически. Столбец **действия** содержит ссылки для просмотра сведений о выполнении действия и повторного запуска конвейера.

    ![Представление мониторинга конвейера](media/load-sap-bw-data/pipeline-monitoring.png)

15. Чтобы просмотреть запуски действий, связанные с выполнением конвейера, выберите **Просмотр запусков действий** в столбце **действия** . В этом конвейере определено только одно действие (действие копирования), поэтому вы увидите только одну запись. Чтобы вернуться в представление "запуски конвейера", щелкните ссылку **конвейеры** вверху. Щелкните **Обновить**, чтобы обновить список.

    ![Экран мониторинга активности](media/load-sap-bw-data/activity-monitoring.png)

16. Чтобы отслеживать сведения о выполнении для каждого действия копирования, выберите ссылку **сведения** , которая представляет собой значок очков под разрядом **действий** в представлении наблюдение за активностью. Доступные сведения включают объем данных, скопированный из источника в приемник, пропускную способность данных, шаги и длительность выполнения, а также используемые конфигурации.

    ![Сведения о мониторинге активности](media/load-sap-bw-data/activity-monitoring-details.png)

17. Чтобы просмотреть **максимальный идентификатор запроса**, вернитесь в представление наблюдение за действиями и выберите **выходные данные** в разделе **действия**.

    ![Экран вывода действия](media/load-sap-bw-data/activity-output.png)

    ![Представление сведений о выходных данных действия](media/load-sap-bw-data/activity-output-details.png)

## <a name="incremental-copy-from-sap-bw-open-hub"></a>Добавочное копирование из SAP BW открытие концентратора

> [!TIP]
> Сведения о том, как SAP BW открытый соединитель концентратора в фабрике данных копирует добавочные данные из SAP BW, см. в разделе [SAP BW открытие разностного извлечения соединителя концентратора](connector-sap-business-warehouse-open-hub.md#delta-extraction-flow) . Эта статья также поможет вам разобраться с базовой конфигурацией соединителя.

Теперь давайте продолжим настройку добавочного копирования из SAP BW открытого концентратора.

Добавочное копирование использует механизм "высокого предела", основанный на **идентификаторе запроса**. Этот идентификатор автоматически создается в SAP BW открытом центре в DTP. Этот рабочий процесс показан на следующей схеме:

![Блок-схема рабочего процесса добавочного копирования](media/load-sap-bw-data/incremental-copy-workflow.png)

На странице фабрика данных — **Начало работы** выберите **создать конвейер из шаблона** , чтобы использовать встроенный шаблон.

1. Найдите **SAP BW** , чтобы найти и выбрать **добавочное копирование из SAP BW в шаблон Azure Data Lake Storage 2-го поколения** . Этот шаблон копирует данные в Azure Data Lake Storage 2-го поколения. Аналогичный рабочий процесс можно использовать для копирования в другие типы приемников.

2. На главной странице шаблона выберите или создайте следующие три подключения, а затем выберите **использовать этот шаблон** в правом нижнем углу окна.

   - **Хранилище BLOB-объектов Azure**. в этом пошаговом руководстве мы используем хранилище больших двоичных объектов Azure для хранения верхнего предела, который является *максимальным идентификатором скопированного запроса*.
   - **SAP BW открыть центр**— это источник, из которого копируются данные. См. предыдущее пошаговое руководство по полному копированию для получения подробных сведений о конфигурации.
   - **Azure Data Lake Storage 2-го поколения**: это приемник, в который копируются данные. См. предыдущее пошаговое руководство по полному копированию для получения подробных сведений о конфигурации.

   ![Добавочное копирование из шаблона SAP BW](media/load-sap-bw-data/incremental-copy-from-sap-bw-template.png)

3. Этот шаблон создает конвейер со следующими тремя действиями и делает их цепочкой в случае успеха: *Lookup*, *копирование данных* и *Web*.

   Перейдите на вкладку **Параметры** конвейера. Вы увидите все конфигурации, которые необходимо предоставить.

   ![Добавочное копирование из конфигурации SAP BW](media/load-sap-bw-data/incremental-copy-from-sap-bw-pipeline-config.png)

   - **Сапопенхубдестинатионнаме**: укажите имя таблицы открытого центра, из которой копируются данные.

   - **Data_Destination_Container**: укажите контейнер назначения Azure Data Lake Storage 2-го поколения, в который копируются данные. Если контейнер не существует, действие копирования фабрики данных создает его во время выполнения.
  
   - **Data_Destination_Directory**. Укажите путь к папке в контейнере Azure Data Lake Storage 2-го поколения для копирования данных. Если путь не существует, действие копирования фабрики данных создает путь во время выполнения.
  
   - **Хигхватермаркблобконтаинер**: укажите контейнер для хранения значения верхнего предела.

   - **Хигхватермаркблобдиректори**: укажите путь к папке в контейнере для хранения значения верхнего предела.

   - **Хигхватермаркблобнаме**: укажите имя большого двоичного объекта для хранения значения верхнего предела, например `requestIdCache.txt` . В хранилище BLOB-объектов перейдите к соответствующему пути Хигхватермаркблобконтаинер + Хигхватермаркблобдиректори + Хигхватермаркблобнаме, например *Container/Path/requestIdCache.txt*. Создайте большой двоичный объект с содержимым 0.

      ![Содержимое BLOB-объекта](media/load-sap-bw-data/blob.png)

   - **Логикаппурл**. в этом шаблоне мы используем действие, чтобы вызвать Azure Logic Apps, чтобы задать значение верхнего предела в хранилище BLOB-объектов. Можно также использовать базу данных SQL Azure для ее хранения. Используйте действие хранимой процедуры для обновления значения.

      Сначала необходимо создать приложение логики, как показано на следующем рисунке. Затем вставьте **URL-адрес HTTP POST**.

      ![Конфигурация приложения логики](media/load-sap-bw-data/logic-app-config.png)

      1. Перейдите на портал Azure. Выберите новую службу **Logic Apps** . Выберите **+ пустое приложение логики** , чтобы открыть **конструктор Logic Apps**.

      2. Создание триггера **при получении HTTP-запроса**. Укажите текст HTTP-запроса следующим образом:

         ```json
         {
            "properties": {
               "sapOpenHubMaxRequestId": {
                  "type": "string"
               }
            },
            "type": "object"
         }
         ```

      3. Добавьте действие **создать BLOB-объект** . Для **пути к папке** и **имени большого двоичного объекта** используйте те же значения, которые вы настроили ранее в *хигхватермаркблобконтаинер + хигхватермаркблобдиректори* и *хигхватермаркблобнаме*.

      4. Щелкните **Сохранить**. Затем скопируйте значение **URL-адреса HTTP POST** для использования в конвейере фабрики данных.

4. После ввода параметров конвейера фабрики данных выберите **Отладка**  >  **завершить** , чтобы вызвать запуск для проверки конфигурации. Или выберите **опубликовать** , чтобы опубликовать все изменения, а затем выберите **добавить триггер** для выполнения выполнения.

## <a name="sap-bw-open-hub-destination-configurations"></a>SAP BW открытые конфигурации назначений концентратора

В этом разделе описывается настройка SAP BWной стороны для использования SAP BW открытого соединителя концентратора в фабрике данных для копирования данных.

### <a name="configure-delta-extraction-in-sap-bw"></a>Настройка извлечения изменений в SAP BW

Если вам требуются исторические и добавочные копии или только добавочные копии, настройте извлечение изменений в SAP BW.

1. Создайте открытое назначение концентратора. Вы можете создать ОХД в SAP Transaction RSA1, который автоматически создает необходимое преобразование и процесс перевода данных. Используйте следующие параметры:

   - **ObjectType**: можно использовать любой тип объекта. Здесь мы используем **InfoCube** в качестве примера.
   - **Тип назначения**: выберите **таблицу базы данных**.
   - **Ключ таблицы**: выберите пункт " **технический ключ**".
   - **Извлечение**: выберите вариант **сохранения данных и вставить записи в таблицу**.

   ![Диалоговое окно "Создание разностного SAP BW ОХД"](media/load-sap-bw-data/create-sap-bw-ohd-delta.png)

   ![Диалоговое окно "Создание SAP BW ОХД delta2"](media/load-sap-bw-data/create-sap-bw-ohd-delta2.png)

   Вы можете увеличить число параллельно выполняющихся рабочих процессов SAP для DTP:

   ![На снимке экрана показаны параметры параллельной обработки, где можно выбрать количество параллельных процессов для D T P.](media/load-sap-bw-data/create-sap-bw-ohd-delta3.png)

2. Запланируйте DTP в цепочках процессов.

   Разностный DTP для Куба работает только в том случае, если необходимые строки не были сжаты. Убедитесь, что сжатие Куба BW не работает, прежде чем DTP в таблицу Open Hub. Самый простой способ сделать это — интегрировать DTP в существующие цепочки процессов. В следующем примере DTP (to the ОХД) вставляется в цепочку процессов между шагами *корректировки* (статистическая свертка) и *свертывания* (сжатие Куба).

   ![Создание SAP BW схемы потока цепочки процессов](media/load-sap-bw-data/create-sap-bw-process-chain.png)

### <a name="configure-full-extraction-in-sap-bw"></a>Настройка полного извлечения в SAP BW

Помимо извлечения изменений, может потребоваться полное извлечение того же SAP BW Инфопровидер. Обычно это применимо, если требуется выполнить полное копирование, но не добавочное, или требуется [Повторная синхронизация разностного извлечения](#resync-delta-extraction).

Для одного ОХД не может быть больше одного DTP. Поэтому перед извлечением изменений необходимо создать дополнительный ОХД.

![Создание SAP BW ОХД Full](media/load-sap-bw-data/create-sap-bw-ohd-full.png)

Для полной загрузки ОХД выберите другие параметры, чем для извлечения изменений.

- В ОХД: задайте параметр **извлечения** , чтобы **удалить данные и вставить записи**. В противном случае данные будут извлекаться много раз при повторении DTP в цепочке процессов BW.

- В DTP: задайте для **режима извлечения** значение **Full**. Необходимо изменить автоматически созданный DTP с **Дельта** на **Full** сразу после создания ОХД, как показано на следующем рисунке:

   ![Диалоговое окно создания SAP BW ОХД, настроенное для полного извлечения](media/load-sap-bw-data/create-sap-bw-ohd-full2.png)

- В соединителе открытого концентратора BW фабрики данных: отключите параметр **исключить последний запрос**. В противном случае ничего не будет извлечено.

Обычно полная DTP выполняется вручную. Также можно создать цепочку процессов для полной DTP. Обычно это отдельная цепочка, не зависящая от существующих цепочек процессов. В любом случае *Убедитесь, что DTP завершен, прежде чем начать извлечение с помощью копирования фабрики данных*. В противном случае будут скопированы только частичные данные.

### <a name="run-delta-extraction-the-first-time"></a>Запустить извлечение изменений в первый раз

Первое извлечение изменений технически является *полным извлечением*. По умолчанию SAP BW открытый соединитель концентратора исключает последний запрос при копировании данных. Для первого извлечения изменений действие копирования фабрики данных не извлекает данные до тех пор, пока последующая DTP не создаст в таблице разностные данные с отдельным ИДЕНТИФИКАТОРом запроса. Существует два способа избежать этого сценария:

- Отключите параметр **исключить последний запрос** для первого извлечения изменений. Убедитесь, что первый разностный DTP завершен, прежде чем начать извлечение изменений в первый раз.
-  Используйте процедуру для повторной синхронизации разностного извлечения, как описано в следующем разделе.

### <a name="resync-delta-extraction"></a>Повторно синхронизировать разностное извлечение

Следующие сценарии изменяют данные в SAP BW кубах, но не считаются разностными DTP:

- SAP BW выборочного удаления (строк с использованием любого условия фильтра)
- Удаление запроса SAP BW (из-за неудачных запросов)

Назначение "открытый центр SAP" не является целевым объектом данных, управляемым киоском данных (во всех SAP BW пакетах поддержки, начиная с 2015). Таким образом, можно удалить данные из Куба, не изменяя данные в ОХД. Затем необходимо повторно синхронизировать данные куба с фабрикой данных:

1. Выполните полное извлечение в фабрике данных (используя полную DTP в SAP).
2. Удалите все строки в открытой таблице концентратора для разностного DTP.
3. Задайте состояние разностного DTP для **выборки**.

После этого все последующие разностные извлекают разностные Дтпс и фабрики данных работают должным образом.

Чтобы задать состояние разностного DTP для **выборки**, можно использовать следующий параметр, чтобы выполнить разностную DTP вручную:

*Нет Передача данных; Состояние Дельта в источнике: получено*

## <a name="next-steps"></a>Следующие шаги

Дополнительные сведения о поддержке соединителя SAP BW Open Hub:

> [!div class="nextstepaction"]
>[Соединитель Open Hub для SAP Business Warehouse](connector-sap-business-warehouse-open-hub.md)
