---
title: Преобразование приемника в потоке данных сопоставления
description: Узнайте, как настроить преобразование приемника в потоке данных сопоставления.
author: kromerm
ms.author: makromer
ms.reviewer: daperlov
ms.service: data-factory
ms.topic: conceptual
ms.custom: seo-lt-2019
ms.date: 03/10/2021
ms.openlocfilehash: 5548d82326ec4ac2306e2c8945bedc20236a4e54
ms.sourcegitcommit: 772eb9c6684dd4864e0ba507945a83e48b8c16f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/20/2021
ms.locfileid: "103009357"
---
# <a name="sink-transformation-in-mapping-data-flow"></a>Преобразование приемника в потоке данных сопоставления

[!INCLUDE[appliesto-adf-asa-md](includes/appliesto-adf-asa-md.md)]

После завершения преобразования данных запишите их в целевое хранилище, используя преобразование «приемник». Для каждого потока данных требуется по крайней мере одно преобразование приемника, но при необходимости можно выполнить запись в любое количество приемников для завершения потока преобразования. Для записи в дополнительные приемники создайте новые потоки с помощью новых ветвей и условных разбиений.

Каждое преобразование приемника связано только с одним объектом набора данных фабрики данных Azure или связанной службой. Преобразование «приемник» определяет форму и расположение данных, в которые необходимо выполнить запись.

## <a name="inline-datasets"></a>Встроенные наборы данных

При создании преобразования «приемник» укажите, определяются ли сведения о приемнике внутри объекта DataSet или в преобразовании приемника. Большинство форматов доступны только в одном или другом. Чтобы узнать, как использовать конкретный соединитель, см. соответствующий документ соединителя.

Если формат поддерживается как для встроенного, так и для объекта DataSet, то оба имеют преимущества. Объекты DataSet — это многократно используемые сущности, которые можно использовать в других потоках данных и действиях, таких как копирование. Эти многократно используемые сущности особенно полезны при использовании зафиксированной схемы. Наборы данных не основаны на Spark. Иногда может потребоваться переопределить некоторые параметры или проекцию схемы в преобразовании приемника.

Встроенные наборы данных рекомендуются при использовании гибких схем, одноразовых экземпляров приемников или параметризованных приемников. Если ваш приемник сильно параметризован, встроенные наборы данных позволяют не создавать фиктивные объекты. Встроенные наборы данных основаны на Spark, а их свойства являются собственными для потока данных.

Чтобы использовать встроенный набор данных, выберите нужный формат в селекторе **типа приемника** . Вместо выбора набора данных приемника выберите связанную службу, к которой необходимо подключиться.

![Снимок экрана, на котором отображаются встроенные выбранные.](media/data-flow/inline-selector.png "Снимок экрана, на котором отображаются встроенные выбранные.")

##  <a name="supported-sink-types"></a><a name="supported-sinks"></a> Поддерживаемые типы приемников

Поток данных сопоставления следует подходу извлечения, загрузки и преобразования (ELT) и работает с *промежуточными* наборами данных, которые находятся в Azure. Сейчас в преобразовании источника могут использоваться следующие наборы данных.

| Соединитель | Формат | Набор данных или встраивание |
| --------- | ------ | -------------- |
| [Хранилище BLOB-объектов Azure](connector-azure-blob-storage.md#mapping-data-flow-properties) | [Avro](format-avro.md#mapping-data-flow-properties) <br>[Текст с разделителями](format-delimited-text.md#mapping-data-flow-properties) <br>[Разностная версия](format-delta.md) <br>[JSON](format-json.md#mapping-data-flow-properties) <br/>[ORC](format-orc.md#mapping-data-flow-properties)<br>[Parquet](format-parquet.md#mapping-data-flow-properties) | ✓/- <br>✓/- <br>-/✓ <br>✓/- <br>✓/✓<br>✓/- |
| [Azure Cosmos DB (SQL API)](connector-azure-cosmos-db.md#mapping-data-flow-properties) | | ✓/- |
| [Azure Data Lake Storage 1-го поколения](connector-azure-data-lake-store.md#mapping-data-flow-properties) | [Avro](format-avro.md#mapping-data-flow-properties) <br>[Текст с разделителями](format-delimited-text.md#mapping-data-flow-properties) <br>[JSON](format-json.md#mapping-data-flow-properties) <br/>[ORC](format-orc.md#mapping-data-flow-properties)<br/>[Parquet](format-parquet.md#mapping-data-flow-properties) | ✓/- <br>✓/- <br>✓/- <br>✓/✓<br>✓/- |
| [Azure Data Lake Storage 2-го поколения](connector-azure-data-lake-storage.md#mapping-data-flow-properties) | [Avro](format-avro.md#mapping-data-flow-properties) <br/>[Модель общих данных](format-common-data-model.md#sink-properties)<br>[Текст с разделителями](format-delimited-text.md#mapping-data-flow-properties) <br>[Разностная версия](format-delta.md) <br>[JSON](format-json.md#mapping-data-flow-properties) <br/>[ORC](format-orc.md#mapping-data-flow-properties)<br/>[Parquet](format-parquet.md#mapping-data-flow-properties) | ✓/- <br>-/✓ <br>✓/- <br>-/✓ <br>✓/-<br>✓/✓ <br>✓/- |
| [База данных Azure для MySQL](connector-azure-database-for-mysql.md) |  | ✓/✓ |
| [База данных Azure для PostgreSQL](connector-azure-database-for-postgresql.md) |  | ✓/✓ |
| [База данных SQL Azure](connector-azure-sql-database.md#mapping-data-flow-properties) | | ✓/- |
| [Управляемый экземпляр Azure SQL (Предварительная версия)](connector-azure-sql-managed-instance.md#mapping-data-flow-properties) | | ✓/- |
| [Azure Synapse Analytics](connector-azure-sql-data-warehouse.md#mapping-data-flow-properties) | | ✓/- |
| [Snowflake](connector-snowflake.md) | | ✓/✓ |

Параметры, относящиеся к этим соединителям, находятся на вкладке **Параметры** . Сведения и примеры сценариев потока данных для этих параметров находятся в документации по соединителю.

Фабрика данных Azure имеет доступ к более чем [90 собственным соединителям](connector-overview.md). Чтобы записать данные в другие источники из потока данных, используйте действие копирования для загрузки этих данных из поддерживаемого приемника.

## <a name="sink-settings"></a>Параметры приемника

После добавления приемника настройте его с помощью вкладки **приемник** . Здесь можно выбрать или создать набор данных, в который будет записываться приемник. Значения разработки для параметров набора данных можно настроить в [параметрах отладки](concepts-data-flow-debug-mode.md). (Режим отладки должен быть включен.)

В следующем видео описывается ряд различных параметров приемника для типов файлов с разделителями текста.

> [!VIDEO https://www.microsoft.com/videoplayer/embed/RE4tf7T]

![Снимок экрана, на котором показаны параметры приемника.](media/data-flow/sink-settings.png "Снимок экрана, на котором показаны параметры приемника.")

**Смещение схемы**. [смещение схемы](concepts-data-flow-schema-drift.md) — это способность фабрики данных в собственном коде управлять гибкими схемами в потоках данных без необходимости явно определять изменения столбцов. Включите параметр **Разрешить отклонение схемы** , чтобы записать дополнительные столбцы поверх того, что определено в схеме данных приемника.

**Проверка схемы**: Если выбран параметр проверить схему, поток данных завершится ошибкой, если какой-либо столбец входящей исходной схемы не найден в исходной проекции или если типы данных не совпадают. Используйте этот параметр, чтобы обеспечить соответствие исходных данных контракту определенной проекции. Это полезно в сценариях источника базы данных, чтобы сообщить об изменении имен или типов столбцов.

## <a name="cache-sink"></a>Приемник кэша

> [!VIDEO https://www.microsoft.com/en-us/videoplayer/embed/RE4HKt1]

*Приемник кэша* используется, когда поток данных записывает данные в кэш Spark, а не в хранилище данных. При сопоставлении потоков данных вы можете ссылаться на эти данные в одном потоке много раз, используя *Поиск в кэше*. Это полезно, если требуется сослаться на данные как часть выражения, но не нужно явно соединять с ними столбцы. Распространенные примеры, в которых приемник кэша может помочь найти максимальное значение в хранилище данных и соответствующим кодам ошибок в базе данных сообщений об ошибках. 

Чтобы записать в приемник кэша, добавьте преобразование «приемник» и выберите « **кэшировать** как тип приемника». В отличие от других типов приемников, не нужно выбирать набор данных или связанную службу, так как вы не пишете во внешнее хранилище. 

![Выбор приемника кэша](media/data-flow/select-cache-sink.png "Выбор приемника кэша")

В параметрах приемника можно дополнительно указать ключевые столбцы приемника кэша. Они используются в качестве условий соответствия при использовании `lookup()` функции в поиске кэша. Если указать ключевые столбцы, функцию нельзя использовать `outputs()` в поиске кэша. Дополнительные сведения о синтаксисе поиска в кэше см. в разделе [кэшированные уточняющие запросы](concepts-data-flow-expression-builder.md#cached-lookup).

![Столбцы ключа приемника кэша](media/data-flow/cache-sink-key-columns.png "Столбцы ключа приемника кэша")

Например, если я указал один ключевой столбец `column1` в в приемнике кэша с именем `cacheExample` , вызов `cacheExample#lookup()` будет иметь один параметр, указывающий, в какой строке в приемнике кэша будет выполняться сопоставление. Функция выводит один сложный столбец с подстолбцами для каждого сопоставленного столбца.

> [!NOTE]
> Приемник кэша должен находиться в полностью независимом потоке данных от любого преобразования, ссылающегося на него посредством поиска в кэше. Кроме того, приемник кэша должен иметь первый записанный приемник. 

## <a name="field-mapping"></a>Сопоставление полей

Аналогично преобразованию «выбор» на вкладке « **сопоставление** » приемника можно выбрать, какие входящие столбцы будут записаны. По умолчанию сопоставляются все входные столбцы, включая смещенные столбцы. Такое поведение называется *автосопоставлением*.

При отключении автосопоставления можно добавить либо фиксированные сопоставления на основе столбцов, либо сопоставления на основе правил. С помощью сопоставлений на основе правил можно написать выражения с сопоставлением шаблонов. Фиксированное сопоставление сопоставляет имена логических и физических столбцов. Дополнительные сведения о сопоставлении на основе правил см. [в разделе Шаблоны столбцов в потоке данных сопоставления](concepts-data-flow-column-pattern.md#rule-based-mapping-in-select-and-sink).

## <a name="custom-sink-ordering"></a>Заказ настраиваемых приемников

По умолчанию данные записываются в несколько приемников в недетерминированном порядке. Подсистема выполнения записывает данные параллельно по мере завершения логики преобразования, и порядок приемников может меняться при каждом запуске. Чтобы указать точный порядок приемников, включите **Настраиваемый порядок приемников** на вкладке **Общие** потока данных. Если этот флажок включен, приемники записываются последовательно в порядке возрастания.

![Снимок экрана, показывающий пользовательский порядок приемников.](media/data-flow/custom-sink-ordering.png "Снимок экрана, показывающий пользовательский порядок приемников.")

> [!NOTE]
> При использовании [кэшированных поисков](./concepts-data-flow-expression-builder.md#cached-lookup)убедитесь, что в упорядочении приемников задано значение 1, самый низкий (или первый) в порядке сортировки.

![Заказ настраиваемых приемников](media/data-flow/cache-2.png "Заказ настраиваемых приемников")

### <a name="sink-groups"></a>Группы приемников

Можно группировать приемники, применяя одинаковый порядковый номер для ряда приемников. ADF будет рассматривать эти приемники как группы, которые могут выполняться параллельно. Параметры для параллельного выполнения будут отображаться в действии потока данных конвейера.

## <a name="error-row-handling"></a>Обработка строк ошибок

При записи в базы данных может произойти сбой некоторых строк данных из-за ограничений, установленных в назначении. По умолчанию выполнение потока данных завершится ошибкой при первой ошибке, которую он получает. В некоторых соединителях можно **продолжать работу при ошибке** , которая позволяет завершить поток данных даже в случае возникновения ошибок в отдельных строках. В настоящее время эта возможность доступна только в базе данных SQL Azure. Дополнительные сведения см. [в разделе Обработка строк ошибок в базе данных SQL Azure](connector-azure-sql-database.md#error-row-handling).

Ниже приведено Видеоруководство по автоматическому использованию обработки строк ошибок базы данных в преобразовании приемника.

> [!VIDEO https://www.microsoft.com/en-us/videoplayer/embed/RE4IWne]

## <a name="data-preview-in-sink"></a>Предварительный просмотр данных в приемнике

При выборке предварительной версии данных в отладочном кластере данные в приемник не записываются. Будет возвращен моментальный снимок данных, которые выглядят, но в назначение ничего не будет записано. Чтобы проверить запись данных в приемник, запустите отладку конвейера из холста конвейера.

## <a name="next-steps"></a>Следующие шаги

Теперь, когда вы создали поток данных, добавьте [в конвейер действие потока данных](concepts-data-flow-overview.md).