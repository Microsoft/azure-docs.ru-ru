---
title: Копирование локальных данных с помощью средства Копирования данных Azure
description: Создайте фабрику данных Azure, а затем примените средство копирования данных для копирования данных из базы данных SQL Server в Хранилище BLOB-объектов Azure.
ms.author: abnarain
author: nabhishek
ms.service: data-factory
ms.topic: tutorial
ms.custom: seo-lt-2019
ms.date: 03/26/2021
ms.openlocfilehash: 70905d23b61ee9fee319bae41aeb421d808fa4d0
ms.sourcegitcommit: f0a3ee8ff77ee89f83b69bc30cb87caa80f1e724
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/26/2021
ms.locfileid: "105566767"
---
# <a name="copy-data-from-a-sql-server-database-to-azure-blob-storage-by-using-the-copy-data-tool"></a>Скопируйте данные из базы данных SQL Server в хранилище BLOB-объектов Azure с помощью средства копирования данных
> [!div class="op_single_selector" title1="Выберите используемую версию службы "Фабрика данных":"]
> * [Версия 1](v1/data-factory-copy-data-from-azure-blob-storage-to-sql-database.md)
> * [Текущая версия](tutorial-hybrid-copy-data-tool.md)

[!INCLUDE[appliesto-adf-asa-md](includes/appliesto-adf-asa-md.md)]

В этом руководстве вы создадите фабрику данных с помощью портала Azure. После этого примените средство копирования данных для создания конвейера, который будет копировать данные из базы данных SQL Server в хранилище BLOB-объектов Azure.

> [!NOTE]
> - Если вы еще не работали с фабрикой данных Azure, ознакомьтесь со статьей [Введение в фабрику данных Azure](introduction.md).

Вот какие шаги выполняются в этом учебнике:

> [!div class="checklist"]
> * Создали фабрику данных.
> * Создание конвейера с помощью средства копирования данных.
> * Мониторинг конвейера и выполнения действий.

## <a name="prerequisites"></a>Предварительные требования
### <a name="azure-subscription"></a>Подписка Azure.
Если у вас еще нет подписки Azure, [создайте бесплатную учетную запись Azure](https://azure.microsoft.com/free/), прежде чем начинать работу.

### <a name="azure-roles"></a>Роли Azure
Чтобы создать экземпляры фабрики данных, нужно назначить учетной записи пользователя, используемой для входа в Azure, роль *участника*, *владельца* либо *администратора* подписки Azure.

Чтобы просмотреть существующие разрешения в подписке, перейдите на портал Azure. В верхнем правом углу выберите имя пользователя, а затем **Разрешения**. Если у вас есть доступ к нескольким подпискам, выберите соответствующую подписку. Примеры инструкций по назначению пользователю роли см. в статье [Назначение ролей Azure с помощью портала Azure](../role-based-access-control/role-assignments-portal.md).

### <a name="sql-server-2014-2016-and-2017"></a>SQL Server 2014, 2016 и 2017
В этом руководстве используйте базу данных SQL Server в качестве *исходного* хранилища данных. Конвейер фабрики данных, созданный в рамках этого руководства, копирует данные из этой базы данных SQL Server (источника) в хранилище BLOB-объектов (приемник). Затем создайте таблицу с именем **emp** в базе данных SQL Server и вставьте в нее несколько примеров записей.

1. Запустите среду SQL Server Management Studio. Если она еще не установлена на вашем компьютере, скачайте ее со страницы [Скачивание SQL Server Management Studio (SSMS)](/sql/ssms/download-sql-server-management-studio-ssms).

1. Подключитесь к экземпляру SQL Server с помощью учетных данных.

1. Создайте пример базы данных. В представлении в виде дерева щелкните правой кнопкой мыши элемент **Базы данных** и выберите пункт **Новая база данных**.

1. В окне **Новая база данных** введите имя базы данных и нажмите кнопку **ОК**.

1. Чтобы создать таблицу **emp** и вставить в нее примеры данных, запустите приведенный ниже сценарий запроса к базе данных. В представлении в виде дерева щелкните правой кнопкой мыши созданную базу данных и выберите пункт **Новый запрос**.

    ```sql
    CREATE TABLE dbo.emp
    (
        ID int IDENTITY(1,1) NOT NULL,
        FirstName varchar(50),
        LastName varchar(50)
    )
    GO

    INSERT INTO emp (FirstName, LastName) VALUES ('John', 'Doe')
    INSERT INTO emp (FirstName, LastName) VALUES ('Jane', 'Doe')
    GO
    ```

### <a name="azure-storage-account"></a>Учетная запись хранения Azure.
В этом руководстве используйте учетную запись хранения Azure общего назначения (хранилища BLOB-объектов) в качестве целевого (принимающего) хранилища данных. Если у вас нет учетной записи хранения общего назначения, изучите инструкции [по созданию учетной записи хранения](../storage/common/storage-account-create.md). Конвейер фабрики данных, созданный в рамках этого руководства, копирует данные из базы данных SQL Server (источника) в это хранилище BLOB-объектов (приемник). 

#### <a name="get-the-storage-account-name-and-account-key"></a>Получение имени и ключа учетной записи хранения и ключа учетной записи
В этом руководстве вы будете использовать имя и ключ своей учетной записи хранения. Чтобы получить имя и ключ учетной записи хранения, сделайте следующее:

1. Войдите на [портал Azure](https://portal.azure.com), используя имя пользователя и пароль Azure.

1. На панели слева выберите **Все службы**. Отфильтруйте содержимое по ключевому слову **хранение**, а затем выберите **Учетные записи хранения**.

    ![Поиск учетной записи хранения](media/doc-common-process/search-storage-account.png)

1. В списке учетных записей хранения найдите с помощью фильтра свою учетную запись хранения (при необходимости). Затем выберите свою учетную запись хранения.

1. В окне **Учетная запись хранения** выберите параметр **Ключи доступа**.


1. Скопируйте значения полей **Имя учетной записи хранения** и **key1**. Затем вставьте их в Блокнот или другой редактор для дальнейшего использования в руководстве.

## <a name="create-a-data-factory"></a>Создание фабрики данных

1. В меню слева выберите **Создать ресурс** > **Интеграция** > **Фабрика данных**.

   ![Создание фабрики данных](./media/doc-common-process/new-azure-data-factory-menu.png)

1. На странице **Новая фабрика данных** в поле **Имя** введите **ADFTutorialDataFactory**.

   Имя фабрики данных должно быть *глобально уникальным*. Если вы увидите следующее сообщение об ошибке для поля имени, введите другое имя фабрики данных (например, ваше_имя_ADFTutorialBulkCopyDF). Дополнительные сведения о правилах именования артефактов фабрики данных см. в статье [Фабрика данных Azure — правила именования](naming-rules.md).

    :::image type="content" source="./media/doc-common-process/name-not-available-error.png" alt-text="Новое сообщение об ошибке фабрики данных со сведениями о том, что имя дублируется.":::
1. Выберите **подписку** Azure, в рамках которой вы хотите создать фабрику данных.
1. Для **группы ресурсов** выполните одно из следующих действий:

   - Выберите **Использовать существующую** и укажите существующую группу ресурсов в раскрывающемся списке.

   - Выберите **Создать новую** и укажите имя группы ресурсов. 
        
     Сведения о группах ресурсов см. в статье [Общие сведения об Azure Resource Manager](../azure-resource-manager/management/overview.md).
1. В качестве **версии** выберите **V2**.
1. В качестве **расположения** выберите расположение фабрики данных. В раскрывающемся списке отображаются только поддерживаемые расположения. Хранилища данных (например, служба хранилища Azure и база данных SQL) и вычислительные ресурсы (например, Azure HDInsight), используемые фабрикой данных, могут находиться в других регионах или расположениях.
1. Нажмите кнопку **создания**.

1. Когда завершится создание, откроется страница **Фабрика данных**, как показано на рисунке ниже.

    :::image type="content" source="./media/doc-common-process/data-factory-home-page.png" alt-text="Домашняя страница Фабрики данных Azure с элементом &quot;Создание и мониторинг&quot;.":::
1. Чтобы открыть на отдельной вкладке пользовательский интерфейс фабрики данных, выберите **Создание и мониторинг**.

## <a name="use-the-copy-data-tool-to-create-a-pipeline"></a>Создание конвейера с помощью средства копирования данных

1. Чтобы запустить средство копирования данных, на странице **Let's get started** (Начало работы) выберите **Копирование данных**.

   ![Страница "Начало работы"](./media/doc-common-process/get-started-page.png)

1. На странице **Свойства** для средства копирования данных в качестве **имени задачи** укажите **CopyFromOnPremSqlToAzureBlobPipeline**. Выберите **Далее**. Средство копирования данных создаст конвейер с именем, которое вы ввели в этом поле.
  ![Имя задачи](./media/tutorial-hybrid-copy-data-tool/properties-page.png)

1. На странице **Source data store** (Исходное хранилище данных) щелкните **Create new connection** (Создать подключение).

1. В разделе **New Linked Service** (Новая связанная служба) выполните поиск по запросу **SQL Server**, а затем выберите **Продолжить**.

1. В диалоговом окне **New Linked Service (SQL Server)** (Новая связанная служба (SQL Server)) в поле **Имя** введите **SqlServerLinkedService**. В разделе **Connect via integration runtime** (Подключение через среду выполнения интеграции) выберите **Создать**. Вам следует создать локальную среду выполнения интеграции, скачать ее на локальный компьютер и зарегистрировать с использованием фабрики данных. Локальная среда выполнения интеграции копирует данные из локальной среды в облако и обратно.

1. В диалоговом окне **Integration Runtime Setup** (Настройка среды выполнения интеграции) выберите **Self-Hosted** (Локальная). Затем выберите **Continue** (Продолжить).

   ![Создание среды выполнения интеграции](./media/tutorial-hybrid-copy-data-tool/create-self-hosted-integration-runtime.png)

1. В диалоговом окне **Integration Runtime Setup** (Настройка среды выполнения интеграции) в поле **Имя** введите **TutorialIntegrationRuntime**. Щелкните **Создать**.

1. В диалоговом окне **Integration Runtime Setup** (Настройка среды выполнения интеграции) выберите **Click here to launch the express setup for this computer** (Щелкните здесь, чтобы запустить экспресс-установку для этого компьютера). Это действие устанавливает среду выполнения интеграции на локальном компьютере и регистрирует ее с использованием фабрики данных. Кроме того, вы можете использовать режим установки вручную: скачайте файл установки, запустите его и примените ключ для регистрации среды выполнения интеграции.

1. Запустите загруженное приложение. В окне будет отображаться "текущее состояние" экспресс-установки.

    ![Состояние экспресс-установки](./media/tutorial-hybrid-copy-data-tool/express-setup-status.png)

1. В диалоговом окне **New Linked Service (SQL Server)** (Новая связанная служба (SQL Server)) убедитесь, что для поля "Среда выполнения интеграции" выбран вариант **TutorialIntegrationRuntime**. Затем выполните следующие действия:

    а. В поле **Имя** введите **SqlServerLinkedService**.

    b. В поле **Имя сервера** введите имя экземпляра SQL Server.

    c. В поле **Имя базы данных** введите имя локальной базы данных.

    d. В поле **Тип проверки подлинности** выберите нужный вариант аутентификации.

    д) В поле **Имя пользователя** введите имя пользователя, имеющего доступ к SQL Server.

    е) Введите **пароль** для этого пользователя.

    ж. Проверьте подключение и нажмите кнопку **Готово**.

      ![Выбранная среда выполнения интеграции](./media/tutorial-hybrid-copy-data-tool/integration-runtime-selected.png)

1. На странице **Исходное хранилище данных** нажмите кнопку **Далее**.

1. На странице **Select tables from which to copy the data or use a custom query** (Выберите таблицы, из которых нужно скопировать данные, или введите пользовательский запрос) выберите в списке значение **[dbo].[emp]** , а затем **Далее**. Можно выбрать любую другую таблицу в зависимости от базы данных.

1. На странице **Destination data store** (Целевое хранилище данных) выберите **Create new connection** (Создать подключение).


1. В окне **New Linked Service** (Новая связанная служба) найдите и выберите **BLOB-объект Azure**, а затем нажмите кнопку **Продолжить**.

   ![Выбор хранилища BLOB-объектов](./media/tutorial-hybrid-copy-data-tool/select-destination-data-store.png)

1. В диалоговом окне **New Linked Service (Azure Blob Storage)** (Новая связанная служба (хранилище BLOB-объектов Azure)) сделайте следующее:

   а. В поле **Имя** введите **AzureStorageLinkedService**.

   b. В разделе **Connect via integration runtime** (Подключение через среду выполнения интеграции) выберите **TutorialIntegrationRuntime**.

   c. В раскрывающемся списке **Имя учетной записи хранения** выберите учетную запись хранения.

   d. Нажмите кнопку **Готово**.

1. В диалоговом окне **Целевое хранилище данных** выберите вариант **Хранилище BLOB-объектов Azure**. Выберите **Далее**.

1. В диалоговом окне **Choose the output file or folder** (Выбор выходного файла или папки) в поле **Путь к папке** введите **adftutorial/fromonprem**. Для работы с этим руководством вы ранее создали контейнер **adftutorial**. Если указанной папки выходных данных (в этом случае **fromonprem**) не существует, Фабрика данных создаст ее автоматически. Вы также можете нажать кнопку **Обзор**, чтобы открыть хранилище BLOB-объектов и просмотреть в нем контейнеры и папки. Если не указать значение в поле **имени файла**, по умолчанию будет использоваться имя источника (в этом случае **dbo.emp**).

   ![Выбор целевого файла или папки](./media/tutorial-hybrid-copy-data-tool/choose-output-file-folder.png)

1. В диалоговом окне **File format settings** (Параметры формата файла) выберите **Далее**.

1. В диалоговом окне **Параметры** выберите **Далее**.

1. В диалоговом окне **Сводка** проверьте значения всех параметров и нажмите кнопку **Далее**.

1. На **странице развертывания** выберите **Мониторинг**, чтобы отслеживать созданный конвейер (задачу). 

1. Когда выполнение конвейера завершится, вы сможете просмотреть состояние созданного контейнера. 

1. На странице "Запуски конвейера" выберите **Обновить**, чтобы обновить список. Щелкните ссылку в разделе **ИМЯ КОНВЕЙЕРА**, чтобы просмотреть сведения о выполнении действия или перезапустить конвейер. 

1. На странице "Запуски операции" выберите ссылку **Сведения** (значок очков) в столбце **ИМЯ АКТИВНОСТИ**, чтобы получить дополнительные сведения об операции копирования. Чтобы вернуться к представлению "Запуски конвейера", щелкните ссылку **Все запуски конвейеров** в меню навигации. Чтобы обновить список, нажмите кнопку **Обновить**.

1. Убедитесь, что целевой файл появился в папке **fromonprem** конвейера **adftutorial**.

1. Выберите вкладку **Правка** слева, чтобы переключиться в режим правки. В этом редакторе вы можете изменять параметры связанных служб, наборов данных и конвейеров, созданных с помощью средства. Выберите **Код**, чтобы просмотреть код JSON для сущности, открытой в редакторе. Сведения о том, как редактировать эти сущности с помощью пользовательского интерфейса фабрики данных, см. в [версии этого руководства для портала Azure](tutorial-copy-data-portal.md).


## <a name="next-steps"></a>Дальнейшие действия
В этом примере конвейер копирует данные из базы данных SQL Server в хранилище BLOB-объектов. Вы ознакомились с выполнением следующих задач:

> [!div class="checklist"]
> * Создали фабрику данных.
> * Создание конвейера с помощью средства копирования данных.
> * Мониторинг конвейера и выполнения действий.

Список хранилищ данных, поддерживаемых фабрикой данных, см. в разделе [Поддерживаемые хранилища данных и форматы](copy-activity-overview.md#supported-data-stores-and-formats).

Информацию о копировании данных в пакетном режиме из источника в место назначения см. в следующем руководстве:

> [!div class="nextstepaction"]
>[Копирование нескольких таблиц в пакетном режиме с помощью фабрики данных Azure](tutorial-bulk-copy-portal.md)
