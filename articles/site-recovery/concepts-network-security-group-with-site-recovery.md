---
title: Группы безопасности сети и Azure Site Recovery | Документация Майкрософт
description: Сведения об использовании групп безопасности сети и Azure Site Recovery для аварийного восстановления и миграции.
author: Harsha-CS
manager: rochakm
ms.service: site-recovery
ms.topic: conceptual
ms.date: 04/08/2019
ms.author: harshacs
ms.openlocfilehash: 367aba09f84da1e227c08721077aa1b2132a62bf
ms.sourcegitcommit: 910a1a38711966cb171050db245fc3b22abc8c5f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "92367980"
---
# <a name="network-security-groups-with-azure-site-recovery"></a>Группы безопасности сети и Azure Site Recovery

Группы безопасности сети позволяют ограничить трафик к ресурсам в виртуальной сети. [Группа безопасности сети](../virtual-network/network-security-groups-overview.md#network-security-groups) содержит список правил безопасности, которые разрешают или запрещают входящий и исходящий трафик в зависимости от IP-адреса источника или назначения, порта и протокола.

В модели развертывания диспетчера ресурсов группы безопасности сети можно связывать с подсетями или отдельными сетевыми интерфейсами. Если группа безопасности сети связана с подсетью, эти правила применяются ко всем ресурсам в подсети. Трафик можно также ограничить, связав NSG с отдельным сетевым интерфейсом в подсети, в которой уже есть связанная NSG.

В этой статье описывается, как можно использовать группы безопасности сети с Azure Site Recovery.

## <a name="using-network-security-groups"></a>Использование групп безопасности сети

С отдельной подсетью может быть связана или не связана NSG, также как и с отдельным сетевым интерфейсом. Таким образом, можно эффективно использовать два ограничения на трафик для виртуальной машины, связав NSG сначала с подсетью, а затем другой NSG к сетевому интерфейсу виртуальной машины. Применение правил NSG в этом случае зависит от направления трафика и приоритета применяемых правил безопасности.

Рассмотрим простой пример с одной виртуальной машиной.
-    Виртуальная машина размещена внутри **подсети Contoso**.
-    **Подсеть Contoso** связана с **NSG подсети**.
-    Кроме того, с **NSG виртуальной машины** связан сетевой интерфейс виртуальной машины.

![NSG и Site Recovery](./media/concepts-network-security-group-with-site-recovery/site-recovery-with-network-security-group.png)

В этом примере для входящего трафика сначала вычисляется NSG подсети. Любой трафик, проходящий через NSG подсети, вычисляется NSG виртуальной машины. Обратное применимо к исходящему трафику. При этом сначала вычисляется NSG виртуальной машины. Любой трафик, проходящий через NSG виртуальной машины, вычисляется NSG подсети.

Это позволяет точно применять правило безопасности. Например, вам может потребоваться разрешить входящий доступ в Интернет для нескольких виртуальных машин приложений (например, интерфейсных виртуальных машин) в подсети, но ограничить входящий доступ в Интернет для других виртуальных машин (например, базы данных и других внутренних виртуальных машин). В этом случае в NSG подсети можно применять менее строгое правило, разрешающее передачу интернет-трафика, и ограничить доступ определенными виртуальными машинами, запретив доступ в NSG виртуальной машины. То же можно применять и для исходящего трафика.

При настройке таких конфигураций NSG убедитесь, что к [правилам безопасности](../virtual-network/network-security-groups-overview.md#security-rules) применяются соответствующие приоритеты. Правила обрабатываются в порядке приоритета. Числа обрабатываются по возрастанию, так как меньшие числа имеют более высокий приоритет. Если показатель трафика соответствует установленному в правиле, обработка останавливается. В результате все правила с более низким приоритетом (большие числа) и тем же атрибутом,что и правила с высоким приоритетом, не обрабатываются.

Не всегда известно, применяются ли группы безопасности сети и к сетевому интерфейсу, и к подсети. Все правила, применяемые к сетевому интерфейсу, можно с легкостью проверить в списке [действующих правил безопасности](../virtual-network/virtual-network-network-interface.md#view-effective-security-rules) сетевого интерфейса. Можно также использовать возможность [проверки IP-потока](../network-watcher/diagnose-vm-network-traffic-filtering-problem.md) в [наблюдателе за сетями Azure](../network-watcher/network-watcher-monitoring-overview.md) , чтобы определить, разрешено ли подключение к сетевому интерфейсу или нет. Средство позволяет узнать, разрешен ли обмен данными и какие правила безопасности сети разрешают или запрещают трафик.

## <a name="on-premises-to-azure-replication-with-nsg"></a>Репликация из локальной среды в Azure с помощью NSG

Azure Site Recovery позволяет осуществлять аварийное восстановление и миграцию в Azure для локальных [виртуальных машин Hyper-V](hyper-v-azure-architecture.md), [виртуальных машин VMware](vmware-azure-architecture.md) и [физических серверов](physical-azure-architecture.md). Для всех сценариев репликации из локальной среды в Azure соответствующие данные отправляются и сохраняются в учетной записи хранения Azure. Во время репликации вам не требуется вносить плату за виртуальные машины. При выполнении отработки отказа в Azure служба Site Recovery автоматически создаст виртуальные машины IaaS Azure.

После создания виртуальных машин и отработки отказа в Azure NSG можно использовать, чтобы ограничить сетевой трафик для виртуальной сети и виртуальных машин. При отработке отказа Site Recovery не создает группы безопасности сети. Мы рекомендуем создавать необходимые группы безопасности сети Azure перед запуском отработки отказа. После этого вы можете связать группы безопасности сети с виртуальными машинами для отработки отказа автоматически, используя сценарии автоматизации с мощными [планами восстановления](site-recovery-create-recovery-plans.md)Site Recovery.

Например, если конфигурация виртуальной машины после отработки отказа аналогична [примеру сценария](concepts-network-security-group-with-site-recovery.md#using-network-security-groups), описанному выше:
-    Вы можете создать **виртуальную сеть Contoso** и **подсеть Contoso** в целевом регионе Azure как часть планирования аварийного восстановления.
-    Вы также можете создать и настроить **NSG подсети** и **NSG виртуальной машины** в рамках того же планирования аварийного восстановления.
-    Затем **NSG подсети** можно связать непосредственно с **подсетью Contoso**, так как NSG и подсеть уже доступны.
-    **NSG виртуальной машины** можно связать с виртуальными машинами во время отработки отказа с использованием планов восстановления.

После создания и настройки групп безопасности сети мы рекомендуем выполнить [тестовую отработку отказа](site-recovery-test-failover-to-azure.md) для проверки сценариев связи NSG и подключение виртуальной машины после отработки отказа.

## <a name="azure-to-azure-replication-with-nsg"></a>Репликация из Azure в Azure с помощью NSG

Azure Site Recovery позволяет выполнять аварийное восстановление [виртуальных машин Azure](azure-to-azure-architecture.md). При включении репликации для виртуальных машин Azure Site Recovery позволяет создавать в целевом регионе реплики виртуальных сетей (включая настройки подсетей и шлюзов) и настраивать сопоставления между исходными и целевыми виртуальными сетями. Вы также можете заранее создать сети и подсети в целевой среде и использовать их для репликации. Site Recovery не создает виртуальные машины в целевом регионе Azure до [отработки отказа](azure-to-azure-tutorial-failover-failback.md).

Для репликации виртуальной машины Azure убедитесь, что правила NSG в исходном регионе Azure позволяют [исходящие подключения](azure-to-azure-about-networking.md#outbound-connectivity-using-service-tags) для трафика репликации. Вы также можете проверить эти необходимые правила на этом [примере конфигурации NSG](azure-to-azure-about-networking.md#example-nsg-configuration).

При отработке отказа Site Recovery не создает и не реплицирует группы безопасности сети. Мы рекомендуем создавать необходимые группы безопасности сети в целевом регионе Azure перед запуском отработки отказа. После этого вы можете связать группы безопасности сети с виртуальными машинами для отработки отказа автоматически, используя сценарии автоматизации с мощными [планами восстановления](site-recovery-create-recovery-plans.md)Site Recovery.

С учетом [примера сценария](concepts-network-security-group-with-site-recovery.md#using-network-security-groups), описанного выше, обратите внимание на следующее:
-    Site Recovery может создавать реплики **виртуальной сети Contoso** и **подсети Contoso** в целевом регионе Azure, если включена репликация для виртуальной машины.
-    Вы можете создавать требуемые реплики **NSG подсети** и **NSG виртуальной машины** (с именем, например, **целевая NSG подсети** и **целевая NSG виртуальной машины**, соответственно) в целевом регионе Azure, разрешая применение любых дополнительных правил, необходимых в целевом регионе.
-    Затем **целевую NSG подсети** можно связать непосредственно с целевой подсетью региона, так как NSG и подсеть уже доступны.
-    **Целевую NSG виртуальной машины** можно связать с виртуальными машинами во время отработки отказа с использованием планов восстановления.

После создания и настройки групп безопасности сети мы рекомендуем выполнить [тестовую отработку отказа](azure-to-azure-tutorial-dr-drill.md) для проверки сценариев связи NSG и подключение виртуальной машины после отработки отказа.

## <a name="next-steps"></a>Дальнейшие действия
-    Узнайте больше о [группах безопасности сети](../virtual-network/network-security-groups-overview.md#network-security-groups).
-    Дополнительные сведения о [правилах безопасности](../virtual-network/network-security-groups-overview.md#security-rules) NSG.
-    Дополнительные сведения об [эффективных правилах безопасности](../virtual-network/diagnose-network-traffic-filter-problem.md) для NSG.
-    См. сведения в статье [Создание плана восстановления с помощью Site Recovery](site-recovery-create-recovery-plans.md).