---
title: Учебник по выполнению отработки отказа виртуальных машин Azure в дополнительный регион в случае аварийного восстановления с помощью Azure Site Recovery.
description: Из этого учебника вы узнаете, как выполнять отработку отказа и повторное включение защиты виртуальных машин Azure, реплицированных в дополнительный регион Azure, в случае аварийного восстановления с помощью службы Azure Site Recovery.
ms.topic: tutorial
ms.date: 11/05/2020
ms.custom: mvc
ms.openlocfilehash: 99263c83d25542073d63c1cba394a147bd5b2170
ms.sourcegitcommit: 867cb1b7a1f3a1f0b427282c648d411d0ca4f81f
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "93392866"
---
# <a name="tutorial-fail-over-azure-vms-to-a-secondary-region"></a>Руководство по отработке отказа виртуальных машин Azure в дополнительный регион

В этом учебнике описано, как выполнить отработку отказа виртуальной машины Azure в дополнительный регион Azure в случае аварийного восстановления с помощью службы [Azure Site Recovery](site-recovery-overview.md). После выполнения отработки отказа повторно включите защиту виртуальных машин в целевом регионе, чтобы выполнить их репликацию обратно в основной регион. Вы узнаете, как выполнять следующие задачи:

> [!div class="checklist"]
> * Проверка предварительных требований
> * Проверка параметров виртуальной машины.
> * Запуск отработки отказа в дополнительный регион
> * Запуск репликации виртуальной машины обратно в основной регион.


> [!NOTE]
> В этом учебнике показано, как выполнить отработку отказа виртуальных машин с минимальным набором шагов. Если вы хотите выполнить отработку отказа с полным набором параметров, см. статьи о [сети](azure-to-azure-about-networking.md), [автоматизации](azure-to-azure-powershell.md) и [об устранении неполадок](azure-to-azure-troubleshoot-errors.md) виртуальной машины Azure.



## <a name="prerequisites"></a>Обязательные условия

Перед началом работы с данным учебником необходимо выполнить описанные ниже действия.

1. Настройте репликацию для одной или нескольких виртуальных машин Azure. Если вы этого не сделали, [ознакомьтесь с первым учебником](azure-to-azure-tutorial-enable-replication.md) из этой серии.
2. Рекомендуем [выполнить пробное аварийное восстановление](azure-to-azure-tutorial-dr-drill.md) для реплицированных виртуальных машин. Запуск пробной отработки перед выполнением полной отработки отказа позволяет убедиться, что все работает правильно, без воздействия на рабочую среду. 


## <a name="verify-the-vm-settings"></a>Проверка параметров виртуальной машины

1. В хранилище выберите **Реплицированные элементы** и выберите виртуальную машину.

    ![Параметр открытия свойств виртуальной машины на странице обзора](./media/azure-to-azure-tutorial-failover-failback/vm-settings.png)

2. На странице **Обзор** виртуальной машины убедитесь, что виртуальная машина защищена и работоспособна, прежде чем запускать отработку отказа.
    ![Страница проверки свойств и состояния виртуальной машины](./media/azure-to-azure-tutorial-failover-failback/vm-state.png)

3. Перед выполнением отработки отказа проверьте следующее:
    - Виртуальная машина работает под управлением поддерживаемой ОС [Windows](azure-to-azure-support-matrix.md#windows) или [Linux](azure-to-azure-support-matrix.md#replicated-machines---linux-file-systemguest-storage).
    - Виртуальная машина соответствует требованиям к [вычислительным ресурсам](azure-to-azure-support-matrix.md#replicated-machines---compute-settings), [хранилищу](azure-to-azure-support-matrix.md#replicated-machines---storage) и [сети](azure-to-azure-support-matrix.md#replicated-machines---networking).

## <a name="run-a-failover"></a>Запуск отработки отказа


1. На странице **Обзор** виртуальной машины нажмите кнопку **Отработка отказа**.

    ![Кнопка "Отработка отказа" для реплицированного элемента](./media/azure-to-azure-tutorial-failover-failback/failover-button.png)

3. В разделе **Отработка отказа** выберите точку восстановления. Виртуальная машина Azure в целевом регионе создается с использованием данных из этой точки восстановления.
  
   - **Последняя обработанная**. Используется последняя точка восстановления, обработанная Site Recovery. Для нее отображается метка времени. Этот вариант не требует времени на обработку данных, обеспечивая низкий показатель целевого времени восстановления (RTO).
   -  **Latest**: обрабатываются все данные, отправленные в службу Site Recovery, чтобы создать точку восстановления для каждой виртуальной машины, прежде чем выполнять в нее отработку отказа. Этот вариант обеспечивает самое низкое значение целевой точки восстановления (RPO), так как все данные реплицированы в службу Site Recovery до момента активации отработки отказа.
   - **Последняя с согласованием приложений**. Отработка отказа виртуальных машин выполняется до последней точки восстановления с согласованным состоянием приложений. Для нее отображается метка времени.
   - **Пользовательский**. Отработка отказа выполняется до определенной точки восстановления. Пользовательский параметр доступен только при отработке отказа на одной виртуальной машине без использования плана восстановления.

    > [!NOTE]
    > Если вы добавили диск к виртуальной машине после включения репликации, точки репликации показывают диски, которые можно восстановить. Например, точка репликации, созданная перед добавлением второго диска, будет отображаться как "1 из 2 дисков".

4. Выберите **Shut down machine before beginning failover** (Завершение работы виртуальной машины перед началом отработки отказа), чтобы служба Site Recovery попыталась выключить исходные виртуальные машины, прежде чем запускать отработку отказа. Завершение работы помогает предотвратить потерю данных. Отработка отказа продолжится, даже если их не удастся отключить. 

    ![Страница параметров отработки отказа](./media/azure-to-azure-tutorial-failover-failback/failover-settings.png)    

3. Нажмите кнопку **ОК**, чтобы начать отработку отказа.
4. Отслеживайте отработку отказа в разделе уведомлений.

    ![Уведомление о ходе выполнения](./media/azure-to-azure-tutorial-failover-failback/notification-failover-start.png) ![Уведомления об успешном выполнении](./media/azure-to-azure-tutorial-failover-failback/notification-failover-finish.png)     

5. После завершения отработки отказа виртуальная машина Azure, созданная в целевом регионе, появится в разделе **Виртуальные машины**. Убедитесь, что виртуальная машина работает и имеет соответствующий размер. Если вы хотите использовать другую точку восстановления для виртуальной машины, на странице **Основные компоненты** выберите параметр **Изменить точку восстановления**.
6. Когда вы будете удовлетворены результатами отработки отказа виртуальной машины, нажмите кнопку **Зафиксировать** на странице обзора, чтобы завершить отработку отказа.

    ![Кнопка "Зафиксировать"](./media/azure-to-azure-tutorial-failover-failback/commit-button.png) 

7. В разделе **Зафиксировать** нажмите кнопку **ОК** для подтверждения. Будут удалены все доступные точки восстановления для виртуальной машины в Site Recovery, и вы не сможете изменить точку восстановления.

8. Ход выполнения фиксации можно отслеживать в разделе уведомлений.

    ![Уведомление о ходе выполнения фиксации](./media/azure-to-azure-tutorial-failover-failback/notification-commit-start.png) ![Уведомление об успешном завершении фиксации](./media/azure-to-azure-tutorial-failover-failback/notification-commit-finish.png)    

9. Служба Site Recovery не поддерживает очистку исходной виртуальной машины после отработки отказа. Это необходимо выполнить вручную.


## <a name="reprotect-the-vm"></a>Повторное включение защиты виртуальной машины

После выполнения отработки отказа повторно включите защиту виртуальной машины в дополнительном регионе, чтобы она реплицировалась обратно в основной регион. 

1. Прежде чем начать, убедитесь, что виртуальная машина находится в **состоянии** *Отработка отказа применена*.
2. Проверьте, доступен ли основной регион и есть ли у вас разрешения, чтобы создавать в нем виртуальные машины.
3. На странице **Обзор** виртуальной машины нажмите кнопку **Защитить повторно**.

   ![Кнопка для включения повторной защиты виртуальной машины.](./media/azure-to-azure-tutorial-failover-failback/reprotect-button.png)

4. В разделе **Защитить повторно** убедитесь, что выбрано правильное направление репликации (из дополнительного в основной регион), и просмотрите целевые параметры основного региона. Ресурсы, помеченные как новые, создаются Site Recovery во время повторного включения защиты.

     ![Страница параметров повторного включения защиты](./media/azure-to-azure-tutorial-failover-failback/reprotect.png)

6. Нажмите кнопку **ОК**, чтобы начать процесс повторного включения защиты. При этом исходные данные будут отправлены в целевое расположение, а разностные данные для виртуальных машин будут реплицированы в целевой регион.
7. Ход выполнения повторного включения защиты можно отслеживать в разделе уведомлений. 

    ![Уведомление о ходе выполнения повторного включения защиты](./media/azure-to-azure-tutorial-failover-failback/notification-reprotect-start.png) ![Уведомление об успешном завершении повторного включения защиты](./media/azure-to-azure-tutorial-failover-failback/notification-reprotect-finish.png)
    

## <a name="next-steps"></a>Дальнейшие действия

Из этого учебника вы узнали, как выполнять отработку отказа из основного региона в дополнительный и запускать репликацию виртуальных машин обратно в основной регион. Теперь можно восстановить размещение из дополнительного региона в основной.

> [!div class="nextstepaction"]
> [Восстановление размещения в основном регионе](azure-to-azure-tutorial-failback.md)
