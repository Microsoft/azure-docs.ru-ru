---
title: Аварийное восстановление VMware с Azure Site Recovery
description: В этой статье приведены общие сведения об аварийном восстановлении виртуальных машин VMware в Azure с помощью службы Azure Site Recovery.
author: rayne-wiselman
ms.service: site-recovery
ms.topic: conceptual
ms.date: 11/12/2019
ms.author: raynew
ms.openlocfilehash: dfbdff01064b483085233ece47d1d3b635b68743
ms.sourcegitcommit: 772eb9c6684dd4864e0ba507945a83e48b8c16f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "87021466"
---
# <a name="about-disaster-recovery-of-vmware-vms-to-azure"></a>Сведения об аварийном восстановлении виртуальных машин VMware в Azure

В этой статье приведены общие сведения об аварийном восстановлении локальных виртуальных машин VMware в Azure с помощью службы [Azure Site Recovery](site-recovery-overview.md).

## <a name="what-is-bcdr"></a>Что такое BCDR?

Стратегия непрерывности бизнес-процессов и аварийного восстановления (BCDR) помогает поддерживать бизнес-операции. Во время запланированных и непредвиденных простоев BCDR обеспечивает безопасность и доступность данных, а также гарантирует непрерывную работу приложений. Помимо возможностей платформы BCDR, таких как региональные пары и высокодоступное хранилище, Azure предоставляет Службы восстановления как неотъемлемую часть решения BCDR. К Службам восстановления можно отнести: 

- [Azure Backup](../backup/backup-overview.md) позволяет создавать резервные копии локальных данных и данных виртуальной машины Azure. Вы можете выполнять архивацию файлов и папок, конкретных рабочих нагрузок или всей виртуальной машины. 
- [Azure Site Recovery](site-recovery-overview.md) обеспечивает устойчивость и аварийное восстановление для приложений и рабочих нагрузок, выполняющихся на локальных компьютерах или виртуальных машинах IaaS Azure. Site Recovery управляет репликацией и выполняет отработку отказа в Azure при возникновении сбоев. Эта служба также выполняет восстановление из Azure на основной сайт. 

> [!NOTE]
> Site Recovery не будет перемещать или хранить данные клиента из целевого региона, в котором было настроено аварийное восстановление для исходных компьютеров. Клиенты могут выбрать хранилище служб восстановления из другого региона, если это необходимо. Хранилище служб восстановления содержит метаданные, но не имеет фактических данных клиента.

## <a name="how-does-site-recovery-do-disaster-recovery"></a>Каким образом служба Site Recovery выполняет аварийное восстановление?

1. После подготовки Azure и локального сайта настройте и включите репликацию для локальных компьютеров.
2. Site Recovery управляет начальной репликацией компьютера в соответствии с параметрами политики.
3. После завершения начальной репликации начинается репликация разностных изменений в Azure. 
4. При ожидаемом ходе репликации запустите тестовое аварийное восстановление.
    - Оно позволяет убедиться, что отработка отказа будет работать корректно в случае реальной необходимости.
    - Тестовая отработка отказа выполняется без воздействия на рабочую среду.
5. В случае простоя можно выполнить отработку отказа в Azure. Вы можете выполнить отработку отказа одного компьютера или создать план восстановления для выполнения отработки отказа нескольких компьютеров одновременно.
6. При отработке отказа виртуальные машины Azure создаются из данных виртуальной машины на управляемых дисках или в учетных записях хранения. Пользователи по-прежнему могут получать доступ к приложениям и рабочим нагрузкам из виртуальной машины Azure.
7. Когда локальный сайт снова станет доступным, вы сможете выполнить восстановление размещения из Azure.
8. Когда размещение будет восстановлено, снова работая с основного сайта, запустите репликацию локальных виртуальных машин в Azure еще раз.


## <a name="how-do-i-know-if-my-environment-is-suitable-for-disaster-recovery-to-azure"></a>Как узнать, подходит ли моя среда для аварийного восстановления в Azure?

Служба Site Recovery может реплицировать любую рабочую нагрузку, выполняющуюся на поддерживаемой виртуальной машине VMware или физическом сервере. Ниже приведены аспекты, которые необходимо проверить в вашей среде.

- Используете ли вы необходимые версии серверов виртуализации VMware при выполнении репликации виртуальных машин VMware? [Установите здесь](vmware-physical-azure-support-matrix.md#on-premises-virtualization-servers).
- Реплицируете ли вы компьютеры с поддерживаемой операционной системой? [Установите здесь](vmware-physical-azure-support-matrix.md#replicated-machines).
- Для аварийного восстановления Linux. Работают ли компьютеры с использованием поддерживаемых файловой системы и гостевого хранилища? [Установите здесь](vmware-physical-azure-support-matrix.md#linux-file-systemsguest-storage)
- Соответствуют ли реплицируемые компьютеры требованиям Azure? [Установите здесь](vmware-physical-azure-support-matrix.md#azure-vm-requirements).
- Поддерживается ли конфигурация вашей сети? [Установите здесь](vmware-physical-azure-support-matrix.md#network).
- Поддерживается ли конфигурация вашего хранилища? [Установите здесь](vmware-physical-azure-support-matrix.md#storage).


## <a name="what-do-i-need-to-set-up-in-azure-before-i-start"></a>Что нужно настроить в Azure перед началом работы?

В Azure необходимо подготовить следующее:

1. Убедитесь, что ваша учетная запись Azure предоставляет разрешения на создание виртуальных машин в Azure.
2. Создайте сеть Azure, к которой будут присоединяться виртуальные машины Azure при их создании из учетных записей хранения или управляемых дисков после отработки отказа.
3. Настройте хранилище Служб восстановления для Site Recovery. Хранилище находится на портале Azure и используется для развертывания, настройки, управления, мониторинга и устранения неполадок развертывания Site Recovery.

*Требуется дополнительная помощь?*

Узнайте, как настроить Azure, [проверив учетную запись](tutorial-prepare-azure.md#verify-account-permissions), создав [сеть](tutorial-prepare-azure.md#set-up-an-azure-network)и [настроив хранилище](tutorial-prepare-azure.md#create-a-recovery-services-vault).



## <a name="what-do-i-need-to-set-up-on-premises-before-i-start"></a>Какие настройки локальной среды необходимы перед началом работы?

В локальной среде сделайте следующее:

1. Настройте несколько учетных записей.

    - Если вы выполняете репликацию виртуальных машин VMware, для получения доступа к vCenter Server или узлам vSphere ESXi и автоматического обнаружения виртуальных машин службе Site Recovery необходима учетная запись.
    - Учетная запись требуется для установки агента службы Mobility Site Recovery на каждом физическом компьютере или виртуальной машине, которые требуется реплицировать.

2. Если вы не сделали это ранее, проверьте совместимость инфраструктуры VMware.
3. Убедитесь, что вы можете подключиться к виртуальным машинам Azure после отработки отказа. Настройте RDP на локальных компьютерах Windows или SSH на компьютерах Linux.

*Требуется дополнительная помощь?*
- Подготовьте учетную запись для [автоматического обнаружения](vmware-azure-tutorial-prepare-on-premises.md#prepare-an-account-for-automatic-discovery) и [установки службы Mobility](vmware-azure-tutorial-prepare-on-premises.md#prepare-an-account-for-mobility-service-installation).
- [Проверьте](vmware-azure-tutorial-prepare-on-premises.md#check-vmware-requirements) совместимость параметров VMware.
- [Подготовьтесь](vmware-azure-tutorial-prepare-on-premises.md#prepare-to-connect-to-azure-vms-after-failover), чтобы обеспечить возможность подключения после отработки отказа в Azure.
- Для получения подробной информации о настройке IP-адресов для виртуальных машин Azure после отработки отказа [ознакомьтесь с этой статьей](concepts-on-premises-to-azure-networking.md).

## <a name="how-do-i-set-up-disaster-recovery"></a>Как настроить аварийное восстановление?

После подготовки Azure и локальной инфраструктуры можно настроить аварийное восстановление.

1. Сведения о компонентах, необходимых для развертывания, см. в статьях [Архитектура репликации из VMware в Azure](vmware-azure-architecture.md) и [Архитектура для репликации физического сервера в Azure](physical-azure-architecture.md). Существует ряд компонентов, поэтому очень важно понять, как они взаимодействуют.
2. **Исходная среда**. Для начала развертывания настройте исходную среду репликации. Укажите целевые объекты и место назначения для репликации.
3. **Сервер конфигурации**. Необходимо настроить сервер конфигурации в исходной локальной среде:
    - Сервер конфигурации — отдельный локальный компьютер. Для аварийного восстановления VMware этот сервер рекомендуется развернуть как виртуальную машину VMware, которую можно развернуть с помощью скачанного шаблона в формате OVF.
    - Сервер конфигурации используется для управления обменом данными между локальной средой и Azure.
    - Несколько других компонентов выполняются на компьютере сервера конфигурации.
        - Сервер обработки получает, оптимизирует и отправляет данные репликации в учетную запись хранения кэша в Azure. Этот сервер также используется для автоматической установки службы Mobility на компьютеры, которые требуется реплицировать, а также для выполнения автоматического обнаружения виртуальных машин на серверах VMware.
        - Главный целевой сервер обрабатывает данные репликации при восстановлении размещения с переносом из Azure.
    - Настройка включает в себя регистрацию сервера конфигурации в хранилище, загрузку MySQL Server и VMware PowerCLI и указание учетных записей для автоматического обнаружения и установки службы Mobility.
4. **Целевая среда**. вы настраиваете целевую среду Azure, указав параметры подписки Azure и сети.
5. **Политика репликации**. Укажите, как должна выполняться репликация. К числу этих параметров относится то, как часто нужно создавать и хранить точки восстановления и следует ли создавать моментальные снимки с согласованием приложений.
6. **Включите репликацию**. Включите репликацию для локальных компьютеров. Если вы создали учетную запись для установки службы Mobility, то установка начнется при запуске репликации для компьютера. 

*Требуется дополнительная помощь?*

- Краткое пошаговое руководство приведено в [руководстве по VMware](vmware-azure-tutorial.md) и статье [Настройка аварийного восстановления в Azure для локальных физических серверов](physical-azure-disaster-recovery.md).
- [Дополнительные сведения](vmware-azure-set-up-source.md) о настройке исходной среды.
- [Дополнительные сведения о](vmware-azure-deploy-configuration-server.md) требованиях к серверу конфигурации и настройке этого сервера с помощью шаблона OVF для репликации VMware. Если по какой-то причине вы не можете использовать шаблон или реплицируете физические серверы, [используйте эти инструкции](physical-azure-set-up-source.md#set-up-the-source-environment).
- Дополнительные сведения о целевых параметрах см. [здесь](vmware-azure-set-up-target.md).
- [Дополнительные сведения](vmware-azure-set-up-replication.md) о настройке политики репликации.
- [Узнайте](vmware-azure-enable-replication.md), как включить репликацию и [исключить](vmware-azure-exclude-disk.md) диски из репликации.


## <a name="something-went-wrong-how-do-i-troubleshoot"></a>Что-то пошло не так, как устранить неполадку?

- Для начала попробуйте [выполнить мониторинг развертывания](site-recovery-monitor-and-troubleshoot.md), чтобы проверить состояние реплицированных элементов, задания и проблемы с инфраструктурой и обнаружить возможные ошибки.
- Если вам не удается завершить начальную репликацию или текущая репликация не работает должным образом, [ознакомьтесь с этой статьей](vmware-azure-troubleshoot-replication.md), содержащей сведения о распространенных ошибках и советы по устранению неполадок.
- Если у вас возникают проблемы с автоматической установкой службы Mobility на компьютерах, которые требуется реплицировать, просмотрите описание ошибок, приведенное [в этой статье](vmware-azure-troubleshoot-push-install.md).
- Если отработка отказа не работает должным образом, проверьте распространенные ошибки [в этой статье](site-recovery-failover-to-azure-troubleshoot.md).
- Если восстановление размещения не работает, проверьте, описана ли ваша проблема [в этой статье](vmware-azure-troubleshoot-failback-reprotect.md).



## <a name="next-steps"></a>Дальнейшие действия

После выполнения репликации следует [запустить тестовое аварийное восстановление](tutorial-dr-drill-azure.md), чтобы убедиться, что отработка отказа работает правильно. 
