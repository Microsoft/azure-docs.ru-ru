---
title: О планах восстановления в Azure Site Recovery
description: Узнайте о планах восстановления в Azure Site Recovery.
ms.topic: conceptual
ms.date: 01/23/2020
ms.openlocfilehash: 8d191781cacc37242dd1be31d6cb87ef196e5e7a
ms.sourcegitcommit: 772eb9c6684dd4864e0ba507945a83e48b8c16f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "84343920"
---
# <a name="about-recovery-plans"></a>Сведения о планах восстановления

В этой статье приводятся общие сведения о планах восстановления в [Azure Site Recovery](site-recovery-overview.md).

План восстановления собирает компьютеры в группы восстановления с целью отработки отказа. План восстановления помогает определить систематический процесс восстановления путем создания небольших независимых модулей, для которых можно выполнять отработку отказа. Как правило, модуль представляет приложение в вашей среде.

- План восстановления определяет, как выполняется отработка отказа компьютеров, а также последовательность их запуска после этого.
- Планы восстановления можно использовать как для отработки отказа, так и для восстановления размещения из Azure.
- К одному плану восстановления можно добавить до 100 защищенных экземпляров.
- План можно настроить, добавив в него порядок, инструкции и задачи.
- После определения плана с помощью можно выполнить отработку отказа.
- На компьютеры можно ссылаться в нескольких планах восстановления, в которых последующие планы пропускают развертывание и запуск компьютера, если он был ранее развернут с помощью другого плана восстановления.



### <a name="why-use-a-recovery-plan"></a>Для чего используется план восстановления?

Планы восстановления используются для следующего:

* Моделирование приложения с точки зрения его зависимостей.
* Автоматизируйте задачи восстановления, чтобы сократить целевое время восстановления (RTO).
* Проверка готовности к миграции или аварийному восстановлению путем добавления приложений в план восстановления.
* Запустите тестовую отработку отказа в планах восстановления, чтобы обеспечить нормальную работу аварийного восстановления или миграции.


## <a name="model-apps"></a>Моделирование приложений 
Можно запланировать и создать группу восстановления для записи свойств приложений. Например, рассмотрим типичное трехуровневое приложение, содержащее серверную часть SQL Server, ПО промежуточного слоя и веб-интерфейс. Как правило, план восстановления настраивается таким образом, чтобы после отработки отказа компьютеры на каждом уровне запускались в правильном порядке.

- Сначала должна быть запущена серверная часть SQL, затем — ПО промежуточного слоя и, наконец, веб-интерфейс.
- Этот порядок запуска гарантирует, что к моменту запуска последнего компьютера приложение будет работать.
- Этот порядок гарантирует, что когда ПО промежуточного слоя запустится и попытается подключиться к уровню SQL Server, этот уровень уже будет работать. 
- Данный порядок запуска также гарантирует, что интерфейсный сервер запустится в последнюю очередь и пользователи не подключатся к URL-адресу приложения, пока все компоненты не будут запущены, а приложение — готово к приему запросов.

Чтобы создать этот порядок, добавьте группы в группу восстановления и добавьте компьютеры в эти группы.
- Если порядок задан, используется последовательная обработка. Действия выполняются в параллельном режиме для улучшения RTO восстановления приложения.
- Отработка отказа компьютеров, которые входят в одну группу, выполняется в параллельном режиме.
- Отработка отказа компьютеров в разных группах выполняется в порядке групп. Это значит, что отработка отказа компьютеров в группе 2 начинается только после завершения отработки отказа и запуска всех компьютеров в группе 1.

    ![Пример плана восстановления](./media/recovery-plan-overview/rp.png)

При внесении приведенных изменений в параметры при выполнении отработки отказа для плана восстановления происходит следующее. 

1. Сначала выполняется шаг завершения работы, на котором осуществляется попытка отключить локальные компьютеры. Исключением является тестовая отработка отказа. В этом случае основной сайт продолжает работать. 
2. Завершение работы инициирует параллельную отработку отказа всех виртуальных машин в плане восстановления.
3. При отработке отказа с помощью реплицированных данных подготавливаются диски виртуальных машин.
4. В указанном порядке выполняются группы запуска и запускаются виртуальные машины в каждой группе. Сначала запускается группа 1, затем группа 2 и, наконец, группа 3. Если в какой-либо группе имеется более одного компьютера, то все они запускаются параллельно.


## <a name="automate-tasks-in-recovery-plans"></a>Автоматизация задач в планах восстановления

Восстановление больших приложений может быть сложной задачей. Выполнение действий вручную подвергают процесс ошибкам, и пользователь, выполняющий отработку отказа, может быть не осведомлен обо всех особенностях приложений. Можно использовать план восстановления для упорядочения и автоматизации действий, необходимых на каждом шаге, применяя модули runbook службы автоматизации Azure для отработки отказа в Azure. Можно также использовать сценарии. Для выполнения задач, которые невозможно автоматизировать, планы восстановления обеспечивают возможность вставки пауз для действий, выполняемых вручную. Существует несколько типов задач, которые можно настроить.

* **Задачи, выполняемые с виртуальной машиной Azure после отработки отказа**. При отработке отказа в Azure обычно требуется выполнить соответствующие действия, чтобы иметь возможность подключиться к виртуальной машине после отработки отказа. Пример: 
    * создание общедоступного IP-адреса для виртуальной машины Azure;
    * назначение группы безопасности сети сетевому адаптеру виртуальной машины Azure;
    * добавление подсистемы балансировки нагрузки в группу доступности.
* **Задачи в виртуальной машине после отработки отказа**. Как правило, они необходимы для перенастройки приложения, выполняемого на виртуальной машине, таким образом, чтобы оно работало в новой среде. Пример:
    * изменение строки подключения к базе данных в компьютере;
    * изменение конфигурации или правил веб-сервера.


### <a name="run-a-test-failover-on-recovery-plans"></a>Запуск тестовой отработки отказа в планах восстановления

План восстановления можно использовать для активации тестовой отработки отказа. Используйте приведенные ниже рекомендации.

- Всегда выполняйте тестовую отработку отказа для приложения, прежде чем выполнять полную отработку отказа. Тестовая отработка отказа помогает проверить, запустится ли приложение на сайте восстановления.
- Если вы нашли что-нибудь, активируйте очистку, а затем повторно запустите тестовую отработку отказа. 
- Несколько раз выполните тестовую отработку отказа, пока не будете уверены в надежном восстановлении приложения.
- Так как все приложения уникальны, необходимо создать планы восстановления, подходящие для каждого из них, и выполнить тестовую отработку отказа для этих планов.
- Приложения и их зависимости часто изменяются. Чтобы обеспечить актуальность планов восстановления, выполните тестовую отработку отказа для каждого приложения каждый квартал.

    ![Снимок экрана примера тестового плана восстановления в Site Recovery](./media/recovery-plan-overview/rptest.png)

## <a name="watch-a-recovery-plan-video"></a>Просмотр видео плана восстановления

Просмотрите краткий пример видео, в котором показана отработка отказа по щелчку для плана восстановления для двухуровневой WordPress приложения.
    
> [!VIDEO https://channel9.msdn.com/Series/Azure-Site-Recovery/One-click-failover-of-a-2-tier-WordPress-application-using-Azure-Site-Recovery/player]



## <a name="next-steps"></a>Дальнейшие действия

- [Создайте](site-recovery-create-recovery-plans.md) план восстановления.
- [Выполнение](site-recovery-failover.md) отработки отказа. 
