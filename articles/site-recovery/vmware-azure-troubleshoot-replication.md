---
title: Устранение неполадок репликации при аварийном восстановлении виртуальных машин VMware и физических серверов в Azure с помощью Azure Site Recovery | Документация Майкрософт
description: В этой статье описано, как устранять распространенные неполадки репликации при аварийном восстановлении физических серверов и виртуальных машин VMware в Azure с помощью Azure Site Recovery.
author: mayurigupta13
manager: rochakm
ms.service: site-recovery
ms.topic: article
ms.date: 08/2/2019
ms.author: mayg
ms.openlocfilehash: 8b44a1d6119cc658b9460e0a52fa0629f759964a
ms.sourcegitcommit: 772eb9c6684dd4864e0ba507945a83e48b8c16f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "91336211"
---
# <a name="troubleshoot-replication-issues-for-vmware-vms-and-physical-servers"></a>Устранение неполадок с репликацией виртуальных машин VMware и физических серверов

В этой статье описаны распространенные неполадки и конкретные ошибки, которые могут возникнуть при репликации локальных физических серверов и виртуальных машин VMware в Azure с помощью [Azure Site Recovery](site-recovery-overview.md).

## <a name="step-1-monitor-process-server-health"></a>Шаг 1. Мониторинг работоспособности сервера обработки

Site Recovery использует [сервер обработки](vmware-physical-azure-config-process-server-overview.md#process-server), чтобы получать, оптимизировать реплицированные данные и отправлять их в Azure.

Мы рекомендуем отслеживать работоспособность серверов обработки на портале, чтобы контролировать их подключение и правильность работы, а также выполнение репликации для исходных компьютеров, связанных с сервером обработки.

- См. дополнительные сведения о [мониторинге серверов обработки](vmware-physical-azure-monitor-process-server.md).
- [Анализ рекомендаций](vmware-physical-azure-troubleshoot-process-server.md#best-practices-for-process-server-deployment)
- [Устранение неполадок с серверами обработки.](vmware-physical-azure-troubleshoot-process-server.md#check-process-server-health).

## <a name="step-2-troubleshoot-connectivity-and-replication-issues"></a>Шаг 2. Устранение неполадок с подключением и репликацией

Ошибки начальной и текущей репликации часто вызваны проблемами с подключением между исходным сервером и сервером обработки или между сервером обработки и Azure.

Чтобы решить эти проблемы, выполните [устранение неполадок с подключением и репликацией](vmware-physical-azure-troubleshoot-process-server.md#check-connectivity-and-replication).




## <a name="step-3-troubleshoot-source-machines-that-arent-available-for-replication"></a>Шаг 3. Устранение неполадок на исходных компьютерах, на которых не выполняется репликация

При попытке выбрать исходную машину для включения репликации с помощью Azure Site Recovery она может быть недоступна по одной из следующих причин.

* **Две виртуальные машины с одинаковыми UUID экземпляра**. Если на сервере vCenter есть две виртуальные машины с одинаковым значением UUID экземпляра, на портале Azure отображается первая виртуальная машина, обнаруженная сервером конфигурации. Для устранения этой проблемы убедитесь, что виртуальным машинам назначены уникальные UUID экземпляра. Этот сценарий типичен в ситуациях, когда виртуальная машина резервного копирования становится активной и сведения о ней попадают в записи об обнаружении. Чтобы устранить эту проблему, ознакомьтесь со статьей [ASR VMware-to-Azure: How To cleanup duplicate/stale entries](https://social.technet.microsoft.com/wiki/contents/articles/32026.asr-vmware-to-azure-how-to-cleanup-duplicatestale-entries.aspx) (Репликация VMware в Azure с помощью ASR: как удалить повторяющиеся или устаревшие записи).
* **Неверные учетные данные пользователя vCenter**. Убедитесь, что вы добавили правильные учетные данные vCenter во время настройки конфигурации с помощью шаблона OVF или процедуры единой настройки. Чтобы проверить учетные данные, добавленные во время установки, обратитесь к разделу [Изменение учетных данных для автоматического обнаружения](vmware-azure-manage-configuration-server.md#modify-credentials-for-automatic-discovery).
* **Недостаточные привилегии vCenter**. Если разрешения, предоставленные для доступа к vCenter, недостаточны, может произойти сбой обнаружения виртуальных машин. Убедитесь, что разрешения, описанные в разделе [Подготовка учетной записи для автоматического обнаружения](vmware-azure-tutorial-prepare-on-premises.md#prepare-an-account-for-automatic-discovery), добавлены в учетную запись пользователя vCenter.
* **Серверы управления Azure Site Recovery**. Если виртуальная машина используется как сервер управления в одной или нескольких из следующих ролей — сервера конфигурации, сервера обработки масштабирования или главного целевого сервера, вы не сможете выбрать виртуальную машину с портала. Серверы управления не могут быть реплицированы.
* **Виртуальная машина уже защищена, или для нее выполнена отработка отказа с помощью служб Azure Site Recovery**. Если виртуальная машина уже защищена или для нее выполнена отработка отказа с помощью Site Recovery, она будет недоступна для включения защиты на портале. Убедитесь, что виртуальная машина, которую вы ищете на портале, не защищена другим пользователем или в рамках другой подписки.
* **vCenter не подключен**. Проверьте, находится ли vCenter в подключенном состоянии. Чтобы проверить, перейдите в "Хранилище Служб восстановления > Инфраструктура Site Recovery > Серверы конфигурации", щелкните соответствующий сервер конфигурации, и справа откроется колонка с подробными сведениями о связанных серверах. Проверьте, подключен ли vCenter. Если он находится в состоянии "Не подключен", устраните проблему и [обновите сервер конфигурации](vmware-azure-manage-configuration-server.md#refresh-configuration-server) на портале. После этого виртуальная машина появится в списке на портале.
* **Узел ESXi отключен**. Если узел ESXi, на котором размещается виртуальная машина, находится в отключенном состоянии, виртуальная машина не будет отображаться или ее нельзя будет выбрать на портале Azure. Включите узел ESXi и [обновите сервер конфигурации](vmware-azure-manage-configuration-server.md#refresh-configuration-server) на портале. После этого виртуальная машина появится в списке на портале.
* **Ожидание перезагрузки**. Если на виртуальной машине ожидается перезагрузка, вы не сможете выбрать ее на портале Azure. Убедитесь, что ожидаемая перезагрузка выполнена, и [обновите сервер конфигурации](vmware-azure-manage-configuration-server.md#refresh-configuration-server). После этого виртуальная машина появится в списке на портале.
* **IP-адрес не найден**. Если с виртуальной машиной не связан допустимый IP-адрес, вы не сможете выбрать ее на портале Azure. Убедитесь, что виртуальной машине назначен допустимый IP-адрес, и [обновите сервер конфигурации](vmware-azure-manage-configuration-server.md#refresh-configuration-server). После этого виртуальная машина появится в списке на портале.

### <a name="troubleshoot-protected-virtual-machines-greyed-out-in-the-portal"></a>Устранение неполадок, когда защищенные виртуальные машины отображаются на портале серым цветом

Виртуальные машины, которые реплицируются Site Recovery, недоступны на портале Azure, если в системе существуют повторяющиеся записи. Чтобы узнать, как удалить устаревшие записи и устранить проблему, обратитесь к статье [ASR VMware-to-Azure: How To cleanup duplicate/stale entries](https://social.technet.microsoft.com/wiki/contents/articles/32026.asr-vmware-to-azure-how-to-cleanup-duplicatestale-entries.aspx) (Репликация VMware в Azure с помощью ASR: как удалить повторяющиеся или устаревшие записи).

## <a name="no-crash-consistent-recovery-point-available-for-the-vm-in-the-last-xxx-minutes"></a>"No crash consistent recovery point available for the VM in the last ХХ minutes" (Для виртуальной машины нет отказоустойчивой точки восстановления за последние ХХ минут).

Ниже перечислены наиболее распространенные проблемы.

### <a name="initial-replication-issues-error-78169"></a>Проблемы с начальной репликацией (ошибка 78169)

Убедившись в отсутствии проблем с подключением, пропускной способностью или синхронизацией времени, как описано выше, проверьте следующее:

- Антивирусная программа не блокирует Azure Site Recovery. [Узнайте больше](vmware-azure-set-up-source.md#azure-site-recovery-folder-exclusions-from-antivirus-program) об исключениях папок, необходимых для Azure Site Recovery.

### <a name="source-machines-with-high-churn-error-78188"></a>Исходные компьютеры с высокой скоростью обработки данных (ошибка 78188)

Возможные причины:
- Скорость изменения данных (записанных байт/с) на перечисленных дисках виртуальной машины превышает [поддерживаемые ограничения Azure Site Recovery](site-recovery-vmware-deployment-planner-analyze-report.md#azure-site-recovery-limits) для выбранного типа учетной записи хранения для целевого объекта репликации.
- Произошел неожиданный рост скорости обработки данных, поэтому большой объем данных ожидает отправки.

Чтобы устранить проблему:
- Убедитесь, что тип целевой учетной записи хранения ("Стандартный" или "Премиум") соответствует требованию к скорости обработки для источника.
- Если вы уже выполняете репликацию на управляемый диск уровня "Премиум" (тип asrseeddisk), убедитесь, что размер диска поддерживает наблюдаемую скорость обработки в соответствии с ограничениями Site Recovery. При необходимости можно увеличить размер диска asrseeddisk. Сделайте следующее:
    - Перейдите в колонку "Диски" для затронутой реплицируемой машины и скопируйте имя диска реплики.
    - Перейдите к управляемому диску этой реплики.
    - В колонке "Обзор" может появиться баннер с сообщением о том, что создан подписанный URL-адрес. Щелкните этот баннер и отмените экспорт. Игнорируйте этот шаг, если баннер не отображается.
    - Как только URL-адрес SAS будет отозван, перейдите в колонку конфигурация управляемого диска и увеличьте размер, чтобы Azure Site Recovery поддерживала отслеживаемую частоту обновлений на исходном диске.
- Если наблюдаемая скорость обработки является временной, просто подождите несколько часов, пока будут переданы ожидающие отправки данные и созданы точки восстановления.
- Если диск не содержит критически важных данных, а только временные журналы, тестовые данные и т. п., попробуйте переместить эти данные в другое расположение или полностью исключите этот диск из репликации.
- Если проблема сохраняется, примените [планировщик развертывания](site-recovery-deployment-planner.md#overview) Site Recovery, чтобы спланировать репликацию.

### <a name="source-machines-with-no-heartbeat-error-78174"></a>Исходные компьютеры не имеют пульса (ошибка 78174)

Такое происходит, когда агент службы "Мобильность" Azure Site Recovery на исходном компьютере не может связаться с сервером конфигурации.

Чтобы устранить эту проблему, выполните следующие действия для проверки возможности подключения к серверу конфигурации с исходной виртуальной машины:

1. Убедитесь, что исходный компьютер запущен.
2. Войдите на исходный компьютер, используя учетную запись с правами администратора.
3. Убедитесь, что следующие службы запущены, и перезапустите их, если потребуется:
   - Svagents (InMage Scout VX Agent);
   - служба приложений InMage Scout;
4. На исходном компьютере изучите журналы, чтобы получить сведения об ошибках:

    *C:\Program Files (x86) \Microsoft Azure site Рековери\ажент\сважентс \* . log*

### <a name="process-server-with-no-heartbeat-error-806"></a>Сервер обработки не имеет пульса (ошибка 806)
Если не поступают сигналы пульса от сервера обработки, проверьте следующее:
1. Виртуальная машина сервера обработки запущена и работает.
2. Проверьте следующие журналы на сервере обработки на предмет следующих ошибок:

    *К:\програмдата\аср\хоме\свсистемс\евентманажер \* . log*\
    перетаскивани
    *К:\програмдата\аср\хоме\свсистемс\ monitor_protection \* . log*

### <a name="master-target-server-with-no-heartbeat-error-78022"></a>Основной целевой сервер не имеет пульса (ошибка 78022)

Такое происходит, когда агент службы "Мобильность" Azure Site Recovery на основном целевом сервере не может связаться с сервером конфигурации.

Чтобы устранить эту проблему, выполните следующие действия по проверке состояния службы:

1. Убедитесь, что главный целевой сервер работает.
2. Войдите на главный целевой сервер, используя учетную запись с правами администратора.
    - Убедитесь, что служба svagents запущена. Если служба работает, перезапустите ее.
    - Проверьте журналы в следующем расположении, чтобы получить сведения об ошибке:

        *C:\Program Files (x86) \Microsoft Azure site Рековери\ажент\сважентс \* . log*
3. Чтобы зарегистрировать главный целевой сервер на сервере конфигурации, перейдите в папку **%PROGRAMDATA%\ASR\Agent** и выполните следующую команду в командной строке:
   ```
   cmd
   cdpcli.exe --registermt

   net stop obengine

   net start obengine

   exit
   ```

## <a name="error-id-78144---no-app-consistent-recovery-point-available-for-the-vm-in-the-last-xxx-minutes"></a>Ошибка 78144: "No crash consistent recovery point available for the VM in the last ХХ minutes" (Для виртуальной машины нет отказоустойчивой точки восстановления за последние ХХ минут).

В агент мобильности версий [9.23](vmware-physical-mobility-service-overview.md#mobility-service-agent-version-923-and-higher) & [9.27](site-recovery-whats-new.md#update-rollup-39) были внесены улучшения для обработки сбоев при установке VSS. Убедитесь, что вы используете последние версии, чтобы получать оптимальные рекомендации по устранению ошибок VSS.

Ниже перечислены наиболее распространенные проблемы.

#### <a name="cause-1-known-issue-in-sql-server-20082008-r2"></a>Причина 1. Известная проблема в SQL Server 2008 и 2008 R2
**Как исправить.** Существует известная ошибка в SQL Server 2008 и 2008 R2. Ознакомьтесь с этой статьей базы знаний: [Агент Azure Site Recovery или другие операции резервного копирования VSS не на основе компонента завершаются с ошибкой на сервере размещения SQL Server 2008 R2](https://support.microsoft.com/help/4504103/non-component-vss-backup-fails-for-server-hosting-sql-server-2008-r2).

#### <a name="cause-2-azure-site-recovery-jobs-fail-on-servers-hosting-any-version-of-sql-server-instances-with-auto_close-dbs"></a>Причина 2. Сбой заданий Azure Site Recovery на серверах, где размещается любая версия экземпляров SQL Server с базами данных AUTO_CLOSE
**Как исправить.** См. [статью базы знаний](https://support.microsoft.com/help/4504104/non-component-vss-backups-such-as-azure-site-recovery-jobs-fail-on-ser).


#### <a name="cause-3-known-issue-in-sql-server-2016-and-2017"></a>Причина 3. Известная проблема в SQL Server 2016 и 2017
**Как исправить.** См. [статью базы знаний](https://support.microsoft.com/help/4493364/fix-error-occurs-when-you-back-up-a-virtual-machine-with-non-component).

#### <a name="cause-4-app-consistency-not-enabled-on-linux-servers"></a>Причина 4. App-Consistency не включена на серверах Linux
**Как исправить** : Azure Site Recovery для операционной системы Linux поддерживает пользовательские сценарии для обеспечения согласованности приложений. Пользовательский скрипт с параметрами pre и POST будет использоваться агентом мобильности Azure Site Recovery для согласованности приложений. [Ниже](./site-recovery-faq.md#replication) приведены действия по его включению.

### <a name="more-causes-due-to-vss-related-issues"></a>Другие причины, связанные с проблемами VSS

Для дальнейшего устранения неполадок проверьте файлы на исходном компьютере, чтобы получить точный код ошибки:

*C:\Program Files (x86) \Microsoft Azure site Рековери\ажент\аппликатион Дата\аппликатионполицилогс\вакп.лог*

Как найти ошибки в файле?
Выполните поиск по строке "vacpError", открыв файл vacp.log в редакторе.

`Ex: `**`vacpError`**`:220#Following disks are in FilteringStopped state [\\.\PHYSICALDRIVE1=5, ]#220|^|224#FAILED: CheckWriterStatus().#2147754994|^|226#FAILED to revoke tags.FAILED: CheckWriterStatus().#2147754994|^|`

В приведенном выше примере найдена ошибка с кодом **2147754994**, информацию о которой вы видите ниже.

#### <a name="vss-writer-is-not-installed---error-2147221164"></a>Модуль записи VSS не установлен — ошибка 2147221164

*Как исправить.* Чтобы создать тег согласованности приложений, Azure Site Recovery использует службу теневого копирования томов (VSS) Майкрософт. Она в свою очередь устанавливает поставщик VSS, чтобы получать моментальные снимки согласованности приложений. Поставщик VSS устанавливается как служба. Если служба поставщика VSS не установлена, создание моментального снимка согласованности приложений завершается ошибкой с ИДЕНТИФИКАТОРом ошибки 0x80040154 "класс не зарегистрирован". </br>
Воспользуйтесь статьей по [устранению неполадок при установке модуля записи VSS](./vmware-azure-troubleshoot-push-install.md#vss-installation-failures).

#### <a name="vss-writer-is-disabled---error-2147943458"></a>Модуль записи VSS отключен — ошибка 2147943458

**Как исправить.** Чтобы создать тег согласованности приложений, Azure Site Recovery использует службу теневого копирования томов (VSS) Майкрософт. Она в свою очередь устанавливает поставщик VSS, чтобы получать моментальные снимки согласованности приложений. Поставщик VSS устанавливается как служба. Если служба поставщика VSS отключена, создание моментального снимка согласованности приложений завершается сбоем с ИДЕНТИФИКАТОРом ошибки "указанная служба отключена и не может быть запущена (0x80070422)". </br>

- Если служба VSS отключена:
    - Убедитесь, что для параметра "Тип запуска" службы поставщика VSS задано значение **Автоматически**.
    - Перезапустите следующие службы:
        - служба VSS;
        - поставщик VSS Azure Site Recovery.
        - служба VDS.

####  <a name="vss-provider-not_registered---error-2147754756"></a>Поставщик VSS не зарегистрирован — ошибка 2147754756

**Как исправить.** Чтобы создать тег согласованности приложений, Azure Site Recovery использует службу теневого копирования томов (VSS) Майкрософт.
Проверьте, установлена ли служба поставщика VSS для Azure Site Recovery. </br>

- Выполните следующие команды для повторной установки поставщика.
- Удалите существующий поставщик: C:\Program Files (x86)\Microsoft Azure Site Recovery\agent\InMageVSSProvider_Uninstall.cmd
- Установите его заново: C:\Program Files (x86)\Microsoft Azure Site Recovery\agent\InMageVSSProvider_Install.cmd

Убедитесь, что для параметра "Тип запуска" службы поставщика VSS задано значение **Автоматически**.
    - Перезапустите следующие службы:
        - служба VSS;
        - поставщик VSS Azure Site Recovery.
        - служба VDS.

## <a name="error-id-95001---insufficient-permissions-found"></a>Идентификатор ошибки 95001-не удалось найти необходимые разрешения

Эта ошибка возникает при попытке включить репликацию, и папки приложения не имеют достаточных разрешений.

**Как исправить**. чтобы устранить эту проблему, убедитесь, что пользователь IUSR имеет роль владельца для всех перечисленных ниже папок.

- *К\програмдата\микрософт Azure site Рековери\привате*
- Каталог установки. Например, если каталогом установки является F Drive, предоставьте правильные разрешения для-
    - *Ф:\програм Files (x86) \Microsoft Azure site Рековери\хоме\свсистемс*
- Папка *\пушинсталлсвк* в каталоге установки. Например, если каталогом установки является диск F, предоставьте правильные разрешения для.
    - *Ф:\програм Files (x86) \Microsoft Azure site Рековери\хоме\свсистемс\пушинсталлсвк*
- Папка *\етк* в каталоге установки. Например, если каталогом установки является диск F, предоставьте правильные разрешения для.
    - *Ф:\програм Files (x86) \Microsoft Azure site Рековери\хоме\свсистемс\етк*
- *C:\Temp*
- *C:\thirdparty\php5nts*
- Все элементы по указанному ниже пути
    - *C:\thirdparty\rrdtool-1.2.15-win32-perl58\rrdtool\Release\**

## <a name="next-steps"></a>Дальнейшие действия

Если вам потребуется дополнительная помощь, опубликуйте свой вопрос на [странице вопросов и ответов по Azure Site Recovery на сайте Майкрософт](/answers/topics/azure-site-recovery.html). У нас активное сообщество, и один из наших инженеров сможет помочь вам.
