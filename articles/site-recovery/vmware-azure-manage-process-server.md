---
title: Управление сервером обработки для виртуальных машин VMware и аварийного восстановления физического сервера в Azure Site Recovery
description: В этой статье описывается управление сервером обработки для аварийного восстановления виртуальных машин VMware или физических серверов с помощью Azure Site Recovery.
author: Rajeswari-Mamilla
manager: rochakm
ms.service: site-recovery
ms.topic: conceptual
ms.date: 04/28/2019
ms.author: ramamill
ms.openlocfilehash: a547a874c42d06d8453b154847561d8b5f0dabb8
ms.sourcegitcommit: 910a1a38711966cb171050db245fc3b22abc8c5f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "96019207"
---
# <a name="manage-process-servers"></a>Управление серверами обработки

В этой статье описаны распространенные задачи по управлению сервером обработки Site Recovery.

Сервер обработки используется для получения, оптимизации и отправки данных репликации в Azure. Она также выполняет принудительную установку службы Mobility Service на виртуальных машинах VMware и физических серверах, которые требуется реплицировать, и выполняет автоматическое обнаружение локальных компьютеров. Для репликации локальных виртуальных машин VMware или физических серверов в Azure сервер обработки устанавливается по умолчанию на компьютере сервера конфигурации. 

- Для больших развертываний могут понадобиться дополнительные серверы обработки в локальной среде, чтобы изменять масштаб емкости.
- Для восстановления размещения из Azure в локальную среду необходимо настроить временный сервер обработки в Azure. Восстановив размещение, вы можете удалить эту виртуальную машину. 

Дополнительные сведения о сервере обработки см. здесь.


## <a name="upgrade-a-process-server"></a>Обновление сервера обработки

При развертывании локального сервера обработки или в качестве виртуальной машины Azure для восстановления размещения устанавливается последняя версия сервера обработки. Команды разработчиков Site Recovery регулярно выпускают исправления и улучшения, и мы рекомендуем вам систематически обновлять свои серверы обработки. Сервер обработки можно обновить следующим образом.

[!INCLUDE [site-recovery-vmware-upgrade -process-server](../../includes/site-recovery-vmware-upgrade-process-server-internal.md)]


## <a name="move-vms-to-balance-the-process-server-load"></a>Перемещение виртуальных машин для балансировки нагрузки сервера обработки

Распределите нагрузку путем перемещения виртуальных машин между двумя серверами обработки следующим образом:

1. В хранилище в разделе **Управление** щелкните **Site Recovery инфраструктура**. В разделе **для виртуальных машин VMware &** щелкните **серверы конфигурации**.
2. Щелкните сервер конфигурации, на котором зарегистрированы серверы обработки.
3. Щелкните сервер обработки, для которого требуется балансировка нагрузки трафика.

    ![На снимке экрана показан сервер обработки, для которого можно распределить нагрузку по трафику.](media/vmware-azure-manage-process-server/LoadBalance.png)

4. Щелкните **Балансировка нагрузки**, выберите целевой сервер обработки, на который требуется переместить компьютеры. Затем нажмите кнопку **ОК** .

    ![На снимке экрана показана панель балансировки нагрузки с выбранным целевым сервером обработки.](media/vmware-azure-manage-process-server/LoadPS.PNG)

2. Щелкните **выбрать компьютеры** и выберите компьютеры, которые требуется переместить с текущего на целевой сервер обработки. Сведения о среднем значении изменения данных отображаются возле каждой виртуальной машины. Нажмите кнопку **ОК**. 
3. В хранилище отслеживайте ход выполнения задания в разделе **наблюдение за**  >  **site Recoveryными заданиями**.

Для отражения изменений на портале потребуется около 15 минут. Для более быстрого вступления в действие [Обновите сервер конфигурации](vmware-azure-manage-configuration-server.md#refresh-configuration-server).

## <a name="switch-an-entire-workload-to-another-process-server"></a>Переключение всей рабочей нагрузки на другой сервер обработки

Переместите всю рабочую нагрузку, обрабатываемую сервером обработки, на другой сервер обработки следующим образом:

1. В хранилище в разделе **Управление** щелкните **Site Recovery инфраструктура**. В разделе **для виртуальных машин VMware &** щелкните **серверы конфигурации**.
2. Щелкните сервер конфигурации, на котором зарегистрированы серверы обработки.
3. Щелкните сервер обработки, с которого необходимо переключить рабочую нагрузку.
4. Щелкните **переключатель**, выберите целевой сервер обработки, на который требуется переместить рабочую нагрузку. Затем нажмите кнопку **ОК** .

    ![На снимке экрана показана область Выбор целевого сервера обработки.](media/vmware-azure-manage-process-server/Switch.PNG)

5. В хранилище отслеживайте ход выполнения задания в разделе **наблюдение за**  >  **site Recoveryными заданиями**.

Для отражения изменений на портале потребуется около 15 минут. Для более быстрого вступления в действие [Обновите сервер конфигурации](vmware-azure-manage-configuration-server.md#refresh-configuration-server).

## <a name="register-a-master-target-server"></a>Регистрация главного целевого сервера

Главный целевой сервер находится на сервере конфигурации и серверах обработки масштабирования. Она должна быть зарегистрирована на сервере конфигурации. В случае сбоя регистрации это может повлиять на работоспособность защищенных элементов. Чтобы зарегистрировать главный целевой сервер на сервере конфигурации, войдите на конкретный сервер конфигурации или сервер обработки масштабирования, на котором требуется регистрация. Перейдите в папку **%ProgramData%\ASR\Agent** и выполните следующую команду в командной строке администратора.

   ```
   cmd
   cdpcli.exe --registermt

   net stop obengine

   net start obengine

   exit
   ```

## <a name="reregister-a-process-server"></a>Повторная регистрация сервера обработки

Повторно зарегистрируйте сервер обработки, работающий локально, или на виртуальной машине Azure с сервером конфигурации следующим образом:

[!INCLUDE [site-recovery-vmware-register-process-server](../../includes/site-recovery-vmware-register-process-server.md)]

Сохранив параметры, сделайте следующее:

1. Откройте командную строку администратора на сервере обработки.
2. Перейдите к папке **%PROGRAMDATA%\ASR\Agent** и выполните эту команду:

    ```
    cdpcli.exe --registermt
    net stop obengine
    net start obengine
    ```

## <a name="modify-proxy-settings-for-an-on-premises-process-server"></a>Изменение параметров прокси-сервера для сервера обработки в локальной среде

Если локальный сервер обработки использует прокси для подключения к Azure, можно изменить параметры прокси-сервера следующим образом.

1. Войдите на компьютер сервера обработки. 
2. Откройте командную строку PowerShell с правами администратора и выполните следующую команду.
   ```powershell
   $pwd = ConvertTo-SecureString -String MyProxyUserPassword
   Set-OBMachineSetting -ProxyServer http://myproxyserver.domain.com -ProxyPort PortNumber –ProxyUserName domain\username -ProxyPassword $pwd
   net stop obengine
   net start obengine
   ```
2. Перейдите к папке **%ProgramData%\ASR\Agent** и выполните следующую команду:
   ```
   cmd
   cdpcli.exe --registermt

   net stop obengine

   net start obengine

   exit
   ```

## <a name="remove-a-process-server"></a>Удаление сервера обработки

[!INCLUDE [site-recovery-vmware-unregister-process-server](../../includes/site-recovery-vmware-unregister-process-server.md)]

## <a name="exclude-folders-from-anti-virus-software"></a>Исключение папок из антивирусного программного обеспечения

Если антивирусная программа запущена на сервере обработки масштабирования (или на главном целевом сервере), исключите следующие папки из операций антивирусной программы:


- C:\Program Files\Microsoft Azure Recovery Services Agent
- C:\ProgramData\ASR.
- C:\ProgramData\ASRLogs.
- C:\ProgramData\ASRSetupLogs.
- C:\ProgramData\LogUploadServiceLogs.
- C:\ProgramData\Microsoft Azure Site Recovery.
- Каталог установки сервера обработки. Например: C:\Program Files (x86) \Microsoft Azure Site Recovery