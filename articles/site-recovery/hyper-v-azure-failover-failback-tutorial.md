---
title: Настройка отработки отказа для виртуальных машин Hyper-V в Azure с помощью Azure Site Recovery
description: Узнайте, как настроить отработку отказа для виртуальных машин Hyper-V в Azure с помощью Azure Site Recovery
author: rayne-wiselman
manager: carmonm
ms.service: site-recovery
ms.topic: tutorial
ms.date: 12/16/2019
ms.author: raynew
ms.custom: MVC
ms.openlocfilehash: b46a2ea12a697afde8223cc3595365c1286512c7
ms.sourcegitcommit: 772eb9c6684dd4864e0ba507945a83e48b8c16f0
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "86132452"
---
# <a name="fail-over-hyper-v-vms-to-azure"></a>Выполнение отработки отказа виртуальных машин Hyper-V в Azure

В этом учебнике рассматривается, как настроить отработку отказа для виртуальных машин Hyper-V в Azure с помощью [Azure Site Recovery](site-recovery-overview.md). Восстановление размещения на локальном сайте после отработки отказа происходит в тех ситуациях, когда это возможно. В этом руководстве описано следующее.

> [!div class="checklist"]
> * Проверка соответствия свойств виртуальной машины Hyper-V требованиям Azure.
> * Отработка отказа для конкретных виртуальных машин в Azure.


Это пятое руководство в серии. В нем предполагается, что вы уже выполнили задачи из предыдущих руководств.    

1. [Подготовка Azure](tutorial-prepare-azure.md)
2. [Подготовка локальных серверов Hyper-V](./hyper-v-prepare-on-premises-tutorial.md)
3. Настройка аварийного восстановления [виртуальных машин Hyper-V](./hyper-v-azure-tutorial.md) или [виртуальных машин Hyper-V, управляемых в облаках VMM System Center](./hyper-v-vmm-azure-tutorial.md).
4. [Выполнение отработки аварийного восстановления](tutorial-dr-drill-azure.md)

[Ознакомьтесь со сведениями](failover-failback-overview.md#types-of-failover) о разных типах отработки отказа. Если вы хотите выполнить отработку отказа нескольких виртуальных машин в плане восстановления, ознакомьтесь с [этой статьей](site-recovery-failover.md).

## <a name="prepare-for-failover"></a>Подготовка к отработке отказа 
Убедитесь, что на виртуальной машине нет моментальных снимков и что при восстановлении размещения локальная виртуальная машина отключена. Так вы обеспечите согласованность данных во время репликации. Не включайте локальную виртуальную машину при восстановлении размещения. 

Отработка отказа и восстановление размещения происходит в три этапа:

1. **Отработка отказа в Azure**. Отработка отказа с переносом виртуальных машин Hyper-V из локального расположения в Azure.
2. **Отработка отказа на локальный сайт.** Отработка отказа виртуальных машин Azure на локальный сайт, если локальный сайт доступен. Запускается синхронизация данных из Azure с локальным сайтом, а после синхронизации виртуальные машины переносятся в локальное расположение.  
3. **Обратная репликация локальных виртуальных машин.** После переноса в локальное расположение включите обратную репликацию локальных виртуальных машин, чтобы начать их репликацию в Azure.

## <a name="verify-vm-properties"></a>Проверка свойств виртуальной машины

Перед отработкой отказа проверьте свойства виртуальной машины и убедитесь, что виртуальная машина соответствует [требованиям Azure](hyper-v-azure-support-matrix.md#replicated-vms).

В разделе **Защищенные элементы** щелкните **Реплицированные элементы** и выберите виртуальную машину.

1. В области **Реплицированный элемент** находятся сводные данные о виртуальной машине, включая состояние работоспособности и последние доступные точки восстановления. Щелкните **Свойства**, чтобы просмотреть дополнительные сведения.

1. В области **Вычисления и сеть** можно изменить имя Azure, группу ресурсов, целевой размер, [группу доступности](../virtual-machines/windows/tutorial-availability-sets.md) и параметры управляемого диска.

1. Можно просмотреть или изменить параметры сети, включая сеть (или подсеть), в которой будет размещаться виртуальная машина Azure после отработки отказа, и IP-адрес, который будет ей назначен.

1. В разделе **Диски** отображаются сведения о дисках операционной системы и дисках данных на виртуальной машине.

## <a name="fail-over-to-azure"></a>Отработка отказа с переходом в Azure

1. В разделе **Параметры** > **Реплицированные элементы** выберите виртуальную машину и щелкните **Отработка отказа**.
2. В разделе **Отработка отказа** выберите **последнюю** точку восстановления. 
3. Выберите **Завершение работы виртуальной машины перед началом отработки отказа**. Site Recovery попытается завершить работу исходных виртуальных машин перед запуском отработки отказа. Отработка отказа продолжится, даже если их не удастся отключить. На странице **Задания** можно следить за ходом выполнения отработки отказа.
4. После проверки **зафиксируйте** отработку отказа. При этом будут удалены все доступные точки восстановления.

> [!WARNING]
> **Не отменяйте выполняющуюся отработку отказа**. Отработка отказа остановится, но виртуальная машина не будет реплицирована повторно.

## <a name="connect-to-failed-over-vm"></a>Подключение к виртуальной машине, на которой выполнялась отработка отказа

1. Если после отработки отказа вы хотите подключиться к виртуальным машинам Azure по протоколу удаленного рабочего стола (RDP) и Secure Shell (SSH), [убедитесь, что выполнены требования](failover-failback-overview.md#connect-to-azure-after-failover).
2. После отработки отказа перейдите к виртуальной машине и проверьте [подключение](../virtual-machines/windows/connect-logon.md) к ней.
3. Используйте параметр **Изменить точку восстановления** при необходимости выбрать другую точку восстановления после отработки отказа. После фиксации отработки отказа на следующем шаге этот параметр будет недоступным.
4. После проверки выберите **Зафиксировать**, чтобы завершить подготовку точки восстановления виртуальной машины после отработки отказа.
5. После этого все остальные доступные точки восстановления будут удалены. На этом шаге отработка отказа будет завершена.

>[!TIP]
> Если после отработки отказа с подключением возникли проблемы, выполните шаги, описанные в руководстве по [устранению неполадок](site-recovery-failover-to-azure-troubleshoot.md).


## <a name="next-steps"></a>Дальнейшие действия

После отработки отказа повторно включите защиту виртуальных машин Azure, чтобы обеспечить их репликацию из Azure в локальную среду. После включения защиты виртуальных машин и репликации их на локальный сайт, выполните восстановление размещения из Azure.
