---
title: Перенос серверов Windows Server 2008 в Azure с помощью службы "Миграция Azure" или Azure Site Recovery
description: В этой статье описан процесс переноса локальных компьютеров Windows Server 2008 в Azure и приводятся рекомендации по использованию Миграции Azure.
author: rayne-wiselman
manager: carmonm
ms.service: site-recovery
ms.topic: tutorial
ms.date: 07/27/2020
ms.author: raynew
ms.custom: MVC
ms.openlocfilehash: 6cc0855d3a4540de780a566a4613b4dbc647cfc5
ms.sourcegitcommit: 910a1a38711966cb171050db245fc3b22abc8c5f
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "92369494"
---
# <a name="migrate-servers-running-windows-server-2008-to-azure"></a>Перенос серверов под управлением Windows Server 2008 в Azure

В этом учебнике показано, как перенести локальные серверы под управлением Windows Server 2008 или Windows Server 2008 R2 на портал Azure с использованием Azure Site Recovery. 

В этом руководстве описано следующее:

> [!div class="checklist"]
> * Подготовка локальной среды к миграции.
> * Настройка целевой среды.
> * Настройка политики репликации.
> * Включите репликацию.
> * Выполнение тестовой миграции, позволяющей убедиться в правильной работе всех компонентов.
> * Отработка отказа в Azure и завершение миграции.

## <a name="migrate-with-azure-migrate"></a>Миграция с помощью службы "Миграция Azure"

Мы рекомендуем перенести компьютеры в Azure с помощью службы [Миграция Azure](../migrate/migrate-services-overview.md). 

- Миграция Azure специально предназначена для переноса серверов.
- Миграция Azure — это центр управления для обнаружения, оценки и переноса локальных компьютеров в Azure. Azure Site Recovery следует использовать только для аварийного восстановления, а не для миграции.
- Миграция Azure поддерживает миграцию серверов под управлением Windows Server 2008.


## <a name="migrate-with-site-recovery"></a>Миграция с помощью Site Recovery

### <a name="supported-operating-systems"></a>Поддерживаемые операционные системы


|Операционная система  | Среда  |
|---------|---------|
|Windows Server 2008 с пакетом обновления 2 (SP2) — 32-разрядная и 64-разрядная версия (IA-32 и x86–64)</br>— Standard</br>— Enterprise</br>— Datacenter   |     Виртуальные машины VMware, виртуальные машины Hyper-V и физические серверы    |
|Windows Server 2008 R2 с пакетом обновления 1 — 64-разрядная версия</br>— Standard</br>— Enterprise</br>— Datacenter     |     Виртуальные машины VMware, виртуальные машины Hyper-V и физические серверы|

> [!WARNING]
> - Перенос серверов под управлением Server Core не поддерживается.
> - Убедитесь, что до миграции был установлен последний пакет обновления и обновления Windows.


### <a name="prerequisites"></a>Предварительные требования

Перед началом работы полезно изучить архитектуру Azure Site Recovery для [миграции серверов VMware и физических серверов](vmware-azure-architecture.md) или [миграции виртуальных машин Hyper-V](hyper-v-azure-architecture.md). 

Чтобы выполнить миграцию виртуальных машин Hyper-V под управлением Windows Server 2008 или Windows Server 2008 R2, выполните действия, описанные в руководстве по [миграции локальных компьютеров в Azure](migrate-tutorial-on-premises-azure.md).

В этом руководстве описано, как можно переносить локальные виртуальные машины VMware и физические серверы под управлением Windows Server 2008 или 2008 R2.
> [!TIP]
> Если вы ищете способ перенести виртуальные машины VMware в Azure, не используя агент, [щелкните здесь](../migrate/tutorial-migrate-vmware.md).


### <a name="limitations-and-known-issues"></a>Ограничения и известные проблемы

- Сервер конфигурации, дополнительные серверы обработки и служба мобильности, которые применяются для миграции серверов Windows Server 2008 с пакетом обновления 2, должны работать под управлением версии 9.19.0.0 программного обеспечения Azure Site Recovery или более поздней.

- Для репликации серверов, работающих под управлением Windows Server 2008 с пакетом обновления 2 (SP2), согласованные с приложением точки восстановления и возможность согласования нескольких виртуальных машин не поддерживаются. Серверы Windows Server 2008 с пакетом обновления 2 (SP2) должны быть перенесены в отказоустойчивую точку восстановления. По умолчанию отказоустойчивые точки восстановления создаются каждые 5 минут. Использование политики репликации с периодичностью создания моментальных снимков с согласованием приложения приведет к тому, что работоспособность репликации станет критической из-за отсутствия согласованных с приложением точек восстановления. Чтобы избежать ложных срабатываний, задайте значение "Выкл." для периодичности создания моментальных снимков с согласованием приложения в политике репликации.

- На перемещаемых серверах должна быть установлена платформа .NET Framework 3.5 с пакетом обновления 1 для работы службы мобильности.

- Если сервер имеет динамические диски, в определенных конфигурациях эти диски на сервере обработки отказа отображаются как внешние диски или помечены как отключенные. Также можно заметить, что состояние зеркальных томов на динамических дисках имеет значение "Отказавшая избыточность". Вы можете устранить эту проблему с помощью diskmgmt.msc, импортировав эти диски вручную и активировав их повторно.

- Перемещаемый сервер должен иметь драйвер vmstorfl.sys. Если драйвер отсутствует на сервере, который переносится, отработка отказа может завершиться ошибкой. 
  > [!TIP]
  >Проверьте, присутствует ли драйвер в папке "C:\Windows\system32\drivers\vmstorfl.sys". Если драйвер не найден, эту проблему можно решить, создав фальшивый файл в папке. 
  >
  > Откройте окно командной строки (выполнить > cmd) и выполните следующую команду: "copy nul c:\Windows\system32\drivers\vmstorfl.sys"

- Возможны проблемы с RDP-подключением к серверам Windows Server 2008 с пакетом обновления 2 (SP2) и 32-разрядной операционной системой сразу после того, как будет выполнена их отработка отказа или тестовая отработка отказа в Azure. Перезапустите виртуальную машину, для которой выполнена отработка отказа, на портале Azure и повторите попытку подключения. Если вам по-прежнему не удается подключиться, проверьте, настроен ли сервер для разрешения подключения к удаленному рабочему столу, и убедитесь, что правила брандмауэра и групп безопасности сети не блокируют подключение. 
  > [!TIP]
  > Перед миграцией серверов настоятельно рекомендуется сделать тестовую отработку отказа. Убедитесь, что на каждом перемещаемом сервере выполнена по меньшей мере одна успешная тестовая отработка отказа. Как часть тестовой отработки отказа подключитесь к машине, для которой выполняется обработка отказа, и убедитесь, что все работает, как ожидалось.
  >
  >Операция тестовой отработки отказа не нарушает работу и помогает выполнять тестирование миграции, создавая виртуальные машины в изолированной сети по своему выбору. Во время тестовой отработки отказа, в отличие от операции отработки отказа, репликация данных продолжает выполняться. Вы можете выполнить столько тестовых отработок отказа, сколько необходимо, пока не будете готовы к миграции. 
  >
  


### <a name="get-started"></a>Начало работы

Выполните следующие задачи для подготовки подписки Azure и локальной среды VMware или физического окружения.

1. [Подготовка Azure](tutorial-prepare-azure.md)
2. Подготовка локальной среды [VMware](vmware-azure-tutorial-prepare-on-premises.md).


### <a name="create-a-recovery-services-vault"></a>Создание хранилища Служб восстановления

1. Войдите на [портал Azure](https://portal.azure.com) > **Службы восстановления**.
2. Щелкните **Создать ресурс** > **Средства управления** > **Backup and Site Recovery**.
3. В поле **Имя** укажите понятное имя **W2K8-migration**. Если у вас есть несколько подписок, выберите нужную.
4. Создайте группу ресурсов **w2k8migrate**.
5. Укажите регион Azure. Сведения о поддерживаемых регионах см. в разделе о доступности по регионам на странице [Цены на Azure Site Recovery](https://azure.microsoft.com/pricing/details/site-recovery/).
6. Для быстрого доступа к хранилищу из панели мониторинга щелкните **Закрепить на панели мониторинга**, а затем — **Создать**.

   ![Снимок экрана с параметрами при создании нового хранилища.](media/migrate-tutorial-windows-server-2008/migrate-windows-server-2008-vault.png)

Новое хранилище появится в колонке **Панель мониторинга** в разделе **Все ресурсы** и на основной странице **Хранилища Служб восстановления**.


### <a name="prepare-your-on-premises-environment-for-migration"></a>Подготовка локальной среды к миграции

- Для миграции виртуальных машин Windows Server 2008, работающих в VMware, [установите локальный сервер конфигурации в VMware](vmware-azure-tutorial.md#set-up-the-source-environment).
- Если сервер конфигурации не может быть установлен в качестве виртуальной машины VMware, [установите его на локальный физический сервер или виртуальную машину](physical-azure-disaster-recovery.md#set-up-the-source-environment).

### <a name="set-up-the-target-environment"></a>Настройка целевой среды

Выберите и проверьте целевые ресурсы.

1. Щелкните **Подготовка инфраструктуры** > **Цель** и выберите требуемую подписку Azure.
2. Укажите модель развертывания с помощью Resource Manager.
3. Site Recovery проверяет наличие одной или нескольких совместимых учетных записей хранения и сетей Azure.


### <a name="set-up-a-replication-policy"></a>Настройка политики репликации

1. Чтобы создать новую политику репликации, щелкните **Инфраструктура Site Recovery** > **Политики репликации** >  **+Политика репликации**.
2. На странице **Создать политику репликации** укажите имя политики.
3. В разделе **Пороговое значение RPO** укажите ограничение целевой точки восстановления (RPO). Если значение RPO репликации превышает порог, создается оповещение.
4. В поле **Хранение точки восстановления** укажите продолжительность периода хранения для каждой точки восстановления (в часах). Реплицированные серверы можно восстановить до любой точки в рамках этого периода. Для компьютеров, реплицируемых в хранилище класса Premium, поддерживается период удержания до 24 часов, а для хранилище класса Standard — до 72 часов.
5. Для параметра **Периодичность создания моментальных снимков с согласованием приложений** укажите значение **Выкл.** Нажмите кнопку **ОК** , чтобы создать политику.

Политика автоматически сопоставляется с сервером конфигурации.

> [!WARNING]
> Укажите значение **Выкл.** для параметра периодичности создания моментальных снимков с согласованием приложений в политике репликации. При репликации серверов под управлением Windows Server 2008 поддерживаются только отказоустойчивые точки восстановления. Если указать другое значение для периодичности создания моментальных снимков с согласованием приложений, будут возникать ложные предупреждения, так как состояние репликации сервера станет критическим из-за отсутствия согласованных с приложениями точек восстановления.

   ![Снимок экрана с параметрами при создании политики репликации.](media/migrate-tutorial-windows-server-2008/create-policy.png)

### <a name="enable-replication"></a>Включение репликации

[Включите репликацию](physical-azure-disaster-recovery.md#enable-replication) для миграции сервера Windows Server 2008 SP2 или Windows Server 2008 R2 SP1.
   
   ![Снимок экрана с параметрами при добавлении физических компьютеров.](media/migrate-tutorial-windows-server-2008/Add-physical-server.png)

   ![Снимок экрана с параметрами при включении репликации.](media/migrate-tutorial-windows-server-2008/Enable-replication.png)

### <a name="run-a-test-migration"></a>Выполнение тестовой миграции

Можно выполнить тестовую отработку отказа реплицируемых серверов после завершения начальной репликации и возвращения состояния сервера **Защищено**.

Запустите [тестовую отработку отказа](tutorial-dr-drill-azure.md) в Azure, чтобы убедиться в надлежащей работе всех компонентов.

   ![Снимок экрана с командой проверки отработки отказа.](media/migrate-tutorial-windows-server-2008/testfailover.png)


### <a name="migrate-to-azure"></a>Миграция в Azure

Запустите отработку отказа для компьютеров, которые необходимо перенести.

1. В разделе **Параметры** > **Реплицированные элементы** выберите компьютер и щелкните **Отработка отказа**.
2. В разделе **Отработка отказа** выберите **точку восстановления**, в которую будет выполнена отработка отказа. Выберите последнюю точку восстановления.
3. Выберите **Завершение работы виртуальной машины перед началом отработки отказа**. Site Recovery попытается выключить сервер перед запуском отработки отказа. Отработка отказа продолжится, даже если их не удастся отключить. На странице **Задания** можно следить за ходом выполнения отработки отказа.
4. Убедитесь, что виртуальная машина Azure отображается в Azure должным образом.
5. В разделе **Реплицированные элементы** щелкните имя сервера правой кнопкой мыши и выберите **Завершение миграции**. Таким образом вы сделаете следующее:

    - Завершите миграцию, прекратите репликацию для сервера и остановите для него выставление счетов Site Recovery.
    - Удалите данные репликации. Перенесенные виртуальные машины при этом не будут удалены.

   ![Снимок экрана с командой завершения миграции.](media/migrate-tutorial-windows-server-2008/complete-migration.png)


> [!WARNING]
> **Не отменяйте отработку отказа в процессе выполнения.** Перед началом отработки отказа репликация сервера останавливается. Если отменить выполняющуюся отработку отказа, она остановится, но репликацию сервера не будет продолжаться.

## <a name="next-steps"></a>Дальнейшие действия
> [!div class="nextstepaction"]
> [Ознакомьтесь с часто задаваемыми вопросами](../migrate/resources-faq.md) о Миграции Azure.