---
title: Отработка отказа виртуальных машин Решения Azure VMware в Azure с помощью Site Recovery
description: Сведения об отработке отказа виртуальных машин Решения Azure VMware в Azure с помощью службы Azure Site Recovery.
author: Harsha-CS
manager: rochakm
ms.service: site-recovery
ms.topic: tutorial
ms.date: 09/30/2020
ms.author: harshacs
ms.custom: MVC
ms.openlocfilehash: 60c268ba837540eda86a4cbaf6e0ab1c425d90b4
ms.sourcegitcommit: 772eb9c6684dd4864e0ba507945a83e48b8c16f0
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "91814286"
---
# <a name="fail-over--azure-vmware-solution-vms"></a>Отработка отказа виртуальных машин Решения Azure VMware

В этой статье содержатся сведения об отработке отказа виртуальных машин Решения Azure VMware в Azure с помощью [службы Azure Site Recovery](site-recovery-overview.md).

Это пятое руководство в серии, в котором показано, как настроить аварийное восстановление для виртуальных машин Решения Azure VMware в Azure.

В этом руководстве описано следующее:

> [!div class="checklist"]

> * Проверка соответствия свойств виртуальной машины Решения Azure VMware требованиям Azure.
> * Отработка отказа для конкретных виртуальных машин в Azure.

> [!NOTE]
> В учебниках описан самый простой способ развертывания для определенного сценария. В них везде, где возможно, используются значения по умолчанию, и описаны не все возможные параметры и пути. Более подробные сведения об отработке отказа см. в статье об [отработке отказа виртуальных машин](site-recovery-failover.md).

[Ознакомьтесь со сведениями](failover-failback-overview.md#types-of-failover) о разных типах отработки отказа. Если вы хотите выполнить отработку отказа нескольких виртуальных машин в плане восстановления, ознакомьтесь с [этой статьей](site-recovery-failover.md).

## <a name="before-you-start"></a>Перед началом работы

Выполните инструкции, приведенные в предыдущих учебниках:

1. Убедитесь, что вы [настроили Azure](avs-tutorial-prepare-azure.md) для аварийного восстановления в Azure.
2. Выполните [эти шаги](avs-tutorial-prepare-avs.md), чтобы подготовить развертывание Решения Azure VMware к аварийному восстановлению в Azure.
3. [Настройте](avs-tutorial-replication.md) аварийное восстановление для виртуальных машин Решения Azure VMware.
4. Запустите [тренировку аварийного восстановления](avs-tutorial-dr-drill-azure.md), чтобы убедиться, что все работает как положено.

## <a name="verify-vm-properties"></a>Проверка свойств виртуальной машины

Перед запуском отработки отказа проверьте свойства виртуальной машины и убедитесь, что виртуальная машина соответствует [требованиям Azure](vmware-physical-azure-support-matrix.md#replicated-machines).

Укажите следующие свойства.

1. В разделе **Защищенные элементы** щелкните **Реплицированные элементы**, а затем выберите виртуальную машину, которую необходимо проверить.

2. В области **Реплицированный элемент** находятся сводные данные о виртуальной машине, включая состояние работоспособности и последние доступные точки восстановления. Выберите **Свойства**, чтобы просмотреть дополнительные сведения.

3. В разделе **Вычисления и сеть** при необходимости вы можете изменить эти свойства:
    * имя Azure;
    * Группа ресурсов
    * целевой размер;
    * [Группа доступности](../virtual-machines/windows/tutorial-availability-sets.md)
    * параметры управляемого диска.

4. Вы можете просмотреть и изменить параметры сети, включая:

    * сеть и подсеть, в которых будет размещена виртуальная машина Azure после отработки отказа;
    * IP-адрес, который будет ей назначен.

5. В разделе **Диски** отображаются сведения о дисках операционной системы и дисках данных на виртуальной машине.

## <a name="run-a-failover-to-azure"></a>Отработка отказа в Azure

1. Щелкните **Параметры** > **Реплицированные элементы**, выберите виртуальную машину для отработки отказа, а затем — **Отработка отказа**.
2. В разделе **Отработка отказа** выберите **точку восстановления**, в которую будет выполнена отработка отказа. Можно выбрать один из следующих вариантов:
   * **Последние**. В этом случае сначала обрабатываются все данные, отправляемые в Site Recovery. Этот вариант обеспечивает самое низкое значение целевой точки восстановления (RPO), так как виртуальная машина Azure, созданная после отработки отказа, будет иметь все данные, реплицированные в службу Site Recovery до момента активации отработки отказа.
   * **Последняя обработанная**. Отработка отказа выполняется до последней точки восстановления виртуальной машины, которая была обработана Site Recovery. Этот вариант обеспечивает низкий показатель целевого времени восстановления, так как не требует времени на обработку данных.
   * **Последняя с согласованием приложений**. Отработка отказа виртуальной машины выполняется до последней точки восстановления с согласованным состоянием приложений, которая была обработана Site Recovery.
   * **Пользовательский**. Этот параметр позволяет указать точку восстановления.

3. Выберите **Shut down machine before beginning failover** (Завершение работы виртуальной машины перед началом отработки отказа), чтобы попытаться выключить исходные виртуальные машины, прежде чем запускать отработку отказа. Отработка отказа продолжится даже если их не удастся отключить. На странице **Задания** можно следить за ходом выполнения отработки отказа.

В некоторых сценариях требуется дополнительная обработка отработки отказа, которая длится около 8–10 минут. Тестовая отработка отказа может занимать больше времени для следующих систем:

* виртуальные машины VMware, использующие Службу мобильности версии ниже 9.8;
* виртуальные машины Linux VMware;
* виртуальные машины VMware без включенной службы DHCP;
* виртуальные машины VMware без загрузочных драйверов storvsc, vmbus, storflt, intelide, atapi.

> [!WARNING]
> Не отменяйте отработку отказа в процессе выполнения. Перед началом отработки отказа репликация виртуальной машины останавливается. Если отменить выполняющуюся отработку отказа, она остановится, но виртуальная машина не будет реплицирована повторно.

## <a name="connect-to-failed-over-vm"></a>Подключение к виртуальной машине, на которой выполнялась отработка отказа

1. Если после отработки отказа вы хотите подключиться к виртуальным машинам Azure по протоколу удаленного рабочего стола (RDP) и Secure Shell (SSH), [убедитесь, что выполнены требования](failover-failback-overview.md#connect-to-azure-after-failover).
2. После отработки отказа перейдите к виртуальной машине и проверьте [подключение](../virtual-machines/windows/connect-logon.md) к ней.
3. Используйте параметр **Изменить точку восстановления** при необходимости выбрать другую точку восстановления после отработки отказа. После фиксации отработки отказа на следующем шаге этот параметр будет недоступным.
4. После проверки выберите **Зафиксировать**, чтобы завершить подготовку точки восстановления виртуальной машины после отработки отказа.
5. После этого все остальные доступные точки восстановления будут удалены. На этом шаге отработка отказа будет завершена.

>[!TIP]
> Если после отработки отказа с подключением возникли проблемы, выполните шаги, описанные в руководстве по [устранению неполадок](site-recovery-failover-to-azure-troubleshoot.md).

## <a name="next-steps"></a>Дальнейшие действия

После отработки отказа повторно включите защиту виртуальных машин Azure в частном облаке Решения Azure VMware. После включения повторной защиты виртуальных машин и репликации их в частное облако Решения Azure VMware выполните восстановление размещения из Azure.


> [!div class="nextstepaction"]
> [Повторное включение защиты виртуальных машин Azure](avs-tutorial-reprotect.md)
> [Восстановление размещения из Azure](avs-tutorial-failback.md)
