---
title: Создание и Настройка планов восстановления в Azure Site Recovery
description: Узнайте, как создать и настроить планы восстановления для аварийного восстановления с помощью службы Azure Site Recovery.
ms.topic: how-to
ms.date: 01/23/2020
ms.openlocfilehash: 0dcde98e8dcaef12896c18c25429f0ba7b1b27d4
ms.sourcegitcommit: 910a1a38711966cb171050db245fc3b22abc8c5f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "96009727"
---
# <a name="create-and-customize-recovery-plans"></a>Создание и настройка планов восстановления

В этой статье описывается создание и Настройка плана восстановления для отработки отказа в [Azure Site Recovery](site-recovery-overview.md). Прежде чем начать работу, [ознакомьтесь подробными сведениями](recovery-plan-overview.md) о планах восстановления.

## <a name="create-a-recovery-plan"></a>Создание плана восстановления

1. В хранилище служб восстановления выберите **планы восстановления (Site Recovery)**  >  **+ план восстановления**.
2. В разделе **Создать план восстановления** укажите имя для нового плана.
3. Выберите исходное и целевое расположение в зависимости от компьютеров в плане, а затем выберите модель развертывания **Resource Manager**. На компьютерах в исходном расположении должны быть настроены отработка отказа и восстановление. 

    **Тип отработки отказа** | **Источник** | **Целевой объект** 
   --- | --- | ---
   Из Azure в Azure | Выберите регион Azure | Выберите регион Azure
   Из VMware в Azure | Выбор сервера конфигурации | Выбор Azure
   Физические компьютеры в Azure | Выбор сервера конфигурации | Выбор Azure   
   Hyper-V в Azure | Выберите имя сайта Hyper-V | Выбор Azure
   Hyper-V (управляется VMM) в Azure  | Выбор сервера VMM | Выбор Azure
  
    Следует отметить следующее.
    - Вы можете использовать план восстановления для отработки отказа в Azure и восстановления размещения из Azure.
    - На компьютерах в исходном расположении должны быть настроены отработка отказа и восстановление.
    - В план восстановления можно включить компьютеры с одинаковыми исходным и целевым расположением.
    - В один и тот же план можно включить виртуальные машины VMware и виртуальные машины Hyper-V под управлением VMM.
    - Виртуальные машины и физические серверы VMware могут быть в одном плане.

4. В окне **Select items virtual machines** (Выбор виртуальных машин) укажите виртуальные машины (или группу репликации), которые нужно добавить в этот план. Нажмите кнопку **ОК**.
    - Компьютеры добавляются в группу плана по умолчанию (группа 1). После отработки отказа все компьютеры в этой группе запускаются одновременно.
    - Вы сможете выбрать компьютеры только в тех расположениях, которые указаны в качестве исходных и целевых. 
5. Щелкните **ОК**, чтобы создать план.

## <a name="add-a-group-to-a-plan"></a>Добавление группы в план

Вы можете создать дополнительные группы и добавить компьютеры в разные группы, чтобы реализовать разные действия для отдельных групп. Например, для каждой группы можно указать время запуска компьютеров после отработки отказа или настроить особые действия.

1. В разделе **Планы восстановления** щелкните нужный план правой кнопкой мыши и выберите **Настройка**. По умолчанию при создании плана все помещенные в него компьютеры входят в группу 1.
2. Щелкните **+ Группа**. По умолчанию группы нумеруются в том порядке, в котором они были добавлены. Вы можете использовать не более семи групп.
3. Выберите компьютер, который хотите переместить в новую группу, щелкните **Изменить группу** и выберите новую группу. Также можно щелкнуть правой кнопкой мыши имя группы, выбрать пункт **Защищенный элемент** и добавить компьютеры в группу. Каждый компьютер и (или) группа репликации может принадлежать только к одной группе в плане восстановления.


## <a name="add-a-script-or-manual-action"></a>Добавление скрипта или выполняемого вручную действия

Вы можете настроить план восстановления, добавив в него скрипт или выполняемое вручную действие. Обратите внимание на следующее.

- При репликации в Azure вы можете интегрировать в план восстановления модули Runbook службы автоматизации Azure. [Подробнее](site-recovery-runbook-automation.md).
- Если для репликации выбраны виртуальные машины Hyper-V под управлением System Center VMM, можно создать скрипт на локальном сервере VMM и включить его в план восстановления.
- Каждый новый скрипт добавляет к группе новый набор действий. Например, для группы с именем Group 1 создается набор предварительных действий с именем *Group 1: pre-steps*. Все предварительные действия перечислены в этом наборе. Чтобы добавить сценарий, на основном сайте должен быть развернут сервер VMM.
- Если вы добавляете ручное действие, то при выполнении плана восстановления он останавливается в момент вставки ручного действия. При этом появляется диалоговое окно с предложением подтвердить, что это действие выполнено вручную.
- Чтобы создать скрипт на сервере VMM, выполните инструкции из [этой статьи](hyper-v-vmm-recovery-script.md).
- Скрипты могут применяться при отработке отказа на дополнительный сайт, а также при восстановлении размещения с дополнительного сайта на основной. В зависимости от сценария репликации поддерживаются разные варианты:
    
    **Сценарий** | **Тип отработки отказа** | **Восстановить**
    --- | --- | --- 
    Из Azure в Azure  | Модуль Runbook | Модуль Runbook
    VMware — Azure | Модуль Runbook | Н/Д 
    С виртуальных машин Hyper-V (с VMM) в Azure | Модуль Runbook | Сценарий
    С сайта Hyper-V в Azure | Модуль Runbook | Н/Д
    Из VMM на дополнительный сервер VMM | Сценарий | Сценарий

1. В плане восстановления щелкните шаг, в который должно быть добавлено действие, и укажите, когда должно выполняться действие:
    1. Если действие должно происходить перед запуском компьютеров группы после отработки отказа, выберите вариант **Добавить предварительное действие**.
    1. Если действие должно происходить после запуска компьютеров группы, для которых выполнена отработка отказа, выберите вариант **Добавить завершающее действие**. Вы можете изменить положение действия с помощью кнопок управления **Move Up** (Переместить выше) и **Move Down** (Переместить ниже).
2. В диалоговом окне **Добавление действия** выберите **Скрипт** или **Выполняемое вручную действие**.
3. Если вы хотите добавить ручное действие, выполните следующие действия.
    1. Введите имя для действия и инструкции по его выполнению. Эти инструкции будут предоставлены пользователю, который запустит отработку отказа.
    1. Укажите, следует ли добавить выполняемое вручную действие для всех типов отработки отказа (тестовая, обычная и плановая (если применимо)). Нажмите кнопку **ОК**.
4. Если вы хотите добавить скрипт, выполните следующие действия.
    1. При добавлении сценария VMM выберите **отработку отказа для сценария VMM** и в поле **пути сценария** введите относительный путь к общей папке. Например, если общая папка расположена по адресу \\\<VMMServerName>\MSSCVMMLibrary\RPScripts, укажите путь \RPScripts\RPScript.PS1.
    1. При добавлении модуля Runbook службы автоматизации Azure укажите **Учетную запись службы автоматизации Azure**, в которой расположен модуль Runbook, и выберите соответствующий **сценарий модуля Runbook для Azure**.
5. Выполните тестовую отработку отказа для плана восстановления, чтобы проверить, правильно ли выполняется скрипт.

## <a name="watch-a-video"></a>Посмотрите видео

Просмотрите видеоролик, демонстрирующий создание плана восстановления.


> [!VIDEO https://www.youtube.com/embed/1KUVdtvGqw8]

## <a name="next-steps"></a>Дальнейшие действия

[Дополнительные сведения](site-recovery-failover.md) о выполнении отработки отказа.  

    
