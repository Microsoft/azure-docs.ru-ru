---
title: Анализ отчета Планировщик развертывания Hyper-V в Azure Site Recovery
description: В этой статье описано, как проанализировать отчет, сформированный Планировщиком развертывания Azure Site Recovery для аварийного восстановления виртуальных машин Hyper-V в Azure.
services: site-recovery
author: mayurigupta13
manager: rochakm
ms.service: site-recovery
ms.topic: conceptual
ms.date: 10/21/2019
ms.author: mayg
ms.openlocfilehash: f230445ecdb046c2b631e89567df71e1d09c3234
ms.sourcegitcommit: 910a1a38711966cb171050db245fc3b22abc8c5f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "95999235"
---
# <a name="analyze-the-azure-site-recovery-deployment-planner-report"></a>Анализ отчета Планировщика развертывания Azure Site Recovery
В этой статье рассматриваются листы, которые содержатся в отчете Excel, созданном планировщиком развертывания Azure Site Recovery для сценария развертывания Hyper-V в Azure.

## <a name="on-premises-summary"></a>Сводка по локальной инфраструктуре
На листе On-premises summary (Сводка по локальной инфраструктуре) содержатся общие сведения о профилированной среде Hyper-V.

![Сводка по локальной инфраструктуре](media/hyper-v-deployment-planner-analyze-report/on-premises-summary-h2a.png)

**Дата начала** и **Дата окончания**: даты начала и окончания профилирования данных, которые рассматривались при создании отчета. По умолчанию "Дата начала" — это дата начала профилирования, а "Дата окончания" — это дата окончания. При создании отчета с этими параметрами им соответствуют значения StartDate и EndDate.

**Total number of profiling days** (Общее число дней профилирования) — общее число дней профилирования между датами начала и окончания, для которых создается отчет.

**Number of compatible virtual machines** (Число совместимых виртуальных машин) — это общее число совместимых виртуальных машин, использующих пропускную способность сети, а также необходимое число учетных записей хранения и ядер Azure.

**Total number of disks across all compatible virtual machines** (Общее число дисков на всех совместимых виртуальных машинах) — общее число дисков на всех совместимых виртуальных машинах.

**Average number of disks per compatible virtual machine** (Среднее число дисков на каждой совместимой виртуальной машине) — среднее число дисков, вычисленное для всех совместимых виртуальных машин.

**Average disk size (GB)** (Средний размер диска (ГБ)) — средний размер диска, вычисленный для всех совместимых виртуальных машин.

**Требуемая RPO (минуты)**: Целевая точка восстановления по умолчанию или значение, передаваемое параметру "DesiredRPO" во время создания отчета для оценки требуемой пропускной способности.

**Desired bandwidth (Mbps)** (Необходимая пропускная способность (Мбит/с)) — значение, заданное для параметра Bandwidth во время создания отчета для оценки достигаемого значения целевой точки восстановления (RPO).

**Observed typical data churn per day (GB)** (Стандартная активность обработки данных в день (ГБ)) — среднее значение обработки данных в течение профилирования.

## <a name="recommendations"></a>Рекомендации 
Лист рекомендаций отчета по развертыванию Hyper-V в Azure содержит следующие сведения с учетом выбранного требуемого значения RPO.

![Рекомендации для отчета по развертыванию VMware в Azure](media/hyper-v-deployment-planner-analyze-report/Recommendations-h2a.png)

### <a name="profile-data"></a>Данные профиля
![Данные профиля](media/hyper-v-deployment-planner-analyze-report/profile-data-h2a.png)

**Profiled data period** (Период профилирования данных) — длительность выполнения профилирования. По умолчанию программа использует для вычисления все данные профилирования, за исключением случаев, когда создается отчет для определенного периода времени с использованием параметров StartDate и EndDate. 

**Number of Hyper-V servers profiled** (Число профилированных серверов Hyper-V) — количество серверов Hyper-V, по виртуальным машинам которых создается отчет. Выберите число, чтобы увидеть имя сервера Hyper-V. Открывается лист с требованиями к локальному хранилищу, где перечислены все серверы с требованиями к хранилищу. 

**Desired RPO** (Требуемое значение RPO) — значение целевой точки восстановления для развертывания. По умолчанию необходимая пропускная способность рассчитывается для значений RPO, равных 15, 30 и 60 минутам. В зависимости от выбора в отчете обновляются затронутые значения. Если во время создания отчета вы использовали параметр DesiredRPOinMin, это значение отображается в результатах по параметру Desired RPO (Требуемое значение RPO).

### <a name="profiling-overview"></a>Общие сведения о профилировании
![Общие сведения о профилировании](media/hyper-v-deployment-planner-analyze-report/profiling-overview-h2a.png)

**Total Profiled Virtual Machines** (Общее число профилированных виртуальных машин) — общее количество виртуальных машин, данные профилирования которых доступны. Если в качестве значений параметра VMListFile заданы виртуальные машины, профилирование которых не выполнялось, они не учитываются при создании отчета и исключаются из общего числа профилированных виртуальных машин.

**Compatible Virtual Machines** (Совместимые виртуальные машины) — число виртуальных машин, которые можно защитить с помощью Azure Site Recovery. Это общее количество совместимых виртуальных машин, для которых вычисляется необходимая пропускная способность сети, количество учетных записей хранения и число ядер в Azure. Сведения о каждой совместимой виртуальной машине см. в соответствующем разделе.

**Incompatible Virtual Machines** (Несовместимые виртуальные машины) — число виртуальных машин, которые нельзя защитить с помощью Site Recovery. Причины несовместимости см. в разделе "Несовместимые виртуальные машины". Если в качестве значений параметра VMListFile заданы виртуальные машины, профилирование которых не выполнялось, они исключаются из общего числа несовместимых виртуальных машин. Эти виртуальные машины перечислены в списке Data not found (Данные не найдены) в нижней части раздела Incompatible Virtual Machines (Несовместимые виртуальные машины).

**Desired RPO** (Требуемое значение RPO) — требуемая целевая точка восстановления в минутах. Отчет создается на основе трех значений RPO: 15, 30 и 60 минут. Рекомендации относительно пропускной способности изменяются в отчете в зависимости от значения, выбранного в раскрывающемся списке **Desired RPO** (Требуемое значение RPO). Этот список расположен в верхнем правом углу страницы. Если при создании отчета вы использовали другое значение параметра **Desired RPO** (Требуемое значение RPO), оно будет отображаться в этом раскрывающемся списке в качестве значения по умолчанию.

### <a name="required-network-bandwidth-mbps"></a>Требуемая пропускная способность сети (Мбит/с)
![Требуемая пропускная способность сети](media/hyper-v-deployment-planner-analyze-report/required-network-bandwidth-h2a.png)

**To meet RPO 100% of the time** (Соблюдение требований к RPO 100 % времени). Рекомендуемая пропускная способность (в Мбит/с), необходимая для соблюдения требований к RPO в 100 % случаев. Это объем пропускной способности, необходимый для разностной репликации в устойчивом состоянии всех совместимых виртуальных машин, чтобы избежать каких-либо нарушений требований к RPO.

**To meet RPO 90% of the time** (Соблюдение требований к RPO 90 % времени). Из-за цены на высокоскоростное подключение или по какой-либо другой причине вы не можете установить объем пропускной способности, необходимый для соблюдения требований к RPO в 100 % случаев. Если это так, вы можете использовать меньший объем пропускной способности, необходимый для соблюдений требований к RPO в 90 % случаев. Чтобы оценить влияние установки меньшего объема, в отчете можно просмотреть сведения о возможном количестве нарушений требований к RPO и их продолжительности.

**Achieved Throughput** (Достигнутая пропускная способность) — это пропускная способность сервера, на котором вы выполнили команду GetThroughput, доступная для региона Azure, где расположена учетная запись хранения. Это значение указывает примерную пропускную способность, которой можно достичь при защите совместимых виртуальных машин с помощью Site Recovery. Характеристики хранилища и сети сервера Hyper-V должны быть такими же, как и на сервере, на котором вы запустили средство.

Для всех развертываний Site Recovery в корпоративных средах мы рекомендуем использовать [ExpressRoute](https://aka.ms/expressroute).

### <a name="required-storage-accounts"></a>Диаграмма Required Azure Storage Accounts (Требуемые учетные записи хранения Azure)
На следующей диаграмме показано общее число учетных записей хранения Azure (уровня Standard и Premium), необходимых для защиты всех совместимых виртуальных машин. Чтобы узнать, какую учетную запись хранения необходимо использовать для каждой виртуальной машины, см. раздел "Размещение хранилища виртуальной машины".

![Требуемые учетные записи хранения Azure](media/hyper-v-deployment-planner-analyze-report/required-storage-accounts-h2a.png)

### <a name="required-number-of-azure-cores"></a>Область Required Number of Azure Cores (Необходимое число ядер Azure)
Это значение указывает на общее число ядер, которое необходимо задать перед отработкой отказа (или тестовой отработкой отказа) всех совместимых виртуальных машин. Если в подписке доступно слишком мало ядер, Site Recovery не сможет создать виртуальные машины и этот процесс завершится сбоем во время отработки отказа (или тестовой отработки отказа).

![Область Required Number of Azure Cores (Необходимое число ядер Azure)](media/hyper-v-deployment-planner-analyze-report/required-number-of-azure-cores-h2a.png)


### <a name="additional-on-premises-storage-requirement"></a>Дополнительные требования к локальному хранилищу

Обеспечьте наличие общего свободного пространства хранения на серверах Hyper-V для успешной начальной и разностной репликаций. Это позволит избежать нежелательных простоев при репликации виртуальных машин. Дополнительные сведения о требованиях к каждому тому см. в разделе [требований к локальному хранилищу](#on-premises-storage-requirement). 

Сведения о том, зачем нужно свободное пространство для репликации, см. [здесь](#why-do-i-need-free-space-on-the-hyper-v-server-for-the-replication).

![Требования к локальному хранилищу и частота копирования](media/hyper-v-deployment-planner-analyze-report/on-premises-storage-and-copy-frequency-h2a.png)

### <a name="maximum-copy-frequency"></a>Максимальная частота копирования
Для достижения нужного значения RPO при репликации нужно настроить рекомендуемую максимальную частоту копирования. Значение по умолчанию — пять минут. Для оптимизации RPO можно настроить частоту копирования 30 секунд.

### <a name="what-if-analysis"></a>Анализ "что если"
![Анализ "что если"](media/hyper-v-deployment-planner-analyze-report/what-if-analysis-h2a.png) В этом анализе отображаются сведения о возможном количестве нарушений, которые могут произойти в процессе профилирования при установке меньшего объема пропускной способности, необходимой для соблюдения требований к RPO только в 90 % случаев. Это может быть одно или несколько нарушений, которые могут произойти в любой заданный день. На диаграмме показано максимальное значение RPO за день. По результатам анализа вы можете определить, допустимо ли количество нарушений требований к RPO за все время и максимальное значение RPO за день для выделенного объема пропускной способности. Если допустимо, вы можете выделить меньший объем пропускной способности для репликации, в противном случае повысьте ее пределы для соблюдения требований к RPO в 100 % случаев. 

### <a name="recommendation-for-successful-initial-replication"></a>Рекомендации для успешной начальной репликации
В этом разделе рассматривается количество пакетов, в которых указаны виртуальные машины для защиты, и минимальная пропускная способность, необходимая для успешной начальной репликации (IR). 

![Пакетная обработка IR](media/hyper-v-deployment-planner-analyze-report/ir-batching-h2a.png)

Защита виртуальных машин должна обеспечиваться в порядке пакетов. Каждый пакет имеет определенный список виртуальных машин. Сначала следует обеспечить защиту виртуальных машин из пакета 1, затем из пакета 2, пакета 3 и т. д. После завершения начальной репликации виртуальных машин пакета 1 можно включить ее для виртуальных машин пакета 2, а затем для виртуальных машин пакета 3 и т. д. 

При несоблюдении порядка следования пакетов во время начальной репликации виртуальных машин, защита которых обеспечивается позже, может быть недостаточно пропускной способности. В результате не удастся выполнить начальную репликацию виртуальных машин или несколько защищенных виртуальных машин могут перейти в режим повторной синхронизации. Для пакетной обработки IR в выбранном листе RPO содержатся подробные сведения о том, какие виртуальные машины должны находиться в каждом пакете.

На диаграмме ниже показаны сведения о распределении пропускной способности для начальной и разностной репликации между пакетами в заданном порядке. При защите первого пакета виртуальных машин для начальной репликации доступна вся пропускная способность. После начальной репликации первого пакета часть пропускной способности потребуется для разностной репликации данных. Оставшаяся часть пропускной способности доступна для начальной репликации второго пакета виртуальных машин. 

В строке пакета 2 показана требуемая пропускная способность для разностной репликации виртуальных машин пакета 1 и пропускная способность, доступная для начальной репликации виртуальных машин пакета 2. Аналогичным образом в строке 3 показана пропускная способность, необходимая для разностной репликации предыдущих пакетов (виртуальные машины пакета 1 и 2), и пропускная способность, доступная для начальной репликации пакета 3 и т. д. После начальной репликации всех пакетов в последней строке отображается пропускная способность, необходимая для разностной репликации всех защищенных виртуальных машин.

**Зачем нужна пакетная обработка начальной репликации?**
Время выполнения начальной репликации зависит от фактического размера диска виртуальной машины, используемого дискового пространства и доступной пропускной способности сети. Подробную информацию можно найти в таблице пакетной обработки IR на выбранном листе RPO.

### <a name="cost-estimation"></a>Оценка затрат
На следующих диаграммах представлена сводная оценка общих затрат на аварийное восстановление в Azure для выбранного целевого региона и валюты, которые вы указали при создании отчета.

![Результаты оценки затрат](media/hyper-v-deployment-planner-analyze-report/cost-estimation-summary-h2a.png)

Сводка поможет вам составить представление о затратах на хранилище, вычисления, сеть и лицензии при защите всех совместимых виртуальных машин в Azure с помощью Site Recovery. Затраты рассчитываются только для совместимых, а не для всех профилируемых виртуальных машин. 
 
Можно просмотреть расходы за месяц или за год. Узнайте больше о поддерживаемых [целевых регионах](./hyper-v-deployment-planner-cost-estimation.md#supported-target-regions) и [валютах](./hyper-v-deployment-planner-cost-estimation.md#supported-currencies).

**Cost by components** (Затраты по составляющим). Расходы на аварийное восстановление разделены на четыре составляющие: стоимость вычислительных ресурсов, хранилища, сети и лицензии Site Recovery. Затраты рассчитываются на основе данных потребления при репликации и тестировании аварийного восстановления. Сюда входит стоимость вычислительных ресурсов, хранилища (классы Premium и Standard), подключения ExpressRoute или VPN, настроенного между локальной средой и Azure, а также лицензии Azure Site Recovery.

**Cost by states** (Затраты по состояниям). Общие расходы на аварийное восстановление рассчитываются на основе двух состояний: репликации и тестирования аварийного восстановления. 

**Replication cost** (Затраты на репликацию). Стоимость репликации. Сюда входит стоимость хранилища, сети и лицензии Site Recovery. 

**DR-Drill cost** (Затраты на тестирование аварийного восстановления). Стоимость тестовой отработки отказа. Site Recovery запускает виртуальные машины при тестовой отработке отказа. Затраты на тестирование аварийного восстановления включают расходы на вычислительные ресурсы и хранилище для работающих виртуальных машин. 

**Azure storage cost per Month/Year** (Месячные или годовые затраты на хранилище). Линейчатая диаграмма отображает общие расходы на хранилище классов Premium и Standard при репликации и тестировании аварийного восстановления. Подробный анализ затрат на виртуальную машину см. на листе [оценки затрат](hyper-v-deployment-planner-cost-estimation.md).

### <a name="growth-factor-and-percentile-values-used"></a>Коэффициент роста и используемые значения процентилей
Этот раздел находится в нижней части страницы. В нем содержатся сведения о значении процентиля, используемом для всех счетчиков производительности профилированных виртуальных машин (по умолчанию 95-й процентиль), а также о коэффициенте роста, используемом во всех вычислениях (по умолчанию — 30 %).

![Коэффициент роста и используемые значения процентилей](media/hyper-v-deployment-planner-run/growth-factor-max-percentile-value.png)

## <a name="recommendations-with-available-bandwidth-as-input"></a>Рекомендации по вводу значения доступной пропускной способности
![Общие сведения о профилировании и ввод значения пропускной способности](media/hyper-v-deployment-planner-analyze-report/profiling-overview-bandwidth-input-h2a.png)

Возможны ситуации, когда вы не сможете установить для репликации Site Recovery достаточный объем пропускной способности. С помощью этого инструмента можно во время создания отчета ввести значение доступной пропускной способности (с помощью параметра -Bandwidth) и получить достигаемое значение RPO в минутах. На основе полученного значения вы можете определить, нужно ли подготовить дополнительный объем пропускной способности или можно просто создать решение для аварийного восстановления.

![Достигаемое значение RPO](media/hyper-v-deployment-planner-analyze-report/achivable-rpo-h2a.PNG)

## <a name="vm-storage-placement-recommendation"></a>Рекомендация по размещению хранилища виртуальных машин 
![Размещение хранилища виртуальной машины](media/hyper-v-deployment-planner-analyze-report/vm-storage-placement-h2a.png)

**Disk Storage Type** (Тип хранилища дисков) — учетная запись хранения уровня Standard или Premium, используемая для репликации всех соответствующих виртуальных машин, указанных в столбце **VMs to Place** (Виртуальные машины для размещения).

**Suggested Prefix** (Рекомендуемый префикс) — префикс из трех знаков, который можно использовать для создания имени учетной записи хранения. Вы можете использовать собственный префикс, но для программы мы рекомендуем использовать префикс, соответствующий требованиям [соглашения об именовании секций учетных записей хранения](/en-in/azure/storage/blobs/storage-performance-checklist).

**Suggested Account Name** (Рекомендуемое имя учетной записи) — имя учетной записи хранения после добавления рекомендуемого префикса. Замените имя в угловых скобках (< и >) именем своей учетной записи.

**Log Storage Account** (Учетная запись хранения журналов). Все журналы репликации хранятся в учетной записи хранения уровня Standard. Если репликация виртуальных машин выполняется в учетную запись хранения уровня Premium, для хранения журналов необходимо настроить дополнительную учетную запись уровня Standard. Одна учетная запись хранения журналов уровня Standard может использоваться несколькими учетными записями хранения репликации уровня Premium. Виртуальные машины, реплицированные в учетные записи хранения уровня Standard, используют ту же учетную запись хранения для журналов.

**Suggested Log Account Name** (Рекомендуемое имя учетной записи) — имя учетной записи хранения журналов после добавления рекомендуемого префикса. Замените имя в угловых скобках (< и >) именем своей учетной записи.

**Placement Summary** (Сводка размещения) — сводные данные об общем числе виртуальных машин, переданных в учетную запись хранения во время репликации и отработки отказа (или тестовой отработки отказа). Сводка содержит следующие данные:

* общее число виртуальных машин, сопоставленных с учетной записью хранения; 
* общее количество операций записи и чтения на диск в секунду на всех виртуальных машинах, размещенных в этой учетной записи хранения;
* общее количество операций ввода-вывода в секунду при записи (репликации);
* общий объем установленного пространства на всех дисках;
* общее число дисков.

**VMs to Place** (Виртуальные машины для размещения). Список всех виртуальных машин, которые необходимо поместить в определенную учетную запись хранения для обеспечения оптимальной производительности и эффективного использования.

## <a name="compatible-vms"></a>Совместимые виртуальные машины
В отчете Excel, созданном с помощью планировщика развертывания Site Recovery, сведения обо всех совместимых виртуальных машинах содержатся на листе Compatible VMs (Совместимые виртуальные машины).

![Совместимые виртуальные машины](media/hyper-v-deployment-planner-analyze-report/compatible-vms-h2a.png)

**Имя виртуальной машины** — имя виртуальной машины, заданное в качестве значения параметра VMListFile во время создания отчета. В этом столбце также перечислены диски (VHD-файлы), присоединенные к виртуальным машинам. Имена включают имена узлов Hyper-V, на которых были размещены виртуальные машины, при их обнаружении средством во время профилирования.

Параметр **VM Compatibility** (Совместимость виртуальной машины) имеет два значения: **Да** и **Да**\*. **Да** \* предназначен для экземпляров, в которых виртуальная машина подходит для [твердотельных накопителей](../virtual-machines/disks-types.md)уровня "Премиум". Здесь для профилированного диска с быстро изменяющимися данными или операциями ввода-вывода настраивается диск класса Premium большего размера, чем сопоставленный с ним. Учетная запись хранения определяет, с каким типом диска хранилища класса Premium сопоставить диск виртуальной машины на основе его размера: 
* если емкость диска составляет меньше 128 ГБ, он сопоставляется с категорией P10;
* если емкость диска составляет от 128 до 256 ГБ, он сопоставляется с категорией P15;
* если емкость диска составляет от 256 до 512 ГБ, он сопоставляется с категорией P20;
* если емкость диска составляет от 512 до 1024 ГБ, он сопоставляется с категорией P30;
* если емкость диска составляет от 1025 до 2048 ГБ, он сопоставляется с категорией P40;
* если емкость диска составляет от 2049 до 4095 ГБ, он сопоставляется с категорией P50.

Например, если характеристики рабочей нагрузки диска помещают в категорию P20 или P30, но размер сопоставляется с более низким типом диска хранилища класса Premium, средство помечает эту виртуальную машину как **"Да"** \* . и рекомендует вам либо изменить размер исходного диска для соответствия рекомендуемому типу диска хранилища класса Premium, либо изменить тип целевого диска после отработки отказа.

**Тип хранилища** — Standard или Premium.

**Suggested Prefix** (Рекомендуемый префикс) — префикс имени учетной записи хранения, состоящий из трех знаков.

**Учетная запись хранения** — имя, к которому добавляется рекомендуемый префикс.

**Peak R/W IOPS (with Growth Factor)** (Пиковое количество операций записи и чтения на диск в секунду (с коэффициентом роста)) — пиковое значение числа операций ввода-вывода в секунду при чтении и записи на диске (95-й процентиль) вместе с будущим коэффициентом роста (по умолчанию — 30 %). Общее число операций записи и чтения на диск в секунду не всегда вычисляется путем сложения операций записи и чтения каждого отдельного диска виртуальной машины. Максимальное число операций записи и чтения в секунду виртуальной машины состоит из максимальных значений каждого отдельного диска в течение каждой минуты процесса профилирования.

**Peak Data Churn in MB/s (with Growth Factor)** (Пиковая активность обработки данных на диске в МБ/с (с коэффициентом роста)) — пиковая скорость обработки данных на диске (95-й процентиль) вместе с будущим коэффициентом роста (по умолчанию — 30 %). Общая скорость обработки данных виртуальной машины не всегда вычисляется путем сложения скорости обработки данных на каждом ее отдельном диске. Максимальная скорость обработки данных виртуальной машины состоит из максимальных значений обработки на каждом отдельном диске в течение каждой минуты процесса профилирования.

**Azure VM Size** (Размер виртуальной машины Azure) — размер виртуальной машины облачных служб Azure, который лучше всего использовать для сопоставления с локальной виртуальной машиной. Это сопоставление выполняется на основе памяти, числа дисков, ядер, сетевых карт и операций записи и чтения на диск в секунду локальной виртуальной машины. Мы рекомендуем всегда использовать виртуальную машину Azure наименьшего размера, характеристики которой соответствуют всем этим характеристикам локальной виртуальной машины.

**Количество дисков** — общее количество дисков (VHD-файлов) на виртуальной машине.

**Размер диска (ГБ)**: общий размер всех дисков виртуальной машины. Эта программа также показывает размер каждого отдельного диска виртуальной машины.

**Ядра** — количество ядер ЦП на виртуальной машине.

**Память (МБ)**  — ОЗУ виртуальной машины.

**Сетевые карты** — количество сетевых карт на виртуальной машине.

**Тип загрузки** — тип загрузки виртуальной машины (BIOS или EFI).

## <a name="incompatible-vms"></a>Несовместимые виртуальные машины
В отчете Excel, созданном с помощью планировщика развертывания Site Recovery, сведения обо всех несовместимых виртуальных машинах содержатся на листе Incompatible VMs (Несовместимые виртуальные машины).

![Несовместимые виртуальные машины](media/hyper-v-deployment-planner-analyze-report/incompatible-vms-h2a.png)

**Имя виртуальной машины** — имя виртуальной машины, заданное в качестве значения параметра VMListFile во время создания отчета. В этом столбце также перечислены диски (VHD-файлы), присоединенные к виртуальным машинам. Имена включают имена узлов Hyper-V, на которых были размещены виртуальные машины, при их обнаружении средством во время профилирования.

Параметр **VM Compatibility** (Совместимость виртуальной машины) указывает, почему определенная виртуальная машина не поддерживает Site Recovery. Причины приводятся для каждого несовместимого диска виртуальной машины, и в зависимости от опубликованных [ограничений хранилища](/en-in/azure/storage/common/scalability-targets-standard-account) эта проблема может быть вызвана следующим:

* Размер диска превышает 4095 ГБ. Сейчас служба хранилища Azure не поддерживает диски данных емкостью более 4095 ГБ.

* Размер диска ОС превышает 2047 ГБ для виртуальной машины поколения 1 (тип загрузки BIOS). Site Recovery не поддерживает размер диска ОС, превышающий 2047 ГБ, для виртуальных машин поколения 1.

* Размер диска ОС превышает 300 ГБ для виртуальной машины поколения 2 (тип загрузки EFI). Site Recovery не поддерживает размер диска ОС, превышающий 300 ГБ, для виртуальных машин поколения 2.

* Имя виртуальной машины не поддерживается с любым из следующих символов: “” [] `. Средству не удастся получить профилируемые данные для виртуальных машин, в именах которых содержатся такие символы. 

* Виртуальный жесткий диск совместно используется двумя или более виртуальными машинами. Azure не поддерживает виртуальные машины с общим виртуальным жестким диском.

* Виртуальная машина с виртуальным подключением Fibre Channel не поддерживается. Site Recovery не поддерживает виртуальные машины с виртуальным подключением Fibre Channel.

* В кластере Hyper-V нет брокера репликации. Site Recovery не поддерживает виртуальную машину в кластере Hyper-V, для которого не настроен брокер реплики Hyper-V.

* Виртуальная машина не обеспечивает высокую доступность. Site Recovery не поддерживает виртуальную машину в узле кластера Hyper-V, виртуальные жесткие диски которой хранятся на локальном диске, а не на диске кластера. 

* Общий размер виртуальной машины (репликация и тестовая отработка отказа) превышает поддерживаемый размер учетной записи хранения класса Premium (35 ТБ). Это обычно происходит на виртуальных машинах с одним диском, показатели производительности которого превышают максимально поддерживаемые ограничения Microsoft Azure или Azure Site Recovery для хранилища класса Standard, используемого для отправки виртуальной машины в зону хранилища класса Premium. Однако максимальный поддерживаемый размер учетной записи хранения класса Premium составляет 35 ТБ. Защиту одной виртуальной машины невозможно обеспечить в нескольких учетных записях хранения. 

    Если тестовая отработка отказа выполняется на защищенной виртуальной машине и для нее настроен неуправляемый диск, этот процесс происходит в той же учетной записи хранения, где выполняется репликация. В этом случае требуется выделить такой же дополнительный объем дискового пространства, что и для репликации. При этом обеспечивается выполнение репликации и успешная параллельная тестовая отработка отказа. При настройке управляемого диска для тестовой отработки отказа дополнительное пространство для виртуальной машины, используемой для тестовой отработки, не требуется.

* Число операций ввода-вывода в секунду источника превышает поддерживаемое хранилищем ограничение в 7500 операций ввода-вывода в секунду на диск.

* Число операций ввода-вывода в секунду источника превышает поддерживаемое хранилищем ограничение в 80 000 операций ввода-вывода в секунду на виртуальную машину.

* Среднее время обработки данных в исходной виртуальной машине превышает поддерживаемый Site Recovery предел в 20 МБ/с для среднего размера ввода-вывода.

* Среднее эффективное значение количества операций ввода-вывода в секунду на исходной виртуальной машине при записи превышает поддерживаемое Site Recovery ограничение в 840 операций.

* Вычисленный объем хранилища моментальных снимков превышает поддерживаемое ограничение в 10 ТБ.

**Peak R/W IOPS (with Growth Factor)** (Пиковое число операций записи и чтения на диск в секунду (с коэффициентом роста)) — пиковое значение числа операций ввода-вывода в секунду на диске (95-й процентиль) вместе с будущим коэффициентом роста (по умолчанию — 30 %). Общее число операций записи и чтения на диск в секунду не всегда вычисляется путем сложения операций записи и чтения каждого отдельного диска виртуальной машины. Максимальное число операций записи и чтения в секунду виртуальной машины состоит из максимальных значений каждого отдельного диска в течение каждой минуты процесса профилирования.

**Peak Data Churn (MB/s) (with Growth Factor)** (Пиковая активность обработки данных на диске (МБ/с) (с коэффициентом роста)) — пиковая скорость обработки данных на диске (95-й процентиль) вместе с будущим коэффициентом роста (по умолчанию — 30 %). Обратите внимание, что общая скорость обработки данных виртуальной машины не всегда вычисляется путем сложения скорости обработки данных на каждом ее отдельном диске. Максимальная скорость обработки данных виртуальной машины состоит из максимальных значений обработки на каждом отдельном диске в течение каждой минуты процесса профилирования.

**Количество дисков** — общее количество виртуальных жестких дисков на виртуальной машине.

**Размер диска (ГБ)**: общий размер установки всех дисков виртуальной машины. Эта программа также показывает размер каждого отдельного диска виртуальной машины.

**Ядра** — количество ядер ЦП на виртуальной машине.

**Память (МБ)**  — объем ОЗУ виртуальной машины.

**Сетевые карты** — количество сетевых карт на виртуальной машине.

**Тип загрузки** — тип загрузки виртуальной машины (BIOS или EFI).

## <a name="azure-site-recovery-limits"></a>Ограничения Azure Site Recovery
В таблице ниже приведены ограничения Site Recovery. Эти ограничения получены на основе проверок, но они не охватывают все возможные сочетания операций ввода-вывода в приложении. Фактические результаты зависят от сочетания операций ввода-вывода приложения. Чтобы получить более точные сведения о производительности приложения, выполните расширенное тестирование приложения с помощью тестовой отработки отказа.
 
**Целевой объект хранилища репликации** | **Средний размер ввода-вывода на исходной виртуальной машине** |**Среднее время обработки данных на исходной виртуальной машине** | **Общий размер обработанных данных на исходной виртуальной машине за день**
---|---|---|---
Хранилище уровня "Стандартный" | 8 КБ | 2 МБ/с на виртуальную машину | 168 ГБ на виртуальную машину
Хранилище уровня "Премиум" | 8 КБ  | 5 МБ/с на виртуальную машину | 421 ГБ на виртуальную машину
Хранилище уровня "Премиум" | 16 КБ или выше| 20 МБ/с на виртуальную машину | 1684 ГБ на виртуальную машину

В указанных ограничениях по средним значениям предполагается 30-процентное перекрытие операций ввода-вывода. В зависимости от коэффициента перекрытия, размера записи и фактической рабочей нагрузки ввода-вывода Site Recovery может обрабатывать более высокую пропускную способность. В приведенных выше значениях предполагается, что длина очереди невыполненной работы составляет примерно 5 минут, то есть после передачи выполняется обработка данных, а созданная точка восстановления составляет пять минут.

## <a name="on-premises-storage-requirement"></a>Требования к локальному хранилищу

На листе содержится требование к общему свободному пространству для хранения для каждого тома серверов Hyper-V (где находятся виртуальные жесткие диски) для успешной начальной и разностной репликации. Перед включением репликации добавьте необходимое дисковое пространство в томах, чтобы убедиться, что репликация не вызывает нежелательных простоев рабочих приложений. 

  Планировщик развертывания Site Recovery определяет требование к оптимальному объему для хранения, исходя из размера виртуальных жестких дисков и пропускной способности сети, используемой для репликации.

![Требования к локальному хранилищу](media/hyper-v-deployment-planner-analyze-report/on-premises-storage-requirement-h2a.png)

### <a name="why-do-i-need-free-space-on-the-hyper-v-server-for-the-replication"></a>Почему необходимо свободное место на сервере Hyper-V для репликации?
* При включении репликации виртуальной машины Site Recovery создает моментальный снимок каждого виртуального жесткого диска виртуальной машины для начальной репликации. Во время начальной репликации приложение записывает новые изменения на диски. Site Recovery отслеживает эти изменения в файлах журналов, которые требуют дополнительного пространства. До завершения начальной репликации файлы журнала хранятся локально. 

    Если недостаточно места для файлов журнала и моментальных снимков (AVHDX), репликация переходит в режим повторной синхронизации и никогда не завершится. В худшем случае для начальной репликации потребуется 100 % дополнительного свободного пространства с учетом размера виртуального жесткого диска.
* После начальной репликации запускается разностная репликация. Site Recovery отслеживает эти изменения в файлах журналов, которые хранятся на томе, где находятся виртуальные жесткие диски виртуальной машины. Эти файлы журналов реплицируются в Azure с периодичностью, настроенной для копирования. Исходя из доступной пропускной способности, репликация файлов журналов в Azure занимает некоторое время. 

    Если недостаточно свободного места для хранения файлов журнала, репликация приостанавливается. Состояние репликации виртуальной машины изменится на состояние требования повторной синхронизации.
* Если пропускной способности сети недостаточно для отправки файлов журналов в Azure, они накапливаются на томе. В худшем случае, если файлы журналов занимают 50 % от размера виртуального жесткого диска, репликация виртуальной машины переходит в требуемое состояние повторной синхронизации. Для разностной репликации данных потребуется 50 % дополнительного свободного пространства с учетом размера виртуального жесткого диска.

**Hyper-V host** (Узел Hyper-V). Список профилируемых серверов Hyper-V. Если сервер входит в кластер Hyper-V, все узлы кластера группируются вместе.

**Volume (VHD path)** (Том (путь к виртуальному жесткому диску)). Каждый том узла Hyper-V с VHD-файлами или VHDX-файлами. 

**Free space available (GB)** (Доступное свободное пространство (ГБ)). Свободное место, доступное в томе.

**Общий объем хранилища, необходимый для тома (ГБ)**: общий объем свободного дискового пространства, необходимый для успешного выполнения начальной и разностной репликации. 

**Total additional storage to be provisioned on the volume for successful replication (GB)** (Общее дополнительное пространство, которое нужно подготовить в томе для успешной репликации (ГБ)). Рекомендуемое общее дополнительное пространство, которое необходимо подготовить в томе для успешной начальной и разностной репликации данных.

## <a name="initial-replication-batching"></a>Пакетная обработка для начальной репликации 

### <a name="why-do-i-need-initial-replication-batching"></a>Зачем нужна пакетная обработка начальной репликации?
Если обеспечивается защита всех виртуальных машин одновременно, требование к свободному пространству гораздо выше. Если пространства недостаточно, репликация виртуальных машин переходит в режим повторной синхронизации. Кроме того, требование к пропускной способности сети гораздо выше для успешной начальной репликации всех виртуальных машин одновременно. 

### <a name="initial-replication-batching-for-a-selected-rpo"></a>Пакетная обработка при начальной репликации для выбранного значения RPO
На этом листе предоставлены подробные сведения о каждом пакете для начальной репликации. Для каждого значения RPO создается отдельный лист по пакетной обработке IR. 

После выполнения рекомендаций по требованиям к локальному хранилищу для каждого тома вы можете ознакомиться с основными сведениями, необходимыми для репликации. Это список виртуальных машин, которые можно защитить в параллельном режиме. Виртуальные машины сгруппированы в одном пакете. Пакетов может быть несколько. Обеспечьте защиту виртуальных машин в порядке пакетов. Сначала следует обеспечить защиту виртуальных машин из пакета 1. После завершения начальной репликации обеспечьте защиту виртуальным машинам из пакета 2 и т. д. На этом листе можно просмотреть список пакетов и соответствующих виртуальных машин. 

![Сведения о пакетной обработке IR](media/hyper-v-deployment-planner-analyze-report/ir-batching-for-rpo-h2a.png)

![Сведения о дополнительной пакетной обработке IR](media/hyper-v-deployment-planner-analyze-report/ir-batching-for-rpo2-h2a.png)

### <a name="each-batch-provides-the-following-information"></a>Сведения о каждом пакете 
**Hyper-V host** (Узел Hyper-V). Узел Hyper-V виртуальной машины, защиту которой требуется обеспечить.

**Виртуальная машина**: виртуальная машина, которую необходимо защитить. 

**Комментарии.** Если для конкретного тома виртуальной машины требуется выполнить какие-либо действие, здесь указывается соответствующий комментарий. Например, если на томе недостаточно свободного места, в комментариях будет указано сообщение Add additional storage to protect this VM (Добавьте дополнительное пространство для защиты этой виртуальной машины).

**Volume (VHD path)** (Том (путь к виртуальному жесткому диску)). Имя тома, на котором находятся виртуальные жесткие диски виртуальной машины. 

**Свободное место на томе (ГБ)**: свободное дисковое пространство, доступное на томе виртуальной машины. При вычислении свободного места на томах учитывается дисковое пространство, используемое для разностной репликации виртуальных машин из предыдущих пакетов, виртуальные жесткие диски которых находятся на том же томе. 

Например, VM1, VM2 и VM3 размещаются на томе E:\VHDpath. Перед репликацией на томе есть 500 ГБ свободного места. VM1 входит в пакет 1, VM2 — в пакет 2 и VM3 — в пакет 3. Для VM1 доступно 500 ГБ свободного места. Свободное место для VM2 составляет 500 — место на диске, требуемое для разностной репликации для VM1. Если для разностной репликации данных VM1 требуется 300 ГБ дискового пространства, для VM2 будет доступно 500–300 ГБ = 200 ГБ. Аналогичным образом для разностной репликации VM2 потребуется 300 ГБ. Свободное место для VM3 составляет 200–300 ГБ = -100 ГБ.

**Storage required on the volume for initial replication (GB)** (Хранилище, необходимое на томе для начальной репликации (ГБ)). Свободное дисковое пространство, требуемое на томе для начальной репликации виртуальной машины.

**Требуемое хранилище для тома для разностной репликации (ГБ)**: объем свободного дискового пространства, необходимого для тома виртуальной машины для разностной репликации.

**Additional storage required based on deficit to avoid replication failure (GB)** (Дополнительное хранилище, необходимое при нехватке места во избежание сбоя репликации (ГБ)). Дополнительное пространство, требуемое на томе для виртуальной машины. Это максимальное значение свободного пространства для начальной и разностной репликации данных без учета свободного места, доступного в томе.

**Minimum bandwidth required for initial replication (Mbps)** (Минимальная пропускная способность, необходимая для начальной репликации (Мбит/с)). Минимальная пропускная способность, необходимая для начальной репликации виртуальной машины.

**Минимальная пропускная способность, необходимая для разностной репликации (Мбит/с)**: Минимальная пропускная способность, необходимая для разностной репликации для виртуальной машины.

### <a name="network-utilization-details-for-each-batch"></a>Подробные сведения об использовании сети для каждого пакета 
В каждой таблице пакета представлена сводка по использованию сети для пакета.

**Пропускная способность для пакетной** службы: пропускная способность, доступная для пакета, после рассмотрения разностной пропускной способности репликации предыдущего пакета.

**Approximate bandwidth available for initial replication of batch** (Приблизительная пропускная способность, доступная для начальной репликации пакета). Пропускная способность, доступная для начальной репликации виртуальных машин пакета. 

**Approximate bandwidth consumed for delta replication of batch** (Приблизительная пропускная способность, используемая для разностной репликации пакета). Пропускная способность, требуемая для разностной репликации виртуальных машин пакета. 

**Предполагаемое время начальной репликации для пакета (чч: мм)**: оценочное время начальной репликации в часах: минут.



## <a name="next-steps"></a>Дальнейшие действия
Подробнее об [оценке затрат](hyper-v-deployment-planner-cost-estimation.md).