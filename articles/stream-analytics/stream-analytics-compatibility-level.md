---
title: Уровни совместимости Azure Stream Analytics
description: Узнайте, как установить уровень совместимости для задания Azure Stream Analytics и основные изменения в последнем уровне совместимости.
author: enkrumah
ms.author: ebnkruma
ms.service: stream-analytics
ms.topic: conceptual
ms.date: 03/10/2020
ms.openlocfilehash: 8105988cd2036f44d214befad3365cf9ee96ee0d
ms.sourcegitcommit: 42a4d0e8fa84609bec0f6c241abe1c20036b9575
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "98015986"
---
# <a name="compatibility-level-for-azure-stream-analytics-jobs"></a>Уровень совместимости заданий Azure Stream Analytics

В этой статье описывается параметр уровня совместимости в Azure Stream Analytics. Stream Analytics — это управляемая служба с обычными обновлениями функций и повышением производительности. Большинство обновлений среды выполнения службы автоматически становятся доступными для конечных пользователей. 

Однако некоторые новые функции в службе могут привести к существенным изменениям, таким как изменение поведения существующего задания или изменение способа использования данных в выполняющихся заданиях. Можно предотвратить выполнение существующих заданий Stream Analytics без существенных изменений, оставляя параметр уровня совместимости ниже. Когда вы будете готовы к работе с последними поведениями среды выполнения, вы можете принять участие в этой функции, вызывая уровень совместимости. 

## <a name="choose-a-compatibility-level"></a>Выбор уровня совместимости

Уровень совместимости управляет поведением во время выполнения задания Stream Analytics. 

В настоящее время Azure Stream Analytics поддерживает три уровня совместимости:

* 1,0 — исходный уровень совместимости, представленный во время общей доступности Azure Stream Analytics несколько лет назад.
* 1,1 — Предыдущее поведение
* 1,2 — самое новое поведение с самыми последними улучшениями

При создании нового Stream Analytics задания рекомендуется создать его с использованием последнего уровня совместимости. Приступите к разработке заданий, посвященной последним поведениям, чтобы избежать добавления изменений и сложности позже.

## <a name="set-the-compatibility-level"></a>Установка уровня совместимости

Можно задать уровень совместимости для задания Stream Analytics в портал Azure или с помощью [вызова REST API задания](/rest/api/streamanalytics/2016-03-01/streamingjobs/createorreplace#compatibilitylevel).

Чтобы обновить уровень совместимости задания в портал Azure:

1. Используйте [портал Azure](https://portal.azure.com) , чтобы перейти к заданию Stream Analytics.
2. Перед обновлением уровня совместимости следует **прерывать** задание. Невозможно обновить уровень совместимости, если задание находится в состоянии выполняется.
3. Под заголовком **Настройка** выберите **уровень совместимости**.
4. Выберите нужное значение уровня совместимости.
5. Нажмите кнопку **сохранить** в нижней части страницы.

![Уровень совместимости Stream Analytics на портале Azure](media/stream-analytics-compatibility-level/stream-analytics-compatibility.png)

При обновлении уровня совместимости T-компилятор проверяет задание с помощью синтаксиса, соответствующего выбранному уровню совместимости.

## <a name="compatibility-level-12"></a>Уровень совместимости 1,2

На уровне совместимости 1,2 появились следующие основные изменения:

###  <a name="amqp-messaging-protocol"></a>Протокол обмена сообщениями AMQP

**уровень 1,2**. Azure Stream Analytics использует протокол обмена сообщениями [протокола расширенных очередей сообщений (AMQP)](../service-bus-messaging/service-bus-amqp-overview.md) для записи в очереди и разделы служебной шины. AMQP позволяет создавать кроссплатформенные гибридные приложения, использующие протокол открытого стандарта.

### <a name="geospatial-functions"></a>Геопространственные функции

**Предыдущие уровни:** Azure Stream Analytics использовались вычисления географического объекта.

**уровень 1,2:** Azure Stream Analytics позволяет вычислять геометрические географические координаты. В сигнатуре геопространственных функций нет изменений. Однако их семантика немного отличается, что позволяет более точно выполнять вычисления, чем раньше.

Azure Stream Analytics поддерживает индексирование геопространственных ссылочных данных. Ссылочные данные, содержащие геопространственные элементы, можно индексировать для более быстрого вычисления соединений.

Обновленные геопространственные функции обеспечивают полную выразительность геообъектного геопространственного формата (WKT). Можно указать другие геопространственные компоненты, которые ранее не поддерживались в геоjson.

Дополнительные сведения см. [в разделе обновления геопространственных функций в Azure Stream Analytics — облако и IOT Edge](https://azure.microsoft.com/blog/updates-to-geospatial-functions-in-azure-stream-analytics-cloud-and-iot-edge/).

### <a name="parallel-query-execution-for-input-sources-with-multiple-partitions"></a>Параллельное выполнение запросов для источников входных данных с несколькими секциями

**Предыдущие уровни:** Запросы Azure Stream Analytics требовали использования предложения PARTITION BY для параллельной обработки запросов во входных секциях источника.

**уровень 1,2:** Если логика запроса может быть параллельна во входных исходных секциях, Azure Stream Analytics создает отдельные экземпляры запросов и параллельно выполняет вычисления.

### <a name="native-bulk-api-integration-with-cosmosdb-output"></a>Собственная интеграция с массовым API с выходными данными CosmosDB

**Предыдущие уровни:** Поведение Upsert было *вставлено или объединено*.

**уровень 1,2:** Собственная интеграция с массовым интерфейсом API с выходными данными CosmosDB увеличивает пропускную способность и позволяет эффективно обрабатывать запросы на регулирование. Дополнительные сведения см. [на странице Azure Stream Analytics Output to Azure Cosmos DB](./stream-analytics-documentdb-output.md#improved-throughput-with-compatibility-level-12).

Поведение Upsert — *Вставить или заменить*.

### <a name="datetimeoffset-when-writing-to-sql-output"></a>DateTimeOffset при записи в выходные данные SQL

**Предыдущие уровни:** типы [DateTimeOffset](/sql/t-sql/data-types/datetimeoffset-transact-sql) были скорректированы по Гринвичу.

**уровень 1,2:** DateTimeOffset больше не корректируется.

### <a name="long-when-writing-to-sql-output"></a>Long при записи в выходные данные SQL

**Предыдущие уровни:** Значения были усечены на основе целевого типа.

**уровень 1,2:** Значения, которые не помещаются в целевой тип, обрабатываются в соответствии с политикой исходящих ошибок.

### <a name="record-and-array-serialization-when-writing-to-sql-output"></a>Сериализация записей и массивов при записи в выходные данные SQL

**Предыдущие уровни:** Записи были записаны как "Record", а массивы были записаны как "Array".

**уровень 1,2:** Записи и массивы сериализуются в формате JSON.

### <a name="strict-validation-of-prefix-of-functions"></a>Жесткое подтверждение префикса функций

**Предыдущие уровни:** Отсутствует определенная проверка префиксов функций.

**уровень 1,2:** Azure Stream Analytics имеет определенную проверку префиксов функций. Добавление префикса к встроенной функции приводит к ошибке. Например, `myprefix.ABS(…)` не поддерживается.

Добавление префикса к встроенным статистическим выражениям также приводит к ошибке. Например, `myprefix.SUM(…)` не поддерживается.

Использование префикса "System" для любых определяемых пользователем функций приводит к ошибке.

### <a name="disallow-array-and-object-as-key-properties-in-cosmos-db-output-adapter"></a>Запретить использование массивов и объектов в качестве ключевых свойств в выходном адаптере Cosmos DB

**Предыдущие уровни:** Типы массивов и объектов поддерживались как ключевые свойства.

**уровень 1,2:** Типы массивов и объектов больше не поддерживаются в качестве ключевого свойства.

## <a name="compatibility-level-11"></a>Уровень совместимости 1,1

На уровне совместимости 1.1 представлены следующие основные изменения:

### <a name="service-bus-xml-format"></a>Формат служебной шины XML

**уровень 1,0:** Azure Stream Analytics использовало DataContractSerializer, поэтому содержимое сообщения включало XML-теги. Пример:

`@\u0006string\b3http://schemas.microsoft.com/2003/10/Serialization/\u0001{ "SensorId":"1", "Temperature":64\}\u0001`

**уровень 1,1:** Содержимое сообщения содержит поток непосредственно без дополнительных тегов. Пример: `{ "SensorId":"1", "Temperature":64}`

### <a name="persisting-case-sensitivity-for-field-names"></a>Учет регистра в именах полей

**уровень 1,0:** Имена полей были изменены в нижний регистр при обработке подсистемой Azure Stream Analytics.

**уровень 1,1.** учет регистра учитывается в именах полей, когда они обрабатываются подсистемой Azure Stream Analytics.

> [!NOTE]
> Возможность учета регистра еще не доступна для заданий Stream Analytics, размещенных с использованием среды IoT Edge. Поэтому, если задание размещено в IoT Edge, все имена полей преобразуются в нижний регистр.

### <a name="floatnandeserializationdisabled"></a>FloatNaNDeserializationDisabled

**уровень 1,0:** CREATE TABLE команда не фильтрует события со значением NaN (нечисловым). например Infinity, -Infinity) в типе столбца FLOAT, так как они не соответствуют задокументированному диапазону этих номеров.

**уровень 1,1:** CREATE TABLE позволяет указать строгую схему. Обработчик Stream Analytics проверяет соответствие данных этой схеме. С помощью этой модели команда может фильтровать события со значениями NaN.

### <a name="disable-automatic-conversion-of-datetime-strings-to-datetime-type-at-ingress-for-json"></a>Отключение автоматического преобразования строк DateTime в тип DateTime при входе для JSON

**уровень 1,0:** Средство синтаксического анализа JSON автоматически преобразует строковые значения со сведениями о дате, времени или зоне в тип DATETIME, чтобы значение немедленно потеряло исходное форматирование и сведения о часовом поясе. Так как это делается на входе, даже если это поле не было использовано в запросе, оно преобразуется в дату и время в формате UTC.

**уровень 1,1:** Не существует автоматического преобразования строковых значений со сведениями о дате, времени или зоне в тип DATETIME. В результате сохраняются сведения о часовом поясе и исходное форматирование. Однако если поле NVARCHAR (MAX) используется в запросе как часть выражения DATETIME (например, функция DATEADD), оно преобразуется в тип DATETIME для выполнения вычислений и теряет исходную форму.

## <a name="next-steps"></a>Дальнейшие действия

* [Устранение неполадок с входными подключениями](stream-analytics-troubleshoot-input.md)
* [Stream Analytics работоспособности ресурсов](./stream-analytics-troubleshoot-query.md)