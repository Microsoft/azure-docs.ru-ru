---
title: Использование управляемых удостоверений для доступа к концентратору событий из задания Azure Stream Analytics (Предварительная версия)
description: В этой статье описывается, как использовать управляемые удостоверения для проверки подлинности задания Azure Stream Analytics в входных и выходных данных концентраторов событий Azure.
author: sidramadoss
ms.author: sidram
ms.service: stream-analytics
ms.topic: how-to
ms.date: 01/04/2021
ms.openlocfilehash: 4dc718f21f2ef3beabc31821bd60b571ac07be05
ms.sourcegitcommit: 42a4d0e8fa84609bec0f6c241abe1c20036b9575
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "98018757"
---
# <a name="use-managed-identities-to-access-event-hubfrom-an-azure-stream-analytics-job-preview"></a>Использование управляемых удостоверений для доступа к концентратору событий из задания Azure Stream Analytics (Предварительная версия)

Azure Stream Analytics поддерживает проверку подлинности управляемого удостоверения для входных и выходных данных концентраторов событий Azure. Управляемые удостоверения устраняют ограничения методов проверки подлинности на основе пользователей, например необходимость повторной проверки подлинности из-за изменения пароля или истечения срока действия маркера пользователя каждые 90 дней. При устранении необходимости в ручной проверке подлинности ваши развертывания Stream Analytics можно полностью автоматизировать.  

Управляемое удостоверение — это зарегистрированное в Azure Active Directory управляемое приложение, представляющее данное задание Stream Analytics. Управляемое приложение используется для проверки подлинности на целевом ресурсе, включая концентраторы событий, которые находятся за брандмауэром или виртуальной сетью (VNet). Дополнительные сведения о том, как обходить брандмауэры, см. в разделе [разрешение доступа к пространствам имен концентраторов событий Azure через частные конечные точки](../event-hubs/private-link-service.md#trusted-microsoft-services).

В этой статье показано, как включить управляемое удостоверение для входных или выходных данных концентраторов событий в Stream Analyticsном задании с помощью портал Azure.Перед включением управляемого удостоверения необходимо сначала установить Stream Analytics задание и ресурс концентратора событий.

### <a name="limitation"></a>Ограничение
Во время предварительной версии ввод выборки из концентраторов событий на портал Azure не будет работать при использовании режима проверки подлинности управляемого удостоверения.

## <a name="create-a-managedidentity"></a>Создание управляемого удостоверения  

Сначала вы создадите управляемое удостоверение для задания Azure Stream Analytics.  

1. В портал Azure откройте задание Azure Stream Analytics.  

1. В меню навигации слева выберите **управляемое удостоверение**,   расположенное в разделе *Настройка*. Затем установите флажок **использовать управляемое системой удостоверение**   и нажмите кнопку **сохранить**.

   :::image type="content" source="media/event-hubs-managed-identity/system-assigned-managed-identity.png" alt-text="Управляемое удостоверение, назначенное системой":::  

1. Субъект-служба для удостоверения Stream Analytics задания создается в Azure Active Directory. Жизненный цикл созданного удостоверения управляется Azure. При удалении задания Stream Analytics Azure автоматически удаляет связанное удостоверение (то есть субъект-службу).  

   Если конфигурация сохраняется, идентификатор объекта (OID) субъекта-службы отображается в качестве идентификатора субъекта, как показано ниже:  

   :::image type="content" source="media/event-hubs-managed-identity/principal-id.png" alt-text="Идентификатор субъекта":::

   Субъект-служба имеет то же имя, что и задание Stream Analytics. Например, если задано имя задания  `MyASAJob` , также будет использоваться имя субъекта-службы  `MyASAJob` .  

## <a name="grant-the-stream-analytics-job-permissionsto-access-the-event-hub"></a>Предоставление разрешений на Stream Analytics заданием доступа к концентратору событий

Чтобы Stream Analytics заданием получать доступ к концентратору событий с помощью управляемого удостоверения, у созданного субъекта-службы должны быть специальные разрешения для концентратора событий.

1. Перейдите в раздел **Управление доступом (IAM)** в концентраторе событий.

1. Выберите **+ Добавить** и **добавить назначение ролей**.

1. На странице **Добавление назначения ролей** введите следующие параметры.

   |Параметр|Значение|
   |---------|-----|
   |Роль|Владелец данных Центров событий Azure|
   |Назначение доступа для|Пользователь, группа или субъект-служба|
   |Выберите пункт|Введите имя задания Stream Analytics|

   :::image type="content" source="media/event-hubs-managed-identity/add-role-assignment.png" alt-text="Добавление назначения роли":::

1. Выберите **сохранить** и подождите минуту или, чтобы изменения распространялись.

Эту роль можно также предоставить на уровне пространства имен концентратора событий, который будет естественным образом распространять разрешения для всех концентраторов событий, созданных в нем. То есть все концентраторы событий в пространстве имен можно использовать в качестве ресурса проверки подлинности управляемого удостоверения в задании Stream Analytics.

## <a name="create-anevent-hub-input-or-output"></a>Создание входных или выходных данных концентратора событий  

Теперь, когда вы настроили управляемое удостоверение, вы можете добавить ресурс концентратора событий в качестве входных или выходных данных для задания Stream Analytics.  

### <a name="add-the-event-hub-as-an-input"></a>Добавление концентратора событий в качестве входных данных 

1. Перейдите к заданию Stream Analytics и перейдите на страницу **входные данные** в разделе **топология задания**.

1. Выберите **добавить поток входных данных > концентратор событий**. В окне входные свойства найдите и выберите свой концентратор событий и выберите **управляемое удостоверение** из раскрывающегося меню *режим проверки подлинности* .

1. Заполните остальные свойства и нажмите кнопку **сохранить**.

### <a name="add-the-event-hub-as-an-output"></a>Добавление концентратора событий в качестве выходных данных

1. Перейдите к заданию Stream Analytics и перейдите на страницу **выходные данные** в разделе **топология задания**.

1. Выберите **добавить > концентратор событий**. В окне свойства вывода найдите и выберите свой концентратор событий и выберите **управляемое удостоверение** из раскрывающегося меню *режим проверки подлинности* .

1. Заполните остальные свойства и нажмите кнопку **сохранить**.

## <a name="next-steps"></a>Дальнейшие действия

* [Выходные данные концентраторов событий из Azure Stream Analytics](event-hubs-output.md)
* [Потоковая передача данных из Центров событий](stream-analytics-define-inputs.md#stream-data-from-event-hubs)
