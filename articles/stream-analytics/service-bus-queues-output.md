---
title: Выходные данные очередей служебной шины из Azure Stream Analytics
description: В этой статье описываются очереди служебной шины в качестве выходных данных для Azure Stream Analytics.
author: enkrumah
ms.author: ebnkruma
ms.service: stream-analytics
ms.topic: conceptual
ms.date: 09/23/2020
ms.openlocfilehash: ad5bb90a0df68cc6c1c230c234c1f695312da3d8
ms.sourcegitcommit: 867cb1b7a1f3a1f0b427282c648d411d0ca4f81f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/20/2021
ms.locfileid: "102451785"
---
# <a name="service-bus-queues-output-from-azure-stream-analytics"></a>Выходные данные очередей служебной шины из Azure Stream Analytics

[Очереди служебной шины](../service-bus-messaging/service-bus-queues-topics-subscriptions.md) доставляют сообщения конкурирующим потребителям по типу FIFO. Как правило, сообщения принимаются и обрабатываются получателями в том порядке, в котором они были добавлены в очередь. Каждое сообщение получается и обрабатывается только одним объектом-получателем сообщения.

На [уровне совместимости 1.2](stream-analytics-compatibility-level.md) Azure Stream Analytics использует для записи в очереди и разделы служебной шины протокол передачи сообщений [AMQP](../service-bus-messaging/service-bus-amqp-overview.md). AMQP позволяет создавать кроссплатформенные гибридные приложения, использующие протокол открытого стандарта.

## <a name="output-configuration"></a>Конфигурация выходных данных

В таблице ниже приведены имена и описание свойств для создания выходных данных очереди.

| Имя свойства | Описание |
| --- | --- |
| Псевдоним выходных данных |Понятное имя, которое используется в запросах для направления выходных данных запроса в очередь служебной шины. |
| Пространство имен служебной шины |Контейнер для набора сущностей обмена сообщениями. |
| Имя очереди |Имя очереди служебной шины. |
| Имя политики очереди |При создании очереди можно также создать политики общего доступа на вкладке **Настройка** очереди. Каждой политике общего доступа присваивается имя, а также для нее задаются разрешения и ключи доступа. |
| Ключ политики очереди |Ключ общего доступа, используемый для аутентификации доступа к пространству имен Служебной шины. |
| Формат сериализации событий |Формат сериализации для выходных данных. Поддерживаются форматы JSON, CSV и Avro. |
| Кодирование |В настоящее время единственным поддерживаемым форматом кодирования файлов CSV и JSON является UTF-8. |
| Разделитель |Применяется только для сериализации в формате CSV. Служба Stream Analytics позволяет использовать ряд распространенных разделителей для сериализации данных в формате CSV. Поддерживаются такие разделители: запятая, точка с запятой, пробел, табуляция и вертикальная черта. |
| Формат |Применимо только для типа JSON. Вариант **строки-разделители** предусматривает форматирование выходных данных таким образом, что каждый объект JSON будет отделен новой строкой. Если выбрать вариант **строки-разделители**, то JSON считывает по одному объекту за раз. Все содержимое само по себе не будет допустимым форматом JSON. Вариант **массив** означает, что выходные данные будут отформатированы как массив объектов JSON. |
| Столбцы свойств | Необязательный параметр. Столбцы с разделителями-запятыми, которые необходимо присоединить как пользовательские свойства исходящего сообщения вместо полезных данных. Дополнительные сведения об этой функции см. в разделе [Свойства пользовательских метаданных для выходных данных](#custom-metadata-properties-for-output). |
| Столбцы системных свойств | Необязательный параметр. Пары "ключ-значение" системных свойств и соответствующих имен столбцов, которые необходимо присоединить к исходящему сообщению вместо полезных данных.  |

Количество разделов [основано на размере и номере SKU служебной шины](../service-bus-messaging/service-bus-partitioning.md). Ключ раздела — это уникальное целое значение для каждого раздела.

## <a name="partitioning"></a>Секционирование

Секционирование выбирается автоматически. Количество разделов [основано на размере и номере SKU служебной шины](../service-bus-messaging/service-bus-partitioning.md). Ключ раздела — это уникальное целое значение для каждого раздела. Число модулей записи вывода совпадает с количеством секций в очереди вывода.

## <a name="output-batch-size"></a>Размер выходного пакета

Максимальный размер сообщения — 256 КБ на сообщение для уровня "Стандартный" и 1 МБ для уровня "Премиум". Дополнительные сведения см. в разделе [ограничения служебной шины](../service-bus-messaging/service-bus-quotas.md). Для оптимизации используйте одно событие для каждого сообщения.

## <a name="custom-metadata-properties-for-output"></a>Свойства пользовательских метаданных для выходных данных

Столбцы запросов можно прикреплять к исходящим сообщениям как пользовательские свойства. Эти столбцы не переходят в полезные данные. Свойства представлены в виде словаря в выходном сообщении. *Ключ* — это имя столбца, а *значение* — это значение столбца в словаре свойств. Поддерживаются все типы данных Stream Analytics, кроме записи и массива.

В следующем примере поля `DeviceId` и `DeviceStatus` добавляются в метаданные.

1. Используйте следующий запрос:

   ```sql
   select *, DeviceId, DeviceStatus from iotHubInput
   ```

1. Настройте `DeviceId,DeviceStatus` в выходных данных столбцы свойств.

   :::image type="content" source="media/service-bus-queues-output/property-columns.png" alt-text="Столбцы свойств":::

На следующем рисунке изображены ожидаемые свойства выходного сообщения, проверенные в EventHub с помощью [обозревателя служебной шины](https://github.com/paolosalvatori/ServiceBusExplorer).

:::image type="content" source="media/service-bus-queues-output/custom-properties.png" alt-text="Настраиваемые свойства события":::

## <a name="system-properties"></a>Свойства системы

Столбцы запросов можно присоединять как [системные свойства](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#properties) к исходящим сообщениям очереди или раздела служебной шины.

Эти столбцы не попадают в полезные данные, а соответствующее [системное свойство](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#properties) BrokeredMessage заполняется значениями столбцов запроса.
Эти системные свойства поддерживаются — `MessageId, ContentType, Label, PartitionKey, ReplyTo, SessionId, CorrelationId, To, ForcePersistence, TimeToLive, ScheduledEnqueueTimeUtc`.

Строковые значения этих столбцов анализируются как соответствующие типы значений системных свойств, а все ошибки синтаксического анализа обрабатываются как ошибки данных.
Это поле предоставляется в формате объекта JSON. Ниже приведены сведения об этом формате.

* Заключаются в фигурные скобки {}.
* Записываются в виде пар "ключ — значение".
* Ключи и значения должны быть строковыми.
* Ключ — это имя системного свойства, а значение — имя столбца запроса.
* Ключи и значения разделяются двоеточием.
* Каждая пара "ключ — значение" разделяется запятой.

В этом примере показано, как использовать это свойство —

* Запрос: `select *, column1, column2 INTO queueOutput FROM iotHubInput`
* Столбцы системных свойств: `{ "MessageId": "column1", "PartitionKey": "column2"}`

Задает `MessageId` в сообщениях очереди служебной шины со значениями `column1`, а для PartitionKey задаются значения `column2`.

## <a name="next-steps"></a>Дальнейшие действия

* [Краткое руководство. по созданию задания Stream Analytics с помощью портала Azure](stream-analytics-quick-create-portal.md)
* [Краткое руководство. Создание задания Azure Stream Analytics с помощью Azure CLI](quick-create-azure-cli.md)
* [Краткое руководство. Создание задания Azure Stream Analytics с помощью шаблона ARM](quick-create-azure-resource-manager.md)
* [Краткое руководство. Создание задания Stream Analytics с помощью Azure PowerShell](stream-analytics-quick-create-powershell.md)
* [Краткое руководство. Создание задания Azure Stream Analytics с помощью Visual Studio](stream-analytics-quick-create-vs.md)
* [Краткое руководство. Создание задания Azure Stream Analytics в Visual Studio Code](quick-create-visual-studio-code.md)