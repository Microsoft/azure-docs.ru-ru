---
title: Рекомендации по хранению и резервному копированию
titleSuffix: Azure Kubernetes Service
description: Рекомендации для оператора кластера по хранению, шифрованию данных и резервному копированию в Службе Azure Kubernetes (AKS)
services: container-service
ms.topic: conceptual
ms.date: 5/6/2019
ms.openlocfilehash: 722fe393ad7637be20360463a4c3b6234224a036
ms.sourcegitcommit: 772eb9c6684dd4864e0ba507945a83e48b8c16f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "88653976"
---
# <a name="best-practices-for-storage-and-backups-in-azure-kubernetes-service-aks"></a>Рекомендации по хранению и резервному копированию в Службе Azure Kubernetes (AKS)

Приложениям часто требуется хранить данные в кластерах, созданных и управляемых в Службе Azure Kubernetes (AKS). Важно понимать, какие существуют потребности в производительности и методах доступа для групп pod, чтобы предоставить приложениям подходящие варианты хранилища. Выбор хранилища может зависеть от размера узла AKS. Также следует продумать методы резервного копирования и протестировать процессы восстановления для подключенного хранилища.

Эта статья содержит рекомендации по выбору хранилища для операторов кластера. В этой статье раскрываются следующие темы.

> [!div class="checklist"]
> * Какие доступны типы хранилища
> * Как правильно выбирать размер узлов AKS для оптимальной производительности хранилища
> * Чем различаются динамическая и статическая подготовка томов
> * Методы резервного копирования и защиты для томов данных

## <a name="choose-the-appropriate-storage-type"></a>Выбор подходящего типа хранилища

**Советы и рекомендации**. Выясните потребности приложения, чтобы выбрать правильное хранилище. Высокопроизводительное хранилище на твердотельных накопителях хорошо подходит для нагрузок в рабочей среде. Хранилище на сетевой основе предпочтительно, когда требуется нескольких одновременных подключений.

Приложениям часто требуется сразу несколько хранилищ разных типов и с разной скоростью работы. Нужно ли вашим приложениям хранилище, которое подключается к отдельным группам pod или которое используется несколькими группами pod совместно? Достаточно ли доступа к данным только для чтения, или требуется запись больших объемов структурированных данных? Такие потребности позволяют определить наиболее подходящий тип хранилища.

В следующей таблице описаны доступные типы хранилищ и их возможности.

| Вариант использования | Подключаемый модуль тома | Для чтения и записи, индивидуально | Только для чтения, совместно | Для чтения и записи, совместно | Поддержка контейнеров Windows Server |
|----------|---------------|-----------------|----------------|-----------------|--------------------|
| Конфигурация совместного использования       | Файлы Azure   | Да | Да | Да | Да |
| Структурированные данные приложения        | Диски Azure   | Да | Нет  | Нет  | Да |
| Неструктурированные данные, операции файловой системы | [BlobFuse][blobfuse] | Да | Да | Да | Нет |

Два основных типа хранилища, предоставляемые для томов в Службе контейнеров Azure, основаны на службах дисков или хранилища файлов Azure. Чтобы повысить безопасность, оба типа хранилища по умолчанию используют Шифрование службы хранилища Azure (SSE), которое шифрует данные при хранении. Сейчас диски нельзя шифровать с помощью шифрования дисков Azure на уровне узлов Службы контейнеров Azure.

Файлы Azure и диски Azure доступны на уровнях производительности "Стандартный" и "Премиум":

- Диски ценовой категории *Премиум* работают на высокопроизводительных твердотельных накопителях (SSD). Для всех производственных рабочих нагрузок мы рекомендуем использовать диски ценовой категории "Премиум".
- Диски ценовой категории *Стандартный* работают на обычных вращающихся жестких дисках (HDD). Это хороший вариант для архивного хранения или для редко используемых данных.

Чтобы выбрать правильный уровень хранилища, важно понимать требования к производительности приложения и шаблоны доступа. См. дополнительные сведения о [размерах и производительности Управляемых дисков Azure][managed-disks].

### <a name="create-and-use-storage-classes-to-define-application-needs"></a>Создание и использование классов хранения для определения требований приложения

Тип используемого хранилища определяется в *классах хранения* Kubernetes. Затем класс хранения указывается в спецификации группы pod или развертывания. Сочетание этих определений используется для создания соответствующего хранилища и его подключения к группе pod. Дополнительные сведения см. в описании [классов хранения в AKS][aks-concepts-storage-classes].

## <a name="size-the-nodes-for-storage-needs"></a>Размер узлов в соответствии с требованиями к хранилищу

**Наилучший вариант**. Размер каждого узла определяет максимально допустимое число дисков. Также узлы разных размеров также предоставляют разные объемы локального хранилища и разную пропускную способность сети. Учитывайте потребности вашего приложения и выберите правильный размер узлов для развертывания.

Узлы AKS выполняются в виде виртуальных машин Azure. Доступны виртуальные машины разных типов и размеров. Каждый размер виртуальной машины предоставляет разный объем базовых ресурсов, например ЦП и памяти. Для каждого размера виртуальной машины существует ограничение на число подключаемых дисков. Производительность хранилища также зависит от выбранного размера виртуальных машин. Она ограничивает число операций ввода-вывода в секунду для локальных и подключенных дисков.

Если для приложения в качестве решения хранилища выбраны диски Azure, оцените и выберите соответствующий размер узла виртуальной машины. Объем ресурсов ЦП и памяти — это не единственные факторы при выборе размера виртуальной машины. Не менее важны и возможности хранилища. Например, размеры виртуальных машин *Standard_B2ms* и *Standard_DS2_v2* предоставляют аналогичный объем ресурсов ЦП и памяти. Но их потенциальная производительность существенно отличается, как видно из следующей таблицы.

| Тип и размер узла | vCPU | Память, ГиБ | Максимальное число дисков данных | Максимальное число некэшированных дисковых операций ввода-вывода в секунду | Максимальная некэшированнае пропускная способность (Мбит/с) |
|--------------------|------|--------------|----------------|------------------------|--------------------------------|
| Standard_B2ms      | 2    | 8            | 4              | 1920                  | 22,5                           |
| Standard_DS2_v2    | 2    | 7            | 8              | 6400                  | 96                             |

Здесь видно, что *Standard_DS2_v2* поддерживает вдвое больше подключенных дисков и предоставляет в три-четыре раза больше операций ввода-вывода в секунду, то есть большую пропускную способность диска. Если при выборе учитывать только основные вычислительные ресурсы и стоимость, вы можете ошибиться с выбором размера виртуальной машины *Standard_B2ms*, что приведет к низкой производительности и ограничениям хранилища. Свяжитесь с группой разработки приложения и совместно с ними оцените требования е емкости и производительности хранилища. Выберите подходящий размер виртуальной машины для узла AKS, который удовлетворяет или даже превосходят эти требования к производительности. Регулярно оценивайте работу приложений, чтобы скорректировать размер виртуальной машины, когда это потребуется.

См. дополнительные сведения о [размерах виртуальных машин Linux в Azure][vm-sizes].

## <a name="dynamically-provision-volumes"></a>Динамическая подготовка томов

**Наилучший вариант**. Чтобы снизить расходы на управление и обеспечить возможность масштабирования, не используйте статически созданные и назначенные постоянные тома. Используйте динамическую подготовку. Определите в классах хранения правильную политику освобождения, чтобы свести к минимуму лишние затраты на хранилище после удаления групп pod.

Когда потребуется подключить хранилище к группам pod, используйте постоянные тома. Эти постоянные тома можно создавать динамически или вручную. Создание постоянных томов вручную повышает расходы на управление и ограничивает возможности масштабирования. Динамическая подготовка постоянных томов упрощает управление хранилищем и позволяет приложениям увеличиваться и масштабироваться по мере необходимости.

![Утверждения постоянного тома в кластере AKS](media/concepts-storage/persistent-volume-claims.png)

Утверждение постоянного тома позволяет динамически создавать хранилища, когда они потребуются. Базовые диски Azure создаются только при получении запроса от групп pod. В определении Pod вы запрашиваете том, который будет создан и подключен к назначенному пути подключения.

Основные концепции динамического создания и использования томов см. в описании [утверждений постоянного тома][aks-concepts-storage-pvcs].

Чтобы ознакомиться с работой этих томов, просмотрите руководства по динамическому созданию и использованию постоянных томов для [дисков Azure][dynamic-disks] или [хранилища файлов][dynamic-files].

Как часть определений классов хранения задайте правильную политику освобождения (*reclaimPolicy*). Эта политика reclaimPolicy управляет поведением базового ресурса хранилища Azure, когда pod удаляется и постоянный том может больше не требоваться. Базовый ресурс хранилища можно удалить или сохранить для использования другим pod в будущем. В политике reclaimPolicy можно выбрать режим *retain* или *delete*. Выясните потребности приложения и регулярно проводите проверки сохраняемого объема хранилища, чтобы снизить затраты на неиспользуемое хранилище.

Дополнительные сведения о параметрах классов хранилища см. в описании [политик освобождения хранилища][reclaim-policy].

## <a name="secure-and-back-up-your-data"></a>Защита и резервное копирование данных

**Рекомендации —** резервное копирование данных с помощью соответствующего средства для хранилища, такого как велеро или Azure Backup. Проверяйте целостность и безопасность этих резервных копий.

Если приложения хранят и используют данные на постоянных дисках или в файлах, следует регулярно выполнять резервное копирование или моментальные снимки этих данных. Диски Azure предоставляют встроенные технологии создания моментальных снимков. Перед выполнением операции моментального снимка может потребоваться найти приложения, чтобы записать записи на диск. [Велеро][velero] может создавать резервные копии постоянных томов вместе с дополнительными ресурсами кластера и конфигурациями. Если вы не можете [запретить учет состояния в приложениях][remove-state], создавайте резервные копии данных из постоянных томов и регулярно проверяйте операции восстановления, чтобы гарантировать целостность данных и надежность процессов.

Выясните ограничения разных подходов к резервному копированию данных и оцените необходимость замораживать данные перед созданием моментального снимка. Резервные копии данных не всегда позволят восстановить среду приложения в кластерном развертывании. Дополнительные сведения об этих сценариях см. в руководстве по [обеспечению непрерывности бизнеса и аварийного восстановления в AKS][best-practices-multi-region].

## <a name="next-steps"></a>Дальнейшие действия

Эта статья посвящена рекомендациям по организации хранения в Службе контейнеров Azure. Дополнительные сведения об основах хранения в Kubernetes см. в статье [Возможности хранения данных в Службе Azure Kubernetes (AKS)][aks-concepts-storage].

<!-- LINKS - External -->
[velero]: https://github.com/heptio/velero
[blobfuse]: https://github.com/Azure/azure-storage-fuse

<!-- LINKS - Internal -->
[aks-concepts-storage]: concepts-storage.md
[vm-sizes]: ../virtual-machines/sizes.md
[dynamic-disks]: azure-disks-dynamic-pv.md
[dynamic-files]: azure-files-dynamic-pv.md
[reclaim-policy]: concepts-storage.md#storage-classes
[aks-concepts-storage-pvcs]: concepts-storage.md#persistent-volume-claims
[aks-concepts-storage-classes]: concepts-storage.md#storage-classes
[managed-disks]: ../virtual-machines/managed-disks-overview.md
[best-practices-multi-region]: operator-best-practices-multi-region.md
[remove-state]: operator-best-practices-multi-region.md#remove-service-state-from-inside-containers
