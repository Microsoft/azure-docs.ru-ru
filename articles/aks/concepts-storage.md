---
title: Основные понятия хранения данных в Службе Azure Kubernetes (AKS)
description: Узнайте о хранении данных в Службе Azure Kubernetes (AKS), включая тома, постоянные тома, классы хранилищ и утверждения.
services: container-service
ms.topic: conceptual
ms.date: 08/17/2020
ms.openlocfilehash: bf910c66694a62505f259c0a95a88f7dfed05d19
ms.sourcegitcommit: 910a1a38711966cb171050db245fc3b22abc8c5f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "98127963"
---
# <a name="storage-options-for-applications-in-azure-kubernetes-service-aks"></a>Возможности хранения данных в Службе Azure Kubernetes (AKS)

Приложениям, работающим в Службе Azure Kubernetes (AKS), может потребоваться хранить и извлекать данные. Для некоторых рабочих нагрузок приложений можно использовать быстрое локальное хранилище данных на узле, которое не требуется после удаления элементов pod. Другим рабочим нагрузкам приложений может требоваться постоянное хранилище на обычных томах данных, размещенных на платформе Azure. Нескольким элементам pod может потребоваться совместно использовать одни тома данных или повторно подключать тома данных, если pod перенесен на другой узел. Наконец, может потребоваться внедрить конфиденциальные данные или данные конфигурации приложения в элементы pod.

![Возможности хранения данных для приложений в кластере AKS](media/concepts-storage/aks-storage-options.png)

В этой статье приводится обзор ключевых понятий хранения данных приложений в AKS:

- [Тома](#volumes)
- [Постоянные тома](#persistent-volumes)
- [Классы хранения в C](#storage-classes)
- [утверждения постоянного тома](#persistent-volume-claims).

## <a name="volumes"></a>Тома

Приложениям часто нужна возможность хранить и извлекать данные. Так как Kubernetes обычно рассматривает отдельные pod как временные, высвобождаемые ресурсы, доступны различные подходы для использования и хранения данных приложений. *Тома* представляет способ хранения, извлечения и сохранения данных элементов pod на протяжении жизненного цикла приложения.

Традиционные тома для хранения и извлечения данных создаются как ресурсы Kubernetes, обслуживаемые службой хранилища Azure. Можно вручную создавать эти тома данных и напрямую назначать их элементам pod или настроить Kubernetes для их автоматического создания. Эти тома данных могут использовать диски Azure или файлы Azure.

- *Диски Azure* можно использовать для создания ресурсов *DataDisk* в Kubernetes. Диски могут использовать службу хранилища Azure ценовой категории "Премиум" на основе высокопроизводительных дисков SSD или службу хранилища Azure ценовой категории "Стандартный" на основе обычных жестких дисков. Для большинства производственных рабочих нагрузок и рабочих нагрузок разработки следует использовать службу хранилища ценовой категории "Премиум". Диски Azure монтируются как *реадвритеонце*, поэтому доступны только для одного Pod. Для томов хранилища, к которым несколько модулей памяти могут одновременно получить доступ, используйте службу файлов Azure.
- *Файлы Azure* можно использовать для подключения к элементам pod общей папки SMB 3.0, размещенной в учетной записи хранения Azure. Служба файлов обеспечивает обмен данными между несколькими узлами и элементами pod. Файлы могут использовать хранилище Azure уровня "Стандартный", поддерживающее обычные жесткие диски или хранилище Azure класса Premium, с помощью высокопроизводительных твердотельных накопителей.

В Kubernetes тома могут представлять собой не просто традиционный диск, используемый для хранения и извлечения данных. Тома Kubernetes могут также применяться для внедрения в pod данных, используемых контейнерами. Распространенные дополнительные типы томов в Kubernetes приведены ниже.

- *emptyDir* — этот том обычно используется в качестве временного хранилища для pod. Все контейнеры в pod могут обращаться к данных в томе. Данные, записанные в том этого типа, хранятся только в течение времени существования pod. Этот том удаляется вместе с pod. Этот том обычно использует дисковый накопитель локального узла, хотя он также может существовать только в памяти узла.
- *Secret* — этот том используется для внедрения в pod конфиденциальных данных, например паролей. Сначала создается Secret с помощью API Kubernetes. При определении pod или развертывания можно запросить определенный Secret. Secret предоставляются только узлам, на которых запланирован запуск элемента pod, требующего этот Secret. Secret сохраняется в *tmpfs*, а не записывается на диск. При удалении с узла последнего pod, которому нужен секрет, данный Secret удаляется из tmpfs. Тома Secret хранятся в указанном пространстве имен и доступны только элементам pod в этом пространстве имен.
- *configMap* — этот тип тома используется для внедрения в элементы pod пар свойств "ключ-значение", например сведений о конфигурации приложения. Вместо того, чтобы определить данные конфигурации приложения в образе контейнера, их можно определить как ресурс Kubernetes, который можно легко обновлять и применять к новым экземплярам pod по мере их развертывания. Как и при использовании Secret, сначала следует создать ConfigMap с помощью API Kubernetes. Затем этот ConfigMap можно запросить при определении pod или развертывания. Тома ConfigMap хранятся в указанном пространстве имен и доступны только элементам pod в этом пространстве имен.

## <a name="persistent-volumes"></a>Постоянные тома

Тома, которые определяются и создаются в ходе жизненного цикла pod, существуют только до удаления pod. Нередко элементам pod нужно сохранить используемое ими хранилище, если pod переносится на другой узел во время события обслуживания, особенно в наборах с отслеживанием состояния. *Постоянный том* — это ресурс хранилища, для создания и управления которым используется API Kubernetes. Этот том может существовать после истечения времени существования отдельного pod.

Для работы постоянного тома используются диски или файлы Azure. Как отмечалось в предыдущем разделе о томах, выбор дисков или файлов часто определяется потребностью в параллельном доступе к данным или необходимым уровнем производительности.

![Постоянные тома в кластере AKS](media/concepts-storage/persistent-volumes.png)

Постоянный том может быть создан *статически* администратором кластера или может быть создан *динамически* сервером API Kubernetes. Если запланирован запуск элемента pod, запрашивающего хранилище, которое в настоящее время недоступно, Kubernetes может создать базовое хранилище на основе дисков или файлов Azure и подключить его к pod. Для динамической подготовки используется класс *StorageClass*. С его помощью можно определить, какой тип хранилища Azure необходимо создать.

## <a name="storage-classes"></a>Классы хранения

Чтобы определить различные ценовые категории хранилищ, например "Премиум" и "Стандартный", можно создать класс *StorageClass*. Кроме того, класс StorageClass определяет политику *reclaimPolicy*. Эта политика reclaimPolicy управляет поведением базового ресурса хранилища Azure, когда pod удаляется и постоянный том может больше не требоваться. Базовый ресурс хранилища можно удалить или сохранить для использования другим pod в будущем.

В AKS `StorageClasses` для кластера, использующего подключаемые модули хранилища в виде дерева, создаются четыре начальные.

- `default` — Использует хранилище Azure Стандардссд для создания управляемого диска. Политика reclaimа гарантирует, что базовый диск Azure будет удален при удалении постоянного тома, который использовался для удаления.
- `managed-premium` — Использует хранилище Azure класса Premium для создания управляемого диска. Политика повторного утверждения гарантирует, что базовый диск Azure будет удален при удалении постоянного тома, который использовался для удаления.
- `azurefile` — Использует хранилище Azure уровня "Стандартный" для создания файлового ресурса Azure. Политика reclaimа гарантирует, что базовый файловый ресурс Azure будет удален при удалении постоянного тома, который использовался для удаления.
- `azurefile-premium` — Использует хранилище Azure класса Premium для создания файлового ресурса Azure. Политика reclaimа гарантирует, что базовый файловый ресурс Azure будет удален при удалении постоянного тома, который использовался для удаления.

Для кластеров с использованием нового интерфейса хранилища контейнера (CSI) внешние подключаемые модули (Предварительная версия) создаются следующие дополнительные сведения `StorageClasses` :
- `managed-csi` — Использует локально избыточное хранилище Azure Стандардссд (LRS) для создания управляемого диска. Политика reclaimа гарантирует, что базовый диск Azure будет удален при удалении постоянного тома, который использовался для удаления. Класс хранения также настраивает постоянные тома для расширения, поэтому необходимо просто изменить утверждение Постоянного тома с новым размером.
- `managed-csi-premium` — Использует локально избыточное хранилище Azure Premium (LRS) для создания управляемого диска. Политика повторного утверждения гарантирует, что базовый диск Azure будет удален при удалении постоянного тома, который использовался для удаления. Аналогичным образом, этот класс хранения позволяет развертывать постоянные тома.
- `azurefile-csi` — Использует хранилище Azure уровня "Стандартный" для создания файлового ресурса Azure. Политика reclaimа гарантирует, что базовый файловый ресурс Azure будет удален при удалении постоянного тома, который использовался для удаления.
- `azurefile-csi-premium` — Использует хранилище Azure класса Premium для создания файлового ресурса Azure. Политика reclaimа гарантирует, что базовый файловый ресурс Azure будет удален при удалении постоянного тома, который использовался для удаления.

Если для постоянного тома не указан класс StorageClass, используется StorageClass по умолчанию. При запросе постоянных томов убедитесь, что они используют именно то хранилище, которое вам нужно. Можно создать класс StorageClass для удовлетворения дополнительных потребностей с помощью `kubectl`. В следующем примере используются управляемые диски ценовой категории "Премиум" и указывается, что при удалении pod базовый диск Azure должен быть *сохранен*.

```yaml
kind: StorageClass
apiVersion: storage.k8s.io/v1
metadata:
  name: managed-premium-retain
provisioner: kubernetes.io/azure-disk
reclaimPolicy: Retain
parameters:
  storageaccounttype: Premium_LRS
  kind: Managed
```

> [!NOTE]
> AKS согласовывает классы хранения по умолчанию и перезаписывает любые изменения, внесенные в эти классы хранения.

## <a name="persistent-volume-claims"></a>Утверждения постоянного тома

Утверждение PersistentVolumeClaim запрашивает хранилище на основе диска или файла, использующее определенный класс StorageClass, режим доступа и размер. Если ресурс для выполнения утверждения согласно определенному классу StorageClass отсутствует, сервер API Kubernetes может динамически подготовить базовый ресурс хранилища в Azure. Определение pod включает в себя подключение тома после его присоединения к pod.

![Утверждения постоянного тома в кластере AKS](media/concepts-storage/persistent-volume-claims.png)

Том PersistentVolume *привязывается* к утверждению PersistentVolumeClaim после назначения элементу pod запрашиваемого доступного ресурса хранилища. Постоянные тома и утверждения сопоставляются как один к одному.

В следующем примере YAML-файла манифеста показано утверждение постоянного тома, использующее класс StorageClass *managed-premium* и запрашивающее диск размером в *5 ГиБ*.

```yaml
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: azure-managed-disk
spec:
  accessModes:
  - ReadWriteOnce
  storageClassName: managed-premium
  resources:
    requests:
      storage: 5Gi
```

При создании определения pod указывается утверждение постоянного тома для запроса требуемого хранилища. Затем указывается подключение *volumeMount* для приложений, предназначенное для чтения и записи данных. В приведенном ниже примере YAML-файла манифеста показано, как предыдущее утверждение постоянного тома может использоваться для подключения тома в *azure/mnt/*.

```yaml
kind: Pod
apiVersion: v1
metadata:
  name: nginx
spec:
  containers:
    - name: myfrontend
      image: mcr.microsoft.com/oss/nginx/nginx:1.15.5-alpine
      volumeMounts:
      - mountPath: "/mnt/azure"
        name: volume
  volumes:
    - name: volume
      persistentVolumeClaim:
        claimName: azure-managed-disk
```

Для подключения тома в контейнере Windows укажите букву диска и путь к нему. Пример:

```yaml
...      
       volumeMounts:
        - mountPath: "d:"
          name: volume
        - mountPath: "c:\k"
          name: k-dir
...
```

## <a name="next-steps"></a>Дальнейшие действия

Соответствующие рекомендации см. в разделе [Рекомендации по хранению и резервному копированию в AKS][operator-best-practices-storage].

Чтобы узнать, как для создавать динамические и статические тома, использующие диски Azure или файлы Azure, ознакомьтесь со следующими практическими руководствами:

- [Создание статического тома с помощью дисков Azure][aks-static-disks]
- [Создание статического тома с помощью файлов Azure][aks-static-files]
- [Создание динамического тома с помощью дисков Azure][aks-dynamic-disks]
- [Создание динамического тома с помощью файлов Azure][aks-dynamic-files]

Дополнительные сведения о ключевых концепциях Kubernetes и AKS вы получите в следующих статьях:

- [Кластеры и рабочие нагрузки Kubernetes и AKS][aks-concepts-clusters-workloads]
- [Идентификация в Kubernetes и AKS][aks-concepts-identity]
- [Безопасность Kubernetes и AKS][aks-concepts-security]
- [Виртуальные сети Kubernetes и AKS][aks-concepts-network]
- [Масштабирование Kubernetes и AKS][aks-concepts-scale]

<!-- EXTERNAL LINKS -->

<!-- INTERNAL LINKS -->
[aks-static-disks]: azure-disk-volume.md
[aks-static-files]: azure-files-volume.md
[aks-dynamic-disks]: azure-disks-dynamic-pv.md
[aks-dynamic-files]: azure-files-dynamic-pv.md
[aks-concepts-clusters-workloads]: concepts-clusters-workloads.md
[aks-concepts-identity]: concepts-identity.md
[aks-concepts-scale]: concepts-scale.md
[aks-concepts-security]: concepts-security.md
[aks-concepts-network]: concepts-network.md
[operator-best-practices-storage]: operator-best-practices-storage.md
