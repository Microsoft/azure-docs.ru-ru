---
title: Основные понятия масштабирования приложений в Службе Azure Kubernetes (AKS)
description: Изучите масштабирование в Службе Azure Kubernetes (AKS), включая средство горизонтального автомасштабирования pod, средство автомасштабирования кластера и соединитель Экземпляров контейнеров Azure.
services: container-service
ms.topic: conceptual
ms.date: 02/28/2019
ms.openlocfilehash: b72ed7cefc6a16eb484e1337dbd64e5f069a2201
ms.sourcegitcommit: 867cb1b7a1f3a1f0b427282c648d411d0ca4f81f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "94686044"
---
# <a name="scaling-options-for-applications-in-azure-kubernetes-service-aks"></a>Возможности масштабирования приложений в Службе Azure Kubernetes (AKS)

При работе приложений в Службе Azure Kubernetes (AKS) может потребоваться увеличить или уменьшить количество вычислительных ресурсов. При изменении числа экземпляров приложения может потребоваться изменить и число базовых узлов Kubernetes. Кроме того, может потребоваться быстро подготавливать большое количество дополнительных экземпляров приложений.

В этой статье рассматриваются основные понятия, которые помогут вам масштабировать приложения в AKS:

- [масштабирование вручную](#manually-scale-pods-or-nodes);
- [средство горизонтального автомасштабирования pod (HPA)](#horizontal-pod-autoscaler);
- [Средство автомасштабирования кластера](#cluster-autoscaler)
- [интеграция Экземпляров контейнеров Azure (ACI) с AKS](#burst-to-azure-container-instances).

## <a name="manually-scale-pods-or-nodes"></a>Масштабирование элементов pod или узлов вручную

Можно вручную масштабировать реплики (элементы pod) и узлы, чтобы проверить, как приложение реагирует на изменение доступных ресурсов и состояния. Масштабирование ресурсов вручную также позволяет задать объем используемых ресурсов (например, количество узлов), чтобы обеспечить фиксированные расходы. Чтобы вручную масштабировать, необходимо определить реплику или число узлов. Затем API Kubernetes планирует создание дополнительных модулей Pod или сток узлов на основе этой реплики или числа узлов.

При уменьшении масштаба узлов API Kubernetes вызывает соответствующий API вычислений Azure, привязанный к типу вычислений, используемому кластером. Например, для кластеров, построенных на основе масштабируемых наборов виртуальных машин, логика выбора удаляемых узлов определяется API масштабируемых наборов виртуальных машин. Дополнительные сведения о выборе узлов для удаления при уменьшении масштаба см. в разделе [часто задаваемые вопросы о VMSS](../virtual-machine-scale-sets/virtual-machine-scale-sets-faq.md#if-i-reduce-my-scale-set-capacity-from-20-to-15-which-vms-are-removed).

Чтобы приступить к масштабированию pod и узлов вручную, ознакомьтесь с разделом [Руководство. Масштабирование приложений в Службе Azure Kubernetes (AKS)][aks-scale].

## <a name="horizontal-pod-autoscaler"></a>Средство горизонтального автомасштабирования объектов pod

Kubernetes использует средство горизонтального автомасштабирования pod (HPA) для отслеживания потребности в ресурсах и автоматического масштабирования числа реплик. По умолчанию средство горизонтального автомасштабирования pod проверяет API метрик каждые 30 секунд на наличие изменений, которые необходимо внести в число реплик. При необходимости изменения число реплик увеличивается или уменьшается соответствующим образом. Средство горизонтального автомасштабирования pod с кластерами AKS, на которых развернут сервер метрик для Kubernetes 1.8 или более поздней версии.

![Горизонтальное автомасштабирование pod в Kubernetes](media/concepts-scale/horizontal-pod-autoscaling.png)

При настройке средства горизонтального автомасштабирования pod для конкретного развертывания можно определить минимальное и максимальное число запускаемых реплик. Можно также определить метрики для мониторинга и принятия решений о масштабировании, например метрику использования ЦП.

Чтобы приступить к работе со средством горизонтального автомасштабирования pod в AKS, ознакомьтесь с разделом [Автомасштабирование pod][aks-hpa].

### <a name="cooldown-of-scaling-events"></a>Время ожидания событий масштабирования

Когда средство горизонтального автомасштабирования pod проверяет API метрик раз в 30 секунд, предыдущие события масштабирования могут оказаться незавершенными к началу следующей проверки. Такое поведение может привести к тому, что модуль автомасштабирования по горизонтали Pod изменит количество реплик, прежде чем предыдущее событие масштабирования сможет получить рабочую нагрузку приложения, а ресурс требует соответствующим образом скорректировать.

Чтобы избежать событий гонки, задается значение задержки. Это значение определяет, как долго горизонтальный Автомасштабирование Pod должно ждать после события Scale, прежде чем можно будет запустить другое событие масштабирования. Такое поведение позволяет применить новое число реплик, а API метрик — для отражения распределенной рабочей нагрузки. [Нет задержки для событий масштабирования в Kubernetes 1,12](https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale/#support-for-cooldown-delay), однако задержка для событий уменьшения масштаба по умолчанию составляет 5 минут.

Сейчас вы не можете настроить эти значения cooldown по умолчанию.

## <a name="cluster-autoscaler"></a>Средство автомасштабирования кластера

Чтобы реагировать на изменение требований к Pod, Kubernetes имеет автомасштабируемый кластер, который корректирует количество узлов на основе запрошенных ресурсов вычислений в пуле узлов. По умолчанию Автомасштабирование кластера проверяет сервер API метрик каждые 10 секунд для любых необходимых изменений в количестве узлов. Если средство автомасштабирования кластера определяет, что требуется внести изменение, количество узлов в кластере AKS увеличивается или уменьшается соответствующим образом. Автомасштабирование кластера работает с кластерами AKS с поддержкой Kubernetes RBAC, которые работают под управлением Kubernetes 1.10. x или более поздней версии.

![Средство автомасштабирования кластера Kubernetes](media/concepts-scale/cluster-autoscaler.png)

Средство автомасштабирования кластера обычно используется вместе со средством горизонтального автомасштабирования pod. В этом случае средство горизонтального автомасштабирования pod увеличивает или уменьшает количество элементов pod на основе потребностей приложения, а средство автомасштабирования кластера соответствующем образом изменяет количество узлов, необходимых для выполнения этих дополнительных pod.

Чтобы приступить к работе со средством автомасштабирования кластера в AKS, ознакомьтесь с разделом [Автомасштабирование кластера с помощью службы Azure Kubernetes (AKS) — предварительная версия][aks-cluster-autoscaler].

### <a name="scale-out-events"></a>События масштабирования

Если у узла нет достаточных ресурсов вычислений для выполнения запрошенного Pod, этот модуль не сможет пройти процесс планирования. Модуль невозможно запустить, если в пуле узлов не доступны дополнительные ресурсы вычислений.

Когда Автомасштабирование кластера обнаруживает модули Pod, которые не могут быть запланированы из-за ограничений ресурсов пула узлов, количество узлов в пуле узлов увеличивается для предоставления дополнительных ресурсов вычислений. Когда эти дополнительные узлы успешно развертываются и становятся доступны для использования в пуле узлов, элементы pod добавляются в расписание для запуска на них.

Если приложению требуется быстрое масштабирование, некоторые элементы pod могут оставаться в состоянии ожидания планирования, пока дополнительные узлы, развернутые средством автомасштабирования кластера, не смогут принять запланированные pod. Для приложений со скачкообразными потребностями в ресурсах можно использовать масштабирование с помощью виртуальных узлов и Экземпляров контейнеров Azure.

### <a name="scale-in-events"></a>Масштабирование событий

Модуль автомасштабирования кластера также отслеживает состояние расписания Pod для узлов, которые недавно не получали новые запросы на планирование. Этот сценарий указывает, что пул узлов имеет больше ресурсов вычислений, чем требуется, и количество узлов может быть уменьшено.

Если узел не используется дольше 10 минут (порог по умолчанию), планируется его удаление. При возникновении такой ситуации запуск элементов pod планируются на других узлах в пуле узлов, и средство автомасштабирования кластера уменьшает число узлов.

Работа приложений может ненадолго прерваться при переносе запуска элементов pod на другие узлы, когда средство автомасштабирования кластера уменьшает число узлов. Чтобы свести к минимуму нарушение работы, избегайте приложений, использующих отдельный экземпляр pod.

## <a name="burst-to-azure-container-instances"></a>Пакетное масштабирование в Экземпляры контейнеров Azure

Чтобы быстро масштабировать кластер AKS, можно интегрировать его с Экземплярами контейнеров Azure (ACI). В Kubernetes есть встроенные компоненты, которые позволяют масштабировать число реплик и узлов. Тем не менее, если приложению требуется быстрое масштабирование, средство горизонтального автомасштабирования pod может запланировать больше элементов pod, чем доступно в соответствии с имеющимися вычислительными ресурсами в пуле узлов. Подобная конфигурация приведет к тому, что средство автомасштабирования кластера развернет дополнительные узлы в пуле узлов, но может потребоваться несколько минут, чтобы эти узлы были успешно подготовлены и планировщик Kubernetes смог запускать на них элементы pod.

![Пакетное масштабирование Kubernetes в ACI](media/concepts-scale/burst-scaling.png)

ACI позволяет быстро развернуть экземпляры контейнеров без дополнительных затрат на инфраструктуру. При подключении к AKS служба ACI становится защищенным логическим расширением кластера AKS. Компонент [виртуальных узлов][virtual-nodes-cli] , основанный на [виртуальной Kubelet][virtual-kubelet], устанавливается в кластер AKS, который представляет ACI в качестве виртуального Kubernetes узла. После этого Kubernetes может планировать запуск элементов pod в качестве экземпляров ACI на виртуальных узлах, а не в качестве элементов pod на узлах виртуальных машин непосредственно в кластере AKS.

Приложение не требует изменений для использования виртуальных узлов. Развертывания можно масштабировать в AKS и ACI без задержек по мере того, как средство автомасштабирования кластера развертывает новые узлы в кластере AKS.

Виртуальные узлы развертываются в дополнительную подсеть в той же виртуальной сети, что и кластер AKS. Эта конфигурация виртуальной сети обеспечивает защиту трафика, передаваемого между ACI и AKS. Как и кластер AKS, экземпляр ACI является безопасным логическим вычислительным ресурсом, который изолирован от других пользователей.

## <a name="next-steps"></a>Дальнейшие действия

Чтобы приступить к масштабированию приложений, сначала изучите [краткое руководство по созданию кластера AKS с помощью Azure CLI][aks-quickstart]. Затем вы можете вручную или автоматически масштабировать приложения в кластере AKS:

- Масштабирование элементов [pod][aks-manually-scale-pods] или [узлов][aks-manually-scale-nodes] вручную.
- Использование [средства горизонтального автомасштабирования pod][aks-hpa].
- Использование [автомасштабирования кластера][aks-cluster-autoscaler]

Дополнительные сведения о ключевых понятиях Kubernetes и AKS приведены в следующих статьях:

- [Кластеры и рабочие нагрузки Kubernetes и AKS][aks-concepts-clusters-workloads]
- [Доступ и идентификация в Kubernetes и AKS][aks-concepts-identity]
- [Безопасность Kubernetes и AKS][aks-concepts-security]
- [Виртуальные сети Kubernetes и AKS][aks-concepts-network]
- [Хранилище Kubernetes и AKS][aks-concepts-storage]

<!-- LINKS - external -->
[virtual-kubelet]: https://virtual-kubelet.io/

<!-- LINKS - internal -->
[aks-quickstart]: kubernetes-walkthrough.md
[aks-hpa]: tutorial-kubernetes-scale.md#autoscale-pods
[aks-scale]: tutorial-kubernetes-scale.md
[aks-manually-scale-pods]: tutorial-kubernetes-scale.md#manually-scale-pods
[aks-manually-scale-nodes]: tutorial-kubernetes-scale.md#manually-scale-aks-nodes
[aks-cluster-autoscaler]: ./cluster-autoscaler.md
[aks-concepts-clusters-workloads]: concepts-clusters-workloads.md
[aks-concepts-security]: concepts-security.md
[aks-concepts-storage]: concepts-storage.md
[aks-concepts-identity]: concepts-identity.md
[aks-concepts-network]: concepts-network.md
[virtual-nodes-cli]: virtual-nodes-cli.md
