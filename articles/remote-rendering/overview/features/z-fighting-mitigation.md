---
title: Устранение Z-конфликтов
description: Описываются методики устранения артефактов Z-конфликтов
author: florianborn71
ms.author: flborn
ms.date: 02/06/2020
ms.topic: article
ms.custom: devx-track-csharp
ms.openlocfilehash: a399565d62b20f62b72257bcb9f3beb2c910ac98
ms.sourcegitcommit: f377ba5ebd431e8c3579445ff588da664b00b36b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/05/2021
ms.locfileid: "99594067"
---
# <a name="z-fighting-mitigation"></a>Устранение Z-конфликтов

При перекрытии двух поверхностей не ясно, какая из них должна быть отображена поверх другой. Результат даже меняется на пиксель, что приводит к артефактам, зависимым от представления камеры. Таким образом, при перемещении камеры или сетки эти структуры заметно мерцают. Этот артефакт называется *Z-конфликтом*. Для приложений дополненной (AR) и виртуальной реальности (VR) проблема усугубляется из-за того, что наголовные устройства всегда перемещаются. Чтобы снизить дискомфорт зрителя, в Удаленной отрисовке Azure доступна функция устранения Z-конфликтов.

## <a name="z-fighting-mitigation-modes"></a>Режимы устранения Z-конфликтов

|Ситуация                        | Результат                               |
|---------------------------------|:-------------------------------------|
|Обычный Z-конфликт               |![Нет детерминированного приоритета между красными и зелеными четырьмя числами](./media/zfighting-0.png)|
|Устранение Z-конфликтов включено    |![Приоритет красной четырехъядерности](./media/zfighting-1.png)|
|Выделение мелкой клеткой включено|![Красная и зеленая параметры переключения переключателей в шаблоне шахматной доски](./media/zfighting-2.png)|

Приведенный ниже код включает устранение Z-конфликтов.

```cs
void EnableZFightingMitigation(RenderingSession session, bool highlight)
{
    ZFightingMitigationSettings settings = session.Connection.ZFightingMitigationSettings;

    // enabling z-fighting mitigation
    settings.Enabled = true;

    // enabling checkerboard highlighting of z-fighting potential
    settings.Highlighting = highlight;
}
```

```cpp
void EnableZFightingMitigation(ApiHandle<RenderingSession> session, bool highlight)
{
    ApiHandle<ZFightingMitigationSettings> settings = session->Connection()->GetZFightingMitigationSettings();

    // enabling z-fighting mitigation
    settings->SetEnabled(true);

    // enabling checkerboard highlighting of z-fighting potential
    settings->SetHighlighting(highlight);
}
```

> [!NOTE]
> Устранение Z-конфликтов — это глобальный параметр, влияющий на все отрисованные сетки.

## <a name="reasons-for-z-fighting"></a>Причины Z-конфликтов

Z-конфликты возникают в основном по двум причинам:

1. когда поверхности находятся очень далеко от камеры, точность их значений глубины снижается и эти значения становятся неотличимыми;
1. когда поверхности в сетке физически пересекаются.

Первая проблема может возникнуть всегда, и ее трудно устранить. Если это происходит в вашем приложении, убедитесь, что отношение расстояния до *передней плоскости* к расстоянию до *задней плоскости* имеет максимально малое значение. Например, расположение передней плоскости на расстоянии 0,01 и задней плоскости на расстоянии 1000 создаст эту проблему гораздо раньше, чем расположение передней плоскости на расстоянии 0,1 и задней — на расстоянии 20.

Вторая проблема является признаком неэффективно созданного содержимого. В реальной жизни два объекта не могут находиться в одном месте одновременно. В зависимости от приложения пользователям может потребоваться определить, существуют ли перекрывающиеся поверхности и где они находятся. Например, сцена САПР здания, которая является основой для реального сооружения, не должна содержать физически невозможных пересечений поверхностей. Чтобы обеспечить визуальную проверку, доступен режим выделения, который выделяет потенциальные Z-конфликты с помощью анимированного узора мелкой клетки.

## <a name="limitations"></a>Ограничения

Предлагаемые способы устранения Z-конфликтов не являются гарантированными. Нет никакой гарантии, что они устранят все Z-конфликты. Кроме того, одна поверхность автоматически отображается над другой. Поэтому при наличии поверхностей, которые находятся слишком близко друг к другу, может случиться так, что сверху окажется не та поверхность. Нередко проблемы возникают при наложении на поверхность текста и других деколей. Если включено устранение Z-конфликтов, эти элементы могут просто исчезнуть.

## <a name="performance-considerations"></a>Вопросы производительности

* Включение устранения Z-конфликтов практически не отражается на производительности.
* Кроме того, включение наложения Z-конфликтов приводит к нетривиальным затратам на производительность, которые зависят от конкретной сцены.

## <a name="api-documentation"></a>Документирование API

* [C# Рендерингконнектион. Зфигхтингмитигатионсеттингс, свойство](/dotnet/api/microsoft.azure.remoterendering.renderingconnection.zfightingmitigationsettings)
* [C++ Рендерингконнектион:: Зфигхтингмитигатионсеттингс ()](/cpp/api/remote-rendering/renderingconnection#zfightingmitigationsettings)

## <a name="next-steps"></a>Дальнейшие действия

* [Режимы отрисовки](../../concepts/rendering-modes.md)
* [Перепроецирование на позднем этапе](late-stage-reprojection.md)