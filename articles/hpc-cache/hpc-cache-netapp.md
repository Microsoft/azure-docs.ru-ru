---
title: Использование кэша Azure HPC и Azure NetApp Files
description: Использование кэша HPC для Azure для улучшения доступа к данным, хранящимся в Azure NetApp Files
author: ekpgh
ms.service: hpc-cache
ms.topic: how-to
ms.date: 10/30/2019
ms.author: v-erkel
ms.openlocfilehash: e955ddc14bb2b0a7abc0dc815c6955247568876b
ms.sourcegitcommit: 772eb9c6684dd4864e0ba507945a83e48b8c16f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "86497018"
---
# <a name="use-azure-hpc-cache-with-azure-netapp-files"></a>Использование кэша HPC для Azure с Azure NetApp Files

Вы можете использовать [Azure NetApp Files](https://azure.microsoft.com/services/netapp/) в качестве целевого объекта хранилища для кэша HPC Azure. В этой статье объясняется, как две службы могут работать вместе, и приводятся советы по их настройке.

Azure NetApp Files сочетает свою операционную систему ONTAP с масштабируемостью и скоростью Microsoft Azure. Это сочетание позволяет пользователям перемещать созданные рабочие процессы в облако, не переписывая код.

Добавление компонента кэша HPC Azure может повысить уровень доступа к файлам за счет представления нескольких Azure NetApp Files томов в одном объединенном пространстве имен. Он может обеспечить пограничные кэширование для томов, расположенных в другом регионе службы. Кроме того, она может повысить производительность по запросу для томов, созданных на уровнях служб низкого уровня, чтобы сэкономить затраты.

## <a name="overview"></a>Обзор

Чтобы использовать Azure NetApp Filesную систему в качестве серверного хранилища с кэшем HPC Azure, выполните эту процедуру.

1. Создайте систему Azure NetApp Files и тома в соответствии с рекомендациями в статье [Планирование системы ниже](#plan-your-azure-netapp-files-system).
1. Создайте кэш HPC Azure в регионе, где требуется доступ к файлам. (Используйте инструкции в статье [создание кэша HPC для Azure](hpc-cache-create.md).)
1. [Определите целевые объекты хранилища](#create-storage-targets-in-the-cache) в кэше, которые указывают на Azure NetApp Files тома. Создайте один целевой объект хранилища кэша для каждого уникального IP-адреса, используемого для доступа к томам.
1. Клиенты [подключаются к КЭШУ HPC Azure](#mount-storage-targets) вместо прямого подключения к Azure NetApp Filesным томам.

## <a name="plan-your-azure-netapp-files-system"></a>Планирование системы Azure NetApp Files

При планировании системы Azure NetApp Files Обратите внимание на элементы в этом разделе, чтобы обеспечить возможность беспрепятственной интеграции с кэшем Azure HPC.

Также прочитайте [документацию по Azure NetApp Files](../azure-netapp-files/index.yml) перед созданием томов для использования с кэшем HPC Azure.

### <a name="nfs-client-access-only"></a>Только клиентский доступ NFS

Сейчас кэш HPC Azure поддерживает только доступ NFS. Его нельзя использовать с битовыми томами в списке ACL SMB или режиме POSIX.

### <a name="exclusive-subnet-for-azure-netapp-files"></a>Исключающая подсеть для Azure NetApp Files

Azure NetApp Files использует одну делегированную подсеть для своих томов. Другие ресурсы не могут использовать эту подсеть. Кроме того, для Azure NetApp Files можно использовать только одну подсеть в виртуальной сети. Дополнительные сведения см. в [руководстве по Azure NetApp Files планировании сети](../azure-netapp-files/azure-netapp-files-network-topologies.md).

### <a name="delegated-subnet-size"></a>Размер делегированной подсети

Используйте минимальный размер для делегированной подсети при создании Azure NetApp Filesной системы для использования с кэшем HPC Azure.

Минимальный размер, заданный с помощью маски/28, предоставляет 16 IP-адресов. На практике Azure NetApp Files использует только три из доступных IP-адресов для доступа к тому. Это означает, что для покрытия всех томов необходимо создать три целевых объекта хранилища в кэше Azure HPC.

Если делегированная подсеть слишком велика, Azure NetApp Filesные тома могут использовать больше IP-адресов, чем может выполнять один экземпляр кэша Azure HPC. Один кэш может иметь не более 10 целевых объектов хранилища.

В примере краткого руководства в Azure NetApp Files документации для делегированной подсети используется 10.7.0.0/16, что дает слишком большой размер подсети.

### <a name="capacity-pool-service-level"></a>Уровень обслуживания пула ресурсов

При выборе уровня обслуживания для пула емкости рассмотрите рабочий процесс. Если вы часто записываете данные на Azure NetApp Files том, производительность кэша может быть ограничена, если время обратной записи замедлено. Выберите высокий уровень обслуживания для томов с частыми операциями записи.

Тома с низким уровнем обслуживания также могут потребовать задержки в начале задачи, пока кэш заполнится предварительно заполненным содержимым. После того как кэш будет готов к работе с хорошим рабочим набором файлов, задержка должна стать незамеченной.

Важно заранее спланировать уровень обслуживания пула ресурсов, так как он не может быть изменен после создания. Новый том потребуется создать в другом пуле емкости, а данные будут скопированы.

Обратите внимание, что можно изменить квоту хранилища тома и размер пула емкости, не нарушая доступ.

## <a name="create-storage-targets-in-the-cache"></a>Создание целевых объектов хранилища в кэше

После настройки системы Azure NetApp Files и создания кэша HPC для Azure Определите целевые объекты хранилища в кэше, указывающие на тома файловой системы.

Создайте один целевой объект хранилища для каждого IP-адреса, используемого Azure NetApp Files томами. IP-адрес указан на странице инструкции по подключению тома.

Если несколько томов имеют один и тот же IP-адрес, можно использовать одну цель хранилища для всех.  

Следуйте [инструкциям по подключению в документации Azure NetApp Files](../azure-netapp-files/azure-netapp-files-mount-unmount-volumes-for-virtual-machines.md) , чтобы найти IP-адреса для использования.

Вы также можете найти IP-адреса с помощью Azure CLI:

```azurecli
az netappfiles volume list -g ${RESOURCE_GROUP} --account-name ${ANF_ACCOUNT} --pool-name ${POOL} --query "[].mountTargets[].ipAddress" | grep -Ee '[0-9]+[.][0-9]+[.][0-9]+[.][0-9]+' | tr -d '"' | tr -d , | sort | uniq
```

Имена экспорта в системе Azure NetApp Files имеют один компонент пути. Не пытайтесь создать целевой объект хранилища для корневого экспорта ``/`` в Azure NetApp Files, так как этот экспорт не предоставляет доступ к файлам.

Для этих целевых объектов хранилища не существует специальных ограничений на пути к виртуальному пространству имен.

## <a name="mount-storage-targets"></a>Целевые объекты для подключения к хранилищу

Клиентские компьютеры должны подключать кэш вместо того, чтобы подключать Azure NetApp Files тома напрямую. Следуйте инструкциям в разделе [Подключение кэша HPC для Azure](hpc-cache-mount.md).

## <a name="next-steps"></a>Дальнейшие действия

* Узнайте больше о настройке и использовании [Azure NetApp Files](../azure-netapp-files/index.yml)
* Чтобы получить помощь в планировании и настройке системы кэша HPC Azure для использования Azure NetApp Files, [обратитесь в службу поддержки](hpc-cache-support-ticket.md).
