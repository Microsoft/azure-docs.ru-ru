---
title: Модели использования кэша HPC Azure
description: Описывает различные модели использования кэша и способы их выбора для установки кэширования только для чтения или чтения и записи, а также для управления другими параметрами кэширования.
author: ekpgh
ms.service: hpc-cache
ms.topic: how-to
ms.date: 03/08/2021
ms.author: v-erkel
ms.openlocfilehash: 856f2c15d2bd0b39212e8962a92b1df50cada29e
ms.sourcegitcommit: 66ce33826d77416dc2e4ba5447eeb387705a6ae5
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/15/2021
ms.locfileid: "103472888"
---
# <a name="understand-cache-usage-models"></a>Общие сведения о моделях использования кэша

Модели использования кэша позволяют настроить хранение файлов в кэше Azure HPC для ускорения рабочего процесса.

## <a name="basic-file-caching-concepts"></a>Основные понятия кэширования файлов

Кэширование файлов — это то, как кэш Azure HPC ускоряет клиентские запросы. В нем используются следующие основные методики:

* **Кэширование чтения** . кэш HPC для Azure хранит копию файлов, запрашиваемых клиентами из системы хранения. В следующий раз, когда клиент запрашивает тот же файл, кэш HPC может предоставить версию в своем кэше вместо того, чтобы извлекать ее из серверной системы хранения.

* **Кэширование записи** . при необходимости кэш Azure HPC может хранить копию любых измененных файлов, отправленных с клиентских компьютеров. Если несколько клиентов вносит изменения в один и тот же файл в течение короткого периода, кэш может составлять все изменения в кэше, а не записывать каждое изменение по отдельности в серверную систему хранения.

  По истечении указанного времени без изменений кэш перемещает файл в долгосрочную систему хранения.

  Если кэширование записи отключено, то кэш не сохраняет измененный файл и немедленно записывает его в систему хранения серверной части.

* **Задержка обратной записи** — для кэша с включенным кэшированием записи, задержка обратной записи — это время, в течение которого кэш ожидает дополнительных изменений файла, прежде чем перемещать файл в систему хранения серверной части.

* **Серверная проверка** — параметр проверки серверной части определяет частоту, с которой кэш сравнивает локальную копию файла с удаленной версией в серверной системе хранения данных. Если серверная копия новее, чем кэшированная копия, кэш извлекает удаленную копию и сохраняет ее для будущих запросов.

  Параметр проверки серверной части показывает, когда кэш *автоматически* сравнивает свои файлы с исходными файлами в удаленном хранилище. Тем не менее можно принудительно использовать кэш HPC Azure для сравнения файлов путем выполнения операции с каталогом, включающей запрос реаддирплус. Реаддирплус — это стандартный API NFS (также называемый расширенным чтением), который возвращает метаданные каталога, что приводит к сравнению и обновлению файлов в кэше.

Модели использования, встроенные в кэш Azure HPC, имеют разные значения для этих параметров, что позволяет выбрать оптимальное сочетание для конкретной ситуации.

## <a name="choose-the-right-usage-model-for-your-workflow"></a>Выбор правильной модели использования для рабочего процесса

Необходимо выбрать модель использования для каждого целевого объекта хранилища, подключенного с помощью NFS. Целевые объекты хранилища BLOB-объектов Azure имеют встроенную модель использования, которую невозможно настроить.

Модели использования кэша HPC позволяют выбрать способ балансировки быстрого реагирования с риском получения устаревших данных. Если вы хотите оптимизировать скорость чтения файлов, вы можете не заботиться, проверяются ли файлы в кэше по внутренним файлам. С другой стороны, если вы хотите, чтобы файлы всегда были обновлены с помощью удаленного хранилища, выберите модель, которая проверяется часто.

Существует несколько вариантов:

* **Частое чтение, редкие операции записи** . Используйте этот параметр, если требуется ускорить доступ на чтение к файлам, которые являются статическими или редко изменяемыми.

  Этот параметр кэширует операции чтения клиента, но не кэширует записи. Он немедленно передает операции записи в хранилище серверной части.
  
  Файлы, хранящиеся в кэше, не сравниваются автоматически с файлами на томе хранилища NFS. (Ознакомьтесь с описанием серверной проверки выше, чтобы узнать, как их сравнивать вручную.)

  Не используйте этот параметр, если существует риск, что файл может быть изменен непосредственно в системе хранения без предварительной записи в кэш. В таком случае кэшированная версия файла не будет синхронизирована с внутренним файлом.

* Более **15% операций записи** . Этот параметр ускоряет скорость чтения и записи. При использовании этого параметра все клиенты должны получить доступ к файлам через кэш HPC Azure, а не подключать серверное хранилище напрямую. В кэшированных файлах будут внесены последние изменения, которые не хранятся в серверной части.

  В этой модели использования файлы в кэше проверяются только по файлам в хранилище серверной части каждые 8 часов. Предполагается, что кэшированная версия файла является более актуальной. Измененный файл в кэше записывается в систему хранения серверной части после того, как она найдется в кэше в течение 20 минут.<!-- an hour --> без дополнительных изменений.

* **Клиенты записываются в целевой объект NFS, минуя кэш** . Выберите этот параметр, если клиенты в рабочем процессе записывают данные непосредственно в систему хранения без предварительной записи в кэш или если требуется оптимизировать согласованность данных. Файлы, запрашиваемые клиентами, кэшируются (операции чтения), но любые изменения этих файлов с клиента (записи) не кэшируются. Они передаются непосредственно в систему хранения серверной части.

  В этой модели использования файлы в кэше часто проверяются относительно серверных версий для обновлений. Эта проверка позволяет изменять файлы вне кэша, сохраняя согласованность данных.

* Более **15% операций записи, проверка резервного сервера на наличие изменений каждые 30 секунд** и **более 15% операций записи, проверка резервного сервера на наличие изменений каждые 60 секунд** . Эти параметры предназначены для рабочих процессов, где требуется ускорить операции чтения и записи, но есть вероятность, что другой пользователь будет выполнять запись непосредственно в серверную систему хранения данных. Например, если несколько наборов клиентов работают с одними и теми же файлами из разных расположений, эти модели использования могут иметь смысл сбалансировать потребность в быстром доступе к файлам с низкой допустимостью для устаревшего содержимого из источника.

* Более **15% операций записи, обратная запись на сервер каждые 30 секунд** — этот параметр предназначен для сценария, в котором несколько клиентов активно изменяют одни и те же файлы, или если некоторые клиенты обращаются непосредственно к внутреннему хранилищу вместо подключения кэша.

  Частые операции записи на серверные части влияют на производительность кэша, поэтому следует рассмотреть возможность использования **более 15% операций записи** при возникновении низкого риска конфликта файлов, например, если известно, что разные клиенты работают в разных областях одного и того же набора файлов.

* **Высокая скорость чтения, проверка резервного сервера каждые 3 часа** . Этот параметр определяет приоритет быстрого считывания на стороне клиента, а также регулярно обновляет кэшированные файлы из серверной системы хранения, в отличие от **редко используемых операций записи** .

В этой таблице перечислены различия в модели использования.

| Модель использования                   | Режим кэширования | Проверка серверной части | Максимальная задержка записи на сервер |
|-------------------------------|--------------|-----------------------|--------------------------|
| Частое чтение, редкие операции записи | Чтение         | Никогда                 | Нет                     |
| Более 15% операций записи       | Чтение/запись   | 8 ч               | 20 минут               |
| Клиенты обходят кэш      | Чтение         | 30 секунд            | Нет                     |
| Более 15% операций записи, частая проверка серверной части (30 секунд) | Чтение/запись | 30 секунд | 20 минут |
| Более 15% операций записи, частая проверка серверной части (60 секунд) | Чтение/запись | 60 секунд | 20 минут |
| Более 15% операций записи, частая обратная запись | Чтение/запись | 30 секунд | 30 секунд |
| Высокая частота чтения, проверка резервного сервера каждые 3 часа | Чтение | 3 часа | Нет |

Если у вас есть вопросы о наилучшей модели использования для рабочего процесса кэша Azure HPC, обратитесь к своему представителяу Azure или отправьте запрос в службу поддержки.

## <a name="next-steps"></a>Дальнейшие действия

* [Добавление целевых объектов хранилища](hpc-cache-add-storage.md) в кэш HPC Azure
