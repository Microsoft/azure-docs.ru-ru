---
title: Использование ключей, управляемых клиентом, для шифрования данных в кэше Azure HPC
description: Использование Azure Key Vault с кэшем Azure HPC для управления доступом к ключам шифрования вместо использования ключей шифрования, управляемых корпорацией Майкрософт по умолчанию
author: ekpgh
ms.service: hpc-cache
ms.topic: how-to
ms.date: 07/20/2020
ms.author: v-erkel
ms.openlocfilehash: f587de4ee2ce051cb771db90d7f9ce00ce66b07f
ms.sourcegitcommit: 2c1b93301174fccea00798df08e08872f53f669c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/22/2021
ms.locfileid: "104772711"
---
# <a name="use-customer-managed-encryption-keys-for-azure-hpc-cache"></a>Использование управляемых клиентом ключей шифрования для кэша HPC Azure

Вы можете использовать Azure Key Vault, чтобы контролировать владение ключами, используемыми для шифрования данных в кэше HPC Azure. В этой статье объясняется, как использовать управляемые клиентом ключи для шифрования данных в кэше.

> [!NOTE]
> Все данные, хранящиеся в Azure, в том числе на дисках кэша, шифруются по умолчанию с помощью ключей, управляемых корпорацией Майкрософт. Чтобы управлять ключами, используемыми для шифрования данных, необходимо выполнить действия, описанные в этой статье.

Кэш HPC Azure также защищен [шифрованием узлов виртуальных машин](../virtual-machines/disk-encryption.md#encryption-at-host---end-to-end-encryption-for-your-vm-data) на управляемых дисках, содержащих кэшированные данные, даже если вы добавили ключ клиента для дисков кэша. Добавление ключа, управляемого клиентом, для двойного шифрования обеспечивает дополнительный уровень безопасности для клиентов с высокими требованиями к безопасности. Дополнительные сведения см. в статье о [шифровании хранилища дисков Azure на стороне сервера](../virtual-machines/disk-encryption.md) .

Существует три шага по включению шифрования ключей, управляемых клиентом, для кэша HPC Azure.

1. Настройте Azure Key Vault для хранения ключей.
1. При создании кэша HPC для Azure выберите шифрование ключа, управляемое клиентом, и укажите хранилище ключей и ключ для использования.
1. После создания кэша Авторизуйте его для доступа к хранилищу ключей.

Шифрование не полностью настраивается до тех пор, пока вы не разрешите его из вновь созданного кэша (шаг 3). Это связано с тем, что необходимо передать удостоверение кэша в хранилище ключей, чтобы сделать его полномочным пользователем. Это невозможно сделать перед созданием кэша, так как это удостоверение не существует до создания кэша.

После создания кэша нельзя изменить ключи, управляемые клиентом, и ключи, управляемые корпорацией Майкрософт. Однако если в кэше используются ключи, управляемые клиентом, можно [изменить](#update-key-settings) ключ шифрования, версию ключа и хранилище ключей по мере необходимости.

## <a name="understand-key-vault-and-key-requirements"></a>Основные сведения о хранилище ключей и ключевых требованиях

Хранилище ключей и ключ должны соответствовать этим требованиям для работы с кэшем Azure HPC.

Свойства хранилища ключей:

* **Подписка** — используйте ту же подписку, которая используется для кэша.
* **Регион** . хранилище ключей должно находиться в том же регионе, что и кэш HPC Azure.
* **Ценовая** Категория — уровень "Стандартный" достаточно для использования с кэшем HPC Azure.
* **Обратимое удаление** . кэш HPC Azure включит обратимое удаление, если оно еще не настроено в хранилище ключей.
* **Очистка защиты** . необходимо включить защиту от очистки.
* **Политика доступа** — достаточно параметров по умолчанию.
* **Сетевое подключение** . кэш Azure HPC должен иметь доступ к хранилищу ключей независимо от выбранных параметров конечной точки.

Ключевые свойства:

* **Тип ключа** — RSA
* **Размер ключа RSA** — 2048
* **Включено** — да.

Разрешения на доступ к хранилищу ключей:

* Пользователь, который создает кэш HPC Azure, должен иметь разрешения, эквивалентные [роли участника Key Vault](../role-based-access-control/built-in-roles.md#key-vault-contributor). Для настройки Azure Key Vault и управления ими необходимы те же разрешения.

  Дополнительные сведения см. [в статье безопасный доступ к хранилищу ключей](../key-vault/general/secure-your-key-vault.md) .

## <a name="1-set-up-azure-key-vault"></a>1. Настройка Azure Key Vault

Вы можете настроить хранилище ключей и ключ перед созданием кэша или выполнить его в процессе создания кэша. Убедитесь, что эти ресурсы соответствуют требованиям, описанным [выше](#understand-key-vault-and-key-requirements).

Во время создания кэша необходимо указать хранилище, ключ и версию ключа, которые будут использоваться для шифрования кэша.

Дополнительные сведения см. в [документации по Azure Key Vault](../key-vault/general/overview.md) .

> [!NOTE]
> Azure Key Vault должны использовать одну и ту же подписку и находиться в том же регионе, что и кэш HPC Azure. Убедитесь, что выбранный регион [поддерживает оба продукта](https://azure.microsoft.com/global-infrastructure/services/?regions=all&products=hpc-cache,key-vault).

## <a name="2-create-the-cache-with-customer-managed-keys-enabled"></a>2. Создайте кэш с включенными управляемыми клиентом ключами.

При создании кэша HPC Azure необходимо указать источник ключа шифрования. Следуйте инструкциям в разделе [создание кэша HPC Azure](hpc-cache-create.md)и укажите хранилище ключей и ключ на странице **ключи шифрования диска** . Вы можете создать новое хранилище ключей и ключ во время создания кэша.

> [!TIP]
> Если страница **ключи шифрования диска** не отображается, убедитесь, что кэш находится в одном из [поддерживаемых регионов](https://azure.microsoft.com/global-infrastructure/services/?regions=all&products=hpc-cache,key-vault).

Пользователь, создающий кэш, должен иметь привилегии, равные [роли участника Key Vault](../role-based-access-control/built-in-roles.md#key-vault-contributor) или выше.

1. Нажмите кнопку, чтобы включить закрытые управляемые ключи. После изменения этого параметра отображаются параметры хранилища ключей.

1. Щелкните **выбрать хранилище ключей** , чтобы открыть страницу выбора ключа. Выберите или создайте хранилище ключей и ключ для шифрования данных на дисках этого кэша.

   Если Azure Key Vault не отображается в списке, проверьте следующие требования:

   * Находится ли кэш в той же подписке, что и хранилище ключей?
   * Находится ли кэш в том же регионе, что и хранилище ключей?
   * Существует ли сетевое подключение между портал Azure и хранилищем ключей?

1. После выбора хранилища выберите отдельный ключ из доступных параметров или создайте новый ключ. Ключ должен быть 2048-битным ключом RSA.

1. Укажите версию для выбранного ключа. Дополнительные сведения об управлении версиями см. в [документации по Azure Key Vault](../key-vault/general/about-keys-secrets-certificates.md#objects-identifiers-and-versioning).

Продолжайте работу с остальными спецификациями и создавайте кэш, как описано в статье [создание кэша HPC для Azure](hpc-cache-create.md).

## <a name="3-authorize-azure-key-vault-encryption-from-the-cache"></a>3. Авторизация Azure Key Vault шифрования из кэша
<!-- header is linked from create article, update if changed -->

Через несколько минут в портал Azure появится новый кэш HPC Azure. Перейдите на страницу " **Обзор** ", чтобы авторизовать ее для доступа к Azure Key Vault и включения шифрования ключа, управляемого клиентом.

> [!TIP]
> Кэш может отображаться в списке ресурсов до очистки сообщений о развертывании. Проверьте список ресурсов через минуту или два вместо ожидания уведомления об успешном выполнении.

Этот двухэтапный процесс необходим, поскольку экземпляру кэша Azure HPC требуется удостоверение для передачи в Azure Key Vault для авторизации. Удостоверение кэша не существует до тех пор, пока не будут завершены начальные шаги по созданию.

> [!NOTE]
> Необходимо авторизовать шифрование в течение 90 минут после создания кэша. Если вы не завершите этот шаг, время ожидания кэша истечет и произойдет сбой. Неудачный кэш должен быть создан повторно, его нельзя исправить.

В кэше отображается состояние **Ожидание ключа**. Нажмите кнопку **включить шифрование** в верхней части страницы, чтобы авторизовать кэш для доступа к указанному хранилищу ключей.

![снимок экрана: страница обзора кэша на портале с выделением на кнопке "включить шифрование" (верхняя строка) и состоянием "ожидание ключа"](media/waiting-for-key.png)

Щелкните **включить шифрование** , а затем нажмите кнопку **Да** , чтобы авторизовать кэш для использования ключа шифрования. Это действие также обеспечивает защиту с обратимым удалением и очисткой (если она еще не включена) в хранилище ключей.

![снимок экрана со страницей обзора кэша на портале с заголовком вверху сообщения, предлагающего пользователю включить шифрование, нажав кнопку Да](media/enable-keyvault.png)

После того как кэш запросит доступ к хранилищу ключей, он может создать и зашифровать диски, хранящие кэшированные данные.

После авторизации шифрования кэш Azure HPC проходит через несколько минут, чтобы создать зашифрованные диски и связанную с ним инфраструктуру.

## <a name="update-key-settings"></a>Обновить параметры ключа

Вы можете изменить хранилище ключей, ключ или версию ключа кэша из портал Azure. Щелкните ссылку параметры **шифрования** кэша, чтобы открыть страницу **Параметры ключа клиента** .

Нельзя изменить кэш между управляемыми клиентом ключами и ключами, управляемыми системой.

![снимок экрана: страница "параметры ключей клиентов", которую можно выбрать, нажав кнопку Параметры > шифрование на странице кэш в портал Azure](media/change-key-click.png)

Щелкните ссылку **изменить ключ** , а затем выберите **изменить хранилище ключей, ключ или версию** , чтобы открыть средство выбора ключа.

![снимок экрана: страница "Выбор ключа из Azure Key Vault" с тремя раскрывающимися селекторами для выбора хранилища ключей, ключа и версии](media/select-new-key.png)

Хранилища ключей в той же подписке и том же регионе, что и этот кэш, отображаются в списке.

После выбора новых значений ключа шифрования нажмите кнопку **выбрать**. Появится страница подтверждения с новыми значениями. Нажмите кнопку **сохранить** , чтобы завершить выбор.

![снимок экрана со страницей подтверждения с кнопкой "Сохранить" вверху слева](media/save-key-settings.png)

## <a name="read-more-about-customer-managed-keys-in-azure"></a>Узнайте больше о ключах, управляемых клиентом, в Azure.

В этих статьях объясняется, как использовать Azure Key Vault и ключи, управляемые клиентом, для шифрования данных в Azure.

* [Общие сведения о шифровании службы хранилища Azure](../storage/common/storage-service-encryption.md)
* [Шифрование дисков с помощью управляемых клиентом ключей](../virtual-machines/disk-encryption.md#customer-managed-keys) . документация по использованию Azure Key Vault с управляемыми дисками, которые аналогичны сценариям для кэша HPC Azure.

## <a name="next-steps"></a>Дальнейшие действия

После создания кэша Azure HPC и полномочного шифрования на основе Key Vault Продолжайте настраивать кэш, предоставляя ему доступ к источникам данных.

* [Добавление целевых объектов хранилища](hpc-cache-add-storage.md)
