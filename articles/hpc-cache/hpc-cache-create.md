---
title: Создание Azure HPC Cache
description: Создание экземпляра Azure HPC Cache
author: ekpgh
ms.service: hpc-cache
ms.topic: how-to
ms.date: 09/30/2020
ms.author: v-erkel
ms.openlocfilehash: 50fdab1fa8def1b4e3b9a9d59d3b2593e5526c65
ms.sourcegitcommit: 772eb9c6684dd4864e0ba507945a83e48b8c16f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/20/2021
ms.locfileid: "103472043"
---
# <a name="create-an-azure-hpc-cache"></a>Создание Azure HPC Cache

Для создания кэша используйте портал Azure или Azure CLI.

![снимок экрана с обзором кэша на портале Azure с кнопкой "Создать" внизу](media/hpc-cache-home-page.png)

Щелкните изображение ниже, чтобы просмотреть [видео демонстрацию](https://azure.microsoft.com/resources/videos/set-up-hpc-cache/) создания кэша и добавления целевого объекта хранилища.

[![Эскиз видео: кэш Azure HPC: Настройка (щелкните, чтобы посетить страницу видео)](media/video-4-setup.png)](https://azure.microsoft.com/resources/videos/set-up-hpc-cache/)

## <a name="portal"></a>[Портал](#tab/azure-portal)

## <a name="define-basic-details"></a>Определение основных сведений

![снимок экрана: страница со сведениями о проекте на портале Azure](media/hpc-cache-create-basics.png)

В области **Сведения о проекте** выберите подписку и группу ресурсов, в которых будет размещаться кэш.

В области **Сведения о службе** задайте имя кэша и следующие атрибуты:

* Расположение — выберите один из [поддерживаемых регионов](hpc-cache-overview.md#region-availability).
* Виртуальная сеть — вы можете создать виртуальную сеть или выбрать имеющуюся.
* Подсеть — выберите или создайте подсеть с по крайней мере 64 IP-адресами (/24). Эта подсеть должна использоваться только для этого экземпляра кэша Azure HPC.

## <a name="set-cache-capacity"></a>Установка емкости кэша
<!-- referenced from GUI - update aka.ms link if you change this header text -->

На странице **Кэш** необходимо задать емкость кэша. Этот набор значений определяет, какой объем данных может хранить кэш и как быстро он может обслуживать клиентские запросы.

Емкость также влияет на стоимость кэша.

Выберите емкость, задав следующие два значения:

* максимальная скорость передачи данных для кэша (пропускная способность) в ГБ/сек;
* объем хранилища, выделенный для кэшированных данных, в ТБ.

Выберите одно из доступных значений пропускной способности и размеры хранилища кэша.

Имейте в виду, что реальная скорость передачи данных зависит от рабочей нагрузки, скорости сети и типа целевых объектов хранилища. Выбранные значения задают максимальную пропускную способность всей системы кэширования, но часть ее используется для дополнительных задач. Например, если клиент запрашивает файл, который еще не хранится в кэше, или если файл помечен как устаревший, кэш использует часть его пропускной способности для выборки из серверного хранилища.

Azure HPC Cache определяет, какие файлы необходимо кэшировать и предварительно загрузить, чтобы максимально увеличить количество попаданий в кэше. Содержимое кэша постоянно оценивается, а файлы перемещаются в долгосрочное хранение, когда к ним обращаются реже. Выберите размер хранилища кэша, который может разместить активный набор рабочих файлов, а также дополнительное пространство для метаданных и другие издержки.

![снимок экрана: страница определения размера кэша](media/hpc-cache-create-capacity.png)

## <a name="enable-azure-key-vault-encryption-optional"></a>Включить шифрование Azure Key Vault (необязательно)

На вкладках " **кэш** " и " **теги** " отображается страница " **ключи шифрования диска** ".<!-- Read [Regional availability](hpc-cache-overview.md#region-availability) to learn more about region support. -->

Если вы хотите управлять ключами шифрования, используемыми для хранилища кэша, укажите сведения о Azure Key Vault на странице **ключи шифрования диска** . Хранилище ключей должно находиться в том же регионе и в той же подписке, что и кэш.

Этот раздел можно пропустить, если не требуется использовать ключи, управляемые клиентом. По умолчанию Azure шифрует данные с помощью ключей, управляемых корпорацией Майкрософт. Дополнительные сведения см. в статье [Шифрование службы хранилища Azure](../storage/common/storage-service-encryption.md) .

> [!NOTE]
>
> * Невозможно изменить ключи, управляемые корпорацией Майкрософт, и ключи, управляемые клиентом, после создания кэша.
> * После создания кэша необходимо авторизовать его для доступа к хранилищу ключей. Нажмите кнопку **включить шифрование** на странице **обзора** кэша, чтобы включить шифрование. Выполните этот шаг в течение 90 минут после создания кэша.
> * Диски кэша создаются после этой авторизации. Это означает, что начальное время создания кэша является коротким, но кэш не будет готов к использованию в течение десяти минут после авторизации доступа.

Полное описание процесса шифрования с помощью управляемого клиентом ключа см. в статье [Использование управляемых клиентом ключей шифрования для кэша HPC Azure](customer-keys.md).

![снимок экрана со страницей "ключи шифрования" с выбранным "управляемым клиентом" и полями хранилища ключей](media/create-encryption.png)

Выберите **клиент, управляемый** для выбора шифрования ключа, управляемого клиентом. Отобразятся поля спецификации хранилища ключей. Выберите Azure Key Vault для использования, а затем выберите ключ и версию, которые следует использовать для этого кэша. Ключ должен быть 2048-битным ключом RSA. На этой странице можно создать новое хранилище ключей, ключ или версию ключа.

После создания кэша необходимо авторизовать его для использования службы хранилища ключей. Дополнительные сведения см. в статье [авторизация Azure Key Vault шифрования из кэша](customer-keys.md#3-authorize-azure-key-vault-encryption-from-the-cache) .

## <a name="add-resource-tags-optional"></a>Добавление тегов ресурсов (необязательно)

На странице **Теги** можно добавлять [теги ресурсов](../azure-resource-manager/management/tag-resources.md) в экземпляр Azure HPC Cache.

## <a name="finish-creating-the-cache"></a>Завершение создания кэша

После настройки нового кэша перейдите на вкладку **Проверка и создание** . Портал проверяет выбранные параметры и позволяет просматривать выбранные параметры. Если все правильно, нажмите кнопку **Создать**.

Создание кэша занимает около 10 минут. Вы можете отслеживать ход создания на панели уведомлений на портале Azure.

![Снимок экрана со страницами создания кэша и уведомлений на портале](media/hpc-cache-deploy-status.png)

По завершении создания появится уведомление со ссылкой на новый экземпляр Azure HPC Cache, а кэш отобразится в списке **Ресурсы** в подписке.

![снимок экрана: экземпляр Azure HPC Cache на портале Azure](media/hpc-cache-new-overview.png)

> [!NOTE]
> Если кэш использует ключи шифрования, управляемые клиентом, то кэш может отображаться в списке ресурсов до того, как состояние развертывания изменится на завершено. Как только кэш находится в состоянии **ожидания ключа** , [его можно авторизовать](customer-keys.md#3-authorize-azure-key-vault-encryption-from-the-cache) для использования хранилища ключей.

## <a name="azure-cli"></a>[Azure CLI](#tab/azure-cli)

## <a name="create-the-cache-with-azure-cli"></a>Создание кэша с помощью Azure CLI

[Настройте Azure CLI для кэша HPC Azure](./az-cli-prerequisites.md).

> [!NOTE]
> В настоящее время Azure CLI не поддерживает создание кэша с помощью управляемых клиентом ключей шифрования. воспользуйтесь порталом Azure.

Для создания нового кэша Azure HPC используйте команду [AZ HPC-Cache Create](/cli/azure/ext/hpc-cache/hpc-cache#ext-hpc-cache-az-hpc-cache-create) .

Укажите следующие значения:

* Имя группы ресурсов кэша
* Имя кэша
* Регион Azure
* Подсеть кэша в следующем формате:

  ``--subnet "/subscriptions/<subscription_id>/resourceGroups/<cache_resource_group>/providers/Microsoft.Network/virtualNetworks/<virtual_network_name>/sub
nets/<cache_subnet_name>"``

  Подсети кэша требуется по крайней мере 64 IP-адресов (/24) и не могут размещать другие ресурсы.

* Емкость кэша. Два значения задают максимальную пропускную способность кэша HPC Azure:

  * Размер кэша (в ГБ)
  * Номер SKU виртуальных машин, используемых в инфраструктуре кэша

  [AZ HPC — список SKU кэша](/cli/azure/ext/hpc-cache/hpc-cache/skus) показывает доступные номера SKU и допустимые параметры размера кэша для каждого из них. Размер кэша в диапазоне от 3 ТБ до 48 ТБ, но поддерживаются только некоторые значения.

  На этой диаграмме показано, какие комбинации размера кэша и номера SKU действительны во время подготовки этого документа (Июль 2020).

  | Объем кэша | Standard_2G | Standard_4G | Standard_8G |
  |------------|-------------|-------------|-------------|
  | 3072 ГБ    | да         | Нет          | Нет          |
  | 6144 ГБ    | да         | да         | Нет          |
  | 12288 ГБ   | да         | да         | да         |
  | 24576 ГБ   | Нет          | да         | да         |
  | 49152 ГБ   | Нет          | Нет          | да         |

  Ознакомьтесь с разделом **Установка емкости кэша** на вкладке инструкции портала, чтобы получить важные сведения о ценах, пропускной способности и том, как правильно установить размер кэша для рабочего процесса.

Пример создания кэша:

```azurecli
az hpc-cache create --resource-group doc-demo-rg --name my-cache-0619 \
    --location "eastus" --cache-size-gb "3072" \
    --subnet "/subscriptions/<subscription-ID>/resourceGroups/doc-demo-rg/providers/Microsoft.Network/virtualNetworks/vnet-doc0619/subnets/default" \
    --sku-name "Standard_2G"
```

Создание кэша занимает несколько минут. При успешном выполнении команда Create возвращает выходные данные следующего вида:

```azurecli
{
  "cacheSizeGb": 3072,
  "health": {
    "state": "Healthy",
    "statusDescription": "The cache is in Running state"
  },
  "id": "/subscriptions/<subscription-ID>/resourceGroups/doc-demo-rg/providers/Microsoft.StorageCache/caches/my-cache-0619",
  "location": "eastus",
  "mountAddresses": [
    "10.3.0.17",
    "10.3.0.18",
    "10.3.0.19"
  ],
  "name": "my-cache-0619",
  "provisioningState": "Succeeded",
  "resourceGroup": "doc-demo-rg",
  "sku": {
    "name": "Standard_2G"
  },
  "subnet": "/subscriptions/<subscription-ID>/resourceGroups/doc-demo-rg/providers/Microsoft.Network/virtualNetworks/vnet-doc0619/subnets/default",
  "tags": null,
  "type": "Microsoft.StorageCache/caches",
  "upgradeStatus": {
    "currentFirmwareVersion": "5.3.42",
    "firmwareUpdateDeadline": "0001-01-01T00:00:00+00:00",
    "firmwareUpdateStatus": "unavailable",
    "lastFirmwareUpdate": "2020-04-01T15:19:54.068299+00:00",
    "pendingFirmwareVersion": null
  }
}
```

Сообщение содержит некоторую полезную информацию, включая следующие:

* Адреса подключения клиентов. Используйте эти IP-адреса, когда будете готовы к подключению клиентов к кэшу. Дополнительные сведения см. в статье [Подключение кэша HPC для Azure](hpc-cache-mount.md) .
* Состояние обновления — при выпуске обновления программного обеспечения это сообщение будет изменено. [Программное обеспечение для кэширования можно обновить](hpc-cache-manage.md#upgrade-cache-software) вручную в удобное время, иначе оно будет применено автоматически через несколько дней.

## <a name="azure-powershell"></a>[Azure PowerShell](#tab/azure-powershell)

> [!CAUTION]
> Модуль PowerShell AZ. Хпккаче в настоящее время находится в общедоступной предварительной версии. Эта предварительная версия предоставляется без соглашения об уровне обслуживания. Эта версия не рекомендуется для использования с рабочими нагрузками в производственной среде. Некоторые функции могут не поддерживаться или иметь ограниченные возможности. Дополнительные сведения см. в статье [Дополнительные условия использования предварительных выпусков Microsoft Azure](https://azure.microsoft.com/support/legal/preview-supplemental-terms/).

## <a name="requirements"></a>Требования

Если вы решили использовать PowerShell локально, для работы с этой статьей установите модуль PowerShell Az и подключитесь к учетной записи Azure с помощью командлета [Connect-AzAccount](/powershell/module/az.accounts/connect-azaccount). См. сведения об [установке модуля Azure PowerShell](/powershell/azure/install-az-ps). Если вы решили использовать Cloud Shell, дополнительные сведения см. в статье [Обзор Azure Cloud Shell](../cloud-shell/overview.md).

> [!IMPORTANT]
> Пока модуль PowerShell **AZ. хпккаче** находится на этапе предварительной версии, его необходимо установить отдельно с помощью `Install-Module` командлета. После того как этот модуль PowerShell станет общедоступным, он будет частью будущих выпусков AZ PowerShell, доступных в Azure Cloud Shell.

```azurepowershell-interactive
Install-Module -Name Az.HPCCache
```

## <a name="create-the-cache-with-azure-powershell"></a>Создание кэша с помощью Azure PowerShell

> [!NOTE]
> В настоящее время Azure PowerShell не поддерживает создание кэша с помощью управляемых клиентом ключей шифрования. воспользуйтесь порталом Azure.

Используйте командлет [New-азпккаче](/powershell/module/az.hpccache/new-azhpccache) для создания нового кэша Azure HPC.

Укажите следующие значения:

* Имя группы ресурсов кэша
* Имя кэша
* Регион Azure
* Подсеть кэша в следующем формате:

  `-SubnetUri "/subscriptions/<subscription_id>/resourceGroups/<cache_resource_group>/providers/Microsoft.Network/virtualNetworks/<virtual_network_name>/sub
nets/<cache_subnet_name>"`

  Подсети кэша требуется по крайней мере 64 IP-адресов (/24) и не могут размещать другие ресурсы.

* Емкость кэша. Два значения задают максимальную пропускную способность кэша HPC Azure:

  * Размер кэша (в ГБ)
  * Номер SKU виртуальных машин, используемых в инфраструктуре кэша

  [Get-азпккаческу](/powershell/module/az.hpccache/get-azhpccachesku) показывает доступные номера SKU и допустимые параметры размера кэша для каждого из них. Размер кэша в диапазоне от 3 ТБ до 48 ТБ, но поддерживаются только некоторые значения.

  На этой диаграмме показано, какие комбинации размера кэша и номера SKU действительны во время подготовки этого документа (Июль 2020).

  | Объем кэша | Standard_2G | Standard_4G | Standard_8G |
  |------------|-------------|-------------|-------------|
  | 3072 ГБ    | да         | Нет          | Нет          |
  | 6144 ГБ    | да         | да         | Нет          |
  | 12 288 ГБ   | да         | да         | да         |
  | 24 576 ГБ   | Нет          | да         | да         |
  | 49 152 ГБ   | Нет          | Нет          | да         |

  Ознакомьтесь с разделом **Установка емкости кэша** на вкладке инструкции портала, чтобы получить важные сведения о ценах, пропускной способности и том, как правильно установить размер кэша для рабочего процесса.

Пример создания кэша:

```azurepowershell-interactive
$cacheParams = @{
  ResourceGroupName = 'doc-demo-rg'
  CacheName = 'my-cache-0619'
  Location = 'eastus'
  cacheSize = '3072'
  SubnetUri = "/subscriptions/<subscription-ID>/resourceGroups/doc-demo-rg/providers/Microsoft.Network/virtualNetworks/vnet-doc0619/subnets/default"
  Sku = 'Standard_2G'
}
New-AzHpcCache @cacheParams
```

Создание кэша занимает несколько минут. При успешном выполнении команда Create возвращает следующие выходные данные:

```Output
cacheSizeGb       : 3072
health            : @{state=Healthy; statusDescription=The cache is in Running state}
id                : /subscriptions/<subscription-ID>/resourceGroups/doc-demo-rg/providers/Microsoft.StorageCache/caches/my-cache-0619
location          : eastus
mountAddresses    : {10.3.0.17, 10.3.0.18, 10.3.0.19}
name              : my-cache-0619
provisioningState : Succeeded
resourceGroup     : doc-demo-rg
sku               : @{name=Standard_2G}
subnet            : /subscriptions/<subscription-ID>/resourceGroups/doc-demo-rg/providers/Microsoft.Network/virtualNetworks/vnet-doc0619/subnets/default
tags              :
type              : Microsoft.StorageCache/caches
upgradeStatus     : @{currentFirmwareVersion=5.3.42; firmwareUpdateDeadline=1/1/0001 12:00:00 AM; firmwareUpdateStatus=unavailable; lastFirmwareUpdate=4/1/2020 10:19:54 AM; pendingFirmwareVersion=}
```

Сообщение содержит некоторую полезную информацию, включая следующие:

* Адреса подключения клиентов. Используйте эти IP-адреса, когда будете готовы к подключению клиентов к кэшу. Дополнительные сведения см. в статье [Подключение кэша HPC для Azure](hpc-cache-mount.md) .
* Состояние обновления — при выпуске обновления программного обеспечения это сообщение изменяется. [Программное обеспечение для кэширования можно обновлять](hpc-cache-manage.md#upgrade-cache-software) вручную в удобное время или автоматически через несколько дней.

---

## <a name="next-steps"></a>Следующие шаги

После того как кэш появится в списке **ресурсов** , можно перейти к следующему шагу.

* [Определите целевые объекты хранилища](hpc-cache-add-storage.md) , чтобы предоставить доступ к своим источникам данных в кэше.
* Если вы используете ключи шифрования, управляемые клиентом, необходимо [авторизовать Azure Key Vaultное шифрование](customer-keys.md#3-authorize-azure-key-vault-encryption-from-the-cache) на странице обзора кэша, чтобы завершить настройку кэша. Этот шаг необходимо выполнить, прежде чем можно будет добавить хранилище. Дополнительные сведения см. в статье [Использование управляемых клиентом ключей шифрования](customer-keys.md) .