---
title: Предварительные требования для кэша HPC Azure
description: Необходимые условия для использования кэша HPC для Azure
author: ekpgh
ms.service: hpc-cache
ms.topic: how-to
ms.date: 03/15/2021
ms.author: v-erkel
ms.openlocfilehash: 5ac0f0677be6b641d496a941c5a8e1343fd017bc
ms.sourcegitcommit: 772eb9c6684dd4864e0ba507945a83e48b8c16f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/20/2021
ms.locfileid: "103562564"
---
# <a name="prerequisites-for-azure-hpc-cache"></a>Необходимые условия для кэша HPC для Azure

Прежде чем использовать портал Azure для создания нового кэша Azure HPC, убедитесь, что среда соответствует этим требованиям.

## <a name="video-overviews"></a>Обзоры видео

Просмотрите эти видеоролики, чтобы получить краткий обзор компонентов системы и то, что им необходимо для совместной работы.

(Щелкните изображение видео или ссылку для просмотра.)

* [Как это работает](https://azure.microsoft.com/resources/videos/how-hpc-cache-works/) — объясняет, как кэш Azure HPC взаимодействует с хранилищем и клиентами.

  [![изображение эскиза видео: кэш Azure HPC: как он работает (щелкните, чтобы посетить страницу видео)](media/video-2-components.png)](https://azure.microsoft.com/resources/videos/how-hpc-cache-works/)  

* [Необходимые условия](https://azure.microsoft.com/resources/videos/hpc-cache-prerequisites/) . описание требований к хранилищу NAS, хранилищу BLOB-объектов Azure, доступу к сети и доступу клиентов

  [![изображение эскиза видео: кэш Azure HPC: предварительные требования (щелкните, чтобы посетить страницу видео)](media/video-3-prerequisites.png)](https://azure.microsoft.com/resources/videos/hpc-cache-prerequisites/)

Для получения конкретных рекомендаций прочитайте оставшуюся часть этой статьи.

## <a name="azure-subscription"></a>Подписка Azure.

Рекомендуется использовать платную подписку.

## <a name="network-infrastructure"></a>Инфраструктура сети

Прежде чем можно будет использовать кэш, необходимо настроить два компонента, связанных с сетью:

* Выделенная подсеть для экземпляра кэша Azure HPC
* Поддержка DNS для того, чтобы кэш мог получать доступ к хранилищу и другим ресурсам.

### <a name="cache-subnet"></a>Подсеть кэша

Для кэша HPC Azure требуется выделенная подсеть со следующими характеристиками:

* В подсети должен быть доступен по крайней мере 64 IP-адресов.
* Подсеть не может размещать другие виртуальные машины даже для связанных служб, таких как клиентские компьютеры.
* При использовании нескольких экземпляров кэша Azure HPC каждому из них требуется собственная подсеть.

Рекомендуется создать новую подсеть для каждого кэша. Вы можете создать виртуальную сеть и подсеть в процессе создания кэша.

### <a name="dns-access"></a>Доступ к DNS

Для доступа к ресурсам за пределами своей виртуальной сети в кэше требуется DNS. В зависимости от того, какие ресурсы используются, может потребоваться настроить настраиваемый DNS-сервер и настроить перенаправление между этим сервером и Azure DNS серверами:

* Для доступа к конечным точкам хранилища BLOB-объектов Azure и другим внутренним ресурсам необходим DNS-сервер на основе Azure.
* Для доступа к локальному хранилищу необходимо настроить пользовательский DNS-сервер, который может разрешать имена узлов хранилища. Это необходимо сделать **перед** созданием кэша.

Если вы используете только хранилище BLOB-объектов, для кэша можно использовать предоставляемый Azure сервер DNS по умолчанию. Однако если вам нужен доступ к хранилищу или другим ресурсам за пределами Azure, необходимо создать пользовательский DNS-сервер и настроить его для пересылки любых запросов на разрешение, специфичных для Azure, на сервер Azure DNS.

Чтобы использовать пользовательский DNS-сервер, перед созданием кэша необходимо выполнить следующие действия по установке:

* Создайте виртуальную сеть, в которой будет размещаться кэш HPC Azure.
* Создайте DNS-сервер.
* Добавьте DNS-сервер в виртуальную сеть кэша.

  Выполните следующие действия, чтобы добавить DNS-сервер в виртуальную сеть в портал Azure:

  1. Откройте виртуальную сеть в портал Azure.
  1. Выберите **DNS-серверы** в меню **Параметры** на боковой панели.
  1. выберите **Пользовательское**.
  1. Введите IP-адрес DNS-сервера в поле.

Простой DNS-сервер также можно использовать для балансировки нагрузки клиентских подключений между всеми доступными точками подключения кэша.

Дополнительные сведения о виртуальных сетях Azure и конфигурациях DNS-серверов см. в [статье разрешение имен для ресурсов в виртуальных сетях Azure](../virtual-network/virtual-networks-name-resolution-for-vms-and-role-instances.md).

## <a name="permissions"></a>Разрешения

Прежде чем начать создание кэша, проверьте эти компоненты, связанные с разрешениями.

* Экземпляр кэша должен иметь возможность создания виртуальных сетевых интерфейсов (NIC). Пользователь, создающий кэш, должен иметь достаточные привилегии в подписке для создания сетевых карт.

* При использовании хранилища BLOB-объектов для кэша Azure HPC требуется авторизация для доступа к вашей учетной записи хранения. Используйте управление доступом на основе ролей Azure (Azure RBAC), чтобы предоставить кэшу доступ к хранилищу BLOB-объектов. Требуются две роли: участник учетной записи хранения и участник данных большого двоичного объекта хранилища.

  Следуйте инструкциям в разделе [Добавление целевых объектов хранилища](hpc-cache-add-storage.md#add-the-access-control-roles-to-your-account) , чтобы добавить роли.

## <a name="storage-infrastructure"></a>Инфраструктура хранилища
<!-- heading is linked in create storage target GUI as aka.ms/hpc-cache-prereq#storage-infrastructure - make sure to fix that if you change the wording of this heading -->

Кэш поддерживает контейнеры больших двоичных объектов Azure, экспорт оборудования NFS и контейнеры BLOB-объектов ADLS, подключенные NFS (в настоящее время в предварительной версии). Добавьте целевые объекты хранилища после создания кэша.

Каждый тип хранилища имеет определенные предварительные требования.

### <a name="blob-storage-requirements"></a>Требования к хранилищу BLOB-объектов

Если вы хотите использовать хранилище BLOB-объектов Azure с кэшем, вам потребуется совместимая учетная запись хранения и пустой контейнер больших двоичных объектов или контейнер, который заполняется данными в формате кэша HPC Azure, как описано в разделе [Перемещение данных в хранилище BLOB-объектов Azure](hpc-cache-ingest.md).

> [!NOTE]
> Для хранилища BLOB-объектов, подключенного к NFS, применяются разные требования. Дополнительные сведения см. в статье [требования к хранилищу ADLS-NFS](#nfs-mounted-blob-adls-nfs-storage-requirements-preview) .

Создайте учетную запись, прежде чем пытаться добавить целевой объект хранилища. При добавлении целевого объекта можно создать новый контейнер.

Чтобы создать совместимую учетную запись хранения, используйте следующие параметры:

* Производительность: **стандартный**
* Тип учетной записи: **StorageV2 (общее назначение версии 2)**
* Репликация: **локально избыточное хранилище (LRS)**
* Уровень доступа (по умолчанию): **горячий**

Рекомендуется использовать учетную запись хранения в том же расположении, что и кэш.

Вы также должны предоставить приложению кэширования доступ к учетной записи хранения Azure, как упоминалось в [разрешениях](#permissions)выше. Выполните процедуру, описанную в разделе [Добавление целевых объектов хранилища](hpc-cache-add-storage.md#add-the-access-control-roles-to-your-account) , чтобы обеспечить кэширование необходимых ролей доступа. Если вы не являетесь владельцем учетной записи хранения, владелец этого этапа.

### <a name="nfs-storage-requirements"></a>Требования к хранилищу NFS
<!-- linked from configuration.md -->

Если используется система хранения NFS (например, локальная аппаратная система NAS), убедитесь, что она соответствует этим требованиям. Для проверки этих параметров может потребоваться работа с сетевыми администраторами или диспетчерами брандмауэра для системы хранения (или центра обработки данных).

> [!NOTE]
> Создание целевого объекта хранилища завершится ошибкой, если кэш не имеет достаточных прав доступа к системе хранения NFS.

Дополнительные сведения см. в статье [Устранение неполадок конфигурации NAS и целевого объекта хранилища NFS](troubleshoot-nas.md).

* **Сетевое подключение:** Кэш HPC Azure требует доступа к сети с высокой пропускной способностью между подсетью кэша и центром обработки данных системы NFS. Рекомендуется использовать [ExpressRoute](../expressroute/index.yml) или аналогичный доступ. При использовании VPN может потребоваться настроить его для фиксации TCP-MSS в 1350, чтобы гарантировать, что большие пакеты не блокируются. Дополнительные сведения об устранении неполадок параметров VPN см. в статье [ограничения размера пакетов VPN](troubleshoot-nas.md#adjust-vpn-packet-size-restrictions) .

* **Доступ к портам:** Для кэша требуется доступ к конкретным портам TCP/UDP в системе хранения. Различные типы хранилища имеют разные требования к портам.

  Чтобы проверить параметры системы хранения, выполните следующую процедуру.

  * Выполните `rpcinfo` команду в системе хранения, чтобы проверить необходимые порты. Приведенная ниже команда перечисляет порты и форматирует соответствующие результаты в таблице. (Используйте IP-адрес системы вместо *<storage_IP>* .)

    Эту команду можно выполнить из любого клиента Linux с установленной инфраструктурой NFS. Если вы используете клиент в подсети кластера, он также может помочь проверить подключение между подсетью и системой хранения данных.

    ```bash
    rpcinfo -p <storage_IP> |egrep "100000\s+4\s+tcp|100005\s+3\s+tcp|100003\s+3\s+tcp|100024\s+1\s+tcp|100021\s+4\s+tcp"| awk '{print $4 "/" $3 " " $5}'|column -t
    ```

  Убедитесь, что все порты, возвращенные ``rpcinfo`` запросом, разрешают неограниченный трафик из подсети кэша HPC Azure.

  * Если вы не можете использовать `rpcinfo` команду, убедитесь, что эти часто используемые порты разрешают входящий и исходящий трафик:

    | Протокол | Порт  | Служба  |
    |----------|-------|----------|
    | TCP/UDP  | 111   | rpcbind  |
    | TCP/UDP  | 2049  | NFS      |
    | TCP/UDP  | 4045  | нлоккмгр |
    | TCP/UDP  | 4046  | подключено   |
    | TCP/UDP  | 4047  | status   |

    Некоторые системы используют разные номера портов для этих служб. чтобы убедиться, обратитесь к документации по системе хранения.

  * Проверьте параметры брандмауэра, чтобы убедиться, что они разрешают трафик на всех этих требуемых портах. Не забудьте проверить брандмауэры, используемые в Azure, а также локальные брандмауэры в центре обработки данных.

* **Доступ к каталогу:** Включите `showmount` команду в системе хранения. Кэш Azure HPC использует эту команду, чтобы проверить, указывает ли Целевая конфигурация хранилища допустимый экспорт, а также убедитесь, что несколько подключений не имеют доступа к одним и тем же подкаталогам (риск конфликта файлов).

  > [!NOTE]
  > Если система хранения NFS использует операционную систему NetApp ONTAP 9,2, не **Включайте `showmount`**. [Обратитесь в службу технической поддержки Майкрософт](hpc-cache-support-ticket.md) за помощью.

  Дополнительные сведения о доступе к списку каталогов см. в [статье Устранение неполадок](troubleshoot-nas.md#enable-export-listing)целевого объекта хранилища NFS.

* **Корневой доступ** (чтение и запись). кэш подключается к внутренней системе в качестве пользователя с идентификатором 0. Проверьте эти параметры в системе хранения:
  
  * Включите `no_root_squash`. Этот параметр гарантирует, что удаленный корневой пользователь сможет получить доступ к файлам, принадлежащим корневому пользователю.

  * Установите флажок политики экспорта, чтобы убедиться, что они не включают ограничения на привилегированный доступ из подсети кэша.

  * Если в хранилище имеются экспорты, которые являются подкаталогами другого экспорта, убедитесь, что кэш имеет корневой доступ к наименьшему сегменту пути. Дополнительные сведения см. в статье Устранение неполадок [с корневым доступом по путям к каталогам](troubleshoot-nas.md#allow-root-access-on-directory-paths) в хранилище NFS.

* Серверное хранилище NFS должно быть совместимой аппаратной или программной платформой. Для получения дополнительных сведений обратитесь к группе кэша HPC Azure.

### <a name="nfs-mounted-blob-adls-nfs-storage-requirements-preview"></a>Требования к хранилищу BLOB-объектов, подключенным к NFS (ADLS-NFS) (Предварительная версия)

Кэш HPC Azure также может использовать контейнер больших двоичных объектов, подключенный к протоколу NFS в качестве целевого объекта хранилища.

> [!NOTE]
> Поддержка протокола NFS 3,0 для хранилища BLOB-объектов Azure доступна в общедоступной предварительной версии. Доступность ограничена, и функции могут измениться в настоящее время и когда функция станет общедоступной. Не используйте технологию предварительной версии в рабочих системах.
>
> Дополнительные сведения об этой предварительной версии функции см. в статье [Поддержка протокола NFS 3,0 в хранилище BLOB-объектов Azure](../storage/blobs/network-file-system-protocol-support.md).

Требования к учетной записи хранения отличаются для целевого объекта хранилища больших двоичных объектов ADLS-NFS и для целевого объекта хранилища больших двоичных объектов. Следуйте инструкциям в разделе [Подключение хранилища BLOB-объектов с помощью протокола nfs 3,0](../storage/blobs/network-file-system-protocol-support-how-to.md) , чтобы создать и настроить учетную запись хранения с поддержкой NFS.

Это общий обзор шагов. Эти действия могут измениться, поэтому всегда используйте [инструкции ADLS-NFS](../storage/blobs/network-file-system-protocol-support-how-to.md) для получения текущих сведений.

1. Убедитесь, что необходимые компоненты доступны в регионах, где вы планируете работать.

1. Включите функцию протокола NFS для своей подписки. Сделайте это *до* создания учетной записи хранения.

1. Создайте защищенную виртуальную сеть (VNet) для учетной записи хранения. Для учетной записи хранения с поддержкой NFS и кэша HPC Azure следует использовать ту же виртуальную сеть. (Не используйте ту же подсеть, что и кэш.)

1. Создайте учетную запись хранения.

   * Вместо использования параметров учетной записи хранения для стандартной учетной записи хранения BLOB-объектов следуйте инструкциям в [документе инструкции](../storage/blobs/network-file-system-protocol-support-how-to.md). Тип поддерживаемой учетной записи хранения может отличаться в зависимости от региона Azure.

   * В разделе **Сетевые подключения** выберите частную конечную точку в созданной защищенной виртуальной сети (рекомендуется) или выберите общедоступную конечную точку с ограниченным доступом из защищенной сети.

   * Не забудьте завершить раздел **Advanced** , где можно включить доступ NFS.

   * Предоставьте приложению кэша доступ к учетной записи хранения Azure, как указано в [разрешениях](#permissions), описанных выше. Это можно сделать при первом создании целевого объекта хранилища. Выполните процедуру, описанную в разделе [Добавление целевых объектов хранилища](hpc-cache-add-storage.md#add-the-access-control-roles-to-your-account) , чтобы обеспечить кэширование необходимых ролей доступа.

     Если вы не являетесь владельцем учетной записи хранения, владелец этого этапа.

## <a name="set-up-azure-cli-access-optional"></a>Настройка доступа к Azure CLI (необязательно)

Если вы хотите создать кэш HPC Azure или управлять им из интерфейса командной строки Azure (Azure CLI), необходимо установить программное обеспечение CLI и расширение кэша HPC. Следуйте инструкциям в разделе [настройка Azure CLI для кэша HPC Azure](az-cli-prerequisites.md).

## <a name="next-steps"></a>Следующие шаги

* [Создание экземпляра кэша Azure HPC](hpc-cache-create.md) из портал Azure
