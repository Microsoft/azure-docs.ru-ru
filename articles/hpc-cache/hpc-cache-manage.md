---
title: Управление кэшем HPC Azure и его обновление
description: Как управлять кэшем HPC Azure и обновлять его с помощью портал Azure или Azure CLI
author: ekpgh
ms.service: hpc-cache
ms.topic: how-to
ms.date: 03/08/2021
ms.author: v-erkel
ms.openlocfilehash: b34beb65bb8c4136887651d8365c937b17718572
ms.sourcegitcommit: 66ce33826d77416dc2e4ba5447eeb387705a6ae5
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/15/2021
ms.locfileid: "103471881"
---
# <a name="manage-your-cache"></a>Управление кэшем

На странице обзора кэша в портал Azure отображаются сведения о проекте, состояние кэша и базовая статистика для кэша. Он также имеет элементы управления для отмены или запуска кэша, удаления кэша, записи данных в долгосрочное хранение и обновления программного обеспечения.

В этой статье также объясняется, как выполнять эти основные задачи с помощью Azure CLI.

Чтобы открыть страницу обзора, выберите ресурс кэша в портал Azure. Например, загрузите страницу **все ресурсы** и щелкните имя кэша.

![снимок экрана со страницей обзора экземпляра кэша Azure HPC](media/hpc-cache-overview.png)

Кнопки в верхней части страницы могут помочь в управлении кэшем:

* **Запуск** и [**Остановка**](#stop-the-cache) — возобновление или приостановка операции кэширования
* [**Flush**](#flush-cached-data) — записывает измененные данные в целевые объекты хранилища
* [**Обновление**](#upgrade-cache-software) — обновляет программное обеспечение кэша.
* [**Получение данных диагностики**](#collect-diagnostics) — Отправка отладочной информации
* **Обновить** — перезагружает страницу обзора
* [**Delete**](#delete-the-cache) — безвозвратное уничтожение кэша

Подробнее об этих параметрах см. ниже.

Щелкните изображение ниже, чтобы просмотреть [видеоролик](https://azure.microsoft.com/resources/videos/managing-hpc-cache/) , демонстрирующий задачи управления кэшем.

[![Эскиз видео. кэш Azure HPC: управление (щелкните, чтобы посетить страницу видео)](media/video-5-manage.png)](https://azure.microsoft.com/resources/videos/managing-hpc-cache/)

## <a name="stop-the-cache"></a>Завершение кэша

Вы можете прерывать кэш, чтобы снизить затраты в течение неактивного периода. Вы не платите за время работы, пока кэш остановлен, но вы платите за выделенный дисковый накопитель в кэше. (Дополнительные сведения см. на странице с [ценами](https://aka.ms/hpc-cache-pricing) .)

Остановленный кэш не отвечает на запросы клиентов. Перед остановкой кэша следует отключить клиентов.

### <a name="portal"></a>[Портал](#tab/azure-portal)

Кнопка **остановить** приостанавливает активный кэш. Кнопка " **Закрыть** " доступна, когда состояние кэша является **работоспособным** или **сниженным**.

![снимок экрана с верхними кнопками с выделенной кнопкой "прекратить" и всплывающим сообщением с описанием действия "завершение" и запросом "продолжить?" со значением Да (по умолчанию) и без кнопок](media/stop-cache.png)

После нажатия кнопки Да для подтверждения остановки кэша кэш автоматически сбрасывает свое содержимое в целевые объекты хранилища. Этот процесс может занять некоторое время, но обеспечивает согласованность данных. Наконец, состояние кэша меняется на **остановлено**.

Чтобы повторно активировать остановленный кэш, нажмите кнопку " **Пуск** ". Подтверждение не требуется.

![снимок экрана с верхними кнопками с выделенным пунктом "запустить"](media/start-cache.png)

### <a name="azure-cli"></a>[Azure CLI](#tab/azure-cli)

[Настройте Azure CLI для кэша HPC Azure](./az-cli-prerequisites.md).

Временное приостановка кэша с помощью команды [AZ HPC-Cache остановить](/cli/azure/ext/hpc-cache/hpc-cache#ext-hpc-cache-az-hpc-cache-stop) . Это действие допустимо только в том случае, если состояние кэша является **работоспособным** или **сниженным**.

Кэш автоматически сбрасывает свое содержимое в целевые объекты хранилища перед остановкой. Этот процесс может занять некоторое время, но обеспечивает согласованность данных.

После завершения действия состояние кэша изменится на **остановлено**.

Повторно активируйте остановленный кэш с помощью команды [AZ HPC-Cache Start](/cli/azure/ext/hpc-cache/hpc-cache#ext-hpc-cache-az-hpc-cache-start).

При выполнении команды Start или останавливают в командной строке отображается сообщение о состоянии "выполняется" до завершения операции.

```azurecli
$ az hpc-cache start --name doc-cache0629
 - Running ..
```

По завершении сообщение обновляется на "завершено" и отображает коды возврата и другие сведения.

```azurecli
$ az hpc-cache start --name doc-cache0629
{- Finished ..
  "endTime": "2020-07-01T18:46:43.6862478+00:00",
  "name": "c48d320f-f5f5-40ab-8b25-0ac065984f62",
  "properties": {
    "output": "success"
  },
  "startTime": "2020-07-01T18:40:28.5468983+00:00",
  "status": "Succeeded"
}
```

---

## <a name="flush-cached-data"></a>Очистить кэшированные данные

Кнопка **очистить** на странице обзор указывает кэшу на немедленную запись всех измененных данных, хранящихся в кэше, на целевые объекты хранилища серверной части. Кэш, как правило, сохраняет данные в целевые объекты хранилища, поэтому нет необходимости делать это вручную, если не требуется гарантировать актуальность серверной системы хранения данных. Например, можно использовать **flush** перед созданием моментального снимка хранилища или проверкой размера набора данных.

> [!NOTE]
> В процессе очистки кэш не может обслуживать клиентские запросы. Доступ к кэшу приостановлен и возобновляется после завершения операции.

При запуске операции записи в кэш кэш прекращает принимать запросы клиентов, а состояние кэша на странице обзора изменяется на **запись на диск**.

Данные в кэше сохраняются в соответствующих целевых объектах хранилища. В зависимости от объема данных, которые необходимо сбросить, процесс может занять несколько минут или более часа.

После сохранения всех данных в целевых объектах хранилища кэш автоматически начинает выполнять запросы клиентов. Состояние кэша возвращается к **работоспособному**.

### <a name="portal"></a>[Портал](#tab/azure-portal)

Чтобы сбросить кэш, нажмите кнопку **Сброс** , а затем нажмите кнопку **Да** , чтобы подтвердить действие.

![снимок экрана с верхними кнопками с выделенным сбросом и всплывающим сообщением с описанием действия сброса и запросом "продолжить?" со значением Да (по умолчанию) и без кнопок](media/hpc-cache-flush.png)

### <a name="azure-cli"></a>[Azure CLI](#tab/azure-cli)

[Настройте Azure CLI для кэша HPC Azure](./az-cli-prerequisites.md).

Используйте [AZ HPC-Cache Flush](/cli/azure/ext/hpc-cache/hpc-cache#ext-hpc-cache-az-hpc-cache-flush) , чтобы принудительно записать все измененные данные в целевые объекты хранилища.

Пример

```azurecli
$ az hpc-cache flush --name doc-cache0629 --resource-group doc-rg
 - Running ..
```

По завершении очистки возвращается сообщение об успешном выполнении.

```azurecli
{- Finished ..
  "endTime": "2020-07-09T17:26:13.9371983+00:00",
  "name": "c22f8e12-fcf0-49e5-b897-6a6e579b6489",
  "properties": {
    "output": "success"
  },
  "startTime": "2020-07-09T17:25:21.4278297+00:00",
  "status": "Succeeded"
}
$
```

---

## <a name="upgrade-cache-software"></a>Обновление программного обеспечения кэша

Если доступна новая версия программного обеспечения, кнопка **Обновить** становится активной. Кроме того, в верхней части страницы появится сообщение об обновлении программного обеспечения.

![снимок экрана верхней строки кнопок с включенной кнопкой "Обновить"](media/hpc-cache-upgrade-button.png)

При обновлении программного обеспечения клиентский доступ не прерывается, но производительность кэша снижается. Планируйте обновление программного обеспечения во время непикового использования или в течение запланированного периода обслуживания.

Обновление программного обеспечения может занять несколько часов. Кэши, настроенные с более высокой пропускной способностью, обновляются дольше, чем кэши с меньшими пиковыми значениями пропускной способности.

Если обновление программного обеспечения доступно, вы получите неделю или установите его вручную. Дата окончания указана в сообщении об обновлении. Если вы не обновите его в течение этого времени, Azure автоматически применит обновление к кэшу. Время автоматического обновления не настраивается. Если вы беспокоитесь о влиянии на производительность кэша, необходимо обновить программное обеспечение самостоятельно до истечения периода времени.

Если кэш остановлен по истечении даты окончания, кэш автоматически обновит программное обеспечение при следующем его запуске. (Обновление может начаться не сразу, но начнется через первый час.)

### <a name="portal"></a>[Портал](#tab/azure-portal)

Нажмите кнопку **Обновить** , чтобы начать обновление программного обеспечения. Состояние кэша изменится на **Обновление** до завершения операции.

### <a name="azure-cli"></a>[Azure CLI](#tab/azure-cli)

[Настройте Azure CLI для кэша HPC Azure](./az-cli-prerequisites.md).

На Azure CLI новые сведения о программном обеспечении включаются в конец отчета о состоянии кэша. (Для проверки используйте команду [AZ HPC-Cache](/cli/azure/ext/hpc-cache/hpc-cache#ext-hpc-cache-az-hpc-cache-show) .) Найдите строку "Упградестатус" в сообщении.

Используйте [AZ HPC — обновление кэша — встроенное по](/cli/azure/ext/hpc-cache/hpc-cache#ext-hpc-cache-az-hpc-cache-upgrade-firmware) для применения обновления (если таковое имеется).

Если обновление недоступно, эта операция не действует.

В этом примере показано состояние кэша (нет доступных обновлений) и результаты выполнения команды обновления встроенного по.

```azurecli
$ az hpc-cache show --name doc-cache0629
{
  "cacheSizeGb": 3072,
  "health": {
    "state": "Healthy",
    "statusDescription": "The cache is in Running state"
  },

<...>

  "tags": null,
  "type": "Microsoft.StorageCache/caches",
  "upgradeStatus": {
    "currentFirmwareVersion": "5.3.61",
    "firmwareUpdateDeadline": "0001-01-01T00:00:00+00:00",
    "firmwareUpdateStatus": "unavailable",
    "lastFirmwareUpdate": "2020-06-29T22:18:32.004822+00:00",
    "pendingFirmwareVersion": null
  }
}
$ az hpc-cache upgrade-firmware --name doc-cache0629
$
```

---

## <a name="collect-diagnostics"></a>Сбор диагностических данных

Кнопка " **получить диагностику** " вручную запускает процесс для получения сведений о системе и их передачи в службу Майкрософт и поддержки для устранения неполадок. Кэш автоматически собирает и отправляет одну и ту же диагностическую информацию, если возникает серьезная проблема с кэшем.

Используйте этот элемент управления, если служба и поддержка Майкрософт запрашивают ее.

После нажатия кнопки нажмите кнопку **Да** , чтобы подтвердить передачу.

![снимок экрана всплывающего сообщения с подтверждением "Запуск сбора диагностики". Кнопка по умолчанию "Yes" выделена.](media/diagnostics-confirm.png)

## <a name="delete-the-cache"></a>Удаление кэша

Кнопка **Удалить** уничтожает кэш. При удалении кэша все его ресурсы уничтожаются и больше не взимается плата за учетную запись.

Резервные тома хранилища, используемые в качестве целевых объектов хранилища, не затрагиваются при удалении кэша. Вы можете добавить их в будущем кэше позже или списать их отдельно.

> [!NOTE]
> Кэш Azure HPC не будет автоматически записывать измененные данные из кэша в серверные системы хранения перед удалением кэша.
>
> Чтобы убедиться в том, что все данные в кэше записаны в долгосрочное хранение, [закройте кэш](#stop-the-cache) перед удалением. Убедитесь, что перед удалением отображается состояние **остановлено** .

### <a name="portal"></a>[Портал](#tab/azure-portal)

После остановки кэша нажмите кнопку " **Удалить** ", чтобы окончательно удалить кэш.

### <a name="azure-cli"></a>[Azure CLI](#tab/azure-cli)

[Настройте Azure CLI для кэша HPC Azure](./az-cli-prerequisites.md).

Чтобы окончательно удалить кэш, воспользуйтесь командой Azure CLI [AZ HPC-Cache Delete](/cli/azure/ext/hpc-cache/hpc-cache#ext-hpc-cache-az-hpc-cache-delete) .

Пример
```azurecli
$ az hpc-cache delete --name doc-cache0629
 - Running ..

<...>

{- Finished ..
  "endTime": "2020-07-09T22:24:35.1605019+00:00",
  "name": "7d3cd0ba-11b3-4180-8298-d9cafc9f22c1",
  "startTime": "2020-07-09T22:13:32.0732892+00:00",
  "status": "Succeeded"
}
$
```

---

## <a name="cache-metrics-and-monitoring"></a>Метрики кэша и мониторинг

На странице "Обзор" отображаются графы для некоторых базовых статистик кэша — пропускная способность кэша, операций в секунду и задержки.

![снимок экрана: три графика с показанной выше статистикой для примера кэша](media/hpc-cache-overview-stats.png)

Эти диаграммы являются частью встроенных средств мониторинга и анализа Azure. Дополнительные средства и оповещения можно найти на страницах под заголовком **мониторинг** на боковой панели портала. Дополнительные сведения см. в разделе "портал" [документации по Azure Monitor](../azure-monitor/essentials/monitor-azure-resource.md#monitoring-in-the-azure-portal).

## <a name="view-warnings"></a>Просмотр предупреждений

Если кэш переходит в неработоспособное состояние, проверьте страницу **предупреждения** . На этой странице отображаются уведомления о программном обеспечении кэша, которые могут помочь понять его состояние.

Эти уведомления не отображаются в журнале действий, так как они не управляются портал Azure. Они часто связаны с пользовательскими параметрами, которые могли быть сделаны.

Ниже перечислены типы предупреждений, которые можно увидеть.

* Кэш не может связаться с NTP-сервером
* Кэшу не удалось загрузить сведения о имени пользователя расширенных групп
* Пользовательские параметры DNS изменены в целевом объекте хранилища

![снимок экрана со страницей мониторинга > предупреждения с сообщением о том, что не удалось скачать имена пользователей расширенных групп](media/warnings-page.png)

## <a name="next-steps"></a>Дальнейшие действия

* Дополнительные сведения о [метриках и средствах статистики Azure](../azure-monitor/index.yml)
* Получение [помощи по кэшу Azure HPC](hpc-cache-support-ticket.md)
