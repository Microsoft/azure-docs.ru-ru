---
title: 'Сценарий: Маршрутизация к общим службам виртуальных сетей'
titleSuffix: Azure Virtual WAN
description: Сценарии маршрутизации. Настройте маршруты для доступа к виртуальной сети общей службы с рабочей нагрузкой, к которой требуется предоставить доступ каждой виртуальной сети и ветви.
services: virtual-wan
author: cherylmc
ms.service: virtual-wan
ms.topic: conceptual
ms.date: 03/02/2021
ms.author: cherylmc
ms.custom: fasttrack-edit
ms.openlocfilehash: 8e0d05d2cb960e760809ab35a8f9e4ca04acf250
ms.sourcegitcommit: 867cb1b7a1f3a1f0b427282c648d411d0ca4f81f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/20/2021
ms.locfileid: "102442967"
---
# <a name="scenario-route-to-shared-services-vnets"></a>Сценарий: Маршрутизация к общим службам виртуальных сетей

При работе с маршрутизацией виртуальных сетей виртуальной глобальной сети существует несколько доступных сценариев. В этом сценарии целью является Настройка маршрутов для доступа к виртуальной сети **общей службы** с рабочими нагрузками, к которым требуется предоставить доступ к каждой виртуальной сети и ветви (VPN/ER/P2S). Примеры этих общих рабочих нагрузок могут включать виртуальные машины со службами, такими как контроллеры домена или общие файловые ресурсы, или службы Azure, предоставляемые внутренне через [частные конечные точки Azure](../private-link/private-endpoint-overview.md).

Дополнительные сведения о маршрутизации виртуальных концентраторов см. в статье [о маршрутизации виртуальных концентраторов](about-virtual-hub-routing.md).

## <a name="design"></a><a name="design"></a>Конструирование

Мы можем использовать матрицу подключения для суммирования требований этого сценария:

**Матрица подключения**

| Исходный тип             | на:   |*Изолированный виртуальных сетей*|*Общая виртуальная сеть*|*Ветви*|
|---|---|---|---|---|
|**Изолированный виртуальных сетей**| ->|        | Прямой доступ | Прямой доступ |
|**Общие виртуальных сетей**  |->| Прямой доступ | Прямой доступ | Прямой доступ |
|**Ветви**      |->| Прямой доступ | Прямой доступ | Прямой доступ |

Каждая ячейка в предыдущей таблице описывает, взаимодействует ли виртуальная Глобальная сеть (сторона "from", заголовки строк) с назначением (сторона "to" последовательности, заголовки столбцов, выделенные курсивом). В этом сценарии отсутствуют брандмауэры или сетевые виртуальные устройства, поэтому обмен данными осуществляется напрямую через виртуальную глобальную сеть (следовательно, слово «Direct» в таблице).

Как и в [случае с изолированной виртуальной](scenario-isolate-vnets.md)сетью, эта матрица подключения предоставляет два различных шаблона строк, которые транслируются в две таблицы маршрутов (общие службы виртуальных сетей и ветви имеют те же требования к подключению). Виртуальная глобальная сеть уже имеет таблицу маршрутов по умолчанию, поэтому нам потребуется другая пользовательская таблица маршрутов, которая будет вызываться **RT_SHARED** в этом примере.

Виртуальных сетей будет связан с таблицей маршрутов **RT_SHARED** . Так как им требуется подключение к ветвям и общей службе виртуальных сетей, виртуальная сеть и ветви общей службы должны распространяться на **RT_SHARED** (в противном случае виртуальных сетей не будет изучать префиксы ветви и общей виртуальной сети). Так как ветви всегда связаны с таблицей маршрутов по умолчанию, а требования к подключению одинаковы для общих служб виртуальных сетей, мы будем связывать общую службу виртуальных сетей с таблицей маршрутов по умолчанию.

В результате это окончательный проект:

* Изолированные виртуальные сети:
  * Связанная таблица маршрутов: **RT_SHARED**
  * Распространение на таблицы маршрутов: **по умолчанию**
* Виртуальные сети общих служб:
  * Связанная таблица маршрутов: **по умолчанию**
  * Распространение на таблицы маршрутов: **RT_SHARED** и **по умолчанию**
* Ветк
  * Связанная таблица маршрутов: **по умолчанию**
  * Распространение на таблицы маршрутов: **RT_SHARED** и **по умолчанию**

> [!NOTE]
> Если виртуальная Глобальная сеть развернута в нескольких регионах, необходимо создать таблицу маршрутов **RT_SHARED** в каждом концентраторе, а маршруты из каждой виртуальной сети общих служб и подключения филиала должны быть распространены в таблицы маршрутов в каждом виртуальном концентраторе с помощью меток распространения.

Дополнительные сведения о маршрутизации виртуальных концентраторов см. в статье [о маршрутизации виртуальных концентраторов](about-virtual-hub-routing.md).

## <a name="workflow"></a><a name="workflow"></a>Рабочий процесс

Чтобы настроить сценарий, необходимо выполнить следующие действия.

1. Найдите виртуальную сеть **общих служб** .
2. Создайте пользовательскую таблицу маршрутов. В этом примере таблица маршрутов упоминается как **RT_SHARED**. Инструкции по созданию таблицы маршрутов см. в статье [Настройка маршрутизации виртуальных концентраторов](how-to-virtual-hub-routing.md). Используйте следующие значения в качестве рекомендации.

   * **Взаимосвязь**
     * Для **виртуальных сетей, *за исключением* виртуальной сети общих служб**, выберите виртуальных сетей для изоляции. Это означает, что все эти виртуальных сетей (за исключением виртуальной сети общих служб) будут иметь доступ к назначению на основе маршрутов RT_SHARED таблице маршрутов.

   * **Распространение**
      * Для **ветвей** распространите маршруты в эту таблицу маршрутов в дополнение к любым другим уже выбранным таблицам маршрутов. Из-за этого шага Таблица маршрутов RT_SHARED будет изучать маршруты от всех подключений филиала (VPN/ER/VPN-подключение пользователей).
      * Для **виртуальных сетей** выберите **виртуальную сеть общих служб**. Из-за этого шага RT_SHARED Таблица маршрутов будет изучать маршруты от подключения к виртуальной сети общих служб.

В результате конфигурация маршрутизации будет показана на следующем рисунке:

   :::image type="content" source="./media/routing-scenarios/shared-service-vnet/shared-services.png" alt-text="Схема для виртуальной сети общих служб." lightbox="./media/routing-scenarios/shared-service-vnet/shared-services.png":::

## <a name="next-steps"></a>Дальнейшие действия

* Сведения о настройке с помощью шаблона ARM см. в разделе [Краткое руководство. Маршрутизация к общим службам виртуальных сетей с помощью шаблона ARM](quickstart-route-shared-services-vnet-template.md).
* Дополнительные сведения о маршрутизации виртуальных концентраторов см. в статье [о маршрутизации виртуальных концентраторов](about-virtual-hub-routing.md).
