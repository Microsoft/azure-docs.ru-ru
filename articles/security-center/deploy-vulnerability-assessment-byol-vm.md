---
title: Оценка уязвимостей BYOL VM в центре безопасности Azure
description: Разверните решение для оценки уязвимостей BYOL на виртуальных машинах Azure, чтобы получить рекомендации в центре безопасности Azure, которые помогут защитить виртуальные машины.
author: memildin
manager: rkarlin
ms.service: security-center
ms.topic: how-to
ms.date: 03/17/2021
ms.author: memildin
ms.openlocfilehash: 61c3d6bfc517b5a6979ea8b7a8fe895a1b3aeb44
ms.sourcegitcommit: 772eb9c6684dd4864e0ba507945a83e48b8c16f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "104602474"
---
# <a name="deploy-a-bring-your-own-license-byol-vulnerability-assessment-solution"></a>Развертывание решения для оценки уязвимостей с помощью собственной лицензии (BYOL)

Если вы включили **защитник Azure для серверов**, вы можете использовать встроенное средство оценки уязвимостей центра безопасности Azure, как описано в статье [средство проверки уязвимостей для виртуальных машин](./deploy-vulnerability-assessment-vm.md). Этот инструмент интегрирован в защитник Azure и не требует каких-либо внешних лицензий — все, что полностью обрабатывалось в центре безопасности. Кроме того, встроенный сканер поддерживает компьютеры с поддержкой Arc Azure.

Кроме того, может потребоваться развернуть собственное решение для оценки уязвимости с частным лицензированием с [Qualys](https://www.qualys.com/lp/azure) или [Rapid7](https://www.rapid7.com/products/insightvm/). Одно из этих решений для партнеров можно установить на нескольких виртуальных машинах, принадлежащих одной подписке (но не на компьютерах с включенной службой Arc Azure).

## <a name="availability"></a>Доступность

|Аспект|Сведения|
|----|:----|
|Состояние выпуска:|Общедоступная версия|
|Типы компьютеров:|![Да](./media/icons/yes-icon.png) Виртуальные машины Azure<br>![Нет](./media/icons/no-icon.png) Компьютеры с поддержкой Azure Arc|
|Цены|Free|
|Требуемые роли и разрешения|**Владелец ресурса** может развернуть сканер<br>**Средство чтения безопасности** может просматривать результаты|
|Облако.|![Да](./media/icons/yes-icon.png) Коммерческие облака<br>![Нет](./media/icons/no-icon.png) Национальные и независимые (US Gov, China Gov, другие правительственные облака)|
|||


## <a name="deploy-a-byol-solution-from-the-azure-portal"></a>Развертывание решения BYOL из портал Azure

Параметры BYOL относятся к поддерживаемым решениям для оценки уязвимостей сторонних производителей. В настоящее время поддерживаются поставщики Qualys и Rapid7.

Поддерживаемые решения позволяют передавать данные об уязвимостях на платформу управления партнера, которая, в свою очередь, возвращает данные мониторинга уязвимостей и работоспособности в Центр безопасности. Вы можете найти уязвимые виртуальные машины на панели мониторинга центра безопасности и перейти в консоль управления партнерами непосредственно из центра безопасности, чтобы получить отчеты и дополнительные сведения.

1. На [портале Azure](https://azure.microsoft.com/features/azure-portal/) откройте **Центр безопасности**.

1. В меню центра безопасности откройте страницу **рекомендации** .

1. Выберите рекомендацию **на виртуальных машинах должно быть включено решение для оценки уязвимостей**.

    :::image type="content" source="./media/deploy-vulnerability-assessment-vm/recommendation-page-machine-groupings.png" alt-text="Группы компьютеров, на которых находится решение для оценки уязвимостей, должны быть включены на странице рекомендации по виртуальным машинам * *" lightbox="./media/deploy-vulnerability-assessment-vm/recommendation-page-machine-groupings.png":::

    Виртуальные машины будут отображаться в одной или нескольких следующих группах:

    * **Работоспособные ресурсы** — центр безопасности обнаружил решение для оценки уязвимостей, выполняющееся на этих виртуальных машинах.
    * **Неработоспособные ресурсы** — расширение сканера уязвимостей можно развернуть на этих виртуальных машинах. 
    * **Неприменимые ресурсы** — для этих виртуальных машин не может быть развернуто расширение сканера уязвимостей.

1. В списке неработоспособных компьютеров выберите, чтобы получить решение для оценки уязвимостей, и выберите **исправить**.

    >[!IMPORTANT]
    > В зависимости от конфигурации может отображаться только подмножество этого списка. 
    >
    > - Если у вас нет настроенного средства проверки уязвимостей стороннего производителя, вам не будет предложено развернуть его.
    > - Если выбранные виртуальные машины не защищены с помощью защитника Azure, параметр средство проверки уязвимостей, встроенный в функцию ASC, будет недоступен.

    :::image type="content" source="./media/deploy-vulnerability-assessment-vm/recommendation-remediation-options.png" alt-text="Параметры, для которых необходимо выбрать тип последовательности исправления, который будет выбран при ответе на рекомендацию * * решение для оценки уязвимостей, должно быть включено на странице рекомендации по виртуальным машинам * *":::

1. Если вы настраиваете новую конфигурацию BYOL, выберите **настроить новый сканер уязвимостей стороннего производителя**, выберите соответствующее расширение, нажмите кнопку " **Далее**" и введите сведения от поставщика, как показано ниже.

    1. Для параметра **Группа ресурсов** выберите **Использовать существующий**. Если позднее удалить эту группу ресурсов, решение BYOL будет недоступно.
    1. В поле **Расположение** укажите, где это решение будет располагаться географически.
    1. Для Qualys введите лицензию, предоставленную Qualys, в поле **код лицензии** .
    1. Для Rapid7 передайте **файл конфигурации Rapid7**.
    1. В поле **открытый ключ** введите сведения об открытом ключе, предоставленные партнером.
    1. Чтобы автоматически установить этот агент оценки уязвимости на всех обнаруженных виртуальных машинах в подписке этого решения, выберите **Автоматическое развертывание**.
    1. Щелкните **ОК**.

1. Если вы уже настроили решение BYOL, выберите **развернуть настроенный сторонний сканер уязвимостей**, выберите соответствующее расширение и нажмите кнопку " **Перейти**".

После установки решения для оценки уязвимостей на целевых компьютерах центр безопасности выполняет проверку, чтобы обнаружить и определить уязвимости в системе и приложении. При первом запуске этот процесс может занять несколько часов. После этого она выполняется ежечасно.



## <a name="deploy-a-byol-solution-using-powershell-and-the-rest-api"></a>Развертывание решения BYOL с помощью PowerShell и REST API

Чтобы программно развернуть решение для оценки уязвимости с частным лицензированием из [Qualys](https://www.qualys.com/lp/azure) или [Rapid7](https://www.rapid7.com/products/insightvm/), используйте предоставляемый скрипт [PowerShell > уязвимости](https://github.com/Azure/Azure-Security-Center/tree/master/Powershell%20scripts/Vulnerability%20Solution). Этот сценарий использует REST API для создания нового решения безопасности в ASC. Вам потребуется лицензия и ключ, предоставленный поставщиком услуг (Qualys или Rapid7).

> [!IMPORTANT] 
> Для каждой лицензии можно создать только одно решение. Попытка создать другое решение с тем же именем, лицензией или ключом завершится ошибкой.

### <a name="prerequisites"></a>Предварительные требования

Необходимые модули PowerShell:

- Install — Module AZ
- Install-Module AZ. Security

### <a name="run-the-script"></a>Выполнение скрипта

Чтобы запустить сценарий, вам понадобятся соответствующие сведения для указанных ниже параметров.

| **Параметр** | **Обязательно** | **Примечания** |
|----|:----:|----|
|**Подписки**|✔|Идентификатор подписки Azure, содержащий ресурсы, которые необходимо проанализировать.|
|**ResourceGroupName**|✔|Имя группы ресурсов. Используйте любую существующую группу ресурсов, включая значение по умолчанию ("Дефаултресаурцеграуп-XXX").<br>Так как решение не является ресурсом Azure, оно не будет указано в группе ресурсов, но к нему по-прежнему прикрепляется. Если позднее удалить группу ресурсов, решение BYOL будет недоступно.|
|**васолутионнаме**|✔|Имя нового решения.|
|**ватипе**|✔|Qualys или Rapid7.|
|**лиценсекоде**|✔|Предоставленная поставщиком строка лицензии.|
|**publicKey**|✔|Поставщик предоставил открытый ключ.|
|**autoUpdate**|-|Включите (true) или отключите (false) автоматическое развертывание для этого решения ва. Если этот параметр включен, каждая новая виртуальная машина в подписке будет автоматически пытаться установить связь с решением.<br/>(По умолчанию: false)|
||||

Синтаксис:

```azurepowershell
.\New-ASCVASolution.ps1 -subscriptionId <Subscription Id> -resourceGroupName <RG Name>
-vaSolutionName <New solution name> -vaType <Qualys / Rapid7> -autoUpdate <true/false>
-licenseCode <License code from vendor> -publicKey <Public Key received from vendor>
```

Пример (этот пример не содержит допустимые сведения о лицензии):

```azurepowershell
.\New-ASCVASolution.ps1 -subscriptionId 'f4cx1b69-dtgb-4ch6-6y6f-ea2e95373d3b' -resourceGroupName 'DefaultResourceGroup-WEU' -vaSolutionName 'QualysVa001' -vaType 'Qualys' -autoUpdate 'false' `
-licenseCode 'eyJjaWQiOiJkZDg5OTYzXe4iMTMzLWM4NTAtODM5FD2mZWM1N2Q3ZGU5MjgiLCJgbTYuOiIyMmM5NDg3MS1lNTVkLTQ1OGItYjhlMC03OTRhMmM3YWM1ZGQiLCJwd3NVcmwiOiJodHRwczovL3FhZ3B1YmxpYy1wMDEuaW50LnF1YWx5cy5jb20vQ2xvdSKJY6VudC8iLCJwd3NQb3J0IjoiNDQzIn0=' `
-publicKey 'MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQCOiOLXjOywMfLZIBGPZLwSocf1Q64GASLK9OHFEmanBl1nkJhZDrZ4YD5lM98fThYbAx1Rde2iYV1ze/wDlX4cIvFAyXuN7HbdkeIlBl6vWXEBZpUU17bOdJOUGolzEzNBhtxi/elEZLghq9Chmah82me/okGMIhJJsCiTtglVQIDAQAB'
```

## <a name="faq---byol-vulnerability-scanner"></a>Часто задаваемые вопросы — средство проверки уязвимостей BYOL

- [Какие параметры связи требуются при развертывании агента Qualys?](#if-i-deploy-a-qualys-agent-what-communications-settings-are-required)
- [Зачем нужно указывать группу ресурсов при настройке решения BYOL?](#why-do-i-have-to-specify-a-resource-group-when-configuring-a-byol-solution)


### <a name="if-i-deploy-a-qualys-agent-what-communications-settings-are-required"></a>Какие параметры связи требуются при развертывании агента Qualys?

Qualys Cloud Agent предназначен для связи с Qualys SOC через регулярные интервалы времени для обновлений и для выполнения различных операций, необходимых для работы продукта. Чтобы обеспечить бесперебойную связь агента с SOC, Настройте сетевую безопасность, разрешающую входящий и исходящий трафик к Qualys SOC CIDR и URL-адресам.

Существует несколько Qualys платформ в различных географических расположениях. CIDR и URL-адреса SOC различаются в зависимости от платформы размещения подписки Qualys. Чтобы указать платформу узла Qualys, используйте эту страницу https://www.qualys.com/platform-identification/ .


### <a name="why-do-i-have-to-specify-a-resource-group-when-configuring-a-byol-solution"></a>Зачем нужно указывать группу ресурсов при настройке решения BYOL?

При настройке решения необходимо выбрать группу ресурсов для ее присоединения. Решение не является ресурсом Azure, поэтому оно не будет включаться в список ресурсов группы ресурсов. Тем не менее, она присоединяется к этой группе ресурсов. Если позднее удалить группу ресурсов, решение BYOL будет недоступно.



## <a name="next-steps"></a>Дальнейшие действия

> [!div class="nextstepaction"]
> [Исправьте результаты решения для оценки уязвимостей](remediate-vulnerability-findings-vm.md)


Центр безопасности также позволяет выполнить анализ уязвимостей для:

- Баз данных SQL — см. раздел [Просмотр отчетов об оценке уязвимостей](defender-for-sql-on-machines-vulnerability-assessment.md#explore-vulnerability-assessment-reports).
- Образы реестра контейнеров Azure. см. раздел [Использование защитника Azure для реестров контейнеров для проверки образов на наличие уязвимостей](defender-for-container-registries-usage.md) .