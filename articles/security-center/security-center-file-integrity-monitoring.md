---
title: Мониторинг целостности файлов в центре безопасности Azure | Документация Майкрософт
description: Узнайте, как настроить мониторинг целостности файлов (FIM) в центре безопасности Azure с помощью этого пошагового руководства.
services: security-center
documentationcenter: na
author: memildin
manager: rkarlin
ms.assetid: 411d7bae-c9d4-4e83-be63-9f2f2312b075
ms.service: security-center
ms.devlang: na
ms.topic: how-to
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 09/22/2020
ms.author: memildin
ms.openlocfilehash: 834df2387d037c19672e3287970300f4e84ca34b
ms.sourcegitcommit: ed7376d919a66edcba3566efdee4bc3351c57eda
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/24/2021
ms.locfileid: "105047989"
---
# <a name="file-integrity-monitoring-in-azure-security-center"></a>Мониторинг целостности файлов в центре безопасности Azure
Узнайте, как настроить мониторинг целостности файлов (FIM) в центре безопасности Azure с помощью этого пошагового руководства.


## <a name="availability"></a>Доступность

|Аспект|Сведения|
|----|:----|
|Состояние выпуска:|Общедоступная версия|
|Цены|Требуется [защитник Azure для серверов](defender-for-servers-introduction.md).<br>FIM передает данные в рабочую область Log Analytics. За эту операцию взимается плата, размер которой зависит от объема передаваемых данных. Дополнительные сведения см. на [странице цен на Log Analytics](https://azure.microsoft.com/pricing/details/log-analytics/).|
|Требуемые роли и разрешения|**Владелец рабочей области** может включать и отключать FIM (Дополнительные сведения см. в статье [роли Azure для log Analytics](/services-hub/health/azure-roles#azure-roles)).<br>**Читатель** может просматривать результаты.|
|Облако.|![Да](./media/icons/yes-icon.png) Коммерческие облака<br>![Да ](./media/icons/yes-icon.png) National/независимых (US gov, Китае gov, other gov)<br>Поддерживается только в регионах, где доступно решение для отслеживания изменений в службе автоматизации Azure.<br>![Да ](./media/icons/yes-icon.png) устройства с поддержкой [дуги Azure](../azure-arc/servers/overview.md) .<br>См. раздел [Supported regions for linked log Analytics Workspace](../automation/how-to/region-mappings.md).<br>Дополнительные [сведения об отслеживании изменений](../automation/change-tracking/overview.md).|
|||

## <a name="what-is-fim-in-security-center"></a>Что такое FIM в центре безопасности?
Мониторинг целостности файлов (FIM), также называемый мониторингом изменений, проверяет файлы операционной системы, реестры Windows, программное обеспечение приложений, системные файлы Linux и многое другое для изменений, которые могут указывать на атаку. 

Центр безопасности рекомендует отслеживать объекты с помощью FIM, а также определять собственные политики или сущности FIM для мониторинга. FIM предупреждает о подозрительной активности, например:

- Создание или удаление ключа файла и раздела реестра
- изменение файлов (изменения размера файла, списков управления доступом или хэша содержимого);
- изменение реестра (изменения размера, списков управления доступом, типа или содержимого).

Из этого руководства вы узнаете, как:

> [!div class="checklist"]
> * Просмотр списка предлагаемых сущностей для мониторинга с помощью FIM
> * Определение собственных настраиваемых правил FIM
> * Аудит изменений в отслеживаемых сущностях
> * Использование подстановочных знаков для упрощения отслеживания в каталогах


## <a name="how-does-fim-work"></a>Как работает FIM?

Сравнивая текущее состояние этих элементов с состоянием во время предыдущей проверки, FIM предупреждает о внесении подозрительных изменений.

FIM использует решение "Отслеживание изменений" Azure, чтобы отслеживать и обнаруживать изменения в среде. При включенном мониторинге целостности файлов имеется **Отслеживание изменений** ресурс типа **решение**. Сведения о частоте сбора данных см. в разделе [Отслеживание изменений сведения о сборе данных](../automation/change-tracking/overview.md#change-tracking-and-inventory-data-collection).

> [!NOTE]
> При удалении **Отслеживание изменений** ресурса также будет отключена функция мониторинга целостности файлов в центре безопасности.

## <a name="which-files-should-i-monitor"></a>Для каких файлов нужно применять мониторинг?
При выборе файлов для отслеживания следует определить, какие файлы являются критически важными для системы и приложений. Мониторинг файлов, которые не предполагается изменять без планирования. При выборе файлов, которые часто изменяются приложениями или операционной системой (например, файлы журнала и текстовые файлы), создается большой шум, что затрудняет обнаружение атаки.

Центр безопасности предоставляет следующий список рекомендуемых элементов для мониторинга на основе известных шаблонов атак.

|Файлы Linux|Файлы Windows|Разделы реестра Windows (HKLM = HKEY_LOCAL_MACHINE)|
|:----|:----|:----|
|/бин/логин|C:\autoexec.bat|Хклм\софтваре\микрософт\криптографи\оид\енкодингтипе 0 \ Криптсипдллремовесигнеддатамсг \{ C689AAB8-8E78-11D0-8C47-00C04FC295EE}|
|/бин/пассвд|C:\boot.ini|Хклм\софтваре\микрософт\криптографи\оид\енкодингтипе 0 \ Криптсипдллремовесигнеддатамсг \{ 603BCC1F-4B59-4E08-B724-D2C6297EF351}|
|/etc/*. conf|C:\config.sys|HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\IniFileMapping\SYSTEM.ini Boot дистрибутивного|
|/уср/бин|C:\Windows\system.ini|HKLM\SOFTWARE\Microsoft\Windows Нт\куррентверсион\виндовс|
|/уср/сбин|C:\Windows\win.ini|HKLM\SOFTWARE\Microsoft\Windows Нт\куррентверсион\винлогон|
|/bin|C:\Windows\regedit.exe|Папки Хклм\софтваре\микрософт\виндовс\куррентверсион\експлорер\шелл|
|/сбин|C:\Windows\System32\userinit.exe|Папки оболочки Хклм\софтваре\микрософт\виндовс\куррентверсион\експлорер\усер|
|/Boot|C:\Windows\explorer.exe|хклм\софтваре\микрософт\виндовс\куррентверсион\рун|
|/usr/local/bin|C:\Program Files\Microsoft Security Client\msseces.exe|хклм\софтваре\микрософт\виндовс\куррентверсион\рунонце|
|/уср/локал/сбин||хклм\софтваре\микрософт\виндовс\куррентверсион\рунонцеекс|
|/опт/бин||хклм\софтваре\микрософт\виндовс\куррентверсион\рунсервицес|
|/опт/сбин||хклм\софтваре\микрософт\виндовс\куррентверсион\рунсервицесонце|
|/etc/crontab.||HKLM\SOFTWARE\WOW6432Node\Microsoft\Cryptography\OID\EncodingType 0 \ Криптсипдллремовесигнеддатамсг \{ C689AAB8-8E78-11D0-8C47-00C04FC295EE}|
|/etc/init.d||HKLM\SOFTWARE\WOW6432Node\Microsoft\Cryptography\OID\EncodingType 0 \ Криптсипдллремовесигнеддатамсг \{ 603BCC1F-4B59-4E08-B724-D2C6297EF351}|
|/етк/крон.хаурли||HKLM\SOFTWARE\WOW6432Node\Microsoft\Windows NT\CurrentVersion\IniFileMapping\system.ini Boot дистрибутивного|
|/етк/крон.даили||HKLM\SOFTWARE\WOW6432Node\Microsoft\Windows Нт\куррентверсион\виндовс|
|/етк/крон.викли||HKLM\SOFTWARE\WOW6432Node\Microsoft\Windows Нт\куррентверсион\винлогон|
|/етк/крон.монсли||Папки HKLM\SOFTWARE\WOW6432Node\Microsoft\Windows\CurrentVersion\Explorer\Shell|
|||Папки оболочки HKLM\SOFTWARE\WOW6432Node\Microsoft\Windows\CurrentVersion\Explorer\User|
|||HKLM\SOFTWARE\WOW6432Node\Microsoft\Windows\CurrentVersion\Run|
|||HKLM\SOFTWARE\WOW6432Node\Microsoft\Windows\CurrentVersion\RunOnce|
|||HKLM\SOFTWARE\WOW6432Node\Microsoft\Windows\CurrentVersion\RunOnceEx|
|||HKLM\SOFTWARE\WOW6432Node\Microsoft\Windows\CurrentVersion\RunServices|
|||HKLM\SOFTWARE\WOW6432Node\Microsoft\Windows\CurrentVersion\RunServicesOnce|
|||хклм\систем\куррентконтролсет\контрол\хивелист|
|||HKLM\SYSTEM\CurrentControlSet\Control\Session Манажер\кновндллс|
|||хклм\систем\куррентконтролсет\сервицес\шаредакцесс\параметерс\фиреваллполици\домаинпрофиле|
|||хклм\систем\куррентконтролсет\сервицес\шаредакцесс\параметерс\фиреваллполици\публикпрофиле|
|||хклм\систем\куррентконтролсет\сервицес\шаредакцесс\параметерс\фиреваллполици\стандардпрофиле|


## <a name="enable-file-integrity-monitoring"></a>Включение мониторинга целостности файлов 

FIM доступен только на страницах центра безопасности портал Azure. В настоящее время нет REST API для работы с FIM.

1. В области **Расширенная защита** панели мониторинга **защитника Azure** выберите **мониторинг целостности файлов**.

   :::image type="content" source="./media/security-center-file-integrity-monitoring/open-file-integrity-monitoring.png" alt-text="Запуск FIM" lightbox="./media/security-center-file-integrity-monitoring/open-file-integrity-monitoring.png":::

    Откроется страница Конфигурация **мониторинга целостности файлов** .

    Для каждой рабочей области предоставляется следующая информация:

    - общее число изменений за последнюю неделю (символ дефиса "-" означает, что FIM не включен для этой рабочей области);
    - общее число компьютеров и виртуальных машин, передающих сведения в эту рабочую область;
    - географическое расположение рабочей области;
    - подписка Azure, к которой относится рабочая область.

1. Эта страница используется для:

    - Доступ и Просмотр состояния и параметров каждой рабочей области

    - ![Значок плана обновления ][4] обновите рабочую область, чтобы использовать защитник Azure. Этот значок указывает, что Рабочая область или подписка не защищены защитником Azure. Чтобы использовать функции FIM, ваша подписка должна быть защищена защитником Azure. Дополнительные сведения см. в статье [Центр безопасности Azure: Бесплатная поддержка защитника Azure](security-center-pricing.md).

    - ![Значок включения][3] Включите FIM на всех компьютерах в рабочей области и настройте параметры FIM. Этот значок указывает, что FIM не включен для рабочей области.

        :::image type="content" source="./media/security-center-file-integrity-monitoring/workspace-list-fim.png" alt-text="Включение FIM для конкретной рабочей области":::


    > [!TIP]
    > Если кнопка "включить" или "Обновить" отсутствует, а пробел пуст, это означает, что FIM уже включен в рабочей области.


1. Выберите **включить**. Отображаются сведения о рабочей области, включая число компьютеров Windows и Linux в рабочей области.

    :::image type="content" source="./media/security-center-file-integrity-monitoring/workspace-fim-status.png" alt-text="Страница сведений о рабочей области FIM":::

   Также здесь приводятся рекомендуемые параметры для Windows и Linux.  Разверните узлы **Файлы Windows**, **Реестр** и **Файлы Linux**, чтобы просмотреть полный список рекомендаций.

1. Снимите флажки для всех рекомендуемых сущностей, которые не нужно отслеживать с помощью FIM.

1. Выберите **Применение мониторинга целостности файлов**, чтобы включить FIM.

> [!NOTE]
> Эти параметры вы можете изменить в любое время. Дополнительные сведения см. в разделе [Изменение списка отслеживаемых сущностей](#edit-monitored-entities) далее в этой статье.



## <a name="audit-monitored-workspaces"></a>Рабочие области с отслеживанием аудита 

Панель **мониторинга целостности файлов** отображается для рабочих областей с включенной функцией FIM. Панель мониторинга FIM открывается после включения FIM в рабочей области или при выборе рабочей области в окне **мониторинга целостности файлов** , в котором уже включена FIM.

:::image type="content" source="./media/security-center-file-integrity-monitoring/fim-dashboard.png" alt-text="Панель мониторинга FIM и ее различные информационные панели":::

На панели мониторинга FIM для рабочей области отображаются следующие сведения.

- общее число компьютеров, подключенных к рабочей области;
- общее число изменений, произошедших за выбранный период времени;
- разбивка изменений по типам (файлы, реестр);
- разбивка изменений по категориям (изменение, добавление, удаление).

Выберите **Фильтр** в верхней части панели мониторинга, чтобы изменить период времени, для которого отображаются изменения.

:::image type="content" source="./media/security-center-file-integrity-monitoring/dashboard-filter.png" alt-text="Фильтр периода времени для панели мониторинга FIM":::

На вкладке **серверы** перечислены компьютеры, передающие отчеты в эту рабочую область. Для каждого компьютера на панели мониторинга предоставляются такие сведения:

- число изменений, произошедших за выбранный период времени;
- разбивка изменений на изменения файлов и реестра.

**Поиск по журналам** открывается при вводе имени компьютера в поле поиска или выборе компьютера, указанного на вкладке "компьютеры". в разделе "Поиск по журналам" отображаются все изменения, внесенные в выбранный период времени для компьютера. Вы можете развернуть любое изменение, чтобы получить дополнительную информацию.

![Поиск по журналам][8]

Вкладка **Изменения** (см. ниже) содержит список всех изменений в рабочей области за выбранный период времени. Для каждой сущности, в которой произошли изменения, на панели мониторинга отображается следующее:

- идентификатор компьютера, на котором произошло изменение;
- тип изменения (реестр или файл);
- категория изменения (изменено, добавлено, удалено);
- дата и время изменения.

![Изменения для рабочей области][9]

Страница **Сведения об изменении** открывается, когда вы вводите изменение в поле поиска или выбираете сущность из списка на вкладке **Изменения**.

![Сведения об изменении][10]

## <a name="edit-monitored-entities"></a>Изменение списка отслеживаемых сущностей

1. Вернитесь на **панель мониторинга "Мониторинг целостности файлов"** и выберите **Параметры**.

   ![Параметры][11]

   Откроется страница **Конфигурация рабочей области** с тремя вкладками: **Реестр Windows**, **Файлы Windows** и **Файлы Linux**. На каждой вкладке перечислены сущности, которые можно изменять для этой категории. Для каждой сущности центр безопасности предоставляет информацию о том, включена ли для нее функция FIM (true или false).  Редактирование сущности позволяет включить или отключить для нее функцию FIM.

   ![Конфигурация рабочей области][12]

2. Выберите защиту идентификации. В этом примере мы выбрали элемент из вкладки "Реестр Windows". Открывается окно **Изменение реестра Windows для отслеживания изменений**.

   ![Изменение реестра Windows для отслеживания изменений][13]

В окне **Изменение реестра Windows для отслеживания изменений** вы можете сделать следующее:

- включить (True) или отключить (False) мониторинг целостности файлов;
- назначить или изменить имя сущности;
- указать или изменить значение или путь;
- удалить сущность, отменить изменения или сохранить изменения.

## <a name="add-a-new-entity-to-monitor"></a>Добавление новой сущности для мониторинга
1. Вернитесь к **панели мониторинга целостности файлов** и выберите **Параметры** в верхней части страницы. Откроется страница **Конфигурация рабочей области**.
2. На странице **Конфигурация рабочей области** перейдите на вкладку, соответствующую типу добавляемой сущности: реестр Windows, файлы Windows или файлы Linux. В нашем примере выбран вариант **Файлы Linux**.

   ![Добавление нового элемента для мониторинга][14]

3. Нажмите **Добавить**. Открывается окно **Добавление файла Linux для отслеживания изменений**.

   ![Ввод требуемых сведений][15]

4. На странице **добавления** введите требуемую информацию и выберите **Сохранить**.

## <a name="disable-monitored-entities"></a>Отключение отслеживаемых сущностей
1. Вернитесь на панель мониторинга " **мониторинг целостности файлов** ".
2. Выберите рабочую область, для которой включена функция FIM. Рабочие области, для которых включена эта функция, можно определить по отсутствию кнопок включения и обновления плана.

   ![Выбор рабочей области, для которой включен FIM][16]

3. В разделе Мониторинг целостности файлов выберите **Параметры**.

   ![Выбор элемента "Параметры"][17]

4. На странице **Конфигурация рабочей области** выберите группу, для которой в столбце **Включено** отображается значение True.

   ![Конфигурация рабочей области][18]

5. В окне **Изменение файла Windows для отслеживания изменений** измените параметр **Включено**, установив значение False.

   ![Присвоение значения False параметру "Включено"][19]

6. Нажмите кнопку **Сохранить**.

## <a name="folder-and-path-monitoring-using-wildcards"></a>Мониторинг папки и пути мониторинга с использованием подстановочных знаков

Используйте подстановочные знаки для упрощения отслеживания в каталогах. При настройке мониторинга папки с использованием подстановочных знаков применяются следующие правила:
-   Для отслеживания нескольких файлов необходимы подстановочные знаки.
-   Подстановочные знаки можно использовать только в последнем сегменте пути, например C:\folder\file или /etc/*.conf.
-   Если у переменной среды недопустимый путь, проверка будет успешной, но запуск ресурса по этому пути завершится сбоем.
-   При настройке пути избегайте общих путей, таких как c:\*.*, так как это приведет к переходу к большому количеству папок.

## <a name="disable-fim"></a>Отключение FIM
Вы всегда можете отключить FIM. FIM использует решение "Отслеживание изменений" Azure, чтобы отслеживать и обнаруживать изменения в среде. После отключения FIM решение для отслеживания изменений будет удалено из выбранной рабочей области.

1. Чтобы отключить FIM, вернитесь на панель мониторинга " **мониторинг целостности файлов** ".
2. Выберите рабочую область.
3. В разделе **наблюдение за целостностью файлов** выберите **Отключить**.

   ![Отключение FIM][20]

4. Выберите **Удалить** для отключения.

## <a name="next-steps"></a>Дальнейшие действия
В этой статье вы узнали, как использовать мониторинг целостности файлов (FIM) в центре безопасности. Дополнительные сведения о Центре безопасности см. в следующих статьях:

* [Настройка политик безопасности](tutorial-security-policy.md) . Узнайте, как настроить политики безопасности для подписок и групп ресурсов Azure.
* [Рекомендации по управлению безопасностью](security-center-recommendations.md) — сведения об использовании рекомендаций для защиты ресурсов Azure.
* [Блог по безопасности Azure](/archive/blogs/azuresecurity/)— последние новости и информация об обеспечении безопасности в Azure.

<!--Image references-->
[1]: ./media/security-center-file-integrity-monitoring/security-center-dashboard.png
[3]: ./media/security-center-file-integrity-monitoring/enable.png
[4]: ./media/security-center-file-integrity-monitoring/upgrade-plan.png
[5]: ./media/security-center-file-integrity-monitoring/enable-fim.png
[7]: ./media/security-center-file-integrity-monitoring/filter.png
[8]: ./media/security-center-file-integrity-monitoring/log-search.png
[9]: ./media/security-center-file-integrity-monitoring/changes-tab.png
[10]: ./media/security-center-file-integrity-monitoring/change-details.png
[11]: ./media/security-center-file-integrity-monitoring/fim-dashboard-settings.png
[12]: ./media/security-center-file-integrity-monitoring/workspace-config.png
[13]: ./media/security-center-file-integrity-monitoring/edit.png
[14]: ./media/security-center-file-integrity-monitoring/add.png
[15]: ./media/security-center-file-integrity-monitoring/add-item.png
[16]: ./media/security-center-file-integrity-monitoring/fim-dashboard-disable.png
[17]: ./media/security-center-file-integrity-monitoring/fim-dashboard-settings-disabled.png
[18]: ./media/security-center-file-integrity-monitoring/workspace-config-disable.png
[19]: ./media/security-center-file-integrity-monitoring/edit-disable.png
[20]: ./media/security-center-file-integrity-monitoring/disable-fim.png