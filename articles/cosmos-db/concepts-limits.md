---
title: Квоты для службы Azure Cosmos DB
description: Квоты для служб Azure Cosmos DB и ограничения по умолчанию для различных типов ресурсов.
author: abhijitpai
ms.author: abpai
ms.service: cosmos-db
ms.topic: conceptual
ms.date: 01/19/2021
ms.openlocfilehash: 007bf845bab6f493fae91debefde27a4929d9f95
ms.sourcegitcommit: 910a1a38711966cb171050db245fc3b22abc8c5f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "98611038"
---
# <a name="azure-cosmos-db-service-quotas"></a>Квоты для службы Azure Cosmos DB

[!INCLUDE[appliesto-all-apis](includes/appliesto-all-apis.md)]

В этой статье представлен обзор квот по умолчанию, предлагаемых для разных ресурсов в Azure Cosmos DB.

## <a name="storage-and-database-operations"></a>Операции с хранилищем и базой данных

Создав учетную запись Azure Cosmos DB в подписке Azure, вы сможете управлять данными в своей учетной записи [, создавая базы данных, контейнеры и элементы](account-databases-containers-items.md).

### <a name="provisioned-throughput"></a>Подготовленная пропускная способность

Вы можете подготовить пропускную способность на уровне контейнера или базы данных ([количество единиц запросов в секунду)](request-units.md). В следующей таблице перечислены ограничения в том, что касается хранения и пропускной способности каждого контейнера или базы данных.

| Ресурс | Ограничение по умолчанию |
| --- | --- |
| Максимальное количество запросов в секунду для контейнера ([режим выделенной пропускной способности](account-databases-containers-items.md#azure-cosmos-containers)) | По умолчанию: 1 000 000. Вы можете увеличить это значение, [направив запрос в службу поддержки Azure](create-support-request-quota-increase.md) |
| Максимальное количество запросов для одной базы данных ([подготовленный режим общей пропускной способности](account-databases-containers-items.md#azure-cosmos-containers)) | По умолчанию: 1 000 000. Вы можете увеличить это значение, [направив запрос в службу поддержки Azure](create-support-request-quota-increase.md) |
| Максимальное число получателей в секунду для (логических) секций | 10 000 |
| Максимальный объем хранилища для всех элементов на (логический) секции | 20 ГБ |
| Максимальное число уникальных (логических) ключей разделов | Неограниченно |
| Максимальный объем хранилища для одного контейнера | Неограниченно |
| Максимальный размер хранилища для базы данных | Неограниченно |
| Максимальный размер вложения на учетную запись (функция прикрепления является устаревшей) | 2 ГБ |
| Минимально требуемых единиц запросов в 1 ГБ | 10 запросов в секунду<br>**Примечание.** этот минимальный уровень можно уменьшить, если ваша учетная запись имеет право на нашу [программу "высокая емкость и низкая пропускная способность"](set-throughput.md#high-storage-low-throughput-program) . |

> [!NOTE]
> Рекомендации по управлению рабочими нагрузками, для которых используются ключи разделов с более высокими установленными ограничениями в плане хранения или пропускной способности, см. в разделе [Создание синтетического ключа секции](synthetic-partition-keys.md).

### <a name="minimum-throughput-limits"></a>Ограничения минимальной пропускной способности

Для контейнера Cosmos (или базы данных с общей пропускной способностью) должна быть предусмотрена минимальная пропускная способность в 400 единиц запросов в секунду. По мере роста контейнера Cosmos DB требуется минимальная пропускная способность, чтобы убедиться, что база данных или контейнер имеют достаточно ресурсов для работы.

Сведения об общей и минимальной пропускной способности контейнера или базы данных можно узнать на портале Azure или пакетов SDK. Дополнительные сведения см. в статье [Подготовка пропускной способности для контейнеров и баз данных](set-throughput.md). 

Фактический минимальный номер единицы запросов в секунду может различаться в зависимости от конфигурации учетной записи. [Azure Monitor метрики](monitor-cosmos-db.md#view-operation-level-metrics-for-azure-cosmos-db) можно использовать для просмотра журнала подготовленной пропускной способности (единиц запросов в секунду) и хранилища в ресурсе. 

#### <a name="minimum-throughput-on-container"></a>Минимальная пропускная способность в контейнере 

Чтобы оценить минимальную пропускную способность, необходимую для контейнера с пропускной способностью вручную, найдите максимум:

* 400 ЕЗ/с 
* Текущий объем хранилища в ГБ * 10 единиц запросов в секунду
* Максимальное значение единиц запросов в секунду, подготовленное в контейнере/100

Пример. Предположим, что у вас есть контейнер, подготовленный с 400 единиц запросов в секунду и 0 ГБ. Вы увеличиваете пропускную способность до 50 000 единиц запросов в секунду и импортируете 20 ГБ данных. Минимальная единица запросов в секунду теперь равна `MAX(400, 20 * 10 RU/s per GB, 50,000 RU/s / 100)` 500 единиц запросов в секунду. Со временем размер хранилища увеличивается до 200 ГБ. Минимальная единица запросов в секунду теперь равна `MAX(400, 200 * 10 RU/s per GB, 50,000 / 100)` 2000 единиц запросов в секунду. 

**Примечание.** Минимальная пропускная способность, равная 10 единиц запросов в ГБ, может быть снижена, если ваша учетная запись имеет право на [«высокую или низкую пропускную способность»](set-throughput.md#high-storage-low-throughput-program).

#### <a name="minimum-throughput-on-shared-throughput-database"></a>Минимальная пропускная способность в базу данных с общей пропускной способностью 
Чтобы оценить минимальную пропускную способность, необходимую для базы данных с общей пропускной способностью, задаваемой вручную, вычислите максимальное значение:

* 400 ЕЗ/с 
* Текущий объем хранилища в ГБ * 10 единиц запросов в секунду
* Максимальное значение единиц запросов в секунду, подготовленное в базе данных (100)
* 400 + Макс (число контейнеров-25, 0) * 100 единиц запросов в секунду

Пример: Предположим, что у вас есть база данных с подготовленными 400 ЕЗ/с, 15 ГБ хранилища и 10 контейнерами. Минимальное число единиц запросов в секунду — `MAX(400, 15 * 10 RU/s per GB, 400 / 100, 400 + 0 )` 400 единиц запросов в секунду. Если в базе данных было 30 контейнеров, минимальное количество единиц запросов в секунду — `400 + MAX(30 - 25, 0) * 100 RU/s` 900 единиц запросов в секунду. 

**Примечание.** Минимальная пропускная способность, равная 10 единиц запросов в ГБ, может быть снижена, если ваша учетная запись имеет право на [«высокую или низкую пропускную способность»](set-throughput.md#high-storage-low-throughput-program).

В сводке приведены минимальные максимальные подготовленные ограничения в единицах запросов в секунду. 

| Ресурс | Ограничение по умолчанию |
| --- | --- |
| Минимальное число записей на контейнер ([выделенный режим подготовки пропускной способности](./account-databases-containers-items.md#azure-cosmos-containers)) | 400 |
| Минимальное число получателей на базу данных ([подготовленный режим с общей пропускной способностью](./account-databases-containers-items.md#azure-cosmos-containers)) | 400 единиц запросов в секунду для первых 25 контейнеров. Дополнительные 100 единиц запросов/с для каждого контейнера. |

Cosmos DB поддерживает программное масштабирование пропускной способности (единиц запросов в секунду) на контейнер или базу данных с помощью пакетов SDK или портала.    

В зависимости от текущих подготовленных единиц запросов в секунду и параметров ресурсов каждый ресурс может масштабироваться синхронно и сразу между минимальным числом единиц запросов в секунду до 100-х, равным минимальным единицам запросов в секунду. Если запрашиваемое значение пропускной способности выходит за пределы диапазона, масштабирование выполняется асинхронно. Асинхронное масштабирование может занять несколько минут в зависимости от запрошенной пропускной способности и размера хранилища данных в контейнере.  

### <a name="serverless"></a>Бессерверные приложения

[Бессерверный](serverless.md) режим позволяет использовать ресурсы Azure Cosmos DB на основе потребления. В следующей таблице перечислены ограничения на хранение и пропускную способность для каждого контейнера или базы данных.

| Ресурс | Ограничение |
| --- | --- |
| Максимум единиц запросов в секунду на (логический) раздел | 5 000 |
| Максимальный объем хранилища для всех элементов на (логический) секции | 20 ГБ |
| Максимальное число уникальных (логических) ключей разделов | Неограниченно |
| Максимальный объем хранилища для одного контейнера | 50 Гб |

## <a name="control-plane-operations"></a>Операции уровня управления

В этой статье описывается, как [подготовить учетную запись Azure Cosmos и управлять ею](how-to-manage-database-account.md) с помощью портала Azure, Azure PowerShell, Azure CLI и шаблонов Azure Resource Manager. В следующей таблице перечислены ограничения, предусмотренные для каждой подписки, учетной записи и количества операций.

| Ресурс | Ограничение по умолчанию |
| --- | --- |
| Максимальное число учетных записей в базе данных на каждую подписку | 50 по умолчанию. Вы можете увеличить это значение, [направив запрос в службу поддержки Azure](create-support-request-quota-increase.md)|
| Максимальное число региональных отработок отказа | 1 в час по умолчанию. Вы можете увеличить это значение, [направив запрос в службу поддержки Azure](create-support-request-quota-increase.md)|

> [!NOTE]
> Региональные отработки отказа применяются только к учетным записям с правами записи в одном регионе. Учетные записи с правами записи в нескольких регионах не зависят от ограничений на изменение региона записи.

База данных Azure Cosmos DB регулярно выполняет автоматическое резервное копирование ваших данных. Дополнительные сведения об интервалах и окнах хранения резервных копий см. в разделе [Оперативное резервное копирование и восстановление данных по запросу в Azure Cosmos DB](online-backup-and-restore.md).

## <a name="per-account-limits"></a>Ограничения для каждой учетной записи

### <a name="provisioned-throughput"></a>Подготовленная пропускная способность

| Ресурс | Ограничение по умолчанию |
| --- | --- |
| Максимальное число баз данных | Неограниченно |
| Максимальное число контейнеров в одной базе данных с общей пропускной способностью |25 |
| Максимальное число контейнеров в одной базе данных с общей пропускной способностью  |без ограничений |
| Максимальное число регионов | Без ограничений (все регионы Azure) |

### <a name="serverless"></a>Бессерверные приложения

| Ресурс | Ограничение |
| --- | --- |
| Максимальное число баз данных | Неограниченно |
| Максимальное число контейнеров на учетную запись  | 100 |
| Максимальное число регионов | 1 (любой регион Azure) |

## <a name="per-container-limits"></a>Ограничения для одного контейнера

В зависимости от используемого API контейнер Azure Cosmos может представлять коллекцию, таблицу или граф. Контейнеры поддерживают конфигурации для [ограничений уникального ключа](unique-keys.md), [хранимых процедур, триггеров и определяемых пользователем функций](stored-procedures-triggers-udfs.md), а также для [политики индексирования](how-to-manage-indexing-policy.md). В следующей таблице перечислены ограничения, предусмотренные для конфигураций в контейнере. 

| Ресурс | Ограничение по умолчанию |
| --- | --- |
| Максимальная длина имени базы данных или контейнера | 255 |
| Максимальное число хранимых процедур на контейнер | 100 <sup>*</sup>|
| Максимальное число определяемых пользователем функций на контейнер | 25 <sup>*</sup>|
| Максимальное число путей в политике индексирования| 100 <sup>*</sup>|
| Максимальное число уникальных ключей на контейнер|10 <sup>*</sup>|
| Максимальное число путей на ограничение уникального ключа|16 <sup>*</sup>|
| Максимальное значение TTL |2147483647|

<sup>*</sup> Вы можете увеличить любое из этих ограничений для каждого контейнера, создав [Поддержка Azure](create-support-request-quota-increase.md).

## <a name="per-item-limits"></a>Ограничения для каждого элемента

В зависимости от используемого API элемент Azure Cosmos может представлять документ в коллекции, строку в таблице или узел (ребро) в графе. В следующей таблице показаны ограничения для каждого элемента в Cosmos DB. 

| Ресурс | Ограничение по умолчанию |
| --- | --- |
| Максимальный размер элемента | 2 МБ (длина UTF-8 для представления JSON) |
| Максимальная длина значения ключа раздела | 2048 байт |
| Максимальная длина значения идентификатора | 1023 байта |
| Максимальное число свойств на элемент | Без практически применимых ограничений |
| Максимальная длина имени свойства | Без практически применимых ограничений |
| Максимальная длина значения свойства | Без практически применимых ограничений |
| Максимальная длина строкового значения свойства | Без практически применимых ограничений |
| Максимальная длина числового значения свойства | 64-разрядное значение IEEE754 с двойной точностью |
| Максимальный уровень вложенности для внедренных объектов и массивов | 128 |
| Максимальное значение TTL |2147483647|

Для полезной нагрузки элемента не предусмотрены ограничения, например по числу свойств и глубине вложенности, за исключением ограничений по длине ключа раздела и значений идентификатора, а также по общему размеру (2 МБ). Возможно, потребуется настроить политику индексирования для контейнеров с большими или сложными структурами элементов, чтобы снизить потребляемое число единиц запросов. Примеры из реальной жизни, а также шаблоны для управления элементами большого размера см. в разделе [Моделирование элементов в Cosmos DB](how-to-model-partition-example.md).

## <a name="per-request-limits"></a>Ограничения для каждого запроса

Azure Cosmos DB поддерживает [CRUD и операции с запросами](/rest/api/cosmos-db/) для ресурсов, таких как контейнеры, элементы и базы данных. Также поддерживаются [транзакционные пакетные запросы](/dotnet/api/microsoft.azure.cosmos.transactionalbatch) к нескольким элементам с одним и тем же ключом раздела в контейнере.

| Ресурс | Ограничение по умолчанию |
| --- | --- |
| Максимальное время выполнения для одной операции (например, выполнение хранимой процедуры или получение одной страницы запроса)| 5 секунд |
| Максимальный размер запроса (например, хранимая процедура, CRUD)| 2 МБ |
| Максимальный размер отклика (например, запрос с разбивкой на страницы) | 4 МБ |
| Максимальное количество операций в пакете транзакции | 100 |

Когда для операции (например, запрос) превышен интервал ожидания или размер отклика, она возвращает клиенту страницу результатов и маркер продолжения, чтобы возобновить выполнение. Практически применимых ограничений по продолжительности выполнения одного запроса на страницах или продолжениях не предусмотрено.

Cosmos DB использует HMAC для авторизации. Для точного контроля доступа к ресурсам, таким как контейнеры, ключи секций или элементы, можно использовать либо первичный ключ, либо [маркеры ресурсов](secure-access-to-data.md) . В следующей таблице перечислены ограничения для ключей авторизации в Cosmos DB.

| Ресурс | Ограничение по умолчанию |
| --- | --- |
| Максимальное время окончания срока действия первичного маркера | 15 мин.  |
| Минимальный срок действия маркера ресурса | 10 мин.  |
| Максимальный срок действия маркера ресурса | 24 ч. по умолчанию. Вы можете увеличить это значение, [направив запрос в службу поддержки Azure](create-support-request-quota-increase.md)|
| Максимальная расфазировка тактовых сигналов для авторизации токена| 15 мин. |

Cosmos DB поддерживает выполнение триггеров во время записи. Служба поддерживает не более одного триггера события перед каждой операцией записи и не более одного триггера после каждой операции записи.

## <a name="metadata-request-limits"></a>Ограничения запросов метаданных

Azure Cosmos DB поддерживает системные метаданные для каждой учетной записи. Эти метаданные позволяют перечислять коллекции, базы данных, другие Azure Cosmos DB ресурсы и их конфигурации для бесплатной оплаты.

| Ресурс | Ограничение по умолчанию |
| --- | --- |
|Максимальная частота создания коллекций в минуту|    100|
|Максимальная частота создания базы данных в минуту|    100|
|Максимальное количество подготовленных обновлений пропускной способности в минуту|    5|

## <a name="limits-for-autoscale-provisioned-throughput"></a>Ограничения для подготовленной автомасштабируемой пропускной способности

Подробное описание ограничений по пропускной способности и хранению при автомасштабировании см. в разделах [Автомасштабирование](provision-throughput-autoscale.md#autoscale-limits) и [Часто задаваемые вопросы](autoscale-faq.md#lowering-the-max-rus).

| Ресурс | Ограничение по умолчанию |
| --- | --- |
| Максимальное число единиц запросов в секунду, до которого возможно масштабирование системы |  `Tmax`, максимальное число единиц запросов в секунду, заданное пользователем|
| Минимальное число единиц запросов в секунду, до которого возможно масштабирование системы | `0.1 * Tmax`|
| Текущее число единиц запросов в секунду, до которого возможно масштабирование системы  |  `0.1*Tmax <= T <= Tmax`, с учетом данных по использованию|
| Минимальное число единиц запросов в час, включаемых в счет| `0.1 * Tmax` <br></br>Выставление счетов выполняется на почасовой основе по максимальному количеству единиц запросов в секунду, до которого система выполняла масштабирование в течение часа или `0.1*Tmax`, в зависимости от того, какая сумма больше. |
| Минимальное значение автомасштабирования для макс. числа единиц запросов в секунду для контейнера  |  `MAX(4000, highest max RU/s ever provisioned / 10, current storage in GB * 100)` с округлением до ближайших 1000 единиц запросов в секунду |
| Минимальное значение автомасштабирования для макс. числа единиц запросов в секунду для базы данных  |  `MAX(4000, highest max RU/s ever provisioned / 10, current storage in GB * 100,  4000 + (MAX(Container count - 25, 0) * 1000))` с округлением до ближайших 1000 единиц запросов в секунду. <br></br>Примечание. Если в базе данных содержится более 25 контейнеров, система увеличивает минимальное значение автомасштабирования макс. числа единиц запросов в секунду на 1000 единиц для каждого дополнительного контейнера. Например, если имеется 30 контейнеров, можно задать минимальное значение автомасштабирования макс. числа единиц запросов в секунду для 9000 единиц запросов в секунду (масштабирование в пределах от 900 до 9000 единиц запросов в секунду).

## <a name="sql-query-limits"></a>Ограничения по запросам SQL

Cosmos DB поддерживает отправку запросов на элементы с помощью [SQL](./sql-query-getting-started.md). В следующей таблице описаны ограничения по операторам запроса, например с точки зрения количества предложений или длины запроса.

| Ресурс | Ограничение по умолчанию |
| --- | --- |
| Максимальная длина SQL-запроса| 256 KB |
| Максимальное число объединений на запрос| 5 <sup>*</sup>|
| Максимальное число определяемых пользователем функций на запрос| 10 <sup>*</sup>|
| Максимальное число точек на многоугольник| 4096 |
| Максимальное число включаемых путей на контейнер| 500 |
| Максимальное число исключаемых путей на контейнер| 500 |
| Максимальное число свойств в составном индексе| 8 |

<sup>*</sup> Вы можете увеличить любой из этих ограничений SQL Query, создав [Поддержка Azure](create-support-request-quota-increase.md).

## <a name="mongodb-api-specific-limits"></a>Ограничения, характерные для API MongoDB

Cosmos DB поддерживает протокол проводной связи MongoDB для приложений, написанных для MongoDB. Поддерживаемые команды и версии протокола приведены в разделе [Поддерживаемые функции и синтаксис MongoDB](mongodb-feature-support.md).

В следующей таблице перечислены ограничения, относящиеся к поддержке функций MongoDB. Другие ограничения службы, указанные для (основного) API SQL, также применяются и к API MongoDB.

| Ресурс | Ограничение по умолчанию |
| --- | --- |
| Максимальный размер памяти для запросов MongoDB (это ограничение применимо только для версии сервера 3.2) | 40 МБ |
|Максимальное время выполнения для операций MongoDB (для версии сервера 3,2)| 15 секунд|
|Максимальное время выполнения для операций MongoDB (для версии сервера 3,6)| 60 секунд|
| Интервал ожидания неактивных подключений для закрытия соединений на стороне сервера * | 30 минут |

\* Рекомендуется задать в параметрах драйвера клиентского приложения интервал ожидания неактивных подключений 2–3 минуты, так как [по умолчанию интервал ожидания для балансировщика нагрузки Azure составляет 4 минуты](../load-balancer/load-balancer-tcp-idle-timeout.md).  Это гарантирует, что неактивные подключения не будут закрыты промежуточной подсистемой балансировки нагрузки между клиентским компьютером и Azure Cosmos DB.

## <a name="try-cosmos-db-free-limits"></a>Ограничения для версии Try Cosmos DB Free

В следующей таблице перечислены ограничения для бесплатной пробной версии [Try Azure Cosmos DB for Free](https://azure.microsoft.com/try/cosmosdb/).

| Ресурс | Ограничение по умолчанию |
| --- | --- |
| Срок действия бесплатной пробной версии | 30 дней (после истечения срока действия можно запросить новую бесплатную пробную версию) <br> После истечения срока действия все хранимые сведения удаляются. |
| Максимальное число контейнеров на подписку (SQL, Gremlin, API таблиц) | 1 |
| Максимальное число контейнеров на подписку (API Mongo DB) | 3 |
| Максимальная пропускная способность на контейнер | 5000 |
| Максимальная пропускная способность на базу данных с общей пропускной способностью | 20 000 |
| Максимальный общий объем хранилища для учетной записи | 10 ГБ |

Бесплатная пробная версия Try Cosmos DB поддерживает глобальную дистрибуцию только в центральных регионах США, Северной Европе и Юго-Восточной Азии. Невозможно создать обращения в службу поддержки Azure для учетных записей Try Azure Cosmos DB. Однако поддержка предоставляется подписчикам, которые приобрели план с услугами поддержки.

## <a name="azure-cosmos-db-free-tier-account-limits"></a>Ограничения учетной записи Azure Cosmos DB уровня Free

В следующей таблице перечислены ограничения для [учетных записей Azure Cosmos DB уровня "Бесплатный"](optimize-dev-test.md#azure-cosmos-db-free-tier).

| Ресурс | Ограничение по умолчанию |
| --- | --- |
| Число учетных записей уровня "Бесплатный" для одной подписки Azure | 1 |
| Продолжительность действия скидки на основе категории для уровня "Бесплатный" | Срок действия учетной записи. Необходимо явное согласие при создании учетной записи. |
| Максимальное число единиц запросов в секунду для уровня "Бесплатный" | 400 ЕЗ/с |
| Максимальный объем хранилища для уровня "Бесплатный" | 5 ГБ |
| Максимальное число баз данных с общей пропускной способностью | 5 |
| Максимальное число контейнеров в базе данных с общей пропускной способностью | 25 <br>25 (в учетных записях уровня "Бесплатный" предоставляется не менее 400 ЕЗ для каждой базы данных с общей пропускной способностью и числом контейнеров не более 400). |

Помимо указанных выше ограничений, к учетным записям уровня "Бесплатный" применимы также [ограничения для учетных записей](#per-account-limits).

> [!NOTE]
> Уровень "бесплатный" Azure Cosmos DB отличается от бесплатной учетной записи Azure. Бесплатная учетная запись Azure предоставляет кредиты и ресурсы Azure бесплатно в течение ограниченного времени. При использовании Azure Cosmos DB в качестве части этой бесплатной учетной записи вы получаете 25 ГБ хранилища и 400 единиц запросов в секунду для подготовленной пропускной способности в течение 12 месяцев.

## <a name="next-steps"></a>Дальнейшие действия

Ознакомьтесь с дополнительными сведениями об основных понятиях Cosmos DB: [глобальное распределение](distribute-data-globally.md), [секционирование](partitioning-overview.md) и [подготовленная пропускная способность](request-units.md).

Приступая к работе с Azure Cosmos DB, ознакомьтесь с одним из наших кратких руководств:

* [Azure Cosmos DB. Создание веб-приложения API SQL с использованием языка .NET и портала Azure](create-sql-api-dotnet.md)
* [Начало работы с API Azure Cosmos DB для MongoDB](create-mongodb-nodejs.md)
* [Краткое руководство. Создание приложения Cassandra с помощью .NET и Azure Cosmos DB](create-cassandra-dotnet.md)
* [Начало работы с API Gremlin в Azure Cosmos DB](create-graph-dotnet.md)
* [Краткое руководство. Создание приложения API таблицы с помощью .NET и Azure Cosmos DB](create-table-dotnet.md)

> [!div class="nextstepaction"]
> [Бесплатная пробная версия Azure Cosmos DB](https://azure.microsoft.com/try/cosmosdb/)
