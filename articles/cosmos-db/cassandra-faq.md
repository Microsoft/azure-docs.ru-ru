---
title: Часто задаваемые вопросы о API Cassandra для Azure Cosmos DB
description: Получите ответы на часто задаваемые вопросы о API Cassandra для Azure Cosmos DB.
author: TheovanKraay
ms.service: cosmos-db
ms.subservice: cosmosdb-cassandra
ms.topic: conceptual
ms.date: 08/12/2020
ms.author: thvankra
ms.openlocfilehash: 1368a3174af08f557b6d08f298fba015601d568c
ms.sourcegitcommit: 910a1a38711966cb171050db245fc3b22abc8c5f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "96030838"
---
# <a name="frequently-asked-questions-about-the-cassandra-api-in-azure-cosmos-db"></a>Часто задаваемые вопросы о API Cassandra в Azure Cosmos DB
[!INCLUDE[appliesto-cassandra-api](includes/appliesto-cassandra-api.md)]

В этой статье описаны различия в функциональных возможностях Apache Cassandra и API Cassandra в Azure Cosmos DB. Здесь также содержатся ответы на часто задаваемые вопросы о API Cassandra в Azure Cosmos DB.

## <a name="key-differences-between-apache-cassandra-and-the-cassandra-api"></a>Основные различия между Apache Cassandra и API Cassandra

- Apache Cassandra рекомендует ограничение размера ключа секции — 100 МБ. API Cassandra для Azure Cosmos DB допускает до 20 ГБ на секцию.
- Apache Cassandra позволяет отключить устойчивые фиксации. Вы можете пропустить запись в журнал фиксации и перейти непосредственно к мемтаблес. Это может привести к утрате данных, если узел выйдет из строя, прежде чем мемтаблес будет сброшен в Сстаблес на диске. Azure Cosmos DB всегда выполняет устойчивые фиксации, чтобы помочь предотвратить потери данных.
- Apache Cassandra может видеть снижение производительности, если Рабочая нагрузка включает много замен или удалений. Причиной является захоронение, которое необходимо пропустить рабочей нагрузке чтения для получения последних данных. API Cassandra не увидит снижение производительности чтения, если Рабочая нагрузка содержит много замен или удалений.
- В сценариях рабочих нагрузок с высокой загрузкой необходимо выполнить сжатие, чтобы объединить Сстаблес на диске. (Слияние требуется, так как записи Apache Cassandra являются только добавлением. Несколько обновлений хранятся в виде отдельных записей SSTable, которые необходимо периодически объединять. Эта ситуация также может привести к снижению производительности чтения во время сжатия. Это влияние на производительность не происходит в API Cassandra, поскольку API не реализует сжатие.
- Установка коэффициента репликации равным 1 возможна при использовании Apache Cassandra. Однако она приводит к низкому доступу, если единственный узел с данными выходит из строя. Это не проблема с API Cassandra для Azure Cosmos DB, так как всегда существует коэффициент репликации 4 (кворум, равный 3).
- Добавление или удаление узлов в Apache Cassandra требует вмешательства вручную, а также высокой загрузки ЦП на новом узле, в то время как существующие узлы перемещают некоторые из их диапазонов маркеров на новый узел. Такая ситуация возникает при списании существующего узла. Однако API Cassandra масштабируется без проблем, обнаруженных в службе или приложении.
- Нет необходимости устанавливать **num_tokens** на каждом узле в кластере, как в Apache Cassandra. Azure Cosmos DB полностью управляет узлами и диапазонами токенов.
- API Cassandra полностью управляется. Вам не нужны команды **нодетул** , такие как Repair и списание, которые используются в Apache Cassandra.

## <a name="other-frequently-asked-questions"></a>Другие часто задаваемые вопросы

### <a name="what-protocol-version-does-the-cassandra-api-support"></a>Какая версия протокола поддерживает API Cassandra?

API Cassandra для Azure Cosmos DB поддерживает CQL версии 3. x. Его совместимость с CQL основана на общедоступном [репозитории Apache Cassandra GitHub](https://github.com/apache/cassandra/blob/trunk/doc/cql3/CQL.textile). Если у вас есть отзывы о поддержке других протоколов, сообщите нам о [голосовом отзыве пользователя](https://feedback.azure.com/forums/263030-azure-cosmos-db) или отправьте сообщение по адресу [askcosmosdbcassandra@microsoft.com](mailto:askcosmosdbcassandra@microsoft.com) .

### <a name="why-is-choosing-throughput-for-a-table-a-requirement"></a>Почему для таблицы требуется выбор пропускной способности?

Azure Cosmos DB задает пропускную способность по умолчанию для контейнера в зависимости от того, где создается таблица: портал Azure или CQL.

Azure Cosmos DB предоставляет гарантии производительности и задержки с верхними границами для операций. Эти гарантии возможны, когда подсистема может принудительно применить управление операциями клиента. Настраивая значение пропускной способности, вы гарантированно получаете требуемые показатели пропускной способности и задержки, так как платформа резервирует эту емкость и обеспечивает бесперебойное выполнение операций.
Вы можете [гибко изменить пропускную способность](manage-scale-cassandra.md) , чтобы получить преимущества от сезонности приложения и сэкономить затраты.

Концепция пропускной способности подробно описана в статье [Единицы запросов в базе данных Azure Cosmos DB](request-units.md). Пропускная способность таблицы равномерно распределяется по базовым физическим секциям.

### <a name="what-is-the-throughput-of-a-table-thats-created-through-cql"></a>Какова пропускная способность таблицы, созданной с помощью CQL?

Azure Cosmos DB использует единицы запросов в секунду в качестве валюты для обеспечения пропускной способности. Таблицы, созданные с помощью CQL, по умолчанию имеют 400 единиц запросов. ЕДИНИЦу запроса можно изменить с портал Azure.

CQL

```shell
CREATE TABLE keyspaceName.tablename (user_id int PRIMARY KEY, lastname text) WITH cosmosdb_provisioned_throughput=1200
```

.NET

```csharp
int provisionedThroughput = 400;
var simpleStatement = new SimpleStatement($"CREATE TABLE {keyspaceName}.{tableName} (user_id int PRIMARY KEY, lastname text)");
var outgoingPayload = new Dictionary<string, byte[]>();
outgoingPayload["cosmosdb_provisioned_throughput"] = Encoding.UTF8.GetBytes(provisionedThroughput.ToString());
simpleStatement.SetOutgoingPayload(outgoingPayload);
```

### <a name="what-happens-when-throughput-is-used-up"></a>Что происходит, когда достигается предел пропускной способности?

Azure Cosmos DB предоставляет гарантии производительности и задержки с верхними границами для операций. Эти гарантии возможны, когда подсистема может принудительно применить управление операциями клиента. Настраивая значение пропускной способности, вы гарантированно получаете требуемые показатели пропускной способности и задержки, так как платформа резервирует эту емкость и обеспечивает бесперебойное выполнение операций.

При проходе этой емкости появится следующее сообщение об ошибке, показывающее, что ваша емкость была использована:

**0x1001 перегружен: запрос не может быть обработан, так как "частота запросов велика"** 

Важно понять, какие операции (и их объем) вызывают эту неполадку. Вы можете получить представление о потребленной емкости по подготовленной емкости с метриками на портал Azure. Затем необходимо убедиться, что емкость потребляется почти одинаково во всех базовых секциях. Если вы видите, что одна секция использует большую часть пропускной способности, значит, у вас есть асимметрия рабочей нагрузки.

Доступны метрики, которые показывают, как пропускная способность используется в течение нескольких часов, в течение нескольких дней и за семь дней, по секциям или в статистической обработке. Дополнительные сведения см. в статье [Мониторинг и отладка с помощью метрик в Azure Cosmos DB](use-metrics.md).

Сведения о журналах диагностики приведены в статье [Журнал ведения диагностики Azure Cosmos DB](./monitor-cosmos-db.md).

### <a name="does-the-primary-key-map-to-the-partition-key-concept-of-azure-cosmos-db"></a>Вписывается ли первичный ключ в концепцию ключа секции в Azure Cosmos DB?

Да, ключ секции используется для размещения сущности в нужном месте. В Azure Cosmos DB он используется для поиска правой логической секции, хранящейся в физической секции. Концепция секционирования подробно описана в статье [Секционирование и масштабирование в Azure Cosmos DB](partitioning-overview.md). Основная мысль здесь заключается в том, что логическая Секция не должна превышать 20 ГБ.

### <a name="what-happens-when-i-get-a-notification-that-a-partition-is-full"></a>Что происходит при получении уведомления о том, что Секция заполнена?

Azure Cosmos DB является системой на основе соглашения об уровне обслуживания (SLA). Он обеспечивает неограниченное масштабирование с гарантией задержки, пропускной способности, доступности и согласованности. Это неограниченное хранилище основано на горизонтальном масштабном масштабировании данных с использованием секционирования в качестве ключевого понятия. Концепция секционирования подробно описана в статье [Секционирование и масштабирование в Azure Cosmos DB](partitioning-overview.md).

Необходимо придерживаться ограничения в 20 ГБ на число сущностей или элементов на логическую секцию. Кроме того, для обеспечения достаточной масштабируемости приложения мы рекомендуем *не* создавать секцию с высокой нагрузкой, чтобы хранить в ней все сведения и выполнять запрос этих данных. Эта ошибка может возникнуть только в том случае, если данные превышаются, т. е. у вас много данных для одного ключа секции (более 20 ГБ). Распределение данных можно найти с помощью портала хранилища. Чтобы устранить эту ошибку, повторно создайте таблицу и выберите детальную основную (ключ секции), что позволяет лучше распространять данные.

### <a name="can-i-use-the-cassandra-api-as-a-key-value-store-with-millions-or-billions-of-partition-keys"></a>Можно ли использовать API Cassandra в качестве хранилища значений ключей с миллионами или миллиардами ключей секций?

За счет масштабирования хранилища в Azure Cosmos DB можно хранить неограниченный объем данных. Это хранилище не зависит от пропускной способности. Да, вы всегда можете использовать API Cassandra только для хранения и извлечения ключей и значений, указав правильный ключ первичного ключа или секции. Эти индивидуальные ключи получают собственный логический раздел и располагаются на вершине физической секции без проблем.

### <a name="can-i-create-more-than-one-table-with-the-cassandra-api"></a>Можно ли создать более одной таблицы с API Cassandra?

Да, можно создать более одной таблицы с API Cassandra. Каждая из этих таблиц считается единицей измерения для пропускной способности и хранилища.

### <a name="can-i-create-more-than-one-table-in-succession"></a>Можно ли поочередно создать несколько таблиц?

Azure Cosmos DB является системой, управляемой ресурсами, как для данных, так и для действий плоскости управления. Контейнеры, такие как коллекции и таблицы, представляют собой сущности среды выполнения, которые подготавливаются для заданной пропускной способности. Создание этих контейнеров в быстром выполнении не является ожидаемым действием и может регулироваться. Если у вас есть тесты, которые немедленно удаляют или создают таблицы, попробуйте проделать их.

### <a name="what-is-the-maximum-number-of-tables-that-i-can-create"></a>Каково максимальное число таблиц, которые можно создать?

Нет физического ограничения на количество таблиц. Если имеется большое количество таблиц (общий устойчивый размер составляет более 10 ТБ данных), которые необходимо создать, а не как обычные десятки или сотни, отправьте электронное письмо по адресу [askcosmosdbcassandra@microsoft.com](mailto:askcosmosdbcassandra@microsoft.com) .

### <a name="what-is-the-maximum-number-of-keyspaces-that-i-can-create"></a>Каково максимальное число пространств ключей, которое можно создать?

Нет физического ограничения на количество пространств ключей, так как они являются контейнерами метаданных. Если у вас много пространств ключей, отправьте электронное письмо по адресу [askcosmosdbcassandra@microsoft.com](mailto:askcosmosdbcassandra@microsoft.com) .

### <a name="can-i-bring-in-a-lot-of-data-after-starting-from-a-normal-table"></a>Можно ли поместить большой объем данных после начала обычной таблицы?

Да. При использовании равномерно распределенных секций емкость хранилища автоматически управляется и увеличивается по мере передачи дополнительных данных. Таким образом, вы можете уверенно импортировать столько данных, сколько требуется, без управления и подготовки узлов и т. д. Но если вы планируете много немедленных роста данных, то более разумно [подготавливать ожидаемую пропускную способность](set-throughput.md) , а не начинать ее немедленно и увеличивать.

### <a name="can-i-use-yaml-file-settings-to-configure-api-behavior"></a>Можно ли использовать параметры файла YAML для настройки поведения API?

API Cassandra для Azure Cosmos DB обеспечивает совместимость на уровне протокола для выполнения операций. а также упрощает управление, мониторинг и конфигурацию. Как разработчик или пользователь, вам не нужно беспокоиться о доступности, захоронениях, кэше ключей, кэше строк, фильтре раскрытия и множестве других параметров. API Cassandra нацелен на предоставление необходимой производительности при чтении и записи без затрат на настройку и управление.

### <a name="will-the-cassandra-api-support-node-addition-cluster-status-and-node-status-commands"></a>Будет ли API Cassandra поддерживать команды "добавить узел", "состояние кластера" и "состояние узла"?

API Cassandra упрощает планирование емкости и реагирование на требования к эластичности для пропускной способности и хранения. С Azure Cosmos DB можно подготавливать необходимую пропускную способность. Затем вы можете масштабировать его в любое количество раз в день, не беспокоясь о добавлении, удалении узлов или управлении ими. Вам не нужно использовать средства для управления узлами и кластерами.

### <a name="what-happens-with-various-configuration-settings-for-keyspace-creation-like-simplenetwork"></a>Что происходит с различными параметрами конфигурации для создания пространства ключей, например Simple или Network?

Azure Cosmos DB предоставляет глобальное распределение из окна по причинам доступности и низкой задержки. Вам не нужно настраивать реплики или другие вещи. Операции записи всегда зафиксированы надежно кворума в любом регионе, где вы пишете, и предоставляет гарантии производительности.

### <a name="what-happens-with-various-settings-for-table-metadata"></a>А как насчет параметров для метаданных таблиц?

Azure Cosmos DB предоставляет гарантии производительности для операций чтения, записи и пропускной способности. Поэтому не нужно беспокоиться об изменении параметров конфигурации и случайном управлении ими. Эти параметры включают фильтр раскрытия, кэширование, возможность восстановления, gc_grace и сжатие memtable_flush_period.

### <a name="is-time-to-live-supported-for-cassandra-tables"></a>Поддерживается ли срок жизни для таблиц Cassandra?

Да, TTL поддерживается.

### <a name="how-can-i-monitor-infrastructure-along-with-throughput"></a>Как можно отслеживать инфраструктуру и пропускную способность?

Служба платформы Azure Cosmos DB помогает повысить производительность и не беспокоиться об управлении инфраструктурой и ее мониторинге. Например, вам не нужно отслеживать состояние узла, состояние реплики, GC и параметры ОС ранее с помощью различных средств. Вам нужно просто проделать пропускную способность, доступную в метриках портала, чтобы узнать, выполняется ли регулирование, а затем увеличить или уменьшить эту пропускную способность. Вы можете:

- Мониторинг [соглашений об уровне обслуживания](./monitor-cosmos-db.md)
- Использование [метрик](use-metrics.md)
- Использование [журналов диагностики](./monitor-cosmos-db.md)

### <a name="which-client-sdks-can-work-with-the-cassandra-api"></a>Какие клиентские пакеты SDK могут работать с API Cassandra?

Клиентские драйверы для Apache Cassandra SDK, использующие CQLv3, использовались для клиентских программ. Если у вас есть другие драйверы, которые вы используете, или если у вас возникли проблемы, отправьте сообщение по адресу [askcosmosdbcassandra@microsoft.com](mailto:askcosmosdbcassandra@microsoft.com) .

### <a name="are-composite-partition-keys-supported"></a>Поддерживаются ли ключи составных секций?

Да, можно использовать регулярный синтаксис для создания составных ключей секций.

### <a name="can-i-use-sstableloader-for-data-loading"></a>Можно ли использовать сстаблелоадер для загрузки данных?

Нет, сстаблелоадер не поддерживается.

### <a name="can-i-pair-an-on-premises-apache-cassandra-cluster-with-the-cassandra-api"></a>Можно ли связать локальный кластер Apache Cassandra с API Cassandra?

В настоящее время Azure Cosmos DB имеет оптимизированный интерфейс для облачной среды без затрат на операции. Если требуется связывание, отправьте сообщение [askcosmosdbcassandra@microsoft.com](mailto:askcosmosdbcassandra@microsoft.com) с описанием вашего сценария. Мы работаем над предложением, которое поможет связать локальный или облачный кластер Cassandra с API Cassandra для Azure Cosmos DB.

### <a name="does-the-cassandra-api-provide-full-backups"></a>Предоставляет ли API Cassandra полные резервные копии?

Azure Cosmos DB предоставляет две свободные полные резервные копии, созданные с интервалом в четыре часа для всех API. Поэтому вам не нужно настраивать расписание резервного копирования. 

Если вы хотите изменить срок хранения и частоту, отправьте сообщение электронной почты по адресу [askcosmosdbcassandra@microsoft.com](mailto:askcosmosdbcassandra@microsoft.com) или создайте обращение в службу поддержки. Сведения о возможности резервного копирования см. в статье [Автоматическая оперативная архивация и восстановление с помощью Azure Cosmos DB](online-backup-and-restore.md).

### <a name="how-does-the-cassandra-api-account-handle-failover-if-a-region-goes-down"></a>Как в учетной записи Cassandra API выполняется отработка отказа, если регион становится недоступен?

API Cassandra позаимствования из глобальной распределенной платформы Azure Cosmos DB. Чтобы обеспечить допустимое время простоя приложения в центре обработки данных, включите по крайней мере еще один регион для учетной записи в портал Azure. Дополнительные сведения см. [в статье высокий уровень доступности с Azure Cosmos DB](high-availability.md).

Вы можете не только добавить любое нужное число регионов для учетной записи, но и управлять тем, в какой регион будет выполняться отработка отказа, настроив приоритет для этой процедуры. Чтобы использовать базу данных, вам также нужно предоставить приложение. В это время ваши клиенты смогут работать без простоя.

### <a name="does-the-cassandra-api-index-all-attributes-of-an-entity-by-default"></a>По умолчанию API Cassandra индексировать все атрибуты сущности?

Нет. API Cassandra поддерживает [вторичные индексы](cassandra-secondary-index.md), которые ведут себя так же, как и Apache Cassandra. По умолчанию API не индексирует каждый атрибут.  


### <a name="can-i-use-the-new-cassandra-api-sdk-locally-with-the-emulator"></a>Можно ли использовать пакет SDK для Cassandra API локально с эмулятором?

Да, это поддерживается. Сведения о том, как это сделать, можно найти в статье [использование эмулятора Azure Cosmos DB для локальной разработки и тестирования](local-emulator.md#cassandra-api) .


### <a name="how-can-i-migrate-data-from-apache-cassandra-clusters-to-azure-cosmos-db"></a>Как можно перенести данные из кластеров Apache Cassandra в Azure Cosmos DB?

Сведения о вариантах миграции см. в статье [Миграция данных в учетную запись API Cassandra в Azure Cosmos DB](cassandra-import-data.md) руководстве.


### <a name="where-can-i-give-feedback-on-cassandra-api-features"></a>Где можно отправить отзыв о API Cassandraных функциях?

Оставьте отзыв с помощью формы обратной связи на форуме [UserVoice](https://feedback.azure.com/forums/263030-azure-cosmos-db).

[azure-portal]: https://portal.azure.com
[query]: ./sql-query-getting-started.md

## <a name="next-steps"></a>Дальнейшие действия

- Приступая к работе с [эластичным масштабированием учетной записи Azure Cosmos DB API Cassandra](manage-scale-cassandra.md).
