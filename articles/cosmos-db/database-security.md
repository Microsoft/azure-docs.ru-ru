---
title: Безопасность баз данных в Azure Cosmos DB
description: Узнайте, как Azure Cosmos DB обеспечивает защиту базы данных и данных.
author: markjbrown
ms.service: cosmos-db
ms.topic: conceptual
ms.date: 10/21/2020
ms.author: mjbrown
ms.openlocfilehash: 19b4c8466e88159839ce1f43a5ba282b1bb3ec9e
ms.sourcegitcommit: 867cb1b7a1f3a1f0b427282c648d411d0ca4f81f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "94636934"
---
# <a name="security-in-azure-cosmos-db---overview"></a>Безопасность в Azure Cosmos DB. Обзор
[!INCLUDE[appliesto-all-apis](includes/appliesto-all-apis.md)]

В этой статье представлены рекомендации по обеспечению безопасности, а также основные возможности, предлагаемые Azure Cosmos DB для предотвращения и обнаружения нарушений в работе баз данных и реагирования на эти нарушения.

## <a name="whats-new-in-azure-cosmos-db-security"></a>Новые возможности Azure Cosmos DB безопасности

Шифрование неактивных данных теперь доступно для документов и резервных копий, хранящихся в Azure Cosmos DB во всех регионах Azure. Шифрование неактивных данных применяется в этих регионах автоматически как для новых, так и для существующих клиентов. Настраивать ничего не нужно. Уровень задержки, пропускной способности, доступности и функциональности сохраняется, но при этом вы получаете преимущество более высокой защищенности данных.

## <a name="how-do-i-secure-my-database"></a>Разделы справки защитить мою базу данных

Ответственность за безопасность данных лежит как на клиенте, так и на поставщике базы данных. В зависимости от выбранного поставщика базы данных доля ответственности клиента может меняться. Если выбрать локальное решение, то клиент должен предоставить все — от защиты конечной точки до физической безопасности оборудования, а это непростая задача. Если выбрать поставщик облачной базы данных PaaS, например Azure Cosmos DB, то обязанности клиента значительно сокращаются. На следующем рисунке, взятом из технического документа корпорации Майкрософт [Shared Responsibilities for Cloud Computing](https://gallery.technet.microsoft.com/Shared-Responsibilities-81d0ff91) (Разделяемые обязанности в облачных вычислениях), показано, как с применением поставщика PaaS, такого как Azure Cosmos DB, сокращается ответственность клиента.

:::image type="content" source="./media/database-security/nosql-database-security-responsibilities.png" alt-text="Ответственность клиента и поставщика базы данных":::

На предыдущей схеме видны высокоуровневые компоненты безопасности в облаке, но о каких элементах необходимо позаботиться конкретно для решения вашей базы данных? И как сравнить решения между собой?

Мы рекомендуем сравнить системы баз данных с помощью следующего контрольного списка требований:

- Параметры безопасности сети и брандмауэра
- Аутентификация пользователей и детальные пользовательские элементы управления
- Возможность глобальной репликации данных в случае регионального сбоя
- Возможность отработки отказа из одного центра обработки данных в другой
- Репликация локальных данных в рамках центра обработки данных
- Автоматическая архивация данных
- Восстановление удаленных данных из архива
- Защита и изолирование конфиденциальных данных
- Мониторинг атак
- Реагирование на атаки
- Возможность защитить данные в пределах геозоны в соответствии с ограничениями, установленными для управления данными
- Физическая защита серверов в защищенных центрах обработки данных
- Сертификация

И хотя это может показаться очевидным, но последние [крупномасштабные нарушения в работе баз данных](https://thehackernews.com/2017/01/mongodb-database-security.html) напоминают нам о простых, но критических важных требованиях, которые необходимо выполнять:

- Обновленные серверы, которые актуальны
- HTTPS по умолчанию/шифрование TLS
- Административные учетные записи с надежными паролями

## <a name="how-does-azure-cosmos-db-secure-my-database"></a>Как Azure Cosmos DB защитить мою базу данных

Давайте еще раз рассмотрим приведенный выше список. Сколько из этих требований к безопасности выполняется Azure Cosmos DB? Абсолютно все.

Рассмотрим каждое из них подробнее.

|Требование к безопасности|Подход к обеспечению безопасности Azure Cosmos DB|
|---|---|
|Безопасность сети|Использование брандмауэра для IP-адресов — первый уровень защиты базы данных. Для поддержки входящего трафика брандмауэра база данных Azure Cosmos DB использует политики контроля доступа на основе IP-адресов. Управление доступом на основе IP-адресов аналогично правилам брандмауэра, используемым традиционными системами баз данных, но они развернуты таким образом, чтобы учетная запись базы данных Azure Cosmos была доступна только из утвержденного набора компьютеров или облачных служб. Дополнительные сведения см. в статье [Azure Cosmos DB поддержка брандмауэра](how-to-configure-firewall.md) .<br><br>Azure Cosmos DB позволяет включить определенный IP-адрес (168.61.48.0), диапазон IP-адресов (168.61.48.0/8), а также сочетания IP-адресов и диапазонов. <br><br>Все запросы, полученные от компьютеров, IP-адреса которых не входят в этот список разрешенных, блокируются Azure Cosmos DB. Затем запросы из утвержденных компьютеров и облачных служб должны пройти процесс аутентификации, чтобы получить право на контроль доступа к ресурсам.<br><br> Вы можете использовать [теги службы виртуальной сети](../virtual-network/service-tags-overview.md) для обеспечения изоляции сети и защиты ресурсов Azure Cosmos DB из общего Интернет. Теги служб можно использовать вместо определенных IP-адресов при создании правил безопасности. Указав имя тега службы (например, Азурекосмосдб) в соответствующем поле источника или назначения правила, можно разрешить или запретить трафик для соответствующей службы.|
|Авторизация|Azure Cosmos DB использует для авторизации код проверки подлинности сообщения на основе хэша (HMAC). <br><br>Каждый запрос хэшируется с помощью секретного ключа учетной записи, а затем хэш в кодировке Base-64 отправляется с каждым вызовом в Azure Cosmos DB. Чтобы проверить запрос, служба Azure Cosmos DB использует соответствующий секретный ключ и свойства для создания хэша, а затем сравнивает это значение со значением в запросе. Если эти два значения совпадают, то операция авторизуется и запрос обрабатывается. В противном случае происходит ошибка авторизации и запрос отклоняется.<br><br>Можно использовать либо [первичный ключ](#primary-keys), либо [маркер ресурса](secure-access-to-data.md#resource-tokens) , который обеспечивает точный доступ к ресурсу, например документу.<br><br>Дополнительные сведения см. в статье о [защите доступа к ресурсам Azure Cosmos DB](secure-access-to-data.md).|
|Пользователи и разрешения|С помощью первичного ключа учетной записи можно создавать пользовательские ресурсы и ресурсы разрешений для каждой базы данных. Маркер ресурса связан с разрешением в базе данных и определяет, имеет ли пользователь доступ (на чтение и запись, только на чтение или без доступа) к ресурсу приложения в базе данных. К ресурсам приложения относятся контейнеры, документы, вложения, хранимые процедуры, триггеры и определяемые пользователем функции (UDF). Затем маркер ресурса используется во время аутентификации, чтобы предоставить или запретить доступ к ресурсу.<br><br>Дополнительные сведения см. в статье о [защите доступа к ресурсам Azure Cosmos DB](secure-access-to-data.md).|
|Интеграция с Active Directory (Azure RBAC)| Вы также можете предоставить или ограничить доступ к учетной записи Cosmos, базе данных, контейнеру и предложениям (пропускной способности) с помощью управления доступом (IAM) в портал Azure. IAM обеспечивает управление доступом на основе ролей и интегрируется с Active Directory. Для частных пользователей и групп можно использовать встроенные роли или пользовательские роли. Дополнительные сведения см. в статье [интеграция Active Directory](role-based-access-control.md) .|
|Глобальная репликация|Azure Cosmos DB предлагает готовое к использованию глобальное распространение, что позволяет реплицировать данные в любой из центров обработки данных Azure по всему миру одним щелчком. Глобальная репликация позволяет осуществлять глобальное масштабирование, обеспечивая низкую задержку при обращении к данным по всему миру.<br><br>В контексте безопасности глобальная репликация обеспечивает защиту данных от региональных сбоев.<br><br>Дополнительные сведения см. в статье [DocumentDB — глобально распределенная служба базы данных в Azure](distribute-data-globally.md).|
|Отработка отказа между регионами|Если вы реплицировали данные в нескольких центрах обработки данных, то Azure Cosmos DB автоматически переключит операции на другой центр, как только будет утрачена связь с региональным центром обработки данных. Вы можете создать список расположенных по приоритетам регионов отработки отказа, используя регионы, в которых реплицируются ваши данные. <br><br>Дополнительные сведения см. в статье об [отработке отказа между регионами в Azure Cosmos DB](high-availability.md).|
|Локальная репликация|Даже в пределах одного центра обработки данных Azure Cosmos DB автоматически реплицирует данные для обеспечения высокой доступности, предоставляя выбор [уровней согласованности](consistency-levels.md). Эта репликация гарантирует [соглашение об уровне обслуживания](https://azure.microsoft.com/support/legal/sla/cosmos-db) 99,99% для всех учетных записей одного региона и всех учетных записей с несколькими регионами с ослабленной согласованностью и 99,999% доступности чтения для всех учетных записей базы данных в нескольких регионах.|
|Автоматическая оперативная архивация|Базы данных Azure Cosmos регулярно архивируются и хранятся в геоизбыточном хранилище. <br><br>Дополнительные сведения см. в статье [Автоматическая оперативная архивация и восстановление с помощью Azure Cosmos DB](online-backup-and-restore.md).|
|Восстановление удаленных данных|Автоматическая оперативная архивация может использоваться для восстановления данных, которые были случайно удалены. Это можно сделать максимум через 30 дней после события. <br><br>Дополнительные сведения см. в статье [Автоматическое оперативное резервное копирование и восстановление с помощью Azure Cosmos DB](online-backup-and-restore.md)|
|Защита и изолирование конфиденциальных данных|Ко всем данным, перечисленным в разделе "Новые возможности", теперь применяется шифрование неактивных данных.<br><br>Личные и другие конфиденциальные данные можно изолировать в определенном контейнере, а доступ для чтения и записи или только для чтения можно ограничить определенным списком пользователей.|
|Мониторинг атак|С помощью [ведения журнала аудита и журналов действий](./monitor-cosmos-db.md)можно отслеживать нормальные и аномальные действия в учетной записи. Вы можете просматривать, какие операции выполнялись с ресурсами, кто инициировал эти операции, время их выполнения, состояние операций и многое другое, как показано на снимке экрана после этой таблицы.|
|Реагирование на атаки|Когда вы обращаетесь в службу поддержки Azure и сообщаете о возможной атаке, запускается 5-этапная процедура реагирования на инцидент. Целью этой 5-этапной процедуры является как можно быстрее восстановить нормальную защиту и функционирование службы. Выполняется обнаружение проблемы и расследование инцидента.<br><br>Дополнительные сведения см. в статье [Microsoft Azure Security Response in the Cloud](https://gallery.technet.microsoft.com/Shared-Responsibilities-81d0ff91) (Реагирование на нарушения безопасности в облаке Microsoft Azure).|
|Установка геозон|Azure Cosmos DB обеспечивает управление данными для отдельных регионов (например, Германия, Китай или US Gov).|
|Защищенное оборудование|Данные в Azure Cosmos DB хранятся на твердотельных накопителях SSD в защищенных центрах обработки данных Azure.<br><br>Дополнительные сведения о глобальных центрах обработки данных корпорации Майкрософт см. на [этой странице](https://www.microsoft.com/en-us/cloud-platform/global-datacenters).|
|Шифрование HTTPS, SSL и TLS|Все подключения к Azure Cosmos DB поддерживают протокол HTTPS. Azure Cosmos DB также поддерживает TLS 1,2.<br>Можно применить минимальную версию протокола TLS на стороне сервера. Для этого обратитесь к [azurecosmosdbtls@service.microsoft.com](mailto:azurecosmosdbtls@service.microsoft.com) .|
|Шифрование при хранении|Все данные, хранимые в Azure Cosmos DB, хранятся в зашифрованном виде. Дополнительные сведения см. в статье [Шифрование неактивных данных базы данных в Azure Cosmos DB](./database-encryption-at-rest.md).|
|Установка исправлений на серверы|Являясь управляемой базой данных, Azure Cosmos DB избавляет от необходимости управлять серверами и устанавливать на них исправления. Это делается автоматически.|
|Административные учетные записи с надежными паролями|Пожалуй, даже не нужно упоминать об этом требовании, но, в отличие от некоторых наших конкурентов, в Azure Cosmos DB не может быть учетной записи администратора без пароля.<br><br> Безопасность через TLS и проверка подлинности на основе секрета HMAC по умолчанию помогут.|
|Сертификаты безопасности и защиты данных| Самый актуальный список сертификатов см. на общем [сайте соответствия требованиям Azure](https://www.microsoft.com/en-us/trustcenter/compliance/complianceofferings) , а также в последнем [документе соответствия требованиям Azure](https://gallery.technet.microsoft.com/Overview-of-Azure-c1be3942) со всеми сертификатами (выполните поиск по запросу Cosmos). Чтобы получить более подробные сведения, ознакомьтесь с 25 апреля 2018 Post [Azure #CosmosDB: безопасное, закрытое, соответствующее требованиям, включающее SoC 1/2 Type 2, HITRUST, PCI DSS уровня 1, ISO 27001, HIPAA, FedRAMP High и многие другие.

На следующем снимке экрана показано, как можно выполнять мониторинг учетной записи с помощью журналов аудита и действий: :::image type="content" source="./media/database-security/nosql-database-security-application-logging.png" alt-text="журналы действий для Azure Cosmos DB":::

<a id="primary-keys"></a>

## <a name="primary-keys"></a>Первичные ключи

Первичные ключи предоставляют доступ ко всем административным ресурсам учетной записи базы данных. Первичные ключи:

- предоставляют доступ к учетным записям, базам данных, пользователям и разрешениям; 
- не могут использоваться для предоставления детального доступа к контейнерам и документам;
- создаются в процессе создания учетной записи;
- можно создать повторно в любое время.

Каждая учетная запись состоит из двух первичных ключей: первичного ключа и вторичного ключа. Двойные ключи позволяют повторно создавать или сменять ключи, обеспечивая постоянный доступ к учетной записи и данным.

Помимо двух первичных ключей для учетной записи Cosmos DB, существуют два ключа только для чтения. Эти ключи разрешают только операции чтения в учетной записи. Ключи только для чтения не предоставляют доступ к ресурсам разрешений на чтение.

Первичные и вторичные ключи, доступные только для чтения и записи на чтение и запись можно получить и повторно создать с помощью портал Azure. Дополнительные сведения см. в разделе [Просмотр, копирование и повторное создание ключей доступа](manage-with-cli.md#regenerate-account-key).

:::image type="content" source="./media/secure-access-to-data/nosql-database-security-master-key-portal.png" alt-text="Управление доступом (IAM) на портале Azure: демонстрация безопасности базы данных NoSQL":::

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения о первичных ключах и маркерах ресурсов см. [в статье Защита доступа к Azure Cosmos DBным данным](secure-access-to-data.md).

Дополнительные сведения о ведении журнала аудита см. в разделе [Azure Cosmos DB ведение журнала диагностики](./monitor-cosmos-db.md).

Дополнительные сведения о сертификации Майкрософт см. в разделе [центр управления безопасностью Azure](https://azure.microsoft.com/support/trust-center/).