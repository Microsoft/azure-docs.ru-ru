---
title: Создание ключа искусственного раздела в Azure Cosmos DB
description: Сведения об использовании ключей искусственного секционирования в контейнерах Azure Cosmos для равномерного распределения данных и рабочей нагрузки по ключам секций.
ms.service: cosmos-db
ms.subservice: cosmosdb-sql
ms.topic: conceptual
ms.date: 12/03/2019
author: markjbrown
ms.author: mjbrown
ms.openlocfilehash: 6b8bc44f1ba5624c37620205aaa574e618ef395f
ms.sourcegitcommit: 867cb1b7a1f3a1f0b427282c648d411d0ca4f81f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "93340657"
---
# <a name="create-a-synthetic-partition-key"></a>Создание искусственного ключа секции
[!INCLUDE[appliesto-sql-api](includes/appliesto-sql-api.md)]

Рекомендуется использовать ключ секции с множеством различных значений, например с сотнями или тысячами. Главное — это равномерное распределение данных и рабочей нагрузки по всем элементам, связанным с этими значениями ключа секции. Если такое свойство не существует в данных, можно создать *Виртуальный ключ секции*. В этом документе описаны некоторые основные методы создания искусственного ключа секции для контейнера Cosmos.

## <a name="concatenate-multiple-properties-of-an-item"></a>Сцепление нескольких свойств элемента

Вы можете создать ключ секции, объединив несколько значений свойств в одно искусственное свойство `partitionKey`. Эти ключи называются искусственными ключами. Рассмотрим следующий пример документа:

```JavaScript
{
"deviceId": "abc-123",
"date": 2018
}
```

Для предыдущего документа одним из вариантов является установка /deviceId или /date в качестве ключа секции. Используйте этот параметр, если вы хотите секционировать контейнер на основе идентификатора или даты устройства. Другой вариант заключается в сцеплении этих двух значений в искусственное свойство `partitionKey`, которое используется в качестве ключа секции.

```JavaScript
{
"deviceId": "abc-123",
"date": 2018,
"partitionKey": "abc-123-2018"
}
```

В сценариях реального времени в базе данных могут быть тысячи элементов. Вместо того, чтобы добавлять искусственный ключ вручную, определите логику на стороне клиента для сцепления значений и вставьте искусственный ключ в элементы в контейнерах Cosmos.

## <a name="use-a-partition-key-with-a-random-suffix"></a>Использование ключа секции со случайным суффиксом

Другой возможной стратегией равномерного распределения рабочей нагрузки является добавление случайного числа в конце значения ключа секции. При таком распределении элементов вы можете выполнять параллельные операции записи по секциям.

Например, если ключ секции представляет собой дату, Вы можете выбрать случайное число от 1 до 400 и сцепить его как суффикс к дате. Этот метод приводит к получению значений ключа секции, таких как  `2018-08-09.1` , `2018-08-09.2` и т. д., с помощью  `2018-08-09.400` . Так как вы рандомизируете ключ секции, ежедневные операции записи в контейнере распределяются равномерно по нескольким секциям. Этот метод обеспечивает оптимальный параллелизм и высокую общую пропускную способность.

## <a name="use-a-partition-key-with-pre-calculated-suffixes"></a>Использование ключа секции с предварительно вычисленными суффиксами 

Стратегия случайного суффикса может значительно повысить пропускную способность записи, но при этом трудно считать конкретный элемент. Вы не узнаете значение суффикса, которое использовалось при написании элемента. Чтобы упростить чтение отдельных элементов, используйте стратегию предварительно вычисляемых суффиксов. Вместо того чтобы использовать случайное число для распределения элементов между секциями, используйте число, вычисляемое на основе чего-либо, которое нужно запросить.

Рассмотрим предыдущий пример, в котором контейнер использует дату в качестве ключа секции. Теперь предположим, что у каждого элемента  `Vehicle-Identification-Number` есть `VIN` атрибут (), к которому требуется получить доступ. Кроме того, предположим, что вы часто выполняете запросы для поиска элементов по в `VIN` дополнение к дате. Прежде чем приложение запишет элемент в контейнер, оно может вычислить суффикс хэша на основе номера ТС и добавить его к дате ключа секции. Вычисление может создать число от 1 до 400, которое распределено равномерно. Этот результат похож на результат, созданный методом стратегии случайного суффикса. Значением ключа секции будет дата, сцепленная с вычисленным результатом.

С помощью этой стратегии записи равномерно распределяются по значениям ключа секции и по секциям. Вы можете легко читать определенный элемент и дату, так как можете вычислить значение ключа секции для конкретного объекта `Vehicle-Identification-Number` . Преимущество этого метода заключается в том, что можно избежать создания одного ключа горячей секции, т. е. ключа секции, который выполняет всю рабочую нагрузку. 

## <a name="next-steps"></a>Дальнейшие действия

Подробнее о концепции разделения вы можете узнать в следующих статьях:

* Подробнее о [логических секциях](partitioning-overview.md).
* Подробнее о [подготовке пропускной способности в контейнерах и базах данных Azure Cosmos](set-throughput.md).
* Подробнее о [подготовке пропускной способности для контейнера Azure Cosmos](how-to-provision-container-throughput.md).
* Подробнее о [подготовке пропускной способности для базы данных Azure Cosmos](how-to-provision-database-throughput.md).
