---
title: Обновление Mongo версии API Azure Cosmos DB для учетной записи MongoDB
description: Как быстро обновить версию MongoDB Wired-Protocol для API существующей Azure Cosmos DB для учетных записей MongoDB
author: christopheranderson
ms.service: cosmos-db
ms.subservice: cosmosdb-mongo
ms.topic: how-to
ms.date: 03/19/2021
ms.author: chrande
ms.openlocfilehash: 8865a16c2840b65f432de679c6dd63b285b1f760
ms.sourcegitcommit: 2c1b93301174fccea00798df08e08872f53f669c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/22/2021
ms.locfileid: "104771833"
---
# <a name="upgrade-the-api-version-of-your-azure-cosmos-db-api-for-mongodb-account"></a>Обновление версии API Azure Cosmos DB API для учетной записи MongoDB
[!INCLUDE[appliesto-mongodb-api](includes/appliesto-mongodb-api.md)]

В этой статье описывается, как обновить версию API для учетной записи API Azure Cosmos DB для MongoDB. После обновления можно использовать новейшие функции API Azure Cosmos DB для MongoDB. Процесс обновления не прерывает доступность вашей учетной записи и не потребляет единиц запросов в секунду или уменьшает емкость базы данных в любой момент. Этот процесс не затрагивает существующие данные или индексы. 

При обновлении до новой версии API Начните с рабочих нагрузок разработки и тестирования перед обновлением рабочих нагрузок. Важно обновить клиенты до версии, совместимой с версией API, до которой выполняется обновление, перед обновлением Azure Cosmos DB API для учетной записи MongoDB.

>[!Note]
> В данный момент только квалифицированные учетные записи, использующие версию 3,2 сервера, могут быть обновлены до версии 3,6 или 4,0. Если в вашей учетной записи не отображается вариант обновления, отправьте запрос [в службу поддержки](https://portal.azure.com/?#blade/Microsoft_Azure_Support/HelpAndSupportBlade).

## <a name="upgrading-to-40-or-36"></a>Обновление до версии 4.0 или 3.6

### <a name="benefits-of-upgrading-to-version-40"></a>Преимущества обновления до версии 4.0

Ниже перечислены новые возможности, реализованные в версии 4,0.
- Поддержка транзакций с несколькими документами в несегментированных коллекциях.
- новые операторы агрегирования;
- повышенная производительность сканирования;
- более быстрое и эффективное хранилище.

### <a name="benefits-of-upgrading-to-version-36"></a>Преимущества обновления до версии 3.6

Ниже перечислены новые возможности, реализованные в версии 3,6.
- Повышение производительности и стабильности
- Поддержка новых команд базы данных
- Поддержка конвейера агрегирования по умолчанию и новых этапов агрегирования
- Поддержка потоков изменений
- Поддержка составных индексов
- Поддержка выполнения по нескольким разделам для следующих операций: обновление, удаление, вычисление и сортировка
- Улучшена производительность следующих операций агрегирования: $count, $skip, $limit и $group
- Сейчас поддерживается индексирование с использованием подстановочных знаков

### <a name="changes-from-version-32"></a>Изменения по сравнению с версией 3.2

- По умолчанию функция [повторной попытки на стороне сервера (SSR)](prevent-rate-limiting-errors.md) включена, поэтому запросы от клиентского приложения не будут возвращать ошибки 16500. Вместо этого запросы будут возобновлены до завершения или истечения времени ожидания (60 секунд).
- Время ожидания каждого запроса составляет 60 секунд.
- В коллекциях MongoDB, создаваемых в новой версии протокола коммуникации, будет по умолчанию индексироваться только свойство `_id`.

### <a name="action-required-when-upgrading-from-32"></a>Действия, необходимые при обновлении с версии 3.2

При обновлении с версии 3.2 суффикс конечной точки учетной записи базы данных будет иметь следующий формат:

```
<your_database_account_name>.mongo.cosmos.azure.com
```

При обновлении с версии 3,2 необходимо заменить существующую конечную точку в приложениях и драйверах, которые подключаются к этой учетной записи базы данных. **Только подключения, использующие новую конечную точку, будут иметь доступ к функциям новой версии API**. Предыдущая конечная точка версии 3.2 должна иметь суффикс `.documents.azure.com`.

>[!Note]
> Эта конечная точка может иметь небольшие отличия, если ваша учетная запись была создана в независимых, правительственном или в облаке Azure с ограниченным доступом.

## <a name="how-to-upgrade"></a>Обновление

1. Войдите в [портал Azure.](https://portal.azure.com/)

1. Перейдите к Azure Cosmos DB API для учетной записи MongoDB. Откройте панель " **Обзор** " и убедитесь, что текущая **версия сервера** — 3,2 или 3,6.

    :::image type="content" source="./media/mongodb-version-upgrade/check-current-version.png" alt-text="Проверьте текущую версию учетной записи MongoDB из портал Azure." border="true":::

1. В меню слева откройте `Features` панель. В этой области отображаются функции уровня учетной записи, доступные для вашей учетной записи базы данных.

1. Выберите строку `Upgrade MongoDB server version`. Если этот параметр не отображается, для вашей учетной записи может быть недоступно это обновление. Если это так, отправьте запрос [в службу поддержки](https://portal.azure.com/?#blade/Microsoft_Azure_Support/HelpAndSupportBlade) .

    :::image type="content" source="./media/mongodb-version-upgrade/upgrade-server-version.png" alt-text="Откройте колонку функции и обновите учетную запись." border="true":::

1. Ознакомьтесь со сведениями об обновлении. Выберите `Set server version to 4.0` (или 3,6 в зависимости от текущей версии).

    :::image type="content" source="./media/mongodb-version-upgrade/select-upgrade.png" alt-text="Ознакомьтесь с руководством по обновлению и выберите Обновить." border="true":::

1. После начала обновления меню **функции** становится неактивным и состояние имеет значение *Ожидание*. Выполнение обновления занимает около 15 минут. Этот процесс не влияет на существующие функции или операции учетной записи базы данных. После завершения **обновления состояние версии сервера MongoDB** отобразит обновленную версию. Если при обработке запроса возникла ошибка, [обратитесь в службу поддержки](https://azure.microsoft.com/en-us/support/create-ticket/) .

1. Ниже приведены некоторые рекомендации после обновления учетной записи.

    1. Если вы обновили с версии 3,2, вернитесь на панель " **Обзор** " и скопируйте новую строку подключения для использования в приложении. Работа старой строки подключения версии 3.2 не будет прервана. Для обеспечения оптимизированной среды все приложения должны использовать новую конечную точку.

    1. Если вы выполнили обновление с версии 3.6, существующая строка подключения будет обновлена до указанного уровня и ее можно продолжать использовать.

## <a name="how-to-downgrade"></a>Как перейти на использование более ранней версии

Вы также можете понизить уровень учетной записи с 4,0 до 3,6, выполнив те же действия, что и в разделе "обновление".

Если вы обновили с 3,2 на (4,0 или 3,6) и хотите перейти на более раннюю версию до 3,2, можно просто вернуться к использованию предыдущей строки подключения (3,2) с узлом, `accountname.documents.azure.com` который остается активным после обновления, работающего под управлением версии 3,2.

## <a name="next-steps"></a>Дальнейшие действия

- Сведения о поддерживаемых и неподдерживаемых [функциях MongoDB версии 4.0](mongodb-feature-support-40.md).
- Сведения о поддерживаемых и неподдерживаемых [функциях MongoDB версии 3.6](mongodb-feature-support-36.md).
- Дополнительные сведения см. в статье о [функциях в версии Mongo 3.6](https://devblogs.microsoft.com/cosmosdb/azure-cosmos-dbs-api-for-mongodb-now-supports-server-version-3-6/).
