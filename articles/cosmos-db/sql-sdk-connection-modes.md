---
title: Azure Cosmos DB режимы подключения пакета SDK SQL
description: Узнайте о различных режимах подключения, доступных в Azure Cosmos DB пакетах SDK для SQL.
author: ealsur
ms.service: cosmos-db
ms.subservice: cosmosdb-sql
ms.topic: how-to
ms.date: 10/14/2020
ms.author: maquaran
ms.custom: devx-track-dotnet, contperf-fy21q2
ms.openlocfilehash: cf985999bac0cf45eec5d8f0f5f9e921b6f4591c
ms.sourcegitcommit: 910a1a38711966cb171050db245fc3b22abc8c5f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "97934957"
---
# <a name="azure-cosmos-db-sql-sdk-connectivity-modes"></a>Azure Cosmos DB режимы подключения пакета SDK SQL
[!INCLUDE[appliesto-sql-api](includes/appliesto-sql-api.md)]

Способ подключения клиента к Azure Cosmos DB имеет важное влияние на производительность, особенно для наблюдаемой задержки на стороне клиента. Azure Cosmos DB предлагает простую, открытую модель программирования RESTFUL по протоколу HTTPS, называемую режимом шлюза. Кроме того, он предлагает эффективный протокол TCP, который также находится в модели взаимодействия и использует TLS для первоначальной проверки подлинности и шифрования трафика, называемого прямым режимом.

## <a name="available-connectivity-modes"></a>Доступные режимы подключения

Доступны два режима подключения:

  * Режим шлюза
      
    Режим шлюза поддерживается на всех платформах SDK. Если приложение работает в корпоративной сети с ограниченными ограничениями брандмауэра, лучшим выбором является режим шлюза, так как он использует стандартный HTTPS-порт и одну конечную точку DNS. Однако компромисс производительности заключается в том, что режим шлюза включает дополнительный прыжок по сети при каждом считывании или записи данных в Azure Cosmos DB. Также рекомендуется использовать режим подключения шлюза при запуске приложений в средах с ограниченным числом подключений к сокету.

    При использовании пакета SDK в функциях Azure, особенно в [плане потребления](../azure-functions/consumption-plan.md), следует учитывать текущие [ограничения на подключения](../azure-functions/manage-connections.md).

  * Режим прямого подключения

    Режим Direct поддерживает подключение по протоколу TCP и обеспечивает лучшую производительность, поскольку уменьшается число прыжков сети. Приложение подключается непосредственно к серверным репликам. В настоящее время режим Direct поддерживается только на платформах SDK .NET и Java.
     
:::image type="content" source="./media/performance-tips/connection-policy.png" alt-text="Режимы подключения Azure Cosmos DB" border="false":::

Эти режимы подключения, по сути, являются условием маршрутизации запросов к плоскости данных — чтения и записи документа — от клиентского компьютера до секций в серверной части Azure Cosmos DB. Режим Direct является предпочтительным вариантом для лучшей производительности. он позволяет клиенту открывать подключения TCP непосредственно к секциям в Azure Cosmos DB серверных *запросов и передавать запросы напрямую ly* без посредников. Напротив, в режиме шлюза запросы, выполняемые клиентом, направляются на так называемый "шлюз" сервер в интерфейсе Azure Cosmos DB, который, в свою очередь, позволяет уменьшить количество запросов к соответствующим секциям в Azure Cosmos DB серверной части.

## <a name="service-port-ranges"></a>Диапазоны портов службы

При использовании прямого режима в дополнение к портам шлюза необходимо убедиться, что диапазон портов 10000 и 20000 открыт, так как Azure Cosmos DB использует динамические TCP-порты. При использовании прямого режима для [частных конечных точек](./how-to-configure-private-endpoints.md)весь диапазон TCP-портов — от 0 до 65535 должен быть открыт. Если эти порты не открыты и вы пытаетесь использовать протокол TCP, может появиться сообщение об ошибке "служба 503 недоступна".

В следующей таблице показана сводка режимов подключения, доступных для различных интерфейсов API, и портов служб, используемых для каждого API:

|Режим подключения  |Поддерживаемый протокол  |Поддерживаемые пакеты SDK  |API и порт службы  |
|---------|---------|---------|---------|
|Шлюз  |   HTTPS    |  Все пакеты SDK    |   SQL (443), MongoDB (10250, 10255, 10256), таблица (443), Cassandra (10350), Graph (443) <br> Порт 10250 сопоставляется с Azure Cosmos DB API по умолчанию для экземпляра MongoDB без георепликации. В то время как порты 10255 и 10256 сопоставляются с экземпляром с георепликацией.   |
|Прямой доступ    |     TCP    |  ПАКЕТ SDK для Java пакета SDK для .NET    | При использовании общедоступной конечной точки или конечных точек службы: порты в диапазоне от 10000 до 20000<br>При использовании частных конечных точек: порты в диапазоне от 0 до 65535 |

## <a name="next-steps"></a>Дальнейшие действия

Для конкретных оптимизаций производительности платформы SDK:

* [Советы по повышению производительности пакета SDK для .NET v2](performance-tips.md)

* [Советы по повышению производительности пакета SDK для .NET v3](performance-tips-dotnet-sdk-v3-sql.md)
 
* [Советы по повышению производительности пакета SDK для Java v4](performance-tips-java-sdk-v4-sql.md)