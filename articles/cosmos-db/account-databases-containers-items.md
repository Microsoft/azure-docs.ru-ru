---
title: Модель ресурсов Azure Cosmos DB
description: В этой статье описывается модель ресурсов Azure Cosmos DB, которая включает в себя учетную запись Azure Cosmos, базу данных, контейнер и элементы. Он также охватывает иерархию этих элементов в учетной записи Azure Cosmos.
author: markjbrown
ms.author: mjbrown
ms.service: cosmos-db
ms.topic: conceptual
ms.date: 10/12/2020
ms.reviewer: sngun
ms.openlocfilehash: 4ed881b74f240946d98d9868344c898d3e9a9dad
ms.sourcegitcommit: 59cfed657839f41c36ccdf7dc2bee4535c920dd4
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/06/2021
ms.locfileid: "99627354"
---
# <a name="azure-cosmos-db-resource-model"></a>Модель ресурсов Azure Cosmos DB
[!INCLUDE[appliesto-all-apis](includes/appliesto-all-apis.md)]

Azure Cosmos DB — это полностью управляемая платформа как услуга (PaaS). Чтобы начать работу с Azure Cosmos DB, сначала создайте учетную запись Azure Cosmos в подписке Azure и базах данных, контейнерах и элементах. В этой статье описывается модель ресурсов Azure Cosmos DB и различные сущности в иерархии модели ресурсов.

Учетная запись Azure Cosmos — это основная единица глобального распределения и высокого уровня доступности. Учетная запись Azure Cosmos содержит уникальное DNS-имя, и вы можете управлять учетной записью с помощью портал Azure или Azure CLI или с помощью различных пакетов SDK для конкретного языка. Дополнительные сведения см. в статье [об управлении учетной записью Azure Cosmos](how-to-manage-database-account.md). Для глобального распределения данных и пропускной способности в нескольких регионах Azure вы можете в любое время добавлять и удалять регионы Azure в своей учетной записи. Можно настроить учетную запись для одного региона или нескольких регионов записи. Дополнительные сведения см. в статье [Добавление и удаление регионов Azure в учетной записи](how-to-manage-database-account.md). Можно настроить уровень [согласованности по умолчанию](consistency-levels.md) для учетной записи.

## <a name="elements-in-an-azure-cosmos-account"></a>Элементы в учетной записи Azure Cosmos

Контейнер Azure Cosmos — это фундаментальная единица масштабируемости. В контейнере у вас может быть практически неограниченная пропускная способность (ЕЗ/с) и ресурсы хранения. Azure Cosmos DB прозрачно разделяет контейнеры с помощью указанного ключа логической секции, чтобы эластично масштабировать подготовленную пропускную способность и ресурсы хранения.

Сейчас вы можете создать не более 50 учетных записей Azure Cosmos в подписке Azure (это мягкое ограничение, которое можно увеличить с помощью запроса на поддержку). Одна учетная запись Azure Cosmos может практически управлять неограниченным объемом данных и подготовленной пропускной способностью. Для управления данными и подготовленной пропускной способностью можно создать одну или несколько баз данных Azure Cosmos в учетной записи, а в рамках базы данных создать один или несколько контейнеров. Ниже показана иерархия разных элементов в учетной записи Azure Cosmos:

:::image type="content" source="./media/account-databases-containers-items/hierarchy.png" alt-text="Иерархия учетной записи Azure Cosmos" border="false":::

После создания учетной записи в подписке Azure вы можете управлять данными в своей учетной записи, создавая базы данных, контейнеры и элементы. 

На следующем рисунке показана иерархия различных сущностей в учетной записи Azure Cosmos DB.

:::image type="content" source="./media/account-databases-containers-items/cosmos-entities.png" alt-text="Сущности учетной записи Azure Cosmos" border="false":::

## <a name="azure-cosmos-databases"></a>базы данных Azure Cosmos.

В своей учетной записи можно создать одну или несколько баз данных Azure Cosmos. База данных аналогична пространству имен. База данных — это единица управления для набора контейнеров Azure Cosmos. В следующей таблице показано, как база данных сопоставляется с различными сущностями, зависящими от API.

| Сущность Azure Cosmos DB | API SQL | API Cassandra | API Azure Cosmos DB для MongoDB | API Gremlin | API таблиц |
| --- | --- | --- | --- | --- | --- |
|База данных Azure Cosmos | База данных | Пространство ключей | База данных | База данных | Н/Д |

> [!NOTE]
> При использовании учетных записей API таблиц при создании первой таблицы база данных по умолчанию автоматически создается в учетной записи Azure Cosmos.

### <a name="operations-on-an-azure-cosmos-database"></a>Операции с базой данных Azure Cosmos

Вы можете взаимодействовать с базой данных Azure Cosmos с помощью API-интерфейсов Azure Cosmos, как описано в следующей таблице.

| Операция | Azure CLI | API SQL | API Cassandra | API Azure Cosmos DB для MongoDB | API Gremlin | API таблиц |
| --- | --- | --- | --- | --- | --- | --- |
|Перечисление всех баз данных| Да | Да | Да (база данных соответствует пространству имен) | Да | Н/Д | Н/Д |
|Чтение базы данных| Да | Да | Да (база данных соответствует пространству имен) | Да | Н/Д | Н/Д |
|Создание базы данных| Да | Да | Да (база данных соответствует пространству имен) | Да | Н/Д | Н/Д |
|Обновление базы данных| Да | Да | Да (база данных соответствует пространству имен) | Да | Н/Д | Н/Д |

## <a name="azure-cosmos-containers"></a>Контейнеры Azure Cosmos

Контейнер Cosmos для Azure — это единица масштабируемости для подготовленной пропускной способности и хранилища. Контейнер горизонтально секционируется и затем реплицируются между несколькими регионами. Элементы, добавляемые в контейнер, автоматически группируются в логические секции, которые распределяются по физическим секциям на основе ключа секции. Пропускная способность контейнера равномерно распределяется по физическим секциям. Дополнительные сведения о секционировании и ключах секций см. в разделе [данные секции](partitioning-overview.md). 

При создании контейнера пропускная способность настраивается в одном из следующих режимов:

* **Выделенный режим пропускной способности**. пропускная способность, подготовленная в контейнере, зарезервирована для этого контейнера и поддерживается соглашением об уровне обслуживания. Дополнительные сведения см. в статье [как подготавливать пропускную способность в контейнере](how-to-provision-container-throughput.md).

* **Общий режим подготовленной пропускной способности**. Эти контейнеры совместно используют подготовленную пропускную способность с другими контейнерами в той же базе данных (за исключением контейнеров, настроенных с выделенной подготовленной пропускной способностью). Иными словами, подготовленная пропускная способность для базы данных является общей для всех контейнеров "Общая пропускная способность". Дополнительные сведения см. в разделе [как подготавливать пропускную способность для базы данных](how-to-provision-database-throughput.md).

> [!NOTE]
> Общую и выделенную пропускную способность можно настроить только при создании базы данных и контейнера. Чтобы переключиться из режима выделенной пропускной способности в режим общей пропускной способности (и наоборот) после создания контейнера, необходимо создать контейнер и перенести данные в новый контейнер. Данные можно перенести с помощью функции веб-канала изменения Azure Cosmos DB.

Контейнер Azure Cosmos может гибко масштабироваться независимо от того, создаются ли контейнеры с помощью выделенных или общих режимов подготовленной пропускной способности.

Контейнер — это контейнер элементов, не зависящий от схемы. Элементы в контейнере могут иметь произвольные схемы. Например, элемент, представляющий человека и элемент, представляющий автомобиль, может быть помещен в один и тот *же контейнер*. По умолчанию все элементы, добавляемые в контейнер, автоматически индексируются без необходимости явного управления индексами или схемой. Поведение индексирования можно настроить, настроив [политику индексирования](index-overview.md) для контейнера. 

Можно задать срок жизни [(TTL)](time-to-live.md) для выбранных элементов в контейнере или для всего контейнера, чтобы корректно удалить эти элементы из системы. Azure Cosmos DB автоматически удаляет элементы по истечении срока их действия. Также гарантируется, что запрос, выполняемый в контейнере, не возвращает элементы с истекшим сроком действия в фиксированной границе. Дополнительные сведения см. в статье [Настройка TTL для контейнера](how-to-time-to-live.md).

[Веб-канал изменений](change-feed.md) можно использовать для подписки на журнал операций, который управляется для каждого логического раздела контейнера. Веб-канал изменений предоставляет журнал всех обновлений, выполненных в контейнере, вместе с образами элементов до и после. Дополнительные сведения см. в разделе [Построение реактивных приложений с помощью веб-канала изменений](serverless-computing-database.md). Длительность хранения для веб-канала изменений также можно настроить с помощью политики веб-канала изменений в контейнере.

Можно зарегистрировать [хранимые процедуры, триггеры, определяемые пользователем функции](stored-procedures-triggers-udfs.md)и [процедуры слияния](how-to-manage-conflicts.md) для контейнера.

Можно указать [ограничение уникального ключа](unique-keys.md) в контейнере Azure Cosmos. Создавая политику уникальных ключей, вы гарантируете уникальность одного или нескольких значений ключа логической секции. Если контейнер создается с помощью политики уникального ключа, можно создать новые или обновленные элементы со значениями, которые дублируют значения, указанные ограничением уникального ключа. См. дополнительные сведения об [ограничениях уникальных ключей](unique-keys.md).

Контейнер является специализированным для сущностей, зависящих от API, как показано в следующей таблице.

| Сущность Azure Cosmos DB | API SQL | API Cassandra | API Azure Cosmos DB для MongoDB | API Gremlin | API таблиц |
| --- | --- | --- | --- | --- | --- |
|Контейнер Azure Cosmos | Контейнер | Таблица | Коллекция | График | Таблица |

> [!NOTE]
> При создании контейнеров следите за тем, чтобы не создать два контейнера с одинаковыми именами, но в разных регистрах. Причина в том, что некоторые компоненты платформы Azure не учитывают регистр. Это может привести к путанице или конфликтам в данных телеметрии и действиях с контейнерами с такими именами.

### <a name="properties-of-an-azure-cosmos-container"></a>Свойства контейнера Azure Cosmos

Контейнер Cosmos для Azure имеет набор системных свойств. В зависимости от используемого API некоторые свойства могут быть не предоставлены напрямую. В следующей таблице приводится описание списка системных свойств.

| Свойство, определяемое системой | Формируемый системой или настраиваемый пользователем | Назначение | API SQL | API Cassandra | API Azure Cosmos DB для MongoDB | API Gremlin | API таблиц |
| --- | --- | --- | --- | --- | --- | --- | --- |
|\_избежать | Создано системой | Уникальный идентификатор контейнера. | Да | Нет | Нет | Нет | Нет |
|\_тегом | Создано системой | Тег сущности, используемый для управления оптимистической блокировкой. | Да | Нет | Нет | Нет | Нет |
|\_лицензии | Создано системой | Метка времени последнего обновления контейнера. | Да | Нет | Нет | Нет | Нет |
|\_самообслуживания | Создано системой | Адресуемый URI контейнера. | Да | Нет | Нет | Нет | Нет |
|идентификатор | Настраиваемый пользователем | Определяемое пользователем уникальное имя контейнера. | Да | Да | Да | Да | Да |
|indexingPolicy | Настраиваемый пользователем | Предоставляет возможность изменения пути индекса, типа индекса и режима индекса. | Да | Нет | Нет | Нет | Да |
|timeToLive | Настраиваемый пользователем | Предоставляет возможность автоматического удаления элементов из контейнера по истечении заданного периода времени. Дополнительные сведения см. [в разделе время жизни](time-to-live.md). | Да | Нет | Нет | Нет | Да |
|changeFeedPolicy | Настраиваемый пользователем | Используется для считывания изменений, внесенных в элементы в контейнере. Дополнительные сведения см. в разделе [веб-канал изменений](change-feed.md). | Да | Нет | Нет | Нет | Да |
|uniqueKeyPolicy | Настраиваемый пользователем | Используется для обеспечения уникальности одного или нескольких значений в логической секции. Дополнительные сведения см. в разделе [ограничения уникального ключа](unique-keys.md). | Да | Нет | Нет | Нет | Да |

### <a name="operations-on-an-azure-cosmos-container"></a>Операции с контейнером Azure Cosmos

Контейнер Azure Cosmos поддерживает следующие операции при использовании любого из API-интерфейсов Azure Cosmos.

| Операция | Azure CLI | API SQL | API Cassandra | API Azure Cosmos DB для MongoDB | API Gremlin | API таблиц |
| --- | --- | --- | --- | --- | --- | --- |
| Перечисление контейнеров в базе данных | Да | Да | Да | Да | Н/Д | Н/Д |
| Считывание контейнера | Да | Да | Да | Да | Н/Д | Н/Д |
| Создает контейнер. | Да | Да | Да | Да | Н/Д | Н/Д |
| Обновление контейнера | Да | Да | Да | Да | Н/Д | Н/Д |
| Удаление контейнера | Да | Да | Да | Да | Н/Д | Н/Д |

## <a name="azure-cosmos-items"></a>Элементы Azure Cosmos

В зависимости от используемого API элемент Azure Cosmos может представлять документ в коллекции, строку в таблице или узел (ребро) в графе. В следующей таблице показано сопоставление сущностей, относящихся к API, с элементом Cosmos Azure.

| Сущность Azure Cosmos DB | API SQL | API Cassandra | API Azure Cosmos DB для MongoDB | API Gremlin | API таблиц |
| --- | --- | --- | --- | --- | --- |
|Элемент Azure Cosmos | Компонент | Строка | Документ | Узел или ребро | Компонент |

### <a name="properties-of-an-item"></a>Свойства элемента

Каждый элемент Cosmos в Azure имеет следующие определяемые системой свойства. В зависимости от используемого API некоторые из них могут быть не предоставлены напрямую.

| Свойство, определяемое системой | Формируемый системой или настраиваемый пользователем| Назначение | API SQL | API Cassandra | API Azure Cosmos DB для MongoDB | API Gremlin | API таблиц |
| --- | --- | --- | --- | --- | --- | --- | --- |
|\_избежать | Создано системой | Уникальный идентификатор элемента | Да | Нет | Нет | Нет | Нет |
|\_тегом | Создано системой | Тег сущности, используемый для управления оптимистической блокировкой. | Да | Нет | Нет | Нет | Нет |
|\_лицензии | Создано системой | Метка времени последнего обновления элемента | Да | Нет | Нет | Нет | Нет |
|\_самообслуживания | Создано системой | Адресуемый URI элемента. | Да | Нет | Нет | Нет | Нет |
|идентификатор | Можно использовать | Определяемое пользователем уникальное имя в логической секции. | Да | Да | Да | Да | Да |
|Определяемые пользователем свойства | Определяемые пользователем маршруты | Определяемые пользователем свойства, представленные в собственном представлении API (включая JSON, BSON и CQL) | Да | Да | Да | Да | Да |

> [!NOTE]
> Уникальность свойства применяется `id` только в пределах каждой логической секции. Несколько документов могут иметь одно и то же `id` свойство с разными значениями ключа секции.

### <a name="operations-on-items"></a>Операции с элементами

Элементы Azure Cosmos поддерживают следующие операции. Для выполнения операций можно использовать любой из интерфейсов API Azure Cosmos.

| Операция | Azure CLI | API SQL | API Cassandra | API Azure Cosmos DB для MongoDB | API Gremlin | API таблиц |
| --- | --- | --- | --- | --- | --- | --- |
| Вставка, замена, удаление, обновление или вставка, чтение | Нет | Да | Да | Да | Да | Да |

## <a name="next-steps"></a>Дальнейшие действия

Узнайте, как управлять учетной записью Azure Cosmos и другими концепциями:

* [Управление учетными записями базы данных в Azure Cosmos DB](how-to-manage-database-account.md)
* [Глобальное распределение](distribute-data-globally.md)
* [Уровни согласованности](consistency-levels.md)
* [Безопасный доступ к учетной записи Azure Cosmos DB с использованием конечной точки службы виртуальной сети Azure](how-to-configure-vnet-service-endpoint.md)
* [Поддержка брандмауэра для Azure Cosmos DB](how-to-configure-firewall.md)
* [Добавление и удаление регионов из учетной записи базы данных](how-to-manage-database-account.md)
* [Соглашение об уровне обслуживания для Azure Cosmos DB](https://azure.microsoft.com/support/legal/sla/cosmos-db/v1_2/)
