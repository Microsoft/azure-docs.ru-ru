---
title: Планирование и управление затратами для Azure Cosmos DB
description: Узнайте, как планировать и управлять затратами на Azure Cosmos DB с помощью анализа затрат в портал Azure.
author: SnehaGunda
ms.author: sngun
ms.custom: subject-cost-optimization
ms.service: cosmos-db
ms.topic: conceptual
ms.date: 11/19/2020
ms.openlocfilehash: 07e165382608f4fde5433de0f4436cb86f5083af
ms.sourcegitcommit: 25d1d5eb0329c14367621924e1da19af0a99acf1
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/16/2021
ms.locfileid: "98251902"
---
# <a name="plan-and-manage-costs-for-azure-cosmos-db"></a>Планирование и управление затратами для Azure Cosmos DB
[!INCLUDE[appliesto-all-apis](includes/appliesto-all-apis.md)]

В этой статье описывается планирование и управление затратами для Azure Cosmos DB. Сначала используйте калькулятор емкости Azure Cosmos DB, чтобы оценить затраты на рабочую нагрузку перед созданием ресурсов. Позже вы сможете ознакомиться с оценочными затратами и приступить к созданию ресурсов.

После начала работы с Azure Cosmos DB ресурсами используйте функции управления затратами для установки бюджетов и отслеживания затрат. Вы также можете просматривать прогнозные затраты и выявление тенденций расходов для выявления областей, в которых может потребоваться выполнить действия. Затраты на Azure Cosmos DB — это только часть ежемесячных затрат в счете Azure. Несмотря на то, что в этой статье объясняется, как спланировать затраты для Azure Cosmos DB и управлять ими, вы оплачиваете все службы и ресурсы Azure, используемые в вашей подписке Azure, включая сторонние службы.

## <a name="prerequisites"></a>Предварительные требования

### <a name="provisioned-throughput-or-serverless"></a>Подготовленная пропускная способность или бессерверная

Azure Cosmos DB поддерживает два типа режимов емкости: [подготовленная пропускная способность](set-throughput.md) и [бессерверные](serverless.md). Способ оплаты за использование Azure Cosmos DB зависит от множества этих двух режимов, поэтому важно выбрать тот, который лучше всего подходит для вашей рабочей нагрузки. Инструкции и рекомендации по выбору см. в статье [Выбор между подготовленной пропускной способностью и бессерверной](throughput-serverless.md) статьей.

### <a name="cost-analysis"></a>Анализ затрат

Анализ затрат в службе "Управление затратами" поддерживает большинство типов учетных записей Azure, но не все из них. Полный список поддерживаемых типов учетных записей см. в статье [Understand Cost Management data](../cost-management-billing/costs/understand-cost-mgt-data.md?WT.mc_id=costmanagementcontent_docsacmhorizontal_-inproduct-learn) (Интерпретация данных службы "Управление затратами"). Для просмотра данных о затратах требуется по крайней мере доступ на чтение для учетной записи Azure. Дополнительные сведения о назначении доступа к данным службы "Управление затратами" Azure см. в [этой статье](../cost-management-billing/costs/assign-access-acm-data.md?WT.mc_id=costmanagementcontent_docsacmhorizontal_-inproduct-learn).

## <a name="estimating-provisioned-throughput-costs-before-using-azure-cosmos-db"></a>Оценка подготовленных затрат пропускной способности перед использованием Azure Cosmos DB

Если вы планируете использовать Azure Cosmos DB в режиме подготовленной пропускной способности, используйте [Калькулятор емкости Azure Cosmos DB](https://cosmos.azure.com/capacitycalculator/) , чтобы оценить затраты перед созданием ресурсов в учетной записи Azure Cosmos. Калькулятор емкости используется для оценки необходимой пропускной способности и стоимости рабочей нагрузки. Настройка баз данных и контейнеров Azure Cosmos с правильным объемом подготовленной пропускной способности или [единиц запроса (единицы запросов в секунду)](request-units.md)для вашей рабочей нагрузки очень важно для оптимизации затрат и производительности. Необходимо ввести такие сведения, как тип API, число регионов, размер элемента, количество запросов на чтение и запись в секунду, общий объем сохраненных данных для получения оценки затрат. Дополнительные сведения о калькуляторе емкости см. в статье об [оценке](estimate-ru-with-capacity-planner.md) .

На следующем снимке экрана показана пропускная способность и оценка затрат с помощью калькулятора емкости:

:::image type="content" source="./media/plan-manage-costs/capacity-calculator-cost-estimate.png" alt-text="Оценка затрат в калькуляторе Azure Cosmos DBной емкости":::

## <a name="estimating-serverless-costs-before-using-azure-cosmos-db"></a><a id="estimating-serverless-costs"></a> Оценка бессерверных затрат перед использованием Azure Cosmos DB

Если вы планируете использовать Azure Cosmos DB в бессерверном режиме, необходимо оценить количество [единиц запросов](request-units.md) и ГБ хранилища, которые можно использовать ежемесячно. Вы можете оценить требуемый объем единиц запросов, оценивая количество операций с базой данных, которые выдаются в течение месяца, и умножьте их на соответствующие затраты на ЕДИНИЦу. В следующей таблице перечислены приблизительные выплаты за ЕДИНИЦу для распространенных операций с базой данных.

| Операция | Расчетные затраты | Примечания |
| --- | --- | --- |
| Создание элемента | 5 ЕЗ | Средняя стоимость для элемента с 1 КБ и меньше 5 свойств для индекса |
| Обновление элемента | 10 ЕЗ | Средняя стоимость для элемента с 1 КБ и меньше 5 свойств для индекса |
| Чтение отдельного элемента по его ИДЕНТИФИКАТОРу и ключу раздела (точка-чтение) | 1 ЕЗ | Средняя стоимость для элемента с 1 КБ |
| Удаление элемента | 5 ЕЗ | |
| Выполнение запроса | 10 ЕЗ | Средняя стоимость запроса, которая использует все преимущества [индексирования](index-overview.md) и возвращает 100 результатов или меньше |

> [!IMPORTANT] 
> Обратите внимание на примечания из приведенной выше таблицы. Для более точной оценки фактических затрат на операции можно использовать [эмулятор Azure Cosmos DB](local-emulator.md) и [оценить стоимость операций](find-request-unit-charge.md)в единицах. Хотя эмулятор Azure Cosmos DB не поддерживает бессерверную работу, он сообщает о стандартной ЕДИНИЦе оплаты за операции базы данных и может использоваться для этой оценки.

После вычисления общего числа единиц запросов и ГБ хранилища, которые, скорее всего, будут использоваться в течение месяца, следующая формула вернет оценку стоимости: **([число единиц запросов]/1 000 000 * $0,25) + ([ГБ хранилища] * $0,25)**.

> [!NOTE]
> Стоимость, показанная в предыдущем примере, используется только в демонстрационных целях. Последние сведения о ценах см. на [странице с ценами](https://azure.microsoft.com/pricing/details/cosmos-db/) .

## <a name="review-estimated-costs-in-the-azure-portal"></a>Просмотр предполагаемых затрат на портале Azure

Когда вы начинаете использовать Azure Cosmos DB ресурсы из портал Azure, можно увидеть оценочные затраты. Чтобы ознакомиться с оценкой затрат, выполните следующие действия.

1. Войдите в портал Azure и перейдите к своей учетной записи Azure Cosmos.
1. Перейдите к разделу **Обзор** .
1. Проверьте диаграмму **затрат** внизу. На этой диаграмме показана оценка текущих затрат за настраиваемый период времени:
1. Создание нового контейнера, например контейнера графа.
1. Введите пропускную способность, необходимую для рабочей нагрузки, например 400 единиц запросов в секунду. После ввода значения пропускной способности можно увидеть оценку цены, как показано на следующем снимке экрана:

   :::image type="content" source="./media/plan-manage-costs/cost-estimate-portal.png" alt-text="Оценка затрат в портал Azure":::

Если у вашей подписки Azure есть предельная сумма расходов, Azure не позволит вам тратить деньги на сумму кредита. При создании и использовании ресурсов Azure используются ваши кредиты. При достижении лимита кредита развернутые ресурсы отключаются в оставшейся части этого расчетного периода. Вы не можете изменить лимит кредита, но можете удалить его. Дополнительные сведения об ограничениях расходов см. в статье [предельная сумма расходов в Azure](../cost-management-billing/manage/spending-limit.md?WT.mc_id=costmanagementcontent_docsacmhorizontal_-inproduct-learn).

Вы можете платить за Azure Cosmos DB оплаты с помощью Azure Соглашение Enterprise денежных обязательств по кредиту. Однако вы не можете использовать денежные обязательства кредита для оплаты за продукты и услуги третьих лиц, включая данные из Azure Marketplace.

## <a name="monitor-costs"></a>Мониторинг затрат

При использовании ресурсов с Azure Cosmos DB взимается плата. Затраты на единицы использования ресурсов зависят от временных интервалов (секунды, минуты, часы и дни) или использования единиц запросов. После начала использования Azure Cosmos DB затраты изменяются, и их можно увидеть на панели [анализ затрат](../cost-management-billing/costs/quick-acm-cost-analysis.md?WT.mc_id=costmanagementcontent_docsacmhorizontal_-inproduct-learn) в портал Azure.

При использовании анализа затрат можно просматривать Azure Cosmos DBные затраты в диаграммах и таблицах для различных временных интервалов. Некоторые примеры относятся к дню, текущему, предыдущему месяцу и году. Вы также можете просматривать затраты по бюджету и прогнозируемым затратам. Переключение на более длительные представления с течением времени может помочь определить тенденции расходов и узнать, где могла произойти чрезмерное расходование. Если вы создали бюджеты, вы также сможете легко увидеть, где они превышаются. 

Просмотр Azure Cosmos DB затрат в анализе затрат:

1. Войдите на [портал Azure](https://portal.azure.com).

1. Откройте область в портал Azure и выберите **анализ затрат** в меню. Например, перейдите к разделу **подписки**, выберите подписку из списка, а затем в меню выберите  **анализ затрат** . Выберите **область** , чтобы переключиться на другую область в анализе затрат.

1. По умолчанию стоимость всех служб показана на первой кольцевой диаграмме. Выберите область диаграммы с меткой "Azure Cosmos DB".

1. Чтобы уменьшить затраты на одну службу, например Azure Cosmos DB, щелкните **Добавить фильтр** , а затем выберите **имя службы**. Затем выберите **Azure Cosmos DB** из списка. Ниже приведен пример, показывающий затраты только на Azure Cosmos DB:
 
   :::image type="content" source="./media/plan-manage-costs/cost-analysis-pane.png" alt-text="Мониторинг затрат с помощью панели &quot;анализ затрат&quot;":::

В предыдущем примере отображаются текущие затраты на Azure Cosmos DB для месяца февраля. Диаграммы также содержат Azure Cosmos DB затраты по расположению и группе ресурсов.

## <a name="create-budgets"></a>Создание бюджетов

Вы можете создавать [бюджеты](../cost-management-billing/costs/tutorial-acm-create-budgets.md?WT.mc_id=costmanagementcontent_docsacmhorizontal_-inproduct-learn) для управления затратами и создавать [оповещения](../cost-management-billing/costs/cost-mgt-alerts-monitor-usage-spending.md?WT.mc_id=costmanagementcontent_docsacmhorizontal_-inproduct-learn) , которые автоматически уведомляют заинтересованных лиц о трате аномалий и чрезмерной трате рисков. Оповещения основываются на расходах по сравнению с пороговыми значениями бюджета и затрат. Бюджеты и оповещения создаются для подписок Azure и групп ресурсов, поэтому они полезны в рамках общей стратегии мониторинга затрат. 

Бюджеты можно создавать с помощью фильтров для конкретных ресурсов или служб в Azure, если требуется дополнительная детализация в мониторинге. Фильтры помогают предотвратить случайное создание новых ресурсов, которые избавляет вас от дополнительных денег. Дополнительные сведения о параметрах фильтра при создании бюджета см. в разделе [Параметры группы и фильтра](../cost-management-billing/costs/group-filter.md?WT.mc_id=costmanagementcontent_docsacmhorizontal_-inproduct-learn).

## <a name="export-cost-data"></a>Экспорт данных о затратах

Вы также можете [экспортировать данные о затратах](../cost-management-billing/costs/tutorial-export-acm-data.md?WT.mc_id=costmanagementcontent_docsacmhorizontal_-inproduct-learn) в учетную запись хранения. Это полезно, если вам или другим пользователям требуется выполнить дополнительный анализ данных за затраты. Например, финансовые группы могут анализировать данные с помощью Excel или Power BI. Вы можете экспортировать затраты на ежедневное, еженедельное или ежемесячное расписание и задать настраиваемый диапазон дат. Для извлечения наборов данных о затратах рекомендуется экспортировать данные о затратах.

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения о том, как работают цены в Azure Cosmos DB, см. в следующих статьях:

* [Модели ценообразования в Azure Cosmos DB](how-pricing-works.md)
* [Optimize provisioned throughput cost in Azure Cosmos DB](optimize-cost-throughput.md) (Оптимизация стоимости подготовленной пропускной способности в Azure Cosmos DB)
* [Optimize query cost in Azure Cosmos DB](./optimize-cost-reads-writes.md) (Оптимизация затрат на отправку запросов в Azure Cosmos DB)
* [Оптимизация затрат на хранение в Azure Cosmos DB](optimize-cost-storage.md)
* Узнайте [, как оптимизировать инвестиции в облако с помощью службы "Управление затратами Azure](../cost-management-billing/costs/cost-mgt-best-practices.md?WT.mc_id=costmanagementcontent_docsacmhorizontal_-inproduct-learn)".
* Дополнительные сведения об управлении затратами с помощью [анализа затрат](../cost-management-billing/costs/quick-acm-cost-analysis.md?WT.mc_id=costmanagementcontent_docsacmhorizontal_-inproduct-learn).
* Узнайте, как [предотвратить непредвиденные затраты](../cost-management-billing/cost-management-billing-overview.md?WT.mc_id=costmanagementcontent_docsacmhorizontal_-inproduct-learn).
* Пройдите курс обучения по [управлению затратами](/learn/paths/control-spending-manage-bills?WT.mc_id=costmanagementcontent_docsacmhorizontal_-inproduct-learn) .