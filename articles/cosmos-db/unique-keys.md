---
title: Использование уникальных ключей в Azure Cosmos DB
description: Узнайте, как определить и использовать уникальные ключи для базы данных Azure Cosmos. В этой статье также описывается, как уникальные ключи добавляют уровень целостности данных.
author: markjbrown
ms.author: mjbrown
ms.service: cosmos-db
ms.subservice: cosmosdb-sql
ms.topic: conceptual
ms.date: 07/23/2020
ms.reviewer: sngun
ms.openlocfilehash: 9eb2b916bfe6c73a1535afb077b04fbb081dd5f1
ms.sourcegitcommit: b39cf769ce8e2eb7ea74cfdac6759a17a048b331
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/22/2021
ms.locfileid: "98685726"
---
# <a name="unique-key-constraints-in-azure-cosmos-db"></a>Ограничения для уникальных ключей в Azure Cosmos DB
[!INCLUDE[appliesto-sql-api](includes/appliesto-sql-api.md)]

Уникальные ключи добавляют слой целостности данных в контейнер Azure Cosmos. Политика уникальных ключей создается одновременно с контейнером Azure Cosmos. Уникальные ключи гарантируют уникальность одного или нескольких значений в пределах логической секции. Вы также можете гарантировать уникальность для каждого [ключа секции](partitioning-overview.md).

После создания контейнера с политикой уникального ключа создание нового или обновление существующего элемента, в результате чего происходит дублирование в логической секции, запрещено, как указано в ограничении уникального ключа. Ключ секции в сочетании с уникальным ключом гарантирует уникальность элемента в области контейнера.

Например, рассмотрим контейнер Azure Cosmos с `Email address` ограничением уникального ключа и `CompanyID` ключом секции. Когда вы настроите уникальный ключ для адреса электронной почты пользователей, каждый элемент будет гарантированно содержать уникальный адрес электронной почты в пределах каждого `CompanyID`. Невозможно создать два элемента с дублирующимся адресом электронной почты и с тем же значением ключа секции. В API-интерфейсе SQL Azure Cosmos DB (Core) элементы хранятся в виде значений JSON. В этих значениях JSON учитывается регистр. При выборе свойства в качестве уникального ключа можно вставить значения с учетом регистра для этого свойства. Например, если в свойстве Name определен уникальный ключ, "Гэби" отличается от "Гэби", и вы можете вставить оба элемента в контейнер.

Чтобы записи могли содержать одинаковые адреса электронной почты, но не одинаковые сочетания имени, фамилии и адреса электронной почты, добавьте в политику уникальных ключей дополнительные пути. Вместо создания уникального ключа, основанного только на адресе электронной почты, можно также создать уникальный ключ с сочетанием имени, фамилии и адреса электронной почты. Такой ключ называется составным уникальным ключом. В этом случае разрешено каждое уникальное сочетание трех значений в пределах заданного `CompanyID`. 

Например, контейнер может содержать элементы со следующими значениями, в которых каждый элемент соблюдает ограничение уникального ключа.

|CompanyID|Имя|Фамилия|Адрес электронной почты|
|---|---|---|---|
|Contoso|Гэби|Дюперре|gaby@contoso.com |
|Contoso|Гэби|Дюперре|gaby@fabrikam.com|
|Fabrikam|Гэби|Дюперре|gaby@fabrikam.com|
|Fabrikam|Иван|Дюперре|gaby@fabrikam.com|
|Fabrkam|   |Дюперре|gaby@fabraikam.com|
|Fabrkam|   |   |gaby@fabraikam.com|

При попытке вставить новый элемент с сочетанием значений, которое указано в предыдущей таблице, вы получите ошибку. Такая ошибка означает, что ограничение уникального ключа не соблюдается. Вы получаете либо `Resource with specified ID or name already exists` `Resource with specified ID, name, or unique index already exists` в виде возвращаемого сообщения. 

## <a name="define-a-unique-key"></a>Определение уникального ключа

Уникальные ключи можно определить только при создании контейнера Azure Cosmos. Уникальный ключ ограничивается логической секцией. В предыдущем примере, если контейнер секционируется по почтовому индексу, вы получите повторяющиеся элементы в каждой логической секции. При создании уникальных ключей учитывайте следующие аспекты.

* Вы не можете изменить уникальный ключ для имеющегося контейнера. Другими словами, после создания контейнера с политикой уникальных ключей эту политику невозможно изменить.

* Чтобы задать уникальный ключ для уже существующего контейнера, создайте новый контейнер с ограничением уникального ключа. Используйте соответствующее средство миграции данных, чтобы переместить все данные из старого контейнера в новый. Между контейнерами SQL данные следует перемещать с помощью [средства переноса данных](import-data.md). Для контейнеров MongoDB используйте [mongoimport.exe или mongorestore.exe](../dms/tutorial-mongodb-cosmos-db.md?toc=%2fazure%2fcosmos-db%2ftoc.json%253ftoc%253d%2fazure%2fcosmos-db%2ftoc.json) для перемещения данных.

* Политика уникальных ключей может содержать не более 16значений путей. Например, значения могут быть `/firstName` , `/lastName` и `/address/zipCode` . Каждая политика уникальных ключей может иметь не более 10 ограничений уникальных ключей или сочетаний. Суммарная длина путей для каждого ограничения уникального индекса не может превышать 60 байт. В предыдущем примере имя, фамилия и адрес электронной почты в совокупности считаются одним ограничением. Это ограничение использует 3 из 16 допустимых путей.

* Если контейнер имеет политику уникального ключа, плата за [единицу запросов (ru)](request-units.md) для создания, обновления и удаления элемента немного выше.

* Разреженные уникальные ключи не поддерживаются. Если для некоторых уникальных путей отсутствуют значения, для них в ограничении уникальности используется значение null. Это означает, что такое ограничение допускает наличие только одного элемента со значением null.

* В именах уникальных ключей учитывается регистр. Например, рассмотрим контейнер с ограничением уникального ключа, установленным в значение `/address/zipcode` . Если в данных есть поле с именем `ZipCode` , Azure Cosmos DB вставляет в качестве уникального ключа значение null, так как `zipcode` не совпадает с `ZipCode` . Учет регистра в этой ситуации приводит к тому, что другие записи со значением ZipCode добавлены не будут, ведь новое значение null нарушит требование уникальности ключа.

## <a name="next-steps"></a>Следующие шаги

* Дополнительные сведения о [логических секциях](partitioning-overview.md)
* Узнайте, [как определить уникальные ключи](how-to-define-unique-keys.md) при создании контейнера
