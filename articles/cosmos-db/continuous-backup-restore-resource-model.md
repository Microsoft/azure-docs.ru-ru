---
title: Модель ресурсов для функции восстановления на момент времени Azure Cosmos DB.
description: В этой статье описывается модель ресурсов для функции восстановления на момент времени Azure Cosmos DB. В нем объясняются параметры, поддерживающие непрерывную архивацию и ресурсы, которые можно восстановить в Azure Cosmos DB API для учетных записей SQL и MongoDB.
author: kanshiG
ms.service: cosmos-db
ms.topic: conceptual
ms.date: 02/01/2021
ms.author: govindk
ms.reviewer: sngun
ms.openlocfilehash: 91421b66af441ed2c7e9c8b66c16ee83f489b03e
ms.sourcegitcommit: 44188608edfdff861cc7e8f611694dec79b9ac7d
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/04/2021
ms.locfileid: "99538516"
---
# <a name="resource-model-for-the-azure-cosmos-db-point-in-time-restore-feature-preview"></a>Модель ресурсов для функции восстановления на момент времени Azure Cosmos DB (Предварительная версия)
[!INCLUDE[appliesto-sql-mongodb-api](includes/appliesto-sql-mongodb-api.md)]

> [!IMPORTANT]
> Функция восстановления на момент времени (режим непрерывного резервного копирования) для Azure Cosmos DB в настоящее время находится в общедоступной предварительной версии.
> Эта предварительная версия предоставляется без соглашения об уровне обслуживания и не рекомендована для использования рабочей среде. Некоторые функции могут не поддерживаться или их возможности могут быть ограничены.
> Дополнительные сведения см. в статье [Дополнительные условия использования предварительных выпусков Microsoft Azure](https://azure.microsoft.com/support/legal/preview-supplemental-terms/).

В этой статье объясняется модель ресурсов для функции восстановления Azure Cosmos DB на момент времени (Предварительная версия). В нем объясняются параметры, поддерживающие непрерывную архивацию и ресурсы, которые можно восстановить в Azure Cosmos DB API для учетных записей SQL и MongoDB.

## <a name="database-accounts-resource-model"></a>Модель ресурсов учетной записи базы данных

Модель ресурсов учетной записи базы данных обновляется с помощью нескольких дополнительных свойств для поддержки новых сценариев восстановления. Эти свойства — **баккупполици, CreateMode и ресторепараметерс.**

### <a name="backuppolicy"></a>баккупполици

Новое свойство в политике резервного копирования на уровне учетной записи с именем "тип" в параметре "баккупполици" обеспечивает непрерывное резервное копирование и функции восстановления на момент времени. Этот режим называется **непрерывным резервным копированием**. В общедоступной предварительной версии этот режим можно задать только при создании учетной записи. После его включения все контейнеры и базы данных, созданные в этой учетной записи, будут иметь непрерывное резервное копирование и функции восстановления на момент времени, включенные по умолчанию.

> [!NOTE]
> В настоящее время функция восстановления на момент времени находится в общедоступной предварительной версии, она доступна для Azure Cosmos DB API для MongoDB и учетных записей SQL. После создания учетной записи с непрерывным режимом ее нельзя переключить в периодическую.

### <a name="createmode"></a>CreateMode

Это свойство указывает, как была создана учетная запись. Возможные значения: "default" и "Restore". Чтобы выполнить восстановление, присвойте этому параметру значение "Restore" и укажите соответствующие значения в `RestoreParameters` свойстве.

### <a name="restoreparameters"></a>ресторепараметерс

`RestoreParameters`Ресурс содержит сведения об операции восстановления, включая идентификатор учетной записи, время восстановления и ресурсы, которые необходимо восстановить.

|Имя свойства |Описание  |
|---------|---------|
|Режимвосстановления  | Режим восстановления должен быть "PointInTime" |
|ресторесаурце   |  InstanceId исходной учетной записи, из которой будет инициировано восстановление.       |
|ресторетиместампинутк  | Момент времени в формате UTC, в который должна быть восстановлена учетная запись. |
|датабасесторесторе   | Список `DatabaseRestoreSource` объектов, указывающий, какие базы данных и контейнеры должны быть восстановлены. Если это значение пустое, то восстанавливается вся учетная запись.   |

**Датабасересторересаурце** — каждый ресурс представляет отдельную базу данных и все коллекции в этой базе данных.

|Имя свойства |Описание  |
|---------|---------|
|databaseName | Имя базы данных |
| коллектионнамес| Список контейнеров в этой базе данных |

### <a name="sample-resource"></a>Образец ресурса

Следующий код JSON — пример ресурса учетной записи базы данных с включенной непрерывной архивацией:

```json
{
  "location": "westus",
  "properties": {
    "databaseAccountOfferType": "Standard",
    "locations": [
      {
        "failoverPriority": 0,
        "locationName": "southcentralus",
        "isZoneRedundant": false
      }
    ],
    "createMode": "Restore",
    "restoreParameters": {
      "restoreMode": "PointInTime",
      "restoreSource": "/subscriptions/subid/providers/Microsoft.DocumentDB/locations/westus/restorableDatabaseAccounts/1a97b4bb-f6a0-430e-ade1-638d781830cc",
      "restoreTimestampInUtc": "2020-06-11T22:05:09Z",
      "databasesToRestore": [
        {
          "databaseName": "db1",
          "collectionNames": [
            "collection1",
            "collection2"
          ]
        },
        {
          "databaseName": "db2",
          "collectionNames": [
            "collection3",
            "collection4"
          ]
        }
      ]
    },
    "backupPolicy": {
      "type": "Continuous"
    },
}
}
```

## <a name="restorable-resources"></a>Ресурсы restorable

Существует набор новых ресурсов и API-интерфейсов, которые помогут вам найти важные сведения о ресурсах, которые можно восстановить, расположение, откуда они могут быть восстановлены, и метки времени, когда в этих ресурсах выполнялись Ключевые операции.

> [!NOTE]
> Для всех API-интерфейсов, используемых для перечисления этих ресурсов, требуются следующие разрешения.
> * `Microsoft.DocumentDB/locations/restorableDatabaseAccounts/*/read`
> * `Microsoft.DocumentDB/locations/restorableDatabaseAccounts/read`

### <a name="restorable-database-account"></a>Учетная запись базы данных restorable

Этот ресурс содержит экземпляр учетной записи базы данных, который можно восстановить. Учетная запись базы данных может быть удаленной или действующей. Он содержит сведения, позволяющие найти учетную запись базы данных источника, которую требуется восстановить.

|Имя свойства |Описание  |
|---------|---------|
| ID | Уникальный идентификатор ресурса. |
| accountName | Имя учетной записи глобальной базы данных. |
| creationTime | Время создания учетной записи в формате UTC.  |
| делетионтиме | Время в формате UTC, когда учетная запись была удалена.  Если учетная запись находится в режиме реального времени, это значение пусто. |
| апитипе | Тип API учетной записи Azure Cosmos DB. |
| рестораблелокатионс | Список расположений, где существовала учетная запись. |
| Рестораблелокатионс: Локатионнаме | Имя региона для региональной учетной записи. |
| Рестораблелокатионс: Регионалдатабасеаккаунтинстанцеи | Идентификатор GUID региональной учетной записи. |
| Рестораблелокатионс: creationTime | Время создания региональной учетной записи в формате UTC.|
| Рестораблелокатионс: Делетионтиме | Время в формате UTC, когда была удалена региональная учетная запись. Если региональная учетная запись является активной, это значение пусто.|

Список всех учетных записей restorable см. в статьях учетные записи [базы данных restorable — список](restorable-database-accounts-list.md) или [restorable учетные записи баз данных — список статей по расположению](restorable-database-accounts-list-by-location.md) .

### <a name="restorable-sql-database"></a>База данных SQL restorable

Каждый ресурс содержит сведения о событии изменения, например создание и удаление, которые произошли в базе данных SQL. Эта информация может помочь в сценариях, когда база данных была случайно удалена, и если необходимо выяснить, когда произошло это событие.

|Имя свойства |Описание  |
|---------|---------|
| eventTimestamp | Время в формате UTC при создании или удалении базы данных. |
| ownerId | Имя базы данных SQL. |
| овнерресаурцеид | Идентификатор ресурса базы данных SQL|
| "тип_операции" | Тип операции этого события базы данных. Возможные значения<br/><ul><li>Создание: событие создания базы данных</li><li>Удаление: событие удаления базы данных</li><li>Replace: событие изменения базы данных</li><li>Системоператион: событие изменения базы данных, активируемое системой. Это событие не инициируется пользователем</li></ul> |
| База данных |Свойства базы данных SQL на момент события|

Чтобы получить список всех изменений базы данных, см. статью [restorable SQL databases-List](restorable-sql-databases-list.md) .

### <a name="restorable-sql-container"></a>Restorable контейнер SQL

Каждый ресурс содержит сведения о событии изменения, например создание и удаление, которые произошли в контейнере SQL. Эти сведения могут помочь в сценариях, в которых контейнер был изменен или удален, и если необходимо выяснить, когда это событие произошло.

|Имя свойства |Описание  |
|---------|---------|
| eventTimestamp    | Время в формате UTC, когда произошло это событие контейнера.|
| ownerId| Имя контейнера SQL.|
| овнерресаурцеид   | Идентификатор ресурса для контейнера SQL.|
| "тип_операции" | Тип операции этого события контейнера. Возможные значения <br/><ul><li>Создание: событие создания контейнера</li><li>Удаление: событие удаления контейнера</li><li>Replace: событие изменения контейнера</li><li>Системоператион: событие изменения контейнера, активируемое системой. Это событие не инициируется пользователем</li></ul> |
| контейнер | Свойства контейнера SQL на момент события.|

Чтобы получить список всех изменений контейнера в той же базе данных, см. статью [restorable SQL Containers-List](restorable-sql-containers-list.md) .

### <a name="restorable-sql-resources"></a>Restorable ресурсы SQL

Каждый ресурс представляет отдельную базу данных и все контейнеры в этой базе данных.

|Имя свойства |Описание  |
|---------|---------|
| databaseName  | Имя базы данных SQL.
| коллектионнамес   | Список контейнеров SQL в этой базе данных.|

Чтобы получить список базы данных SQL и поле со списком контейнеров, существующих в учетной записи с заданной меткой времени и расположением, см. статью [restorable SQL Resources-List](restorable-sql-resources-list.md) .

### <a name="restorable-mongodb-database"></a>База данных MongoDB restorable

Каждый ресурс содержит сведения о событии изменения, например создание и удаление, которые произошли в базе данных MongoDB. Эта информация может помочь в сценарии, когда база данных была случайно удалена, и пользователь должен узнать, когда произошло это событие.

|Имя свойства |Описание  |
|---------|---------|
|eventTimestamp| Время в формате UTC, когда произошло событие базы данных.|
| ownerId| Имя базы данных MongoDB. |
| овнерресаурцеид   | Идентификатор ресурса базы данных MongoDB. |
| "тип_операции" |   Тип операции этого события базы данных. Возможные значения<br/><ul><li> Создание: событие создания базы данных</li><li> Удаление: событие удаления базы данных</li><li> Replace: событие изменения базы данных</li><li> Системоператион: событие изменения базы данных, активируемое системой. Это событие не инициируется пользователем </li></ul> |

Чтобы получить список всех изменений базы данных, см. статью [restorable MongoDB databases-List](restorable-mongodb-databases-list.md) .

### <a name="restorable-mongodb-collection"></a>Коллекция restorable MongoDB

Каждый ресурс содержит сведения о событии изменения, например создание и удаление, которые произошли в коллекции MongoDB. Эта информация может помочь в сценариях, где коллекция была изменена или удалена, и пользователь должен узнать, когда произошло это событие.

|Имя свойства |Описание  |
|---------|---------|
| eventTimestamp |Время в формате UTC, когда произошло событие сбора. |
| ownerId| Имя коллекции MongoDB. |
| овнерресаурцеид   | Идентификатор ресурса коллекции MongoDB. |
| "тип_операции" |Тип операции этого события коллекции. Возможные значения<br/><ul><li>Создать: событие создания коллекции</li><li>Удаление: событие удаления коллекции</li><li>Replace: событие изменения коллекции</li><li>Системоператион: событие изменения коллекции, инициированное системой. Это событие не инициируется пользователем</li></ul> |

Чтобы получить список всех изменений контейнера в той же базе данных, см. статью [restorable MongoDB Collections-List](restorable-mongodb-collections-list.md) .

### <a name="restorable-mongodb-resources"></a>Ресурсы restorable MongoDB

Каждый ресурс представляет отдельную базу данных и все коллекции в этой базе данных.

|Имя свойства |Описание  |
|---------|---------|
| databaseName  |Имя базы данных MongoDB. |
| коллектионнамес | Список коллекций MongoDB в этой базе данных. |

Чтобы получить список всех сочетаний баз данных и коллекций MongoDB, существующих в учетной записи с заданной меткой времени и расположением, см. статью [restorable MongoDB Resources-List](restorable-mongodb-resources-list.md) .

## <a name="next-steps"></a>Следующие шаги

* Настройка непрерывного резервного копирования и управление им с помощью [портал Azure](continuous-backup-restore-portal.md), [PowerShell](continuous-backup-restore-powershell.md), [интерфейса командной строки](continuous-backup-restore-command-line.md)или [Azure Resource Manager](continuous-backup-restore-template.md).
* [Управление разрешениями](continuous-backup-restore-permissions.md) , необходимыми для восстановления данных в режиме непрерывной архивации.
