---
title: Справочник по мониторингу Azure Cosmos DB данных | Документация Майкрософт
description: Важные справочные материалы, необходимые при мониторинге журналов и метрик в Azure Cosmos DB.
author: SnehaGunda
ms.service: cosmos-db
ms.topic: how-to
ms.date: 12/07/2020
ms.author: sngun
ms.custom: subject-monitoring
ms.openlocfilehash: 04103de47e82764f7ec4effa84a9b2b7b90b9363
ms.sourcegitcommit: c4c554db636f829d7abe70e2c433d27281b35183
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "98034641"
---
# <a name="monitoring-azure-cosmos-db-data-reference"></a>Справочник по мониторингу Azure Cosmos DB данных

[!INCLUDE[appliesto-all-apis](includes/appliesto-all-apis.md)]

В этой статье приведены сведения о данных журнала и метрик, собранные для анализа производительности и доступности Azure Cosmos DB. Подробные сведения о сборе и анализе данных мониторинга для Azure Cosmos DB см. в статье [мониторинг Azure Cosmos DB](monitor-cosmos-db.md) .

## <a name="metrics"></a>Метрики

Все метрики, соответствующие Azure Cosmos DB, хранятся в пространстве имен **Cosmos DB стандартных метриках**. Список всех метрик поддержки Azure Monitor (в том числе Azure Cosmos DB) см. в статье [Azure Monitor поддерживаемые метрики](../azure-monitor/platform/metrics-supported.md). В этом разделе перечислены все автоматически собранные метрики платформы, собранные для Azure Cosmos DB.  

### <a name="request-metrics"></a>Метрики запросов

|Метрика (отображаемое имя метрики)|Единица (тип агрегирования) |Описание|Измерения| Степени детализации времени| Сопоставление метрик прежних версий | Использование |
|---|---|---|---| ---| ---| ---|
| TotalRequests (Всего запросов) | Количество (число) | Количество выполненных запросов| DatabaseName, CollectionName, Region, StatusCode| All | TotalRequests, HTTP 2xx, HTTP 3xx, HTTP 400, HTTP 401, внутренняя ошибка сервера, служба недоступна, отрегулированные запросы, среднее число запросов в секунду | Используется для отслеживания запросов по коду состояния, контейнеру с поминутной гранулярностью. Чтобы получить среднее число запросов в секунду, используйте агрегат Count в минуту и разделите на 60. |
| Метадатарекуестс (запросы метаданных) |Количество (число) | Количество запросов метаданных. Azure Cosmos DB поддерживает контейнер системных метаданных для каждой учетной записи, что позволяет перечислять коллекции, базы данных и т. д. и их конфигурации без оплаты. | DatabaseName, CollectionName, Region, StatusCode| All| |Позволяет отслеживать регулирование из-за запросов метаданных.|
| MongoRequests (запросы Mongo) | Количество (число) | Количество выполненных запросов Mongo | DatabaseName, CollectionName, Region, CommandName, ErrorCode| All |Частота запросов на запрос Mongo, частота запросов на обновление Mongo, частота запросов на удаление Mongo, частота запросов на вставку Mongo, частота запросов на количество Mongo| Позволяет отслеживать ошибки запроса Mongo, использование каждого типа команды. |

### <a name="request-unit-metrics"></a>Метрики единиц запроса

|Метрика (отображаемое имя метрики)|Единица (тип агрегирования)|Описание|Измерения| Степени детализации времени| Сопоставление метрик прежних версий | Использование |
|---|---|---|---| ---| ---| ---|
| Монгорекуестчарже (плата за запрос Mongo) | Количество (всего) |Использованные единицы запросов Mongo| DatabaseName, CollectionName, Region, CommandName, ErrorCode| All |Расходы запросов на запрос Mongo, расходы запросов на обновление Mongo, расходы запросов на удаление Mongo, расходы запросов на вставку Mongo, расходы запросов на количество Mongo| Позволяет отслеживать единицы запросов ресурсов Mongo в минуту.|
| Тоталрекуестунитс (общее количество единиц запросов)| Количество (всего) | Использованные единицы запросов| DatabaseName, CollectionName, Region, StatusCode |All| TotalRequestUnits| Позволяет отслеживать использование общего количества единиц запросов со степенью детализации до минуты. Чтобы получить среднее число единиц запросов, потребленных в секунду, используйте общий объем агрегата в минуту и разделите на 60.|
| Провисионедсраугхпут (подготовленная пропускная способность)| Количество (максимум) |Подготовленная пропускная способность на уровне гранулярности контейнера| DatabaseName, ContainerName| 5M| | Используется для мониторинга подготовленной пропускной способности для каждого контейнера.|

### <a name="storage-metrics"></a>Метрики хранения

|Метрика (отображаемое имя метрики)|Единица (тип агрегирования)|Описание|Измерения| Степени детализации времени| Сопоставление метрик прежних версий | Использование |
|---|---|---|---| ---| ---| ---|
| Аваилаблестораже (Доступное хранилище) |Байт (всего) | Общее Доступное хранилище, зарегистрированное в 5-минутном уровне детализации для региона| DatabaseName, CollectionName, Region| 5M| Доступная служба хранилища| Позволяет отслеживать доступную емкость хранилища (применимо только для фиксированных коллекций хранилища). Минимальная степень детализации должна составлять 5 минут.| 
| Использование данных (использование) |Байт (всего) |Общее количество использованных данных в 5-минутном уровне на регион| DatabaseName, CollectionName, Region| 5M |Размер данных | Для мониторинга общего использования данных в контейнере и регионе минимальная степень детализации должна составлять 5 минут.|
| Индексусаже (использование индекса) | Байт (всего) |Общее использование индекса получено в течение 5 минут на регион| DatabaseName, CollectionName, Region| 5M| Размер индексов| Для мониторинга общего использования данных в контейнере и регионе минимальная степень детализации должна составлять 5 минут. |
| Документкуота (квота документа) | Байт (всего) | Общая квота хранилища сообщила об уровне детализации в 5 минут на регион.| DatabaseName, CollectionName, Region| 5M |Емкость хранилища| Используется для мониторинга общей квоты в контейнере и регионе, минимальная степень детализации должна составлять 5 минут.|
| Документкаунт (число документов) | Количество (всего) |Общее число документов, сообщаемых с детализацией по 5 минутам на регион| DatabaseName, CollectionName, Region| 5M |Число документов|Используется для мониторинга количества документов в контейнере и регионе, минимальная степень детализации должна составлять 5 минут.|

### <a name="latency-metrics"></a>Метрики задержки

|Метрика (отображаемое имя метрики)|Единица (тип агрегирования)|Описание|Измерения| Степени детализации времени| Использование |
|---|---|---|---| ---| ---|
| Репликатионлатенци (задержка репликации)| Миллисекунды (минимальное, максимальное, среднее) | Задержка репликации P99 между исходными и целевыми регионами для геореплицируемой учетной записи| SourceRegion, TargetRegion| All | Позволяет отслеживать задержку репликации P99 между любыми двумя регионами для геореплицируемой учетной записи. |
| Задержка на стороне сервера| Миллисекунды (среднее) | Время, затраченное сервером на обработку запроса. | CollectionName, ConnectionMode, DatabaseName, OperationType, Публикапитипе, регион | All | Используется для отслеживания задержки запросов на сервере Azure Cosmos DB. |

### <a name="availability-metrics"></a>Метрики доступности

|Метрика (отображаемое имя метрики) |Единица (тип агрегирования)|Описание| Степени детализации времени| Сопоставление метрик прежних версий | Использование |
|---|---|---|---| ---| ---|
| Сервицеаваилабилити (доступность службы)| Процент (минимум, максимум) | Доступность запросов учетной записи со степенью детализации до одного часа| 1 ч | Доступность службы | Представляет процент от общего числа переданных запросов. Запрос считается не удавшимся из-за ошибки системы, если код состояния — 410, 500 или 503. Позволяет отслеживать доступность учетной записи со степенью детализации до одного часа. |

### <a name="cassandra-api-metrics"></a>Метрики по API Cassandra

|Метрика (отображаемое имя метрики)|Единица (тип агрегирования)|Описание|Измерения| Степени детализации времени| Использование |
|---|---|---|---| ---| ---|
| Кассандрарекуестс (запросы Cassandra) | Количество (число) | Количество сделанных запросов API Cassandra| DatabaseName, CollectionName, ErrorCode, Region, OperationType, ResourceType| All| Позволяет отслеживать запросы Cassandra со степенью детализации до минуты. Чтобы получить среднее число запросов в секунду, используйте агрегат Count в минуту и разделите на 60.|
| Кассандрарекуестчаржес (плата за запрос Cassandra) | Количество (SUM, min, Max, AVG) | Единицы запросов, потребляемые API Cassandra | DatabaseName, CollectionName, Region, OperationType, ResourceType| All| Позволяет отслеживать единицы запросов, используемые в минуту учетной записью API Cassandra.|
| Кассандраконнектионклосурес (замыкания на Cassandra подключения) |Количество (число) |Число закрытых подключений Cassandra| ClosureReason, Region| All | Позволяет отслеживать возможность подключения между клиентами и API Cassandra для Azure Cosmos DB.|

Дополнительные сведения см. в списке [всех метрик платформы, поддерживаемых в Azure Monitor](../azure-monitor/platform/metrics-supported.md).

## <a name="resource-logs"></a>Журналы ресурсов

В следующей таблице перечислены свойства журналов ресурсов в Azure Cosmos DB. Журналы ресурсов собираются в Azure Monitor журналов или службе хранилища Azure. В Azure Monitor журналы собираются в таблицу **AzureDiagnostics** в разделе Поставщик ресурсов * * имя `MICROSOFT.DOCUMENTDB` .

| Поле или свойство службы хранилища Azure | Свойство журналов Azure Monitor | Описание |
| --- | --- | --- |
| **time** | **TimeGenerated** | Дата и время (UTC) выполнения операции. |
| **resourceId** | **Ресурс** | Учетная запись Azure Cosmos DB, для которой включены журналы.|
| **category** | **Категория** | Для Azure Cosmos DB, **DataPlaneRequests**, **MongoRequests**, **куерирунтиместатистикс**, **партитионкэйстатистикс**, **партитионкэйруконсумптион**, **контролпланерекуестс**, **CassandraRequests**, **GremlinRequests** — это доступные типы журналов. |
| **operationName** | **OperationName** | Имя операции. Имя операции может иметь значение  `Create` , `Update` , `Read` , `ReadFeed` , `Delete` , `Replace` , `Execute` , `SqlQuery` , `Query` , `JSQuery` , `Head` , `HeadFeed` или `Upsert` .   |
| **properties** | н/д | Содержимое этого поля описано в строках, приведенных ниже. |
| **activityId** | **activityId_g** | Уникальный идентификатор GUID регистрируемой операции. |
| **Агента** | **userAgent_s** | Строка, указывающая агент пользователя клиента, из которого был отправлен запрос. Формат агента пользователя — `{user agent name}/{version}` .|
| **рекуестресаурцетипе** | **requestResourceType_s** | Тип доступного ресурса. Это значение может быть базой данных, контейнером, документом, вложением, пользователем, разрешениями, хранимой процедурой, триггером, определяемой пользователем функцией или предложением. |
| **statusCode** | **statusCode_s** | Состояние ответа операции. |
| **requestResourceId** | **ResourceId** | Идентификатор ресурса, который относится к запросу. В зависимости от выполняемой операции это значение может указывать на `databaseRid` , `collectionRid` или `documentRid` .|
| **clientIpAddress** | **clientIpAddress_s** | IP-адрес клиента. |
| **requestCharge** | **requestCharge_s** | Количество единиц запросов в секунду, используемых операцией |
| **collectionRid** | **collectionId_s** | Уникальный идентификатор коллекции.|
| **duration** | **duration_d** | Длительность операции в миллисекундах. |
| **requestLength** | **requestLength_s** | Длина запроса в байтах. |
| **responseLength** | **responseLength_s** | Длина ответа в байтах.|
| **ресаурцетокенпермиссионид** | **resourceTokenPermissionId_s** | Это свойство указывает идентификатор разрешения маркера ресурса, который вы указали. Дополнительные сведения о разрешениях см. в разделе [безопасный доступ к вашей статье данных](./secure-access-to-data.md#permissions) . |
| **ресаурцетокенпермиссионмоде** | **resourceTokenPermissionMode_s** | Это свойство указывает режим разрешений, заданный при создании маркера ресурса. Режим разрешения может иметь такие значения, как "все" или "чтение". Дополнительные сведения о разрешениях см. в разделе [безопасный доступ к вашей статье данных](./secure-access-to-data.md#permissions) . |
| **resourceTokenUserRid** | **resourceTokenUserRid_s** | Это свойство должно быть заполнено, если [маркеры ресурсов](./secure-access-to-data.md#resource-tokens) используются для проверки подлинности. Значение указывает на идентификатор ресурса пользователя. |
| **responseLength** | **responseLength_s** | Длина ответа в байтах.|

Список всех категорий журналов Azure Monitor и ссылки на связанные схемы см. в разделе [Azure Monitor журналы — категории и схемы](../azure-monitor/platform/resource-logs-schema.md). 

## <a name="azure-monitor-logs-tables"></a>Таблицы журналов Azure Monitor

Azure Cosmos DB использует таблицы Kusto из журналов Azure Monitor. Эти таблицы можно запрашивать с помощью log Analytics. Список используемых Kusto зажимы см. в статье Справочник по [таблицам журналов Azure Monitor](/azure/azure-monitor/reference/tables/tables-resourcetype#azure-cosmos-db) .

## <a name="see-also"></a>См. также:

- Описание Azure Cosmos DB мониторинга см. в разделе [monitoring Azure Cosmos DB](monitor-cosmos-db.md) .
- Подробные сведения о мониторинге ресурсов Azure см. в статье [Мониторинг ресурсов Azure с помощью Azure Monitor](../azure-monitor/insights/monitor-azure-resource.md).