---
title: Устранение распространенных ошибок в API Azure Cosmos DB для Mongo DB
description: В этом документе обсуждаются способы устранения распространенных проблем, возникающих в API Azure Cosmos DB для MongoDB.
author: christopheranderson
ms.service: cosmos-db
ms.subservice: cosmosdb-mongo
ms.topic: troubleshooting
ms.date: 07/15/2020
ms.author: chrande
ms.openlocfilehash: 13ac90ae70262f2f6781f5f40ec67da4bf74ab68
ms.sourcegitcommit: b4647f06c0953435af3cb24baaf6d15a5a761a9c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/02/2021
ms.locfileid: "101661279"
---
# <a name="troubleshoot-common-issues-in-azure-cosmos-dbs-api-for-mongodb"></a>Устранение распространенных неполадок в API Azure Cosmos DB для MongoDB
[!INCLUDE[appliesto-mongodb-api](includes/appliesto-mongodb-api.md)]

В следующей статье описаны распространенные ошибки и решения для развертываний с помощью Azure Cosmos DB API для MongoDB.

>[!Note]
> В Azure Cosmos DB не размещен модуль MongoDB. Он предоставляет реализацию [протокола MongoDB Wire версии 4,0](mongodb-feature-support-40.md), [3,6](mongodb-feature-support-36.md)и устаревшей поддержки [протокола проводной сети версии 3,2](mongodb-feature-support.md). Поэтому некоторые из этих ошибок находятся только в API Azure Cosmos DB для MongoDB.

## <a name="common-errors-and-solutions"></a>Распространенные ошибки и способы их устранения

| Код       | Ошибка                | Описание  | Решение  |
|------------|----------------------|--------------|-----------|
| 2 | Путь индекса, соответствующий указанному элементу упорядочения, исключается, или запрос ORDER BY не имеет соответствующего составного индекса, из которого он может быть обслужен. | Запрос вызывает сортировку по неиндексированному полю. | Создайте совпадающий индекс (или составной индекс) для предпринятого запроса сортировки. |
| 13 | Не авторизовано | В запросе отсутствуют разрешения на завершение. | Убедитесь, что установлены соответствующие разрешения для базы данных и коллекции.  |
| 16 | инвалидленгс | Указанный запрос имеет недопустимую длину. | Если вы используете функцию объяснить (), убедитесь, что вы предоставляете только одну операцию. |
| 26 | NamespaceNotFound | Не удается найти базу данных или коллекцию, на которую указывает ссылка в запросе. | Убедитесь, что имя базы данных или коллекции полностью совпадает с именем в запросе.|
| 50 | ExceededTimeLimit | Время запроса превысило время ожидания выполнения на 60 с. |  Причин сбоя может быть несколько. Одна из причин в том, что текущей выделенной мощности единиц запросов недостаточно для выполнения запроса. Эту проблему можно устранить, увеличив единицы запроса этой коллекции или базы данных. В других случаях эту ошибку можно обойти, разделив большой запрос на более мелкие. Повторная попытка операции записи, при которой произошла эта ошибка, может привести к дублированию записи. <br><br>Если вы пытаетесь удалить большие объемы данных без использования дополнительных единиц запросов: <br>— Рекомендуется использовать TTL (на основе метки времени): [срок действия данных истекает с помощью API Azure Cosmos DB для MongoDB](./mongodb-time-to-live.md) <br>— Используйте размер курсора или пакета для выполнения удаления. Вы можете извлекать и удалять по одному документу за цикл. Это позволит медленно удалять данные без ухудшения производительности рабочего приложения.|
| 61 | ShardKeyNotFound | Документ в запросе не содержал ключ сегмента коллекции (ключ секции Azure Cosmos DB). | Убедитесь, что в запросе используется ключ сегмента коллекции.|
| 66 | ImmutableField | Запрос пытается изменить неизменяемое поле. | поля "ID" являются неизменяемыми. Убедитесь, что запрос не пытается обновить это поле. |
| 67 | CannotCreateIndex | Не удается выполнить запрос на создание индекса. | В контейнере можно создать до 500 индексов с одним полем. В составной индекс можно добавить до восьми полей (составные индексы поддерживаются в версии 3.6 и более новой). |
| 115 | CommandNotSupported | Отправленный запрос не поддерживается. | Дополнительные сведения должны быть приведены в сообщении об ошибке. Если эта функция важна для ваших развертываний, сообщите нам о создании запроса в службу поддержки на [портал Azure](https://portal.azure.com/?#blade/Microsoft_Azure_Support/HelpAndSupportBlade). |
| 11000 | DuplicateKey | Ключ сегмента (ключ секции Azure Cosmos DB) вставляемого документа уже существует в коллекции или нарушено ограничение уникальности индексов полей. | Используйте функцию update() для обновления имеющегося документа. Если нарушено ограничение уникальности индексов полей, вставьте или обновите документ, используя значение поля, которого еще не существует в сегменте или секции. |
| 16500 | TooManyRequests  | Общее число использованных единиц запроса превысило число, подготовленное для коллекции, и было отрегулировано. | Рекомендуем масштабировать пропускную способность, назначенную контейнеру или набору контейнеров на портале Azure, или можно выполнить операцию еще раз. При [включении SSR](prevent-rate-limiting-errors.md) (Повтор на стороне сервера) Azure Cosmos DB автоматически повторяет запросы, которые не удалось выполнить из-за этой ошибки. |
| 16501 | ExceededMemoryLimit | Так как в этой службе несколько клиентов, операция превысила выделенную память для клиента. | Уменьшите область операции, применив более строгие критерии запроса, или обратитесь в службу поддержки на [портале Azure](https://portal.azure.com/?#blade/Microsoft_Azure_Support/HelpAndSupportBlade). Пример: `db.getCollection('users').aggregate([{$match: {name: "Andy"}}, {$sort: {age: -1}}]))` |
| 40324 | Нераспознанное имя этапа конвейера. | Имя этапа в запросе конвейера агрегирования не распознано. | Убедитесь, что в запросе все имена конвейеров агрегирования являются допустимыми. |
| - | Проблемы с версией протокола в MongoDB | Более старые версии драйверов MongoDB не могут обнаружить имя учетной записи Azure Cosmos в строках подключения. | Добавьте *AppName = @**AccountName** @* в конце API Cosmos DB для строки подключения к MongoDB, где ***AccountName*** — это имя учетной записи Cosmos DB. |
| - | Сетевые проблемы на клиенте MongoDB (например, исключения сокетов или endOfStream)| Сбой при выполнении сетевого запроса. Зачастую это является следствием того, что клиент MongoDB пытается использовать неактивное подключение TCP. Драйверы MongoDB часто используют пулы соединений, что приводит к использованию для запроса произвольного соединения, выбранного из пула. Время ожидания неактивных соединений в Azure Cosmos DB обычно истекает через четыре минуты. | Вы можете повторить эти неудачные запросы в коде приложения, изменить параметры клиента MongoDB, чтобы разоактивировать неактивные TCP-подключения до истечения времени ожидания в течение 4 минут, или настроить параметры проверки активности ОС для поддержания TCP-подключений в активном состоянии.<br><br>Чтобы не получать сообщения о подключении, вы можете изменить строку подключения, установив для параметра maxConnectionIdleTime значение 1–2 мин.<br>-Mongo драйвер: Configure *максидлетимемс = 120000* <br>-Node.JS: Configure *соккеттимеаутмс = 120000*, *аутореконнект* = true, *keepAlive* = true, *кипаливеинитиалделай* = 3 минуты

## <a name="next-steps"></a>Дальнейшие действия

- Узнайте, как [использовать Studio 3T](mongodb-mongochef.md) с API Azure Cosmos DB для MongoDB.
- Узнайте, как [использовать Robo 3T](mongodb-robomongo.md) с API Azure Cosmos DB для MongoDB.
- Ознакомьтесь с [примерами](mongodb-samples.md) MongoDB с API Azure Cosmos DB для MongoDB.