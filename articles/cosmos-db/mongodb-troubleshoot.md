---
title: Устранение распространенных ошибок в API Azure Cosmos DB для Mongo DB
description: В этом документе обсуждаются способы устранения распространенных проблем, возникающих в API Azure Cosmos DB для MongoDB.
author: christopheranderson
ms.service: cosmos-db
ms.subservice: cosmosdb-mongo
ms.topic: troubleshooting
ms.date: 07/15/2020
ms.author: chrande
ms.openlocfilehash: de39aee73a6f4b422af4524d3302f8858f8b060b
ms.sourcegitcommit: c27a20b278f2ac758447418ea4c8c61e27927d6a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/03/2021
ms.locfileid: "101692243"
---
# <a name="troubleshoot-common-issues-in-azure-cosmos-dbs-api-for-mongodb"></a>Устранение распространенных неполадок в API Azure Cosmos DB для MongoDB
[!INCLUDE[appliesto-mongodb-api](includes/appliesto-mongodb-api.md)]

В следующей статье описаны распространенные ошибки и решения для развертываний с помощью Azure Cosmos DB API для MongoDB.

>[!Note]
> В Azure Cosmos DB не размещен модуль MongoDB. Он предоставляет реализацию [протокола MongoDB Wire версии 4,0](mongodb-feature-support-40.md), [3,6](mongodb-feature-support-36.md)и устаревшей поддержки [протокола проводной сети версии 3,2](mongodb-feature-support.md). Поэтому некоторые из этих ошибок находятся только в API Azure Cosmos DB для MongoDB.

## <a name="common-errors-and-solutions"></a>Распространенные ошибки и способы их устранения

| Код       | Ошибка                | Описание  | Решение  |
|------------|----------------------|--------------|-----------|
| 2 | BadValue | Одна из распространенных причин состоит в том, что исключается путь индекса, соответствующий указанному элементу упорядочивания, а запрос order by не имеет соответствующего составного индекса, из которого он может обслуживаться. Запрос вызывает сортировку по неиндексированному полю. | Создайте совпадающий индекс (или составной индекс) для предпринятого запроса сортировки. |
| 2 | Транзакция неактивна | Многодокументная транзакция превышает фиксированное ограничение в 5 секунд. | Повторите транзакцию с несколькими документами или ограничьте область действия в рамках транзакции с несколькими документами, чтобы она была завершена в течение 5-секундного ограничения времени. |
| 13 | Не авторизовано | В запросе отсутствуют разрешения на завершение. | Убедитесь, что используется правильный ключ.  |
| 26 | NamespaceNotFound | Не удается найти базу данных или коллекцию, на которую указывает ссылка в запросе. | Убедитесь, что имя базы данных или коллекции полностью совпадает с именем в запросе.|
| 50 | ExceededTimeLimit | Время запроса превысило время ожидания выполнения на 60 с. |  Причин сбоя может быть несколько. Одна из причин в том, что текущей выделенной мощности единиц запросов недостаточно для выполнения запроса. Эту проблему можно устранить, увеличив единицы запроса этой коллекции или базы данных. В других случаях эту ошибку можно обойти, разделив большой запрос на более мелкие. Повторная попытка операции записи, при которой произошла эта ошибка, может привести к дублированию записи. <br><br>Если вы пытаетесь удалить большие объемы данных без использования дополнительных единиц запросов: <br>— Попробуйте использовать параметр TTL (срок жизни по метке времени): [Завершение срока действия данных с помощью API Azure Cosmos DB для MongoDB](mongodb-time-to-live.md) <br>— Используйте для удаления размер курсора (пакета). Вы можете извлекать и удалять по одному документу за цикл. Это позволит медленно удалять данные без ухудшения производительности рабочего приложения.|
| 61 | ShardKeyNotFound | Документ в запросе не содержал ключ сегмента коллекции (ключ секции Azure Cosmos DB). | Убедитесь, что в запросе используется ключ сегмента коллекции.|
| 66 | ImmutableField | Запрос пытается изменить неизменяемое поле. | поля "_id" являются неизменяемыми. Убедитесь, что запрос не пытается обновить такое поле или поле ключа сегмента. |
| 67 | CannotCreateIndex | Не удается выполнить запрос на создание индекса. | В контейнере можно создать до 500 индексов с одним полем. В составной индекс можно добавить до восьми полей (составные индексы поддерживаются в версии 3.6 и более новой). |
| 112 | вритеконфликт | Сбой транзакции с несколькими документами из-за конфликтующей транзакции с несколькими документами | Повторите транзакцию с несколькими документами, пока она не будет выполнена. |
| 115 | CommandNotSupported | Отправленный запрос не поддерживается. | Дополнительные сведения должны быть приведены в сообщении об ошибке. Если эта функция важна для ваших развертываний, создайте запрос в службу поддержки в [портал Azure](https://portal.azure.com/?#blade/Microsoft_Azure_Support/HelpAndSupportBlade) , и группа Azure Cosmos DB вернет вас к вам. |
| 11000 | DuplicateKey | Ключ сегмента (ключ секции Azure Cosmos DB) вставляемого документа уже существует в коллекции или нарушено ограничение уникальности индексов полей. | Используйте функцию update() для обновления имеющегося документа. Если нарушено ограничение уникальности индексов полей, вставьте или обновите документ, используя значение поля, которого еще не существует в сегменте или секции. Другой вариант — использовать поле, содержащее сочетание полей идентификаторов и ключей сегментов. |
| 16500 | TooManyRequests  | Общее число использованных единиц запроса превысило число, подготовленное для коллекции, и было отрегулировано. | Рекомендуем масштабировать пропускную способность, назначенную контейнеру или набору контейнеров на портале Azure, или можно выполнить операцию еще раз. При включении SSR (повтора на стороне сервера) Azure Cosmos DB автоматически повторяет запросы, которые не удалось выполнить из-за этой ошибки. |
| 16501 | ExceededMemoryLimit | Так как в этой службе несколько клиентов, операция превысила выделенную память для клиента. Это применимо только к API Azure Cosmos DB для MongoDB версии 3.2. | Уменьшите область операции, применив более строгие критерии запроса, или обратитесь в службу поддержки на [портале Azure](https://portal.azure.com/?#blade/Microsoft_Azure_Support/HelpAndSupportBlade). Пример: `db.getCollection('users').aggregate([{$match: {name: "Andy"}}, {$sort: {age: -1}}]))` |
| 40324 | Нераспознанное имя этапа конвейера. | Имя этапа в запросе конвейера агрегирования не распознано. | Убедитесь, что в запросе все имена конвейеров агрегирования являются допустимыми. |
| - | Проблемы с версией протокола в MongoDB | Более старые версии драйверов MongoDB не могут обнаружить имя учетной записи Azure Cosmos в строках подключения. | Добавьте `appName=@accountName@` в конец строки подключения, где `accountName` — это имя учетной записи Azure Cosmos DB. |
| - | Сетевые проблемы на клиенте MongoDB (например, исключения сокетов или endOfStream)| Сбой при выполнении сетевого запроса. Зачастую это является следствием того, что клиент MongoDB пытается использовать неактивное подключение TCP. Драйверы MongoDB часто используют пулы соединений, что приводит к использованию для запроса произвольного соединения, выбранного из пула. Время ожидания неактивных соединений в Azure Cosmos DB обычно истекает через четыре минуты. | Вы можете повторить эти завершившиеся сбоем запросы в коде приложения, изменить параметры клиента (драйвера) MongoDB для удаления неактивных TCP-соединений до истечения времени ожидания (4 минуты) или настроить параметры `keepalive` операционной системы, чтобы обеспечить поддержку TCP-соединений в активном состоянии.<br><br>Чтобы не получать сообщения о подключении, вы можете изменить строку подключения, установив для параметра `maxConnectionIdleTime` значение 1–2 мин.<br>— Драйвер Mongo: настройте `maxIdleTimeMS=120000` <br>— Node.JS: настройте `socketTimeoutMS=120000`, `autoReconnect` = true, `keepAlive` = true, `keepAliveInitialDelay` = 3 минуты
| - | Оболочка Mongo не работает на портал Azure | Когда пользователь пытается открыть оболочку Mongo, ничего не происходит, а вкладка просто остается пустой.  | Проверьте брандмауэр. Брандмауэр не поддерживается в оболочке Mongo на портале Azure. <br>— Установите оболочку Mongo на локальном компьютере в соответствии с правилами брандмауэра. <br>— Используйте прежнюю версию оболочки Mongo.
| - | Не удается подключиться с помощью строки подключения  | Строка подключения изменилась при обновлении версии 3.2 до версии 3.6. | Обратите внимание, что при использовании API Azure Cosmos DB для учетных записей MongoDB, учетные записи версии 3.6 будет иметь конечную точку в формате `*.mongo.cosmos.azure.com`, в то время как в версии 3.2 конечная точка будет иметь формат `*.documents.azure.com`.  

## <a name="next-steps"></a>Дальнейшие действия

- Узнайте, как [использовать Studio 3T](mongodb-mongochef.md) с API Azure Cosmos DB для MongoDB.
- Узнайте, как [использовать Robo 3T](mongodb-robomongo.md) с API Azure Cosmos DB для MongoDB.
- Ознакомьтесь с [примерами](mongodb-samples.md) MongoDB с API Azure Cosmos DB для MongoDB.
