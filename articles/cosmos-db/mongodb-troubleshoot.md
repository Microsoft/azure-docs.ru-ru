---
title: Устранение распространенных ошибок в API Azure Cosmos DB для Mongo DB
description: В этом документе обсуждаются способы устранения распространенных проблем, возникающих в API Azure Cosmos DB для MongoDB.
author: christopheranderson
ms.service: cosmos-db
ms.subservice: cosmosdb-mongo
ms.topic: troubleshooting
ms.date: 07/15/2020
ms.author: chrande
ms.openlocfilehash: f4ed242dced4798f5f416dae90ef2d6b6bde0e06
ms.sourcegitcommit: d49bd223e44ade094264b4c58f7192a57729bada
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/02/2021
ms.locfileid: "99258190"
---
# <a name="troubleshoot-common-issues-in-azure-cosmos-dbs-api-for-mongodb"></a>Устранение распространенных неполадок в API Azure Cosmos DB для MongoDB
[!INCLUDE[appliesto-mongodb-api](includes/appliesto-mongodb-api.md)]

В следующей статье описаны распространенные ошибки и решения для развертываний с помощью Azure Cosmos DB API для MongoDB.

>[!Note]
> В Azure Cosmos DB не размещен модуль MongoDB. Он предоставляет реализацию протокола Wire MongoDB. Поэтому некоторые из этих ошибок находятся только в API Azure Cosmos DB для MongoDB. 

## <a name="common-errors-and-solutions"></a>Распространенные ошибки и способы их устранения

| Код       | Ошибка                | Описание  | Решение  |
|------------|----------------------|--------------|-----------|
| 2 | Путь индекса, соответствующий указанному элементу упорядочения, исключается, или запрос ORDER BY не имеет соответствующего составного индекса, из которого он может быть обслужен. | Запрос вызывает сортировку по неиндексированному полю. | Создание совпадающего индекса (или составного индекса) для предпринятого запроса сортировки. |
| 13 | Не авторизовано | В запросе отсутствуют разрешения на завершение. | Убедитесь, что установлены соответствующие разрешения для базы данных и коллекции.  |
| 16 | инвалидленгс | Указанный запрос имеет недопустимую длину. | Если вы используете функцию объяснить (), убедитесь, что вы предоставляете только одну операцию. |
| 26 | намеспаценотфаунд | Не удается найти базу данных или коллекцию, на которую указывает ссылка в запросе. | Убедитесь, что имя базы данных или коллекции точно соответствует имени в запросе.|
| 50 | ексцеедедтимелимит | Время запроса превысило время ожидания выполнения на 60 с. |  Эта ошибка может быть вызвана многими причинами. Одна из причин заключается в том, что количество выделенных единиц запроса недостаточно для выполнения запроса. Эту проблему можно устранить, увеличив единицы запроса этой коллекции или базы данных. В других случаях эту ошибку можно обойти, разделив большой запрос на более мелкие. Повторная попытка операции записи, которая получила эту ошибку, может привести к дублированию записи. <br><br>Если вы пытаетесь удалить большие объемы данных, не влияя на RUs: <br>— Рекомендуется использовать TTL (на основе метки времени): [срок действия данных истекает с помощью API Azure Cosmos DB для MongoDB](https://docs.microsoft.com/azure/cosmos-db/mongodb-time-to-live) <br>— Используйте размер курсора или пакета для выполнения удаления. Вы можете извлекать и удалять по одному документу за цикл. Это позволит вам постепенно удалять данные, не влияя на работу рабочего приложения.|
| 61 | шардкэйнотфаунд | Документ в запросе не содержал ключ сегмента коллекции (Azure Cosmos DB ключ секции). | Убедитесь, что в запросе используется ключ сегмента коллекции.|
| 66 | иммутаблефиелд | Запрос пытается изменить неизменяемое поле | поля "ID" являются неизменяемыми. Убедитесь, что запрос не пытается обновить это поле. |
| 67 | канноткреатеиндекс | Не удается завершить запрос на создание индекса. | В контейнере можно создать до 500 индексов одного поля. В составной индекс можно включать до восьми полей (составные индексы поддерживаются в версии 3.6 +). |
| 115 | комманднотсуппортед | Предпринятая попытка запроса не поддерживается. | В сообщении об ошибке должны быть указаны дополнительные сведения. Если эта функция важна для ваших развертываний, сообщите нам о создании запроса в службу поддержки на [портал Azure](https://portal.azure.com/?#blade/Microsoft_Azure_Support/HelpAndSupportBlade). |
| 11000 | дупликатекэй | Ключ сегмента (Azure Cosmos DB ключ секции) вставляемого документа уже существует в коллекции или нарушено ограничение уникального индекса. | Используйте функцию Update () для обновления существующего документа. Если ограничение уникального поля индекса нарушено, вставьте или обновите документ со значением поля, которое еще не существует в сегменте или секции. |
| 16500 | TooManyRequests  | Общее число использованных единиц запроса превысило число, подготовленное для коллекции, и было отрегулировано. | Рекомендуем масштабировать пропускную способность, назначенную контейнеру или набору контейнеров на портале Azure, или можно выполнить операцию еще раз. При [включении SSR](prevent-rate-limiting-errors.md) (Повтор на стороне сервера) Azure Cosmos DB автоматически повторяет запросы, которые не удалось выполнить из-за этой ошибки. |
| 16501 | ExceededMemoryLimit | Так как в этой службе несколько клиентов, операция превысила выделенную память для клиента. | Уменьшите область операции, применив более строгие критерии запроса, или обратитесь в службу поддержки на [портале Azure](https://portal.azure.com/?#blade/Microsoft_Azure_Support/HelpAndSupportBlade). Например, `db.getCollection('users').aggregate([{$match: {name: "Andy"}}, {$sort: {age: -1}}]))`. |
| 40324 | Нераспознанное имя этапа конвейера. | Имя этапа в запросе конвейера агрегирования не распознано. | Убедитесь, что все имена конвейеров агрегирования являются допустимыми в запросе. |
| - | Проблемы с версией протокола в MongoDB | Более старые версии драйверов MongoDB не могут обнаружить имя учетной записи Azure Cosmos в строках подключения. | Добавьте *AppName = @**AccountName** @* в конце API Cosmos DB для строки подключения к MongoDB, где ***AccountName** _ — это имя учетной записи Cosmos DB. |
| - | MongoDB клиентские сетевые проблемы (например, исключения сокетов или endOfStream)| Не удалось выполнить сетевой запрос. Часто это вызвано неактивным подключением TCP, которое пытается использовать клиент MongoDB. Драйверы MongoDB часто используют пулы соединений, что приводит к произвольному соединению, выбранному из пула, используемого для запроса. Неактивные подключения обычно имеют время ожидания Azure Cosmos DB окончания через четыре минуты. | Вы можете повторить эти неудачные запросы в коде приложения, изменить параметры клиента MongoDB, чтобы разоактивировать неактивные TCP-подключения до истечения времени ожидания в течение 4 минут, или настроить параметры проверки активности ОС для поддержания TCP-подключений в активном состоянии.<br><br>Чтобы не получать сообщения о подключении, вы можете изменить строку подключения, установив для параметра maxConnectionIdleTime значение 1–2 мин.<br>-Mongo драйвер: Настройка _maxIdleTimeMS = 120000 * <br>-Node.JS: Configure *соккеттимеаутмс = 120000*, *аутореконнект* = true, *keepAlive* = true, *кипаливеинитиалделай* = 3 минуты

## <a name="next-steps"></a>Дальнейшие действия

- Узнайте, как [использовать Studio 3T](mongodb-mongochef.md) с API Azure Cosmos DB для MongoDB.
- Узнайте, как [использовать Robo 3T](mongodb-robomongo.md) с API Azure Cosmos DB для MongoDB.
- Ознакомьтесь с [примерами](mongodb-samples.md) MongoDB с API Azure Cosmos DB для MongoDB.
