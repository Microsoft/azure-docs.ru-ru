---
title: Устранение неполадок с сообщением "слишком большой заголовок запроса" или 400 неверного запроса в Azure Cosmos DB
description: Узнайте, как диагностировать и устранить исключение слишком большого заголовка запроса.
author: j82w
ms.service: cosmos-db
ms.subservice: cosmosdb-sql
ms.date: 07/13/2020
ms.author: jawilley
ms.topic: troubleshooting
ms.reviewer: sngun
ms.custom: devx-track-dotnet
ms.openlocfilehash: a14503bc56777563b6360143efaa86a136b22278
ms.sourcegitcommit: 867cb1b7a1f3a1f0b427282c648d411d0ca4f81f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "93340526"
---
# <a name="diagnose-and-troubleshoot-azure-cosmos-db-request-header-too-large-message"></a>Диагностика и устранение неполадок Azure Cosmos DB сообщения "слишком большой заголовок запроса"
[!INCLUDE[appliesto-sql-api](includes/appliesto-sql-api.md)]

Сообщение "слишком большой заголовок запроса" вызывается с кодом ошибки HTTP 400. Эта ошибка возникает, если размер заголовка запроса увеличился настолько крупнее, что он превышает максимально допустимый размер. Рекомендуется использовать последнюю версию пакета SDK. Используйте по меньшей мере версии 3. x или 2. x, так как эти версии добавляют в сообщение об исключении трассировку размера заголовка.

## <a name="troubleshooting-steps"></a>Действия по устранению неполадок
Сообщение "слишком большой заголовок запроса" появляется, если сеанс или маркер продолжения слишком велики. В следующих разделах описывается причина проблемы и ее решение в каждой категории.

### <a name="session-token-is-too-large"></a>Токен сеанса слишком велик

#### <a name="cause"></a>Причина.
Наиболее вероятный сбой запроса 400 из-за слишком большого размера маркера сеанса. Если следующие инструкции имеют значение true, маркер сеанса слишком велик:

* Эта ошибка возникает в операциях с точками, таких как создание, чтение и обновление там, где нет токена продолжения.
* Исключение запущено без внесения изменений в приложение. Маркер сеанса растет по мере увеличения числа секций в контейнере. Количество секций увеличивается по мере увеличения объема данных или увеличения пропускной способности.

#### <a name="temporary-mitigation"></a>Временное снижение: 
Перезапустите клиентское приложение, чтобы сбросить все токены сеанса. В конечном итоге маркер сеанса будет расти до предыдущего размера, вызвавшего ошибку. Чтобы полностью избежать этой проблемы, используйте решение в следующем разделе.

#### <a name="solution"></a>Решение.
1. Следуйте указаниям в статьях с советами по повышению производительности [.NET v3](performance-tips-dotnet-sdk-v3-sql.md) или [.NET v2](performance-tips.md) . Преобразуйте приложение для использования режима прямого подключения с протоколом TCP. Режим прямого соединения с протоколом TCP не имеет ограничений на размер заголовка, таких как протокол HTTP, поэтому это позволяет избежать этой проблемы. Обязательно используйте последнюю версию пакета SDK, которая содержит исправление для операций запросов, если взаимодействие служб недоступно.
1. Если режим прямого подключения с протоколом TCP не является параметром для вашей рабочей нагрузки, его можно уменьшить, изменив [уровень согласованности клиента](how-to-manage-consistency.md). Токен сеанса используется только для обеспечения согласованности сеанса, что является уровнем согласованности по умолчанию для Azure Cosmos DB. Другие уровни согласованности не используют токен сеанса.

### <a name="continuation-token-is-too-large"></a>Слишком большой токен продолжения

#### <a name="cause"></a>Причина.
Недопустимый запрос 400 происходит в операциях запроса, когда токен продолжения используется, если маркер продолжения увеличился слишком много или если разные запросы имеют разные размеры маркеров продолжения.
    
#### <a name="solution"></a>Решение.
1. Следуйте указаниям в статьях с советами по повышению производительности [.NET v3](performance-tips-dotnet-sdk-v3-sql.md) или [.NET v2](performance-tips.md) . Преобразуйте приложение для использования режима прямого подключения с протоколом TCP. Режим прямого соединения с протоколом TCP не имеет ограничений на размер заголовка, таких как протокол HTTP, поэтому это позволяет избежать этой проблемы. 
1. Если режим прямого подключения с протоколом TCP не является параметром для вашей рабочей нагрузки, задайте `ResponseContinuationTokenLimitInKb` параметр. Этот параметр можно найти в `FeedOptions` версии 2 или `QueryRequestOptions` 3.

## <a name="next-steps"></a>Дальнейшие действия
* [Диагностика и устранение неполадок](troubleshoot-dot-net-sdk.md) при использовании пакета SDK для Azure Cosmos DB .NET.
* Ознакомьтесь с рекомендациями по производительности для [.NET v3](performance-tips-dotnet-sdk-v3-sql.md) и [.NET v2](performance-tips.md).
