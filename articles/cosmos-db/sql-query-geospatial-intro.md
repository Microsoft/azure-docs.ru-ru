---
title: Данные о геопространственном и географическом расположении в Azure Cosmos DB
description: Узнайте, как создавать пространственные объекты с помощью Azure Cosmos DB и API SQL.
author: timsander1
ms.service: cosmos-db
ms.subservice: cosmosdb-sql
ms.topic: conceptual
ms.date: 02/25/2021
ms.author: tisande
ms.custom: devx-track-js
ms.openlocfilehash: b20c72ae3ed8a8fffa02fc3a2c86f9f73ba2663b
ms.sourcegitcommit: c27a20b278f2ac758447418ea4c8c61e27927d6a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/03/2021
ms.locfileid: "101692136"
---
# <a name="geospatial-and-geojson-location-data-in-azure-cosmos-db"></a>Данные о геопространственном и географическом расположении в Azure Cosmos DB
[!INCLUDE[appliesto-sql-api](includes/appliesto-sql-api.md)]

Эта статья содержит вводную информацию о геопространственной функциональности Azure Cosmos DB. После ознакомления с нашей документацией по геопространственной индексации вы сможете ответить на следующие вопросы:

* Как хранить пространственные данные в Azure Cosmos DB?
* Как запросить пространственные данные в Azure Cosmos DB в SQL и LINQ?
* Как включить или отключить пространственное индексирование в Azure Cosmos DB?

## <a name="spatial-data-use-cases"></a>Варианты использования пространственных данных

Геопространственные данные часто используют запросы с близостью, например "найти все кафе поблизости в текущем расположении". Распространенные варианты использования:

* Аналитика географического расположения, управление конкретными размещенными маркетинговым инициативами.
* Персонализация на основе местоположения для нескольких отраслей, таких как розничная торговля и здравоохранение.
* Улучшение логистики для оптимизации транспорта.
* Анализ рисков, особенно для страховых и финансовых компаний.
* Осведомленность о состоянии для оповещений и уведомлений.

## <a name="introduction-to-spatial-data"></a>Общие сведения о пространственных данных

Пространственные данные описывают положение и форму объектов в пространстве. В большинстве приложений они соответствуют объектам на поверхности Земли и геопространственным данным. Пространственные данные могут использоваться для представления местонахождения человека, мест, представляющих интерес, или границ города или озера.

API-интерфейс SQL Azure Cosmos DB поддерживает два пространственных типа данных: тип данных **Geometry** и тип данных **Geography** .

- Тип **Geometry** представляет данные в евклидово (плоской) системе координат
- Пространственный тип данных **geography** представляет данные в системе координат для сферической Земли.

## <a name="supported-data-types"></a>Поддерживаемые типы данных

Azure Cosmos DB поддерживает индексацию и запросы к геопространственным данным точки, представляемым [спецификацией GeoJSON](https://tools.ietf.org/html/rfc7946). Структуры данных GeoJSON всегда являются действительными объектами JSON, поэтому их можно сохранять и опрашивать с помощью Azure Cosmos DB без специальных средств или библиотек.

Azure Cosmos DB поддерживает следующие пространственные типы данных:

- Точка
- LineString
- Многоугольник
- MultiPolygon

### <a name="points"></a>точки

**Точка** обозначает одно положение в пространстве. В геопространственных данных точка представляет точное расположение, которое может быть адресом продуктового магазина, киоска, точкой расположения автомобиля или города.  В GeoJSON (и Azure Cosmos DB) точка представляется в виде пары координат или широты и долготы.

Вот пример JSON для точки:

**Точки в базе данных Azure Cosmos DB**

```json
{
    "type":"Point",
    "coordinates":[ 31.9, -4.8 ]
}
```

Пространственные типы данных могут быть внедрены в документ Azure Cosmos DB, как показано в этом примере профиля пользователя, содержащего данные о расположении:

**Использование профиля с данными о местоположении, которые хранятся в Azure Cosmos DB**

```json
{
    "id":"cosmosdb-profile",
    "screen_name":"@CosmosDB",
    "city":"Redmond",
    "topics":[ "global", "distributed" ],
    "location":{
        "type":"Point",
        "coordinates":[ 31.9, -4.8 ]
    }
}
```

### <a name="points-in-a-geometry-coordinate-system"></a>Точки в геометрической системе координат

Для типа данных **Geometry** в спецификации геоjson сначала указывается горизонтальная ось и вертикальная ось.

### <a name="points-in-a-geography-coordinate-system"></a>Точки в географической системе координат

Для типа данных **Geography спецификация географического** формата JSON сначала определяет долготу и широту секунд. Как и в других картах, широта и долгота представляют собой углы и выражаются в градусах. Значение долготы отсчитывается от нулевого меридиана и находится в диапазоне от –180 до 180.0 градусов, а значение широты отсчитывается от экватора и находится в диапазоне от –90.0 до 90.0 градусов.

В Azure Cosmos DB координаты интерпретируются в соответствии с системой координат WGS-84. Дополнительные сведения о системах координат см. ниже.

### <a name="linestrings"></a>LineString

**Объект LineString** представляет собой последовательность из двух или более точек в пространстве и отрезков, которые их соединяют. В геопространственных данных объекты LineString обычно используются для представления автомагистралей или рек.

**LineString в геоjson**

```json
    "type":"LineString",
    "coordinates":[ [
        [ 31.8, -5 ],
        [ 31.8, -4.7 ]
    ] ]
```

### <a name="polygons"></a>многоугольники

**Многоугольник** представляет собой область, ограниченную соединенными друг с другом точками, которая образует замкнутый объект LineString. Многоугольники обычно используются для представления естественных природных образований, таких как озера, или географических единиц, таких как города и области. Ниже приведен пример многоугольника в Azure Cosmos DB.

**Многоугольники в GeoJSON**

```json
{
    "type":"Polygon",
    "coordinates":[ [
        [ 31.8, -5 ],
        [ 32, -5 ],
        [ 32, -4.7 ],
        [ 31.8, -4.7 ],
        [ 31.8, -5 ]
    ] ]
}
```

> [!NOTE]
> По спецификации GeoJSON для действительного многоугольника последняя пара координат должна совпадать с первой, чтобы фигура стала замкнутой.
>
> Точки внутри многоугольника должны указываться в порядке против часовой стрелки. Если точки указаны в порядке по часовой стрелке, то многоугольник представляет регион, расположенный снаружи от него.
>
>

### <a name="multipolygons"></a>MultiPolygon

**Многоугольный** — это массив из нуля или более многоугольников. **Многоугольные многоугольники** не могут перекрывать сторону или иметь общую область. Они могут касаться одной или нескольких точек.

**Многомногоугольники в геоjson**

```json
{
    "type":"MultiPolygon",
    "coordinates":[[[
        [52.0, 12.0],
        [53.0, 12.0],
        [53.0, 13.0],
        [52.0, 13.0],
        [52.0, 12.0]
        ]],
        [[
        [50.0, 0.0],
        [51.0, 0.0],
        [51.0, 5.0],
        [50.0, 5.0],
        [50.0, 0.0]
        ]]]
}
```

## <a name="coordinate-reference-systems"></a>Системы координат

Поскольку форма земли является неравномерным, координаты геопространственных данных geography представлены во многих системах координатных ссылок (CR), каждый из которых имеет собственные кадры ссылки и единиц измерения. Например, "Национальная система координат Великобритании" (National Grid of Britain) обладает точностью в Великобритании, но не за ее пределами.

Самой популярной системой координат на данный момент является [WGS-84](https://earth-info.nga.mil/GandG/update/index.php). WGS-84 используют устройства GPS и многие службы географических карт, в том числе Карты Google и API-интерфейсы Карт Bing. Azure Cosmos DB поддерживает индексирование геопространственных данных geography и запросы только с помощью WGS-84 CR.

## <a name="creating-documents-with-spatial-data"></a>Создание документов с пространственными данными
При создании документов, содержащих значения GeoJSON, они автоматически индексируются с пространственным индексом в соответствии с политикой индексирования контейнера. При работе с пакетом SDK Azure Cosmos DB в динамически типизированных языках программирования, таких как Python или Node.js, необходимо создавать действительные объекты GeoJSON.

**Создание документа с геопространственными данными в Node.js**

```javascript
var userProfileDocument = {
    "id":"cosmosdb",
    "location":{
        "type":"Point",
        "coordinates":[ -122.12, 47.66 ]
    }
};

client.createDocument(`dbs/${databaseName}/colls/${collectionName}`, userProfileDocument, (err, created) => {
    // additional code within the callback
});
```

При работе с API-интерфейсами SQL можно использовать `Point` `LineString` классы,, `Polygon` и `MultiPolygon` в `Microsoft.Azure.Cosmos.Spatial` пространстве имен для внедрения сведений о расположении в объекты приложения. Эти классы помогают упростить сериализацию и десериализацию пространственных данных в GeoJSON.

**Создание документа с геопространственными данными в .NET**

```csharp
using Microsoft.Azure.Cosmos.Spatial;

public class UserProfile
{
    [JsonProperty("id")]
    public string id { get; set; }

    [JsonProperty("location")]
    public Point Location { get; set; }

    // More properties
}

await container.CreateItemAsync( new UserProfile
    {
        id = "cosmosdb",
        Location = new Point (-122.12, 47.66)
    });
```

Если у вас нет информации широты и долготы, но у вас есть физические адреса или расположение, например город или страна или регион, можно найти фактические координаты, используя службу геокодирования, например службы Bing Maps для служб RESTFUL. Дополнительные сведения о геокодировании в Картах Bing можно найти [здесь](/bingmaps/rest-services/).

## <a name="next-steps"></a>Дальнейшие действия

Теперь, когда вы ознакомились с предварительными сведениями о поддержке геопространственных данных в Azure Cosmos DB, вы можете сделать следующее:

* Дополнительные сведения о запросах Azure Cosmos DB см. [здесь](sql-query-getting-started.md).
* Дополнительные сведения о [запросе пространственных данных с помощью Azure Cosmos DB](sql-query-geospatial-query.md)
* Дополнительные сведения об [индексировании пространственных данных с помощью Azure Cosmos DB](sql-query-geospatial-index.md)