---
title: Подготовка к переносу данных в API Azure Cosmos DB для MongoDB
description: Этот документ содержит общие сведения о предварительных требованиях к переносу данных из MongoDB в Cosmos DB.
author: anfeldma-ms
ms.service: cosmos-db
ms.subservice: cosmosdb-mongo
ms.topic: how-to
ms.date: 03/02/2021
ms.author: anfeldma
ms.openlocfilehash: cdc5dc9cee3520d9a3f22ff710dfa193e6ef4fed
ms.sourcegitcommit: 910a1a38711966cb171050db245fc3b22abc8c5f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/20/2021
ms.locfileid: "102553295"
---
# <a name="pre-migration-steps-for-data-migrations-from-mongodb-to-azure-cosmos-dbs-api-for-mongodb"></a>Подготовка к переносу данных из MongoDB в API Azure Cosmos DB для MongoDB
[!INCLUDE[appliesto-mongodb-api](includes/appliesto-mongodb-api.md)]

> [!IMPORTANT]  
> Это MongoDB в серии, посвященной переносу MongoDB в Azure Cosmos DB API Mongo в масштабе. Клиенты, выполняющие лицензирование и развертывание MongoDB на самостоятельно управляемой инфраструктуре, могут попытаться сократить затраты на их размещение данных, перейдя в управляемую облачную службу, например Azure Cosmos DB с ценами с оплатой по мере использования и эластичными масштабируемостью. Цель этой серии — пошаговое руководство клиента в процессе миграции:
>
> 1. [Предварительная миграция](mongodb-pre-migration.md) . Инвентаризация существующего MongoDB данных, Планирование миграции и выбор соответствующих средств миграции.
> 2. Выполнение — миграция с MongoDB на Azure Cosmos DB с помощью предоставленных [руководств]().
> 3. [После миграции](mongodb-post-migration.md) — обновите и оптимизируйте существующие приложения, чтобы они выполнялись в соответствии с новой Azure Cosmos DB размещения данных.
>

В твердом плане, выполняемом до миграции, может быть воздействие на временную шкалу и успешность миграции команды. Хорошим аналогом для предварительной миграции является запуск нового проекта. Вы можете начать с определения требований, а затем структурировать задачи, связанные с задачами, а также определить приоритеты основных задач, которые должны быть рассмотрены первыми. Это помогает сделать расписание проекта предсказуемым, но, конечно же, могут возникнуть непредвиденные требования и усложнить расписание проекта. Переход к миграции. создание всеобъемлющего плана выполнения на этапе предварительной миграции снижает вероятность того, что вы обнаружите непредвиденные задачи миграции в конце процесса, экономя время во время миграции и помогающее обеспечить выполнение целей.

Перед переносом данных из MongoDB (локальной или облачной среды) в API Azure Cosmos DB для MongoDB необходимо выполнить следующие действия.

1. [Ознакомьтесь с основными рекомендациями по использованию API Azure Cosmos DB для MongoDB.](#considerations)
2. [Выберите способ переноса данных.](#options)
3. [Оцените пропускную способность, необходимую для рабочих нагрузок.](#estimate-throughput)
4. [Выберите оптимальный ключ секции для данных.](#partitioning)
5. [Поймите принцип работы политики индексирования, которую можно задать для данных.](#indexing)

Если вы уже выполнили описанные выше предварительные требования для переноса, то можете [перенести данные MongoDB в API Azure Cosmos DB для MongoDB с помощью Azure Database Migration Service](../dms/tutorial-mongodb-cosmos-db.md). Кроме того, если вы еще не создали учетную запись, можно ознакомиться с любым из [кратких руководств](create-mongodb-dotnet.md) с инструкциями по созданию учетной записи.

## <a name="considerations-when-using-azure-cosmos-dbs-api-for-mongodb"></a><a id="considerations"></a>Рекомендации по использованию API Azure Cosmos DB для MongoDB

Ниже приведены определенные характеристики API Azure Cosmos DB для MongoDB.

- **Модель емкости**. Емкость базы данных в Azure Cosmos DB определяется посредством модели на основе пропускной способности. Эта модель основана на [единицах запросов в секунду](request-units.md). Это единица измерения, представляющая количество операций с базами данных, которые могут выполняться с коллекцией в секунду. Эту емкость можно выделить на [уровне базы данных или коллекции](set-throughput.md), и ее можно подготовить в модели выделения или с помощью [автомасштабирования подготовленной пропускной способности](provision-throughput-autoscale.md).

- **Единицы запроса**. С каждой операцией базы данных связано определенное число единиц запроса (ЕЗ) в Azure Cosmos DB. При выполнении операции это значение вычитается из доступного уровня единиц запроса в заданную секунду. Если для запроса требуется больше ЕЗ, чем выделено ЕЗ/с, это проблему можно устранить проблему двумя способами — увеличить количество ЕЗ или подождать до начала следующей секунды, а затем повторить операцию.

- **Эластичная емкость**. Емкость заданной коллекции или базы данных может измениться в любое время. Это позволяет гибко адаптировать базу данных к требованиям рабочей нагрузки к пропускной способности.

- **Автоматическое сегментирование**. Azure Cosmos DB предоставляет систему автоматического секционирования, для которой требуется только сегмент (или ключ секции). [Механизм автоматического секционирования](partitioning-overview.md) действует во всех API Azure Cosmos DB. Это позволяет эффективно масштабировать данные и пропускную способность с помощью горизонтального распределения.

## <a name="migration-options-for-azure-cosmos-dbs-api-for-mongodb"></a><a id="options"></a>Способы переноса данных MongoDB в API Azure Cosmos DB

Служба [Azure Database Migration Service для API Azure Cosmos DB для MongoDB](../dms/tutorial-mongodb-cosmos-db.md) предоставляет механизм, который упрощает перенос данных за счет полностью управляемой платформы размещения, параметров мониторинга миграции и автоматического регулирования. Ниже приведен полный список способов переноса.

|**Тип переноса**|**Решение**|**Рекомендации**|
|---------|---------|---------|
|Справка в Интернете|[Azure Database Migration Service](../dms/tutorial-mongodb-cosmos-db-online.md)|&bull; Использует библиотеку исполнителя массовых операций в Azure Cosmos DB. <br/>&bull; Подходит для больших наборов данных и выполняет репликацию динамических изменений. <br/>&bull; Работает только с другими источниками MongoDB.|
|Автономная миграция|[Azure Database Migration Service](../dms/tutorial-mongodb-cosmos-db-online.md)|&bull; Использует библиотеку исполнителя массовых операций в Azure Cosmos DB. <br/>&bull; Подходит для больших наборов данных и выполняет репликацию динамических изменений. <br/>&bull; Работает только с другими источниками MongoDB.|
|Вне сети|[Фабрика данных Azure](../data-factory/connector-azure-cosmos-db.md).|&bull; Простота настройки и поддержка нескольких источников. <br/>&bull; Использует библиотеку исполнителя массовых операций в Azure Cosmos DB. <br/>&bull; Подходит для больших наборов данных. <br/>&bull; Отсутствие контрольных точек означает, что любые проблемы во время переноса потребуют перезапуска всего процесса.<br/>&bull; Отсутствие очереди недоставленных сообщений означает, что несколько ошибочных файлов могут прервать весь процесс переноса. <br/>&bull; Требуется пользовательский код для увеличения пропускной способности чтения для определенных источников данных.|
|Вне сети|[Существующие инструменты Mongo (mongodump, mongorestore, Studio3T)](https://azure.microsoft.com/resources/videos/using-mongodb-tools-with-azure-cosmos-db/)|&bull; Простота настройки и интеграции. <br/>&bull; Требуется настраиваемая обработка регулирования.|

## <a name="estimate-the-throughput-need-for-your-workloads"></a><a id="estimate-throughput"></a> Оценка пропускной способности, необходимой для рабочих нагрузок

В Azure Cosmos DB пропускная способность подготавливается заранее и измеряется в единицах запроса в секунду (ЕЗ/с). В отличие от виртуальных машин или локальных серверов, значение ЕЗ можно легко масштабировать в любой момент. Можно мгновенно изменить число подготовленных ЕЗ. Дополнительные сведения см. в статье [Единицы запроса в базе данных Azure Cosmos DB](request-units.md).

Чтобы определить количество единиц запроса в зависимости от конфигурации учетной записи базы данных, объема данных, размера документа и требуемого числа операций чтения и записи в секунду, можно использовать [калькулятор емкости Azure Cosmos DB](https://cosmos.azure.com/capacitycalculator/).

Ниже приведены ключевые факторы, влияющие на количество ЕЗ.
- **Размер документа**. С увеличением размера элемента или документа число единиц запроса, расходуемых на чтение и запись элемента или документа, также увеличивается.

- **Число свойств документа**. Количество ЕЗ, используемых для создания или обновления документа, связано с числом, сложностью и длиной его свойств. Вы можете сократить потребление единиц запроса для операций записи, [ограничив количество индексируемых свойств](mongodb-indexing.md).

- **Шаблоны запросов**. Сложность запроса влияет на количество единиц запроса, потребляемых этим запросом. 

Лучше всего понять затраты на запросы можно с помощью примера данных в Azure Cosmos DB. [Выполните примеры запросов из оболочки MongoDB](connect-mongodb-account.md) помощью команды `getLastRequestStastistics`, чтобы получить платеж за запрос и просмотреть количество использованных ЕЗ.

`db.runCommand({getLastRequestStatistics: 1})`

Выходные данные этой команды — документ JSON следующего вида:

```{  "_t": "GetRequestStatisticsResponse",  "ok": 1,  "CommandName": "find",  "RequestCharge": 10.1,  "RequestDurationInMilliSeconds": 7.2}```

Можно также использовать [параметры диагностики](cosmosdb-monitor-resource-logs.md), чтобы понять частоту и закономерности запросов, выполняемых в Azure Cosmos DB. Результаты из журналов диагностики можно отправить в учетную запись хранения, экземпляр EventHub или [Azure Log Analytics](../azure-monitor/logs/log-analytics-tutorial.md).  

## <a name="choose-your-partition-key"></a><a id="partitioning"></a>Выбор ключа секции
Секционирование, также называемое сегментированием, является ключевой точкой, которую необходимо рассмотреть перед переносом данных. Azure Cosmos DB использует полностью управляемое секционирование для увеличения емкости базы данных в соответствии с требованиями к хранилищу и пропускной способности. Для этого компонента не требуется размещение или настройка серверов маршрутизации.   

Аналогичным образом функция секционирования автоматически добавляет емкость и соответственно перераспределяет данные. Дополнительные сведения и рекомендации по выбору правильного ключа секции для данных см. статье [Выбор ключа секции](partitioning-overview.md#choose-partitionkey). 

## <a name="index-your-data"></a><a id="indexing"></a>Индексирование данных

API Azure Cosmos DB для MongoDB Server версии 3,6 и более поздних версий автоматически индексирует `_id` только поле. Невозможно удалить это поле. Он автоматически обеспечивает уникальность `_id` поля для каждого ключа сегмента. Для индексирования дополнительных полей применяются [команды управления индексами MongoDB](mongodb-indexing.md). Эта политика индексирования по умолчанию отличается от API SQL для Azure Cosmos DB, где по умолчанию индексируются все поля.

Возможности индексирования, предоставляемые Azure Cosmos DB, включают добавление составных индексов, уникальных индексов и индексов срока жизни (TTL). Интерфейс управления индексами сопоставляется с командой `createIndex()`. Дополнительные сведения см. [в статье об индексировании Azure Cosmos DB API для MongoDB](mongodb-indexing.md).

Служба [Azure Database Migration Service](../dms/tutorial-mongodb-cosmos-db.md) автоматически переносит коллекции MongoDB с уникальными индексами. Однако перед переносом эти уникальные индексы необходимо создать. Azure Cosmos DB не поддерживает создание уникальных индексов, если в коллекциях уже есть данные. Дополнительные сведения см. в статье об [уникальных ключах в Azure Cosmos DB](unique-keys.md).

## <a name="next-steps"></a>Дальнейшие действия
* [Перенесите данные MongoDB в Cosmos DB с помощью Database Migration Service.](../dms/tutorial-mongodb-cosmos-db.md) 
* [Подготовка пропускной способности в контейнерах и базах данных Azure Cosmos](set-throughput.md)
* [Partitioning in Azure Cosmos DB](partitioning-overview.md) (Секционирование в Azure Cosmos DB)
* [Глобальное распределение в Azure Cosmos DB](distribute-data-globally.md)
* [Индексирование в Azure Cosmos DB](index-overview.md)
* [Единицы запросов в Azure Cosmos DB](request-units.md)
