---
title: Создание оповещений для Azure Cosmos DB с помощью Azure Monitor
description: Узнайте, как настроить оповещения для Azure Cosmos DB с помощью Azure Monitor.
author: SnehaGunda
ms.author: sngun
ms.service: cosmos-db
ms.devlang: dotnet
ms.topic: how-to
ms.date: 07/16/2020
ms.openlocfilehash: e29db7e31438bc7f6ac609384d0d9b92c275e813
ms.sourcegitcommit: 867cb1b7a1f3a1f0b427282c648d411d0ca4f81f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "93339552"
---
# <a name="create-alerts-for-azure-cosmos-db-using-azure-monitor"></a>Создание оповещений для Azure Cosmos DB с помощью Azure Monitor
[!INCLUDE[appliesto-all-apis](includes/appliesto-all-apis.md)]

Оповещения используются для настройки повторяющихся тестов, чтобы отслеживать доступность и скорость реагирования ресурсов Azure Cosmos DB. Оповещения могут отправлять вам уведомления в виде сообщения электронной почты или выполнять функцию Azure, когда одна из метрик достигает порогового значения или если в журнале действий регистрируется определенное событие.

Вы можете получать оповещения на основе метрик или событий журнала действий в учетной записи Azure Cosmos:

* **Метрики** — оповещение активируется, когда значение указанной метрики пересекается с назначенным пороговым значением. Например, если количество потребляемых единиц запроса превышает 1000 единиц запросов в секунду. Это оповещение активируется как при первом выполнении условия, так и после того, как выполнение этого условия прекращается. Различные метрики, доступные в Azure Cosmos DB, см. в статье [Справочник по данным мониторинга](monitor-cosmos-db-reference.md#metrics) .

* **События журнала действий** — это оповещение активируется при возникновении определенного события. Например, при доступе или обновлении ключей учетной записи Azure Cosmos.

Оповещения можно настроить из панели Azure Cosmos DB или службы Azure Monitor в портал Azure. Оба интерфейса предлагают одинаковые параметры. В этой статье показано, как настроить оповещения для Azure Cosmos DB с помощью Azure Monitor.

## <a name="create-an-alert-rule"></a>Создание правила оповещения

В этом разделе показано, как создать оповещение при получении кода состояния HTTP 429, который получается, если количество запросов ограничено. Например, если имеется 100 или более запросов с ограниченным количеством ограничений, может потребоваться получить предупреждение. В этой статье показано, как настроить оповещение для такого сценария с помощью кода состояния HTTP. Аналогичные действия можно использовать для настройки других типов оповещений. вам нужно просто выбрать другое условие в зависимости от требований.

1. Войдите в [портал Azure.](https://portal.azure.com/)

1. Выберите **монитор** на панели навигации слева и щелкните **оповещения**.

1. Нажмите кнопку Создать правило генерации оповещений, чтобы открыть панель Создание правила генерации оповещений.  

1. Заполните раздел **Scope (область** ):

   * Откройте панель **Выбор ресурсов** и настройте следующие параметры.

   * Выберите имя **подписки** .

   * Выберите **учетные записи Azure Cosmos DB** для **типа ресурса**.

   * **Расположение** учетной записи Azure Cosmos.

   * После заполнения сведений отобразится список учетных записей Azure Cosmos в выбранной области. Выберите ту, для которой нужно настроить оповещения, и нажмите кнопку **Готово**.

1. Заполните раздел **условия** :

   * Откройте панель **Выбор условия** , чтобы открыть страницу **Настройка логики сигнала** и настроить следующие параметры.

   * Выберите сигнал. **Тип сигнала** может быть **метрикой** или **журналом действий**. Выберите **метрики** для этого сценария. Так как вы хотите получать оповещение при наличии проблем с ограничением скорости для общей метрики единиц запросов.

   * Выберите **все** для **службы мониторинга** .

   * Выберите **имя сигнала**. Чтобы получить оповещение для кодов состояния HTTP, выберите сигнал **общего числа единиц запроса** .

   * На следующей вкладке можно определить логику для активации предупреждения и использовать диаграмму для просмотра тенденций учетной записи Azure Cosmos. Метрика " **Общая единица запросов** " поддерживает измерения. Эти измерения позволяют фильтровать по метрике. Если ни одно измерение не выбрано, это значение игнорируется.

   * Выберите **StatusCode** в качестве **имени измерения**. Выберите **Добавить пользовательское значение** и задайте для кода состояния значение 429.

   * В **логике оповещений** установите **пороговое значение** **static**. В статическом пороговом значении для вычисления правила используется заданное пользователем пороговое значение, тогда как динамические пороговые значения используют встроенные алгоритмы машинного обучения для непрерывного изучения шаблона поведения метрики и автоматического вычисления порогов.

   * Задайте для **оператора** значение **больше**, для параметра **тип агрегирования** — **итог**, а для **порогового значения** — **100**. В этой логике, если клиент видит более 100 запросов, имеющих код состояния 429, оповещение активируется. Можно также настроить тип статистической обработки, гранулярность статистической обработки и частоту оценки в зависимости от требований.

   * После заполнения формы выберите **Готово**. На следующем снимке экрана показаны подробные сведения о логике оповещения.

     :::image type="content" source="./media/create-alerts/configure-alert-logic.png" alt-text="Настройка логики для получения оповещений для запросов с ограничением скорости или 429":::

1. Заполните раздел **группы действий** :

   * На панели **создать правило** выберите существующую группу действий или создайте новую группу действий. Группа действий позволяет определить действие, выполняемое при возникновении условия оповещения. В этом примере создайте новую группу действий для получения уведомления по электронной почте при активации оповещения. Откройте панель **Добавить группу действий** и заполните следующие сведения:

   * **Имя группы действий** . имя группы действий должно быть уникальным в пределах группы ресурсов.

   * **Краткое имя** — короткое имя группы действий. это значение включается в сообщение электронной почты и SMS-уведомления, чтобы узнать, какая группа действий является источником уведомления.

   * Выберите подписку и группу ресурсов, в которых будет создана эта группа действий.  

   * Укажите имя действия и выберите в качестве **типа действия**"Электронная почта", "SMS-сообщение", "Отправка" или " **Передача/речь** ". На следующем снимке экрана показаны подробные сведения о типе действия:

     :::image type="content" source="./media/create-alerts/configure-alert-action-type.png" alt-text="Настройте тип действия, например уведомление по электронной почте для получения оповещения.":::

1. Заполните раздел **сведений о правиле генерации оповещений** :

   * Определите имя правила, укажите необязательное описание, степень серьезности предупреждения, выберите, следует ли включить правило после создания правила, а затем выберите **создать правило оповещение** , чтобы создать оповещение для правила метрики.

После создания оповещения оно будет активно в течение 10 минут.

## <a name="common-alerting-scenarios"></a>Распространенные сценарии предупреждений

Ниже приведены некоторые сценарии, в которых можно использовать оповещения.

* При обновлении ключей учетной записи Azure Cosmos.
* Если данные или индексы контейнера, базы данных или региона превышают определенное число байтов.
* Если нормализованное потребление единиц запросов/s превышает определенный процент. Нормализованная метрика потребления единиц запросов выдает максимальный уровень использования пропускной способности в наборе реплик. Дополнительные сведения см. в статье [как отслеживать нормализованные сведения о единицах запросов в секунду](monitor-normalized-request-units.md) .  
* При добавлении или удалении региона, а также при переходе в режим «вне сети».
* При создании, удалении или обновлении базы данных или контейнера.
* При изменении пропускной способности базы данных или контейнера.

## <a name="next-steps"></a>Дальнейшие действия

* Как [отслеживать нормализованную метрику единиц запросов в секунду](monitor-normalized-request-units.md) в контейнере Azure Cosmos.
* [Мониторинг пропускной способности или использования единиц запросов](monitor-request-unit-usage.md) для операции в Azure Cosmos DB.