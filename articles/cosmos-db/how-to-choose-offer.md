---
title: Выбор между ручным и автомасштабированием Azure Cosmos DB
description: Узнайте, как выбрать стандартную (ручную) подготовленную пропускную способность и Автомасштабирование для рабочей нагрузки.
author: deborahc
ms.service: cosmos-db
ms.topic: conceptual
ms.date: 08/19/2020
ms.author: dech
ms.openlocfilehash: d8a6471d53ad4b2428504f9c53cbec6bc1967c49
ms.sourcegitcommit: 910a1a38711966cb171050db245fc3b22abc8c5f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "93089646"
---
# <a name="how-to-choose-between-standard-manual-and-autoscale-provisioned-throughput"></a>Как сделать выбор между стандартной (ручной) и автомасштабируемой подготовленной пропускной способностью 
[!INCLUDE[appliesto-all-apis](includes/appliesto-all-apis.md)]

Azure Cosmos DB поддерживает два типа (или предложения) подготовленной пропускной способности: стандартный (ручной) и автомасштабируемый. Оба типа пропускной способности подходят для критически важных рабочих нагрузок, требующих высокой производительности и масштабирования, и поддерживаются одними и теми же соглашениями об уровне обслуживания Azure Cosmos DB в отношении пропускной способности, доступности, задержки и согласованности.

Эта статья рассказывает о том, как сделать правильный выбор между стандартной (ручной) и автомасштабируемой подготовленной пропускной способностью для рабочей нагрузки. 

## <a name="overview-of-provisioned-throughput-types"></a>Общие сведения о подготовленных типах пропускной способности
Прежде чем коснуться различий между стандартным (ручным) и автомасштабируемым типами, важно сначала понять, как работает подготовленная пропускная способность в Azure Cosmos DB. 

При использовании подготовленной пропускной способности вы задаете пропускную способность, измеряемую в единицах запросов в секунду (ЕЗ/с), необходимых для вашей рабочей нагрузки. Служба подготавливает производительность, необходимую для поддержки требований к пропускной способности. Операции базы данных для службы, например операции чтения, записи и запросы, потребляют некоторый объем единиц запросов (ЕЗ). Дополнительные сведения о [единицах запросов](request-units.md).

В следующей таблице показано общее сравнение стандартного (ручного) и автомасштабируемого типов пропускной способности.

|Описание|Стандартный (ручной)|Автомасштабирование|
|-------------|------|-------|
|Лучше всего подходит для|Рабочих нагрузок с постоянным или предсказуемым трафиком|Рабочих нагрузок с переменным или непредсказуемым трафиком См. раздел [варианты использования автомасштабирования](provision-throughput-autoscale.md#use-cases-of-autoscale).|
|Принцип работы|Вы подготавливаете заданное количество ЕЗ/с `T`, статичное во времени, пока вы не измените это значение вручную. Каждую секунду можно использовать пропускную способность до `T` ЕЗ/с. <br/><br/>Например, если задать значение 400 ЕЗ/с для стандартной (ручной) пропускной способности, она будет постоянно находиться на указанном уровне.|Вы указываете наибольшее или максимальное количество ЕЗ/с `Tmax`, которое система не должна превышать. Система автоматически масштабирует пропускную способность `T` таким образом, чтобы она не превышала `0.1* Tmax <= T <= Tmax`. <br/><br/>Например, если задать максимальное значение для автомасштабирования, равное 4 000 ЕЗ/с, система будет масштабировать количество запросов в пределах 400–4 000 ЕЗ/с.|
|Сценарии использования|Вы хотите вручную управлять емкостью пропускной способности (ЕЗ/с) и масштабировать ее самостоятельно.<br/><br/>У вас высокое, стабильное использование подготовленных единиц запросов в секунду. Если вы установили подготовленное значение единиц запросов в секунду `T` и использовали 66 % от запланированных часов в месяц и более, по расчетам, вы сэкономите благодаря стандартному (ручному) значению подготовленных ЕЗ/с.<br/><br/>Это основано на сравнении значения параметра `T` при использовании стандартного (ручного) типа и того же количества `Tmax` при автомасштабировании. |Вы хотите управлять пропускной способностью (ЕЗ/с) и масштабированием на основе использования с помощью Azure Cosmos DB.<br/><br/>Число используемых единиц запросов в секунду у вас меняется, или его сложно прогнозировать. Если для автомасштабирования вы установили максимальное значение единиц запросов в секунду `Tmax` и использовали все это количество (`Tmax`) для 66 % от запланированных часов в месяц и менее, по расчетам, вы сэкономите благодаря автомасштабированию.<br/><br/>Это основано на сравнении значения параметра `Tmax` при автомасштабировании и того же количества `T` при использовании стандартного (ручного) типа.|
|Модель выставления счетов|Выставление счетов выполняется почасово для подготовленного числа единиц запросов в секунду, независимо от того, сколько их было использовано.<br/><br/>Пример <li>Подготовлено 400 ЕЗ/с</li><li>Час 1: нет запросов</li><li>Час 2: 400 единиц запросов в секунду</li><br/><br/>За оба часа 1 и 2 будет взиматься одинаковая плата за 400 единиц запросов в секунду по [тарифам за стандартный (ручной) тип масштабирования пропускной способности](https://azure.microsoft.com/pricing/details/cosmos-db/).|Выставление счетов выполняется на почасовой основе по максимальному количеству единиц запросов в секунду, до которого система выполняла масштабирование в течение часа. <br/><br/>Пример <li>Подготовленная максимальная пропускная способность для автомасштабирования: 4 000 ЕЗ/с (с масштабированием от 400 до 4 000 ЕЗ/с)</li><li>Час 1: система масштабировала пропускную способность до максимального значения в 3 500 ЕЗ/с</li><li>Час 2: система масштабировала пропускную способность до максимального значения в 400 ЕЗ/с (всегда 10 % от `Tmax`) из-за неиспользования</li><br/><br/>Счет выставляется за 3 500 ЕЗ/с за час 1 и 400 ЕЗ/с за час 2 согласно [тарифам на автомасштабирование подготовленной пропускной способности](https://azure.microsoft.com/pricing/details/cosmos-db/). Тариф на автомасштабирование за единицу запросов в секунду составляет 1,5 * тариф на стандартный (ручной) тип масштабирования пропускной способности.
|Что происходит при превышении количества подготовленных единиц запросов в секунду|Значение ЕЗ/с остается статичным по отношению к подготовленному значению. Все запросы, потребляемые свыше подготовленного значения единиц запросов в секунду, будут ограничены по скорости и получат отклик с рекомендацией подождать, прежде чем совершить повторную попытку. При необходимости можно вручную увеличить или уменьшить количество единиц запросов в секунду.| При автомасштабировании система будет увеличивать количество единиц запросов в секунду до максимального числа ЕЗ/с. Все запросы, потребляемые свыше максимального значения единиц запросов в секунду для автомасштабирования, будут ограничены по скорости и получат отклик с рекомендацией подождать, прежде чем совершить повторную попытку.|

## <a name="understand-your-traffic-patterns"></a>Общие сведения о шаблонах трафика

### <a name="new-applications"></a>Новые приложения ###

Если вы создаете новое приложение и еще не знаете, какой шаблон трафика использовать, вы можете начать с единиц запросов в секунду (или с минимального значения единиц запросов в секунду) для точки входа, чтобы избежать указания слишком большого значения в начале. Или, если у вас небольшое приложение, которое не нуждается в большом масштабе, для оптимизации затрат нужно подготовить лишь минимальное количество единиц запросов в секунду для точки входа. Для небольших приложений с низким ожидаемым трафиком можно также рассмотреть режим [бессерверной](throughput-serverless.md) емкости.

Если вы планируете использовать стандартную (ручную) или Автомасштабирование, то следует учитывать следующее.

Если вы подготовите значение в 400 единиц запросов в секунду для точки входа при стандартном (ручном) масштабировании, то не сможете потреблять больше указанного значения, пока не измените пропускную способность вручную. Вам будет выставлен счет за 400 ЕЗ/с в час при стандартном (ручном) указании подготовленной пропускной способности.

Если вы подготовите максимальное значение пропускной способности в 4000 единиц запросов в секунду для точки входа при автомасштабировании, ресурс будет сам масштабировать пропускную способность в пределах между 400 и 4000 ЕЗ/с. Так как ставка за единицу запросов в секунду при автомасштабировании пропускной способности в 1,5 раза выше ставки стандартного (ручного) масштабирования, за часы, когда система масштабируется до минимального значения в 400 ЕЗ/с, счет будет выше, чем при указании 400 ЕЗ/с вручную. Однако при использовании автомасштабирования в ситуациях, когда трафик приложения сильно меняется, вы сможете потребить до 4000 единиц запросов в секунду без каких-либо действий со стороны пользователя. В общем, следует сопоставить преимущества потребления максимального числа единиц запросов в секунду в любое время с увеличенной в 1,5 раза ставкой на автомасштабирование.

Чтобы оценить требования к пропускной способности, используйте [калькулятор емкости](estimate-ru-with-capacity-planner.md) Azure Cosmos DB. 

### <a name="existing-applications"></a>Существующие приложения ###

Если у вас есть приложение, использующее стандартное (ручное) масштабирование подготовленной пропускной способности, можно использовать [метрики Azure Monitor](../azure-monitor/insights/cosmosdb-insights-overview.md), чтобы определить, подходит ли шаблон трафика для автомасштабирования. 

Сначала найдите [метрику нормализованного потребления единиц запросов](monitor-normalized-request-units.md#view-the-normalized-request-unit-consumption-metric) для базы данных или контейнера. Нормализованное использование показывает, насколько вы используете стандартное (ручное) масштабирование подготовленной пропускной способности. Чем ближе показатель к 100 %, тем больше подготовленных единиц запросов в секунду вы используете. [Подробнее](monitor-normalized-request-units.md#view-the-normalized-request-unit-consumption-metric) о метрике.

Затем определите, как нормализованное использование меняется с течением времени. Нахождение наивысшей нормализованной загрузки для каждого часа. Затем Вычислите среднее нормализованное использование в течение всех часов. Если вы видите, что среднее использование составляет меньше 66 %, попробуйте включить автомасштабирование для базы данных или контейнера. Напротив, если среднее использование превышает 66 %, рекомендуется оставить стандартную (масштабируемую вручную) подготовленную пропускную способность.

> [!TIP]
> Если ваша учетная запись настроена для использования операций записи в несколько регионов и имеет более одного региона, то частота в 100 единиц запросов в секунду одинакова для ручного и автомасштабирования. Это означает, что включение автомасштабирования не влечет за собой дополнительных затрат, независимо от использования. Поэтому всегда рекомендуется использовать Автомасштабирование с записью в нескольких регионах, если у вас есть несколько регионов, чтобы воспользоваться преимуществами экономии только для единиц, масштабируемых приложением до. Если у вас есть операции записи в несколько регионов и один регион, используйте среднее использование, чтобы определить, будет ли снижение затрат. 

#### <a name="examples"></a>Примеры

Давайте взглянем на два разных примера рабочих нагрузок и проанализируем их, если они подходят для пропускной способности вручную или автомасштабирования. Чтобы продемонстрировать общий подход, мы проанализируем три часа истории, чтобы определить разницу в затратах между использованием ручного и автомасштабирования. Для рабочих нагрузок в рабочей среде рекомендуется использовать историю (или более длительную, если она доступна) для создания шаблона использования единиц запросов/с.

> [!NOTE]
> Все примеры, приведенные в этом документе, основаны на ценах на учетную запись Azure Cosmos, развернутую в регионе, не являющемся государственным в США. Цены и вычисления различаются в зависимости от региона, который вы используете. сведения о последних ценах см. на [странице цен](https://azure.microsoft.com/pricing/details/cosmos-db/) на Azure Cosmos DB.

Предполагается, что:
- Предположим, что у нас есть пропускная способность в 30 000 единиц запросов в секунду. 
- Для нашего региона настроена запись в одном регионе с одним регионом. Если у нас есть несколько регионов, то Почасовая стоимость будет умножиться на количество регионов.
- Используйте цены на общедоступную цену за использование вручную ($0,008 долларов США на 100 единиц запросов в час) и пропускную способность автомасштабирования ($0,012 долларов США за 100 единиц запросов в час) в учетных записях записи с одним регионом. Дополнительные сведения см. на [странице с ценами](https://azure.microsoft.com/pricing/details/cosmos-db/) . 

#### <a name="example-1-variable-workload-autoscale-recommended"></a>Пример 1. переменная Рабочая нагрузка (рекомендуется Автомасштабирование)

Во первых, мы рассмотрим нормализованное потребление единиц запросов. Эта Рабочая нагрузка имеет переменный трафик с нормализованным потреблением единиц запросов в диапазоне от 6% до 100%. Возможны случайные всплески в 100%, которые трудно прогнозировать, но много часов с низким уровнем использования. 

:::image type="content" source="media/how-to-choose-offer/variable-workload_use_autoscale.png" alt-text="Рабочая нагрузка с переменным трафиком — нормализованное потребление единиц запросов в диапазоне от 6% до 100% для всех часов":::

Сравните затраты на подготовку к пропускной способности 30 000 единиц запросов в секунду, а также установите для параметра Автомасштабирование Max единиц запросов в секунду значение 30 000 (масштабируется от 3000 до 30 000 единиц запросов в секунду). 

Теперь давайте проанализируем историю. Предположим, что мы используем использование, описанное в следующей таблице. Среднее использование в этих трех часах составляет 39%. Так как нормализованное потребление на ЕДИНИЦу времени в среднем меньше 66%, мы сохраняем с помощью автомасштабирования. 

Обратите внимание, что в час 1 при использовании 6% для автомасштабирования будет выставлен счет за 10% от максимального числа единиц запросов в секунду, что является минимальным числом штук в час. Хотя стоимость автомасштабирования может быть выше, чем пропускная способность вручную в определенные часы, при условии, что среднее использование менее 66% в течение всех часов, автоматическое масштабирование будет дешевле.

|Период времени  | Использование |Счет за Автомасштабирование, выставленный по счету/с  |Вариант 1: вручную 30 000 единиц запросов в секунду  | Вариант 2. Автомасштабирование между 3000-30 000 единиц запросов в секунду |
|---------|---------|---------|---------|---------|
|Час 1  | 6 %  |     3000  |  30 000 * 0,008/100 = $2,40        |   3000 * 0,012/100 = $0,36      |
|Час 2  | 100 %  |     30 000    |  30 000 * 0,008/100 = $2,40       |  30 000 * 0,012/100 = $3,60      |
|Час 3 |  11%  |     3300    |  30 000 * 0,008/100 = $2,40       |    3300 * 0,012/100 = $0,40     |
|**Всего**   |  |        |  $7,20       |    $4,36 (в 39% экономии)    |

#### <a name="example-2-steady-workload-manual-throughput-recommended"></a>Пример 2. Устойчивая Рабочая нагрузка (рекомендуется пропускная способность вручную)

Эта Рабочая нагрузка имеет постоянный трафик с нормализованным потреблением на ЕДИНИЦу в диапазоне от 72% до 100%. При наличии 30 000 единиц запросов в секунду это означает, что мы потребляемся между 21 600 и 30 000 единиц запросов в секунду.

:::image type="content" source="media/how-to-choose-offer/steady_workload_use_manual_throughput.png" alt-text="Рабочая нагрузка с постоянным трафиком — нормализованное потребление единиц запросов в диапазоне от 72% до 100% за все часы":::

Сравните затраты на подготовку к пропускной способности 30 000 единиц запросов в секунду, а также установите для параметра Автомасштабирование Max единиц запросов в секунду значение 30 000 (масштабируется от 3000 до 30 000 единиц запросов в секунду).

Предположим, что у нас есть журнал использования, как описано в таблице. Средний уровень использования в этих трех часах составляет 88%. Так как нормализованное потребление на ЕДИНИЦу времени в среднем превышает 66%, мы сохраняем с помощью пропускной способности вручную.

Как правило, если среднее использование за все 730 часов в течение месяца превышает 66%, то мы будем сохранять с помощью пропускной способности вручную. 

| Период времени | Использование |Счет за Автомасштабирование, выставленный по счету/с  |Вариант 1: вручную 30 000 единиц запросов в секунду  | Вариант 2. Автомасштабирование между 3000-30 000 единиц запросов в секунду |
|---------|---------|---------|---------|---------|
|Час 1  | 72%  |     21 600   |  30 000 * 0,008/100 = $2,40        |   21600 * 0,012/100 = $2,59      |
|Час 2  | 93 %  |     28 000    |  30 000 * 0,008/100 = $2,40       |  28 000 * 0,012/100 = $3,36       |
|Час 3 |  100 %  |     30 000    |  30 000 * 0,008/100 = $2,40       |    30 000 * 0,012/100 = $3,60     |
|**Всего**   |  |        |  $7,20       |    $9,55     |

> [!TIP]
> Для стандартного (ручного) масштабирования пропускной способности можно применить метрику нормализованного использования, чтобы оценить фактическое количество единиц запросов в секунду, которые вы сможете потребить при переключении на автомасштабирование. Умножьте показатель нормализованного использования в конкретный момент времени на текущее значение единиц запросов в секунду в подготовленном стандартном (ручном) типе масштабирования. Например, если вы подготовили 5 000 ЕЗ/с и нормализованное использование составляет 90 %, то использование единиц запросов в секунду составляет 0,9 * 5 000 = 4 500 ЕЗ/с. Если вы видите, что шаблон трафика меняется, но вы указали слишком большое или слишком маленькое значение, вы можете включить автомасштабирование, а затем соответствующим образом изменить параметр максимального числа единиц запросов в секунду.

#### <a name="how-to-calculate-average-utilization"></a>Вычисление среднего уровня использования
Автомасштабирование счетов за максимальный коэффициент единиц запросов в секунду в течение часа. При анализе нормализованного потребления на ЕДИНИЦу времени при вычислении среднего важно использовать максимальное использование в час. 

Чтобы вычислить среднее значение наибольшего использования в течение всех часов:
1. Задайте для **агрегата** метрика потребления норамлизед единицу, равную **Max**.
1. Выберите **время гранулярности** в 1 час.
1. Перейдите к **параметрам диаграммы**.
1. Выберите параметр линейчатая диаграмма. 
1. В разделе **общий доступ** выберите пункт **скачать в Excel** . В созданной электронной таблице Вычислите среднее использование в течение всех часов. 

:::image type="content" source="media/how-to-choose-offer/variable-workload-highest-util-by-hour.png" alt-text="Чтобы просмотреть нормализованное использование единиц запросов в час, 1) выберите гранулярность времени в 1 час. 2) изменить параметры диаграммы; 3) выберите параметр линейчатая диаграмма. 4) в разделе &quot;общий доступ&quot; выберите Скачать в Excel, чтобы вычислить среднее значение в течение всех часов. ":::

## <a name="measure-and-monitor-your-usage"></a>Измерение и отслеживание использования
Спустя некоторое время после выбора типа масштабирования пропускной способности следует понаблюдать за приложением и внести необходимые изменения. 

Если вы применяете автомасштабирование, используйте Azure Monitor, чтобы просмотреть значения подготовленного максимального количества единиц запросов в секунду (**максимальная пропускная способность при автомасштабировании**) и числа единиц запросов в секунду, которое в настоящий момент использует система (**подготовленная пропускная способность**). Ниже приведен пример переменной или непредсказуемой рабочей нагрузки при использовании автомасштабирования. Обратите внимание, что в случае отсутствия трафика система масштабирует количество единиц запросов в секунду до минимального значения, равного 10 % от максимального числа единиц запросов в секунду, что в данном случае составляет 5000 ЕЗ/с и 50 000 ЕЗ/с соответственно. 

:::image type="content" source="media/how-to-choose-offer/autoscale-metrics-azure-monitor.png" alt-text="Пример рабочей нагрузки с автомасштабированием: максимальный коэффициент единиц запросов в секунду (50 000 единиц запросов в s) и пропускная способность, начиная с 5000-50 000 единиц запросов в секунду":::

> [!NOTE]
> Если используется стандартная (ручная) подготовленная пропускная способность, метрика **Подготовленная пропускная способность** указывает на то значение, которое вы настроили как пользователь. При использовании автомасштабирования пропускной способности эта метрика относится к числу единиц запросов в секунду, которое в настоящее время потребляет система.

## <a name="next-steps"></a>Дальнейшие действия
* Чтобы оценить пропускную способность для новых рабочих нагрузок, используйте [калькулятор единиц запросов](https://cosmos.azure.com/capacitycalculator/).
* Используйте [Azure Monitor](monitor-cosmos-db.md#view-operation-level-metrics-for-azure-cosmos-db) для отслеживания существующих рабочих нагрузок.
* Узнайте, как [подготовить автомасштабируемую пропускную способность для базы данных или контейнера Azure Cosmos](how-to-provision-autoscale-throughput.md).
* Изучите [часто задаваемые вопросы об автомасштабировании](autoscale-faq.md).