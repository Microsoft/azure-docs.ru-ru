---
title: Руководство по Копирование данных в хранилище BLOB-объектов Azure Data Box с помощью REST API
description: Из этого учебника вы узнаете, как подключиться к хранилищу BLOB-объектов Azure Data Box с помощью интерфейсов REST API по протоколам HTTP или HTTPS, а также как затем скопировать данные из Azure Data Box Heavy.
services: databox
author: alkohli
ms.service: databox
ms.subservice: heavy
ms.topic: tutorial
ms.date: 07/03/2019
ms.author: alkohli
ms.openlocfilehash: e2fc174147b99b7b952c6d10084cfc969dacf5a6
ms.sourcegitcommit: 772eb9c6684dd4864e0ba507945a83e48b8c16f0
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "91949145"
---
# <a name="tutorial-copy-data-to-azure-data-box-blob-storage-via-rest-apis"></a>Руководство по Копирование данных в хранилище BLOB-объектов Azure Data Box с помощью REST API  

В этом руководстве описываются процедуры по подключению к хранилищу BLOB-объектов Azure Data Box через REST API по протоколу *HTTP* или *HTTPS*. Рассматриваются также шаги после подключения, необходимые для копирования данных в хранилище BLOB-объектов Data Box.

В этом руководстве описано следующее:

> [!div class="checklist"]
> * Предварительные требования
> * Подключение к хранилищу BLOB-объектов Data Box по протоколу *HTTP* или *HTTPS*.
> * копирование данных в Data Box Heavy.

## <a name="prerequisites"></a>Предварительные требования

Перед тем как начать, убедитесь в следующем.

1. Вы завершили работу со статьей [Руководство: Настройка Azure Data Box Heavy](data-box-heavy-deploy-set-up.md).
2. Вы получили устройство Data Box Heavy (состояние заказа на портале — **Доставлено**).
3. Вы проверили [системные требования для хранилища BLOB-объектов Data Box](data-box-system-requirements-rest.md) и знакомы с поддерживаемыми версиями API, пакетов SDK и инструментов.
4. У вас есть доступ к главному компьютеру с данными, которые необходимо скопировать в Data Box Heavy. На главном компьютере должно быть следующее ПО:
    - [поддерживаемая операционная система](data-box-system-requirements.md);
    - Компьютер должен быть подключен к высокоскоростной сети. Чтобы ускорить копирование, можно параллельно использовать два подключения 40 GbE (по одному на каждый узел). Если у вас нет доступного подключения на 40 GbE, мы рекомендуем использовать хотя бы два подключения 10 GbE (по одному на каждый узел). 
5. [Скачайте AzCopy 7.1.0](https://aka.ms/azcopyforazurestack20170417) на главный компьютер. Вы используете AzCopy для копирования данных в хранилище BLOB-объектов Azure Data Box с главного компьютера.


## <a name="connect-via-http-or-https"></a>Подключение по протоколу HTTP или HTTPS

Вы можете подключиться к хранилищу BLOB-объектов Data Box по протоколу *HTTP* или *HTTPS*.

- *HTTPS* — это безопасный и рекомендуемый способ подключения к хранилищу BLOB-объектов Data Box.
- *HTTP* используется при подключении через доверенные сети.

Подключение к хранилищу BLOB-объектов Data Box по протоколам *HTTP* и *HTTPS* происходит по-разному.

## <a name="connect-via-http"></a>Подключение по протоколу HTTP

Для подключения к REST API хранилища BLOB-объектов Data Box по протоколу *HTTP* необходимо выполнить следующие действия:

- добавить IP-адрес устройства и конечную точку службы BLOB-объектов к удаленному узлу;
- настроить стороннее программное обеспечение и проверить подключение.

Каждое из этих действий описано в следующих разделах.

> [!IMPORTANT]
> Для Data Box Heavy необходимо повторить все описанные выше действия, чтобы подключиться ко второму узлу.

### <a name="add-device-ip-address-and-blob-service-endpoint"></a>Добавление IP-адреса устройства и конечной точки службы BLOB-объектов

[!INCLUDE [data-box-add-device-ip](../../includes/data-box-add-device-ip.md)]



### <a name="configure-partner-software-and-verify-connection"></a>Настройка партнерского программного обеспечения и проверка подключения

[!INCLUDE [data-box-configure-partner-software](../../includes/data-box-configure-partner-software.md)]

[!INCLUDE [data-box-verify-connection](../../includes/data-box-verify-connection.md)]

## <a name="connect-via-https"></a>Подключение по протоколу HTTPS

Для подключения к REST API хранилища BLOB-объектов Azure по протоколу HTTP необходимо выполнить следующие действия:

- скачать сертификат на портале Azure;
- импортировать сертификат на клиенте или удаленном узле;
- добавить IP-адрес устройства и конечную точку службы BLOB-объектов к клиенту или удаленному узлу;
- настроить стороннее программное обеспечение и проверить подключение.

Каждое из этих действий описано в следующих разделах.

> [!IMPORTANT]
> Для Data Box Heavy необходимо повторить все описанные выше действия, чтобы подключиться ко второму узлу.

### <a name="download-certificate"></a>Загрузить сертификат

Скачайте сертификат с помощью портала Azure.

1. Войдите на портал Azure.
2. Перейдите к заказу Data Box, а затем к разделу **Общие > Сведения об устройстве**.
3. В разделе **Учетные данные устройства** перейдите к **API доступа к устройству**. Щелкните элемент **Загрузить**. После этого будет скачан файл сертификата **\<your order name>.cer**. **Сохраните** этот файл. Этот сертификат следует установить на компьютере клиента или узла, который будет использоваться для подключения к устройству.

    ![Скачивание сертификата с помощью портала Azure](media/data-box-deploy-copy-data-via-rest/download-cert-1.png)
 
### <a name="import-certificate"></a>Импорт сертификата 

Для доступа к хранилищу BLOB-объектов Data Box через протокол HTTPS требуется TLS/SSL-сертификат для устройства. Этот сертификат предоставляется клиентскому приложению по-разному в зависимости от приложения, операционной системы и дистрибутива. Некоторые приложения получают доступ к сертификату после его импорта в хранилище сертификатов системы, в других приложениях не используется этот механизм.

В этом разделе описаны особенности доступа к сертификату для некоторых приложений. Дополнительные сведения для других приложений см. в документации по этим приложениям и используемой операционной системе.

Выполните следующие действия, чтобы импортировать файл `.cer` в корневое хранилище клиента Windows или Linux. В системе Windows для импорта и установки сертификата можно использовать Windows PowerShell или пользовательский интерфейс Windows Server.

#### <a name="use-windows-powershell"></a>Использование Windows PowerShell

1. Запустите сеанс Windows PowerShell от имени администратора.
2. В командной строке введите:

    ```
    Import-Certificate -FilePath C:\temp\localuihttps.cer -CertStoreLocation Cert:\LocalMachine\Root
    ```

#### <a name="use-windows-server-ui"></a>Использование пользовательского интерфейса Windows Server

1.  Щелкните правой кнопкой мыши файл `.cer` и выберите **Установить сертификат**. Запустится мастер импорта сертификатов.
2.  В качестве **Расположения хранилища** выберите **Локальный компьютер**, а затем нажмите кнопку **Далее**.

    ![Импорт сертификата с помощью PowerShell](media/data-box-deploy-copy-data-via-rest/import-cert-ws-1.png)

3.  Выберите **Поместить все сертификаты в следующее хранилище**, затем нажмите кнопку **Обзор**. Перейдите в корневое хранилище удаленного узла и нажмите кнопку **Далее**.

    ![Импорт сертификата с помощью PowerShell (2)](media/data-box-deploy-copy-data-via-rest/import-cert-ws-2.png)

4.  Нажмите кнопку **Готово**. Появится сообщение о том, что импорт успешно выполнен.

    ![Импорт сертификата с помощью PowerShell (3)](media/data-box-deploy-copy-data-via-rest/import-cert-ws-3.png)

#### <a name="use-a-linux-system"></a>Использование системы Linux

Метод импорта сертификата зависит от дистрибутива.

> [!IMPORTANT]
> Для Data Box Heavy необходимо повторить все описанные выше действия, чтобы подключиться ко второму узлу.

В некоторых дистрибутивах, например Ubuntu и Debian, используется команда `update-ca-certificates`.  

- Переименуйте файл сертификата с кодировкой Base64, чтобы у него было расширение `.crt`, а затем скопируйте его в расположение `/usr/local/share/ca-certificates directory`.
- Выполните команду `update-ca-certificates`.

В последних версиях RHEL, Fedora и CentOS используется команда `update-ca-trust`.

- Скопируйте файл сертификата в каталог `/etc/pki/ca-trust/source/anchors`.
- Выполните `update-ca-trust`.

Дополнительные сведения см. в документации по своему дистрибутиву.

### <a name="add-device-ip-address-and-blob-service-endpoint"></a>Добавление IP-адреса устройства и конечной точки службы BLOB-объектов 

Выполните те же действия для [добавления IP-адреса устройства и конечной точки службы BLOB-объектов, что и при подключении по протоколу *HTTP*](#add-device-ip-address-and-blob-service-endpoint).

### <a name="configure-partner-software-and-verify-connection"></a>Настройка партнерского программного обеспечения и проверка подключения

Выполните шаги для [настройки партнерского программного обеспечения, которые вы выполняли при подключении по протоколу *HTTP*](#configure-partner-software-and-verify-connection). Единственное отличие — не устанавливайте флажок для *использования HTTP*.

## <a name="copy-data-to-data-box-heavy"></a>копирование данных в Data Box Heavy.

После подключения к хранилищу BLOB-объектов Data Box можно скопировать данные. Прежде чем копировать данные, ознакомьтесь со следующими моментами.

-  При копировании данных убедитесь, что размер данных соответствует ограничениям на размер, указанным в статье об [ограничениях для службы хранилища Azure и Data Box Heavy](data-box-limits.md).
- Если данные, отправляемые Data Box Heavy, одновременно отправляются другими приложениями за пределами устройства, это может привести к сбоям заданий отправки и повреждению данных.

В этом руководстве AzCopy используется для копирования данных в хранилище BLOB-объектов Data Box. Вы также можете использовать Обозреватель службы хранилища Azure (если вы предпочитаете средство с графическим пользовательским интерфейсом) или партнерское программное обеспечение для копирования данных.

Процедура копирования включает в себя следующие действия:

- Создание контейнера
- Отправка содержимого папки в хранилище BLOB-объектов Data Box
- Отправка измененных файлов в хранилище BLOB-объектов Data Box


В следующих разделах каждый этап рассматривается более подробно.

> [!IMPORTANT]
> Для Data Box Heavy необходимо повторить все описанные выше действия, чтобы скопировать данные на второй узел.

### <a name="create-a-container"></a>Создание контейнера

Первый шаг — создать контейнер, потому что большие двоичные объекты должны всегда передаваться в контейнер. Контейнеры упорядочивают группы больших двоичных объектов аналогично организации файлов в папках на компьютере. Чтобы создать контейнер больших двоичных объектов, сделайте следующее.

1. Откройте обозреватель хранилищ.
2. В левой области разверните учетную запись хранения, в которой собираетесь создать контейнер больших двоичных объектов.
3. Щелкните правой кнопкой мыши **Контейнеры больших двоичных объектов** и выберите в контекстном меню **Создать контейнер BLOB-объектов**.

   ![Контекстное меню для создания контейнеров BLOB-объектов](media/data-box-deploy-copy-data-via-rest/create-blob-container-1.png)

4. Под папкой **Контейнеры больших двоичных объектов** отобразится текстовое поле. Введите имя контейнера больших двоичных объектов. В разделе о [создании контейнера и настройке разрешений](../storage/blobs/storage-quickstart-blobs-dotnet.md) см. сведения о правилах и ограничениях для именования контейнеров больших двоичных объектов.
5. Нажмите клавишу **ВВОД**, чтобы создать контейнер больших двоичных объектов, или **ESC** для отмены. После успешного создания контейнера больших двоичных объектов он отобразится в папке **Контейнеры больших двоичных объектов** выбранной учетной записи хранения.

   ![Контейнер больших двоичных объектов создан](media/data-box-deploy-copy-data-via-rest/create-blob-container-2.png)

### <a name="upload-contents-of-a-folder-to-data-box-blob-storage"></a>Отправка содержимого папки в хранилище BLOB-объектов Data Box

С помощью AzCopy вы можете передать все файлы из определенной папки в Windows или Linux в хранилище BLOB-объектов. Чтобы передать все большие двоичные объекты, содержащиеся в папке, введите следующую команду AzCopy:

#### <a name="linux"></a>Linux

```azcopy
azcopy \
    --source /mnt/myfolder \
    --destination https://data-box-storage-account-name.blob.device-serial-no.microsoftdatabox.com/container-name/files/ \
    --dest-key <key> \
    --recursive
```

#### <a name="windows"></a>Windows

```azcopy
AzCopy /Source:C:\myfolder /Dest:https://data-box-storage-account-name.blob.device-serial-no.microsoftdatabox.com/container-name/files/ /DestKey:<key> /S
```

Вместо `<key>` укажите ключ учетной записи. Чтобы получить ключ учетной записи, перейдите к учетной записи хранения на портале Azure. Перейдите в раздел **Параметры > Ключи доступа**, выберите ключ и вставьте его в команду AzCopy.

Если указанный контейнер назначения не существует, AzCopy создаст его и передаст в него файл. В качестве исходного пути укажите путь к нужному каталогу данных, а в URL-адресе назначения замените `data-box-storage-account-name` именем учетной записи хранения, связанной с вашим Data Box.

Чтобы рекурсивно передать все содержимое определенного каталога в хранилище больших двоичных объектов, укажите параметр `--recursive` (для Linux) или `/S` (для Windows). При запуске с этими параметрами AzCopy передает все вложенные папки и файлы.

### <a name="upload-modified-files-to-data-box-blob-storage"></a>Отправка измененных файлов в хранилище BLOB-объектов Data Box

Используйте AzCopy для передачи файлов с учетом времени их последнего изменения. Чтобы проверить этот режим, измените или создайте несколько тестовых файлов в исходном каталоге. Чтобы отправить только те файлы, которые обновлены или добавлены, укажите параметр `--exclude-older` (для Linux) или `/XO` (для Windows) в команде AzCopy.

Если вы хотите скопировать только те ресурсы, которые существуют в папке источника и отсутствуют в целевой папке, укажите параметры `--exclude-older` и `--exclude-newer` (для Linux) или `/XO` и `/XN` (для Windows) в команде AzCopy. AzCopy передаст только обновленные данные, учитывая отметки времени файлов.

#### <a name="linux"></a>Linux

```azcopy
azcopy \
--source /mnt/myfolder \
--destination https://data-box-heavy-storage-account-name.blob.device-serial-no.microsoftdatabox.com/container-name/files/ \
--dest-key <key> \
--recursive \
--exclude-older
```

#### <a name="windows"></a>Windows

```azcopy
AzCopy /Source:C:\myfolder /Dest:https://data-box-heavy-storage-account-name.blob.device-serial-no.microsoftdatabox.com/container-name/files/ /DestKey:<key> /S /XO
```

При возникновении ошибки во время копирования или подключения см. статью [Troubleshoot issues related to Azure Data Box Blob storage](data-box-troubleshoot-rest.md) (Устранение неполадок в хранилище BLOB-объектов службы Data Box).

Следующий шаг — подготовка устройства к отправке.

## <a name="next-steps"></a>Дальнейшие действия

В этом руководстве были освещены следующие темы относительно Azure Data Box.

> [!div class="checklist"]
> * Предварительные требования
> * Подключение к хранилищу BLOB-объектов Data Box по протоколу *HTTP* или *HTTPS*.
> * копирование данных в Data Box Heavy.


Перейдите к следующему руководству, чтобы узнать, как отправить свой Data Box обратно в корпорацию Майкрософт.

> [!div class="nextstepaction"]
> [Отправка Azure Data Box Heavy в Майкрософт](./data-box-heavy-deploy-picked-up.md)
