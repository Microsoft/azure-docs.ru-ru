---
title: Руководство по Копирование с виртуальных жестких дисков на управляемые диски
titleSuffix: Azure Data Box Heavy
description: Узнайте, как копировать данные с виртуальных жестких дисков рабочих нагрузок локальных виртуальных машин в Azure Data Box Heavy.
services: databox
author: alkohli
ms.service: databox
ms.subservice: heavy
ms.topic: tutorial
ms.date: 07/03/2019
ms.author: alkohli
ms.openlocfilehash: 335b564225bc2b7a4c2217c1d912f952239ecf24
ms.sourcegitcommit: 772eb9c6684dd4864e0ba507945a83e48b8c16f0
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "92127205"
---
# <a name="tutorial-use-data-box-heavy-to-import-data-as-managed-disks-in-azure"></a>Руководство. Использование Data Box Heavy для импорта данных в качестве управляемых дисков в Azure

В этом руководстве описывается использование Azure Data Box Heavy для переноса локальных виртуальных жестких дисков на управляемые диски в Azure. Виртуальные жесткие диски из локальных виртуальных машин копируются в Data Box Heavy в качестве страничных BLOB-объектов и отправляются в Azure как управляемые диски. Затем эти управляемые диски можно подключить к виртуальным машинам Azure.

В этом руководстве описано следующее:

> [!div class="checklist"]
> * Проверка предварительных требований
> * подключение к Azure Data Box Heavy;
> * копирование данных в Data Box Heavy.


## <a name="prerequisites"></a>Предварительные требования

Перед тем как начать, убедитесь в следующем.

1. Вы завершили работу со статьей [Руководство: Настройка Azure Data Box Heavy](data-box-heavy-deploy-set-up.md).
2. Вы получили устройство Data Box Heavy (состояние заказа на портале — **Доставлено**).
3. Ваш компьютер подключен к высокоскоростной сети. Чтобы ускорить копирование, можно параллельно использовать два подключения 40 GbE (по одному на каждый узел). Если у вас нет доступного подключения на 40 GbE, мы рекомендуем использовать хотя бы два подключения 10 GbE (по одному на каждый узел). 
4. Вы просмотрели:

    - поддерживаемые [размеры управляемых дисков в пределах размеров объектов Azure](data-box-heavy-limits.md#azure-object-size-limits);
    - статью [Общие сведения об управляемых дисках Azure](../virtual-machines/managed-disks-overview.md). 

## <a name="connect-to-data-box-heavy"></a>подключение к Azure Data Box Heavy;

Для каждой связанной группы ресурсов Data Box Heavy создает одну общую папку на основе указанных групп ресурсов. Например, если `mydbmdrg1` и `mydbmdrg2` созданы при размещении заказа, создаются следующие общие папки:

- `mydbmdrg1_MDisk`
- `mydbmdrg2_MDisk`

В каждой общей папке создаются следующие три папки, которые соответствуют контейнерам в вашей учетной записи хранения.

- SSD (цен. категория "Премиум")
- Диск HDD (цен. категория "Стандартный")
- SSD (цен. категория "Стандартный")

В следующей таблице показаны UNC-пути к общим папкам в Data Box Heavy.
 
|        Протокол подключения           |             UNC-путь к общей папке                                               |
|-------------------|--------------------------------------------------------------------------------|
| SMB |`\\<DeviceIPAddress>\<ResourceGroupName_MDisk>\<Premium SSD>\file1.vhd`<br> `\\<DeviceIPAddress>\<ResourceGroupName_MDisk>\<Standard HDD>\file2.vhd`<br> `\\<DeviceIPAddress>\<ResourceGroupName_MDisk>\<Standard SSD>\file3.vhd` |  
| NFS |`//<DeviceIPAddress>/<ResourceGroup1_MDisk>/<Premium SSD>/file1.vhd`<br> `//<DeviceIPAddress>/<ResourceGroupName_MDisk>/<Standard HDD>/file2.vhd`<br> `//<DeviceIPAddress>/<ResourceGroupName_MDisk>/<Standard SSD>/file3.vhd` |

В зависимости от того, используете ли вы SMB или NFS для подключения к общим папкам Data Box Heavy, шаги для подключения отличаются.

> [!NOTE]
> - Подключение через REST не поддерживается для этой функции.
> - Повторите инструкции по подключению для подключения ко второму узлу Data Box Heavy.

### <a name="connect-to-data-box-heavy-via-smb"></a>Подключение к Data Box Heavy через SMB.

Если вы используете главный компьютер с Windows Server, для подключения к Data Box Heavy выполните указанные ниже действия.

1. В первую очередь необходимо выполнить проверку подлинности и начать сеанс. Перейдите на страницу **Подключение и копирование**. Чтобы получить учетные данные для доступа к общим папкам, связанным с группой ресурсов, щелкните **Получить учетные данные**. Можно также найти учетные данные для доступа в **сведениях об устройстве** на портале Azure.

    > [!NOTE]
    > Учетные данные всех общих папок для управляемых дисков идентичны.

    ![Получение учетных данных для доступа к общей папке](media/data-box-deploy-copy-data-from-vhds/get-share-credentials1.png)

2. В диалоговом окне "Доступ к общей папке и копирование данных" скопируйте **имя пользователя** и **пароль** для общей папки. Нажмите кнопку **ОК**.
    
    ![Получение учетных данных для доступа к общей папке 2](media/data-box-deploy-copy-data-from-vhds/get-share-credentials2.png)

3. Чтобы получить доступ к общим папкам, связанным с вашим ресурсом (в следующем примере *mydbmdrg1*) на главном компьютере, откройте командное окно. В командной строке введите:

    `net use \\<IP address of the device>\<share name>  /u:<user name for the share>`

    Ниже приведены UNC-пути общих папок для этого примера.

    - `\\169.254.250.200\mydbmdrg1_MDisk`
    - `\\169.254.250.200\mydbmdrg2_MDisk`
    
4. При отображении соответствующего запроса введите пароль для общей папки. В примере ниже показан процесс подключения к общей папке с помощью указанной выше команды.

    ```
    C:\>net use \\169.254.250.200\mydbmdrgl_MDisk /u:mdisk
    Enter the password for ‘mdisk’ to connect to '169.254.250.200':
    The command completed successfully.
    C: \>
    ```

4. Нажмите клавиши WINDOWS+R. В окне **Выполнить** введите `\\<device IP address>\<ShareName>`. Нажмите кнопку **ОК**, чтобы открыть проводник.
    
    ![Подключение к общей папке с помощью проводника](media/data-box-deploy-copy-data-from-vhds/connect-shares-file-explorer1.png)

    Следующие предварительно созданные папки теперь отображаются внутри каждой общей папки.
    
    ![Подключение к общей папке с помощью проводника 2](media/data-box-deploy-copy-data-from-vhds/connect-shares-file-explorer2.png)


### <a name="connect-to-data-box-heavy-via-nfs"></a>Подключение к Data Box Heavy через NFS

Если вы используете главный компьютер с ОС Linux, то выполните указанные ниже действия, чтобы настроить устройство для доступа к NFS-клиентам.

1. Укажите IP-адреса клиентов, которым разрешен доступ к общей папке. В локальном пользовательском веб-интерфейсе перейдите на страницу **Подключение и копирование**. В разделе **Параметры NFS** щелкните **Клиентский доступ NFS**.

    ![Настройка клиентского доступа NFS](media/data-box-deploy-copy-data-from-vhds/nfs-client-access1.png)

2. Укажите IP-адрес NFS-клиента и щелкните **Добавить**. Вы можете настроить доступ для нескольких NFS-клиентов, выполнив это действие для каждого клиента. Нажмите кнопку **ОК**.

    ![Настройка клиентского доступа NFS 2](media/data-box-deploy-copy-data-from-vhds/nfs-client-access2.png)

2. Убедитесь, что на главном компьютере с ОС Linux установлен NFS-клиент [поддерживаемой версии](data-box-system-requirements.md). Используйте версию, подходящую для используемого вами дистрибутива ОС Linux.

3. После установки NFS-клиента подключите общую папку NFS на устройстве, выполнив указанную ниже команду.

    `sudo mount <Data Box or Data Box Heavy IP>:/<NFS share on Data Box or Data Box Heavy device> <Path to the folder on local Linux computer>`

    В примере ниже показано, как подключиться к общей папке Data Box или Data Box Heavy по протоколу NFS. Устройство Data Box или Data Box Heavy имеет IP-адрес `169.254.250.200`, общая папка`mydbmdrg1_MDisk` подключена в виртуальной машине ubuntuVM, а точка подключения имеет название `/home/databoxubuntuhost/databox`.

    `sudo mount -t nfs 169.254.250.200:/mydbmdrg1_MDisk /home/databoxubuntuhost/databox`


## <a name="copy-data-to-data-box-heavy"></a>копирование данных в Data Box Heavy.

После подключения к серверу данных можно копировать данные. VHD-файл копируется в промежуточную учетную запись хранения в качестве страничного BLOB-объекта. Страничный BLOB-объект затем преобразуется в управляемый диск и перемещается в группу ресурсов.

Прежде чем начать копирование данных, ознакомьтесь со следующими моментами.

- Всегда копируйте виртуальные жесткие диски в одну из предварительно созданных папок. Если вы скопируете виртуальные жесткие диски за пределами этих папок или в созданную вами папку, они будут отправлены в учетную запись хранения Azure в виде страничных BLOB-объектов, а не управляемых дисков.
- Чтобы создать управляемые диски, можно отправить только фиксированные виртуальные жесткие диски. VHDX-файлы или динамические и разностные виртуальные жесткие диски не поддерживаются.
- Вы можете иметь только один управляемый диск с заданным именем в группе ресурсов во всех предварительно созданных папках. Это значит, что виртуальные жесткие диски, отправленные в предварительно созданные папки, должны иметь уникальные имена. Убедитесь, что указанное имя не совпадает с уже существующим управляемым диском в группе ресурсов.
- Просмотрите ограничения размеров для управляемых дисков в разделе [Ограничения размера для объектов Azure](data-box-heavy-limits.md#azure-object-size-limits).

В зависимости от того, производится ли подключение через SMB или NFS вы можете:

- [копировать данные по протоколу SMB](data-box-heavy-deploy-copy-data.md#copy-data-to-data-box-heavy);
- [копировать данные по протоколу NFS](data-box-heavy-deploy-copy-data-via-nfs.md#copy-data-to-data-box-heavy).

Дождитесь окончания заданий копирования. Прежде чем переходить к следующему шагу убедитесь, что задания копирования завершены без ошибок.

![Отсутствие ошибок на странице **Подключиться и копировать**](media/data-box-deploy-copy-data-from-vhds/verify-no-errors-connect-and-copy.png)

Если в процессе копирования возникают ошибки, скачайте журналы со страницы **Подключение и копирование**.

- Если вы скопировали файл, не выровненный по размеру 512 байт, файл не будет отправлен в качестве страничного BLOB-объекта в промежуточную учетную запись хранения. Вы увидите сообщение об ошибке в журналах. Удалите файл и скопируйте файл,который выровнен по размеру 512 байт.

- Если вы скопировали VHDX (эти файлы не поддерживаются) с длинным именем, вы получите сообщение об ошибке в журналах.

    ![Ошибка в журналах на странице **Подключение и копирование**](media/data-box-deploy-copy-data-from-vhds/errors-connect-and-copy.png)

    Прежде чем перейти к следующему шагу, устраните ошибки.

Чтобы обеспечить целостность данных, при копировании данных система вычисляет их контрольные суммы. По завершении копирования проверьте использованное и свободное место на устройстве.
    
![Проверка свободного и использованного места на панели мониторинга](media/data-box-deploy-copy-data-from-vhds/verify-used-space-dashboard.png)

После завершения задания копирования можно перейти к **подготовке к отправке**.


## <a name="next-steps"></a>Дальнейшие действия

Из этого руководства вы узнали следующие сведения об Azure Data Box Heavy:

> [!div class="checklist"]
> * Проверка предварительных требований
> * подключение к Azure Data Box Heavy;
> * копирование данных в Data Box Heavy.


Перейдите к следующему руководству, чтобы узнать, как отправить Data Box Heavy в Майкрософт.

> [!div class="nextstepaction"]
> [Отправка Azure Data Box Heavy в Майкрософт](./data-box-heavy-deploy-picked-up.md)