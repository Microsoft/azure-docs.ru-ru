---
title: Просмотр топологии виртуальной сети Azure | Документация Майкрософт
description: Узнайте, как просматривать ресурсы в виртуальной сети и отношения между ними.
services: network-watcher
documentationcenter: na
author: damendo
ms.service: network-watcher
ms.devlang: na
ms.topic: how-to
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 05/09/2018
ms.author: damendo
ms.openlocfilehash: c04da65af27ebd5ac654bc059ae004c157a20f33
ms.sourcegitcommit: 772eb9c6684dd4864e0ba507945a83e48b8c16f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "84737535"
---
# <a name="view-the-topology-of-an-azure-virtual-network"></a>Просмотр топологии виртуальной сети Azure

Из этой статьи вы узнаете, как просматривать ресурсы в виртуальной сети Microsoft Azure и отношения между ними. Например, виртуальная сеть содержит подсети. В подсеть помещены ресурсы, такие как виртуальные машины Azure. У виртуальных машин может быть один или несколько сетевых интерфейсов. С каждой подсетью можно связать группу безопасности сети и таблицу маршрутов. Возможность топологии Azure "Наблюдателя за сетями" позволяет просматривать все ресурсы в виртуальной сети, ресурсы, связанные с ресурсами в виртуальной сети, и отношения между ресурсами.

Для просмотра топологии можно использовать [портал Azure](#azure-portal), [Azure CLI](#azure-cli) или [PowerShell](#powershell).

[!INCLUDE [updated-for-az](../../includes/updated-for-az.md)]

## <a name="view-topology---azure-portal"></a><a name = "azure-portal"></a>Просмотр топологии: портал Azure

1. Войдите на [портал Azure](https://portal.azure.com) с помощью учетной записи, которая предоставляет необходимые [разрешения](required-rbac-permissions.md).
2. В верхнем левом углу окна портала выберите **Все службы**.
3. В поле фильтра **Все службы** введите *Наблюдатель за сетями*. Когда в результатах появится **Наблюдатель за сетями**, выберите его.
4. Выберите элемент **Топология**. Чтобы создать топологию, требуется наблюдатель за сетями в том же регионе, где размещена виртуальная сеть, для которой нужно создать топологию. Если не включить наблюдатель за сетями в регионе виртуальной сети, для которой нужно создать топологию, наблюдатели за сетями автоматически создаются во всех регионах. Наблюдатели за сетями создаются в группе ресурсов с именем **NetworkWatcherRG**.
5. Выберите подписку и группу ресурсов виртуальной сети, для которой требуется просмотреть топологию, а затем выберите виртуальную сеть. На следующем изображении показана топология для виртуальной сети с именем *MyVnet* в группе ресурсов с именем *MyResourceGroup*:

    ![Отображение топологии](./media/view-network-topology/view-topology.png)

    Как видно на предыдущем изображении, виртуальная сеть содержит три подсети. В одной подсети развернута виртуальная машина. К виртуальной машине присоединен один сетевой интерфейс, и с ней связан общедоступный IP-адрес. С другими двумя подсетями связана таблицы маршрутов. Каждая таблица маршрутов содержит два маршрута. С одной подсетью связана группа безопасности сети. Сведения о топологии отображаются только для ресурсов, которые:
    
    - Находятся в той же группе ресурсов и регионе, что и виртуальная сеть *myVnet*. Например, группа безопасности сети, находящаяся в группе ресурсов, которая отличается от *MyResourceGroup*, не отображается, даже если эта группа безопасности сети связана с подсетью в виртуальной сети *MyVnet*.
    - Находятся в виртуальной сети *myVnet* или связаны с ресурсами в ней. (например, группа безопасности сети, которая не связана с подсетью или сетевым интерфейсом в виртуальной сети *myVnet*, не отображается, даже если она находится в группе ресурсов *MyResourceGroup*).

   Показанная на изображении топология соответствует виртуальной сети, созданной после развертывания **примера скрипта для маршрутизации трафика через сетевой виртуальный модуль**, который можно развернуть с помощью [Azure CLI](../virtual-network/scripts/virtual-network-cli-sample-route-traffic-through-nva.md?toc=%2fazure%2fnetwork-watcher%2ftoc.json) или [PowerShell](../virtual-network/scripts/virtual-network-powershell-sample-route-traffic-through-nva.md?toc=%2fazure%2fnetwork-watcher%2ftoc.json).

6. Выберите **Скачать топологию**, чтобы скачать изображение в виде редактируемого файла в формате SVG.

Ресурсы, показанные на схеме, представляют собой подмножество сетевых компонентов в виртуальной сети. Например, если отображается группа безопасности сети, правила безопасности в ней не показаны на схеме. Линии на схеме не различаются, но они представляют один из двух типов отношений: *отношения вложения* или *отношения связи*. Чтобы просмотреть полный список ресурсов в виртуальной сети, а также тип отношений между ресурсами, сформируйте топологию с помощью [PowerShell](#powershell) или [Azure CLI](#azure-cli).

## <a name="view-topology---azure-cli"></a><a name = "azure-cli"></a>Просмотр топологии: Azure CLI

Выполнять команды можно одним из следующих способов:
- В Azure Cloud Shell выберите **Попробовать** вверху справа от любой команды. Azure Cloud Shell — это бесплатная интерактивная оболочка, в которой предустановлены и настроены для использования с вашей учетной записью стандартные средства Azure.
- Запустите CLI с компьютера. Если вы запускаете CLI с компьютера, для выполнения действий, описанных в этой статье, требуется Azure CLI 2.0.31 или более поздней версии. Выполните командлет `az --version`, чтобы узнать установленную версию. Если вам необходимо выполнить установку или обновление, см. статью [Установка Azure CLI](/cli/azure/install-azure-cli). Если Azure CLI запущен локально, необходимо также выполнить командлет `az login`, чтобы создать подключение к Azure.

Используемая учетная запись должна предоставлять необходимые [разрешения](required-rbac-permissions.md).

1. Если в регионе виртуальной сети, для которой нужно создать топологию, уже есть наблюдатель за сетями, перейдите к шагу 3. Создайте группу ресурсов для размещения наблюдателя за сетями с помощью команды [az group create](/cli/azure/group). В следующем примере создается группа ресурсов в регионе *eastus*:

    ```azurecli-interactive
    az group create --name NetworkWatcherRG --location eastus
    ```

2. Создайте наблюдатель за сетями с помощью команды [az network watcher configure](/cli/azure/network/watcher#az-network-watcher-configure). В следующем примере создается наблюдатель за сетями в регионе *eastus*:

    ```azurecli-interactive
    az network watcher configure \
      --resource-group NetworkWatcherRG \
      --location eastus \
      --enabled true
    ```

3. Просмотрите топологию с помощью команды [az network watcher show-topology](/cli/azure/network/watcher#az-network-watcher-show-topology). В следующем примере отображается топология для группы ресурсов *myResourceGroup*:

    ```azurecli-interactive
    az network watcher show-topology --resource-group MyResourceGroup
    ```

    Сведения о топологии возвращаются только для ресурсов, находящихся в той же группе ресурсов, что и группа ресурсов *MyResourceGroup*, и в том же регионе, что и наблюдатель за сетями. Например, группа безопасности сети, находящаяся в группе ресурсов, которая отличается от *MyResourceGroup*, не отображается, даже если эта группа безопасности сети связана с подсетью в виртуальной сети *MyVnet*.

   Изучите дополнительные сведения об отношениях и [свойствах](#properties) в возвращаемых выходных данных. Если у вас нет виртуальной сети для просмотра топологии, можно создать ее с помощью примера скрипта для [маршрутизации трафика через сетевой виртуальный модуль](../virtual-network/scripts/virtual-network-cli-sample-route-traffic-through-nva.md?toc=%2fazure%2fnetwork-watcher%2ftoc.json). Чтобы просмотреть схему топологии и скачать ее в виде редактируемого файла, используйте [портал](#azure-portal).

## <a name="view-topology---powershell"></a><a name = "powershell"></a>Просмотр топологии: PowerShell

Выполнять команды можно одним из следующих способов:
- В Azure Cloud Shell выберите **Попробовать** вверху справа от любой команды. Azure Cloud Shell — это бесплатная интерактивная оболочка, в которой предустановлены и настроены для использования с вашей учетной записью стандартные средства Azure.
- Запустите PowerShell с компьютера. При запуске PowerShell с компьютера для работы с этой статьей требуется `Az` модуль Azure PowerShell. Выполните командлет `Get-Module -ListAvailable Az`, чтобы узнать установленную версию. Если вам необходимо выполнить обновление, ознакомьтесь со статьей, посвященной [установке модуля Azure PowerShell](/powershell/azure/install-Az-ps). Если модуль PowerShell запущен локально, необходимо также выполнить командлет `Connect-AzAccount`, чтобы создать подключение к Azure.

Используемая учетная запись должна предоставлять необходимые [разрешения](required-rbac-permissions.md).

1. Если в регионе виртуальной сети, для которой нужно создать топологию, уже есть наблюдатель за сетями, перейдите к шагу 3. Создайте группу ресурсов, которая будет содержать наблюдатель за сетями с помощью [New-азресаурцеграуп](/powershell/module/az.Resources/New-azResourceGroup). В следующем примере создается группа ресурсов в регионе *eastus*:

    ```azurepowershell-interactive
    New-AzResourceGroup -Name NetworkWatcherRG -Location EastUS
    ```

2. Создайте наблюдатель за сетями с помощью [New-азнетворкватчер](/powershell/module/az.network/new-aznetworkwatcher). В следующем примере создается наблюдатель за сетями в регионе eastus:

    ```azurepowershell-interactive
    New-AzNetworkWatcher `
      -Name NetworkWatcher_eastus `
      -ResourceGroupName NetworkWatcherRG
    ```

3. Получите экземпляр наблюдателя за сетями с помощью [Get-азнетворкватчер](/powershell/module/az.network/get-aznetworkwatcher). В следующем примере выполняется получение наблюдателя за сетями в регионе "Восточная часть США":

    ```azurepowershell-interactive
    $nw = Get-AzResource `
      | Where {$_.ResourceType -eq "Microsoft.Network/networkWatchers" -and $_.Location -eq "EastUS" }
    $networkWatcher = Get-AzNetworkWatcher `
      -Name $nw.Name `
      -ResourceGroupName $nw.ResourceGroupName
    ```

4. Получите топологию с помощью [Get-азнетворкватчертопологи](/powershell/module/az.network/get-aznetworkwatchertopology). В следующем примере выполняется получение топологии для виртуальной сети в группе ресурсов с именем *MyResourceGroup*:

    ```azurepowershell-interactive
    Get-AzNetworkWatcherTopology `
      -NetworkWatcher $networkWatcher `
      -TargetResourceGroupName MyResourceGroup
    ```

   Сведения о топологии возвращаются только для ресурсов, находящихся в той же группе ресурсов, что и группа ресурсов *MyResourceGroup*, и в том же регионе, что и наблюдатель за сетями. Например, группа безопасности сети, находящаяся в группе ресурсов, которая отличается от *MyResourceGroup*, не отображается, даже если эта группа безопасности сети связана с подсетью в виртуальной сети *MyVnet*.

   Изучите дополнительные сведения об отношениях и [свойствах](#properties) в возвращаемых выходных данных. Если у вас нет виртуальной сети для просмотра топологии, можно создать ее с помощью примера скрипта для [маршрутизации трафика через сетевой виртуальный модуль](../virtual-network/scripts/virtual-network-powershell-sample-route-traffic-through-nva.md?toc=%2fazure%2fnetwork-watcher%2ftoc.json). Чтобы просмотреть схему топологии и скачать ее в виде редактируемого файла, используйте [портал](#azure-portal).

## <a name="relationships"></a>Отношения

Все ресурсы, возвращаемые в топологии, имеют один из следующих типов отношений с другим ресурсом:

| Тип отношений | Пример                                                                                                |
| ---               | ---                                                                                                    |
| Containment       | Виртуальная сеть содержит подсеть. Подсеть содержит сетевой интерфейс.                            |
| Связь        | Сетевой интерфейс связывается с виртуальной машиной. Общедоступный IP-адрес связывается с сетевым интерфейсом. |

## <a name="properties"></a>Свойства

Все ресурсы, возвращаемые в топологии, имеют следующие свойства:

- **Name** (Имя): имя ресурса.
- **Id** (Идентификатор): URI ресурса.
- **Location** (Расположение): регион Azure, в котором находится ресурс.
- **Associations** (Связи): список связей объекта по ссылке. У каждой связи есть следующие свойства:
    - **AssociationType** (Тип связи): значение, которое ссылается на связь между дочерним и родительским объектом. Допустимые значения: *Contains* или *Associated*.
    - **Name** (Имя): имя ресурса, на который указывает ссылка.
    - **ResourceId** (Идентификатор ресурса): универсальный код ресурса (URI), на который добавляется ссылка при установке связи.

## <a name="next-steps"></a>Дальнейшие действия

- Узнайте, как [диагностировать проблему фильтрации входящего и исходящего трафика виртуальной машины](diagnose-vm-network-traffic-filtering-problem.md), используя функцию для проверки потока IP в Наблюдателе за сетями.
- Узнайте, как [диагностировать проблему маршрутизации исходящего трафика виртуальной машины](diagnose-vm-network-routing-problem.md), используя функцию следующего прыжка в Наблюдателе за сетями.
