---
title: Руководство. Изучение Azure Digital Twins с помощью примера клиентского приложения
titleSuffix: Azure Digital Twins
description: Руководство по изучению пакетов SDK Azure Digital Twins с помощью примера приложения командной строки
author: baanders
ms.author: baanders
ms.date: 5/8/2020
ms.topic: tutorial
ms.service: digital-twins
ms.openlocfilehash: db85bf19c1b040fea1ed2f5d6dcf904288366c7f
ms.sourcegitcommit: 8dd8d2caeb38236f79fe5bfc6909cb1a8b609f4a
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "98050244"
---
# <a name="tutorial-explore-azure-digital-twins-with-a-sample-client-app"></a>Руководство по Изучение Azure Digital Twins с помощью примера клиентского приложения

В этом учебнике представлен пример приложения, которое реализует клиентское приложение командной строки для взаимодействия с экземпляром Azure Digital Twins. Это клиентское приложение аналогично тому, которое создается в разделе [*Учебник. Написание кода для клиентского приложения*](tutorial-code.md).

Этот пример можно использовать для выполнения базовых действий Azure Digital Twins, таких как отправка моделей, создание и изменение двойников и создание связей. Вы также можете изучить код этого примера, чтобы больше узнать о программных интерфейсах Azure Digital Twins и на практике реализовать собственные команды, при желании изменяя этот пример проекта.

В этом учебнике вам предстоит выполнить следующее.
> [!div class="checklist"]
> * Настроить экземпляр Azure Digital Twins.
> * Настроить пример приложения командной строки для взаимодействия с этим экземпляром.
> * Использовать это приложение командной строки для изучения Azure Digital Twins, включая **модели**, **цифровые двойники**, **связи** и **запросы**.

[!INCLUDE [Azure Digital Twins tutorial: sample prerequisites](../../includes/digital-twins-tutorial-sample-prereqs.md)]

[!INCLUDE [Azure Digital Twins tutorial: configure the sample project](../../includes/digital-twins-tutorial-sample-configure.md)]

## <a name="explore-with-the-sample-solution"></a>Изучение с помощью примера решения

Теперь, когда экземпляр и пример приложения настроены, вы будете использовать пример проекта и некоторые предварительно созданные примеры кода для создания и изучения базового решения Azure Digital Twins. Основными компонентами решения являются **модели**, **цифровые двойники** и **связи**, которые позволяют создать запрашиваемый **граф двойников** среды.

### <a name="model-a-physical-environment-with-dtdl"></a>Моделирование физической среды с помощью DTDL

При создании решения Azure Digital Twins в первую очередь необходимо определить [**модели**](concepts-models.md) двойников для вашей среды. 

Модели похожи на классы в объектно-ориентированных языках программирования. Они предоставляют определяемые пользователем шаблоны для [цифровых двойников](concepts-twins-graph.md), экземпляры которых будут затем создаваться на основе этих шаблонов. Для их создания используется похожий на JSON язык, который называется **языком определения цифровых двойников или DTDL (Digital Twins Definition Language)** . На этом языке можно определять *свойства*, *телеметрию*, *связи* и *компоненты* двойника.

> [!NOTE]
> DTDL также позволяет определять *команды* в цифровых двойниках. Однако в настоящее время в службе Azure Digital Twins команды не поддерживаются.

В окне Visual Studio, в котором открыт проект _**AdtE2ESample**_, из панели *Обозревателя решений* перейдите в папку *AdtSampleApp\SampleClientApp\Models*. В этой папке содержатся примеры моделей.

Выберите *Room.json*, чтобы открыть его в окне редактирования, и внесите следующие изменения.

1. **Обновите номер версии**, чтобы указать, что вы предоставляете более новую версию этой модели. Для этого измените *1* в конце значения `@id` на *2*. Можно указать любое число больше текущего номера версии.
1. **Измените свойство**. Измените имя свойства `Humidity` на *HumidityLevel* или на другое имя, которое вам больше нравится. Однако не забывайте, что если вы используете имя, отличное от *HumidityLevel*, то должны будете указывать это имя вместо *HumidityLevel* на протяжении всего учебника).
1. **Добавьте свойство**. Под свойством `HumidityLevel`, которое заканчивается на строке 15, вставьте следующий код, чтобы добавить свойство `RoomName` к объекту room.

    :::code language="json" source="~/digital-twins-docs-samples/models/Room.json" range="16-20":::

1. **Добавьте связь**. Под только что добавленным свойством `RoomName` вставьте следующий код, чтобы добавить для этого типа двойника возможность формировать связи *contains* с другими двойниками.

    :::code language="json" source="~/digital-twins-docs-samples/models/Room.json" range="21-24":::

Когда вы закончите, обновленная модель должна выглядеть следующим образом:

:::code language="json" source="~/digital-twins-docs-samples/models/Room.json":::

Обязательно сохраните этот файл, прежде чем двигаться дальше.

> [!TIP]
> Если вы хотите попробовать создать свою собственную модель, можно вставить код модели *Room* в новый файл и сохранить его с расширением *JSON* в папке *AdtSampleApp\SampleClientApp\Models*. Затем поэкспериментируйте с добавлением свойств и отношений, представляющих ваши замыслы. Можно также поискать какие-нибудь идеи в других примерах моделей в этой папке.

> [!TIP] 
> Существует не зависящий от языка [пример проверяющего элемента управления DTDL](/samples/azure-samples/dtdl-validator/dtdl-validator), который можно использовать для проверки документов модели, чтобы убедиться в правильности DTDL. Он создан на основе библиотеки средства синтаксического анализа DTDL, о которой вы можете подробнее узнать в разделе [*Практическое руководство. Анализ и проверка моделей*](how-to-parse-models.md).

### <a name="get-started-with-the-command-line-app"></a>Начало работы с приложением командной строки

Теперь, когда модель определена, вы будете использовать этот пример приложения для взаимодействия с вашим экземпляром Azure Digital Twins. Запустите проект с помощью кнопки панели инструментов, показанной ниже.

:::image type="content" source="media/tutorial-command-line-app/start-button-sample.png" alt-text="Кнопка запуска Visual Studio (проект SampleClientApp)":::

Откроется окно консоли. Выполните проверку подлинности и дождитесь выполнения команды. 
* Проверка подлинности осуществляется через браузер: ваш веб-браузер по умолчанию открывается с запросом проверки подлинности. Используйте этот запрос для входа со своими учетными данными Azure. Затем можно закрыть эту вкладку или окно браузера.

Ниже приведен снимок экрана, показывающий, как выглядит консоль проекта.

:::image type="content" source="media/tutorial-command-line-app/command-line-app.png" alt-text="Приветственное сообщение приложения командной строки":::

> [!TIP]
> Чтобы получить список команд, которые вы можете использовать с этим проектом, введите `help` в консоли проекта и нажмите клавишу ВВОД.
> :::image type="content" source="media/tutorial-command-line-app/command-line-app-help.png" alt-text="Результат выполнения команды help":::

Оставьте консоль проекта в рабочем состоянии для выполнения остальных шагов в этом учебнике.

#### <a name="upload-models-to-azure-digital-twins"></a>Отправка моделей в Azure Digital Twins

После построения моделей вам необходимо отправить их в свой экземпляр Azure Digital Twins. Таким образом ваш экземпляр службы Azure Digital Twins настраивается с вашим собственным словарем личного домена. После отправки моделей можно создавать экземпляры двойников, которые их используют.

В окне консоли проекта выполните следующую команду, чтобы отправить ваши обновленные модели *Room* и *Floor*, которые вы будете использовать в следующем разделе для создания различных типов двойников.

```cmd/sh
CreateModels Room Floor
```

В выходных данных этой команды должно быть указано, что модели успешно созданы.

> [!TIP]
> Если вы ранее построили свою собственную модель, ее тоже можно загрузить здесь, добавив ее имя файла (расширение можно не указывать) в список `Room Floor` в приведенной выше команде.

Убедитесь, что модели успешно созданы, выполнив команду `GetModels true`. Эта команда запрашивает в экземпляре Azure Digital Twins все отправленные модели и возвращает полные сведения о них. Найдите отредактированную модель *Room* в результатах команды:

:::image type="content" source="media/tutorial-command-line-app/output-get-models.png" alt-text="Результаты GetModels, показывающие обновленную модель Room":::

#### <a name="errors"></a>ошибки

Пример приложения также обрабатывает ошибки службы. 

Повторите команду `CreateModels`, чтобы попытаться второй раз отправить одну из тех моделей, которые только что были отправлены:

```cmd/sh
CreateModels Room
```

Так как модели не перезаписываются, появится ошибка службы.
Дополнительные сведения о том, как удалить существующие модели, см. в разделе [*Практическое руководство. Управление настраиваемыми моделями*](how-to-manage-model.md).
```cmd/sh
Response 409: Service request failed.
Status: 409 (Conflict)

Content:
{"error":{"code":"ModelAlreadyExists","message":"Could not add model dtmi:example:Room;2 as it already exists. Use Model_List API to view models that already exist. See the Swagger example.(http://aka.ms/ModelListSwSmpl)"}}

Headers:
Strict-Transport-Security: REDACTED
Date: Wed, 20 May 2020 00:53:49 GMT
Content-Length: 223
Content-Type: application/json; charset=utf-8
```

### <a name="create-digital-twins"></a>Создание цифровых двойников

Теперь, когда несколько моделей отправлено в ваш экземпляр Azure Digital Twins, можно создавать [**цифровые двойники**](concepts-twins-graph.md) на основе определений этих моделей. Цифровые двойники представляют сущности в вашей бизнес-среде — такие как датчики на ферме, комнаты в здании или фары автомобиля. 

Для создания цифрового двойника используется команда `CreateDigitalTwin`. Вы должны сослаться на модель, на основе которой создается двойник, и при необходимости можете задать начальные значения каких-либо свойств в модели. На этом этапе вам не нужно передавать какие-либо сведения о связях.

Выполните следующий код в консоли запущенного проекта, чтобы создать несколько двойников на основе модели *Room*, которую вы обновили ранее, и другой модели, *Floor*. Напомним, что модель *Room* имеет три свойства, поэтому можно включить в команду аргументы с начальными значениями для этих свойств.

```cmd/sh
CreateDigitalTwin dtmi:example:Room;2 room0 RoomName string Room0 Temperature double 70 HumidityLevel double 30
CreateDigitalTwin dtmi:example:Room;2 room1 RoomName string Room1 Temperature double 80 HumidityLevel double 60
CreateDigitalTwin dtmi:example:Floor;1 floor0
CreateDigitalTwin dtmi:example:Floor;1 floor1
```

> [!TIP]
> Если вы ранее отправили свою собственную модель, попробуйте создать свою команду `CreateDigitalTwin` на основе приведенных выше команд, чтобы добавить двойник с типом вашей модели.

В выходных данных этих команд должно быть указано, что двойники успешно созданы. 

:::image type="content" source="media/tutorial-command-line-app/output-create-digital-twin.png" alt-text="Фрагмент выходных данных команд CreateDigitalTwin, показывающий floor0, floor1, room0 и room1":::

Вы также можете проверить, были ли двойники успешно созданы, выполнив команду `Query`. Эта команда запрашивает в вашем экземпляре Azure Digital Twins все содержащиеся в нем цифровые близнецы. Найдите в результатах команды двойники *floor0*, *floor1*, *room0* и *room1*.

#### <a name="modify-a-digital-twin"></a>Изменение цифровых двойников

Вы также можете изменить свойства созданного вами двойника. Попробуйте выполнить следующую команду, чтобы изменить значение свойства RoomName двойника *room0* с *Room0* на *PresidentialSuite*.

```cmd/sh
UpdateDigitalTwin room0 add /RoomName string PresidentialSuite
```

В выходных данных должно быть указано, что двойник успешно обновлен.

Для проверки также можно выполнить следующую команду, чтобы просмотреть сведения о двойнике *room0*.

```cmd/sh
GetDigitalTwin room0
```

В выходных данных должно быть указано обновленное имя.

> [!NOTE]
> Базовый REST API использует JSON Patch, чтобы определить обновления в двойнике. Приложение командной строки соответствует этому формату, так что вы можете экспериментировать с тем, что фактически предполагается базовым API.

### <a name="create-a-graph-by-adding-relationships"></a>Создание графа путем добавления связей

Далее вы можете создать некоторые **связи** между этими двойниками, чтобы подключить их к [**графу двойников**](concepts-twins-graph.md). Графы двойников используются для представления всей среды. 

Чтобы добавить связь, используйте команду `CreateRelationship`. Укажите двойник, от которого исходит связь, тип добавляемой связи и двойник, к которому необходимо подсоединить эту связь. Наконец, укажите имя (идентификатор) связи.

Выполните следующий код, чтобы добавить связь "contains" от каждого из созданных ранее двойников *Floor* к соответствующему двойнику *Room*. Обратите внимание, что для этого в модели *Floor* должна быть определена связь *contains*.

```cmd/sh
CreateRelationship floor0 contains room0 relationship0
CreateRelationship floor1 contains room1 relationship1
```

Выходные данные этих команд подтверждают, что связи были успешно созданы:

:::image type="content" source="media/tutorial-command-line-app/output-create-relationship.png" alt-text="Фрагмент выходных данных команд CreateRelationship, показывающий relationship0 и relationship1":::

Вы также можете проверить эти связи с помощью любой из следующих команд, которые запрашивают связи в вашем экземпляре Azure Digital Twins.
* Чтобы просмотреть все связи, исходящие от каждого двойника Floor (просмотреть связи с одной стороны):
    ```cmd/sh
    GetRelationships floor0
    GetRelationships floor1
    ```
* Чтобы просмотреть все связи, входящие в каждый двойник Room (просмотреть связи с другой стороны):
    ```cmd/sh
    GetIncomingRelationships room0
    ```
* Чтобы запросить эти связи по отдельности: 
    ```cmd/sh
    GetRelationship floor0 relationship0
    GetRelationship floor1 relationship1
    ```

Двойники и связи, которые вы настроили в этом учебнике, образуют следующий концептуальный граф:

:::image type="content" source="media/tutorial-command-line-app/sample-graph.png" alt-text="Граф, показывающий floor0, связанный с помощью relationship0 с room0, и floor1, связанный с помощью relationship1 с room1" border="false":::

### <a name="query-the-twin-graph-to-answer-environment-questions"></a>Запрос графа двойников для получения ответов по среде

Главной особенностью Azure Digital Twins является возможность просто и эффективно [запрашивать](concepts-query-language.md) граф двойников, чтобы получать ответы о вашей среде. Выполните следующие команды в консоли запущенного проекта, чтобы понять, как это происходит.

* **Какие сущности из моей среды представлены в Azure Digital Twins?** (запрос всех)

    ```cmd/sh
    Query
    ```

    Это позволяет быстро оценить состояние среды и убедиться, что в Azure Digital Twins все представлено именно так, как вы хотите. В результате будут выведены все цифровые двойники с подробными сведениями. Ниже приведен фрагмент:

    :::image type="content" source="media/tutorial-command-line-app/output-query-all.png" alt-text="Частичные результаты запроса двойников, показывающие room0 и floor1":::

    >[!NOTE]
    >В примере проекта команда `Query` без дополнительных аргументов является эквивалентом запроса `Query SELECT * FROM DIGITALTWINS`. Чтобы запросить данные о всех двойниках в экземпляре с помощью [интерфейсов API для запросов](/rest/api/digital-twins/dataplane/query) или [команд CLI](how-to-use-cli.md), используйте более длинный (полный) запрос.

* **Какие комнаты существуют в моей среде?** (запрос по модели)

    ```cmd/sh
    Query SELECT * FROM DIGITALTWINS T WHERE IS_OF_MODEL(T, 'dtmi:example:Room;2')
    ```

    Вы можете ограничить свой запрос двойниками определенного типа, чтобы получить более конкретную информацию о том, что есть в вашей среде. В результате будут показаны *room0* и *room1*, но **не** показаны *floor0* и *room1* (так как это этажи, а не комнаты).
    
    :::image type="content" source="media/tutorial-command-line-app/output-query-model.png" alt-text="Результаты запроса по модели, показывающие только room0 и room1":::

* **Какие комнаты есть на этаже *floor0*?** (запрос по связи)

    ```cmd/sh
    Query SELECT room FROM DIGITALTWINS floor JOIN room RELATED floor.contains where floor.$dtId = 'floor0'
    ```

    Вы можете выполнять запрос в свой граф на основе связей, чтобы получить сведения о том, как связаны двойники, или чтобы ограничить запрос определенной областью. На этаже *floor0* есть только комната *room0*, так что в результате будет только одна комната.

    :::image type="content" source="media/tutorial-command-line-app/output-query-relationship.png" alt-text="Результаты запроса по связи, показывающие room0":::

* **Какие двойники имеют температуру выше 75?** (запрос по свойству)

    ```cmd/sh
    Query SELECT * FROM DigitalTwins T WHERE T.Temperature > 75
    ```

    Вы можете запрашивать граф на основе свойств, чтобы получать ответы на множество вопросов, например о наличии в вашей среде выбросов, которые требуют внимания. Поддерживаются также и другие операторы сравнения ( *<* , *>* , *=* и *!=* ). В результатах отображается комната *room1*, так как она имеет температуру 80.

    :::image type="content" source="media/tutorial-command-line-app/output-query-property.png" alt-text="Результаты запроса по свойству, показывающие только room1":::

* **Какие комнаты на этаже *floor0* имеют температуру выше 75?** (составной запрос)

    ```cmd/sh
    Query SELECT room FROM DIGITALTWINS floor JOIN room RELATED floor.contains where floor.$dtId = 'floor0' AND IS_OF_MODEL(room, 'dtmi:example:Room;2') AND room.Temperature > 75
    ```

    Вы можете сочетать предыдущие запросы, как это делается в SQL, с помощью логических операторов, таких как `AND`, `OR`, `NOT`. В этом запросе используется `AND`, чтобы уточнить предыдущий запрос о температурах двойников. Теперь результат должен включать только комнаты с температурой выше 75, которые находятся на этаже *floor0* — в данном случае таких комнат нет. В результате мы получим пустой набор.

    :::image type="content" source="media/tutorial-command-line-app/output-query-compound.png" alt-text="Результаты составного запроса, показывающие пустой набор":::

## <a name="clean-up-resources"></a>Очистка ресурсов

Проект в этом учебнике формирует основу для следующего раздела [*Учебник. Подключение комплексного решения*](tutorial-end-to-end.md). Если вы собираетесь перейти к следующему учебнику, то можете сохранить настроенные здесь ресурсы, чтобы продолжить работу с этим экземпляром Azure Digital Twins и настроенным примером приложения.
* В таком случае используйте команды примера приложения `DeleteAllTwins` и `DeleteAllModels`, чтобы удалить соответственно двойники и модели в вашем экземпляре. Таким образом, вы получите чистую площадку для следующего учебника.

[!INCLUDE [digital-twins-cleanup-basic.md](../../includes/digital-twins-cleanup-basic.md)]

Наконец, удалите папку примера проекта, скачанную на локальный компьютер.

## <a name="next-steps"></a>Дальнейшие действия 

В этом руководстве вы начали работу с Azure Digital Twins — настроили экземпляр и клиентское приложение для взаимодействия с экземпляром. Вы использовали клиентское приложение для изучения Azure Digital Twins, а также для создания моделей, цифровых двойников и связей. Вы также выполнили в решении несколько запросов, чтобы понять, на какие вопросы о среде может ответить Azure Digital Twins.

Перейдите к следующему учебнику, в котором вам предстоит использовать пример приложения командной строки в сочетании с другими службами Azure для выполнения комплексного сценария, управляемого данными:
> [!div class="nextstepaction"]
> [*Руководство. Подключение комплексного решения*](tutorial-end-to-end.md)