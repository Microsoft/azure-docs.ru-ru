---
title: Управление конечными точками и маршрутами (портал)
titleSuffix: Azure Digital Twins
description: Узнайте, как настроить конечные точки и маршруты событий для данных Azure Digital двойников с помощью портал Azure и управлять ими.
author: baanders
ms.author: baanders
ms.date: 7/22/2020
ms.topic: how-to
ms.service: digital-twins
ms.openlocfilehash: 0f705aa61f1fe627dc0c8227242538e01ffce1d5
ms.sourcegitcommit: dd24c3f35e286c5b7f6c3467a256ff85343826ad
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/29/2021
ms.locfileid: "99070855"
---
# <a name="manage-endpoints-and-routes-in-azure-digital-twins-portal"></a>Управление конечными точками и маршрутами в Azure Digital двойников (портал)

[!INCLUDE [digital-twins-route-selector.md](../../includes/digital-twins-route-selector.md)]

В Azure Digital двойников можно маршрутизировать [уведомления о событиях](how-to-interpret-event-data.md) в подчиненные службы или подключенные ресурсы вычислений. Для этого сначала необходимо настроить **конечные точки**, которые могут получать события. Затем можно создать [**маршруты событий**](concepts-route-events.md) , указывающие, какие события, создаваемые Azure Digital двойников, доставляются в конечные точки.

В этой статье описывается процесс создания конечных точек и маршрутов с помощью [портал Azure](https://portal.azure.com).

Кроме того, можно также управлять конечными точками и маршрутами с помощью [API маршрутов событий](/rest/api/digital-twins/dataplane/eventroutes), [пакетов SDK](how-to-use-apis-sdks.md#overview-data-plane-apis)или [интерфейса командной строки Azure Digital двойников](how-to-use-cli.md). Версию этой статьи, которая использует эти механизмы вместо портала, см. [*в разделе Практические руководства. Управление конечными точками и маршрутами (API и интерфейс командной строки)*](how-to-manage-routes-apis-cli.md).

## <a name="prerequisites"></a>Предварительные требования

* Вам потребуется **учетная запись Azure** (вы можете настроить ее [здесь](https://azure.microsoft.com/free/?WT.mc_id=A261C142F)бесплатно).
* Вам потребуется **экземпляр Azure Digital двойников** в подписке Azure. Если у вас еще нет экземпляра, его можно создать, выполнив действия, описанные в разделе [*инструкции. Настройка экземпляра и проверки подлинности*](how-to-set-up-instance-portal.md). Используйте следующие значения из программы установки, которые можно использовать далее в этой статье:
    - Имя экземпляра
    - Группа ресурсов

Эти сведения можно найти в [портал Azure](https://portal.azure.com) после настройки экземпляра. Войдите на портал и найдите имя своего экземпляра на панели поиска портала.
 
:::image type="content" source="media/how-to-manage-routes-portal/search-field-portal.png" alt-text="Снимок экрана портал Azure панели поиска." lightbox="media/how-to-manage-routes-portal/search-field-portal.png":::

Выберите экземпляр из результатов, чтобы просмотреть эти сведения в обзоре для своего экземпляра.

:::image type="content" source="media/how-to-manage-routes-portal/instance-details.png" alt-text="Снимок экрана со страницей обзора для экземпляра цифрового двойников Azure. Имя и группа ресурсов выделены.":::

## <a name="create-an-endpoint-for-azure-digital-twins"></a>Создание конечной точки для Azure Digital двойников

Ниже приведены поддерживаемые типы конечных точек, которые можно создать для экземпляра.
* [Сетка событий](../event-grid/overview.md) 
* [Центры событий](../event-hubs/event-hubs-about.md)
* [Служебная шина](../service-bus-messaging/service-bus-messaging-overview.md)

Дополнительные сведения о различных типах конечных точек см. в статье [*Выбор между службами обмена сообщениями Azure*](../event-grid/compare-messaging-services.md).

В этом разделе объясняется, как создать одну из этих конечных точек в [портал Azure](https://portal.azure.com).

[!INCLUDE [digital-twins-endpoint-resources.md](../../includes/digital-twins-endpoint-resources.md)]

### <a name="create-the-endpoint"></a>Создание конечной точки 

После создания ресурсов конечной точки их можно использовать для конечной точки Azure Digital двойников. Чтобы создать новую конечную точку, перейдите на страницу своего экземпляра в [портал Azure](https://portal.azure.com) (можно найти экземпляр, введя его имя на панели поиска портала).

1. В меню экземпляр выберите пункт _конечные точки_. Затем на следующей странице *конечные точки* выберите *+ создать конечную точку*. Откроется страница *Создание конечной точки* , где вы заполните поля в следующих шагах.

    :::image type="content" source="media/how-to-manage-routes-portal/create-endpoint-event-grid.png" alt-text="Снимок экрана создания конечной точки сетки событий типа." lightbox="media/how-to-manage-routes-portal/create-endpoint-event-grid.png":::

1. Введите **имя** конечной точки и выберите **тип конечной точки**.

1. Заполните другие сведения, необходимые для типа конечной точки, включая подписку и ресурсы конечной точки, описанные [выше](#prerequisite-create-endpoint-resources).
    1. Для конечных точек концентратора событий и служебной шины необходимо выбрать **тип проверки подлинности**. Вы можете использовать проверку подлинности на основе ключей с предварительно созданным правилом авторизации или проверкой подлинности на основе удостоверений, если вы будете использовать конечную точку с [управляемым удостоверением](concepts-security.md#managed-identity-for-accessing-other-resources-preview) для вашего экземпляра Azure Digital двойников. 

    :::row:::
        :::column:::
            :::image type="content" source="media/how-to-manage-routes-portal/create-endpoint-event-hub-authentication.png" alt-text="Снимок экрана создания конечной точки типа &quot;концентратор событий&quot;." lightbox="media/how-to-manage-routes-portal/create-endpoint-event-hub-authentication.png":::
        :::column-end:::
        :::column:::
        :::column-end:::
    :::row-end:::

1. Завершите создание конечной точки, выбрав _сохранить_.

>[!IMPORTANT]
> Чтобы успешно использовать проверку подлинности на основе удостоверений для вашей конечной точки, необходимо создать управляемое удостоверение для своего экземпляра, выполнив действия, описанные в разделе [*инструкции. Включение управляемого удостоверения для событий маршрутизации (Предварительная версия)*](how-to-enable-managed-identities.md).

После создания конечной точки можно убедиться, что конечная точка была успешно создана, проверив значок уведомления на верхней панели портал Azure: 

:::row:::
    :::column:::
        :::image type="content" source="media/how-to-manage-routes-portal/create-endpoint-notifications.png" alt-text="Снимок экрана уведомления для проверки создания конечной точки. Выбран значок колокольчика с верхней панели портала, и появится уведомление о том, что конечная точка ADT-EH-Endpoint успешно создана.":::
    :::column-end:::
    :::column:::
    :::column-end:::
:::row-end:::

Если создание конечной точки завершается сбоем, просмотрите сообщение об ошибке и повторите попытку через несколько минут.

Вы также можете просмотреть конечную точку, созданную на странице *конечные точки* для своего экземпляра Digital двойников Azure.

Теперь служба "Сетка событий", "концентратор событий" или "служебная шина" доступна в качестве конечной точки в Azure Digital двойников под именем, выбранным для конечной точки. Обычно это имя используется в качестве цели для **маршрута события**, который будет создан [Далее в этой статье](#create-an-event-route).

### <a name="create-an-endpoint-with-dead-lettering"></a>Создание конечной точки с недоставленным письмом

Если конечная точка не может доставить событие в течение определенного периода времени или после попытки доставить событие определенное количество раз, оно может отправить недоставленное событие в учетную запись хранения. Этот процесс называется **недоставленным**.

Чтобы создать конечную точку с включенной недоставленным письмом, необходимо использовать [команды интерфейса командной строки](how-to-use-cli.md) или [API-интерфейсы плоскости управления](/rest/api/digital-twins/controlplane/endpoints/digitaltwinsendpoint_createorupdate) для создания конечной точки, а не портал Azure.

Инструкции по выполнению этих действий с помощью этих средств см. в разделе [*API и версия CLI*](how-to-manage-routes-apis-cli.md#create-an-endpoint-with-dead-lettering) этой статьи.

## <a name="create-an-event-route"></a>Создание маршрута события

Чтобы фактически передавать данные из Azure Digital двойников в конечную точку, необходимо определить **маршрут события**. Эти маршруты позволяют разработчикам связывать потоки событий во всей системе и в подчиненных службах. Дополнительные сведения о маршрутах событий см. в статье [*Маршрутизация событий цифровых двойников Azure*](concepts-route-events.md).

**Предварительные требования**. прежде чем можно будет перейти к созданию маршрута, необходимо создать конечные точки, как описано ранее в этой статье. После завершения настройки конечных точек можно перейти к созданию маршрута события.

>[!NOTE]
>Если вы недавно развернули конечные точки, убедитесь, что они завершили развертывание, **прежде чем** пытаться использовать их для нового маршрута событий. Если вы не можете настроить маршрут, так как конечные точки не готовы, подождите несколько минут и повторите попытку.

### <a name="creation-steps-with-the-azure-portal"></a>Создание шагов с помощью портал Azure

Определение маршрута события содержит следующие элементы:
* Имя маршрута, которое вы хотите использовать
* Имя конечной точки, которую вы хотите использовать.
* Фильтр, который определяет, какие события отправляются в конечную точку
    - Чтобы отключить маршрут таким образом, чтобы события не отправлялись, используйте значение фильтра `false`
    - Чтобы включить маршрут без какой-либо специальной фильтрации, используйте значение фильтра `true`
    - Дополнительные сведения о любом другом типе фильтра см. в разделе [*Фильтрация событий*](#filter-events) ниже.

Один маршрут позволяет выбрать несколько уведомлений и типов событий.

Чтобы создать маршрут событий, перейдите на страницу сведений об экземпляре Azure Digital двойников в [портал Azure](https://portal.azure.com) (вы можете найти его, введя его имя на панели поиска портала).

В меню экземпляр выберите пункт _маршруты событий_. Затем на следующей странице *маршрутов событий* выберите *+ создать маршрут события*. 

На открывшейся странице *Создание маршрута события* выберите минимум:
* Имя маршрута в поле " _имя_ "
* _Конечная точка_ , которую вы хотите использовать для создания маршрута 

Чтобы включить маршрут, необходимо также **Добавить фильтр маршрутов событий** по крайней мере `true` . (Если значение по умолчанию — `false` , будет создан маршрут, но в него не будут отправляться никакие события.) Для этого переключите переключатель в _Расширенный редактор_ , чтобы включить его, и напишите `true` в поле *фильтра* .

:::image type="content" source="media/how-to-manage-routes-portal/create-event-route-no-filter.png" alt-text="Снимок экрана создания маршрута события для экземпляра." lightbox="media/how-to-manage-routes-portal/create-event-route-no-filter.png":::

По завершении нажмите кнопку _Save (сохранить_ ), чтобы создать маршрут события.

## <a name="filter-events"></a>События фильтра

Как описано выше, у маршрутов есть поле **фильтра** . Если значение фильтра для маршрута равно, то `false` никакие события не будут отправляться в конечную точку. 

После включения минимального фильтра `true` конечные точки получат различные события из Azure Digital двойников:
* Данные телеметрии, созданные [цифровым двойников](concepts-twins-graph.md) с помощью API службы Digital двойников
* Двойника уведомления об изменении свойств для любых двойника в экземпляре цифрового двойников Azure
* События жизненного цикла, которые срабатывают при создании или удалении двойников или связей

Можно ограничить типы отправляемых событий, определив фильтр более конкретного типа.

Чтобы добавить фильтр событий во время создания маршрута событий, используйте раздел _Добавление фильтра маршрутов событий_ страницы *Создание маршрута события* . 

Можно выбрать один из основных общих параметров фильтра или использовать дополнительные параметры фильтра для создания собственных настраиваемых фильтров.

#### <a name="use-the-basic-filters"></a>Использование основных фильтров

Чтобы использовать основные фильтры, разверните параметр _типы событий_ и установите флажки, соответствующие событиям, которые вы хотите отправить в конечную точку. 

:::row:::
    :::column:::
        :::image type="content" source="media/how-to-manage-routes-portal/create-event-route-filter-basic-1.png" alt-text="Снимок экрана создания маршрута события с базовым фильтром. Установка флажков событий.":::
    :::column-end:::
    :::column:::
    :::column-end:::
:::row-end:::

При этом текстовое поле фильтра будет автоматически заполнено текстом выбранного фильтра:

:::row:::
    :::column:::
        :::image type="content" source="media/how-to-manage-routes-portal/create-event-route-filter-basic-2.png" alt-text="Снимок экрана создания маршрута события с базовым фильтром. Отображение автоматически заполняемого текста фильтра после выбора событий.":::
    :::column-end:::
    :::column:::
    :::column-end:::
:::row-end:::

#### <a name="use-the-advanced-filters"></a>Использование расширенных фильтров

Кроме того, можно использовать параметр Расширенный фильтр для создания собственных настраиваемых фильтров.

Чтобы создать маршрут события с дополнительными параметрами фильтра, переключите его в _Расширенный редактор_ , чтобы включить его. Затем можно написать собственные фильтры событий в поле *фильтра* :

:::row:::
    :::column:::
        :::image type="content" source="media/how-to-manage-routes-portal/create-event-route-filter-advanced.png" alt-text="Снимок экрана создания маршрута события с расширенным фильтром.":::
    :::column-end:::
    :::column:::
    :::column-end:::
:::row-end:::

Ниже приведены поддерживаемые фильтры маршрутов. Сведения в столбце *схема текста фильтра* — это текст, который можно указать в поле фильтра.

[!INCLUDE [digital-twins-route-filters](../../includes/digital-twins-route-filters.md)]

[!INCLUDE [digital-twins-route-metrics](../../includes/digital-twins-route-metrics.md)]

## <a name="next-steps"></a>Дальнейшие действия

Сведения о различных типах сообщений о событиях, которые можно получить:
* [*Пошаговое руководство. анализ данных события*](how-to-interpret-event-data.md)
