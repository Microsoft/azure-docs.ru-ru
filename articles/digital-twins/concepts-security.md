---
title: Безопасность для решений Azure Digital Twins
titleSuffix: Azure Digital Twins
description: Ознакомьтесь с рекомендациями по обеспечению безопасности в Azure Digital двойников.
author: baanders
ms.author: baanders
ms.date: 3/18/2020
ms.topic: conceptual
ms.service: digital-twins
ms.openlocfilehash: 81a44d4d0025c841cf56e19d6afee5e95bd44a55
ms.sourcegitcommit: c27a20b278f2ac758447418ea4c8c61e27927d6a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/03/2021
ms.locfileid: "101730513"
---
# <a name="secure-azure-digital-twins"></a>Защита цифровых двойников Azure

В целях безопасности Azure Digital двойников обеспечивает точный контроль доступа к определенным данным, ресурсам и действиям в развертывании. Это достигается за счет детальной стратегии управления ролями и разрешениями, называемой управлением **доступом на основе ролей Azure (Azure RBAC)**. Общие принципы Azure RBAC можно прочитать [здесь](../role-based-access-control/overview.md).

Azure Digital двойников также поддерживает шифрование неактивных данных.

## <a name="roles-and-permissions-with-azure-rbac"></a>Роли и разрешения с помощью Azure RBAC

Azure RBAC предоставляется в Azure Digital двойников через интеграцию с [Azure Active Directory](../active-directory/fundamentals/active-directory-whatis.md) (Azure AD).

Можно использовать Azure RBAC для предоставления разрешений *субъекту безопасности*, который может быть пользователем, группой или субъектом-службой приложения. Проверка подлинности субъекта безопасности осуществляется с помощью Azure AD и получение маркера OAuth 2,0 в возврате. Этот токен можно использовать для авторизации запроса доступа к экземпляру Digital двойников Azure.

### <a name="authentication-and-authorization"></a>Аутентификация и авторизация

В Azure AD доступ состоит из двух этапов. Когда участник безопасности (пользователь, группа или приложение) пытается получить доступ к Azure Digital двойников, запрос должен пройти *проверку подлинности* и *авторизоваться*. 

1. Во-первых, удостоверение субъекта безопасности *проходит проверку подлинности* и возвращается маркер OAuth 2,0.
2. Затем маркер передается как часть запроса в службу Digital двойников, чтобы *авторизовать* доступ к указанному ресурсу.

Этап проверки подлинности требует, чтобы любой запрос приложения содержал маркер доступа OAuth 2,0 во время выполнения. Если приложение выполняется в сущности Azure, например в приложении " [функции Azure](../azure-functions/functions-overview.md) ", оно может использовать **управляемое удостоверение** для доступа к ресурсам. Дополнительные сведения об управляемых удостоверениях см. в следующем разделе.

Для шага авторизации необходимо, чтобы роль Azure была назначена субъекту безопасности. Роли, назначенные субъекту безопасности, определяют разрешения, которые будут иметь субъекта. Azure Digital двойников предоставляет роли Azure, охватывающие наборы разрешений для ресурсов Digital двойников в Azure. Эти роли описаны далее в этой статье.

Дополнительные сведения о ролях и назначениях ролей, поддерживаемых в Azure, см. в разделе Общие сведения о [*различных ролях*](../role-based-access-control/rbac-and-directory-admin-roles.md) в документации по RBAC Azure.

#### <a name="authentication-with-managed-identities"></a>Проверка подлинности с помощью управляемых удостоверений

[Управляемые удостоверения для ресурсов Azure](../active-directory/managed-identities-azure-resources/overview.md) — это функция кросс-Azure, которая позволяет создать безопасное удостоверение, связанное с развертыванием, в котором выполняется код приложения. Затем это удостоверение можно связать с ролями управления доступом, чтобы предоставить настраиваемые разрешения на доступ к конкретным ресурсам Azure, которые требуются вашему приложению.

С помощью управляемых удостоверений платформа Azure управляет этим идентификатором среды выполнения. Ключи доступа не нужно хранить и защищать в коде приложений или конфигурации ни для удостоверения, ни для ресурсов, к которым необходимо получить доступ. Клиентское приложение Azure Digital двойников, работающее в приложении службы приложений Azure, не обязано выполнять обработку правил и ключей SAS, а также других маркеров доступа. Клиентскому приложению требуется только адрес конечной точки пространства имен Azure Digital двойников. При подключении приложения Azure Digital двойников привязывает контекст управляемого объекта к клиенту. После связывания с управляемым удостоверением клиент Azure Digital двойников сможет выполнять все разрешенные операции. Затем авторизация будет предоставляться путем связывания управляемого объекта с ролью Azure Digital двойников (описывается ниже).

#### <a name="authorization-azure-roles-for-azure-digital-twins"></a>Авторизация: роли Azure для цифрового двойников Azure

Azure предоставляет **две встроенные роли Azure** для авторизации доступа к [API-интерфейсам плоскости данных](how-to-use-apis-sdks.md#overview-data-plane-apis)Digital двойников. Вы можете ссылаться на роли по имени или по ИДЕНТИФИКАТОРу:

| Встроенные роли | Описание | ID | 
| --- | --- | --- |
| Владелец данных Azure Digital Twins | Предоставляет полный доступ к ресурсам Azure Digital двойников | bcd981a7-7f74-457b-83e1-cceb9e632ffe |
| Модуль чтения данных Azure Digital двойников | Предоставляет доступ только для чтения к ресурсам Azure Digital двойников | d57506d4-4c8d-48b1-8587-93c323f6a5a3 |

Назначить роли можно двумя способами.
* с помощью панели управления доступом (IAM) для Azure Digital двойников в портал Azure (см. раздел [*назначение ролей Azure с помощью портал Azure*](../role-based-access-control/role-assignments-portal.md)).
* Добавление или удаление роли с помощью команд интерфейса командной строки

Дополнительные сведения о том, как это сделать, см. в учебнике по цифровым двойников Azure [*: подключение комплексного решения*](tutorial-end-to-end.md).

Дополнительные сведения о том, как определяются встроенные роли, см. в разделе Описание [*определений ролей*](../role-based-access-control/role-definitions.md) в документации по методу RBAC Azure. Дополнительные сведения о создании пользовательских ролей Azure см. в статье [*пользовательские роли Azure*](../role-based-access-control/custom-roles.md).

##### <a name="automating-roles"></a>Автоматизация ролей

При ссылке на роли в автоматизированных сценариях рекомендуется ссылаться на них по **идентификаторам** , а не по именам. Имена могут изменяться между выпусками, но идентификаторы не будут, сделав их более стабильной ссылкой в службе автоматизации.

> [!TIP]
> Если вы ассигинг роли с помощью командлета, например `New-AzRoleAssignment` ([Reference](/powershell/module/az.resources/new-azroleassignment)), можно использовать `-RoleDefinitionId` параметр вместо `-RoleDefinitionName` для передачи идентификатора, а не имени роли.

### <a name="permission-scopes"></a>Области разрешений

Прежде чем назначить роль Azure субъекту безопасности, определите для него область доступа. Рекомендации определяют, что лучше всего предоставить только минимально возможную область.

В следующем списке описываются уровни, на которых можно ограничить доступ к ресурсам Digital двойников.
* Модели. действия для этого ресурса определяют управление [моделями](concepts-models.md) , отправленными в Azure Digital двойников.
* Запрос Digital двойников Graph. действия для этого ресурса определяют возможность выполнения [операций запросов](concepts-query-language.md) на цифровой двойников в цифровом графе Azure Digital двойников.
* Digital двойника. действия для этого ресурса обеспечивают управление операциями CRUD в [цифровом двойников](concepts-twins-graph.md) в графе двойника.
* Отношение Digital двойника. действия для этого ресурса определяют управление операциями CRUD над [связями](concepts-twins-graph.md) между цифровыми двойниковми в двойника графе.
* Маршрут события. действия для этого ресурса определяют разрешения на [маршрутизацию событий](concepts-route-events.md) из Azure Digital двойников в службу конечной точки, например [концентратор событий](../event-hubs/event-hubs-about.md), службу " [Сетка событий](../event-grid/overview.md)" или [служебную шину](../service-bus-messaging/service-bus-messaging-overview.md).

### <a name="troubleshooting-permissions"></a>Разрешения на устранение неполадок

Если пользователь пытается выполнить действие, недопустимое его ролью, они могут получить сообщение об ошибке при чтении запроса на обслуживание `403 (Forbidden)` . Дополнительные сведения и инструкции по устранению неполадок см. [*в разделе Устранение неполадок: сбой запроса цифрового двойников для Azure с состоянием: 403 (запрещено)*](troubleshoot-error-403.md).

## <a name="managed-identity-for-accessing-other-resources-preview"></a>Управляемое удостоверение для доступа к другим ресурсам (Предварительная версия)

Настройка **управляемого удостоверения** [Azure Active Directory (Azure AD)](../active-directory/fundamentals/active-directory-whatis.md) для экземпляра цифрового двойников Azure позволяет экземпляру легко получать доступ к другим ресурсам, защищенным Azure AD, таким как [Azure Key Vault](../key-vault/general/overview.md). Удостоверение управляется платформой Azure и не требует предоставления или смены секретов. Дополнительные сведения об управляемых удостоверениях в Azure AD см. в статье  [*управляемые удостоверения для ресурсов Azure*](../active-directory/managed-identities-azure-resources/overview.md). 

Azure поддерживает два типа управляемых удостоверений: назначенные системой и назначенные пользователем. В настоящее время Azure Digital двойников поддерживает только **назначенные системой удостоверения**. 

Вы можете использовать управляемое системой удостоверение, назначенное для цифрового экземпляра Azure, для проверки подлинности в [определяемой пользователем конечной точке](concepts-route-events.md#create-an-endpoint). Azure Digital двойников поддерживает назначенную системой проверку подлинности на основе удостоверений в конечных точках [концентратора событий](../event-hubs/event-hubs-about.md) и назначений служебной [шины](../service-bus-messaging/service-bus-messaging-overview.md)   , а в конечную точку [контейнера хранилища Azure](../storage/blobs/storage-blobs-introduction.md)—   для [событий недоставленных сообщений](concepts-route-events.md#dead-letter-events). [Сетка событий](../event-grid/overview.md)   в настоящее время конечные точки не поддерживаются для управляемых удостоверений.

Инструкции о том, как включить управляемое системой удостоверение для Azure Digital двойников и использовать его для маршрутизации событий, см. в разделе [*инструкции. Включение управляемого удостоверения для событий маршрутизации (Предварительная версия)*](./how-to-enable-managed-identities-portal.md).

## <a name="private-network-access-with-azure-private-link-preview"></a>Доступ к частной сети с помощью частной связи Azure (Предварительная версия)

[Частная связь Azure](../private-link/private-link-overview.md) — это служба, которая позволяет получать доступ к ресурсам Azure (таким как [концентраторы событий Azure](../event-hubs/event-hubs-about.md), служба [хранилища Azure](../storage/common/storage-introduction.md)и [Azure Cosmos DB](../cosmos-db/introduction.md)), а также службы, размещенные в Azure, в частной конечной точке в [виртуальной сети Azure (VNet)](../virtual-network/virtual-networks-overview.md). 

Аналогичным образом можно использовать частные конечные точки для экземпляра Azure Digital двойника, чтобы разрешить клиентам, находящимся в виртуальной сети, безопасный доступ к экземпляру через частную связь. 

Частная конечная точка использует IP-адрес из адресного пространства виртуальной сети Azure. Сетевой трафик между клиентом в частной сети и экземпляром Digital двойников Azure проходит по виртуальной сети и частной ссылке на магистральную сеть Майкрософт, что устраняет уязвимость в общедоступном Интернете. Это визуальное представление этой системы:

:::image type="content" source="media/concepts-security/private-link.png" alt-text="Схема, показывающая сеть для Повергрид компании, которая является защищенной ВИРТУАЛЬНОЙ сетью без доступа к Интернету или общедоступному облаку, подключение через частный канал к экземпляру цифрового двойников Azure с именем Цитйофтвинс.":::

Настройка частной конечной точки для экземпляра Digital двойников Azure позволяет защитить экземпляр Azure Digital двойников и исключить открытую раскрытие, а также избежать утечка данных из виртуальной сети.

Инструкции по настройке частного канала для Azure Digital двойников см. в разделе [*практические рекомендации. включение частного доступа с помощью закрытой ссылки (Предварительная версия)*](./how-to-enable-private-link-portal.md).

### <a name="design-considerations"></a>Рекомендации по проектированию 

При работе с частной ссылкой на Azure Digital двойников ниже приведены некоторые факторы, которые следует учитывать.
* **Цены**: сведения о ценах см. на  [странице цен на частную связь Azure](https://azure.microsoft.com/pricing/details/private-link). 
* **Доступность по регионам**. для Azure Digital двойников эта функция доступна во всех регионах Azure, где доступен Azure Digital двойников. 
* **Максимальное число частных конечных точек на экземпляр Azure Digital двойников**: 10

Сведения об ограничениях частной ссылки см. в [документации по частной ссылке Azure: ограничения](../private-link/private-link-service-overview.md#limitations).

## <a name="service-tags"></a>Теги служб

**Тег службы** представляет группу ПРЕФИКСОВ IP-адресов из заданной службы Azure. Корпорация Майкрософт управляет префиксами адресов, входящих в тег службы, и автоматически обновляет этот тег при изменении адресов, сводя к минимуму сложность частых обновлений правил сетевой безопасности. Дополнительные сведения о тегах служб см. в разделе  [*теги виртуальной сети*](../virtual-network/service-tags-overview.md). 

Вы можете использовать теги службы для определения элементов управления доступом к сети для [групп безопасности сети](../virtual-network/network-security-groups-overview.md#security-rules)   или [брандмауэра Azure](../firewall/service-tags.md), используя теги службы вместо конкретных IP-адресов при создании правил безопасности. Указав имя тега службы (в данном случае **азуредигиталтвинс**) в соответствующем поле *источника*   или *назначения*   правила, можно разрешить или запретить трафик для соответствующей службы. 

Ниже приведены подробные сведения о теге службы **азуредигиталтвинс** .

| Тег | Назначение | Может ли использовать входящий или исходящий трафик? | Может быть региональным? | Можно ли использовать с Брандмауэром Azure? |
| --- | --- | --- | --- | --- |
| азуредигиталтвинс | Azure Digital Twins<br>Примечание. Этот тег или IP-адреса, охваченные этим тегом, можно использовать для ограничения доступа к конечным точкам, настроенным для [маршрутов событий](concepts-route-events.md). | Входящий трафик | Нет | Да |

### <a name="using-service-tags-for-accessing-event-route-endpoints"></a>Использование тегов службы для доступа к конечным точкам маршрута событий 

Ниже приведены инструкции по доступу к конечным точкам [маршрута событий](concepts-route-events.md) с помощью тегов службы в Azure Digital двойников.

1. Сначала скачайте эту ссылку на JSON-файл с примерами диапазонов Azure IP и тегами службы: [*диапазоны IP-адресов Azure и теги службы*](https://www.microsoft.com/download/details.aspx?id=56519). 

2. Найдите диапазоны IP-адресов "Азуредигиталтвинс" в файле JSON.  

3. Сведения о настройке IP-фильтров для этого ресурса см. в документации по внешнему ресурсу, подключенному к конечной точке (например, к службе " [Сетка событий](../event-grid/overview.md)", [концентратору событий](../event-hubs/event-hubs-about.md), [служебной шине или службе](../service-bus-messaging/service-bus-messaging-overview.md) [хранилища Azure](../storage/blobs/storage-blobs-overview.md) для [событий недоставленных сообщений](concepts-route-events.md#dead-letter-events)).

4. Настройте IP-фильтры для внешних ресурсов, используя диапазоны IP-адресов из *шага 2*.  

5. Периодически обновляйте диапазоны IP-адресов. Диапазоны могут меняться со временем, поэтому рекомендуется регулярно проверять их и обновлять при необходимости. Частота этих обновлений может быть различной, но рекомендуется проверять их раз в неделю.

## <a name="encryption-of-data-at-rest"></a>Шифрование неактивных данных

Azure Digital двойников обеспечивает шифрование неактивных и транзитных данных, так как оно написано в наших центрах обработки данных, и расшифровывает его по мере доступа к нему. Это шифрование выполняется с помощью ключа шифрования, управляемого корпорацией Майкрософт.

## <a name="cross-origin-resource-sharing-cors"></a>Общий доступ к ресурсам независимо от источника (CORS)

Azure Digital двойников сейчас не поддерживает **общий доступ к ресурсам между источниками (CORS)**. В результате, если вы вызываете REST API из приложения браузера, интерфейса [управления API (APIM)](../api-management/api-management-key-concepts.md) или соединителя [Power Apps](/powerapps/powerapps-overview) , может появиться сообщение об ошибке политики.

Чтобы устранить эту ошибку, можно выполнить одно из следующих действий.
* Удалить Заголовок CORS `Access-Control-Allow-Origin` из сообщения. Этот заголовок указывает, можно ли предоставить общий доступ к ответу. 
* Кроме того, можно создать прокси-сервер CORS и сделать REST API Azure Digital двойников. 

## <a name="next-steps"></a>Дальнейшие действия

* Сведения об этих концепциях см. в разделе [*как настроить экземпляр и проверку подлинности*](how-to-set-up-instance-portal.md).

* Сведения о том, как взаимодействовать с этими концепциями из кода клиентского приложения, см. в статье [*написание кода проверки подлинности приложения*](how-to-authenticate-client.md).

* Узнайте больше об [Azure RBAC](../role-based-access-control/overview.md).