---
title: Интерпретация данных о событиях
titleSuffix: Azure Digital Twins
description: См. статью как интерпретировать различные типы событий и их различные уведомления.
author: baanders
ms.author: baanders
ms.date: 6/23/2020
ms.topic: how-to
ms.service: digital-twins
ms.openlocfilehash: a0f2b971eae5d37e8fb0771e213075289af6c519
ms.sourcegitcommit: 8dd8d2caeb38236f79fe5bfc6909cb1a8b609f4a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "98045263"
---
# <a name="understand-event-data"></a>Общие сведения о событиях

Различные события в Azure Digital двойников создают **уведомления**, которые позволяют серверной части решения знать о различных действиях. Затем они [направляются](concepts-route-events.md) в разные расположения внутри и за пределами цифрового двойников Azure, которые могут использовать эти сведения для выполнения действий.

Существует несколько типов уведомлений, которые могут быть созданы, а сообщения уведомления могут различаться в зависимости от типа создаваемого им события. В этой статье приводятся подробные сведения о различных типах сообщений и о том, как они могут выглядеть.

На этой диаграмме показаны различные типы уведомлений:

[!INCLUDE [digital-twins-notifications.md](../../includes/digital-twins-notifications.md)]

Как правило, уведомления состоят из двух частей: заголовка и текста. 

### <a name="event-notification-headers"></a>Заголовки уведомлений о событиях

Заголовки сообщений уведомлений представлены парами "ключ-значение". В зависимости от используемого протокола (MQTT, AMQP или HTTP) заголовки сообщений будут сериализованы по-разному. В этом разделе рассматриваются общие сведения о заголовках для сообщений об уведомлениях, независимо от выбранного протокола и сериализации.

Некоторые уведомления соответствуют стандарту [клаудевентс](https://cloudevents.io/) . Клаудевентс соответствие выглядит следующим образом.
* Уведомления, созданные на устройствах, продолжают следовать существующим спецификациям для уведомлений.
* Уведомления, обработанные и выпущенные центром Интернета вещей, продолжают следовать существующим спецификациям для уведомления, за исключением случаев, когда центр Интернета вещей выбирает поддержку Клаудевентс, например с помощью службы "Сетка событий".
* Уведомления, созданные из [Digital двойников](concepts-twins-graph.md) с [моделью](concepts-models.md) , соответствуют клаудевентс
* Уведомления, обработанные и созданные с помощью Azure Digital двойников, соответствуют Клаудевентс

Службы должны добавить порядковый номер для всех уведомлений, чтобы обозначить их порядок, или сохранить собственный порядок другим способом. 

Уведомления, созданные в службе "Сетка событий" Azure Digital двойников, будут автоматически отформатированы как схема Клаудевентс или схема Евентгридевент в зависимости от типа схемы, определенного в разделе "Сетка событий". 

Атрибуты расширения в заголовках будут добавлены как свойства в схеме сетки событий внутри полезных данных. 

### <a name="event-notification-bodies"></a>Основные тексты уведомлений о событиях

Тексты сообщений с уведомлениями описаны здесь в JSON. В зависимости от сериализации, необходимой для текста сообщения (например, с JSON, КБОР, protobuf и т. д.), тело сообщения может быть сериализовано по-разному.

Набор полей, содержащихся в тексте, зависит от различных типов уведомлений. Вот два образца основных текста сообщений, чтобы получить представление о том, как они обычно выглядят и могут включать.

Сообщение телеметрии:

```json
{
  "specversion": "1.0",
  "id": "df5a5992-817b-4e8a-b12c-e0b18d4bf8fb",
  "type": "microsoft.iot.telemetry",
  "source": "contoso-adt.api.wus2.digitaltwins.azure.net/digitaltwins/room1",
  "data": {
    "Temperature": 10
  },
  "dataschema": "dtmi:example:com:floor4;2",
  "datacontenttype": "application/json",
  "traceparent": "00-7e3081c6d3edfb4eaf7d3244b2036baa-23d762f4d9f81741-01"
}
```

Сообщение уведомления о жизненном цикле:

```json
{
  "specversion": "1.0",
  "id": "d047e992-dddc-4a5a-b0af-fa79832235f8",
  "type": "Microsoft.DigitalTwins.Twin.Create",
  "source": "contoso-adt.api.wus2.digitaltwins.azure.net",
  "data": {
    "$dtId": "floor1",
    "$etag": "W/\"e398dbf4-8214-4483-9d52-880b61e491ec\"",
    "$metadata": {
      "$model": "dtmi:example:Floor;1"
    }
  },
  "subject": "floor1",
  "time": "2020-06-23T19:03:48.9700792Z",
  "datacontenttype": "application/json",
  "traceparent": "00-18f4e34b3e4a784aadf5913917537e7d-691a71e0a220d642-01"
}
```

## <a name="message-format-detail-for-different-event-types"></a>Сведения о формате сообщений для различных типов событий

В этом разделе приводятся более подробные сведения о различных типах уведомлений, созданных в центре Интернета вещей и Azure Digital двойников (или других службах Azure IoT). Вы узнаете о том, что инициирует каждый тип уведомления, а также о наборе полей, включаемых в каждый тип текста уведомления.

### <a name="digital-twin-life-cycle-notifications"></a>Уведомления о жизненном цикле цифровых двойника

Все уведомления [цифровых двойников](concepts-twins-graph.md) выдаются независимо от того, представляют ли они [устройства центра Интернета вещей в Azure Digital двойников](how-to-ingest-iot-hub-data.md) . Это происходит из **-за уведомлений о жизненном цикле**, которые относятся к самому цифровому двойника.

Уведомления жизненного цикла активируются в следующих случаях:
* Создается цифровой двойника
* Удален цифровой двойника

#### <a name="properties"></a>Свойства

Ниже приведены поля в тексте уведомления о жизненном цикле.

| Название | Значение |
| --- | --- |
| `id` | Идентификатор уведомления, например UUID или счетчик, поддерживаемый службой. `source` + `id` уникален для каждого отдельного события. |
| `source` | Имя центра Интернета вещей или экземпляра Azure Digital двойников, например *myhub.Azure-Devices.NET* или *mydigitaltwins.westus2.azuredigitaltwins.NET* |
| `specversion` | *1.0*<br>Сообщение соответствует данной версии [спецификации клаудевентс](https://github.com/cloudevents/spec). |
| `type` | `Microsoft.DigitalTwins.Twin.Create`<br>`Microsoft.DigitalTwins.Twin.Delete` |
| `datacontenttype` | `application/json` |
| `subject` | Идентификатор цифрового двойника |
| `time` | Метка времени, когда операция произошла в двойника |
| `traceparent` | Контекст трассировки W3C для события |

#### <a name="body-details"></a>Сведения о тексте

Тело — это затронутый цифровой двойника, представленный в формате JSON. Схема для этого ресурса — *Digital двойников Resource 7,1*.

Для событий создания полезные данные отражают состояние двойника после создания ресурса, поэтому он должен включать все созданные системой элементы, как `GET` вызов.

Ниже приведен пример текста для устройства [IoT Plug and Play (PnP)](../iot-pnp/overview-iot-plug-and-play.md) с компонентами и без свойств верхнего уровня. Свойства, которые не имеют смысла для устройств (например, сообщаемых свойств), следует опустить.

```json
{
  "$dtId": "device-digitaltwin-01",
  "$etag": "W/\"e59ce8f5-03c0-4356-aea9-249ecbdc07f9\"",
  "thermostat": {
    "temperature": 80,
    "humidity": 45,
    "$metadata": {
      "$model": "dtmi:com:contoso:Thermostat;1",
      "temperature": {
        "desiredValue": 85,
        "desiredVersion": 3,
        "ackVersion": 2,
        "ackCode": 200,
        "ackDescription": "OK"
      },
      "humidity": {
        "desiredValue": 40,
        "desiredVersion": 1,
        "ackVersion": 1,
        "ackCode": 200,
        "ackDescription": "OK"
      }
    }
  },
  "$metadata": {
    "$model": "dtmi:com:contoso:Thermostat_X500;1",
  }
}
```

Вот еще один пример цифрового двойникаа. Это основано на [модели](concepts-models.md)и не поддерживает компоненты:

```json
{
  "$dtId": "logical-digitaltwin-01",
  "$etag": "W/\"e59ce8f5-03c0-4356-aea9-249ecbdc07f9\"",
  "avgTemperature": 70,
  "comfortIndex": 85,
  "$metadata": {
    "$model": "dtmi:com:contoso:Building;1",
    "avgTemperature": {
      "desiredValue": 72,
      "desiredVersion": 5,
      "ackVersion": 4,
      "ackCode": 200,
      "ackDescription": "OK"
    },
    "comfortIndex": {
      "desiredValue": 90,
      "desiredVersion": 1,
      "ackVersion": 3,
      "ackCode": 200,
      "ackDescription": "OK"
    }
  }
}
```

### <a name="digital-twin-relationship-change-notifications"></a>Уведомления об изменении отношений с цифровыми двойниками

**Уведомления об изменении связей** активируются при создании, обновлении или удалении любой связи цифрового двойника. 

#### <a name="properties"></a>Свойства

Ниже приведены поля в тексте уведомления об изменении ребра.

| Название    | Значение |
| --- | --- |
| `id` | Идентификатор уведомления, например UUID или счетчик, поддерживаемый службой. `source` + `id` уникален для каждого отдельного события |
| `source` | Имя экземпляра Azure Digital двойников, например *mydigitaltwins.westus2.azuredigitaltwins.NET* |
| `specversion` | *1.0*<br>Сообщение соответствует данной версии [спецификации клаудевентс](https://github.com/cloudevents/spec). |
| `type` | `Microsoft.DigitalTwins.Relationship.Create`<br>`Microsoft.DigitalTwins.Relationship.Update`<br>`Microsoft.DigitalTwins.Relationship.Delete`
|`datacontenttype`| `application/json` |
| `subject` | ИДЕНТИФИКАТОР связи, например `<twinID>/relationships/<relationshipID>` |
| `time` | Отметка времени для выполнения операции в связи |
| `traceparent` | Контекст трассировки W3C для события |

#### <a name="body-details"></a>Сведения о тексте

Текст — это полезная нагрузка связи, также в формате JSON. Он использует тот же формат, что и `GET` запрос связи через [API дигиталтвинс](/rest/api/digital-twins/dataplane/twins). 

"Обновление связи" означает, что свойства связи изменились. 

Ниже приведен пример уведомления о связи обновления для обновления свойства.

```json
{
    "modelId": "dtmi:example:Floor;1",
    "patch": [
      {
        "value": "user3",
        "path": "/ownershipUser",
        "op": "replace"
      }
    ]
  }
```

Для параметр `Relationship.Delete` Body является тем же, что `GET` и запрос, и получает Последнее состояние перед удалением.

Ниже приведен пример уведомления о создании или удалении связи.

```json
{
    "$relationshipId": "device_to_device",
    "$etag": "W/\"72479873-0083-41a8-83e2-caedb932d881\"",
    "$relationshipName": "Connected",
    "$targetId": "device2",
    "connectionType": "WIFI"
}
```

### <a name="digital-twin-change-notifications"></a>Уведомления об изменениях цифровых двойника

**Уведомления об изменениях цифровых двойника** активируются при обновлении цифрового двойника, например:
* При изменении значений свойств или метаданных.
* При изменении метаданных в цифровом двойника или компоненте. Примером такого сценария является изменение модели цифрового двойника.

#### <a name="properties"></a>Свойства

Ниже приведены поля в тексте уведомления об изменении цифрового двойника.

| Название    | Значение |
| --- | --- |
| `id` | Идентификатор уведомления, например UUID или счетчик, поддерживаемый службой. `source` + `id` уникален для каждого отдельного события |
| `source` | Имя центра Интернета вещей или экземпляра Azure Digital двойников, например *myhub.Azure-Devices.NET* или *mydigitaltwins.westus2.azuredigitaltwins.NET*
| `specversion` | *1.0*<br>Сообщение соответствует данной версии [спецификации клаудевентс](https://github.com/cloudevents/spec). |
| `type` | `Microsoft.DigitalTwins.Twin.Update` |
| `datacontenttype` | `application/json` |
| `subject` | Идентификатор цифрового двойника |
| `time` | Метка времени, когда операция была выполнена в цифровом двойника |
| `traceparent` | Контекст трассировки W3C для события |

#### <a name="body-details"></a>Сведения о тексте

Текст `Twin.Update` уведомления представляет собой документ с исправлением JSON, содержащий обновление цифрового двойника.

Например, предположим, что цифровое двойника было обновлено с помощью следующего исправления.

:::code language="json" source="~/digital-twins-docs-samples/models/patch-component-2.json":::

Соответствующее уведомление (если служба, синхронно выполняемая службой, например Azure Digital двойников, которая обновляет цифровой двойника), будет иметь следующий текст:

```json
{
    "modelId": "dtmi:example:com:floor4;2",
    "patch": [
      {
        "value": 40,
        "path": "/Temperature",
        "op": "replace"
      },
      {
        "value": 30,
        "path": "/comp1/prop1",
        "op": "add"
      }
    ]
  }
```

## <a name="next-steps"></a>Дальнейшие действия

См. раздел Создание конечных точек и маршрутов для доставки событий.
* [*Руководство. Управление конечными точками и маршрутами*](how-to-manage-routes-apis-cli.md)

Или ознакомьтесь с дополнительными сведениями о параметрах API и пакета SDK для цифровых двойников Azure:
* [*Практические руководства. Использование API-интерфейсов и пакетов SDK для цифровых двойников Azure*](how-to-use-apis-sdks.md)