---
title: Создание пользовательских пакетов SDK для определенных языков с помощью AutoRest
titleSuffix: Azure Digital Twins
description: Узнайте, как использовать Автозапись для создания пакетов SDK для пользовательского языка для написания кода Azure Digital двойников на других языках, у которых нет опубликованных пакетов SDK.
author: baanders
ms.author: baanders
ms.date: 3/9/2021
ms.topic: how-to
ms.service: digital-twins
ms.custom:
- devx-track-js
- contperf-fy21q3
ms.openlocfilehash: 35cf54199f8f2c187ad397c21fb941111f07c4a3
ms.sourcegitcommit: e6de1702d3958a3bea275645eb46e4f2e0f011af
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/20/2021
ms.locfileid: "102561846"
---
# <a name="create-custom-language-sdks-for-azure-digital-twins-using-autorest"></a>Создание пользовательских пакетов SDK для Azure Digital двойников с помощью функции автоотдыха

Если вам нужно работать с Azure Digital двойников, используя язык, который не содержит [опубликованного пакета SDK для Azure Digital двойников](how-to-use-apis-sdks.md), в этой статье будет показано, как использовать автооставшуюся для создания собственного пакета SDK на выбранном языке. 

В примерах в этой статье показано создание [пакета SDK для плоскости данных](how-to-use-apis-sdks.md#overview-data-plane-apis), но этот процесс будет работать и для создания  [пакета SDK для плоскости управления](how-to-use-apis-sdks.md#overview-control-plane-apis) .

## <a name="prerequisites"></a>Предварительные требования

Чтобы создать пакет SDK, сначала необходимо выполнить следующую настройку на локальном компьютере:
* Установка [**автоотдыха**](https://github.com/Azure/autorest)версии 2.0.4413 (версия 3 сейчас не поддерживается)
* Установка [**Node.js**](https://nodejs.org), которая является предварительным условием для использования функции автоотдыха
* Установка [ **Visual Studio**](https://visualstudio.microsoft.com/downloads/)
* Скачайте последнюю версию файла **Swagger** (OpenAPI) Azure Digital двойников из [папки Swagger плоскости данных](https://github.com/Azure/azure-rest-api-specs/tree/master/specification/digitaltwins/data-plane/Microsoft.DigitalTwins), а также соответствующую папку примеров. Файл Swagger называется *digitaltwins.jsв*.

>[!TIP]
> Чтобы создать **пакет SDK для плоскости управления** , выполните действия, описанные в этой статье, используя последний файл **Swagger плоскости управления** (OpenAPI) из [папки контрольной плоскости Swagger](https://github.com/Azure/azure-rest-api-specs/tree/master/specification/digitaltwins/resource-manager/Microsoft.DigitalTwins/) , а не из плоскости данных.

После того как компьютер оснащен всеми данными из приведенного выше списка, вы можете использовать автооставшуюся для создания пакета SDK.

## <a name="create-the-sdk-using-autorest"></a>Создание пакета SDK с помощью функции автоотдыха 

После установки Node.js можно выполнить следующую команду, чтобы убедиться, что установлена требуемая версия "Автоустановка".
```cmd/sh
npm install -g autorest@2.0.4413
```

Чтобы выполнить автооставшуюся в файле Swagger Azure Digital двойников, выполните следующие действия.
1. Скопируйте файл Swagger Azure Digital двойников и соответствующую папку примеров в рабочий каталог.
2. Используйте окно командной строки, чтобы перейти к рабочему каталогу.
3. Выполните команду "автооставшаяся" с помощью следующей команды. Замените `<language>` заполнитель выбранным языком: `python` , `java` , `go` и т. д. (Полный список параметров можно найти в [файле сведений об авторелизе](https://github.com/Azure/autorest).)

```cmd/sh
autorest --input-file=digitaltwins.json --<language> --output-folder=DigitalTwinsApi --add-credentials --azure-arm --namespace=DigitalTwinsApi
```

В результате вы увидите новую папку с именем *дигиталтвинсапи* в рабочем каталоге. Создаваемые файлы SDK будут иметь пространство имен *дигиталтвинсапи*. Вы по-прежнему будете использовать это пространство имен с помощью остальных примеров использования в этой статье.

Автооставшаяся версия поддерживает широкий спектр генераторов кода языка.

## <a name="make-the-sdk-into-a-class-library"></a>Создание пакета SDK в библиотеке классов

Вы можете включить файлы, созданные функцией автоотдыха, непосредственно в решение .NET. Однако, скорее всего, потребуется включить пакет SDK для Digital двойников в несколько отдельных проектов (клиентские приложения, приложения функций Azure и многое другое). По этой причине может оказаться полезным создать отдельный проект (библиотеку классов .NET) из созданных файлов. Затем этот проект библиотеки классов можно включить в несколько решений в качестве ссылки на проект.

В этом разделе приводятся инструкции по созданию пакета SDK в виде библиотеки классов, которая является собственным проектом и может быть включена в другие проекты. Эти действия зависят от **Visual Studio**.

Ниже приведены шаги.

1. Создание нового решения Visual Studio для библиотеки классов
2. Использовать *дигиталтвинсапи* в качестве имени проекта
3. В обозревателе решений щелкните правой кнопкой мыши проект *дигиталтвинсапи* созданного решения и выберите *Добавить > существующий элемент...*
4. Найдите папку, в которой был создан пакет SDK, и выберите файлы на корневом уровне.
5. Нажмите кнопку "ОК"
6. Добавьте папку в проект (щелкните проект правой кнопкой мыши в обозреватель решений и выберите *добавить > Новая папка*).
7. Назовите *модели* папок
8. Щелкните правой кнопкой мыши папку *модели* в обозревателе решений и выберите *Добавить > существующий элемент...*
9. Выберите файлы в папке *Models* СОЗДАННОГО пакета SDK и нажмите кнопку ОК.

Для успешного создания пакета SDK в проекте понадобятся следующие ссылки:
* `Microsoft.Rest.ClientRuntime`
* `Microsoft.Rest.ClientRuntime.Azure`

Чтобы добавить их, откройте *инструменты > диспетчер пакетов nuget > управления пакетами NuGet для решения.*...

1. На панели убедитесь, что выбрана вкладка *Обзор* .
2. Поиск *Microsoft. RESTful*
3. Выберите `ClientRuntime` пакеты и `ClientRuntime.Azure` и добавьте их в решение.

Теперь можно создать проект и включить его в качестве ссылки на проект в любое написанное вами приложение Azure Digital двойников.

## <a name="tips-for-using-the-sdk"></a>Советы по использованию пакета SDK

В этом разделе содержатся общие сведения и рекомендации по использованию созданного пакета SDK.

### <a name="synchronous-and-asynchronous-calls"></a>Синхронные и асинхронные вызовы

Все функции пакета SDK имеют синхронные и асинхронные версии.

### <a name="typed-and-untyped-data"></a>Типизированные и нетипизированные данные

REST API вызовы обычно возвращают строго типизированные объекты. Тем не менее, так как Azure Digital двойников позволяет пользователям определять собственные пользовательские типы для двойников, невозможно предварительно определить статические возвращаемые данные для многих вызовов Azure Digital двойников. Вместо этого интерфейсы API возвращают строго типизированные типы оболочек, где это применимо, а пользовательские данные двойника находятся в объектах Json.NET (используется везде, где в сигнатурах API отображается тип данных Object). Эти объекты можно привести к соответствующим образом в коде.

### <a name="error-handling"></a>Обработка ошибок

При возникновении ошибки в пакете SDK (включая ошибки HTTP, такие как 404) пакет SDK выдает исключение. По этой причине важно инкапсулировать все вызовы API внутри блоков try/catch.

Ниже приведен фрагмент кода, который пытается добавить двойника и перехватывает все ошибки в этом процессе:

:::code language="csharp" source="~/digital-twins-docs-samples/sdks/csharp/twin_operations_other.cs" id="CreateTwin_errorHandling":::

### <a name="paging"></a>Разбивка на страницы

При автоrestful создаются два типа шаблонов подкачки для пакета SDK:
* Один для всех API, за исключением API запросов
* Один для API запроса

Ниже приведен пример метода, показывающий, как получить список исходящих связей от Azure Digital двойников в шаблоне постраничного просмотра без запроса:

:::code language="csharp" source="~/digital-twins-docs-samples/sdks/csharp/graph_operations_sample.cs" id="FindOutgoingRelationshipsMethod":::

Второй шаблон создается только для API запроса. Он явно используется `continuationToken` .

>[!TIP]
> Основной причиной получения страниц является вычисление [расходов единиц запросов](concepts-query-units.md) для вызова API запроса.

Ниже приведен пример с этим шаблоном:

:::code language="csharp" source="~/digital-twins-docs-samples/sdks/csharp/queries.cs" id="PagedQuery":::

## <a name="next-steps"></a>Следующие шаги

Пошаговые инструкции по созданию клиентского приложения, в котором можно использовать пакет SDK:
* [*Руководство. Написание кода для клиентского приложения*](tutorial-code.md)
