---
title: Общие сведения о сетевом подключении к виртуальным рабочим столам Windows
titleSuffix: Azure
description: Дополнительные сведения о сетевом подключении к виртуальным рабочим столам Windows
author: gundarev
ms.topic: conceptual
ms.date: 11/16/2020
ms.author: denisgun
ms.openlocfilehash: e4149864e16196b695d38a8c46ab5af835453412
ms.sourcegitcommit: 867cb1b7a1f3a1f0b427282c648d411d0ca4f81f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "99221216"
---
# <a name="understanding-windows-virtual-desktop-network-connectivity"></a>Общие сведения о сетевом подключении к виртуальным рабочим столам Windows

Виртуальные рабочие столы Windows позволяют размещать клиентские сеансы на узлах сеансов, работающих в Azure. Корпорация Майкрософт управляет частями служб от имени клиента и предоставляет защищенные конечные точки для подключения клиентов и узлов сеансов. На приведенной ниже схеме представлен общий обзор сетевых подключений, используемых виртуальным рабочим столом Windows.

:::image type="content" source="media/windows-virtual-desktop-network-connections.svg" alt-text="Схема сетевых подключений к виртуальным рабочим столам Windows" lightbox="media/windows-virtual-desktop-network-connections.svg":::

## <a name="session-connectivity"></a>Подключение к сеансу

Виртуальный рабочий стол Windows использует протокол удаленного рабочего стола (RDP) для предоставления возможностей удаленного просмотра и ввода через сетевые подключения. Протокол RDP изначально был выпущен в Windows NT 4,0 Terminal Server Edition и был постоянно развиваться с каждым выпуском Microsoft Windows и Windows Server. С самого начала RDP разрабатывался как не зависящий от базового транспортного стека, и сегодня он поддерживает несколько типов транспорта.

## <a name="reverse-connect-transport"></a>Транспорт для обратных подключений

Виртуальный рабочий стол Windows использует транспорт обратных подключений для установления удаленного сеанса и передачи трафика RDP. В отличие от локальных службы удаленных рабочих столов развертывания, для приема входящих RDP-подключений не используется прослушиватель TCP. Вместо этого используется исходящее подключение к инфраструктуре виртуальных рабочих столов Windows через HTTPS-подключение.

## <a name="session-host-communication-channel"></a>Канал связи узла сеансов

При запуске узла сеансов виртуальных рабочих столов Windows служба загрузчика удаленный рабочий стол Agent устанавливает постоянный канал связи брокера виртуальных рабочих столов Windows. Этот коммуникационный канал размещается поверх подключения TLS и служит шиной обмена сообщениями службы между узлом сеанса и инфраструктурой виртуальных рабочих столов Windows.

## <a name="client-connection-sequence"></a>Последовательность клиентских подключений

Последовательность подключения клиента, описанная ниже.

1. Использование поддерживаемого пользователя клиента виртуальных рабочих столов Windows для подписки на рабочую область виртуальных рабочих столов Windows
2. Azure Active Directory выполняет проверку подлинности пользователя и возвращает маркер, используемый для перечисления ресурсов, доступных пользователю
3. Клиент передает токен в службу подписки на канал виртуальных рабочих столов Windows
4. Служба подписки на канал виртуальных рабочих столов Windows проверяет маркер
5. Служба подписки на канал виртуальных рабочих столов Windows передает список доступных настольных компьютеров и удаленных приложений RemoteApp обратно клиенту в виде конфигурации подключения с цифровой подписью.
6. Клиент сохраняет конфигурацию подключения для каждого доступного ресурса в наборе RDP-файлов.
7. Когда пользователь выбирает ресурс для подключения, клиент использует связанный RDP-файл и устанавливает безопасное подключение TLS 1,2 к ближайшему экземпляру шлюза виртуальных рабочих столов Windows и передает сведения о подключении.
8. Шлюз виртуальных рабочих столов Windows проверяет запрос и запрашивает у брокера виртуальных рабочих столов Windows управление подключением.
9. Брокер виртуальных рабочих столов Windows определяет узел сеанса и использует ранее установленный постоянный канал связи для инициализации подключения.
10. Удаленный рабочий стол Stack инициирует подключение TLS 1,2 к тому же экземпляру шлюза виртуальных рабочих столов Windows, который используется клиентом.
11. После того как клиент и узел сеансов подключены к шлюзу, шлюз начинает ретрансляцию необработанных данных между обеими конечными точками, при этом устанавливается базовый транспорт для обратных подключений для RDP.
12. После установки базового транспорта клиент запускает подтверждение RDP.

## <a name="connection-security"></a>Безопасность подключения

TLS 1,2 используется для всех подключений, инициированных клиентами и узлами сеансов, к компонентам инфраструктуры виртуальных рабочих столов Windows. Виртуальный рабочий стол Windows использует те же шифры TLS 1,2, что и [Передняя дверца Azure](../frontdoor/front-door-faq.md#what-are-the-current-cipher-suites-supported-by-azure-front-door). Важно убедиться, что на клиентских компьютерах и узлах сеансов эти шифры могут использоваться.
Для транспорта с обратным подключением клиент и узел сеансов подключаются к шлюзу виртуальных рабочих столов Windows. После установления TCP-подключения клиент или узел сеансов проверяет сертификат шлюза виртуальных рабочих столов Windows.
После установки базового транспорта RDP устанавливает вложенное TLS-соединение между клиентом и узлом сеансов, используя сертификаты узла сеанса. По умолчанию сертификат, используемый для шифрования RDP, создается автоматически операционной системой во время развертывания. При необходимости клиенты могут развертывать централизованно управляемые сертификаты, выданные центром сертификации предприятия. Дополнительные сведения о настройке сертификатов см. в [документации по Windows Server](/troubleshoot/windows-server/remote/remote-desktop-listener-certificate-configurations).

## <a name="next-steps"></a>Дальнейшие действия

* Дополнительные сведения о требованиях к пропускной способности виртуальных рабочих столов Windows см. в статье [Общие сведения о требованиях к пропускной способности протокол удаленного рабочего стола (RDP) для виртуальных рабочих](rdp-bandwidth.md)
* Чтобы приступить к работе со службой QoS для виртуальных рабочих столов Windows, см. статью [Реализация качества обслуживания (QoS) для виртуальных рабочих столов Windows](rdp-quality-of-service-qos.md).
