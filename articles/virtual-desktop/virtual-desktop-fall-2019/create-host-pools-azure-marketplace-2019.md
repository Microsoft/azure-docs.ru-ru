---
title: Пул узлов Виртуального рабочего стола Windows (классическая версия) в Azure Marketplace — Azure
description: Сведения о том, как создать пул узлов Виртуального рабочего стола Windows (классическая версия) с помощью Azure Marketplace.
author: Heidilohr
ms.topic: how-to
ms.date: 03/30/2020
ms.author: helohr
manager: lizross
ms.openlocfilehash: 04184a658ae1efd03afd3e920818eb5317bc7553
ms.sourcegitcommit: 772eb9c6684dd4864e0ba507945a83e48b8c16f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "88008599"
---
# <a name="tutorial-create-a-host-pool-in-windows-virtual-desktop-classic"></a>Руководство по созданию пула узлов на Виртуальном рабочем столе Windows (классическая версия)

>[!IMPORTANT]
>Это содержимое применимо к Виртуальному рабочему столу Windows (классическая версия), который не поддерживает объекты Azure Resource Manager для Виртуального рабочего стола Windows. Сведения об обеспечении управления объектами Azure Resource Manager для Виртуального рабочего стола Windows см. в [этой статье](../create-host-pools-azure-marketplace.md).

В этом учебнике вы узнаете, как создать пул узлов в клиенте Виртуального рабочего стола Windows, используя предложение Microsoft Azure Marketplace.

Пулы узлов — это коллекция, состоящая из одной или нескольких идентичных виртуальных машин в средах клиента Виртуального рабочего стола Windows. Каждый пул узлов может содержать группы приложений, с которыми пользователи могут взаимодействовать, как с физическим рабочим столом.

В этом учебнике рассматриваются следующие задачи:

> [!div class="checklist"]
>
> * Создание пула узла на Виртуальном рабочем столе Windows.
> * Создание группы ресурсов с виртуальными машинами в подписке Azure.
> * Присоединение виртуальных машин к домену Active Directory.
> * Регистрация виртуальных машин с помощью Виртуального рабочего стола Windows.

## <a name="prerequisites"></a>Предварительные требования

* Клиент на Виртуальном рабочем столе. В предыдущем [учебнике](tenant-setup-azure-active-directory.md) рассказывается, как создать клиент.
* [Модуль PowerShell для Виртуального рабочего стола Windows](/powershell/windows-virtual-desktop/overview/).

При наличии модуля выполните следующий командлет, чтобы войти в учетную запись:

```powershell
Add-RdsAccount -DeploymentUrl "https://rdbroker.wvd.microsoft.com"
```

## <a name="sign-in-to-azure"></a>Вход в Azure

Войдите на [портал Azure](https://portal.azure.com).

## <a name="run-the-azure-marketplace-offering-to-provision-a-new-host-pool"></a>Запустите предложение Azure Marketplace для подготовки пула узлов.

Запустите предложение Azure Marketplace для подготовки пула узлов:

1. На **домашней странице** или в меню портала Azure выберите **Создать ресурс**.
1. В окне поиска Marketplace введите **Виртуальный рабочий стол Windows**.
1. Выберите **Windows Virtual Desktop — Provision a host pool** (Виртуальный рабочий стол Windows — подготовка пула узлов) и щелкните **Создать**.

Затем следуйте инструкциям из следующего раздела, чтобы ввести сведения на соответствующих вкладках.

### <a name="basics"></a>Основы

На вкладке **Основные** сделайте следующее:

1. Выберите **подписку**.
1. Под полем **Группа ресурсов** щелкните ссылку **Создать** и укажите имя новой группы ресурсов.
1. Выберите **регион**.
1. Введите имя пула узлов, уникальное в пределах клиента Виртуального рабочего стола Windows.
1. Выберите **тип рабочего стола**. Если вы выберете **Личный**, каждый пользователь, который подключится к этому пулу узлов, будет постоянно связан с виртуальной машиной.
1. Введите данные пользователей, которые могут входить в клиенты Виртуального рабочего стола Windows и получать доступ к рабочему столу. Используйте список с разделителями-запятыми. Например, если вы хотите назначить доступ `user1@contoso.com` и `user2@contoso.com`, введите *`user1@contoso.com,user2@contoso.com`* .
1. В качестве **расположения метаданных службы** выберите то же расположение, что и для виртуальной сети с подключением к серверу Active Directory.

   >[!IMPORTANT]
   >Если вы используете только доменные службы Azure Active Directory Domain Services (Azure AD DS) и решение Azure Active Directory (Azure AD), разверните пул узлов в том же регионе, в котором находятся доменные службы Azure AD DS, чтобы избежать ошибок, связанных с присоединением к домену и учетными данными.

1. По завершении выберите **Next: Configure virtual machines** (настройка виртуальных машин).

### <a name="configure-virtual-machines"></a>Настройка виртуальных машин

На вкладке **Configure virtual machines** (Настройка виртуальных машин) сделайте следующее:

1. Примите значения по умолчанию или укажите количество и размер виртуальных машин.

    >[!NOTE]
    >Если конкретный размер виртуальной машины, который вы ищете, не отображается в селекторе размера, это связано с тем, что мы еще не подключили этот размер к средству Azure Marketplace. Чтобы запросить размер, создайте запрос или проголосуйте за существующий на [форуме UserVoice по Виртуальному рабочему столу Windows](https://windowsvirtualdesktop.uservoice.com/forums/921118-general).

1. Введите префикс для имен виртуальных машин. Например, если вы введете имя *prefix*, имена у виртуальных машин будут **prefix-0**, **prefix-1** и т. п.
1. По завершении выберите **Next: параметры виртуальной машины**.

### <a name="virtual-machine-settings"></a>Параметры виртуальной машины

На вкладке **Параметры виртуальной машины** сделайте следующее:

1. Выберите **Источник образа** и введите соответствующую информацию о том, как его искать и хранить. Параметры различаются для хранилища BLOB-объектов, управляемого образа и коллекции.

   Если вы решили не использовать управляемые диски, выберите учетную запись хранения, содержащую *VHD*-файл.
1. Введите имя участника-пользователя и пароль. Эта учетная запись должна быть учетной записью домена, которая будет присоединять виртуальные машины к домену Active Directory. Эти же имя пользователя и пароль будут созданы на виртуальных машинах в качестве локальной учетной записи. Позже вы сможете сбросить эти локальные учетные записи.

   >[!NOTE]
   > Если вы присоединяете виртуальные машины к Azure AD DS, убедитесь, что пользователь для присоединения к домену участвует в [группе администраторов контроллера домена Azure AD](../../active-directory-domain-services/tutorial-create-instance-advanced.md#configure-an-administrative-group).
   >
   > Учетная запись также должна принадлежать к управляемому домену Azure AD DS или клиенту Azure AD. Учетные записи из внешних каталогов, связанных с клиентом Azure AD, не смогут пройти проверку подлинности в процессе присоединения к домену.

1. Выберите **виртуальную сеть** с подключением к серверу AD DS, а затем подсеть для размещения виртуальных машин.
1. По завершении выберите **Next: Windows Virtual Desktop information** (Далее: сведения о Виртуальном рабочем столе Windows).

### <a name="windows-virtual-desktop-tenant-information"></a>Сведения о клиенте Виртуального рабочего стола Windows

На вкладке **Windows Virtual Desktop tenant information** (Сведения о клиенте Виртуального рабочего стола Windows) сделайте следующее:

1. Введите **имя группы клиента Виртуального рабочего стола Windows** в группе вашего клиента. Оставьте значение по умолчанию, если вам не было предоставлено определенное имя группы клиента.
1. В поле **Windows Virtual Desktop tenant name** (Имя клиента Виртуального рабочего стола Windows) введите имя клиента, в котором будет создан этот пул узлов.
1. Укажите тип учетных данных, которые вы хотите использовать для аутентификации в качестве владельца служб удаленных рабочих столов клиента Виртуального рабочего стола Windows. Введите имя участника-пользователя или субъект-службу и пароль.

   Если вы завершили учебник [Создание субъектов-служб и назначений ролей с помощью PowerShell](create-service-principal-role-powershell.md), выберите **Субъект-служба**.

1. Для **субъекта-службы** в поле **Идентификатор клиента Azure AD** введите учетную запись администратора клиента для экземпляра Azure AD, содержащего субъект-службу. Поддерживаются только субъекты-службы с использованием пароля.
1. По завершении выберите **Next: Отзыв и создание**.

## <a name="complete-setup-and-create-the-virtual-machine"></a>Завершение настройки и создание виртуальной машины

На вкладке **Просмотр и создание** просмотрите сведения о настройке. Если необходимо изменить что-либо, вернитесь назад и внесите необходимые изменения. Когда все будет готово, нажмите кнопку **Создать**, чтобы развернуть пул узлов.

В зависимости от количества создаваемых виртуальных машин этот процесс может занять более 30 минут.

>[!IMPORTANT]
> Чтобы усилить защиту среды Виртуального рабочего стола Windows в Azure, мы рекомендуем не открывать входящий порт 3389 для виртуальных машин. Для Виртуального рабочего стола Windows не требуется открытие входящего порта 3389, чтобы пользователи могли получить доступ к виртуальным машинам пула узла.
>
> Если вам все же нужно открыть порт 3389 для устранения проблем, мы рекомендуем использовать JIT-доступ. Дополнительные сведения см. в статье [Защита портов управления с помощью JIT-доступа](../../security-center/security-center-just-in-time.md).

## <a name="optional-assign-additional-users-to-the-desktop-application-group"></a>(Необязательно.) Назначение дополнительным пользователям группы классических приложений

После того как Azure Marketplace создаст пул, можно назначить дополнительных пользователей группе классических приложений. Если вам не требуется добавлять пользователей, пропустите этот раздел.

Чтобы назначить пользователей группе классических приложений, выполните следующие действия:

1. Откройте окно PowerShell.

1. Выполните следующую команду, чтобы войти в среду Виртуального рабочего стола Windows:

   ```powershell
   Add-RdsAccount -DeploymentUrl "https://rdbroker.wvd.microsoft.com"
   ```

1. Добавьте пользователей в группу классических приложений с помощью следующей команды:

   ```powershell
   Add-RdsAppGroupUser <tenantname> <hostpoolname> "Desktop Application Group" -UserPrincipalName <userupn>
   ```

   Имя участника-пользователя должно соответствовать удостоверению пользователя в Azure AD (например, *user1@contoso.com* ). Если вы хотите добавить нескольких пользователей, выполните команду для каждого пользователя.

Пользователи, добавленные в группу классических приложений, смогут войти на Виртуальный рабочий стол Windows с помощью поддерживаемых клиентов Удаленного рабочего стола, чтобы просматривать ресурсы для рабочего стола сеанса.

Поддерживаемые клиенты:

* [клиент удаленного рабочего стола для Windows 7 и Windows 10](connect-windows-7-10-2019.md);
* [веб-клиент Виртуального рабочего стола Windows](connect-web-2019.md).

## <a name="next-steps"></a>Дальнейшие действия

Вы создали пул узлов и назначили пользователей для доступа к рабочему столу. Пул узлов можно заполнить программами RemoteApp. Дополнительные сведения о том, как управлять приложениями в Виртуальном рабочем столе Windows, см. в данном учебнике:

> [!div class="nextstepaction"]
> [Управление группами приложений](manage-app-groups-2019.md)
