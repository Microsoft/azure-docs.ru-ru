---
title: Контейнеры профилей Фслогикс NetApp виртуальный рабочий стол Windows — Azure
description: Создание контейнера профиля Фслогикс с помощью Azure NetApp Files в виртуальном рабочем столе Windows.
author: Heidilohr
ms.topic: how-to
ms.date: 06/05/2020
ms.author: helohr
manager: lizross
ms.openlocfilehash: 6a9f2c62d8e7f17f6ea8377982c79fef3dfbb97c
ms.sourcegitcommit: 910a1a38711966cb171050db245fc3b22abc8c5f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "96016834"
---
# <a name="create-a-profile-container-with-azure-netapp-files-and-ad-ds"></a>Создание контейнера профиля с Azure NetApp Files и AD DS

Мы рекомендуем использовать контейнеры профилей Фслогикс в качестве решения профиля пользователя для [службы виртуальных рабочих столов Windows](overview.md). Контейнеры профилей Фслогикс хранят полный профиль пользователя в одном контейнере и предназначены для перемещения профилей в неустойчивых удаленных вычислительных средах, таких как виртуальные рабочие столы Windows. При входе контейнер динамически подключается к вычислительной среде, используя локально поддерживаемый виртуальный жесткий диск (VHD) и виртуальный жесткий диск Hyper-V (VHDX). Эти дополнительные технологии драйверов фильтров позволяют использовать профиль пользователя сразу же и отображаться в системе точно так же, как и локальный профиль пользователя. Дополнительные сведения о контейнерах профилей Фслогикс см. в статье [контейнеры профилей фслогикс и файлы Azure](fslogix-containers-azure-files.md).

Вы можете создавать контейнеры профилей Фслогикс с помощью [Azure NetApp Files](https://azure.microsoft.com/services/netapp/), простой в использовании службы собственной платформы Azure, которая помогает клиентам быстро и надежно подготавливать тома SMB корпоративного уровня для сред виртуальных рабочих столов Windows. Дополнительные сведения о Azure NetApp Files см. в разделе [что такое Azure NetApp Files?](../azure-netapp-files/azure-netapp-files-introduction.md)

В этом руководство показано, как настроить учетную запись Azure NetApp Files и создать контейнеры профилей Фслогикс в виртуальном рабочем столе Windows.

В этой статье предполагается, что [Пулы узлов](create-host-pools-azure-marketplace.md) уже настроены и сгруппированы в один или несколько клиентов в среде виртуальных рабочих столов Windows. Сведения о настройке клиентов см. [в статье Создание клиента в виртуальном рабочем столе Windows и в](./virtual-desktop-fall-2019/tenant-setup-azure-active-directory.md) [нашей записи блога сообщества Tech](https://techcommunity.microsoft.com/t5/Windows-IT-Pro-Blog/Getting-started-with-Windows-Virtual-Desktop/ba-p/391054).

Инструкции в этом разделе предназначены специально для пользователей виртуальных рабочих столов Windows. Если вы ищете общие рекомендации по настройке Azure NetApp Files и созданию контейнеров профилей Фслогикс за пределами виртуального рабочего стола Windows, ознакомьтесь с [кратким руководством по настройке Azure NetApp Files и созданию тома NFS](../azure-netapp-files/azure-netapp-files-quickstart-set-up-account-create-volumes.md).

>[!NOTE]
>В этой статье не рассматриваются рекомендации по защите доступа к Azure NetApp Files общему ресурсу.

>[!NOTE]
>Если вы ищете сравнительные материалы о различных вариантах хранения контейнера профиля Фслогикс в Azure, см. статью [Параметры хранилища для контейнеров профилей фслогикс](store-fslogix-profile.md).

## <a name="prerequisites"></a>Предварительные условия

Перед созданием контейнера профиля Фслогикс для пула узлов необходимо выполнить следующие действия.

- Настройка и настройка виртуального рабочего стола Windows
- Подготавливает пул узлов виртуальных рабочих столов Windows
- [Включение подписки на Azure NetApp Files](../azure-netapp-files/azure-netapp-files-register.md)

## <a name="set-up-your-azure-netapp-files-account"></a>Настройка учетной записи Azure NetApp Files

Чтобы приступить к работе, необходимо настроить учетную запись Azure NetApp Files.

1. Войдите на [портал Azure](https://portal.azure.com). Убедитесь, что у вашей учетной записи есть права участника или администратора.

2. Щелкните **значок Azure Cloud Shell** справа от панели поиска, чтобы открыть Azure Cloud Shell.

3. После открытия Azure Cloud Shell выберите **PowerShell**.

4. Если вы впервые используете Azure Cloud Shell, создайте учетную запись хранения в той же подписке, в которой хранятся Azure NetApp Files и виртуальный рабочий стол Windows.

   > [!div class="mx-imgBorder"]
   > ![Окно учетной записи хранения с кнопкой создать хранилище в нижней части окна, выделенного красным цветом.](media/create-storage-button.png)

5. После загрузки Azure Cloud Shell выполните следующие два командлета.

   ```azurecli
   az account set --subscription <subscriptionID>
   ```

   ```azurecli
   az provider register --namespace Microsoft.NetApp --wait
   ```

6. В левой части окна выберите **все службы**. Введите **Azure NetApp Files** в поле поиска, которое отображается в верхней части меню.

   > [!div class="mx-imgBorder"]
   > ![Снимок экрана, в котором пользователь вводит "Azure NetApp Files" в поле поиска All Services (все службы). В результатах поиска отображается ресурс Azure NetApp Files.](media/azure-netapp-files-search-box.png)


7. Выберите **Azure NetApp Files** в результатах поиска, а затем щелкните **создать**.

8. Нажмите кнопку **Добавить**.
9. Когда откроется вкладка **Новая учетная запись NetApp** , введите следующие значения:

    - В качестве **имени** введите имя учетной записи NetApp.
    - В поле **Подписка** выберите подписку для учетной записи хранения, настроенной на шаге 4 из раскрывающегося меню.
    - В поле **Группа ресурсов** выберите существующую группу ресурсов из раскрывающегося меню или создайте новую, выбрав **создать**.
    - В поле **Расположение** выберите регион для учетной записи NetApp в раскрывающемся меню. Этот регион должен быть тем же регионом, что и виртуальные машины узла сеанса.

   >[!NOTE]
   >Azure NetApp Files сейчас не поддерживает подключение тома между регионами.

10. По завершении нажмите кнопку **создать** , чтобы создать учетную запись NetApp.

## <a name="create-a-capacity-pool"></a>Создание пула ресурсов

Затем создайте пул емкости.

1. Перейдите в меню Azure NetApp Files и выберите новую учетную запись.
2. В меню учетной записи выберите **Пулы ресурсов** в разделе Служба хранилища.
3. Выберите **Добавить пул**.
4. Когда откроется вкладка **Создание пула ресурсов** , введите следующие значения:

    - В поле **имя** введите имя нового пула ресурсов.
    - В поле **уровень обслуживания** выберите нужное значение из раскрывающегося меню. Для большинства сред рекомендуется использовать **Premium** .
       >[!NOTE]
       >Параметр Premium обеспечивает минимальную пропускную способность, доступную для уровня обслуживания Premium (256 Мбит/с). Может потребоваться настроить эту пропускную способность для рабочей среды. Окончательная пропускная способность основана на связи, описанной в разделе [ограничения пропускной способности](../azure-netapp-files/azure-netapp-files-service-levels.md).
    - В поле **size (тиб) (размер)** введите размер пула емкости, который наилучшим образом соответствует вашим потребностям. Минимальный размер — 4 тиб.

5. Завершив настройку, нажмите кнопку **ОК**.

## <a name="join-an-active-directory-connection"></a>Присоединение к Active Directoryному соединению

После этого необходимо присоединиться к Active Directoryному соединению.

1. Выберите **Active Directory подключения** в меню в левой части страницы, а затем нажмите кнопку **присоединить** , чтобы открыть страницу **Присоединение Active Directory** .

   > [!div class="mx-imgBorder"]
   > ![Снимок экрана меню соединения Active Directory соединения.](media/active-directory-connections-menu.png)

2. Введите следующие значения на странице **соединение Active Directory** , чтобы присоединиться к соединению.

    - В поле **основной DNS**-сервер введите IP-адрес DNS-сервера в среде, который может разрешить доменное имя.
    - В качестве имени **домена** введите полное доменное имя.
    - Для **префикса сервера SMB (учетная запись компьютера)** введите строку, которую необходимо добавить к имени учетной записи компьютера.
    - В поле **username (имя пользователя**) введите имя учетной записи с разрешениями на присоединение к домену.
    - В поле **Password (пароль**) введите пароль учетной записи.

## <a name="create-a-new-volume"></a>Создание нового тома

Далее необходимо создать новый том.

1. Выберите **тома**, а затем щелкните **Добавить том**.

2. Когда откроется вкладка **Создание тома** , введите следующие значения:

    - В поле **имя тома** введите имя нового тома.
    - В поле **пул емкости** выберите только что созданный пул ресурсов из раскрывающегося меню.
    - В поле **квота (гиб)** введите размер тома, соответствующий вашей среде.
    - В поле **Виртуальная сеть** выберите существующую виртуальную сеть с подключением к контроллеру домена из раскрывающегося меню.
    - В разделе **подсеть** выберите **создать**. Помните, что эта подсеть будет делегирована в Azure NetApp Files.

3.  Нажмите кнопку **Далее: \> \> протокол** , чтобы открыть вкладку Протокол и настроить параметры доступа к тому.

## <a name="configure-volume-access-parameters"></a>Настройка параметров доступа к тому

После создания тома настройте параметры доступа к тому.

1.  В качестве типа протокола выберите **SMB** .
2.  В разделе Конфигурация в раскрывающемся меню **Active Directory** выберите тот же каталог, который вы изначально подключили для соединения [с Active Directory](create-fslogix-profile-container.md#join-an-active-directory-connection). Помните, что существует ограничение в один Active Directory на подписку.
3.  В текстовом поле **имя общего ресурса** введите имя общей папки, используемой пулом узлов сеансов и его пользователями.

4.  В нижней части страницы выберите **Review + create** (Проверить и создать). Откроется страница Проверка. После успешной проверки тома нажмите кнопку **создать**.

5.  На этом этапе начнется развертывание нового тома. После завершения развертывания можно использовать общий ресурс Azure NetApp Files.

6.  Чтобы просмотреть путь подключения, выберите **Переход к ресурсу** и найдите его на вкладке Обзор.

    > [!div class="mx-imgBorder"]
    > ![Снимок экрана с экраном обзора с красной стрелкой, указывающей на путь подключения.](media/overview-mount-path.png)

## <a name="configure-fslogix-on-session-host-virtual-machines-vms"></a>Настройка Фслогикс на виртуальных машинах узла сеансов

Этот раздел основан на разделе [Создание контейнера профилей для пула узлов с помощью общей папки](create-host-pools-user-profile.md).

1. [Скачайте zip-файл агента фслогикс](https://go.microsoft.com/fwlink/?linkid=2084562&clcid=0x409) , пока вы все еще удаленно находитесь на виртуальной машине узла сеансов.

2. Распакуйте скачанный файл.

3. В файле перейдите к   >  **выпускам** x64 и запустите **FSLogixAppsSetup.exe**. Откроется меню установки.

4.  Если у вас есть ключ продукта, введите его в текстовом поле ключ продукта.

5. Установите флажок, чтобы **я принимаю условия лицензии**.

6. Нажмите кнопку **Установить**.

7. Перейдите в раздел **C: \\ Program Files \\ фслогикс \\ Apps** , чтобы подтвердить установку агента.

8. В меню Пуск запустите **regedit** от имени администратора.

9. Перейдите в раздел **Computer \\ HKEY_LOCAL_MACHINE \\ Software \\ фслогикс**.

10. Создайте ключ с именем **Profiles**.

11.  Создайте значение с именем **Enabled** , указав для типа **REG_DWORD** значение, равное **1**.

12. Создайте значение с именем **вхдлокатионс** с **многострочным типом и** задайте в качестве его значения данных URI для Azure NetApp Files общего ресурса.

13. Создайте значение с именем **делетелокалпрофилевхенвхдшаулдаппли** и значением DWORD, равным 1, чтобы избежать проблем с существующими локальными профилями перед входом в систему.

     >[!WARNING]
     >Будьте внимательны при создании значения Делетелокалпрофилевхенвхдшаулдаппли. Если система профилей Фслогикс определяет, что пользователь должен иметь профиль Фслогикс, но локальный профиль уже существует, контейнер профиля окончательно удалит локальный профиль. Затем пользователь будет входить в новый профиль Фслогикс.

## <a name="assign-users-to-session-host"></a>Назначение пользователей узлу сеансов

1. Откройте **интегрированную среду сценариев PowerShell** от имени администратора и войдите на виртуальный рабочий стол Windows.

2. Выполните следующие командлеты.

   ```powershell
   Import-Module Microsoft.RdInfra.RdPowershell
   # (Optional) Install-Module Microsoft.RdInfra.RdPowershell
   $brokerurl = "https://rdbroker.wvd.microsoft.com"
   Add-RdsAccount -DeploymentUrl $brokerurl
   ```

3. При появлении запроса на ввод учетных данных введите учетные данные пользователя с ролью создателя клиента или участника RDS/RDS в клиенте виртуальных рабочих столов Windows.

4. Выполните следующие командлеты, чтобы назначить пользователя группе удаленный рабочий стол.

   ```powershell
   $wvdTenant = "<your-wvd-tenant>"
   $hostPool = "<wvd-pool>"
   $appGroup = "Desktop Application Group"
   $user = "<user-principal>"
   Add-RdsAppGroupUser $wvdTenant $hostPool $appGroup $user
   ```

## <a name="make-sure-users-can-access-the-azure-netapp-file-share"></a>Убедитесь, что пользователи имеют доступ к общей папке Azure NetApp

1. Откройте веб – браузер и перейдите по адресу <https://rdweb.wvd.microsoft.com/arm/webclient> .

2. Выполните вход, используя учетные данные пользователя, назначенного группе удаленный рабочий стол.

3. После установки сеанса пользователя Войдите в портал Azure с помощью учетной записи администратора.

4. Откройте **Azure NetApp Files**, выберите учетную запись Azure NetApp Files, а затем щелкните **тома**. После открытия меню тома выберите соответствующий том.

   > [!div class="mx-imgBorder"]
   > ![Снимок экрана учетной записи NetApp, настроенной ранее в портал Azure с выбранной кнопкой "тома".](media/netapp-account.png)

5. Перейдите на вкладку **Обзор** и убедитесь, что в контейнере профиля фслогикс используется пространство.

6. Подключитесь напрямую к любой виртуальной машине из пула узлов с помощью удаленный рабочий стол и откройте **Проводник.** Затем перейдите к **пути подключения** (в следующем примере путь подключения — \\ \\ ANF-SMB-3863.gt1107.onmicrosoft.com \\ использовании-VOL).

   В этой папке должен быть виртуальный жесткий диск профиля (или VHDX), подобный показанному в следующем примере.

   > [!div class="mx-imgBorder"]
   > ![Снимок экрана содержимого папки в пути подключения. Внутри — это один VHD-файл с именем "Profile_ssbb".](media/mount-path-folder.png)

## <a name="next-steps"></a>Дальнейшие действия

Для настройки общего ресурса профиля пользователя можно использовать контейнеры профилей Фслогикс. Сведения о создании общих папок профилей пользователей с помощью новых контейнеров см. в статье [Создание контейнера профилей для пула узлов с использованием общей папки](create-host-pools-user-profile.md).

Вы также можете создать файловый ресурс службы файлов Azure для хранения профиля Фслогикс в. Дополнительные сведения см. в статье [Создание файлового ресурса службы файлов Azure с помощью контроллера домена](create-file-share.md).