---
title: Диагностика проблем производительности графики удаленный рабочий стол — Azure
description: В этой статье описывается, как использовать счетчики графики RemoteFX в сеансах протокола удаленного рабочего стола для диагностики проблем с производительностью графики в виртуальном рабочем столе Windows.
author: Heidilohr
ms.topic: troubleshooting
ms.date: 05/23/2019
ms.author: helohr
manager: lizross
ms.openlocfilehash: dc5c6499fa47a1e32a517032d5cc2a97b3f2677f
ms.sourcegitcommit: 772eb9c6684dd4864e0ba507945a83e48b8c16f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "88007172"
---
# <a name="diagnose-graphics-performance-issues-in-remote-desktop"></a>Диагностика проблем производительности графики в удаленный рабочий стол

Чтобы диагностировать проблемы с качеством удаленных сеансов, в разделе "графика RemoteFX" системного монитора были предоставлены счетчики. Эта статья поможет выявить и устранить узкие места, связанные с графиком, во время сеансов протокол удаленного рабочего стола (RDP), использующих эти счетчики.

## <a name="find-your-remote-session-name"></a>Поиск имени удаленного сеанса

Для обнаружения счетчиков производительности графики потребуется имя удаленного сеанса. Следуйте инструкциям в этом разделе, чтобы обозначить экземпляр каждого счетчика.

1. Откройте командную строку Windows из удаленного сеанса.
2. Выполните команду **квинста** и найдите имя своего сеанса.
    - Если ваш сеанс размещен на виртуальной машине с несколькими сеансами (ВМ), для экземпляра каждого счетчика добавляется суффикс с тем же номером, что и имя сеанса, например "RDP-TCP 37".
    - Если ваш сеанс размещается на виртуальной машине, поддерживающей виртуальные графические процессоры (GPU), экземпляр каждого счетчика хранится на сервере, а не на виртуальной машине. Экземпляры счетчиков содержат имя виртуальной машины вместо числа в имени сеанса, например "Win8 Enterprise VM".

>[!NOTE]
> Хотя у счетчиков есть RemoteFX в своих именах, они также включают графику удаленного рабочего стола в сценариях виртуальных GPU.

## <a name="access-performance-counters"></a>Доступ к счетчикам производительности

Определив имя удаленного сеанса, выполните следующие инструкции, чтобы получить данные счетчиков производительности графики RemoteFX для удаленного сеанса.

1. Выберите **Запуск**  >  **административных средств**  >  **Монитор производительности**.
2. В диалоговом окне **системный монитор** разверните узел **средства мониторинга**, выберите **системный монитор** и нажмите кнопку **Добавить**.
3. В диалоговом окне **Добавление счетчиков** в списке **Доступные счетчики** разверните раздел для графики RemoteFX.
4. Выберите счетчики для мониторинга.
5. В списке **экземпляры выбранного объекта** выберите конкретные экземпляры для отслеживания выбранных счетчиков и нажмите кнопку **Добавить**. Чтобы выбрать все доступные экземпляры счетчиков, выберите **все экземпляры**.
6. После добавления счетчиков нажмите кнопку **ОК**.

Выбранные счетчики производительности отобразятся на экране монитора производительности.

>[!NOTE]
>Каждый активный сеанс на узле имеет свой собственный экземпляр каждого счетчика производительности.

## <a name="diagnose-issues"></a>Диагностика проблем

Проблемы производительности, связанные с графикой, обычно делятся на четыре категории:

- Низкая частота кадров
- Случайные ожидания
- Высокая задержка ввода
- Низкое качество кадров

### <a name="addressing-low-frame-rate-random-stalls-and-high-input-latency"></a>Устранение низкой частоты кадров, случайных ожиданий и высокой задержки ввода

Сначала проверьте счетчик выходных кадров/сек. Он измеряет количество кадров, доступных клиенту. Если это значение меньше значения счетчика входных кадров в секунду, кадры пропускаются. Для выявления узкого места используйте счетчик пропущенных кадров/сек.

Существует три типа пропущенных кадров/сек.

- Пропущено кадров в секунду (нехватка ресурсов сервера)
- Пропущено кадров в секунду (недостаточно сетевых ресурсов)
- Пропущено кадров в секунду (недостаточно ресурсов клиента)

Высокое значение для всех пропущенных кадров/секунд означает, что проблема связана с ресурсом, который отслеживается счетчиком. Например, если клиент не расшифровывает и отображает кадры с той же скоростью, что и сервер предоставляет кадры, счетчик пропущенных кадров/с (недостаточных ресурсов клиента) будет иметь значение High.

Если счетчик выходных кадров/сек соответствует счетчику входных кадров в секунду, но вы все еще заметили необычное запаздывание или ожидание, среднее время кодирования может быть приведением. Кодирование — это синхронный процесс, выполняемый на сервере в сценарии с одним сеансом (GPU) и на виртуальной машине в сценарии с несколькими сеансами. Среднее время кодирования должно быть в 33 МС. Если среднее время кодирования составляет 33 МС, но по-прежнему возникают проблемы с производительностью, возможно, возникла проблема с используемым приложением или операционной системой.

Дополнительные сведения об диагностике проблем, связанных с приложениями, см. в разделе [счетчики производительности задержки ввода данных пользователем](/windows-server/remote/remote-desktop-services/rds-rdsh-performance-counters/).

Так как протокол RDP поддерживает среднее время кодирования 33 МС, он поддерживает частоту входных кадров до 30 кадров в секунду. Обратите внимание, что 33 МС является максимальной поддерживаемой частотой кадров. Во многих случаях частота кадров, предусмотренная пользователем, будет ниже в зависимости от частоты передачи кадра по протоколу RDP источником. Например, для таких задач, как просмотр видео, требуется полная частота входных кадров в 30 кадров/с, но менее ресурсоемкие задачи, такие как нечастое изменение документа, — это гораздо меньшее значение для входных кадров в секунду без ухудшения качества работы пользователя.

### <a name="addressing-poor-frame-quality"></a>Адресация низкого качества кадра

Используйте счетчик качества кадров для диагностики проблем с качеством кадров. Этот счетчик выражает качество выходного кадра в процентах от качества исходного кадра. Потери качества могут быть вызваны RemoteFX или источником графики. Если RemoteFX привел к снижению качества, то проблемы могут быть недостаток сети или серверных ресурсов для отправки содержимого с высокой точностью.

## <a name="mitigation"></a>Меры по снижению риска

Если ресурсы сервера вызывают узкие места, попробуйте один из следующих подходов, чтобы повысить производительность.

- Сократите количество сеансов на узел.
- Увеличьте объем памяти и ресурсов вычислений на сервере.
- Удалите разрешение соединения.

Если сетевые ресурсы вызывают узкие места, попробуйте один из следующих подходов к повышению доступности сети за сеанс:

- Сократите количество сеансов на узел.
- Используйте сеть с более высокой пропускной способностью.
- Удалите разрешение соединения.

Если ресурсы клиента вызывают узкие места, попробуйте один из следующих подходов, чтобы повысить производительность.

- Установите самый последний клиент удаленный рабочий стол.
- Увеличьте объем памяти и ресурсов вычислений на клиентском компьютере.

> [!NOTE]
> В настоящее время счетчик исходных кадров/секунд не поддерживается. Сейчас счетчик исходных кадров/секунд всегда будет отображать 0.

## <a name="next-steps"></a>Дальнейшие действия

- Сведения о создании виртуальной машины Azure, оптимизированной для GPU, см. в разделе [Настройка ускорения графического процессора для среды виртуальных рабочих столов Windows](configure-vm-gpu.md).
- Общие сведения об устранении неполадок и путях эскалации см. в разделе [Общие сведения об устранении неполадок, Отзывы и поддержка](troubleshoot-set-up-overview.md).
- Дополнительные сведения о службе см. в разделе [Среда рабочего стола Windows](environment-setup.md).
