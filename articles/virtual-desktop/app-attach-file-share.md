---
title: Виртуальный рабочий стол Windows Настройка файлового ресурса MSIX присоединить предварительную версию — Azure
description: Как настроить общую папку для подключения приложения MSIX к виртуальному рабочему столу Windows.
author: Heidilohr
ms.topic: how-to
ms.date: 12/14/2020
ms.author: helohr
manager: lizross
ms.openlocfilehash: 49a350b77958901aae5e54e82d856e4f3772702e
ms.sourcegitcommit: 2aa52d30e7b733616d6d92633436e499fbe8b069
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/06/2021
ms.locfileid: "97930792"
---
# <a name="set-up-a-file-share-for-msix-app-attach-preview"></a>Настройка общей папки для присоединения приложения MSIX (Предварительная версия)

> [!IMPORTANT]
> Присоединение приложения MSIX в настоящее время находится в общедоступной предварительной версии.
> Эта предварительная версия предоставляется без соглашения об уровне обслуживания и не рекомендована для использования рабочей среде. Некоторые функции могут не поддерживаться или их возможности могут быть ограничены. Дополнительные сведения см. в статье [Дополнительные условия использования предварительных выпусков Microsoft Azure](https://azure.microsoft.com/support/legal/preview-supplemental-terms/).

Все образы MSIX должны храниться в общей сетевой папке, к которой могут обращаться пользователи в пуле узлов с разрешениями только для чтения.

Присоединение приложения MSIX (Предварительная версия) не зависит от типа структуры хранилища, которую использует файловый ресурс. Рекомендации для общего ресурса, присоединяемого к приложению MSIX, одинаковы для общей папки Фслогикс. Дополнительные сведения о требованиях к хранению см. [в статье Параметры хранилища для контейнеров профилей фслогикс в виртуальном рабочем столе Windows](store-fslogix-profile.md).

## <a name="performance-requirements"></a>Требования к производительности

Ограничение размера образа подключения к приложению MSIX зависит от типа хранилища, используемого для хранения VHD-или VHDx-файлов, а также от ограничений по размеру VHD, ВХСД или файлов CIM и файловой системы.

В следующей таблице приведен пример того, сколько ресурсов для каждой виртуальной машины требуется один образ MSIX в 1 ГБ с одним приложением MSIX.

| Ресурс             | Требования |
|----------------------|--------------|
| Устойчивое состояние операций ввода-вывода    | 1 операций ввода-вывода       |
| Вход в систему с компьютера | 10 операций ввода-вывода      |
| Задержка              | 400 мс       |

Требования могут сильно различаться в зависимости от того, сколько MSIX приложений хранится в образе MSIX. Для больших MSIX изображений необходимо выделить дополнительную пропускную способность.

### <a name="storage-recommendations"></a>Рекомендации по хранению данных

Azure предлагает несколько вариантов хранения, которые можно использовать для подключения к приложению МИСКС. Мы рекомендуем использовать службы файлов Azure или Azure NetApp Files, так как эти параметры обеспечивают лучшее значение между затратами и расходами на управление. В статье [варианты хранения для контейнеров профилей фслогикс в Windows Virtual Desktop](store-fslogix-profile.md) сравниваются различные предложения управляемых решений хранилища Azure в контексте виртуальных рабочих столов Windows.

### <a name="optimize-msix-app-attach-performance"></a>Оптимизация производительности присоединения приложения MSIX

Ниже приведены некоторые другие вещи, которые рекомендуется выполнить для оптимизации производительности присоединения приложений MSIX.

- Решение хранилища, используемое для присоединения приложения MSIX, должно находиться в том же расположении центра обработки данных, что и узлы сеансов.
- Чтобы избежать узких мест производительности, исключите следующие файлы VHD, VHDX и CIM из антивирусных проверок:
   
    - <Мсиксаппаттачфилешаре \> \* . VHD
    - <Мсиксаппаттачфилешаре \> \* . ФОРМАТЕ
    - \\\\\\общий ресурс storageaccount.File.Core.Windows.NET \* \* . VHD
    - \\\\\\общий ресурс storageaccount.File.Core.Windows.NET \* \* . ФОРМАТЕ
    - <MSIXAppAttachFileShare>. ПРОГРАММЕ
    - \\\\\\общий ресурс storageaccount.File.Core.Windows.NET \* \* . ПРОГРАММЕ

- Разделите структуру хранилища для подключения приложения MSIX из контейнеров профилей Фслогикс.
- Все системные учетные записи виртуальной машины и учетные записи пользователей должны иметь разрешения только на чтение для доступа к общей папке.
- Все планы аварийного восстановления для виртуальных рабочих столов Windows должны включать в себя репликацию приложения MSIX, которое присоединяет общую папку в хранилище дополнительного отработки отказа. Дополнительные сведения об аварийном восстановлении см. в разделе [Настройка плана непрерывности бизнес-процессов и аварийного восстановления](disaster-recovery.md).

## <a name="how-to-set-up-the-file-share"></a>Настройка общей папки

Процесс установки для присоединения общей папки в приложении MSIX во многом аналогичен [процессу установки для файловых ресурсов профиля фслогикс](create-host-pools-user-profile.md). Однако необходимо назначить пользователям различные разрешения. Присоединение приложения MSIX требует наличия разрешений только для чтения для доступа к общей папке.

Если вы храните приложения MSIX в службе файлов Azure, то для узлов сеансов необходимо назначить все виртуальные машины узла сеансов как управление доступом на основе ролей учетной записи хранения (RBAC), так и общую папку с новыми разрешениями файловой системы NTFS для общей папки.

| Объект Azure                      | Требуемая роль                                     | Функция Role                                  |
|-----------------------------------|--------------------------------------------------|-----------------------------------------------|
| Узел сеанса (объекты компьютера виртуальной машины)| Участник общей папки файловых данных хранилища SMB          | Чтение и выполнение, чтение, просмотр содержимого папки  |
| Администраторы общей папки              | Участник общих папок данных SMB службы хранилища с повышенными правами | Полный доступ                                  |
| Пользователи в общей папке               | Участник общей папки файловых данных хранилища SMB          | Чтение и выполнение, чтение, просмотр содержимого папки  |

Назначение разрешений для виртуальных машин узла сеансов для учетной записи хранения и общей папки:

1. Создайте группу безопасности домен Active Directory служб (AD DS).

2. Добавьте учетные записи компьютеров для всех виртуальных машин узла сеансов в качестве членов группы.

3. Синхронизируйте группу AD DS с Azure Active Directory (Azure AD).

4. Создайте учетную запись хранения.

5. Создайте общую папку в учетной записи хранения, следуя инструкциям в разделе [Создание файлового ресурса Azure](../storage/files/storage-how-to-create-file-share.md#create-file-share).

6. Присоедините учетную запись хранения к AD DS, следуя инструкциям в [первой части статьи: Включение проверки подлинности AD DS для файловых ресурсов Azure](../storage/files/storage-files-identity-ad-ds-enable.md#option-one-recommended-use-azfileshybrid-powershell-module).

7. Назначьте синхронизированную группу AD DS в Azure AD и назначьте учетную запись хранения роли участника "общий ресурс SMB данных файлов хранилища".

8. Подключите общую папку к любому узлу сеансов, следуя инструкциям в [части 2. Назначьте удостоверению разрешения на уровне общего ресурса](../storage/files/storage-files-identity-ad-ds-assign-permissions.md).

9. Предоставьте группе AD DS разрешения NTFS для общей папки.

10. Настройте разрешения NTFS для учетных записей пользователей. Вам потребуется операционная единица (OU), исходя из AD DS, к которой принадлежат учетные записи в виртуальной машине.

После назначения удостоверения для хранилища следуйте инструкциям в статьях в разделе [дальнейшие действия](#next-steps) , чтобы предоставить другим необходимым пользователям разрешения на доступ к удостоверению, назначенному виртуальным машинам.

Кроме того, необходимо убедиться, что на виртуальных машинах узла сеансов имеются новые разрешения файловой системы NTFS. Необходимо иметь контейнер операционной единицы, источником которого являются службы домен Active Directory Services (AD DS), и пользователи должны быть членами этой операционной единицы для использования этих разрешений.

## <a name="next-steps"></a>Дальнейшие действия

Ниже приведены другие действия, которые необходимо выполнить после настройки общего файлового ресурса.

- Узнайте, как настроить Azure Active Directory доменных служб (AD DS) в статье [Создание контейнера профиля с помощью службы файлов Azure и AD DS](create-file-share.md).
- Узнайте, как настроить службы файлов Azure и Azure AD DS в статье [Создание контейнера профилей с помощью службы файлов Azure и azure AD DS](create-profile-container-adds.md).
- Узнайте, как настроить Azure NetApp Files для подключения к приложению MSIX в статье [Создание контейнера профиля с Azure NetApp Files и AD DS](create-fslogix-profile-container.md).
- Узнайте, как использовать общую папку на основе виртуальной машины в статье [Создание контейнера профиля для пула узлов с помощью общей папки](create-host-pools-user-profile.md).

Когда вы закончите, вот некоторые другие ресурсы, которые могут оказаться полезными:

- Запросите наши вопросы сообщества об этой функции в [Windows Virtual Desktop течкоммунити](https://techcommunity.microsoft.com/t5/Windows-Virtual-Desktop/bd-p/WindowsVirtualDesktop).
- Вы также можете оставить отзыв о виртуальном рабочем столе Windows в [центре обратной связи по виртуальным рабочим столам Windows](https://support.microsoft.com/help/4021566/windows-10-send-feedback-to-microsoft-with-feedback-hub-app).
- [Глоссарий по присоединению приложений MSIX](app-attach-glossary.md)
- [Часто задаваемые вопросы о присоединении приложения MSIX](app-attach-faq.md)
