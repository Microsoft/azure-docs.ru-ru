---
title: Требования к пропускной способности протокол удаленного рабочего стола виртуальных рабочих столов Windows в Azure
titleSuffix: Azure
description: Общие сведения о требованиях к пропускной способности RDP для виртуальных рабочих столов Windows.
author: gundarev
ms.topic: conceptual
ms.date: 11/16/2020
ms.author: denisgun
ms.openlocfilehash: c9ef72241ac62efd8555de59bb52949321364035
ms.sourcegitcommit: 910a1a38711966cb171050db245fc3b22abc8c5f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "96325185"
---
# <a name="remote-desktop-protocol-rdp-bandwidth-requirements"></a>Требования к пропускной способности протокол удаленного рабочего стола (RDP)

Протокол удаленного рабочего стола (RDP) — это сложная технология, использующая различные методы для совершения доставки удаленной графики сервера на клиентское устройство. В зависимости от варианта использования, доступности вычислительных ресурсов и пропускной способности сети протокол RDP динамически корректирует различные параметры, чтобы обеспечить лучшее взаимодействие с пользователем.

Протокол удаленного рабочего стола мультиплексируют несколько динамических виртуальных каналов (DVCs) в один канал данных, отправляемый через разные сетевые транспорты. Существуют отдельные DVCs для удаленной графики, ввода, перенаправления устройств, печати и других. Партнеры ВВД также могут реализовать свои расширения, использующие интерфейсы DVC.
Объем данных, отправляемых по протоколу RDP, зависит от активности пользователей. Например, пользователь может работать с базовым текстовым содержимым для большей части сеанса и использовать минимальную пропускную способность, а затем создавать печатную страницу документа 200 на локальном принтере. Это задание печати будет использовать значительный объем пропускной способности сети.

При использовании удаленного сеанса доступная пропускная способность сети существенно влияет на качество работы. Разные приложения и разрешения экрана требуют различных конфигураций сети, поэтому важно убедиться, что конфигурация сети соответствует вашим потребностям.

## <a name="estimating-bandwidth-utilization"></a>Оценка использования пропускной способности

Протокол RDP использует различные алгоритмы сжатия для различных типов данных. В таблице ниже приведены руководства по оценке передачи данных.

| Тип данных | Направление | Как оценить |
|---|---|---|
| Удаленная графика | Узел сеанса на клиент | [См. подробные рекомендации](#estimating-bandwidth-used-by-remote-graphics) |
| Периодических сигналов | Оба направления | ~ 20 байт каждые 5 секунд  |
| Входные данные | С клиента на узел сеансов | Объем данных основывается на активности пользователей, менее 100 байт для большинства операций.  |
| Передача файлов | Оба направления | При передаче файлов используется групповое сжатие. Использование сжатия ZIP для аппроксимации |
| Печать | Узел сеанса на клиент | Перенос заданий печати зависит от драйвера и использования блочного сжатия. сжатие ZIP для аппроксимации |

Требования к пропускной способности могут изменяться в некоторых сценариях, например:

* голосовые конференции и видеоконференции;
* связь в режиме реального времени;
* потоковое видео в разрешении 4К.

## <a name="estimating-bandwidth-used-by-remote-graphics"></a>Оценка пропускной способности, используемой удаленной графикой

Нетрудно спрогнозировать использование пропускной способности удаленным рабочим столом. Действия пользователя создают большую часть трафика удаленного рабочего стола. Каждый пользователь уникален, и различия в рабочих шаблонах могут значительно изменить сетевое использование.

Лучшим способом анализа требований к пропускной способности является мониторинг соединений с реальными пользователями. Мониторинг может выполняться встроенными счетчиками производительности или сетевым оборудованием.

Однако во многих случаях вы можете оценить использование сети, зная, как работает протокол удаленного рабочего стола, и анализируя рабочие шаблоны пользователей.

Удаленный протокол предоставляет графику, созданную удаленным сервером для отображения на локальном мониторе. В частности, он предоставляет точечный рисунок рабочего стола, полностью составленный на сервере.
Отправка точечного рисунка на рабочем столе кажется простой задачей при первом подходе, но требует значительного количества ресурсов. Например, образ 1080p на настольном компьютере в его несжатом формате имеет размер около 8 МБ. Отображение этого изображения на мониторе, подключенном локально, с частотой обновления экрана, равной 30 Гц, требует пропускной способности около 237 МБ/с.

Чтобы уменьшить объем данных, передаваемых по сети, протокол RDP использует сочетание нескольких методов, включая, но не ограничиваясь

* Оптимизация частоты кадров
* Классификация содержимого экрана
* Кодеки для конкретного содержимого
* Кодирование последовательного изображения
* Кэширование на стороне клиента

Для лучшего понимания удаленной графики учитывайте следующее.

* Более широкие возможности графики и пропускной способности, которую она займет
  * Текст, элементы пользовательского интерфейса окна и сплошные области цвета потребляют меньше пропускной способности, чем любые другие.
  * Естественные изображения — это наиболее значимые участники использования пропускной способности. Но кэширование на стороне клиента помогает с его уменьшением.
* Передаются только измененные части экрана. Если на экране нет видимых обновлений, обновления не отправляются.
* Воспроизведение видео и другое содержимое с высокой частотой кадров, по сути, представляют собой слайд-шоу с изображением. Протокол RDP динамически использует соответствующие видеокодеки, чтобы доставлять их с приближением к исходной частоте кадров. Тем не менее, он по-прежнему является графическим и является наиболее значимым участником использования пропускной способности.
* Время простоя на удаленном рабочем столе означает отсутствие или минимальное обновление экрана; Таким образом, использование сети минимально во время простоя.
* При сворачивании окна клиента удаленного рабочего стола никакие графические обновления не отправляются с узла сеансов.

На забывайте, что нагрузка на сеть зависит от частоты исходящих кадров рабочей нагрузки приложения и разрешения экрана. При увеличении частоты кадров или разрешения экрана потребность в пропускной способности также возрастает. Например, небольшая рабочая нагрузка при высоком разрешении экрана требует больше пропускной способности, чем аналогичная рабочая нагрузка при обычном или низком разрешении. Для использования устройств с разным разрешением экрана требуется разная пропускная способность.

В следующей таблице приведены инструкции по оценке данных, используемых различными графическими сценариями. Эти номера применяются к конфигурации с одним монитором с разрешением 1920 x 1080 и с графическим режимом по умолчанию и с графическим режимом H. 264/AVC 444.

| Сценарий | Режим по умолчанию | H. 264/режим AVC 444 | Thumbnail | Описание сценария |
|:---|---:|---:|---|---|
| Бездействие | 0,3 кбит/с | 0,3 кбит/с |:::image type="content" source="media/idle.png" alt-text="Снимок экрана неактивного подключения":::| Пользователь приостановил свою работу, и нет активных обновлений экрана |
| Microsoft Word | 100-150 кбит/с | 200-300 кбит/с |:::image type="content" source="media/word.gif" alt-text="Анимация Microsoft Word":::| Пользователь активно работает с Microsoft Word, вводя, вставляя графические изображения и переключаясь между документами. |
| Microsoft Excel | 150-200 кбит/с | 400-500 Кбит/с |:::image type="content" source="media/excel.gif" alt-text="Анимация Microsoft Excel":::| Пользователь активно работает с Microsoft Excel, несколько ячеек с формулами и диаграммами обновляются одновременно |
| Microsoft PowerPoint | 4 – 4,5 Мбит/с | 1,6 – 1,8 Мбит/с |:::image type="content" source="media/powerpoint.gif" alt-text="Анимация Microsoft PowerPoint":::| Пользователь активно работает с Microsoft PowerPoint, вводя и вставляя. Пользователь также изменяет насыщенную графику и использует эффекты смены слайдов |
| Просмотр веб-страниц | 6 – 6.5 Мбит/с | 0.9-1 Мбит/с |:::image type="content" source="media/web.gif" alt-text="Анимация обзора веб-страниц":::| Пользователь активно работает с полнофункциональным графическим веб-сайтом, содержащим несколько статических и анимированных изображений. Пользователь прокручивает страницы горизонтально и вертикально |
| Коллекция изображений | 3.3 – 3,6 Мбит/с | 0,7 – 0,8 Мбит/с |:::image type="content" source="media/image-gallery.gif" alt-text="Анимация коллекции изображений":::| Пользователь активно работает с приложением из коллекции изображений. Просмотр, масштабирование, изменение размера и вращение изображений |
| Воспроизведение видео | 8,5 – 241,3 Мбит/с | 2,5 – 2,8 Мбит/с |:::image type="content" source="media/video.gif" alt-text="Анимация воспроизведения видео":::| Пользователь отслеживает 30-КАДРОВое видео, которое потребляет 1/2 экрана |
| Воспроизведение видео в полноэкранном режиме | 7,5 – 8,5 Мбит/с | 2,5 – 3.1 Мбит/с |:::image type="content" source="media/fullscreen-video.gif" alt-text="Анимация воспроизведения полноэкранного видео":::| Пользователь отслеживает 30-КАДРОВое видео, которое развернуто в полноэкранном режиме |

## <a name="dynamic-bandwidth-allocation"></a>Динамическое распределение пропускной способности

Протокол удаленного рабочего стола — это современный протокол, предназначенный для динамического изменения состояния сети.
Вместо использования жестких ограничений использования пропускной способности протокол RDP использует непрерывное обнаружение сети, которое активно отслеживает доступную пропускную способность сети и время приема пакетов. В зависимости от полученных результатов протокол RDP динамически выбирает параметры кодировки графики и распределяет пропускную способность для перенаправления устройств и других виртуальных каналов.  
Эта технология позволяет протоколу RDP использовать полный сетевой канал, когда он доступен, и быстро отключать его, когда сеть требуется для другого.
Протокол RDP обнаруживает, что и изменяет качество изображения, частоту кадров или алгоритмы сжатия, если другие приложения запрашивают сеть.

## <a name="limit-network-bandwidth-use-with-throttle-rate"></a>Ограничение использования полосы пропускания сети с частотой регулирования

В большинстве случаев нет необходимости ограничивать использование пропускной способности, так как ограничение может повлиять на взаимодействие с пользователем. Однако в сетях с ограниченным доступом может потребоваться ограничить использование сети. Еще один пример — арендованные сети с оплатой за используемый объем трафика.

В таких случаях можно ограничить исходящий сетевой трафик RDP, указав частоту регулирования в политике QoS.

  >[!NOTE]
  > [Убедитесь, что протокол RDP шортпас включен](./shortpath.md) — ограничение частоты регулирования не поддерживается для транспорта с обратным соединением.

### <a name="implement-throttle-rate-limiting-on-session-host-using-group-policy"></a>Реализация ограничения частоты регулирования на узле сеансов с помощью групповая политика

Можно использовать службу качества обслуживания на основе политик (QoS) в групповая политика, чтобы задать стандартную частоту регулирования.

Чтобы создать политику качества обслуживания для узлов сеансов, присоединенных к домену, сначала войдите на компьютер, на котором установлено групповая политика Management. Откройте управление групповая политика (нажмите кнопку Пуск, выберите пункт Администрирование, а затем выберите групповая политика управление) и выполните следующие действия.

1. В групповая политика управление выберите контейнер, в котором должна быть создана новая политика. Например, если весь сеанс содержит компьютеры, расположенные в **узле «узлы сеансов** с именем подразделения», Новая политика должна быть создана в подразделении узла сеансов.

2. Щелкните правой кнопкой мыши соответствующий контейнер, а затем выберите **создать объект GPO в этом домене и свяжите его**.

3. В диалоговом окне **Создание объекта групповой политики** введите имя нового объекта Групповая политика в поле **имя** , а затем нажмите кнопку **ОК**.

4. Щелкните правой кнопкой мыши только что созданную политику и выберите **изменить**.

5. В редактор "Управление групповыми политиками" разверните узел **Конфигурация компьютера**, разверните узел **Параметры Windows**, щелкните правой кнопкой мыши элемент **QoS на основе политики** и выберите команду **создать новую политику**.

6. В диалоговом окне Служба **QoS на основе политик** на странице Открытие введите имя новой политики в поле **имя** . Установите флажок **задать частоту исходящих запросов** и задайте требуемое значение, а затем нажмите кнопку **Далее**.

7. На следующей странице выберите **только приложения с именем исполняемого файла** и введите имя **svchost.exe**, а затем нажмите кнопку **Далее**. Этот параметр указывает политике назначить только приоритет трафика, соответствующего службе удаленный рабочий стол.

8. На третьей странице убедитесь, что выбраны **все исходные IP-адреса** и **IP-адрес назначения** . Выберите **Далее**. Эти два параметра гарантируют, что пакеты будут управляться независимо от того, на каком компьютере (IP-адрес) отправляются пакеты, а какой компьютер (IP-адрес) получит пакеты.

9. На четвертой странице выберите **UDP** в раскрывающемся списке **выберите протокол, к которому применяется политика QoS** .

10. Под заголовком **укажите номер исходного порта**, выберите **из этого исходного порта или диапазона**. В сопроводительном текстовом поле введите **3390**. Нажмите кнопку **Готово**.

Новые политики, которые вы создали, вступят в силу только после обновления групповая политика на компьютерах узла сеансов. Хотя групповая политика периодически обновляет, можно принудительно выполнить немедленное обновление, выполнив следующие действия.

1. На каждом узле сеансов, для которого требуется обновить групповая политика, откройте командную строку от имени администратора (*Запуск от имени администратора*).

2. В командной строке введите

   ```console
   gpupdate /force
   ```

### <a name="implement-throttle-rate-limiting-on-session-host-using-powershell"></a>Реализация ограничения частоты регулирования на узле сеансов с помощью PowerShell

Вы можете настроить частоту регулирования для RDP Шортпас с помощью следующего командлета PowerShell:

```powershell
New-NetQosPolicy -Name "RDP Shortpath" -AppPathNameMatchCondition "svchost.exe" -IPProtocolMatchCondition UDP -IPSrcPortStartMatchCondition 3390 -IPSrcPortEndMatchCondition 3390 -DSCPAction 46 -NetworkProfile All
```

## <a name="next-steps"></a>Дальнейшие действия

* Дополнительные сведения о требованиях к пропускной способности виртуальных рабочих столов Windows см. в статье [Общие сведения о требованиях к пропускной способности протокол удаленного рабочего стола (RDP) для виртуальных рабочих](rdp-bandwidth.md)
* Дополнительные сведения о сетевом подключении к виртуальным рабочим столам Windows [см.](network-connectivity.md)
* Чтобы приступить к работе со службой QoS для виртуальных рабочих столов Windows, см. статью [Реализация качества обслуживания (QoS) для виртуальных рабочих столов Windows](rdp-quality-of-service-qos.md).
