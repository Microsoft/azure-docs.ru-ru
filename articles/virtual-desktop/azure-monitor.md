---
title: Использование монитора виртуальных рабочих столов Windows в Azure
description: Использование Azure Monitor для виртуальных рабочих столов Windows.
author: Heidilohr
ms.topic: how-to
ms.date: 03/29/2021
ms.author: helohr
manager: lizross
ms.openlocfilehash: 1b93e0c0d61eaa390eda66da2a583a4f429ddd79
ms.sourcegitcommit: dae6b628a8d57540263a1f2f1cdb10721ed1470d
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/29/2021
ms.locfileid: "105709554"
---
# <a name="use-azure-monitor-for-windows-virtual-desktop-to-monitor-your-deployment"></a>Использование Azure Monitor для виртуальных рабочих столов Windows для мониторинга развертывания

Azure Monitor для виртуальных рабочих столов Windows — это панель мониторинга, основанная на Azure Monitor книгах, которые помогают ИТ-специалистам понять среды виртуальных рабочих столов Windows. В этом разделе описывается настройка Azure Monitor для виртуальных рабочих столов Windows для мониторинга сред виртуальных рабочих столов Windows.

## <a name="requirements"></a>Требования

Прежде чем приступить к использованию Azure Monitor для виртуальных рабочих столов Windows, необходимо настроить следующие компоненты:

- Все наблюдаемые среды виртуальных рабочих столов Windows должны быть основаны на последнем выпуске виртуального рабочего стола Windows, совместимом с Azure Resource Manager.
- По крайней мере одна настроенная Log Analytics Рабочая область. Используйте назначенную рабочую область Log Analytics для узлов сеансов виртуальных рабочих столов Windows, чтобы убедиться, что счетчики производительности и события собираются только с узлов сеансов в развертывании виртуальных рабочих столов Windows.
- Включите сбор данных для следующих элементов в рабочей области Log Analytics:
    - Диагностика среды виртуальных рабочих столов Windows
    - Рекомендуемые счетчики производительности с узлов сеансов виртуальных рабочих столов Windows
    - Рекомендуемые журналы событий Windows из узлов сеансов виртуальных рабочих столов Windows

 Процесс установки данных, описанный в этой статье, необходим для мониторинга виртуальных рабочих столов Windows. Вы можете отключить все остальные элементы, отправляющие данные в рабочую область Log Analytics, чтобы сэкономить затраты.

Для всех Azure Monitor наблюдения за виртуальным рабочим столом Windows для вашей среды также необходимы следующие разрешения на доступ для чтения:

- Доступ для чтения к подпискам Azure, которые содержат ресурсы виртуальных рабочих столов Windows
- Доступ для чтения к группам ресурсов подписки, которые содержат узлы сеансов виртуальных рабочих столов Windows
- Доступ на чтение к рабочей области Log Analytics или рабочим областям

>[!NOTE]
> Доступ только для чтения позволяет администраторам просматривать данные. Для управления ресурсами на портале виртуальных рабочих столов Windows необходимы разные разрешения.

## <a name="open-azure-monitor-for-windows-virtual-desktop"></a>Открытие Azure Monitor для виртуальных рабочих столов Windows

Вы можете открыть Azure Monitor для виртуальных рабочих столов Windows одним из следующих способов:

- Перейдите по адресу [AKA.MS/azmonwvdi](https://portal.azure.com/#blade/Microsoft_Azure_WVD/WvdManagerMenuBlade/workbooks).
- Найдите и выберите в портал Azure **виртуальный рабочий стол Windows** , а затем щелкните **аналитика**.
- Найдите и выберите **Azure Monitor** из портал Azure. Выберите **центр Insights** в разделе **Insights**, а затем выберите **Windows виртуальный рабочий стол**.
После открытия страницы введите **подписку**, **группу ресурсов**, **пул узлов** и **временной диапазон** среды, которую требуется отслеживать.

>[!NOTE]
>В настоящее время виртуальный рабочий стол Windows поддерживает одновременное наблюдение за одной подпиской, группой ресурсов и пулом узлов. Если не удается найти среду, которую требуется отслеживать, см. [документацию по устранению неполадок](troubleshoot-azure-monitor.md) для получения известных запросов к функциям и проблем.

## <a name="log-analytics-settings"></a>Параметры Log Analytics

Чтобы приступить к использованию Azure Monitor для виртуальных рабочих столов Windows, потребуется по крайней мере одна Log Analyticsная Рабочая область. Используйте назначенную рабочую область Log Analytics для узлов сеансов виртуальных рабочих столов Windows, чтобы убедиться, что счетчики производительности и события собираются только узлы сеансов форм в развертывании виртуальных рабочих столов Windows. Если Рабочая область уже настроена, переходите к [настройке с помощью книги настройки](#set-up-using-the-configuration-workbook). Чтобы настроить его, см. раздел [создание log Analytics рабочей области в портал Azure](../azure-monitor/logs/quick-create-workspace.md).

>[!NOTE]
>Для Log Analytics будет взиматься плата за использование стандартных хранилищ данных. Для начала рекомендуется выбрать модель с оплатой по мере использования и настроить ее при масштабировании развертывания, а также получить дополнительные данные. Дополнительные сведения см. в разделе [цены на Azure Monitor](https://azure.microsoft.com/pricing/details/monitor/).

## <a name="set-up-using-the-configuration-workbook"></a>Настройка с помощью книги настройки

Если вы впервые открываете Azure Monitor для виртуальных рабочих столов Windows, вам потребуется настроить Azure Monitor для среды виртуальных рабочих столов Windows. Чтобы настроить ресурсы, сделайте следующее:

1. Откройте Azure Monitor для виртуальных рабочих столов Windows в портал Azure по адресу [AKA.MS/azmonwvdi](https://portal.azure.com/#blade/Microsoft_Azure_WVD/WvdManagerMenuBlade/workbooks), а затем выберите **Книга конфигурации**.
2. Выберите среду для настройки в разделе **Подписка**, **Группа ресурсов** и **пул узлов**.

Книга конфигурации настраивает среду мониторинга и позволяет проверить конфигурацию после завершения процесса установки. Важно проверить конфигурацию, если элементы на панели мониторинга отображаются неправильно или если группа продуктов публикует обновления, требующие новых параметров.

### <a name="resource-diagnostic-settings"></a>Параметры диагностики ресурсов

Чтобы получить сведения о инфраструктуре виртуальных рабочих столов Windows, необходимо включить несколько параметров диагностики в пулах узлов и рабочих областей Windows (это Рабочая область виртуального рабочего стола Windows, а не Рабочая область Log Analytics). Дополнительные сведения о пулах узлов, рабочих областях и других объектах ресурсов виртуальных рабочих столов Windows см. в нашем [руководству по среде](environment-setup.md).

Дополнительные сведения о диагностике виртуальных рабочих столов Windows и поддерживаемых диагностических таблицах см. в статье [Отправка диагностики виртуальных рабочих столов Windows в log Analytics](diagnostics-log-analytics.md).

Чтобы задать параметры диагностики ресурсов в книге конфигурации, выполните следующие действия. 

1. Выберите вкладку **параметры диагностики ресурсов** в книге конфигурация. 
2. Выберите **log Analytics рабочей области** , чтобы отправить диагностику виртуальных рабочих столов Windows. 

#### <a name="host-pool-diagnostic-settings"></a>Параметры диагностики для пула узлов

Чтобы настроить диагностику пула узлов с помощью раздела "параметры диагностики ресурсов" в книге конфигурации:

1. В разделе **пул узлов** проверьте, включена ли диагностика виртуальных рабочих столов Windows. В противном случае появится сообщение об ошибке "не найдена существующая конфигурация диагностики для выбранного пула узлов". Необходимо включить следующие поддерживаемые диагностические таблицы:

    - Контрольная точка
    - Error
    - Управление
    - Подключение
    - HostRegistration
    - аженсеалсстатус
    
    >[!NOTE]
    > Если сообщение об ошибке не отображается, шаги с 2 по 4 выполнять не нужно.

2. Выберите **Настройка пула узлов**.
3. Выберите **Развернуть**.
4. Обновите книгу конфигурации.

#### <a name="workspace-diagnostic-settings"></a>Параметры диагностики рабочей области 

Чтобы настроить диагностику рабочей области с помощью раздела "параметры диагностики ресурсов" в книге конфигурации, сделайте следующее:

 1. В разделе **Рабочая область** проверьте, включена ли диагностика виртуальных рабочих столов Windows для рабочей области виртуальных рабочих столов Windows. В противном случае появится сообщение об ошибке "не найдена существующая конфигурация диагностики для выбранной рабочей области". Необходимо включить следующие поддерживаемые таблицы диагностики:
 
    - Контрольная точка
    - Error
    - Управление
    - Веб-канал
    
    >[!NOTE]
    > Если сообщение об ошибке не отображается, шаги 2-4 выполнять не нужно.

2. Выберите **Настройка рабочей области**.
3. Выберите **Развернуть**.
4. Обновите книгу конфигурации.

### <a name="session-host-data-settings"></a>Параметры данных узла сеанса

Чтобы получить сведения о узлах сеансов виртуальных рабочих столов Windows, необходимо установить агент Log Analytics на всех узлах сеансов в пуле узлов, убедиться, что узлы сеансов отправляются в Log Analytics рабочую область, и настроить параметры агента Log Analytics для получения данных о производительности и журналах событий Windows.

Log Analytics Рабочая область, в которую отправляются данные узла сеанса, не должна совпадать с той, куда вы отправляете диагностические данные. Если у вас есть узлы сеансов Azure за пределами среды виртуальных рабочих столов Windows, рекомендуется иметь назначенную рабочую область Log Analytics для узлов сеансов виртуальных рабочих столов Windows. 

Чтобы задать Log Analytics рабочую область, в которой нужно получить данные узла сеанса, выполните следующие действия. 

1. Выберите вкладку **Параметры данных узла сеанса** в книге конфигурации. 
2. Выберите **рабочую область log Analytics** , в которую нужно отправить данные узла сеансов. 

#### <a name="session-hosts"></a>Узлы сеансов

Необходимо установить агент Log Analytics на всех узлах сеансов в пуле узлов и отправить данные с этих узлов в выбранную Log Analytics рабочую область. Если Log Analytics не настроен для всех узлов сеансов в пуле узлов, вы увидите раздел **узлы сеансов** в верхней части **параметров данных узла сеанса** с сообщением "некоторые узлы в пуле узлов не отправляют данные в выбранную рабочую область log Analytics".

>[!NOTE]
> Если раздел **узлы сеансов** или сообщение об ошибке не отображаются, все узлы сеансов настроены правильно. Пропустите, чтобы настроить инструкции для [счетчиков производительности рабочей области](#workspace-performance-counters).

Настройка оставшихся узлов сеансов с помощью книги настройки:

1. Выберите **Добавить узлы в рабочую область**. 
2. Обновите книгу конфигурации.

>[!NOTE]
>Для установки расширения Log Analytics необходимо запустить компьютер узла. Если автоматическое развертывание не работает, расширение можно установить на узле вручную. Сведения об установке расширения вручную см. в разделе [log Analytics расширение виртуальной машины для Windows](../virtual-machines/extensions/oms-windows.md).

#### <a name="workspace-performance-counters"></a>Счетчики производительности рабочей области

Необходимо включить определенные счетчики производительности для получения сведений о производительности от узлов сеансов и отправки их в рабочую область Log Analytics.

Если счетчики производительности уже включены и их нужно удалить, следуйте инструкциям в разделе [Настройка счетчиков производительности](../azure-monitor/agents/data-sources-performance-counters.md). Вы можете добавлять и удалять счетчики производительности в одном и том же расположении.

Чтобы настроить счетчики производительности с помощью книги конфигурации, выполните следующие действия. 

1. В разделе **счетчики производительности рабочей области** в книге конфигурация проверьте **настроенные счетчики** , чтобы увидеть, какие счетчики уже включены для отправки в рабочую область log Analytics. Установите флажок **отсутствующие счетчики** , чтобы убедиться, что все необходимые счетчики включены.
2. Если счетчики отсутствуют, выберите **настроить счетчики производительности**.
3. Выберите **применить конфигурацию**.
4. Обновите книгу конфигурации.
5. Убедитесь, что все необходимые счетчики включены, проверив список **отсутствующие счетчики** . 

#### <a name="configure-windows-event-logs"></a>Настройка журналов событий Windows

Кроме того, необходимо включить определенные журналы событий Windows для получения сведений об ошибках, предупреждениях и сведениях от узлов сеансов и отправить их в рабочую область Log Analytics.

Если вы уже включили журналы событий Windows и хотите удалить их, следуйте инструкциям в разделе [Настройка журналов событий Windows](../azure-monitor/agents/data-sources-windows-events.md#configuring-windows-event-logs).  Журналы событий Windows можно добавлять и удалять в одном и том же расположении.

Чтобы настроить журналы событий Windows с помощью книги конфигурации, выполните следующие действия.

1. В разделе **Конфигурация журналов событий Windows** проверьте **настроенные журналы событий** , чтобы просмотреть журналы событий, которые вы уже включили для отправки в рабочую область log Analytics. Проверьте **отсутствующие журналы событий** , чтобы убедиться, что все журналы событий Windows включены.
2. Если журналы событий Windows отсутствуют, выберите **настроить события**.
3. Выберите **Развернуть**.
4. Обновите книгу конфигурации.
5. Убедитесь, что все необходимые журналы событий Windows включены, проверив список **отсутствующие журналы событий** . 

>[!NOTE]
>Если автоматическое развертывание события завершается сбоем, выберите **открыть конфигурацию агента** в книге настройки, чтобы вручную добавить недостающие журналы событий Windows. 

## <a name="optional-configure-alerts"></a>Необязательно: Настройка оповещений

Azure Monitor для виртуальных рабочих столов Windows позволяет отслеживать Azure Monitor оповещения, происходящие в выбранной подписке в контексте данных виртуальных рабочих столов Windows. Azure Monitor оповещения являются дополнительным компонентом в подписках Azure, и их необходимо настроить отдельно от Azure Monitor для виртуального рабочего стола Windows. Платформу предупреждений Azure Monitor можно использовать для задания настраиваемых оповещений о событиях, диагностике и ресурсах виртуальных рабочих столов Windows. Дополнительные сведения о Azure Monitor оповещениях см. в статье [реагирование на события с помощью Azure Monitor предупреждений](../azure-monitor/alerts/tutorial-response.md).

## <a name="diagnostic-and-usage-data"></a>Данные диагностики и использования

Корпорация Майкрософт автоматически собирает данные об использовании и производительности при работе службы Azure Monitor. Корпорация Майкрософт использует эти данные для повышения качества, безопасности и целостности службы.

Чтобы обеспечить точную и эффективную возможность устранения неполадок, собранные данные содержат идентификатор сеанса портала, Azure Active Directory идентификатор пользователя и имя вкладки портала, в которой произошло событие. Корпорация Майкрософт не собирает сведения об именах, адресах и другую контактную информацию.

Дополнительные сведения о сборе и использовании данных см. в [заявлении о конфиденциальности служб Microsoft Online Services](https://privacy.microsoft.com/privacystatement).

>[!NOTE]
>Дополнительные сведения о просмотре или удалении персональных данных, собираемых службой, см. [в статье запросы на субъекты данных Azure для GDPR](/microsoft-365/compliance/gdpr-dsr-azure). Дополнительные сведения о GDPR см. [в разделе GDPR портала доверия службы](https://servicetrust.microsoft.com/ViewPage/GDPRGetStarted).

## <a name="next-steps"></a>Дальнейшие шаги

Теперь, когда вы настроили Azure Monitor для среды виртуальных рабочих столов Windows, ниже приведены некоторые ресурсы, которые могут помочь начать мониторинг среды.

- Ознакомьтесь с нашим [глоссарием](azure-monitor-glossary.md) , чтобы узнать больше о терминах и концепциях, связанных с Azure Monitor для виртуальных рабочих столов Windows.
- Если у вас возникла проблема, ознакомьтесь с нашим [руководством по устранению неполадок](troubleshoot-azure-monitor.md) , чтобы получить справку и известные проблемы.
