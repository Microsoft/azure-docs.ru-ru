---
title: Пул узлов Виртуального рабочего стола Windows на портале Azure — Azure
description: Сведения о том, как создать пул узлов Виртуального рабочего стола Windows с помощью портала Azure.
author: Heidilohr
ms.topic: tutorial
ms.custom: references_regions
ms.date: 03/10/2021
ms.author: helohr
manager: femila
ms.openlocfilehash: 1003ab20f839469235d6bd7949ec3b2df4dd4f25
ms.sourcegitcommit: 56b0c7923d67f96da21653b4bb37d943c36a81d6
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/06/2021
ms.locfileid: "106447987"
---
# <a name="tutorial-create-a-host-pool-with-the-azure-portal"></a>Руководство по Создание пула узлов на портале Azure

>[!IMPORTANT]
>Это содержимое применимо к Виртуальному рабочему столу Windows с объектами Azure Resource Manager для Виртуального рабочего стола Windows. Если вы используете Виртуальный рабочий стол Windows (классический) без объектов Azure Resource Manager, ознакомьтесь с [этой статьей](./virtual-desktop-fall-2019/create-host-pools-azure-marketplace-2019.md). Все объекты, созданные с помощью Виртуального рабочего стола Windows (классического), не поддерживают управление с помощью портала Azure.

Пулы узлов — это коллекция, состоящая из одной или нескольких идентичных виртуальных машин в средах Виртуального рабочего стола Windows. Каждый пул узлов может содержать группы приложений, с которыми пользователи могут взаимодействовать, как с физическим рабочим столом.

В этой статье рассматривается процесс настройки, позволяющий создать пул узлов для среды Виртуального рабочего стола Windows с помощью портала Azure. Этот метод предоставляет браузерный пользовательский интерфейс для таких операций, как создание пула узлов в Виртуальном рабочем столе Windows и группы ресурсов с виртуальными машинами в подписке Azure, присоединение этих виртуальных машин к домену Active Directory и их регистрация в Виртуальном рабочем столе Windows.

## <a name="prerequisites"></a>Предварительные требования

Для создания пула узлов необходимо ввести значения для следующих параметров:

- имя образа виртуальной машины;
- Конфигурация виртуальной машины
- свойства домена и сети;
- свойства пула узлов Виртуального рабочего стола Windows.

Также вам нужно знать следующее:

- Где расположен источник нужного образа? Это образ из коллекции Azure или пользовательский образ?
- Учетные данные для присоединения к домену.

Кроме того, убедитесь, что вы зарегистрировали поставщик ресурсов Microsoft.DesktopVirtualization. Если вы этого еще не сделали, перейдите в раздел **Подписки**, выберите имя подписки и щелкните **Поставщики ресурсов**. Выполните поиск по запросу DesktopVirtualization, выберите Microsoft.DesktopVirtualization, а затем нажмите "Зарегистрироваться".

При создании пула узлов Виртуального рабочего стола Windows на основе шаблона Azure Resource Manager вы можете создать виртуальную машину из коллекции Azure, на основе управляемого образа или неуправляемого образа. Дополнительные сведения о создании образов виртуальных машин см. в статьях [Подготовка диска VHD или VHDX для Windows к отправке в Azure](../virtual-machines/windows/prepare-for-upload-vhd-image.md) и [Создание управляемого образа универсальной виртуальной машины в Azure](../virtual-machines/windows/capture-image-resource.md).

Если у вас еще нет подписки Azure, обязательно [создайте учетную запись](https://azure.microsoft.com/free/?WT.mc_id=A261C142F), прежде чем переходить к этим инструкциям.

## <a name="begin-the-host-pool-setup-process"></a>Начало настройки пула узлов

Чтобы приступить к созданию пула узлов, сделайте следующее.

1. Войдите на портал Azure по адресу [https://portal.azure.com](https://portal.azure.com/).
   
   >[!NOTE]
   > Если вы выполняете вход на портал US Gov, перейдите по ссылке [https://portal.azure.us/](https://portal.azure.us/).

2. Введите **Виртуальный рабочий стол Windows** в поле поиска, а затем найдите и выберите **Виртуальный рабочий стол Windows** в разделе "Службы".

3. На странице обзорных сведений для **Виртуального рабочего стола Windows** щелкните **Создать пул узлов**.

4. На вкладке **Основные сведения** выберите нужную подписку в разделе "Проект".

5. Выберите из раскрывающегося списка существующую группу ресурсов или щелкните вариант **Создать**, чтобы создать новую.

6. Введите уникальное имя для пула узлов.

7. В раскрывающемся списке "Расположение" выберите регион, где вы намерены создать пул узлов.

   В географическом расположении Azure, связанном с выбранными регионами, будут храниться метаданные для этого пула узлов и связанных с ним объектов. Выбирайте регионы в том географическом расположении, где вы предпочитаете хранить метаданные службы.

     > [!div class="mx-imgBorder"]
     > ![Снимок экрана на портале Azure, где отмечено поле "Расположение" с выбранным значением "Восточная часть США". Рядом с этим полем отображается текст "Метаданные будут храниться в восточной части США".](media/portal-location-field.png)
  
   >[!NOTE]
   > Если вы хотите создать пул узлов в [поддерживаемом регионе](data-locations.md) за пределами США, вам потребуется повторно зарегистрировать поставщик ресурсов. После повторной регистрации вы должны увидеть другие регионы в раскрывающемся списке для выбора расположения. Узнайте, как выполнить повторную регистрацию, из статьи об устранении неполадок при [создании пула узлов](troubleshoot-set-up-issues.md#i-only-see-us-when-setting-the-location-for-my-service-objects).

8. В разделе "Тип пула узлов" выберите **Личный** или **Общий**.

    - Если вы выбрали **Личный**, укажите вариант **Автоматическое** либо **Прямое** в поле "Тип назначения".

      > [!div class="mx-imgBorder"]
      > ![Снимок экрана с раскрывающимся меню для выбора типа назначения. Здесь пользователь выбрал вариант "Автоматическое".](media/assignment-type-field.png)

9.  Если вы выбрали **Общий**, введите следующие сведения.

     - Для параметра **Max session limit** (Максимальное число сеансов) введите максимальное число пользователей, которые будут направляться на один узел сеанса подсистемой балансировки нагрузки.
     - Для параметра **Алгоритм балансировки нагрузки** выберите вариант "В ширину" или "В глубину", в зависимости от планируемого режима потребления.

       > [!div class="mx-imgBorder"]
       > ![Снимок экрана с полем типа назначения, где выбран вариант "Общий". Пользователь навел указатель мыши на вариант "В ширину" в раскрывающемся меню балансировки нагрузки.](media/pooled-assignment-type.png)

10. По завершении выберите **Next: Virtual Machines >** (Далее: виртуальные машины >).

11. Если вы уже создали виртуальные машины и хотите использовать их в новом пуле узлов, щелкните **Нет**, а затем выберите **Next: Workspace >** (Далее: рабочая область >) и перейдите в раздел [Сведения о рабочей области](#workspace-information). Если вы сейчас будете создавать новые виртуальные машины и регистрировать их в новом пуле узлов, выберите **Да**.

Итак, вы завершили первую часть. Теперь перейдем к следующему этапу процесса настройки, где мы создадим виртуальную машину.

## <a name="virtual-machine-details"></a>Сведения о виртуальной машине

После завершения первой части процесса вам осталось настроить виртуальную машину.

Чтобы создать виртуальную машину одновременно с настройкой пула узлов, выполните следующие действия.

1. В разделе **Группа ресурсов** выберите группу ресурсов, в которой вы хотите создать виртуальные машины. Эта группа ресурсов может отличаться от той, которую вы указали для пула узлов.

2. После этого укажите **префикс имени** для имен виртуальных машин, которые создаст процесс настройки. К нему будет добавляться суффикс `-`, где числа начинаются с 0.

3. Выберите подходящее значение для параметра **Расположение виртуальной машины**. Это может быть тот же регион, который вы выбрали для пула узлов, или другой регион.
   
4. Затем выберите вариант доступности, который лучше всего вам подходит. Дополнительные сведения о том, какой вариант вам подходит, см. в статье [Варианты доступности виртуальных машин в Azure](../virtual-machines/availability.md) и в разделе [Вопросы и ответы](faq.md#which-availability-option-is-best-for-me).
   
   > [!div class="mx-imgBorder"]
   > [Снимок экрана: раскрывающееся меню зоны доступности. Выделенный параметр "зона доступности".](media/availability-zone.png)

5. Теперь выберите образ, который нужно использовать для создания виртуальной машины. Здесь можно выбрать вариант **Коллекция** или **Большой двоичный объект хранилища**.

    - Если вы выберете **Коллекция**, выберите один из рекомендуемых образов в раскрывающемся меню:

      - Windows 10 Корпоративная с поддержкой нескольких сеансов, версия 1909;
      - Windows 10 Корпоративная с поддержкой нескольких сеансов, версия 1909 и Приложения Microsoft 365;
      - Windows Server 2019 Datacenter
      - Windows 10 Корпоративная с поддержкой нескольких сеансов, версия 2004;
      - Windows 10 Корпоративная с поддержкой нескольких сеансов, версия 2004 и Приложения Microsoft 365.

      Если нужный образ не отображается, щелкните **Просмотреть все образы**, чтобы выбрать другой образ из своей коллекции или один из образов, предоставленных корпорацией Майкрософт и другими издателями. Убедитесь, что вы выбрали один из [поддерживаемых образов ОС](overview.md#supported-virtual-machine-os-images).

      > [!div class="mx-imgBorder"]
      > ![Снимок экрана Marketplace, где отображается список образов, предоставленных корпорацией Майкрософт.](media/marketplace-images.png)

      Можно также открыть **Мои элементы** и выбрать уже загруженный пользовательский образ.

      > [!div class="mx-imgBorder"]
      > ![Снимок экрана с вкладкой "Мои элементы".](media/my-items.png)

    - Если вы выберете **Большой двоичный объект хранилища**, вы можете использовать собственный образ, созданный на основе виртуальной машины Hyper-V или Azure. Вам останется лишь указать расположение образа в виде URI в большом двоичном объекте хранилища.
   
   Расположение образа не зависит от параметра доступности, но устойчивость зоны образа определяет, можно ли использовать этот образ с зоной доступности. При выборе зоны доступности во время создания образа убедитесь, что вы используете образ из коллекции с включенной устойчивостью зоны. Дополнительные сведения о том, какой вариант устойчивости зоны использовать, см. в разделе [Вопросы и ответы](faq.md#which-availability-option-is-best-for-me).

6. Затем выберите необходимое значение для параметра **Размер виртуальной машины**. Здесь можно сохранить размер по умолчанию или выбрать **Изменить размер**. Если вы щелкнете **Изменить размер**, откроется окно для выбора размера виртуальной машины, который лучше подходит для вашей рабочей нагрузки.

7. В поле **Число виртуальных машин** укажите, сколько виртуальных машин нужно создать для этого пула узлов.

    >[!NOTE]
    >Процесс настройки поддерживает до 400 виртуальных машин при настройке пула узлов, а каждый процесс настройки виртуальной машины создает четыре объекта в группе ресурсов. Так как процесс создания не проверяет квоту для подписки, вам нужно самостоятельно следить за тем, чтобы введенное число виртуальных машин не привело к превышению ограничений Azure для виртуальных машин и API для используемой группы ресурсов и подписки. Вы сможете добавить дополнительные виртуальные машины позднее, завершив создание пула узлов.

8. Выберите типы дисков ОС, которые будут использоваться виртуальными машинами: SSD (цен. категория "Стандартный"), SSD (цен. категория "Премиум") или HDD (цен. категория "Стандартный").

9. В разделе Network and security (Сеть и безопасность) выберите **Виртуальная сеть** и **Подсеть**, в которых вы решили разместить создаваемые виртуальные машины. Убедитесь, что эта виртуальная сеть может подключаться к контроллеру домена, так как вам потребуется присоединить к домену виртуальные машины в этой виртуальной сети. DNS-серверы выбранной виртуальной сети нужно настроить для использования IP-адреса контроллера домена.

10. Выберите нужный тип группы безопасности: **Базовый**, **Расширенный** или **Нет**.

    Если вы выберете **Базовый**, дополнительно укажите, нужно ли открыть какой-либо входящий порт. Если ответ **Да**, выберите вариант из списка стандартных портов, чтобы разрешить входящие подключения.

    >[!NOTE]
    >Для повышения безопасности мы не рекомендуем открывать общедоступные входящие порты.

    > [!div class="mx-imgBorder"]
    > ![Снимок экрана со страницей группы безопасности, где в раскрывающемся меню отображается список доступных портов.](media/available-ports.png)

    Если вы выберете **Расширенный**, укажите существующую группу безопасности сети, которую вы настроили ранее.

11. После этого укажите, нужно ли присоединять эти виртуальные машины к определенному домену и подразделению. Если ответ **Да**, укажите домен для присоединения. При необходимости можно добавить подразделение предприятия, к которому будут относиться эти виртуальные машины. Если вы выберете **Нет**, виртуальные машины будут присоединены к домену, соответствующему суффиксу **имени участника-пользователя для присоединения к домену AD**.

    - Когда указываете подразделение, используйте полный путь (различающееся имя) без кавычек.

12. В разделе "Учетная запись администратора домена" введите учетные данные администратора домена Active Directory для выбранной виртуальной сети. Для этой учетной записи нельзя включить многофакторную проверку подлинности (MFA). Если выполняется присоединение к домену доменных служб Azure Active Directory (Azure AD DS), учетная запись должна входить в группу администраторов контроллера домена Azure AD, а пароль учетной записи должен быть действителен в Azure AD DS.

13. По завершении выберите **Next: Workspace >** (Далее: рабочая область >).

Теперь все готово к следующему этапу настройки пула узлов, который включает регистрацию группы приложений в рабочей области.

## <a name="workspace-information"></a>Сведения о рабочей области

Процесс настройки пула узлов по умолчанию создает группу классических приложений. Чтобы пул узлов работал правильно, необходимо опубликовать эту группу приложений для пользователей или групп пользователей, а также зарегистрировать эту ее в рабочей области.

Чтобы зарегистрировать группу классических приложений в рабочей области, сделайте следующее.

1. Выберите **Да**.

   Если вы выберете **Нет**, группу приложений можно будет зарегистрировать позже. Но для правильной работы пула узлов мы рекомендуем выполнить регистрацию в рабочей области как можно скорее.

2. Затем выберите, будете ли вы создавать новую рабочую область или выберете одну из существующих. Вы можете зарегистрировать группу приложений только в тех рабочих областях, которые созданы в том же расположении, что и пул узлов.

3. Кроме того, вы можете выбрать **Next: Tags >** (Далее: теги >).

    Это позволит добавить теги, чтобы группировать объекты по значениям метаданных и упростить работу администраторам.

4. Когда все будет готово, выберите **Просмотр и создание**.

     >[!NOTE]
     >Процесс проверки и создания не проверяет соответствие пароля стандартам безопасности и (или) правильность архитектуры, поэтому вам придется самостоятельно убедиться в отсутствии проблем по этим аспектам.

5. Проверьте сведения о развертывании и убедитесь, что все правильно. Когда все будет готово, выберите **Создать**. Будет запущен процесс развертывания, который создает следующее:

     - новый пул узлов;
     - группу классических приложений;
     - рабочую область, если вы решили ее создать;
     - регистрацию группы классических приложений, если вы подтвердили желание ее зарегистрировать;
     - виртуальные машины, присоединенные к домену и зарегистрированные в новом пуле узлов, если вы подтвердили желание их создать;
     - ссылку на скачивание шаблона Resource Manager на основе заданной конфигурации.

Теперь все готово!

## <a name="run-the-azure-resource-manager-template-to-provision-a-new-host-pool"></a>Запуск шаблона Azure Resource Manager для подготовки нового пула узлов

Если вы предпочитаете использовать автоматизированный процесс, то лучше [скачайте шаблон Azure Resource Manager](https://github.com/Azure/RDS-Templates/tree/master/ARM-wvd-templates), чтобы подготовить новый пул узлов.

>[!NOTE]
>Если вы используете автоматизированный процесс для создания среды, вам потребуется последняя версия файла конфигурации JSON. JSON-файл можно найти [здесь](https://wvdportalstorageblob.blob.core.windows.net/galleryartifacts?restype=container&comp=list).

## <a name="next-steps"></a>Дальнейшие действия

Пул узлов готов, и вы можете заполнить его приложениями RemoteApp. Дополнительные сведения о том, как управлять приложениями в Виртуальном рабочем столе Windows, см. в следующем руководстве:

> [!div class="nextstepaction"]
> [Управление группами приложений](./manage-app-groups.md)
