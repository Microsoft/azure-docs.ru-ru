---
title: Определение требуемого размера подсети & диапазона
titleSuffix: Azure SQL Managed Instance
description: В этом разделе описывается, как вычислить размер подсети, в которой будет развернут Управляемый экземпляр Azure SQL.
services: sql-database
ms.service: sql-managed-instance
ms.subservice: operations
ms.custom: seo-lt-2019, sqldbrb=1
ms.devlang: ''
ms.topic: how-to
author: srdan-bozovic-msft
ms.author: srbozovi
ms.reviewer: sstein, bonova
ms.date: 02/22/2019
ms.openlocfilehash: 156a4c74eea24b20c28df88be85cb32c0ebe2981
ms.sourcegitcommit: 910a1a38711966cb171050db245fc3b22abc8c5f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "96012462"
---
# <a name="determine-required-subnet-size--range-for-azure-sql-managed-instance"></a>Определение требуемого размера подсети & диапазона для Управляемый экземпляр SQL Azure
[!INCLUDE[appliesto-sqlmi](../includes/appliesto-sqlmi.md)]

Управляемый экземпляр Azure SQL необходимо развернуть в [виртуальной сети](../../virtual-network/virtual-networks-overview.md)Azure.

Количество управляемых экземпляров, которые могут быть развернуты в подсети VNet, зависит от размера подсети (диапазона подсети).

При создании управляемого экземпляра Azure выделяет несколько виртуальных машин в зависимости от уровня, выбранного во время подготовки. Поскольку виртуальные машины связанны с подсетью, им необходимы IP-адреса. Azure может выделить дополнительные виртуальные машины для обеспечения высокой доступности во время выполнения обычных операций и технического обслуживания. В результате количество требуемых IP-адресов в подсети превышает число управляемых экземпляров в этой подсети.

По умолчанию для управляемого экземпляра необходимо не менее 32 IP-адресов в подсети. Поэтому при определении минимального количества диапазона IP-адресов подсети для маски подсети можно использовать значение /27. Рекомендуется тщательно спланировать размер подсети для развертывания управляемых экземпляров. Входные данные, которые следует учитывать во время планирования:

- Число управляемых экземпляров, включая следующие параметры экземпляра:
  - уровень служб
  - создание оборудования
  - число виртуальных ядер
- Планирование масштабирования или изменения уровня служб

> [!IMPORTANT]
> Размер подсети с 16 IP-адресами (маска подсети/28) позволяет развертывать управляемый экземпляр внутри него, но его следует использовать только для развертывания одного экземпляра, используемого для оценки или в сценариях разработки и тестирования, в которых операции масштабирования выполняться не будут.

## <a name="determine-subnet-size"></a>Определение размера подсети

Измените размер подсети в соответствии с потребностями развертывания и масштабирования экземпляров. При создании вычислений могут помочь следующие параметры:

- Azure использует пять IP-адресов в подсети для своих потребностей
- Каждый виртуальный кластер выделяет дополнительное количество адресов. 
- Каждый управляемый экземпляр использует количество адресов, которое зависит от ценовой категории и поколения оборудования.

> [!IMPORTANT]
> Невозможно изменить диапазон адресов подсети, если в подсети имеется какой-либо ресурс. Кроме того, невозможно переместить управляемые экземпляры из одной подсети в другую. Везде, где это возможно, рекомендуется использовать больше подсетей, а не меньше, чтобы предотвратить возникновение проблем в будущем.

GP = общее назначение; BC = критически важный для бизнеса; VC = виртуальный кластер

| **Аппаратный сбор** | **Ценовая категория** | **Использование Azure** | **Использование VC** | **Использование экземпляра** | **Полная*** |
| --- | --- | --- | --- | --- | --- |
| 4-е поколение | GP | 5 | 1 | 5 | 11 |
| 4-е поколение | BC | 5 | 1 | 5 | 11 |
| 5-го поколения | GP | 5 | 6 | 3 | 14 |
| 5-го поколения | BC | 5 | 6 | 5 | 16 |

  \* Общее число столбцов отображает количество адресов, которые будут выполнены при развертывании одного экземпляра в подсети. Каждый дополнительный экземпляр в подсети добавляет число адресов, представленных в столбце использование экземпляра. Адреса, представленные в столбце использование Azure, совместно используются несколькими виртуальными кластерами, а адреса, представленные в столбце использование VC, совместно используются экземплярами, размещенными в этом виртуальном кластере.

Операция обновления обычно требует изменения размера виртуального кластера. В некоторых случаях для операции обновления потребуется создание виртуального кластера (Дополнительные сведения см. в [статье Проверка операций управления](sql-managed-instance-paas-overview.md#management-operations)). В случае создания виртуального кластера требуется число дополнительных адресов, равное количеству адресов, представленных в столбце использования VC, суммированном по адресам, необходимым для экземпляров, размещенных в этом виртуальном кластере (столбец использования экземпляра).

**Пример 1**. планируется наличие одного управляемого экземпляра общего назначения (го поколения Hardware) и одного управляемого экземпляра с критически важным для предприятия (го поколения Hardware). Это означает, что для развертывания потребуется как минимум 5 + 1 + 1 * 5 + 6 + 1 * 5 = 22 IP-адресов. Так как диапазоны IP-адресов определяются в степени 2, подсети требуется минимальный диапазон IP-адресов 32 (2 ^ 5) для этого развертывания.<br><br>
Как упоминалось выше, в некоторых случаях для операции обновления потребуется создание виртуального кластера. Это означает, что в качестве примера в случае обновления для управляемого экземпляра го поколения Business, требующего создания виртуального кластера, необходимо иметь дополнительные 6 + 5 = 11 доступных IP-адресов. Так как вы уже используете 22 адреса 32, для этой операции нет доступных адресов. Поэтому необходимо зарезервировать подсеть с маской подсети/26 (64 адресов).

**Пример 2**. вы планируете использовать три общего назначения (го поколенияное оборудование) и два критически важных для бизнеса экземпляра (го поколения Hardware), помещенные в одну подсеть. Это означает, что требуется 5 + 6 + 3 * 3 + 2 * 5 = 30 IP-адресов. Поэтому необходимо зарезервировать подсеть с маской подсети/26. Выбор маски подсети/27 приведет к тому, что оставшееся число адресов будет равно 2 (32 – 30). это не помешает операциям обновления для всех экземпляров, так как в подсети для выполнения масштабирования экземпляра потребуется дополнительный адрес.

**Пример 3**. вы планируете использовать один управляемый экземпляр общего назначения (го поколения оборудование) и выполнять операцию обновления виртуальных ядер вовремя. Это означает, что вам потребуется 5 + 6 + 1 * 3 + 3 = 17 IP-адресов. Поскольку диапазоны IP-адресов определяются как значения в степени 2, вам потребуется диапазон из 32 (2 ^ 5) IP-адресов. Таким образом, необходимо зарезервировать подсеть с маской подсети /27.

### <a name="address-requirements-for-update-scenarios"></a>Требования к адресам для сценариев обновления

Во время выполнения экземпляров операции масштабирования временно требуются дополнительные ресурсы IP, зависящие от ценовой категории и поколения оборудования.

| **Аппаратный сбор** | **Ценовая категория** | **Сценарий** | **Дополнительные адреса*** |
| --- | --- | --- | --- |
| 4-е поколение | GP или BC | Масштабирование виртуальных ядер | 5 |
| 4-е поколение | GP или BC | Масштабирование хранилища | 5 |
| 4-е поколение | GP или BC | Переключение с GP на BC или BC на GP | 5 |
| 4-е поколение | GP | Переключение на го поколения * | 9 |
| 4-е поколение | BC | Переключение на го поколения * | 11 |
| 5-го поколения | GP | Масштабирование виртуальных ядер | 3 |
| 5-го поколения | GP | Масштабирование хранилища | 0 |
| 5-го поколения | GP | Переключение на BC | 5 |
| 5-го поколения | BC | Масштабирование виртуальных ядер | 5 |
| 5-го поколения | BC | Масштабирование хранилища | 5 |
| 5-го поколения | BC | Переключение на GP | 3 |

  \* Го поколенияное оборудование помещается в фазу и больше не доступно для новых развертываний. Обновите создание оборудования с го поколения до го поколения, чтобы воспользоваться возможностями, характерными для создания оборудования го поколения.

## <a name="next-steps"></a>Дальнейшие действия

- Общие сведения см. в статье [что такое Azure SQL управляемый экземпляр?](sql-managed-instance-paas-overview.md).
- Дополнительные сведения об [архитектуре подключения для SQL управляемый экземпляр](connectivity-architecture-overview.md).
- См. раздел [Создание виртуальной сети, в которой будет развернут SQL управляемый экземпляр](virtual-network-subnet-create-arm-template.md).
- Сведения о проблемах с DNS см. [в статье Настройка настраиваемой службы DNS](custom-dns-configure.md).
