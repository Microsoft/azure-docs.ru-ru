---
title: Мониторинг операций управления
titleSuffix: Azure SQL Managed Instance
description: Узнайте о различных способах мониторинга операций управления Управляемый экземпляр Azure SQL.
services: sql-database
ms.service: sql-managed-instance
ms.subservice: operations
ms.custom: ''
ms.devlang: ''
ms.topic: how-to
author: urosmil
ms.author: urmilano
ms.reviewer: sstein, bonova, MashaMSFT
ms.date: 09/03/2020
ms.openlocfilehash: 6cdd3137798e221974dadda78dd55b6ae944bc78
ms.sourcegitcommit: e559daa1f7115d703bfa1b87da1cf267bf6ae9e8
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/17/2021
ms.locfileid: "100589349"
---
# <a name="monitoring-azure-sql-managed-instance-management-operations"></a>Мониторинг операций управления Управляемый экземпляр SQL Azure
[!INCLUDE[appliesto-sqlmi](../includes/appliesto-sqlmi.md)]

Управляемый экземпляр Azure SQL обеспечивает мониторинг [операций управления](management-operations-overview.md) , которые используются для развертывания новых управляемых экземпляров, обновления свойств экземпляра или удаления экземпляров, когда они больше не нужны. 

## <a name="overview"></a>Обзор

Все операции управления можно классифицировать следующим образом:

- Развертывание экземпляра (создание нового экземпляра).
- Обновление экземпляра (изменение свойств экземпляра, например виртуальных ядер или зарезервированное хранилище).
- Удаление экземпляра.

Большинство операций управления — [длительные операции](management-operations-overview.md#duration). Поэтому необходимо отслеживать состояние или выполнять шаги, выполняемые в ходе операции. 

Существует несколько способов мониторинга операций управления управляемыми экземплярами.

- [Развертывания группы ресурсов](../../azure-resource-manager/templates/deployment-history.md)
- [Журнал действий](../../azure-monitor/essentials/activity-log.md)
- [API операций управляемого экземпляра](#managed-instance-operations-api)


В следующей таблице сравниваются параметры мониторинга операции управления. 

| Параметр | Сохранение | Поддержка отмены | Создать | Update | DELETE | Отменить | Шаги |
| --- | --- | --- | --- | --- | --- | --- | --- |
| Развертывания группы ресурсов | Бесконечно<sup>1</sup> | Нет<sup>2</sup> | Видимый | Видимый | Не отображается. | Видимый | Не отображается. |
| Журнал действий | 90 дней | Нет | Видимый | Видимый | Видимый | Видимый |  Не отображается. |
| API операций управляемого экземпляра | 24 часа | [Да](management-operations-cancel.md) | Видимый | Видимый | Видимый | Видимый | Видимый |
|  |  |  |  |  |  |  | |

<sup>1</sup> журнал развертывания для группы ресурсов ограничен 800 развертываниями.

<sup>2</sup> развертывания группы ресурсов поддерживают операцию отмены. Тем не менее из-за отмены логики отменяется только операция, запланированная на развертывание после выполнения действия отмены. Непрерывное развертывание не отменяется при отмене развертывания группы ресурсов. Поскольку развертывание управляемого экземпляра состоит из одного длительного шага (с точки зрения диспетчера ресурсов Azure), отмена развертывания группы ресурсов не приведет к отмене развертывания управляемого экземпляра, и операция будет завершена. 

## <a name="managed-instance-operations-api"></a>API операций управляемого экземпляра

API операций управления специально предназначены для отслеживания операций. Мониторинг операций с управляемыми экземплярами позволяет получить подробные сведения о параметрах и шагах операций, а также [отменить определенные операции](management-operations-cancel.md). Помимо сведений об операциях и команды Cancel этот API можно использовать в скриптах автоматизации с развертываниями с несколькими ресурсами. в зависимости от этапа выполнения можно запустить некоторое развертывание зависимых ресурсов.

Это интерфейсы API: 

| Get-Help | Описание |
| --- | --- |
|[Операции Управляемый экземпляр — получение](/rest/api/sql/managedinstanceoperations/get)|Возвращает операцию управления управляемым экземпляром.|
|[Управляемый экземпляр операции — отмена](/rest/api/sql/managedinstanceoperations/cancel)|Отменяет асинхронную операцию на управляемом экземпляре.|
|[Управляемый экземпляр операций — список по Управляемый экземпляр](/rest/api/sql/managedinstanceoperations/listbymanagedinstance)|Возвращает список операций, выполненных с управляемым экземпляром.|

> [!NOTE]
> Используйте API версии 2020-02-02, чтобы просмотреть операцию создания управляемого экземпляра в списке операций. Это версия по умолчанию, используемая в портал Azure и последние пакеты PowerShell и Azure CLI.

## <a name="monitor-operations"></a>Мониторинг операций

# <a name="portal"></a>[Портал](#tab/azure-portal)

В портал Azure используйте страницу **Обзор** управляемого экземпляра для мониторинга операций с управляемым экземпляром. 

Например, **операция создания** отображается в начале процесса создания на странице **Обзор** : 

![Ход создания управляемого экземпляра](./media/management-operations-monitor/monitoring-create-operation.png)

Выберите **текущую операцию** , чтобы открыть страницу **текущей операции** и просмотреть операции **создания** или **обновления** . Кроме того, можно также [отменить](management-operations-cancel.md) операции на этой странице.  

![Сведения об операции управляемого экземпляра](./media/management-operations-monitor/monitoring-operation-details.png)

> [!NOTE]
> [Можно отменить](management-operations-cancel.md)создание операций, отправленных с помощью портал Azure, PowerShell, Azure CLI или других средств, использующих REST API версии 2020-02-02. REST API версии старше 2020-02-02, используемые для отправки операции создания, запустит развертывание экземпляра, но развертывание не будет указано в API операций и не будет отменено.

# <a name="powershell"></a>[PowerShell](#tab/azure-powershell)

Командлет Get-AzSqlInstanceOperation получает сведения об операциях в управляемом экземпляре. Вы можете просмотреть все операции в управляемом экземпляре или просмотреть определенную операцию, указав имя операции.

```powershell-interactive
$managedInstance = "yourInstanceName"
$resourceGroup = "yourResourceGroupName"

$managementOperations = Get-AzSqlInstanceOperation `
    -ManagedInstanceName $managedInstance  -ResourceGroupName $resourceGroup
```

Подробное описание команд см. в разделе [Get-азсклинстанцеоператион](/powershell/module/az.sql/get-azsqlinstanceoperation).

# <a name="azure-cli"></a>[Azure CLI](#tab/azure-cli)

В списке AZ SQL MI Op получается список операций, выполняемых на управляемом экземпляре. Если вы еще не установили Azure CLI, обратитесь к разделу [Установка Azure CLI](/cli/azure/install-azure-cli).

```azurecli-interactive
az sql mi op list -g yourResourceGroupName --mi yourInstanceName 
```

Подробное описание команд см. в разделе [AZ SQL MI Op](/cli/azure/sql/mi/op).

---

## <a name="next-steps"></a>Дальнейшие действия

- Сведения о создании первого управляемого экземпляра см. в [этом руководстве по началу работы](instance-create-quickstart.md).
- Список функций и сравнительных списков см. в разделе [Общие функции SQL](../database/features-comparison.md).
- Дополнительные сведения о конфигурации виртуальной сети см. в разделе [Архитектура подключения к Управляемому экземпляру SQL Azure](connectivity-architecture-overview.md).
- Сведения о создании управляемого экземпляра и восстановлении базы данных из файла резервной копии см. в разделе [Краткое руководство. Создание управляемого экземпляра Управляемого экземпляра SQL](instance-create-quickstart.md).
- Сведения о миграции с помощью Azure Database Migration Service см. в разделе [Руководство. Миграция из SQL Server в Управляемый экземпляр базы данных SQL Azure в автономном режиме с помощью DMS](../../dms/tutorial-sql-server-to-managed-instance.md).