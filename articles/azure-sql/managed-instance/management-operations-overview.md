---
title: Общие сведения об операциях управления
titleSuffix: Azure SQL Managed Instance
description: Узнайте больше о длительности операций управления в Управляемом экземпляре SQL Azure и рекомендациях по ним.
services: sql-database
ms.service: sql-managed-instance
ms.subservice: operations
ms.custom: ''
ms.devlang: ''
ms.topic: overview
author: urosmil
ms.author: urmilano
ms.reviewer: sstein, MashaMSFT
ms.date: 07/10/2020
ms.openlocfilehash: 2da7311e61aa39be69a6a0a29eff686baaad7ebf
ms.sourcegitcommit: f28ebb95ae9aaaff3f87d8388a09b41e0b3445b5
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/29/2021
ms.locfileid: "91323198"
---
# <a name="overview-of-azure-sql-managed-instance-management-operations"></a>Обзор операций управления в Управляемом экземпляре SQL Azure
[!INCLUDE[appliesto-sqlmi](../includes/appliesto-sqlmi.md)]

Управляемый экземпляр SQL Azure поддерживает операции управления, которые можно использовать для автоматического развертывания новых управляемых экземпляров и удаления ненужных, а также обновления свойств управляемых экземпляров.

## <a name="what-are-management-operations"></a>Что такое операции управления?

Все операции управления можно классифицировать следующим образом:

- Развертывание экземпляра (создание нового экземпляра).
- обновление экземпляра (изменение свойств экземпляра, например числа виртуальных ядер или зарезервированной емкости в хранилище);
- Удаление экземпляра

Для поддержки [развертываний в виртуальных сетях Azure](../../virtual-network/virtual-network-for-azure-services.md), а также для обеспечения изоляции и безопасности клиентов Управляемый экземпляр SQL использует [виртуальные кластеры](connectivity-architecture-overview.md#high-level-connectivity-architecture). Виртуальный кластер представляет собой выделенный набор изолированных виртуальных машин, развернутых в подсети виртуальной сети клиента. По сути, каждое развертывание управляемого экземпляра в пустой подсети приводит к созданию нового виртуального кластера.

Последующие операции управления управляемыми экземплярами могут влиять на работу базового виртуального кластера. Изменения, влияющие на работу базового кластера, могут отражаться на длительности операций управления, так как развертывание дополнительных виртуальных машин требует дополнительного времени, что необходимо учитывать при планировании новых развертываний или обновлений имеющихся управляемых экземпляров.


## <a name="duration"></a>Длительность

Длительность операций в виртуальном кластере может быть различной, но обычно она является наибольшей. 

Ниже приведены типичные значения, рассчитанные на основе существующих данных телеметрии служб.

- **Создание виртуального кластера.**  Создание — это синхронный этап в операциях управления экземпляром. <br/> **90 % операций завершается в течение 4 часов**.
- **Изменение размера виртуального кластера (расширение или сжатие).** Расширение выполняется синхронно, а сжатие — асинхронно (без какого-либо влияния на длительность операций управления экземпляром). <br/>**90 % операций расширения кластера завершается менее чем за 2,5 часа**.
- **Удаление виртуального кластера.** Удаление — это асинхронный этап, но для пустого виртуального кластера его также можно [инициировать вручную](virtual-cluster-delete.md) (в этом случае оно выполняется синхронно). <br/>**90 % операций удаления виртуальных кластеров завершается через 1,5 часа**.

Кроме того, управление экземплярами может также включать в себя одну из операций с размещенными базами данных, что приводит к более длительному выполнению.

- **Подключение файлов базы данных из службы хранилища Azure.**  Синхронный этап, например изменение масштаба вычислительных ресурсов (виртуальных ядер) или хранилища на уровне служб общего назначения. <br/>**90 % этих операций завершается в течение 5 минут**.
- **Заполнение начальными значениями групп доступности Always On.** Синхронный этап, например изменение масштаба вычислительных ресурсов (виртуальных ядер) или хранилища на уровне служб общего назначения, а также изменение уровня служб с "Общего назначения" на "Критически важный для бизнеса" (или наоборот). Длительность этой операции пропорциональна общему размеру базы данных, а также текущей активности базы данных (число активных транзакций). Операция базы данных при обновлении экземпляра может существенно повлиять на общую длительность. <br/>**90 % этих операций выполняется со скоростью 220 ГБ/ч или больше.**

В следующих таблицах перечислены операции и типичная общая длительность в зависимости от категории операции.

**Категория: Развертывание**.

|Операция  |Длительные сегменты  |Ожидаемая продолжительность  |
|---------|---------|---------|
|Первый экземпляр в пустой подсети|Создание виртуального кластера|90 % операций завершается в течение 4 часов.|
|Первый экземпляр другого поколения оборудования в непустой подсети (например, первый экземпляр поколения 5 в подсети с экземплярами поколения 4)|Создание виртуального кластера<sup>1</sup>|90 % операций завершается в течение 4 часов.|
|Создание последующих экземпляров в непустой подсети (второй, третий и т. д. экземпляр)|Изменение размера виртуального кластера|90 % операций завершается в течение 2,5 часов.|
| | | 

<sup>1</sup> Виртуальный кластер создается для каждого поколения оборудования.

**Категория: обновление**

|Операция  |Длительные сегменты  |Ожидаемая продолжительность  |
|---------|---------|---------|
|Изменение свойства экземпляра (пароль администратора, имя для входа в Azure AD, флаг "Преимущество гибридного использования Azure")|Недоступно|До 1 минуты.|
|Горизонтальное изменение масштаба хранилища экземпляра (уровень служб общего назначения)|Присоединение файлов базы данных|90 % операций завершается в течение 5 минут.|
|Горизонтальное изменение масштаба хранилища экземпляра (уровень критически важных для бизнеса служб)|— Изменение размера виртуального кластера<br>— Начальное заполнение групп доступности Always On|90 % операций завершаются в течение 2,5 часов + время на заполнение всех баз данных (220 ГБ/ч).|
|Вертикальное изменение масштаба вычислительных ресурсов экземпляра (количества виртуальных ядер, уровень "Общего назначения")|— Изменение размера виртуального кластера<br>— Присоединение файлов базы данных|90 % операций завершается в течение 2,5 часов.|
|Вертикальное изменение масштаба вычислительных ресурсов экземпляра (количества виртуальных ядер, уровень "Критически важный для бизнеса")|— Изменение размера виртуального кластера<br>— Начальное заполнение групп доступности Always On|90 % операций завершаются в течение 2,5 часов + время на заполнение всех баз данных (220 ГБ/ч).|
|Изменение уровня служб экземпляра (с "Общего назначения" на "Критически важный для бизнеса" и наоборот)|— Изменение размера виртуального кластера<br>— Начальное заполнение групп доступности Always On|90 % операций завершаются в течение 2,5 часов + время на заполнение всех баз данных (220 ГБ/ч).|
| | | 

**Категория: удаление**

|Операция  |Длительные сегменты  |Ожидаемая продолжительность  |
|---------|---------|---------|
|Удаление экземпляра|Резервное копирование заключительного фрагмента журнала для всех баз данных|90 % операций длится не более 1 минуты.<br>Примечание. При удалении последнего экземпляра в подсети в ходе этой операции будет запланировано удаление виртуального кластера через 12 часов.<sup>1</sup>|
|Удаление виртуального кластера (выполняется в качестве операции, инициированной пользователем)|Удаление виртуального кластера|90 % операций завершается в течение 1,5 часов.|
| | | 

<sup>1</sup> 12 часов задано в текущей конфигурации, но она может быть изменена в будущем. Если виртуальный кластер необходимо удалить быстрее (например, чтобы освободить подсеть), выполните инструкции в статье [Удаление подсети после удаления управляемого экземпляра](virtual-cluster-delete.md).

## <a name="instance-availability"></a>Доступность экземпляра

Управляемый экземпляр SQL **доступен во время операций обновления**, за исключением короткого простоя, вызванного отработкой отказа, которая выполняется в конце обновления. Благодаря [ускоренному восстановлению базы данных](../accelerated-database-recovery.md) этот простой обычно длится до 10 секунд даже в случае прерывания длительных транзакций.

Управляемый экземпляр недоступен для клиентских приложений во время операций развертывания и удаления.

> [!IMPORTANT]
> При выполнении длительных транзакций (импорт данных, задания обработки данных, перестроение индекса и т. д.) не рекомендуется масштабировать вычислительные ресурсы или хранилище Управляемого экземпляра SQL Azure, а также изменять уровень служб. Отработка отказа базы данных в конце операции отменяет все текущие транзакции. 

## <a name="management-operations-steps"></a>Этапы операций управления

Операции управления состоят из нескольких этапов. С помощью [предлагаемого API операций](management-operations-monitor.md) эти этапы можно предоставлять для подмножества операций (развертывание и обновление). Операция развертывания состоит из трех этапов, тогда как операция обновления выполняется за шесть этапов. Дополнительные сведения о длительности операций см. в разделе [Длительность](#duration). Этапы перечислены в порядке выполнения.

### <a name="managed-instance-deployment-steps"></a>Этапы развертывания управляемого экземпляра

|Имя шага  |Описание шага  |
|----|---------|
|Проверка запросов |Отправленные параметры проверяются. В случае ошибки в конфигурации операция завершится сбоем. |
|Создание виртуального кластера или изменение его размера |В зависимости от состояния подсети выполняется создание виртуального кластера или изменение его размера. |
|Запуск нового экземпляра SQL |В развернутом виртуальном кластере запускается процесс SQL. |

### <a name="managed-instance-update-steps"></a>Этапы обновления управляемого экземпляра

|Имя шага  |Описание шага  |
|----|---------|
|Проверка запросов | Отправленные параметры проверяются. В случае ошибки в конфигурации операция завершится сбоем. |
|Создание виртуального кластера или изменение его размера |В зависимости от состояния подсети выполняется создание виртуального кластера или изменение его размера. |
|Запуск нового экземпляра SQL | В развернутом виртуальном кластере запускается процесс SQL. |
|Заполнение начальными значениями файлов базы данных или подключение файлов базы данных |В зависимости от типа операции обновления выполняется либо заполнение базы данных начальными значениями, либо подключение файлов базы данных. |
|Подготовка к отработке отказа и отработка отказа |После заполнения данных начальными значениями или повторного подключения файлов базы данных система подготавливается к отработке отказа. Если все настроено, то выполняется отработка отказа **с коротким временем простоя**. |
|Очистка старого экземпляра SQL |Удаление старого процесса SQL из виртуального кластера |

> [!NOTE]
> В результате масштабирования экземпляров базовый виртуальный кластер подвергнется процессу освобождения неиспользуемой емкости и возможной дефрагментации емкости. Это может повлиять на экземпляры, не участвующие в операциях создания или масштабирования. 


## <a name="management-operations-cross-impact"></a>Перекрестное влияние операций управления

Операции управления управляемым экземпляром могут повлиять на другие операции управления экземплярами, размещенными в том же виртуальном кластере.

- **Длительные операции восстановления** в виртуальном кластере приводят к приостановке операции создания экземпляра или масштабирования другого экземпляра в той же подсети.<br/>**Пример**. Если выполняется длительная операция восстановления, а в той же подсети обрабатывается запрос на создание или масштабирование, то выполнение этого запроса займет больше времени, так как сначала потребуется дождаться завершения операции восстановления.

- **Операция создания или масштабирования следующего экземпляра** приостанавливается ранее инициированной операцией создания или масштабирования экземпляра, потребовавшей изменения размера виртуального кластера.<br/>**Пример**. Если в одной подсети в одном и том же виртуальном кластере получено несколько запросов на создание и (или) масштабирование и один из них инициирует изменение размера виртуального кластера, то все запросы, которые были отправлены через 5 после этого начального запроса, будут выполняться дольше, чем ожидалось, так как для их выполнения необходимо дождаться завершения изменения размера.

- **Операции создания и масштабирования, запрашиваемые в пределах 5-минутного периода**, объединяются в пакеты и выполняются параллельно.<br/>**Пример**. Для всех операций, запрашиваемых в пределах 5-минутного периода, будет выполняться только одна операция изменения размера виртуального кластера (отсчитывается с момента выполнения запроса первой операции). Если с момента отправки первого запроса до момента отправки последующего прошло более 5 минут, этот следующий запрос будет выполнен только после изменения размера виртуального кластера.

> [!IMPORTANT]
> Операции управления, приостановленные из-за выполнения другой операции, будут автоматически возобновлены после выполнения условий для продолжения. Для возобновления временно приостановленных операций управления никаких действий со стороны пользователя не требуется.

## <a name="monitoring-management-operations"></a>Мониторинг операций управления

Сведения о мониторинге выполнения операций управления и их состояния см. в разделе [Мониторинг операций управления в Управляемом экземпляре SQL Azure](management-operations-monitor.md).

## <a name="canceling-management-operations"></a>Отмена операций управления

Сведения о том, как отменить операцию управления, см. в разделе [Отмена операций управления в Управляемом экземпляре SQL Azure](management-operations-cancel.md).


## <a name="next-steps"></a>Дальнейшие действия

- Сведения о создании первого управляемого экземпляра см. в [этом руководстве по началу работы](instance-create-quickstart.md).
- Сведения о функциях и список сравнения см. в статье [Сравнение функций: база данных SQL Azure и Управляемый экземпляр Azure SQL](../database/features-comparison.md).
- Дополнительные сведения о конфигурации виртуальной сети см. в разделе [Архитектура подключения к Управляемому экземпляру SQL Azure](connectivity-architecture-overview.md).
- Сведения о создании управляемого экземпляра и восстановлении базы данных из файла резервной копии см. в разделе [Краткое руководство. Создание управляемого экземпляра Управляемого экземпляра SQL](instance-create-quickstart.md).
- Сведения о миграции с помощью Azure Database Migration Service см. в разделе [Руководство. Миграция из SQL Server в Управляемый экземпляр базы данных SQL Azure в автономном режиме с помощью DMS](../../dms/tutorial-sql-server-to-managed-instance.md).
