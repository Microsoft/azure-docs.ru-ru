---
title: Перенос баз данных в SQL Управляемый экземпляр с помощью службы воспроизведения журналов
description: Сведения о переносе баз данных из SQL Server в SQL Управляемый экземпляр с помощью службы воспроизведения журналов
services: sql-database
ms.service: sql-managed-instance
ms.custom: seo-lt-2019, sqldbrb=1
ms.devlang: ''
ms.topic: how-to
author: danimir
ms.author: danil
ms.reviewer: sstein
ms.date: 02/23/2021
ms.openlocfilehash: 73963763716d7e18b757b5ade8998f23cc589fdb
ms.sourcegitcommit: b4647f06c0953435af3cb24baaf6d15a5a761a9c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/02/2021
ms.locfileid: "101661364"
---
# <a name="migrate-databases-from-sql-server-to-sql-managed-instance-using-log-replay-service"></a>Перенос баз данных из SQL Server в SQL Управляемый экземпляр с помощью службы воспроизведения журналов
[!INCLUDE[appliesto-sqlmi](../includes/appliesto-sqlmi.md)]

В этой статье объясняется, как вручную настроить миграцию базы данных с SQL Server 2008-2019 на SQL Управляемый экземпляр с помощью службы воспроизведения журналов (LRS). Это облачная служба, включенная для Управляемый экземпляр на основе технологии доставки журналов SQL Server. LRS следует использовать в тех случаях, когда служба миграции данных Azure (DMS) не может использоваться, когда требуется больше элементов управления или если существует небольшая погрешность для простоя.

## <a name="when-to-use-log-replay-service"></a>Когда следует использовать службу воспроизведения журналов

В случаях, когда служба [DMS Azure](https://docs.microsoft.com/azure/dms/tutorial-sql-server-to-managed-instance) не может использоваться для миграции, LRS облачную службу можно использовать непосредственно с PowerShell, командлетами CLI или API для ручной сборки и координации переноса баз данных в SQL управляемый экземпляр. 

Вы можете использовать облачную службу LRS в следующих случаях:
- Для проекта переноса базы данных требуется дополнительный контроль
- Существует небольшая погрешность для простой прямую миграцию миграции.
- Невозможно установить исполняемый файл DMS в вашей среде
- Исполняемый файл DMS не имеет доступа к резервным копиям базы данных
- Доступ к ОС узла невозможен или отсутствуют права администратора
- Не удалось открыть сетевые порты из вашей среды в Azure

> [!NOTE]
> Рекомендуемый автоматизированный способ переноса баз данных из SQL Server в SQL Управляемый экземпляр — использование Azure DMS. Эта служба использует одну и ту же облачную службу LRS в серверной части с доставкой журналов в режиме NORECOVERY. Рекомендуется вручную использовать LRS для управления миграцией в тех случаях, когда Azure DMS не полностью поддерживает ваши сценарии.

## <a name="how-does-it-work"></a>Как это работает?

Для создания пользовательского решения с помощью LRS для переноса баз данных в облако требуется выполнить несколько действий по оркестрации, показанных на схеме и описанных в таблице ниже.

Миграция состоит из создания полных резервных копий базы данных на SQL Server с включенной КОНТРОЛЬной СУММой и копирования файлов резервных копий в хранилище BLOB-объектов Azure. LRS используется для восстановления файлов резервных копий из хранилища BLOB-объектов Azure в SQL Управляемый экземпляр. Хранилище BLOB-объектов Azure используется в качестве промежуточного хранилища между SQL Server и SQL Управляемый экземпляр.

LRS будет отслеживать хранилище больших двоичных объектов Azure на наличие новых разностных резервных копий, а также добавлять созданные после восстановления полной резервной копии журналы и автоматически восстанавливать новые добавленные файлы. Ход выполнения восстановления файлов резервной копии на SQL Управляемый экземпляр можно отслеживать с помощью службы. Кроме того, процесс может быть прерван при необходимости.

LRS не требует специального соглашения об именовании файлов резервных копий, так как оно сканирует все файлы, размещенные в хранилище BLOB-объектов Azure, и конструирует цепочку резервных копий от считывания только заголовков файлов. Базы данных находятся в состоянии восстановления в процессе миграции, так как они восстанавливаются в режиме [NORECOVERY](https://docs.microsoft.com/sql/t-sql/statements/restore-statements-transact-sql?view=sql-server-ver15#comparison-of-recovery-and-norecovery) и не могут использоваться для чтения или записи до полного завершения процесса миграции. 

При переносе нескольких баз данных резервные копии для каждой базы данных необходимо поместить в отдельную папку в хранилище BLOB-объектов Azure. LRS необходимо запустить отдельно для каждой базы данных, и необходимо указать разные пути для разделения папок хранилища BLOB-объектов Azure. 

LRS можно запустить в автозаполнении или непрерывном режиме. При запуске в режиме автозаполнения миграция будет выполнена автоматически, когда было восстановлено Последнее указанное имя файла резервной копии. При запуске в непрерывном режиме служба постоянно восстанавливает все добавленные файлы резервных копий, и миграция будет выполнена только в ручном прямую миграцию. Рекомендуется, чтобы ручная прямую миграцию выполнялась только после создания окончательной резервной копии с заключительным фрагментом журнала и показана как восстановленная в Управляемый экземпляр SQL. Окончательный шаг прямую миграцию сделает базу данных доступной для чтения и записи в SQL Управляемый экземпляр.

После остановки LRS либо автоматически на автозаполнении, либо вручную в прямую миграцию, процесс восстановления невозможно возобновить для базы данных, которая была подключена к SQL Управляемый экземпляр. Чтобы восстановить дополнительные файлы резервных копий после завершения миграции с помощью автозаполнения или вручную в прямую миграцию, необходимо удалить базу данных, а всю цепочку резервных копий необходимо восстановить с нуля, перезапуская LRS.

  ![Описание действий по оркестрации службы воспроизведения журналов для SQL Управляемый экземпляр](./media/log-replay-service-migrate/log-replay-service-conceptual.png)

| Операция | Сведения |
| :----------------------------- | :------------------------- |
| **1. Скопируйте резервные копии базы данных из SQL Server в хранилище BLOB-объектов Azure**. | — Копирование полных, разностных и резервных копий журналов из SQL Server в контейнер хранилища BLOB-объектов Azure с помощью [Azcopy](https://docs.microsoft.com/azure/storage/common/storage-use-azcopy-v10)или [Обозреватель службы хранилища Azure](https://azure.microsoft.com/features/storage-explorer/). <br />— Используйте любые имена файлов, так как LRS не требует определенного соглашения об именовании файлов.<br />— При переносе нескольких баз данных для каждой базы данных требуется отдельная папка. |
| **2. Запустите службу LRS в облаке**. | -Service можно запустить с помощью командлетов: <br /> PowerShell [Start-азсклинстанцедатабаселогреплай](https://docs.microsoft.com/powershell/module/az.sql/start-azsqlinstancedatabaselogreplay) <br /> [Командлеты CLI az_sql_midb_log_replay_start](https://docs.microsoft.com/cli/azure/sql/midb/log-replay#az_sql_midb_log_replay_start). <br /> -Start LRS отдельно для каждой базы данных, указывающей на другую папку резервных копий в хранилище BLOB-объектов Azure. <br />— После запуска служба выберет резервные копии из контейнера хранилища BLOB-объектов Azure и начнет их восстановление в SQL Управляемый экземпляр.<br /> -Если LRS был запущен в непрерывном режиме, то после восстановления всех начальных резервных копий служба будет следить за новыми файлами, отправленными в папку, и будет постоянно применять журналы на основе цепочки LSN, пока служба не будет остановлена. |
| **2,1. Отслеживайте ход выполнения операции**. | — Ход выполнения операции восстановления можно отслеживать с помощью командлетов или: <br /> PowerShell [Get-азсклинстанцедатабаселогреплай](https://docs.microsoft.com/powershell/module/az.sql/get-azsqlinstancedatabaselogreplay) <br /> [Командлеты CLI az_sql_midb_log_replay_show](https://docs.microsoft.com/cli/azure/sql/midb/log-replay#az_sql_midb_log_replay_show). |
| **2,2. при необходимости стоп\аборт операцию**. | В случае, если процесс миграции необходимо прерывать, операция может быть остановлена с помощью командлетов: <br /> PowerShell [-азсклинстанцедатабаселогреплай](https://docs.microsoft.com/powershell/module/az.sql/stop-azsqlinstancedatabaselogreplay) <br /> Командлеты CLI [az_sql_midb_log_replay_stop](https://docs.microsoft.com/cli/azure/sql/midb/log-replay#az_sql_midb_log_replay_stop) . <br /><br />— Это приведет к удалению восстанавливаемой базы данных на Управляемый экземпляр SQL. <br />-После остановки LRS невозможно возобновить работу базы данных. Процесс миграции необходимо перезапустить с нуля. |
| **3. прямую миграцию в облако при готовности**. | — После восстановления всех резервных копий на SQL Управляемый экземпляр выполните операцию прямую миграцию, инициируя LRS Complete с помощью командлетов: <br />PowerShell [Complete — азсклинстанцедатабаселогреплай](https://docs.microsoft.com/powershell/module/az.sql/complete-azsqlinstancedatabaselogreplay) <br /> Командлеты CLI [az_sql_midb_log_replay_complete](https://docs.microsoft.com/cli/azure/sql/midb/log-replay#az_sql_midb_log_replay_complete) . <br /><br />— Это приведет к остановке службы LRS и включению базы данных в оперативный режим для чтения и записи в Управляемый экземпляр SQL.<br /> -Переведите строку подключения приложения с SQL Server на SQL Управляемый экземпляр. |

## <a name="requirements-for-getting-started"></a>Требования к началу работы

### <a name="sql-server-side"></a>SQL Serverная сторона
- SQL Server 2008-2019
- Полное резервное копирование баз данных (один или несколько файлов)
- Разностная резервная копия (один или несколько файлов)
- Резервная копия журнала (не разбиение для файла журнала транзакций)
- Для резервных копий **должна быть включена контрольная сумма** (обязательная)

### <a name="azure-side"></a>На стороне Azure
- PowerShell AZ. SQL Module версии 2.16.0 или выше ([Установка](https://www.powershellgallery.com/packages/Az.Sql/)или использование Azure [Cloud Shell](https://docs.microsoft.com/azure/cloud-shell/))
- CLI версии 2.19.0 или выше ([Установка](https://docs.microsoft.com/cli/azure/install-azure-cli))
- Контейнер хранилища BLOB-объектов Azure подготовлен
- Маркер безопасности SAS с разрешениями на **Чтение** и только **Список** , созданные для контейнера хранилища BLOB-объектов

### <a name="migrating-multiple-databases"></a>Перенос нескольких баз данных
- Файлы резервных копий для разных баз данных должны размещаться в отдельных папках в хранилище BLOB-объектов Azure.
- LRS необходимо запустить отдельно для каждой базы данных, указывающей на соответствующую папку в хранилище BLOB-объектов Azure.
- LRS может поддерживать до 100 одновременных процессов восстановления на один Управляемый экземпляр SQL.

### <a name="azure-rbac-permissions-required"></a>Требуются разрешения RBAC Azure
Для выполнения LRS с помощью указанных клиентов требуется одна из следующих ролей Azure:
- Роль владельца подписки или
- Роль [участника управляемый экземпляр](../../role-based-access-control/built-in-roles.md#sql-managed-instance-contributor) или
- Пользовательская роль со следующим разрешением:
  - `Microsoft.Sql/managedInstances/databases/*`

## <a name="best-practices"></a>Рекомендации

В качестве рекомендаций настоятельно рекомендуется использовать следующие рекомендации:
- Запустите [Помощник по миграции данных](https://docs.microsoft.com/sql/dma/dma-overview) , чтобы проверить готовность баз данных к миграции в SQL управляемый экземпляр. 
- Разбиение полных и разностных резервных копий на несколько файлов вместо одного файла.
- Включите сжатие резервных копий.
- Используйте Cloud Shell для выполнения скриптов, так как они всегда будут обновлены до выпуска последних версий командлетов.
- Запланируйте Завершение миграции в течение 47 часов с момента запуска службы LRS. Это льготный период, препятствующий запуску программных обновлений, управляемых системой, после запуска LRS.

> [!IMPORTANT]
> - Базу данных, восстанавливаемую с помощью LRS, нельзя использовать до завершения процесса миграции. Это обусловлено тем, что базовая технология восстанавливается в режиме NORECOVERY.
> - Режим РЕЗЕРВного восстановления, допускающий доступ только для чтения к базам данных во время миграции, не поддерживается LRS из-за различий в версиях SQL Управляемый экземпляр и на серверах SQL Server на рынке.
> - После завершения миграции с помощью автозаполнения или вручную прямую миграцию процесс миграции завершается, так как LRS не поддерживает восстановление после возобновления.

## <a name="steps-to-execute"></a>Шаги для выполнения

### <a name="make-backups-on-the-sql-server"></a>Создание резервных копий на SQL Server

Резервные копии на SQL Server можно создать одним из следующих двух вариантов:

- Выполните резервное копирование в хранилище локального диска, а затем отправьте файлы в хранилище BLOB-объектов Azure, если ваша среда является ограниченным режимом прямой архивации в хранилище больших двоичных объектов Azure.
- Резервное копирование непосредственно в хранилище BLOB-объектов Azure с параметром "TO URL" в T-SQL, если среда и процедуры безопасности позволяют это сделать. 

Настройте базы данных, которые требуется перенести в режим полного восстановления, чтобы разрешить резервное копирование журналов.

```SQL
-- To permit log backups, before the full database backup, modify the database to use the full recovery model.
USE master
ALTER DATABASE SampleDB
SET RECOVERY FULL
GO
```

Чтобы вручную создать полную резервную копию базы данных в локальном хранилище, используйте приведенные ниже примеры сценариев T-SQL. Убедитесь, что параметр CHECKSUM включен, так как это обязательное требование для LRS.

```SQL
-- Example on how to make full database backup to the local disk
BACKUP DATABASE [SampleDB]
TO DISK='C:\BACKUP\SampleDB_full_14_43.bak',
WITH INIT, COMPRESSION, CHECKSUM
GO

-- Example on how to make differential database backup to the locak disk
BACKUP DATABASE [SampleDB]
TO DISK='C:\BACKUP\SampleDB_diff_14_44.bak',
WITH DIFFERENTIAL, COMPRESSION, CHECKSUM
GO

-- Example on how to make the log backup
BACKUP LOG [SampleDB]
TO DISK='C:\BACKUP\SampleDB_log_14_45.bak',
WITH CHECKSUM
GO
```

Файлы, резервные копии которых были заархивированы в локальное хранилище, необходимо отправить в хранилище BLOB-объектов Azure. В том случае, если корпоративная политика разрешает это, альтернативный способ создания резервных копий непосредственно в хранилище BLOB-объектов Azure описан в следующем руководстве: [Использование службы хранилища больших двоичных объектов Azure с SQL Server](https://docs.microsoft.com/sql/relational-databases/tutorial-use-azure-blob-storage-service-with-sql-server-2016#1---create-stored-access-policy-and-shared-access-storage). При использовании этого альтернативного подхода убедитесь, что все резервные копии созданы с включенным параметром CHECKSUM.

### <a name="copy-backups-from-sql-server-to-azure-blob-storage"></a>Копирование резервных копий из SQL Server в хранилище BLOB-объектов Azure

Некоторые из следующих подходов можно использовать для передачи резервных копий в хранилище BLOB-объектов в переносе баз данных в управляемый экземпляр с помощью LRS:
- Использование SQL Server собственного [резервного копирования для работы с URL-адресами](https://docs.microsoft.com/sql/relational-databases/backup-restore/sql-server-backup-to-url) .
- С помощью [Azcopy](https://docs.microsoft.com/azure/storage/common/storage-use-azcopy-v10)или [Обозреватель службы хранилища Azure](https://azure.microsoft.com/en-us/features/storage-explorer) для отправки резервных копий в контейнер больших двоичных объектов.
- Использование Обозреватель службы хранилища в портал Azure.

### <a name="create-azure-blob-and-sas-authentication-token"></a>Создание BLOB-объекта Azure и маркера проверки подлинности SAS

Хранилище BLOB-объектов Azure используется в качестве промежуточного хранилища для файлов резервных копий между SQL Server и SQL Управляемый экземпляр. Чтобы создать контейнер хранилища BLOB-объектов Azure, выполните следующие действия.

1. [создать учетную запись хранения;](https://docs.microsoft.com/azure/storage/common/storage-account-create?tabs=azure-portal)
2. [Создавайте контейнер больших двоичных объектов](https://docs.microsoft.com/azure/storage/blobs/storage-quickstart-blobs-portal) в учетной записи хранения

После создания контейнера больших двоичных объектов создайте маркер проверки подлинности SAS с разрешениями на чтение и перечисление, выполнив следующие действия.

1. Доступ к учетной записи хранения с помощью портал Azure
2. Перейдите к Обозреватель службы хранилища
3. Разверните раздел Контейнеры больших двоичных объектов.
4. Щелкните правой кнопкой мыши контейнер больших двоичных объектов
5. Выберите получить подпись общего доступа
6. Выберите срок действия маркера. Убедитесь, что токен действителен для периода миграции.
    - Обратите внимание, что часовой пояс маркера и Управляемый экземпляр SQL могут быть несогласованными. Убедитесь, что маркер SAS имеет соответствующие сроки, которые необходимо учитывать в часовых поясах. Если это возможно, задайте в качестве часового пояса более раннюю и позднее время планового окна миграции.
8. Убедитесь, что выбраны разрешения только на чтение и на список.
9. Нажмите кнопку "Создать"
10. Скопируйте маркер после вопросительного знака "?" и "назад". Маркер SAS обычно начинается с "SV = 2020-10" в URI для использования в коде.

> [!IMPORTANT]
> - Разрешения для маркера SAS для хранилища BLOB-объектов Azure должны быть прочитаны и перечислены только в списке. В случае любых других разрешений, предоставленных для маркера проверки подлинности SAS, запуск службы LRS завершится ошибкой. Эти требования безопасности предназначены для разработки.
> - Токен должен иметь соответствующую достоверность времени. Убедитесь, что часовой пояс между маркером и управляемым экземпляром учитывается.
> - Убедитесь, что токен скопирован, начиная с "SV = 2020-10..." до конца строки.

### <a name="log-in-to-azure-and-select-subscription"></a>Войдите в Azure и выберите подписку.

Используйте следующий командлет PowerShell для входа в Azure:

```powershell
Login-AzAccount
```

Выберите подходящую подписку, в которой находится SQL Управляемый экземпляр, с помощью следующего командлета PowerShell:

```powershell
Select-AzSubscription -SubscriptionId <subscription ID>
```

## <a name="start-the-migration"></a>Начало миграции

Миграция начнется с запуска службы LRS. Службу можно запустить в автозаполнении или непрерывном режиме. При запуске в режиме автозаполнения миграция будет выполнена автоматически, когда был восстановлен последний указанный файл резервной копии. Для этого параметра требуется команда Start, чтобы указать имя файла последнего файла резервной копии. Когда LRS запускается в непрерывном режиме, служба постоянно восстанавливает все добавленные файлы резервных копий, а миграция закончится только в ручном прямую миграцию. 

### <a name="start-lrs-in-autocomplete-mode"></a>Запуск LRS в режиме автозаполнения

Чтобы запустить службу LRS в режиме автозаполнения, используйте следующую команду PowerShell или команды CLI. Укажите имя последнего файла резервной копии с параметром-Ластбаккупнаме. При восстановлении указанного имени файла последней резервной копии служба автоматически инициирует прямую миграцию.

Запуск LRS в режиме автозаполнения с примером PowerShell:

```PowerShell
Start-AzSqlInstanceDatabaseLogReplay -ResourceGroupName "ResourceGroup01" `
    -InstanceName "ManagedInstance01" `
    -Name "ManagedDatabaseName" `
    -Collation "SQL_Latin1_General_CP1_CI_AS" `
    -StorageContainerUri "https://test.blob.core.windows.net/testing" `
    -StorageContainerSasToken "sv=2019-02-02&ss=b&srt=sco&sp=rl&se=2023-12-02T00:09:14Z&st=2019-11-25T16:09:14Z&spr=https&sig=92kAe4QYmXaht%2Fgjocqwerqwer41s%3D" `
    -AutoCompleteRestore `
    -LastBackupName "last_backup.bak"
```

Запуск LRS в режиме автозаполнения — пример CLI:

```CLI
az sql midb log-replay start -g mygroup --mi myinstance -n mymanageddb -a --last-bn "backup.bak"
    --storage-uri "https://test.blob.core.windows.net/testing"
    --storage-sas "sv=2019-02-02&ss=b&srt=sco&sp=rl&se=2023-12-02T00:09:14Z&st=2019-11-25T16:09:14Z&spr=https&sig=92kAe4QYmXaht%2Fgjocqwerqwer41s%3D"
```

### <a name="start-lrs-in-continuous-mode"></a>Запуск LRS в непрерывном режиме

Запуск LRS в непрерывном режиме — пример PowerShell:

```PowerShell
Start-AzSqlInstanceDatabaseLogReplay -ResourceGroupName "ResourceGroup01" `
    -InstanceName "ManagedInstance01" `
    -Name "ManagedDatabaseName" `
    -Collation "SQL_Latin1_General_CP1_CI_AS" -StorageContainerUri "https://test.blob.core.windows.net/testing" `
    -StorageContainerSasToken "sv=2019-02-02&ss=b&srt=sco&sp=rl&se=2023-12-02T00:09:14Z&st=2019-11-25T16:09:14Z&spr=https&sig=92kAe4QYmXaht%2Fgjocqwerqwer41s%3D"
```

Запуск LRS в непрерывном режиме — пример CLI:

```CLI
az sql midb log-replay start -g mygroup --mi myinstance -n mymanageddb
    --storage-uri "https://test.blob.core.windows.net/testing"
    --storage-sas "sv=2019-02-02&ss=b&srt=sco&sp=rl&se=2023-12-02T00:09:14Z&st=2019-11-25T16:09:14Z&spr=https&sig=92kAe4QYmXaht%2Fgjocqwerqwer41s%3D"
```

> [!IMPORTANT]
> После запуска LRS все системные исправления, управляемые системой, будут остановлены в течение следующих 47 часов. После передачи этого окна следующее автоматическое обновление программного обеспечения автоматически останавливает текущую LRS. В таком случае миграцию невозможно возобновить, и ее необходимо перезапустить с нуля. 

## <a name="monitor-the-migration-progress"></a>Мониторинг хода выполнения миграции

Чтобы отслеживать ход выполнения операции миграции, используйте следующую команду PowerShell:

```PowerShell
Get-AzSqlInstanceDatabaseLogReplay -ResourceGroupName "ResourceGroup01" `
    -InstanceName "ManagedInstance01" `
    -Name "ManagedDatabaseName"
```

Чтобы отслеживать ход выполнения операции миграции, используйте следующую команду CLI:

```CLI
az sql midb log-replay show -g mygroup --mi myinstance -n mymanageddb
```

## <a name="stop-the-migration"></a>Завершение миграции

Если необходимо отключить миграцию, используйте следующие командлеты. Остановка миграции приведет к удалению базы данных, восстановленной на Управляемый экземпляр SQL, из-за чего возобновление миграции будет невозможно.

Чтобы стоп\аборт процесс миграции, используйте следующую команду PowerShell:

```PowerShell
Stop-AzSqlInstanceDatabaseLogReplay -ResourceGroupName "ResourceGroup01" `
    -InstanceName "ManagedInstance01" `
    -Name "ManagedDatabaseName"
```

Чтобы стоп\аборт процесс миграции, используйте следующую команду интерфейса командной строки:

```CLI
az sql midb log-replay stop -g mygroup --mi myinstance -n mymanageddb
```

## <a name="complete-the-migration-continuous-mode"></a>Завершение миграции (непрерывный режим)

Если LRS запускается в непрерывном режиме, то после того, как вы убедитесь, что все резервные копии восстановлены, инициализация прямую миграцию завершит миграцию. После завершения прямую миграцию база данных будет перенесена и готова к доступу на чтение и запись.

Чтобы завершить процесс миграции в непрерывном режиме LRS, используйте следующую команду PowerShell:

```PowerShell
Complete-AzSqlInstanceDatabaseLogReplay -ResourceGroupName "ResourceGroup01" `
-InstanceName "ManagedInstance01" `
-Name "ManagedDatabaseName" `
-LastBackupName "last_backup.bak"
```

Чтобы завершить процесс миграции в непрерывном режиме LRS, используйте следующую команду интерфейса командной строки:

```CLI
az sql midb log-replay complete -g mygroup --mi myinstance -n mymanageddb --last-backup-name "backup.bak"
```

## <a name="troubleshooting"></a>Устранение неполадок

После запуска LRS используйте командлеты мониторинга (Get-азсклинстанцедатабаселогреплай или az_sql_midb_log_replay_show), чтобы просмотреть состояние операции. Если после некоторого времени LRS не сможет начаться с ошибкой, проверьте некоторые из наиболее распространенных проблем.
- Была ли резервная копия базы данных на SQL Server, сделанная с помощью параметра **CHECKSUM** ?
- Доступны ли разрешения на **Чтение** МАРКЕРа SAS в **списке** только для службы LRS?
- Был ли маркер SAS для LRS, скопированный после вопросительного знака "?", с содержимым, начинающимся примерно так: "SV = 2020-02-10..."? 
- Допустимо ли время **действия маркера** SAS для временного интервала запуска и завершения миграции? Обратите внимание, что могут воздержаться несоответствия из-за различных **часовых поясов** , используемых для управляемый экземпляр SQL и маркера SAS. Попробуйте повторно создать маркер SAS с расширением срока действия маркера временного окна до и после текущей даты.
- Правильно ли написано имя базы данных, имя группы ресурсов и имя управляемого экземпляра?
- Если LRS был запущен в режиме автозаполнения, было ли указано допустимое имя для последнего файла резервной копии?

## <a name="next-steps"></a>Дальнейшие действия
- Дополнительные сведения о [миграции SQL Server в управляемый экземпляр SQL](../migration-guides/managed-instance/sql-server-to-managed-instance-guide.md).
- Дополнительные сведения о [различиях между SQL Server и управляемый экземпляр SQL Azure](transact-sql-tsql-differences-sql-server.md).
- Узнайте больше о [рекомендациях по затратам и размеру рабочих нагрузок, перенесенных в Azure](https://docs.microsoft.com/azure/cloud-adoption-framework/migrate/azure-best-practices/migrate-best-practices-costs).
