---
title: Ограничения ресурсов
titleSuffix: Azure SQL Managed Instance
description: В этой статье приводятся общие сведения об ограничениях ресурсов для Управляемый экземпляр Azure SQL.
services: sql-database
ms.service: sql-managed-instance
ms.subservice: operations
ms.custom: ''
ms.devlang: ''
ms.topic: reference
author: bonova
ms.author: bonova
ms.reviewer: sstein, jovanpop, sachinp
ms.date: 09/14/2020
ms.openlocfilehash: ee0c673027892e6d3ee55b6ec5f67a30d88be683
ms.sourcegitcommit: f611b3f57027a21f7b229edf8a5b4f4c75f76331
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/22/2021
ms.locfileid: "104780350"
---
# <a name="overview-of-azure-sql-managed-instance-resource-limits"></a>Общие сведения об ограничениях ресурсов Управляемого экземпляра SQL Azure
[!INCLUDE[appliesto-sqlmi](../includes/appliesto-sqlmi.md)]

В этой статье приводятся общие сведения о технических характеристиках и ограничениях ресурсов для Управляемый экземпляр Azure SQL, а также сведения о том, как запросить увеличение этих ограничений.

> [!NOTE]
> Различия в поддерживаемых функциях и инструкциях T-SQL см. в статьях [Сравнение функций Базы данных SQL Azure и SQL Server](../database/features-comparison.md) и [Различия T-SQL между Управляемым экземпляром Базы данных SQL Azure и SQL Server](transact-sql-tsql-differences-sql-server.md). Общие различия между уровнями служб для базы данных SQL Azure и SQL Управляемый экземпляр см. в статье [Сравнение уровней служб](../database/service-tiers-general-purpose-business-critical.md#service-tier-comparison).

## <a name="hardware-generation-characteristics"></a>Характеристики поколения оборудования

SQL Управляемый экземпляр имеет ограничения характеристик и ресурсов, зависящие от базовой инфраструктуры и архитектуры. SQL Управляемый экземпляр можно развернуть в двух поколениях оборудования: го поколения и го поколения. Поколения оборудования имеют различные характеристики, как описано в следующей таблице.

|   | **4-е поколение** | **5-го поколения** |
| --- | --- | --- |
| **Оборудование** | Процессоры Intel® с частотой 3 – 2673 v3 (Haswell) 2,4 ГГц, подключенный SSD Виртуальное ядро = 1 PP (физическое ядро) | Intel® 2673 V4 (Broadwell) 2,3 ГГц, Intel® SP-8160 (Skylake) и Intel® 8272CL (Cascade Lake) с частотой 2,5 ГГц, быстрый SSD NVMe, виртуальное ядро = 1 LP (Hyper-Thread) |
| **Число виртуальных ядер** | 8, 16, 24 виртуальных ядер | 4, 8, 16, 24, 32, 40, 64, 80 виртуальных ядер |
| **Максимальный объем памяти (соотношение памяти и ядра)** | 7 ГБ на виртуальное ядро<br/>Добавьте дополнительные виртуальных ядер, чтобы получить больше памяти. | 5,1 ГБ на виртуальное ядро<br/>Добавьте дополнительные виртуальных ядер, чтобы получить больше памяти. |
| **Максимальная память In-Memory OLTP** | Ограничение экземпляра: 1 – 1,5 ГБ на виртуальное ядро| Ограничение экземпляров: 0,8-1,65 ГБ на виртуальное ядро |
| **Максимальное зарезервированное хранилище экземпляра** |  Общего назначения: 8 ТБ<br/>Критически важный для бизнеса: 1 ТБ | Общего назначения: 8 ТБ<br/> Критически важный для бизнеса 1 ТБ, 2 ТБ или 4 ТБ в зависимости от числа ядер |

> [!IMPORTANT]
> - Го поколенияное оборудование находится в стадии развертывания и больше не доступно для новых развертываний. Все новые экземпляры SQL Управляемый экземпляр должны быть развернуты на оборудовании го поколения.
> - Попробуйте [переместить экземпляр SQL управляемый экземпляр на оборудование поколения 5](../database/service-tiers-vcore.md) , чтобы получить более широкий спектр Виртуальное ядро и масштабируемости хранилища, ускоренную сеть, лучшую производительность операций ввода-вывода и минимальную задержку.

### <a name="in-memory-oltp-available-space"></a>Доступное пространство выполняющейся в памяти OLTP 

Объем пространства выполняющейся в памяти OLTP на уровне служб [критически важный для бизнеса](../database/service-tier-business-critical.md) зависит от числа виртуальных ядер и создания оборудования. В следующей таблице перечислены ограничения памяти, которые могут использоваться для объектов OLTP в памяти.

| Пространство выполняющейся в памяти OLTP  | **5-го поколения** | **4-е поколение** |
| --- | --- | --- |
| 4 виртуальных ядра  | 3,14 ГБ | |   
| 8 виртуальных ядер  | 6,28 ГБ | 8 ГБ |
| 16 виртуальных ядер | 15,77 ГБ | 20 ГБ |
| 24 виртуальных ядер | 25,25 ГБ | 36 ГБ |
| 32 виртуальных ядер | 37,94 ГБ | |
| 40 виртуальных ядер | 52,23 ГБ | |
| 64 виртуальных ядер | 99,9 ГБ    | |
| 80 виртуальных ядер | 131,68 ГБ| |

## <a name="service-tier-characteristics"></a>Характеристики уровней служб

SQL Управляемый экземпляр имеет два уровня служб: [общего назначения](../database/service-tier-general-purpose.md) и [критически важный для бизнеса](../database/service-tier-business-critical.md). Эти уровни предоставляют [различные возможности](../database/service-tiers-general-purpose-business-critical.md), как описано в таблице ниже.

> [!Important]
> Критически важный для бизнеса уровня службы предоставляет дополнительную встроенную копию Управляемый экземпляр SQL (вторичную реплику), которую можно использовать для рабочей нагрузки только для чтения. Если вы можете разделить запросы на чтение и запись, а также запросы только для чтения/аналитических отчетов, вы получаете дважды виртуальных ядер и память для одной цены. Вторичная реплика может отставать от основного экземпляра до нескольких секунд, поэтому она предназначена для разгрузки рабочих нагрузок отчетов и аналитики, которые не требуют точного текущего состояния данных. В приведенной ниже таблице **запросы только для чтения** — это запросы, выполняемые на вторичной реплике.

| **Компонент** | **Общего назначения** | **Уровень "Критически важный для бизнеса"** |
| --- | --- | --- |
| Количество виртуальных ядер\* | 4-е поколение: 8, 16, 24<br/>Го поколения: 4, 8, 16, 24, 32, 40, 64, 80 | 4-е поколение: 8, 16, 24 <br/> Го поколения: 4, 8, 16, 24, 32, 40, 64, 80 <br/>\*Одинаковое число виртуальных ядер выделяется для запросов только для чтения. |
| Максимальный объем памяти | Го поколения: 56 ГБ — 168 ГБ (7 ГБ/Виртуальное ядро)<br/>Го поколения: 20,4 ГБ — 408 ГБ (5.1 ГБ/Виртуальное ядро)<br/>Добавьте дополнительные виртуальных ядер, чтобы получить больше памяти. | Го поколения: 56 ГБ — 168 ГБ (7 ГБ/Виртуальное ядро)<br/>Го поколения: 20,4 ГБ-408 ГБ (5.1 ГБ/Виртуальное ядро) для запросов на чтение и запись<br/>+ дополнительно 20,4 ГБ — 408 ГБ (5.1 ГБ/Виртуальное ядро) для запросов только для чтения.<br/>Добавьте дополнительные виртуальных ядер, чтобы получить больше памяти. |
| Максимальный размер хранилища экземпляра (зарезервировано) | -2 ТБ для 4 виртуальных ядер (только го поколения)<br/>-8 ТБ для других размеров | Го поколения: 1 ТБ <br/> 5-е поколение: <br/>-1 ТБ для 4, 8, 16 виртуальных ядер<br/>— 2 ТБ для 24 виртуальных ядер<br/>— 4 ТБ для 32, 40, 64, 80 виртуальных ядер |
| Максимальный размер базы данных | До текущего размера экземпляра (максимум 2 ТБ – 8 ТБ в зависимости от числа виртуальных ядер). | До текущего размера экземпляра (максимум 1 ТБ – 4 ТБ в зависимости от числа виртуальных ядер). |
| Максимальный размер tempdb | Ограничено 24 ГБ/Виртуальное ядро (96-1 920 ГБ) и доступным размером хранилища экземпляра.<br/>Добавьте дополнительные виртуальных ядер, чтобы получить больше пространства TempDB.<br/> Размер файла журнала ограничен 120 ГБ.| Размер хранилища до текущего доступного экземпляра. |
| Максимальное количество баз данных на экземпляр | 100. пользовательские базы данных, если не достигнут предел размера хранилища экземпляра. | 100. пользовательские базы данных, если не достигнут предел размера хранилища экземпляра. |
| Максимальное число файлов базы данных на экземпляр | До 280, если не достигнут размер хранилища экземпляра или превышено ограничение на [объем выделяемого пространства для хранилища на диске Azure Premium](../database/doc-changes-updates-release-notes.md#exceeding-storage-space-with-small-database-files) . | 32 767 файлов на базу данных, если не достигнут предел размера хранилища экземпляра. |
| Максимальный размер файла данных | Ограниченный текущий доступный размер хранилища экземпляра (не более 2 ТБ-8 ТБ) и [место выделения памяти для хранилища на диске Azure класса Premium](../database/doc-changes-updates-release-notes.md#exceeding-storage-space-with-small-database-files). | Ограниченный текущий доступный размер хранилища экземпляра (до 1 ТБ – 4 ТБ). |
| Максимальный размер файла журнала | Ограничение в 2 ТБ и доступный размер хранилища экземпляров. | Ограничение в 2 ТБ и доступный размер хранилища экземпляров. |
| Операции ввода-вывода в секунду для данных или журнала (приблизительно) | До 30-40 КБ в секунду на экземпляр *, 500-7500 на каждый файл<br/>\*[Увеличение размера файла для получения дополнительных операций ввода-вывода](#file-io-characteristics-in-general-purpose-tier)| 16 k – 320 КБ (4000 операций ввода/Виртуальное ядро)<br/>Добавьте дополнительные виртуальных ядер, чтобы получить лучшую производительность ввода-вывода. |
| Ограничение пропускной способности записи в журнал (на экземпляр) | 3 МБ/с на виртуальное ядро<br/>Максимум 120 МБ/с на экземпляр<br/>22-65 МБ/с на базу данных<br/>\*[Увеличьте размер файла, чтобы получить лучшую производительность ввода-вывода](#file-io-characteristics-in-general-purpose-tier) | 4 МБ/с на виртуальное ядро<br/>Макс. 96 МБ/с |
| Пропускная способность данных (приблизительно) | 100–250 МБ/с на каждый файл<br/>\*[Увеличьте размер файла, чтобы получить лучшую производительность ввода-вывода](#file-io-characteristics-in-general-purpose-tier) | Не ограничено. |
| Задержка операций ввода-вывода хранилища (приблизительно) | 5–10 мс | 1–2 мс |
| Выполняющаяся в памяти OLTP | Не поддерживается | Доступно, [размер зависит от числа Виртуальное ядро](#in-memory-oltp-available-space) |
| Максимальное число сеансов | 30 000 | 30 000 |
| Максимальное количество одновременных рабочих ролей (запросов) | 4-е поколение: 210 * количество виртуальных ядер + 800<br>5-е поколение: 105 * количество виртуальных ядер + 800 | 4-е поколение: 210 * число виртуальных ядер + 800<br>5-е поколение: 105 * число виртуальных ядер + 800 |
| [Реплики только для чтения](../database/read-scale-out.md) | 0 | 1 (входит в цену) |
| Изоляция вычислений | Го поколения не поддерживается, так как экземпляры общего назначения могут использовать физическое оборудование совместно с другими экземплярами<br/>Го поколения не поддерживается из-за нерекомендуемого срока|5-е поколение:<br/>— поддерживается для 40, 64, 80 виртуальных ядер<br/>-не поддерживается для других размеров<br/><br/>Го поколения не поддерживается из-за нерекомендуемого срока|


Некоторые дополнительные соображения. 

- **Текущий доступный размер хранилища экземпляра** — это разница между зарезервированным размером экземпляра и используемым дисковым пространством.
- Размер данных и файлов журнала в пользовательских и системных базах данных включается в размер хранилища экземпляра, который сравнивается с максимальным пределом максимального размера хранилища. Используйте [sys.master_files](/sql/relational-databases/system-catalog-views/sys-master-files-transact-sql) системное представление, чтобы определить общее используемое пространство по базам данных. Журналы ошибок не сохраняются и не включаются в размер. Резервные копии не включаются в размер хранилища.
- Пропускная способность и операции ввода-вывода на уровне общего назначения также зависят от [размера файла](#file-io-characteristics-in-general-purpose-tier) , который явно не ограничен управляемый экземпляром SQL.
  Вы можете создать другую доступную для чтения реплику в другом регионе Azure с помощью [групп автоматической отработки отказа](../database/auto-failover-group-configure.md) .
- Максимальное число операций ввода-вывода для экземпляра зависит от структуры файла и распределения рабочей нагрузки. Например, если вы создадите 7-1 ТБ файлов с максимальным количеством операций ввода-вывода в секунду и 7 маленьких файлов (менее 128 ГБ) с 500 операций ввода-вывода в секунду, можно получить 38500 операций ввода-вывода в секунду на экземпляр (7x5000 + 7x500), если Рабочая нагрузка может использовать все файлы. Обратите внимание, что для автоматического резервного копирования также используются некоторые операции ввода-вывода.

Дополнительные сведения об [ограничениях ресурсов в пулах управляемый экземпляр SQL см. в этой статье](instance-pools-overview.md#resource-limitations).

### <a name="file-io-characteristics-in-general-purpose-tier"></a>Характеристики ввода-вывода файла на уровне общего назначения

На уровне служб общего назначения каждый файл базы данных получает выделенные операции ввода-вывода и пропускную способность, зависящие от размера файла. Большие файлы получают больше операций ввода-вывода в секунду и пропускной способности. Характеристики ввода-вывода файлов базы данных показаны в следующей таблице:

| Размер файла | >= 0 и <= 128 гиб | >128 и <= 512 гиб | >0,5 и <= 1 тиб    | >1 и <= 2 тиб    | >2 и <= 4 тиб | >4 и <= 8 тиб |
|---------------------|-------|-------|-------|-------|-------|-------|-------|
| Операций ввода-вывода на файл       | 500   | 2300              | 5000              | 7500              | 7500              | 12 500   |
| Пропускная способность на файл | 100 МиБ/с | 150 МиБ/с | 200 МиБ/с | 250 МиБ/с | 250 МиБ/с | 480 MiB/с | 

Если вы заметили высокую задержку ввода-вывода для какого-либо файла базы данных или видите, что достигнут предел в операциях ввода/вывода, производительность может повыситься путем [увеличения размера файла](https://techcommunity.microsoft.com/t5/Azure-SQL-Database/Increase-data-file-size-to-improve-HammerDB-workload-performance/ba-p/823337).

Кроме того, существует ограничение на уровень экземпляра при максимальной пропускной способности записи в журнал (см. выше для значений, например 22 Мб/с), поэтому вы не сможете достичь максимального размера файла в файле журнала, так как вы достигли предельной пропускной способности экземпляра.

## <a name="supported-regions"></a>Поддерживаемые регионы

Управляемый экземпляр SQL можно создавать только в [поддерживаемых регионах](https://azure.microsoft.com/global-infrastructure/services/?products=sql-database&regions=all). Чтобы создать Управляемый экземпляр SQL в регионе, который в настоящее время не поддерживается, можно [Отправить запрос в службу поддержки через портал Azure](../database/quota-increase-request.md).

## <a name="supported-subscription-types"></a>Поддерживаемые типы подписок

SQL Управляемый экземпляр в настоящее время поддерживает развертывание только для следующих типов подписок:

- [Соглашение Enterprise (EA)](https://azure.microsoft.com/pricing/enterprise-agreement/)
- [Оплата по мере использования](https://azure.microsoft.com/offers/ms-azr-0003p/)
- [Поставщик облачных служб (CSP)](/partner-center/csp-documents-and-learning-resources)
- [Enterprise — разработка и тестирование](https://azure.microsoft.com/offers/ms-azr-0148p/)
- [Разработка и тестирование с оплатой по мере использования](https://azure.microsoft.com/offers/ms-azr-0023p/)
- [Подписки с ежемесячным кредитом Azure для подписчиков Visual Studio](https://azure.microsoft.com/pricing/member-offers/credit-for-visual-studio-subscribers/)

## <a name="regional-resource-limitations"></a>Ограничение подписок по регионам

> [!Note]
> Чтобы получить актуальные сведения о доступности регионов для подписок, сначала установите флажок [Выбрать регион](https://aka.ms/sqlcapacity).

Поддерживаемые типы подписок могут содержать ограниченное число ресурсов на регион. SQL Управляемый экземпляр имеет два ограничения по умолчанию для каждого региона Azure (которые можно увеличить по запросу, создав специальный [запрос на поддержку в портал Azure](../database/quota-increase-request.md) в зависимости от типа подписки:

- **Ограничение подсети**. Максимальное число подсетей, в которых экземпляры SQL управляемый экземпляр развертываются в одном регионе.
- **ограничение единицы Виртуальное ядро**: максимальное число единиц Виртуальное ядро, которые могут быть развернуты во всех экземплярах в одном регионе. Одна из Виртуальное ядро групповой политики использует одну единицу Виртуальное ядро, а один BC Виртуальное ядро — 4 Виртуальное ядро единиц. Общее число экземпляров не ограничено, если оно находится в пределах ограничения единицы Виртуальное ядро.

> [!Note]
> Эти ограничения являются параметрами по умолчанию, а не техническими ограничениями. Ограничения можно увеличить по запросу, создав специальный [запрос на поддержку в портал Azure](../database/quota-increase-request.md) , если требуется больше экземпляров в текущем регионе. В качестве альтернативы можно создать новые экземпляры SQL Управляемый экземпляр в другом регионе Azure, не отправляя запросы на поддержку.

В следующей таблице показаны **региональные ограничения по умолчанию** для поддерживаемых типов подписки (ограничения по умолчанию можно расширить с помощью запроса на поддержку, описанного ниже).

|Тип подписки| Максимальное число подсетей Управляемый экземпляр SQL | Максимальное число единиц Виртуальное ядро * |
| :---| :--- | :--- |
|Оплата по мере использования|3|320|
|Поставщик служб шифрования |8 (15 в некоторых регионах * *)|960 (1440 в некоторых регионах * *)|
|Разработка и тестирование с оплатой по мере использования|3|320|
|Enterprise — разработка и тестирование|3|320|
|EA|8 (15 в некоторых регионах * *)|960 (1440 в некоторых регионах * *)|
|Visual Studio Enterprise|2 |64|
|Visual Studio Professional и MSDN Platforms|2|32|

\* При планировании развертываний примите во внимание, что для уровня служб критически важный для бизнеса (BC) требуется четыре (4) раза больше емкости, чем уровень служб общего назначения (GP). Например: 1 GP Виртуальное ядро = 1 Виртуальное ядро Unit и 1 BC Виртуальное ядро = 4 Виртуальное ядро. Чтобы упростить анализ потребления с учетом ограничений по умолчанию, суммируйте единицы Виртуальное ядро во всех подсетях в регионе, где развернут SQL Управляемый экземпляр, и сравните результаты с ограничениями единиц экземпляра для вашего типа подписки. Ограничение **максимального числа единиц Виртуальное ядро** применяется к каждой подписке в регионе. Ограничения на отдельные подсети отсутствуют, за исключением того, что сумма всех виртуальных ядер, развернутых в нескольких подсетях, должна быть меньше или равна **максимальному числу единиц Виртуальное ядро**.

\*\* Более крупные ограничения подсети и виртуальное ядро доступны в следующих регионах: Восточная Австралия, восток США, Восточная часть США 2, Северная Европа, Юго-Центральный регион США, Юго-Восточная Азия, южная часть Соединенного Королевства, Западная Европа, Западная часть США 2.

> [!IMPORTANT]
> Если размер Виртуальное ядро и подсети равен 0, это означает, что региональные ограничения по умолчанию для вашего типа подписки не заданы. Вы также можете использовать запрос на увеличение квоты для получения доступа к подписке в определенном регионе, следуя той же процедуре, предоставляя необходимые значения Виртуальное ядро и подсети.

## <a name="request-a-quota-increase"></a>Запрос на увеличение квоты

Если в текущих регионах требуется больше экземпляров, отправьте запрос в службу поддержки, чтобы расширить квоту с помощью портал Azure. Дополнительные сведения см. в статье [запрос увеличения квоты для базы данных SQL Azure](../database/quota-increase-request.md).

## <a name="next-steps"></a>Следующие шаги

- Дополнительные сведения о SQL Управляемый экземпляр см. [в разделе что такое управляемый экземпляр SQL?](sql-managed-instance-paas-overview.md).
- Сведения о ценах см. на странице [цен на SQL управляемый экземпляр](https://azure.microsoft.com/pricing/details/sql-database/managed/).
- Сведения о создании первого Управляемый экземпляр SQL см. [в руководстве по быстрому](instance-create-quickstart.md)запуску.
