---
title: Миграция из SQL Server в Azure SQL Управляемый экземпляр
description: Узнайте, как перенести базу данных из SQL Server в Управляемый экземпляр SQL Azure.
services: sql-database
ms.service: sql-managed-instance
ms.subservice: migration
ms.custom: seo-lt-2019, sqldbrb=1
ms.devlang: ''
ms.topic: conceptual
author: bonova
ms.author: bonova
ms.reviewer: ''
ms.date: 07/11/2019
ms.openlocfilehash: df0a28c4d2ba78e9b7a6b52e26537540164d28e0
ms.sourcegitcommit: f0a3ee8ff77ee89f83b69bc30cb87caa80f1e724
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/26/2021
ms.locfileid: "105564319"
---
# <a name="sql-server-instance-migration-to-azure-sql-managed-instance"></a>Миграция экземпляра SQL Server в Azure SQL Управляемый экземпляр
[!INCLUDE[appliesto-sqlmi](../includes/appliesto-sqlmi.md)]

В этой статье вы узнаете о методах переноса экземпляра SQL Server 2005 или более поздней версии в [управляемый экземпляр SQL Azure](sql-managed-instance-paas-overview.md). Сведения о миграции в отдельную базу данных или эластичный пул см. [в разделе Обзор миграции: SQL Server в базу данных SQL](../migration-guides/database/sql-server-to-sql-database-overview.md). Сведения о миграции с других платформ и рекомендации по средствам и вариантам см. в статье [Миграция в Azure SQL](../migration-guides/index.yml).

> [!NOTE]
> Если вы хотите быстро начать работу с Azure SQL Управляемый экземпляр, вместо этой страницы можно перейти к [руководству](quickstart-content-reference-guide.md) по быстрому запуску.

В общем процесс переноса базы данных выглядит примерно так:

![Процесс миграции](./media/migrate-to-instance-from-sql-server/migration-process.png)

- [Оцените совместимость SQL управляемый экземпляр](#assess-sql-managed-instance-compatibility) , где следует убедиться в отсутствии блокирующих проблем, которые могут препятствовать миграции.
  
  Этот шаг также включает создание [базовых показателей производительности](#create-a-performance-baseline) для определения использования ресурсов на исходном экземпляре SQL Server. Этот шаг необходим, если требуется развернуть управляемый экземпляр с правильным размером и проверить, не влияет ли производительность после миграции.
- [Выберите параметры подключения приложений](connect-application-instance.md).
- Выполните [развертывание в управляемом экземпляре с оптимальным размером](#deploy-to-an-optimally-sized-managed-instance) , где вы будете выбирать технические характеристики (количество виртуальных ядер, объем памяти) и уровень производительности (критически важный для бизнеса, общего назначения) управляемого экземпляра.
- [Выберите метод миграции и выполните миграцию](#select-a-migration-method-and-migrate) для переноса баз данных с помощью автономной миграции (собственная архивация, восстановление, импорт и экспорт базы данных) или оперативной миграции (служба миграции данных Azure, репликация транзакций).
- [Мониторинг приложений](#monitor-applications) для обеспечения ожидаемой производительности.

> [!NOTE]
> Сведения о переносе отдельной базы данных в отдельную базу данных или эластичный пул см. в статье [Перенос базы данных SQL Server в базу данных SQL Azure](../database/migrate-to-database-from-sql-server.md).

## <a name="assess-sql-managed-instance-compatibility"></a>Оценка совместимости SQL Управляемый экземпляр

Сначала определите, совместима ли Управляемый экземпляр SQL с требованиями приложения к базе данных. SQL Управляемый экземпляр обеспечивает простое перемещение и миграцию для большинства существующих приложений, использующих SQL Server. Однако иногда могут потребоваться функции или возможности, которые еще не поддерживаются, а затраты на реализацию решения слишком высоки.

Используйте [Помощник по миграции данных](/sql/dma/dma-overview) для обнаружения потенциальных проблем совместимости, влияющих на функциональность базы данных в базе данных SQL Azure. Если обнаружены проблемы с блокировкой, может потребоваться рассмотреть альтернативный вариант, например [SQL Server на виртуальной машине Azure](https://azure.microsoft.com/services/virtual-machines/sql-server/). Ниже приводится несколько примеров.

- Если требуется прямой доступ к операционной системе или файловой системе, например для установки сторонних или пользовательских агентов на той же виртуальной машине с SQL Server.
- При наличии достаточной зависимости от компонентов, которые по-прежнему не поддерживаются, таких как FileStream/FileTable, Polybase и транзакции между экземплярами.
- Если вам абсолютно нужно остаться в определенной версии SQL Server (например, 2012).
- Если требования к вычислительной мощности значительно ниже, чем предложения управляемого экземпляра (один Виртуальное ядро, например), и консолидация базы данных не является приемлемым вариантом.

Если вы разрешили все идентифицированные блокирующие миграцию и продолжите миграцию на SQL Управляемый экземпляр, обратите внимание, что некоторые изменения могут повлиять на производительность рабочей нагрузки:

- Обязательная модель полного восстановления и регулярное автоматическое расписание архивации могут повлиять на производительность рабочей нагрузки или действий по обслуживанию и ETL, если вы периодически использовали модель простого или неполного протоколирования или остановили резервное копирование по запросу.
- Различные конфигурации уровня сервера или базы данных, такие как флаги трассировки или уровни совместимости.
- Новые функции, которые вы используете, например прозрачное шифрование базы данных (TDE) или группы автоматической отработки отказа, могут влиять на использование ЦП и операций ввода-вывода.

SQL Управляемый экземпляр гарантирует доступность 99,99% даже в критических сценариях, поэтому издержки, вызванные этими функциями, нельзя отключить. Дополнительные сведения см. в описании [основных причин, которые могут привести к различным показателям производительности SQL Server и Azure SQL управляемый экземпляр](https://azure.microsoft.com/blog/key-causes-of-performance-differences-between-sql-managed-instance-and-sql-server/).

#### <a name="in-memory-oltp-memory-optimized-tables"></a>In-Memory OLTP (оптимизированные для памяти таблицы)

SQL Server предоставляет возможность In-Memory OLTP, которая позволяет использовать оптимизированные для памяти таблицы, оптимизированные для памяти табличные типы и модули SQL, скомпилированные в собственном режиме, для выполнения рабочих нагрузок с высокой пропускной способностью и низкой задержкой в отношении транзакционной обработки транзакций. 

> [!IMPORTANT]
> In-Memory OLTP поддерживается только на уровне критически важный для бизнеса в Управляемый экземпляр Azure SQL (и не поддерживается на уровне общего назначения).

Если у вас есть оптимизированные для памяти таблицы или типы оптимизированных для памяти таблиц в локальной SQL Server и вы хотите перенести их на Управляемый экземпляр SQL Azure, необходимо выполнить одно из следующих действий.

- Выберите уровень критически важный для бизнеса для целевого Управляемый экземпляр SQL Azure, который поддерживает In-Memory OLTP.
- Если вы хотите перейти на общего назначения уровень в Управляемый экземпляр SQL Azure, удалите оптимизированные для памяти таблицы, оптимизированные для памяти табличные типы и скомпилированные в собственном коде модули SQL, которые взаимодействуют с оптимизированными для памяти объектами перед переносом баз данных. Следующий запрос T-SQL можно использовать для обнаружения всех объектов, которые необходимо удалить перед миграцией на уровень общего назначения:

```tsql
SELECT * FROM sys.tables WHERE is_memory_optimized=1
SELECT * FROM sys.table_types WHERE is_memory_optimized=1
SELECT * FROM sys.sql_modules WHERE uses_native_compilation=1
```

Дополнительные сведения о технологиях в памяти см. в статье [Оптимизация производительности с помощью технологий в памяти в базе данных SQL Azure и Azure sql управляемый экземпляр](../in-memory-oltp-overview.md)

### <a name="create-a-performance-baseline"></a>Создание базового показателя производительности

Если необходимо сравнить производительность рабочей нагрузки на управляемом экземпляре с исходной рабочей нагрузкой, выполняемой на SQL Server, необходимо создать базовый уровень производительности, который будет использоваться для сравнения.

Базовые показатели производительности — это набор параметров, таких как средняя и максимальная загрузка ЦП, средняя скорость операций ввода-вывода на диск, пропускная способность, число операций ввода/вывода в секунду, максимальное ожидаемое время жизни страницы и средний максимальный размер базы данных tempdb. Вы хотели бы иметь аналогичные или даже более лучшие параметры после миграции, поэтому важно измерять и записывать базовые значения для этих параметров. Помимо системных параметров необходимо выбрать набор репрезентативных запросов или наиболее важных запросов в рабочей нагрузке и оценить минимальное/среднее/максимальное значение длительности использования ЦП для выбранных запросов. Эти значения позволяют сравнить производительность рабочей нагрузки, выполняемой на управляемом экземпляре, с исходными значениями в экземпляре источника SQL Server.

Ниже приведены некоторые параметры, которые необходимо измерять в экземпляре SQL Server.

- [Отслеживайте использование ЦП на экземпляре SQL Server](https://techcommunity.microsoft.com/t5/Azure-SQL-Database/Monitor-CPU-usage-on-SQL-Server/ba-p/680777#M131) и записывайте среднюю и пиковую загрузку ЦП.
- [Отслеживайте использование памяти на экземпляре SQL Server](/sql/relational-databases/performance-monitor/monitor-memory-usage) и определите объем памяти, используемый различными компонентами, такими как буферный пул, кэш планов, пул хранилища столбцов, выполняющаяся [в памяти OLTP](/sql/relational-databases/in-memory-oltp/monitor-and-troubleshoot-memory-usage?view=sql-server-2017)и т. д. Кроме того, вы должны найти средние и пиковые значения счетчика производительности "ожидаемая память страницы".
- Мониторинг использования дискового ввода-вывода на экземпляре SQL Server источника с помощью [sys.dm_io_virtual_file_stats](/sql/relational-databases/system-dynamic-management-views/sys-dm-io-virtual-file-stats-transact-sql) представлений или [счетчиков производительности](/sql/relational-databases/performance-monitor/monitor-disk-usage).
- Отслеживайте производительность рабочей нагрузки и запросов или экземпляр SQL Server, проверив динамические административные представления или хранилище запросов при миграции с версии SQL Server 2016 +. Выявление средней длительности и загрузки ЦП наиболее важных запросов в рабочей нагрузке для сравнения с запросами, выполняемыми на управляемом экземпляре.

> [!Note]
> Если вы заметили проблемы с рабочей нагрузкой на SQL Server например, высокая загрузка ЦП, постоянная нехватка памяти, или проблемы с параметризациями, следует попытаться разрешить их в исходном экземпляре SQL Server, прежде чем приступать к базовому плану и миграции. Миграция известных проблем в любую новую систему может привести к непредвиденным результатам и сделает недействительным сравнение производительности.

В результате этого действия вы должны были задокументированы средние и пиковые значения использования ЦП, памяти и операций ввода-вывода в исходной системе, а также среднюю и максимальную продолжительность и использование ЦП главным и наиболее важными запросами в рабочей нагрузке. Эти значения следует использовать позже для сравнения производительности рабочей нагрузки на управляемом экземпляре с базовой производительностью рабочей нагрузки на экземпляре источника SQL Server.

## <a name="deploy-to-an-optimally-sized-managed-instance"></a>Развертывание в управляемый экземпляр оптимального размера

SQL Управляемый экземпляр предназначен для локальных рабочих нагрузок, которые планируется переместить в облако. Он представляет [новую модель приобретения](../database/service-tiers-vcore.md), которая обеспечивает большую гибкость при выборе правильного уровня ресурсов для рабочих нагрузок. В локальной среде вы, вероятно, изменяли размер этих рабочих нагрузок с помощью физических ядер и пропускной способности ввода-вывода. Модель приобретения для управляемого экземпляра основана на виртуальных ядрах, а дополнительное хранилище и операции ввода-вывода доступны отдельно. Модель на основе виртуального ядра — это более простой способ понять требования к вычислению в облаке по сравнению с используемым в локальной среде. Эта новая модель позволяет выбирать оптимальный размер целевой среды в облаке. Ниже приведены некоторые общие рекомендации, которые могут помочь вам выбрать правильный уровень служб и характеристики.

- Исходя из базовых показателей использования ЦП, можно подготавливать управляемый экземпляр, который соответствует количеству ядер, используемых в SQL Server, учитывая, что характеристики ЦП могут быть масштабированы в соответствии с [характеристиками виртуальных машин, где установлен управляемый экземпляр](resource-limits.md#hardware-generation-characteristics).
- В зависимости от базового использования памяти выберите [уровень служб, который соответствует памяти](resource-limits.md#hardware-generation-characteristics). Объем памяти не может быть выбран напрямую, поэтому необходимо выбрать управляемый экземпляр с количеством виртуальных ядер, имеющим соответствующий объем памяти (например, 5,1 ГБ/Виртуальное ядро в го поколения).
- В зависимости от базовой задержки ввода-вывода файловой системы выберите между уровнями служб общего назначения (задержка более 5 мс) и критически важный для бизнеса (задержка менее 3 мс).
- Исходя из базовых пропускной способности, предварительно выделяется размер файлов данных или журналов для получения ожидаемой производительности ввода-вывода.

Во время развертывания можно выбрать ресурсы для вычислений и хранения, а затем изменить их, не вводя время простоя приложения с помощью [портал Azure](../database/scale-resources.md):

![Размер управляемого экземпляра](./media/migrate-to-instance-from-sql-server/managed-instance-sizing.png)

Сведения о создании инфраструктуры виртуальной сети и управляемого экземпляра см. в статье [Краткое руководство. Создание Управляемого экземпляра Базы данных SQL Azure](instance-create-quickstart.md).

> [!IMPORTANT]
> Важно, чтобы Целевая виртуальная сеть и подсети были в соответствии с [требованиями к виртуальной сети для управляемого экземпляра](connectivity-architecture-overview.md#network-requirements). Любая несовместимость может помешать созданию новых экземпляров или использованию созданных. Узнайте подробнее о [создании сетей](virtual-network-subnet-create-arm-template.md) и [настройке имеющихся](vnet-existing-add-subnet.md).

## <a name="select-a-migration-method-and-migrate"></a>Выберите метод миграции и выполните миграцию.

SQL Управляемый экземпляр предназначен для пользовательских сценариев, требующих массового переноса баз данных из локальных или виртуальных машин Azure. Они являются оптимальным выбором, если необходимо выполнить заполнение и сдвиг серверной части приложений, которые регулярно используют функции уровня экземпляра и (или) межбазовых баз данных. В этом случае вы можете переместить весь экземпляр в соответствующую среду в Azure без необходимости изменять архитектуру приложений.

Чтобы переместить экземпляры SQL, необходимо тщательно спланировать следующее:

- Миграция всех баз данных, которые должны быть размещены (которые выполняются в одном экземпляре).
- Миграция объектов уровня экземпляра, от которых зависит приложение, включая имена входа, учетные данные, задания агента SQL Server и триггеры уровня сервера.

SQL Управляемый экземпляр — это управляемая служба, которая позволяет делегировать некоторые обычные действия АДМИНИСТРАТОРу платформы по мере их создания. Поэтому некоторые данные на уровне экземпляра не требуется переносить, например задания обслуживания для регулярного резервного копирования или настройки Always On, так как в ней встроена [Высокая доступность](../database/high-availability-sla.md) .

SQL Управляемый экземпляр поддерживает следующие параметры миграции базы данных (в настоящее время это единственные поддерживаемые методы переноса):

- Azure Database Migration Service-миграция с почти нулевым временем простоя.
- Исходная `RESTORE DATABASE FROM URL` использует исходные резервные копии из SQL Server. Использование этого метода сопряжено с некоторым простоем.

### <a name="azure-database-migration-service"></a>Azure Database Migration Service

[Azure Database Migration Service](../../dms/dms-overview.md) — это полностью управляемая служба, предназначенная для обеспечения бесперебойной миграции с нескольких источников базы данных на платформы данных Azure с минимальным временем простоя. Эта служба упрощает выполнение задач, необходимых для перемещения имеющихся сторонних баз данных и баз данных SQL Server в Azure. Варианты развертывания в общедоступной предварительной версии включают базы данных в базе данных SQL Azure и SQL Server базы данных на виртуальной машине Azure. Database Migration Service является рекомендуемым методом миграции для корпоративных рабочих нагрузок.

Если в локальной SQL Server используется SQL Server Integration Services (SSIS), Database Migration Service еще не поддерживает миграцию каталога служб SSIS (SSISDB), в котором хранятся пакеты служб SSIS, но вы можете подготавливать Azure-SSIS Integration Runtime (IR) в фабрике данных Azure, что создаст новый SSISDB в управляемом экземпляре, чтобы можно было повторно развернуть пакеты на нем. См. статью [создание Azure-SSIS IR в фабрике данных Azure](../../data-factory/create-azure-ssis-integration-runtime.md).

Дополнительные сведения об этом сценарии и действиях по настройке Database Migration Service см. в статье [Перенос локальной базы данных в управляемый экземпляр с помощью Database Migration Service](../../dms/tutorial-sql-server-to-managed-instance.md).  

### <a name="native-restore-from-url"></a>Исходное восстановление из URL-адреса

Восстановление собственных резервных копий (BAK-файлов), взятых из экземпляра SQL Server, доступного в [службе хранилища Azure](https://azure.microsoft.com/services/storage/), является одной из основных возможностей управляемый экземпляр SQL, что обеспечивает быструю и простую миграцию базы данных в автономном режиме.

На следующей схеме представлен общий обзор процесса:

![На схеме показано, SQL Server со стрелкой, обозначенной как резервное копирование и передача на URL-адрес в службу хранилища Azure, и вторая стрелка с меткой восстановление из URL-адреса, передаваемого из службы хранилища Azure в Управляемый экземпляр SQL.](./media/migrate-to-instance-from-sql-server/migration-flow.png)

В следующей таблице представлена дополнительная информация о методах, которые вы можете использовать в зависимости от используемой исходной версии SQL Server.

|Шаг|Ядро и версия SQL|Метод резервного копирования и восстановления|
|---|---|---|
|Помещение резервной копии в службу хранилища Azure|До 2012 SP1 CU2|Передача BAK файла непосредственно в службу хранилища Azure|
||От 2012 SP1 CU2 до 2016|Прямое резервное копирование с использованием устаревшего синтаксиса [WITH CREDENTIAL](/sql/t-sql/statements/restore-statements-transact-sql)|
||2016 и более поздние версии|Прямое резервное копирование с использованием синтаксиса [WITH SAS CREDENTIAL](/sql/relational-databases/backup-restore/sql-server-backup-to-url)|
|Восстановление из хранилища Azure в управляемый экземпляр|[Восстановление на основе URL-адреса с помощью учетных данных SAS](restore-sample-database-quickstart.md)|

> [!IMPORTANT]
>
> - При миграции базы данных, защищенной [прозрачное шифрование данных](../database/transparent-data-encryption-tde-overview.md) , на управляемый экземпляр с помощью собственного параметра восстановления, необходимо выполнить миграцию соответствующего сертификата из локальной виртуальной машины или SQL Server виртуальных машин Azure перед восстановлением базы данных. Пошаговая процедура приведена в статье о [переносе сертификата защищенной TDE базы данных в управляемый экземпляр](tde-certificate-migrate.md).
> - Восстановление системных баз данных не поддерживается. Для миграции объектов уровня экземпляра (хранящихся в базах данных master или msdb) рекомендуется создать скрипты и выполнить скрипты T-SQL в целевом экземпляре.

Сведения о восстановлении резервной копии базы данных в управляемый экземпляр с использованием учетных данных SAS см. в [этой статье](restore-sample-database-quickstart.md).

> [!VIDEO https://www.youtube.com/embed/RxWYojo_Y3Q]

## <a name="monitor-applications"></a>Мониторинг приложений

После завершения миграции на управляемый экземпляр следует отрегулировать поведение приложения и производительность рабочей нагрузки. Этот процесс включает следующие действия.

- [Сравните производительность рабочей нагрузки, выполняемой на управляемом экземпляре](#compare-performance-with-the-baseline) [, с базовым показателем производительности, созданным на экземпляре SQL Server источника](#create-a-performance-baseline).
- Постоянное [Отслеживание производительности рабочей нагрузки](#monitor-performance) для выявления потенциальных проблем и улучшений.

### <a name="compare-performance-with-the-baseline"></a>Сравнение производительности с базовыми показателями

Первое действие, которое необходимо выполнить сразу после успешной миграции, — это сравнение производительности рабочей нагрузки с базовой производительностью рабочей нагрузки. Цель этого действия — убедиться, что производительность рабочей нагрузки управляемого экземпляра соответствует вашим потребностям.

При миграции базы данных на управляемый экземпляр в большинстве случаев сохраняются параметры базы данных и ее исходный уровень совместимости. Исходные параметры сохраняются там, где это возможно, чтобы снизить риск снижения производительности по сравнению с исходным экземпляром SQL Server. Если уровень совместимости пользовательской базы данных до переноса был равен 100 или выше, он остается неизменным после переноса. Если уровень совместимости пользовательской базы данных был 90 до миграции, в обновленной базе данных устанавливается уровень совместимости 100, который является минимально поддерживаемым уровнем совместимости в управляемом экземпляре. Уровень совместимости системных баз данных равен 140. Поскольку миграция на управляемый экземпляр фактически переносится на последнюю версию ядра СУБД SQL Server, следует иметь в виду, что необходимо повторно проверить производительность рабочей нагрузки, чтобы избежать некоторых неудивительных проблем с производительностью.

В качестве необходимого компонента убедитесь, что выполнены следующие действия.

- Выровняйте параметры на управляемом экземпляре с помощью параметров из экземпляра SQL Server источника, изучая различные экземпляры, базы данных, параметры tempdb и конфигурации. Перед запуском первого сравнения производительности убедитесь, что вы не изменили такие параметры, как уровни совместимости или шифрование, или примите риск того, что некоторые из новых включенных функций могут повлиять на некоторые запросы. Чтобы уменьшить риски, связанные с переносом, измените уровень совместимости базы данных только после мониторинга производительности.
- Реализуйте рекомендации по [использованию хранилища для общего назначения](https://techcommunity.microsoft.com), например предварительное выделение размера файлов, чтобы повысить производительность.
- Узнайте о [различиях в среде, которые могут вызвать различия в производительности между управляемым экземпляром и SQL Server](https://azure.microsoft.com/blog/key-causes-of-performance-differences-between-sql-managed-instance-and-sql-server/), а также выявление рисков, которые могут повлиять на производительность.
- Убедитесь, что в управляемом экземпляре включено хранилище запросов и включена автоматическая настройка. Эти функции позволяют измерять производительность рабочей нагрузки и автоматически устраняют потенциальные проблемы с производительностью. Узнайте, как использовать хранилище запросов в качестве оптимального средства для получения сведений о производительности рабочей нагрузки до и после изменения уровня совместимости базы данных, как описано в статье [обеспечение стабильной производительности во время обновления до более новой версии SQL Server](/sql/relational-databases/performance/query-store-usage-scenarios#CEUpgrade).
После подготовки среды, сравнимой по мере возможности с локальной средой, можно приступить к выполнению рабочей нагрузки и измерению производительности. Процесс измерения должен включать те же параметры, которые вы измеряете [при создании базовых показателей производительности рабочей нагрузки в экземпляре SQL Server источника](#create-a-performance-baseline).
В результате следует сравнить параметры производительности с базовыми показателями и выделить критические различия.

> [!NOTE]
> Во многих случаях вы не сможете получить точную согласованность производительности на управляемом экземпляре и SQL Server. Управляемый экземпляр Azure SQL — это SQL Server ядро СУБД, но в конфигурации инфраструктуры и высокой доступности на управляемом экземпляре могут возникнуть некоторые различия. Вы можете ожидать, что некоторые запросы будут выполняться быстрее, а другие могут быть медленнее. Цель сравнения заключается в том, чтобы убедиться, что производительность рабочей нагрузки в управляемом экземпляре соответствует производительности SQL Server (в среднем) и определить критически важные запросы с производительностью, не соответствующей исходной производительности.

Результат сравнения производительности может быть следующим:

- Производительность рабочей нагрузки на управляемом экземпляре выстраивается или повышается по сравнению с производительностью рабочей нагрузки на SQL Server. В этом случае вы успешно подтвердили успешное выполнение миграции.
- Большая часть параметров производительности и запросов в рабочей нагрузке работают нормально, с некоторыми исключениями с низкой производительностью. В этом случае необходимо найти различия и их важность. При наличии важных запросов с пониженной производительностью следует определить, изменились ли базовые планы SQL, или что запросы приводят к некоторым ограничениям ресурсов. В этом случае можно применить некоторые указания по критическим запросам (например, измененный уровень совместимости, механизм оценки количества элементов) либо напрямую, либо с помощью структур планов, перестроение или создание статистики и индексов, которые могут повлиять на планы.
- Большинство запросов выполняются медленнее на управляемом экземпляре по сравнению с исходным экземпляром SQL Server. В этом случае попробуйте найти основные причины разницы, например [достижение некоторого предела ресурсов](resource-limits.md#service-tier-characteristics) , такого как ограничения операций ввода-вывода, ограничение памяти, ограничение частоты обращения к журналу экземпляра и т. д. Если ограничения ресурсов, которые могут вызвать разницу, отсутствуют, попробуйте изменить уровень совместимости базы данных или измените параметры базы данных, такие как устаревшая Оценка кратности, и повторно запустите тест. Ознакомьтесь с рекомендациями, предоставляемыми представлениями управляемого экземпляра или хранилища запросов, чтобы выяснить, какие запросы имеют производительность.

> [!IMPORTANT]
> Управляемый экземпляр Azure SQL имеет встроенную функцию автоматического исправления плана, которая включена по умолчанию. Эта функция гарантирует, что запросы, которые работали в процессе вставки, не будут понижаться в будущем. Убедитесь, что эта функция включена и вы выполнили рабочую нагрузку достаточно долго для старых параметров, прежде чем изменять новые параметры, чтобы позволить управляемому экземпляру получать сведения о базовых показателях производительности и планах.

Измените параметры или обновите уровни служб, чтобы выполнить согласование с оптимальной конфигурацией до тех пор, пока не будет выводится производительность рабочей нагрузки, соответствующая вашим потребностям.

### <a name="monitor-performance"></a>Мониторинг производительности

SQL Управляемый экземпляр предоставляет множество дополнительных средств для мониторинга и устранения неполадок, и их следует использовать для наблюдения за производительностью экземпляра. Ниже приведены некоторые параметры, которые необходимо отслеживать.

- Использование ЦП на экземпляре, чтобы определить, соответствует ли подготовленное количество виртуальных ядер для вашей рабочей нагрузки.
- Ожидаемый срок жизни страницы на управляемом экземпляре, чтобы определить [, требуется ли дополнительная память](https://techcommunity.microsoft.com/t5/Azure-SQL-Database/Do-you-need-more-memory-on-Azure-SQL-Managed-Instance/ba-p/563444).
- Статистические данные, такие как `INSTANCE_LOG_GOVERNOR` или `PAGEIOLATCH` , которые будут сообщать о проблемах ввода-вывода хранилища, особенно на общего назначения уровне, где может потребоваться предварительное выделение файлов для повышения производительности ввода-вывода.

## <a name="leverage-advanced-paas-features"></a>Использование дополнительных функций PaaS

Когда вы настроили полностью управляемую платформу и проверили, что Рабочая нагрузка производительность в соответствии с производительностью SQL Server рабочей нагрузки, используйте преимущества, предоставляемые автоматически в рамках службы.

Даже если вы не вносите некоторые изменения в управляемый экземпляр во время миграции, существует большая вероятность того, что вы включите некоторые из новых функций, пока вы используете экземпляр, чтобы воспользоваться преимуществами последних улучшений ядра СУБД. Некоторые изменения включаются только после [изменения уровня совместимости базы данных](/sql/relational-databases/databases/view-or-change-the-compatibility-level-of-a-database).

Например, не нужно создавать резервные копии на управляемом экземпляре — Служба автоматически выполняет резервное копирование. Вам больше не нужно будет контролировать планирование, создание резервных копий и управление ими. SQL Управляемый экземпляр предоставляет возможность восстановления в любой момент времени в течение этого периода хранения с помощью восстановления на [момент времени (PITR)](../database/recovery-using-backups.md#point-in-time-restore). Кроме того, не нужно беспокоиться о настройке высокого уровня доступности, так как в ней встроена [Высокая доступность](../database/high-availability-sla.md) .

Для усиления безопасности рекомендуется использовать [проверку Подлинности Azure Active Directory](../database/security-overview.md), [Аудит](auditing-configure.md), [обнаружение угроз](../database/azure-defender-for-sql.md), [безопасность на уровне строк](/sql/relational-databases/security/row-level-security)и [Динамическое маскирование данных](/sql/relational-databases/security/dynamic-data-masking).

В дополнение к расширенным функциям управления и безопасности, управляемый экземпляр предоставляет набор дополнительных средств, которые могут помочь в [мониторинге и настройке рабочей нагрузки](../database/monitor-tune-overview.md). [Аналитика SQL Azure](../../azure-monitor/insights/azure-sql.md) позволяет отслеживать большой набор управляемых экземпляров и централизовать мониторинг большого количества экземпляров и баз данных. [Автоматическая настройка](/sql/relational-databases/automatic-tuning/automatic-tuning#automatic-plan-correction) в управляемых экземплярах постоянно отслеживает производительность статистики выполнения плана SQL и автоматически устраняет выявленные проблемы с производительностью.

## <a name="next-steps"></a>Дальнейшие действия

- Сведения о Управляемый экземпляр Azure SQL см. в статье [что такое управляемый экземпляр SQL Azure?](sql-managed-instance-paas-overview.md).
- Руководство со сведениями о восстановлении из резервной копии см. в статье [Краткое руководство. Создание Управляемого экземпляра Базы данных SQL Azure](instance-create-quickstart.md).
- Руководство по переносу с помощью Database Migration Service см. в статье [Перенос локальной базы данных в Azure SQL управляемый экземпляр с помощью Database Migration Service](../../dms/tutorial-sql-server-to-managed-instance.md).