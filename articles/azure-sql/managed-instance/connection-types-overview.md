---
title: Типы подключений
titleSuffix: Azure SQL Managed Instance
description: Сведения о типах подключений Управляемый экземпляр Azure SQL
services: sql-database
ms.service: sql-managed-instance
ms.subservice: operations
ms.topic: conceptual
author: srdan-bozovic-msft
ms.author: srbozovi
ms.reviewer: vanto
ms.date: 10/07/2019
ms.custom: devx-track-azurepowershell
ms.openlocfilehash: f1c4fe8268d24026609f55d76a102a5c9a4e8295
ms.sourcegitcommit: 772eb9c6684dd4864e0ba507945a83e48b8c16f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "91356322"
---
# <a name="azure-sql-managed-instance-connection-types"></a>Типы соединения управляемого экземпляра SQL Azure
[!INCLUDE[appliesto-sqlmi](../includes/appliesto-sqlmi.md)]

В этой статье объясняется, как клиенты подключаются к Azure SQL Управляемый экземпляр в зависимости от типа соединения. Ниже приведены примеры сценариев для изменения типов подключений, а также соображения, связанные с изменением параметров подключения по умолчанию.

## <a name="connection-types"></a>Типы подключений

Управляемый экземпляр Azure SQL поддерживает следующие два типа подключений:

- **Перенаправление (рекомендуется):** Клиенты устанавливают подключения непосредственно к узлу, на котором размещена база данных. Чтобы обеспечить соединение с помощью перенаправления, необходимо открыть брандмауэры и группы безопасности сети (NSG), чтобы разрешить доступ через порты 1433 и 11000-11999. Пакеты отправляются непосредственно в базу данных, поэтому при использовании перенаправления можно снизить задержку и повысить пропускную способность, по сравнению с прокси-сервером.
- **Прокси-сервер (по умолчанию):** В этом режиме все соединения используют компонент прокси-шлюза. Чтобы обеспечить соединение, необходимо открыть только порт 1433 для частных сетей и порт 3342 для общедоступного подключения. Этот режим может стать результатом большего времени задержки и меньшей пропускной способности, в зависимости от характера рабочей нагрузки. Чтобы задержка была минимальной, а пропускная способность высокой, настоятельно рекомендуется использовать политику перенаправления подключения через политику подключения прокси-сервера.

## <a name="redirect-connection-type"></a>Тип подключения перенаправления

В типе подключения перенаправления после того, как сеанс TCP установлен для ядра SQL, клиентский сеанс получает целевой виртуальный IP-адрес узла виртуального кластера из балансировщика нагрузки. Последующие пакеты поступают непосредственно на узел виртуального кластера, минуя шлюз. Этот поток трафика представлен на схеме ниже.

![На схеме показана локальная сеть с перенаправкой-Find-DB, подключенная к шлюзу в виртуальной сети Azure, и запрос перенаправления, подключенный к основному узлу базы данных в виртуальной сети.](./media/connection-types-overview/redirect.png)

> [!IMPORTANT]
> Тип подключения перенаправления в настоящее время работает только для частной конечной точки. Независимо от параметра типа подключения подключения через общедоступную конечную точку проходят через прокси-сервер.

## <a name="proxy-connection-type"></a>Тип подключения прокси-сервера

В типе подключения прокси-сервера сеанс TCP устанавливается с помощью шлюза, а все последующие пакеты проходят через него. Этот поток трафика представлен на схеме ниже.

![На схеме показана локальная сеть с прокси-сервером, подключенным к шлюзу в виртуальной сети Azure, подключается рядом с основным узлом базы данных в виртуальной сети.](./media/connection-types-overview/proxy.png)

## <a name="changing-connection-type"></a>Изменение типа подключения

- **С помощью портала:** Чтобы изменить тип подключения с помощью портал Azure, откройте страницу виртуальная сеть и используйте параметр **тип подключения** , чтобы изменить тип соединения и сохранить изменения.

- **Скрипт для изменения параметров типа соединения с помощью PowerShell:**

[!INCLUDE [updated-for-az](../../../includes/updated-for-az.md)]

В следующем сценарии PowerShell показано, как изменить тип соединения для управляемого экземпляра на `Redirect` .

```powershell
Install-Module -Name Az
Import-Module Az.Accounts
Import-Module Az.Sql

Connect-AzAccount
# Get your SubscriptionId from the Get-AzSubscription command
Get-AzSubscription
# Use your SubscriptionId in place of {subscription-id} below
Select-AzSubscription -SubscriptionId {subscription-id}
# Replace {rg-name} with the resource group for your managed instance, and replace {mi-name} with the name of your managed instance
$mi = Get-AzSqlInstance -ResourceGroupName {rg-name} -Name {mi-name}
$mi = $mi | Set-AzSqlInstance -ProxyOverride "Redirect" -force
```

## <a name="next-steps"></a>Дальнейшие действия

- [Восстановление базы данных в SQL Управляемый экземпляр](restore-sample-database-quickstart.md)
- Узнайте, как [настроить общедоступную конечную точку на SQL управляемый экземпляр](public-endpoint-configure.md)
- Сведения об [архитектуре подключения SQL управляемый экземпляр](connectivity-architecture-overview.md)
