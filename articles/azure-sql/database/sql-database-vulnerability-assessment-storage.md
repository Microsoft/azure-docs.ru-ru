---
title: Результаты сканирования оценки уязвимостей сохраняются в учетной записи хранения, доступной в защищенных брандмауэрах и виртуальных сетей
description: Содержит инструкции по хранению проверок оценки уязвимостей в учетной записи хранения, доступ к которой можно получить через брандмауэр или виртуальную сеть.
services: sql-database
ms.service: sql-db-mi
ms.subservice: security
ms.topic: how-to
author: davidtrigano
ms.author: datrigan
ms.reviewer: vanto
ms.date: 12/01/2020
ms.openlocfilehash: a4edf94302e063aed7ba539f173ea1364331c4de
ms.sourcegitcommit: 8245325f9170371e08bbc66da7a6c292bbbd94cc
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/07/2021
ms.locfileid: "99807535"
---
# <a name="store-vulnerability-assessment-scan-results-in-a-storage-account-accessible-behind-firewalls-and-vnets"></a>Результаты сканирования оценки уязвимостей сохраняются в учетной записи хранения, доступной в защищенных брандмауэрах и виртуальных сетей
[!INCLUDE[appliesto-sqldb-sqlmi-asa](../includes/appliesto-sqldb-sqlmi-asa.md)]

Если вы ограничиваете доступ к вашей учетной записи хранения в Azure для определенных виртуальных сетей или служб, необходимо включить соответствующую конфигурацию, чтобы проверка уязвимостей (ва) для баз данных SQL или управляемых экземпляров имели доступ к этой учетной записи хранения.

## <a name="enable-azure-sql-database-va-scanning-access-to-the-storage-account"></a>Включить проверку доступа к учетной записи хранения для базы данных SQL Azure

Если вы настроили свою учетную запись хранения для получения доступа только к определенным сетям или службам, необходимо убедиться, что для базы данных SQL Azure просматриваются проверки в учетной записи хранения. Вы можете использовать существующую учетную запись хранения или создать новую учетную запись хранения для хранения результатов проверки ва для всех баз данных на [логическом сервере SQL](logical-servers.md)Server.

> [!NOTE]
> Служба оценки уязвимостей не может получить доступ к учетным записям хранения, защищенным брандмауэрами, или виртуальных сетей, если им требуются ключи доступа к хранилищу.

Перейдите к **группе ресурсов** , содержащей учетную запись хранения, и откройте панель **учетная запись хранения** . В разделе **Параметры** выберите **брандмауэр и виртуальные сети**.

Убедитесь, что установлен флажок **разрешить доверенным службам Майкрософт доступ к этой учетной записи хранения** .

:::image type="content" source="media/sql-database-vulnerability-assessment-storage/storage-allow-microsoft-services.png" alt-text="На снимке экрана показано диалоговое окно Брандмауэр и виртуальные сети с параметром разрешить доверенным службам Майкрософт доступ к этой учетной записи хранения.":::

Чтобы узнать, какая учетная запись хранения используется, перейдите в область **SQL Server** на [портал Azure](https://portal.azure.com)в разделе **Безопасность** выберите **Центр безопасности**.

:::image type="content" source="../database/media/azure-defender-for-sql/va-storage.png" alt-text="Настройка оценки уязвимостей":::

## <a name="store-va-scan-results-for-azure-sql-managed-instance-in-a-storage-account-that-can-be-accessed-behind-a-firewall-or-vnet"></a>Сохранять результаты проверки для Управляемый экземпляр Azure SQL в учетной записи хранения, доступ к которой можно получить через брандмауэр или виртуальную сеть

Поскольку Управляемый экземпляр не является доверенной службой Майкрософт и имеет другую виртуальную сеть из учетной записи хранения, проверка на неизвестное место приведет к ошибке.

Для поддержки проверки ва в управляемых экземплярах выполните следующие действия.

1. В области **управляемый экземпляр SQL** под заголовком **Обзор** щелкните ссылку **Виртуальная сеть или подсеть** . Откроется область **Виртуальная сеть** .

   :::image type="content" source="../managed-instance/media/public-endpoint-configure/mi-overview.png" alt-text="Mi-overview2":::

1. В разделе **Параметры** выберите **Подсети**. Щелкните **подсеть** в новой области, чтобы добавить подсеть, и делегируйте ее в *Microsoft. скл\манажединстанце*. Дополнительные сведения см. в разделе [Управление подсетями](../../virtual-network/virtual-network-manage-subnet.md).

   :::image type="content" source="media/sql-database-vulnerability-assessment-storage/mi-subnets.png" alt-text="На снимке экрана показана подсеть, которая была делегирована Microsoft. Скл\манажединстанце.":::

1. В области **Виртуальная сеть** в разделе **Параметры** выберите **конечные точки службы**. Нажмите кнопку **Добавить** в новой панели и добавьте службу *Microsoft. Storage* в качестве новой конечной точки службы. Убедитесь, что выбрана подсеть *манажединстанце* . Нажмите кнопку **Добавить**.

   :::image type="content" source="media/sql-database-vulnerability-assessment-storage/mi-service-endpoint.png" alt-text="На снимке экрана показано добавление конечных точек службы, в которое вы добавляете службу Microsoft. Storage в качестве конечной точки.":::

1. Перейдите в **учетную запись хранения** , выбранную для хранения проверок ва. В разделе **Параметры** выберите **брандмауэр и виртуальные сети**. Щелкните **Добавить существующую виртуальную сеть**. Выберите виртуальную сеть и подсеть управляемого экземпляра и нажмите кнопку **Добавить**.

   :::image type="content" source="media/sql-database-vulnerability-assessment-storage/storage-firewall.png" alt-text="На снимке экрана показана панель брандмауэры и виртуальные сети, которая содержит ссылку Добавить существующую виртуальную сеть.":::

Теперь вы можете хранить проверки ва для управляемых экземпляров в вашей учетной записи хранения.

## <a name="next-steps"></a>Дальнейшие действия

- [Оценка уязвимостей](sql-vulnerability-assessment.md)
- [Создайте учетную запись хранения Azure](../../storage/common/storage-account-create.md)
- [Azure Defender для SQL](azure-defender-for-sql.md)
