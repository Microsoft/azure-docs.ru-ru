---
title: Масштабирование ресурсов эластичного пула
description: На этой странице описано масштабирование ресурсов для эластичных пулов в Базе данных SQL Azure.
services: sql-database
ms.service: sql-database
ms.subservice: elastic-pools
ms.custom: sqldbrb=1
ms.devlang: ''
ms.topic: conceptual
author: oslake
ms.author: moslake
ms.reviewer: sstein
ms.date: 09/16/2020
ms.openlocfilehash: 947d842860452425f8b30fbdaf9558c2a94a89a2
ms.sourcegitcommit: 910a1a38711966cb171050db245fc3b22abc8c5f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "92781215"
---
# <a name="scale-elastic-pool-resources-in-azure-sql-database"></a>Масштабирование ресурсов эластичного пула в Базе данных SQL Azure
[!INCLUDE[appliesto-sqldb](../includes/appliesto-sqldb.md)]

В этой статье описано масштабирование вычислительных ресурсов и ресурсов хранилища для эластичных пулов и баз данных в пулах в Базе данных SQL Azure.

## <a name="change-compute-resources-vcores-or-dtus"></a>Изменение ресурсов вычислений (виртуальных ядер или DTU)

После первоначального выбора количества виртуальных ядер или Edtu можно динамически масштабировать эластичный пул в зависимости от фактической работы с помощью [портал Azure](elastic-pool-manage.md#azure-portal), [PowerShell](/powershell/module/az.sql/Get-AzSqlElasticPool), [Azure CLI](/cli/azure/sql/elastic-pool#az-sql-elastic-pool-update)или [REST API](/rest/api/sql/elasticpools/update).

### <a name="impact-of-changing-service-tier-or-rescaling-compute-size"></a>Влияние изменения уровня служб или повторного масштабирования размера вычислений

Изменение уровня служб или размера вычислений эластичного пула соответствует аналогичному шаблону для отдельных баз данных и в основном включает службу, выполняющую следующие действия:

1. Создание нового вычислительного экземпляра для эластичного пула  

    Новый вычислительный экземпляр для эластичного пула создается с требуемым уровнем служб и размером вычислений. Для некоторых сочетаний изменений уровня служб и размера вычислений реплика каждой базы данных должна быть создана в новом вычислительном экземпляре, который включает копирование данных и может сильно повлиять на общую задержку. Независимо от этого, базы данных остаются в сети на этом шаге, а подключения по-прежнему направляются в базы данных в исходном вычислительном экземпляре.

2. Переключить маршрутизацию подключений на новый вычислительный экземпляр

    Существующие соединения с базами данных в исходном вычислительном экземпляре удаляются. Все новые соединения устанавливаются для баз данных в новом вычислительном экземпляре. Для некоторых сочетаний изменений уровня служб и размера вычислений файлы базы данных отсоединяются и повторно присоединяются во время переключения.  Независимо от этого коммутатор может привести к кратковременному прерыванию работы службы, когда базы данных недоступны в течение 30 секунд и часто в течение нескольких секунд. Если при отсоединении подключений выполняются длительные транзакции, длительность этого шага может занять больше времени, чтобы восстановить прерванные транзакции. [Ускоренное восстановление базы данных](../accelerated-database-recovery.md) может снизить последствия прерывания длительных транзакций.

> [!IMPORTANT]
> Во время какого-либо этапа рабочего процесса данные не теряются.

### <a name="latency-of-changing-service-tier-or-rescaling-compute-size"></a>Задержка изменения уровня службы или увеличения размера вычислений

Расчетная задержка для изменения уровня служб, масштабирования размера вычислений отдельной базы данных или эластичного пула, перемещения базы данных в пул эластичных БД и из нее, а также для перемещения базы данных между пулами эластичных БД.

|Уровень служб|Базовая простая база данных,</br>Standard (S0-S1)|Базовый эластичный пул,</br>Standard (S2-S12), </br>общего назначения одной базы данных или эластичного пула|Premium или критически важный для бизнеса одна база данных или эластичный пул|Гипермасштабирование
|:---|:---|:---|:---|:---|
|**Базовая простая база данных, уровень " </br> Стандартный" (S0-S1)**|&bull;&nbsp;Постоянная задержка во времени независимо от используемого пространства</br>&bull;&nbsp;Обычно менее 5 минут|&bull;&nbsp;Задержка, пропорциональная объему базы данных, используемой из-за копирования данных</br>&bull;&nbsp;Обычно используется менее 1 минуты на ГБ пространства|&bull;&nbsp;Задержка, пропорциональная объему базы данных, используемой из-за копирования данных</br>&bull;&nbsp;Обычно используется менее 1 минуты на ГБ пространства|&bull;&nbsp;Задержка, пропорциональная объему базы данных, используемой из-за копирования данных</br>&bull;&nbsp;Обычно используется менее 1 минуты на ГБ пространства|
|**Базовый эластичный пул, </br> Standard (S2-S12), </br> общего назначения одна база данных или эластичный пул**|&bull;&nbsp;Задержка, пропорциональная объему базы данных, используемой из-за копирования данных</br>&bull;&nbsp;Обычно используется менее 1 минуты на ГБ пространства|&bull;&nbsp;Для отдельных баз данных, постоянная задержка во времени независимо от используемого пространства</br>&bull;&nbsp;Как правило, для отдельных баз данных менее 5 минут</br>&bull;&nbsp;Для эластичных пулов, пропорционально количеству баз данных|&bull;&nbsp;Задержка, пропорциональная объему базы данных, используемой из-за копирования данных</br>&bull;&nbsp;Обычно используется менее 1 минуты на ГБ пространства|&bull;&nbsp;Задержка, пропорциональная объему базы данных, используемой из-за копирования данных</br>&bull;&nbsp;Обычно используется менее 1 минуты на ГБ пространства|
|**Premium или критически важный для бизнеса одна база данных или эластичный пул**|&bull;&nbsp;Задержка, пропорциональная объему базы данных, используемой из-за копирования данных</br>&bull;&nbsp;Обычно используется менее 1 минуты на ГБ пространства|&bull;&nbsp;Задержка, пропорциональная объему базы данных, используемой из-за копирования данных</br>&bull;&nbsp;Обычно используется менее 1 минуты на ГБ пространства|&bull;&nbsp;Задержка, пропорциональная объему базы данных, используемой из-за копирования данных</br>&bull;&nbsp;Обычно используется менее 1 минуты на ГБ пространства|&bull;&nbsp;Задержка, пропорциональная объему базы данных, используемой из-за копирования данных</br>&bull;&nbsp;Обычно используется менее 1 минуты на ГБ пространства|
|**Гипермасштабирование**|Н/Д|Н/Д|Н/Д|&bull;&nbsp;Постоянная задержка во времени независимо от используемого пространства</br>&bull;&nbsp;Обычно менее 2 минут|

> [!NOTE]
>
> - В случае изменения уровня служб или масштабирования вычислений для эластичного пула необходимо использовать для вычисления оценки объем пространства, используемого во всех базах данных в пуле.
> - В случае перемещения базы данных в эластичный пул или из него только пространство, используемое базой данных, влияет на задержку, а не на пространство, используемое пулом эластичных БД.
> - Для пулов эластичных БД уровня "Стандартный" и общего назначения задержка перемещения базы данных в пул эластичных БД или между пулами эластичных пулов будет пропорционально размеру базы данных, если пул эластичных БД использует хранилище привилегированного файлового ресурса ([PFS](../../storage/files/storage-files-introduction.md)). Чтобы определить, использует ли пул хранилище PFS, выполните следующий запрос в контексте любой базы данных в пуле. Если значение в столбце AccountType равно `PremiumFileStorage` или `PremiumFileStorage-ZRS` , то пул использует хранилище PFS.

```sql
SELECT s.file_id,
       s.type_desc,
       s.name,
       FILEPROPERTYEX(s.name, 'AccountType') AS AccountType
FROM sys.database_files AS s
WHERE s.type_desc IN ('ROWS', 'LOG');
```

> [!TIP]
> Сведения о мониторинге выполняемых операций см. в статьях [Управление операциями с помощью REST API SQL](/rest/api/sql/operations/list), [Управление операциями с помощью интерфейса командной строки](/cli/azure/sql/db/op), [мониторинг операций с помощью T-SQL](/sql/relational-databases/system-dynamic-management-views/sys-dm-operation-status-azure-sql-database) и следующие две команды PowerShell: [Get-азсклдатабасеактивити](/powershell/module/az.sql/get-azsqldatabaseactivity) и [останавливают-азсклдатабасеактивити](/powershell/module/az.sql/stop-azsqldatabaseactivity).

### <a name="additional-considerations-when-changing-service-tier-or-rescaling-compute-size"></a>Дополнительные рекомендации при изменении уровня служб или масштабировании размера вычислений

- Если уменьшении виртуальных ядер или Edtu для эластичного пула, используемое пространство пула должно быть меньше максимального допустимого размера целевого уровня службы и пула Edtu.
- При изменении масштаба eDTU эластичного пула взимается дополнительная плата за хранилище, если максимальный размер хранилища пула поддерживается целевым пулом и превышает включенный объем хранилища целевого пула. Например, если пул категории "Стандартный" с максимальным размером в 100 ГБ, содержащий 100 eDTU, уменьшается до пула категории "Стандартный" с максимальным размером в 100 ГБ, содержащего 50 eDTU, то взимается плата за дополнительное хранилище, так как целевой пул поддерживает максимальный размер в 100 ГБ, а его включенный объем хранилища составляет только 50 ГБ. Поэтому дополнительный объем хранилища равен 100 – 50 = 50 ГБ. Чтобы узнать о ценах на дополнительное хранилище, ознакомьтесь с [ценами на Базу данных SQL](https://azure.microsoft.com/pricing/details/sql-database/). Если фактический объем пространства, которое используется, меньше, чем включенный объем хранилища, то этих дополнительных затрат можно избежать, уменьшив максимальный размер базы данных до включенного объема.

### <a name="billing-during-rescaling"></a>Выставление счетов при масштабировании

Плата взимается за каждый час существования базы данных с учетом самого высокого уровня служб и объема вычислительных ресурсов, которые использовались в течение этого часа, даже если база данных использовалась или была активна менее часа. Например, если вы создадите отдельную базу данных и через 5 минут удалите ее, вам будет выставлен счет за 1 час использования базы данных.

## <a name="change-elastic-pool-storage-size"></a>изменение размера хранилища эластичного пула

> [!IMPORTANT]
> Иногда требуется сжать базу данных, чтобы освободить неиспользуемое пространство. Дополнительные сведения см. [в статье Управление дисковым пространством в базе данных SQL Azure](file-space-manage.md).

### <a name="vcore-based-purchasing-model"></a>Модель приобретения на основе виртуальных ядер

- Объем подготавливаемого хранилища не может превышать максимального допустимого размера.

  - Для хранения в хранилище уровня служб "Стандартный" или "Общего назначения" можно увеличить или уменьшить размер с шагом приращения в 10 ГБ.
  - Для хранения в хранилище уровня служб "Премиум" "Критически важный для бизнеса" можно увеличить или уменьшить размер с шагом приращения в 250 ГБ.
- Для подготовки хранилища эластичного пула можно увеличить или уменьшить его максимальный размер.
- Стоимость хранилища для эластичного пула равна объему хранилища, умноженному на цену единицы хранения этого хранилища для уровня служб. Сведения о цене на дополнительное хранилище см. на [странице цен на Базу данных SQL](https://azure.microsoft.com/pricing/details/sql-database/).

> [!IMPORTANT]
> Иногда требуется сжать базу данных, чтобы освободить неиспользуемое пространство. Дополнительные сведения см. [в статье Управление дисковым пространством в базе данных SQL Azure](file-space-manage.md).

### <a name="dtu-based-purchasing-model"></a>Модель приобретения на основе единиц DTU

- Цена DTU для эластичного пула включает в себя определенный объем хранилища, не требующий дополнительной платы. Дополнительный объем хранилища, сверх включенного, можно подготовить за дополнительную плату в пределах максимального допустимого размера с шагом в 250 ГБ при объеме хранилища до 1 ТБ и с шагом в 256 ГБ — при объеме более 1 ТБ. Сведения о включенном объеме хранилища и ограничениях максимального размера см. в разделе [Отдельная база данных: размеры хранилища и объемы вычислительных ресурсов](resource-limits-dtu-elastic-pools.md#elastic-pool-storage-sizes-and-compute-sizes).
- Дополнительное хранилище для эластичного пула можно подготовить, увеличив его максимальный размер с помощью [портала Azure](elastic-pool-manage.md#azure-portal), [PowerShell](/powershell/module/az.sql/Get-AzSqlElasticPool), [Azure CLI](/cli/azure/sql/elastic-pool#az-sql-elastic-pool-update) или [REST API](/rest/api/sql/elasticpools/update).
- Стоимость дополнительного хранилища для эластичного пула равна объему хранилища, умноженному на цену единицы хранения этого хранилища для уровня служб. Сведения о цене на дополнительное хранилище см. на [странице цен на Базу данных SQL](https://azure.microsoft.com/pricing/details/sql-database/).

> [!IMPORTANT]
> Иногда требуется сжать базу данных, чтобы освободить неиспользуемое пространство. Дополнительные сведения см. [в статье Управление дисковым пространством в базе данных SQL Azure](file-space-manage.md).

## <a name="next-steps"></a>Дальнейшие действия

Сведения об общих ограничениях ресурсов см. в статьях [Ограничения ресурсов базы данных SQL в модели приобретения на основе виртуальных ядер — эластичные пулы](resource-limits-vcore-elastic-pools.md) и [Ограничения ресурсов базы данных SQL в модели приобретения на основе единиц DTU — эластичные пулы](resource-limits-dtu-elastic-pools.md).