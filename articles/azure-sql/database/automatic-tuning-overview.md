---
title: Общие сведения об автоматической настройке
description: База данных SQL Azure и Azure SQL Управляемый экземпляр анализируют SQL запросы и автоматически адаптируются к рабочей нагрузке пользователя.
services: sql-database
ms.service: sql-db-mi
ms.subservice: performance
ms.custom: sqldbrb=2
ms.devlang: ''
ms.topic: conceptual
author: danimir
ms.author: danil
ms.reviewer: wiassaf, sstein
ms.date: 03/30/2020
ms.openlocfilehash: 4204254754307f8310d5ccfda19400de57381075
ms.sourcegitcommit: 910a1a38711966cb171050db245fc3b22abc8c5f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "96500875"
---
# <a name="automatic-tuning-in-azure-sql-database-and-azure-sql-managed-instance"></a>Автоматическая настройка в базе данных SQL Azure и Управляемый экземпляр Azure SQL
[!INCLUDE[appliesto-sqldb-sqlmi](../includes/appliesto-sqldb-sqlmi.md)]

Автоматическая настройка базы данных SQL Azure и Azure SQL Управляемый экземпляр обеспечивает пиковую производительность и устойчивые рабочие нагрузки благодаря непрерывной настройке производительности на основе искусственного интеллекта и машинного обучения.

Автоматическая настройка — это полностью управляемая интеллектуальная служба производительности, которая непрерывно отслеживает выполняемые в базе данных запросы с помощью встроенной системы аналитики и автоматически повышает их производительность. Это достигается за счет динамической адаптации базы данных к изменениям рабочих нагрузок и применения рекомендаций по настройке. Автоматическая настройка горизонтально изучает все базы данных Azure с помощью механизма искусственного интеллекта и динамически улучшает действия настройки. Чем дольше база данных работает с автоматической настройкой, тем лучше она работает.

Автоматическая настройка базы данных SQL Azure и Azure SQL Управляемый экземпляр может быть одной из важнейших функций, которые можно включить для обеспечения стабильного и пикового выполнения рабочих нагрузок базы данных.

## <a name="what-can-automatic-tuning-do-for-you"></a>Что может выполнять автоматическая настройка

- Автоматическая настройка производительности баз данных
- Автоматическая проверка прироста производительности.
- Автоматический откат и самостоятельное восстановление.
- Журнал настройки
- Скрипты Transact-SQL (T-SQL) для действий настройки для ручных развертываний
- Упреждающий мониторинг производительности рабочей нагрузки.
- возможность развертывания сотен тысяч баз данных;
- положительное влияние на ресурсы DevOps и совокупную стоимость владения.

## <a name="safe-reliable-and-proven"></a>Безопасность и надежность

Операции настройки для баз данных в базе данных SQL Azure полностью защищены для повышения производительности наиболее интенсивных рабочих нагрузок. Система была разработана с осторожностью, чтобы предотвратить воздействие на рабочие нагрузки пользователя. Автоматические рекомендации по настройке применяются только во время недостаточной нагрузки. Система также может временно отключать автоматические операции по настройке, чтобы защитить производительность рабочей нагрузки. В этом случае сообщение "отключено системой" будет отображаться в портал Azure. Автоматическая настройка относится к рабочим нагрузкам с наивысшим приоритетом ресурсов.

Автоматические механизмы настройки отлажены и были усовершенствованы на нескольких миллионах баз данных, работающих в Azure. Автоматические операции настройки проверяются автоматически, чтобы обеспечить положительное улучшение производительности рабочей нагрузки. Регрессионные рекомендации по производительности динамически обнаруживаются и оперативно отменяются. С помощью записанного журнала настройки существует четкая трассировка усовершенствований, внесенных в каждую базу данных в базе данных SQL Azure и Управляемый экземпляр Azure SQL.

![Как работает автоматическая настройка](./media/automatic-tuning-overview/how-does-automatic-tuning-work.png)

Автоматическая настройка базы данных SQL Azure предоставляет доступ к своей основной логике с помощью функции автоматической настройки SQL Server в ядре СУБД. Дополнительные технические сведения о встроенном механизме настройки см. в статье [Automatic tuning](/sql/relational-databases/automatic-tuning/automatic-tuning) (Автоматическая настройка).

В приведенном ниже видео представлены принципы работы автоматической настройки и типичные сценарии использования.

> [!VIDEO https://channel9.msdn.com/Shows/Azure-Friday/Improve-Azure-SQL-Database-Performance-with-automatic-tuning/player]

## <a name="enable-automatic-tuning"></a>Включение автоматической настройки

- [Автоматическая настройка базы данных SQL Azure включается в портал Azure](automatic-tuning-enable.md) или с помощью инструкции [ALTER DATABASE](/sql/t-sql/statements/alter-database-transact-sql-set-options?view=azuresqldb-current) T-SQL.
- Включить автоматическую настройку для Управляемый экземпляр SQL Azure можно с помощью инструкции [ALTER DATABASE](/sql/t-sql/statements/alter-database-transact-sql-set-options?view=azuresqldb-mi-current) T-SQL.

## <a name="automatic-tuning-options"></a>Параметры автоматической настройки

Параметры автоматической настройки, доступные в базе данных SQL Azure и Управляемый экземпляр Azure SQL:

| Параметр автоматической настройки | Поддержка отдельной базы данных и базы данных в пуле | Поддержка базы данных экземпляра |
| :----------------------------- | ----- | ----- |
| **Создание индекса** — определяет индексы, которые могут повысить производительность рабочей нагрузки, создает индексы и автоматически проверяет производительность запросов. | Да | Нет |
| **DROP INDEX** — ежедневно идентифицирует избыточные и повторяющиеся индексы, за исключением уникальных индексов и индексов, которые не использовались в течение длительного времени (>90 дней). Обратите внимание, что эта функция несовместима с приложениями, которые используют переключения секций и подсказки индекса. Удаление неиспользуемых индексов не поддерживается для уровней обслуживания "Премиум" и "критически важный для бизнеса". | Да | Нет |
| **Принудительный последний хороший план** (автоматическое исправление плана) — определяет запросы SQL Azure с использованием плана выполнения, который медленнее предыдущего, и запросов, использующих Последний известный план, а не регрессивный план. | Да | Да |

### <a name="automatic-tuning-for-sql-database"></a>Автоматическая настройка базы данных SQL

Автоматическая настройка базы данных SQL Azure использует для оптимизации производительности базы данных **Создание индекса**, **DROP INDEX** и **принудительного выполнения последнего хорошего плана** рекомендаций помощника по базам. Дополнительные сведения см. [в разделе рекомендации помощника по базам данных в портал Azure](database-advisor-find-recommendations-portal.md), в [PowerShell](/powershell/module/az.sql/get-azsqldatabaserecommendedaction)и в [REST API](/rest/api/sql/serverautomatictuning).

Можно либо вручную применить рекомендации по настройке с помощью портал Azure, либо включить автоматическую настройку для автономного применения рекомендаций по настройке. Преимущество автономного системного применения рекомендаций по настройке заключается в том, что система автоматически проверяет возможность увеличить производительность рабочей нагрузки. Если значительное повышение производительности не обнаружено, система автоматически вернется к рекомендации по настройке. Обратите внимание, что в случае запросов, на которые могут повлиять рекомендации по настройке, выполняемые нечасто, этап проверки может занять до 72 часов.

В случае применения рекомендаций по настройке с помощью T-SQL, автоматическая проверка производительности и механизмы реверсирования недоступны. Рекомендации, применяемые таким образом, остаются активными и отображаются в списке рекомендаций по настройке в течение 24-48 часов. перед тем, как система автоматически отбудет их снять. Если вы хотите удалить рекомендацию раньше, вы можете отказаться от портал Azure.

Параметры автоматической настройки могут быть независимо включены или отключены для каждой базы данных, а также могут быть настроены на уровне сервера и применены к каждой базе данных, которая наследует параметры от сервера. Серверы могут наследовать значения по умолчанию Azure для параметров автоматической настройки. Поддерживаемые сейчас значения Azure по умолчанию: FORCE_LAST_GOOD_PLAN включено, CREATE_INDEX включено, а DROP_INDEX отключено.

> [!IMPORTANT]
> По состоянию на март 2020 изменения в Azure по умолчанию для автоматической настройки вступят в силу следующим образом.
>
> - Новые значения по умолчанию для Azure будут FORCE_LAST_GOOD_PLAN = Enabled, CREATE_INDEX = Disabled и DROP_INDEX = Disabled.
> - Существующие серверы, у которых нет настроенных параметров автоматической настройки, будут автоматически настроены для НАСЛЕДОВАНия новых значений по умолчанию Azure. Это относится ко всем клиентам, которые в настоящее время имеют параметры сервера для автоматической настройки в неопределенном состоянии.
> - Новые созданные серверы будут автоматически настроены для НАСЛЕДОВАНия новых параметров Azure по умолчанию (в отличие от предыдущих, когда автоматическая настройка находилась в неопределенном состоянии после создания нового сервера).

Для настройки автоматической настройки рекомендуется настроить параметры автоматической настройки на сервере и наследовать параметры для баз данных, принадлежащих родительскому серверу, так как это упрощает управление параметрами автоматической настройки для большого количества баз данных.

Дополнительные сведения о создании уведомлений по электронной почте для рекомендаций по автоматической настройке см. в разделе [уведомления по электронной почте для автоматической настройки](automatic-tuning-email-notifications-configure.md).

### <a name="automatic-tuning-for-azure-sql-managed-instance"></a>Автоматическая настройка Управляемый экземпляр Azure SQL

Автоматическая настройка SQL Управляемый экземпляр поддерживает только **последний хороший план**. Дополнительные сведения о настройке параметров автоматической настройки с помощью T-SQL см. в разделе [Автоматическая настройка содержит автоматическое исправление плана](https://azure.microsoft.com/blog/automatic-tuning-introduces-automatic-plan-correction-and-t-sql-management/) и [Автоматическое исправление плана](/sql/relational-databases/automatic-tuning/automatic-tuning?view=sql-server-ver15#automatic-plan-correction).

## <a name="next-steps"></a>Дальнейшие действия

- Дополнительные сведения о встроенных аналитических аналитиках, используемых в автоматической настройке, см. в статье [искусственный интеллект — Настройка базы данных SQL Azure](https://azure.microsoft.com/blog/artificial-intelligence-tunes-azure-sql-databases/).
- Чтобы узнать, как работает автоматическая настройка, см. статью [Автоматическое индексирование миллионов баз данных в база данных SQL Microsoft Azure](https://www.microsoft.com/research/uploads/prod/2019/02/autoindexing_azuredb.pdf).