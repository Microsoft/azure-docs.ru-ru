---
title: Модели приобретения
titleSuffix: Azure SQL Database & Azure SQL Managed Instance
description: Сведения о моделях приобретения, доступных для базы данных SQL Azure и Управляемый экземпляр Azure SQL.
services: sql-database
ms.service: sql-db-mi
ms.subservice: features
ms.custom: sqldbrb=1
ms.devlang: ''
ms.topic: conceptual
author: stevestein
ms.author: sstein
ms.reviewer: ''
ms.date: 05/28/2020
ms.openlocfilehash: 8883263d6ddb2fb8ddc809f464288fcd282531bd
ms.sourcegitcommit: 910a1a38711966cb171050db245fc3b22abc8c5f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "92788831"
---
# <a name="choose-between-the-vcore-and-dtu-purchasing-models---azure-sql-database-and-sql-managed-instance"></a>Выбор между моделями приобретения Виртуальное ядро и DTU в базе данных SQL Azure и SQL Управляемый экземпляр
[!INCLUDE[appliesto-sqldb-sqlmi](../includes/appliesto-sqldb-sqlmi.md)]

База данных SQL Azure и Управляемый экземпляр Azure SQL позволяют легко приобрести полностью управляемое ядро СУБД как услуга (PaaS), удовлетворяющее требованиям к производительности и затратам. В зависимости от модели развертывания, выбранной для базы данных SQL Azure, можно выбрать модель приобретения, которая будет работать для вас:

- [Модель приобретения на основе виртуальных ядер (Виртуальное ядро)](service-tiers-vcore.md) (рекомендуется). Эта модель приобретения предоставляет возможность выбора между подготовленным уровнем вычислений и бессерверным уровнем вычислений. Используя подготовленный уровень вычислений, вы выбираете точный объем ресурсов вычислений, которые всегда подготавливаются для рабочей нагрузки. На уровне бессерверных вычислений вы указываете автоматическое масштабирование ресурсов вычислений через настраиваемый диапазон вычислений. С помощью этой категории вычислений можно также автоматически приостанавливать и возобновлять работу базы данных на основе действий рабочей нагрузки. Цена единицы Виртуальное ядро на единицу времени меньше на подготовленном уровне вычислений, чем на уровне бессерверных вычислений.
- [Модель приобретения на основе единиц транзакций базы данных (DTU)](service-tiers-dtu.md). Эта модель приобретения предоставляет Объединенные пакеты вычислений и хранилища, сбалансированные для распространенных рабочих нагрузок.

Существует две модели приобретения:

- [модель приобретения на основе виртуальное ядро](service-tiers-vcore.md) доступна как для [базы данных SQL Azure](sql-database-paas-overview.md) , так и для [управляемый экземпляр Azure SQL](../managed-instance/sql-managed-instance-paas-overview.md). [Уровень службы "линейка](service-tier-hyperscale.md) " доступен для отдельных баз данных, использующих [модель приобретения на основе виртуальное ядро](service-tiers-vcore.md).
- [Модель приобретения на основе DTU](service-tiers-dtu.md) доступна для [базы данных SQL Azure](single-database-manage.md).

В следующей таблице и диаграмме сравниваются и отличаются модели приобретения на основе виртуальное ядро и DTU:

|**Модель приобретения**|**Описание**|**Сценарии применения**|
|---|---|---|
|На основе DTU|Эта модель основана на наборе показателей ресурсов вычислений, хранения и ввода-вывода. Объем вычислительных ресурсов выражается в единицах DTU для отдельных баз данных и в единицах eDTU (единица транзакций эластичной базы данных) для эластичных пулов. Дополнительные сведения о DTU и eDTU см. в разделе [Модель приобретения на основе единиц DTU](purchasing-models.md#dtu-based-purchasing-model).|Клиенты, которым требуются простые, предварительно настроенные параметры ресурсов|
|на основе виртуальное ядро|Эта модель позволяет независимо выбрать ресурсы вычисления и хранилища. Модель приобретения на основе виртуальных ядер также позволяет применять [Преимущество гибридного использования Azure](https://azure.microsoft.com/pricing/hybrid-benefit/) для SQL Server, чтобы снизить затраты.|Клиенты, обладающие гибкостью, контролем и прозрачностью|
||||  

![Сравнение моделей ценообразования](./media/purchasing-models/pricing-model.png)

Хотите оптимизировать и сократить ваши расходы на облако?

[!INCLUDE [cost-management-horizontal](../../../includes/cost-management-horizontal.md)]

## <a name="compute-costs"></a>Затраты на вычислительные ресурсы

### <a name="provisioned-compute-costs"></a>Подготовленные затраты на вычисление

В подготовленном уровне вычислений стоимость вычислений отражает общую емкость вычислений, подготовленную для приложения.

На критически важный для бизнеса уровне служб автоматически выделяются по крайней мере три реплики. Для отражения этого дополнительного выделения ресурсов вычислений Цена в модели приобретения на основе виртуальное ядро составляет примерно 2,7 раз выше на уровне служб критически важный для бизнеса, чем на уровне служб общего назначения. Аналогичным образом, более высокая стоимость хранилища на ГБ на уровне служб критически важный для бизнеса отражает более высокие ограничения на операции ввода-вывода и более низкую задержку хранилища SSD.

Стоимость хранилища службы архивации одинакова для уровня служб критически важный для бизнеса и общего назначения уровня служб, так как оба уровня используют хранилище класса Standard для резервного копирования.

### <a name="serverless-compute-costs"></a>Затраты на бессерверные вычислений

Описание того, как определяется емкость вычислений и рассчитываются затраты на бессерверный уровень вычислений, см. в разделе [уровень сервера базы данных SQL](serverless-tier-overview.md).

## <a name="storage-costs"></a>Затраты на хранение

Модель выставления счетов зависит от типа хранилища. Для хранилища данных плата наследуется за подготовленное хранилище на основе выбранного максимального размера базы данных или пула. Затраты изменяются только при уменьшении или увеличении максимального значения. Хранилище резервных копий связано с автоматическими резервными копиями экземпляра и выделяется автоматически. Увеличение срока хранения резервных копий увеличивает объем хранилища резервных копий, используемого экземпляром.

По умолчанию семь дней автоматического резервного копирования баз данных копируются в стандартную учетную запись хранения BLOB-объектов хранилища с доступом на чтение (RA-GRS). Это хранилище используется еженедельными полными резервными копиями, ежедневными разностными резервными копиями и резервными копиями журналов транзакций, которые копируются каждые пять минут. Размер журналов транзакций зависит от скорости изменения базы данных. Минимальный объем хранилища, равный 100% от размера базы данных, предоставляется без дополнительной платы. Плата за дополнительное пространство хранилища резервных копий будет взиматься с расчетом ГБ в месяц.

Дополнительные сведения о ценах на службу хранилища см. на странице [Обзор цен на хранилище Azure](https://azure.microsoft.com/pricing/details/sql-database/single/).

## <a name="vcore-based-purchasing-model"></a>Модель приобретения на основе виртуальных ядер

Виртуальное ядро (Виртуальное ядро) представляет собой логический ЦП и предлагает возможность выбора между поколениями оборудования и физическими характеристиками оборудования (например, число ядер, объем памяти и размер хранилища). Модель приобретения на основе виртуальное ядро обеспечивает гибкость, контроль, прозрачность использования отдельных ресурсов и простой способ перевода локальных требований к рабочей нагрузке в облако. Эта модель позволяет выбирать ресурсы вычислений, памяти и хранилища в зависимости от потребностей рабочей нагрузки.

В модели приобретения на основе виртуальное ядро можно выбрать между уровнями служб [общего назначения](high-availability-sla.md#basic-standard-and-general-purpose-service-tier-locally-redundant-availability) и [критически важный для бизнеса](high-availability-sla.md#premium-and-business-critical-service-tier-locally-redundant-availability) для базы данных SQL и управляемый экземпляр SQL.  Для отдельных баз данных можно также выбрать [уровень службы "масштабирование](service-tier-hyperscale.md)".

Модель приобретения на основе виртуальное ядро позволяет независимо выбирать ресурсы вычислений и хранения, сопоставлять локальную производительность и оптимизировать цену. В модели приобретения на основе виртуальное ядро вы платите:

- ресурсы вычислений (уровень служб + количество виртуальных ядер и объем памяти + поколение оборудования);
- тип и объем хранилища данных и журнала;
- Хранилище резервных копий (RA-GRS).

> [!IMPORTANT]
> Для вычислений с ресурсами, вводом-выводом и хранилищем журналов выставляются счета за базу данных или эластичный пул. За хранилище резервных копий начислена каждая база данных. Дополнительные сведения о расходах на Управляемый экземпляр SQL см. в разделе [sql управляемый экземпляр](../managed-instance/sql-managed-instance-paas-overview.md).
> **Ограничения области:** Текущий список поддерживаемых регионов см. в разделе [продукты, доступные по регионам](https://azure.microsoft.com/global-infrastructure/services/?products=sql-database&regions=all). Чтобы создать управляемый экземпляр в регионе, который сейчас не поддерживается, [отправьте запрос в службу поддержки через портал Azure](quota-increase-request.md).

Если база данных потребляет более 300 DTU, то преобразование в модель приобретения на основе виртуальное ядро может снизить затраты. Вы можете преобразовать с помощью используемого API или портал Azure, не прерывая работу. Однако преобразование не требуется и не выполняется автоматически. Если модель приобретения на основе единиц DTU соответствует вашим требованиям к производительности и бизнес-требованиям, продолжайте использовать ее.

Чтобы преобразовать модель приобретения на основе DTU в модель приобретения на основе виртуальное ядро, см. статью [Переход с DTU на виртуальное ядро](migrate-dtu-to-vcore.md).

## <a name="dtu-based-purchasing-model"></a>Модель приобретения на основе единиц DTU

Единица транзакции базы данных (DTU) представляет собой смешанную меру ЦП, памяти, операций чтения и записи. Модель приобретения на основе единиц DTU предлагает ряд предварительно настроенных пакетов вычислительных ресурсов и включенный объем хранилища для обеспечения различных уровней производительности приложений. Если вы предпочитаете упростить предварительно настроенный пакет и фиксированные платежи каждый месяц, то модель на основе DTU может быть более подходящей для ваших потребностей.

В модели приобретения на основе DTU можно выбрать один из уровней служб "базовый", "Стандартный" и "Премиум" для базы данных SQL Azure. Модель приобретения на основе DTU недоступна для Управляемый экземпляр Azure SQL.

### <a name="database-transaction-units-dtus"></a>Единицы транзакций базы данных (DTU)

Для отдельной базы данных с определенным размером вычислений в пределах [уровня службы](single-database-scale.md)Azure гарантирует определенный уровень ресурсов для этой базы данных (независимо от любой другой базы данных в облаке Azure). Эта гарантия обеспечивает предсказуемый уровень производительности. Объем ресурсов, выделенных для базы данных, вычисляется как число DTU и представляет собой объединенный показатель ресурсов вычислений, хранения и ввода-вывода.

Отношение между этими ресурсами изначально определяется [рабочей нагрузкой производительности оперативной обработки транзакций (OLTP)](service-tiers-dtu.md) , которая является типичной для реальных рабочих нагрузок OLTP. Если Рабочая нагрузка превышает объем какого-либо из этих ресурсов, пропускная способность регулируется, что приводит к снижению производительности и времени ожидания.

Ресурсы, используемые рабочей нагрузкой, не влияют на ресурсы, доступные для других баз данных в облаке Azure. Аналогичным образом ресурсы, используемые другими рабочими нагрузками, не влияют на ресурсы, доступные для базы данных.

![Ограничивающий прямоугольник](./media/purchasing-models/bounding-box.png)

DTU наиболее полезны для понимания относительных ресурсов, выделенных для баз данных с различными размерами вычислений и уровнями служб. Пример:

- Удвоение количества DTU путем увеличения размера вычислений базы данных равно удвоению набора ресурсов, доступных этой базе данных.
- База данных P11 уровня службы Premium с 1750 DTU предоставляет 350 больше мощности вычислений DTU, чем базовая база данных уровня службы с 5 DTU.  

Чтобы получить более подробные сведения о потреблении ресурсов (DTU) рабочей нагрузки, используйте [аналитические сведения о производительности запросов](query-performance-insight-use.md) в следующих случаях:

- Выявление запросов с наибольшим количеством ресурсов ЦП, длительности и выполнений, которые могут быть настроены для повышения производительности. Например, запрос с интенсивным вводом-выводом может получить преимущество от [методов оптимизации в памяти](../in-memory-oltp-overview.md) , чтобы лучше использовать доступную память на определенном уровне служб и в вычислительном размере.
- Детализируйте сведения о запросе, чтобы просмотреть его текст и историю использования ресурсов.
- Доступ к рекомендациям по настройке производительности, которые показывают действия, выполняемые [Помощник по базам данных SQL](database-advisor-implement-performance-recommendations.md).

### <a name="elastic-database-transaction-units-edtus"></a>Единицы транзакций эластичной базы данных (Edtu)

Для баз данных, которые всегда доступны, вместо предоставления выделенного набора ресурсов (DTU), которые не всегда требуются, эти базы данных можно поместить в [эластичный пул](elastic-pool-overview.md). Базы данных в эластичном пуле находятся на одном сервере и совместно используют пул ресурсов.

Общие ресурсы в эластичном пуле измеряются единицами транзакций эластичной базы данных (Edtu). Эластичные пулы предоставляют простое и экономичное решение для управления целями производительности для нескольких баз данных с широко изменяющимися и непредсказуемыми шаблонами использования. Эластичный пул гарантирует, что все ресурсы не могут быть использованы в одной базе данных в пуле, в то время как гарантируется, что каждая база данных в пуле всегда будет иметь минимальный объем необходимых ресурсов.

Пулу предоставляется заданное количество единиц eDTU по фиксированной цене. В эластичном пуле отдельные базы данных могут автоматически масштабироваться в пределах настроенных границ. База данных с более плотной нагрузкой будет потреблять больше Edtu для удовлетворения спроса. Базы данных с более светлыми нагрузками будут потреблять меньше Edtu. Базы данных без нагрузки не будут потреблять eDTU. Так как ресурсы подготавливаются для всего пула, а не для каждой базы данных, эластичные пулы упрощают задачи управления и предоставляют Прогнозируемый бюджет для пула.

Можно добавить дополнительные Edtu в существующий пул без простоя базы данных и без влияния на базы данных в пуле. Аналогичным образом, если дополнительные Edtu больше не требуются, удалите их из существующего пула в любое время. Кроме того, в любое время можно добавлять базы данных в пул или вычитать их из пула. Чтобы зарезервировать Edtu для других баз данных, ограничьте число Edtu, которое может использовать база данных при интенсивной нагрузке. Если база данных постоянно использует ресурсы, переместите ее из пула и настройте в качестве отдельной базы данных с прогнозируемым объемом требуемых ресурсов.

### <a name="determine-the-number-of-dtus-needed-by-a-workload"></a>Определение числа единиц DTU, требуемых для рабочей нагрузки

Если вы хотите перенести существующую локальную или SQL Server рабочую нагрузку виртуальной машины в базу данных SQL, используйте [Калькулятор DTU](https://dtucalculator.azurewebsites.net/) , чтобы приблизительно оценить необходимое количество DTU. Для существующей рабочей нагрузки базы данных SQL используйте [аналитические сведения о производительности запросов](query-performance-insight-use.md) , чтобы получить представление о потреблении ресурсов базы данных (DTU) и получать более подробные сведения для оптимизации рабочей нагрузки. Динамическое административное представление [sys.dm_db_resource_stats](/sql/relational-databases/system-dynamic-management-views/sys-dm-db-resource-stats-azure-sql-database) позволяет просматривать потребление ресурсов за последний час. В представлении каталога [sys.resource_stats](/sql/relational-databases/system-catalog-views/sys-resource-stats-azure-sql-database) отображается потребление ресурсов за последние 14 дней, но с более низким уровнем точности в среднем за пять минут.

### <a name="determine-dtu-utilization"></a>Определение использования DTU

Чтобы определить средний процент использования DTU/eDTU относительно ограничения DTU/eDTU базы данных или эластичного пула, используйте следующую формулу:

`avg_dtu_percent = MAX(avg_cpu_percent, avg_data_io_percent, avg_log_write_percent)`

Входные значения для этой формулы можно получить из [sys.dm_db_resource_stats](/sql/relational-databases/system-dynamic-management-views/sys-dm-db-resource-stats-azure-sql-database), [sys.resource_stats](/sql/relational-databases/system-catalog-views/sys-resource-stats-azure-sql-database)и [sys.elastic_pool_resource_stats](/sql/relational-databases/system-catalog-views/sys-elastic-pool-resource-stats-azure-sql-database) DMV. Иными словами, чтобы определить процент использования DTU/eDTU в отношении ограничения DTU/eDTU базы данных или эластичного пула, выберите наибольшее процентное значение из следующих значений: `avg_cpu_percent` , `avg_data_io_percent` и `avg_log_write_percent` в определенный момент времени.

> [!NOTE]
> Ограничение DTU базы данных определяется ЦП, операциями чтения, записи и памятью, доступной базе данных. Однако, поскольку ядро СУБД SQL обычно использует всю доступную память для кэша данных, чтобы повысить производительность, `avg_memory_usage_percent` значение обычно будет близко к 100% независимо от текущей загрузки базы данных. Таким образом, несмотря на то, что память косвенно влияет на предел DTU, она не используется в формуле использования DTU.

### <a name="workloads-that-benefit-from-an-elastic-pool-of-resources"></a>Рабочие нагрузки, для которых эффективно используется эластичный пул ресурсов

Пулы хорошо подходят для баз данных с низким средним использованием ресурсов и относительно редких пиков нагрузки. Дополнительные сведения см. [в разделе когда следует использовать эластичный пул базы данных SQL?](elastic-pool-overview.md).

### <a name="hardware-generations-in-the-dtu-based-purchasing-model"></a>Поколения оборудования в модели приобретения на основе DTU

В модели приобретения на основе DTU клиенты не могут выбрать поколение оборудования, используемое для баз данных. Хотя данная база данных обычно остается в определенном аппаратном создании оборудования в течение длительного времени (обычно за несколько месяцев), существуют определенные события, которые могут привести к перемещению базы данных в другое поколение оборудования.

Например, база данных может быть перемещена в другое поколение оборудования, если она масштабируется по отношению к другой цели обслуживания или если текущая инфраструктура в центре обработки данных приближается к ограничениям емкости или если используемое в настоящее время оборудование списано из-за его жизненного цикла.

Если база данных перемещается на другое оборудование, производительность рабочей нагрузки может измениться. Модель DTU гарантирует, что пропускная способность и время отклика рабочей нагрузки [производительности DTU](./service-tiers-dtu.md#dtu-benchmark) будут значительно совпадать, так как база данных переходит на другое поколение оборудования, если его цель обслуживания (число DTU) остается неизменной.

Однако в широком спектре рабочих нагрузок клиента, выполняемых в базе данных SQL Azure, влияние использования различных аппаратных средств для одной цели обслуживания может быть более продолжено. Различные рабочие нагрузки будут использовать разные аппаратные конфигурации и функции. Таким образом, для рабочих нагрузок, отличных от производительности DTU, можно увидеть различия в производительности, если база данных перемещается из одного поколения оборудования в другое.

Например, приложение, чувствительное к задержке в сети, может обеспечить лучшую производительность го поколения оборудования и го поколения из-за использования ускорения сети в го поколения, но приложение, использующее интенсивные операции ввода-вывода Read, может более эффективно работать на го поколения оборудовании и го поколения благодаря увеличению количества памяти на ядро в го поколения.

Клиенты с рабочими нагрузками, которые чувствительны к изменениям оборудования или клиентам, желающим управлять выбором оборудования для своей базы данных, могут использовать модель [Виртуальное ядро](service-tiers-vcore.md) для выбора предпочтительного поколения оборудования во время создания и масштабирования базы данных. В модели Виртуальное ядро ограничения ресурсов каждой цели обслуживания в каждом формировании оборудования задокументированы как для [отдельных баз данных](resource-limits-vcore-single-databases.md) , так и для [эластичных пулов](resource-limits-vcore-elastic-pools.md). Дополнительные сведения о поколениях оборудования в модели Виртуальное ядро см. в разделе [поколения оборудования](./service-tiers-vcore.md#hardware-generations).

## <a name="frequently-asked-questions-faqs"></a>Часто задаваемые вопросы (FAQ)

### <a name="do-i-need-to-take-my-application-offline-to-convert-from-a-dtu-based-service-tier-to-a-vcore-based-service-tier"></a>Нужно ли переводить приложение в автономный режим для преобразования из уровня служб на основе DTU на уровень служб на основе виртуальное ядро?

Нет. Перевести приложение в автономный режим не требуется. Новые уровни служб предлагают простой метод интерактивного преобразования, похожий на существующий процесс обновления баз данных со Standard до уровня служб Premium и наоборот. Это преобразование можно начать с помощью портал Azure, PowerShell, Azure CLI, T-SQL или REST API. Ознакомьтесь со статьями [Управление ресурсами отдельной базы данных в Базе данных SQL Azure](single-database-scale.md) и [Управление несколькими базами данных SQL Azure и их масштабирование с помощью эластичных пулов](elastic-pool-overview.md).

### <a name="can-i-convert-a-database-from-a-service-tier-in-the-vcore-based-purchasing-model-to-a-service-tier-in-the-dtu-based-purchasing-model"></a>Можно ли преобразовать базу данных из уровня службы в модели приобретения на основе виртуальное ядро в уровень служб в модели приобретения на основе DTU?

Да, можно легко преобразовать базу данных в любую поддерживаемую цель производительности с помощью портал Azure, PowerShell, Azure CLI, T-SQL или REST API. Ознакомьтесь со статьями [Управление ресурсами отдельной базы данных в Базе данных SQL Azure](single-database-scale.md) и [Управление несколькими базами данных SQL Azure и их масштабирование с помощью эластичных пулов](elastic-pool-overview.md).

## <a name="next-steps"></a>Дальнейшие действия

- Дополнительные сведения о модели приобретения на основе виртуальное ядро см. в разделе [модель приобретения на основе виртуальное ядро](service-tiers-vcore.md).
- Дополнительные сведения о модели приобретения на основе DTU см. в разделе [модель приобретения на основе DTU](service-tiers-dtu.md).