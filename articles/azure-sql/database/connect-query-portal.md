---
title: Запросы к Базе данных SQL с помощью редактора запросов на портале Azure (предварительная версия)
description: Узнайте, как с помощью редактора запросов выполнять запросы Transact-SQL (T-SQL) к базе данных в Базе данных SQL Azure.
titleSuffix: Azure SQL Database
keywords: подключение к базе данных sql, запрос в базе данных sql, портал azure, портал, редактор запросов
services: sql-database
ms.service: sql-database
ms.subservice: development
ms.custom: sqldbrb=1
ms.devlang: ''
ms.topic: quickstart
author: Ninarn
ms.author: ninarn
ms.reviewer: sstein
ms.date: 03/01/2021
ms.openlocfilehash: b2b614002a380ecd9c7eb6ec40e9dbd734b99628
ms.sourcegitcommit: c27a20b278f2ac758447418ea4c8c61e27927d6a
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/03/2021
ms.locfileid: "101692850"
---
# <a name="quickstart-use-the-azure-portals-query-editor-preview-to-query-an-azure-sql-database"></a>Краткое руководство. Выполнение запросов к Базе данных SQL Azure с помощью редактора запросов (предварительная версия) на портале Azure
[!INCLUDE[appliesto-sqldb](../includes/appliesto-sqldb.md)]

Редактор запросов на портале Azure позволяет выполнять SQL-запросы к базе данных в Базе данных SQL Azure или к хранилищу данных в Azure Synapse Analytics.

В этом кратком руководстве показано, как с помощью редактора запросов выполнять запросы Transact-SQL (T-SQL) к базе данных.

## <a name="prerequisites"></a>Предварительные требования

### <a name="create-a-database-with-sample-data"></a>Создание базы данных с примерами данных

Для работы с этим кратким руководством требуется пример базы данных AdventureWorksLT. Если у вас нет рабочей копии с образцом базы данных AdventureWorksLT в базе данных SQL, создайте ее с помощью следующего краткого руководства:

[Краткое руководство. Создание базы данных в Базе данных SQL Azure с помощью портала Azure, PowerShell или Azure CLI](single-database-create-quickstart.md)

### <a name="set-an-azure-active-directory-admin-for-the-server-optional"></a>Настройка администратора доменных служб Azure Active Directory для сервера (необязательно)

Настройка администратора Azure Active Directory (Azure AD) позволяет использовать единое удостоверение для входа на портал Azure и в вашу базу данных. Если вы хотите использовать Microsoft Azure Active Directory для подключения к редактору запросов, выполните следующие действия.

Это необязательный процесс. Вместо этого для подключения к редактору запросов можно использовать проверку подлинности SQL.

> [!NOTE]
> * Учетные записи электронной почты (например, outlook.com, gmail.com, yahoo.com и др.) пока не поддерживаются как учетные записи администраторов Azure AD. Выберите пользователя, который изначально был создан в Azure AD или же интегрирован с этой службой.
> * Вход администратора Microsoft Azure Active Directory работает с учетными записями, для которых включена 2-факторная проверка подлинности, но редактор запросов не поддерживает 2-факторную проверку подлинности.

1. На портале Microsoft Azure найдите сервер базы данных SQL.

2. В меню **SQL Server** выберите **Администратор Active Directory**.

3. Вернувшись на страницу **администратора доменных служб Active Directory** SQL Server, нажмите кнопку **Указать администратора** на панели инструментов.

    ![выбор Active Directory](./media/connect-query-portal/select-active-directory.png)

4. На странице **Добавление администратора** в поле поиска введите пользователя или группу для поиска, выберите их в качестве администратора, а затем нажмите кнопку **Выбрать**.

5. Вернувшись на страницу **администратора Active Directory** SQL Server, щелкните на панели инструментов кнопку **Сохранить**.

## <a name="using-sql-query-editor"></a>Использование редактора запросов SQL

1. Войдите на [портал Azure](https://portal.azure.com/) и выберите базу данных, которой будут адресоваться запросы.

2. В меню **Базы данных SQL** выберите **Редактор запросов (предварительная версия)** .

    ![Поиск редактора запросов](./media/connect-query-portal/find-query-editor.PNG)

### <a name="establish-a-connection-to-the-database"></a>Установка подключения к базе данных

Даже если вы уже вошли на портал, вам нужно отдельно ввести учетные данные для доступа к базе данных. Для подключения к базе данных можно использовать аутентификацию SQL или Azure Active Directory.

#### <a name="connect-using-sql-authentication"></a>Подключение с помощью аутентификации SQL

1. На странице **Вход** в разделе **Проверка подлинности SQL Server** введите **имя входа** и **пароль** пользователя, у которого есть доступ к этой базе данных. Если вы не знаете такого пользователя, введите имя входа и пароль администратора сервера этой базы данных.

    ![войти](./media/connect-query-portal/login-menu.png)

2. Щелкните **ОК**.

#### <a name="connect-using-azure-active-directory"></a>Подключение с помощью Azure Active Directory

В **редакторе запросов (предварительная версия)** перейдите на страницу **входа** в разделе **Проверка подлинности Active Directory**. Проверка подлинности выполняется автоматически, и если вы являетесь администратором Microsoft Azure Active Directory для базы данных, появится сообщение о том, что выполнен вход. Нажмите кнопку **Продолжить как** *\<your user or group ID>* . Если на странице сообщается, что вход не выполнен, попробуйте обновить эту страницу.

### <a name="query-a-database-in-sql-database"></a>Запрос к базе данных в Базе данных SQL

Следующие примеры запросов должны выполняться в примере базы данных AdventureWorksLT.

#### <a name="run-a-select-query"></a>Выполнение запроса SELECT

1. Вставьте следующий запрос в редактор запросов:

   ```sql
    SELECT TOP 20 pc.Name as CategoryName, p.name as ProductName
    FROM SalesLT.ProductCategory pc
    JOIN SalesLT.Product p
    ON pc.productcategoryid = p.productcategoryid;
   ```

2. Щелкните **Выполнить** и просмотрите выходные данные в области **Результаты**.

   ![результаты редактора запросов](./media/connect-query-portal/query-editor-results.png)

3. При желании можно сохранить запрос в виде файла .sql или экспортировать возвращенные данные в файл .json, .csv или .xml.

#### <a name="run-an-insert-query"></a>Выполнение запроса INSERT

Выполните следующую инструкцию T-SQL [INSERT](/sql/t-sql/statements/insert-transact-sql/), чтобы добавить новый продукт в таблицу `SalesLT.Product`.

1. Замените предыдущий запрос следующим содержимым.

    ```sql
    INSERT INTO [SalesLT].[Product]
           ( [Name]
           , [ProductNumber]
           , [Color]
           , [ProductCategoryID]
           , [StandardCost]
           , [ListPrice]
           , [SellStartDate]
           )
    VALUES
           ('myNewProduct'
           ,123456789
           ,'NewColor'
           ,1
           ,100
           ,100
           ,GETDATE() );
   ```


2. Щелкните **Выполнить**, чтобы вставить новую строку в таблицу `Product`. Отобразится панель **сообщений** с результатом: **Запрос выполнен. Затронуто строк: 1**.


#### <a name="run-an-update-query"></a>Выполнение запроса UPDATE

Выполните следующую инструкцию T-SQL [UPDATE](/sql/t-sql/queries/update-transact-sql/), чтобы изменить новый продукт.

1. Замените предыдущий запрос следующим содержимым.

   ```sql
   UPDATE [SalesLT].[Product]
   SET [ListPrice] = 125
   WHERE Name = 'myNewProduct';
   ```

2. Щелкните **Выполнить**, чтобы обновить указанную строку в таблице`Product`. Отобразится панель **сообщений** с результатом: **Запрос выполнен. Затронуто строк: 1**.

#### <a name="run-a-delete-query"></a>Выполнение запроса DELETE

Выполните следующую инструкцию T-SQL [DELETE](/sql/t-sql/statements/delete-transact-sql/), чтобы удалить новый продукт.

1. Замените предыдущий запрос следующим содержимым:

   ```sql
   DELETE FROM [SalesLT].[Product]
   WHERE Name = 'myNewProduct';
   ```

2. Щелкните **Выполнить**, чтобы удалить указанную строку в таблице`Product`. Отобразится панель **сообщений** с результатом: **Запрос выполнен. Затронуто строк: 1**.


## <a name="troubleshooting-and-considerations"></a>Рекомендации и устранение неполадок

Ознакомьтесь с рекомендациями по работе с редактором запросов.

### <a name="configure-local-network-settings"></a>Настройка параметров локальной сети

В редакторе запросов вы можете увидеть одно из следующих сообщений об ошибке:
 - *Параметры локальной сети могут препятствовать формированию запросов в редакторе запросов. Нажмите здесь, чтобы получить инструкции по настройке параметров сети*
 - *Не удается установить подключение к серверу. Это может свидетельствовать о проблеме с конфигурацией локального брандмауэра или с параметрами прокси-сервера сети*

Это происходит потому, что редактор запросов использует порты 443 и 1443 для обмена данными. Убедитесь, что исходящий трафик HTTPS включен на этих портах. В приведенных ниже инструкциях вы узнаете, как это сделать в зависимости от операционной системы. Возможно, потребуется обратиться в корпоративный ИТ-отдел, чтобы предоставить разрешение на открытие этого подключения в локальной сети.

#### <a name="steps-for-windows"></a>Действия для устройств Windows

1. Откройте **Брандмауэр Защитника Windows**
2. В меню слева выберите **Расширенные параметры**
3. В окне **Брандмауэр Защитника Windows с повышенной безопасностью** выберите **Правила для исходящего трафика** в меню слева.
4. Выберите **Создать правило...** в меню справа

В **Мастере создания правил для исходящего трафика** выполните следующие действия:

1. Выберите **порт** в качестве типа правила. Щелкните **Далее**.
2. Выберите **TCP**
3. Выберите **Определенные удаленные порты** и введите "443, 1443". Затем нажмите **Далее**
4. Выберите "Разрешить подключение, если оно защищено"
5. Нажмите **Далее**, затем еще раз нажмите **Далее**
5. Параметры "Домен", "Частный" и "Общий" должны быть выбраны
6. Присвойте правилу имя, например "Доступ к редактору запросов Azure SQL", и при необходимости добавьте описание. Затем нажмите **Готово**

#### <a name="steps-for-mac"></a>Действия для Mac
1. Откройте **Системные настройки** (меню Apple > Системные настройки).
2. Нажмите **Сведения о безопасности и конфиденциальности**.
3. Щелкните пункт **Брандмауэр**.
4. Если брандмауэр отключен, **нажмите значок блокировки внизу, чтобы внести изменения**, и выберите **Включить брандмауэр**
4. Нажмите **Параметры брандмауэра**.
5. В окне **Безопасность и конфиденциальность** выберите этот параметр: "Автоматически разрешать подписанному программному обеспечению принимать входящие подключения".

#### <a name="steps-for-linux"></a>Действия для Linux
Выполните следующие команды, чтобы обновить iptables
  ```
  sudo iptables -A OUTPUT -p tcp --dport 443 -j ACCEPT
  sudo iptables -A OUTPUT -p tcp --dport 1443 -j ACCEPT
  ```

### <a name="connection-considerations"></a>Рекомендации по подключению

* Кроме того, необходимо [добавить на сервере исходящий IP-адрес в разрешающие правила брандмауэра](firewall-create-server-level-portal-quickstart.md) для обращения к базам данных и хранилищам данных.

* Если на сервере настроено подключение к приватному каналу Azure и вы подключаетесь к редактору запросов из IP-адреса в частной виртуальной сети Microsoft Azure, нет необходимости добавлять IP-адрес клиента в правила брандмауэра сервера базы данных SQL.

* Основные разрешения RBAC, необходимые для использования редактора запросов, — это доступ к серверу и базе данных в режиме "Только чтение". Любой пользователь с такими разрешениями получает доступ к функции редактора запросов. Чтобы ограничить доступ определенным пользователям, необходимо запретить им входить в редактор запросов с помощью Azure Active Directory или учетных данных проверки подлинности SQL. Если они не могут назначить себя администратором AAD для сервера, получить доступ к учетной записи администратора SQL или добавить ее, то у них не должно быть возможности использовать редактор запросов.

* Редактор запросов не поддерживает подключение к базе данных `master`.

* Редактор запросов не может подключиться к реплике базы данных с помощью `ApplicationIntent=ReadOnly`

* Если отображается сообщение об ошибке "Не удалось проверить заголовок X-CSRF-Signature", выполните следующие действия, чтобы устранить проблему:

    * Убедитесь, что на вашем компьютере правильно настроены время и часовой пояс. Вы также можете попытаться сопоставить часовой пояс компьютера с Azure, выполнив поиск часового пояса для своего экземпляра, например восточной части США, Тихоокеанского и т. д.
    * Если вы используете сеть прокси-сервера, убедитесь, что заголовок запроса X-CSRF-Signature не изменяется и не удаляется.

### <a name="other-considerations"></a>Другие замечания

* Если нажать клавишу **F5**, страница редактора запросов обновится, а выполняемый запрос будет закрыт.

* Время ожидания для выполнения запроса составляет 5 минут.

* Редактор запросов поддерживает только цилиндрическую проекцию для типов данных geography.

* Поддержка IntelliSense для таблиц и представлений баз данных отсутствует, но редактор поддерживает автозаполнение для введенных ранее имен.

## <a name="next-steps"></a>Дальнейшие действия

Подробнее о поддержке Transact-SQL (T-SQL) в Базе данных SQL Azure см. в разделе о [решении проблем, связанных с отличиями Transact-SQL, при миграции в Базу данных SQL](transact-sql-tsql-differences-sql-server.md).
