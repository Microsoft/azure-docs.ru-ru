---
title: Оценка уязвимостей SQL
titleSuffix: Azure SQL Database & SQL Managed Instance & Azure Synapse Analytics
description: Узнайте, как настроить оценку уязвимостей SQL и интерпретировать отчеты об оценке в базе данных SQL Azure, Управляемый экземпляр Azure SQL и Azure синапсе Analytics.
services: sql-database
ms.service: sql-db-mi
ms.subservice: security
ms.custom: sqldbrb=3
ms.devlang: ''
ms.topic: how-to
author: davidtrigano
ms.author: datrigan
ms.reviewer: vanto
ms.date: 02/11/2021
tags: azure-synapse
ms.openlocfilehash: 1719c5a7112ee32f86d0593d274a59638cf81a0e
ms.sourcegitcommit: 867cb1b7a1f3a1f0b427282c648d411d0ca4f81f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "100376649"
---
# <a name="sql-vulnerability-assessment-helps-you-identify-database-vulnerabilities"></a>Оценка уязвимостей SQL позволяет обнаруживать уязвимости базы данных
[!INCLUDE[appliesto-sqldb-sqlmi-asa](../includes/appliesto-sqldb-sqlmi-asa.md)]

Оценка уязвимостей SQL — это простая в настройке служба, которая может обнаруживать, записывать и помогать устранять потенциальные уязвимости базы данных. Используйте его, чтобы с упреждением повышать безопасность своей базы данных.

Оценка уязвимостей является частью предложения ["защитник Azure для SQL"](azure-defender-for-sql.md) , которое является единым пакетом для расширенных возможностей обеспечения безопасности SQL. Доступ к оценке уязвимостей и управление ими можно получить с помощью центрального портала Azure Defender для SQL.

> [!NOTE]
> Оценка уязвимостей поддерживается для базы данных SQL Azure, Azure SQL Управляемый экземпляр и Azure синапсе Analytics. В оставшейся части этой статьи в качестве баз данных используются базы данных SQL Azure, Azure SQL Управляемый экземпляр и Azure синапсе Analytics. сервер ссылается на [сервер](logical-servers.md) , на котором размещены базы данных SQL Azure и Azure синапсе.

## <a name="what-is-sql-vulnerability-assessment"></a>Что такое Оценка уязвимостей SQL?

Оценка уязвимостей SQL — это служба, которая обеспечивает видимость состояния безопасности. Оценка уязвимостей включает действия по устранению проблем безопасности и повышению уровня безопасности базы данных. Она помогает отслеживать динамическую среду базы данных, в которой изменения сложно отслеживать и улучшать безопасность SQL.

Оценка уязвимостей — это служба сканирования, встроенная в базу данных SQL Azure. Служба использует базу знаний правил, которые помечают уязвимости безопасности. Он выделяет отклонения от рекомендаций, таких как непредусмотренные настройки, чрезмерные разрешения и незащищенные конфиденциальные данные.

Правила основаны на рекомендациях корпорации Майкрософт и сосредоточены на вопросах безопасности, представляющих наибольшую опасность для базы данных и ее ценных данных. Они охватывают проблемы уровня базы данных и проблемы безопасности на уровне сервера, такие как параметры брандмауэра сервера и разрешения уровня сервера.

Результаты проверки включают в себя практические действия по устранению каждой проблемы, а также настроенные скрипты исправления, если их можно применить. Вы можете настроить отчет об оценке для своей среды, установив допустимый базовый план для:

- Конфигурации разрешений
- Конфигурации компонентов
- Параметры базы данных

## <a name="configure-vulnerability-assessment"></a>Настройка оценки уязвимостей

Чтобы настроить оценку уязвимостей, выполните следующие действия.

1. В [портал Azure](https://portal.azure.com)откройте конкретный ресурс в базе данных SQL Azure, базе данных SQL управляемый экземпляр или Azure синапсе.

1. Под заголовком **Безопасность** выберите **Центр безопасности**.

1. Щелкните **настроить** на ссылке, чтобы открыть область Параметры защитника Azure для SQL для всего сервера или управляемого экземпляра.

    :::image type="content" source="media/sql-vulnerability-assessment/opening-sql-configuration.png" alt-text="Открытие защитника для конфигурации SQL":::

    > [!NOTE]
    > Для оценки уязвимостей SQL требуется, чтобы план **SQL Defender** был доступен для выполнения проверок. Дополнительные сведения о том, как включить защитник Azure для SQL, см. в разделе [защитник Azure для SQL](azure-defender-for-sql.md).

1. На странице **Параметры сервера** укажите параметры защитника Azure для SQL:

    :::image type="content" source="media/sql-vulnerability-assessment/sql-vulnerability-scan-settings.png" alt-text="Настройка сканирования для оценки уязвимостей SQL":::

    1. Настройте учетную запись хранения, в которой будут храниться результаты проверки для всех баз данных на сервере или управляемом экземпляре. Дополнительные сведения об учетных записях хранения см. в разделе [Об учетных записях хранения Azure](../../storage/common/storage-account-create.md).

        > [!TIP]
        > Дополнительные сведения о хранении проверок оценки уязвимостей за брандмауэрами и виртуальных сетей см. [в статье Сохранение результатов проверки уязвимостей в учетной записи хранения, доступной через брандмауэры и виртуальных сетей](sql-database-vulnerability-assessment-storage.md).

    1. Чтобы настроить оценку уязвимостей для автоматического выполнения еженедельных сканирований с целью обнаружения непредусмотренных конфигураций безопасности, установите **периодические повторные проверки** в значение **вкл**. Результаты отправляются на адреса электронной почты, указанные при **отправке отчетов о сканировании**. Вы также можете отправить уведомление по электронной почте администраторам и владельцам подписки, включив **также отправку уведомлений по электронной почте администраторам и владельцам подписок**.

1. Сканирование для оценки уязвимостей SQL также можно выполнять по запросу:

    1. На странице **центра безопасности** ресурса выберите **Просмотреть дополнительные результаты в средстве оценки уязвимостей** , чтобы получить доступ к результатам проверки предыдущих проверок.

        :::image type="content" source="media/sql-vulnerability-assessment/view-additional-findings-link.png" alt-text="Открытие результатов проверки и параметров ручного сканирования":::

    1. Чтобы выполнить проверку по требованию для проверки базы данных на наличие уязвимостей, на панели инструментов нажмите кнопку **проверить** .

        :::image type="content" source="media/sql-vulnerability-assessment/on-demand-vulnerability-scan.png" alt-text="Выберите проверить, чтобы запустить сканирование для оценки уязвимости ресурса SQL по запросу.":::


  > [!NOTE]
  > Проверка безопасна и не требует большого количества ресурсов. Выполнение займет несколько секунд и полностью доступно только для чтения. Изменения в базе данных не вносятся.

## <a name="remediate-vulnerabilities"></a>Страница "Исправление уязвимостей"

После завершения проверки уязвимостей отчет отображается в портал Azure. Отчет представляет:

- Общие сведения о состоянии безопасности
- Число найденных проблем и
- Сводка по серьезности рисков
- Список полученных результатов для дальнейшего исследования

:::image type="content" source="media/sql-vulnerability-assessment/sample-sql-vulnerabilities-report.png" alt-text="Отчет о пробном сканировании от сканера оценки уязвимостей SQL":::

Исправление обнаруженных уязвимостей:

1. Проверьте результаты и определите, какие из результатов отчета являются настоящими проблемами безопасности для вашей среды.

1. Выберите каждый сбойный результат, чтобы понять его влияние и причину сбоя проверки безопасности.

    > [!TIP]
    > На странице сведения о выпусках содержатся действия по устранению неполадок, объясняющие, как устранить проблему.

    :::image type="content" source="media/sql-vulnerability-assessment/examining-vulnerability-findings.gif" alt-text="Проверка результатов проверки уязвимостей":::

1. При проверке результатов оценки можно пометить конкретные результаты как приемлемые *базовые показатели* в вашей среде. Базовый план — это, по сути, Настройка того, как сообщаются результаты. При последующих проверках результаты, соответствующие базовому плану, считаются пройденными. После того как вы установили базовое состояние безопасности, Оценка уязвимостей будет сообщать только об отклонениях от базовых показателей. Таким образом вы можете сосредоточиться на соответствующих проблемах.

    :::image type="content" source="media/sql-vulnerability-assessment/baseline-approval.png" alt-text="Утверждение поиска в качестве базового показателя для будущих проверок":::

1. При изменении базовых показателей используйте кнопку **Scan (сканирование** ), чтобы выполнить проверку по требованию и просмотреть настроенный отчет. Все выводы, добавленные к базовому плану, теперь отображаются в списке **пройдены** с указанием того, что они прошли из-за изменений базовых показателей.

    :::image type="content" source="media/sql-vulnerability-assessment/passed-per-custom-baseline.png" alt-text="Пройденные оценки, указывающие, что они прошли на пользовательский базовый план":::

Теперь можно использовать сканирование оценки уязвимостей, чтобы обеспечить высокий уровень безопасности базы данных и соблюдение политик организации. 

## <a name="advanced-capabilities"></a>Расширенные возможности

### <a name="export-an-assessment-report"></a>Экспорт отчета об оценке

Выберите **экспортировать результаты проверки** , чтобы создать загружаемый отчет Excel о результатах проверки. Этот отчет содержит сводную вкладку, в которой отображается сводка оценки. Отчет содержит все неудачные проверки. Она также содержит вкладку **результаты** , содержащую полный набор результатов проверки. Результаты включают все выполненные проверки и подробные сведения о результатах для каждого из них.

### <a name="view-scan-history"></a>Просмотр журнала сканирования

В области Оценка уязвимостей выберите **журнал сканирования** , чтобы просмотреть журнал всех проверок, ранее запущенных в этой базе данных. Выберите определенное сканирование из списка, чтобы просмотреть подробные результаты.

## <a name="manage-vulnerability-assessments-programmatically"></a>Программное управление оценками уязвимостей

### <a name="using-azure-powershell"></a>Использование Azure PowerShell

[!INCLUDE [updated-for-az](../../../includes/updated-for-az.md)]
> [!IMPORTANT]
> Модуль PowerShell Azure Resource Manager по-прежнему поддерживается, но вся будущая разработка предназначена для модуля AZ. SQL. Сведения об этих командлетах см. в разделе [AzureRM.Sql](/powershell/module/AzureRM.Sql/). Аргументы команд в модулях Az и AzureRm практически идентичны.

Для программного управления оценками уязвимостей можно использовать командлеты Azure PowerShell. Поддерживаемые командлеты:

| Имя командлета в качестве ссылки | Описание |
| :-------------------- | :---------- |
| [Clear-Азсклдатабасевулнерабилитяссессментрулебаселине](/powershell/module/az.sql/Clear-azSqlDatabaseVulnerabilityAssessmentRuleBaseline) | Очищает базовое правило оценки уязвимости.<br/>Сначала установите базовый план, прежде чем использовать этот командлет для его очистки. |
| [Clear-Азсклдатабасевулнерабилитяссессментсеттинг](/powershell/module/az.sql/Clear-azSqlDatabaseVulnerabilityAssessmentSetting) | Очищает параметры оценки уязвимостей базы данных. |
| [Clear-Азсклинстанцедатабасевулнерабилитяссессментрулебаселине](/powershell/module/az.sql/Clear-AzSqlInstanceDatabaseVulnerabilityAssessmentRuleBaseline) | Очищает базовый план правила оценки уязвимостей управляемой базы данных.<br/>Сначала установите базовый план, прежде чем использовать этот командлет для его очистки. |
| [Clear-Азсклинстанцедатабасевулнерабилитяссессментсеттинг](/powershell/module/az.sql/Clear-AzSqlInstanceDatabaseVulnerabilityAssessmentSetting) | Очищает параметры оценки уязвимостей управляемой базы данных. |
| [Clear-Азсклинстанцевулнерабилитяссессментсеттинг](/powershell/module/az.sql/Clear-AzSqlInstanceVulnerabilityAssessmentSetting) | Очищает параметры оценки уязвимостей управляемого экземпляра. |
| [Convert-Азсклдатабасевулнерабилитяссессментскан](/powershell/module/az.sql/Convert-azSqlDatabaseVulnerabilityAssessmentScan) | Преобразует результаты сканирования оценки уязвимостей базы данных в файл Excel. |
| [Convert-Азсклинстанцедатабасевулнерабилитяссессментскан](/powershell/module/az.sql/Convert-AzSqlInstanceDatabaseVulnerabilityAssessmentScan) | Результаты сканирования оценки уязвимостей управляемой базы данных преобразуются в файл Excel. |
| [Get-Азсклдатабасевулнерабилитяссессментрулебаселине](/powershell/module/az.sql/Get-azSqlDatabaseVulnerabilityAssessmentRuleBaseline) | Возвращает базовый план правила оценки уязвимости базы данных для данного правила. |
| [Get-Азсклинстанцедатабасевулнерабилитяссессментрулебаселине](/powershell/module/az.sql/Get-AzSqlInstanceDatabaseVulnerabilityAssessmentRuleBaseline) | Возвращает базовый план правила оценки уязвимости управляемой базы данных для данного правила. |
| [Get-Азсклдатабасевулнерабилитяссессментсканрекорд](/powershell/module/az.sql/Get-azSqlDatabaseVulnerabilityAssessmentScanRecord) | Возвращает все записи просмотра оценки уязвимостей, связанные с заданной базой данных. |
| [Get-Азсклинстанцедатабасевулнерабилитяссессментсканрекорд](/powershell/module/az.sql/Get-AzSqlInstanceDatabaseVulnerabilityAssessmentScanRecord) | Возвращает все записи просмотра оценки уязвимостей, связанные с заданной управляемой базой данных. |
| [Get-Азсклдатабасевулнерабилитяссессментсеттинг](/powershell/module/az.sql/Get-azSqlDatabaseVulnerabilityAssessmentSetting) | Возвращает параметры оценки уязвимостей базы данных. |
| [Get-Азсклинстанцедатабасевулнерабилитяссессментсеттинг](/powershell/module/az.sql/Get-AzSqlInstanceDatabaseVulnerabilityAssessmentSetting) | Возвращает параметры оценки уязвимостей управляемой базы данных. |
| [Set-Азсклдатабасевулнерабилитяссессментрулебаселине](/powershell/module/az.sql/Set-azSqlDatabaseVulnerabilityAssessmentRuleBaseline) | Устанавливает базовое правило для оценки уязвимости. |
| [Set-Азсклинстанцедатабасевулнерабилитяссессментрулебаселине](/powershell/module/az.sql/Set-AzSqlInstanceDatabaseVulnerabilityAssessmentRuleBaseline) | Задает базовый план правила оценки уязвимостей для управляемой базы данных. |
| [Start-Азсклдатабасевулнерабилитяссессментскан](/powershell/module/az.sql/Start-azSqlDatabaseVulnerabilityAssessmentScan) | Активирует запуск сканирования оценки уязвимостей в базе данных. |
| [Start-Азсклинстанцедатабасевулнерабилитяссессментскан](/powershell/module/az.sql/Start-AzSqlInstanceDatabaseVulnerabilityAssessmentScan) | Активирует запуск сканирования оценки уязвимостей в управляемой базе данных. |
| [Update-Азсклдатабасевулнерабилитяссессментсеттинг](/powershell/module/az.sql/Update-azSqlDatabaseVulnerabilityAssessmentSetting) | Обновляет параметры оценки уязвимостей базы данных. |
| [Update-Азсклинстанцедатабасевулнерабилитяссессментсеттинг](/powershell/module/az.sql/Update-AzSqlInstanceDatabaseVulnerabilityAssessmentSetting) | Обновляет параметры оценки уязвимостей управляемой базы данных. |
| [Update-Азсклинстанцевулнерабилитяссессментсеттинг](/powershell/module/az.sql/Update-AzSqlInstanceVulnerabilityAssessmentSetting) | Обновляет параметры оценки уязвимостей управляемого экземпляра. |
| &nbsp; | &nbsp; |

Пример сценария см. в статье [Поддержка PowerShell для оценки уязвимостей SQL Azure](/archive/blogs/sqlsecurity/azure-sql-vulnerability-assessment-now-with-powershell-support).

### <a name="using-resource-manager-templates"></a>Использование шаблонов Resource Manager

Чтобы настроить базовые показатели оценки уязвимостей с помощью шаблонов Azure Resource Manager, используйте `Microsoft.Sql/servers/databases/vulnerabilityAssessments/rules/baselines` тип.

Перед добавлением базовых показателей убедитесь, что вы включили `vulnerabilityAssessments` .

Ниже приведен пример определения базового правила VA2065 для `master` базы данных и VA1143 в `user` базу данных в качестве ресурсов в шаблоне диспетчер ресурсов.

```json
   "resources": [
      {
         "type": "Microsoft.Sql/servers/databases/vulnerabilityAssessments/rules/baselines",
         "apiVersion": "2018-06-01-preview",
         "name": "[concat(parameters('server_name'),'/', parameters('database_name') , '/default/VA2065/master')]",
         "properties": {
            "baselineResults": [
               {
                  "result": [
                     "FirewallRuleName3",
                     "StartIpAddress",
                     "EndIpAddress"
                  ]
               },
               {
                  "result": [
                     "FirewallRuleName4",
                     "62.92.15.68",
                     "62.92.15.68"
                  ]
               }
            ]
         },
         "type": "Microsoft.Sql/servers/databases/vulnerabilityAssessments/rules/baselines",
         "apiVersion": "2018-06-01-preview",
         "name": "[concat(parameters('server_name'),'/', parameters('database_name'), '/default/VA2130/Default')]",
         "dependsOn": [
            "[resourceId('Microsoft.Sql/servers/vulnerabilityAssessments', parameters('server_name'), 'Default')]"
         ],
         "properties": {
            "baselineResults": [
               {
                  "result": [
                     "dbo"
                  ]
               }
            ]
         }
      }
   ]
```

Для `master` базы данных и `user` базы данных имена ресурсов определяются по-разному:

- База данных master-"имя": "[Concat (параметры (" server_name "),"/", параметры (" database_name "),"/default/VA2065/<b>master</b>")]",
- Пользовательская база данных-"имя": "[Concat (параметры (" server_name "),"/", параметры (" database_name "),"/default/VA2065/<b>Default</b>")]",

Для управления логическими типами как true или false установите базовый результат с двоичным входом, например "1"/"0".

```json
   {
      "type": "Microsoft.Sql/servers/databases/vulnerabilityAssessments/rules/baselines",
      "apiVersion": "2018-06-01-preview",
      "name": "[concat(parameters('server_name'),'/', parameters('database_name'), '/default/VA1143/Default')]",

      "dependsOn": [
         "[resourceId('Microsoft.Sql/servers/vulnerabilityAssessments', parameters('server_name'), 'Default')]"
      ],

      "properties": {
         "baselineResults": [
            {
               "result": [
                  "1"
               ]
            }
         ]
      }

   }
```

## <a name="next-steps"></a>Дальнейшие действия  

- [Узнайте больше про Azure Defender для SQL](azure-defender-for-sql.md).
- Дополнительные сведения об [обнаружении и классификации данных](data-discovery-and-classification-overview.md).
- Дополнительные сведения о [хранении результатов проверки уязвимостей см. в статье учетная запись хранения, доступная в защищенных брандмауэрах и виртуальных сетей](sql-database-vulnerability-assessment-storage.md).