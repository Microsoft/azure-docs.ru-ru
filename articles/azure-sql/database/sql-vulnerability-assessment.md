---
title: Оценка уязвимостей SQL
titleSuffix: Azure SQL Database & SQL Managed Instance & Azure Synapse Analytics
description: Узнайте, как настроить оценку уязвимостей SQL и интерпретировать отчеты об оценке в базе данных SQL Azure, Управляемый экземпляр Azure SQL и Azure синапсе Analytics.
services: sql-database
ms.service: sql-db-mi
ms.subservice: security
ms.custom: sqldbrb=3
ms.devlang: ''
ms.topic: how-to
author: davidtrigano
ms.author: datrigan
ms.reviewer: vanto
ms.date: 09/21/2020
tags: azure-synapse
ms.openlocfilehash: 67258a19d1efe605a3a0b2227f107cc1928a207a
ms.sourcegitcommit: 8245325f9170371e08bbc66da7a6c292bbbd94cc
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/07/2021
ms.locfileid: "99806398"
---
# <a name="sql-vulnerability-assessment-helps-you-identify-database-vulnerabilities"></a>Оценка уязвимостей SQL позволяет обнаруживать уязвимости базы данных
[!INCLUDE[appliesto-sqldb-sqlmi-asa](../includes/appliesto-sqldb-sqlmi-asa.md)]

Оценка уязвимостей SQL — это простая в настройке служба, которая может обнаруживать, записывать и помогать устранять потенциальные уязвимости базы данных. Используйте его, чтобы с упреждением повышать безопасность своей базы данных.

Оценка уязвимостей является частью предложения ["защитник Azure для SQL"](azure-defender-for-sql.md) , которое является единым пакетом для расширенных возможностей обеспечения безопасности SQL. Доступ к оценке уязвимостей и управление ими можно получить с помощью центрального портала Azure Defender для SQL.

> [!NOTE]
> Оценка уязвимостей поддерживается для базы данных SQL Azure, Azure SQL Управляемый экземпляр и Azure синапсе Analytics. В оставшейся части этой статьи в качестве баз данных используются базы данных SQL Azure, Azure SQL Управляемый экземпляр и Azure синапсе Analytics. сервер ссылается на [сервер](logical-servers.md) , на котором размещены базы данных SQL Azure и Azure синапсе.

## <a name="what-is-sql-vulnerability-assessment"></a>Что такое Оценка уязвимостей SQL?

Оценка уязвимостей SQL — это служба, которая обеспечивает видимость состояния безопасности. Оценка уязвимостей включает действия по устранению проблем безопасности и повышению уровня безопасности базы данных. Она помогает отслеживать динамическую среду базы данных, в которой изменения сложно отслеживать и улучшать безопасность SQL.

Оценка уязвимостей — это служба сканирования, встроенная в базу данных SQL Azure. Служба использует базу знаний правил, которые помечают уязвимости безопасности. Он выделяет отклонения от рекомендаций, таких как непредусмотренные настройки, чрезмерные разрешения и незащищенные конфиденциальные данные.

Правила основаны на рекомендациях корпорации Майкрософт и сосредоточены на вопросах безопасности, представляющих наибольшую опасность для базы данных и ее ценных данных. Они охватывают проблемы уровня базы данных и проблемы безопасности на уровне сервера, такие как параметры брандмауэра сервера и разрешения уровня сервера.

Результаты проверки включают в себя практические действия по устранению каждой проблемы, а также настроенные скрипты исправления, если их можно применить. Вы можете настроить отчет об оценке для своей среды, установив допустимый базовый план для:

- Конфигурации разрешений
- Конфигурации компонентов
- Параметры базы данных

## <a name="configure-vulnerability-assessment"></a>Настройка оценки уязвимостей

Ниже приведены действия по настройке оценки уязвимостей.

1. Перейдите к базе данных SQL Azure, базе данных SQL Управляемый экземпляр или ресурсу Azure синапсе в [портал Azure](https://portal.azure.com).

2. Под заголовком **Безопасность** выберите **Центр безопасности**.

3. Затем щелкните **настроить** в ссылке, чтобы открыть панель параметров защитника Azure для SQL для всего сервера или управляемого экземпляра.

    > [!NOTE]
    > Для оценки уязвимостей SQL требуется, чтобы план **SQL Defender** был доступен для выполнения проверок. Дополнительные сведения о том, как включить защитник Azure для SQL, см. в разделе [защитник Azure для SQL](azure-defender-for-sql.md).

4. Настройте учетную запись хранения, в которой будут храниться результаты проверки для всех баз данных на сервере или управляемом экземпляре. Дополнительные сведения об учетных записях хранения см. в разделе [Об учетных записях хранения Azure](../../storage/common/storage-account-create.md).

    > [!NOTE]
    > Дополнительные сведения о хранении проверок оценки уязвимостей за брандмауэрами и виртуальных сетей см. [в статье Сохранение результатов проверки уязвимостей в учетной записи хранения, доступной через брандмауэры и виртуальных сетей](sql-database-vulnerability-assessment-storage.md).

5. Настройка оценки уязвимостей SQL для автоматического запуска периодических регулярных проверок в течение недели для автоматического обнаружения изменений в настройках безопасности. Для этого включите **периодические повторяющиеся проверки** при выборе учетной записи хранения. Сводка результатов сканирования отправляется на адреса электронной почты, указанные при **отправке отчетов о сканировании**. Вы также можете отправить уведомление по электронной почте администраторам и владельцам подписки, включив **также отправку уведомлений по электронной почте администраторам и владельцам подписок**.

6. Оценка уязвимостей SQL может выполнять проверку по запросу. После настройки оценки уязвимостей SQL выберите **Scan (сканировать** ), чтобы проверить базу данных на наличие уязвимостей.

![Проверка базы данных](./media/sql-vulnerability-assessment/pp_va_initialize.png)

  > [!NOTE]
  > Проверка безопасна и не требует большого количества ресурсов. Выполнение займет несколько секунд и полностью доступно только для чтения. Изменения в базе данных не вносятся.

## <a name="remediate-vulnerabilities"></a>Страница "Исправление уязвимостей"

1. После завершения проверки отчет о проверке автоматически отображается в портал Azure. В отчете представлен обзор состояния безопасности. В нем указывается, сколько обнаруженных проблем и их серьезность. Результаты включают предупреждения о отклонениях от рекомендаций и моментальный снимок параметров безопасности, таких как субъекты и роли базы данных, а также связанные с ними разрешения.

![Просмотр отчета](./media/sql-vulnerability-assessment/pp_main_getstarted.png)

2. Просмотрите результаты и определите, какие проблемы в отчете действительно нарушают безопасность в вашей среде. Выполните детализацию до каждого неудачного результата, чтобы понять влияние полученных результатов и причины сбоя при проверке безопасности. Чтобы устранить проблемы, используйте сведения об исправлении, предоставленные в отчете.

![Анализ отчета](./media/sql-vulnerability-assessment/pp_fail_rule_show_remediation.png)

3. При проверке результатов оценки можно пометить конкретные результаты как приемлемые *базовые показатели* в вашей среде. Базовые показатели — важные параметры, влияющие на содержимое отчета о проверке. При следующих проверках результаты, которые соответствуют базовым показателям, будут рассматриваться как прошедшие проверку. После того как вы установили базовое состояние безопасности, Оценка уязвимостей будет сообщать только об отклонениях от базовых показателей. Таким образом вы можете сосредоточиться на соответствующих проблемах.

![Настройка базовых показателей](./media/sql-vulnerability-assessment/pp_fail_rule_show_baseline.png)

4. После завершения настройки **базовых показателей правил** запустите новую проверку, чтобы просмотреть настроенный отчет. Оценка уязвимостей теперь сообщает только о проблемах безопасности, которые отличаются от утвержденного базового состояния.

![Просмотр настраиваемого отчета](./media/sql-vulnerability-assessment/pp_pass_main_with_baselines.png)

Теперь службу оценки уязвимостей можно использовать, чтобы постоянно отслеживать безопасность базы данных и обеспечивать ее высокий уровень, а также следить за соблюдением политик организации. 

## <a name="advanced-capabilities"></a>Расширенные возможности

### <a name="export-an-assessment-report"></a>Экспорт отчета об оценке

Выберите **экспортировать результаты проверки** , чтобы создать загружаемый отчет Excel о результатах проверки. Этот отчет содержит сводную вкладку, в которой отображается сводка оценки. Отчет содержит все неудачные проверки. Она также содержит вкладку **результаты** , содержащую полный набор результатов проверки. Результаты включают все выполненные проверки и подробные сведения о результатах для каждого из них.

### <a name="view-scan-history"></a>Просмотр журнала сканирования

В области Оценка уязвимостей выберите **журнал сканирования** , чтобы просмотреть журнал всех проверок, ранее запущенных в этой базе данных. Выберите определенное сканирование из списка, чтобы просмотреть подробные результаты.

## <a name="manage-vulnerability-assessments-programmatically"></a>Программное управление оценками уязвимостей

### <a name="using-azure-powershell"></a>Использование Azure PowerShell

[!INCLUDE [updated-for-az](../../../includes/updated-for-az.md)]
> [!IMPORTANT]
> Модуль PowerShell Azure Resource Manager по-прежнему поддерживается, но вся будущая разработка предназначена для модуля AZ. SQL. Сведения об этих командлетах см. в разделе [AzureRM.Sql](/powershell/module/AzureRM.Sql/). Аргументы команд в модулях Az и AzureRm практически идентичны.

Для программного управления оценками уязвимостей можно использовать командлеты Azure PowerShell. Поддерживаемые командлеты:

| Имя командлета в качестве ссылки | Описание |
| :-------------------- | :---------- |
| [Clear-Азсклдатабасевулнерабилитяссессментрулебаселине](/powershell/module/az.sql/Clear-azSqlDatabaseVulnerabilityAssessmentRuleBaseline) | Очищает базовый план правила оценки уязвимостей.<br/>Сначала установите базовый план, прежде чем использовать этот командлет для его очистки. |
| [Clear-Азсклдатабасевулнерабилитяссессментсеттинг](/powershell/module/az.sql/Clear-azSqlDatabaseVulnerabilityAssessmentSetting) | Очищает параметры оценки уязвимостей базы данных. |
| [Clear-Азсклинстанцедатабасевулнерабилитяссессментрулебаселине](/powershell/module/az.sql/Clear-AzSqlInstanceDatabaseVulnerabilityAssessmentRuleBaseline) | Очищает базовый план правила оценки уязвимостей управляемой базы данных.<br/>Сначала установите базовый план, прежде чем использовать этот командлет для его очистки. |
| [Clear-Азсклинстанцедатабасевулнерабилитяссессментсеттинг](/powershell/module/az.sql/Clear-AzSqlInstanceDatabaseVulnerabilityAssessmentSetting) | Очищает параметры оценки уязвимостей управляемой базы данных. |
| [Clear-Азсклинстанцевулнерабилитяссессментсеттинг](/powershell/module/az.sql/Clear-AzSqlInstanceVulnerabilityAssessmentSetting) | Очищает параметры оценки уязвимостей управляемого экземпляра. |
| [Convert-Азсклдатабасевулнерабилитяссессментскан](/powershell/module/az.sql/Convert-azSqlDatabaseVulnerabilityAssessmentScan) | Преобразует результаты сканирования оценки уязвимостей базы данных в файл Excel. |
| [Convert-Азсклинстанцедатабасевулнерабилитяссессментскан](/powershell/module/az.sql/Convert-AzSqlInstanceDatabaseVulnerabilityAssessmentScan) | Результаты сканирования оценки уязвимостей управляемой базы данных преобразуются в файл Excel. |
| [Get-Азсклдатабасевулнерабилитяссессментрулебаселине](/powershell/module/az.sql/Get-azSqlDatabaseVulnerabilityAssessmentRuleBaseline) | Возвращает базовый план правила оценки уязвимости базы данных для данного правила. |
| [Get-Азсклинстанцедатабасевулнерабилитяссессментрулебаселине](/powershell/module/az.sql/Get-AzSqlInstanceDatabaseVulnerabilityAssessmentRuleBaseline) | Возвращает базовый план правила оценки уязвимости управляемой базы данных для данного правила. |
| [Get-Азсклдатабасевулнерабилитяссессментсканрекорд](/powershell/module/az.sql/Get-azSqlDatabaseVulnerabilityAssessmentScanRecord) | Возвращает все записи просмотра оценки уязвимостей, связанные с заданной базой данных. |
| [Get-Азсклинстанцедатабасевулнерабилитяссессментсканрекорд](/powershell/module/az.sql/Get-AzSqlInstanceDatabaseVulnerabilityAssessmentScanRecord) | Возвращает все записи просмотра оценки уязвимостей, связанные с заданной управляемой базой данных. |
| [Get-Азсклдатабасевулнерабилитяссессментсеттинг](/powershell/module/az.sql/Get-azSqlDatabaseVulnerabilityAssessmentSetting) | Возвращает параметры оценки уязвимостей базы данных. |
| [Get-Азсклинстанцедатабасевулнерабилитяссессментсеттинг](/powershell/module/az.sql/Get-AzSqlInstanceDatabaseVulnerabilityAssessmentSetting) | Возвращает параметры оценки уязвимостей управляемой базы данных. |
| [Set-Азсклдатабасевулнерабилитяссессментрулебаселине](/powershell/module/az.sql/Set-azSqlDatabaseVulnerabilityAssessmentRuleBaseline) | Задает базовый план правила оценки уязвимостей. |
| [Set-Азсклинстанцедатабасевулнерабилитяссессментрулебаселине](/powershell/module/az.sql/Set-AzSqlInstanceDatabaseVulnerabilityAssessmentRuleBaseline) | Задает базовый план правила оценки уязвимостей для управляемой базы данных. |
| [Start-Азсклдатабасевулнерабилитяссессментскан](/powershell/module/az.sql/Start-azSqlDatabaseVulnerabilityAssessmentScan) | Активирует запуск сканирования оценки уязвимостей в базе данных. |
| [Start-Азсклинстанцедатабасевулнерабилитяссессментскан](/powershell/module/az.sql/Start-AzSqlInstanceDatabaseVulnerabilityAssessmentScan) | Активирует запуск сканирования оценки уязвимостей в управляемой базе данных. |
| [Update-Азсклдатабасевулнерабилитяссессментсеттинг](/powershell/module/az.sql/Update-azSqlDatabaseVulnerabilityAssessmentSetting) | Обновляет параметры оценки уязвимостей базы данных. |
| [Update-Азсклинстанцедатабасевулнерабилитяссессментсеттинг](/powershell/module/az.sql/Update-AzSqlInstanceDatabaseVulnerabilityAssessmentSetting) | Обновляет параметры оценки уязвимостей управляемой базы данных. |
| [Update-Азсклинстанцевулнерабилитяссессментсеттинг](/powershell/module/az.sql/Update-AzSqlInstanceVulnerabilityAssessmentSetting) | Обновляет параметры оценки уязвимостей управляемого экземпляра. |
| &nbsp; | &nbsp; |

Пример сценария см. в разделе [Azure SQL Vulnerability Assessment PowerShell support](/archive/blogs/sqlsecurity/azure-sql-vulnerability-assessment-now-with-powershell-support) (Поддержка PowerShell для оценки уязвимостей Azure SQL).

### <a name="using-resource-manager-templates"></a>Использование шаблонов Resource Manager

Чтобы настроить базовые показатели оценки уязвимостей с помощью шаблонов Azure Resource Manager, используйте `Microsoft.Sql/servers/databases/vulnerabilityAssessments/rules/baselines` тип.

Перед добавлением базовых показателей убедитесь, что вы включили `vulnerabilityAssessments` .

Ниже приведен пример определения базового правила VA2065 для `master` базы данных и VA1143 в `user` базу данных в качестве ресурсов в шаблоне диспетчер ресурсов.

```json
   "resources": [
      {
         "type": "Microsoft.Sql/servers/databases/vulnerabilityAssessments/rules/baselines",
         "apiVersion": "2018-06-01-preview",
         "name": "[concat(parameters('server_name'),'/', parameters('database_name') , '/default/VA2065/master')]",
         "properties": {
            "baselineResults": [
               {
                  "result": [
                     "FirewallRuleName3",
                     "StartIpAddress",
                     "EndIpAddress"
                  ]
               },
               {
                  "result": [
                     "FirewallRuleName4",
                     "62.92.15.68",
                     "62.92.15.68"
                  ]
               }
            ]
         },
         "type": "Microsoft.Sql/servers/databases/vulnerabilityAssessments/rules/baselines",
         "apiVersion": "2018-06-01-preview",
         "name": "[concat(parameters('server_name'),'/', parameters('database_name'), '/default/VA2130/Default')]",
         "dependsOn": [
            "[resourceId('Microsoft.Sql/servers/vulnerabilityAssessments', parameters('server_name'), 'Default')]"
         ],
         "properties": {
            "baselineResults": [
               {
                  "result": [
                     "dbo"
                  ]
               }
            ]
         }
      }
   ]
```

Для `master` базы данных и `user` базы данных имена ресурсов определяются по-разному:

- База данных master-"имя": "[Concat (параметры (" server_name "),"/", параметры (" database_name "),"/default/VA2065/<b>master</b>")]",
- Пользовательская база данных-"имя": "[Concat (параметры (" server_name "),"/", параметры (" database_name "),"/default/VA2065/<b>Default</b>")]",

Для управления логическими типами как true или false установите базовый результат с двоичным входом, например "1"/"0".

```json
   {
      "type": "Microsoft.Sql/servers/databases/vulnerabilityAssessments/rules/baselines",
      "apiVersion": "2018-06-01-preview",
      "name": "[concat(parameters('server_name'),'/', parameters('database_name'), '/default/VA1143/Default')]",

      "dependsOn": [
         "[resourceId('Microsoft.Sql/servers/vulnerabilityAssessments', parameters('server_name'), 'Default')]"
      ],

      "properties": {
         "baselineResults": [
            {
               "result": [
                  "1"
               ]
            }
         ]
      }

   }
```

## <a name="next-steps"></a>Дальнейшие действия  

- [Узнайте больше про Azure Defender для SQL](azure-defender-for-sql.md).
- Дополнительные сведения об [обнаружении и классификации данных](data-discovery-and-classification-overview.md).
- Сведения о [хранении результатов проверки уязвимостей в учетной записи хранения, доступной в защищенных брандмауэрах и виртуальных сетей](sql-database-vulnerability-assessment-storage.md).
