---
title: План для событий обслуживания Azure
description: Узнайте, как подготовиться к запланированным событиям обслуживания в базе данных SQL Azure и Управляемый экземпляр Azure SQL.
services: sql-database
ms.service: sql-db-mi
ms.subservice: service
ms.custom: sqldbrb=1
ms.devlang: ''
ms.topic: conceptual
author: aamalvea
ms.author: aamalvea
ms.reviewer: sstein
ms.date: 1/21/2021
ms.openlocfilehash: d38ac9731959cf9a23052753b09c9e7819846705
ms.sourcegitcommit: 910a1a38711966cb171050db245fc3b22abc8c5f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "101664123"
---
# <a name="plan-for-azure-maintenance-events-in-azure-sql-database-and-azure-sql-managed-instance"></a>Планирование событий обслуживания Azure в базе данных SQL Azure и Управляемый экземпляр Azure SQL
[!INCLUDE[appliesto-sqldb-sqlmi](../includes/appliesto-sqldb-sqlmi.md)]

Узнайте, как подготовиться к запланированным событиям обслуживания базы данных в базе данных SQL Azure и Управляемый экземпляр Azure SQL.

## <a name="what-is-a-planned-maintenance-event"></a>Что такое событие планового обслуживания?

Чтобы обеспечить безопасность, соответствие, стабильность и работоспособность базы данных SQL Azure и служб SQL Azure Управляемый экземпляр Services, обновления выполняются через компоненты службы почти постоянно. Благодаря современной и надежной архитектуре служб и инновационным технологиям, таким как [горячее исправление](https://aka.ms/azuresqlhotpatching), большинство обновлений полностью прозрачны и не затрагиваются в отношении доступности служб. Однако некоторые типы обновлений вызывают короткие перерывы в обслуживании и нуждаются в специальной обработке. 

Для каждой базы данных SQL Azure и Azure SQL Управляемый экземпляр поддерживать кворум реплик баз данных, в которых одна реплика является первичной. В любой момент первичная реплика должна быть интерактивным обслуживанием, и хотя бы одна вторичная реплика должна быть работоспособной. Во время планового обслуживания участники кворума базы данных будут переходить в автономный режим по одному, соблюдая условие наличия одной первичной реплики, отвечающей на запросы, и по крайней мере одной подключенной вторичной реплики, чтобы предотвратить простой клиента. Когда первичную реплику необходимо перевести в автономный режим, возникнет процесс перенастройки или отработки отказа, в результате которого одна вторичная реплика станет новой первичной.  

## <a name="what-to-expect-during-a-planned-maintenance-event"></a>Что происходит во время события планового обслуживания

Событие обслуживания может создавать одну или несколько отработок отказа в зависимости от несчастливых первичной и вторичной реплик в начале события обслуживания. В среднем 1,7 отработки отказа происходит в соответствии с запланированным событием обслуживания. Перенастройка или отработка отказа обычно завершается в течение 30 секунд. Среднее значение составляет восемь секунд. Если подключение уже установлено, приложение должно повторно подключиться к новой первичной реплике базы данных. Если при попытке выполнить новое подключение происходит перенастройка базы данных до того, как новая первичная реплика будет подключена к сети, возникает ошибка 40613 (база данных недоступна): *"база данных" {DatabaseName} "на сервере" {servername} "в настоящее время недоступна. Повторите попытку подключения позже ".* Если база данных имеет длительный запрос, этот запрос будет прерван во время перенастройки и потребуется перезапуститься.

## <a name="how-to-simulate-a-planned-maintenance-event"></a>Имитация события запланированного обслуживания

Обеспечение устойчивости клиентского приложения к событиям обслуживания до развертывания в рабочей среде поможет снизить риск сбоев приложений и повлиять на доступность приложений для конечных пользователей. Поведение клиентского приложения можно проверить во время запланированного обслуживания, [инициируя отработку отказа вручную](https://aka.ms/mifailover-techblog) с помощью PowerShell, интерфейса командной строки или REST API. Он будет создавать идентичное поведение, как событие обслуживания, приведя первичную реплику в автономный режим.

## <a name="retry-logic"></a>Логика повторных попыток

Для любого клиентского приложения в рабочей среде, которое подключается к облачной службе базы данных, следует реализовать [надежную логику повторных попыток подключения](troubleshoot-common-connectivity-issues.md#retry-logic-for-transient-errors). Это поможет сделать отработку отказа прозрачной для конечных пользователей или минимум уменьшить негативные последствия.

## <a name="resource-health"></a>Работоспособность ресурса

Если в базе данных возникают ошибки входа в систему, Проверьте текущее состояние в окне [работоспособность ресурсов](../../service-health/resource-health-overview.md#get-started) в [портал Azure](https://portal.azure.com) . Раздел "Работоспособность ресурсов" содержит причину простоя для каждого события (если она доступна).

## <a name="maintenance-window-feature"></a>Функция периода обслуживания

Функция периода обслуживания позволяет настраивать расписания прогнозируемого периода обслуживания для доступных баз данных SQL Azure и управляемых экземпляров SQL. Дополнительные сведения см. в разделе [окно обслуживания](maintenance-window.md) .

## <a name="next-steps"></a>Дальнейшие действия

- Дополнительные сведения о [работоспособность ресурсов](resource-health-to-troubleshoot-connectivity.md) для базы данных SQL azure и управляемый экземпляр SQL Azure.
- Дополнительные сведения о логике повторных попыток см. в разделе [логика повторных попыток для временных ошибок](troubleshoot-common-connectivity-issues.md#retry-logic-for-transient-errors).
- Настройте расписания периодов обслуживания с помощью функции [периода обслуживания](maintenance-window.md) .
