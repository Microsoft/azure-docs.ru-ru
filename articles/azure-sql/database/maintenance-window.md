---
title: Период обслуживания
description: Узнайте, как можно настроить окно обслуживания базы данных SQL Azure и управляемого экземпляра.
services: sql-database
ms.service: sql-db-mi
ms.subservice: service
ms.topic: conceptual
author: WilliamDAssafMSFT
ms.author: wiassaf
ms.reviewer: sstein
ms.custom: references_regions
ms.date: 03/11/2021
ms.openlocfilehash: bd91c29ca97c2096c4d8f3df19dbb9eab306b8e7
ms.sourcegitcommit: 772eb9c6684dd4864e0ba507945a83e48b8c16f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/20/2021
ms.locfileid: "103149755"
---
# <a name="maintenance-window-preview"></a>Период обслуживания (Предварительная версия)
[!INCLUDE[appliesto-sqldb-sqlmi](../includes/appliesto-sqldb-sqlmi.md)]

С помощью функции "период обслуживания" можно настроить расписание обслуживания для [базы данных SQL Azure](sql-database-paas-overview.md) и ресурсов [управляемого экземпляра SQL Azure](../managed-instance/sql-managed-instance-paas-overview.md) , что позволяет предсказуемо и менее сильно нарушить работу рабочей нагрузки. 

> [!Note]
> Функция периода обслуживания не защищает от незапланированных событий, таких как сбои оборудования, которые могут привести к короткому перерыву в соединении.

## <a name="overview"></a>Обзор

Azure периодически выполняет [плановое обслуживание](planned-maintenance.md) базы данных SQL и ресурсов управляемого экземпляра SQL. Во время события обслуживания SQL Azure базы данных полностью доступны, но могут подвергаться короткой отработке отказа в рамках соответствующих соглашений об уровне обслуживания для [базы данных SQL](https://azure.microsoft.com/support/legal/sla/sql-database) и [управляемого экземпляра SQL](https://azure.microsoft.com/support/legal/sla/azure-sql-sql-managed-instance), так как в некоторых случаях требуется перенастройка ресурсов.

Период обслуживания предназначен для производственных рабочих нагрузок, которые не являются устойчивыми к отработке отказа базы данных или экземпляра и не могут приводить к кратковременным перерывам в соединении, вызванным запланированными событиями обслуживания. Выбрав предпочтительный период обслуживания, можно снизить влияние планового обслуживания на то, что оно будет происходить за пределами рабочего времени. Отказоустойчивые рабочие нагрузки и рабочие нагрузки, не являющиеся производственными, могут полагаться на политику обслуживания SQL Azure по умолчанию.

Окно обслуживания можно настроить для создания или для существующих ресурсов SQL Azure. Его можно настроить с помощью портал Azure, PowerShell, интерфейса командной строки или API Azure.

> [!Important]
> Настройка периода обслуживания — это длительно выполняющаяся асинхронная операция, аналогичная изменению уровня служб для ресурса SQL Azure. Ресурс доступен во время операции, за исключением короткой отработки отказа, которая происходит в конце операции и обычно длится до 8 секунд даже в случае прерывания длительных транзакций. Чтобы уменьшить влияние отработки отказа, необходимо выполнить операцию за пределами пиковых часов.

### <a name="gain-more-predictability-with-maintenance-window"></a>Увеличение предсказуемости с помощью периода обслуживания

По умолчанию политика обслуживания SQL Azure блокирует затронутые обновления в течение периода, **8:00 17:00 Местное время каждый день** во избежание каких-либо сбоев во время типичных пиковых рабочих часов. Местное время определяется расположением [региона Azure](https://azure.microsoft.com/global-infrastructure/geographies/) , в котором размещается ресурс, и может отслеживаться переход на летнее время в соответствии с определением местного часового пояса. 

Вы можете дополнительно настроить обновления обслуживания на время, которое подходит для ресурсов SQL Azure, выбрав один из двух дополнительных слотов окна обслуживания:
 
* Окно "будний день", 10PM до 06:00 Местное время понедельник — четверг
* Окно выходных дней, 10PM to 06:00 Местное время пятница — воскресенье

После выбора периода обслуживания и завершения настройки службы запланированное обслуживание будет выполняться только в выбранном окне.   

> [!Important]
> В редких случаях, когда любое отсрочка действия может привести к серьезным последствиям, например к применению критического исправления безопасности, настроенный период обслуживания может быть временно переопределен. 

### <a name="cost-and-eligibility"></a>Затраты и права

Настройка и использование периода обслуживания предоставляется бесплатно для всех [типов предложений](https://azure.microsoft.com/support/legal/offer-details/): оплата по мере использования, поставщик облачных решений (CSP), Microsoft Соглашение Enterprise или соглашение клиента Майкрософт.

> [!Note]
> Предложение Azure — это тип имеющейся подписки Azure. Например, подписка с [тарифами с оплатой по мере](https://azure.microsoft.com/offers/ms-azr-0003p/)использования, [Azure в открытом](https://azure.microsoft.com/offers/ms-azr-0111p/)виде и [Visual Studio Enterprise](https://azure.microsoft.com/offers/ms-azr-0063p/) все предложения Azure. Каждое предложение или план имеют разные условия и преимущества. Ваше предложение или план отображается в обзоре подписки. Дополнительные сведения о переключении подписки на другое предложение см. в статье [изменение подписки Azure на другое предложение](/azure/cost-management-billing/manage/switch-azure-offer).

## <a name="advance-notifications"></a>Расширенные уведомления

Уведомления об обслуживании можно настроить для оповещения о предстоящих событиях запланированного обслуживания для базы данных SQL Azure за 24 часа, во время обслуживания и после завершения обслуживания. Дополнительные сведения см. в разделе [предварительные уведомления](advance-notifications.md).

## <a name="availability"></a>Доступность

### <a name="supported-service-level-objectives"></a>Поддерживаемые цели уровня обслуживания

Выбор периода обслуживания, отличного от значения по умолчанию, доступен для всех SLO, **за исключением**:
* Гипермасштабирование 
* Пулы экземпляров
* Устаревший го поколения Виртуальное ядро
* Basic, S0 и S1 
* DC, серия fsv2, серия M

### <a name="azure-region-support"></a>Поддержка региона Azure

Выбор периода обслуживания, отличного от значения по умолчанию, в настоящее время доступен в следующих регионах:

- Восточная Австралия
- Юго-Восточная Австралия
- Южная Бразилия
- Центральная Канада
- Центральная часть США
- Восточная часть США
- восточная часть США 2
- Восточная Азия
- Восточная Япония
- Норсцентрал США
- Северная Европа
- Саусцентрал США
- Юго-Восточная Азия
- южная часть Соединенного Королевства
- Западная Европа
- западная часть США
- Западная часть США 2

## <a name="gateway-maintenance-for-azure-sql-database"></a>Обслуживание шлюза для базы данных SQL Azure

Чтобы получить максимальную пользу из периодов обслуживания, убедитесь, что клиентские приложения используют политику перенаправления подключений. Перенаправление является рекомендуемой политикой подключения, где клиенты устанавливают подключения непосредственно к узлу, на котором размещена база данных, что приводит к снижению задержки и повышению пропускной способности.  

* В базе данных SQL Azure все подключения, использующие политику подключения прокси-сервера, могут быть затронуты как в выбранном периоде обслуживания, так и в окне обслуживания узла шлюза. Однако клиентские подключения, использующие рекомендованную политику перенаправления подключений, не затрагиваются при отработке отказа узла шлюза. 

* В управляемом экземпляре SQL Azure узлы шлюза размещаются [в виртуальном кластере](../../azure-sql/managed-instance/connectivity-architecture-overview.md#virtual-cluster-connectivity-architecture) и имеют тот же период обслуживания, что и управляемый экземпляр, но для минимизации количества нарушений во время события обслуживания рекомендуется по-прежнему использовать политику перенаправления подключений.

Дополнительные сведения о политике подключения клиентов в базе данных SQL Azure см. в статье [Политика подключения к базе данных SQL Azure](../database/connectivity-architecture.md#connection-policy). 

Дополнительные сведения о политике клиентских подключений в управляемом экземпляре SQL Azure см. в статье [типы подключений управляемого экземпляра SQL Azure](../../azure-sql/managed-instance/connection-types-overview.md).

## <a name="considerations-for-azure-sql-managed-instance"></a>Рекомендации для управляемого экземпляра SQL Azure

Управляемый экземпляр SQL Azure состоит из компонентов службы, размещенных на выделенном наборе изолированных виртуальных машин, которые выполняются внутри подсети виртуальной сети клиента. Эти виртуальные машины образуют [виртуальные кластеры](/azure/azure-sql/managed-instance/connectivity-architecture-overview#high-level-connectivity-architecture) , которые могут содержать несколько управляемых экземпляров. Период обслуживания, настроенный на экземплярах одной подсети, может повлиять на количество виртуальных кластеров в подсети и распределение экземпляров между виртуальными кластерами. Это может потребовать некоторых эффектов.

### <a name="maintenance-window-configuration-is-long-running-operation"></a>Конфигурация периода обслуживания является длительной операцией 
Все экземпляры, размещенные в виртуальном кластере, совместно используют окно обслуживания. По умолчанию все управляемые экземпляры размещаются в виртуальном кластере с использованием стандартного периода обслуживания. Указание другого периода обслуживания для управляемого экземпляра во время его создания или впоследствии означает, что он должен быть помещен в виртуальный кластер с соответствующим периодом обслуживания. Если такой виртуальный кластер отсутствует в подсети, сначала необходимо создать новый для размещения экземпляра. Для использования дополнительного экземпляра в существующем виртуальном кластере может потребоваться изменить размер кластера. Обе операции влияют на длительность настройки периода обслуживания для управляемого экземпляра.
Ожидаемая длительность настройки периода обслуживания в управляемом экземпляре может быть рассчитана с помощью [оценочной длительности операций управления экземпляром](/azure/azure-sql/managed-instance/management-operations-overview#duration).

> [!Important]
> Кратковременная отработка отказа происходит в конце операции обслуживания и обычно длится до 8 секунд даже в случае прерывания длительных транзакций. Чтобы уменьшить влияние отработки отказа, следует запланировать выполнение операции за пределами пиковых часов.

### <a name="ip-address-space-requirements"></a>Требования к пространству IP-адресов
Каждый новый виртуальный кластер в подсети требует дополнительных IP-адресов в соответствии с [распределением IP-адресов виртуального кластера](/azure/azure-sql/managed-instance/vnet-subnet-determine-size#determine-subnet-size). Изменение периода обслуживания для существующего управляемого экземпляра также требует [временной дополнительной емкости IP-адресов](/azure/azure-sql/managed-instance/vnet-subnet-determine-size#address-requirements-for-update-scenarios) , как в сценарии масштабирования виртуальных ядер для соответствующего уровня служб.

### <a name="ip-address-change"></a>Изменение IP-адреса
Настройка и изменение периода обслуживания приводит к изменению IP-адреса экземпляра в диапазоне IP-адресов подсети.

> [!Important]
>  Убедитесь, что правила NSG и брандмауэра не блокируют трафик данных после изменения IP-адреса. 

## <a name="next-steps"></a>Следующие шаги

* [Расширенные уведомления](advance-notifications.md)
* [Настройка периода обслуживания](maintenance-window-configure.md)

## <a name="learn-more"></a>Дополнительные сведения

* [Вопросы и ответы по периоду обслуживания](maintenance-window-faq.yml)
* [База данных SQL Azure](sql-database-paas-overview.md) 
* [Управляемый экземпляр SQL](../managed-instance/sql-managed-instance-paas-overview.md)
* [Планирование событий обслуживания Azure в базе данных SQL Azure и управляемом экземпляре SQL Azure](planned-maintenance.md)





