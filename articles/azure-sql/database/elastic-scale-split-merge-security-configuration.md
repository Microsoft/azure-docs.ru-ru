---
title: Настройка параметров безопасности для службы разделения и объединения
description: Настройка сертификатов x409 для шифрования с помощью службы разделения или слияния для гибкого масштабирования.
services: sql-database
ms.service: sql-database
ms.subservice: scale-out
ms.custom: sqldbrb=1
ms.devlang: ''
ms.topic: conceptual
author: VanMSFT
ms.author: vanto
ms.reviewer: sstein
ms.date: 12/18/2018
ms.openlocfilehash: 235efc550fd47d4244a5bf081c75d5e824a8e4b4
ms.sourcegitcommit: 910a1a38711966cb171050db245fc3b22abc8c5f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "92793438"
---
# <a name="split-merge-security-configuration"></a>Настройка параметров безопасности для службы разделения и объединения
[!INCLUDE[appliesto-sqldb](../includes/appliesto-sqldb.md)]

Для использования службы разделения и объединения необходимо правильно настроить параметры безопасности. Служба является частью функции эластичного масштабирования базы данных SQL Azure. Дополнительные сведения см. в [руководстве по эластичному масштабированию службы разбиения и объединения](elastic-scale-configure-deploy-split-and-merge.md).

## <a name="configuring-certificates"></a>Настройка сертификатов

Сертификаты настраиваются двумя способами. 

1. [Настройка сертификата TLS/SSL](#to-configure-the-tlsssl-certificate)
2. [Настройка сертификатов клиентов](#to-configure-client-certificates) 

## <a name="to-obtain-certificates"></a>Получение сертификатов

Сертификаты можно получать от общих центров сертификации (ЦС) или в [службе сертификации Windows](/windows/win32/seccrypto/certificate-services). Это наиболее предпочтительные способы получения сертификатов.

Если эти варианты недоступны, можно создавать **самозаверяющие сертификаты**.

## <a name="tools-to-generate-certificates"></a>Инструменты для создания сертификатов

* [makecert.exe](/previous-versions/dotnet/netframework-4.0/bfsktky3(v=vs.100))
* [pvk2pfx.exe](/windows-hardware/drivers/devtest/pvk2pfx)

### <a name="to-run-the-tools"></a>Запуск инструментов

* Сведения о запуске инструментов из командной строки разработчика для Visual Studio см. в статье [Командная строка разработчика для Visual Studio](/dotnet/framework/tools/developer-command-prompt-for-vs). 
  
    Если ПО установлено, перейдите к:
  
    ```console
    %ProgramFiles(x86)%\Windows Kits\x.y\bin\x86 
    ```

* Пакет WDK можно загрузить в разделе [Windows 8.1: загрузка пакетов и средств](https://msdn.microsoft.com/windows/hardware/gg454513#drivers)

## <a name="to-configure-the-tlsssl-certificate"></a>Настройка сертификата TLS/SSL

Для шифрования связи и проверки подлинности сервера требуется сертификат TLS/SSL. Выберите наиболее подходящий из этих трех сценариев и выполните все шаги.

### <a name="create-a-new-self-signed-certificate"></a>Создание самозаверяющего сертификата

1. [Создание сертификата Self-Signed](#create-a-self-signed-certificate)
2. [Создать PFX-файл для сертификата Self-Signed TLS/SSL](#create-pfx-file-for-self-signed-tlsssl-certificate)
3. [Отправка TLS/SSL-сертификата в облачную службу](#upload-tlsssl-certificate-to-cloud-service)
4. [Обновление сертификата TLS/SSL в файле конфигурации службы](#update-tlsssl-certificate-in-service-configuration-file)
5. [Импорт центра сертификации TLS/SSL](#import-tlsssl-certification-authority)

### <a name="to-use-an-existing-certificate-from-the-certificate-store"></a>Использование существующего сертификата из хранилища сертификатов
1. [Экспорт сертификата TLS/SSL из хранилища сертификатов](#export-tlsssl-certificate-from-certificate-store)
2. [Отправка TLS/SSL-сертификата в облачную службу](#upload-tlsssl-certificate-to-cloud-service)
3. [Обновление сертификата TLS/SSL в файле конфигурации службы](#update-tlsssl-certificate-in-service-configuration-file)

### <a name="to-use-an-existing-certificate-in-a-pfx-file"></a>Использование существующего сертификата в PFX-файле
1. [Отправка TLS/SSL-сертификата в облачную службу](#upload-tlsssl-certificate-to-cloud-service)
2. [Обновление сертификата TLS/SSL в файле конфигурации службы](#update-tlsssl-certificate-in-service-configuration-file)

## <a name="to-configure-client-certificates"></a>Настройка сертификатов клиентов
Для проверки подлинности запросов к службе требуются сертификаты клиентов. Выберите наиболее подходящий из этих трех сценариев и выполните все шаги.

### <a name="turn-off-client-certificates"></a>Отключение сертификатов клиента
1. [Отключение аутентификации на основе сертификата клиента](#turn-off-client-certificate-based-authentication)

### <a name="issue-new-self-signed-client-certificates"></a>Выдача новых самозаверяющих сертификатов клиента
1. [Создание центра самозаверяющей сертификации](#create-a-self-signed-certification-authority)
2. [Передача сертификата ЦС в облачную службу](#upload-ca-certificate-to-cloud-service)
3. [Обновление сертификата ЦС в файле конфигурации службы](#update-ca-certificate-in-service-configuration-file)
4. [Выдача сертификатов клиентов](#issue-client-certificates)
5. [Создание PFX-файлов для сертификатов клиента](#create-pfx-files-for-client-certificates)
6. [Импорт сертификата клиента](#import-client-certificate)
7. [Копирование отпечатков сертификатов клиента](#copy-client-certificate-thumbprints)
8. [Настройка разрешенных клиентов в файле конфигурации службы](#configure-allowed-clients-in-the-service-configuration-file)

### <a name="use-existing-client-certificates"></a>Использование существующих сертификатов клиентов
1. [Find CA Public Key](#find-ca-public-key)
2. [Передача сертификата ЦС в облачную службу](#upload-ca-certificate-to-cloud-service)
3. [Обновление сертификата ЦС в файле конфигурации службы](#update-ca-certificate-in-service-configuration-file)
4. [Копирование отпечатков сертификатов клиента](#copy-client-certificate-thumbprints)
5. [Настройка разрешенных клиентов в файле конфигурации службы](#configure-allowed-clients-in-the-service-configuration-file)
6. [Настройка проверки отзыва сертификата клиента](#configure-client-certificate-revocation-check)

## <a name="allowed-ip-addresses"></a>Разрешенные IP-адреса
Доступ к конечным точкам службы может быть ограничен для определенных диапазонов IP-адресов.

## <a name="to-configure-encryption-for-the-store"></a>Настройка шифрования для хранилища
Сертификат необходим для шифрования учетных данных, которые хранятся в хранилище метаданных. Выберите наиболее подходящий из этих трех сценариев и выполните все шаги.

### <a name="use-a-new-self-signed-certificate"></a>Использование нового самозаверяющего сертификата
1. [Создание сертификата Self-Signed](#create-a-self-signed-certificate)
2. [Создание PFX-файла для самозаверяющего сертификата шифрования](#create-pfx-file-for-self-signed-tlsssl-certificate)
3. [Передача сертификата шифрования в облачную службу](#upload-encryption-certificate-to-cloud-service)
4. [Обновление сертификата шифрования в файле конфигурации службы](#update-encryption-certificate-in-service-configuration-file)

### <a name="use-an-existing-certificate-from-the-certificate-store"></a>Использование существующего сертификата из хранилища сертификатов
1. [Экспорт сертификата шифрования из хранилища сертификатов](#export-encryption-certificate-from-certificate-store)
2. [Передача сертификата шифрования в облачную службу](#upload-encryption-certificate-to-cloud-service)
3. [Обновление сертификата шифрования в файле конфигурации службы](#update-encryption-certificate-in-service-configuration-file)

### <a name="use-an-existing-certificate-in-a-pfx-file"></a>Использование существующего сертификата в PFX-файле
1. [Передача сертификата шифрования в облачную службу](#upload-encryption-certificate-to-cloud-service)
2. [Обновление сертификата шифрования в файле конфигурации службы](#update-encryption-certificate-in-service-configuration-file)

## <a name="the-default-configuration"></a>Конфигурация по умолчанию
В конфигурации по умолчанию запрещен любой доступ к конечной точке HTTP. Это рекомендуемый параметр, так как запросы к этим конечным точкам могут содержать конфиденциальную информацию, например учетные данные базы данных.
В конфигурации по умолчанию разрешен доступ к конечной точке HTTPS. Этот параметр в дальнейшем может быть ограничен.

### <a name="changing-the-configuration"></a>Изменение конфигурации
Группа правил управления доступом, применяемых к и конечной точке, настраивается в **\<EndpointAcls>** разделе **файла конфигурации службы**.

```xml
<EndpointAcls>
    <EndpointAcl role="SplitMergeWeb" endPoint="HttpIn" accessControl="DenyAll" />
    <EndpointAcl role="SplitMergeWeb" endPoint="HttpsIn" accessControl="AllowAll" />
</EndpointAcls>
```

Правила в группе управления доступом настраиваются в разделе \<AccessControl name=""> файла конфигурации службы. 

Описание формата содержится в документации по спискам управления сетевым доступом.
Например, правила, позволяющие разрешить получение доступа к конечной точке HTTPS только IP-адресам в диапазоне от 100.100.0.0 до 100.100.255.255, будут выглядеть следующим образом:

```xml
<AccessControl name="Retricted">
    <Rule action="permit" description="Some" order="1" remoteSubnet="100.100.0.0/16"/>
    <Rule action="deny" description="None" order="2" remoteSubnet="0.0.0.0/0" />
</AccessControl>
<EndpointAcls>
    <EndpointAcl role="SplitMergeWeb" endPoint="HttpsIn" accessControl="Restricted" />
</EndpointAcls>
```

## <a name="denial-of-service-prevention"></a>Предотвращение отказа в обслуживании
Существует два различных механизма, поддерживаемых для выявления и предотвращения атак в виде отказа в обслуживании.

* Ограничение количества одновременных запросов на удаленный узел (по умолчанию отключено)
* Ограничение частоты доступа в расчете на удаленный узел (включено по умолчанию)

Они основаны на функциях, более подробно документированных в Dynamic IP Security в IIS. При изменении этой конфигурации имейте в виду следующие факторы.

* Поведение прокси-серверов и устройств преобразования сетевых адресов в отношении информации удаленного хоста (узла)
* Учитывается каждый запрос к любому ресурсу в веб-роли (например, загрузки скриптов, изображений и т. д.)

## <a name="restricting-number-of-concurrent-accesses"></a>Ограничение числа одновременных обращений
Ниже перечислены параметры, с помощью которых настраивается их действие.

```xml
<Setting name="DynamicIpRestrictionDenyByConcurrentRequests" value="false" />
<Setting name="DynamicIpRestrictionMaxConcurrentRequests" value="20" />
```

Измените значение DynamicIpRestrictionDenyByConcurrentRequests на true, чтобы включить эту защиту.

## <a name="restricting-rate-of-access"></a>Ограничение частоты доступа
Ниже перечислены параметры, с помощью которых настраивается их действие.

```xml
<Setting name="DynamicIpRestrictionDenyByRequestRate" value="true" />
<Setting name="DynamicIpRestrictionMaxRequests" value="100" />
<Setting name="DynamicIpRestrictionRequestIntervalInMilliseconds" value="2000" />
```

## <a name="configuring-the-response-to-a-denied-request"></a>Настройка ответа на отклоненный запрос
Следующий параметр позволяет настроить ответ на отклоненный запрос.

```xml
<Setting name="DynamicIpRestrictionDenyAction" value="AbortRequest" />
```

По вопросу иных поддерживаемых значений обратитесь к документации по динамической IP-безопасности в IIS.

## <a name="operations-for-configuring-service-certificates"></a>Операции настройки службы сертификатов
Этот раздел предназначен только для справки. Выполните этапы настройки, описанные в следующих инструкциях:

* Настройка сертификата TLS/SSL
* Настройка сертификатов клиентов

## <a name="create-a-self-signed-certificate"></a>Создание самозаверяющего сертификата
Выполните:

```console
makecert ^
  -n "CN=myservice.cloudapp.net" ^
  -e MM/DD/YYYY ^
  -r -cy end -sky exchange -eku "1.3.6.1.5.5.7.3.1" ^
  -a sha256 -len 2048 ^
  -sv MySSL.pvk MySSL.cer
```

Чтобы настроить:

* -n с URL-адресом службы. Поддерживаются подстановочные знаки ("CN=*.cloudapp.net") и альтернативные имена ("CN=myservice1.cloudapp.net, CN=myservice2.cloudapp.net").
* -e со сроком действия сертификата Создайте надежный пароль и укажите его при появлении запроса.

## <a name="create-pfx-file-for-self-signed-tlsssl-certificate"></a>Создание PFX-файла для самозаверяющего TLS/SSL-сертификата
Выполните:

```console
pvk2pfx -pvk MySSL.pvk -spc MySSL.cer
```

Введите пароль, а затем экспортируйте сертификат с этими параметрами.

* Да, экспортировать закрытый ключ
* Экспортировать все расширенные свойства.

## <a name="export-tlsssl-certificate-from-certificate-store"></a>Экспорт сертификата TLS/SSL из хранилища сертификатов
* Поиск сертификата
* Выберите «Действия > Все задачи > Экспортировать…»
* Экспортируйте сертификат в PFX-файл со следующими параметрами.
  * Да, экспортировать закрытый ключ
  * По возможности включите все сертификаты в путь сертификации *Экспортировать все расширенные свойства.

## <a name="upload-tlsssl-certificate-to-cloud-service"></a>Отправка TLS/SSL-сертификата в облачную службу
Отправьте сертификат с существующим или созданным. PFX-файл с парой ключей TLS:

* Введите пароль, защищающий данные закрытого ключа

## <a name="update-tlsssl-certificate-in-service-configuration-file"></a>Обновление сертификата TLS/SSL в файле конфигурации службы
Обновите значения отпечатка следующего параметра в файле конфигурации службы значением отпечатка сертификата, отправленного в облачную службу.

```console
<Certificate name="SSL" thumbprint="" thumbprintAlgorithm="sha1" />
```

## <a name="import-tlsssl-certification-authority"></a>Импорт центра сертификации TLS/SSL
Выполните эти шаги на всех учетных записях или компьютерах, которые будут взаимодействовать со службой.

* Дважды нажмите файл .CER в проводнике Windows
* В диалоговом окне сертификата нажмите «Установить сертификат...»
* Импортируйте сертификат в хранилище доверенных корневых центров сертификации

## <a name="turn-off-client-certificate-based-authentication"></a>Отключение аутентификации на основе сертификата клиента
Проверка подлинности клиента поддерживается только на основе сертификата, и ее отключение откроет общий доступ к конечным точкам службы, если только не используются другие механизмы (например, виртуальная сеть Microsoft Azure).

Присвойте этим параметрам значение false в файле конфигурации службы, если нужно отключить эту функцию.

```xml
<Setting name="SetupWebAppForClientCertificates" value="false" />
<Setting name="SetupWebserverForClientCertificates" value="false" />
```

Затем скопируйте тот же отпечаток, что и в сертификате TLS/SSL, в параметре сертификата ЦС:

```xml
<Certificate name="CA" thumbprint="" thumbprintAlgorithm="sha1" />
```

## <a name="create-a-self-signed-certification-authority"></a>Создание центра самозаверяющей сертификации
Выполните следующие шаги для создания самозаверяющего сертификата, выступающего в качестве центра сертификации.

```console
makecert ^
-n "CN=MyCA" ^
-e MM/DD/YYYY ^
 -r -cy authority -h 1 ^
 -a sha256 -len 2048 ^
  -sr localmachine -ss my ^
  MyCA.cer
```

Как настроить

* -e с датой окончания срока действия сертификации

## <a name="find-ca-public-key"></a>Поиск открытого ключа ЦС
Все сертификаты клиента должны быть выданы центром сертификации, уполномоченным данной службой. Найдите открытый ключ в том центре сертификации, который выдал сертификаты клиента, использование которых предусмотрено для проверки подлинности, чтобы передать его в облачную службу.

Если файл с открытым ключом недоступен, экспортируйте его из хранилища сертификатов:

* Поиск сертификата
  * Поиск сертификата клиента, выданного этим же центром сертификации
* Дважды щелкните сертификат.
* Перейдите на вкладку "Путь сертификации" в диалоговом окне "Сертификат".
* Дважды щелкните запись центра сертификации в пути.
* Запишите свойства сертификата.
* Закройте диалоговое окно **Сертификат** .
* Поиск сертификата
  * Найдите центр сертификации, записанный ранее.
* Выберите «Действия > Все задачи > Экспортировать…»
* Экспортируйте сертификат в .CER с этими параметрами:
  * **Нет, не экспортировать закрытый ключ**
  * По возможности включить все сертификаты в путь сертификации.
  * Экспортировать все расширенные свойства.

## <a name="upload-ca-certificate-to-cloud-service"></a>Передача сертификата ЦС в облачную службу
Передайте сертификат с существующим или созданным файлом .CER при помощи открытого ключа центра сертификации.

## <a name="update-ca-certificate-in-service-configuration-file"></a>Обновление сертификата ЦС в файле конфигурации службы
Обновите значения отпечатка следующего параметра в файле конфигурации службы значением отпечатка сертификата, отправленного в облачную службу.

```xml
<Certificate name="CA" thumbprint="" thumbprintAlgorithm="sha1" />
```

Обновите значение следующего параметра значением того же отпечатка.

```xml
<Setting name="AdditionalTrustedRootCertificationAuthorities" value="" />
```

## <a name="issue-client-certificates"></a>Выдача сертификатов клиентов
Каждый пользователь, получивший разрешение на доступ к службе, должен иметь сертификат клиента, выданный для исключительного использования. При этом такому пользователю нужно выбрать надежный пароль для защиты своего закрытого ключа. 

На том же компьютере, где был создан и хранился самозаверяющий сертификат ЦС, необходимо выполнить следующие шаги.

```console
makecert ^
  -n "CN=My ID" ^
  -e MM/DD/YYYY ^
  -cy end -sky exchange -eku "1.3.6.1.5.5.7.3.2" ^
  -a sha256 -len 2048 ^
  -in "MyCA" -ir localmachine -is my ^
  -sv MyID.pvk MyID.cer
```

Настройка.

* -n с идентификатором клиента, который будет проходить проверку подлинности с этим сертификатом
* -e с датой окончания срока действия сертификата
* MyID.pvk и MyID.cer с уникальными именами файлов для этого сертификата клиента

Эта команда запросит создать пароль и однократно его использовать. Выбирайте надежные пароли.

## <a name="create-pfx-files-for-client-certificates"></a>Создание PFX-файлов для сертификатов клиента
Для каждого созданного сертификата клиента выполните следующее.

```console
pvk2pfx -pvk MyID.pvk -spc MyID.cer
```

Настройка.

```console
MyID.pvk and MyID.cer with the filename for the client certificate
```

Введите пароль, а затем экспортируйте сертификат с этими параметрами.

* Да, экспортировать закрытый ключ
* Экспортировать все расширенные свойства.
* Лицо, которому выдается данный сертификат, должно выбрать пароль экспорта

## <a name="import-client-certificate"></a>Импорт сертификата клиента
Каждый пользователь, которому был выдан сертификат клиента, должен импортировать пару ключей в те компьютеры, которые он будет использовать для обмена данными со службой:

* Дважды щелкните .PFX-файл в проводнике Windows
* Импортируйте сертификат в личное хранилище по крайней мере с этим параметром:
  * Включить все расширенные свойства проверки

## <a name="copy-client-certificate-thumbprints"></a>Копирование отпечатков сертификатов клиента
Каждый пользователь, которому был выдан сертификат клиента, должен выполнить следующие шаги для получения отпечатка своего сертификата, который будет добавлен в файл конфигурации службы:

* Запустите certmgr.exe
* Выберите вкладку Личные
* Дважды щелкните сертификат клиента, который будет использоваться для проверки подлинности
* В открывшемся диалоговом окне сертификата перейдите на вкладку "Подробности"
* Убедитесь, что в разделе "Показать" выбран вариант "Все"
* Выберите в списке поле с именем "Отпечаток"
* Скопируйте значение отпечатка
  * Удалить невидимые символы Юникода перед первой цифрой
  * Удалить все пробелы

## <a name="configure-allowed-clients-in-the-service-configuration-file"></a>Настройка разрешенных клиентов в файле конфигурации службы
Обновите значение следующего параметра в файле конфигурации службы списком отпечатков сертификатов клиента, разделенных запятыми, которым разрешен доступ к службе.

```xml
<Setting name="AllowedClientCertificateThumbprints" value="" />
```

## <a name="configure-client-certificate-revocation-check"></a>Настройка проверки отзыва сертификата клиента
При значении по умолчанию проверка статуса отзыва сертификата клиента в центре сертификации не выполняется. Чтобы включить проверку, поддерживаемую центром сертификации, выдавшим сертификат клиента, измените следующий параметр одним из значений, определенных в перечислении X509RevocationMode:

```xml
<Setting name="ClientCertificateRevocationCheck" value="NoCheck" />
```

## <a name="create-pfx-file-for-self-signed-encryption-certificates"></a>Создание PFX-файла для самозаверяющих сертификатов шифрования
Для сертификата шифрования выполните следующую команду:

```console
pvk2pfx -pvk MyID.pvk -spc MyID.cer
```

Настройка.

```console
MyID.pvk and MyID.cer with the filename for the encryption certificate
```

Введите пароль, а затем экспортируйте сертификат с этими параметрами.

* Да, экспортировать закрытый ключ
* Экспортировать все расширенные свойства.
* При отправке сертификата в облачную службу потребуется пароль.

## <a name="export-encryption-certificate-from-certificate-store"></a>Экспорт сертификата шифрования из хранилища сертификатов
* Поиск сертификата
* Выберите «Действия > Все задачи > Экспортировать…»
* Экспортируйте сертификат в PFX-файл со следующими параметрами. 
  * Да, экспортировать закрытый ключ
  * Включить, по возможности, все сертификаты в путь сертификации 
* Экспортировать все расширенные свойства.

## <a name="upload-encryption-certificate-to-cloud-service"></a>Передача сертификата шифрования в облачную службу
Отправьте сертификат с существующим или созданным .PFX-файлом с помощью пары ключей SSL.

* Введите пароль, защищающий данные закрытого ключа

## <a name="update-encryption-certificate-in-service-configuration-file"></a>Обновление сертификата шифрования в файле конфигурации службы
Замените значения отпечатка следующих параметров в файле конфигурации службы значением отпечатка сертификата, отправленного в облачную службу.

```xml
<Certificate name="DataEncryptionPrimary" thumbprint="" thumbprintAlgorithm="sha1" />
```

## <a name="common-certificate-operations"></a>Стандартные операции сертификата
* Настройка сертификата TLS/SSL
* Настройка сертификатов клиентов

## <a name="find-certificate"></a>Поиск сертификата
Выполните следующие действия.

1. Запустите mmc.exe.
2. Файл -> Добавить/удалить оснастку...
3. Выберите **Сертификаты**.
4. Нажмите кнопку **Добавить**.
5. Выберите расположение хранилища сертификатов.
6. Нажмите кнопку **Готово**.
7. Нажмите кнопку **OK**.
8. Разверните элемент **Сертификаты**.
9. Разверните хранилище сертификатов.
10. Разверните дочерний узел сертификата.
11. Выберите сертификат из списка.

## <a name="export-certificate"></a>Экспорт сертификата
В **мастере экспорта сертификатов**:

1. Щелкните **Далее**.
2. Выберите **Да**, а затем — **Export the private key** (Экспортировать закрытый ключ).
3. Щелкните **Далее**.
4. Выберите нужный формат выходного файла.
5. Проверьте необходимые параметры.
6. Проверьте **Пароль**.
7. Введите надежный пароль и подтвердите его.
8. Щелкните **Далее**.
9. Введите или выберите имя файла, в котором будет храниться сертификат (используйте расширение .PFX).
10. Щелкните **Далее**.
11. Нажмите кнопку **Готово**.
12. Нажмите кнопку **OK**.

## <a name="import-certificate"></a>Импорт сертификата
В мастере импорта сертификатов:

1. Выберите расположение хранилища.
   
   * Выберите **Текущий пользователь** , если доступ к службе будет только у тех процессов, которые запущены под учетной записью текущего пользователя.
   * Выберите **Локальный компьютер** , если доступ к службе будет и у других процессов на этом компьютере.
2. Щелкните **Далее**.
3. При импорте из файла подтвердите путь к файлу.
4. При импорте .PFX-файла:
   1. Введите пароль, защищающий закрытый ключ
   2. Выберите параметры импорта
5. Выберите "Разместить" сертификаты в следующее хранилище.
6. Нажмите кнопку **Обзор**.
7. Выберите нужное хранилище.
8. Нажмите кнопку **Готово**.
   
   * Если хранилище доверенного корневого центра сертификации выбрано, щелкните **Да**.
9. Нажмите кнопку **ОК** во всех диалоговых окнах.

## <a name="upload-certificate"></a>Передача сертификата
В [портал Azure](https://portal.azure.com/)

1. Выберите **Облачные службы**.
2. Выберите облачную службу.
3. Щелкните **Сертификаты** в верхнем меню.
4. На нижней панели щелкните **Передать**.
5. Выберите файл сертификата.
6. Если это PFX-файл, введите пароль для закрытого ключа.
7. После завершения скопируйте отпечаток сертификата из новой записи в списке.

## <a name="other-security-considerations"></a>Прочие вопросы по безопасности
Параметры TLS, описанные в этом документе, шифруют обмен данными между службой и ее клиентами при использовании конечной точки HTTPS. Это важно, поскольку учетные данные для доступа к базе данных и другие конфиденциальные сведения передаются по каналу связи. Однако обратите внимание, что служба сохраняет внутреннее состояние, включая учетные данные, во внутренних таблицах базы данных SQL Azure, которые вы указали для хранения метаданных в подписке Microsoft Azure. База данных была определена как часть следующего параметра в вашем файле конфигурации службы (файл .CSCFG): 

```xml
<Setting name="ElasticScaleMetadata" value="Server=…" />
```

Учетные данные, хранящиеся в этой базе данных, будут зашифрованы. Однако рекомендуется убедиться что веб-роли и рабочие роли развертываний службы актуальны и защищены, так как имеют доступ к базе данных метаданных и сертификату, используемому для шифрования и расшифровки сохраненных учетных данных. 

[!INCLUDE [elastic-scale-include](../../../includes/elastic-scale-include.md)]