---
title: Мониторинг и настройка производительности
description: Обзор возможностей мониторинга и настройки производительности и методологии в базе данных SQL Azure и Управляемый экземпляр Azure SQL.
services: sql-database
ms.service: sql-db-mi
ms.subservice: performance
ms.custom: sqldbrb=2
ms.devlang: ''
ms.topic: conceptual
author: jovanpop-msft
ms.author: jovanpop
ms.reviewer: wiassaf, sstein
ms.date: 09/30/2020
ms.openlocfilehash: 6b56da68b10bc40304097fbe9eeaf200d422b663
ms.sourcegitcommit: e559daa1f7115d703bfa1b87da1cf267bf6ae9e8
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/17/2021
ms.locfileid: "100592696"
---
# <a name="monitoring-and-performance-tuning-in-azure-sql-database-and-azure-sql-managed-instance"></a>Мониторинг и настройка производительности Базы данных SQL Azure и Управляемого экземпляра SQL Azure
[!INCLUDE[appliesto-sqldb-sqlmi](../includes/appliesto-sqldb-sqlmi.md)]

Чтобы отслеживать производительность базы данных в базе данных SQL Azure и Управляемый экземпляр Azure SQL, начните с мониторинга ресурсов ЦП и операций ввода-вывода, используемых рабочей нагрузкой, относительно уровня производительности базы данных, выбранного при выборе конкретного уровня служб и уровня производительности. Для этого база данных SQL Azure и Azure SQL Управляемый экземпляр выдают метрики ресурсов, которые можно просмотреть в портал Azure или с помощью одного из следующих SQL Server средств управления: [Azure Data Studio](/sql/azure-data-studio/what-is) или [SQL Server Management Studio](/sql/ssms/sql-server-management-studio-ssms) (SSMS).

База данных SQL Azure предоставляет ряд помощников по базам данных, позволяющих обеспечить Интеллектуальные рекомендации по настройке производительности и параметры автоматической настройки для повышения производительности. Кроме того, анализ производительности запросов отображает подробные сведения о запросах, ответственных за наибольшее использование ЦП и операций ввода-вывода для баз данных в одной и в составе пула.

База данных SQL Azure и Azure SQL Управляемый экземпляр обеспечивают расширенные возможности мониторинга и настройки с помощью искусственного интеллекта, чтобы помочь вам в устранении неполадок и максимальном производительности баз данных и решений. Вы можете настроить [потоковый экспорт](metrics-diagnostic-telemetry-logging-streaming-export-configure.md) этих [Intelligent Insights](intelligent-insights-overview.md) и других журналов ресурсов базы данных и метрик в одно из нескольких назначений для использования и анализа, особенно с помощью [аналитики SQL](../../azure-monitor/insights/azure-sql.md). Аналитика SQL Azure — это расширенное решение для мониторинга в облаке для мониторинга производительности всех баз данных в масштабе и нескольких подписок в одном представлении. Список журналов и метрик, которые можно экспортировать, см. в статье [диагностические данные диагностики для экспорта](metrics-diagnostic-telemetry-logging-streaming-export-configure.md#diagnostic-telemetry-for-export) .

SQL Server имеет собственные возможности мониторинга и диагностики, которые использует база данных SQL и SQL Управляемый экземпляр, такие как [хранилище запросов](/sql/relational-databases/performance/monitoring-performance-by-using-the-query-store) и [динамические административные представления (DMV)](/sql/relational-databases/system-dynamic-management-views/system-dynamic-management-views). В разделе [мониторинг с помощью динамических административных](monitoring-with-dmvs.md) сценариев для отслеживания различных проблем с производительностью.

## <a name="monitoring-and-tuning-capabilities-in-the-azure-portal"></a>Возможности мониторинга и настройки в портал Azure

В портал Azure база данных SQL Azure и Azure SQL Управляемый экземпляр обеспечивают мониторинг метрик ресурсов. База данных SQL Azure предоставляет помощники по базам данных, а анализ производительности запросов предоставляет рекомендации по настройке запросов и анализ производительности запросов. В портал Azure можно включить автоматическую настройку для [логических серверов SQL](logical-servers.md) и их отдельных баз данных и пулов.

> [!NOTE]
> Базы данных с очень низким уровнем использования могут отображаться на портале с меньшей вероятностью использования. Из-за способа передачи данных телеметрии при преобразовании значения типа Double в ближайшее целое число, которое может быть меньше 0,5, будет округляться до 0, что приводит к снижению степени гранулярности порожденной телеметрии. Дополнительные сведения см. [в статье низкая метрика базы данных и эластичного пула с округлением до нуля](#low-database-and-elastic-pool-metrics-rounding-to-zero).

### <a name="azure-sql-database-and-azure-sql-managed-instance-resource-monitoring"></a>Мониторинг ресурсов базы данных SQL Azure и Azure SQL Управляемый экземпляр

Вы можете быстро отслеживать различные метрики ресурсов в портал Azure в представлении **метрики** . Эти метрики позволяют определить, приближается ли база данных к 100% ресурсов процессора, памяти или операций ввода-вывода. Высокий уровень DTU или процент процессоров, а также высокий процент операций ввода-вывода указывает, что для рабочей нагрузки может потребоваться больше ресурсов ЦП или операций ввода-вывода. Он также может указывать на запросы, которые необходимо оптимизировать.

  ![Метрики ресурсов](./media/monitor-tune-overview/resource-metrics.png)

### <a name="database-advisors-in-azure-sql-database"></a>Помощники по базам данных в базе данных SQL Azure

База данных SQL Azure включает [помощники по базам данных](database-advisor-implement-performance-recommendations.md) , которые предоставляют рекомендации по настройке производительности для отдельных баз данных и в составе пула. Эти рекомендации доступны в портал Azure, а также с помощью [PowerShell](/powershell/module/az.sql/get-azsqldatabaseadvisor). Можно также включить [автоматическую настройку](automatic-tuning-overview.md) , чтобы база данных SQL Azure могла автоматически реализовывать эти рекомендации по настройке.

### <a name="query-performance-insight-in-azure-sql-database"></a>анализ производительности запросов в базе данных SQL Azure

[Анализ производительности запросов](query-performance-insight-use.md) показывает производительность в портал Azure самых ресурсоемких и наиболее длительных запросов для баз данных в одной и в составе пула.

### <a name="low-database-and-elastic-pool-metrics-rounding-to-zero"></a>Низкая метрики базы данных и эластичного пула округляются до нуля

Начиная с сентября 2020 базы данных с очень низким уровнем использования могут отображаться на портале с меньшей вероятностью использования. Из-за способа передачи данных телеметрии при преобразовании значения типа Double в ближайшее целое число, которое может быть меньше 0,5, будет округляться до 0, что приводит к снижению степени гранулярности порожденной телеметрии.

Например, рассмотрим 1-минутное окно со следующими четырьмя точками данных: 0,1, 0,1, 0,1, 0,1, эти низкие значения округляются вниз до 0, 0, 0, 0 и представляют среднее значение 0. Если любая из точек данных больше 0,5, например 0,1, 0,1, 0,9, 0,1, они округляются в 0, 0, 1, 0 и показывают среднее значение по 0,25.

Затронутые метрики базы данных:
- cpu_percent
- log_write_percent
- workers_percent
- sessions_percent
- physical_data_read_percent
- dtu_consumption_percent2
- xtp_storage_percent

Затронутые метрики эластичного пула:
- cpu_percent
- physical_data_read_percent
- log_write_percent
- memory_usage_percent
- data_storage_percent
- peak_worker_percent
- peak_session_percent
- xtp_storage_percent
- allocated_data_storage_percent


## <a name="generate-intelligent-assessments-of-performance-issues"></a>Создание интеллектуальной оценки проблем производительности

[Intelligent Insights](intelligent-insights-overview.md) для базы данных SQL Azure и azure SQL управляемый экземпляр использует встроенную аналитику для постоянного отслеживания использования базы данных с помощью искусственного интеллекта и обнаружения событий, вызывающих низкую производительность. Intelligent Insights автоматически обнаруживает проблемы с производительностью баз данных в зависимости от времени ожидания выполнения запроса, ошибок или истечения времени ожидания. После обнаружения будет выполнен подробный анализ, создающий журнал ресурсов (именуемый SQLInsights) с [интеллектуальной оценкой проблем](intelligent-insights-troubleshoot-performance.md). Эта оценка состоит из анализа первопричин проблемы с производительностью базы данных и возможных рекомендаций по повышению производительности.

Intelligent Insights — уникальная функция встроенного аналитического механизма Azure, который предлагает следующие возможности:

- Упреждающий мониторинг
- специализированная аналитика производительности;
- заблаговременное выявление снижения производительности базы данных;
- анализ первопричин обнаруженных проблем;
- рекомендации по повышению производительности;
- возможность развертывания сотен тысяч баз данных;
- положительное влияние на ресурсы DevOps и совокупную стоимость владения.

## <a name="enable-the-streaming-export-of-metrics-and-resource-logs"></a>Включение потокового экспорта метрик и журналов ресурсов

Вы можете включить и настроить [потоковую передачу телеметрии диагностики](metrics-diagnostic-telemetry-logging-streaming-export-configure.md) в одно из нескольких назначений, включая журнал ресурсов Intelligent Insights. Используйте [SQL Analytics](../../azure-monitor/insights/azure-sql.md) и другие возможности для использования этой дополнительной диагностической телеметрии для выявления и устранения проблем с производительностью.

Вы настраиваете параметры диагностики для потоковой передачи категорий метрик и журналов ресурсов для отдельных баз данных, баз данных в пуле, эластичных пулов, управляемых экземпляров и баз данных экземпляров в один из следующих ресурсов Azure.

### <a name="log-analytics-workspace-in-azure-monitor"></a>Рабочая область Log Analytics в Azure Monitor

Вы можете передавать метрики и журналы ресурсов в [рабочую область log Analytics в Azure Monitor](../../azure-monitor/essentials/resource-logs.md#send-to-log-analytics-workspace). Поток данных, переданный здесь, можно использовать в [SQL Analytics](../../azure-monitor/insights/azure-sql.md), который представляет собой облачное решение мониторинга, которое обеспечивает интеллектуальный Мониторинг баз данных, включая отчеты о производительности, предупреждения и рекомендации по устранению рисков. Потоки данных, переданные в рабочую область Log Analytics, можно анализировать с помощью собранных данных мониторинга, а также использовать другие функции Azure Monitor, такие как оповещения и визуализации.

### <a name="azure-event-hubs"></a>Центры событий Azure

Вы можете передавать метрики и журналы ресурсов в [концентраторы событий Azure](../../azure-monitor/essentials/resource-logs.md#send-to-azure-event-hubs). Потоковая передача данных диагностики в концентраторы событий для обеспечения следующих функциональных возможностей:

- **Потоковая передача журналов в сторонние системы для телеметрии и ведения журнала**

  Выполните потоковую передачу всех метрик и журналов ресурсов в один концентратор событий, чтобы передать данные журнала в стороннее средство SIEM или log Analytics.
- **Создание пользовательской платформы для телеметрии и ведения журнала**

  Высокая масштабируемость публикации и подписки концентраторов событий позволяет гибко принимать метрики и журналы ресурсов в настраиваемую платформу телеметрии. Дополнительные сведения см. в статье [Разработка и изменение размера платформы телеметрии глобальной шкалы в концентраторах событий Azure](https://azure.microsoft.com/documentation/videos/build-2015-designing-and-sizing-a-global-scale-telemetry-platform-on-azure-event-Hubs/) .
- **Проверка работоспособности службы путем потоковой передачи данных критического пути в Power BI**

  Используйте концентраторы событий, Stream Analytics и Power BI для преобразования диагностических данных в практический анализ в режиме реального времени в службах Azure. Дополнительные сведения об этом решении см. в разделе [Stream Analytics и Power BI. панель мониторинга для потоковой передачи данных в режиме реального времени](../../stream-analytics/stream-analytics-power-bi-dashboard.md) .

### <a name="azure-storage"></a>Служба хранилища Azure

Потоковые метрики и журналы ресурсов в [службе хранилища Azure](../../azure-monitor/essentials/resource-logs.md#send-to-azure-storage). Используйте службу хранилища Azure для архивации огромных объемов диагностических данных диагностики за долю стоимости предыдущих двух вариантов потоковой передачи.

## <a name="use-extended-events"></a>Использование расширенных событий 

Кроме того, можно использовать [Расширенные события](/sql/relational-databases/extended-events/extended-events) в SQL Server для расширенного мониторинга и устранения неполадок. Архитектура расширенных событий позволяет пользователям выполнять накопление как минимум данных, необходимых для устранения проблем с производительностью. Сведения об использовании расширенных событий в базе данных SQL Azure см. [в разделе Расширенные события в базе данных SQL Azure](xevent-db-diff-from-svr.md).

## <a name="next-steps"></a>Дальнейшие шаги

- Дополнительные сведения о интеллектуальных рекомендациях по производительности для одной и для баз данных в составе пула см. в статье [рекомендации по повышению производительности базы данных](database-advisor-implement-performance-recommendations.md).
- Дополнительные сведения о мониторинге производительности базы данных с помощью автоматической диагностики и анализа первопричин проблем с производительностью см. в статье [Intelligent Insights](intelligent-insights-overview.md).