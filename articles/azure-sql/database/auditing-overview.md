---
title: Аудит для Базы данных SQL Azure и Azure Synapse Analytics
description: Используйте Аудит базы данных SQL Azure, чтобы отслеживать события базы данных в журнале аудита.
services: sql-database
ms.service: sql-database
ms.subservice: security
ms.topic: conceptual
author: DavidTrigano
ms.author: datrigan
ms.reviewer: vanto
ms.date: 03/17/2021
ms.custom: azure-synapse, sqldbrb=1
ms.openlocfilehash: 8513127f4a79c9c94323140462ad2d2648a0130d
ms.sourcegitcommit: 772eb9c6684dd4864e0ba507945a83e48b8c16f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "104577696"
---
# <a name="auditing-for-azure-sql-database-and-azure-synapse-analytics"></a>Аудит для базы данных SQL Azure и Azure синапсе Analytics
[!INCLUDE[appliesto-sqldb-asa](../includes/appliesto-sqldb-asa.md)]

Аудит для [базы данных SQL Azure](sql-database-paas-overview.md) и [Azure синапсе Analytics](../../synapse-analytics/sql-data-warehouse/sql-data-warehouse-overview-what-is.md) отслеживает события базы данных и записывает их в журнал аудита в учетной записи хранения Azure, log Analytics рабочей области или концентраторах событий.

Аудит также дает следующие возможности.

- Помогает поддерживать соответствие нормативным требованиям, лучше понимать происходящее в базах данных, а также получать аналитические сведения о расхождениях и аномалиях, которые могут указывать на проблемы в бизнесе или потенциальные нарушения безопасности.

- Средства аудита способствуют соблюдению стандартов соответствия, но не гарантируют их выполнение. Дополнительные сведения о программах Azure, поддерживающих соответствие стандартам, см. в [центре управления безопасностью Azure](https://gallery.technet.microsoft.com/Overview-of-Azure-c1be3942), где также можно увидеть актуальный список сертификатов соответствия для Azure SQL.

> [!NOTE]
> Сведения об аудите Управляемый экземпляр Azure SQL см. в следующей статье Начало [работы с аудитом sql управляемый экземпляр](../managed-instance/auditing-configure.md).

## <a name="overview"></a><a id="overview"></a>Обзор

Используйте аудит базы данных SQL, чтобы выполнять следующие действия:

- **Сохранить** журнал аудита выбранных событий. Вы можете указать, какие категории действий базы данных должны проходить аудит.
- **Создавать отчеты** по действиям, производимым с базой данных. Вы можете использовать предварительно настроенные отчеты и панель мониторинга для быстрого начала работы с отчетностью по действиям и событиям.
- **Анализировать** отчеты. Вы можете искать подозрительные события, необычную деятельность и тенденции.

> [!IMPORTANT]
> Аудит для базы данных SQL Azure и Azure синапсе оптимизирован для обеспечения доступности и производительности. При очень высокой активности или высокой сетевой нагрузке база данных SQL Azure и Azure синапсе позволяют выполнять операции и не записывать некоторые события аудита.

### <a name="auditing-limitations"></a>Ограничения аудита

- **Хранилище класса "Премиум"** сейчас **не поддерживается**.
- **Иерархическое пространство имен** для **учетной записи хранения Azure Data Lake Storage 2-го поколения** в настоящее время **не поддерживается**.
- Включение аудита в приостановленной **службе Azure синапсе** не поддерживается. Чтобы включить аудит, возобновите работу Azure Synapse.
- Аудит для **ПУЛОВ SQL Azure синапсе** поддерживает **только** группы действий аудита по умолчанию.


#### <a name="define-server-level-vs-database-level-auditing-policy"></a><a id="server-vs-database-level"></a>Определение политики аудита уровня сервера и базы данных

Политику аудита можно определить для конкретной базы данных или в качестве политики [сервера](logical-servers.md) по умолчанию в Azure (где размещается база данных SQL или Azure синапсе):

- Политика сервера применяется ко всем существующим и новым базам данных на сервере.

- Если *включен аудит для сервера*, он *обязательно применяется к базе данных*. Аудит базы данных будет выполнен независимо от его параметров.

- Если политика аудита определена на уровне базы данных для Log Analytics рабочей области или назначения концентратора событий, то следующие операции не сохраняют политику аудита на уровне базы данных-источника:
    - [Копирование базы данных](database-copy.md)
    - [Восстановление на момент времени](recovery-using-backups.md)
    - [Георепликация](active-geo-replication-overview.md) (база данных-получатель не будет иметь аудита на уровне базы данных)

- Включение аудита в базе данных, помимо включения ее на сервере *, не приводит к переопределению* или изменению параметров аудита сервера. Оба аудита будут выполняться параллельно. Таким образом, аудит базы данных выполняется дважды: один раз в соответствии с политикой сервера и еще раз в соответствии с политикой базы данных.

   > [!NOTE]
   > Не устанавливайте политику аудита одновременно для сервера и BLOB-объектов базы данных, за исключением следующих случаев.
    >
    > - Вы хотите использовать другую *учетную запись хранения*, *период хранения* или *рабочую область Log Analytics* для конкретной базы данных.
    > - Нужно провести аудит типов событий или категорий для конкретной базы данных, которая отличается от остальных баз данных на сервере. Например, может потребоваться выполнить аудит вставки данных в таблицу только для конкретной базы данных.
   >
   > Во всех остальных случаях мы рекомендуем включать аудит только на уровне сервера и полностью отключить аудит на уровне баз данных.

#### <a name="remarks"></a>Remarks

- Журналы аудита записываются в **добавочные большие двоичные объекты** в хранилище BLOB-объектов Azure в подписке Azure.
- Журналы аудита находятся в формате XEL-и могут быть открыты с помощью [SQL Server Management Studio (SSMS)](/sql/ssms/download-sql-server-management-studio-ssms).
- Чтобы настроить неизменяемое хранилище журналов для событий аудита на уровне сервера или базы данных, следуйте [инструкциям, предоставленным службой хранилища Azure](../../storage/blobs/storage-blob-immutability-policies-manage.md#enabling-allow-protected-append-blobs-writes). Убедитесь, что выбран параметр **разрешить дополнительные добавления** при настройке неизменяемого хранилища BLOB-объектов.
- Вы можете записать журналы аудита в учетную запись хранения Azure за пределами виртуальной сети или брандмауэра. Конкретные инструкции см. в [этой статье](audit-write-storage-account-behind-vnet-firewall.md).
- Дополнительные сведения о формате журнала, иерархии папки для хранения, соглашении об именовании см. в [документации по формату журнала аудита больших двоичных объектов](./audit-log-format.md).
- Аудит [доступных только для чтения реплик](read-scale-out.md) включен автоматически. Дополнительные сведения об иерархии папок для хранения, соглашениях об именовании и формате журнала приведены в статье [о формате журнала аудита Базы данных SQL](audit-log-format.md).
- При использовании аутентификация Azure AD записи неудачных попыток входа *не* будут отображаться в журнале аудита SQL. Чтобы просмотреть записи аудита для неудачных попыток входа, посетите [портал Azure Active Directory](../../active-directory/reports-monitoring/reference-sign-ins-error-codes.md), который регистрирует сведения об этих событиях.
- Данные для входа направляются шлюзом в конкретный экземпляр, в котором находится база данных.  В случае входов в AAD перед попыткой использовать учетную запись пользователя для входа в запрошенную базу данных выполняется проверка учетных данных.  В случае сбоя доступ к запрашиваемой базе данных отсутствует, поэтому аудит не выполняется.  В случае имен входа SQL эти учетные данные проверяются на запрошенных данных, поэтому в этом случае их можно проследить.  Успешные попытки входа, при которых удалось получить доступ к базе данных, проходят аудит в обоих случаях.
- После настройки параметров аудита можно включить новую функцию обнаружения угроз и настроить адреса электронной почты для получения предупреждений системы безопасности. Использование функции обнаружения угроз позволяет настроить упреждающие оповещения об аномальной активности в базах данных, которая может указывать на потенциальные угрозы безопасности. Дополнительные сведения см. в статье [Обнаружение угроз для базы данных SQL](threat-detection-overview.md).

## <a name="set-up-auditing-for-your-server"></a><a id="setup-auditing"></a>Настройка аудита для сервера

Политика аудита по умолчанию включает в себя все действия и приведенные ниже группы действий, которые будут осуществлять аудит всех запросов и хранимых процедур, выполняемых с базой данных, а также успешных и неудачных попыток входа:
  
- BATCH_COMPLETED_GROUP;
- SUCCESSFUL_DATABASE_AUTHENTICATION_GROUP;
- FAILED_DATABASE_AUTHENTICATION_GROUP.
  
Вы можете настроить аудит для различных типов действий и групп действий с помощью PowerShell, как описано в разделе [Управление аудитом базы данных SQL с помощью Azure PowerShell](#manage-auditing) .

База данных SQL Azure и аудит Azure синапсе хранят 4000 символов данных для символьных полей в записи аудита. Если возвращаемые после выполнения проверяемого действия значения **statement** или **data_sensitivity_information** содержат более 4000 символов, все данные сверх этого числа **будут усечены и не будут проверены**.
В следующем разделе описывается настройка аудита на портале Azure.

  > [!NOTE]
  > - Включение аудита в приостановленном выделенном пуле SQL невозможно. Чтобы включить аудит, отмените приостановку выделенного пула SQL. Дополнительные сведения о [выделенном пуле SQL](../..//synapse-analytics/sql/best-practices-dedicated-sql-pool.md).
  > - Если аудит настроен на Log Analytics рабочую область или даже на целевой объект-концентратор с помощью командлета портал Azure или PowerShell, то создается [параметр диагностики](../../azure-monitor/essentials/diagnostic-settings.md) с включенной категорией "склсекуритяудитевентс".

1. Перейдите на [портал Microsoft Azure](https://portal.azure.com).
2. Перейдите к разделу **Аудит** под заголовком безопасность в **базе данных SQL** или в области **SQL Server** .
3. Если необходимо настроить политику аудита сервера, выберите ссылку **Просмотреть параметры сервера** на странице аудита базы данных. Вы можете затем просмотреть или изменить параметры аудита сервера. Политики аудита сервера применяются ко всем существующим и вновь созданным базам данных на этом сервере.

    ![Снимок экрана, на котором показана ссылка на просмотр параметров сервера, выделенная на странице аудита базы данных.](./media/auditing-overview/2_auditing_get_started_server_inherit.png)

4. Если вам нужно включить аудит на уровне базы данных, установите для параметра **Аудит** значение **Вкл.** Если включен аудит сервера, настроенный аудит для базы данных будет существовать параллельно с ним.

5. Вы можете выбрать из нескольких вариантов настройки расположения для записи журналов аудита. Вы можете записывать журналы в учетную запись хранения Azure, в Log Analytics рабочую область для использования с помощью Azure Monitor журналов или в концентратор событий для использования концентратора событий. Вы также можете настроить любое сочетание этих вариантов, и журналы аудита будут записываться в каждый из них.
  
   ![варианты хранилищ](./media/auditing-overview/auditing-select-destination.png)

### <a name="auditing-of-microsoft-support-operations"></a><a id="auditing-of-microsoft-support-operations"></a>Аудит операций служба поддержки Майкрософт

Аудит операций служба поддержки Майкрософт для Azure SQL Server позволяет проводить аудит операций инженеров службы поддержки Майкрософт, когда им требуется доступ к серверу во время запроса на поддержку. Использование этой возможности вместе с аудитом позволяет повысить прозрачность ваших сотрудников и позволяет обнаруживать аномалии, визуализацию тенденций и предотвращение потери данных.

Чтобы включить аудит операций служба поддержки Майкрософт, перейдите к **аудиту** в разделе "безопасность" в области " **сервер SQL Azure** " и переключите **Аудит операций поддержки Майкрософт** в значение **вкл**.

  > [!IMPORTANT]
  > Аудит операций поддержки Майкрософт не поддерживает назначение учетной записи хранения. Чтобы включить эту возможность, необходимо настроить Log Analytics рабочую область или назначение концентратора событий.

![Снимок экрана служба поддержки Майкрософт операций](./media/auditing-overview/support-operations.png)

Чтобы просматривать журналы аудита служба поддержки Майкрософт операций в рабочей области Log Analytics, используйте следующий запрос:

```kusto
AzureDiagnostics
| where Category == "DevOpsOperationsAudit"
```

### <a name="audit-to-storage-destination"></a><a id="audit-storage-destination"></a>Запись журналов аудита в целевое хранилище

Чтобы настроить запись журналов аудита в учетную запись хранения, в разделе **Аудит** выберите пункт **хранилище** . Выберите учетную запись хранения Azure, в которой будут сохраняться журналы, а затем выберите срок хранения, открыв **Дополнительные свойства**. Затем нажмите кнопку **Сохранить**. Журналы старше периода хранения удаляются.

- По умолчанию период хранения равен 0 (неограниченный период хранения). Это значение можно изменить, переместив ползунок **retention (дни)** в **Дополнительные свойства** при настройке учетной записи хранения для аудита.
  - Если для периода хранения вместо 0 (неограниченный период хранения) указать любое другое значение, то оно будет применяться только к журналам, записанным после изменения. Журналы, записанные в то время, когда был установлен неограниченный период хранения, сохранятся даже после включения определенного периода хранения.

  ![запись хранения Azure](./media/auditing-overview/auditing_select_storage.png)

### <a name="audit-to-log-analytics-destination"></a><a id="audit-log-analytics-destination"></a>Запись журналов аудита в назначение Log Analytics
  
Чтобы настроить запись журналов аудита в Log Analytics рабочую область, выберите **log Analytics** и откройте **сведения о log Analytics**. Выберите Log Analytics рабочую область, в которую будут записываться журналы, и нажмите кнопку **ОК**. Если вы не создали Log Analytics рабочую область, см. раздел [создание log Analytics рабочей области на портал Azure](../../azure-monitor/logs/quick-create-workspace.md).

   ![LogAnalyticsworkspace](./media/auditing-overview/auditing_select_oms.png)

Дополнительные сведения о Azure Monitor Log Analytics рабочей области см. в статье [Разработка развертывания журналов Azure Monitor](../../azure-monitor/logs/design-logs-deployment.md) .
   
### <a name="audit-to-event-hub-destination"></a><a id="audit-event-hub-destination"></a>Запись журналов аудита в назначение концентратора событий

Чтобы настроить запись журналов аудита в концентратор событий, выберите **концентратор событий**. Выберите концентратор событий, в котором будут записываться журналы, и нажмите кнопку **сохранить**. Убедитесь, что концентратор событий находится в том же регионе, что база данных и сервер.

   ![Eventhub](./media/auditing-overview/auditing_select_event_hub.png)

## <a name="analyze-audit-logs-and-reports"></a><a id="subheading-3"></a>Анализ журналов и отчетов аудита

Если нужно записывать журналы аудита в журналы Azure Monitor:

- Используйте [портал Azure](https://portal.azure.com). Откройте соответствующую базу данных. В верхней части страницы **аудита** базы данных выберите **Просмотр журналов аудита**.

    ![просмотр журналов аудита](./media/auditing-overview/auditing-view-audit-logs.png)

- Затем можно просмотреть журналы одним из двух способов:

    Щелкните **Log Analytics** в верхней части страницы **Записи аудита**. Откроется представление журналов в рабочей области Log Analytics, где можно настроить диапазон времени и поисковый запрос.

    ![открытие в рабочей области Log Analytics](./media/auditing-overview/auditing-log-analytics.png)

    Щелкните **Просмотреть панель мониторинга** в верхней части страницы **Записи аудита**. Откроется панель мониторинга со сведениями о журналах аудита, с которой можно перейти к аналитическим сведениям о безопасности, разделу доступа к конфиденциальным данным и другим возможностям. Панель мониторинга содержит аналитические сведения о безопасности на основе ваших данных.
    Кроме того, можно настроить диапазон времени и поисковый запрос.
    ![Просмотр панели мониторинга Log Analytics](media/auditing-overview/auditing-view-dashboard.png)

    ![Панель мониторинга Log Analytics](media/auditing-overview/auditing-log-analytics-dashboard.png)

    ![Аналитические сведения о безопасности в Log Analytics](media/auditing-overview/auditing-log-analytics-dashboard-data.png)

- Кроме того, к журналам аудита также можно перейти в колонке Log Analytics. Откройте рабочую область Log Analytics и в разделе **General** (Общие сведения) щелкните **Журналы**. Вы можете начать с простого запроса, например *выполните поиск SQLSecurityAuditEvents*, чтобы просмотреть журналы аудита.
    На этой странице можно также использовать [журналы Azure Monitor](../../azure-monitor/logs/log-query-overview.md) для расширенного поиска по данным журналов аудита. Журналы Azure Monitor предоставляют аналитические сведения о работе систем в режиме реального времени. Вы можете использовать встроенный поиск и настраиваемые панели мониторинга для быстрого анализа миллионов записей по всем рабочим нагрузкам и серверам. Дополнительные полезные сведения о языке и командах поиска по журналам Azure Monitor см. в [этой статье](../../azure-monitor/logs/log-query-overview.md).

Если журналы аудита записываются в концентратор событий:

- Чтобы работать с данными журналов аудита из концентратора событий, необходимо настроить потоковую передачу для получения событий и их записи в целевой объект. Дополнительные сведения см. в [документации по Центрам событий Azure](../index.yml).
- Журналы аудита в концентраторе событий записываются в текст событий [Apache Avro](https://avro.apache.org/) и хранятся в формате JSON с типом кодировки UTF-8. Для чтения журналов аудита можете использовать [средства Avro](../../event-hubs/event-hubs-capture-overview.md#use-avro-tools) или похожие средства, которые поддерживают данный формат.

Если журналы аудита записываются в учетную запись хранения Azure, их можно просматривать несколькими способами:

- Журналы аудита объединяются в учетной записи, выбранной на этапе настройки. Журналы аудита можно просматривать с помощью таких инструментов, как [обозреватель хранилищ Azure](https://storageexplorer.com/). В службе хранилища Azure журналы аудита сохраняются в виде коллекции файлов больших двоичных объектов в контейнере **sqldbauditlogs**. Дополнительные сведения об иерархии папок для хранения, соглашениях об именовании и формате журнала приведены в статье [о формате журнала аудита Базы данных SQL](./audit-log-format.md).

- Используйте [портал Azure](https://portal.azure.com).  Откройте соответствующую базу данных. В верхней области страницы базы данных **Аудит** щелкните **Ознакомиться с журналами аудита**.

    ![просмотр журналов аудита](./media/auditing-overview/auditing-view-audit-logs.png)

    Откроется колонка **Записи аудита**, в которой можно просматривать журналы.

  - Для просмотра записей за определенную дату щелкните **Фильтр** в верхней области страницы **Записи аудита**.
  - Можно переключаться между записями аудита, созданными *политикой аудита сервера* и *политикой аудита базы данных*, изменяя значение параметра **Источник аудита**.

       ![Снимок экрана, на котором показаны параметры просмотра записей аудита.]( ./media/auditing-overview/8_auditing_get_started_blob_audit_records.png)

- Используйте системную функцию **sys.fn_get_audit_file** (T-SQL), чтобы вернуть данные журнала аудита в табличном формате. Дополнительные сведения об использовании этой функции см. в статье [sys.fn_get_audit_file (Transact-SQL)](/sql/relational-databases/system-functions/sys-fn-get-audit-file-transact-sql).

- Используйте **объединение файлов аудита** в SQL Server Management Studio (начиная с SSMS 17):
    1. В меню SSMS выберите **Файл** > **Открыть** > **Объединение файлов аудита**.

        ![Снимок экрана, показывающий пункт меню "объединить файлы аудита".](./media/auditing-overview/9_auditing_get_started_ssms_1.png)
    2. Откроется диалоговое окно **Добавление файлов аудита**. Выберите один из способов **добавления**. Вы можете использовать объединение файлов аудита из локального диска или импортировать их из службы хранилища Azure. Необходимо предоставить сведения о службе хранилища Azure и ключ учетной записи.

    3. После добавления всех файлов для слияния нажмите кнопку **OK** для завершения операции слияния.

    4. Объединенный файл откроется в SSMS, где вы сможете его просмотреть и проанализировать, а также экспортировать в XEL или CSV-файл или в таблицу.

- Используйте Power BI. Вы можете просматривать и анализировать данные журнала аудита в Power BI. Чтобы получить дополнительные сведения и загрузить шаблон, см. запись блога [об анализе данных журнала аудита в Power BI](https://techcommunity.microsoft.com/t5/azure-database-support-blog/sql-azure-blob-auditing-basic-power-bi-dashboard/ba-p/368895).
- Скачайте файлы журналов из контейнера больших двоичных объектов хранилища Azure из портала или с помощью [обозревателя хранилища Azure](https://storageexplorer.com/).
  - После загрузки файла журнала дважды щелкните по нему, чтобы открыть, просмотреть и проанализировать журналы в среде SSMS.
  - Вы также можете загрузить одновременно несколько файлов через обозреватель хранилища Azure. Чтобы сделать это, щелкните правой кнопкой мыши конкретную вложенную папку и выберите **Сохранить как**, чтобы сохранить ее в локальной папке.

- Дополнительные методы

  - После загрузки нескольких файлов или вложенной папки, содержащей файлы журнала, можно объединить их локально, как описано выше в инструкциях по объединению файлов аудита в SSMS.
  - Программное Просмотр журналов аудита BLOB-объектов: [запрос файлов расширенных событий](https://sqlscope.wordpress.com/2014/11/15/reading-extended-event-files-using-client-side-tools-only/) с помощью PowerShell.

## <a name="production-practices"></a><a id="production-practices"></a>Рекомендации для рабочей среды


### <a name="auditing-geo-replicated-databases"></a>Аудит географически реплицированных баз данных

При использовании геореплицированных баз данных, если включить аудит для базы данных-источника, к базе данных-получателю будут применяться идентичные политики аудита. Кроме того, можно настроить аудит базы данных-получателя, включив аудит для **сервера-получателя**, независимо от базы данных-источника.

- Аудит на уровне сервера (**рекомендуется**). Включите аудит на **сервере-источнике** и **сервере-получателе** — все базы данных-источники и базы данных-получатели пройдут независимый аудит на основе соответствующей политики на уровне сервера.
- Аудит на уровне базы данных. Аудит на уровне базы данных для баз данных-получателей можно настроить только с помощью параметров аудита в базе данных-источнике.
  - Его необходимо включить для самой *базы данных-источника*, а не для сервера.
  - После включения аудита в базе данных-источнике он станет доступным в базе данных-получателе.

    > [!IMPORTANT]
    > При использовании аудита на уровне базы данных настройки хранилища для базы данных-получателя будут совпадать с настройками для базы данных-источника, что приведет к появлению трафика между регионами. Рекомендуем включать аудит только на уровне сервера, а на уровне баз данных отключить все параметры аудита для всех баз данных.

### <a name="storage-key-regeneration"></a>Повторное создание ключа хранилища

Обычно в рабочей среде приходится периодически обновлять ключи хранилища. Если журналы аудита записываются в службу хранилища Azure, при обновлении ключей необходимо повторно сохранить политику аудита. Применяется следующая обработка.

1. Откройте **Дополнительные свойства** в разделе **хранилище**. В поле **ключ доступа к хранилищу** выберите **вторичный**. Затем щелкните **Сохранить** в верхней области страницы настройки аудита.

    ![Снимок экрана, на котором показан процесс выбора вторичного ключа доступа к хранилищу данных.](./media/auditing-overview/5_auditing_get_started_storage_key_regeneration.png)
2. Перейдите на страницу конфигурации хранилища и повторно создайте первичный ключ доступа.

    ![Область навигации](./media/auditing-overview/6_auditing_get_started_regenerate_key.png)
3. Вернитесь на страницу настройки аудита, измените значение ключа доступа к хранилищу со вторичного на первичный, затем нажмите кнопку **ОК**. Затем щелкните **Сохранить** в верхней области страницы настройки аудита.
4. Вернитесь на страницу настройки хранилища и повторно создайте ключ доступа получателя (для подготовки к следующему циклу обновления ключей).

## <a name="manage-azure-sql-database-auditing"></a><a id="manage-auditing"></a>Управление аудитом базы данных SQL Azure

### <a name="using-azure-powershell"></a>Использование Azure PowerShell

**Командлеты PowerShell (включая поддержку предложения WHERE для дополнительной фильтрации)** .

- [Создание или обновление политики аудита базы данных (Set-AzSqlDatabaseAudit)](/powershell/module/az.sql/set-azsqldatabaseaudit)
- [Создание или обновление политики аудита сервера (Set-AzSqlServerAudit)](/powershell/module/az.sql/set-azsqlserveraudit)
- [Получение политики аудита баз данных (Get-AzSqlDatabaseAudit)](/powershell/module/az.sql/get-azsqldatabaseaudit)
- [Получение политики аудита сервера (Get-AzSqlDatabaseAudit)](/powershell/module/az.sql/get-azsqlserveraudit)
- [Удаление политики аудита базы данных (Remove-AzSqlDatabaseAudit)](/powershell/module/az.sql/remove-azsqldatabaseaudit)
- [Удаление политики аудита сервера (Remove-AzSqlServerAudit)](/powershell/module/az.sql/remove-azsqlserveraudit)

Пример сценария см. в статье [Настройка аудита и обнаружения угроз для базы данных SQL с помощью PowerShell](scripts/auditing-threat-detection-powershell-configure.md).

### <a name="using-rest-api"></a>Использование REST API

**REST API.**

- [Создание или обновление политики аудита базы данных](/rest/api/sql/database%20auditing%20settings/createorupdate)
- [Создание или обновление политики аудита сервера](/rest/api/sql/server%20auditing%20settings/createorupdate)
- [Получение политики аудита базы данных](/rest/api/sql/database%20auditing%20settings/get)
- [Получение политики аудита сервера](/rest/api/sql/server%20auditing%20settings/get)

Расширенная политика с поддержкой предложения WHERE для дополнительной фильтрации:

- [Создание или обновление *расширенной* политики аудита базы данных](/rest/api/sql/database%20extended%20auditing%20settings/createorupdate)
- [Создание или обновление *расширенной* политики аудита сервера](/rest/api/sql/server%20auditing%20settings/createorupdate)
- [Получение *расширенной* политики аудита базы данных](/rest/api/sql/database%20extended%20auditing%20settings/get)
- [Получение *расширенной* политики аудита сервера](/rest/api/sql/server%20auditing%20settings/get)

### <a name="using-azure-cli"></a>Использование Azure CLI

- [Управление политикой аудита сервера](/cli/azure/sql/server/audit-policy)
- [Управление политикой аудита базы данных](/cli/azure/sql/db/audit-policy)

### <a name="using-azure-resource-manager-templates"></a>Использование шаблонов Azure Resource Manager

Вы можете управлять аудитом базы данных SQL Azure с помощью шаблонов [Azure Resource Manager](../../azure-resource-manager/management/overview.md) , как показано в следующих примерах:

- [Развертывание базы данных SQL Azure с включенным аудитом для записи журналов аудита в учетную запись хранения BLOB-объектов Azure](https://github.com/Azure/azure-quickstart-templates/tree/master/201-sql-auditing-server-policy-to-blob-storage)
- [Развертывание базы данных SQL Azure с включенным аудитом для записи журналов аудита в Log Analytics](https://github.com/Azure/azure-quickstart-templates/tree/master/201-sql-auditing-server-policy-to-oms)
- [Развертывание базы данных SQL Azure с включенным аудитом для записи журналов аудита в концентраторы событий](https://github.com/Azure/azure-quickstart-templates/tree/master/201-sql-auditing-server-policy-to-eventhub)

> [!NOTE]
> Указанные примеры размещены во внешнем общедоступном репозитории и предоставляются "как есть", без каких-либо гарантий. Они не поддерживаются ни в одной программе или службе поддержки Майкрософт.
