---
title: Краткое руководство. Создание виртуальной машины SQL Server на базе Linux в Azure
description: Это руководство содержит сведения о создании виртуальной машины SQL Server 2017 на базе Linux на портале Azure.
services: virtual-machines-linux
author: MashaMSFT
ms.date: 10/22/2019
tags: azure-service-management
ms.topic: quickstart
ms.service: virtual-machines-sql
ms.workload: iaas-sql-server
ms.author: mathoma
ms.reviewer: jroth
ms.openlocfilehash: fd5c289f2b441b5862d863d9a390a1cd054acbfa
ms.sourcegitcommit: 910a1a38711966cb171050db245fc3b22abc8c5f
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "92790157"
---
# <a name="provision-a-linux-virtual-machine-running-sql-server-in-the-azure-portal"></a>Подготовка виртуальной машины Linux под управлением SQL Server на портале Azure
[!INCLUDE[appliesto-sqlvm](../../includes/appliesto-sqlvm.md)]

> [!div class="op_single_selector"]
> * [Linux](sql-vm-create-portal-quickstart.md)
> * [Windows](../windows/sql-vm-create-portal-quickstart.md)

В этом кратком руководстве вы будете использовать портал Azure для создания виртуальной машины Linux с установленным SQL Server 2017. Вы узнаете следующее: 


* [Создание виртуальной машины Linux под управлением SQL Server из коллекции](#create)
* [подключаться к новой виртуальной машине по протоколу SSH](#connect);
* [изменять пароль системного администратора](#password);
* [настраивать удаленные подключения](#remote).

## <a name="prerequisites"></a>Предварительные требования

Если у вас еще нет подписки Azure, [создайте бесплатную учетную запись](https://azure.microsoft.com/free), прежде чем начинать работу.

## <a name="create-a-linux-vm-with-sql-server-installed"></a><a id="create"></a> Создание виртуальной машины Linux с установленным SQL Server

1. Войдите на [портал Azure](https://portal.azure.com/).

1. В области слева выберите **Создать ресурс**.

1. В области **Создать ресурс** выберите **Вычисления**.

1. Выберите **Просмотреть все** рядом с заголовком **Подборка**.

   ![Просмотр всех образов виртуальных машин](./media/sql-vm-create-portal-quickstart/azure-compute-blade.png)

1. В поле поиска введите **SQL Server 2019** и выберите **Ввод**, чтобы начать поиск.

1. Ограничьте результаты поиска, выбрав **Операционная система** > **Redhat**.

    ![Фильтр поиска для образов виртуальной машины SQL Server 2019](./media/sql-vm-create-portal-quickstart/searchfilter.png)

1. Выберите образ SQL Server 2019 на базе Linux в результатах поиска. В этом учебнике используется **SQL Server 2019 на RHEL74**.

   > [!TIP]
   > Выпуск Developer позволяет выполнять тестирование или разработку, используя функции выпуска Enterprise без затрат на лицензию SQL Server. Вы оплачиваете только стоимость выполнения виртуальной машины Linux.

1. Нажмите кнопку **создания**. 


### <a name="set-up-your-linux-vm"></a>Настройка виртуальной машины Linux

1. На вкладке **Основы** выберите **Подписка** и **Группа ресурсов**. 

    ![Окно "Основы"](./media/sql-vm-create-portal-quickstart/basics.png)

1. В поле **Имя виртуальной машины** введите имя новой виртуальной машины Linux.
1. Затем введите или выберите следующие значения:
   * **Регион**. Выберите подходящий регион Azure.
   * **Параметры доступности**. Выберите параметры доступности и избыточности, которые лучше всего подходят для приложений и данных.
   * **Изменение размера**. Выберите этот параметр, чтобы указать размер машины, а затем нажмите кнопку **Выбрать**. См. сведения о [размерах виртуальных машин](../../../virtual-machines/sizes.md).

     ![Выбор размера виртуальной машины](./media/sql-vm-create-portal-quickstart/vmsizes.png)

   > [!TIP]
   > Для разработки и функционального тестирования используйте размер виртуальной машины **DS2** или выше. Для тестирования производительности используйте **DS13** или выше.

   * **Тип проверки подлинности.** Выберите **Открытый ключ SSH**.

     > [!Note]
     > Для проверки подлинности вы можете использовать открытый ключ или пароль SSH. SSH является более безопасным. Сведения о создании ключа SSH см. в статье [Как создать и использовать пару из открытого и закрытого ключей SSH для виртуальных машин Linux в Azure](../../../virtual-machines/linux/mac-create-ssh-keys.md).

   * **Имя пользователя**. Введите имя администратора для виртуальной машины.
   * **Открытый ключ SSH**. Введите открытый ключ RSA.
   * **Общедоступные входящие порты**. Выберите **Разрешить выбранные порты**, а затем выберите порт **SSH (22)** в списке **общедоступных входящих портов**. В этом руководстве это необходимо для подключения и завершения настройки SQL Server. Если вы хотите удаленно подключиться к SQL Server, необходимо вручную разрешить передачу трафика в порт по умолчанию (1433). Этот порт используется Microsoft SQL Server, чтобы устанавливать подключения через Интернет после создания виртуальной машины.

     ![Входящие порты](./media/sql-vm-create-portal-quickstart/port-settings.png)

1. Внесите нужные изменения в параметры на следующих дополнительных вкладках или оставьте параметры по умолчанию.
    * **диски;**
    * **Сеть**
    * **Управление**
    * **Конфигурация гостевой ОС**
    * **Теги**

1. Выберите **Review + create** (Просмотреть и создать).
1. В области **Отзыв и создание** выберите **Создать**.

## <a name="connect-to-the-linux-vm"></a><a id="connect"></a> Подключение к виртуальной машине Linux

Если вы уже используете оболочку BASH, подключитесь к виртуальной машине Azure с помощью команды **SSH**. В следующей команде замените имя пользователя и IP-адрес виртуальной машины, чтобы подключиться к виртуальной машине Linux.

```bash
ssh azureadmin@40.55.55.555
```

IP-адрес виртуальной машины можно найти на портале Azure.

![IP-адрес на портале Azure](./media/sql-vm-create-portal-quickstart/vmproperties.png)

Если вы используете Windows и у вас нет оболочки BASH, установите клиент SSH, например PuTTY.

1. [Скачайте и установите PuTTY](https://www.chiark.greenend.org.uk/~sgtatham/putty/download.html).

1. Запустите PuTTY.

1. На экране настройки PuTTY введите общедоступный IP-адрес виртуальной машины.

1. Выберите **Открыть** и введите имя пользователя и пароль при появлении запросов.

Дополнительные сведения о подключении к виртуальным машинам Linux см. в статье [Создание виртуальной машины Linux с помощью портала Azure](../../../virtual-machines/linux/quick-create-portal.md).

> [!NOTE]
> Если вы видите оповещение системы безопасности PuTTY о том, что ключ узла сервера не кэшируется в реестре, выберите один из следующих параметров. Если вы доверяете этому узлу, выберите **Да**, чтобы добавить ключ в кэш PuTTy и продолжить подключение. Если вы хотите продолжить подключение один раз, не добавляя ключ в кэш, выберите **Нет**. Если вы не доверяете этому узлу, выберите **Отмена**, чтобы прервать подключение.

## <a name="change-the-sa-password"></a><a id="password"></a> Смена пароля системного администратора

Новая виртуальная машина устанавливает SQL Server со случайным паролем системного администратора. Сбросьте этот пароль, прежде чем подключиться к SQL Server с помощью имени для входа системного администратора.

1. После подключения к виртуальной машине Linux откройте новое окно терминала команд.

1. Измените пароль системного администратора, выполнив следующие команды:

   ```bash
   sudo systemctl stop mssql-server
   sudo /opt/mssql/bin/mssql-conf set-sa-password
   ```

   При появлении запроса введите новый пароль системного администратора и повторите его еще раз для подтверждения.

1. Перезапустите службу SQL Server.

   ```bash
   sudo systemctl start mssql-server
   ```

## <a name="add-the-tools-to-your-path-optional"></a>Добавление средств в путь (необязательно)

Несколько [пакетов](sql-server-on-linux-vm-what-is-iaas-overview.md#packages) SQL Server установлены по умолчанию, включая пакет программ командной строки SQL Server. Пакет средств содержит средства **sqlcmd** и **bcp**. Для удобства можно по желанию добавить путь к средствам (`/opt/mssql-tools/bin/`) в переменную среды **PATH**.

1. Выполните следующие команды, чтобы изменить переменную среды **PATH** как для сеансов входа в систему, так и для интерактивных сеансов и сеансов без входа в систему.

   ```bash
   echo 'export PATH="$PATH:/opt/mssql-tools/bin"' >> ~/.bash_profile
   echo 'export PATH="$PATH:/opt/mssql-tools/bin"' >> ~/.bashrc
   source ~/.bashrc
   ```

## <a name="configure-for-remote-connections"></a><a id="remote"></a> Настройка удаленных подключений

Если необходимо выполнить удаленное подключение к SQL Server на виртуальной машине Azure, необходимо настроить правило входящих подключений в группе безопасности сети. Это правило разрешает передачу трафика на порте, на котором SQL Server ожидает передачу данных (по умолчанию 1433). Ниже показано, как использовать портал Azure для выполнения этого шага.

> [!TIP]
> Если вы выбрали входящий порт **MS SQL (1433)** в параметрах во время подготовки, эти изменения были сделаны автоматически. Затем можно перейти к следующему разделу, в котором описано, как настроить брандмауэр

1. На портале выберите **Виртуальные машины**, а затем виртуальную машину сервера SQL.
1. На панели навигации слева в разделе **Параметры** выберите **Сеть**.
1. В окне "Сеть" в разделе **Правила входящего порта** выберите **Добавить входящий порт**.

   ![Правила для входящих портов](./media/sql-vm-create-portal-quickstart/networking.png)

1. В списке **Служба** выберите **MS SQL**.

    ![Правило группы безопасности MS SQL](./media/sql-vm-create-portal-quickstart/sqlnsgrule.png)

1. Нажмите кнопку **ОК** , чтобы сохранить правило для виртуальной машины.

### <a name="open-the-firewall-on-rhel"></a>Открытие брандмауэра в RHEL

Это руководство содержит сведения о создании виртуальной машины Red Hat Enterprise Linux (RHEL). Если вы хотите удаленно подключаться к виртуальным машинам RHEL, необходимо открыть порт 1433 в брандмауэре Linux.

1. [Подключитесь](#connect) к виртуальной машине RHEL.

1. В оболочке BASH выполните следующие команды:

   ```bash
   sudo firewall-cmd --zone=public --add-port=1433/tcp --permanent
   sudo firewall-cmd --reload
   ```

## <a name="next-steps"></a>Дальнейшие действия

Теперь, когда у вас есть виртуальная машина SQL Server 2017 в Azure, можно локально подключиться с помощью **sqlcmd** для выполнения запросов Transact-SQL.

Если вы настроили виртуальную машину Azure для удаленных подключений SQL Server, вы сможете выполнить удаленное подключение. Пример того, как выполнить удаленное подключение к SQL Server на базе Linux из Windows, см. в статье [Use SQL Server Management Studio (SSMS) on Windows to manage SQL Server on Linux](/sql/linux/sql-server-linux-develop-use-ssms) (Использование SQL Server Management Studio (SSMS) в Windows для управления SQL Server в Linux). Сведения о подключении с помощью Visual Studio Code см. в статье [Use Visual Studio Code to create and run Transact-SQL scripts for SQL Server](/sql/linux/sql-server-linux-develop-use-vscode) (Использование Visual Studio Code для создания и выполнения скриптов Transact-SQL для SQL Server).

Дополнительные сведения об SQL Server на Linux см. в [этой статье](/sql/linux/sql-server-linux-overview). Подробные сведения об использовании виртуальных машин SQL Server 2017 на базе Linux см. в статье [Обзор SQL Server на виртуальных машинах Azure (Linux)](sql-server-on-linux-vm-what-is-iaas-overview.md).