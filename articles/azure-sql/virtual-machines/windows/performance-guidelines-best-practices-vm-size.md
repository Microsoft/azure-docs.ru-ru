---
title: 'Размер виртуальной машины: рекомендации по повышению производительности & рекомендации'
description: Предоставляет рекомендации по размеру виртуальной машины и рекомендации по оптимизации производительности SQL Server в виртуальной машине Azure.
services: virtual-machines-windows
documentationcenter: na
author: dplessMSFT
editor: ''
tags: azure-service-management
ms.service: virtual-machines-sql
ms.devlang: na
ms.topic: conceptual
ms.tgt_pltfrm: vm-windows-sql-server
ms.workload: iaas-sql-server
ms.date: 03/25/2021
ms.author: dpless
ms.reviewer: jroth
ms.openlocfilehash: 9427ae1b9bd68f63df40d24122cc13b5460fbc27
ms.sourcegitcommit: f0a3ee8ff77ee89f83b69bc30cb87caa80f1e724
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/26/2021
ms.locfileid: "105572502"
---
# <a name="vm-size-performance-best-practices-for-sql-server-on-azure-vms"></a>Размер виртуальной машины: рекомендации по повышению производительности SQL Server на виртуальных машинах Azure
[!INCLUDE[appliesto-sqlvm](../../includes/appliesto-sqlvm.md)]

В этой статье приведены рекомендации и рекомендации по оптимизации производительности SQL Server на виртуальных машинах Azure (VM).

Как правило, существует компромисс между оптимизацией затрат и оптимизацией производительности. Эта серия рекомендаций по повышению производительности сосредоточена на получении *оптимальной* производительности для SQL Server на виртуальных машинах Azure. Если рабочая нагрузка не так велика, могут потребоваться не все рекомендуемые варианты оптимизации. При оценке этих рекомендаций учитывайте актуальные потребности в производительности, затраты и характер рабочих нагрузок.


## <a name="checklist"></a>Контрольный список

Ознакомьтесь с приведенным ниже контрольным списком, чтобы получить краткий обзор рекомендаций по размеру виртуальной машины, которые более подробно рассматриваются в остальной части статьи. 

- Используйте размеры виртуальных машин с 4 или более виртуальных ЦП, такими как [Standard_M8-4 мс](/../../virtual-machines/m-series), [E4ds_v4](../../../virtual-machines/edv4-edsv4-series.md#edv4-series)или [DS12_v2](../../../virtual-machines/dv2-dsv2-series-memory.md#dsv2-series-11-15) или более поздней версии. 
- Используйте размеры виртуальных машин, [оптимизированных для памяти](../../../virtual-machines/sizes-memory.md) , для лучшей производительности SQL Server рабочих нагрузок. 
- Серии [DSv2 11-15](../../../virtual-machines/dv2-dsv2-series-memory.md), [Edsv4](../../../virtual-machines/edv4-edsv4-series.md) , [M](../../../virtual-machines/m-series.md)и [Mv2](../../../virtual-machines/mv2-series.md) предлагают оптимальное соотношение объема памяти и виртуальное ядро, необходимого для рабочих нагрузок OLTP. Оба виртуальных машины серии M предлагают наибольшее соотношение памяти и виртуальное ядро, необходимое для критически важных рабочих нагрузок, и идеально подходят для рабочих нагрузок хранилища данных. 
- Рассмотрим более высокое соотношение памяти и виртуальное ядро для критически важных и рабочих нагрузок хранилища данных. 
- Используйте образы виртуальных машин Azure в Marketplace, так как параметры SQL Server и хранилища настроены для оптимальной производительности SQL Server. 
- Собирайте характеристики производительности целевой рабочей нагрузки и используйте их для определения подходящего размера виртуальной машины для вашего бизнеса.

Чтобы сравнить контрольный список размера виртуальной машины с другими, ознакомьтесь с подробным [списком рекомендаций по повышению производительности](performance-guidelines-best-practices-checklist.md). 

## <a name="overview"></a>Обзор

При создании SQL Server на виртуальной машине Azure следует тщательно продумать необходимый тип рабочей нагрузки. При переносе существующей среды [собирайте базовые показатели производительности](performance-guidelines-best-practices-collect-baseline.md) , чтобы определить SQL Server требования к виртуальной машине Azure. Если это новая виртуальная машина, создайте новую виртуальную машину SQL Server в соответствии с требованиями поставщика. 

Если вы создаете новую виртуальную машину SQL Server с новым приложением, созданным для облака, вы можете легко масштабировать виртуальную машину SQL Server по мере развития требований к данным и использованию.
Запускайте среды разработки с использованием серии D-Series, серии B или Av2 и развивайте среду с течением времени. 

Используйте SQL Server образы VM Marketplace с конфигурацией хранилища на портале. Это упростит создание пулов носителей, необходимых для получения размера, операций ввода-вывода в секунду и пропускной способности, необходимой для рабочих нагрузок. Важно выбрать SQL Server виртуальных машин, поддерживающих хранилище класса Premium и кэширование хранилища класса Premium. Дополнительные сведения см. в статье о [хранилище](performance-guidelines-best-practices-storage.md) . 

Рекомендуемый минимум для производственной среды OLTP — 4 Виртуальное ядро, 32 ГБ памяти и отношение памяти к Виртуальное ядро 8. Для новых сред Начните с 4 Виртуальное ядро компьютеров и масштабируйте их до 8, 16, 32 виртуальных ядер или более при изменении требований к данным и вычислительным ресурсам. Для пропускной способности OLTP целевые SQL Server виртуальные машины с 5000 операций ввода-вывода в секунду для каждого Виртуальное ядро. 

SQL Server в хранилище данных и критически важных средах часто требуется масштабироваться сверх соотношения "память — Виртуальное ядро". Для средних сред можно выбрать 16-Виртуальное ядро соотношение памяти и объем памяти 32 для больших сред хранилища данных. 

SQL Server средах хранилища данных часто получают преимущества параллельной обработки больших компьютеров. По этой причине серии M и Mv2 являются надежными вариантами для больших сред хранилища данных.

Используйте конфигурацию виртуальных ЦП и памяти исходного компьютера в качестве основы для миграции текущей локальной базы данных SQL Server в SQL Server на виртуальных машинах Azure. Поднесите базовую лицензию в Azure, чтобы воспользоваться преимуществами [преимущество гибридного использования Azure](https://azure.microsoft.com/pricing/hybrid-benefit/) и сэкономить на SQL Server стоимости лицензирования.

## <a name="memory-optimized"></a>Оптимизированные для операций в памяти

[Размер виртуальных машин, оптимизированных для памяти](../../../virtual-machines/sizes-memory.md) , является первичным целевым объектом для SQL Server виртуальных машин и рекомендуемым вариантом корпорации Майкрософт. Виртуальные машины, оптимизированные для памяти, обеспечивают более надежное соотношение памяти и процессора, а также средние и большие кэши. 

### <a name="m-mv2-and-mdsv2-series"></a>Серии M, Mv2 и Mdsv2

[Серия M](../../../virtual-machines/m-series.md) предлагает виртуальное ядро количество и память для некоторых из самых больших SQL Server рабочих нагрузок.  

[Серия Mv2](../../../virtual-machines/mv2-series.md) имеет наибольшее количество Виртуальное ядро и память, поэтому рекомендуется для критически важных рабочих нагрузок и хранилищ данных. Экземпляры серии Mv2 — это оптимизированные для памяти размеры виртуальных машин, обеспечивающие непревзойденную вычислительную производительность для поддержки больших баз данных в памяти и рабочих нагрузок с высоким соотношением памяти к ЦП, которое идеально подходит для серверов реляционных баз данных, больших кэшей и аналитики в памяти.

Например, [Standard_M64ms](../../../virtual-machines/m-series.md) имеет отношение 28 памяти к Виртуальное ядро.

[Mdsv2 Medium серии памяти](../../..//virtual-machines/msv2-mdsv2-series.md) — это новая серия m, которая в настоящее время доступна в [предварительной версии](https://aka.ms/Mv2MedMemoryPreview) , которая предлагает ряд виртуальных машин Azure уровня m с предложением памяти midtier. Эти компьютеры хорошо подходят для SQL Server рабочих нагрузок с поддержкой не менее 10 Виртуальное ядро памяти до 30.

К некоторым функциям серии M и Mv2, привлекательным для SQL Server производительности, относятся [хранилище класса Premium](../../../virtual-machines/premium-storage-performance.md) и [Поддержка кэширования хранилища](../../../virtual-machines/premium-storage-performance.md#disk-caching) уровня "Премиум", поддержка [Ultra-Disk](../../../virtual-machines/disks-enable-ultra-ssd.md) и [ускорение записи](../../../virtual-machines/how-to-enable-write-accelerator.md).

### <a name="edsv4-series"></a>Серия Edsv4

[Серия Edsv4](../../../virtual-machines/edv4-edsv4-series.md) предназначена для приложений, интенсивно использующих память. На этих виртуальных машинах имеется большая емкость SSD локального хранилища, а для локальных дисковых операций — до 504 гиб ОЗУ. Существует почти согласованное 8 гиб памяти на каждый Виртуальное ядро для большинства этих виртуальных машин, что идеально подходит для стандартных рабочих нагрузок SQL Server. 

В этой группе есть новая виртуальная машина с [Standard_E80ids_v4](../../../virtual-machines/edv4-edsv4-series.md) , предлагающая 80 виртуальных ядер, 504 ГБ памяти и соотношение памяти с виртуальное ядро, равным 6. Эта виртуальная машина важна, так как она [изолирована](../../../virtual-machines/isolation.md) , что означает, что она гарантированно является единственной виртуальной машиной, работающей на узле, и, следовательно, изолирована от других клиентских рабочих нагрузок. Это отношение "память — Виртуальное ядро" ниже рекомендуемого для SQL Server, поэтому его следует использовать, только если требуется изоляция.

Виртуальные машины серии Edsv4 поддерживают [хранилище класса Premium](../../../virtual-machines/premium-storage-performance.md)и [кэширование хранилища класса Premium](../../../virtual-machines/premium-storage-performance.md#disk-caching).

### <a name="dsv2-series-11-15"></a>Серия DSv2 11–15

[DSv2-series 11-15](../../../virtual-machines/dv2-dsv2-series-memory.md#dsv2-series-11-15) имеет те же конфигурации памяти и дисков, что и в предыдущей серии D. Этот ряд имеет согласованное соотношение памяти и ЦП 7 на всех виртуальных машинах. Это самый маленький из ряда, оптимизированных для памяти, и является хорошим вариантом низкой стоимости для SQL Server рабочих нагрузок начального уровня.

[DSv2-series 11-15](../../../virtual-machines/dv2-dsv2-series-memory.md#dsv2-series-11-15) поддерживает [хранилище класса Premium](../../../virtual-machines/premium-storage-performance.md) и [кэширование хранилища класса](../../../virtual-machines/premium-storage-performance.md#disk-caching)Premium, что настоятельно рекомендуется для оптимальной производительности.

## <a name="general-purpose"></a>Общего назначения

[Размеры виртуальных машин общего назначения](../../../virtual-machines/sizes-general.md) предназначены для обеспечения сбалансированного соотношения памяти и виртуальное ядро для небольших рабочих нагрузок уровня записи, таких как разработка и тестирование, веб-серверы и небольшие серверы баз данных. 

Из-за меньшего соотношения памяти и виртуальное ядрои с виртуальными машинами общего назначения важно тщательно отслеживать счетчики производительности на основе памяти, чтобы убедиться, что SQL Server способен получить память кэша буфера. Дополнительные сведения см. в разделе [Базовая производительность памяти](performance-guidelines-best-practices-collect-baseline.md#memory) . 

Поскольку начальная рекомендация для рабочих нагрузок рабочей нагрузки — это соотношение "память — Виртуальное ядро", минимальная рекомендуемая конфигурация для виртуальной машины общего назначения, в которой выполняется SQL Server, составляет 4 виртуальных ЦП и 32 ГБ памяти. 

### <a name="ddsv4-series"></a>Серия Ddsv4

[Серия Ddsv4](../../../virtual-machines/ddv4-ddsv4-series.md) предлагает достаточное сочетание виртуальных ЦП, памяти и временного диска, но с меньшей поддержкой памяти и виртуальное ядро. 

Виртуальные машины Ddsv4 имеют меньшую задержку и более скоростное локальное хранилище.

Эти компьютеры идеально подходят для параллельных развертываний SQL и приложений, требующих быстрого доступа к временным хранилищам и реляционным базам данных отделов. Для всех виртуальных машин в этой серии используется стандартное соотношение Виртуальное ядро памяти 4. 

Поэтому рекомендуется использовать D8ds_v4 в качестве начальной виртуальной машины в этой серии, которая имеет 8 виртуальных ядер и 32 ГБ памяти. Самый крупный компьютер — это D64ds_v4, в котором 64 ГБ памяти, виртуальных ядер и 256 гигабайт.

Виртуальные машины [серии Ddsv4](../../../virtual-machines/ddv4-ddsv4-series.md) поддерживают [хранилище класса Premium](../../../virtual-machines/premium-storage-performance.md) и [кэширование хранилища класса](../../../virtual-machines/premium-storage-performance.md#disk-caching)Premium.

> [!NOTE]
> [Ddsv4-Series](../../../virtual-machines/ddv4-ddsv4-series.md) не имеет соотношения "память — Виртуальное ядро", равное 8, которое рекомендуется для рабочих нагрузок SQL Server. Таким образом, следует рассмотреть возможность использования этих виртуальных машин только для небольших рабочих нагрузок приложений и разработки.

### <a name="b-series"></a>Серия B

Масштабируемые размеры виртуальных машин [серии B](../../../virtual-machines/sizes-b-series-burstable.md) идеально подходят для рабочих нагрузок, которые не требуют единообразной производительности, такой как проверка концепции и очень небольшие серверы приложений и разработки. 

Большинство размеров виртуальных машин [серии B](../../../virtual-machines/sizes-b-series-burstable.md) имеют соотношение "память — Виртуальное ядро", равное 4. Самым большим из этих компьютеров является [Standard_B20ms](../../../virtual-machines/sizes-b-series-burstable.md) с 20 виртуальных ядер и 80 ГБ памяти.

Эта серия уникальна, так как приложения имеют возможность **ускорения** работы в рабочее время с разбивкой на отдельные кредиты в зависимости от размера компьютера. 

После исчерпания кредитов виртуальная машина возвращается к производительности базового компьютера.

Преимущество серии B — это экономия вычислительных ресурсов, которую можно достигнуть по сравнению с другими размерами виртуальных машин в других рядах, особенно если требуется вычислительная мощность в течение дня.

Эта серия поддерживает [хранилище класса Premium](../../../virtual-machines/premium-storage-performance.md), но **не поддерживает** [кэширование хранилища класса Premium](../../../virtual-machines/premium-storage-performance.md#disk-caching).

> [!NOTE] 
> Для [пакетной серии B](../../../virtual-machines/sizes-b-series-burstable.md) не установлено соотношение "память — Виртуальное ядро", равное 8, которое рекомендуется для рабочих нагрузок SQL Server. Поэтому рекомендуется использовать эти виртуальные машины только для небольших приложений, веб-серверов и рабочих нагрузок разработки.

### <a name="av2-series"></a>Серия Av2

Виртуальные машины [серии Av2](../../../virtual-machines/av2-series.md) лучше всего подходят для рабочих нагрузок начального уровня, таких как разработка и тестирование, веб-серверы с небольшим трафиком, небольшие и средние базы данных приложений, а также средства проверки концепции.

Только [Standard_A2m_v2](../../../virtual-machines/av2-series.md) (2 виртуальных ядер и 16 ГБ памяти), [Standard_A4m_v2](../../../virtual-machines/av2-series.md) (4 виртуальных ядер и 32 ГБ памяти), а также [Standard_A8m_v2](../../../virtual-machines/av2-series.md) (8 виртуальных ядер и 64 ГБ памяти) имеют оптимальное соотношение памяти и виртуальное ядро для этих трех основных виртуальных машин. 

Эти виртуальные машины являются хорошим вариантом для небольших SQL Server машин разработки и тестирования. 

8 Виртуальное ядро [Standard_A8m_v2](../../../virtual-machines/av2-series.md) также может быть хорошим вариантом для небольших приложений и веб-серверов.

> [!NOTE] 
> Серия Av2 не поддерживает хранилище класса Premium и поэтому не рекомендуется для рабочих нагрузок рабочей SQL Server даже с виртуальными машинами, имеющими соотношение памяти с виртуальное ядро 8.

## <a name="storage-optimized"></a>Оптимизированные для операций в хранилище

[Размеры виртуальных машин, оптимизированных для хранилища](../../../virtual-machines/sizes-storage.md) , предназначены для конкретных вариантов использования. Эти виртуальные машины специально разработаны с оптимизированной пропускной способностью диска и операциями ввода-вывода. 

### <a name="lsv2-series"></a>Серия Lsv2

[Lsv2-Series](../../../virtual-machines/lsv2-series.md) имеет высокую пропускную способность, низкую задержку и локальное хранилище NVMe. Виртуальные машины серии Lsv2 оптимизированы для использования локального диска на узле, подключенном непосредственно к виртуальной машине, вместо использования устойчивых дисков данных. 

Эти виртуальные машины являются надежными вариантами для больших данных, хранилищ данных, отчетов и рабочих нагрузок ETL. Высокая пропускная способность и операции ввода-вывода в локальном хранилище NVMe являются хорошим вариантом использования для обработки файлов, которые будут загружены в базу данных, и других сценариев, в которых данные могут быть воссозданы из исходной системы или других репозиториев, таких как хранилище BLOB-объектов Azure или Azure Data Lake. [Серия Lsv2](../../../virtual-machines/lsv2-series.md) Виртуальные машины могут также занимать свою производительность диска в течение 30 минут за раз.

Эти виртуальные машины размером от 8 до 80 виртуальных ЦП с 8 гиб памяти на виртуальных ЦП и каждые 8 1,92 виртуальных ЦП ТБ твердотельного накопителя NVMe. Это означает, что для самой крупной виртуальной машины этой серии [L80s_v2](../../../virtual-machines/lsv2-series.md), существует 80 виртуальных цп и 640 Bib памяти с 10 раз 1.92 ТБ хранилища NVMe.  Существует согласованное соотношение памяти и виртуальное ядро, равное 8, для всех этих виртуальных машин.

Хранилище NVMe является эфемерным, поэтому данные на этих дисках будут потеряны при отмене выделения виртуальной машины или перемещении на другой узел для восстановления службы.

Серии Lsv2 и Ls поддерживают [хранилище класса Premium](../../../virtual-machines/premium-storage-performance.md), но не кэширование хранилища класса Premium. Создание локального кэша для увеличения числа операций ввода-вывода не поддерживается. 

> [!WARNING]
> Хранение файлов данных в эфемерном хранилище NVMe может привести к утере данных при освобождении виртуальной машины. 

## <a name="constrained-vcores"></a>Ограниченный виртуальных ядер

Высокая производительность SQL Server рабочих нагрузках часто требует больших объемов памяти, операций ввода-вывода и пропускной способности без увеличения числа Виртуальное ядро. 

Большинство рабочих нагрузок OLTP — это базы данных приложений, управляемые большим количеством небольших транзакций. При использовании рабочих нагрузок OLTP считывается или изменяется только небольшой объем данных, но объем транзакций, управляемых количеством пользователей, значительно выше. Важно иметь SQL Serverную память, доступную для планов кэширования, сохранять недавно использовавшиеся данные для повышения производительности, а также обеспечивать быстрое считывание данных в память. 

Этим средам OLTP требуется больший объем памяти, быстрый объем хранилища и пропускная способность ввода-вывода, необходимая для оптимального выполнения. 

Чтобы обеспечить такой уровень производительности без повышения SQL Server стоимости лицензирования, Azure предлагает размеры виртуальных машин с [ограниченным количеством виртуальных ЦП](../../../virtual-machines/constrained-vcpu.md). 

Это помогает управлять затратами на лицензирование за счет сокращения числа доступных виртуальных ядер при сохранении одинаковой памяти, хранилища и пропускной способности ввода-вывода родительской виртуальной машины.

Число виртуальных ЦП может быть ограничено одной половиной до одного квартала исходного размера виртуальной машины. Уменьшение числа виртуальных ядер, доступных для виртуальной машины, обеспечит более высокое соотношение памяти и виртуальное ядро, но стоимость вычислений останется неизменной.

Эти новые размеры виртуальных машин имеют суффикс, указывающий количество активных виртуальных ЦП, чтобы упростить их определение. 

Например, для [M64-32ms](../../../virtual-machines/constrained-vcpu.md) требуется только лицензирование 32 SQL Server виртуальных ядер с памятью, вводом-выводом и пропускной способностью [M64ms](../../../virtual-machines/m-series.md) , а [M64-16ms](../../../virtual-machines/constrained-vcpu.md) требуется только лицензирование 16 виртуальных ядер.  Несмотря на то, что [M64-16ms](../../../virtual-machines/constrained-vcpu.md) имеет квартал SQL Server стоимости лицензирования M64ms, стоимость виртуальной машины будет одинаковой.

> [!NOTE] 
> - С ограниченными рабочими нагрузками для средних и крупных хранилищ данных может быть выгодно несколько [Виртуальное ядро виртуальных машин](../../../virtual-machines/constrained-vcpu.md), но рабочие нагрузки хранилища данных обычно характеризуются меньшим числом пользователей и процессов, обращающихся к большим объемам данных через планы запросов, которые выполняются параллельно. 
> - Стоимость вычислений, которая включает в себя лицензирование операционной системы, останется такой же, как и родительская виртуальная машина. 



## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения см. в других статьях этой серии:
- [Краткий контрольный список](performance-guidelines-best-practices-checklist.md)
- [Память](performance-guidelines-best-practices-storage.md)
- [Получение базовых показателей](performance-guidelines-best-practices-collect-baseline.md)

Рекомендации по обеспечению безопасности см. [в статье вопросы безопасности SQL Server на виртуальных машинах Azure](security-considerations-best-practices.md).

Ознакомьтесь с другими статьями, посвященными виртуальным машинам SQL Server, используя руководство с [обзором SQL Server на виртуальных машинах с Windows](sql-server-on-azure-vm-iaas-what-is-overview.md). Если у вас есть вопросы по виртуальным машинам SQL Server, см. раздел [часто задаваемых вопросов](frequently-asked-questions-faq.md).
