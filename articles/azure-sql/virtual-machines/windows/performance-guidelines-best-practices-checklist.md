---
title: 'Контрольный список: рекомендации по повышению производительности & рекомендации'
description: Содержит краткий контрольный список для ознакомления с рекомендациями и рекомендациями по оптимизации производительности SQL Server на виртуальной машине Azure.
services: virtual-machines-windows
documentationcenter: na
author: MashaMSFT
editor: ''
tags: azure-service-management
ms.service: virtual-machines-sql
ms.devlang: na
ms.topic: conceptual
ms.tgt_pltfrm: vm-windows-sql-server
ms.workload: iaas-sql-server
ms.date: 03/25/2021
ms.author: mathoma
ms.custom: contperf-fy21q3
ms.reviewer: jroth
ms.openlocfilehash: 0b88884576a47db871c78b874104d4973ee9ba9a
ms.sourcegitcommit: f0a3ee8ff77ee89f83b69bc30cb87caa80f1e724
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/26/2021
ms.locfileid: "105572454"
---
# <a name="checklist-performance-best-practices-for-sql-server-on-azure-vms"></a>Контрольный список: рекомендации по повышению производительности SQL Server на виртуальных машинах Azure
[!INCLUDE[appliesto-sqlvm](../../includes/appliesto-sqlvm.md)]

В этой статье приводится краткий контрольный список в виде набора рекомендаций и руководств по оптимизации производительности SQL Server на виртуальных машинах Azure. 

Подробные сведения см. в других статьях этой серии: [Размер виртуальной машины](performance-guidelines-best-practices-vm-size.md), [хранилище](performance-guidelines-best-practices-storage.md), [базовые показатели](performance-guidelines-best-practices-collect-baseline.md). 


## <a name="overview"></a>Обзор

При запуске SQL Server на виртуальных машинах Azure продолжайте использовать те же параметры настройки производительности базы данных, которые применяются для SQL Server в локальных серверных средах. Однако производительность реляционной базы данных в общедоступном облаке зависит от многих факторов, таких как размер виртуальной машины, и конфигурации дисков данных.

Как правило, существует компромисс между оптимизацией затрат и оптимизацией производительности. Эта серия рекомендаций по повышению производительности сосредоточена на получении *оптимальной* производительности для SQL Server на виртуальных машинах Azure. Если рабочая нагрузка не так велика, могут потребоваться не все рекомендуемые варианты оптимизации. При оценке этих рекомендаций учитывайте актуальные потребности в производительности, затраты и характер рабочих нагрузок.

## <a name="vm-size"></a>Размер виртуальной машины

Ниже приведен краткий список рекомендаций по размеру виртуальной машины для запуска SQL Server на виртуальной машине Azure. 

- Используйте размеры виртуальных машин с 4 или более виртуальных ЦП, такими как [Standard_M8-4 мс](/../../virtual-machines/m-series), [E4ds_v4](../../../virtual-machines/edv4-edsv4-series.md#edv4-series)или [DS12_v2](../../../virtual-machines/dv2-dsv2-series-memory.md#dsv2-series-11-15) или более поздней версии. 
- Используйте размеры виртуальных машин, [оптимизированных для памяти](../../../virtual-machines/sizes-memory.md) , для лучшей производительности SQL Server рабочих нагрузок. 
- Серии [DSv2 11-15](../../../virtual-machines/dv2-dsv2-series-memory.md), [Edsv4](../../../virtual-machines/edv4-edsv4-series.md) , [M](../../../virtual-machines/m-series.md)и [Mv2](../../../virtual-machines/mv2-series.md) предлагают оптимальное соотношение объема памяти и виртуальное ядро, необходимого для рабочих нагрузок OLTP. Оба виртуальных машины серии M предлагают наибольшее соотношение памяти и виртуальное ядро, необходимое для критически важных рабочих нагрузок, и идеально подходят для рабочих нагрузок хранилища данных. 
- Рассмотрим более высокое соотношение памяти и виртуальное ядро для критически важных и рабочих нагрузок хранилища данных. 
- Используйте образы виртуальных машин Azure в Marketplace, так как параметры SQL Server и хранилище настроены для оптимальной производительности SQL Server. 
- Собирайте характеристики производительности целевой рабочей нагрузки и используйте их для определения подходящего размера виртуальной машины для вашего бизнеса.

Чтобы узнать больше, ознакомьтесь с полными [рекомендациями по размеру виртуальной машины](performance-guidelines-best-practices-vm-size.md). 

## <a name="storage"></a>Память

Ниже приведен краткий контрольный список рекомендаций по настройке хранилища для запуска SQL Server на виртуальной машине Azure. 

- Мониторинг приложения и [Определение требований к пропускной способности и задержкам хранилища](../../../virtual-machines/premium-storage-performance.md#counters-to-measure-application-performance-requirements) для SQL Server файлов данных, журналов и tempdb перед выбором типа диска. 
- Чтобы оптимизировать производительность хранилища, запланируйте доступ к самым высоким некэшированным операциям ввода-вывода и используйте кэширование данных в качестве функции производительности для чтения данных, избегая [ограничений и регулирования виртуальных машин и дисков](../../../virtual-machines/premium-storage-performance.md#throttling).
- Размещайте файлы данных, журналов и tempdb на разных дисках.
    - Для диска данных используйте только [диски P30 и P40 Premium](../../../virtual-machines/disks-types.md#premium-ssd) , чтобы обеспечить доступность поддержки кэша.
    - Для плана диска журнала для емкости и производительности тестирования, а также при оценке [дисков P30-P80 уровня "Премиум](../../../virtual-machines/disks-types.md#premium-ssd)".
      - Если требуется задержка хранилища в миллисекундах, используйте для журнала транзакций [Ultra-диски Azure](../../../virtual-machines/disks-types.md#ultra-disk) . 
      - Для развертываний виртуальных машин серии M рекомендуется [ускоритель записи](../../../virtual-machines/how-to-enable-write-accelerator.md) с помощью Ultra-дисков Azure.
    - Разместите [базу данных tempdb](/sql/relational-databases/databases/tempdb-database) на локальном жестком диске с ВРЕМЕНным накопителем `D:\` для большинства SQL Server рабочих нагрузок, выбрав оптимальный размер виртуальной машины. 
      - Если емкость локального диска не достаточна для базы данных tempdb, рекомендуется изменить размер виртуальной машины. Дополнительные сведения см. в разделе [политики кэширования файлов данных](performance-guidelines-best-practices-storage.md#data-file-caching-policies) .
- Создавайте несколько дисков данных Azure с помощью [дисковых пространств](/windows-server/storage/storage-spaces/overview) , чтобы увеличить пропускную способность для операций ввода-вывода и ограничения пропускной способности целевой виртуальной машины.
- Установите для [кэширования узла](../../../virtual-machines/disks-performance.md#virtual-machine-uncached-vs-cached-limits) значение только чтение для дисков с файлами данных.
- Установите для [кэширования узла](../../../virtual-machines/disks-performance.md#virtual-machine-uncached-vs-cached-limits) значение None для дисков файлов журнала.
    - Не включайте Кэширование чтения и записи на дисках, содержащих файлы SQL Server. 
    - Всегда прекращайте работу службы SQL Server, прежде чем изменять параметры кэша диска.
- Для рабочих нагрузок разработки и тестирования рекомендуется использовать хранилище уровня "Стандартный". Не рекомендуется использовать HDD (цен. категория "Стандартный") или SSD для рабочих нагрузок.
- [Разбивка дисков на основе кредита](../../../virtual-machines/disk-bursting.md#credit-based-bursting) (P1-P20) должна учитываться только для небольших рабочих нагрузок разработки и тестирования и систем отделов.
- Подготавливает учетную запись хранения в том же регионе, что и виртуальная машина SQL Server. 
- Отключите геоизбыточное хранилище Azure (георепликацию) и используйте LRS (локально избыточное хранилище) в учетной записи хранения.
- Отформатируйте диск данных, чтобы он использовал размер единицы распределения 64 КБ для всех файлов данных, размещенных на диске, отличном от временного `D:\` диска (по умолчанию — 4 КБ). SQL Server виртуальные машины, развернутые с помощью Azure Marketplace, поставляются с дисками данных с размером единицы размещения и чередованием для пула носителей, установленного в 64 КБ. 

Дополнительные сведения см. в разделе комплексные [рекомендации по хранению](performance-guidelines-best-practices-storage.md). 


## <a name="azure--sql-feature-specific"></a>Специальные возможности Azure & SQL

Ниже приведен краткий список рекомендаций по конфигурации SQL Server и Azure при запуске SQL Server на виртуальной машине Azure. 

- Зарегистрируйтесь в [расширении агента IaaS SQL](sql-agent-extension-manually-register-single-vm.md) , чтобы разблокировать ряд преимуществ для [функций](sql-server-iaas-agent-extension-automate-management.md#feature-benefits). 
- Включите сжатие страниц базы данных.
- Включите быструю инициализацию для файлов данных.
- Ограничить автоувеличение базы данных.
- Отключить автоматическое сжатие базы данных.
- Переместите все базы данных на диски с данными, включая системные базы данных.
- Переместите журнал ошибок SQL Server и каталоги файлов трассировки на диски с данными.
- Настройка резервного копирования и расположения файлов базы данных по умолчанию.
- [Включите блокировку страниц в памяти.](/sql/database-engine/configure-windows/enable-the-lock-pages-in-memory-option-windows)
- Оцените и примените [последние накопительные обновления](/sql/database-engine/install-windows/latest-updates-for-microsoft-sql-server) для установленной версии SQL Server.
- Резервное копирование непосредственно в хранилище BLOB-объектов Azure.
- Используйте несколько файлов [tempdb](/sql/relational-databases/databases/tempdb-database#optimizing-tempdb-performance-in-sql-server) , 1 файл на ядро, до 8 файлов.



## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения см. в других статьях этой серии:
- [Размер виртуальной машины](performance-guidelines-best-practices-vm-size.md)
- [Память](performance-guidelines-best-practices-storage.md)
- [Получение базовых показателей](performance-guidelines-best-practices-collect-baseline.md)

Рекомендации по обеспечению безопасности см. [в статье вопросы безопасности SQL Server на виртуальных машинах Azure](security-considerations-best-practices.md).

Ознакомьтесь с другими статьями, посвященными виртуальным машинам SQL Server, используя руководство с [обзором SQL Server на виртуальных машинах с Windows](sql-server-on-azure-vm-iaas-what-is-overview.md). Если у вас есть вопросы по виртуальным машинам SQL Server, см. раздел [часто задаваемых вопросов](frequently-asked-questions-faq.md).
