---
title: Часто задаваемые вопросы об SQL Server на виртуальных машинах Windows в Azure | Документация Майкрософт
description: В этой статье содержатся ответы на часто задаваемые вопросы о запуске SQL Server в виртуальных машинах Azure.
services: virtual-machines-windows
documentationcenter: ''
author: MashaMSFT
editor: ''
tags: azure-service-management
ms.assetid: 2fa5ee6b-51a6-4237-805f-518e6c57d11b
ms.service: virtual-machines-sql
ms.topic: troubleshooting
ms.tgt_pltfrm: vm-windows-sql-server
ms.workload: iaas-sql-server
ms.date: 08/05/2019
ms.author: mathoma
ms.openlocfilehash: 014bbe4421bf00f35b2d80505cea288e75f8ca94
ms.sourcegitcommit: 94c3c1be6bc17403adbb2bab6bbaf4a717a66009
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/12/2021
ms.locfileid: "103224679"
---
# <a name="frequently-asked-questions-for-sql-server-on-azure-vms"></a>Часто задаваемые вопросы о SQL Server на виртуальных машинах Azure
[!INCLUDE[appliesto-sqlvm](../../includes/appliesto-sqlvm.md)]

> [!div class="op_single_selector"]
> * [Windows](frequently-asked-questions-faq.md)
> * [Linux](../linux/frequently-asked-questions-faq.md)

В этой статье содержатся ответы на некоторые наиболее распространенные вопросы о запуске [SQL Server на виртуальных машинах Windows Azure](https://azure.microsoft.com/services/virtual-machines/sql-server/).

[!INCLUDE [support-disclaimer](../../../../includes/support-disclaimer.md)]

## <a name="images"></a><a id="images"></a> Образы

1. **Какие образы доступны в коллекции виртуальных машин SQL Server?** 

   В Azure доступны образы виртуальных машин для всех поддерживаемых основных выпусков SQL Server во всех выпусках Windows и Linux. Дополнительные сведения см. в полном списке образов виртуальных машин [Windows](sql-server-on-azure-vm-iaas-what-is-overview.md#payasyougo) и [Linux](../linux/sql-server-on-linux-vm-what-is-iaas-overview.md#create).

1. **Обновляются ли доступные образы в коллекции виртуальных машин SQL Server?**

   Каждые два месяца образы SQL Server в коллекции виртуальных машин обновляются до последних версий Windows и Linux. Образы Windows содержат все обновления, отмеченные как важные в Центре обновления Windows, в частности важные обновления системы безопасности и пакеты обновления SQL Server. Образы Linux содержат последние обновления системы. Накопительные пакеты обновления SQL Server в Linux и Windows обрабатываются по-разному. Для Linux накопительные пакеты обновления SQL Server также включены в обновление. Но виртуальные машины Windows сейчас не поддерживают накопительные пакеты обновления для SQL Server или Windows Server.

1. **Можно ли удалить образы виртуальных машин SQL Server из коллекции?**

   Да. Azure поддерживает только один образ для основного номера версии и выпуска. Например, при выпуске нового пакета обновления SQL Server в коллекцию Azure для него добавляется новый образ. Образ SQL Server для предыдущего пакета обновления немедленно удаляется с портала Azure. Но он доступен для подготовки из PowerShell в течение следующих трех месяцев. После трех месяцев предыдущий образ пакета обновления становится недоступным. Эта политика удаления также применяется, если версия SQL Server перестает поддерживаться по окончании жизненного цикла.


1. **Можно ли развернуть старую версию образа SQL Server, недоступного на портале Azure?**

   Да, с помощью PowerShell. Дополнительные сведения о том, как развернуть виртуальные машины SQL Server с помощью PowerShell, см. в статье [Как подготовить виртуальные машины SQL Server с помощью Azure PowerShell](create-sql-vm-powershell.md).
   
1. **Можно ли создать универсальный SQL Server образ Azure Marketplace на виртуальной машине SQL Server и использовать его для развертывания виртуальных машин?**

   Да, но после этого необходимо [зарегистрировать каждую виртуальную машину SQL Server с расширением агента IaaS SQL](sql-agent-extension-manually-register-single-vm.md) , чтобы управлять SQL Server виртуальной машиной на портале, а также использовать такие функции, как автоматическое исправление и автоматическое резервное копирование. При регистрации в расширении необходимо также указать тип лицензии для каждой SQL Server виртуальной машины.

1. **Как подготовить виртуальную машину SQL Server Azure и использовать ее для развертывания новых виртуальных машин?**

   Вы можете развернуть виртуальную машину Windows Server (без SQL Server) и использовать процесс [SQL Sysprep](/sql/database-engine/install-windows/install-sql-server-using-sysprep) для подготовки SQL Server на виртуальной машине Azure (Windows) с помощью установочного носителя SQL Server. Клиенты, у которых есть программа [Software Assurance](https://www.microsoft.com/licensing/licensing-programs/software-assurance-default?rtc=1&activetab=software-assurance-default-pivot%3aprimaryr3), установочный носитель могут получить в [Центре корпоративного лицензирования](https://www.microsoft.com/Licensing/servicecenter/default.aspx). Клиенты, у которых нет программы Software Assurance, могут использовать установочный носитель из Azure Marketplace SQL Server образ виртуальной машины с нужным выпуском.

   Кроме того, можно использовать один из SQL Server образов из Azure Marketplace, чтобы обобщить SQL Server на виртуальной машине Azure. Обратите внимание, что перед созданием собственного образа необходимо удалить следующий раздел реестра в исходном образе. Если этого не сделать, установочная папка начальной загрузки SQL Server может раздуться, расширение IaaS для SQL будет находиться в состоянии сбоя.

   Путь к разделу реестра:  
   `Computer\HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Setup\SysPrepExternal\Specialize`

   > [!NOTE]
   > SQL Server на виртуальных машинах Azure, включая развернутые из пользовательских обобщенных образов, следует [зарегистрировать с помощью расширения агента IaaS SQL](./sql-agent-extension-manually-register-single-vm.md?tabs=azure-cli%252cbash) , чтобы удовлетворить требования соответствия и использовать дополнительные функции, такие как автоматическое исправление и автоматическое резервное копирование. Расширение также позволяет [указать тип лицензии](./licensing-model-azure-hybrid-benefit-ahb-change.md?tabs=azure-portal) для каждой SQL Server виртуальной машины.

1. **Можно ли использовать собственный виртуальный жесткий диск для развертывания виртуальной машины SQL Server?**

   Да, но после этого необходимо [зарегистрировать каждую виртуальную машину SQL Server с расширением агента IaaS SQL](sql-agent-extension-manually-register-single-vm.md) , чтобы управлять SQL Server виртуальной машиной на портале, а также использовать такие функции, как автоматическое исправление и автоматическое резервное копирование.

1. **Можно ли настроить конфигурации, не отображаемые в коллекции виртуальных машин (например, Windows 2008 R2 + SQL Server 2012)?**

   Нет. С помощью портала Azure или [PowerShell](create-sql-vm-powershell.md) вы можете выбрать только один из представленных в коллекции образов виртуальных машин с SQL Server. Однако вы можете развернуть виртуальную машину Windows и самостоятельно установить на нее SQL Server. Затем необходимо [зарегистрировать SQL Server виртуальную машину с расширением агента IaaS SQL](sql-agent-extension-manually-register-single-vm.md) для управления виртуальной машиной SQL Server в портал Azure, а также воспользоваться такими функциями, как автоматическая установка исправлений и автоматическое резервное копирование. 


## <a name="creation"></a>Создание

1. **Как создать виртуальную машину Azure с SQL Server?**

   Самый простой способ — создать виртуальную машину, которая включает SQL Server. Инструкции по регистрации в Azure и созданию виртуальной машины SQL Server на портале см. в статье [Подготовка виртуальной машины SQL Server на портале Azure](create-sql-vm-portal.md). Вы можете выбрать образ виртуальной машины, использующей лицензирование SQL Server с посекундной оплатой, или же образ, который позволяет применить собственную лицензию SQL Server. Кроме того, вы можете вручную установить SQL Server на виртуальной машине, используя выпуск с бесплатной лицензией (Developer или Express) или предоставив существующую локальную лицензию. Обязательно [зарегистрируйте SQL Serverную виртуальную машину с расширением агента IaaS SQL](sql-agent-extension-manually-register-single-vm.md) для управления SQL Server виртуальной машиной на портале, а также используйте такие функции, как автоматическая установка исправлений и автоматическое резервное копирование. При использовании собственной лицензии у вас должно быть преимущество [Перемещение лицензий в рамках программы Software Assurance в Azure](https://azure.microsoft.com/pricing/license-mobility/). Дополнительные сведения см. в [руководстве по выбору ценовой категории для виртуальных машин Azure SQL Server](pricing-guidance.md).

1. **Как перенести локальную базу данных SQL Server в облако?**

   Сначала создайте виртуальную машину Azure с экземпляром SQL Server. Затем перенесите локальные базы данных в этот экземпляр. Стратегии переноса данных см. в статье [Миграция базы данных SQL Server в экземпляр SQL Server на виртуальной машине Azure](migrate-to-vm-from-sql-server.md).

## <a name="licensing"></a>Лицензирование

1. **Как установить лицензированную копию SQL Server в виртуальной машине Azure?**

   Это можно сделать тремя способами: Если вы являетесь клиентом Соглашение Enterprise (EA), вы можете подготавливать один из [образов виртуальных машин, поддерживающих лицензии](sql-server-on-azure-vm-iaas-what-is-overview.md#BYOL), которые также называются собственными лицензиями (BYOL). Если у вас есть [Software Assurance](https://www.microsoft.com/en-us/licensing/licensing-programs/software-assurance-default), вы можете включить [преимущество гибридного использования Azure](licensing-model-azure-hybrid-benefit-ahb-change.md) на основе существующего образа с оплатой по мере использования (PAYG). Вы можете также скопировать установочный носитель SQL Server в виртуальную машину Windows Server, а затем установить SQL Server на виртуальной машине. Обязательно зарегистрируйте SQL Serverную виртуальную машину с [расширением](sql-agent-extension-manually-register-single-vm.md) для таких функций, как Управление порталом, автоматическая архивация и автоматическая установка исправлений. 


1. **Требуется ли клиенту SQL Server клиентские лицензии (CAL) для подключения к образу SQL Server с оплатой по мере использования, который выполняется на виртуальных машинах Azure?**

   Нет. Клиентам требуются клиентские лицензии, если они используют собственную лицензию и перемещают свои SQL Server SA Server/CAL на виртуальные машины Azure. 

1. **Можно ли настроить виртуальную машину для использования собственной лицензии SQL Server, если она была создана из одного из образов коллекции с оплатой по мере использования?**

   Да. Вы можете легко переключить образ коллекции с оплатой по мере использования (PAYG) на собственную лицензию (BYOL), включив [Преимущество гибридного использования Azure](https://azure.microsoft.com/pricing/hybrid-benefit/faq/).  Дополнительные сведения см. в разделе [Изменение модели лицензирования для виртуальной машины SQL Server в Azure](licensing-model-azure-hybrid-benefit-ahb-change.md). Сейчас эта возможность доступна клиентам общедоступного облака и облака Azure для государственных организаций.


1. **Будет ли переход на другую модель лицензирования сопровождаться простоем SQL Server?**

   Нет. [Изменение модели лицензирования](licensing-model-azure-hybrid-benefit-ahb-change.md) не сопровождается простоем SQL Server, так как изменение вступает в силу немедленно и не требует перезапуска виртуальной машины. Однако, чтобы зарегистрировать виртуальную машину SQL Server с расширением агента IaaS SQL, [расширение SQL IaaS](sql-server-iaas-agent-extension-automate-management.md) является необходимым условием и установка расширения SQL IaaS в _полном_ режиме перезапускает службу SQL Server. Таким образом, если необходимо установить расширение IaaS для SQL, установите его в _упрощенном_ режиме для ограниченной функциональности или в _полном_ режиме в течение периода обслуживания. Расширение IaaS для SQL, установленное в _упрощенном_ режиме, может быть обновлено до _полного_ режима в любое время. Для этого требуется перезапустить службу SQL Server. 
   
1. **Можно ли переключать модели лицензирования на SQL Server виртуальной машине, развернутой с помощью классической модели?**

   Нет. Изменение моделей лицензирования не поддерживается на классической виртуальной машине. Вы можете перенести виртуальную машину в модель Azure Resource Manager и зарегистрироваться в расширении агента IaaS SQL. После регистрации виртуальной машины в расширении агента IaaS SQL изменения модели лицензирования будут доступны на виртуальной машине.

1. **Можно ли использовать портал Azure для управления несколькими экземплярами на одной виртуальной машине?**

   Нет. Управление порталом — это функция, предоставляемая расширением агента IaaS SQL, которая зависит от расширения агента SQL Server IaaS. Таким образом, для расширения применяются те же ограничения, что и для расширения. При условии правильной настройки портал может управлять только одним экземпляром по умолчанию или одним именованным экземпляром. Дополнительные сведения об ограничениях см. в статье [Расширение агента IaaS для SQL Server](sql-server-iaas-agent-extension-automate-management.md). 

1. **Могут ли из подписок CSP активировать Преимущество гибридного использования Azure?**

   Да, Преимущество гибридного использования Azure доступно для подписок CSP. Клиентам CSP следует сначала развернуть образ с оплатой по мере использования, а затем [изменить модель лицензирования](licensing-model-azure-hybrid-benefit-ahb-change.md), чтобы использовать собственную лицензию.
   
 
1. **Нужно ли платить за лицензирование SQL Server на виртуальной машине Azure, если она используется только для резервирования или отработки отказа?**

   Чтобы получить бесплатную пассивную лицензию для резервной вторичной группы доступности или экземпляра отказоустойчивого кластера, необходимо выполнить все следующие условия, указанные в [описании условий лицензирования продуктов](https://www.microsoft.com/licensing/product-licensing/products):

   1. В рамках программы [Software Assurance](https://www.microsoft.com/licensing/licensing-programs/software-assurance-default?activetab=software-assurance-default-pivot%3aprimaryr3) вы сможете [перемещать лицензии](https://www.microsoft.com/licensing/licensing-programs/software-assurance-license-mobility?activetab=software-assurance-license-mobility-pivot:primaryr2). 
   1. Пассивный экземпляр SQL Server не обслуживает данные SQL Server для клиентов и не выполняет активные рабочие нагрузки SQL Server. Он используется только для синхронизации с сервером-источником и иным образом поддерживает пассивную базу данных в состоянии "горячего" резервирования. Если он обслуживает данные, например клиентские отчеты, выполняя активные рабочие нагрузки SQL Server или любую работу, отличную от той, которая указана в условиях продукта, это должно оплачиваться лицензированным экземпляром SQL Server. На вторичном экземпляре допускается следующее действие: проверки согласованности базы данных или CheckDB, полные резервные копии, резервные копии журналов транзакций и мониторинг данных об использовании ресурсов. Вы можете также одновременно запускать первичный и соответствующий экземпляр аварийного восстановления в течение короткого периода тестирования аварийного восстановления каждые 90 дней. 
   1. Активная лицензия SQL Server распространяется на Software Assurance и позволяет использовать только **один** пассивный вторичный экземпляр SQL Server с тем же объемом вычислений, что и лицензированный активный сервер. 
   1. Дополнительная виртуальная машина SQL Server использует лицензию [аварийного восстановления](business-continuity-high-availability-disaster-recovery-hadr-overview.md#free-dr-replica-in-azure) данных на портале Azure.
   
1. **Что считается пассивным экземпляром?**

   Пассивный экземпляр SQL Server не обслуживает данные SQL Server для клиентов и не выполняет активные рабочие нагрузки SQL Server. Он используется только для синхронизации с сервером-источником и иным образом поддерживает пассивную базу данных в состоянии "горячего" резервирования. Если он обслуживает данные, например клиентские отчеты, выполняя активные рабочие нагрузки SQL Server или любую работу, отличную от той, которая указана в условиях продукта, это должно оплачиваться лицензированным экземпляром SQL Server. На вторичном экземпляре допускается следующее действие: проверки согласованности базы данных или CheckDB, полные резервные копии, резервные копии журналов транзакций и мониторинг данных об использовании ресурсов. Вы можете также одновременно запускать первичный и соответствующий экземпляр аварийного восстановления в течение короткого периода тестирования аварийного восстановления каждые 90 дней.
   

1. **В каких сценариях можно использовать преимущество аварийного восстановления?**

   В этом [руководстве по лицензированию](https://aka.ms/sql2019licenseguide) приведены сценарии, в которых можно использовать преимущества аварийного восстановления. Дополнительные сведения см. в разделе об условиях использования продукта и обратитесь к консультанту по лицензированию или менеджеру по учетным записям.

1. **Какие подписки поддерживают преимущество аварийного восстановления?**

   Комплексные программы, предоставляющие права на подписку, эквивалентную Software Assurance, в виде фиксированной выгоды, поддерживают преимущество аварийного восстановления. В частности но не ограничивается значениями Open Value (OV), Open Value Subscription (OVS), Соглашение Enterprise (EA), Соглашение Enterpriseной подпиской (EAS) и серверной и облачной регистрацией (SCE). Дополнительные сведения см. в разделе об [условиях использования продукта](https://www.microsoft.com/licensing/product-licensing/products) и обратитесь к консультанту по лицензированию или менеджеру по учетным записям. 

   
 ## <a name="extension"></a>Расширение

1. **Будет ли регистрация моей виртуальной машины новым расширением агента IaaS SQL, повлечет за собой дополнительные расходы?**

   Нет. Расширение агента IaaS SQL просто обеспечивает дополнительную управляемость для SQL Server на виртуальной машине Azure без дополнительной оплаты. 

1. **Доступно ли расширение агента IaaS SQL для всех клиентов?**
 
   Да, при условии, что виртуальная машина SQL Server была развернута в общедоступном облаке с помощью модели Resource Manager, а не классической модели. Все остальные клиенты могут зарегистрироваться в новом расширении агента IaaS SQL. Тем не менее только клиенты с преимуществом [Software Assurance](https://www.microsoft.com/licensing/licensing-programs/software-assurance-default?activetab=software-assurance-default-pivot%3aprimaryr3) могут использовать собственную лицензию, активировав [Преимущество гибридного использования Azure (AHB)](https://azure.microsoft.com/pricing/hybrid-benefit/) на виртуальной машине SQL Server. 

1. **Что происходит с ресурсом расширения (_Microsoft. склвиртуалмачине_), если ресурс виртуальной машины перемещается или удаляется?** 

   Когда ресурс Microsoft.Compute/VirtualMachine удаляется или перемещается, связанному с ним ресурсу виртуальной машины Microsoft.Sql приходит уведомление об асинхронной репликации операции.

1. **Что происходит с виртуальной машиной, если ресурс расширения (_Microsoft. склвиртуалмачине_) удаляется?**

    Удаление ресурса Microsoft.SqlVirtualMachine не влияет на ресурс Microsoft.Compute/VirtualMachine. Тем не менее изменения лицензирования по умолчанию возвращают исходный источник образов. 

1. **Можно ли зарегистрировать самостоятельно развернутые SQL Server виртуальные машины с расширением агента IaaS SQL?**

    Да. Если вы развернули SQL Server с собственного носителя и установили расширение SQL IaaS, вы можете зарегистрировать виртуальную машину SQL Server с расширением, чтобы получить преимущества управляемости, предоставляемые расширением SQL IaaS.    


## <a name="administration"></a>Администрирование

1. **Можно ли установить второй экземпляр SQL Server в той же виртуальной машине? Можно изменить установленные компоненты экземпляра по умолчанию?**

   Да. Установочный носитель SQL Server находится в папке на диске **C** . Запустите файл **Setup.exe** из этого расположения, чтобы добавить новые экземпляры SQL Server или изменить другие компоненты SQL Server, установленные на виртуальной машине. Обратите внимание, что некоторые функции, такие как автоматическая архивация, автоматическая установка исправлений и интеграция Azure Key Vault, работают только с экземпляром по умолчанию или именованным экземпляром, настроенными должным образом (см. вопрос 3). Клиенты [, использующие Software Assurance](licensing-model-azure-hybrid-benefit-ahb-change.md) с помощью преимущество гибридного использования Azure или модели лицензирования с **оплатой по мере** использования, могут установить на виртуальной машине несколько экземпляров SQL Server без дополнительных затрат на лицензирование. Дополнительные экземпляры SQL Server могут ограничить системные ресурсы, если они не настроены правильно. 

1. **Каково максимальное число экземпляров на виртуальной машине?**
   SQL Server 2012 SQL Server 2019 может поддерживать [экземпляры 50](/sql/sql-server/editions-and-components-of-sql-server-version-15#RDBMSSP) на изолированном сервере. Это то же ограничение, независимое от локальной среды Azure. Ознакомьтесь [с рекомендациями, чтобы](performance-guidelines-best-practices.md#multiple-instances) узнать, как лучше подготовить среду. 

1. **Можно ли удалить экземпляр по умолчанию SQL Server?**

   Да, но нужно учесть некоторые факторы. Во-первых, в зависимости от модели лицензии виртуальной машины может продолжаться выставление счетов, связанных с SQL Server. Во вторых, как уже говорилось в предыдущем ответе, есть функции, которые используют [расширение агента IaaS SQL Server](sql-server-iaas-agent-extension-automate-management.md). Если вы удалите экземпляр по умолчанию не удалив расширение IaaS, то оно будет непрерывно искать экземпляр по умолчанию. Возможно, это приведет к регистрации ошибок в журнале событий. У этих ошибок два источника: **служба управления учетными данными Microsoft SQL Server** и **агент IaaS Microsoft SQL Server**. Пример одной из ошибок показан ниже.

      При подключении к SQL Server произошла ошибка, связанная с сетью или с определенным экземпляром. Сервер не найден или недоступен.

   Если вы решите удалить экземпляр по умолчанию, удалите и [расширение агента IaaS SQL Server](sql-server-iaas-agent-extension-automate-management.md). 

1. **Можно ли использовать именованный экземпляр SQL Server с расширением IaaS?**
   
   Да, если именованный экземпляр является единственным экземпляром в SQL Server, а исходный экземпляр по умолчанию был [удален правильно](sql-server-iaas-agent-extension-automate-management.md#named-instance-support). Если экземпляр по умолчанию отсутствует и на одной виртуальной машине SQL Server есть несколько именованных экземпляров, установка расширения агента IaaS для SQL Server не будет выполнена.  

1. **Можно ли удалить SQL Server и связанные с ними счета на основе SQL Server виртуальной машины?**

   Да, но вам потребуется выполнить дополнительные действия, чтобы избежать оплаты за экземпляр SQL Server, как описано в [руководстве по ценам](pricing-guidance.md). Если вы хотите полностью удалить SQL Server экземпляр, можно выполнить миграцию на другую виртуальную машину Azure без предварительной установки SQL Server на виртуальной машине и удалить текущую виртуальную машину SQL Server. Если вы хотите, чтобы виртуальная машина оставалась без SQL Server выставлении счетов, выполните следующие действия. 

   1. При необходимости создайте резервную копию всех данных, включая системные базы данных. 
   1. Полностью удалите SQL Server, включая расширение SQL IaaS (если оно есть).
   1. Установите бесплатный [выпуск SQL Express](https://www.microsoft.com/sql-server/sql-server-downloads).
   1. Зарегистрируйтесь в расширении агента IaaS SQL в [упрощенном режиме](sql-agent-extension-manually-register-single-vm.md).
   1. используемых Отключите службу Express SQL Server, отключив запуск службы. 

1. **Можно ли использовать портал Azure для управления несколькими экземплярами на одной виртуальной машине?**

   Нет. Управление порталом обеспечивается расширением агента IaaS SQL, которое зависит от расширения агента SQL Server IaaS. Таким образом, те же ограничения применяются к расширению в качестве расширения. Портал может управлять только одним экземпляром по умолчанию или одним именованным экземпляром, если он правильно настроен. Дополнительные сведения см. в разделе [расширение агента IaaS SQL Server](sql-server-iaas-agent-extension-automate-management.md) 


## <a name="updating-and-patching"></a>Обновление и установка исправлений

1. **Разделы справки перейти на другую версию или выпуск SQL Server на виртуальной машине Azure?**

   Клиенты могут изменить версию или выпуск SQL Server с помощью установочного носителя, который содержит требуемую версию или выпуск SQL Server. Когда выпуск будет изменен, измените свойство выпуска виртуальной машины на портале Azure, чтобы для нее отображались точные сведения о выставлении счетов. Дополнительные сведения см. в статье об [изменении выпуска виртуальной машины SQL Server](change-sql-server-edition.md). Для разных версий SQL Server нет никакой разницы в оплате, после изменения версии SQL Server, поэтому никаких дальнейших действий не требуется.

1. **Где можно получить установочный носитель, чтобы изменить выпуск или версию SQL Server?**

   Клиенты, у которых есть программа [Software Assurance](https://www.microsoft.com/licensing/licensing-programs/software-assurance-default), установочный носитель могут получить в [Центре корпоративного лицензирования](https://www.microsoft.com/Licensing/servicecenter/default.aspx). Клиенты, у которых нет программы Software Assurance, могут использовать установочный носитель из Azure Marketplace SQL Server образ виртуальной машины с требуемым выпуском.
   
1. **Как обновления и пакеты обновления применяются к виртуальной машине SQL Server?**

   Виртуальные машины позволяют контролировать сервер, в том числе время и способ применения обновлений. Что касается операционной системы, вы можете вручную применять обновления для Windows или включить службу расписаний под названием [Автоматическое исправление](automated-patching.md). Эта служба устанавливает все обновления, помеченные как важные, включая обновления SQL Server из этой категории. Другие необязательные обновления для SQL Server необходимо устанавливать вручную.

1. **Можно ли обновить экземпляр SQL Server 2008/2008 R2 после его регистрации с помощью расширения агента IaaS SQL?**

   Если ОС Windows Server 2008 R2 или более поздней версии, да. Вы можете использовать любой установочный носитель для обновления версии и выпуска SQL Server, а затем обновить режим [расширения IaaS для SQL](sql-server-iaas-agent-extension-automate-management.md#management-modes) с _NoAgent_ до _полного_. Это обеспечит доступ ко всем преимуществам расширения IaaS для SQL, таким как управление порталом, автоматическое резервное копирование и автоматическая установка исправлений. Если используется версия ОС Windows Server 2008, поддерживается только режим агента. 

1. **Как можно получить бесплатные обновления для системы безопасности моих экземпляров SQL Server 2008 и SQL Server 2008 R2?**

   Вы можете получить [Бесплатные обновления для системы безопасности](sql-server-2008-extend-end-of-support.md) , переместив SQL Server "как есть" на виртуальную машину Azure. Дополнительные сведения см. [здесь](/sql/sql-server/end-of-support/sql-server-end-of-life-overview). 
  
   

## <a name="general"></a>Общие сведения

1. **Поддерживаются ли экземпляры отказоустойчивого кластера SQL Server на виртуальных машинах Azure?**

   Да. Экземпляр отказоустойчивого кластера можно установить с помощью [общих папок уровня "Премиум" (PFS)](failover-cluster-instance-premium-file-share-manually-configure.md) или [локальных дисковых пространств (S2D)](failover-cluster-instance-storage-spaces-direct-manually-configure.md) для подсистемы хранения. Характеристики скорости ввода-вывода и пропускной способности общих папок уровня "Премиум" отвечают потребностям множества рабочих нагрузок. Для интенсивных по вводу-выводу рабочих нагрузок рекомендуется использовать локальные дисковые пространства на базе управляемых дисков уровня "Премиум" или "Ультра". Кроме того, вы можете использовать сторонние решения для кластеризации или хранения, как описано в статье [высокий уровень доступности и аварийное восстановление SQL Server на виртуальных машинах Azure](business-continuity-high-availability-disaster-recovery-hadr-overview.md#azure-only-high-availability-solutions).

   > [!IMPORTANT]
   > В настоящее время _полное_ [расширение агента IaaS для SQL Server](sql-server-iaas-agent-extension-automate-management.md) не поддерживается для экземпляра отказоустойчивого кластера SQL Server в Azure. Мы рекомендуем удалить _полное_ расширение с виртуальных машин, которые участвуют в экземпляре отказоустойчивого кластера, и установить расширение в _облегченном_ режиме. Это расширение поддерживает такие компоненты, как автоматическое резервное копирование и установка исправлений, а также некоторые возможности портала для SQL Server. Эти компоненты не будут работать для виртуальных машин SQL Server после удаления _полного_ агента.

1. **В чем разница между виртуальными машинами SQL Server и службой "База данных SQL"?**

   По существу выполнение SQL Server в виртуальной машине Azure не отличается от выполнения SQL Server в удаленном центре данных. В отличие от этого, [база данных SQL Azure](../../database/sql-database-paas-overview.md) предлагает базу данных как услугу. При использовании Базы данных SQL у вас нет доступа к компьютерам, на которых размещаются ваши базы данных. Полное сравнение см. в разделе [Выбор компонента SQL Server в облаке: база данных SQL Azure (PaaS) или SQL Server на виртуальных машинах Azure (IaaS)](../../azure-sql-iaas-vs-paas-what-is-overview.md).

1. **Как установить SQL Server Data Tools в виртуальной машине Azure?**

    Скачайте инструменты SQL Server Data Tools со страницы [Microsoft SQL Server Data Tools ― Business Intelligence для Visual Studio 2013](https://www.microsoft.com/download/details.aspx?id=42313) и установите их.

1. **Поддерживаются ли распределенные транзакции с координатором распределенных транзакций (MSDTC) на виртуальных машинах SQL Server?**
   
    Да. Локальная служба DTC поддерживается в SQL Server 2016 с пакетом обновления 2 (SP2) и выше. Однако приложения должны быть протестированы при использовании группы доступности Always On, так как во время отработки отказа транзакции в реальном времени завершатся ошибкой и их необходимо повторить. Кластерная служба DTC доступна с Windows Server 2019. 
    
1. **Выполняет ли виртуальная машина Azure SQL перемещение или хранение данных клиента за пределами региона?**

   Нет. Фактически, виртуальная машина SQL Azure и расширение агента IaaS SQL не хранят никаких данных клиента.

## <a name="sql-server-iaas-agent-extension"></a>Расширение агента IaaS для SQL Server

1. **Следует ли регистрировать виртуальную машину SQL Server, подготовленную на основе образа SQL Server, в Azure Marketplace?**

   Нет. Корпорация Майкрософт автоматически регистрирует виртуальные машины, подготовленные на основе образов SQL Server в Azure Marketplace. Регистрация в расширении требуется только в том случае, если виртуальная машина *не* была подготовлена из образов SQL Server в Azure Marketplace и SQL Server была самостоятельно установлена.

1. **Доступно ли расширение агента IaaS SQL для всех клиентов?** 

   Да. Клиенты должны зарегистрировать свои SQL Server виртуальные машины с расширением, если они не использовали SQL Serverный образ из Azure Marketplace, а вместо этого самостоятельно установили SQL Server или добавили свой пользовательский виртуальный жесткий диск. Виртуальные машины, принадлежащие всем типам подписок (Direct, Соглашение Enterprise и поставщик облачных решений), могут зарегистрироваться в расширении агента IaaS SQL.

1. **Что представляет собой режим управления по умолчанию при регистрации в расширении агента IaaS SQL?**

   Режим управления по умолчанию при регистрации в расширении агента IaaS SQL является *облегченным*. Если свойство управления SQL Server не задано при регистрации в расширении, режим будет установлен как легковесный, а служба SQL Server не будет перезапускаться. Рекомендуется сначала зарегистрироваться в расширении агента IaaS SQL в упрощенном режиме, а затем выполнить обновление до полной версии в течение периода обслуживания. Аналогично, Управление по умолчанию также упрощено при использовании [функции автоматической регистрации](sql-agent-extension-automatic-registration-all-vms.md).

1. **Каковы предварительные требования для регистрации в расширении агента IaaS SQL?**

   Нет предварительных требований для регистрации с расширением агента IaaS SQL, отличным от установки SQL Server на виртуальной машине. Обратите внимание, что если расширение агента IaaS SQL установлено в полном режиме, SQL Server служба будет перезапущена, поэтому рекомендуется использовать его в течение периода обслуживания.

1. **Будет ли регистрация в расширении агента IaaS SQL установить агент на виртуальной машине?**

   Да, регистрация в расширении агента IaaS SQL в режиме полной управляемости устанавливает агент на виртуальную машину. Регистрация в режиме Lightweight или без агента не выполняется. 

   При регистрации в расширении агента IaaS SQL в упрощенном режиме на виртуальную машину копируются только *двоичные файлы* расширения агента SQL IaaS. агент не устанавливается. Затем эти двоичные файлы используются для установки агента при обновлении режима управления до полного.


1. **Будет ли регистрация с помощью расширения агента IaaS SQL SQL Server перезапуска на моей виртуальной машине?**

   Это зависит от режима, выбранного во время регистрации. Если указан режим "упрощенный" или "неагентный", то служба SQL Server не будет перезапущена. Однако при указании режима управления Full это приведет к перезапуску службы SQL Server. Функция автоматической регистрации регистрирует SQL Server виртуальные машины в упрощенном режиме, если только версия Windows Server не 2008. в этом случае SQL Server виртуальная машина будет зарегистрирована в режиме "без агента". 

1. **В чем разница между режимами упрощения и управления агентами при регистрации с помощью расширения агента IaaS SQL?** 

   Режим управления "без агента" является единственным доступным режимом управления для SQL Server 2008 и SQL Server 2008 R2 на Windows Server 2008. Для всех последующих версий Windows Server доступны два режима управления: Облегченный и полный. 

   Для режима "без агента" требуется, чтобы свойства SQL Server версии и выпуска были заданы клиентом. Упрощенный режим запрашивает у виртуальной машины версию и выпуск экземпляра SQL Server.

1. **Можно ли зарегистрироваться в расширении агента IaaS SQL без указания типа лицензии SQL Server?**

   Нет. Тип лицензии SQL Server не является дополнительным свойством при регистрации с расширением агента IaaS SQL. При регистрации с помощью расширения агента IaaS SQL необходимо задать тип лицензии SQL Server как "Оплата по мере использования" или "Преимущество гибридного использования Azure" во всех режимах управления (без агента, lightweight и Full). Если у вас есть какие-либо бесплатные версии SQL Server, например Выпуск Developer или Evaluation Edition, вы должны зарегистрироваться в лицензии с оплатой по мере использования. Преимущество гибридного использования Azure доступны только для платных версий SQL Server, таких как выпуски Enterprise и Standard.

1. **Можно ли обновить расширение SQL Server IaaS из режима агента в полный режим?**

   Нет. Обновление режима управляемости до Full или lightweight недоступно для режима "без агента". Это техническое ограничение Windows Server 2008. Необходимо сначала обновить ОС до Windows Server 2008 R2 или более поздней версии, после чего вы сможете выполнить обновление до режима полного управления. 

1. **Можно ли обновить расширение IaaS для SQL Server и перейти с упрощенного режима на полный?**

   Да. Обновление режима управляемости с Lightweight на Full поддерживается с помощью Azure PowerShell или портал Azure. Это приведет к перезапуску службы SQL Server.

1. **Можно ли понизить расширение SQL Server IaaS с полного режима до агента или упрощенного режима управления?**

   Нет. Понижение уровня режима управления расширения IaaS для SQL Server не поддерживается. Режим управляемости не может быть понижен из полного режима в режим "упрощенный" или "без агента", и его нельзя понизить с упрощенного режима на режим "без агента". 

   Чтобы изменить режим управляемости с полной управляемости, [Отмените регистрацию](sql-agent-extension-manually-register-single-vm.md#unregister-from-extension) SQL Server виртуальной машины в расширении агента IaaS SQL, удалив _ресурс_ виртуальной машины SQL и повторно ЗАрегистрируйте SQL Serverную виртуальную машину с расширением агента IaaS SQL в другом режиме управления.

1. **Можно ли зарегистрироваться в расширении агента IaaS SQL из портал Azure?**

   Нет. Регистрация в расширении агента IaaS SQL недоступна в портал Azure. Регистрация в расширении агента IaaS SQL поддерживается только в Azure CLI или Azure PowerShell. 

1. **Можно ли зарегистрировать виртуальную машину с расширением агента IaaS SQL до установки SQL Server?**

   Нет. Для успешной регистрации в расширении агента IaaS SQL виртуальная машина должна иметь хотя бы один экземпляр SQL Server (ядро СУБД). Если на виртуальной машине нет экземпляра SQL Server, новый ресурс Microsoft.SqlVirtualMachine будет находиться в состоянии сбоя.

1. **Можно ли зарегистрировать виртуальную машину с расширением агента IaaS SQL при наличии нескольких SQL Server экземпляров?**

   Да, если на виртуальной машине имеется экземпляр по умолчанию. Расширение агента IaaS SQL будет регистрировать только один экземпляр SQL Server (ядро СУБД). Расширение агента IaaS SQL будет регистрировать экземпляр SQL Server по умолчанию в случае нескольких экземпляров.

1. **Можно ли зарегистрировать экземпляр отказоустойчивого кластера SQL Server с расширением агента IaaS SQL?**

   Да. SQL Server экземпляры отказоустойчивого кластера на виртуальной машине Azure можно зарегистрировать с помощью расширения агента IaaS SQL в упрощенном режиме. Однако экземпляры отказоустойчивого кластера SQL Server нельзя обновить до режима полного управления.

1. **Можно ли зарегистрировать виртуальную машину с расширением агента IaaS SQL, если группа доступности Always On настроена?**

   Да. Регистрация SQL Server экземпляра на виртуальной машине Azure с расширением агента IaaS SQL не ограничена, если вы участвуете в конфигурации группы доступности Always On.

1. **Какова стоимость регистрации в расширении агента IaaS SQL или обновления до полного режима управления?**

   Отсутствует. Не взимается плата, связанная с регистрацией в расширении агента IaaS SQL, или с использованием любого из трех режимов управления. Управление виртуальной машиной SQL Server с помощью расширения полностью бесплатное. 

1. **Как сказывается на производительности использование различных режимов управления?**

   Использование *упрощенного* режима управления и *NoAgent* не влияет на производительность. При использовании режима *полного* управления есть минимальное влияние двух служб, установленных в операционной системе. Их можно отслеживать с помощью диспетчера задач и просматривать во встроенной консоли служб Windows. 

   Имена этих двух служб:
   - `SqlIaaSExtensionQuery` (отображаемое имя — `Microsoft SQL Server IaaS Query Service`);
   - `SQLIaaSExtension` (отображаемое имя — `Microsoft SQL Server IaaS Agent`).

1. **Разделы справки удалить расширение?**

   Удалите расширение, отменив [регистрацию](sql-agent-extension-manually-register-single-vm.md#unregister-from-extension) SQL Server виртуальной машины в расширении агента IaaS SQL. 

## <a name="resources"></a>Ресурсы

**Для виртуальных машин Windows**:

* [Обзор SQL Server на виртуальных машинах Windows](sql-server-on-azure-vm-iaas-what-is-overview.md).
* [Инициализация SQL Server на виртуальной машине Windows](create-sql-vm-portal.md)
* [Миграция базы данных в SQL Server на виртуальной машине Azure](migrate-to-vm-from-sql-server.md)
* [Высокий уровень доступности и аварийное восстановление для SQL Server на виртуальных машинах Azure](business-continuity-high-availability-disaster-recovery-hadr-overview.md)
* [Рекомендации по оптимизации производительности SQL Server на виртуальных машинах Azure](performance-guidelines-best-practices.md)
* [Шаблоны приложений и стратегии разработки для SQL Server на виртуальных машинах Azure](application-patterns-development-strategies.md)

**Для виртуальных машин Linux**:

* [Обзор SQL Server на виртуальных машинах Linux](../linux/sql-server-on-linux-vm-what-is-iaas-overview.md).
* [Инициализация SQL Server на виртуальной машине Linux](../linux/sql-vm-create-portal-quickstart.md)
* [Frequently asked questions for SQL Server on Linux Azure Virtual Machines](../linux/frequently-asked-questions-faq.md) (Часто задаваемые вопросы об SQL Server на виртуальных машинах Azure (Linux))
* [Документация по SQL Server в Linux](/sql/linux/sql-server-linux-overview).
