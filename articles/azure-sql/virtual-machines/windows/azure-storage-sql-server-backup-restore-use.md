---
title: Как использовать службу хранилища Azure для SQL Server резервного копирования и восстановления | Документация Майкрософт
description: Узнайте, как выполнить архивацию SQL Server в службу хранилища Azure. Описаны преимущества архивации баз данных SQL в службу хранилища Azure.
services: virtual-machines-windows
documentationcenter: ''
author: MashaMSFT
tags: azure-service-management
ms.assetid: 0db7667d-ef63-4e2b-bd4d-574802090f8b
ms.service: virtual-machines-sql
ms.subservice: backup
ms.topic: conceptual
ms.tgt_pltfrm: vm-windows-sql-server
ms.workload: iaas-sql-server
ms.date: 01/31/2017
ms.author: mathoma
ms.openlocfilehash: 35fff49a53f5a0a9532fd0dff841356c5deaf3ea
ms.sourcegitcommit: 772eb9c6684dd4864e0ba507945a83e48b8c16f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "97724788"
---
# <a name="use-azure-storage-for-sql-server-backup-and-restore"></a>Использование службы хранилища Azure для SQL Server резервного копирования и восстановления
[!INCLUDE[appliesto-sqlvm](../../includes/appliesto-sqlvm.md)]

Начиная с SQL Server 2012 с пакетом обновления 1 (SP1) CU2, теперь можно создавать резервные копии SQL Server баз данных непосредственно в хранилище BLOB-объектов Azure. Используйте эту функцию для резервного копирования и восстановления из хранилища BLOB-объектов Azure. Резервное копирование в облако предоставляет преимущества доступности, геореплицируемого хранилища вне сайта и простоту миграции данных в облако и из него. Выдавать `BACKUP` инструкции или `RESTORE` операторы можно с помощью TRANSACT-SQL или объектов SMO.

## <a name="overview"></a>Обзор
SQL Server 2016 содержит новые возможности: можно использовать [архивацию моментальных снимков файлов](/sql/relational-databases/backup-restore/file-snapshot-backups-for-database-files-in-azure) , чтобы практически мгновенно выполнять архивацию и невероятно быстро осуществлять восстановление.

В этом разделе объясняется, почему вы можете использовать службу хранилища Azure для SQL Server резервных копий, а затем описывает используемые компоненты. Вы можете использовать ресурсы, предоставленные в конце статьи, для доступа к пошаговым руководствам и дополнительным сведениям, чтобы приступить к использованию этой службы с резервными копиями SQL Server.

## <a name="benefits-of-using-azure-blob-storage-for-sql-server-backups"></a>Преимущества использования хранилища BLOB-объектов Azure для резервного копирования SQL Server
Есть несколько задач, которые нужно решить при архивации SQL Server. К ним относятся управление хранилищами, риск отказа хранилища, доступ к внешнему хранилищу и настройка устройств. Многие из этих задач решаются с помощью хранилища BLOB-объектов Azure для SQL Server резервных копий. Учтите следующие преимущества.

* **Удобство использования**. Хранение резервных копий в больших двоичных объектах Azure может быть удобным, гибким и доступным вариантом внешнего хранения. Создание внешнего хранилища для архивов SQL Server может быть не сложнее изменения существующих сценариев и заданий для использования синтаксиса **BACKUP TO URL**. Удаленное хранилище обычно должно быть расположено достаточно далеко от рабочей базы данных, чтобы одна авария не могла повлиять одновременно и на удаленную копию, и на рабочую базу данных. Выбор [георепликации больших двоичных объектов Azure](../../../storage/common/storage-redundancy.md) обеспечивает дополнительный уровень защиты в случае аварии, которая может повлиять на весь регион.
* **Архив резервного копирования**. хранилище BLOB-объектов Azure предлагает лучшую альтернативу часто используемому варианту ленты для архивации резервных копий. Может потребоваться физически транспортировать накопители на магнитной ленте в удаленное помещение и принимать меры для защиты носителей. Хранение резервных копий в хранилище BLOB-объектов Azure обеспечивает возможность мгновенного, высокодоступного и надежного архивирования.
* **Управляемое оборудование**. При использовании служб Azure отсутствуют накладные расходы на управление оборудованием. Службы Azure управляют оборудованием, обеспечивая при этом георепликацию для избыточности и защиту от сбоев оборудования.
* **Неограниченное хранилище**. Включая прямую архивацию в большие двоичные объекты Azure, вы получаете доступ к практически неограниченным ресурсам хранения. Кроме того, архивация на диск виртуальной машины Azure имеет ограничения в зависимости от размера виртуальной машины. Число дисков, которые можно подключить к виртуальной машине Azure для хранения резервных копий, ограничено. Для сверхбольших экземпляров данное ограничение составляет 16 дисков, а для небольших экземпляров это количество меньше.
* **Доступность архивов**. Архивы, сохраненные в больших двоичных объектах Azure, теперь доступны везде и всегда. К ним легко получить доступ для восстановления данных в экземпляр SQL Server. Подключать или отключать базу данных или скачивать и подключать виртуальный жесткий диск при этом не требуется.
* **Затраты** — оплата только тех услуг, которые используются. Может применяться в качестве экономически эффективного решения по удаленному резервному копированию и архивированию. Дополнительные сведения см. на страницах [Калькулятор цен](https://go.microsoft.com/fwlink/?LinkId=277060 "Калькулятор цен") и [Цены Azure](https://go.microsoft.com/fwlink/?LinkId=277059 "Цены Azure").
* **Моментальные снимки хранилища.** Если файлы базы данных хранятся в большом двоичном объекте Azure и используется SQL Server 2016, то можно использовать [архивацию файлов моментальных снимков](/sql/relational-databases/backup-restore/file-snapshot-backups-for-database-files-in-azure), чтобы выполнять архивацию и восстановление практически мгновенно.

Дополнительные сведения см. в статье [SQL Server резервное копирование и восстановление с помощью хранилища BLOB-объектов Azure](/sql/relational-databases/backup-restore/sql-server-backup-and-restore-with-microsoft-azure-blob-storage-service).

В следующих двух разделах представлено хранилище BLOB-объектов Azure, включая необходимые компоненты SQL Server. Важно понимать компоненты и их взаимодействие, чтобы успешно использовать резервное копирование и восстановление из хранилища BLOB-объектов Azure.

## <a name="azure-blob-storage-components"></a>Компоненты хранилища BLOB-объектов Azure
При резервном копировании в хранилище BLOB-объектов Azure используются следующие компоненты Azure.

| Компонент | Описание |
| --- | --- |
| **Учетная запись хранения** |Учетная запись хранения является отправной точкой для всех служб хранилища. Чтобы получить доступ к хранилищу BLOB-объектов Azure, сначала создайте учетную запись хранения Azure. Дополнительные сведения о хранилище BLOB-объектов Azure см. [в статье как использовать хранилище BLOB](https://azure.microsoft.com/develop/net/how-to-guides/blob-storage/)-объектов Azure. |
| **Контейнер** |Контейнер позволяет сгруппировать набор больших двоичных объектов и может содержать неограниченное количество больших двоичных объектов. Чтобы записать SQL Server резервную копию в хранилище BLOB-объектов Azure, необходимо создать по крайней мере корневой контейнер. |
| **Большие двоичные объекты** |Файл любого типа и размера. Для адресации больших двоичных объектов используется следующий формат URL-адреса: `https://<storageaccount>.blob.core.windows.net/<container>/<blob>` . Дополнительные сведения о страничных BLOB-объектах см. в статье [Understanding Block and Page Blobs](/rest/api/storageservices/Understanding-Block-Blobs--Append-Blobs--and-Page-Blobs) (Основные сведения о блочных, добавочных и страничных BLOB-объектах). |

## <a name="sql-server-components"></a>Компоненты SQL Server
При резервном копировании в хранилище BLOB-объектов Azure используются следующие компоненты SQL Server.

| Компонент | Описание |
| --- | --- |
| **URL-адрес** |URL-адрес определяет универсальный идентификатор ресурса (URI) для уникального файла резервной копии. URL-адрес содержит расположение и имя файла резервной копии SQL Server. URL-адрес должен указывать на фактический большой двоичный объект, а не просто на контейнер. Если BLOB-объект не существует, Azure создаст его. Если указан существующий большой двоичный объект, команда Backup завершается ошибкой, если `WITH FORMAT` не указан параметр. Ниже приведен пример URL-адреса, который можно указать в команде BACKUP: `https://<storageaccount>.blob.core.windows.net/<container>/<FILENAME.bak>` .<br><br> Использование HTTPS рекомендуется, но не является обязательным. |
| **Учетные данные** |Сведения, необходимые для подключения и проверки подлинности в хранилище BLOB-объектов Azure, хранятся в виде учетных данных. Чтобы разрешить SQL Server записывать резервные копии как BLOB-объекты Azure или выполнять восстановление из BLOB-объектов, необходимо создать учетные данные SQL Server. Дополнительные сведения см. в статье [SQL Server Credential](/sql/t-sql/statements/create-credential-transact-sql) (Учетные данные SQL Server). |

> [!NOTE]
> SQL Server 2016 обновлена для поддержки блочных BLOB-объектов. Дополнительные сведения см. в [руководстве по использованию хранилища BLOB-объектов Microsoft Azure с базами данных SQL Server 2016](/sql/relational-databases/tutorial-use-azure-blob-storage-service-with-sql-server-2016) .
> 

## <a name="next-steps"></a>Дальнейшие действия

1. Если у вас ее еще нет, создайте учетную запись Azure. При оценке затрат на Azure рассмотрите [бесплатную пробную версию](https://azure.microsoft.com/free/).
2. Затем следуйте одному из следующих учебников, в которых описывается создание учетной записи и выполнение восстановления.
   
   * **SQL Server 2014**: [учебник. SQL Server 2014 резервное копирование и восстановление в Microsoft Azure хранилище BLOB-объектов](/previous-versions/sql/2014/relational-databases/backup-restore/sql-server-backup-to-url).
   * **SQL Server 2016**: [учебник. Использование хранилища Blob-объектов Microsoft Azure с базами данных SQL Server 2016](/sql/relational-databases/tutorial-use-azure-blob-storage-service-with-sql-server-2016)
3. Ознакомьтесь с дополнительной документацией, начиная с [SQL Server резервного копирования и восстановления с Microsoft Azure хранилищем BLOB-объектов](/sql/relational-databases/backup-restore/sql-server-backup-and-restore-with-microsoft-azure-blob-storage-service).

При наличии проблем ознакомьтесь с разделом [Резервное копирование SQL Server на URL-адрес — рекомендации и устранение неполадок](/sql/relational-databases/backup-restore/sql-server-backup-to-url-best-practices-and-troubleshooting).

Другие SQL Server параметры резервного копирования и восстановления см. [в статье резервное копирование и восстановление для SQL Server на виртуальных машинах Azure](backup-restore.md).