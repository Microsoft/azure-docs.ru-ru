---
title: 'Хранилище: рекомендации по повышению производительности & рекомендации'
description: Предоставляет рекомендации и рекомендации по оптимизации производительности SQL Server на виртуальной машине Azure.
services: virtual-machines-windows
documentationcenter: na
author: dplessMSFT
editor: ''
tags: azure-service-management
ms.assetid: a0c85092-2113-4982-b73a-4e80160bac36
ms.service: virtual-machines-sql
ms.devlang: na
ms.topic: conceptual
ms.tgt_pltfrm: vm-windows-sql-server
ms.workload: iaas-sql-server
ms.date: 03/25/2021
ms.author: dpless
ms.reviewer: jroth
ms.openlocfilehash: 001a9a15c259d0b0d73eec9c9a39ad7c27f26721
ms.sourcegitcommit: f0a3ee8ff77ee89f83b69bc30cb87caa80f1e724
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/26/2021
ms.locfileid: "105572519"
---
# <a name="storage-performance-best-practices-for-sql-server-on-azure-vms"></a>Хранилище: рекомендации по повышению производительности SQL Server на виртуальных машинах Azure
[!INCLUDE[appliesto-sqlvm](../../includes/appliesto-sqlvm.md)]

В этой статье приводятся рекомендации и рекомендации по оптимизации производительности SQL Server на виртуальных машинах Azure.

Как правило, существует компромисс между оптимизацией затрат и оптимизацией производительности. Эта серия рекомендаций по повышению производительности сосредоточена на получении *оптимальной* производительности для SQL Server на виртуальных машинах Azure. Если рабочая нагрузка не так велика, могут потребоваться не все рекомендуемые варианты оптимизации. При оценке этих рекомендаций учитывайте актуальные потребности в производительности, затраты и характер рабочих нагрузок.

Дополнительные сведения см. в других статьях в этой серии: [Контрольный список производительности](performance-guidelines-best-practices-checklist.md), [Размер виртуальной машины](performance-guidelines-best-practices-vm-size.md)и [базовый уровень](performance-guidelines-best-practices-collect-baseline.md). 

## <a name="checklist"></a>Контрольный список

Ознакомьтесь со следующим контрольным списком, чтобы получить краткий обзор рекомендаций по хранению, которые в остальной части статьи более подробно описаны. 

- Мониторинг приложения и [Определение требований к пропускной способности и задержкам хранилища](../../../virtual-machines/premium-storage-performance.md#counters-to-measure-application-performance-requirements) для SQL Server файлов данных, журналов и tempdb перед выбором типа диска. 
- Чтобы оптимизировать производительность хранилища, запланируйте доступ к самым высоким некэшированным операциям ввода-вывода и используйте кэширование данных как функцию производительности для чтения данных, избегая [ограниченного выделения виртуальных машин и дисков](../../../virtual-machines/premium-storage-performance.md#throttling).
- Размещайте файлы данных, журналов и tempdb на разных дисках.
    - Для диска данных используйте только [диски P30 и P40 Premium](../../../virtual-machines/disks-types.md#premium-ssd) , чтобы обеспечить доступность поддержки кэша.
    - Для плана диска журнала с учетом емкости и производительности тестирования в сравнении с расчетом на [диски P30-P80 уровня "Премиум](../../../virtual-machines/disks-types.md#premium-ssd) "
      - Если требуется задержка хранилища в миллисекундах, используйте для журнала транзакций [Ultra-диски Azure](../../../virtual-machines/disks-types.md#ultra-disk) . 
      - Для развертываний виртуальных машин серии M рекомендуется [написать ускоритель](../../../virtual-machines/how-to-enable-write-accelerator.md) с помощью Ultra-дисков Azure.
    - Разместите [базу данных tempdb](/sql/relational-databases/databases/tempdb-database) на локальном жестком диске с ВРЕМЕНным накопителем `D:\` для большинства SQL Server рабочих нагрузок, выбрав оптимальный размер виртуальной машины. 
      - Если емкость локального диска не достаточна для базы данных tempdb, рекомендуется изменить размер виртуальной машины. Дополнительные сведения см. в разделе [политики кэширования файлов данных](#data-file-caching-policies) .
- Создавайте несколько дисков данных Azure с помощью [дисковых пространств](/windows-server/storage/storage-spaces/overview) , чтобы увеличить пропускную способность для операций ввода-вывода и ограничения пропускной способности целевой виртуальной машины.
- Установите для [кэширования узла](../../../virtual-machines/disks-performance.md#virtual-machine-uncached-vs-cached-limits) значение только чтение для дисков с файлами данных.
- Установите для [кэширования узла](../../../virtual-machines/disks-performance.md#virtual-machine-uncached-vs-cached-limits) значение None для дисков файлов журнала.
    - Не включайте Кэширование чтения и записи на дисках, содержащих файлы SQL Server. 
    - Всегда прекращайте работу службы SQL Server, прежде чем изменять параметры кэша диска.
- Для рабочих нагрузок разработки и тестирования и архивации долгосрочного резервного копирования рекомендуется использовать хранилище уровня "Стандартный". Не рекомендуется использовать HDD (цен. категория "Стандартный") или SSD для рабочих нагрузок.
- [Разбивка дисков на основе кредита](../../../virtual-machines/disk-bursting.md#credit-based-bursting) (P1-P20) должна учитываться только для небольших рабочих нагрузок разработки и тестирования и систем отделов.
- Подготавливает учетную запись хранения в том же регионе, что и виртуальная машина SQL Server. 
- Отключите геоизбыточное хранилище Azure (георепликацию) и используйте LRS (локально избыточное хранилище) в учетной записи хранения.
- Отформатируйте диск данных, чтобы он использовал размер единицы распределения 64 КБ для всех файлов данных, размещенных на диске, отличном от временного `D:\` диска (по умолчанию — 4 КБ). SQL Server виртуальные машины, развернутые с помощью Azure Marketplace, поставляются с дисками данных с размером единицы размещения и чередованием для пула носителей, установленного в 64 КБ. 

Чтобы сравнить контрольный список хранилища с другими, ознакомьтесь с подробным [списком рекомендаций по повышению производительности](performance-guidelines-best-practices-checklist.md). 

## <a name="overview"></a>Обзор

Чтобы найти наиболее эффективную конфигурацию для SQL Server рабочих нагрузок на виртуальной машине Azure, начните с [измерения производительности хранилища бизнес-приложений](performance-guidelines-best-practices-collect-baseline.md#storage). После того как требования к хранилищу известны, выберите виртуальную машину, которая поддерживает необходимые операции ввода-вывода и пропускную способность с соответствующим соотношением "память — Виртуальное ядро". 

Выберите размер виртуальной машины с достаточной масштабируемостью хранилища для вашей рабочей нагрузки и сочетанием дисков (обычно в пуле носителей), которые соответствуют требованиям вашего бизнеса к емкости и производительности. 

Тип диска зависит как от типа файла, который размещен на диске, так и от пиковых требований к производительности.

> [!TIP]
> Подготовка виртуальной машины SQL Server с помощью портал Azure помогает выполнить процесс настройки хранилища и реализует большинство рекомендаций по хранению, таких как создание отдельных пулов носителей для файлов данных и журналов, использование tempdb на `D:\` диске и включение оптимальной политики кэширования. Дополнительные сведения о подготовке и настройке хранилища см. в статье [Конфигурация хранилища виртуальных машин SQL](storage-configuration.md). 

## <a name="vm-disk-types"></a>Типы дисков виртуальной машины

Вы можете выбрать уровень производительности для дисков. Типами управляемых дисков, доступных в качестве базового хранилища (с увеличением возможностей производительности), являются стандартные жесткие диски (HDD), стандартные SSD, твердотельные накопители уровня "Премиум" и диски Ultra. 

Производительность диска увеличится с учетом таких [меток дисков категории "Премиум](../../../virtual-machines/disks-types.md#premium-ssd) ", как P1 с 4 гиб пространства и 120 операций ввода-вывода в секунду на P80 с 32 Тиб хранилища и 20 000 операций ввода-вывода в секунду. Хранилище класса Premium поддерживает кэш хранилища, который помогает повысить производительность операций чтения и записи для некоторых рабочих нагрузок. Дополнительные сведения см. в разделе [Общие сведения об управляемых дисках](../../../virtual-machines/managed-disks-overview.md). 

Существует также три основных [типа дисков](../../../virtual-machines/managed-disks-overview.md#disk-roles) , которые следует учитывать для SQL Server на виртуальной машине Azure — диск ОС, временный диск и диски данных. Тщательно выбирайте, что хранится на диске операционной системы `(C:\)` и временных временных дисках `(D:\)` . 

### <a name="operating-system-disk"></a>Диск операционной системы

Диск операционной системы — это виртуальный жесткий диск, который может быть загружен и подключен как работающая версия операционной системы и помечен как `C:\` диск. При создании виртуальной машины Azure платформа присоединяет по крайней мере один диск к виртуальной машине для диска операционной системы. `C:\`Диск является расположением по умолчанию для установки приложений и конфигурации файлов. 

В рабочих средах SQL Server не используйте диск операционной системы для файлов данных, файлов журнала и журналов ошибок. 

### <a name="temporary-disk"></a>Временный диск

Многие виртуальные машины Azure содержат другой тип диска, называемый временным диском (обозначенный как `D:\` диск). В зависимости от ряда виртуальных машин и размера емкости этого диска может отличаться. Временный диск является эфемерным, то есть диск создается повторно (как в, он освобождается и выделяется снова), когда виртуальная машина перезапускается или перемещается на другой узел (например, для [восстановления службы](/troubleshoot/azure/virtual-machines/understand-vm-reboot)). 

Временный диск хранилища не сохраняется в удаленном хранилище и поэтому не должен хранить файлы пользовательской базы данных, файлы журнала транзакций или что-либо, которое необходимо сохранить. 

Размещайте базу данных tempdb на локальном временном `D:\` накопителе SSD для SQL Server рабочих нагрузок, если только не используется локальный кэш. Если вы используете виртуальную машину, в которой [нет временного диска](../../../virtual-machines/azure-vms-no-temp-disk.md) , рекомендуется разместить базу данных tempdb на отдельном изолированном диске или пуле носителей с установленным кэшированием "только для чтения". Дополнительные сведения см. в статье [база данных tempdb: политики кэширования](performance-guidelines-best-practices-storage.md#data-file-caching-policies).

### <a name="data-disks"></a>Диски данных

Диски данных — это диски удаленного хранилища, которые часто создаются в [пулах носителей](/windows-server/storage/storage-spaces/overview) , чтобы превысить емкость и производительность, которые может предоставить виртуальная машина любому отдельному диску.

Подключите минимальное количество дисков, удовлетворяющих требованиям к операциям ввода-вывода, пропускной способности и емкости рабочей нагрузки. Не следует превысить максимальное количество дисков данных наименьшей виртуальной машины, для которой планируется изменить размер.

Размещайте файлы данных и журналов на дисках данных, подготовленных в соответствии с требованиями к производительности. 

Отформатируйте диск данных, чтобы он использовал размер единицы распределения 64 КБ для всех файлов данных, размещенных на диске, отличном от временного `D:\` диска (по умолчанию — 4 КБ). SQL Server виртуальные машины, развернутые с помощью Azure Marketplace, поставляются с дисками данных с размером единицы размещения и чередованием для пула носителей, установленного в 64 КБ. 

## <a name="premium-disks"></a>Диски уровня "Премиум"

Используйте накопители SSD уровня "Премиум" для файлов данных и журналов для рабочих нагрузок рабочей SQL Server. SSD (цен. категория "Премиум") операций ввода-вывода и пропускной способности различаются в зависимости от [размера и типа диска](../../../virtual-machines/disks-types.md). 

Для рабочих нагрузок используйте диски P30 и P40 для SQL Server файлов данных, чтобы обеспечить поддержку кэширования и использовать P30 до P80 для SQL Server файлов журнала транзакций.  Для получения наибольшей совокупной стоимости владения Начните с P30s (5000 операций ввода-вывода в секунду/200 МБИТ/с) для файлов данных и журналов и выбирайте более высокие мощности, если требуется управлять числом дисков виртуальной машины.

Для рабочих нагрузок OLTP сопоставьте целевые операции ввода-вывода на диск (или пул носителей) с требованиями к производительности, используя рабочие нагрузки в пиковое время и `Disk Reads/sec`  +  `Disk Writes/sec` счетчики производительности. Для рабочих нагрузок хранилища данных и отчетов сопоставьте целевую пропускную способность с помощью рабочих нагрузок в пиковое время и `Disk Read Bytes/sec`  +  `Disk Write Bytes/sec` . 

Используйте дисковые пространства для достижения оптимальной производительности, настройте два пула: один для файлов журнала, а другой для файлов данных. Если чередование дисков не используется, используйте два диска SSD уровня "Премиум", сопоставленные с отдельными дисками, где один диск содержит файл журнала, а другой — данные.

[Подготовленные операции ввода-вывода в секунду и пропускная способность](../../../virtual-machines/disks-types.md#premium-ssd) на диск, используемые в составе пула носителей. Объединенные возможности операций ввода-вывода в секунду и пропускной способности дисков — это максимальная возможность до ограничения пропускной способности виртуальной машины.

Рекомендуется использовать минимальное количество дисков, чтобы удовлетворить минимальные требования к операциям ввода-вывода (и пропускной способности) и емкости. Однако баланс цены и производительности, как правило, лучше с большим количеством небольших дисков, а не с небольшим количеством больших дисков.

### <a name="scaling-premium-disks"></a>Масштабирование дисков класса Premium

При первом развертывании управляемого диска Azure уровень производительности для этого диска зависит от размера подготовленного диска. Назначьте уровень производительности при развертывании или измените его позже, не меняя размер диска. При увеличении спроса можно повысить уровень производительности в соответствии с потребностями бизнеса. 

Изменение уровня производительности позволяет администраторам подготавливать и отвечать более высокими спросами, не полагаясь на нагрузку на [диск](../../../virtual-machines/disk-bursting.md#credit-based-bursting). 

Используйте более высокую производительность в течение всего времени, когда выставление счетов соответствует уровню производительности хранилища. Обновите уровень в соответствии с требованиями к производительности без увеличения емкости. Вернитесь к исходному уровню, когда дополнительная производительность больше не требуется.

Это экономичное и временное расширение производительности — это надежный вариант использования целевых событий, таких как покупка, тестирование производительности, обучающие мероприятия и другие короткие окна, в которых большая производительность необходима только в течение короткого срока. 

Дополнительные сведения см. в статье [уровни производительности для управляемых дисков](../../../virtual-machines/disks-change-performance.md). 

## <a name="azure-ultra-disk"></a>Ultra Disk в Azure

Если время отклика в миллисекундах требует меньшего времени, рекомендуется использовать для SQL Server диска журнала [Azure Ultra Disk](../../../virtual-machines/disks-types.md#ultra-disk) или даже диск данных для приложений, которые чрезвычайно чувствительны к задержкам ввода-вывода. 

Можно настроить Ultra Disk, где емкость и операции ввода-вывода могут масштабироваться независимо друг от друга. С помощью администраторов Ultra Disk можно подготавливать диск с требованиями к емкости, операциям ввода-вывода в секунду и пропускной способности в зависимости от потребностей приложения. 

Ultra Disk не поддерживается во всех рядах виртуальных машин и имеет другие ограничения, такие как доступность региона, избыточность и поддержка Azure Backup. Дополнительные сведения см. в статье [Использование Ultra дисков Azure](../../../virtual-machines/disks-enable-ultra-ssd.md) для получения полного списка ограничений. 

## <a name="standard-hdds-and-ssds"></a>Стандартные жесткие диски и твердотельные накопители

[Стандартные жесткие диски](../../../virtual-machines/disks-types.md#standard-hdd) и твердотельные накопители имеют различные задержки и пропускную способность и рекомендуются только для рабочих нагрузок разработки и тестирования. Для производственных рабочих нагрузок необходимо использовать SSD (цен. категория "Премиум"). Если вы используете SSD (цен. категория "Стандартный") (сценарии разработки и тестирования), рекомендуется добавить максимальное число дисков данных, поддерживаемое [размером виртуальной машины](../../../virtual-machines/sizes.md?toc=/azure/virtual-machines/windows/toc.json) , и использовать чередование дисков с дисками для лучшей производительности.

## <a name="caching"></a>Caching

Виртуальные машины, поддерживающие кэширование хранилища класса Premium, могут использовать дополнительную функцию, называемую BlobCache или кэшированием узла Azure для расширения возможностей операций ввода-вывода и пропускной способности виртуальной машины. Виртуальные машины, поддерживающие хранилище класса Premium и хранилище класса Premium, имеют два разных ограничения пропускной способности хранилища, которые можно использовать вместе для повышения производительности хранилища.

Пропускная способность операций ввода-вывода в секунду и Мбит/с без кэширования учитывает ограничения пропускной способности некэшированного диска виртуальной машины. Максимальные кэшированные ограничения предоставляют дополнительный буфер для операций чтения, который помогает увеличивать и непредвиденные пиковые значения.

Включите кэширование уровня "Премиум" каждый раз, когда поддерживается параметр, чтобы значительно повысить производительность операций чтения с диска данных без дополнительных затрат. 

Чтение и запись в BlobCache Azure (кэшированные операции ввода-вывода и пропускная способность) не учитываются для некэшированных операций ввода/вывода в секунду и ограничений пропускной способности виртуальной машины.

> [!NOTE]
> Кэширование дисков не поддерживается для дисков 4 Тиб и больше (P50 и больше). Если к виртуальной машине подключено несколько дисков, то кэширование применяется ко всем дискам, размер которых меньше 4 ТиБ. Дополнительные сведения см. в разделе [кэширование диска](../../../virtual-machines/premium-storage-performance.md#disk-caching). 

### <a name="uncached-throughput"></a>Некэшированная пропускная способность

Максимальное число операций ввода-вывода и пропускная способность для диска не в кэше — это максимальный предел удаленного хранилища, который может быть подключен виртуальной машиной. Это ограничение определено на виртуальной машине и не является ограничением базового дискового накопителя. Это ограничение применяется только к операциям ввода-вывода для дисков данных, удаленных к виртуальной машине, а не локальных операций ввода-вывода для временного диска ( `D:\` диска) или диска операционной системы.

Объем некэшированных операций ввода-вывода в секунду и пропускная способность, доступные для виртуальной машины, можно проверить в документации по виртуальной машине.

Например, документация по [сериям M](../../../virtual-machines/m-series.md) показывает, что максимальная некэшированная пропускная способность для Standard_M8ms виртуальной машины составляет 5000 операций ввода-вывода в секунду и 125 Мбит/с для некэшированной пропускной способности диска. 

![Снимок экрана, показывающий документацию по пропускной способности некэшированного диска серии M.](./media/performance-guidelines-best-practices/m-series-table.png)

Также можно увидеть, что Standard_M32ts поддерживает 20 000 некэшированных дисковых операций ввода-вывода и 500 Мбит/с для некэшированного диска. Это ограничение регулируется на уровне виртуальной машины независимо от базового хранилища дисков уровня "Премиум".

Дополнительные сведения см. в разделе некэшированные [и кэшированные ограничения](../../../virtual-machines/linux/disk-performance-linux.md#virtual-machine-uncached-vs-cached-limits).


### <a name="cached-and-temp-storage-throughput"></a>Пропускная способность кэшированного и временного хранилища

Максимальное кэшированное и временное ограничение пропускной способности хранилища — это отдельный предел от некэшированной пропускной способности виртуальной машины. BlobCache Azure состоит из комбинации оперативной памяти узла виртуальной машины и локально подключенного SSD. Временный диск ( `D:\` диск) в виртуальной машине также размещается на этом локальном SSD.

Максимальное кэшированное и временное ограничение пропускной способности хранилища управляет вводом-выводом для локального временного диска ( `D:\` диска) и Azure BlobCache, **только если** включено кэширование узла. 

Если кэширование включено в хранилище класса Premium, виртуальные машины могут масштабироваться за пределами ограничений операций ввода-вывода ВИРТУАЛЬНЫХ машин без кэширования и ограничения пропускной способности.  

Только некоторые виртуальные машины поддерживают хранилище класса Premium и кэширование хранилища класса Premium (которые необходимо проверить в документации по виртуальной машине). Например, документация по [сериям M](../../../virtual-machines/m-series.md) указывает, что поддерживается хранилище класса Premium и кэширование хранилища класса Premium: 

![Снимок экрана, показывающий поддержку хранилища Premium серии M.](./media/performance-guidelines-best-practices/m-series-table-premium-support.png)

Ограничения кэша будут зависеть от размера виртуальной машины. Например, виртуальная машина Standard_M8ms поддерживает 10000 кэшированных дисковых операций ввода-вывода в секунду и 1000 Мбит/с для кэшированного диска с общим размером кэша в 793 гиб. Аналогичным образом Standard_M32ts виртуальная машина поддерживает 40000 кэшированных дисковых операций ввода-вывода и 400 Мбит/с для кэшированного диска с общим размером кэша 3174 гиб. 

![Снимок экрана с документацией по пропускной способности кэшированного диска серии M.](./media/performance-guidelines-best-practices/m-series-table-cached-temp.png)

Можно вручную включить кэширование узла на существующей виртуальной машине. Прежде чем вносить изменения в политику кэширования виртуальной машины, закройте все рабочие нагрузки приложений и службы SQL Server. Изменение любого из параметров кэша виртуальной машины приводит к отсоединению и повторному присоединению целевого диска после применения параметров.

### <a name="data-file-caching-policies"></a>Политики кэширования файлов данных

Политика кэширования хранилища зависит от типа SQL Server файлов данных, размещенных на диске. 

В следующей таблице приведена сводка рекомендуемых политик кэширования на основе типа данных SQL Server. 

|SQL Server диск |Рекомендация |
|---------|---------|
| **Диск данных** | Включите `Read-only` кэширование для дисков, на которых размещены файлы данных SQL Server. <br/> Чтение из кэша будет выполняться быстрее, чем некэшированные операции чтения с диска данных. <br/> Некэшированные операции ввода-вывода и пропускная способность плюс кэшированные операции ввода-вывода и пропускная способность будут возвращать общую возможную производительность виртуальной машины в пределах виртуальных машин, но фактическая производительность зависит от способности рабочей нагрузки использовать кэш (коэффициент попадания в кэш). <br/>|
|**Диск журнала транзакций**|Задайте политику кэширования `None` для дисков, на которых размещается журнал транзакций.  Включение кэширования для диска журнала транзакций не дает выигрыша в производительности, а при `Read-only` `Read/Write` включении или кэшировании на диске журнала может снизиться производительность операций записи на диск и уменьшить объем кэша, доступный для операций чтения на диске данных.  |
|**Диск операционной системы** | Политика кэширования по умолчанию может иметь значение `Read-only` или `Read/write` для диска операционной системы. <br/> Не рекомендуется изменять уровень кэширования диска операционной системы.  |
| **tempdb**| Если базу данных tempdb невозможно разместить на временном диске `D:\` из-за возможных причин, измените размер виртуальной машины, чтобы увеличить временный диск или разместить базу данных tempdb на отдельном диске с `Read-only` настроенным кэшированием. <br/> Кэш виртуальной машины и временный диск используют локальный SSD, поэтому помните об этом при определении размера операций ввода-вывода базы данных tempdb при размещении на временном диске.| 
| | | 


Дополнительные сведения см. в разделе [кэширование диска](../../../virtual-machines/premium-storage-performance.md#disk-caching). 


## <a name="disk-striping"></a>Чередование дисков

Проанализируйте пропускную способность и пропускную способность, необходимую для файлов данных SQL, чтобы определить количество дисков данных, включая файл журнала и tempdb. Пропускная способность и ограничения пропускной способности зависят от размера виртуальной машины. Дополнительные сведения см. в статье [Размер виртуальной машины](../../../virtual-machines/sizes.md) .

Добавьте дополнительные диски данных и используйте чередование дисков для большей пропускной способности. Например, приложение, для которого требуется 12 000 операций ввода-вывода в секунду и 180 МБ/с, может использовать три чередующихся P30 диска для доставки 15 000 операций ввода-вывода в секунду и 600 МБ/с. 

Сведения о настройке чередования дисков см. в разделе [чередование дисков](storage-configuration.md#disk-striping). 

## <a name="disk-capping"></a>Ограниченное дисковое выделение 

На уровне диска и виртуальной машины существуют ограничения пропускной способности. Максимальное число операций ввода-вывода в секунду на виртуальную машину и на диск различаются и не зависит друг от друга.

Приложения, которые потребляют ресурсы за пределами этих ограничений, будут регулироваться (также называются ограниченными). Выберите виртуальную машину и размер диска в дисковой полосе, соответствующей требованиям приложения, и не накладывает ограничений на ограничения. Для устранения ограниченного использования используйте кэширование или настройте приложение, чтобы уменьшить пропускную способность.

Например, приложение, требующее 12 000 операций ввода-вывода и 180 МБ/с, может: 
- Используйте [Standard_M32ms](../../../virtual-machines/m-series.md) с максимальной пропускной способностью некэшированного диска в 20 000 операций ввода-вывода в секунду и 500 Мбит/с.
- Чередование трех P30 дисков для доставки 15 000 операций ввода-вывода в секунду и 600 МБ/с.
- Используйте [Standard_M16msную](../../../virtual-machines/m-series.md) виртуальную машину и используйте кэширование узла, чтобы использовать локальный кэш для использования пропускной способности. 

Виртуальные машины, настроенные для увеличения масштаба во время высокой загрузки, должны подготавливать хранилище с достаточным количеством операций ввода-вывода в секунду и пропускной способностью для поддержки максимального размера виртуальной машины, сохраняя при этом общее число дисков, которое не превышает максимального значения, поддерживаемого минимальным номером SKU виртуальной машины, предназначенного для использования.

Дополнительные сведения об ограничениях на ограниченный диск и использовании кэширования для предотвращения неограниченного использования см. в разделе ограничение [дискового ввода-вывода](../../../virtual-machines/disks-performance.md).

> [!NOTE] 
> Некоторые ограничения на ограниченное дисковое состояние могут привести к удовлетворительной производительности пользователей; Настройте и настройте рабочие нагрузки, а не увеличьте размер виртуальной машины, чтобы сбалансировать управление затратами и производительностью бизнеса. 


## <a name="write-acceleration"></a>Ускорение записи

Ускорение записи — это функция диска, доступная только для виртуальных машин [серии M](https://docs.microsoft.com/azure/virtual-machines/m-series) . Целью ускорения записи является повышение задержки операций ввода-вывода при записи в хранилище Azure класса Premium, если требуется задержка ввода-вывода в течение одного числа из-за большого объема критически важных рабочих нагрузок OLTP или сред хранилища данных. 

Используйте ускорение записи, чтобы улучшить задержку записи на диск, на котором размещаются файлы журналов. Не используйте ускорение записи для файлов данных SQL Server. 

Ускоритель записи диски используют те же ограничения операций ввода-вывода, что и виртуальная машина. Число подключенных дисков не может превышать Ускоритель записи количество операций ввода-вывода в секунду для виртуальной машины.  

В следующей таблице перечислены числа дисков данных и операций ввода-вывода, поддерживаемых на каждой виртуальной машине. 

| SKU виртуальной машины  | Число дисков Ускоритель записи  | Ускоритель записи дисковых операций ввода-вывода на виртуальную машину  |
|---|---|---|
| M416ms_v2, M416s_v2  | 16  | 20 000  |
| M128ms, M128s  | 16  | 20 000  |
| M208ms_v2, M208s_v2  | 8  | 10000  |
| M64ms, M64ls, M64s  |  8 | 10000 |
| M32ms, M32ls, M32ts, M32s  | 4  | 5000  |
| M16ms, M16s  | 2 | 2500 |
| M8ms, M8s  | 1 | 1250 |

Существует ряд ограничений на использование ускорения записи. Дополнительные сведения см. в разделе [ограничения при использовании ускоритель записи](../../../virtual-machines/how-to-enable-write-accelerator.md#restrictions-when-using-write-accelerator).


### <a name="comparing-to-azure-ultra-disk"></a>Сравнение с Ultra Disk в Azure

Наибольшее различие между ускорением записи и Ultra Disks в Azure заключается в том, что ускорение записи — это функция виртуальной машины, доступная только для дисков серии M и Azure Ultra. Ускорение записи — это оптимизированный для записи кэш с собственными ограничениями в зависимости от размера виртуальной машины. Диски Azure "Ultra" — это дисковый накопитель с малой задержкой для виртуальных машин Azure. 

По возможности используйте ускорение записи для дисков журнала транзакций на Ultra Disks. Для виртуальных машин, которые не поддерживают ускорение записи, но нуждаются в низкой задержке в журнале транзакций, используйте диски Azure Ultra. 

## <a name="monitor-storage-performance"></a>Мониторинг производительности хранилища

Для оценки потребностей в хранении и определения того, насколько хорошо работает хранилище, необходимо понять, что именно следует измерять, и что означают эти индикаторы. 

[Операций ввода-вывода в секунду](../../../virtual-machines/premium-storage-performance.md#iops) : количество запросов, которые приложение делает в хранилище, в секунду. Измерьте количество операций ввода-вывода с помощью счетчиков системного монитора `Disk Reads/sec` и `Disk Writes/sec` . Для достижения оптимальной производительности приложения [OLTP (оперативная обработка транзакций)](/azure/architecture/data-guide/relational-data/online-transaction-processing) должны иметь более высокие числа операций ввода-вывода. Примерами приложений OLTP являются такие приложения, как системы обработки платежей, Интернет-покупки и розничные торговые терминалы.

[Пропускная способность](../../../virtual-machines/premium-storage-performance.md#throughput) — это объем данных, отправляемых в базовое хранилище, который часто измеряется в мегабайтах в секунду. Измерьте пропускную способность с помощью счетчиков системного монитора `Disk Read Bytes/sec` и `Disk Write Bytes/sec` . [Хранение данных](/azure/architecture/data-guide/relational-data/data-warehousing) оптимизировано для максимизации пропускной способности операций ввода-вывода в секунду. Примерами приложений для хранения данных являются такие приложения, как хранилища данных для анализа, отчеты, рабочие потоки ETL и другие цели бизнес-аналитики.

Размеры единиц операций ввода-вывода влияют на операции чтения и пропускной способности, так как меньшие размеры операций ввода-вывода приводят к увеличению числа операций чтения, а большие размеры операций ввода-вывода SQL Server автоматически выбирает оптимальный размер ввода-вывода. Дополнительные сведения о см. в разделе [Оптимизация операций ввода-вывода, пропускной способности и задержки для приложений](../../../virtual-machines/premium-storage-performance.md#optimize-iops-throughput-and-latency-at-a-glance). 

Для обнаружения ограниченности на уровне виртуальной машины и диска, а также потребления и работоспособности кэша AzureBlob существуют определенные метрики Azure Monitor. Сведения о том, как определить ключевые счетчики для добавления в решение мониторинга и портал Azure панели мониторинга, см. в разделе [метрики использования хранилища](../../../virtual-machines/disks-metrics.md#storage-io-utilization-metrics). 

> [!NOTE]
> Azure Monitor в настоящее время не предлагает метрик на уровне диска для временного Временного диска `(D:\)` . Процент использования кэшированных операций ввода-вывода в секунду и кэшированная пропускная способность виртуальной машины в процентах будут отражать операции ввода-вывода и пропускную способность одновременно для временного Временного диска `(D:\)` и кэширования узла


## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения о рекомендациях по повышению производительности см. в других статьях этой серии:
- [Краткий контрольный список](performance-guidelines-best-practices-checklist.md)
- [Размер виртуальной машины](performance-guidelines-best-practices-vm-size.md)
- [Получение базовых показателей](performance-guidelines-best-practices-collect-baseline.md)

Рекомендации по обеспечению безопасности см. [в статье вопросы безопасности SQL Server на виртуальных машинах Azure](security-considerations-best-practices.md).

Чтобы узнать, как провести полное тестирование производительности SQL Server на виртуальных машинах Azure с помощью тестов TPC-E и TPC_C, см. [эту запись блога](https://techcommunity.microsoft.com/t5/sql-server/optimize-oltp-performance-with-sql-server-on-azure-vm/ba-p/916794).

Ознакомьтесь с другими статьями, посвященными виртуальным машинам SQL Server, используя руководство с [обзором SQL Server на виртуальных машинах с Windows](sql-server-on-azure-vm-iaas-what-is-overview.md). Если у вас есть вопросы по виртуальным машинам SQL Server, см. раздел [часто задаваемых вопросов](frequently-asked-questions-faq.md).
