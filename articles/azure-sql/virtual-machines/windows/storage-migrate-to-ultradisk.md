---
title: Перенос диска журнала на диск Ultra
description: Узнайте, как перенести SQL Server на диск журнала виртуальной машины Azure в Azure Ултрадиск, чтобы воспользоваться преимуществами высокой производительности и низкой задержки.
services: virtual-machines-windows
documentationcenter: na
author: MashaMSFT
editor: ''
tags: azure-service-management
ms.assetid: ''
ms.service: virtual-machines-sql
ms.subservice: management
ms.topic: how-to
ms.tgt_pltfrm: vm-windows-sql-server
ms.workload: iaas-sql-server
ms.date: 07/09/2020
ms.author: mathoma
ms.reviewer: jroth
ms.openlocfilehash: e8410b4e0997798eba5ee91f361c3a5f1ce47ef1
ms.sourcegitcommit: 772eb9c6684dd4864e0ba507945a83e48b8c16f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "104586307"
---
# <a name="migrate-log-disk-to-ultra-disk"></a>Перенос диска журнала на диск Ultra
[!INCLUDE[appliesto-sqlvm](../../includes/appliesto-sqlvm.md)]

Высокопроизводительные диски Azure обеспечивают высокую пропускную способность, высокую скорость операций ввода-вывода в секунду и согласованную с низкой задержкой дисковый накопитель для SQL Server на виртуальной машине Azure. 

В этой статье описывается, как перенести диск журнала в Ultra SSD, чтобы воспользоваться преимуществами производительности, предоставляемыми Ultra Disks. 

## <a name="back-up-database"></a>Резервное копирование базы данных

Создайте [полную резервную копию](backup-restore.md) базы данных. 

## <a name="attach-disk"></a>Подключение диска

Подключите SSD (цен. категория "Ультра") к виртуальной машине после включения совместимости ултрадиск на виртуальной машине. 

Поддержка Ultra Disk поддерживается для подмножества размеров и регионов виртуальных машин. Прежде чем продолжать, проверьте, что виртуальная машина находится в регионе, зоне и размере, поддерживающем Ultra Disk. Вы можете [определить и проверить размер и регион виртуальной машины](../../../virtual-machines/disks-enable-ultra-ssd.md#determine-vm-size-and-region-availability) с помощью Azure CLI или PowerShell. 

### <a name="enable-compatibility"></a>Включить совместимость

Чтобы включить совместимость, выполните следующие действия.

1. Перейдите на виртуальную машину в [портал Azure](https://portal.azure.com/). 
1. Останавливает или освобождает виртуальную машину. 
1. Выберите **диски** в разделе **Параметры** , а затем щелкните **Дополнительные параметры**. 

   :::image type="content" source="media/storage-migrate-to-ultradisk/additional-disks-settings-azure-portal.png" alt-text="Выберите дополнительные параметры для дисков в разделе Параметры в портал Azure":::

1. Выберите **Да** , чтобы **включить совместимость с Ultra Disk**. 

   :::image type="content" source="../../../virtual-machines/media/virtual-machines-disks-getting-started-ultra-ssd/enable-ultra-disks-existing-vm.png" alt-text="Снимок экрана, на котором показан параметр &quot;Да&quot;.":::

1. Щелкните **Сохранить**. 



### <a name="attach-disk"></a>Подключение диска

Используйте портал Azure, чтобы подключить к виртуальной машине Ultra Disk. Дополнительные сведения см. [в статье подключение к Ultra Disk](../../../virtual-machines/disks-enable-ultra-ssd.md#attach-an-ultra-disk).

После подключения диска запустите виртуальную машину еще раз, используя портал Azure. 



## <a name="format-disk"></a>Форматировать диск

Подключитесь к виртуальной машине и отформатируйте свой диск Ultra.  

Чтобы отформатировать Ultra Disk, выполните следующие действия.

1. Подключитесь к виртуальной машине с помощью протокол удаленного рабочего стола (RDP).
1. Используйте [Управление дисками](/windows-server/storage/disk-management/overview-of-disk-management) , чтобы отформатировать и создать разделы для вновь подключенного диска Ultra. 


## <a name="use-disk-for-log"></a>Использовать диск для журнала

Настройте SQL Server для использования нового диска журнала. Это можно сделать с помощью Transact-SQL (T-SQL) или SQL Server Management Studio (SSMS). Учетная запись, используемая для учетной записи службы SQL Server, должна иметь полный контроль над новым расположением файла журнала. 

### <a name="configure-permissions"></a>Настройка разрешений

1. Проверьте учетную запись службы, используемую SQL Server. Это можно сделать с помощью диспетчер конфигурации SQL Server или Services. msc.
1. Перейдите к новому диску. 
1. Создайте папку (или несколько папок), которая будет использоваться для файла журнала. 
1. Щелкните правой кнопкой мыши папку и выберите команду **Свойства**.
1. На вкладке **Безопасность** предоставьте полный доступ к учетной записи службы SQL Server. 
1. Нажмите кнопку **ОК**  , чтобы сохранить параметры. 
1. Повторите эти действия для каждой папки корневого уровня, в которой планируется использовать данные SQL. 

### <a name="use-new-log-drive"></a>Использовать новый диск журнала 

После предоставления разрешений Используйте Transact-SQL (T-SQL) или SQL Server Management Studio (SSMS), чтобы отсоединить базу данных и переместить существующие файлы журналов в новое расположение.

   > [!CAUTION]
   > Отсоединение базы данных переводит ее в режим «вне сети», закрывает соединения и откатывает все транзакции, которые находятся в полете. Пройдите осторожность и во время периода обслуживания. 



# <a name="transact-sql-t-sql"></a>[Transact-SQL (T-SQL)](#tab/tsql)

Используйте T-SQL для перемещения существующих файлов в новое расположение:

1. Подключитесь к базе данных в SQL Server Management Studio и откройте **новое окно запроса** . 
1. Получить существующие файлы и расположения:

   ```sql
   USE AdventureWorks
   GO

   sp_helpfile
   GO
   ```

1. Отсоединить базу данных: 

   ```sql
   USE master
   GO

   sp_detach_db 'AdventureWorks'
   GO
   ```

1. С помощью проводника переместите файл журнала в новое место на диске Ultra. 

1. Присоедините базу данных, указав новые расположения файлов: 

   ```sql
    sp_attach_db 'AdventureWorks'
   'E:\Fixed_FG\AdventureWorks.mdf',
   'E:\Fixed_FG\AdventureWorks_2.ndf',
   'F:\New_Log\AdventureWorks_log.ldf'
   GO
   ```

На этом этапе база данных переходит в оперативный режим с журналом в новом расположении. 



# <a name="sql-server-management-studio-ssms"></a>[SQL Server Management Studio (SSMS)](#tab/ssms)

Используйте SSMS для перемещения существующих файлов в новое расположение:

1. Подключитесь к базе данных в SQL Server Management Studio (SSMS). 
1. Щелкните правой кнопкой мыши базу данных, выберите пункт **Свойства** , а затем выберите пункт **файлы**. 
1. Запишите путь к существующим файлам. 
1. Чтобы закрыть диалоговое окно, нажмите кнопку **ОК**. 
1. Щелкните правой кнопкой мыши базу данных, выберите **задачи**  >  **отсоединить**. 
1. Следуйте указаниям мастера, чтобы отключить базу данных. 
1. Используйте проводник, чтобы вручную переместить файл журнала в новое расположение.
1. Присоединение базы данных в SQL Server Management Studio
   1. Щелкните правой кнопкой мыши **базы данных** в **обозревателе объектов** и выберите **присоединить базу данных**. 
   1. С помощью диалогового окна Добавьте каждый файл, включая файл журнала, в новом расположении. 
   1. Нажмите кнопку **ОК** , чтобы присоединить базу данных. 

На этом этапе база данных переходит в оперативный режим с журналом в новом расположении.

---


## <a name="next-steps"></a>Дальнейшие действия

Ознакомьтесь с [рекомендациями](performance-guidelines-best-practices.md) по повышению производительности для получения дополнительных параметров, чтобы повысить производительность. 

Общие сведения о SQL Server на виртуальных машинах Azure см. в следующих статьях:

- [Обзор SQL Server на виртуальных машинах Windows](sql-server-on-azure-vm-iaas-what-is-overview.md)
- [Обзор SQL Server на виртуальных машинах Linux](../linux/sql-server-on-linux-vm-what-is-iaas-overview.md)
