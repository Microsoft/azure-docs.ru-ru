---
title: Высокий уровень доступности, аварийное восстановление, непрерывность бизнес-процессов
description: Узнайте о параметрах обеспечения высокой доступности, аварийного восстановления (HADR) и непрерывности бизнес-процессов, доступных для SQL Server на виртуальных машинах Azure, таких как группы доступности Always On, экземпляр отказоустойчивого кластера, зеркальное отображение базы данных, Доставка журналов и резервное копирование & восстановления в службу хранилища Azure.
services: virtual-machines-windows
documentationcenter: na
author: MashaMSFT
editor: ''
tags: azure-service-management
ms.assetid: 53981f7e-8370-4979-b26a-93a5988d905f
ms.service: virtual-machines-sql
ms.subservice: hadr
ms.topic: conceptual
ms.tgt_pltfrm: vm-windows-sql-server
ms.workload: iaas-sql-server
ms.date: 06/27/2020
ms.author: mathoma
ms.openlocfilehash: f4d870f458607ceb0f05812b5c0c066ce810448e
ms.sourcegitcommit: e6de1702d3958a3bea275645eb46e4f2e0f011af
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/20/2021
ms.locfileid: "102508323"
---
# <a name="business-continuity-and-hadr-for-sql-server-on-azure-virtual-machines"></a>Непрерывность бизнес-процессов и HADR для SQL Server на виртуальных машинах Azure
[!INCLUDE[appliesto-sqlvm](../../includes/appliesto-sqlvm.md)]

Непрерывность бизнес-процессов означает продолжение бизнеса в случае аварии, планирование восстановления и обеспечение высокой доступности данных. SQL Server на виртуальных машинах Azure может снизить стоимость решения для баз данных с высоким уровнем доступности и аварийного восстановления (HADR). 

Большинство SQL Server решений HADR поддерживаются на виртуальных машинах, как и гибридные решения только для Azure. Если решение предназначено только для использования в службе Azure, в ней выполняется вся система HADR. В гибридной конфигурации часть решения выполняется в Azure, а другая часть — в локальной сети организации. Гибкость среды Azure позволяет полностью или частично перемещать ресурсы в Azure в соответствии с бюджетом и требованиями систем баз данных SQL Server к HADR.

В этой статье сравниваются решения обеспечения непрерывности бизнес-процессов, доступные для SQL Server на виртуальных машинах Azure. 

## <a name="overview"></a>Обзор

Вы должны убедиться, что система базы данных имеет возможности HADR, необходимые для соглашения об уровне обслуживания (SLA). Тот факт, что Azure предоставляет механизмы высокого уровня доступности, такие как восстановление службы для облачных служб и обнаружение сбоев при восстановлении виртуальных машин, не гарантирует, что вы сможете удовлетворить соглашение об уровне обслуживания. Хотя эти механизмы помогают защитить высокую доступность виртуальной машины, они не защищают доступность SQL Server, выполняющихся внутри виртуальной машины. 

Возможен сбой экземпляра SQL Server, пока виртуальная машина находится в режиме «в сети» и находится в работоспособном состоянии. Даже механизмы высокого уровня доступности, предоставляемые Azure, позволяют просто выполнять виртуальные машины из-за таких событий, как восстановление после сбоев программного обеспечения или оборудования и обновление операционной системы.

Геоизбыточное хранилище (GRS) в Azure реализуется с помощью функции георепликации. GRS может не быть достаточным решением для аварийного восстановления баз данных. Поскольку Георепликация отправляет данные асинхронно, последние обновления могут быть потеряны в случае аварии. Дополнительные сведения об ограничениях георепликации см. в разделе [Поддержка георепликации](#geo-replication-support) .

## <a name="deployment-architectures"></a>Архитектуры развертывания
Azure поддерживает следующие SQL Server технологии обеспечения непрерывности бизнес-процессов:

* [группы доступности Always On](/sql/database-engine/availability-groups/windows/always-on-availability-groups-sql-server)
* [Экземпляры отказоустойчивого кластера Always On (FCI)](/sql/sql-server/failover-clusters/windows/always-on-failover-cluster-instances-sql-server)
* [Доставка журналов](/sql/database-engine/log-shipping/about-log-shipping-sql-server)
* [SQL Server резервного копирования и восстановления с помощью хранилища BLOB-объектов Azure](/sql/relational-databases/backup-restore/sql-server-backup-and-restore-with-microsoft-azure-blob-storage-service)
* [Зеркальное отображение базы данных](/sql/database-engine/database-mirroring/database-mirroring-sql-server) — не рекомендуется в SQL Server 2016

Можно сочетать технологии для реализации SQL Serverного решения, которое обладает возможностями высокой доступности и аварийного восстановления. В зависимости от используемой технологии для гибридного развертывания может потребоваться VPN-туннель с виртуальной сетью Azure. В следующих разделах показаны некоторые примеры архитектуры развертывания.

## <a name="azure-only-high-availability-solutions"></a>Только для Azure: решения с высоким уровнем доступности

Вы можете использовать решение высокого уровня доступности для SQL Server на уровне базы данных с группы доступности Always On. Можно также создать решение высокого уровня доступности на уровне экземпляра с Always On экземплярами отказоустойчивого кластера. Для дополнительной защиты можно создать избыточность на обоих уровнях, создав группы доступности в экземплярах отказоустойчивого кластера. 

| Технология | Примеры архитектур |
| --- | --- |
| **Группы доступности** |Реплики доступности, выполняемые на виртуальных машинах Azure в одном регионе, обеспечивают высокий уровень доступности. Необходимо настроить виртуальную машину контроллера домена, так как для отказоустойчивой кластеризации Windows требуется домен Active Directory.<br/><br/> Для повышения избыточности и доступности виртуальные машины Azure можно развернуть в разных [зонах доступности](../../../availability-zones/az-overview.md) , как описано в разделе [Общие сведения о группе доступности](availability-group-overview.md). Если SQL Server виртуальные машины в группе доступности развернуты в зонах доступности, используйте [Load Balancer (цен. Категория "Стандартный") Azure](../../../load-balancer/load-balancer-overview.md) для прослушивателя, как описано в статьях, посвященных [шаблонам](availability-group-quickstart-template-configure.md) [интерфейса командной строки Azure SQL](./availability-group-az-commandline-configure.md) и Azure.<br/> ![Схема, показывающая "контроллер домена" над "кластером WSFC", созданной для "первичной реплики", "вторичная реплика" и "файловый ресурс-свидетель".](./media/business-continuity-high-availability-disaster-recovery-hadr-overview/azure-only-ha-always-on.png)<br/>Дополнительные сведения см. в статье [Автоматическая настройка групп доступности AlwaysOn на виртуальных машинах Azure с использованием Resource Manager](./availability-group-quickstart-template-configure.md). |
| **Экземпляры отказоустойчивого кластера** |Экземпляры отказоустойчивого кластера поддерживаются на SQL Server виртуальных машинах. Так как компонент FCI требует общего хранилища, пять решений будут работать с SQL Server на виртуальных машинах Azure: <br/><br/> — Использование [общих дисков Azure](failover-cluster-instance-azure-shared-disks-manually-configure.md) для Windows Server 2019. Общие управляемые диски — это продукт Azure, который разрешает одновременное подключение управляемого диска к нескольким виртуальным машинам. Виртуальные машины в кластере могут выполнять чтение или запись на подключенный диск в соответствии с резервированием, выбранным кластеризованным приложением, с помощью постоянных резервирований SCSI (по протоколу SCSI). SCSI PR — это стандартное решение для хранения данных, которое используется приложениями, работающими в локальной сети хранения данных (SAN). Включение параметра SCSI PR на управляемом диске позволяет перенести эти приложения в Azure как есть. <br/><br/>— Использование [Локальные дисковые пространства \( S2D \) ](failover-cluster-instance-storage-spaces-direct-manually-configure.md) для предоставления программной виртуальной сети SAN для Windows Server 2016 и более поздних версий.<br/><br/>— Использование [общего файлового ресурса](failover-cluster-instance-premium-file-share-manually-configure.md) уровня "Премиум" для Windows Server 2012 и более поздних версий. Файловые ресурсы уровня "Премиум" — это резервная копия на основе SSD, постоянно низкая задержка и полностью поддерживается для использования с FCI.<br/><br/>— Использование хранилища, поддерживаемого партнерским решением для кластеризации. Конкретный пример, в котором используется SIOS, см. в записи блога [отказоустойчивая кластеризация и SIOS](https://azure.microsoft.com/blog/high-availability-for-a-file-share-using-wsfc-ilb-and-3rd-party-software-sios-datakeeper/).<br/><br/>— Использование общего блочного хранилища для удаленного целевого объекта iSCSI через Azure ExpressRoute. Например, решение NetApp Private Storage (NPS) предоставляет цели iSCSI через ExpressRoute с Equinix для виртуальных машин Azure.<br/><br/>По любым вопросам, связанным с доступом к данным при отработке отказа и касающимся решений репликации данных и общих хранилищ от партнеров корпорации Майкрософт, обращайтесь к поставщикам решений.<br/><br/>||

## <a name="azure-only-disaster-recovery-solutions"></a>Только для Azure: решения аварийного восстановления
Вы можете создать решение аварийного восстановления для баз данных SQL Server в Azure с помощью групп доступности, зеркального отображения базы данных или резервного копирования и восстановления с большими двоичными объектами хранилища.

| Технология | Примеры архитектур |
| --- | --- |
| **Группы доступности** |Реплики доступности, выполняемые в нескольких центрах обработки данных на виртуальных машинах Azure для аварийного восстановления. Это решение для разных регионов помогает защититься от полного сбоя сайта. <br/> ![Схема, на которой показаны две области с "первичной репликой" и "вторичной репликой", соединенной "асинхронной фиксацией".](./media/business-continuity-high-availability-disaster-recovery-hadr-overview/azure-only-dr-alwayson.png)<br/>В пределах региона все реплики должны находиться в одной и той же облачной службе и одной виртуальной сети. Так как каждый регион будет иметь отдельную виртуальную сеть, для этих решений требуется подключение типа "сеть — сеть". Дополнительные сведения см. [в статье Настройка подключения типа "сеть — сеть" с помощью портал Azure](../../../vpn-gateway/vpn-gateway-howto-vnet-vnet-resource-manager-portal.md). Подробные инструкции см. [в статье Настройка группы доступности SQL Server Always On в разных регионах Azure](availability-group-manually-configure-multiple-regions.md).|
| **Зеркальное отображение базы данных** |Основной, зеркальный и другие серверы, выполняемые в разных центрах обработки данных для аварийного восстановления. Их необходимо развернуть с помощью сертификатов сервера. SQL Server зеркальное отображение базы данных не поддерживается для SQL Server 2008 или SQL Server 2008 R2 на виртуальной машине Azure. <br/>![Схема, которая показывает "участник" в одном регионе, подключенном к "зеркальному" в другом регионе с "высокой производительностью".](./media/business-continuity-high-availability-disaster-recovery-hadr-overview/azure-only-dr-dbmirroring.png) |
| **Резервное копирование и восстановление с помощью хранилища BLOB-объектов Azure** |Рабочие базы данных, резервное копирование которых осуществляется непосредственно в хранилище BLOB-объектов в другом центре обработки, для аварийного восстановления.<br/>![Схема, на которой в одном регионе показана база данных с резервным копированием в хранилище BLOB-объектов в другом регионе.](./media/business-continuity-high-availability-disaster-recovery-hadr-overview/azure-only-dr-backup-restore.png)<br/>Дополнительные сведения см. [в статье резервное копирование и восстановление для SQL Server на виртуальных машинах Azure](../../../azure-sql/virtual-machines/windows/backup-restore.md). |
| **Репликация и отработка отказа SQL Server в Azure с помощью Azure Site Recovery** |Экземпляр рабочего SQL Server в одном центре обработки данных Azure, который реплицируется непосредственно в службу хранилища Azure в другом центре обработки данных Azure для аварийного восстановления.<br/>![Схема, на которой в одном центре обработки данных Azure показана "Database" с использованием функции "Репликация ASR" для аварийного восстановления в другом центре обработки данных. ](./media/business-continuity-high-availability-disaster-recovery-hadr-overview/azure-only-dr-standalone-sqlserver-asr.png)<br/>Дополнительные сведения см. в разделе [Защита SQL Server с помощью аварийного восстановления SQL Server и Azure Site Recovery](../../../site-recovery/site-recovery-sql.md). |


## <a name="hybrid-it-disaster-recovery-solutions"></a>Гибридная ИТ-среда. Решения аварийного восстановления
Вы можете использовать решение аварийного восстановления для баз данных SQL Server в гибридной ИТ-среде, используя группы доступности, зеркальное отображение базы данных, доставку журналов, а также резервное копирование и восстановление с помощью хранилища больших двоичных объектов Azure.

| Технология | Примеры архитектур |
| --- | --- |
| **Группы доступности** |Некоторые реплики доступности, выполняемые на виртуальных машинах Azure, и другие реплики, которые выполняются локально для аварийного восстановления на нескольких сайтах. Рабочий сайт может размещаться локально или в центре обработки данных Azure.<br/>![Группы доступности](./media/business-continuity-high-availability-disaster-recovery-hadr-overview/hybrid-dr-alwayson.png)<br/>Так как все реплики доступности должны находиться в одном отказоустойчивом кластере, он должен охватывать обе сети (отказоустойчивый кластер с несколькими подсетями). Для этой конфигурации требуется установить VPN-подключение между сетью Azure и локальной сетью.<br/><br/>Для успешного аварийного восстановления баз данных также следует установить реплику контроллера домена на сайте аварийного восстановления.|
| **Зеркальное отображение базы данных** |Один участник, работающий на виртуальной машине Azure и другой, выполняющийся локально, для аварийного восстановления между сайтами с помощью сертификатов сервера. Партнеры не должны находиться в одном домене Active Directory, и VPN-подключение не требуется.<br/>![Зеркальное отображение базы данных](./media/business-continuity-high-availability-disaster-recovery-hadr-overview/hybrid-dr-dbmirroring.png)<br/>В другом сценарии зеркального отображения базы данных один участник выполняется на виртуальной машине Azure, а другой — локально в том же домене Active Directory для межсайтового аварийного восстановления. Требуется [VPN-подключение между виртуальной сетью Azure и локальной сетью](../../../vpn-gateway/tutorial-site-to-site-portal.md).<br/><br/>Для успешного аварийного восстановления баз данных также следует установить реплику контроллера домена на сайте аварийного восстановления. SQL Server зеркальное отображение базы данных не поддерживается для SQL Server 2008 или SQL Server 2008 R2 на виртуальной машине Azure. |
| **Доставка журналов** |Один сервер запущен на виртуальной машине Azure, а другой — в локальной сети для межсайтового аварийного восстановления. Доставка журналов зависит от общего доступа к файлам Windows, поэтому требуется VPN-подключение между виртуальной сетью Azure и локальной сетью.<br/>![доставка журналов;](./media/business-continuity-high-availability-disaster-recovery-hadr-overview/hybrid-dr-log-shipping.png)<br/>Для успешного аварийного восстановления баз данных также следует установить реплику контроллера домена на сайте аварийного восстановления. |
| **Резервное копирование и восстановление с помощью хранилища BLOB-объектов Azure** |Локальные рабочие базы данных архивируются непосредственно в хранилище BLOB-объектов Azure для аварийного восстановления.<br/>![Резервное копирование и восстановление](./media/business-continuity-high-availability-disaster-recovery-hadr-overview/hybrid-dr-backup-restore.png)<br/>Дополнительные сведения см. [в статье резервное копирование и восстановление для SQL Server на виртуальных машинах Azure](../../../azure-sql/virtual-machines/windows/backup-restore.md). |
| **Репликация и отработка отказа SQL Server в Azure с помощью Azure Site Recovery** |Локальный экземпляр рабочего SQL Server реплицируется непосредственно в службу хранилища Azure для аварийного восстановления.<br/>![Репликация с помощью Azure Site Recovery](./media/business-continuity-high-availability-disaster-recovery-hadr-overview/hybrid-dr-standalone-sqlserver-asr.png)<br/>Дополнительные сведения см. в разделе [Защита SQL Server с помощью аварийного восстановления SQL Server и Azure Site Recovery](../../../site-recovery/site-recovery-sql.md). |


## <a name="free-dr-replica-in-azure"></a>Бесплатная реплика аварийного восстановления в Azure

При наличии [программы Software Assurance](https://www.microsoft.com/licensing/licensing-programs/software-assurance-default?rtc=1&activetab=software-assurance-default-pivot:primaryr3)можно реализовать планы гибридного аварийного восстановления (Dr) с SQL Server без дополнительных затрат на лицензирование для пассивного экземпляра аварийного восстановления.

Например, можно использовать два бесплатных пассивных получателя, когда все три реплики размещаются в Azure: 

![Два бесплатных пассивных устройства, когда все в Azure](./media/business-continuity-high-availability-disaster-recovery-hadr-overview/failover-with-primary-in-azure.png)

Кроме того, можно настроить среду гибридной отработки отказа с лицензированным первичным локальным ресурсом, одним бесплатным пассивным для высокого уровня доступности и одним бесплатным пассивным для АВАРИЙного восстановления в Azure:

![Три бесплатных пассивных развертывания, если среда гибридна с одной первичной локальной репликой](./media/business-continuity-high-availability-disaster-recovery-hadr-overview/hybrid-with-primary-on-prem.png)

Дополнительные сведения см. в [условиях лицензирования продуктов](https://www.microsoft.com/licensing/product-licensing/products). 

Чтобы включить это преимущество, перейдите к [ресурсу SQL Server виртуальной машины](manage-sql-vm-portal.md#access-the-sql-virtual-machines-resource). Выберите **Настройка** в разделе **Параметры**, а затем выберите вариант **аварийного восстановления** в разделе **Лицензия SQL Server**. Установите флажок, чтобы убедиться, что эта SQL Server виртуальная машина будет использоваться в качестве пассивной реплики, а затем нажмите кнопку **Применить** , чтобы сохранить параметры. 

![Настройка реплики аварийного восстановления в Azure](./media/business-continuity-high-availability-disaster-recovery-hadr-overview/dr-replica-in-portal.png)


## <a name="important-considerations-for-sql-server-hadr-in-azure"></a>Важные соображения в отношении HADR для SQL Server в Azure
Виртуальные машины, хранилища и сети Azure имеют рабочие характеристики, отличные от характеристик локальной, невиртуализированной ИТ-инфраструктуры. Для успешной реализации решения SQL Server HADR в Azure необходимо понимать эти различия и спроектировать решение для их размещения.

### <a name="high-availability-nodes-in-an-availability-set"></a>Узлы с высоким уровнем доступности в группе доступности
Группы доступности в Azure позволяют размещать узлы с высоким уровнем доступности в отдельные домены сбоя и домены обновления. Платформа Azure назначает каждой виртуальной машине в группе доступности домен обновления и домен сбоя. Эта конфигурация в центре обработки данных гарантирует, что во время запланированного или незапланированного обслуживания по крайней мере одна виртуальная машина доступна и соответствует соглашению об уровне обслуживания Azure 99,95%. 

Чтобы настроить настройку высокого уровня доступности, разместите все участвующие SQL Server виртуальные машины в одной группе доступности, чтобы избежать потери приложений или данных во время события обслуживания. В одной группе доступности можно разместить только узлы из одной облачной службы. Дополнительные сведения см. в статье [Управление доступностью виртуальных машин](../../../virtual-machines/availability.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json).

### <a name="high-availability-nodes-in-an-availability-zone"></a>Узлы с высоким уровнем доступности в зоне доступности
Зоны доступности — уникальные физические расположения в пределах одного региона Azure. Каждая зона состоит из одного или нескольких центров обработки данных, оснащенных независимыми системами электроснабжения, охлаждения и сетевого взаимодействия. Физическое разделение зон доступности в пределах региона помогает защитить приложения и данные от сбоев центров обработки данных, гарантируя, что по крайней мере одна виртуальная машина доступна и соответствует соглашению об уровне обслуживания Azure 99,99%. 

Чтобы настроить высокий уровень доступности, разместите участие SQL Server виртуальных машин, распределенных по зонам доступности в регионе. Между зонами доступности будет взиматься дополнительная плата за передачу данных между сетями. Дополнительные сведения см. в статье [Регионы и зоны доступности в Azure](../../../availability-zones/az-overview.md). 


### <a name="failover-cluster-behavior-in-azure-networking"></a>Поведение отказоустойчивого кластера в сети Azure
Служба DHCP, не совместимая с RFC, в Azure может привести к сбою при создании определенных конфигураций отказоустойчивого кластера. Это происходит потому, что сетевому имени кластера назначается дублирующий IP-адрес, например тот же IP-адрес, что и один из узлов кластера. Это проблема при использовании групп доступности, которые зависят от компонента отказоустойчивого кластера Windows.

Рассмотрим сценарий, в котором вы создаете и подключаете к сети кластер с двумя узлами.

1. Кластер переходит в режим «в сети», а затем NODE1 запрашивает динамически назначенный IP-адрес для сетевого имени кластера.
2. Служба DHCP не предоставляет IP-адрес, отличный от NODE1's собственного IP-адреса, так как служба DHCP распознает, что запрос поступает от NODE1 самого себя.
3. Windows обнаружит, что дубликату адреса назначено значение NODE1 и сетевому имени отказоустойчивого кластера, и группа кластера по умолчанию не может подключиться к сети.
4. Группа кластера по умолчанию перемещается в NODE2. NODE2 считает IP-адрес NODE1's IP-адресом кластера и переводит группу кластера по умолчанию в режим «в сети».
5. Когда NODE2 пытается установить подключение к NODE1, пакеты, направленные на NODE1, никогда не оставляют NODE2, так как он разрешает NODE1's IP-адрес самому себе. NODE2 не может установить подключение к NODE1, а затем теряет кворум и завершает работу кластера.
6. NODE1 может отправлять пакеты в NODE2, но NODE2 не может ответить. Узел NODE1 теряет кворум и завершает работу кластера.

Этот сценарий можно избежать, назначив неиспользуемый статический IP-адрес сетевому имени кластера, чтобы подключить сетевое имя кластера к сети. Например, можно использовать локальный IP-адрес канала, например 169.254.1.1. Указания по упрощению этого процесса см. в статье [How to Configure Windows Failover Cluster in Azure for AlwaysOn Availability Groups](https://social.technet.microsoft.com/wiki/contents/articles/14776.configuring-windows-failover-cluster-in-windows-azure-for-alwayson-availability-groups.aspx) (Как настроить отказоустойчивый кластер Windows в Azure для групп доступности Always On).

Дополнительные сведения см. в статье [Автоматическая настройка групп доступности AlwaysOn на виртуальных машинах Azure с использованием Resource Manager](./availability-group-quickstart-template-configure.md).

### <a name="support-for-availability-group-listeners"></a>Поддержка прослушивателей групп доступности
Прослушиватели групп доступности поддерживаются на виртуальных машинах Azure под Windows Server 2012 и более поздних версий. Это поддержка возможна благодаря использованию конечных точек балансировки нагрузки на виртуальных машинах Azure, представляющих собой узлы группы доступности. Чтобы прослушиватели работали как для клиентских приложений, работающих в Azure, так и для локальных пользователей, необходимо выполнить специальные действия по настройке.

Существует два основных способа настройки: внешний (общедоступный) или внутренний прослушиватель. Внешний (общедоступный) прослушиватель использует балансировщик нагрузки, доступный в Интернете, и связан с общедоступным виртуальным IP-адресом, доступным через Интернет. Внутренний прослушиватель использует внутренний балансировщик нагрузки и поддерживает только клиенты в пределах одной виртуальной сети. Для обоих типов балансировщика нагрузки необходимо включить прямой ответ от сервера. 

Если группа доступности охватывает несколько подсетей Azure (например, развертывание, охватывающее регионы Azure), строка подключения клиента должна включать `MultisubnetFailover=True` . В результате будут выполняться попытки параллельного подключения к репликам в разных подсетях. Инструкции по настройке прослушивателя см. в статье [Настройка прослушивателя ilB для групп доступности в Azure](availability-group-listener-powershell-configure.md).


Вы по-прежнему можете подключаются к отдельным репликам доступности, напрямую подключаясь к экземпляру службы. Кроме того, поскольку группы доступности имеют обратную совместимость с клиентами зеркального отображения базы данных, можно подключиться к репликам доступности, таким как участники зеркального отображения базы данных, если реплики настроены аналогично зеркальному отображению базы данных.

* Есть одна первичная реплика и одна вторичная реплика.
* Вторичная реплика настроена как недоступная для чтения (**вторичный** параметр для чтения имеет значение **No**).

Ниже приведен пример строки подключения клиента, которая соответствует конфигурации, подобной этой для зеркального отображения базы данных, с помощью ADO.NET или SQL Server Native Client.

```console
Data Source=ReplicaServer1;Failover Partner=ReplicaServer2;Initial Catalog=AvailabilityDatabase;
```

Дополнительные сведения о подключении клиента см. в следующих статьях.

* [Использование ключевых слов строки подключения с собственным клиентом SQL Server](/sql/relational-databases/native-client/applications/using-connection-string-keywords-with-sql-server-native-client)
* [Подключение клиентов к сеансу зеркального отображения базы данных (SQL Server)](/sql/database-engine/database-mirroring/connect-clients-to-a-database-mirroring-session-sql-server)
* [Подключение к прослушивателю группы доступности в гибридной ИТ-среде](/archive/blogs/sqlalwayson/connecting-to-availability-group-listener-in-hybrid-it)
* [Прослушиватели групп доступности, возможность подключения клиентов и отработка отказа приложений (SQL Server)](/sql/database-engine/availability-groups/windows/listeners-client-connectivity-application-failover)
* [Использование строк подключения к зеркально отображаемой базе данных с группами доступности](/sql/database-engine/availability-groups/windows/listeners-client-connectivity-application-failover)

### <a name="network-latency-in-hybrid-it"></a>Задержки сети в гибридной ИТ-среде
Развертывание решения HADR с учетом предположения, что возможны периоды высокой задержки в сети между локальной сетью и Azure. При развертывании реплик в Azure используйте асинхронную фиксацию вместо синхронной фиксации для режима синхронизации. При развертывании серверов зеркального отображения баз данных как локально, так и в Azure используйте режим высокой производительности вместо режима высокой безопасности.

### <a name="geo-replication-support"></a>Поддержка георепликации
Георепликация на дисках Azure не поддерживает хранение файлов данных и журнала из одной базы данных на отдельных дисках. GRS реплицирует изменения на каждом диске независимо и асинхронно. Этот механизм обеспечивает единый порядок записи на одном диске в геореплицированной копии, но не в геореплицированных копиях нескольких дисков. Если база данных настроена для хранения файла данных и файла журнала на отдельных дисках, то восстановленные диски после аварии могут содержать более актуальную копию файла данных, чем файл журнала, что приведет к разрыву журнала записи SQL Server и свойств ACID (атомарность, согласованность, изоляция и устойчивость) транзакций. 

Если у вас нет возможности отключить георепликацию в учетной записи хранения, следует хранить все файлы данных и журналов базы данных на одном диске. Если необходимо использовать более одного диска из-за размера базы данных, разверните одно из перечисленных выше решений аварийного восстановления, чтобы обеспечить избыточность данных.

## <a name="next-steps"></a>Дальнейшие действия

Решите, является ли [Группа доступности](availability-group-overview.md) или [экземпляр отказоустойчивого кластера](failover-cluster-instance-overview.md) лучшим решением для обеспечения непрерывности бизнес-процессов. Затем ознакомьтесь с [рекомендациями](hadr-cluster-best-practices.md) по настройке среды для обеспечения высокого уровня доступности и аварийного восстановления.