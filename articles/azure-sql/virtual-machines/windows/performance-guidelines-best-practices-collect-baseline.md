---
title: 'Получение базового плана: рекомендации по производительности & рекомендации'
description: В этой статье приводятся шаги для получения базовых показателей производительности в соответствии с рекомендациями по оптимизации производительности SQL Server на виртуальной машине Azure.
services: virtual-machines-windows
documentationcenter: na
author: MashaMSFT
editor: ''
tags: azure-service-management
ms.assetid: a0c85092-2113-4982-b73a-4e80160bac36
ms.service: virtual-machines-sql
ms.devlang: na
ms.topic: conceptual
ms.tgt_pltfrm: vm-windows-sql-server
ms.workload: iaas-sql-server
ms.date: 03/25/2021
ms.author: mathoma
ms.reviewer: jroth
ms.openlocfilehash: b1909d5fd5e3c02f104c73acb515740cb6ff65f6
ms.sourcegitcommit: f0a3ee8ff77ee89f83b69bc30cb87caa80f1e724
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/26/2021
ms.locfileid: "105572451"
---
# <a name="collect-baseline-performance-best-practices-for-sql-server-on-azure-vm"></a>Получение базового плана: рекомендации по производительности для SQL Server на виртуальной машине Azure
[!INCLUDE[appliesto-sqlvm](../../includes/appliesto-sqlvm.md)]

В этой статье содержатся сведения о том, как получить базовые показатели производительности в виде набора рекомендаций и рекомендаций по оптимизации производительности SQL Server на виртуальных машинах Azure.

Как правило, существует компромисс между оптимизацией затрат и оптимизацией производительности. Эта серия рекомендаций по повышению производительности сосредоточена на получении *оптимальной* производительности для SQL Server на виртуальных машинах Azure. Если рабочая нагрузка не так велика, могут потребоваться не все рекомендуемые варианты оптимизации. При оценке этих рекомендаций учитывайте актуальные потребности в производительности, затраты и характер рабочих нагрузок.

## <a name="overview"></a>Обзор

Для использования такого подхода Соберите счетчики производительности с помощью PerfMon/LogMan и запишите SQL Server статистику ожидания, чтобы лучше понять общие проблемы и потенциальные узкие места исходной среды. 

Начните с сбора данных о ЦП, памяти, операциях [ввода-вывода](../../../virtual-machines/premium-storage-performance.md#iops), [пропускной способности](../../../virtual-machines/premium-storage-performance.md#throughput)и [задержке](../../../virtual-machines/premium-storage-performance.md#latency) исходной рабочей нагрузки в пиковое время после [контрольного списка производительности приложения](../../../virtual-machines/premium-storage-performance.md#application-performance-requirements-checklist). 

Сбор данных в часы пиковой загрузки, например рабочие нагрузки в течение обычного рабочего дня, а также другие процессы высокой нагрузки, такие как обработка на конце дня и рабочие нагрузки ETL на выходные. Рассмотрите возможность масштабирования ресурсов для нетипично интенсивных рабочих нагрузок, таких как обработка в конце квартала, а затем масштабирование выполняется после завершения рабочей нагрузки. 

Используйте анализ производительности, чтобы выбрать [Размер виртуальной машины](../../../virtual-machines/sizes-memory.md) , который может масштабироваться в требованиях к производительности рабочей нагрузки.


## <a name="storage"></a>Память

SQL Server производительность в значительной степени зависит от подсистемы ввода-вывода, и производительность хранилища измеряется в потоках операций и пропускной способности. Если ваша база данных не умещается в физическую память, SQL Server постоянно переносит страницы базы данных в буферный пул и из него. Файлы данных для SQL Server должны обрабатываться по-разному. Доступ к файлам журнала выполняется последовательно, за исключением случаев, когда требуется откатить транзакцию, где файлы данных, включая tempdb, обращаются к ним случайным образом. При наличии медленных подсистем ввода-вывода пользователи могут столкнуться с проблемами производительности, например с медленным временем отклика и задачами, которые не были завершены из-за истечения времени ожидания. 

Виртуальные машины Azure Marketplace имеют файлы журналов на физическом диске, отдельном от файлов данных по умолчанию. Количество и размер файлов данных tempdb соответствуют рекомендациям и предназначены для временного `D:\` диска. 

Следующие счетчики системного монитора позволяют проверить пропускную способность ввода-вывода, необходимую для SQL Server. 
* **\Логикалдиск\диск чтений/с** (операций чтения)
* **Операций записи \логикалдиск\диск/с** (запись в секунду) 
* **\Логикалдиск\диск Прочитано байт/с** (требования к пропускной способности для файлов данных, журналов и tempdb)
* **\Логикалдиск\диск записано байт/с** (требования к пропускной способности для файлов данных, журналов и tempdb)

Используя операции ввода-вывода и требования к пропускной способности на пиковых уровнях, оцените размеры виртуальных машин, которые соответствуют емкости измерений. 

Если для вашей рабочей нагрузки требуется 20 000 операций чтения и 10 000 операций ввода-вывода, можно выбрать E16s_v3 (с размером до 32 КБ и 25600 без кэшированных операций ввода-вывода) или M16_s (с 2 P30 дисков, чередующиеся с помощью дисковых пространств). 

Убедитесь, что вы понимаете требования к пропускной способности и операциям ввода-вывода для рабочей нагрузки, так как виртуальные машины имеют разные ограничения шкалы для операций ввода-вывода

## <a name="memory"></a>Память

Следите за внешней памятью, используемой операционной системой, а также памятью, используемой внутренне SQL Server. Определение нажима для любого из этих компонентов поможет установить размер виртуальных машин и определить возможности для настройки. 

Следующие счетчики системного монитора могут помочь проверить работоспособность памяти SQL Server виртуальной машины. 
* [\Память\Доступный объем в МБ](/azure/monitoring/infrastructure-health/vmhealth-windows/winserver-memory-availmbytes)
* [\SQLServer: память Манажер\таржет Server Memory (КБ)](/sql/relational-databases/performance-monitor/sql-server-buffer-manager-object)
* [\SQLServer: память Манажер\тотал Server Memory (КБ)](/sql/relational-databases/performance-monitor/sql-server-buffer-manager-object)
* [\SQLServer: операций записи Манажер\лази буфера/с](/sql/relational-databases/performance-monitor/sql-server-buffer-manager-object)
* [\SQLServer: ожидаемый срок жизни буфера buffer](/sql/relational-databases/performance-monitor/sql-server-buffer-manager-object)

## <a name="compute"></a>Вычисления

Управление расчетами в Azure осуществляется иначе, чем в локальной среде. Локальные серверы создаются в течение последних нескольких лет без обновления из-за затрат на управление и стоимости приобретения нового оборудования. Виртуализация позволяет устранить некоторые из этих проблем, но приложения оптимизируются, чтобы использовать наибольшее преимущество базового оборудования. Это означает, что любое значительное изменение потребления ресурсов требует перераспределения всей физической среды. 

Это не является сложной проблемой в Azure, которая позволяет легко достичь новой виртуальной машины на другом ряде оборудования и даже в другом регионе. 

В Azure вы хотите использовать как можно больше ресурсов виртуальных машин, поэтому виртуальные машины Azure должны быть настроены таким образом, чтобы среднее значение ЦП максимально велико, без влияния на рабочую нагрузку. 

Следующие счетчики системного монитора могут помочь проверить работоспособность вычислений SQL Server виртуальной машины.
* **\ Процессор Information (_Total) \% время процессора**
* **Процессорное время \Process (sqlservr) \%**

> [!NOTE] 
> В идеале рекомендуется использовать 80% вычислений с пиковыми нагрузками выше 90%, но не достижением 100% за любой длительный период времени. По сути, вам нужно только подготавливать необходимые приложения, а затем планировать масштабирование в соответствии с потребностями бизнеса. 


## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения см. в других статьях этой серии:
- [Краткий контрольный список](performance-guidelines-best-practices-checklist.md)
- [Размер виртуальной машины](performance-guidelines-best-practices-vm-size.md)
- [Память](performance-guidelines-best-practices-storage.md)


Рекомендации по обеспечению безопасности см. [в статье вопросы безопасности SQL Server на виртуальных машинах Azure](security-considerations-best-practices.md).

Ознакомьтесь с другими статьями, посвященными виртуальным машинам SQL Server, используя руководство с [обзором SQL Server на виртуальных машинах с Windows](sql-server-on-azure-vm-iaas-what-is-overview.md). Если у вас есть вопросы по виртуальным машинам SQL Server, см. раздел [часто задаваемых вопросов](frequently-asked-questions-faq.md).
