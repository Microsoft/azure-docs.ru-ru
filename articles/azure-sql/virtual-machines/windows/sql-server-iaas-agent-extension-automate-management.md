---
title: Что такое расширение агента SQL Server IaaS?
description: В этой статье описывается, как расширение агента IaaS для SQL Server помогает автоматизировать административные задачи администрирования SQL Server на виртуальных машинах Azure. К ним относятся такие функции, как автоматическая архивация, автоматическая установка исправлений, интеграция Azure Key Vault, Управление лицензированием, Настройка хранилища и централизованное управление всеми экземплярами виртуальных машин SQL Server.
services: virtual-machines-windows
documentationcenter: ''
author: MashaMSFT
editor: ''
tags: azure-resource-manager
ms.assetid: effe4e2f-35b5-490a-b5ef-b06746083da4
ms.service: virtual-machines-sql
ms.subservice: management
ms.devlang: na
ms.topic: conceptual
ms.tgt_pltfrm: vm-windows-sql-server
ms.workload: iaas-sql-server
ms.date: 11/07/2020
ms.author: mathoma
ms.reviewer: jroth
ms.custom: seo-lt-2019
ms.openlocfilehash: cab5ac5e6a8fd900a41ff3690763746033b6200e
ms.sourcegitcommit: f3ec73fb5f8de72fe483995bd4bbad9b74a9cc9f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/04/2021
ms.locfileid: "102034818"
---
# <a name="automate-management-with-the-sql-server-iaas-agent-extension"></a>Автоматизация управления с помощью расширения агента SQL Server IaaS
[!INCLUDE[appliesto-sqlvm](../../includes/appliesto-sqlvm.md)]


Расширение агента SQL Server IaaS (SqlIaasExtension) выполняется в SQL Server на виртуальных машинах Azure для автоматизации задач управления и администрирования. 

В этой статье приводятся общие сведения о расширении. Чтобы установить расширение IaaS SQL Server для SQL Server на виртуальных машинах Azure, изучите статьи для [автоматической установки](sql-agent-extension-automatic-registration-all-vms.md), [отдельных виртуальных машин](sql-agent-extension-manually-register-single-vm.md)или [виртуальных машин](sql-agent-extension-manually-register-vms-bulk.md). 

## <a name="overview"></a>Обзор

Расширение агента SQL Server IaaS позволяет выполнять интеграцию с портал Azure и в зависимости от режима управления разблокирует ряд преимуществ функций для SQL Server на виртуальных машинах Azure: 

- **Преимущества функций**. расширение разблокирует ряд преимуществ функций автоматизации, таких как Управление порталом, гибкость лицензий, автоматическая архивация, автоматическая установка исправлений и многое другое. Дополнительные сведения см. в разделе [преимущества функций](#feature-benefits) далее в этой статье. 

- **Соответствие**. расширение предлагает упрощенный метод выполнения требования для уведомления корпорации Майкрософт о том, что преимущество гибридного использования Azure включена, как указано в условиях продукта. Этот процесс устраняет необходимость в управлении формами регистрации лицензий для каждого ресурса.  

- **Free**. расширение во всех трех режимах управляемости полностью бесплатное. Нет дополнительных затрат, связанных с расширением, или с изменением режимов управления. 

- **Упрощенное управление лицензиями**. расширение упрощает управление лицензиями SQL Server и позволяет быстро выявление SQL Server виртуальных машин с преимущество гибридного использования Azure, включенными с помощью [портал Azure](manage-sql-vm-portal.md), PowerShell или Azure CLI: 

   # <a name="powershell"></a>[PowerShell](#tab/azure-powershell)

   ```powershell-interactive
   Get-AzSqlVM | Where-Object {$_.LicenseType -eq 'AHUB'}
   ```

   # <a name="azure-cli"></a>[Azure CLI](#tab/azure-cli)

   ```azurecli-interactive
   $ az sql vm list --query "[?sqlServerLicenseType=='AHUB']"
   ```
   ---


> [!IMPORTANT]
> Расширение агента IaaS SQL собирает данные для предоставления клиентам дополнительных преимуществ при использовании SQL Server в виртуальных машинах Azure. Корпорация Майкрософт не будет использовать эти данные для аудита лицензирования без согласия клиента. Дополнительные сведения см. в разделе [SQL Server о конфиденциальности](/sql/sql-server/sql-server-privacy#non-personal-data) .


## <a name="feature-benefits"></a>Преимущества функций 

Расширение агента SQL Server IaaS разблокирует ряд преимуществ для управления виртуальной машиной SQL Server. 

Эти преимущества приведены в следующей таблице. 


| Функция | Описание |
| --- | --- |
| **Управление на портале** | Разблокирует [Управление на портале](manage-sql-vm-portal.md), чтобы вы могли просматривать все SQL Server виртуальные машины в одном месте, а также включать и отключать функции SQL непосредственно на портале. <br/> Режим управления: упрощенная & полная|  
| **Автоматическая архивация** |Автоматизирует планирование резервного копирования всех баз данных для экземпляра по умолчанию или [правильно установленного](frequently-asked-questions-faq.md#administration) именованного экземпляра SQL Server на виртуальной машине SQL Server. Дополнительные сведения см. в статье [Автоматическое резервное копирование для виртуальных машин SQL Server (Resource Manager)](automated-backup-sql-2014.md). <br/> Режим управления: полный|
| **Автоматическая установка исправлений** |Настраивает период обслуживания, в течение которого могут выполняться важные обновления системы безопасности Windows и SQL Server, поэтому во время пиковой нагрузки можно избежать обновлений в рабочее время. Дополнительные сведения см. в статье [Автоматическая установка исправлений SQL Server на виртуальных машинах Azure (Resource Manager)](automated-patching.md). <br/> Режим управления: полный|
| **Интеграция с Azure Key Vault** |Автоматически устанавливает и настраивает хранилище ключей Azure на виртуальной машине SQL Server. Дополнительные сведения см. в статье [Настройка интеграции Azure Key Vault для SQL Server на виртуальных машинах Azure (Resource Manager)](azure-key-vault-integration-configure.md). <br/> Режим управления: полный|
| **Просмотр использования диска на портале** | Позволяет просматривать графическое представление использования дисков в файлах данных SQL в портал Azure.  <br/> Режим управления: полный | 
| **Гибкое лицензирование** | Изменяйте затраты путем [простого перехода](licensing-model-azure-hybrid-benefit-ahb-change.md) с собственной лицензии (также известной как преимущество гибридного использования Azure) в модель лицензирования с оплатой по мере использования и обратно. <br/> Режим управления: упрощенная & полная| 
| **Гибкая версия или выпуск** | Если вы решили изменить [версию](change-sql-server-version.md) или [выпуск](change-sql-server-edition.md) SQL Server, можно обновить метаданные в портал Azure без необходимости повторного развертывания всей виртуальной машины SQL Server.  <br/> Режим управления: упрощенная & полная| 


## <a name="management-modes"></a>Режимы управления

Вы можете зарегистрировать расширение SQL IaaS в трех режимах управления: 

- **Облегченный** режим копирует двоичные файлы РАСШИРЕНИЙ на виртуальную машину, но не устанавливает агент и не перезапускает службу SQL Server. Упрощенный режим поддерживает только изменение типа лицензии и выпуска SQL Server и обеспечивает ограниченное управление порталом. Используйте этот параметр для SQL Server виртуальных машин с несколькими экземплярами или с участием в экземпляре отказоустойчивого кластера (FCI). Упрощенный режим является режимом управления по умолчанию при использовании функции [автоматической регистрации](sql-agent-extension-automatic-registration-all-vms.md) или если тип управления не указан во время ручной регистрации. Упрощенный режим не влияет на память или загрузку ЦП и дополнительная плата не взимается. Рекомендуется сначала зарегистрировать виртуальную машину SQL Server в упрощенном режиме, а затем выполнить обновление до полного режима в течение запланированного периода обслуживания. 

- **Полный** режим устанавливает агент IaaS SQL на виртуальную машину, чтобы обеспечить все функциональные возможности, но требует перезапуска службы SQL Server и системного администратора. Используйте его для управления виртуальной машиной SQL Server с одним экземпляром. В полном режиме устанавливаются две службы Windows, которые минимально воздействуют на память и загрузку ЦП. Это воздействие можно отслеживать с помощью диспетчера задач. Плата за использование режима полного управления не взимается. 

- Режим **NoAgent** предназначен для SQL Server 2008 и SQL Server 2008 R2, установленных в Windows Server 2008. Режим NoAgent не влияет на память или загрузку ЦП. При использовании режима управления с помощью агента не взимается плата, SQL Server не перезапускается, а агент не устанавливается на виртуальную машину. 

Текущий режим агента SQL Server IaaS можно просмотреть с помощью Azure PowerShell. 

  ```powershell-interactive
  # Get the SqlVirtualMachine
  $sqlvm = Get-AzSqlVM -Name $vm.Name  -ResourceGroupName $vm.ResourceGroupName
  $sqlvm.SqlManagementType
  ```


## <a name="installation"></a>Установка

Зарегистрируйте SQL Server ВИРТУАЛЬную машину с расширением агента SQL Server IaaS, чтобы создать _ресурс_ **виртуальной машины SQL** в рамках подписки, который является _отдельным_ ресурсом из ресурса виртуальной машины. При отмене регистрации ВИРТУАЛЬНОЙ машины SQL Server в расширении _ресурс_ **виртуальной машины SQL** будет удален, но фактические виртуальные машины не будут удалены.

При развертывании образа виртуальной машины Azure Marketplace SQL Server с помощью портал Azure автоматически регистрирует виртуальную машину SQL Server с расширением. Однако, если вы решили самостоятельно установить SQL Server на виртуальной машине Azure или подготовили виртуальную машину Azure из пользовательского виртуального жесткого диска, то необходимо зарегистрировать ВИРТУАЛЬную машину SQL Server с расширением SQL IaaS, чтобы разблокировать преимущества функций. 

Регистрация расширения в упрощенном режиме скопирует двоичные файлы, но не установит агент на виртуальную машину. Агент устанавливается на виртуальную машину при обновлении расширения до полного режима управления. 

Существует три способа регистрации в расширении: 
- [Автоматически для всех текущих и будущих виртуальных машин в подписке](sql-agent-extension-automatic-registration-all-vms.md)
- [Вручную для одной виртуальной машины](sql-agent-extension-manually-register-single-vm.md)
- [Ручное копирование нескольких виртуальных машин](sql-agent-extension-manually-register-vms-bulk.md)

### <a name="named-instance-support"></a>Поддержка именованного экземпляра

Расширение агента SQL Server IaaS работает с именованным экземпляром SQL Server если это единственный экземпляр SQL Server, доступный на виртуальной машине. Расширение не удается установить на виртуальных машинах с несколькими именованными экземплярами SQL Server, если на виртуальной машине нет экземпляра по умолчанию. 

Чтобы использовать именованный экземпляр SQL Server, разверните виртуальную машину Azure, установите в нее один именованный экземпляр SQL Server, а затем зарегистрируйте его с помощью [расширения SQL IaaS](sql-agent-extension-manually-register-single-vm.md).

Кроме того, чтобы использовать именованный экземпляр с образом SQL Server Azure Marketplace, выполните следующие действия. 

   1. Разверните виртуальную машину SQL Server из Azure Marketplace. 
   1. [Отмените регистрацию](sql-agent-extension-manually-register-single-vm.md#unregister-from-extension) SQL Server виртуальной машины в расширении агента IaaS SQL. 
   1. Полностью удалите SQL Server в виртуальной машине SQL Server.
   1. Установите SQL Server с именованным экземпляром в виртуальной машине SQL Server. 
   1. [Зарегистрируйте виртуальную машину с расширением агента IaaS SQL](sql-agent-extension-manually-register-single-vm.md#register-with-extension). 

## <a name="verify-status-of-extension"></a>Проверка состояния расширения

Чтобы проверить состояние расширения, используйте портал Azure или Azure PowerShell. 

### <a name="azure-portal"></a>Портал Azure

Убедитесь, что расширение установлено в портал Azure. 

Выберите **все параметры** в области виртуальная машина, а затем щелкните **расширения**. В списке будет указано расширение **SqlIaasExtension**.

![Состояние расширения агента IaaS SQL Server в портал Azure](./media/sql-server-iaas-agent-extension-automate-management/azure-rm-sql-server-iaas-agent-portal.png)


### <a name="azure-powershell"></a>Azure PowerShell

Вы также можете использовать командлет Azure PowerShell **Get-AzVMSqlServerExtension**:

   ```powershell-interactive
   Get-AzVMSqlServerExtension -VMName "vmname" -ResourceGroupName "resourcegroupname"
   ```

Предыдущая команда подтверждает, что агент установлен, и предоставляет общие сведения о состоянии. С помощью следующих команд можно получить определенные сведения о состоянии автоматической архивации и установки исправлений.

   ```powershell-interactive
    $sqlext = Get-AzVMSqlServerExtension -VMName "vmname" -ResourceGroupName "resourcegroupname"
    $sqlext.AutoPatchingSettings
    $sqlext.AutoBackupSettings
   ```


## <a name="limitations"></a>Ограничения

Расширение агента IaaS SQL поддерживает только: 

- Виртуальные машины SQL Server, развернутые с помощью Azure Resource Manager. Виртуальные машины SQL Server, развернутые с помощью классической модели развертывания, не поддерживаются. 
- Виртуальные машины SQL Server, развернутые в общедоступном облаке или в облаке Azure для государственных организаций. Развертывания в других частных облаках или облаках для государственных организаций не поддерживаются. 



## <a name="next-steps"></a>Дальнейшие действия

Чтобы установить расширение IaaS SQL Server для SQL Server на виртуальных машинах Azure, изучите статьи для [автоматической установки](sql-agent-extension-automatic-registration-all-vms.md), [отдельных виртуальных машин](sql-agent-extension-manually-register-single-vm.md)или [виртуальных машин](sql-agent-extension-manually-register-vms-bulk.md).

Подробные сведения о работе SQL Server на виртуальных машинах Azure см. в статье [Что собой представляет SQL Server на виртуальных машинах Azure](sql-server-on-azure-vm-iaas-what-is-overview.md).

Дополнительные сведения см. в разделе [часто задаваемые вопросы](frequently-asked-questions-faq.md). 
