---
title: Смена сертификатов для базы данных SQL Azure & SQL Управляемый экземпляр
description: Узнайте о предстоящих изменениях изменений корневого сертификата, которые повлияют на базу данных SQL Azure и Azure SQL Управляемый экземпляр
author: srdan-bozovic-msft
ms.author: srbozovi
ms.service: sql-db-mi
ms.subservice: service
ms.topic: conceptual
ms.date: 09/13/2020
ms.openlocfilehash: 96367b143711c4ec5f3f8d609f048c72c6fded16
ms.sourcegitcommit: 772eb9c6684dd4864e0ba507945a83e48b8c16f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "97590857"
---
# <a name="understanding-the-changes-in-the-root-ca-change-for-azure-sql-database--sql-managed-instance"></a>Основные сведения об изменениях в корневом ЦС для базы данных SQL Azure & SQL Управляемый экземпляр

База данных SQL Azure & Управляемый экземпляр SQL будет изменять корневой сертификат для клиентского приложения или драйвера с поддержкой SSL, который используется для установления безопасного подключения TDS. Срок действия [текущего корневого сертификата](https://www.digicert.com/CACerts/BaltimoreCyberTrustRoot.crt.pem) истекает 26 октября 2020 в рамках стандартных рекомендаций по обслуживанию и обеспечению безопасности. В этой статье приводятся дополнительные сведения о предстоящих изменениях, ресурсах, которые будут затронуты, и действиях, которые необходимо выполнить, чтобы обеспечить поддержку подключения приложения к серверу базы данных.

## <a name="what-update-is-going-to-happen"></a>Какое обновление будет выполнено?

[Браузер центра](https://cabforum.org/) сертификации. Форум недавно опубликованных отчетов о нескольких сертификатах, выданных поставщиками центров сертификации, которые не соответствуют требованиям.

Согласно требованиям отрасли поставщики ЦС начали отменять сертификаты ЦС для несоответствующих центров сертификации, требовать, чтобы серверы использовали сертификаты, выпущенные соответствующими центрами сертификации, и подписали сертификаты ЦС из соответствующих центров сертификации. Так как база данных SQL Azure & SQL Управляемый экземпляр в настоящее время использует один из этих несоответствующих сертификатов, которые клиентские приложения используют для проверки SSL-подключений, необходимо убедиться, что выполнены соответствующие действия (описанные ниже), чтобы максимально уменьшить потенциальное воздействие на серверы SQL Azure.

Новый сертификат будет использоваться начиная с 26 октября 2020 г. При использовании полной проверки сертификата сервера при подключении из клиента SQL (TrustServerCertificate = true) необходимо убедиться, что клиент SQL сможет проверить новый корневой сертификат до 26 октября 2020 г.

## <a name="how-do-i-know-if-my-application-might-be-affected"></a>Разделы справки выяснить, может ли приложение затронуть?

Все приложения, использующие SSL/TLS и проверяющие корневой сертификат, должны обновить корневой сертификат для подключения к базе данных SQL Azure & SQL Управляемый экземпляр. 

Если вы сейчас не используете SSL/TLS, это не повлияет на доступность вашего приложения. Вы можете проверить, пытается ли клиентское приложение проверить корневой сертификат, просмотрев строку подключения. Если для TrustServerCertificate явно задано значение true, это не повлияет.

Если ваш клиентский драйвер использует хранилище сертификатов ОС, как и большинство драйверов, и операционная система регулярно обслуживает это изменение, то, так как корневой сертификат, к которому мы переключаться, должен быть уже доступен в хранилище доверенных корневых сертификатов. Проверьте наличие Baltimore Цибердигицерт Глобалрут G2 и убедитесь, что оно имеется.

Если ваш клиентский драйвер использует хранилище сертификатов локального файла, чтобы избежать прерывания работы приложения из-за неожиданного отзыва сертификатов или обновления сертификата, который был отозван, см. раздел [**что нужно сделать для поддержания подключения**](./ssl-root-certificate-expiring.md#what-do-i-need-to-do-to-maintain-connectivity) .

## <a name="what-do-i-need-to-do-to-maintain-connectivity"></a>Что нужно сделать для поддержания подключения

Чтобы избежать прерывания доступности приложения из-за неожиданного отзыва сертификатов или обновления сертификата, который был отозван, выполните следующие действия:

*   Скачайте корневой центр сертификации Baltimore CyberTrust root & DigiCert Глобалрут G2 по ссылкам ниже:
    *   https://www.digicert.com/CACerts/BaltimoreCyberTrustRoot.crt.pem
    *   https://cacerts.digicert.com/DigiCertGlobalRootG2.crt.pem

*   Создайте объединенное хранилище сертификатов ЦС с сертификатами **BaltimoreCyberTrustRoot** и **DigiCertGlobalRootG2** .

## <a name="what-can-be-the-impact"></a>Что может быть повлияло?
Если вы проверяете сертификаты сервера, как описано здесь, доступность приложения может быть прервана, так как база данных не будет доступна. В зависимости от приложения могут быть получены различные сообщения об ошибках, включая, но не ограниченные:
*   Недопустимый сертификат или отозванный сертификат
*   Время ожидания подключения истекло
*   Ошибка, если применимо

## <a name="frequently-asked-questions"></a>Часто задаваемые вопросы

### <a name="if-i-am-not-using-ssltls-do-i-still-need-to-update-the-root-ca"></a>Если я не использую SSL/TLS, мне все равно нужно обновить корневой ЦС?
Если не используется протокол SSL/TLS, действия, касающиеся этого изменения, не требуются. Вы по-прежнему должны установить план для начала использования последней версии TLS, так как мы планируем применять применение TLS в ближайшем будущем.

### <a name="what-will-happen-if-i-do-not-update-the-root-certificate-before-october-26-2020"></a>Что произойдет, если не обновить корневой сертификат до 26 октября 2020?
Если вы не обновите корневой сертификат до 30 ноября 2020, ваши приложения, подключающиеся по протоколу SSL/TLS и выполняющие проверку корневого сертификата, не смогут взаимодействовать с базой данных SQL Azure & SQL Управляемый экземпляр и приложение будет испытывать проблемы с подключением к базе данных SQL Azure & Управляемый экземпляр SQL.

### <a name="do-i-need-to-plan-a-maintenance-downtime-for-this-changebr"></a>Нужно ли запланировать время простоя обслуживания для этого изменения?<BR>
Нет. Так как изменение здесь происходит только на стороне клиента для подключения к серверу, для этого изменения не требуется простоя обслуживания.

### <a name="what-if-i-cannot-get-a-scheduled-downtime-for-this-change-before-october-26-2020"></a>Что делать, если не удается получить запланированное время простоя для этого изменения до 26 октября 2020 г.?
Так как клиенты, используемые для подключения к серверу, должны обновить сведения о сертификате, как описано в разделе Исправление [здесь](./ssl-root-certificate-expiring.md#what-do-i-need-to-do-to-maintain-connectivity), в этом случае не требуется простоя сервера.

### <a name="if-i-create-a-new-server-after-november-30-2020-will-i-be-impacted"></a>Если я создаю новый сервер после 30 ноября 2020, будет ли это затронуто?
Для серверов, созданных после 26 октября 2020 г., вы можете использовать только что выпущенный сертификат для подключения приложений по протоколу SSL.

### <a name="how-often-does-microsoft-update-their-certificates-or-what-is-the-expiry-policy"></a>Как часто Корпорация Майкрософт обновляет свои сертификаты или какова политика срока действия?
Эти сертификаты, используемые базой данных SQL Azure & Управляемый экземпляр SQL, предоставляются доверенными центрами сертификации (CA). Поэтому поддержка этих сертификатов в базе данных SQL Azure & Управляемый экземпляр SQL привязывается к поддержке этих сертификатов центром сертификации. Однако, как и в этом случае, в этих стандартных сертификатах могут воздержаться непредвиденные ошибки, которые должны быть исправлены самым ранним образом.

### <a name="if-i-am-using-read-replicas-do-i-need-to-perform-this-update-only-on-primary-server-or-all-the-read-replicas"></a>Если я использую для чтения реплики, нужно ли выполнять это обновление только на основном сервере или во всех репликах чтения?
Так как это обновление является изменением на стороне клиента, если клиент использовался для считывания данных с сервера реплики, необходимо также применить изменения для этих клиентов. 

### <a name="do-we-have-server-side-query-to-verify-if-ssl-is-being-used"></a>Есть ли у нас запрос на стороне сервера для проверки использования SSL?
Так как эта конфигурация является клиентской на стороне клиента, сведения на стороне сервера недоступны.

### <a name="what-if-i-have-further-questions"></a>Что делать, если у меня возникнут дополнительные вопросы?
Если у вас есть план поддержки и вам нужна техническая помощь, создайте запрос на поддержку Azure. см. статью [о создании запроса на поддержку Azure](../../azure-portal/supportability/how-to-create-azure-support-request.md).