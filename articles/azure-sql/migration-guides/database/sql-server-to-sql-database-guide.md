---
title: 'SQL Server в базу данных SQL: руководство по миграции'
description: Следуйте этому руководству, чтобы перенести базы данных SQL Server в базу данных SQL Azure.
ms.service: sql-database
ms.subservice: migration-guide
ms.custom: ''
ms.devlang: ''
ms.topic: how-to
author: mokabiru
ms.author: mokabiru
ms.reviewer: MashaMSFT
ms.date: 11/06/2020
ms.openlocfilehash: a9dfd185af012314ddc481b598f181b6760640ec
ms.sourcegitcommit: c27a20b278f2ac758447418ea4c8c61e27927d6a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/03/2021
ms.locfileid: "101690946"
---
# <a name="migration-guide-sql-server-to-sql-database"></a>Руководство по миграции: SQL Server в базу данных SQL
[!INCLUDE[appliesto--sqldb](../../includes/appliesto-sqldb.md)]

Это пошаговое руководством поможет перенести экземпляр SQL Server в базу данных SQL Azure. 

Вы можете выполнить миграцию SQL Server, выполняемого локально или в: 

- SQL Server на виртуальных машинах  
- Amazon Web Services (AWS) EC2 
- Служба реляционной базы данных Amazon (AWS RDS) 
- Подсистема вычислений (Google Cloud Platform-обеспечить)  
- Облачный SQL для SQL Server (Google Cloud Platform – обеспечить) 

Дополнительные сведения о миграции см. в разделе [Общие сведения о миграции](sql-server-to-sql-database-overview.md). Другие сценарии см. в разделе [руководств по миграции баз данных](https://datamigration.microsoft.com/).

:::image type="content" source="media/sql-server-to-database-overview/migration-process-flow-small.png" alt-text="Поток процесса миграции":::

## <a name="prerequisites"></a>Предварительные требования 

Чтобы перенести SQL Server в базу данных SQL Azure, убедитесь, что у вас есть следующие необходимые компоненты: 

- Выбранный [метод миграции](sql-server-to-sql-database-overview.md#compare-migration-options) и соответствующие инструменты 
- [Помощник по миграции данных (DMA)](https://www.microsoft.com/download/details.aspx?id=53595) , установленный на компьютере, который может подключиться к исходному SQL Server
- Целевая [база данных SQL Azure](../../database/single-database-create-quickstart.md)


## <a name="pre-migration"></a>Подготовка к миграции

Убедившись, что исходная среда поддерживается, начните с этапа перед переносом. Обнаружение всех существующих источников данных, оценка пригодности к миграции и определение проблем с блокировкой, которые могут препятствовать миграции. 

### <a name="discover"></a>Обнаружить

На этапе обнаружения проверьте сеть, чтобы определить все SQL Server экземпляры и функции, используемые в Организации. 

Используйте службу " [Миграция Azure](../../../migrate/migrate-services-overview.md) ", чтобы оценить пригодность для миграции локальных серверов, определить размер на основе производительности и оценить затраты на их запуск в Azure. 

Кроме того, для оценки текущей ИТ-инфраструктуры можно воспользоваться [набором средств оценки и планирования Microsoft ("набор средств для MAP Toolkit")](https://www.microsoft.com/download/details.aspx?id=7826) . Набор средств предоставляет мощный инструмент для инвентаризации, оценки и создания отчетов, позволяющий упростить процесс планирования миграции. 

Дополнительные сведения о средствах, доступных для использования в фазе обнаружения, см. в разделе [службы и средства, доступные для сценариев переноса данных](../../../dms/dms-tools-matrix.md). 

### <a name="assess"></a>Оценка 

После обнаружения источников данных оцените все локальные SQL Server базы данных, которые можно перенести в базу данных SQL Azure, чтобы определить блокирование миграции или проблемы совместимости. 

Для оценки получаемых баз данных можно использовать Помощник по миграции данных (версии 4,1 и более поздних версий): 

- [Рекомендации для целевого объекта Azure](/sql/dma/dma-assess-sql-data-estate-to-sqldb)
- [Рекомендации по SKU Azure](/sql/dma/dma-sku-recommend-sql-db)

Чтобы оценить среду с помощью оценки миграции базы данных, выполните следующие действия. 

1. Откройте [Помощник по миграции данных (DMA)](https://www.microsoft.com/download/details.aspx?id=53595). 
1. Выберите **файл** и нажмите кнопку **создать оценку**. 
1. Укажите имя проекта, выберите SQL Server в качестве типа исходного сервера, а затем выберите База данных SQL Azure в качестве типа целевого сервера. 
1. Выберите типы отчетов оценки, которые требуется создать. Например, совместимость базы данных и функции четности. В зависимости от типа оценки разрешения, необходимые для источника SQL Server, могут отличаться.  Прежде чем выполнять оценку, DMA выделит разрешения, необходимые для выбранного помощника.
    - Категория " **четность функций** " содержит исчерпывающий набор рекомендаций, альтернативы, доступные в Azure, и действия по планированию проекта миграции. (требуются разрешения sysadmin)
    - Категория **проблемы совместимости** определяет частично поддерживаемые или неподдерживаемые проблемы совместимости компонентов, которые могут блокировать миграцию, а также рекомендации по их устранению ( `CONNECT SQL` , `VIEW SERVER STATE` и `VIEW ANY DEFINITION` необходимые разрешения).
1. Укажите сведения о подключении к источнику для SQL Server и подключитесь к базе данных источника.
1. Выберите **начать оценку**. 
1. После завершения процесса выберите и проверьте отчеты об оценке на предмет блокировки миграции и проблемы с четностью компонентов. Отчет об оценке также можно экспортировать в файл, который можно использовать совместно с другими командами или сотрудниками Организации. 
1. Определите уровень совместимости базы данных, который снизит усилия, выполняемые после миграции.  
1. Найдите оптимальный номер SKU базы данных SQL Azure для локальной рабочей нагрузки. 

Дополнительные сведения см. в разделе [выполнение SQL Serverной оценки миграции с помощью помощник по миграции данных](/sql/dma/dma-assesssqlonprem).

Если при оценке обнаруживается несколько блокировок, чтобы убедиться, что база данных не готова к миграции базы данных SQL Azure, можно также рассмотреть следующее:

- [Управляемый экземпляр SQL Azure](../managed-instance/sql-server-to-managed-instance-overview.md) при наличии нескольких зависимостей уровня экземпляра
- [SQL Server на виртуальных машинах Azure](../virtual-machines/sql-server-to-sql-on-azure-vm-migration-overview.md) , если базы данных SQL и SQL управляемый экземпляр не подходят для целевого объекта. 



#### <a name="scaled-assessments-and-analysis"></a>Масштабируемые оценки и анализ
Помощник по миграции данных поддерживает выполнение масштабируемых оценок и консолидацию отчетов об оценке для анализа. 

Если у вас есть несколько серверов и баз данных, которые необходимо оценить и проанализировать в масштабе, чтобы предоставить более подробное представление о разотношении данных, ознакомьтесь со следующими ссылками, чтобы получить дополнительные сведения.

- [Выполнение масштабируемых оценок с помощью PowerShell](/sql/dma/dma-consolidatereports)
- [Анализ отчетов об оценке с помощью Power BI](/sql/dma/dma-consolidatereports#dma-reports)

> [!IMPORTANT]
> Выполнение оценок в масштабе для нескольких баз данных, особенно больших, также может быть автоматизировано с помощью [программы командной строки DMA](/sql/dma/dma-commandline) и отправлено в службу " [Миграция Azure](/sql/dma/dma-assess-sql-data-estate-to-sqldb#view-target-readiness-assessment-results) " для дальнейшего анализа и обеспечения готовности к работе.

## <a name="migrate"></a>Миграция

После завершения задач, связанных с стадией перед миграцией, можно приступать к выполнению переноса схемы и данных. 

Перенесите данные с помощью выбранного [метода миграции](sql-server-to-sql-database-overview.md#compare-migration-options). 

В этом руководством описаны два наиболее популярных варианта — Помощник по миграции данных и Azure Database Migration Service. 

### <a name="data-migration-assistant-dma"></a>Помощник по миграции данных (DMA)

Чтобы перенести базу данных из SQL Server в базу данных SQL Azure с помощью DMA, выполните следующие действия. 

1. Скачайте и установите [Помощник по миграции базы данных](https://www.microsoft.com/download/details.aspx?id=53595).
1. Создайте новый проект и выберите **Миграция** в качестве типа проекта.
1. Задайте для параметра Тип исходного сервера значение **SQL Server** , а для параметра Тип целевого сервера — **база данных SQL Azure**, выберите область миграции в качестве **схемы и данных** и нажмите кнопку **создать**.
1. В проекте миграции укажите сведения об исходном сервере, такие как имя сервера, учетные данные для подключения к серверу и исходная база данных для миграции.
1. В сведениях о целевом сервере укажите имя сервера базы данных SQL Azure, учетные данные для подключения к серверу и целевую базу данных для миграции.
1. Выберите объекты схемы и разверните их в целевой базе данных SQL Azure.
1. Наконец, выберите **начать миграцию данных** и отслеживайте ход выполнения миграции.

Подробное руководство см. в статье [Миграция локальных SQL Server или SQL Server на виртуальные машины Azure в базу данных SQL Azure с помощью помощник по миграции данных](/sql/dma/dma-migrateonpremsqltosqldb). 


> [!NOTE]
> - Масштабировать базу данных до более высокого уровня служб и размера вычислений в процессе импорта, чтобы максимально увеличить скорость импорта, предоставляя дополнительные ресурсы. После завершения импорта эти значения можно уменьшить.</br>
> - Уровень совместимости импортированной базы данных основан на уровне совместимости базы данных-источника. 


### <a name="azure-database-migration-service-dms"></a>Azure Database Migration Service (DMS)

Чтобы перенести базы данных из SQL Server в базу данных SQL Azure с помощью DMS, выполните следующие действия:

1. Если вы этого еще не сделали, зарегистрируйте поставщик ресурсов **Microsoft. Migration** в своей подписке. 
1. Создайте экземпляр Azure Database Migration Service в выбранном расположении (предпочтительно в том же регионе, что и Целевая база данных SQL Azure). Выберите существующую виртуальную сеть или создайте новую для размещения экземпляра DMS.
1. После создания экземпляра DMS создайте новый проект миграции и укажите в качестве типа исходного сервера **SQL Server** и тип целевого сервера в качестве **базы данных SQL Azure**. Выберите **Миграция автономных данных** в качестве типа действия в колонке создание проекта миграции.
1. Укажите сведения об источнике SQL Server на странице сведений об **источнике миграции** , а также сведения о целевой базе данных SQL Azure на странице сведений о **целевом объекте миграции** .
1. Сопоставьте исходную и целевую базы данных для миграции, а затем выберите таблицы, которые требуется перенести.
1. Ознакомьтесь со сводкой о миграции и выберите **запустить миграцию**. Затем можно отслеживать действие миграции и проверять ход выполнения миграции базы данных.

Подробное руководство см. в статье [миграция SQL Server в базу данных SQL Azure с помощью DMS](../../../dms/tutorial-sql-server-to-azure-sql.md). 

## <a name="data-sync-and-cutover"></a>Синхронизация данных и прямую миграцию

При использовании параметров миграции, которые постоянно реплицируют и синхронизируют изменения данных от источника к целевому объекту, исходные данные и схема могут измениться и отменяться от целевого объекта. Во время синхронизации данных убедитесь, что все изменения в источнике фиксируются и применяются к целевому объекту в процессе миграции. 

Убедившись, что данные одинаковы как на исходном, так и в целевом объекте, можно прямую миграцию из источника в целевую среду. Важно спланировать процесс прямую миграцию с группами бизнеса или приложений, чтобы обеспечить минимальное прерывание во время прямую миграцию, не влияющее на непрерывность бизнес-процессов. 

> [!IMPORTANT]
> Дополнительные сведения о конкретных действиях, связанных с выполнением прямую миграцию в процессе миграции с помощью DMS, см. в разделе [выполнение миграции прямую миграцию](../../../dms/tutorial-sql-server-azure-sql-online.md#perform-migration-cutover).

## <a name="migration-recommendations"></a>Рекомендации по миграции

Чтобы ускорить миграцию в базу данных SQL Azure, необходимо принять во внимание следующие рекомендации.

|  | Состязание за ресурсы | Рекомендация |
|--|--|--|
| **Источник (обычно локальный)** |Основным узким местом во время миграции в источнике являются операции ввода-вывода данных и задержка для файла данных, который необходимо внимательно отслеживать.  |На основе операций ввода-вывода данных и задержки в файлах данных, а также в зависимости от того, является ли виртуальная машина или физический сервер, необходимо привлечь администратора хранилища и изучить варианты устранения узкого места. |
|**Целевой объект (база данных SQL Azure)**|Наибольший ограничивающий фактор — это скорость создания журнала и задержка для файла журнала. С помощью базы данных SQL Azure можно получить максимальную частоту создания журнала 96 МБ/с. | Чтобы ускорить миграцию, увеличьте масштаб целевой базы данных SQL до критически важный для бизнеса го поколения 8 Виртуальное ядро, чтобы получить максимальную частоту создания журнала 96 МБ/с, а также обеспечить низкую задержку для файла журнала. Уровень службы " [горизонтальное масштабирование](../../database/service-tier-hyperscale.md) " обеспечивает частоту записи в журнал 100 МБ/с независимо от выбранного уровня обслуживания. |
|**Network** |Требуется пропускная способность сети равна максимальной скорости приема журнала 96 МБ/с (768 МБ/с) |В зависимости от сетевого подключения из локального центра обработки данных к Azure проверьте пропускную способность сети (как правило, [Azure ExpressRoute](../../../expressroute/expressroute-introduction.md#bandwidth-options)), чтобы обеспечить максимальную скорость приема журнала. |
|**Виртуальная машина, используемая для Помощник по миграции данных (DMA)** |ЦП является основным узким местом для виртуальной машины, на которой работает DMA. |Вопросы, которые необходимо учитывать для ускорения переноса данных с помощью </br>— Виртуальные машины с интенсивным использованием вычислительных ресурсов Azure </br>— Используйте по крайней мере F8s_v2 (8 Виртуальное ядро) виртуальную машину для запуска DMA </br>— Убедитесь, что виртуальная машина запущена в том же регионе Azure, что и Целевая. |
|**Azure Database Migration Service (DMA)** |Конфликты при вычислении ресурсов и объекты базы данных для DMS |Используйте Premium 4 Виртуальное ядро. DMS автоматически берет на себя объекты базы данных, такие как внешние ключи, триггеры, ограничения и некластеризованные индексы, и не требует вмешательства вручную.  |


## <a name="post-migration"></a>После миграции

После успешного завершения этапа миграции пройдите ряд задач, выполняемых после миграции, чтобы обеспечить бесперебойную работу всех компонентов. 

Этап, выполняемый после миграции, крайне важен для согласования любых проблем с точностью данных и проверки полноты, а также для устранения проблем с производительностью рабочей нагрузки. 

### <a name="remediate-applications"></a>Исправление приложений 

После переноса данных в целевую среду все приложения, которые раньше использовали источник, должны приступить к приему целевого объекта. Для этого в некоторых случаях потребуется внести изменения в приложения.

### <a name="perform-tests"></a>Выполнение тестов

Тестирование переноса базы данных включает следующие действия.

1. **Разработка проверочных тестов**. Чтобы протестировать перенос базы данных, необходимо использовать SQL-запросы. Необходимо создать запросы проверки, которые будут выполняться как в исходной, так и в целевой базах данных. Запросы на проверку должны охватывать определенную область.
1. **Настройка тестовой среды**. Тестовая среда должна содержать копию исходной и целевой баз данных. Не забудьте изолировать тестовую среду.
1. **Выполнение проверочных тестов**. Выполните проверочные тесты для источника и целевого объекта, а затем проанализируйте результаты.
1. **Выполнение тестов производительности**. Запустите тест производительности для источника и целевого объекта, а затем проанализируйте и сравните результаты.

   > [!NOTE]
   > Чтобы получить помощь в разработке и выполнении проверочных тестов, выполняемых после переноса, используйте решение по обеспечению качества данных, предоставляемое нашим партнером [QuerySurge](https://www.querysurge.com/company/partners/microsoft). 


## <a name="leverage-advanced-features"></a>Использование дополнительных функций 

Воспользуйтесь преимуществами расширенных облачных функций, предлагаемых базой данных SQL, таких как [Встроенная Высокая доступность](../../database/high-availability-sla.md), [обнаружение угроз](../../database/azure-defender-for-sql.md), [мониторинг и Настройка рабочей нагрузки](../../database/monitor-tune-overview.md). 

Некоторые SQL Server функции доступны только после изменения [уровня совместимости базы данных](/sql/relational-databases/databases/view-or-change-the-compatibility-level-of-a-database) на последний уровень совместимости (150). 

Дополнительные сведения см. в статье [Управление базой данных SQL Azure после миграции](../../database/manage-data-after-migrating-to-database.md) .


## <a name="next-steps"></a>Дальнейшие действия

- Сведения о службах и средствах Майкрософт и сторонних поставщиков, которые помогут вам в использовании различных сценариев переноса баз данных и данных, а также специальных задач см. в разделе [служба и средства для переноса данных](../../../dms/dms-tools-matrix.md).

- Дополнительные сведения о базе данных SQL см. в следующих статьях:
    - [Обзор базы данных SQL Azure](../../database/sql-database-paas-overview.md)
   - [Калькулятор совокупной стоимости владения Azure](https://azure.microsoft.com/pricing/tco/calculator/) 


- Дополнительные сведения о структуре и цикле внедрения для миграции в облако см. в разделе
   -  [Cloud Adoption Framework для Azure](/azure/cloud-adoption-framework/migrate/azure-best-practices/contoso-migration-scale)
   -  [Рекомендации по затратам и изменению размеров рабочих нагрузок, переносятся в Azure](/azure/cloud-adoption-framework/migrate/azure-best-practices/migrate-best-practices-costs) 

- Чтобы оценить уровень доступа к приложениям, см. раздел [набор средств миграции для доступа к данным (Предварительная версия)](https://marketplace.visualstudio.com/items?itemName=ms-databasemigration.data-access-migration-toolkit)
- Дополнительные сведения о выполнении проверки уровня доступа к данным A/B см. [Database experimentation Assistant](/sql/dea/database-experimentation-assistant-overview).