---
title: Правила оценки для SQL Server миграции Управляемый экземпляр SQL Azure
description: Правила оценки для обнаружения проблем с исходным экземпляром SQL Server, которые должны быть решены перед миграцией в Azure SQL Управляемый экземпляр.
ms.service: sql-managed-instance
ms.subservice: migration-guide
ms.custom: ''
ms.devlang: ''
ms.topic: how-to
author: MashaMSFT
ms.author: mathoma
ms.reviewer: MashaMSFT
ms.date: 12/15/2020
ms.openlocfilehash: fc8959d44fbacd90916a045d23db4bee872c4670
ms.sourcegitcommit: a8ff4f9f69332eef9c75093fd56a9aae2fe65122
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/24/2021
ms.locfileid: "105026042"
---
# <a name="assessment-rules-for-sql-server-to--azure-sql-managed-instance-migration"></a>Правила оценки для SQL Server миграции Управляемый экземпляр SQL Azure
[!INCLUDE[appliesto--sqldb](../../includes/appliesto-sqldb.md)]

Средства миграции проверяют экземпляр SQL Server источника, выполняя ряд правил оценки для обнаружения проблем, которые необходимо устранить перед переносом базы данных SQL Server в Управляемый экземпляр Azure SQL. 

В этой статье представлен список правил, используемых для оценки возможности миграции базы данных SQL Server в Azure SQL Управляемый экземпляр. 

## <a name="analysiscommand-job"></a>Задание AnalysisCommand<a id="AnalysisCommandJob"></a>

**Title: шаг задания AnalysisCommand не поддерживается в Azure SQL Управляемый экземпляр.**   
**Категория**: предупреждение   


**Описание**   
Это шаг задания, выполняющий команду Analysis Services. Шаг задания AnalysisCommand не поддерживается в Управляемый экземпляр Azure SQL.

**Рекомендуемые**     
Просмотрите раздел затронутые объекты в службе "миграция Azure", чтобы просмотреть все задания с помощью шага задания команды службы Analysis Services и оценить, можно ли удалить шаг задания или затронутый объект. Также можно перейти на SQL Server на виртуальной машине Azure.

Дополнительные сведения: [Агент SQL Server различия в Azure SQL управляемый экземпляр ](../../managed-instance/transact-sql-tsql-differences-sql-server.md#sql-server-agent)

## <a name="analysisquery-job"></a>Задание AnalysisQuery<a id="AnalysisQueryJob"></a>

**Title: шаг задания AnalysisQuery не поддерживается в Azure SQL Управляемый экземпляр.**   
**Категория**: предупреждение   

**Описание**   
Это шаг задания, выполняющий запрос Analysis Services. Шаг задания AnalysisQuery не поддерживается в Управляемый экземпляр Azure SQL.


**Рекомендуемые**   
Просмотрите раздел затронутые объекты в службе "миграция Azure", чтобы просмотреть все задания с помощью шага задания запроса службы Analysis Services и оценить, можно ли удалить шаг задания или затронутый объект. Также можно перейти на SQL Server на виртуальной машине Azure.

Дополнительные сведения: [Агент SQL Server различия в Azure SQL управляемый экземпляр ](../../managed-instance/transact-sql-tsql-differences-sql-server.md#sql-server-agent)


## <a name="assembly-from-file"></a>Сборка из файла<a id="AssemblyFromFile"></a>

**Title: "CREATE ASSEMBLY" и "ALTER ASSEMBLY" с параметром файла не поддерживаются в Управляемый экземпляр Azure SQL.**   
**Категория**: предупреждение   

**Описание**   
Управляемый экземпляр Azure SQL не может получить доступ к файловым ресурсам или папкам Windows. Сведения об использовании инструкций BULK INSERT, которые не ссылаются на большой двоичный объект Azure, см. в разделе "затронутые объекты". Объекты с "BULK INSERT", где источник не является хранилищем BLOB-объектов Azure, не будут работать после миграции в Azure SQL Управляемый экземпляр.


**Рекомендуемые**   
При переходе на Управляемый экземпляр SQL Azure необходимо преобразовать инструкции BULK INSERT, использующие локальные файлы или общие файловые ресурсы, для использования файлов из хранилища BLOB-объектов Azure. Также можно перейти на SQL Server на виртуальной машине Azure. 

Дополнительные сведения: [различия в CLR в Azure SQL управляемый экземпляр ](../../managed-instance/transact-sql-tsql-differences-sql-server.md#clr)

## <a name="bulk-insert"></a>Инструкция INSERT<a id="BulkInsert"></a>

**Title: BULK INSERT с источником данных BLOB-объектов, отличным от Azure, не поддерживается в Управляемый экземпляр SQL Azure.**   
**Категория**: вопрос   

**Описание**   
Управляемый экземпляр Azure SQL не может получить доступ к файловым ресурсам или папкам Windows. Сведения об использовании инструкций BULK INSERT, которые не ссылаются на большой двоичный объект Azure, см. в разделе "затронутые объекты". Объекты с "BULK INSERT", где источник не является хранилищем BLOB-объектов Azure, не будут работать после миграции в Azure SQL Управляемый экземпляр.


**Рекомендуемые**   
При переходе на Управляемый экземпляр SQL Azure необходимо преобразовать инструкции BULK INSERT, использующие локальные файлы или общие файловые ресурсы, для использования файлов из хранилища BLOB-объектов Azure.

Дополнительные сведения: [различия в инструкции BULK INSERT и OPENROWSET в Azure SQL управляемый экземпляр ](../../managed-instance/transact-sql-tsql-differences-sql-server.md#bulk-insert--openrowset)


## <a name="clr-security"></a>Безопасность среды CLR<a id="ClrStrictSecurity"></a>

**Title: сборки CLR, помеченные как надежные или EXTERNAL_ACCESS, считаются небезопасными**   
**Категория**: вопрос   

**Описание**   
В Azure SQL Управляемый экземпляр применяется режим строгой безопасности CLR. Этот режим включен по умолчанию и вводит критические изменения для баз данных, содержащих пользовательские сборки среды CLR, помеченные как надежные или EXTERNAL_ACCESS.


**Рекомендуемые**   
Среда CLR использует управление доступом для кода (CAS) в .NET Framework, которое больше не поддерживается в качестве границы безопасности. Начиная с версии ядра СУБД SQL Server 2017 (14. x), `sp_configure` для повышения безопасности сборок среды CLR вводится параметр, именуемый CLR строгим обеспечением безопасности. Среда CLR строгая безопасность включена по умолчанию и обрабатывает безопасный и EXTERNAL_ACCESS сборки CLR, как если бы они были помечены как ненадежные. При отключенной функции безопасности CLR сборка CLR, созданная с помощью PERMISSION_SET = Сейф, может иметь доступ к внешним системным ресурсам, вызывать неуправляемый код и получать права системного администратора. После включения строгой безопасности сборки без подписи загружаться не будут. Кроме того, если база данных содержит надежные или EXTERNAL_ACCESS сборки, инструкция RESTORE или присоединение базы данных может завершиться, но сборки могут не загрузиться. Чтобы загрузить сборки, необходимо либо изменить, либо удалить и повторно создать каждую сборку, чтобы она была подписана с помощью сертификата или асимметричного ключа, имеющего соответствующее имя входа с разрешениями ненадежной сборки на сервере.

Дополнительные сведения: [Среда CLR с уровнем безопасности](/sql/database-engine/configure-windows/clr-strict-security)

## <a name="compute-clause"></a>Предложение COMPUTE<a id="ComputeClause"></a>

**Title: предложение COMPUTE больше не поддерживается и было удалено.**   
**Категория**: предупреждение   

**Описание**   
Предложение COMPUTE формирует итоги, которые отображаются в виде дополнительных столбцов сводки в конце результирующего набора. Однако это предложение больше не поддерживается в Управляемый экземпляр Azure SQL.



**Рекомендуемые**   
Модуль T-SQL необходимо переписывать с помощью оператора ROLLUP. В приведенном ниже коде показано, как можно заменить ВЫЧИСЛЕНие на ROLLUP. 

```sql
USE AdventureWorks GO;  

SELECT SalesOrderID, UnitPrice, UnitPriceDiscount 
FROM Sales.SalesOrderDetail 
ORDER BY SalesOrderID COMPUTE SUM(UnitPrice), SUM(UnitPriceDiscount) 
BY SalesOrderID GO; 

SELECT SalesOrderID, UnitPrice, UnitPriceDiscount,SUM(UnitPrice) as UnitPrice , 
SUM(UnitPriceDiscount) as UnitPriceDiscount 
FROM Sales.SalesOrderDetail 
GROUP BY SalesOrderID, UnitPrice, UnitPriceDiscount WITH ROLLUP;
```

Дополнительные сведения: [неподдерживаемая функция ядро СУБД в SQL Server](/previous-versions/sql/2014/database-engine/discontinued-database-engine-functionality-in-sql-server-2016#Denali)

## <a name="cryptographic-provider"></a>Поставщик служб шифрования<a id="CryptographicProvider"></a>

**Title: обнаружено использование создания поставщика служб шифрования или изменение поставщика служб шифрования, которое не поддерживается в Управляемый экземпляр Azure SQL.**   
**Категория**: вопрос   

**Описание**   
Управляемый экземпляр Azure SQL не поддерживает инструкции поставщика служб шифрования, так как он не может получить доступ к файлам. Сведения об использовании операторов поставщика служб шифрования см. в разделе затронутые объекты. Объекты с "Создание поставщика служб шифрования" или "Изменение поставщика служб шифрования" будут работать неправильно после переноса в Azure SQL Управляемый экземпляр.


**Рекомендуемые**   
Проверьте объекты с помощью инструкций "создать поставщик служб шифрования" или "Изменение поставщика служб шифрования". В любом из необходимых объектов удалите использование этих функций. Также можно перейти на SQL Server на виртуальной машине Azure. 

Дополнительные сведения. [различия в поставщике служб шифрования в Azure SQL управляемый экземпляр ](../../managed-instance/transact-sql-tsql-differences-sql-server.md#cryptographic-providers)

## <a name="database-compatibility"></a>Совместимость базы данных<a id="DbCompatLevelLowerThan100"></a>

**Title: уровень совместимости базы данных ниже 100 не поддерживается.**   
**Категория**: предупреждение   

**Описание**   
Уровень совместимости базы данных — это ценное средство, помогающее в модернизации базы данных, позволяющее обновлять SQL Server ядро СУБД, сохраняя при этом работоспособное состояние приложений, сохраняя при этом одинаковый уровень совместимости базы данных до обновления. Управляемый экземпляр Azure SQL не поддерживает уровни совместимости ниже 100. Когда база данных с уровнем совместимости ниже 100 восстанавливается в Управляемый экземпляр SQL Azure, уровень совместимости обновляется до 100. 


**Рекомендация**... Оцените, не повреждена ли функциональность приложения при обновлении уровня совместимости базы данных до 100 в Управляемый экземпляр Azure SQL. Также можно перейти на SQL Server на виртуальной машине Azure.

Дополнительные сведения: [Поддерживаемые уровни совместимости в Azure SQL управляемый экземпляр ](../../managed-instance/transact-sql-tsql-differences-sql-server.md#compatibility-levels)

## <a name="database-principal-alias"></a>Псевдоним участника базы данных<a id="DatabasePrincipalAlias"></a>

**Title: SYS. DATABASE_PRINCIPAL_ALIASES прекращена и была удалена.**   
**Категория**: вопрос   

**Описание**   
Представления. DATABASE_PRINCIPAL_ALIASES прекращена и была удалена в Управляемый экземпляр SQL Azure.


**Рекомендуемые**   
Использование ролей вместо псевдонимов.

Дополнительные сведения: [неподдерживаемая функция ядро СУБД в SQL Server](/previous-versions/sql/2014/database-engine/discontinued-database-engine-functionality-in-sql-server-2016#Denali)

## <a name="disable_def_cnst_chk-option"></a>DISABLE_DEF_CNST_CHK, параметр<a id="DisableDefCNSTCHK"></a>

**Title: параметр SET DISABLE_DEF_CNST_CHK больше не поддерживается и был удален.**   
**Категория**: вопрос   

**Описание**   
Параметр SET DISABLE_DEF_CNST_CHK больше не поддерживается и был удален в Управляемый экземпляр SQL Azure.


Дополнительные сведения: [неподдерживаемая функция ядро СУБД в SQL Server](/previous-versions/sql/2014/database-engine/discontinued-database-engine-functionality-in-sql-server-2016#Denali)

## <a name="fastfirstrow-hint"></a>Подсказка FASTFIRSTROW<a id="FastFirstRowHint"></a>

**Title: указание запроса FASTFIRSTROW прекращено и было удалено.**   
**Категория**: предупреждение   

**Описание**   
Указание запроса FASTFIRSTROW прекращено и было удалено в Управляемый экземпляр Azure SQL.


**Рекомендуемые**   
Вместо параметра Use указание запроса FASTFIRSTROW (FAST n).

Дополнительные сведения: [неподдерживаемая функция ядро СУБД в SQL Server](/previous-versions/sql/2014/database-engine/discontinued-database-engine-functionality-in-sql-server-2016#Denali)

## <a name="filestream"></a>Потока<a id="FileStream"></a>

**Title: FILESTREAM и FileTable не поддерживаются в Управляемый экземпляр SQL Azure.**   
**Категория**: вопрос   

**Описание**   
Функция FILESTREAM, которая позволяет хранить неструктурированные данные, такие как текстовые документы, изображения и видео в файловой системе NTFS, не поддерживается в Управляемый экземпляр Azure SQL. **Невозможно выполнить миграцию этой базы данных, так как резервная копия, содержащая файловые группы FILESTREAM, не может быть восстановлена в Управляемый экземпляр Azure SQL.**


**Рекомендуемые**   
Передайте неструктурированные файлы в хранилище BLOB-объектов Azure и сохраните метаданные, связанные с этими файлами (имя, тип, расположение URL-адреса, ключ к хранилищу и т. д.) в Управляемый экземпляр Azure SQL. Возможно, потребуется выполнить повторное проектирование приложения, чтобы разрешить потоковую передачу больших двоичных объектов в Azure SQL Управляемый экземпляр и обратно. Также можно перейти на SQL Server на виртуальной машине Azure.

Дополнительные сведения: [потоковая передача больших двоичных объектов в блог SQL Azure и обратно](https://azure.microsoft.com/en-in/blog/streaming-blobs-to-and-from-sql-azure/)

## <a name="heterogeneous-ms-dtc"></a>Разнородные MS DTC<a id="MIHeterogeneousMSDTCTransactSQL"></a>

**Title: запуск РАСПРЕДЕЛЕНной транзакции с не SQL Server удаленным сервером не поддерживается в Управляемый экземпляр SQL Azure.**   
**Категория**: вопрос   

**Описание**   
Распределенная транзакция, запущенная инструкцией Transact SQL BEGIN РАСПРЕДЕЛЕНная транзакция и управляемая Microsoft координатор распределенных транзакций (MS DTC), не поддерживается в Управляемый экземпляр SQL Azure, если удаленный сервер не SQL Server. 


**Рекомендуемые**   
Просмотрите раздел затронутые объекты в службе "миграция Azure", чтобы просмотреть все объекты с помощью транзакции BEGIN ДИСТРУБУТЕД. Рассмотрите возможность переноса баз данных участников в Azure SQL Управляемый экземпляр, где поддерживаются распределенные транзакции между несколькими экземплярами (в настоящее время это предварительная версия). Также можно перейти на SQL Server на виртуальной машине Azure.

Дополнительные сведения: [транзакции на нескольких серверах для управляемый экземпляр Azure SQL ](../../database/elastic-transactions-overview.md#transactions-across-multiple-servers-for-azure-sql-managed-instance)

## <a name="homogenous-ms-dtc"></a>Однородные MS DTC<a id="MIHomogeneousMSDTCTransactSQL"></a>

**Title: начало РАСПРЕДЕЛЕНной транзакции поддерживается на нескольких серверах для Управляемый экземпляр Azure SQL.**   
**Категория**: вопрос   

**Описание**   
Распределенная транзакция, запущенная инструкцией Transact SQL BEGIN РАСПРЕДЕЛЕНной ТРАНЗАКЦИей и управляемая Microsoft координатор распределенных транзакций (MS DTC), поддерживается на нескольких серверах для Управляемый экземпляр SQL Azure.


**Рекомендуемые**   
Просмотрите раздел затронутые объекты в службе "миграция Azure", чтобы просмотреть все объекты с помощью транзакции BEGIN ДИСТРУБУТЕД. Рассмотрите возможность переноса баз данных участников в Azure SQL Управляемый экземпляр, где поддерживаются распределенные транзакции между несколькими экземплярами (в настоящее время это предварительная версия). Также можно перейти на SQL Server на виртуальной машине Azure. 

Дополнительные сведения: [транзакции на нескольких серверах для управляемый экземпляр Azure SQL](../../database/elastic-transactions-overview.md#transactions-across-multiple-servers-for-azure-sql-managed-instance)


## <a name="linked-server-non-sql-provider"></a>Связанный сервер (не поставщик SQL)<a id="LinkedServerWithNonSQLProvider"></a>

**Title: связанный сервер с поставщиком, не являющимся SQL Server, не поддерживается в Управляемый экземпляр SQL Azure.**   
**Категория**: вопрос   

**Описание**   
Связанные серверы позволяют SQL Server ядро СУБД выполнять команды для OLE DB источников данных за пределами экземпляра SQL Server. Связанный сервер с поставщиком, не являющимся SQL Server, не поддерживается в Управляемый экземпляр SQL Azure. 


**Рекомендуемые**   
Управляемый экземпляр Azure SQL не поддерживает функциональность связанного сервера, если поставщик удаленных серверов не SQL Server например Oracle, Sybase и т. д. 

Для устранения необходимости в связанных серверах рекомендуется выполнить следующие действия. 
- Определите зависимые базы данных с удаленных серверов, не являющихся серверами SQL, и рассмотрите возможность перемещения их в переносимую базу данных. 
- Перенесите зависимые базы данных на поддерживаемые целевые объекты, такие как SQL Управляемый экземпляр, база данных SQL, Azure синапсе SQL и экземпляры SQL Server. 
- Рассмотрите возможность создания связанного сервера между Управляемый экземпляр Azure SQL и SQL Server на виртуальной машине Azure (ВИРТУАЛЬная машина SQL).  Затем с виртуальной машины SQL создайте связанный сервер для Oracle, Sybase и т. д. Этот подход требует двух прыжков, но может использоваться как временное решение.  
- Также можно перейти на SQL Server на виртуальной машине Azure.

Дополнительные сведения: [различия связанных серверов в Azure SQL управляемый экземпляр](../../managed-instance/transact-sql-tsql-differences-sql-server.md#linked-servers)

## <a name="merge-job"></a>Задание слияния<a id="MergeJob"></a>

**Title: шаг задания слияния не поддерживается в Управляемый экземпляр Azure SQL.**   
**Категория**: предупреждение   

**Описание**   
Это шаг задания, который активирует агент слияния репликации. Агент слияния репликации — это исполняемый файл программы, который применяет к подписчикам исходный моментальный снимок, содержащийся в таблицах базы данных. Кроме того, он выполняет слияние добавочных изменений данных, которые произошли на издателе после создания исходного моментального снимка, а также улаживает конфликты либо в соответствии с правилами, заданными пользователем, либо с помощью созданного пользователем сопоставителя. Шаг задания слияния не поддерживается в Управляемый экземпляр Azure SQL.


**Рекомендуемые**   
Просмотрите раздел затронутые объекты в службе "миграция Azure", чтобы просмотреть все задания с помощью шага задания слияния и оценить, можно ли удалить шаг задания или затронутый объект. Также можно перейти на SQL Server на виртуальной машине Azure

Дополнительные сведения: [Агент SQL Server различия в Azure SQL управляемый экземпляр ](../../managed-instance/transact-sql-tsql-differences-sql-server.md#sql-server-agent)


## <a name="mi-database-size"></a>Размер базы данных MI<a id="MIDatabaseSize<"></a>

**Title: Управляемый экземпляр Azure SQL не поддерживает размер базы данных больше 8 ТБ.**   
**Категория**: вопрос   

**Описание**   
Размер базы данных превышает максимальное зарезервированное хранилище экземпляра. **Эта база данных не может быть выбрана для миграции, так как ее размер превышает допустимый предел.**


**Рекомендуемые**   
Оцените, можно ли заархивировать данные как сжатые или сегментированные в несколько баз данных. Также можно перейти на SQL Server на виртуальной машине Azure.

Дополнительные сведения: [характеристики создания оборудования для управляемый экземпляр Azure SQL ](../../managed-instance/resource-limits.md#hardware-generation-characteristics)



## <a name="mi-instance-size"></a>Размер экземпляра MI<a id="MIInstanceSize<"></a>

**Title: максимальный размер хранилища экземпляра в Управляемый экземпляр SQL Azure не может превышать 8 ТБ.**   
**Категория**: предупреждение   

**Описание**   
Размер всех баз данных превышает максимальное зарезервированное хранилище экземпляра.  


**Рекомендуемые**   
Рассмотрите возможность переноса баз данных в разные управляемые экземпляры SQL Azure или SQL Server на виртуальной машине Azure, если все базы данных должны существовать в одном и том же экземпляре. 

Дополнительные сведения: [характеристики создания оборудования для управляемый экземпляр Azure SQL ](../../managed-instance/resource-limits.md#hardware-generation-characteristics)


## <a name="multiple-log-files"></a>Несколько файлов журналов<a id="MultipleLogFiles<"></a>

**Title: Управляемый экземпляр Azure SQL не поддерживает несколько файлов журнала.**   
**Категория**: вопрос   

**Описание**   
SQL Server позволяет базе данных регистрироваться в нескольких файлах. Эта база данных содержит несколько файлов журналов, которые не поддерживаются в Управляемый экземпляр Azure SQL. * * Эта база данных не может быть перенесена, так как невозможно восстановить резервную копию в Управляемый экземпляр Azure SQL. 
**

**Рекомендуемые**   
Управляемый экземпляр Azure SQL поддерживает только один журнал для каждой базы данных. Перед переносом этой базы данных в Azure необходимо удалить все файлы журнала, кроме одного. 

```sql
ALTER DATABASE [database_name] REMOVE FILE [log_file_name]
```

Дополнительные сведения: [неподдерживаемые параметры базы данных в Azure SQL управляемый экземпляр  ](../../managed-instance/transact-sql-tsql-differences-sql-server.md#database-options)



## <a name="next-column"></a>Следующий столбец<a id="NextColumn"></a>

**Title: таблицы и столбцы с именем NEXT приведут к ошибке в Управляемый экземпляр Azure SQL.**   
**Категория**: вопрос   

**Описание**   
Обнаружены таблицы или столбцы с именами NEXT. ДЛЯ последовательностей, введенных в Microsoft SQL Server, используется стандартная функция следующего значения ANSI. Если таблица или столбец имеют имя NEXT, а столбец имеет псевдоним VALUE, а также если пропущено ключевое слово AS по стандарту ANSI, то результирующая инструкция может вызвать ошибку.


**Рекомендуемые**   
При создании псевдонима для таблицы или столбца перепишите инструкции, включив ключевое слово AS по стандарту ANSI. Например, если столбец имеет имя NEXT, а этот столбец имеет псевдоним в виде значения, запрос выбор следующего значения из таблицы вызовет ошибку и должен быть перезаписан в качестве SELECT далее в качестве значения в таблице. Аналогичным образом, если таблица имеет имя NEXT и эта таблица имеет псевдоним в виде значения, запрос SELECT col1 of NEXT VALUE вызовет ошибку и должен быть перезаписан в качестве параметра выбор col1 из далее в качестве значения.



## <a name="non-ansi-style-left-outer-join"></a>Левое внешнее соединение в стиле, отличном от ANSI<a id="NonANSILeftOuterJoinSyntax"></a>

**Title: неподдерживаемое левое внешнее соединение в стиле ANSI не поддерживается и было удалено.**   
**Категория**: предупреждение   

**Описание**   
Неподдерживаемое левое внешнее соединение в стиле ANSI прекращено и было удалено в Управляемый экземпляр Azure SQL. 


**Рекомендуемые**   
Использование синтаксиса соединения ANSI.

Дополнительные сведения: [неподдерживаемая функция ядро СУБД в SQL Server](/previous-versions/sql/2014/database-engine/discontinued-database-engine-functionality-in-sql-server-2016#Denali)

## <a name="non-ansi-style-right-outer-join"></a>Правое внешнее соединение в стиле, отличном от ANSI<a id="NonANSIRightOuterJoinSyntax"></a>

**Title: в стиле без ANSI правое внешнее соединение не поддерживается и было удалено.**   
**Категория**: предупреждение   

**Описание**   
Дальнейшее внешнее соединение в стиле, отличном от ANSI, прекращено и было удалено в Управляемый экземпляр Azure SQL. 



Дополнительные сведения: [неподдерживаемая функция ядро СУБД в SQL Server](/previous-versions/sql/2014/database-engine/discontinued-database-engine-functionality-in-sql-server-2016#Denali)

**Рекомендуемые**   
Использование синтаксиса соединения ANSI.

## <a name="databases-exceed-100"></a>Базы данных превышают 100 <a id="NumDbExceeds100"></a>

**Title: Управляемый экземпляр Azure SQL поддерживает не более 100 баз данных на экземпляр.**   
**Категория**: предупреждение   

**Описание**   
Максимальное число баз данных, поддерживаемое в Управляемый экземпляр Azure SQL, составляет 100, если не достигнут предел размера хранилища экземпляра.



**Рекомендуемые**   
Рассмотрите возможность переноса баз данных в разные управляемые экземпляры SQL Azure или SQL Server на виртуальной машине Azure, если все базы данных должны существовать в одном и том же экземпляре. 

Дополнительные сведения: [ограничения ресурсов Azure SQL управляемый экземпляр ](../../managed-instance/resource-limits.md#service-tier-characteristics)

## <a name="openrowset-non-blob-data-source"></a>OPENROWSET (источник данных, отличный от BLOB)<a id="OpenRowsetWithNonBlobDataSourceBulk"></a>

**Title: функция OpenRowSet, используемая в групповой операции с источником данных хранилища BLOB-объектов, отличной от Azure, не поддерживается в Управляемый экземпляр Azure SQL.**   
**Категория**: вопрос   

**Описание**   
Функция OPENROWSET поддерживает групповые операции с помощью встроенного поставщика BULK, который позволяет считывать данные из файла и возвращаться их в виде набора строк. Функция OPENROWSET с источником данных хранилища BLOB-объектов, отличной от Azure, не поддерживается в Управляемый экземпляр Azure SQL. 



**Рекомендуемые**   
Функцию OPENROWSET можно использовать для выполнения запросов только в SQL Server экземплярах (управляемых, локальных или виртуальных машинах). Только значения SQLNCLI, SQLNCLI11 и SQLOLEDB поддерживаются в качестве поставщика. Таким образом, действие рекомендации заключается в том, чтобы определить зависимые базы данных от удаленных серверов, отличных от SQL, и перенести их в переносимую базу данных. Также можно перейти на SQL Server на виртуальной машине Azure

Дополнительные сведения: [различия в инструкции BULK INSERT и OPENROWSET в Azure SQL управляемый экземпляр ](../../managed-instance/transact-sql-tsql-differences-sql-server.md#bulk-insert--openrowset)

## <a name="openrowset-non-sql-provider"></a>OPENROWSET (не поставщик SQL)<a id="OpenRowsetWithNonSQLProvider"></a>

**Title: OpenRowSet с поставщиком, отличным от поставщика SQL, не поддерживается в Управляемый экземпляр Azure SQL.**   
**Категория**: вопрос   

**Описание**   
Это альтернативный метод для доступа к таблицам на связанном сервере и является однократным нерегламентированным методом соединения и удаленного доступа к данным с помощью OLE DB. Функция OpenRowSet с поставщиком, отличной от SQL, не поддерживается в Управляемый экземпляр Azure SQL. 



**Рекомендуемые**   
Функцию OPENROWSET можно использовать для выполнения запросов только в SQL Server экземплярах (управляемых, локальных или виртуальных машинах). Только значения SQLNCLI, SQLNCLI11 и SQLOLEDB поддерживаются в качестве поставщика. Таким образом, действие рекомендации заключается в том, чтобы определить зависимые базы данных от удаленных серверов, отличных от SQL, и перенести их в переносимую базу данных.

Дополнительные сведения: [различия в инструкции BULK INSERT и OPENROWSET в Azure SQL управляемый экземпляр ](../../managed-instance/transact-sql-tsql-differences-sql-server.md#bulk-insert--openrowset)


## <a name="powershell-job"></a>Задание PowerShell<a id="PowerShellJob"></a>

**Title: шаг задания PowerShell не поддерживается в Управляемый экземпляр Azure SQL.**   
**Категория**: предупреждение   

**Описание**   
Это шаг задания, который запускает сценарий PowerShell. Шаг задания PowerShell не поддерживается в Управляемый экземпляр Azure SQL. 



**Рекомендуемые**   
Просмотрите раздел затронутые объекты в службе "миграция Azure", чтобы просмотреть все задания с помощью шага задания PowerShell и оценить, можно ли удалить шаг задания или затронутый объект.  Оцените, можно ли использовать службу автоматизации Azure. Также можно перейти на SQL Server на виртуальной машине Azure

Дополнительные сведения: [Агент SQL Server различия в Azure SQL управляемый экземпляр ](../../managed-instance/transact-sql-tsql-differences-sql-server.md#sql-server-agent)

## <a name="queue-reader-job"></a>Задание чтения очереди<a id="QueueReaderJob"></a>

**Title: шаг задания чтения очереди не поддерживается в Управляемый экземпляр Azure SQL.**   
**Категория**: предупреждение   

**Описание**   
Это шаг задания, который активирует агент чтения очереди репликации. Агент чтения очереди репликации — это исполняемый файл, который считывает сообщения, хранящиеся в очереди Microsoft SQL Server или в очереди сообщений Майкрософт, а затем применяет эти сообщения к издателю. Агент чтения очереди используется совместно с публикациями транзакций и публикациями моментальных снимков, которые допускают обновление посредством очередей. Шаг задания модуля чтения очереди не поддерживается в Управляемый экземпляр Azure SQL.


**Рекомендуемые**   
Просмотрите раздел затронутые объекты в службе "миграция Azure", чтобы просмотреть все задания с помощью шага задания чтения очереди и оценить, можно ли удалить шаг задания или затронутый объект. Также можно перейти на SQL Server на виртуальной машине Azure.

Дополнительные сведения: [Агент SQL Server различия в Azure SQL управляемый экземпляр ](../../managed-instance/transact-sql-tsql-differences-sql-server.md#sql-server-agent)


## <a name="raiserror"></a>RAISERROR<a id="RAISERROR"></a>

**Title: вызовы RAISERROR в устаревшем стиле должны быть заменены современными эквивалентами.**   
**Категория**: предупреждение   

**Описание**   
Вызовы RAISERROR, как в приведенном ниже примере, называются устаревшими, так как они не содержат запятые и круглые скобки. RAISERROR 50001 "это тест". Этот метод вызова инструкции RAISERROR будет прекращен и удален в Управляемый экземпляр Azure SQL.



**Рекомендуемые**   
Перепишите инструкцию, используя текущий синтаксис RAISERROR, или оцените, является ли этот современный подход `BEGIN TRY { }  END TRY BEGIN CATCH {  THROW; } END CATCH` возможным.

Дополнительные сведения: [неподдерживаемая функция ядро СУБД в SQL Server](/previous-versions/sql/2014/database-engine/discontinued-database-engine-functionality-in-sql-server-2016#Denali)

## <a name="service-broker"></a>Компонент Service Broker<a id="ServiceBrokerWithNonLocalAddress"></a>

**Title: Service Broker функция частично поддерживается в Управляемый экземпляр SQL Azure.**   
**Категория**: вопрос   

**Описание**   
SQL Server Service Broker обеспечивает встроенную поддержку приложений для обмена сообщениями и очередей в SQL Server ядро СУБД. В этой базе данных включен межэкземплярный Service Broker, который не поддерживается в Управляемый экземпляр SQL Azure. 


**Рекомендуемые**   
Управляемый экземпляр Azure SQL не поддерживает перекрестные экземпляры компонента Service Broker, т. е. Если адрес не является локальным. Перед миграцией базы данных в Azure необходимо отключить Service Broker с помощью следующей команды: `ALTER DATABASE [database_name] SET DISABLE_BROKER` ; Кроме того, может потребоваться удалить или прерывать конечную точку Service Broker, чтобы предотвратить появление сообщений в экземпляре SQL. После переноса базы данных в Azure вы можете ознакомиться с функциями служебной шины Azure, чтобы реализовать универсальную облачную систему обмена сообщениями вместо Service Broker. Также можно перейти на SQL Server на виртуальной машине Azure. 

Дополнительные сведения: [Service Broker различия в Azure SQL управляемый экземпляр ](../../managed-instance/transact-sql-tsql-differences-sql-server.md#service-broker)

## <a name="sql-mail"></a>Служба SQL Mail<a id="SqlMail"></a>

**Title: прекращена поддержка службы SQL Mail.**   
**Категория**: предупреждение   


**Описание**   
Служба SQL Mail прекращена и удалена в Управляемый экземпляр Azure SQL.



**Рекомендуемые**   
Использование компонента Database Mail.

Дополнительные сведения: [неподдерживаемая функция ядро СУБД в SQL Server](/previous-versions/sql/2014/database-engine/discontinued-database-engine-functionality-in-sql-server-2016#Denali)


## <a name="systemprocedures110"></a>SystemProcedures110<a id="SystemProcedures110"></a>


**Title: обнаружены инструкции, которые ссылаются на удаленные системные хранимые процедуры, недоступные в Управляемый экземпляр Azure SQL.**   
**Категория**: предупреждение   

**Описание**   
Следующие неподдерживаемые системные и расширенные хранимые процедуры нельзя использовать в Azure SQL управляемый экземпляр- `sp_dboption` ,,,, `sp_addserver` `sp_dropalias` `sp_activedirectory_obj` `sp_activedirectory_scp` и `sp_activedirectory_start` . 




**Рекомендуемые**   
Удалите ссылки на неподдерживаемые системные процедуры, которые были удалены в Управляемый экземпляр Azure SQL.

Дополнительные сведения: [неподдерживаемая функция ядро СУБД в SQL Server](/previous-versions/sql/2014/database-engine/discontinued-database-engine-functionality-in-sql-server-2016#Denali)

## <a name="transact-sql-job"></a>Задание Transact-SQL<a id="TransactSqlJob"></a>

**Title: шаг задания TSQL включает неподдерживаемые команды в Azure SQL Управляемый экземпляр**   
**Категория**: предупреждение   


**Описание**   
Это шаг задания, который запускает скрипты TSQL в запланированное время. Шаг задания TSQL включает неподдерживаемые команды, которые не поддерживаются в Управляемый экземпляр Azure SQL.



**Рекомендуемые**   
Просмотрите раздел затронутые объекты в службе "миграция Azure", чтобы просмотреть все задания, включающие неподдерживаемые команды в Azure SQL Управляемый экземпляр и оценить, можно ли удалить шаг задания или затронутый объект. Также можно перейти на SQL Server на виртуальной машине Azure.

Дополнительные сведения: [Агент SQL Server различия в Azure SQL управляемый экземпляр ](../../managed-instance/transact-sql-tsql-differences-sql-server.md#sql-server-agent)


## <a name="trace-flags"></a>Флаги трассировки<a id="TraceFlags"></a>

**Title: не найдены флаги трассировки, поддерживаемые Управляемый экземпляр SQL Azure.**   
**Категория**: предупреждение   


**Описание**   
Управляемый экземпляр Azure SQL поддерживает только ограниченное число глобальных флагов трассировки. Флаги трассировки сеанса не поддерживаются.



**Рекомендуемые**   
Просмотрите раздел затронутые объекты в службе "миграция Azure", чтобы просмотреть все флаги трассировки, которые не поддерживаются в Управляемый экземпляр SQL Azure, и оцените, можно ли их удалить. Также можно перейти на SQL Server на виртуальной машине Azure.

Дополнительные сведения: [Флаги трассировки](/sql/t-sql/database-console-commands/dbcc-traceon-trace-flags-transact-sql#trace-flags)


## <a name="windows-authentication"></a>Проверка подлинности Windows<a id="WindowsAuthentication"></a>

**Title: пользователи базы данных, сопоставленные с проверкой подлинности Windows (встроенная безопасность), не поддерживаются в Управляемый экземпляр SQL Azure.**   
**Категория**: предупреждение   


**Описание**   
Управляемый экземпляр Azure SQL поддерживает два типа проверки подлинности: 
- Проверка подлинности SQL, использующая имя пользователя и пароль
- Проверка подлинности Azure Active Directory с использованием удостоверений, контролируемых Azure Active Directory, которая поддерживается управляемыми и интегрированными доменами. 

Пользователи базы данных, сопоставленные с проверкой подлинности Windows (встроенная безопасность), не поддерживаются в Управляемый экземпляр SQL Azure. 


**Рекомендуемые**   
Федерацию локального Active Directory с Azure Active Directory. Затем удостоверение Windows можно заменить эквивалентными удостоверениями Azure Active Directory. Также можно перейти на SQL Server на виртуальной машине Azure.

Дополнительные сведения: [возможности безопасности SQL управляемый экземпляр](../../database/security-overview.md#authentication)


## <a name="xp_cmdshell"></a>XP_cmdshell<a id="XpCmdshell"></a>

**Title: xp_cmdshell не поддерживается в Управляемый экземпляр SQL Azure.**   
**Категория**: вопрос   


**Описание**   
Xp_cmdshell, который порождает командную оболочку Windows и передает строку для выполнения, не поддерживается в Управляемый экземпляр SQL Azure. 



**Рекомендуемые**   
Просмотрите раздел затронутые объекты в службе "миграция Azure", чтобы просмотреть все объекты, использующие xp_cmdshell, и оцените, можно ли удалить ссылку на xp_cmdshell или затронутый объект. Рассмотрите возможность изучения службы автоматизации Azure, которая предоставляет облачную автоматизацию и службу настройки. Также можно перейти на SQL Server на виртуальной машине Azure.

Дополнительные сведения: [различия хранимых процедур в Azure SQL управляемый экземпляр](../../managed-instance/transact-sql-tsql-differences-sql-server.md#stored-procedures-functions-and-triggers)

## <a name="next-steps"></a>Следующие шаги

Чтобы приступить к переносу SQL Server в Azure SQL Управляемый экземпляр, ознакомьтесь с [руководством по миграции SQL Server в sql управляемый экземпляр](sql-server-to-managed-instance-guide.md).

- Сведения о службах и средствах Майкрософт и сторонних поставщиков, которые помогут вам в использовании различных сценариев переноса баз данных и данных, а также специальных задач см. в разделе [служба и средства для переноса данных](../../../dms/dms-tools-matrix.md).

- Дополнительные сведения о Управляемый экземпляр Azure SQL см. в следующих статьях:
   - [Уровни служб в Azure SQL Управляемый экземпляр](../../managed-instance/sql-managed-instance-paas-overview.md#service-tiers)
   - [Различия между SQL Server и Управляемый экземпляр SQL Azure](../../managed-instance/transact-sql-tsql-differences-sql-server.md)
   - [Калькулятор совокупной стоимости владения Azure](https://azure.microsoft.com/pricing/tco/calculator/) 


- Дополнительные сведения о структуре и цикле внедрения для миграции в облако см. в разделе
   -  [Cloud Adoption Framework для Azure](/azure/cloud-adoption-framework/migrate/azure-best-practices/contoso-migration-scale)
   -  [Рекомендации по затратам и изменению размеров рабочих нагрузок, переносятся в Azure](/azure/cloud-adoption-framework/migrate/azure-best-practices/migrate-best-practices-costs) 

- Чтобы оценить уровень доступа к приложениям, см. раздел [набор средств миграции для доступа к данным (Предварительная версия)](https://marketplace.visualstudio.com/items?itemName=ms-databasemigration.data-access-migration-toolkit)
- Дополнительные сведения о выполнении проверки уровня доступа к данным A/B см. [Database experimentation Assistant](/sql/dea/database-experimentation-assistant-overview).