---
title: Создание Service Fabric кластерной среды в Azure DevTest Labs
description: Узнайте, как создать среду с автономным Service Fabricным кластером, а также запускать и прекращать работу кластера с помощью расписаний.
author: EMaher
ms.topic: article
ms.date: 06/26/2020
ms.author: enewman
ms.openlocfilehash: 530cf3b20820e34913612419d0ffa731a70f6a58
ms.sourcegitcommit: 772eb9c6684dd4864e0ba507945a83e48b8c16f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "85484015"
---
# <a name="create-an-environment-with-self-contained-service-fabric-cluster-in-azure-devtest-labs"></a>Создайте среду с автономным кластером Service Fabric в Azure DevTest Labs
В этой статье содержатся сведения о создании среды с автономным кластером Service Fabric в Azure DevTest Labs. 

## <a name="overview"></a>Обзор
DevTest Labs может создавать автономные тестовые среды, как определено в шаблонах управления ресурсами Azure. Эти среды содержат как ресурсы IaaS, такие как виртуальные машины, так и ресурсы PaaS, например Service Fabric. DevTest Labs позволяет управлять виртуальными машинами в среде, предоставляя команды для управления виртуальными машинами. Эти команды дают возможность запускать или прекращать работу виртуальной машины по расписанию. Аналогично, DevTest Labs также может помочь в управлении кластерами Service Fabric в среде. Вы можете запускать или прекращать Service Fabric кластер в среде вручную или по расписанию.

## <a name="create-a-service-fabric-cluster"></a>Создание кластера Service Fabric
Service Fabric кластеры создаются с помощью сред в DevTest Labs. Каждая среда определяется шаблоном Azure Resource Manager в репозитории Git. [Общедоступный репозиторий Git](https://github.com/Azure/azure-devtestlab/tree/master/Environments/) для DevTest Labs содержит шаблон диспетчер ресурсов для создания кластера Service Fabric в папке [ServiceFabric-Cluster](https://github.com/Azure/azure-devtestlab/tree/master/Environments/ServiceFabric-LabCluster) . 

1. Сначала создайте лабораторию в Azure DevTest Labs с помощью инструкций, приведенных в следующей статье: [Создание лаборатории](devtest-lab-create-lab.md). Обратите внимание, что параметр **общедоступные среды** **включен по** умолчанию. 
2. Убедитесь, что поставщик Service Fabric зарегистрирован для вашей подписки, выполнив следующие действия.
    1. Выберите **подписки** в меню навигации слева и выберите свою **подписку** .
    2. На странице **Подписка** выберите **поставщики ресурсов** в разделе **Параметры** в меню слева. 
    3. Если **Microsoft. сервиекфабрик** не зарегистрирована, выберите **зарегистрировать**. 
3. На странице **DevTest Lab** созданной лаборатории выберите **+ Добавить** на панели инструментов. 
    
    ![Кнопка "Добавить" на панели инструментов](./media/create-environment-service-fabric-cluster/add-button.png)
3. На странице **Выбор базы** выберите **Service Fabric лабораторный кластер** в списке. 

    ![Выберите Service Fabric лабораторный кластер в списке.](./media/create-environment-service-fabric-cluster/select-service-fabric-cluster.png)
4. На странице **Настройка параметров** выполните следующие действия. 
    1. Укажите **имя** для **среды** кластера. Это имя группы ресурсов в Azure, в которой будет создан кластер Service Fabric. 
    2. Выберите **операционную систему (ОС)** для виртуальных машин кластера. Значение по умолчанию: **Windows**.
    3. Укажите имя **администратора** для кластера. 
    4. Укажите **пароль** для администратора. 
    5. Для **сертификата** введите сведения о сертификате в виде строки в кодировке Base64. Чтобы создать сертификат, выполните следующие действия.
        1. Скачайте файл **Create-ClusterCertificate.ps1** из [репозитория Git](https://github.com/Azure/azure-devtestlab/tree/master/Environments/ServiceFabric-LabCluster). Кроме того, можно клонировать репозиторий на компьютере. 
        2. Запустите **PowerShell**. 
        3. Запустите файл **PS1** с помощью команды `.\Create-ClusterCertificate.ps1` . Появится текстовый файл, Открытый в блокноте, с информацией, необходимой для заполнения полей, связанных с сертификатом, на этой странице. . 
    6. Введите **пароль для сертификата**.
    7. Укажите **отпечаток** для сертификата.
    8. На странице **Настройка параметров** нажмите кнопку **Добавить** . 

        ![Настройка параметров кластера](./media/create-environment-service-fabric-cluster/configure-settings.png)
5. После создания кластера вы увидите группу ресурсов с именем среды, которую вы указали на предыдущем шаге. При развертывании в нем отображается Service Fabric кластер. Если состояние группы ресурсов зависает при **создании**, выберите **Обновить** на панели инструментов. **Service Fabric кластерная** среда создает кластер с 5 узлами 1 до узла в Linux или Windows.

    В следующем примере **мисфабрикклустеррг** — это имя группы ресурсов, созданной специально для кластера Service Fabric. Важно отметить, что лабораторные среды являются самодостаточными в группе ресурсов, в которой они создаются. Это означает, что шаблон, определяющий среду, может обращаться только к ресурсам в только что созданной группе ресурсов или [виртуальных сетях, настроенных для использования в лаборатории](devtest-lab-configure-vnet.md). В этом примере создаются все необходимые ресурсы в одной группе ресурсов.

    ![Кластер создан](./media/create-environment-service-fabric-cluster/cluster-created.png)

## <a name="start-or-stop-the-cluster"></a>Запуск или завершение работы кластера
Вы можете запускать или прекращать работу кластера либо на странице DevTest Lab, либо на странице кластера Service Fabric, предоставляемой DevTest Labs. 

### <a name="from-the-devtest-lab-page"></a>На странице лаборатории DevTest
Вы можете запустить или закрыть кластер на странице лаборатории DevTest для своей лаборатории. 

1. Выберите **три точки (...)** для кластера Service Fabric, как показано на следующем рисунке: 

    ![Запуск и завершение команд для кластера](./media/create-environment-service-fabric-cluster/start-stop-on-devtest-lab-page.png)

2. В контекстном меню вы увидите две команды для **запуска** и **завершения** работы кластера. Команда Start запускает все узлы в кластере. Команда Stop останавливает все узлы в кластере. После остановки кластера сам кластер Service Fabric остается в состоянии готовности, но узлы не будут доступны до тех пор, пока команда запуска не будет вызвана в кластере в лаборатории.

    При использовании кластера Service Fabric в тестовой среде необходимо учитывать некоторые моменты. После перезапуска узлов может потребоваться некоторое время на полное восстановление кластера Service Fabric. Чтобы сохранить данные от завершения работы до запуска, необходимо сохранить данные на управляемом диске, подключенном к виртуальной машине. Использование подключенного управляемого диска влияет на производительность, поэтому рекомендуется только для тестовых сред. Если диск, используемый для хранения данных, не является резервным, данные теряются, когда в кластере выдается команда "закончить".

### <a name="from-the-service-fabric-cluster-page"></a>На странице кластера Service Fabric 
Существует другой способ запуска или завершения работы кластера. 

1. Выберите Service Fabric кластер в представлении в виде дерева на странице лаборатории DevTest. 

    ![Выбор кластера](./media/create-environment-service-fabric-cluster/select-cluster.png)

2. На странице **кластера Service Fabric** кластере на панели инструментов отображаются команды для запуска или завершения работы кластера. 

    ![Запуск и завершение команд на странице кластера Service Fabric](./media/create-environment-service-fabric-cluster/start-stop-on-cluster-page.png)

## <a name="configure-auto-startup-and-auto-shutdown-schedule"></a>Настройка автоматического запуска и расписания автоматического завершения работы
Service Fabric кластеры можно запускать или останавливать по расписанию. Эта процедура похожа на работу виртуальных машин в лаборатории. Для экономии денег по умолчанию каждый кластер, созданный в лаборатории, автоматически завершает работу в момент, определенный [политикой завершения работы](devtest-lab-set-lab-policy.md?#set-auto-shutdown-policy)лаборатории. Можно переопределить, указав, следует ли завершить работу кластера или указать время завершения работы кластера. 

![Существующие расписания для автоматического запуска и автоматического завершения работы](./media/create-environment-service-fabric-cluster/existing-schedules.png)

### <a name="opt-in-to-the-auto-start-schedule"></a>Согласие на автоматическое расписание запуска
Чтобы принять участие в расписании запуска, выполните следующие действия.

1. В меню слева выберите **Автоматический запуск** .
2. Выберите **вкл** . **, чтобы разрешить запуск этого кластера Service Fabric для автоматического запуска**. Эта страница доступна только в том случае, если владелец лаборатории разрешил пользователям выполнять автозагрузку виртуальных машин или кластеров Service Fabric.
3. На панели инструментов щелкните **Сохранить**. 

    ![Автоматическая страница звезды](./media/create-environment-service-fabric-cluster/set-auto-start-settings.png)

### <a name="configure-auto-shutdown-settings"></a>Настройка параметров автоматического завершения работы 
Чтобы изменить параметры завершения работы, выполните следующие действия.

1. В меню слева выберите **Автоматическое завершение работы** . 
2. На этой странице можно отказаться от автоматического завершения работы, выбрав параметр **отключено** для параметра **включено**. 
3. Если **выбрано** значение **включено**, выполните следующие действия.
    1. Укажите **время** завершения работы.
    2. Укажите **Часовой пояс** для времени. 
    3. Укажите, следует ли DevTest Labs отправлять **уведомления** до автоматического завершения работы. 
    4. Если для параметра уведомление выбрано **значение Да** , то для отправки уведомлений укажите **URL-адрес** и (или) **адрес электронной почты** . 
    5. На панели инструментов щелкните **Сохранить**.

        ![Автоматическое завершение работы страницы](./media/create-environment-service-fabric-cluster/auto-shutdown-settings.png)

## <a name="to-view-nodes-in-the-service-fabric-cluster"></a>Просмотр узлов в кластере Service Fabric
Страница кластера Service Fabric, показанная в предыдущих шагах, относится к странице DevTest Labs. В нем не отображаются узлы в кластере. Чтобы просмотреть дополнительные сведения о кластере, выполните следующие действия.

1. На странице **лаборатории DevTest** для своей лаборатории выберите **группу ресурсов** в представлении в виде дерева в разделе **мои виртуальные машины** .

    ![Выбор группы ресурсов](./media/create-environment-service-fabric-cluster/select-resource-group.png)
2. На странице **Группа ресурсов** отображаются все ресурсы в группе ресурсов в списке. Выберите **кластер Service Fabric** из списка. 

    ![Выберите кластер в списке.](./media/create-environment-service-fabric-cluster/select-cluster-resource-group-page.png)
3. Отобразится страница **кластера Service Fabric** кластера. Это страница, которую предоставляет Service Fabric. Вы увидите все сведения о кластерах, таких как узлы, типы узлов и т. д.

    ![Домашняя страница кластера Service Fabric](./media/create-environment-service-fabric-cluster/service-fabric-cluster-page.png)

## <a name="next-steps"></a>Дальнейшие действия
Дополнительные сведения о средах см. в следующих статьях: 

- [Создание сред со множеством виртуальных машин и ресурсов PaaS с помощью шаблонов Azure Resource Manager](devtest-lab-create-environment-from-arm.md)
- [Настройка и использование общедоступных сред в Azure DevTest Labs](devtest-lab-configure-use-public-environments.md)
