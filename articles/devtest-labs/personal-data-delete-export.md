---
title: Удаление и экспорт персональных данных из Azure DevTest Labs
description: Сведения об удалении и экспорте персональных данных из службы Azure DevLast Labs для выполнения всех обязанностей, установленных Общим регламентом по защите данных (GDPR).
ms.topic: article
ms.date: 06/26/2020
ms.openlocfilehash: 2c44b2f3aa6f2dfad18ed53804842a5dad8bd94a
ms.sourcegitcommit: 772eb9c6684dd4864e0ba507945a83e48b8c16f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "85483522"
---
# <a name="export-or-delete-personal-data-from-azure-devtest-labs"></a>Экспорт или удаление персональных данных из Azure DevTest Labs
В этой статье описываются действия по удалению и экспорту персональных данных из службы Azure DevTest Labs. 

## <a name="what-personal-data-does-devtest-labs-collect"></a>Какие личные данные собирает DevTest Labs?
DevTest Labs собирает два основных фрагмента персональных данных пользователя. К ним относится: адрес электронной почты пользователя и идентификатор объекта пользователя. Эта информация является критически важной для предоставления возможностей службы администраторам и пользователям лаборатории.

### <a name="user-email-address"></a>Адрес электронной почты пользователя
DevTest Labs использует адрес электронной почты пользователя для отправки пользователям лаборатории уведомлений по электронной почте об автоматическом завершении работы. На электронную почту пользователей приходит уведомление о завершении работы их компьютера. Пользователи могут при желании отложить или пропустить завершение работы. Адрес электронной почты настраивается на уровне лаборатории или на уровне виртуальной машины.

**Задание электронной почты в лаборатории:**

![Задание электронной почты на уровне лаборатории](./media/personal-data-delete-export/lab-user-email.png)

**Задание электронной почты на виртуальной машине:**

![Задание электронной почты на уровне виртуальной машины](./media/personal-data-delete-export/vm-user-email.png)

### <a name="user-object-id"></a>Идентификатор объекта пользователя
С помощью идентификатора объекта пользователя DevTest Labs отображает тенденции затрат по месяцам и затрат по ресурсам для администраторов лаборатории. Это позволяет отслеживать затраты и управлять пороговыми значениями для их лаборатории. 

**Тенденция предполагаемой стоимости за текущий календарный месяц:** 
 ![ Тренд оценки затрат за текущий календарный месяц](./media/personal-data-delete-export/estimated-cost-trend-per-month.png)

**Предполагаемая стоимость по ресурсам за месяц:** 
 ![ Предполагаемая стоимость по ресурсам с начала месяца](./media/personal-data-delete-export/estimated-month-to-date-cost-by-resource.png)


## <a name="why-do-we-need-this-personal-data"></a>Зачем нужны персональные данные?
Служба DevTest Labs использует персональные данные в оперативных целях. Эти данные являются критически важными для того, чтобы служба предоставляла основные возможности. Если для адреса электронной почты пользователя задать политику хранения, пользователи лаборатории не будут своевременно получать уведомления об автоматическом завершении работы по электронной почте после того, как их адрес электронной почты будет удален из нашей системы. Аналогичным образом администратор лаборатории не может просматривать тенденции затрат по месяцам и затрат по ресурсам для компьютеров в их лабораториях, если идентификаторы объектов пользователей удалены в соответствии с политикой хранения. Таким образом, эти данные необходимо хранить до тех пор, пока ресурс пользователя активен в лаборатории.

## <a name="how-can-i-have-the-system-to-forget-my-personal-data"></a>Что необходимо сделать, чтобы система не сохраняла мои персональные данные?
Если вы, как пользователь лаборатории, хотите удалить эти персональные данные, это можно сделать, удалив соответствующий ресурс в лаборатории. Служба DevTest Labs анонимизирует удаленные персональные данные через 30 дней после удаления пользователем.

Например, если вы удалите виртуальную машину или адрес своей электронной почты, служба DevTest Labs анонимизирует эти данные через 30 дней после удаления ресурса. 30-дневная политика хранения после удаления необходима для предоставления администратору лаборатории точных данных о прогнозируемой стоимости по месяцам.

## <a name="how-can-i-request-an-export-on-my-personal-data"></a>Как запросить экспорт персональных данных?
Вы можете экспортировать данные личного и лабораторного использования с помощью портал Azure или PowerShell. Данные экспортируются как два разных CSV-файла:

- **disks.csv** — содержит сведения о дисках, используемых различными виртуальными машинами.
- **virtualmachines.csv** — содержит сведения о виртуальных машинах в лаборатории.

### <a name="azure-portal"></a>Портал Azure
Как пользователь лаборатории, вы можете запросить экспорт персональных данных, которые хранятся в службе DevTest Labs. Чтобы запросить экспорт, перейдите к параметру **Персональные данные** на странице **Обзор** лаборатории. Нажмите кнопку **Запрос экспорта**, в результате чего в учетной записи хранения администратора лаборатории будет создан скачиваемый файл Excel. Затем обратитесь к администратору лаборатории, чтобы просмотреть эти данные.

1. Выберите **Персональные данные** в меню слева. 

    ![Страница "Персональные данные"](./media/personal-data-delete-export/personal-data-page.png)
2. Выберите **группу ресурсов**, в которой содержится лаборатория.

    ![Выбор группы ресурсов](./media/personal-data-delete-export/select-resource-group.png)
3. В группе ресурсов выберите **учетную запись хранения**.
4. На странице **Учетная запись хранения** выберите **Большие двоичные объекты**.

    ![Выбор плитки "Большие двоичные объекты"](./media/personal-data-delete-export/select-blobs-tile.png)
5. Выберите контейнер с именем **labresourceusage** в списке контейнеров.

    ![Выбор контейнера больших двоичных объектов](./media/personal-data-delete-export/select-blob-container.png)
6. Выберите **папку** с именем лаборатории. В этой папке вы найдете файлы **CSV** для **дисков** и **виртуальных машин** в лаборатории. Вы можете скачать эти CSV-файлы, отфильтровать содержимое для пользователя лаборатории, запрашивающего доступ, и предоставить его ему.

    ![Скачивание CSV-файла](./media/personal-data-delete-export/download-csv-file.png)

### <a name="azure-powershell"></a>Azure PowerShell

```powershell
Param (
    [Parameter (Mandatory=$true, HelpMessage="The storage account name where to store usage data")]
    [string] $storageAccountName,

    [Parameter (Mandatory=$true, HelpMessage="The storage account key")]
    [string] $storageKey,

    [Parameter (Mandatory=$true, HelpMessage="The DevTest Lab name to get usage data from")]
    [string] $labName,

    [Parameter (Mandatory=$true, HelpMessage="The DevTest Lab subscription")]
    [string] $labSubscription
    )

#Login
Login-AzureRmAccount

# Set the subscription for the lab
Get-AzureRmSubscription -SubscriptionId $labSubscription  | Select-AzureRmSubscription

# DTL will create this container in the storage when invoking the action, cannot be changed currently
$containerName = "labresourceusage"

# Get the storage context
$Ctx = New-AzureStorageContext -StorageAccountName $storageAccountName -StorageAccountKey $storageKey 
$SasToken = New-AzureStorageAccountSASToken -Service Blob, File -ResourceType Container, Service, Object -Permission rwdlacup -Protocol HttpsOnly -Context $Ctx

# Generate the storage blob uri
$blobUri = $Ctx.BlobEndPoint + $SasToken

# blobStorageAbsoluteSasUri and usageStartDate are required
$actionParameters = @{
    'blobStorageAbsoluteSasUri' = $blobUri    
}

$startdate = (Get-Date).AddDays(-7)

$actionParameters.Add('usageStartDate', $startdate.Date.ToString())

# Get the lab resource group
$resourceGroupName = (Find-AzureRmResource -ResourceType 'Microsoft.DevTestLab/labs' | Where-Object { $_.Name -eq $labName}).ResourceGroupName
    
# Create the lab resource id
$resourceId = "/subscriptions/" + $labSubscription + "/resourceGroups/" + $resourceGroupName + "/providers/Microsoft.DevTestLab/labs/" + $labName + "/"

# !!!!!!! this is the new resource action to get the usage data.
$result = Invoke-AzureRmResourceAction -Action 'exportLabResourceUsage' -ResourceId $resourceId -Parameters $actionParameters -Force
 
# Finish up cleanly
if ($result.Status -eq "Succeeded") {
    Write-Output "Telemetry successfully downloaded for " $labName
    return 0
}
else
{
    Write-Output "Failed to download lab: " + $labName
    Write-Error $result.toString()
    return -1
}
```

Ниже приведены ключевые компоненты в приведенном выше примере.

- Команда Invoke-AzureRmResourceAction.
   
    ```
    Invoke-AzureRmResourceAction -Action 'exportLabResourceUsage' -ResourceId $resourceId -Parameters $actionParameters -Force
    ```
- Два параметра действия
    - **блобсторажеабсолутесасури** — универсальный код ресурса (URI) учетной записи хранения с маркером подписанного URL-адрес (SAS). В сценарии PowerShell это значение может быть передано вместо ключа хранилища.
    - **усажестартдате** — Начальная дата для извлечения данных с датой окончания, которая является текущей датой выполнения действия. Гранулярность находится на уровне дня, поэтому даже при добавлении сведений о времени она будет пропущена.

### <a name="exported-data---a-closer-look"></a>Экспортированные данные — более подробное представление
Теперь давайте более подробно рассмотрим экспортированные данные. Как упоминалось ранее, после успешного экспорта данных будет два CSV-файла. 

**virtualmachines.csv** содержит следующие столбцы данных:

| Имя столбца | Описание |
| ----------- | ----------- | 
| SubscriptionId | Идентификатор подписки, в которой находится лаборатория. |
| лабуид | Уникальный идентификатор GUID для лаборатории. |
| лабнаме | Имя лаборатории. |
| лабресаурцеид | Полный идентификатор ресурса лаборатории. |
| ResourceGroupName | Имя группы ресурсов, содержащей виртуальную машину | 
| ResourceId | Полный идентификатор ресурса для виртуальной машины. |
| ресаурцеуид | Идентификатор GUID для виртуальной машины |
| Имя | Имя виртуальной машины. |
| CreatedTime | Дата и время создания виртуальной машины. |
| DeletedDate | Дата и время удаления виртуальной машины. Если она пуста, то удаление еще не выполнялось. |
| ресаурцеовнер | Владелец виртуальной машины. Если значение пустое, то это либо запрашиваемая виртуальная машина, либо созданная субъектом-службой. |
| приЦингтиер | Ценовая категория виртуальной машины |
| ресаурцестатус | Состояние доступности виртуальной машины. Активна, если виртуальная машина удалена, если она еще существует или неактивна. |
| компутересаурцеид | Полный идентификатор расчетного ресурса виртуальной машины. |
| Запрашиваемой | Задайте значение true, если ВИРТУАЛЬная машина является запрашиваемой виртуальной машиной | 
| Идентификатора среды | Идентификатор ресурса среды, в котором была создана виртуальная машина. Она пуста, если виртуальная машина не была создана как часть ресурса среды. |
| ExpirationDate | Срок действия виртуальной машины. Он имеет значение Empty, если дата окончания срока действия не была задана.
| галлеримажереференцеверсион |  Версия базового образа виртуальной машины. |
| галлеримажереференцеоффер | Предложение базового образа виртуальной машины. |
| галлеримажереференцепублишер | Издатель базового образа виртуальной машины. |
| галлеримажереференцеску | Номер SKU базового образа виртуальной машины |
| галлеримажереференцеостипе | Тип ОС базового образа виртуальной машины |
| кустомимажеид | Полный идентификатор базового пользовательского образа виртуальной машины. |

Столбцы данных, содержащиеся в **disks.csv** , перечислены ниже:

| Имя столбца | Описание | 
| ----------- | ----------- | 
| SubscriptionId | Идентификатор подписки, содержащей лабораторию |
| лабуид | GUID лаборатории |
| лабнаме | Имя лаборатории | 
| лабресаурцеид | Полный идентификатор ресурса для лаборатории | 
| ResourceGroupName | Имя группы ресурсов, содержащей лабораторию | 
| ResourceId | Полный идентификатор ресурса для виртуальной машины. |
| ресаурцеуид | Идентификатор GUID для виртуальной машины |
 |Имя | Имя подключенного диска |
| CreatedTime |Дата и время создания диска данных. |
| DeletedDate | Дата и время удаления диска данных. |
| ресаурцестатус | Состояние ресурса. Активен, если ресурс существует. Неактивное, при удалении. |
| дискблобнаме | Имя большого двоичного объекта для диска данных. |
| дисксизегб | Размер диска данных. |
| DiskType | Тип диска данных. 0 для уровня "Стандартный", 1 — "Премиум". |
| леаседбивмид | Идентификатор ресурса виртуальной машины, к которой подключен диск данных. |


> [!NOTE]
> Если вы работаете с несколькими лабораториями и хотите получить общую информацию, два ключевых столбца — это **лабуид** и **ресаурцеуид**, которые являются уникальными идентификаторами в подписках.

Экспортированные данные можно манипулировать и наглядно использовать с помощью таких средств, как SQL Server, Power BI и т. д. Эта функция особенно полезна, если вы хотите сообщить об использовании лабораторной работы группе управления, которая может не использовать ту же подписку Azure, что и вы.

## <a name="next-steps"></a>Дальнейшие действия
См. следующие статьи: 

- [Управление базовыми политиками лаборатории в Azure DevTest Labs](devtest-lab-set-lab-policy.md)
- [Часто задаваемые вопросы по Аналитике компьютеров](devtest-lab-faq.md)
