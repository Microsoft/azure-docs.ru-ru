---
title: Шифрование дисков ОС с помощью управляемых клиентом ключей в Azure DevTest Labs
description: Узнайте, как шифровать диски операционной системы (ОС) с помощью управляемых клиентом ключей в Azure DevTest Labs.
ms.topic: article
ms.date: 09/01/2020
ms.openlocfilehash: 26ef4ff1529483da9956c6dcc43807af0ffd6463
ms.sourcegitcommit: 910a1a38711966cb171050db245fc3b22abc8c5f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "96341218"
---
# <a name="encrypt-operating-system-os-disks-using-customer-managed-keys-in-azure-devtest-labs"></a>Шифрование дисков операционной системы (ОС) с помощью управляемых клиентом ключей в Azure DevTest Labs
Шифрование на стороне сервера (SSE) защищает данные и помогает соблюсти корпоративные обязательства по обеспечению безопасности и соответствия. SSE автоматически шифрует данные, хранящиеся на управляемых дисках в Azure (дисках ОС и данных), по умолчанию при сохранении в облаке. Дополнительные сведения о [шифровании дисков](../virtual-machines/disk-encryption.md) в Azure. 

В рамках DevTest Labs все диски ОС и диски данных, созданные как часть лаборатории, шифруются с помощью ключей, управляемых платформой. Однако в качестве владельца лаборатории можно использовать собственные ключи для шифрования дисков ОС виртуальных машин лаборатории. Если вы решили управлять шифрованием с помощью собственных ключей, можно указать ключ, **управляемый клиентом** , который будет использоваться для шифрования данных на дисках ОС лаборатории. Дополнительные сведения о шифровании на стороне сервера (SSE) с ключами, управляемыми клиентом, и других типах шифрования управляемых дисков см. в разделе [управляемые клиентом ключи](../virtual-machines/disk-encryption.md#customer-managed-keys). См. также [раздел ограничения с помощью ключей, управляемых клиентом](../virtual-machines/disks-enable-customer-managed-keys-portal.md#restrictions).

> [!NOTE]
> - В настоящее время шифрование дисков с помощью управляемого клиентом ключа поддерживается только для дисков ОС в DevTest Labs. 
> 
> - Этот параметр применяется ко вновь созданным дискам ОС в лаборатории. Если вы решили изменить набор шифрования диска в некоторый момент, старые диски в лаборатории останутся зашифрованными с использованием предыдущего набора шифрования диска. 

В следующем разделе показано, как владелец лаборатории может настроить шифрование с помощью управляемого клиентом ключа.

## <a name="pre-requisites"></a>Предварительные требования

1. Если у вас нет набора шифрования дисков, следуйте указаниям в этой статье, чтобы [настроить Key Vault и набор шифрования дисков](../virtual-machines/disks-enable-customer-managed-keys-portal.md). Обратите внимание на следующие требования к набору шифрования дисков: 

    - Набор шифрования дисков должен находиться **в том же регионе и подписке, что и ваша лаборатория**. 
    - Убедитесь, что у вас (владелец лаборатории) есть по крайней мере **доступ на уровне чтения** к набору шифрования диска, который будет использоваться для шифрования дисков ОС лаборатории. 
1. Для лабораторий, созданных до 8/1/2020, владельцу лаборатории необходимо включить удостоверение, назначенное системой лаборатории. Чтобы сделать это, владелец лаборатории может перейти в свою лабораторию, щелкнуть " **Конфигурация и политики**", выбрать колонку **удостоверение (Предварительная версия)** , изменить значение **состояния** "назначено системой" **на "включено** " и нажать кнопку " **сохранить**". Для новых лабораторных занятий, созданных после того, как система по назначению удостоверений в лаборатории 8/1/2020 будет включена по умолчанию. 

    > [!div class="mx-imgBorder"]
    > :::image type="content" source="./media/encrypt-disks-customer-managed-keys/managed-keys.png" alt-text="Управляемые ключи":::
1. Чтобы Лаборатория обрабатывала шифрование для всех дисков ОС лаборатории, владелец лаборатории должен явным образом предоставить **назначенную системой роль читателя удостоверений** на наборе шифрования диска, а также роль участника виртуальной машины в базовой подписке Azure. Владелец лаборатории может сделать это, выполнив следующие действия.

   
    1. Убедитесь, что вы являетесь членом [роли администратора доступа пользователей](../role-based-access-control/built-in-roles.md#user-access-administrator) на уровне подписки Azure, чтобы вы могли управлять доступом пользователей к ресурсам Azure. 
    1. На странице **набор шифрования дисков** выберите **Управление доступом (IAM)** в меню слева. 
    1. Выберите **+ Добавить** на панели инструментов и щелкните **добавить назначение роли**.  

        :::image type="content" source="./media/encrypt-disks-customer-managed-keys/add-role-management-menu.png" alt-text="Добавление управления ролями — меню":::
    1. На странице **Добавление назначения ролей** выберите роль **читатель** или роль, которая обеспечивает дополнительный доступ. 
    1. Введите имя лаборатории, для которой будет использоваться набор шифрования дисков, и выберите имя лаборатории (удостоверение, назначенное системой для лаборатории) из раскрывающегося списка. 
    
        :::image type="content" source="./media/encrypt-disks-customer-managed-keys/select-lab.png" alt-text="Выбор управляемого системой удостоверения лаборатории":::        
    1. На панели инструментов щелкните **Сохранить**. 

        :::image type="content" source="./media/encrypt-disks-customer-managed-keys/save-role-assignment.png" alt-text="Сохранить назначение ролей":::
3. Добавьте в роль **участника виртуальной машины** **удостоверение, назначенное системой** лаборатории, с помощью страницы   ->  **управления доступом к подпискам (IAM)** . Шаги аналогичны описанным в предыдущих шагах. 

    
    1. Перейдите на страницу **подписки** в портал Azure. 
    1. Выберите **Управление доступом (IAM)** . 
    1. Выберите **+ Добавить** на панели инструментов и щелкните **добавить назначение роли**. 
    
        :::image type="content" source="./media/encrypt-disks-customer-managed-keys/subscription-access-control-page.png" alt-text="Подписка — страница управления доступом > (IAM)":::
    1. На странице **Добавление назначения ролей** выберите **участника виртуальной машины** для роли.
    1. Введите имя лаборатории и выберите **имя лаборатории** (удостоверение, назначенное системой для лаборатории) из раскрывающегося списка. 
    1. На панели инструментов щелкните **Сохранить**. 

## <a name="encrypt-lab-os-disks-with-a-customer-managed-key"></a>Шифрование дисков ОС лаборатории с помощью управляемого клиентом ключа 

1. На домашней странице лаборатории в портал Azure выберите **Конфигурация и политики** в меню слева. 
1. На странице **Конфигурация и политики** в разделе **Шифрование** выберите **диски (Предварительная версия)** . По умолчанию для параметра **тип шифрования** задано значение **Шифрование неактивных данных с управляемым платформой ключом**.

    :::image type="content" source="./media/encrypt-disks-customer-managed-keys/disks-page.png" alt-text="Вкладка &quot;диски&quot; страницы &quot;Конфигурация и политики&quot;":::
1. В качестве **типа шифрования** выберите **Шифрование неактивных с помощью управляемого клиентом ключа** из раскрывающегося списка. 
1. Для параметра **Шифрование диска** выберите созданный ранее набор шифрования дисков. Это тот же набор шифрования диска, к которому может получить доступ, назначенный системой удостоверением лаборатории.
1. На панели инструментов щелкните **Сохранить**. 

    :::image type="content" source="./media/encrypt-disks-customer-managed-keys/disk-encryption-set.png" alt-text="Включение шифрования с помощью ключа, управляемого клиентом":::
1. В окне сообщения со следующим текстом: *этот параметр будет применяться к вновь созданным компьютерам в лаборатории. Старый диск ОС останется зашифрованным со старым набором шифрования диска*, нажмите кнопку **ОК**. 

    После настройки диски ОС лаборатории будут зашифрованы с помощью управляемого клиентом ключа, предоставленного с использованием набора шифрования дисков. 
   
## <a name="how-to-validate-if-disks-are-being-encrypted"></a>Проверка шифрования дисков

1. Перейдите к виртуальной машине лаборатории, созданной после включения шифрования дисков с помощью управляемого клиентом ключа в лаборатории.

    > [!div class="mx-imgBorder"]
    > :::image type="content" source="./media/encrypt-disks-customer-managed-keys/enabled-encryption-vm.png" alt-text="Виртуальная машина с включенным шифрованием дисков":::
1. Щелкните группу ресурсов виртуальной машины и щелкните диск операционной системы.

    > [!div class="mx-imgBorder"]
    > :::image type="content" source="./media/encrypt-disks-customer-managed-keys/vm-resource-group.png" alt-text="Группа ресурсов виртуальной машины":::
1. Перейдите к разделу шифрование и проверьте, задано ли для шифрования ключ, управляемый клиентом, с выбранным набором шифрования дисков.

    > [!div class="mx-imgBorder"]
    > :::image type="content" source="./media/encrypt-disks-customer-managed-keys/validate-encryption.png" alt-text="Проверка шифрования":::
  
## <a name="next-steps"></a>Дальнейшие действия

См. следующие статьи: 

- [Шифрование дисков Azure](../virtual-machines/disk-encryption.md). 
- [Ключи, управляемые клиентом](../virtual-machines/disk-encryption.md#customer-managed-keys)