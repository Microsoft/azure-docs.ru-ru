---
title: Корпоративная Эталонная архитектура для Azure DevTest Labs
description: В этой статье приводятся справочные сведения по архитектуре Azure DevTest Labs на предприятии.
ms.topic: article
ms.date: 06/26/2020
ms.reviewer: christianreddington,anthdela,juselph
ms.openlocfilehash: 29f739c2fb9dd1cc58bf6c400eeee1bebb6243c2
ms.sourcegitcommit: 910a1a38711966cb171050db245fc3b22abc8c5f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "92328850"
---
# <a name="azure-devtest-labs-reference-architecture-for-enterprises"></a>Azure DevTest Labs эталонной архитектурой для предприятий
Эта статья содержит справочную архитектуру, помогающую развернуть решение на основе Azure DevTest Labs на предприятии. Он включает в себя следующее:
- Локальное подключение через Azure ExpressRoute
- Шлюз удаленных рабочих столов для удаленного входа на виртуальные машины
- Подключение к репозиторию артефактов для частных артефактов
- Другие службы PaaS, используемые в лабораториях

![Схема эталонной архитектуры](./media/devtest-lab-reference-architecture/reference-architecture.png)

## <a name="architecture"></a>Архитектура
Это ключевые элементы эталонной архитектуры:

- **Azure Active Directory (Azure AD)**. DevTest Labs использует [службу Azure AD для управления удостоверениями](../active-directory/fundamentals/active-directory-whatis.md). При предоставлении пользователям доступа к среде, основанной на DevTest Labs, учитывайте следующие два ключевых аспекта:
    - **Управление ресурсами**: обеспечивает доступ к портал Azure для управления ресурсами (создание виртуальных машин, создание сред, запуск, завершение, перезапуск, удаление и применение артефактов) и т. д. Управление ресурсами осуществляется с помощью управления доступом на основе ролей Azure (Azure RBAC). Вы назначаете роли пользователям и устанавливаете разрешения на доступ к ресурсам и уровням доступа.
    - **Виртуальные машины (уровень сети)**. в конфигурации по умолчанию виртуальные машины используют учетную запись локального администратора. Если доступен домен ([доменные службы Azure AD](../active-directory-domain-services/overview.md), локальный домен или облачный домен), компьютеры могут быть присоединены к домену. Пользователи могут использовать свои удостоверения на основе домена для подключения к виртуальным машинам.
- **Локальное подключение**. в схеме архитектуры используется [ExpressRoute](../expressroute/expressroute-introduction.md) . Но вы также можете использовать [VPN типа "сеть — сеть](../vpn-gateway/vpn-gateway-about-vpn-gateway-settings.md)". Хотя ExpressRoute не требуется для DevTest Labs, он обычно используется на предприятиях. ExpressRoute требуется только в том случае, если необходим доступ к корпоративным ресурсам. Распространенные сценарии:
    - У вас есть локальные данные, которые не могут быть перемещены в облако.
    - Вы предпочитаете присоединить виртуальные машины лаборатории к локальному домену.
    - Необходимо принудительно включить весь сетевой трафик в облачной среде и из нее через локальный брандмауэр для обеспечения безопасности и соответствия требованиям.
- **Группы безопасности сети**. распространенный способ ограничения трафика в облачную среду (или в облачной среде) на основе IP-адресов источника и назначения заключается в использовании [группы безопасности сети](../virtual-network/network-security-groups-overview.md). Например, вы хотите разрешить только трафик, поступающий из корпоративной сети, в сети лаборатории.
- **Шлюз удаленных рабочих столов**. предприятия обычно блокируют исходящие подключения к удаленному рабочему столу в корпоративном брандмауэре. Существует несколько вариантов обеспечения возможности подключения к облачной среде в DevTest Labs, включая:
  - Используйте [Шлюз удаленных рабочих столов](/windows-server/remote/remote-desktop-services/desktop-hosting-logical-architecture)и разрешите статический IP-адрес балансировщика нагрузки шлюза.
  - [Направлять весь входящий трафик RDP](../vpn-gateway/vpn-gateway-forced-tunneling-rm.md) через подключение ExpressRoute или VPN типа "сеть — сеть". Эта функция часто учитывается, когда предприятия планируют развертывание DevTest Labs.
- **Сетевые службы (виртуальные сети, подсети)**. топология [сети Azure](../networking/networking-overview.md) — это еще один ключевой элемент в архитектуре DevTest Labs. Он определяет, могут ли ресурсы из лаборатории взаимодействовать и иметь доступ к локальным и Интернет-ресурсам. Наша схема архитектуры включает в себя наиболее распространенные способы использования DevTest Labs клиентами. все лаборатории подключаются через [пиринг виртуальных сетей](../virtual-network/virtual-network-peering-overview.md) , используя [модель Hub](/azure/architecture/reference-architectures/hybrid-networking/hub-spoke) для подключения ExpressRoute или VPN типа "сеть — сеть" к локальной среде. Но DevTest Labs использует виртуальную сеть Azure напрямую, поэтому нет никаких ограничений на настройку сетевой инфраструктуры.
- **DevTest Labs**. DevTest Labs — это ключевая часть общей архитектуры. Дополнительные сведения о службе см. в статье [о DevTest Labs](devtest-lab-overview.md).
- **Виртуальные машины и другие ресурсы (SaaS, PaaS, IaaS)**. виртуальные машины — это ключевая Рабочая нагрузка, которую DevTest Labs поддерживает вместе с другими ресурсами Azure. DevTest Labs позволяет предприятиям легко и быстро предоставлять доступ к ресурсам Azure (включая виртуальные машины и другие ресурсы Azure). Узнайте больше о доступе к Azure для [разработчиков](devtest-lab-developer-lab.md) и [тестировщиков](devtest-lab-test-env.md).

## <a name="scalability-considerations"></a>Вопросы масштабируемости
Несмотря на то, что DevTest Labs не имеет встроенных квот или ограничений, другие ресурсы Azure, используемые в типичной работе лаборатории, имеют [квоты на уровне подписки](../azure-resource-manager/management/azure-subscription-service-limits.md). Таким образом, в типичном развертывании предприятия требуется несколько подписок Azure, чтобы охватить большое развертывание DevTest Labs. Квоты, которые чаще всего относятся к предприятиям:

- **Группы ресурсов**. в конфигурации по умолчанию DevTest Labs создает группу ресурсов для каждой новой виртуальной машины, или пользователь создает среду с помощью службы. Подписки могут содержать [до 980 групп ресурсов](../azure-resource-manager/management/azure-subscription-service-limits.md#subscription-limits). Таким образом, это ограничение для виртуальных машин и сред в подписке. Следует учесть еще две конфигурации:
    - **[Все виртуальные машины отправляются в одну группу ресурсов](resource-group-control.md)**. Несмотря на то, что эта программа установки позволяет обеспечить соответствие ограничению группы ресурсов, она влияет на ограничение по типу ресурса в пределах группы ресурсов.
    - **Использование общих общедоступных IP-адресов**. все виртуальные машины одного размера и региона находятся в одной группе ресурсов. Эта конфигурация представляет собой "среднюю заземление" между квотами групп ресурсов и квотами на ресурсы группы ресурсов, если виртуальным машинам разрешено иметь общедоступные IP-адреса.
- **Ресурсов на группу ресурсов для каждого типа** ресурсов: ограничение по умолчанию для [ресурсов на группу ресурсов по каждому типу ресурсов равно 800](../azure-resource-manager/management/azure-subscription-service-limits.md#resource-group-limits).  Когда вы используете *все виртуальные машины, переходите к одной и той же конфигурации группы ресурсов* , пользователи могут столкнуться с этой подпиской гораздо быстрее, особенно если у виртуальных машин много дополнительных дисков.
- **Учетные записи хранения**. Лаборатория в DevTest Labs поставляется с учетной записью хранения. Квота Azure для [количества учетных записей хранения на регион для каждой подписки составляет 250](../azure-resource-manager/management/azure-subscription-service-limits.md#storage-limits). Максимальное число DevTest Labs в одном регионе также равно 250.
- **Назначения ролей**. Назначение ролей заключается в том, как вы предоставляете пользователю или участнику доступ к ресурсу (владельцу, ресурсу, уровню разрешений). В Azure существует [ограничение в 2 000 назначений ролей на подписку](../azure-resource-manager/management/azure-subscription-service-limits.md#azure-role-based-access-control-limits). По умолчанию служба DevTest Labs создает группу ресурсов для каждой виртуальной машины. Владельцу предоставляется разрешение *owner* для виртуальной машины DevTest Labs и разрешение *читатель* для группы ресурсов. Таким образом, каждая создаваемая виртуальная машина использует два назначения ролей в дополнение к назначениям, которые используются при предоставлении пользователям разрешений на лабораторию.
- **Чтение и запись API**. Существуют различные способы автоматизации Azure и DevTest Labs, включая интерфейсы API, PowerShell, Azure CLI и Azure SDK. При помощи службы автоматизации может быть достигнуто еще одно ограничение на запросы API: каждая подписка позволяет до [12 000 запросов на чтение и 1 200 запросов на запись в час](../azure-resource-manager/management/request-limits-and-throttling.md). Учитывайте это ограничение при автоматизации DevTest Labs.

## <a name="manageability-considerations"></a>Вопросы управляемости
DevTest Labs имеет отличный пользовательский интерфейс администратора для работы с одной лабораторией. Но на предприятии, скорее всего, у вас есть несколько подписок Azure и многих лабораторных занятий. Для согласования изменений во всех лабораториях требуется создание сценариев и автоматизации. Ниже приведены некоторые примеры и рекомендации по управлению развертыванием DevTest Labs.

- **Изменения в параметрах лаборатории**. распространенным сценарием является обновление определенного параметра лаборатории во всех лабораториях развертывания. Например, доступен новый размер экземпляра виртуальной машины, и все лаборатории необходимо обновить, чтобы разрешить его. Эти изменения лучше всего автоматизировать с помощью сценариев PowerShell, интерфейса командной строки или интерфейсов API.  
- **Личный маркер доступа репозитория артефактов**. как правило, личные маркеры доступа для репозитория Git истекает через 90 дней, один год или два года. Чтобы обеспечить непрерывность, важно расширить личный маркер доступа или создать новый. Затем используйте автоматизацию для применения нового личного маркера доступа ко всем лабораториям.
- **Ограничить изменения в лабораторных условиях**. часто определенный параметр должен быть ограничен (например, разрешить использование образов Marketplace). Вы можете использовать политику Azure, чтобы запретить изменение типа ресурса. Можно также создать пользовательскую роль и предоставить пользователям эту роль, а не роль *владельца* лаборатории. Это можно сделать для большинства параметров в лаборатории (внутренняя поддержка, объявление лаборатории, разрешенные размеры виртуальных машин и т. д.).
- **Требовать, чтобы виртуальные машины следовали соглашению об именовании**. менеджерам обычно требуется легко найти виртуальные машины, которые являются частью облачной среды разработки и тестирования. Это можно сделать с помощью [политики Azure](https://github.com/Azure/azure-policy/tree/master/samples/TextPatterns/allow-multiple-name-patterns).

Важно отметить, что DevTest Labs использует базовые ресурсы Azure, которые управляются аналогичным образом: сети, диски, расчеты и т. д. Например, политика Azure применяется к виртуальным машинам, созданным в лаборатории. Центр безопасности Azure может сообщать о соответствии виртуальной машины. А служба Azure Backup может обеспечить регулярное резервное копирование для виртуальных машин в лаборатории.

## <a name="security-considerations"></a>Вопросы безопасности
Azure DevTest Labs использует существующие ресурсы в Azure (COMPUTE, Network и т. д.). Поэтому он автоматически получает преимущества от функций безопасности, встроенных в платформу. Например, чтобы разрешить исходящие подключения к удаленному рабочему столу только из корпоративной сети, просто добавьте группу безопасности сети в виртуальную сеть в шлюзе удаленных рабочих столов. Единственным дополнительным фактором безопасности является уровень разрешений, предоставляемых членам команды, которые используют лабораторию ежедневно. Наиболее распространенными разрешениями являются [ *owner* и *User*](devtest-lab-add-devtest-user.md). Дополнительные сведения об этих ролях см. [в разделе Добавление владельцев и пользователей в Azure DevTest Labs](devtest-lab-add-devtest-user.md).

## <a name="next-steps"></a>Дальнейшие действия
См. следующую статью в этой серии: [увеличение масштаба инфраструктуры Azure DevTest Labs](devtest-lab-guidance-scale.md).