---
title: Интеграция сред в Azure Pipelines в Azure DevTest Labs
description: Узнайте, как интегрировать среды Azure DevTest Labs в конвейеры непрерывной интеграции Azure DevOps (CI) и непрерывной поставки (CD).
ms.topic: article
ms.date: 06/26/2020
ms.openlocfilehash: be726b2a3f67fd3dada4fdc3cf794922a3c18d06
ms.sourcegitcommit: 772eb9c6684dd4864e0ba507945a83e48b8c16f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "85483029"
---
# <a name="integrate-environments-into-your-azure-devops-cicd-pipelines"></a>Интеграция сред в конвейеры CI/CD DevOps в Azure
Вы можете использовать расширение Tasks Azure DevTest Labs, которое устанавливается в Azure DevOps Services (ранее называлось Visual Studio Team Services), чтобы легко интегрировать конвейер сборки и выпуска непрерывной интеграции (CI) и непрерывной поставки (CD) с Azure DevTest Labs. Эти расширения упрощают развертывание [среды](devtest-lab-test-env.md) для определенной тестовой задачи, а затем удаляют ее после завершения теста. 

В этой статье показано, как создать и развернуть среду, а затем удалить среду в одном полном конвейере. Вы обычно выполняете каждую из этих задач по отдельности в пользовательском конвейере сборки, тестирования и развертывания. Расширения, используемые в этой статье, добавляются к [задачам виртуальной машины с созданием или удалением](devtest-lab-integrate-ci-cd.md).

- Создание среда
- Удаление среды

## <a name="before-you-begin"></a>Перед началом
Перед интеграцией конвейера CI/CD с Azure DevTest Labs установите расширение [задач Azure DevTest Labs](https://marketplace.visualstudio.com/items?itemName=ms-azuredevtestlabs.tasks) из Visual Studio Marketplace. 

## <a name="create-and-configure-the-lab-for-environments"></a>Создание и Настройка лаборатории для сред
В этом разделе описывается создание и Настройка лаборатории, в которой будет развернута среда Azure.

1. [Создайте лабораторию](devtest-lab-create-lab.md) , если у вас ее еще нет. 
2. Настройте лабораторию и создайте шаблон среды, выполнив инструкции из этой статьи: [создание сред с несколькими виртуальными машинами и ресурсов PaaS с помощью шаблонов Azure Resource Manager](devtest-lab-create-environment-from-arm.md).
3. В этом примере используйте существующий шаблон быстрого запуска Azure [https://azure.microsoft.com/resources/templates/201-web-app-redis-cache-sql-database/](https://azure.microsoft.com/resources/templates/201-web-app-redis-cache-sql-database/) .
4. Скопируйте папку **201-Web-App-Redis-Cache-SQL-Database** в папку **армтемплате** репозитория, настроенного на шаге 2.

## <a name="create-a-release-definition"></a>Создание определения выпуска
Чтобы создать определение выпуска, сделайте следующее:

1.  На вкладке **выпуски** в **центре сборки & выпуска** нажмите кнопку **со знаком «плюс» (+)** .
2.  В окне **Создание определения выпуска** выберите шаблон **Пустой**, а затем нажмите кнопку **Далее**.
3.  Выберите **Выбрать позже**, а потом щелкните **Создать**, чтобы создать определение выпуска с одной средой по умолчанию без связанных артефактов.
4.  Чтобы открыть контекстное меню, в новом определении выпуска нажмите **кнопку с многоточием (...)** рядом с именем среды, а затем выберите **Настройка переменных**.
5.  В окне **настройки среды** введите следующие значения переменных, используемых в задачах определения выпуска:
1.  В поле **administratorLogin** введите имя для входа администратора SQL.
2.  В поле **administratorLoginPassword** введите пароль, который будет использоваться для входа администратора SQL. Используйте значок "замка" для скрытия и защиты пароля.
3.  В поле **DatabaseName** введите имя базы данных SQL.
4.  Эти переменные являются специфическими для примеров сред, и разные среды могут иметь разные переменные.

## <a name="create-an-environment"></a>Создание среды
Следующий этап развертывания заключается в создании среды для использования в целях разработки или тестирования.

1. В определении выпуска выберите **Добавить задачи**.
2. На вкладке **задачи** добавьте задачу Azure DevTest Labs создание среды. Настройте задачу следующим образом.
    1. В поле **Подписка на AzureRM** выберите подключение в списке **Доступные подключения к службе Azure** или создайте подключение с ограниченными разрешениями к вашей подписке Azure. Дополнительные сведения см. в разделе о [конечной точке службы Azure Resource Manager](/azure/devops/pipelines/library/service-endpoints).
2. В поле **имя лаборатории** выберите имя экземпляра, созданного ранее.
3. В поле **Имя репозитория** выберите репозиторий, в который был отправлен шаблон диспетчер ресурсов (201).
4. В поле **имя шаблона** выберите имя среды, сохраненной в репозитории исходного кода *. 
5. Имя **лаборатории**, **Имя репозитория** и **имя шаблона** являются понятными представлениями идентификаторов ресурсов Azure. Если ввести понятное имя вручную, это приведет к сбоям, и для выбора сведений используйте раскрывающиеся списки.
6. В поле **имя среды** введите имя для уникальной идентификации экземпляра среды в лаборатории.  Оно должно быть уникальным в пределах лаборатории.
7. **Файл параметров** и **Параметры** позволяют передавать пользовательские параметры в среду. Для установки значений параметров можно использовать один или оба варианта. В этом примере будет использоваться раздел Parameters. Используйте имена переменных, определенных в среде, например: `-administratorLogin "$(administratorLogin)" -administratorLoginPassword "$(administratorLoginPassword)" -databaseName "$(databaseName)" -cacheSKUCapacity 1`
8. Сведения в шаблоне среды можно передать в разделе Output шаблона. Установите флажок **создать выходные переменные на основе выходных данных шаблона среды** , чтобы другие задачи могли использовать эти данные. `$(Reference name.Output Name)` соответствует шаблону. Например, если имя ссылки было равно, а имя выхода в шаблоне было расположением переменной, это будет `$(DTL.location)` .

## <a name="delete-the-environment"></a>Удаление среды
Последним этапом является удаление среды, развернутой в экземпляре Azure DevTest Labs. Обычно среда удаляется после выполнения задач разработки или выполнения тестов, необходимых для развернутых ресурсов.

В определении выпуска выберите **добавить задачи**, а затем на вкладке **развертывание** добавьте задачу **Azure DevTest Labs Удаление среды** . Настройте его следующим образом.

1. Чтобы удалить виртуальную машину, см. раздел [Azure DevTest Labs Tasks](https://marketplace.visualstudio.com/items?itemName=ms-azuredevtestlabs.tasks):
    1. В поле **Подписка на AzureRM** выберите подключение в списке **Доступные подключения к службе Azure** или создайте подключение с ограниченными разрешениями к вашей подписке Azure. Дополнительные сведения см. в разделе о [конечной точке службы Azure Resource Manager](/azure/devops/pipelines/library/service-endpoints).
    2. В поле **имя лаборатории** выберите лабораторию, в которой находится среда.
    3. В поле **имя среды** введите имя удаляемой среды.
2. Введите имя для определения выпуска и сохраните его.

## <a name="next-steps"></a>Дальнейшие действия
См. следующие статьи: 
- [Создавайте среды с несколькими виртуальными машинами с помощью шаблонов диспетчер ресурсов](devtest-lab-create-environment-from-arm.md).
- Краткое руководство диспетчер ресурсов шаблонов для автоматизации DevTest Labs из [репозитория GitHub DevTest Labs](https://github.com/Azure/azure-quickstart-templates).
- [Страница устранения неполадок VSTS](/azure/devops/pipelines/troubleshooting)

