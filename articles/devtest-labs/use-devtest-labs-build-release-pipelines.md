---
title: Использование DevTest Labs в конвейерах сборки и выпуска в Azure Pipelines
description: Узнайте, как использовать Azure DevTest Labs в конвейерах сборки и выпуска Azure Pipelines.
ms.topic: article
ms.date: 06/26/2020
ms.openlocfilehash: d04ed5dd7bebac0c8f24deb9145c3d2e4b77122e
ms.sourcegitcommit: 772eb9c6684dd4864e0ba507945a83e48b8c16f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "88080340"
---
# <a name="use-devtest-labs-in-azure-pipelines-build-and-release-pipelines"></a>Использование DevTest Labs в конвейерах сборки и выпуска в Azure Pipelines
Azure Pipelines в этой статье содержатся сведения о том, как DevTest Labs можно использовать в конвейерах сборки и выпуска. 

## <a name="overall-flow"></a>Общий поток
Основной поток — создать **конвейер сборки** , который выполняет следующие задачи:

1. Создайте код приложения.
1. Создайте базовую среду в DevTest Labs.
1. Обновите среду с помощью пользовательских сведений.
1. Развертывание приложения в среде DevTest Labs
1. Протестируйте код. 

После успешного завершения сборки **конвейер выпуска** будет использовать артефакты сборки для развертывания промежуточной или рабочей среды. 

Одно из необходимых локальных компонентов состоит в том, что вся информация, необходимая для повторного создания проверенной экосистемы, доступна в рамках артефактов сборки, включая настройку ресурсов Azure. По мере использования ресурсов Azure компании хотят управлять использованием этих ресурсов или контролировать их. В некоторых ситуациях Azure Resource Manager шаблоны, используемые для создания и настройки ресурсов, могут управляться другим отделом, наподобие этого. Кроме того, эти шаблоны могут храниться в другом репозитории. Она приводит к интересной ситуации, когда сборка будет создана и протестирована, и как код, так и конфигурация должны храниться в артефактах сборки для правильного воссоздания системы в рабочей среде. 

Используя DevTest Labs на этапе сборки или тестирования, можно добавить шаблоны Azure Resource Manager и вспомогательные файлы в источники сборки, чтобы на этапе выпуска точная конфигурация, используемая для тестирования, была развернута в рабочей среде. Задача **создания среды Azure DevTest Labs** с правильной конфигурацией сохранит шаблоны диспетчер ресурсов в артефактах сборки. В этом примере вы будете использовать код из [руководства: создание веб-приложения .NET Core и базы данных SQL в службе приложений Azure](../app-service/tutorial-dotnetcore-sqldb-app.md)для развертывания и тестирования веб-приложения в Azure.

![Общий поток](./media/use-devtest-labs-build-release-pipelines/overall-flow.png)

## <a name="set-up-azure-resources"></a>Настройка ресурсов Azure
Существует несколько элементов, которые необходимо заранее создать.

- Два хранилища. Первый из них с кодом из учебника и шаблоном диспетчер ресурсов с двумя дополнительными виртуальными машинами. Второй будет содержать базовый шаблон Azure Resource Manager (существующая конфигурация).
- Группа ресурсов для развертывания рабочего кода и конфигурации.
- Лаборатория должна быть настроена с [подключением к репозиторию конфигурации](devtest-lab-create-environment-from-arm.md) для конвейера сборки. Шаблон диспетчер ресурсов необходимо вернуть в репозиторий конфигурации, как azuredeploy.jsс metadata.js, чтобы разрешить DevTest Labs распознавать и развертывать шаблон.

Конвейер сборки создаст среду DevTest Labs и развернет код для тестирования.

## <a name="set-up-a-build-pipeline"></a>Настройка конвейера сборки
В Azure Pipelines создайте конвейер сборки, используя код из [руководства: создание веб-приложения .NET Core и базы данных SQL в службе приложений Azure](../app-service/tutorial-dotnetcore-sqldb-app.md). Используйте шаблон **ASP.NET Core** , который будет заполнять необходимую задачу для сборки, тестирования и публикации кода.

![Выбор шаблона ASP.NET](./media/use-devtest-labs-build-release-pipelines/select-asp-net.png)

Необходимо добавить три дополнительные задачи для создания среды в DevTest Labs и развертывания в среде.

![Конвейер с тремя задачами](./media/use-devtest-labs-build-release-pipelines/pipeline-tasks.png)

### <a name="create-environment-task"></a>Задача "Создание среды"
В задаче Создание среды Azure DevTest Labs (задача "**Создание среды** ") используйте раскрывающиеся списки для выбора следующих значений:

- Подписка Azure.
- имя лаборатории
- Имя репозитория
- имя шаблона (который показывает папку, в которой хранится среда). 

Вместо ввода данных вручную рекомендуется использовать раскрывающиеся списки на странице. Если вы вручную вводите сведения, введите полные идентификаторы ресурсов Azure. Задача отображает понятные имена вместо идентификаторов ресурсов. 

Имя среды — это отображаемое имя, отображаемое в DevTest Labs. Оно должно быть уникальным именем для каждой сборки. Например: **тестенв $ (Build. BuildId)**. 

Для передачи сведений в шаблон диспетчер ресурсов можно указать файл параметров или параметры. 

Выберите **создать выходные переменные на основе параметра выходные данные шаблона среды** и введите Справочное имя. В этом примере введите **басинв** в качестве справочного имени. Этот Басинв будет использоваться при настройке следующей задачи. 

![Задача "Создание среды Azure DevTest Labs"](./media/use-devtest-labs-build-release-pipelines/create-environment.png)

### <a name="populate-environment-task"></a>Заполнение задачи среды
Вторая задача (**Azure DevTest Labs заполнение задачи среды** ) заключается в обновлении существующей среды DevTest Labs. Задача создания среды выводит **басинв. енвиронментресаурцеид** , которая используется для настройки имени среды для этой задачи. Шаблон диспетчер ресурсов для этого примера имеет два параметра — **adminUserName** и **adminPassword**. 

![Заполнение задачи среды Azure DevTest Labs](./media/use-devtest-labs-build-release-pipelines/populate-environment.png)

## <a name="app-service-deploy-task"></a>Задача развертывания службы приложений
Третья задача — задача **развертывания службы приложений Azure** . Для типа приложения задано значение **веб-приложение** , а для свойства имя службы приложений — **$ (веб-сайт)**.

![Задача развертывания службы приложений](./media/use-devtest-labs-build-release-pipelines/app-service-deploy.png)

## <a name="set-up-release-pipeline"></a>Настройка конвейера выпуска
Вы создадите конвейер выпуска с двумя задачами: **развертывание Azure: создание или обновление группы ресурсов** и **развертывание службы приложений Azure**. 

Для первой задачи укажите имя и расположение группы ресурсов. Расположение шаблона — это связанный артефакт. Если шаблон диспетчер ресурсов содержит связанные шаблоны, необходимо реализовать пользовательское развертывание группы ресурсов. Шаблон находится в опубликованном Drop-артефакте. Переопределите параметры шаблона для шаблона диспетчер ресурсов. Остальные параметры можно оставить значениями по умолчанию. 

Для второй задачи **разверните службу приложений Azure**, укажите подписку Azure, выберите **веб-приложение** для **типа приложения** и **$ (веб-сайт)** для **имени службы приложений**. Остальные параметры можно оставить значениями по умолчанию. 

## <a name="test-run"></a>Тестовый запуск
Теперь, когда оба конвейера настроены, вручную заставят сборку в очередь и посмотрим на работу. Следующим шагом является установка соответствующего триггера для сборки и подключение сборки к конвейеру выпуска.

## <a name="next-steps"></a>Дальнейшие действия
См. следующие статьи:

- [Интеграция Azure DevTest Labs в конвейер непрерывной интеграции и доставки Azure Pipelines](devtest-lab-integrate-ci-cd.md)
- [Интегрируйте среды в конвейеры Azure Pipelines CI/CD](integrate-environments-devops-pipeline.md)
