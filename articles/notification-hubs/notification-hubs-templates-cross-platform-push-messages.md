---
title: Шаблоны центров уведомлений Azure
description: Сведения об использовании шаблонов для центров уведомлений Azure.
services: notification-hubs
documentationcenter: .net
author: sethmanheim
manager: femila
ms.service: notification-hubs
ms.workload: mobile
ms.tgt_pltfrm: mobile-multiple
ms.devlang: multiple
ms.topic: article
ms.date: 02/16/2021
ms.author: sethm
ms.reviewer: thsomasu
ms.lastreviewed: 01/04/2019
ms.openlocfilehash: ee42512a468f4ff86ad7ba273d3971fd124779e2
ms.sourcegitcommit: 910a1a38711966cb171050db245fc3b22abc8c5f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "100635648"
---
# <a name="notification-hubs-templates"></a>Шаблоны центров уведомлений

Шаблоны позволяют клиентскому приложению определять точный формат уведомлений, которые оно будет получать. С помощью шаблонов приложение получает несколько преимуществ, включая следующие:

- Серверная часть, не зависящая от платформы
- Персонализированные уведомления
- Независимость от версии клиента
- Простая локализация

В этом разделе содержатся два подробных примера использования шаблонов для отправки независимых от платформы уведомлений, предназначенных для всех устройств на разных платформах, а также для настройки широковещательных уведомлений на каждое устройство.

## <a name="using-templates-cross-platform"></a>Использование шаблонов для разных платформ

Стандартный способ отправки push-уведомлений заключается в отправке полезных данных в службу уведомлений платформы (WNS, APNS) для каждого уведомления. Например, для отправки оповещения в службу APNS полезными данными будет объект JSON следующего вида:

```json
{"aps": {"alert" : "Hello!" }}
```

Для отправки аналогичного всплывающего сообщения в приложении Магазина Windows полезными данными XML будет:

```xml
<toast>
  <visual>
    <binding template=\"ToastText01\">
      <text id=\"1\">Hello!</text>
    </binding>
  </visual>
</toast>
```

Аналогичные полезные данные можно создавать для платформ MPNS (Windows Phone) и FCM (Android).

Это требование заставляет серверную часть приложения формировать разные полезные данные для каждой платформы, а также возлагает на нее ответственность за часть уровня представления данных в приложении. К некоторым вопросам относятся локализация и графические макеты (особенно для приложений Магазина Windows, которые содержат уведомления для плиток различных типов).

Шаблон центра уведомлений позволяет клиентскому приложению создавать специальные регистрации (называются шаблонными регистрациями), которые содержат не только набор тегов, но и шаблон. Шаблон "центры уведомлений" позволяет клиентскому приложению связывать устройства с шаблонами независимо от того, работаете ли вы с установками (предпочтительно) или регистрацией. Учитывая приведенные выше примеры полезной нагрузки, единственной независимой от платформы информацией является реальное предупреждающее сообщение (**Hello!**). Шаблон — это набор инструкций для центра уведомлений о том, как форматировать независимое от платформы сообщение для регистрации конкретного клиентского приложения. В предыдущем примере платформонезависимым сообщением является единичное свойство `message = Hello!`.

Процесс показан на следующем рисунке.

![Схема, демонстрирующая процесс использования шаблонов на разных платформах](./media/notification-hubs-templates/notification-hubs-hello.png)

Шаблон для регистрации клиентского приложения iOS выглядит следующим образом:

```json
{"aps": {"alert": "$(message)"}}
```

Соответствующий шаблон для клиентского приложения Магазина Windows:

```xml
<toast>
    <visual>
        <binding template=\"ToastText01\">
            <text id=\"1\">$(message)</text>
        </binding>
    </visual>
</toast>
```

Обратите внимание, что фактическое сообщение заменяется на выражение `$(message)` . Это выражение указывает концентратору уведомлений, когда он отправляет сообщение в эту конкретную регистрацию, для создания сообщения, следующего за ним, и вставки общего значения.

Если вы работаете с моделью установки, ключ "Templates" для установки содержит JSON нескольких шаблонов. При работе с моделью регистрации клиентское приложение может создать несколько регистраций, чтобы использовать несколько шаблонов. Например, шаблон для сообщений предупреждений и шаблон для обновлений плиток. Клиентские приложения также могут использовать комбинацию собственных регистраций (регистраций без шаблона) и регистраций с шаблонами.

Центр уведомлений отправляет одно уведомление для каждого шаблона, не учитывая, принадлежат ли они одному клиентскому приложению. Это поведение может использоваться для преобразования платформонезависимых уведомлений в серию уведомлений. Например, одно и то же независимое от платформы сообщение для концентратора уведомлений можно легко преобразовать в всплывающее оповещение и обновление плитки, не требуя от сервера уведомления об этом. Некоторые платформы (например, iOS) могут сворачивать несколько уведомлений на одно устройство, если они отправляются в течение короткого периода времени.

## <a name="using-templates-for-personalization"></a>Использование шаблонов для персонализации

Еще одним преимуществом использования шаблонов является возможность использования центров уведомлений для персонализации уведомлений по отдельным регистрациям. Например, рассмотрим приложение Weather, которое отображает плитку с условиями погоды в определенном месте. Пользователь может выбрать между отображением градусов Цельсия или Фаренгейта и прогноз на один или на пять дней. С помощью шаблонов каждая установка клиентского приложения может зарегистрировать необходимый для себя формат (1 день и шкала Цельсия, 1 день и шкала Фаренгейта, 5 дней и шкала Цельсия, 5 дней и шкала Фаренгейта), а его серверная часть будет отправлять одно сообщение со всеми данными, необходимыми для заполнения шаблонов (например, пятидневный прогноз с градусами Цельсия и Фаренгейта).

Шаблон для прогноза погоды на один день и шкалой Цельсия выглядит следующим образом:

```xml
<tile>
  <visual>
    <binding template="TileWideSmallImageAndText04">
      <image id="1" src="$(day1_image)" alt="alt text"/>
      <text id="1">Seattle, WA</text>
      <text id="2">$(day1_tempC)</text>
    </binding>  
  </visual>
</tile>
```

Сообщение, отправленное в центр уведомлений, содержит все следующие свойства:

| day1_image | day2_image | day3_image | day4_image | day5_image |
|------------|------------|------------|------------|------------|
| day1_tempC | day2_tempC | day3_tempC | day4_tempC | day5_tempC |
| day1_tempF | day2_tempF | day3_tempF | day4_tempF | day5_tempF |

С помощью этого шаблона серверная часть отправляет только одно сообщение без необходимости хранить персональные параметры для пользователей приложения. Этот сценарий показан на следующей схеме:

![Схема, показывающая, как серверная часть отправляет только одно сообщение на каждую платформу.](./media/notification-hubs-templates/notification-hubs-registration-specific.png)

## <a name="how-to-register-templates"></a>Регистрация шаблонов

Чтобы зарегистрировать шаблоны с помощью модели установки (предпочтительно) или модели регистрации, см. раздел [Управление регистрацией](notification-hubs-push-notification-registration-management.md).

## <a name="template-expression-language"></a>Язык выражений шаблонов

В шаблоны можно использовать только форматы документов XML или JSON. Кроме того, выражения можно размещать только в конкретных местах; Например, атрибуты или значения узла для XML, значения строковых свойств для JSON.

В следующей таблице показан синтаксис, используемый в шаблонах:

| Выражение       | Описание |
| ---------------- | --- |
| $(prop)          | Ссылка на свойство события с заданным именем. В именах свойств регистр не учитывается. Значением этого выражения является текстовое значение свойства или пустая строка, если свойство не существует. |
|$(prop, n)       | То же, что выше, но текст обрезается до n символов, например, выражение $(title, 20) сокращает содержимое свойства title до 20 символов. |
| .(prop, n)      | То же, что выше, но к тексту добавляются три точки, поскольку он является сокращенным. Общий размер обрезанной строки и суффикс не должен превышать n символов. (Title, 20) с входным свойством "это строка заголовка" результаты в этом виде **...** |
| %(prop)          | Аналогично $(name), за исключением того, что выходные данные имеют формат URI. |
| #(prop)          | Используется в шаблонах JSON (например, для шаблонов iOS и Android).<br><br>Эта функция работает точно так же, как указанная ранее "$ (Prop)", за исключением случаев использования в шаблонах JSON (например, шаблоны Apple). В этом случае, если эта функция не окружена "{", "}" (например, "Мижсонпроперти": "# (Name)"), она вычисляется как число в формате JavaScript, например "RegExp" (0&#124; (&#91;1-9&#93;&#91;0-9&#93; *)) ( \.&#91;0-9&#93;+)? ( (e&#124;E) (+&#124;-)? &#91;0-9&#93;+)?, то выходной JSON-файл является числом.<br><br>Например, "Эмблема:" # (Name) "превращается в" эмблему ": 40 (а не" 40 "). |
| "Text" или "Text" | Литерал. Литералы содержат произвольный текст, заключенный в одинарные или двойные кавычки. |
| expr1 + expr2    | Оператор объединения, объединяющий два выражения в одну строку. |

Выражения могут быть любого из перечисленных выше видов.

При использовании конкатенации все выражение должно быть заключено в `{}`. Например, `{$(prop) + ‘ - ’ + $(prop2)}`.

Например, ниже представлен недопустимый шаблон XML.

```xml
<tile>
  <visual>
    <binding $(property)>
      <text id="1">Seattle, WA</text>
    </binding>  
  </visual>
</tile>
```

Как было сказано ранее, при использовании конкатенации выражения должны быть заключены в квадратные скобки. Пример:

```xml
<tile>
  <visual>
    <binding template="ToastText01">
      <text id="1">{'Hi, ' + $(name)}</text>
    </binding>  
  </visual>
</tile>
```

## <a name="next-steps"></a>Дальнейшие действия

[Дополнительные сведения о центрах уведомлений Azure](notification-hubs-push-notification-overview.md)
