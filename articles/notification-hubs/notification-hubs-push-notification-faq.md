---
title: Часто задаваемые вопросы о центрах уведомлений Azure | Документация Майкрософт
description: Часто задаваемые вопросы о проектировании и реализации решений в центрах уведомлений Azure.
services: notification-hubs
documentationcenter: mobile
author: sethmanheim
manager: femila
keywords: отправка push-уведомлений, push-уведомления, push-уведомления iOS, push-уведомления android, push-уведомления ios, push-уведомления android
ms.service: notification-hubs
ms.workload: mobile
ms.tgt_pltfrm: mobile-multiple
ms.devlang: multiple
ms.topic: article
ms.date: 02/12/2021
ms.author: sethm
ms.reviewer: thsomasu
ms.lastreviewed: 11/13/2019
ms.openlocfilehash: 0f79402956148c566bc34faa88e10895657883c2
ms.sourcegitcommit: 910a1a38711966cb171050db245fc3b22abc8c5f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/20/2021
ms.locfileid: "100591734"
---
# <a name="push-notifications-with-azure-notification-hubs-frequently-asked-questions"></a>Часто задаваемые вопросы об отправке push-уведомлений с помощью Центров уведомлений Azure

## <a name="general"></a>Общие сведения

### <a name="what-is-the-resource-structure-of-notification-hubs"></a>Какую структуру ресурсов используют Центры уведомлений?

Центры уведомлений Azure имеют два уровня ресурсов — это узлы и пространства имен. Узел — это отдельный ресурс для отправки, который содержит сведения об операциях отправки между платформами для одного приложения. Пространство имен содержит несколько узлов одного региона. Мы советуем сопоставлять одно пространство имен с одним приложением. В пространство имен можно включить рабочий центр, который работает с основным приложением, тестовый центр для работы с тестовым приложением и т. д.

### <a name="what-is-the-price-model-for-notification-hubs"></a>Как определяется цена на концентраторы уведомлений?

Последние сведения о тарифах можно найти на странице [цен на Центры уведомлений]. Счета за Центры уведомлений выставляются на уровне пространства имен (определение пространства имен дано в разделе "Какую структуру ресурсов используют Центры уведомлений?"). Центры уведомлений поддерживают три ценовые категории:

* Уровень **Бесплатный**. Это хороший выбор для изучения возможностей отправки, но мы не советуем использовать его для рабочих приложений. На каждое пространство имен поддерживается до 500 устройств и до 1 млн уведомлений в месяц без соглашений об уровне обслуживания.
* **Базовый**. Для небольших рабочих приложений можно выбрать этот уровень или уровень "Стандартный". На каждое пространство имен поддерживается до 200 тысяч устройств и до 10 млн операций отправки в месяц в качестве базового тарифа.
* Уровень **Стандартный**. Рекомендуемый вариант для средних и крупных рабочих приложений. На каждое пространство имен поддерживается до 10 млн устройств и до 10 млн операций отправки в месяц в качестве базового тарифа. Включает в себя расширенную телеметрию (предоставлены дополнительные данные о состоянии отправки).

Возможности уровня "Стандартный":

* **Расширенная телеметрия.** Центры уведомлений предоставляют телеметрию по каждому сообщению, которая позволяет отслеживать push-запросы и информацию о системе отправки уведомлений платформы для отладки.
* **Мультитенантность**. Вы можете работать с учетными данными система отправки уведомлений платформы на уровне пространства имен. Эта возможность позволяет легко распределять между клиентами узлы в одном пространстве имен.
* **Запланированная отправка**. Вы можете запланировать отправку уведомлений в любое время.
* **Групповые операции**. включает функции экспорта и импорта регистраций, как описано в документе [Экспорт и импорт регистраций] .

### <a name="what-is-the-notification-hubs-sla"></a>Что такое соглашение об уровне обслуживания для концентраторов уведомлений?

Для уровней Центров уведомлений "Базовый" и "Стандартный" мы гарантируем, что как минимум 99,9 % времени правильно настроенные приложения смогут отправлять push-уведомления или выполнять операции управления регистрацией. Дополнительные сведения о соглашении об уровне обслуживания Центров уведомлений см. на [этой странице](https://azure.microsoft.com/support/legal/sla/notification-hubs/).

> [!NOTE]
> Поскольку push-уведомления зависят от сторонних систем уведомления платформы, таких как служба push-уведомлений Apple (APNs) и Firebase Cloud Messaging Google (FCM), гарантия соглашения об уровне обслуживания для доставки этих сообщений отсутствует. После того как Центр уведомлений передаст пакеты системам отправки уведомлений платформы (с поддержкой соглашений об уровне обслуживания), непосредственная доставка push-уведомлений возлагается на эти системы (без поддержки соглашений об уровне обслуживания).

### <a name="how-do-i-upgrade-or-downgrade-my-hub-or-namespace-to-a-different-tier"></a>Как мне повысить или понизить уровень для узла или пространства имен?

Перейдите в раздел **[портал Azure]**  >  **пространства имен** или **концентраторов уведомлений**. Выберите ресурс, который требуется обновить, и перейдите на **страницу цен**. Обратите внимание на следующие требования:

* Новая ценовая категория будет применяться ко *всем* узлам в пространстве имен, с которыми вы работаете.
* Если при снижении уровня будет превышен лимит на число устройств, установленный для нового уровня, такое изменение вступит в силу только тогда, когда вы удалите все лишние устройства.

## <a name="design-and-development"></a>Проектирование и разработка

### <a name="which-server-side-platforms-do-you-support"></a>Какие платформы на стороне сервера вы поддерживаете?

Серверные пакеты SDK доступны для .NET, Java, Node.js, PHP и Python. API Центров уведомлений основан на интерфейсах REST, поэтому вы можете работать непосредственно с REST API. Это удобно, если вы используете сразу несколько платформ или хотите избежать дополнительных зависимостей. Дополнительные сведения см. на странице [Отправка push-уведомлений с помощью центров уведомлений Azure в iOS].

### <a name="which-client-platforms-do-you-support"></a>Какие клиентские платформы вы поддерживаете?

Push-уведомления поддерживаются для [iOS](ios-sdk-get-started.md), [Android](notification-hubs-android-push-notification-google-fcm-get-started.md), [Windows Universal](notification-hubs-windows-store-dotnet-get-started-wns-push-notification.md), [Windows Phone](notification-hubs-windows-mobile-push-notifications-mpns.md), [Android China (через Baidu)](notification-hubs-baidu-china-android-notifications-get-started.md), Xamarin [iOS](xamarin-notification-hubs-ios-push-notification-apns-get-started.md) и [Android](xamarin-notification-hubs-push-notifications-android-gcm.md)и [Safari](https://github.com/Azure/azure-notificationhubs-samples/tree/master/PushToSafari). Дополнительные сведения см. на странице центра [уведомлений начало работы учебники](ios-sdk-get-started.md) .

### <a name="do-you-support-text-message-email-or-web-notifications"></a>Поддерживаются ли уведомления по SMS и электронной почте, а также веб-уведомления?

Центры уведомлений отправляют уведомления на устройства, на которых работают мобильные приложения. и не поддерживают отправку электронных писем или текстовых сообщений. Кроме того, Центры уведомлений также не предоставляют возможность отправки push-уведомлений в браузере по умолчанию. Клиенты могут внедрить эту функцию с помощью SignalR на базе поддерживаемых серверных платформ. 

### <a name="how-many-devices-can-i-support-if-i-send-push-notifications-via-notification-hubs"></a>Сколько устройств может поддерживаться при отправке push-уведомлений через концентраторы уведомлений?

Сведения о поддерживаемых устройствах см. на странице с [ценами на Центры уведомлений].

Если требуется поддержка более 10 000 000 зарегистрированных устройств, необходимо секционировать устройства по нескольким пространствам имен.

### <a name="how-many-push-notifications-can-i-send-out"></a>Сколько push-уведомлений я могу отправить?

В зависимости от выбранной категории Центры уведомлений Azure автоматически выполняют масштабирование на основе количества уведомлений, проходящих через систему.

> [!NOTE]
> Общая стоимость использования может увеличиваться в зависимости от числа отправленных push-уведомлений. Ознакомьтесь с ограничениями для категорий на странице [с ценами на Центры уведомлений].

Наши клиенты отправляют миллионы push-уведомлений в день с помощью Центров уведомлений. Пока вы используете Центры уведомлений Azure, вам не нужно предпринимать специальные действия для масштабирования решения по отправке push-уведомлений.

### <a name="how-long-does-it-take-for-sent-push-notifications-to-reach-my-device"></a>Как скоро push-уведомления доставляются на мое устройство?

При обычном использовании с более или менее согласованной входящей нагрузкой даже Центры уведомлений Azure могут обрабатывать по крайней мере *1 миллион отправленных push-уведомлений в минуту*. Такая скорость может меняться в зависимости от количества тегов, характера входящих данных и других внешних факторов.

В течение предполагаемого времени доставки служба подсчитывает целевые объекты для соответствующей платформы и направляет сообщения службам push-уведомлений (PNS) на основе зарегистрированных тегов или выражений тегов. Службы PNS отвечают за отправку уведомлений на устройство.

Они не предоставляют никаких гарантий по доставке уведомлений, предусмотренных соглашением об уровне обслуживания. Однако подавляющая часть рush-уведомлений доставляется на устройства в течение нескольких минут (как правило, в диапазоне 10 минут) с момента их отправки в Центры уведомлений. Для отправки нескольких уведомлений может потребоваться больше времени.

> [!NOTE]
> Кроме того, в Центрах уведомлений Azure предусмотрена политика для удаления любых рush-уведомлений, которые не были доставлены в PNS в течение 30 минут. Эта задержка может произойти по ряду причин, чаще всего потому, что служба PNS регулирует работу приложения.

### <a name="is-there-any-latency-guarantee"></a>Предоставляются ли какие-либо гарантии по задержкам?

Из-за характера доставки push-уведомлений (они доставляются внешней службой PNS для определенной платформы) гарантии по задержкам не предоставляются. Как правило, большая часть рush-уведомлений доставляется в течение нескольких минут.

### <a name="where-does-azure-notification-hubs-store-data"></a>Где центры уведомлений Azure хранят данные?

Центры уведомлений Azure сохраняют данные регистрации клиентов в регионе, выбранном клиентом. Центры уведомлений обеспечивают покрытие аварийного восстановления метаданных (имя концентраторов уведомлений, строка подключения и другие важные сведения). Для всех регионов, кроме Южная Бразилия и Юго-Восточной Азии, резервная копия метаданных размещается в другом регионе (обычно в парном регионе Azure). Для регионов Южная Бразилия и Юго-Восточной Азии резервные копии хранятся в том же регионе, что и требования к местонахождение данных для этих регионов.

### <a name="what-do-i-need-to-consider-when-designing-a-solution-with-namespaces-and-notification-hubs"></a>Что следует учитывать при разработке решения в пространствах имен и Центрах уведомлений?

#### <a name="mobile-appenvironment"></a>Мобильное приложение и среда

* Используйте один Центр уведомлений для мобильного приложения в среде.
* В мультитенантном сценарии для каждого клиента должен быть отдельный концентратор.
* Никогда не используйте один и тот же Центр уведомлений в тестовой и рабочей средах, так как это может вызвать проблемы при отправке уведомлений. (Apple предлагает конечные точки Sandbox и Production Push с отдельными учетными данными для каждой из них.)
* По умолчанию тестовые уведомления можно отправлять на зарегистрированные устройства с портала Azure или с помощью интегрированного компонента Azure в Visual Studio. Существует пороговое значение в 10 устройств, которые случайным образом выбираются из пула регистрации.

> [!NOTE]
> Если для Центра был изначально настроен сертификат "песочницы" Apple, а затем — сертификат рабочей среды Apple, исходные маркеры устройств станут недействительными, что может привести к сбою отправки push-уведомлений. Используйте рабочую и тестовую среду по отдельности и разные Центры для разных сред.

#### <a name="pns-credentials"></a>Учетные данные PNS

При регистрации мобильного приложения на портале разработчиков платформы (например, Apple или Google) вы получаете идентификатор приложения и маркеры безопасности. Серверная часть приложения предоставляет эти маркеры службам PNS, чтобы они могли отправлять push-уведомления на устройства. Маркеры безопасности могут быть представлены в виде сертификатов (например, Apple iOS или Windows Phone) или ключей безопасности (например, Google Android или Windows). Их требуется настроить в Центрах уведомлений. Как правило, настройка осуществляется на уровне концентратора уведомлений, а также на уровне пространства имен в мультитенантном сценарии.

#### <a name="namespaces"></a>Пространства имен

Пространства имен могут также использоваться для группирования развертываний. Кроме того, с их помощью можно представить все концентраторы уведомлений для всех клиентов одного приложения в мультитенантном сценарии.

#### <a name="geo-distribution"></a>Географическое распределение

Географическое распределение не всегда является критически важным для push-уведомлений. Различные системы PNS (например, APNs или FCM), которые доставляют push-уведомления на устройства, распределены неравномерно.

Однако при наличии приложения, которое используется глобально, вы можете создать Центры в разных пространствах имен с помощью службы Центров уведомлений в разных регионах Azure по всему миру.

> [!NOTE]
> Мы не рекомендуем использовать этот подход, так как это приведет к увеличению затрат на управление, в частности на регистрацию. Используйте этот подход только в случае крайней необходимости.

### <a name="should-i-do-registrations-from-the-app-backend-or-directly-through-client-devices"></a>Где следует выполнять регистрацию: в серверной части приложения или непосредственно на клиентских устройствах?

Выполняйте регистрацию в серверной части приложения в тех случаях, когда необходимо выполнить аутентификацию клиента перед созданием регистрации, или при наличии тегов, которые должны быть созданы и изменены серверной частью приложения на основе определенной логики приложения. Дополнительные сведения см. в статьях [Регистрация из внутренней службы приложения] и [Управление регистрацией].

### <a name="what-is-the-push-notification-delivery-security-model"></a>Какая модель безопасности доставки push-уведомлений используется?

Центры уведомлений Azure используют модель безопасности на основе [подписанного URL-адреса](../storage/common/storage-sas-overview.md). Маркеры подписанного URL-адреса можно использовать на уровне корневого пространства имен или на детализированном уровне Центров уведомлений. Для этих маркеров подписанного URL-адреса можно задать различные правила авторизации, например разрешения для отправки сообщений или прослушивания уведомлений. Дополнительные сведения см. в документе о [модели безопасности Центров уведомлений].

### <a name="how-should-i-handle-sensitive-payload-in-push-notifications"></a>Как обрабатываются конфиденциальные полезные данные в push-уведомлениях?

Все уведомления доставляются на целевые устройства службами PNS платформы. При отправке уведомления в Центр уведомлений Azure оно обрабатывается и передается в соответствующую службу PNS.

Передача уведомлений от отправителя в Центры уведомлений Azure и в службу PNS осуществляется по протоколу HTTPS.

> [!NOTE]
> Центры уведомлений Azure не заносить в журнал полезные данные сообщений.

Для отправки конфиденциальных полезных данных мы советуем использовать шаблон безопасных push-уведомлений. Отправитель посылает уведомление для проверки связи с идентификатором сообщения на устройство без конфиденциальных полезных данных. Когда приложение на устройстве получает эти полезные данные, оно может напрямую вызвать безопасный API, чтобы получить информацию о сообщении. Руководство по реализации этой схемы см. на странице [Безопасные push-уведомления посредством центров уведомлений Azure].

## <a name="operations"></a>Операции

### <a name="what-support-is-provided-for-disaster-recovery"></a>Какая поддержка предоставляется для аварийного восстановления?

Мы предоставляем аварийное восстановление метаданных со своей стороны (имя Центра уведомлений, строка подключения и другие важные данные). В случае аварийного восстановления данные регистрации являются *единственным утерянным сегментом* инфраструктуры Центров уведомлений. Необходимо реализовать решение для повторного заполнения этих данных в новом концентраторе после восстановления:

1. Создайте дополнительный концентратор уведомлений в другом центре обработки данных. Мы советуем создать его с самого начала, так как это позволит предотвратить влияние на возможности управления в случае аварийного восстановления. Его можно создать непосредственно при аварийном восстановлении.

2. Обеспечьте синхронизацию дополнительного концентратора уведомлений с основным концентратором уведомлений, используя один из следующих вариантов:

   * Используйте серверную часть приложения, которая одновременно создает и обновляет установки в обоих концентраторах уведомлений. Установки позволяют указать собственный уникальный идентификатор устройства, что делает его более подходящим для сценария репликации. Дополнительные сведения см. в этом [образце кода](https://github.com/Azure/azure-notificationhubs-dotnet/tree/main/Samples/RedundantHubSample).
   * Используйте серверную часть приложения, которая получает регулярный дамп регистраций из основного концентратора уведомлений в качестве резервной копии, а затем выполняет массовою вставку в дополнительный Центр уведомлений.

Во вторичном концентраторе уведомлений могут находиться просроченные установки и регистрации. Когда отправка отправляются в маркер с истекшим сроком действия, концентраторы уведомлений автоматически очищает связанную запись установки или регистрации на основе ответа, полученного от сервера PNS. Чтобы очистить записи с истекшим сроком действия из дополнительного центра уведомлений, добавьте пользовательскую логику, обрабатывающую отзывы каждой отправки. Затем истекает срок действия установки или регистрации в дополнительном концентраторе уведомлений.

Если у вас нет серверной части, при запуске приложений на целевых устройствах они создадут регистрацию в дополнительном концентраторе уведомлений. В конечном итоге этот Центр уведомлений зарегистрирует все активные устройства.

В течение определенного периода времени устройства, на которых не открыты приложения, не будут получать уведомления.

### <a name="is-all-of-my-data-stored-in-encrypted-form"></a>Все ли данные хранятся в зашифрованном виде?

Центры уведомлений Azure шифруют все непрочные данные клиента, за исключением тегов регистрации. По этой причине не следует хранить личные или конфиденциальные данные с помощью тегов.

### <a name="is-there-audit-log-capability"></a>Предусмотрена ли возможность ведения журнала аудита?

Да. Все операции по управлению Центрами уведомлений обновляются в журнале действий Azure, который представлен на [портале Azure]. Журнал действий Azure предлагает аналитические сведения об операциях, которые выполнялись с ресурсами в подписках. С помощью журнала действий можно ответить на вопросы что, кто и когда о любой операции записи (PUT, POST, DELETE) с ресурсами в вашей подписке. Вы также можете отслеживать состояние операции и другие ее свойства. Тем не менее журнал действий не содержит сведения об операции чтения (GET).

## <a name="monitoring-and-troubleshooting"></a>Мониторинг и устранение неполадок

### <a name="what-troubleshooting-capabilities-are-available"></a>Какие возможности для устранения неполадок доступны?

Центры уведомлений Azure предоставляют несколько функциональных возможностей для устранения неполадок, особенно в наиболее распространенном случае удаления уведомлений. Дополнительные сведения см. в техническом документе [Центры уведомлений Azure — рекомендации по диагностике].

### <a name="what-telemetry-features-are-available"></a>Какие телеметрические функции доступны?

Центры уведомлений Microsoft Azure позволяют просматривать данные телеметрии на [портале Azure]. Дополнительные сведения о доступных метриках в Центрах уведомлений см. на [этой странице].

Можно также программно получить доступ к метрикам. Дополнительные сведения см. в следующих статьях:

- [Получение метрик Azure Monitor с помощью .NET](https://azure.microsoft.com/resources/samples/monitor-dotnet-metrics-api/). В этом примере используются имя пользователя и пароль. Чтобы использовать сертификат, перегрузите метод ФромсервицепринЦипал, чтобы предоставить сертификат, как показано в [этом примере](https://github.com/Azure/azure-libraries-for-net/blob/master/src/ResourceManagement/ResourceManager/Authentication/AzureCredentialsFactory.cs). 
- [Получение метрик и журналов действий для ресурса](https://azure.microsoft.com/resources/samples/monitor-dotnet-query-metrics-activitylogs/)
- [Пошаговое руководство по REST API Azure Monitor](../azure-monitor/essentials/rest-api-walkthrough.md)

> [!NOTE]
> Успешные уведомления означают, что push-уведомления были доставлены внешнему PNSу (например, APNs для iOS и macOS или FCM для устройств Android). Службы PNS отвечают за доставку уведомлений на целевые устройства. Как правило, служба PNS не предоставляет метрики доставки третьим лицам.  

[Портал Azure]: https://portal.azure.com
[Цены на центры уведомлений]: https://azure.microsoft.com/pricing/details/notification-hubs/
[Notification Hubs SLA]: https://azure.microsoft.com/support/legal/sla/
[Использование интерфейса REST центров уведомлений]: /previous-versions/azure/reference/dn530746(v=azure.100)
[Mobile Services Pricing]: https://azure.microsoft.com/pricing/details/mobile-services/
[Регистрация из внутренней службы приложения]: /previous-versions/azure/azure-services/dn743807(v=azure.100)
[Управление регистрацией]: /previous-versions/azure/azure-services/dn530747(v=azure.100)
[Безопасность]: /previous-versions/azure/azure-services/dn495373(v=azure.100)
[Безопасные push-уведомления посредством центров уведомлений Azure]: ./notification-hubs-aspnet-backend-ios-push-apple-apns-secure-notification.md
[Центры уведомлений Azure — рекомендации по диагностике]: ./notification-hubs-push-notification-fixer.md
[Метрики]: ../azure-monitor/essentials/metrics-supported.md#microsoftnotificationhubsnamespacesnotificationhubs
[Экспорт и импорт регистраций]: ./export-modify-registrations-bulk.md
[Портал Azure]: https://portal.azure.com
[complete samples]: https://github.com/Azure/azure-notificationhubs-samples
[App Service Pricing]: https://azure.microsoft.com/pricing/details/app-service/
