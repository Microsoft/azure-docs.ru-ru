---
title: Устранение неполадок при сбоях среды выполнения U-SQL Azure Data Lake Analytics
description: Узнайте, как устранять неполадки во время выполнения U-SQL.
ms.reviewer: jasonh
ms.service: data-lake-analytics
ms.topic: troubleshooting
ms.date: 10/10/2019
ms.openlocfilehash: 1236b83b410057e55015391772e37bd461a448d0
ms.sourcegitcommit: 910a1a38711966cb171050db245fc3b22abc8c5f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/20/2021
ms.locfileid: "102030619"
---
# <a name="learn-how-to-troubleshoot-u-sql-runtime-failures-due-to-runtime-changes"></a>Сведения об устранении сбоев среды выполнения U-SQL из-за изменений среды выполнения

Среда выполнения U-SQL Azure Data Lake, включая компилятор, оптимизатор и диспетчер заданий, обрабатывается вашим кодом U-SQL.

## <a name="choosing-your-u-sql-runtime-version"></a>Выбор версии среды выполнения U-SQL

При отправке заданий U-SQL из Visual Studio, пакета SDK ADL или портала Azure Data Lake Analytics в задании будет использоваться текущая доступная среда выполнения по умолчанию. Новые версии среды выполнения U-SQL выпускаются на регулярной основе и включают как небольшие обновления, так и исправления безопасности.

Можно также выбрать пользовательскую версию среды выполнения. так как вы хотите испытать новое обновление, необходимо остаться на более старой версии среды выполнения или предоставить исправление для обнаруженной проблемы, при которой невозможно подождать регулярного обновления.

> [!CAUTION]
> Если вы выберете среду выполнения, которая отличается от среды по умолчанию, ваши задания U-SQL, возможно, перестанут выполняться. Используйте эти версии только для тестирования.

В редких случаях служба поддержки Майкрософт может закрепить другую версию среды выполнения по умолчанию для вашей учетной записи. Убедитесь, что вы отменяете этот ПИН-код как можно скорее. Если вы сохранили прикрепление к этой версии, срок ее действия истечет позже.

### <a name="monitoring-your-jobs-u-sql-runtime-version"></a>Мониторинг заданий версия среды выполнения U-SQL

Вы можете просмотреть историю, в которой в журнале заданий вашей учетной записи использовалась версия среды выполнения предыдущих заданий, используя обозреватель заданий Visual Studio или журнал заданий портал Azure.

1. На портале Azure выберите свою учетную запись Data Lake Analytics.
2. Выберите **Просмотреть все задания**. Появится список всех активных и недавно завершенных заданий в учетной записи.
3. При необходимости щелкните **Фильтр** для поиска заданий по значениям **Диапазон времени**, **Имя задания** и **Автор**.
4. Вы видите среду выполнения, используемую в завершенных заданиях.

![Отображение версии среды выполнения прошлого задания](./media/runtime-troubleshoot/prior-job-usql-runtime-version-.png)

Доступные версии среды выполнения со временем меняются. Среда выполнения по умолчанию всегда называется "по умолчанию", и в течение некоторого времени сохраняется по крайней мере Предыдущая среда выполнения, а специальные среды выполнения могут быть доступны по разным причинам. Явно именованные среды выполнения обычно выполняются в следующем формате (курсив используется для переменных частей, а [] указывает на необязательные части):

release_YYYYMMDD_adl_buildno [_modifier]

Например, release_20190318_adl_3394512_2 означает, что вторая версия сборки 3394512 выпуска среды выполнения в марте 18 2019 и release_20190318_adl_3394512_private означает частную сборку того же выпуска. Примечание. Дата связана с моментом последнего возврата для этого выпуска и необязательной официальной датой выпуска.


## <a name="troubleshooting-u-sql-runtime-version-issues"></a>Устранение проблем с версиями среды выполнения U-SQL

Существует две возможные проблемы с версией среды выполнения, которые могут возникнуть:

1. Сценарий или некоторый пользовательский код изменяет поведение одного выпуска на следующий. Такие критические изменения обычно сообщаются заранее с публикацией заметок о выпуске. Если вы столкнулись с таким критическим изменением, обратитесь в служба поддержки Майкрософт, чтобы сообщить о нарушении этого поведения (если оно еще не документировано) и отправьте задания в более старую версию среды выполнения.

2. Вы использовали среду выполнения, отличную от среды по умолчанию, явно или неявно, если она была закреплена в вашей учетной записи, и эта среда выполнения была удалена через некоторое время. Если вы столкнулись с отсутствующими средами выполнения, обновите сценарии, чтобы они выполнялись в текущей среде выполнения по умолчанию. Если вам требуется дополнительное время, обратитесь в служба поддержки Майкрософт

## <a name="known-issues"></a>Известные проблемы

1. Ссылка на Newtonsoft.Jsв файле версии 12.0.3 или выше в скрипте USQL вызовет следующую ошибку компиляции:

    *«К сожалению, задания, выполняемые в учетной записи Data Lake Analytics, скорее всего, будут выполняться медленнее или не смогут завершиться. Непредвиденная проблема мешает автоматически восстановить эту функцию в учетной записи Azure Data Lake Analytics. У инженеров Azure Data Lake был обращен к анализу».*  

    Где стек вызовов будет содержать:  
    `System.IndexOutOfRangeException: Index was outside the bounds of the array.`  
    `at Roslyn.Compilers.MetadataReader.PEFile.CustomAttributeTableReader.get_Item(UInt32 rowId)`  
    `...`

    **Решение**. Используйте Newtonsoft.Jsв файле v 12.0.2 или ниже.
2. Клиенты могут видеть временные файлы и папки в своем хранилище. Они создаются в рамках обычного выполнения задания, но обычно удаляются до того, как клиенты увидят их. При определенных обстоятельствах, которые являются редкими и случайными, они могут оставаться видимыми в течение определенного периода времени. Они в конечном итоге удаляются и никогда не учитываются как часть хранилища пользователей или создают любые формы выплат. В зависимости от логики заданий клиентов они могут вызывать проблемы. Например, если задание перечисляет все файлы в папке, а затем сравнивает списки файлов, может произойти сбой из-за непредвиденных временных файлов. Аналогично, если подчиненное задание перечисляет все файлы из указанной папки для дальнейшей обработки, оно также может перечислить временные файлы.  

    **Решение**. в среде выполнения обнаружено исправление, где временные файлы будут храниться в временной папке уровня учетной записи, отличной от текущей выходной папки. Временные файлы будут записаны в эту новую временную папку и будут удалены в конце выполнения задания.  
    Поскольку это исправление обрабатывает данные клиентов, крайне важно, чтобы это исправление было проверено в MSFT перед его отправкой. Это исправление должно быть доступно в качестве бета-версии среды выполнения в середине 2021 и в качестве среды выполнения по умолчанию во второй половине года 2021. 


## <a name="see-also"></a>См. также раздел

- [Обзор аналитики озера данных Azure](data-lake-analytics-overview.md)
- [Управление Azure Data Lake Analytics с помощью портал Azure](data-lake-analytics-manage-use-portal.md)
- [Мониторинг заданий в Azure Data Lake Analytics с помощью портал Azure](data-lake-analytics-monitor-and-troubleshoot-jobs-tutorial.md)
