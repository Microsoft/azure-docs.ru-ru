---
title: Развертывание SQL Azure для пограничных вычислений с помощью Docker — SQL Azure для пограничных вычислений
description: Cведения о развертывании SQL Azure для пограничных вычислений с помощью Docker.
keywords: sql azure для пограничных вычислений, контейнер, docker
services: sql-edge
ms.service: sql-edge
ms.topic: quickstart
author: SQLSourabh
ms.author: sourabha
ms.reviewer: sstein
ms.date: 09/22/2020
ms.openlocfilehash: fce098767fffd36376399bbd9396699e3d9fbfd3
ms.sourcegitcommit: f28ebb95ae9aaaff3f87d8388a09b41e0b3445b5
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/29/2021
ms.locfileid: "93392084"
---
# <a name="deploy-azure-sql-edge-with-docker"></a>Развертывание SQL Azure для пограничных вычислений с помощью Docker

Это краткое руководство описывает использование Docker для извлечения и запуска образа контейнера SQL Azure для пограничных вычислений. Затем мы подключимся при помощи **sqlcmd** для создания первой базы данных и выполнения запросов.

Этот образ состоит из SQL Azure для пограничных вычислений на основе Ubuntu 18.04. Он может использоваться с Dосker Engine 1.8+ на Linux или Docker для Mac или Windows.

## <a name="prerequisites"></a>предварительные требования

- Docker Engine 1.8+ на любом поддерживаемом дистрибутиве Linux или Docker для Mac или Windows. Дополнительные сведения см. в разделе [Установка Docker](https://docs.docker.com/engine/installation/). Так как образы SQL Azure для пограничных вычислений основаны на Ubuntu 18.04, рекомендуется использовать узел Docker для Ubuntu 18.04.
- Драйвер хранилища **overlay2** Docker. По умолчанию он используется большинством пользователей. Если вы не используете этот поставщик хранилища и хотите изменить его, см. инструкции и предупреждения в [документации по Docker для настройки overlay2](https://docs.docker.com/storage/storagedriver/overlayfs-driver/#configure-docker-with-the-overlay-or-overlay2-storage-driver).
- Не менее 10 ГБ места на диске.
- Не менее 1 ГБ ОЗУ.
- [Требования к оборудованию для SQL Azure для пограничных вычислений](./features.md#hardware-support).


## <a name="pull-and-run-the-container-image"></a>Извлечение и запуск образа контейнера

Перед выполнением следующих действий убедитесь, что вы выбрали предпочтительную оболочку (Bash, PowerShell или CMD) в начале этой статьи.

1. Извлеките образ контейнера SQL Azure для пограничных вычислений из Реестра контейнеров Майкрософт.

    - Извлечение образа контейнера SQL Azure для пограничных вычислений
        ```bash
        sudo docker pull mcr.microsoft.com/azure-sql-edge:latest 
        ```

> [!NOTE]
> Для команд Bash в этой статье используется `sudo`. В macOS и Windows sudo может не потребоваться. В Linux, если вы не хотите использовать sudo для запуска Docker, можно настроить группу Docker и добавить в нее пользователей. Дополнительные сведения см. в статье [Действия после установки для Linux](https://docs.docker.com/engine/install/linux-postinstall/).

Предыдущая команда извлекает последние образы контейнеров SQL Azure для пограничных вычислений. Список всех доступных образов см. на странице [azure-sql-egde](https://hub.docker.com/_/microsoft-azure-sql-edge) центра Docker.

2. Чтобы запустить образ контейнера с помощью Docker, выполните следующую команду в оболочке bash (Linux или macOS) или в командной строке PowerShell с повышенными привилегиями.
    
    - Запуск экземпляра SQL Azure для пограничных вычислений, выполняемого в качестве выпуска Developer
        ```bash
        sudo docker run --cap-add SYS_PTRACE -e 'ACCEPT_EULA=1' -e 'MSSQL_SA_PASSWORD=yourStrong(!)Password' -p 1433:1433 --name azuresqledge -d mcr.microsoft.com/azure-sql-edge
        ```

    - Запуск экземпляра SQL Azure для пограничных вычислений, выполняемого в качестве выпуска Premium
        ```bash
        sudo docker run --cap-add SYS_PTRACE -e 'ACCEPT_EULA=1' -e 'MSSQL_SA_PASSWORD=yourStrong(!)Password' -e 'MSSQL_PID=Premium' -p 1433:1433 --name azuresqledge -d mcr.microsoft.com/azure-sql-edge
        ```
    > [!NOTE]
    > Если вы используете PowerShell в Windows для выполнения этих команд, используйте двойные кавычки вместо одинарных.


    > [!NOTE]
    > Пароль должен соответствовать политике паролей ядра СУБД Microsoft SQL по умолчанию. В противном случае контейнер не сможет настроить ядро SQL и прекратит работу. По умолчанию пароль должен состоять не менее чем из восьми символов и содержать символы как минимум трех из четырех наборов: прописные и строчные буквы, 10 основных цифр и специальные символы. Проверить журнал ошибок можно, выполнив команду [docker logs](https://docs.docker.com/engine/reference/commandline/logs/).
    
    Следующая таблица содержит описание параметров запуска команды `docker run` из предыдущего примера.

    | Параметр | Описание |
    |-----|-----|
    | **-e "ACCEPT_EULA=Y"** |  Присвойте переменной **ACCEPT_EULA** любое значение, чтобы подтвердить свое согласие с [лицензионным соглашением](https://go.microsoft.com/fwlink/?linkid=2139274). Обязательный параметр для образа SQL Azure для пограничных вычислений. |
    | **-e "MSSQL_SA_PASSWORD=yourStrong(!)Password"** | Укажите свой надежный пароль длиной не меньше восьми символов, соответствующий [требованиям к паролям в SQL Azure для пограничных вычислений](/sql/relational-databases/security/password-policy). Обязательный параметр для образа SQL Azure для пограничных вычислений. |
    | **-p 1433:1433** | Сопоставление TCP-порта среды узла (первое значение) с TCP-портом в контейнере (второе значение). В нашем примере SQL Azure для пограничных вычислений прослушивает TCP-порт 1433 в контейнере, который перенаправляется на порт 1433 на узле. |
    | **--name azuresqledge** | Укажите свое имя для контейнера вместо сгенерированного случайным образом. При запуске нескольких контейнеров использовать одинаковые имена запрещено. |
    | **-d** | Запустите контейнер в фоновом режиме (управляющая программа) |

    Полный список всех переменных среды SQL Azure для пограничных вычислений см. в разделе [Настройка SQL Azure для пограничных вычислений с переменными среды](configure.md#configure-by-using-environment-variables). Чтобы настроить контейнеры SQL Azure для пограничных вычислений, можно также использовать файл [mssql.conf](configure.md#configure-by-using-an-mssqlconf-file).

3. Для просмотра ваших контейнеров Docker используйте команду `docker ps`.
   
   ```bash
    sudo docker ps -a
   ```

4. Если в столбце **STATUS** (Состояние) отображается состояние **Up** (Запущен), то SQL Azure для пограничных вычислений выполняется в контейнере и прослушивает порт, указанный в столбце **PORTS** (Порты). Если в столбце **STATUS** (Состояние) контейнера с SQL Azure для пограничных вычислений отображается **Exited** (Завершен), ознакомьтесь с разделом по устранению неполадок документации по SQL Azure для пограничных вычислений.

    Параметр `-h` (имя узла) может оказаться полезен, но для простоты в этом учебнике он не описывается. Он изменяет внутреннее имя контейнера на пользовательское значение. Это имя отображается при выполнении следующего запроса Transact-SQL.

    ```sql
    SELECT @@SERVERNAME,
        SERVERPROPERTY('ComputerNamePhysicalNetBIOS'),
        SERVERPROPERTY('MachineName'),
        SERVERPROPERTY('ServerName')
    ```

    Установка параметров `-h` и `--name` равными позволяет легко идентифицировать целевой контейнер.

5. В качестве последнего шага измените пароль SA, так как `SA_PASSWORD` отображается в выходных данных `ps -eax` и хранится в переменной среды с тем же именем. См. действия ниже.

## <a name="change-the-sa-password"></a>Смена пароля администратора

Учетная запись **SA** обладает правами администратора на экземпляре SQL Azure для пограничных вычислений, создаваемом во время установки. После создания контейнера SQL Azure для пограничных вычислений указанную вами переменную среды `MSSQL_SA_PASSWORD` можно обнаружить, запустив `echo $SA_PASSWORD` в контейнере. В целях безопасности смените пароль SA.

1. Назначьте для пользователя SA надежный пароль.

2. Используйте `docker exec` для запуска **sqlcmd**, чтобы изменить пароль с помощью Transact-SQL. В следующем примере замените старый пароль `<YourStrong!Passw0rd>` и новый пароль `<YourNewStrong!Passw0rd>`собственными паролями.

   ```bash
   sudo docker exec -it azuresqledge /opt/mssql-tools/bin/sqlcmd \
      -S localhost -U SA -P "<YourStrong@Passw0rd>" \
      -Q 'ALTER LOGIN SA WITH PASSWORD="<YourNewStrong@Passw0rd>"'
   ```

## <a name="connect-to-azure-sql-edge"></a>Подключение к службе SQL Azure для пограничных вычислений

На следующем шаге воспользуемся средством командной строки SQL Azure для пограничных вычислений **sqlcmd** внутри контейнера для подключения к SQL Azure для пограничных вычислений.

> [!NOTE]
> Средство sqlcmd недоступно в ARM64 версии контейнеров SQL для пограничных вычислений.

1. Выполните команду `docker exec -it`, чтобы запустить интерактивную оболочку bash внутри запущенного контейнера. В следующем примере `azuresqledge` — это имя, заданное в параметре `--name` при создании контейнера.

   ```bash
   sudo docker exec -it azuresqledge "bash"
   ```

2. После входа в контейнер подключитесь локально с помощью sqlcmd. Средство sqlcmd не включено в путь по умолчанию, поэтому необходимо указать полный путь.

   ```bash
   /opt/mssql-tools/bin/sqlcmd -S localhost -U SA -P "<YourNewStrong@Passw0rd>"
   ```

   > [!TIP]
   > Вы можете опустить пароль в командной строке. В этом случае вы получите приглашение для его ввода.

3. Если все сработает должным образом, вы перейдете к приглашению команды **sqlcmd**: `1>`.

## <a name="create-and-query-data"></a>Создание и запрос данных

В следующих разделах приведено пошаговое руководство по созданию базы данных, добавлению данных и запуску простого запроса с использованием **sqlcmd** и Transact-SQL.

### <a name="create-a-new-database"></a>Создание базы данных

Выполните следующие шаги, чтобы создать базу данных `TestDB`.

1. В приглашении команды **sqlcmd** вставьте следующую команду Transact-SQL, чтобы создать тестовую базу данных:

   ```sql
   CREATE DATABASE TestDB
   Go
   ```

2. В следующей строке напишите запрос, который должен вернуть имена всех баз данных на сервере:

   ```sql
   SELECT Name from sys.Databases
   Go
   ```

### <a name="insert-data"></a>Добавление данных

Теперь создайте таблицу `Inventory` и вставьте две новых строки.

1. В приглашении команды **sqlcmd** переключите контекст на новую базу данных `TestDB`:

   ```sql
   USE TestDB
   ```

2. Создайте таблицу `Inventory`:

   ```sql
   CREATE TABLE Inventory (id INT, name NVARCHAR(50), quantity INT)
   ```

3. Вставьте данные в новую таблицу:

   ```sql
   INSERT INTO Inventory VALUES (1, 'banana', 150); INSERT INTO Inventory VALUES (2, 'orange', 154);
   ```

4. Введите `GO`, чтобы выполнить предыдущие команды:

   ```sql
   GO
   ```

### <a name="select-data"></a>Выбор данных

Теперь выполните запрос, чтобы вернуть данные из таблицы `Inventory`.

1. В приглашении команды **sqlcmd** введите запрос, который должен вернуть из таблицы `Inventory` строки, где количество превышает 152:

   ```sql
   SELECT * FROM Inventory WHERE quantity > 152;
   ```

2. Выполните команду:

   ```sql
   GO
   ```

### <a name="exit-the-sqlcmd-command-prompt"></a>Выход из приглашения команды sqlcmd

1. Чтобы завершить сеанс **sqlcmd**, введите `QUIT`:

   ```sql
   QUIT
   ```

2. Чтобы выйти из интерактивной командной строки в контейнере, введите команду `exit`. Контейнер продолжит работать после выхода из интерактивной оболочки bash.

## <a name="connect-from-outside-the-container"></a> Подключение из-за пределов контейнера

Подключиться к экземпляру SQL Azure для пограничных вычислений на компьютере Docker можно также с помощью любого внешнего инструмента в macOS, Windows или Linux, поддерживающего подключения SQL. Дополнительные сведения о подключении к контейнеру SQL для пограничных вычислений из внешней среды см. в [этой статье](connect.md).

## <a name="remove-your-container"></a>Удаление контейнера

Чтобы удалить контейнер SQL для пограничных вычислений, используемый в этом учебнике, выполните следующие команды.

```bash
sudo docker stop azuresqledge
sudo docker rm azuresqledge
```

> [!WARNING]
> Остановка и удаление контейнера безвозвратно удаляет все данные SQL для пограничных вычислений в контейнере. Чтобы сохранить данные, [создайте и скопируйте файл резервной копии за пределы контейнера](backup-restore.md) или используйте [метод постоянного хранения данных контейнера](configure.md#persist-your-data).

## <a name="next-steps"></a>Next Steps

- [Машинное обучение и искусственный интеллект с использованием ONNX в SQL для пограничных вычислений](onnx-overview.md)
- [Создание комплексного решения для Интернета вещей с использованием SQL для пограничных вычислений на основе IoT Edge](tutorial-deploy-azure-resources.md).
- [Потоковая передача данных в SQL Azure для пограничных вычислений](stream-data.md)