---
title: Использование Политики Azure для применения конфигураций кластера в требуемом масштабе (предварительная версия)
services: azure-arc
ms.service: azure-arc
ms.date: 02/15/2021
ms.topic: article
author: mlearned
ms.author: mlearned
description: Использование Политики Azure для применения конфигураций кластера в требуемом масштабе
keywords: Kubernetes, Arc, Azure, K8s, контейнеры
ms.openlocfilehash: 23cd42458c396afd31741c648d713934250a4112
ms.sourcegitcommit: e559daa1f7115d703bfa1b87da1cf267bf6ae9e8
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/17/2021
ms.locfileid: "100587805"
---
# <a name="use-azure-policy-to-apply-cluster-configurations-at-scale-preview"></a>Использование Политики Azure для применения конфигураций кластера в требуемом масштабе (предварительная версия)

## <a name="overview"></a>Обзор

Вы можете использовать политику Azure, чтобы применить к одному из следующих ресурсов `Microsoft.KubernetesConfiguration/sourceControlConfigurations` :
*  `Microsoft.Kubernetes/connectedclusters` ресурсов.
* Ресурс с поддержкой Гитопс `Microsoft.ContainerService/managedClusters` . 

Чтобы использовать политику Azure, выберите существующее определение политики и Создайте назначение политики. При создании назначения политики:
1. Задайте область для назначения.
    * Областью действия будет группа ресурсов или подписка Azure. 
2. Задайте параметры `sourceControlConfiguration` , которые будут созданы. 

После создания назначения обработчик политик Azure определяет все `connectedCluster` `managedCluster` ресурсы, расположенные в области, и применяет их `sourceControlConfiguration` к каждому из них.

Вы можете включить несколько репозиториев Git в качестве источников истинности для каждого кластера, используя несколько назначений политик. Каждое назначение политики будет настроено для использования другого репозитория Git. Например, один репозиторий для центрального ИТ-оператора или кластера и другие репозиториев для групп приложений.

## <a name="prerequisite"></a>Предварительное требование

Убедитесь, что у вас есть `Microsoft.Authorization/policyAssignments/write` разрешения на область (подписку или группу ресурсов), в которой будет создано это назначение политики.

## <a name="create-a-policy-assignment"></a>Создание назначения политики

1. В портал Azure перейдите к **политике**.
1. В разделе **Разработка** боковой панели выберите **определения**.
1. В категории "Kubernetes" выберите встроенную политику "развернуть Гитопс в кластере Kubernetes". 
1. Щелкните **Назначить**.
1. Укажите в качестве **области** группу управления, подписку или группу ресурсов, к которым будет применяться назначение политики.
    * Если требуется исключить все ресурсы из области политики, задайте **исключения**.
1. Присвойте назначению политики легко узнаваемое **имя** и **Описание**.
1. Убедитесь, что для **применения политики** задано значение **включено**.
1. Выберите **Далее**.
1. Задайте значения параметров, которые будут использоваться при создании `sourceControlConfiguration` .
1. Выберите **Далее**.
1. Включите параметр **Создание задачи исправления**.
1. Убедитесь, что установлен флажок **создать управляемое удостоверение** и что удостоверение будет иметь разрешения **участника** . 
    * Дополнительные сведения см. в статье [Создание назначения политики](../../governance/policy/assign-policy-portal.md) и [исправление несоответствующих ресурсов с помощью политики Azure](../../governance/policy/how-to/remediate-resources.md).
1. Выберите **Review + create** (Просмотреть и создать).

После создания назначения политики `sourceControlConfiguration` будет применяться к любому из следующих ресурсов, расположенных в области назначения.
* Новые `connectedCluster` ресурсы.
* Новые `managedCluster` ресурсы с установленными агентами гитопс. 

Для существующих кластеров необходимо вручную запустить задачу исправления. Для того чтобы назначение политики вступило в силу, эта задача обычно занимает от 10 до 20 минут.

## <a name="verify-a-policy-assignment"></a>Проверка назначения политики

1. В портал Azure перейдите к одному из `connectedCluster` ресурсов.
1. В разделе **Параметры** боковой панели выберите **политики**. 
    * Интерфейс взаимодействия с кластером AKS еще не реализован.
    * В списке политики вы увидите созданное ранее назначение политики с **состоянием соответствия** , установленным как *соответствующее*.
1. В разделе **Параметры** боковой панели выберите пункт **Конфигурации**.
    * В списке конфигурации вы увидите `sourceControlConfiguration` , что назначение политики было создано.
1. Используйте `kubectl` для опроса кластера. 
    * Должно отобразиться пространство имен и артефакты, созданные `sourceControlConfiguration` .
    * В течение 5 минут в кластере должны появиться артефакты, описанные в манифестах в настроенном репозитории Git.

## <a name="next-steps"></a>Дальнейшие действия

* [Настройка Azure Monitor для контейнеров с кластерами Kubernetes с поддержкой Arc](../../azure-monitor/containers/container-insights-enable-arc-enabled-clusters.md)
