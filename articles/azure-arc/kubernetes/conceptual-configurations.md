---
title: Конфигурации и Гитопс — служба "Дуга Azure" включена Kubernetes
services: azure-arc
ms.service: azure-arc
ms.date: 02/15/2021
ms.topic: conceptual
author: shashankbarsin
ms.author: shasb
description: В этой статье приводятся общие сведения о Гитопс и функциях настройки для Kubernetes с поддержкой ARC в Azure.
keywords: Kubernetes, дуга, Azure, контейнеры, конфигурация, Гитопс
ms.openlocfilehash: 780c3c5c578c8a9b12eb7dda711070790477ac5f
ms.sourcegitcommit: de98cb7b98eaab1b92aa6a378436d9d513494404
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/17/2021
ms.locfileid: "100561702"
---
# <a name="configurations-and-gitops-with-azure-arc-enabled-kubernetes"></a>Конфигурации и Гитопс с включенной службой Arc Azure Kubernetes

В связи с Kubernetes Гитопс — это практика объявления требуемого состояния конфигураций кластера Kubernetes (развертываний, пространств имен и т. д.) в репозитории Git. За этим объявлением следует развертывание этих конфигураций кластера с помощью опроса и на основе запроса, используя оператор. Репозиторий Git может содержать:
* YAML-Format манифесты, описывающие любые допустимые ресурсы Kubernetes, включая пространства имен, Конфигмапс, развертывания, Daemonset и т. д.
* Helm диаграммы для развертывания приложений.

[Flux](https://docs.fluxcd.io/), популярное средство с открытым кодом в гитопс пространстве, можно развернуть в кластере Kubernetes, чтобы упростить поток конфигураций из репозитория Git в кластер Kubernetes. Flux поддерживает развертывание своего оператора в областях кластера и пространства имен. Оператор Flux, развернутый с областью пространства имен, может развертывать только объекты Kubernetes в определенном пространстве имен. Возможность выбора между кластером или областью пространства имен позволяет получить многоклиентские шаблоны развертывания в одном кластере Kubernetes.

## <a name="configurations"></a>Конфигурации

[![Архитектура ](./media/conceptual-configurations.png) конфигураций](./media/conceptual-configurations.png#lightbox)

Подключение между кластером и репозиторием Git создается как `Microsoft.KubernetesConfiguration/sourceControlConfigurations` ресурс расширения на основе ресурса Kubernetes, включенного в дугу Azure (представленного `Microsoft.Kubernetes/connectedClusters` ) в Azure Resource Manager. 

`sourceControlConfiguration`Свойства ресурсов используются для развертывания оператора Flux в кластере с соответствующими параметрами, такими как репозиторий Git, из которого запрашиваются манифесты, и интервал опроса, по которому их можно извлечь. `sourceControlConfiguration`Данные хранятся в зашифрованном виде в базе данных Azure Cosmos DB для обеспечения конфиденциальности данных.

`config-agent`Работающий в кластере отвечает за следующее:
* Отслеживание новых или обновленных `sourceControlConfiguration` ресурсов расширения в ресурсе Kubernetes с включенной службой "Дуга Azure".
* Развертывание оператора Flux для просмотра репозитория Git для каждого из них `sourceControlConfiguration` .
* Применение любых обновлений, внесенных в любые `sourceControlConfiguration` . 

Вы можете создать несколько ресурсов области пространства имен `sourceControlConfiguration` в кластере Kubernetes с включенной службой Arc Azure для достижения нескольких из них.

> [!NOTE]
> * Так как `config-agent` мониторы для новых или обновленных `sourceControlConfiguration` ресурсов расширения будут доступны в ресурсе Kubernetes с включенной службой Arc Azure, агентам требуется подключение, чтобы требуемое состояние было извлечено в кластер. Когда агенты не могут подключиться к Azure, свойства требуемого состояния, объявленные в `sourceControlConfiguration` ресурсе в Azure Resource Manager, не применяются к кластеру.
> * Конфиденциальные данные клиента, такие как закрытый ключ, содержимое узла, имя пользователя HTTPS и маркер или пароль, не хранятся более 48 часов в службе "Дуга" с включенной службой Kubernetes. Если вы используете конфиденциальные данные для конфигураций, рекомендуется перевести кластеры в режим «в сети» как можно чаще.

## <a name="apply-configurations-at-scale"></a>Применение конфигураций в масштабе

Так как Azure Resource Manager управляет конфигурациями, вы можете использовать политику Azure для автоматизации создания той же конфигурации во всех ресурсах Kubernetes, поддерживающих службу Arc Azure, в области действия подписки или группы ресурсов. 

Такое применение при масштабировании гарантирует, что общая базовая конфигурация (содержащая конфигурации, такие как Клустерролебиндингс, Ролебиндингс и Нетворкполици) может быть применена ко всему парку или инвентаризации в кластерах Kubernetes, включенных в дугу Azure.

## <a name="next-steps"></a>Дальнейшие действия

* [Подключение кластера к службе "Дуга Azure"](./connect-cluster.md)
* [Создание конфигураций в кластере Kubernetes с включенной Arc](./use-gitops-connected-cluster.md)
* [Использование политики Azure для применения конфигураций в масштабе](./use-azure-policy.md)