---
title: Конфигурации и Гитопс — служба "Дуга Azure" включена Kubernetes
services: azure-arc
ms.service: azure-arc
ms.date: 03/02/2021
ms.topic: conceptual
author: shashankbarsin
ms.author: shasb
description: В этой статье приводятся общие сведения о Гитопс и функциях настройки для Kubernetes с поддержкой ARC в Azure.
keywords: Kubernetes, дуга, Azure, контейнеры, конфигурация, Гитопс
ms.openlocfilehash: 88a30876b25730e4cb0b4b1e19fac94b9e556adc
ms.sourcegitcommit: dac05f662ac353c1c7c5294399fca2a99b4f89c8
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/04/2021
ms.locfileid: "102121802"
---
# <a name="configurations-and-gitops-with-azure-arc-enabled-kubernetes"></a>Конфигурации и Гитопс с включенной службой Arc Azure Kubernetes

В связи с Kubernetes Гитопс — это практика объявления требуемого состояния конфигураций кластера Kubernetes (развертываний, пространств имен и т. д.) в репозитории Git. За этим объявлением следует развертывание этих конфигураций кластера с помощью опроса и на основе запроса, используя оператор. Репозиторий Git может содержать:
* YAML-Format манифесты, описывающие любые допустимые ресурсы Kubernetes, включая пространства имен, Конфигмапс, развертывания, Daemonset и т. д.
* Helm диаграммы для развертывания приложений.

[Flux](https://docs.fluxcd.io/)— популярное средство с открытым исходным кодом в гитопс пространстве, можно развернуть в кластере Kubernetes, чтобы упростить поток конфигураций из репозитория Git в кластер Kubernetes. Flux поддерживает развертывание своего оператора в областях кластера и пространства имен. Оператор Flux, развернутый с областью пространства имен, может развертывать только объекты Kubernetes в определенном пространстве имен. Возможность выбора между кластером или областью пространства имен позволяет получить многоклиентские шаблоны развертывания в одном кластере Kubernetes.

## <a name="configurations"></a>Конфигурации

[![Архитектура ](./media/conceptual-configurations.png) конфигураций](./media/conceptual-configurations.png#lightbox)

Подключение между кластером и репозиторием Git создается как ресурс конфигурации ( `Microsoft.KubernetesConfiguration/sourceControlConfigurations` ) поверх ресурса Kubernetes с поддержкой дуги Azure (представленного `Microsoft.Kubernetes/connectedClusters` ) в Azure Resource Manager. 

Свойства ресурса конфигурации используются для развертывания оператора Flux в кластере с соответствующими параметрами, такими как репозиторий Git, из которого нужно извлечь манифесты, и интервал опроса, по которому их можно извлечь. Данные ресурсов конфигурации хранятся в зашифрованном виде в базе данных Azure Cosmos DB для обеспечения конфиденциальности данных.

`config-agent`Работающий в кластере отвечает за следующее:
* Отслеживание новых или обновленных ресурсов конфигурации в ресурсе Kubernetes с включенной службой "Дуга Azure".
* Развертывание оператора Flux для просмотра репозитория Git для каждого ресурса конфигурации.
* Применение любых обновлений, внесенных в любой ресурс конфигурации. 

Вы можете создать несколько ресурсов конфигурации уровня пространства имен в одном кластере Kubernetes с включенной службой "Дуга Azure" для достижения многопользовательской аренды.

> [!NOTE]
> * `config-agent` отслеживает новые или обновленные ресурсы конфигурации, которые должны быть доступны в ресурсе Kubernetes с включенной ARC. Таким же агентам требуется подключение, чтобы требуемое состояние было извлечено в кластер. Если агентам не удается подключиться к Azure, возникает задержка при распространении требуемого состояния в кластер.
> * Конфиденциальные данные клиента, такие как закрытый ключ, содержимое узла, имя пользователя HTTPS и маркер или пароль, не хранятся более 48 часов в службе "Дуга" с включенной службой Kubernetes. Если для конфигураций используются конфиденциальные данные, переведите кластеры в режим «в сети» как можно чаще.

## <a name="apply-configurations-at-scale"></a>Применение конфигураций в масштабе

Так как Azure Resource Manager управляет конфигурациями, вы можете автоматизировать создание одинаковой конфигурации во всех ресурсах Kubernetes с поддержкой дуги Azure с помощью политики Azure в области подписки или группы ресурсов. 

Такое применение при масштабировании гарантирует, что общая базовая конфигурация (содержащая конфигурации, такие как Клустерролебиндингс, Ролебиндингс и Нетворкполици) может быть применена ко всему парку или инвентаризации в кластере с поддержкой ARC в Azure.

## <a name="next-steps"></a>Дальнейшие действия

* Пошаговое руководство по [подключению кластера Kubernetes к службе "Дуга Azure](./connect-cluster.md)".
* У вас уже есть кластер Kubernetes, подключенный к службе "Дуга Azure"? [Создайте конфигурации в кластере Kubernetes с включенной Arc](./use-gitops-connected-cluster.md).
* Узнайте, как [использовать политику Azure для применения конфигураций в масштабе](./use-azure-policy.md).