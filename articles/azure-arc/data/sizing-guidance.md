---
title: Руководство по определению размера
description: Спланируйте размер развертывания служб данных, поддерживающих службу "Дуга Azure".
services: azure-arc
ms.service: azure-arc
ms.subservice: azure-arc-data
author: twright-msft
ms.author: twright
ms.reviewer: mikeray
ms.date: 09/22/2020
ms.topic: how-to
ms.openlocfilehash: 6e7f2e445c3e4e8df7420c0587e156968f3a2c92
ms.sourcegitcommit: 867cb1b7a1f3a1f0b427282c648d411d0ca4f81f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "94542683"
---
# <a name="sizing-guidance"></a>Руководство по выбору размера

[!INCLUDE [azure-arc-data-preview](../../../includes/azure-arc-data-preview.md)]

## <a name="overview-of-sizing-guidance"></a>Обзор руководства по выбору размера

При планировании развертывания служб данных дуги Azure необходимо спланировать требуемый объем вычислительных ресурсов, памяти и хранилища, который потребуется для работы контроллера данных ARC в Azure, а также число PostgreSQL групп серверов, которые будут развертываться.  Поскольку службы данных, включенные в службу Arc Azure, развернуты на Kubernetes, у вас есть возможность гибко добавлять дополнительную емкость в кластер Kubernetes, добавляя дополнительные расчетные узлы или хранилище.  В этом руководстве приведены рекомендации по минимальным требованиям, а также приведены рекомендации по рекомендуемым размерам для некоторых распространенных требований.

## <a name="general-sizing-requirements"></a>Общие требования к размерам

> [!NOTE]
> Если вы не знакомы с понятиями, изложенными в этой статье, вы можете ознакомиться с дополнительными сведениями о [Kubernetes ресурсов](https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/) и [нотации размера Kubernetes](https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/#resource-units-in-kubernetes).

Числа ядер должны быть целым числом, которое больше или равно единице.

При использовании аздата для развертывания значения памяти должны быть указаны в степени двух чисел, т. е. с помощью суффиксов: Ki, MI или перечислить.

Значения предельного числа должны всегда быть больше, чем значение запроса, если оно указано.

Ограничение значений для ядер — это оплачиваемая метрика на управляемом экземпляре SQL и PostgreSQL масштабируемые группы серверов.

## <a name="minimum-deployment-requirements"></a>Минимальные требования к развертыванию

Минимальный размер развертывания служб данных, включенных в службу Arc Azure, можно считать контроллером данных ARC в Azure и одним управляемым экземпляром SQL, а также одной группой PostgreSQL Scale Server с двумя рабочими узлами.  Для этой конфигурации требуется по меньшей мере 16 ГБ ОЗУ и 4 ядра _доступной_ емкости в кластере Kubernetes.  Необходимо обеспечить минимальный размер Kubernetes узла (8 ГБ ОЗУ и 4 ядра) и общую емкость 16 ГБ ОЗУ на всех узлах Kubernetes.  Например, у вас может быть 1 узел с объемом ОЗУ 32 ГБ и 4 ядрами или иметь 2 узла с 16 ГБ ОЗУ и 4 ядрами.

Дополнительные сведения о размере хранилища см. в статье о [настройке хранилища](storage-configuration.md) .

## <a name="data-controller-sizing-details"></a>Сведения о размере контроллера данных

Контроллер данных — это коллекция модулей Pod, развернутых в кластере Kubernetes для предоставления API, службы контроллера, загрузчика, а также баз данных и панелей мониторинга.  В этой таблице описаны значения по умолчанию для запросов и ограничений памяти и ЦП.

|Имя объекта pod|Запрос ЦП|Запрос памяти|Ограничение ЦП|Предельный объем памяти|Примечания|
|---|---|---|---|---|---|
|**загрузчик**|100 млн|100Mi|200m|200Mi||
|**control**|400m|2Gi|1800m|2Gi||
|**контролдб**|200m|3Gi|800m|6Gi||
|**контролвд**|10 миллионов|100Mi|100 млн|200Mi||
|**логсдб**|200m|1600Mi|2|1600Mi||
|**логсуи**|100 млн|500Mi|2|2Gi||
|**метриксдб**|200m|800Mi|400m|2Gi||
|**метриксдк**|100 млн|200Mi|200m|300Mi|Метриксдк — это управляющий набор, который создается на каждом узле Kubernetes в кластере.  Числа в таблице указаны _для каждого узла_. Если задать Алловнодеметриксколлектион = false в файле профиля развертывания перед созданием контроллера данных, то набор управляющей программы метриксдк создаваться не будет.|
|**метриксуи**|20 млн|200Mi|500m|200Mi||
|**мгмтпрокси**|200m|250Mi|500m|500Mi||

Вы можете переопределить параметры по умолчанию для контролдб и управления модулями Pod в файле профиля развертывания или YAML контроллера.  Пример

```yaml
  resources:
    controller:
      limits:
        cpu: "1000m"
        memory: "3Gi"
      requests:
        cpu: "800m"
        memory: "2Gi"
    controllerDb:
      limits:
        cpu: "800m"
        memory: "8Gi"
      requests:
        cpu: "200m"
        memory: "4Gi"
```

Дополнительные сведения о размере хранилища см. в статье о [настройке хранилища](storage-configuration.md) .

## <a name="sql-managed-instance-sizing-details"></a>Сведения о размере управляемого экземпляра SQL

Каждый управляемый экземпляр SQL должен иметь следующие минимальные запросы ресурсов:
- Память: 2Gi
- Ядра: 1

Каждый созданный экземпляр Pod управляемого экземпляра SQL имеет три контейнера:

|Имя контейнера|Запрос ЦП|Запрос памяти|Ограничение ЦП|Предельный объем памяти|Примечания|
|---|---|---|---|---|---|
|флуентбит|100 млн|100Mi|Не указано|Не указано|Запросы ресурсов контейнера флуентбит _в дополнение к_ запросам, указанным для управляемого экземпляра SQL.||
|Дуга — склми|Пользователь указал или не указал.|Пользователь указал или не указал.|Пользователь указал или не указал.|Пользователь указал или не указал.||
|collectd|Не указано|Не указано|Не указано|Не указано||

Размер тома по умолчанию для всех постоянных томов — 5Gi.

## <a name="postgresql-hyperscale-server-group-sizing-details"></a>Сведения о размере группы серверов PostgreSQL Scale

Каждый узел PostgreSQL в масштабе группы серверов должен иметь следующие минимальные запросы на ресурсы:
- Память: 256Mi
- Ядра: 1

Каждый созданный координатор PostgreSQL или рабочий модуль группы серверов с тремя контейнерами:

|Имя контейнера|Запрос ЦП|Запрос памяти|Ограничение ЦП|Предельный объем памяти|Примечания|
|---|---|---|---|---|---|
|флуентбит|100 млн|100Mi|Не указано|Не указано|Запросы ресурсов контейнера флуентбит _в дополнение к_ запросам, указанным для узлов группы серверов PostgreSQL Scale.|
|postgres|Пользователь указал или не указал.|Указанный пользователем или 256Mi (по умолчанию).|Пользователь указал или не указал.|Пользователь указал или не указал.||
|Telegraf|Не указано|Не указано|Не указано|Не указано||

## <a name="cumulative-sizing"></a>Совокупное изменение размера

Общий размер среды, необходимый для служб данных, поддерживающих службу "Дуга Azure", в основном является функцией числа и размера создаваемых экземпляров базы данных.  Общий размер может быть трудно предсказать заранее, зная, что количество экземпляров будет увеличиваться и уменьшаться, и объем ресурсов, необходимых для каждого экземпляра базы данных, изменится.

Базовый размер для данной среды служб данных, включенной в службу Arc Azure, — это размер контроллера данных, для которого требуется 4 ядра и 16 ГБ ОЗУ.  Здесь можно добавить в верхнюю совокупную сумму ядер и памяти, необходимых для экземпляров базы данных.  Для управляемого экземпляра SQL количество модулей Pod равно числу создаваемых управляемых экземпляров SQL.  Для групп серверов PostgreSQL Scale количество модулей Pod эквивалентно количеству рабочих узлов плюс один для узла координатора.  Например, если имеется группа серверов PostgreSQL с 3 рабочими узлами, общее число модулей Pod будет равно 4.

Помимо ядер и памяти, запрашиваемых для каждого экземпляра базы данных, необходимо добавить 250m ядер и 250Mi ОЗУ для контейнеров агентов.

Ниже приведен пример вычисления размера.

Требования

- **"SQL1"**: 1 управляемый экземпляр SQL с 16 ГБ ОЗУ, 4 ядрами
- **"SQL2"**: 1 управляемый экземпляр SQL с 256 ГБ ОЗУ, 16 ядер
- **"Postgres1"**: 1 PostgreSQL (горизонтальная группа серверов) с 4 работниками на 12 ГБ ОЗУ, 4 ядра

Вычисления размеров:

- Размер "SQL1": 1 модуль * ([16 шт., 4 ядра] + [250Mi ОЗУ, 250m ядер]) для агентов на Pod = 16,25 и 4 ГБ ОЗУ, 4,25 ядер.
- Размер "SQL2": 1 модуль * ([256/шт., 16 ядер] + + [250Mi ОЗУ, 250m ядер]) для агентов на Pod = 256,25 ОЗУ, 16,25 ядер.
- Общий размер SQL 1 и SQL 2: (16,25 ГБ + 256,25/с) = 272,5 ГБ ОЗУ, (4,25 ядра + 16,25 ядер) = 20,5 ядер.

- Размер "Postgres1": (4 рабочих модулей Pod + 1 модуль координатора) * ([12 ГБ ОЗУ, 4 ядра] + [250Mi ОЗУ, 250m ядер]) для агентов на Pod = 61,25 ГБ ОЗУ, 21,25 ядер.

- Ниже приведена общая емкость экземпляров базы данных: 272,5 ГБ ОЗУ, 20,5 ядер для SQL + 61,25 ГБ ОЗУ, 21,25 ядра для 333,75 PostgreSQL.

- Общая емкость, требуемая для экземпляров базы данных и контроллера данных: 333,75 ГБ ОЗУ, 42,5 ядер для экземпляров базы данных + 16 ГБ ОЗУ, 4 ядра для контроллера данных = 349,75 ГБ ОЗУ, 46,5 ядра.

Дополнительные сведения о размере хранилища см. в статье о [настройке хранилища](storage-configuration.md) .

## <a name="other-considerations"></a>Другие замечания

Помните, что заданный запрос размера экземпляра базы данных для ядер или ОЗУ не может превышать доступную емкость узлов Kubernetes в кластере.  Например, если самый крупный узел Kubernetes в кластере Kubernetes составляет 256 ГБ ОЗУ и 24 ядра, вы не сможете создать экземпляр базы данных с запросом 512 ГБ ОЗУ и числом ядер 48.  

Рекомендуется хранить по крайней мере 25% доступной емкости на узлах Kubernetes, чтобы Kubernetes эффективно планировать создание модулей Pod и обеспечить Эластичное масштабирование и более длительное увеличение спроса.  

При вычислении размера не забывайте добавлять требования к ресурсам системных модулей Kubernetes и других рабочих нагрузок, которые могут предоставлять общую емкость с помощью служб данных, включенных в службу Arc Azure, в одном кластере Kubernetes.

Чтобы обеспечить высокий уровень доступности во время планового обслуживания и непрерывности аварийного восстановления, необходимо спланировать хотя бы один из узлов Kubernetes в кластере, чтобы он был недоступен в определенный момент времени.  Kubernetes попытается перепланировать модули, запущенные на данном узле, который был отключен для обслуживания или из-за сбоя.  Если на оставшихся узлах нет доступной емкости, эти модули не будут перепланированы для создания, пока не появится доступная емкость.  Будьте внимательны с большими экземплярами баз данных.  Например, если имеется только один узел Kubernetes, достаточно большой для удовлетворения требований к ресурсам для большого экземпляра базы данных, и этот узел завершается сбоем, Kubernetes не сможет запланировать экземпляр Pod экземпляра базы данных на другой узел Kubernetes.

Учитывайте [максимальные ограничения для размера кластера Kubernetes](https://kubernetes.io/docs/setup/best-practices/cluster-large/) .

Возможно, администратор Kubernetes настроил [квоты ресурсов](https://kubernetes.io/docs/concepts/policy/resource-quotas/) на пространство имен или проект.  При планировании размеров экземпляров базы данных учитывайте следующее.
