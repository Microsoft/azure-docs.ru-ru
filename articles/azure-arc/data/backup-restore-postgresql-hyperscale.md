---
title: Резервное копирование и восстановление для Базы данных Azure для групп серверов Гипермасштабирования PostgreSQL
description: Резервное копирование и восстановление для Базы данных Azure для групп серверов Гипермасштабирования PostgreSQL
services: azure-arc
ms.service: azure-arc
ms.subservice: azure-arc-data
author: TheJY
ms.author: jeanyd
ms.reviewer: mikeray
ms.date: 12/09/2020
ms.topic: how-to
ms.openlocfilehash: 8b3304c673e8606667246a7d0df9ad8f3be11d9b
ms.sourcegitcommit: 910a1a38711966cb171050db245fc3b22abc8c5f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/20/2021
ms.locfileid: "101686705"
---
# <a name="back-up-and-restore-azure-arc-enabled-postgresql-hyperscale-server-groups"></a>Резервное копирование и восстановление групп серверов PostgreSQL с поддержкой дуги Azure

[!INCLUDE [azure-arc-common-prerequisites](../../../includes/azure-arc-common-prerequisites.md)]

[!INCLUDE [azure-arc-data-preview](../../../includes/azure-arc-data-preview.md)]

При резервном копировании или восстановлении группы серверов PostgreSQL в службе "Дуга Azure" с включенной службой Arc все наборы баз данных на всех узлах PostgreSQL в группе серверов архивируются и восстанавливаются.

## <a name="take-a-manual-full-backup"></a>Создание полной резервной копии вручную

Чтобы создать полную резервную копию всех папок данных и журналов группы серверов, выполните следующую команду:
```console
azdata arc postgres backup create [--name <backup name>] --server-name <server group name> [--no-wait] 
```
Где:
- __имя__ указывает имя резервной копии.
- __имя сервера__ указывает на группу серверов.
- __нет-Wait__ указывает, что Командная строка не будет ждать завершения резервного копирования, чтобы вы могли продолжить использовать это окно командной строки.

Эта команда координирует распределенное полное резервное копирование по всем узлам, составляющим группу серверов PostgreSQL с поддержкой дуги Azure. Иными словами, он будет создавать резервные копии всех данных в координаторе и рабочих узлах.

Пример:

```console
azdata arc postgres backup create --name backup12082020-0250pm --server-name postgres01
```

После завершения резервного копирования будут возвращены идентификатор, имя, размер, состояние и метка времени резервной копии. Пример:
```console
{
  "ID": "8085723fcbae4aafb24798c1458f4bb7",
  "name": "backup12082020-0250pm",
  "size": "9.04 MiB",
  "state": "Done",
  "timestamp": "2020-12-08 22:50:22+00:00"
}
```
`+xx:yy` Указывает часовой пояс для времени, в течение которого была создана резервная копия. В этом примере "+ 00:00" означает время в формате UTC (UTC + 00 час 00 минут).

> [!NOTE]
> Пока нет возможности:
> - Планирование автоматического резервного копирования
> - Отображение хода выполнения резервного копирования

## <a name="list-backups"></a>Перечисление резервных копий

Чтобы получить список резервных копий, доступных для восстановления, выполните следующую команду:

```console
azdata arc postgres backup list --server-name <servergroup name>
```

Пример:

```console
azdata arc postgres backup list --server-name postgres01
```

Возвращает выходные данные следующего вида:

```output
ID                                Name                   Size       State    Timestamp
--------------------------------  ---------------------  ---------  -------  -------------------------
d744303b1b224ef48be9cba4f58c7cb9  backup12072020-0731pm  13.83 MiB  Done     2020-12-08 03:32:09+00:00
c4f964d28da34318a420e6d14374bd36  backup12072020-0819pm  9.04 MiB   Done     2020-12-08 04:19:49+00:00
a304c6ef99694645a2a90ce339e94714  backup12072020-0822pm  9.1 MiB    Done     2020-12-08 04:22:26+00:00
47d1f57ec9014328abb0d8fe56020760  backup12072020-0827pm  9.06 MiB   Done     2020-12-08 04:27:22+00:00
8085723fcbae4aafb24798c1458f4bb7  backup12082020-0250pm  9.04 MiB   Done     2020-12-08 22:50:22+00:00
```

Столбец timestamp указывает момент времени в формате UTC, в котором была сделана резервная копия.

## <a name="restore-a-backup"></a>Восстановление резервной копии
В этом разделе мы покажу, как выполнить полное восстановление или восстановление на момент времени. При восстановлении полной резервной копии вы восстанавливаете все содержимое резервной копии. Когда вы выполняете восстановление на момент времени, вы восстанавливаете до определенной точки во времени. Любая транзакция, которая выполнялась позже этого момента времени, не восстанавливается.

### <a name="restore-a-full-backup"></a>Восстановление полной резервной копии
Чтобы восстановить все содержимое резервной копии, выполните команду:
```console
azdata arc postgres backup restore --server-name <target server group name> [--source-server-name <source server group name> --backup-id <backup id>]
or
azdata arc postgres backup restore -sn <target server group name> [-ssn <source server group name> --backup-id <backup id>]
```
<!--To read the general format of restore command, run: azdata arc postgres backup restore --help -->

Где:
- __BACKUP-ID__ — это идентификатор резервной копии, отображаемый в команде list Backup, показанной выше.
Это приведет к координации распределенного полного восстановления по всем узлам, составляющим группу серверов PostgreSQL с поддержкой дуги Azure. Иными словами, он восстановит все данные в координаторе и рабочих узлах.

#### <a name="examples"></a>Примеры:

__Восстановите группу серверов postgres01 на себя:__

```console
azdata arc postgres backup restore -sn postgres01 --backup-id d134f51aa87f4044b5fb07cf95cf797f
```

Эта операция поддерживается только для PostgreSQL версии 12 и более поздних версий.

__Восстановите группу серверов postgres01 в другую группу серверов postgres02:__

```console
azdata arc postgres backup restore -sn postgres02 -ssn postgres01 --backup-id d134f51aa87f4044b5fb07cf95cf797f
```
Эта операция поддерживается для любой версии PostgreSQL, начиная с версии 11. Целевая группа серверов должна быть создана до операции восстановления, должна иметь одинаковую конфигурацию и должна использовать тот же канал резервного копирования, что и исходная группа серверов.

После завершения операции восстановления она возвратит в командной строке следующий результат:

```json
{
  "ID": "d134f51aa87f4044b5fb07cf95cf797f",
  "state": "Done"
}
```

> [!NOTE]
> Пока нет возможности:
> - Восстановление резервной копии с указанием ее имени
> - Отображение хода выполнения операции восстановления


### <a name="do-a-point-in-time-restore"></a>Восстановление на момент времени

Чтобы восстановить группу серверов до определенного момента времени, выполните команду:
```console
azdata arc postgres backup restore --server-name <target server group name> --source-server-name <source server group name> --time <point in time to restore to>
or
azdata arc postgres backup restore -sn <target server group name> -ssn <source server group name> -t <point in time to restore to>
```

Чтобы прочитать общий формат команды Restore, выполните команду: `azdata arc postgres backup restore --help` .

Где `time` — это момент времени для восстановления. Укажите либо метку времени, либо число и суффикс ( `m` для минут, для часов, для `h` `d` дней или `w` для недель). Например `1.5h` , возвращается 90 минут.

#### <a name="examples"></a>Примеры:
__Выполните восстановление на момент времени в группе серверов postgres01 на себя:__

Восстановление группы серверов по времени до самого момента пока невозможно.

__Выполните восстановление на момент времени из группы серверов postgres01 в другую группу серверов postgres02 с определенной меткой времени:__
```console
azdata arc postgres backup restore -sn postgres02 -ssn postgres01 -t "2020-12-08 04:23:48.751326+00"
``` 

Этот пример восстанавливается в группе серверов postgres02, когда группа серверов postgres01 была на 8 декабря 2020 в 04:23:48.75 UTC. Обратите внимание, что "+ 00" обозначает часовой пояс точки во времени, который вы указали. Если вы не указали часовой пояс, будет использоваться часовой пояс клиента, с которого выполняется операция восстановления.

Пример:
- `2020-12-08 04:23:48.751326+00` интерпретируется как время в `2020-12-08 04:23:48.751326` формате UTC
- Если вы используете стандартный часовой пояс (PST = UTC + 08), `2020-12-08 04:23:48.751326` он интерпретируется как время в `2020-12-08 12:23:48.751326` формате UTC. Эта операция поддерживается для любой версии PostgreSQL, начиная с версии 11. Целевая группа серверов должна быть создана до операции восстановления и должна использовать ту же резервную копию PVC, что и исходная группа серверов.


__Выполните восстановление на момент времени из группы серверов postgres01 в другую группу серверов postgres02 за определенное время в прошлом:__
```console
azdata arc postgres backup restore -sn postgres02 -ssn postgres01 -t "22m"
```

Этот пример восстанавливается в группе серверов postgres02, в которой postgres01 группы серверов составил 22 минуты назад.
Эта операция поддерживается для любой версии PostgreSQL, начиная с версии 11. Целевая группа серверов должна быть создана до операции восстановления и должна использовать ту же резервную копию PVC, что и исходная группа серверов.

> [!NOTE]
> Пока нет возможности:
> - Отображение хода выполнения операции восстановления

## <a name="delete-backups"></a>Удаление резервных копий.

Невозможно задать срок хранения резервной копии в предварительной версии. Однако вы можете вручную удалить ненужные резервные копии.
Ниже приведена общая команда для удаления резервных копий.

```console
azdata arc postgres backup delete  [--server-name, -sn] {[--name, -n], -id}
```

где:
- `--server-name` имя группы серверов, из которой пользователь хочет удалить резервную копию.
- `--name` Имя удаляемой резервной копии
- `-id`Идентификатор удаляемой резервной копии

> [!NOTE]
> `--name` и `-id` являются взаимоисключающими.

Пример:

```console
azdata arc postgres backup delete -sn postgres01 -n MyBackup091720200110am
{
  "ID": "5b0481dfc1c94b4cac79dd56a1bb21f4",
  "name": "MyBackup091720200110am",
  "state": "Done"
}
```

Вы можете получить имя и идентификатор резервных копий, выполнив команду list Backup, как описано в предыдущем абзаце.

Чтобы получить дополнительные сведения о команде delete, выполните команду:

```console
azdata arc postgres backup delete --help
```

## <a name="next-steps"></a>Дальнейшие действия
- Дополнительные сведения о [масштабировании (Добавление рабочих узлов)](scale-out-postgresql-hyperscale-server-group.md) в группу серверов
- Дополнительные сведения о [масштабировании (увеличение или уменьшение объема памяти и виртуальных ядер)](scale-up-down-postgresql-hyperscale-server-group-using-cli.md) для группы серверов
