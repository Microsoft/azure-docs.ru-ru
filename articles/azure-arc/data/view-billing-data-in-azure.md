---
title: Отправьте данные о выставлении счетов в Azure и просмотрите их в портал Azure
description: Отправьте данные о выставлении счетов в Azure и просмотрите их в портал Azure
services: azure-arc
ms.service: azure-arc
ms.subservice: azure-arc-data
author: twright-msft
ms.author: twright
ms.reviewer: mikeray
ms.date: 03/02/2021
ms.topic: how-to
ms.openlocfilehash: 16546432c8c0a23d5c9dc471fe8c62ced5eca993
ms.sourcegitcommit: c27a20b278f2ac758447418ea4c8c61e27927d6a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/03/2021
ms.locfileid: "101687538"
---
# <a name="upload-billing-data-to-azure-and-view-it-in-the-azure-portal"></a>Отправьте данные о выставлении счетов в Azure и просмотрите их в портал Azure

> [!IMPORTANT] 
>  В течение периода действия предварительной версии не взимается плата за использование служб данных, включенных в службу Arc Azure. Несмотря на то, что система выставления счетов работает в конечном итоге, для счетчика выставления счетов устанавливается значение $0.  При выполнении этого сценария вы увидите записи в выставлении счетов для службы, которая в настоящее время называется **гибридными службами данных** , а также для ресурсов типа с именем **Microsoft. Азуредата/ `<resource type>`**. Вы увидите запись для каждой службы данных — созданной вами дуги Azure, но плата за каждую запись будет взиматься за $0.

[!INCLUDE [azure-arc-data-preview](../../../includes/azure-arc-data-preview.md)]

## <a name="connectivity-modes---implications-for-billing-data"></a>Режимы подключения — влияние на данные о выставлении счетов

В будущем будут доступны два режима, в которых можно запустить службы данных, поддерживающие службу Arc Azure.

- **Непрямое подключение — прямое** подключение к Azure отсутствует. Данные отправляются в Azure только с помощью процесса экспорта и передачи. Все развертывания служб данных в Azure Arc работают в режиме предварительной версии.
- **Подключено напрямую** . в этом режиме будет определена зависимость от службы Kubernetes в службе "Дуга Azure" для обеспечения прямого подключения между Azure и кластером Kubernetes, на котором работают службы данных, поддерживающие службу "Дуга Azure". Это обеспечит дополнительные возможности, а также позволит вам использовать портал Azure и Azure CLI для управления службами данных, включенными в службу "Дуга Azure", так же, как вы управляете службами данных в Azure PaaS.  Этот режим подключения пока недоступен в предварительной версии, но скоро появится.

Дополнительные сведения о различиях между [режимами подключения](./connectivity.md)см. в этой статье.

В режиме косвенного подключения данные о выставлении счетов периодически экспортируются из контроллера данных Arc Azure в защищенный файл, а затем передаются в Azure и обрабатываются.  В предстоящем режиме прямого подключения данные для выставления счетов автоматически отправляются в Azure примерно через 1 час, чтобы получить представление о затратах служб в ближайшем режиме реального времени. Процесс экспорта и отправки данных в косвенно подключенном режиме также можно автоматизировать с помощью сценариев или создать службу, которая сделает это автоматически.

## <a name="upload-billing-data-to-azure"></a>Отправка данных о выставлении счетов в Azure

Чтобы передать данные о выставлении счетов в Azure, сначала необходимо выполнить следующие действия:

1. Создайте службу данных с поддержкой дуги Azure, если она еще не создана. Например, создайте один из следующих элементов:
   - [Создание управляемого экземпляра SQL Azure в службе "Дуга Azure"](create-sql-managed-instance.md)
   - [Создание группы сервера с Гипермасштабированием PostgreSQL с поддержкой Azure Arc](create-postgresql-hyperscale-server-group.md)
1. [Отправляйте данные инвентаризации ресурсов, сведения об использовании, метрики и журналы, чтобы Azure Monitor,](upload-metrics-and-logs-to-azure-monitor.md) если вы еще этого не сделали.
1. Подождите не менее 2 часов с момента создания службы данных, чтобы процесс сбора данных телеметрии выставления счетов мог собирать данные о выставлении счетов.

Выполните следующую команду, чтобы экспортировать данные выставления счетов:

```console
azdata arc dc export -t usage -p usage.json
```

Пока файл не зашифрован, поэтому можно просмотреть его содержимое. Вы можете открыть в текстовом редакторе и увидеть, как выглядит содержимое.

Обратите внимание, что существует два набора данных: `resources` и `data` . `resources`— Это контроллер данных, PostgreSQL масштабируемые группы серверов и экземпляры, управляемые SQL. `resources`Записи в данных фиксируют соответствующие события в журнале ресурса — при его создании, при обновлении и при удалении. В `data` записях захватывается, сколько ядер было доступно для использования данным экземпляром каждый час.

Пример `resource` записи:

```console
    {
        "customObjectName": "<resource type>-2020-29-5-23-13-17-164711",
        "uid": "4bc3dc6b-9148-4c7a-b7dc-01afc1ef5373",
        "instanceName": "sqlInstance001",
        "instanceNamespace": "arc",
        "instanceType": "<resource>",
        "location": "eastus",
        "resourceGroupName": "production-resources",
        "subscriptionId": "482c901a-129a-4f5d-86e3-cc6b294590b2",
        "isDeleted": false,
        "externalEndpoint": "32.191.39.83:1433",
        "vCores": "2",
        "createTimestamp": "05/29/2020 23:13:17",
        "updateTimestamp": "05/29/2020 23:13:17"
    }
```

Пример `data` записи:

```console
        {
          "requestType": "usageUpload",
          "clusterId": "4b0917dd-e003-480e-ae74-1a8bb5e36b5d",
          "name": "DataControllerTestName",
          "subscriptionId": "482c901a-129a-4f5d-86e3-cc6b294590b2",
          "resourceGroup": "production-resources",
          "location": "eastus",
          "uploadRequest": {
            "exportType": "usages",
            "dataTimestamp": "2020-06-17T22:32:24Z",
            "data": "[{\"name\":\"sqlInstance001\",
                       \"namespace\":\"arc\",
                       \"type\":\"<resource type>\",
                       \"eventSequence\":1, 
                       \"eventId\":\"50DF90E8-FC2C-4BBF-B245-CB20DC97FF24\",
                       \"startTime\":\"2020-06-17T19:11:47.7533333\",
                       \"endTime\":\"2020-06-17T19:59:00\",
                       \"quantity\":1,
                       \"id\":\"4BC3DC6B-9148-4C7A-B7DC-01AFC1EF5373\"}]",
           "signature":"MIIE7gYJKoZIhvcNAQ...2xXqkK"
          }
        }
```

Выполните следующую команду, чтобы отправить usage.jsв файл в Azure:

```console
azdata arc dc upload -p usage.json
```

## <a name="view-billing-data-in-azure-portal"></a>Просмотр данных о выставлении счетов в портал Azure

Выполните следующие действия, чтобы просмотреть данные о выставлении счетов в портал Azure:

1. Откройте [портал Azure](https://portal.azure.com).
1. В поле поиска в верхней части экрана введите " **Управление затратами** " и щелкните "Служба управления затратами".
1. В разделе **Обзор управления затратами** перейдите на вкладку **Управление затратами** .
1. Щелкните вкладку **анализ затрат** слева.
1. Нажмите кнопку **затрата на ресурс** в верхней части представления.
1. Убедитесь, что для области задана подписка, в которой были созданы ресурсы службы данных.
1. В раскрывающемся списке рядом с областью выбора области в верхней части представления выберите пункт **затраты по ресурсам** .
1. Убедитесь, что для фильтра даты установлен **этот месяц** или какой-либо другой диапазон времени, который имеет смысл при создании ресурсов службы данных.
1. Нажмите кнопку **Добавить фильтр** , чтобы добавить фильтр по **типу ресурса** ,  =  `microsoft.azuredata/<data service type>` Если требуется отфильтровать только один тип службы данных, поддерживающей службу "Дуга Azure".
1. Теперь вы увидите список всех ресурсов, которые были созданы и отправлены в Azure. Так как счетчик выставления счетов равен $0, вы увидите, что стоимость всегда составляет $0.

## <a name="download-billing-data"></a>Скачивание данных о выставлении счетов

Сводные данные выставления счетов можно загрузить непосредственно из портал Azure.

1. В представлении " **анализ затрат" — > представление по типу ресурса** , которое вы достигли, выполнив приведенные выше инструкции, нажмите кнопку Скачать вверху.
1. Выберите тип файла скачивания — Excel или CSV и нажмите кнопку **скачать данные** .
1. Откройте файл в соответствующем редакторе, используя выбранный тип файла.

## <a name="export-billing-data"></a>Экспорт данных о выставлении счетов

Вы также можете периодически автоматически экспортировать **подробные** данные об использовании и выставлении счетов в контейнер службы хранилища Azure, создав задание экспорта выставления счетов. Это полезно, если вы хотите просмотреть сведения о выставлении счетов, например количество часов, за которые был выставлен счет за указанный экземпляр за период выставления счетов.

Чтобы настроить задание экспорта выставления счетов, выполните следующие действия.

1. Щелкните **EXPORTS (экспорты** ) слева.
1. Нажмите кнопку **Добавить**.
1. Введите имя и частоту экспорта, а затем нажмите кнопку Далее.
1. Выберите либо создать новую учетную запись хранения, либо использовать существующую, заполнив форму, чтобы указать учетную запись хранения, контейнер и путь к каталогу для экспорта файлов данных выставления счетов, а затем нажмите кнопку Далее.
1. Нажмите кнопку **Создать**.

Файлы экспорта данных для выставления счетов будут доступны примерно через 4 часа и будут экспортированы по расписанию, указанному при создании задания экспорта выставления счетов.

Чтобы просмотреть экспортируемые файлы данных о выставлении счетов, выполните следующие действия.

Файлы данных выставления счетов можно проверить в портал Azure. 

> [!IMPORTANT]
> После создания задания экспорта выставления счетов подождите 4 часа, прежде чем продолжить выполнение следующих шагов.

1. В поле поиска в верхней части портала введите **учетные записи хранения** и щелкните **учетные записи хранения**.
3. Щелкните учетную запись хранения, указанную при создании задания экспорта выставления счетов выше.
4. Щелкните контейнеры слева.
5. Щелкните контейнер, указанный при создании задания экспорта выставления счетов выше.
6. Щелкните папку, указанную при создании задания экспорта выставления счетов выше.
7. Выполните детализацию по созданным папкам и файлам и щелкните один из созданных CSV-файлов.
8. Нажмите кнопку **скачать** , чтобы сохранить файл в локальной папке загрузки.
9. Откройте файл с помощью средства просмотра CSV-файлов, например Excel.
10. Отфильтруйте результаты, чтобы отображались только строки с **типом ресурса**  =  `Microsoft.AzureData/<data service resource type` .
11. Вы увидите число часов, в течение которых экземпляр использовался в течение текущего 24 часов в столбце Усажекуантити.
