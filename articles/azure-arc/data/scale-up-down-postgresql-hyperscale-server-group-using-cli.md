---
title: Увеличение и уменьшение масштаба для группы горизонтального масштабирования базы данных Azure для PostgreSQL с помощью интерфейса командной строки (аздата или kubectl)
description: Увеличение и уменьшение масштаба для группы горизонтального масштабирования базы данных Azure для PostgreSQL с помощью интерфейса командной строки (аздата или kubectl)
services: azure-arc
ms.service: azure-arc
ms.subservice: azure-arc-data
author: TheJY
ms.author: jeanyd
ms.reviewer: mikeray
ms.date: 09/22/2020
ms.topic: how-to
ms.openlocfilehash: 4461fb6904d51ee8d740b633a2d0028658ac2ced
ms.sourcegitcommit: c27a20b278f2ac758447418ea4c8c61e27927d6a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/03/2021
ms.locfileid: "101687555"
---
# <a name="scale-up-and-down-an-azure-database-for-postgresql-hyperscale-server-group-using-cli-azdata-or-kubectl"></a>Увеличение и уменьшение масштаба для группы горизонтального масштабирования базы данных Azure для PostgreSQL с помощью интерфейса командной строки (аздата или kubectl)



Иногда может потребоваться изменить характеристики или определение группы серверов. Пример.

- Увеличение или уменьшение числа виртуальных ядер, используемых каждым из координаторов или рабочих узлов
- Масштабирование памяти, используемой каждым из координаторов или рабочих узлов

В этом руководство объясняется, как масштабировать Виртуальное ядро и (или) память.

Увеличение или уменьшение масштаба Виртуальное ядро или памяти для группы серверов означает возможность установки минимального и/или максимального значения для каждого из параметров Виртуальное ядро и памяти. Если вы хотите настроить группу серверов для использования определенного числа Виртуальное ядро или определенного объема памяти, задайте параметры min равными параметрам Max.

[!INCLUDE [azure-arc-data-preview](../../../includes/azure-arc-data-preview.md)]

## <a name="show-the-current-definition-of-the-server-group"></a>Отображение текущего определения группы серверов

Чтобы отобразить текущее определение группы серверов и узнать о текущих параметрах Виртуальное ядро и памяти, выполните одну из следующих команд:

### <a name="cli-with-azdata"></a>CLI с аздата

```console
azdata arc postgres server show -n <server group name>
```
### <a name="cli-with-kubectl"></a>CLI с kubectl

```console
kubectl describe postgresql-12/<server group name> [-n <namespace name>]
```
> [!NOTE]
> Если вы создали группу серверов PostgreSQL версии 11, запустите `kubectl describe postgresql-11/<server group name>` вместо нее.

Он возвращает конфигурацию группы серверов. Если вы создали группу серверов с параметрами по умолчанию, вы увидите определение следующим образом:

```console
"scheduling": {
      "default": {
        "resources": {
          "requests": {
            "memory": "256Mi"
          }
        }
      }
    },
```

## <a name="interpret-the-definition-of-the-server-group"></a>Интерпретировать определение группы серверов

В определении группы серверов раздел, передающий параметры min/max Виртуальное ядро на узел и минимальный/максимальный объем памяти на узел, — это раздел **"планирование"** . В этом разделе максимальные параметры будут сохранены в подразделе **"ограничения"** , а параметры min сохраняются в подразделе **"запросы"**.

Если заданы параметры min, отличные от параметров Max, конфигурация гарантирует, что группа серверов выделила запрошенные ресурсы, если это необходимо. Он не будет превышать установленные пределы.

Ресурсы (виртуальных ядер и память), которые будут фактически использоваться группой серверов, имеют максимальные значения параметров и зависят от рабочих нагрузок и ресурсов, доступных в кластере. Если вы не задаете параметр max, группа серверов может использовать все ресурсы, выделенные кластером Kubernetes, в узлы Kubernetes, на которых запланирована ваша группа серверов.

Эти параметры Виртуальное ядро и Memory применяются к каждому из узлов PostgreSQL Scale (узел координатор и рабочие узлы). Пока не поддерживается установка определений узла координатора и рабочих узлов отдельно.

В конфигурации по умолчанию для параметра Минимальный объем памяти задано значение 256Mi, так как это минимальный размер памяти, рекомендуемый для выполнения PostgreSQLного масштабирования.

> [!NOTE]
> Установка минимального значения не означает, что группа серверов обязательно будет использовать это минимальное значение. Это означает, что, если требуется группа серверов, будет гарантированно выделено выделение по крайней мере этого минимума. Например, давайте рассмотрим задание `--minCpu 2` . Это не означает, что группа серверов будет использовать по крайней мере 2 виртуальных ядер в любое время. Это означает, что группа серверов может начать использовать менее 2 виртуальных ядер, если это не требует много ресурсов и при этом гарантированно выделяется по крайней мере 2 виртуальных ядер, если они потребуются позже. Это означает, что кластер Kubernetes выделяет ресурсы другим рабочим нагрузкам таким образом, что он может выделить 2 виртуальных ядер группе серверов, если это необходимо.

>[!NOTE]
>Перед изменением конфигурации системы обязательно ознакомьтесь [с моделью ресурсов](https://github.com/kubernetes/community/blob/master/contributors/design-proposals/scheduling/resources.md#resource-quantities) Kubernetes.

## <a name="scale-up-the-server-group"></a>Увеличение масштаба группы серверов

Параметры, которые вы собираетесь настроить, должны быть учтены в конфигурации, заданной для кластера Kubernetes. Убедитесь, что не заданы значения, которые кластеру Kubernetes не удастся удовлетворить. Это может привести к ошибкам или непредсказуемому поведению. Например, если после изменения конфигурации состояние группы серверов постоянно _обновляется_ , это может означать, что параметры, указанные ниже, задаются для тех значений, которые кластеру Kubernetes не соответствует. Если это так, отмените изменения или прочтите _troubleshooting_section.

Например, предположим, что вы хотите увеличить масштаб определения группы серверов, чтобы:

- Min Виртуальное ядро = 2
- Max Виртуальное ядро = 4
- Минимальный объем памяти = 512 МБ
- Максимальный объем памяти = 1 ГБ

Используйте один из следующих подходов:

### <a name="cli-with-azdata"></a>CLI с аздата

```console
azdata arc postgres server edit -n <name of your server group> --cores-request <# core-request>  --cores-limit <# core-limit>  --memory-request <# memory-request>Mi  --memory-limit <# memory-limit>Mi
```

> [!CAUTION]
> Ниже приведен пример, демонстрирующий использование команды. Перед выполнением команды Edit убедитесь, что для параметров заданы значения, которые могут соблюдаться в кластере Kubernetes.

```console
azdata arc postgres server edit -n <name of your server group> --cores-request 2  --cores-limit 4  --memory-request 512Mi  --memory-limit 1024Mi
```

Команда выполняется успешно, когда показывает:

```console
<name of your server group> is Ready
```

> [!NOTE]
> Чтобы получить дополнительные сведения об этих параметрах, выполните команду `azdata arc postgres server edit --help` .

### <a name="cli-with-kubectl"></a>CLI с kubectl

```console
kubectl edit postgresql-12/<server group name> [-n <namespace name>]
```

Откроется редактор VI, где можно перемещаться и изменять конфигурацию. Используйте следующую команду, чтобы связать требуемый параметр с именем поля в спецификации:

> [!CAUTION]
> Ниже приведен пример, демонстрирующий, как можно изменить конфигурацию. Перед обновлением конфигурации убедитесь, что для параметров заданы значения, которые могут соблюдаться в кластере Kubernetes.

Пример.
- Min Виртуальное ядро = 2 — > счедулинг\дефаулт\ресаурцес\рекуестс\кпу
- Max Виртуальное ядро = 4 — > счедулинг\дефаулт\ресаурцес\лимитс\кпу
- Min memory = 512 МБ — > счедулинг\дефаулт\ресаурцес\рекуестс\кпу
- Максимальный объем памяти = 1 ГБ — > счедулинг\дефаулт\ресаурцес\лимитс\кпу

Если вы не знакомы с редактором VI, см. Описание команд, которые могут потребоваться [здесь](https://www.computerhope.com/unix/uvi.htm):
- режим редактирования: `i`
- перемещаться по стрелкам
- _stop редактирования: `esc`
- _exit без сохранения: `:qa!`
- _exit после сохранения: `:qw!`


## <a name="show-the-scaled-up-definition-of-the-server-group"></a>Отображение масштабируемого определения группы серверов

Выполните команду еще раз, чтобы отобразить определение группы серверов и убедиться, что она задана по своему желанию:

### <a name="cli-with-azdata"></a>CLI с аздата

```console
azdata arc postgres server show -n <the name of your server group>
```
### <a name="cli-with-kubectl"></a>CLI с kubectl

```console
kubectl describe postgresql-12/<server group name>  [-n <namespace name>]
```
> [!NOTE]
> Если вы создали группу серверов PostgreSQL версии 11, запустите `kubectl describe postgresql-11/<server group name>` вместо нее.


Отобразится новое определение группы серверов:

```console
"scheduling": {
      "default": {
        "resources": {
          "limits": {
            "cpu": "4",
            "memory": "1024Mi"
          },
          "requests": {
            "cpu": "2",
            "memory": "512Mi"
          }
        }
      }
    },
```

## <a name="scale-down-the-server-group"></a>Уменьшение масштаба группы серверов

Чтобы уменьшить масштаб группы серверов, выполните ту же команду, но задайте меньшие значения для параметров, которые необходимо масштабировать. Чтобы удалить запросы и (или) ограничения, укажите его значение как пустую строку.

## <a name="reset-to-default-values"></a>Восстановить значения по умолчанию
Чтобы сбросить ограничения ядра и памяти, запрашивает параметры по умолчанию, измените их и передайте пустую строку вместо фактического значения. Например, если требуется сбросить параметр ограничения ядра (CL), выполните следующие команды:
- на клиенте Linux:

```console
    azdata arc postgres server edit -n <servergroup name> -cl ""
```

- в клиенте Windows: 
 
```console
    azdata arc postgres server edit -n <servergroup name> -cl '""'
```


## <a name="next-steps"></a>Дальнейшие действия

- [Масштабирование группы серверов с Гипермасштабированием Базы данных Azure для PostgreSQL](scale-out-postgresql-hyperscale-server-group.md)
- [Основные понятия конфигурации хранилища и хранилища Kubernetes](storage-configuration.md)
- [Модель ресурсов Kubernetes](https://github.com/kubernetes/community/blob/master/contributors/design-proposals/scheduling/resources.md#resource-quantities)
