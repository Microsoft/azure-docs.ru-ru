---
title: Режимы подключения и требования
description: Сведения о вариантах подключения служб данных в службе "Дуга Azure" для из вашей среды в Azure
services: azure-arc
ms.service: azure-arc
ms.subservice: azure-arc-data
author: twright-msft
ms.author: twright
ms.reviewer: mikeray
ms.date: 09/22/2020
ms.topic: conceptual
ms.openlocfilehash: d148509af45b93dce8dbd99b9afc674276b149b6
ms.sourcegitcommit: 740698a63c485390ebdd5e58bc41929ec0e4ed2d
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/03/2021
ms.locfileid: "99493978"
---
# <a name="connectivity-modes-and-requirements"></a>Режимы подключения и требования

[!INCLUDE [azure-arc-data-preview](../../../includes/azure-arc-data-preview.md)]

## <a name="connectivity-modes"></a>Режимы подключения

Существует несколько вариантов подключения из вашей среды служб данных, включенной в службу "Дуга Azure", в Azure. По мере того, как ваши требования зависят от бизнес-политики, регламентированного законодательства или доступности сетевого подключения к Azure, можно выбрать один из следующих режимов подключения.

Служба данных с поддержкой службы "Дуга Azure" предоставляет возможность подключения к Azure в двух разных *режимах подключения*: 

- Подключено напрямую 
- Косвенное соединение

Режим подключения предоставляет гибкие возможности для выбора объема данных, отправляемых в Azure, и способа взаимодействия пользователей с контроллером данных ARC. В зависимости от выбранного режима подключения некоторые функциональные возможности служб данных, включенных в службу "Дуга" Azure, могут быть недоступны.

Важно! Если службы данных, включенные в службу "Дуга Azure", напрямую подключены к Azure, пользователи могут использовать [Azure Resource Manager API-интерфейсы](/rest/api/resources/), Azure CLI и портал Azure для работы со службами данных Arc Azure. Взаимодействие в режиме прямого подключения очень похоже на использование любой другой службы Azure с подготовкой или отменой подготовки, масштабированием, настройкой и т. д. на портал Azure.  Если службы данных с поддержкой дуги Azure были косвенно подключены к Azure, то портал Azure является представлением только для чтения. Вы можете просматривать данные инвентаризации управляемых экземпляров SQL и postgres масштабируемых экземпляров, а также сведения о них, но вы не можете выполнять действия с ними в портал Azure.  В режиме косвенного подключения все действия должны выполняться локально с помощью Azure Data Studio, [!INCLUDE [azure-data-cli-azdata](../../../includes/azure-data-cli-azdata.md)] или собственных средств Kubernetes, таких как kubectl.

Кроме того, Azure Active Directory и Azure Role-Based Access Control можно использовать только в режиме прямого подключения, поскольку существует зависимость от непрерывного и прямого подключения к Azure для предоставления этой функции.

Некоторые службы, подключенные к Azure, доступны только в том случае, если их можно напрямую доработать, например службы безопасности защитника Azure, контейнерные аналитики и Azure Backup в хранилище BLOB-объектов.

||**Косвенное соединение**|**Подключено напрямую**|**Не подключено**|
|---|---|---|---|
|**Описание**|Режим с прямым подключением предлагает большинство служб управления в вашей среде локально без прямого подключения к Azure.  В Azure необходимо отправить минимальный объем данных _только_ для учета и выставления счетов. Он экспортируется в файл и отправляется в Azure по крайней мере один раз в месяц.  Прямое или непрерывное подключение к Azure не требуется.  Некоторые функции и службы, для которых требуется подключение к Azure, будут недоступны.|Режим прямого подключения предоставляет все доступные службы, если прямое подключение можно установить с помощью Azure. Подключения всегда инициируются _из_ вашей среды в Azure и используют стандартные порты и протоколы, такие как HTTPS/443.|Никакие данные не могут отправляться в Azure или из него каким бы то ни было образом.|
|**Текущая доступность**| доступна предварительная версия.|доступна предварительная версия.|В настоящее время не поддерживается.|
|**Стандартные сценарии использования**|Локальные центры обработки данных, которые не допускают подключения к области данных центра обработки данных или из нее в соответствии с политиками соответствия бизнес-или нормативных требований или отсутствием проблем с внешними атаками или утечка данных.  Типичные примеры: финансовые учреждения, здравоохранение, государственные учреждения. <br/><br/>Граничные расположения сайтов, на которых пограничным сайтом обычно нет подключения к Интернету.  Типичные примеры: «топливо», «газовые» или «воинские» приложения.  <br/><br/>Граничные расположения сайтов с периодическим подключением с длительными периодами простоя.  Типичные примеры: стадионах, круизных фирм. | Организации, использующие общедоступные облака.  Типичные примеры: Azure, AWS или Google Cloud.<br/><br/>Расположение узлов с пограничным подключением, которое обычно имеется и разрешено.  Типичные примеры: розничные магазины, производство.<br/><br/>Корпоративные центры обработки данных с более строгими политиками для подключения к региону данных центра и из него в Интернет.  Типичные примеры: нерегулируемые предприятия, малые и средние предприятия|«Air-гаппед» среды, в которых нет никаких данных из-за каких-либо обстоятельств, которые могут поступать или переходить из среды данных. Типичные примеры: лучшие секретные средства для государственных организаций.|
|**Отправка данных в Azure**|Существует три способа отправки данных о выставлении счетов и инвентаризации в Azure.<br><br> 1) данные экспортируются из области данных автоматическим процессом, который может подключиться как к защищенной области данных, так и к Azure.<br><br>2) данные экспортируются из области данных автоматизированным процессом в области данных, автоматически копируются в менее безопасный регион, а автоматизированный процесс в менее безопасном регионе передает данные в Azure.<br><br>3. данные вручную экспортируются пользователем в безопасном регионе, вручную выгружаются из защищенного региона и вручную передаются в Azure. <br><br>Первые два варианта — это автоматизированный непрерывный процесс, который может быть запланирован на частое выполнение, поэтому минимальная задержка передачи данных в Azure подлежит только за доступное подключение к Azure.|Данные автоматически и постоянно отправляются в Azure.|Данные никогда не отправляются в Azure.|

## <a name="feature-availability-by-connectivity-mode"></a>Доступность функций по режиму подключения

|**Возможность**|**Косвенное соединение**|**Подключено напрямую**|
|---|---|---|
|**Автоматическое обеспечение высокого уровня доступности**|Поддерживается|Поддерживается|
|**Самостоятельная подготовка**|Поддерживается<br/>Создание можно выполнить с помощью Azure Data Studio, [!INCLUDE [azure-data-cli-azdata](../../../includes/azure-data-cli-azdata.md)] или собственных средств Kubernetes (Helm, kubectl, OC и т. д.) или с помощью службы "Дуга Azure", поддерживающей Kubernetes гитопс.|Поддерживается<br/>В дополнение к параметрам создания в режиме косвенного подключения можно также создать с помощью портал Azure, Azure Resource Manager API, Azure CLI или шаблонов ARM. **Ожидание доступности непосредственно подключенного режима**
|**Эластичное масштабирование**|Поддерживается|Поддерживается<br/>**Ожидание доступности непосредственно подключенного режима**|
|**Выставление счетов**|Поддерживается<br/>Данные о выставлении счетов периодически экспортируются и отправляются в Azure.|Поддерживается<br/>Данные о выставлении счетов автоматически и постоянно отправляются в Azure и отражаются практически в реальном времени. **Ожидание доступности непосредственно подключенного режима**|
|**Управление запасами**|Поддерживается<br/>Данные инвентаризации периодически экспортируются и отправляются в Azure.<br/><br/>Используйте клиентские средства, такие как Azure Data Studio, Azure Data CLI, `kubectl` а также для просмотра и управления инвентаризацией локально.|Поддерживается<br/>Данные инвентаризации автоматически и постоянно отправляются в Azure и отражаются практически в реальном времени. Таким образом, можно управлять инвентаризацией непосредственно из портал Azure. **Ожидание доступности непосредственно подключенного режима**|
|**Автоматическое обновление и установка исправлений**|Поддерживается<br/>Контроллер данных должен иметь прямой доступ к реестру контейнеров Microsoft (мкр), или образы контейнеров должны быть извлечены из мкр и отправлены в локальный закрытый реестр контейнеров, к которому имеет доступ контроллер данных.|Поддерживается<br/>**Ожидание доступности непосредственно подключенного режима**|
|**Автоматическое резервное копирование и восстановление**|Поддерживается<br/>Автоматическая локальная Архивация и восстановление.|Поддерживается<br/>В дополнение к автоматической локальной архивации и восстановлению можно _Дополнительно_ отправить резервные копии в Azure Backup для долгосрочного хранения на месте. **Ожидание доступности непосредственно подключенного режима**|
|**Мониторинг**|Поддерживается<br/>Локальный мониторинг с помощью панелей мониторинга Grafana и Kibana.|Поддерживается<br/>Помимо локальных панелей мониторинга, при _необходимости_ можно отправить данные мониторинга и журналы, чтобы Azure Monitor для масштабируемого мониторинга нескольких сайтов в одном месте. **Ожидание доступности непосредственно подключенного режима**|
|**Аутентификация**|Используйте локальные имя пользователя и пароль для проверки подлинности контроллера данных и панели мониторинга. Используйте имена входа SQL и postgres или Active Directory для подключения к экземплярам базы данных.  Используйте поставщики проверки подлинности K8s для проверки подлинности в API Kubernetes.|В дополнение к методам проверки подлинности для режима непрямого подключения или вместо _них можно также использовать Azure Active Directory_ . **Ожидание доступности непосредственно подключенного режима**|
|**Управление доступом на основе ролей (RBAC)**|Используйте Kubernetes RBAC в API Kubernetes. Используйте SQL и postgres RBAC для экземпляров базы данных.|При необходимости можно выполнить интеграцию с Azure Active Directory и Azure RBAC. **Ожидание доступности непосредственно подключенного режима**|
|**Azure Defender**|Не поддерживается|Запланировано на будущее|

## <a name="connectivity-requirements"></a>Требования к подключению

**Для некоторых функций требуется подключение к Azure.**

**Все взаимодействия с Azure всегда инициируются из вашей среды.** Это справедливо даже для операций, которые инициируются пользователем в портал Azure.  В этом случае существует задача, которая находится в очереди в Azure.  Агент в вашей среде инициирует взаимодействие с Azure, чтобы узнать, какие задачи находятся в очереди, выполняет задачи и сообщает о состоянии, завершении или сбое в Azure.

|**Тип данных**|**Направление**|**Обязательный/необязательный**|**Дополнительные затраты**|**Требуется режим**|**Примечания**|
|---|---|---|---|---|---|
|**Образы контейнеров**|Реестр контейнеров (Майкрософт) — > клиент|Обязательно|Нет|Косвенный или прямой|Образы контейнеров — это метод распространения программного обеспечения.  В среде, которая может подключаться к реестру контейнеров Microsoft (мкр) через Интернет, образы контейнеров можно извлечь непосредственно из мкр.  В случае, если среда развертывания не имеет прямого подключения, можно извлечь образы из мкр и отправить их в частный реестр контейнеров в среде развертывания.  Во время создания можно настроить процесс создания для извлечения из закрытого реестра контейнеров вместо мкр. Это также относится к автоматическим обновлениям.|
|**Инвентаризация ресурсов**|Среда клиента — > Azure|Обязательно|Нет|Косвенный или прямой|Инвентаризация контроллеров данных, экземпляров баз данных (PostgreSQL и SQL) хранится в Azure в целях выставления счетов, а также в целях создания инвентаризации всех контроллеров данных и экземпляров баз данных в одном месте, что особенно полезно, если у вас есть несколько сред со службами данных Arc Azure.  При подготовке экземпляров, отмене подготовки, изменении масштаба и увеличении масштаба инвентаризации обновляются в Azure.|
|**Данные телеметрии для выставления счетов**|Среда клиента — > Azure|Обязательно|Нет|Косвенный или прямой|Использование экземпляров базы данных должно быть отправлено в Azure в целях выставления счетов.  В течение периода действия предварительной версии не взимается плата за службы данных, поддерживающие службу "Дуга Azure".|
|**Мониторинг данных и журналов**|Среда клиента — > Azure|Необязательный|Возможно, в зависимости от объема данных (см. раздел [цены на Azure Monitor](https://azure.microsoft.com/en-us/pricing/details/monitor/)).|Косвенный или прямой|Вы можете отправить локально собранные данные мониторинга и журналы, чтобы Azure Monitor для агрегирования данных в нескольких средах в одном месте, а также для использования Azure Monitor служб, таких как оповещения, использования данных в Машинное обучение Azure и т. д.|
|**Управление доступом на основе ролей в Azure (Azure RBAC)**|Среда клиента — > Azure — > Среда клиента|Необязательно|Нет|Только Direct|Если вы хотите использовать Azure RBAC, подключение должно быть установлено в Azure постоянно.  Если вы не хотите использовать Azure RBAC, можно использовать локальные Kubernetes RBAC.  **Ожидание доступности непосредственно подключенного режима**|
|**Azure Active Directory (AD)**|Среда клиента — > Azure — > Среда клиента|Необязательный|Возможно, вы уже оплачиваете Azure AD|Только Direct|Если вы хотите использовать Azure AD для проверки подлинности, подключение должно быть установлено в Azure постоянно. Если вы не хотите использовать Azure AD для проверки подлинности, вы можете службы федерации Active Directory (AD FS) (ADFS) поверх Active Directory. **Ожидание доступности непосредственно подключенного режима**|
|**Резервное копирование и восстановление**|Среда клиента — > Среда клиента|Обязательно|Нет|Прямой или косвенный|Службу резервного копирования и восстановления можно настроить так, чтобы она указывала на локальные классы хранилища. |
|**Резервное копирование Azure — долгосрочное хранение**| Среда клиента — > Azure | Необязательный| Да для службы хранилища Azure | Только Direct |Возможно, вам потребуется отправить резервные копии, которые выполняются локально, чтобы Azure Backup для долгосрочного хранения резервных копий, а затем вернуть их в локальную среду для восстановления. **Ожидание доступности непосредственно подключенного режима**|
|**Службы безопасности защитника Azure**|Среда клиента — > Azure — > Среда клиента|Необязательный|Да|Только Direct|**Ожидание доступности непосредственно подключенного режима**|
|**Подготовка и изменение конфигурации от портал Azure**|Среда клиента — > Azure — > Среда клиента|Необязательно|Нет|Только Direct|Изменения подготовки и конфигурации можно выполнять локально с помощью Azure Data Studio или [!INCLUDE [azure-data-cli-azdata](../../../includes/azure-data-cli-azdata.md)] .  В режиме прямого подключения вы также сможете подготавливать и вносить изменения в конфигурацию из портал Azure. **Ожидание доступности непосредственно подключенного режима**|


## <a name="details-on-internet-addresses-ports-encryption-and-proxy-server-support"></a>Сведения об адресах Интернета, портах, шифровании и поддержке прокси-сервера

В настоящее время на этапе предварительной версии поддерживается только непрямо подключенный режим. В этом режиме для служб, доступных в Интернете, требуется только три подключения. Ниже перечислены доступные подключения.

- [Реестр контейнеров (Майкрософт) (мкр)](#microsoft-container-registry-mcr)
- [API Azure Resource Manager](#azure-resource-manager-apis)
- [API Azure Monitor](#azure-monitor-apis)

Все подключения по протоколу HTTPS к Azure и реестр контейнеров Майкрософт шифруются с помощью SSL/TLS с помощью официально подписанных и проверяемых сертификатов.

Следующие разделы содержат сведения об этих соединениях. 

### <a name="microsoft-container-registry-mcr"></a>Реестр контейнеров (Майкрософт) (мкр)

В реестре контейнеров Майкрософт размещаются образы контейнеров служб данных, включенные в службу "Дуга Azure".  Вы можете извлечь эти образы из мкр и отправить их в частный реестр контейнеров и настроить процесс развертывания контроллера данных на извлечение образов контейнеров из этого закрытого реестра контейнеров.

#### <a name="connection-source"></a>Источник подключения

Kubernetes kubelet на каждом из узлов Kubernetes извлекает образы контейнеров.

#### <a name="connection-target"></a>Цель подключения

`mcr.microsoft.com`

#### <a name="protocol"></a>Протокол

HTTPS

#### <a name="port"></a>Порт

443

#### <a name="can-use-proxy"></a>Может использовать прокси-сервер

Да

#### <a name="authentication"></a>Аутентификация

Нет

### <a name="azure-resource-manager-apis"></a>API Azure Resource Manager
Azure Data Studio [!INCLUDE [azure-data-cli-azdata](../../../includes/azure-data-cli-azdata.md)] и Azure CLI подключиться к Azure Resource Manager API-интерфейсам для отправки и получения данных в Azure и обратно для некоторых функций.

#### <a name="connection-source"></a>Источник подключения

Компьютер, на котором работает Azure Data Studio, [!INCLUDE [azure-data-cli-azdata](../../../includes/azure-data-cli-azdata.md)] или Azure CLI, который подключается к Azure.

#### <a name="connection-target"></a>Цель подключения

- `login.microsoftonline.com`
- `management.azure.com`
- `san-af-eastus-prod.azurewebsites.net`
- `san-af-eastus2-prod.azurewebsites.net`
- `san-af-australiaeast-prod.azurewebsites.net`
- `san-af-centralus-prod.azurewebsites.net`
- `san-af-westus2-prod.azurewebsites.net`
- `san-af-westeurope-prod.azurewebsites.net`
- `san-af-southeastasia-prod.azurewebsites.net`
- `san-af-koreacentral-prod.azurewebsites.net`
- `san-af-northeurope-prod.azurewebsites.net`
- `san-af-westeurope-prod.azurewebsites.net`
- `san-af-uksouth-prod.azurewebsites.net`
- `san-af-francecentral-prod.azurewebsites.net`

#### <a name="protocol"></a>Протокол

HTTPS

#### <a name="port"></a>Порт

443

#### <a name="can-use-proxy"></a>Может использовать прокси-сервер

Да

#### <a name="authentication"></a>Аутентификация 

Azure Active Directory

### <a name="azure-monitor-apis"></a>API Azure Monitor

Azure Data Studio [!INCLUDE [azure-data-cli-azdata](../../../includes/azure-data-cli-azdata.md)] и Azure CLI подключиться к Azure Resource Manager API-интерфейсам для отправки и получения данных в Azure и обратно для некоторых функций.

#### <a name="connection-source"></a>Источник подключения

Компьютер, на котором выполняется [!INCLUDE [azure-data-cli-azdata](../../../includes/azure-data-cli-azdata.md)] или Azure CLI, который отправляет метрики мониторинга или журналы в Azure Monitor.

#### <a name="connection-target"></a>Цель подключения

- `login.microsoftonline.com`
- `management.azure.com`
- `*.ods.opinsights.azure.com`
- `*.oms.opinsights.azure.com`
- `*.monitoring.azure.com`

#### <a name="protocol"></a>Протокол

HTTPS

#### <a name="port"></a>Порт

443

#### <a name="can-use-proxy"></a>Может использовать прокси-сервер

Да

#### <a name="authentication"></a>Аутентификация 

Azure Active Directory

> [!NOTE]
> Сейчас все подключения браузера HTTPS/443 к панелям мониторинга Grafana и Kibana, а также [!INCLUDE [azure-data-cli-azdata](../../../includes/azure-data-cli-azdata.md)] к API контроллера данных шифруются с помощью SSL-шифрования с использованием самозаверяющих сертификатов.  В будущем будет доступна функция, которая позволит вам предоставлять собственные сертификаты для шифрования этих SSL-подключений.

Подключение из Azure Data Studio и [!INCLUDE [azure-data-cli-azdata](../../../includes/azure-data-cli-azdata.md)] к серверу API Kubernetes использует установленную проверку подлинности и шифрование Kubernetes.  Каждый пользователь, использующий Azure Data Studio и, [!INCLUDE [azure-data-cli-azdata](../../../includes/azure-data-cli-azdata.md)] должен иметь проверенное подключение к API Kubernetes для выполнения многих действий, связанных со службами данных, включенными в службу Arc Azure.

