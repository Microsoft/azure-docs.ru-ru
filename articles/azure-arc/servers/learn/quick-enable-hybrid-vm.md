---
title: Подключение гибридной виртуальной машины к серверам с поддержкой Azure Arc
description: Узнайте, как подключить и зарегистрировать гибридную виртуальную машину на серверах с поддержкой Azure Arc.
ms.topic: quickstart
ms.date: 12/15/2020
ms.openlocfilehash: 68869854cbfcf6d7297137e6239b2229a20c04a1
ms.sourcegitcommit: 66479d7e55449b78ee587df14babb6321f7d1757
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/15/2020
ms.locfileid: "97516782"
---
# <a name="quickstart-connect-hybrid-machine-with-azure-arc-enabled-servers"></a>Краткое руководство. Подключение гибридной виртуальной машины к серверам с поддержкой Azure Arc

[Серверы с поддержкой Azure Arc](../overview.md) позволяют управлять компьютерами Windows и Linux, размещенными в локальной, периферийной и многооблачной средах. В рамках этого краткого руководства вы развернете и настроите агент Connected Machine на своем компьютере под управлением Windows или Linux, размещенном за пределами Azure, для управления серверами с поддержкой Arc.

## <a name="prerequisites"></a>Предварительные требования

* Если у вас еще нет подписки Azure, [создайте бесплатную учетную запись](https://azure.microsoft.com/free/?WT.mc_id=A261C142F), прежде чем начинать работу.

* Для развертывания серверов с поддержкой Arc агент гибридной подключенной виртуальной машины требует наличия прав администратора на компьютере для установки и настройки агента. В Linux для этого используется корневая учетная запись, а в Windows — учетная запись, являющаяся членом группы локальных администраторов.

* Перед началом работы обязательно ознакомьтесь с [предварительными требованиями](../agent-overview.md#prerequisites) агента и проверьте следующее:

    * На целевом компьютере запущена поддерживаемая [версия операционной системы](../agent-overview.md#supported-operating-systems).

    * Вашей учетной записи назначены [обязательные роли Azure](../agent-overview.md#required-permissions).

    * Если компьютер подключается через брандмауэр или прокси-сервер для связи через Интернет, убедитесь, что [перечисленные](../agent-overview.md#networking-configuration) URL-адреса не заблокированы.

    * Серверы с поддержкой Azure Arc поддерживают только регионы, указанные на [этой странице](../overview.md#supported-regions).

> [!WARNING]
> В имени узла Linux или компьютера Windows нельзя использовать зарезервированные слова или товарные знаки. В противном случае, при попытке зарегистрировать подключенный компьютер в Azure произойдет ошибка. Список зарезервированных слов см. в статье [Ошибки имен зарезервированных ресурсов](../../../azure-resource-manager/templates/error-reserved-resource-name.md).

[!INCLUDE [cloud-shell-try-it.md](../../../../includes/cloud-shell-try-it.md)]

## <a name="register-azure-resource-providers"></a>Регистрация поставщиков ресурсов Azure

Использование серверов с поддержкой Azure Arc зависит от следующих поставщиков ресурсов Azure в подписке:

* Microsoft.HybridCompute
* Microsoft.GuestConfiguration

Зарегистрируйте их с помощью таких команд:

```azurecli-interactive
az account set --subscription "{Your Subscription Name}"
az provider register --namespace 'Microsoft.HybridCompute'
az provider register --namespace 'Microsoft.GuestConfiguration'
```

## <a name="generate-installation-script"></a>Создание сценария установки

Сценарий для автоматизации скачивания и установки, а также для установки подключения к Azure Arc, доступен на портале Azure. Чтобы завершить процесс, выполните следующие действия:

1. Запустите службу Azure Arc на портале Azure, щелкнув **Все службы**, а затем выполнив поиск и выбрав **Серверы — Azure Arc**.

    :::image type="content" source="./media/quick-enable-hybrid-vm/search-machines.png" alt-text="Поиск серверов с поддержкой Arc в разделе &quot;Все службы&quot;" border="false":::

1. На странице **Серверы —Azure Arc** щелкните **Добавить** в левом верхнем углу.

1. На странице **Выбор метод** выберите плитку **Добавление серверов с помощью интерактивного скриптов**, а затем щелкните **Создать скрипт**.

1. На странице **Создать скрипт** выберите подписку и группу ресурсов, которые следует использовать для управления компьютером в Azure. Выберите расположение Azure, в котором будут храниться метаданные компьютера. Это расположение может совпадать или не совпадать с расположением группы ресурсов.

1. На странице **Необходимые условия** просмотрите сведения и нажмите кнопку **Далее: Сведения о ресурсе**.

1. На странице **Сведения о ресурсе** укажите следующее:

    1. В раскрывающемся списке **Группа ресурсов** выберите группу ресурсов, из которой будет осуществляться управление компьютером.
    1. В раскрывающемся списке **Регион** выберите регион Azure для хранения метаданных серверов.
    1. В раскрывающемся списке **Операционная система** выберите операционную систему, в которой будет выполняться скрипт.
    1. Если компьютер обменивается данными через прокси-сервер для подключения к Интернету, укажите IP-адрес прокси-сервера или имя и номер порта, которые будут использоваться компьютером для взаимодействия с прокси-сервером. Введите значение в формате `http://<proxyURL>:<proxyport>`.
    1. По завершении выберите **Next: Теги**.

1. На странице **Теги** проверьте **теги физического расположения**, заданные по умолчанию, а затем введите нужное значение или укажите один или несколько **настраиваемых тегов** в соответствии со своими стандартами.

1. По завершении выберите **Next: Download and run script** (Далее: скачивание и выполнение скрипта).

1. На вкладке **Download and run script** (Скачивание и выполнение скрипта) просмотрите сводные данные и щелкните **Скачать**. Если вам все еще нужно внести изменения, щелкните **Назад**.

## <a name="install-the-agent-using-the-script"></a>Установка агента с помощью сценария

### <a name="windows-agent"></a>Агент Windows

1. Войдите на сервер.

1. Откройте 64-разрядную командную строку PowerShell с повышенными привилегиями.

1. Перейдите к обычной или общей папке, в которую скопировали скрипт, и выполните его на сервере, запустив `./OnboardingScript.ps1`.

### <a name="linux-agent"></a>Агент Linux

1. Чтобы установить агент Linux на целевом компьютере, который может напрямую взаимодействовать с Azure, выполните следующую команду:

    ```bash
    bash ~/Install_linux_azcmagent.sh
    ```

    * Если целевой компьютер обменивается данными через прокси-сервер, выполните следующую команду:

        ```bash
        bash ~/Install_linux_azcmagent.sh --proxy "{proxy-url}:{proxy-port}"
        ```

## <a name="verify-the-connection-with-azure-arc"></a>Проверка подключения с помощью Azure Arc

После установки агента и настройки его подключения к серверам с поддержкой Azure Arc перейдите на портал Azure, чтобы убедиться, что сервер подключен. Просмотрите свои компьютеры на [портале Azure](https://aka.ms/hybridmachineportal).

:::image type="content" source="./media/quick-enable-hybrid-vm/enabled-machine.png" alt-text="Успешное подключение к компьютеру" border="false":::

## <a name="next-steps"></a>Дальнейшие действия

Теперь после включения гибридной виртуальной машины Linux или Windows и успешного подключения к службе вы можете включить Политику Azure, чтобы узнать о соблюдении требований в Azure.

Сведения об определении серверов с поддержкой Azure Arc, на которых не установлен агент Log Analytics, см. в следующем учебнике:

> [!div class="nextstepaction"]
> [Создание назначения политики для идентификации ресурсов, не соответствующих требованиям](tutorial-assign-policy-portal.md)
