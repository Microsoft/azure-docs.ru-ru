---
title: Устранение неполадок подключения в концентраторах событий Azure | Документация Майкрософт
description: Эта статья содержит сведения об устранении проблем с подключением к концентраторам событий Azure.
ms.topic: article
ms.date: 06/23/2020
ms.openlocfilehash: 8eddc0e8c598e4553b30759d179fecb6ae880829
ms.sourcegitcommit: 867cb1b7a1f3a1f0b427282c648d411d0ca4f81f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "96012686"
---
# <a name="troubleshoot-connectivity-issues---azure-event-hubs"></a>Устранение неполадок подключения — концентраторы событий Azure
Существуют различные причины, по которым клиентские приложения не могут подключаться к концентратору событий. Возникающие проблемы с подключением могут быть постоянными или временными. Если эта ошибка происходит постоянно, может потребоваться проверить строку подключения, параметры брандмауэра организации, параметры брандмауэра IP-адресов, параметры сетевой безопасности (конечные точки службы, частные конечные точки и т. д.) и многое другое. Для временных проблем обновление до последней версии пакета SDK, выполнение команд для проверки пропущенных пакетов и получение трассировки сети может помочь в устранении неполадок. 

В этой статье приводятся советы по устранению проблем с подключением к концентраторам событий Azure. 

## <a name="troubleshoot-permanent-connectivity-issues"></a>Устранение проблем с постоянным подключением
Если приложение не может подключиться к концентратору событий, выполните действия из этого раздела, чтобы устранить проблему. 

### <a name="check-if-there-is-a-service-outage"></a>Проверка сбоя службы
Проверьте наличие сбоя службы концентраторов событий Azure на [сайте состояния службы Azure](https://azure.microsoft.com/status/).

### <a name="verify-the-connection-string"></a>Проверка строки подключения 
Проверьте правильность используемой строки подключения. Сведения о получении строки подключения с помощью портал Azure, CLI или PowerShell см. в разделе [Получение строки подключения](event-hubs-get-connection-string.md) . 

Для клиентов Kafka убедитесь, что producer.config или consumer.config файлы настроены правильно. Дополнительные сведения см. [в статье отправка и получение сообщений с помощью Kafka в концентраторах событий](event-hubs-quickstart-kafka-enabled-event-hubs.md#send-and-receive-messages-with-kafka-in-event-hubs).

[!INCLUDE [event-hubs-connectivity](../../includes/event-hubs-connectivity.md)]

### <a name="verify-that-azureeventgrid-service-tag-is-allowed-in-your-network-security-groups"></a>Убедитесь, что тег службы Азуривентгрид разрешен в группах безопасности сети.
Если приложение работает в подсети и имеется связанная группа безопасности сети, проверьте, разрешен ли доступ к исходящему Интернету или разрешать использование тега службы Азуривентгрид. См. раздел [теги службы виртуальной сети](../virtual-network/service-tags-overview.md) и выполните поиск по запросу `EventHub` .

### <a name="check-if-the-application-needs-to-be-running-in-a-specific-subnet-of-a-vnet"></a>Проверка необходимости запуска приложения в определенной подсети
Убедитесь, что приложение выполняется в подсети виртуальной сети, которая имеет доступ к пространству имен. Если это не так, запустите приложение в подсети, которая имеет доступ к пространству имен, или добавьте IP-адрес компьютера, на котором выполняется приложение, в [брандмауэр IP](event-hubs-ip-filtering.md). 

При создании конечной точки службы виртуальной сети для пространства имен концентратора событий пространство имен принимает трафик только из подсети, привязанной к конечной точке службы. Исключение этого поведения. Вы можете добавить определенные IP-адреса в брандмауэре IP-адресов, чтобы разрешить доступ к общедоступной конечной точке концентратора событий. Дополнительные сведения см. в статье [конечные точки сетевой службы](event-hubs-service-endpoints.md).

### <a name="check-the-ip-firewall-settings-for-your-namespace"></a>Проверьте параметры брандмауэра IP-адресов для пространства имен.
Убедитесь, что общедоступный IP-адрес компьютера, на котором работает приложение, не заблокирован брандмауэром IP.  

По умолчанию пространства имен Центров событий доступны из Интернета при условии, что запрос поступает с действительной аутентификацией и авторизацией. С помощью IP-брандмауэра такой доступ можно дополнительно ограничить набором или диапазоном IPv4-адресов, введя их в нотации [CIDR](https://en.wikipedia.org/wiki/Classless_Inter-Domain_Routing).

Правила брандмауэра для IP-адресов применяются на уровне пространства имен Центров событий. Поэтому они действуют для всех клиентских подключений по любым поддерживаемым протоколам. Любые попытки подключения с IP-адреса, который не соответствует правилу разрешения IP-адресов для пространства имен Центров событий, отклоняются. В ответе клиенту правило фильтрации IP-адресов не упоминается. Правила фильтрации IP-адресов применяются по порядку, поэтому первое правило, которое соответствует IP-адресу, определяет действие (принять или отклонить).

Дополнительные сведения см. в статье [Настройка правил брандмауэра для IP-адресов для пространства имен концентраторов событий Azure](event-hubs-ip-filtering.md). Чтобы проверить, есть ли у вас проблемы с IP-фильтрацией, виртуальной сетью или цепочкой сертификатов, см. раздел [Устранение неполадок, связанных с сетью](#troubleshoot-network-related-issues).

### <a name="check-if-the-namespace-can-be-accessed-using-only-a-private-endpoint"></a>Проверка возможности доступа к пространству имен с использованием только частной конечной точки
Если пространство имен концентраторов событий настроено для доступа только через закрытую конечную точку, убедитесь, что клиентское приложение обращается к пространству имен через частную конечную точку. 

[Служба "Частная связь Azure](../private-link/private-link-overview.md) " позволяет получать доступ к концентраторам событий Azure через **частную конечную точку** в виртуальной сети. Частная конечная точка — это сетевой интерфейс, который защищенно и надежно подключается к службе через Приватный канал Azure. Частная конечная точка использует частный IP-адрес из виртуальной сети, фактически передавая ее в виртуальную сеть. Весь трафик к службе может маршрутизироваться через частную конечную точку, поэтому шлюзы, устройства преобразования сетевых адресов (NAT), подключения ExpressRoute и VPN, а также общедоступные IP-адреса не требуются. Трафик между виртуальной сетью и службой проходит через магистральную сеть Майкрософт, что позволяет избежать рисков общедоступного Интернета. Вы можете подключиться к экземпляру ресурса Azure, обеспечивая наивысшую степень детализации в управлении доступом.

Дополнительные сведения см. в разделе [Настройка частных конечных точек](private-link-service.md). Чтобы убедиться, что используется частная конечная точка, см. раздел **Проверка работоспособности подключения к частной конечной точке** . 

### <a name="troubleshoot-network-related-issues"></a>Устранение проблем, связанных с сетью
Чтобы устранить проблемы, связанные с сетью, с концентраторами событий, выполните следующие действия. 

Перейдите к или [wget](https://www.gnu.org/software/wget/) `https://<yournamespacename>.servicebus.windows.net/` . Он помогает проверять наличие IP-фильтрации, виртуальной сети или цепочки сертификатов (чаще всего при использовании пакета SDK для Java).

Пример **успешного сообщения**:

```xml
<feed xmlns="http://www.w3.org/2005/Atom"><title type="text">Publicly Listed Services</title><subtitle type="text">This is the list of publicly-listed services currently available.</subtitle><id>uuid:27fcd1e2-3a99-44b1-8f1e-3e92b52f0171;id=30</id><updated>2019-12-27T13:11:47Z</updated><generator>Service Bus 1.1</generator></feed>
```

Пример **сообщения об ошибке сбоя**:

```json
<Error>
    <Code>400</Code>
    <Detail>
        Bad Request. To know more visit https://aka.ms/sbResourceMgrExceptions. . TrackingId:b786d4d1-cbaf-47a8-a3d1-be689cda2a98_G22, SystemTracker:NoSystemTracker, Timestamp:2019-12-27T13:12:40
    </Detail>
</Error>
```

## <a name="troubleshoot-transient-connectivity-issues"></a>Устранение проблем с временным подключением
Если возникают проблемы с подключением, просмотрите советы по устранению неполадок в следующих разделах. 

### <a name="use-the-latest-version-of-the-client-sdk"></a>Использовать последнюю версию клиентского пакета SDK
Некоторые из временных проблем с подключением могли быть исправлены в более поздних версиях пакета SDK, чем вы используете. Убедитесь, что вы используете последнюю версию клиентских пакетов SDK в своих приложениях. Пакеты SDK постоянно усовершенствованы с новыми и обновленными функциями и исправлениями ошибок, поэтому всегда проверяйте последний пакет. Просмотрите заметки о выпуске, чтобы устранить исправленные проблемы, а также добавить или обновить компоненты. 

Сведения о клиентских пакетах SDK см. в статье [концентраторы событий Azure — клиентские пакеты SDK](sdks.md) . 

### <a name="run-the-command-to-check-dropped-packets"></a>Выполните команду, чтобы проверить пропущенные пакеты.
При наличии периодических проблем с подключением выполните следующую команду, чтобы проверить наличие пропущенных пакетов. Эта команда попытается установить 25 разных TCP-подключений каждые 1 секунду со службой. После этого можно проверить, сколько из них прошло успешное выполнение и завершилось сбоем, а также увидеть задержку подключения TCP. Это средство можно загрузить `psping` [отсюда](/sysinternals/downloads/psping).

```shell
.\psping.exe -n 25 -i 1 -q <yournamespacename>.servicebus.windows.net:5671 -nobanner     
```
Аналогичные команды можно использовать, если вы используете другие средства, такие как `tnc` , `ping` и т. д. 

Найдите трассировку сети, если предыдущие шаги не помогают и не анализируют их с помощью таких средств, как [Wireshark](https://www.wireshark.org/). При необходимости обратитесь в [Служба поддержки Майкрософт](https://support.microsoft.com/) . 

### <a name="service-upgradesrestarts"></a>Обновление или перезапуск службы
Проблемы с временным подключением могут возникать из-за обновления и перезапуска серверной части службы. Когда они возникнут, могут возникнуть следующие симптомы. 

- Может существовать перетаскивание входящих сообщений или запросов.
- Файл журнала может содержать сообщения об ошибках.
- Приложения могут быть отключены от службы в течение нескольких секунд.
- Запросы могут быть продолжены с немедленным регулированием.

Если код приложения использует пакет SDK, то политика повторных попыток уже встроена и активна. Приложение будет повторно подключено без значительного влияния на приложение или рабочий процесс. Перехват этих временных ошибок, резервное копирование и повторная попытка вызова гарантирует устойчивость кода к этим временным проблемам.

## <a name="next-steps"></a>Дальнейшие действия
См. следующие статьи:

* [Устранение проблем с проверкой подлинности и авторизацией](troubleshoot-authentication-authorization.md)
