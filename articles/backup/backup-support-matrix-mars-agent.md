---
title: Матрица поддержки для агента MARS
description: В этой статье приводится сводка Azure Backup поддержки при резервном копировании компьютеров, на которых выполняется агент Службы восстановления Microsoft Azure (MARS).
ms.date: 08/30/2019
ms.topic: conceptual
ms.openlocfilehash: 2170440b7b47861b75801b8dbd334686b4cabc8b
ms.sourcegitcommit: 910a1a38711966cb171050db245fc3b22abc8c5f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "98985620"
---
# <a name="support-matrix-for-backup-with-the-microsoft-azure-recovery-services-mars-agent"></a>Матрица поддержки для резервного копирования с помощью агента Служб восстановления Microsoft Azure (MARS)

[Службу Azure Backup](backup-overview.md) можно использовать для резервного копирования локальных компьютеров и приложений, а также для резервного копирования виртуальных машин Azure. В этой статье перечислены параметры и ограничения поддержки при использовании агента Службы восстановления Microsoft Azure (MARS) для резервного копирования компьютеров.

## <a name="the-mars-agent"></a>Агент MARS

Azure Backup использует агент MARS для резервного копирования данных с локальных компьютеров и виртуальных машин Azure в хранилище резервных копий служб восстановления в Azure. Агент MARS может:

- Запускайте на локальных компьютерах под управлением Windows, чтобы они могли выполнять резервное копирование непосредственно в хранилище служб восстановления резервных копий в Azure.
- Запустите на виртуальных машинах Windows, чтобы они могли выполнять резервное копирование непосредственно в хранилище.
- Выполните команду на сервере Microsoft Azure Backup Server (MABS) или System Center Data Protection Manager (DPM). В этом сценарии компьютеры и рабочие нагрузки архивируются в MABS или на сервер DPM. Затем агент MARS создает резервную копию этого сервера в хранилище в Azure.

> [!NOTE]
>Azure Backup не поддерживает автоматическую корректировку часов для летнего времени (DST). Измените политику, чтобы убедиться в том, что переход на летнее время учитывается во избежание расхождений между реальным временем и временем запланированного резервного копирования.

Параметры резервного копирования зависят от того, где установлен агент. Дополнительные сведения см. [в разделе архитектура Azure Backup с помощью агента Mars](backup-architecture.md#architecture-direct-backup-of-on-premises-windows-server-machines-or-azure-vm-files-or-folders). Сведения об архитектуре резервного копирования MABS и DPM см. [в статье резервное копирование в DPM или MABS](backup-architecture.md#architecture-back-up-to-dpmmabs). См. также [требования](backup-support-matrix-mabs-dpm.md) к архитектуре резервного копирования.

**Установка** | **Сведения**
--- | ---
Скачайте последнюю версию агента MARS | Последнюю версию агента можно скачать из хранилища или [напрямую](https://aka.ms/azurebackup_agent).
Установить непосредственно на компьютере | Агент MARS можно установить непосредственно на локальном сервере Windows Server или на виртуальной машине Windows, работающей под управлением любой из [поддерживаемых операционных систем](./backup-support-matrix-mabs-dpm.md#supported-mabs-and-dpm-operating-systems).
Установить на сервере резервного копирования | При настройке сервера DPM или MABS для резервного копирования в Azure нужно скачать и установить агент MARS на этом сервере. Агент можно установить в [поддерживаемых операционных системах](backup-support-matrix-mabs-dpm.md#supported-mabs-and-dpm-operating-systems) в матрице поддержки Backup Server.

> [!NOTE]
> По умолчанию для виртуальных машин Azure, для которых включена резервная копия, устанавливается Azure Backup расширение. Это расширение создает резервную копию всей виртуальной машины. Вы можете установить и запустить агент MARS на виртуальной машине Azure вместе с расширением, если хотите выполнить резервное копирование определенных папок или файлов, а не всей виртуальной машины.
> При запуске агента MARS на виртуальной машине Azure выполняется резервное копирование файлов или папок, которые находятся во временном хранилище на виртуальной машине. Резервное копирование завершается сбоем, если файлы или папки удаляются из временного хранилища или если временное хранилище удалено.

## <a name="cache-folder-support"></a>Поддержка папок кэширования

При использовании агента MARS для резервного копирования данных агент создает моментальный снимок данных и сохраняет их в папке локального кэша перед отправкой данных в Azure. Папка для кэша (Рабочая область) имеет несколько требований:

**Cache** | **Сведения**
--- | ---
Размер |  Объем свободного места в папке кэша должен составлять от 5 до 10 процентов от общего размера данных резервных копий.
Расположение | Папка кэша должна храниться локально на компьютере, на котором создается резервная копия, и должна находиться в режиме в сети. Папка кэша не должна находиться в общей сетевой папке, на съемном носителе или на автономном томе.
Папка | Папка кэша не должна быть зашифрована на диске с дедупликацией или в сжатой папке, быть разреженной или иметь точку повторного анализа.
Изменения расположения | Чтобы изменить расположение кэша, остановите модуль архивации ( `net stop bengine` ) и скопируйте папку кэша на новый диск. (Убедитесь, что на новом диске достаточно места.) Затем обновите две записи реестра в **HKLM\SOFTWARE\Microsoft\Windows Azure Backup** (**config/ScratchLocation** и **config/клаудбаккуппровидер/ScratchLocation**) в новом расположении и перезапустите подсистему.

## <a name="networking-and-access-support"></a>Поддержка сети и доступа

### <a name="url-and-ip-access"></a>URL-адрес и доступ по IP

Агенту MARS требуется доступ к таким URL-адресам:

- `http://www.msftncsi.com/ncsi.txt`
- *.Microsoft.com
- *.WindowsAzure.com
- *. MicrosoftOnline.com
- *. Windows.net
- `www.msftconnecttest.com`

И на следующие IP-адреса:

- 20.190.128.0/18
- 40.126.0.0/18

Для доступа ко всем указанным выше URL-адресам и IP-адреса используется протокол HTTPS через порт 443.

При резервном копировании файлов и папок из виртуальных машин Azure с помощью агента MARS виртуальная сеть Azure также должна быть настроена для разрешения доступа. Если вы используете группы безопасности сети (NSG), используйте тег службы *AzureBackup*, чтобы разрешить исходящий доступ к Azure Backup. Кроме тегов Azure Backup, вам нужно разрешить подключение для проверки подлинности и передачи данных, создав аналогичные [правила NSG](../virtual-network/network-security-groups-overview.md#service-tags) для *Azure Active Directory* и *службы хранилища Azure*. Ниже описан процесс создания правила для тега Azure Backup:

1. В разделе **Все службы** перейдите к **группам сетевой безопасности** и выберите группу сетевой безопасности.
2. Выберите **Правила безопасности для исходящего трафика** в разделе **Параметры**.
3. Выберите **Добавить**. Введите все необходимые сведения для создания нового правила, как описано в разделе [параметры правила безопасности](../virtual-network/manage-network-security-group.md#security-rule-settings). Убедитесь, что параметр **Назначение** имеет значение *Тег службы*, а **Тег целевой службы** имеет значение *AzureBackup*.
4. Нажмите кнопку **Добавить** , чтобы сохранить только что созданное правило безопасности для исходящего трафика.

Аналогичным образом можно создавать правила безопасности для исходящего трафика NSG для службы хранилища Azure и Azure AD. Дополнительные сведения о тегах служб см. в [этой статье](../virtual-network/service-tags-overview.md).

### <a name="azure-expressroute-support"></a>Поддержка Azure ExpressRoute

Вы можете выполнять резервное копирование данных через Azure ExpressRoute с помощью общедоступного пиринга (для старых каналов) и пиринга Майкрософт. Резервное копирование через частный пиринг не поддерживается.

С общедоступным пирингом: Обеспечьте доступ к следующим доменам и адресам:

* URL-адреса
  * `www.msftncsi.com`
  * `*.Microsoft.com`
  * `*.WindowsAzure.com`
  * `*.microsoftonline.com`
  * `*.windows.net`
  * `www.msftconnecttest.com`
* IP-адреса
  * 20.190.128.0/18
  * 40.126.0.0/18

С помощью пиринга Майкрософт выберите следующие службы или регионы и соответствующие значения сообщества:

- Azure Backup (в соответствии с расположением хранилища служб восстановления)
- Azure Active Directory (12076:5060);
- Служба хранилища Azure (в соответствии с расположением хранилища служб восстановления)

Дополнительные сведения см. в разделе [требования к маршрутизации ExpressRoute](../expressroute/expressroute-routing.md#bgp).

>[!NOTE]
>Общедоступный пиринг не рекомендуется использовать для новых каналов.

### <a name="private-endpoint-support"></a>Поддержка частных конечных точек

Теперь можно использовать частные конечные точки для безопасного резервного копирования данных с серверов в хранилище служб восстановления. Поскольку Azure Active Directory в настоящее время не поддерживает частные конечные точки, IP-адресам и полным доменным именам, необходимым для Azure Active Directory, потребуется разрешать исходящий доступ отдельно.

При использовании агента MARS для резервного копирования локальных ресурсов убедитесь, что локальная сеть (содержащая ваши ресурсы для резервного копирования) подключена к виртуальной сети Azure, содержащей закрытую конечную точку для хранилища. Затем можно продолжить установку агента MARS и настроить резервное копирование. Однако необходимо убедиться, что все соединения для резервного копирования выполняются только через одноранговую сеть.

Если удалить частные конечные точки для хранилища после регистрации агента MARS, необходимо повторно зарегистрировать контейнер в хранилище. Для них не нужно прекращать защиту.

Дополнительные сведения о [частных конечных точках для Azure Backup](private-endpoints.md).

### <a name="throttling-support"></a>Поддержка регулирования

**Компонент** | **Сведения**
--- | ---
Управление пропускной способностью | Поддерживается. В агенте MARS используйте **Свойства изменить** , чтобы настроить пропускную способность.
Регулирование сети | Недоступно для резервных копий компьютеров под управлением Windows Server 2008 R2, Windows Server 2008 SP2 или Windows 7.

## <a name="supported-operating-systems"></a>Поддерживаемые операционные системы

>[!NOTE]
> Агент MARS не поддерживает номера SKU Windows Server Core.

Агент MARS можно использовать для резервного копирования непосредственно в Azure в операционных системах, перечисленных ниже, которые выполняются в:

1. Локальные серверы Windows
2. Виртуальные машины Azure под управлением Windows

Операционные системы должны иметь 64 бит и должны работать с последними пакетами и обновлениями служб. В следующей таблице перечислены эти операционные системы.

**Операционная система** | **Файлы, папки** | **Состояние системы** | **Требования к программному обеспечению и модулям**
--- | --- | --- | ---
Windows 10 (Корпоративная, Pro, Домашняя) | Да | Нет |  Проверьте соответствующую версию сервера на наличие требований к программному обеспечению или модулю
Windows 8.1 (Корпоративная, Pro)| Да |Нет | Проверьте соответствующую версию сервера на наличие требований к программному обеспечению или модулю
Windows 8 (Корпоративная, Pro) | Да | Нет | Проверьте соответствующую версию сервера на наличие требований к программному обеспечению или модулю
Windows Server 2016 (Standard, Datacenter и Essentials) | Да | Да | — .NET 4,5 <br> — Windows PowerShell <br> — Последний совместимый распространяемый пакет Microsoft VC + + <br> — Консоль управления Microsoft (MMC) 3,0
Windows Server 2012 R2 (Standard, Datacenter, Foundation и Essentials) | Да | Да | — .NET 4,5 <br> — Windows PowerShell <br> — Последний совместимый распространяемый пакет Microsoft VC + + <br> — Консоль управления Microsoft (MMC) 3,0
Windows Server 2012 (Standard, Datacenter, Foundation) | Да | Да |— .NET 4,5 <br> Windows PowerShell <br> — Последний совместимый распространяемый пакет Microsoft VC + + <br> — Консоль управления Microsoft (MMC) 3,0 <br> — Обслуживание образов развертывания и управление ими (DISM.exe)
Windows Storage Server 2016/2012 R2/2012 (стандартная, Рабочая группа) | Да | Нет | — .NET 4,5 <br> — Windows PowerShell <br> — Последний совместимый распространяемый пакет Microsoft VC + + <br> — Консоль управления Microsoft (MMC) 3,0
Windows Server 2019 (Standard, Datacenter и Essentials); | Да | Да | — .NET 4,5 <br> — Windows PowerShell <br> — Последний совместимый распространяемый пакет Microsoft VC + + <br> — Консоль управления Microsoft (MMC) 3,0

Дополнительные сведения см. в разделе [ПОДДЕРЖИВАЕМЫЕ MABS и операционные системы DPM](backup-support-matrix-mabs-dpm.md#supported-mabs-and-dpm-operating-systems).

### <a name="operating-systems-at-end-of-support"></a>Операционные системы по окончании поддержки

Следующие операционные системы по завершении поддержки, поэтому настоятельно рекомендуется обновить операционную систему, чтобы продолжить оставаться защищенной.

Если существующие обязательства не позволяют обновить операционную систему, рассмотрите возможность переноса серверов Windows на виртуальные машины Azure и использование резервных копий виртуальных машин Azure для продолжения защиты. Дополнительные сведения о миграции Windows Server см. на [странице переходов](https://azure.microsoft.com/migration/windows-server/) .

Для локальных или размещенных сред, в которых невозможно обновить операционную систему или выполнить миграцию в Azure, активируйте Расширенные обновления безопасности для компьютеров, чтобы продолжить их защиту и поддержку. Обратите внимание, что для расширенных обновлений безопасности доступны только определенные выпуски. Дополнительные сведения см. на [странице вопросов и ответов](https://www.microsoft.com/windows-server/extended-security-updates) .

| **Операционная система**                                       | **Файлы, папки** | **Состояние системы** | **Требования к программному обеспечению и модулям**                           |
| ------------------------------------------------------------ | ----------------- | ------------------ | ------------------------------------------------------------ |
| Windows 7 (максимальная, Корпоративная, профессиональная, Домашняя расширенная или базовая, начальная) | Да               | Нет                 | Проверьте соответствующую версию сервера на наличие требований к программному обеспечению или модулю |
| Windows Server 2008 R2 (Standard, Enterprise, Datacenter, Foundation) | Да               | Да                | — .NET 3,5, .NET 4,5 <br>  — Windows PowerShell <br>  -Совместимый распространяемый пакет Microsoft VC + + <br>  — Консоль управления Microsoft (MMC) 3,0 <br>  — Обслуживание образов развертывания и управление ими (DISM.exe) |
| Windows Server 2008 SP2 (Standard, Datacenter, Foundation)  | Да               | Нет                 | — .NET 3,5, .NET 4,5 <br>  — Windows PowerShell <br>  -Совместимый распространяемый пакет Microsoft VC + + <br>  — Консоль управления Microsoft (MMC) 3,0 <br>  — Обслуживание образов развертывания и управление ими (DISM.exe) <br>  — Виртуальный сервер 2005, базовый + KB KB948515 |

## <a name="backup-limits"></a>Ограничения резервного копирования

### <a name="size-limits"></a>Ограничения размера

Azure Backup ограничивает размер источника данных файла или папки, резервную копию которого можно создать. Элементы, которые вы создаете из одного тома, не могут превышать размеры, приведенные в этой таблице:

**Операционная система** | **Ограничение размера**
--- | ---
Windows Server 2012 или более поздней версии; |54 400 ГБ
Windows Server 2008 R2 с пакетом обновления 1 (SP1) |1700 ГБ
Windows Server 2008 с пакетом обновления 2 (SP2)| 1700 ГБ
Windows 8 или более поздняя версия| 54 400 ГБ
Windows 7| 1700 ГБ

### <a name="minimum-retention-limits"></a>Минимальные ограничения на хранение

Ниже приведены минимальные значения длительности хранения, которые можно задать для различных точек восстановления.

|Точка восстановления |Duration  |
|---------|---------|
|Ежедневная точка восстановления    |   7 дней      |
|Еженедельная точка восстановления     |    4 нед.     |
|Месячная точка восстановления    |   3 месяца      |
|Ежегодная точка восстановления  |      Год   |

### <a name="other-limitations"></a>Другие ограничения

- Режим MARS не поддерживает защиту нескольких компьютеров с одним и тем же именем в одном хранилище.

## <a name="supported-file-types-for-backup"></a>Поддерживаемые типы файлов для резервного копирования

**Тип** | **Поддержка**
--- | ---
Шифрование<sup>*</sup>| Поддерживается.
Compressed | Поддерживается.
разреженные; | Поддерживается.
Сжатые и разреженные |Поддерживается.
Жесткие связи| Не поддерживается. Пропущено.
Точка повторного анализа| Не поддерживается. Пропущено.
Зашифрованные и разреженные |Не поддерживается. Пропущено.
Сжатые потоки данных| Не поддерживается. Пропущено.
Разреженные потоки данных| Не поддерживается. Пропущено.
OneDrive (синхронизированные файлы — это разреженные потоки)| Не поддерживается.
Папки с включенным репликация DFS | Не поддерживается.

\* Убедитесь, что агент MARS имеет доступ к необходимым сертификатам для доступа к зашифрованным файлам. Недоступные файлы будут пропущены.

## <a name="supported-drives-or-volumes-for-backup"></a>Поддерживаемые диски или тома для резервного копирования

**Дикс/том** | **Поддержка** | **Сведения**
--- | --- | ---
Тома только для чтения| Не поддерживается | Служба теневого копирования томов (VSS) работает только в том случае, если том доступен для записи.
Автономные тома| Не поддерживается |Служба VSS работает, только если том находится в режиме «в сети».
Сетевая папка| Не поддерживается |Том должен быть локальным на сервере.
Тома, заблокированные BitLocker| Не поддерживается |Перед началом резервного копирования том должен быть разблокирован.
Идентификация файловой системы| Не поддерживается |Поддерживается только файловая система NTFS.
Съемные носители| Не поддерживается |Все источники элементов резервного копирования должны иметь *фиксированное* состояние.
Дедуплицированные диски | Поддерживается | Azure Backup преобразует дедуплицированные данные в обычные. Он оптимизирует, шифрует, сохраняет и отправляет данные в хранилище.

## <a name="support-for-initial-offline-backup"></a>Поддержка начального автономного резервного копирования

Azure Backup поддерживает *автономное заполнение* для перемещения данных начального резервного копирования в Azure с помощью дисков. Эта поддержка полезна, если начальная резервная копия, скорее всего, будет находиться в диапазоне размера терабайт (TBs). Автономное резервное копирование поддерживается для:

- Непосредственная Архивация файлов и папок на локальных компьютерах, на которых выполняется агент MARS.
- резервного копирования рабочих нагрузок и файлов с сервера DPM или MABS;

Автономное резервное копирование не может использоваться для файлов состояния системы.

## <a name="support-for-data-restoration"></a>Поддержка восстановления данных

С помощью функции [мгновенного восстановления](backup-instant-restore-capability.md) Azure Backup можно восстановить данные перед их копированием в хранилище. На компьютере, на котором выполняется резервное копирование, должна быть запущена платформа .NET Framework 4.5.2 или более поздней версии.

Резервные копии не могут быть восстановлены на целевом компьютере, на котором работает более ранняя версия операционной системы. Например, резервная копия, созданная с компьютера под Windows 7, может быть восстановлена в Windows 8 или более поздней версии. Но резервная копия, созданная с компьютера под Windows 8, не может быть восстановлена на компьютере под Windows 7.

## <a name="next-steps"></a>Дальнейшие действия

- Дополнительные сведения об [архитектуре резервного копирования, использующей агент Mars](backup-architecture.md#architecture-direct-backup-of-on-premises-windows-server-machines-or-azure-vm-files-or-folders).
- Узнайте, что поддерживается при [запуске агента Mars на сервере MABS или DPM](backup-support-matrix-mabs-dpm.md).
