---
title: Вопросы и ответы о резервном копировании баз данных SAP HANA на виртуальных машинах Azure
description: В этой статье вы найдете ответы на часто задаваемые вопросы о резервном копировании баз данных SAP HANA с помощью службы Azure Backup.
ms.topic: conceptual
ms.date: 11/7/2019
ms.openlocfilehash: bf662600bafcd18b00c8f8d3b673fc3f9c110aca
ms.sourcegitcommit: 867cb1b7a1f3a1f0b427282c648d411d0ca4f81f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "95400213"
---
# <a name="frequently-asked-questions--back-up-sap-hana-databases-on-azure-vms"></a>Вопросы и ответы о резервном копировании баз данных SAP HANA на виртуальных машинах Azure

В этой статье содержатся ответы на часто задаваемые вопросы о резервном копировании баз данных SAP HANA с помощью службы Azure Backup.

## <a name="backup"></a>Резервное копирование

### <a name="how-many-full-backups-are-supported-per-day"></a>Сколько поддерживается полных резервных копий в день?

Поддерживается только одна полная резервная копия в день. Нельзя создавать разностные резервные копии и полные резервные копии, активированные в тот же день.

### <a name="do-successful-backup-jobs-create-alerts"></a>Отправляются ли оповещения об успешно выполненных заданиях резервного копирования?

Нет. Для успешно выполненных заданий резервного копирования не создаются оповещения. Оповещения отправляются только в случае сбоя. Поведение оповещений портала подробно описано [здесь](./backup-azure-monitoring-built-in-monitor.md). Однако если вы заинтересованы в наличии оповещений даже для успешного выполнения заданий, можно использовать [Azure Monitor](./backup-azure-monitoring-use-azuremonitor.md).

### <a name="can-i-see-scheduled-backup-jobs-in-the-backup-jobs-menu"></a>Можно ли просмотреть запланированные задания резервного копирования в меню "Задания резервного копирования"?

В меню "Задание архивации" отображаются только задания архивации по запросу. Для запланированных заданий используйте [Azure Monitor](./backup-azure-monitoring-use-azuremonitor.md).

### <a name="are-future-databases-automatically-added-for-backup"></a>Добавляются ли автоматически будущие базы данных в резервное копирование?

Нет, в настоящее время это не поддерживается.

### <a name="if-i-delete-a-database-from-an-instance-what-will-happen-to-the-backups"></a>Что произойдет с резервным копированием, если удалить базу данных из экземпляра?

Если удалить базу данных из экземпляра SAP HANA, попытки ее резервного копирования все равно будут продолжаться. Это означает, что удаленная база данных начнет отображаться как неработоспособная в разделе **Элементы архивации** и будет по-прежнему обрабатываться как защищенная.
Правильный способ отключения защиты этой базы данных — выполнить в этой базе данных **остановку резервного копирования с удалением данных**.

### <a name="if-i-change-the-name-of-the-database-after-it-has-been-protected-what-will-the-behavior-be"></a>Что произойдет, если изменить имя базы данных после включения защиты?

Переименованная база данных рассматривается как новая база данных. Таким образом, служба будет обрабатывать эту ситуацию так, как если бы база данных не была найдена и не будет создавать резервные копии. Переименованная база данных будет отображаться как новая база данных и должна быть настроена для защиты.

### <a name="what-are-the-prerequisites-to-back-up-sap-hana-databases-on-an-azure-vm"></a>Каковы необходимые условия для резервного копирования баз данных SAP HANA на виртуальной машине Azure?

См. [необходимые условия](tutorial-backup-sap-hana-db.md#prerequisites) и раздел [Функции скрипта предварительной регистрации](tutorial-backup-sap-hana-db.md#what-the-pre-registration-script-does).

### <a name="what-permissions-should-be-set-so-azure-can-back-up-sap-hana-databases"></a>Какие разрешения следует задать, чтобы Azure мог выполнять резервное копирование SAP HANA баз данных?

Необходимые разрешения, позволяющие Azure выполнять резервное копирование баз данных SAP HANA, задаются при выполнении скрипта предварительной регистрации. Дополнительные сведения о том, что делает сценарий предварительной регистрации, можно найти [здесь](tutorial-backup-sap-hana-db.md#what-the-pre-registration-script-does).

### <a name="will-backups-work-after-migrating-sap-hana-from-sdc-to-mdc"></a>Будет ли выполняться резервное копирование после миграции SAP HANA из SDC в MDC?

В [этом разделе](./backup-azure-sap-hana-database-troubleshoot.md#sdc-to-mdc-upgrade-with-a-change-in-sid) содержится руководство по устранению неполадок.

### <a name="what-should-be-done-while-upgrading-within-the-same-version"></a>Что необходимо выполнить при обновлении в той же версии?

Обратитесь к [этому разделу](backup-azure-sap-hana-database-troubleshoot.md#sdc-version-upgrade-or-mdc-version-upgrade-on-the-same-vm) в руководстве по устранению неполадок.

### <a name="can-azure-hana-backup-be-set-up-against-a-virtual-ip-load-balancer-and-not-a-virtual-machine"></a>Можно ли настроить резервное копирование Azure HANA для виртуального IP-адреса (балансировщик нагрузки), а не для виртуальной машины?

Сейчас у нас нет возможности настроить решение только для виртуального IP-адреса. Для работы этого решения требуется виртуальная машина.

### <a name="how-can-i-move-an-on-demand-backup-to-the-local-file-system-instead-of-the-azure-vault"></a>Как выполнить резервное копирование по запросу в локальную файловую систему, а не в хранилище Azure?

1. Дождитесь завершения текущей резервной копии требуемой базы данных (выполните проверку из Studio для завершения).
1. Отключите резервное копирование журналов и установите **файловую систему** в качестве каталога резервного копирования для требуемой базы данных, выполнив следующие действия.
1. Дважды щелкните **systemdb** -> **Конфигурация** -> **Выбрать базу данных** -> **Фильтр (журнал)** .
    1. Задайте для параметра enable_auto_log_backup значение **нет**.
    1. Задайте для catalog_backup_using_backint **значение false**.
1. Выполните резервное копирование по запросу (полное/разностное/добавочное) для нужной базы данных и дождитесь завершения резервного копирования и архивации каталога.
1. Если необходимо также переместить резервные копии журналов в файловую систему, задайте для параметра enable_auto_log_backup значение **Да**.
1. Верните предыдущие значения параметров, чтобы разрешить резервное копирование в хранилище Azure.
    1. Задайте для параметра enable_auto_log_backup значение **Да**.
    1. Задайте для catalog_backup_using_backint **значение true**.

>[!NOTE]
>Перемещение резервных копий в локальную файловую систему и обратное переключение в хранилище Azure может привести к разрыву цепочки журналов резервных копий журналов в хранилище. Это приведет к запуску полной резервной копии, что после успешного завершения приведет к резервному копированию журналов.

### <a name="how-can-i-use-sap-hana-backup-with-my-hana-replication-set-up"></a>Как можно использовать SAP HANA резервное копирование с настроенной репликацией HANA?

В настоящее время Azure Backup не имеет возможности понять настройку HSR. Это означает, что основной и дополнительный узлы HSR будут рассматриваться как две отдельные, несвязанные виртуальные машины. Сначала необходимо настроить резервное копирование на основном узле. Когда происходит отработка отказа, необходимо настроить резервное копирование на вторичном узле (который теперь становится основным узлом). Автоматическая архивация на другой узел отсутствует.

Для резервного копирования данных из активного (первичного) узла в любой момент времени можно **Переключить защиту** на вторичный узел, который теперь становится первичным после отработки отказа.

Чтобы выполнить эту **защиту**, выполните следующие действия.

- [Отключение защиты](sap-hana-db-manage.md#stop-protection-for-an-sap-hana-database) (с помощью удержания данных) на первичном
- Запуск [скрипта предварительной регистрации](https://aka.ms/scriptforpermsonhana) на вторичном узле
- [Обнаружение баз данных](tutorial-backup-sap-hana-db.md#discover-the-databases) на вторичном узле и [Настройка резервных копий](tutorial-backup-sap-hana-db.md#configure-backup) на них

Эти действия необходимо выполнить вручную после каждого отработки отказа. Эти действия можно выполнить с помощью командной строки или протокола HTTP RESTFUL в дополнение к портал Azure. Для автоматизации этих шагов можно использовать модуль Runbook Azure.

Ниже приведен подробный пример того, как должна быть выполнена **Защита коммутатора** .

В этом примере у вас есть два узла: node 1 (основной) и node 2 (дополнительный) в HSR.  Резервные копии настраиваются на узле 1. Как упоминалось выше, не пытайтесь настроить резервное копирование на узле 2.

Когда происходит первая отработка отказа, узел 2 станет основным. В этой конфигурации будет справедливо следующее:

1. Отключите защиту узла 1 (предыдущий первичный) с параметром "хранить данные".
1. Запустите сценарий предварительной регистрации на узле 2 (который теперь является первичным).
1. Обнаружение баз данных на узле 2, назначение политики резервного копирования и Настройка резервного копирования.

Затем запускается первая полная резервная копия на узле 2 и после этого завершается резервное копирование журналов.

При следующей отработки отказа узел 1 снова станет первичным, а узел 2 станет вторичным. Теперь повторите эту процедуру:

1. Отключите защиту узла 2 с помощью параметра "хранить данные".
1. Запустите сценарий предварительной регистрации на узле 1 (который опять стал основным).
1. Затем [возобновите резервное копирование](sap-hana-db-manage.md#resume-protection-for-an-sap-hana-database) на узле 1 с требуемой политикой (так как резервные копии были остановлены ранее на узле 1).

После этого полная резервная копия будет активирована на узле 1, а после завершения резервного копирования журналов начнется.

## <a name="restore"></a>Восстановить

### <a name="why-cant-i-see-the-hana-system-i-want-my-database-to-be-restored-to"></a>Почему не отображается система HANA, в которую нужно восстановить базу данных?

Проверьте, выполнены ли все предварительные условия для восстановления в целевом экземпляре SAP HANA. Дополнительные сведения см. в разделе [Восстановление баз данных SAP HANA на виртуальных машинах Azure. Предварительные требования](./sap-hana-db-restore.md#prerequisites).

### <a name="why-is-the-overwrite-db-restore-failing-for-my-database"></a>Почему не удается восстановить базу данных с перезаписью?

Убедитесь, что при восстановлении выбран параметр **Принудительная перезапись**.

### <a name="why-do-i-see-the-source-and-target-systems-for-restore-are-incompatible-error"></a>Почему возникает ошибка "Исходная и конечная системы для восстановления несовместимы"?

Чтобы узнать, какие типы восстановления поддерживаются в настоящее время, обратитесь к заметке SAP HANA номер [1642148](https://launchpad.support.sap.com/#/notes/1642148).

### <a name="can-i-use-a-backup-of-a-database-running-on-sles-to-restore-to-an-rhel-hana-system-or-vice-versa"></a>Можно ли использовать резервную копию базы данных, работающей на SLES, для восстановления в систему RHEL HANA или наоборот?

Да, вы можете использовать резервные копии потоковой передачи, активируемые в базе данных HANA, работающей на SLES, чтобы восстановить ее в систему RHEL HANA и наоборот. То есть восстановление между операционными системами возможно с помощью потоковой архивации. Однако необходимо убедиться, что система HANA, в которую требуется выполнить восстановление, и система HANA, используемая для восстановления, совместимы для восстановления в соответствии с SAP. Сведения о том, какие типы восстановления являются совместимыми, см. в SAP HANA Примечание [1642148](https://launchpad.support.sap.com/#/notes/1642148) .

## <a name="policy"></a>Политика

### <a name="different-options-available-during-creation-of-a-new-policy-for-sap-hana-backup"></a>Различные параметры, доступные при создании новой политики для резервного копирования SAP HANA

Перед созданием политики необходимо четко проделать требования к RPO и RTO и соответствующим затратам.

RPO (цель восстановления) указывает, какой объем данных приемлем для пользователя или клиента. Это определяется частотой резервного копирования журналов. Более частые резервные копии журналов указывают на более низкие значения RPO, а минимальное значение, поддерживаемое службой Azure Backup, составляет 15 минут. Поэтому периодичность резервного копирования журналов может составлять не более 15 минут.

RTO (время восстановления) указывает скорость восстановления данных до последнего доступного момента времени после потери данных. Это зависит от стратегии восстановления, применяемой HANA, которая обычно зависит от того, сколько файлов требуется для восстановления. Это также влияет на затраты, и Следующая таблица должна помочь в понимании всех сценариев и их влиянии.

|Политика резервного копирования  |RTO  |Cost  |
|---------|---------|---------|
|Ежедневное полное + журналы     |   Быстрее, так как для восстановления на момент времени требуется только один полный и обязательный журналы копирования.      |    Параметр костлиест, так как полная копия выполняется ежедневно, поэтому в серверной части накапливается больше данных, пока не закончится время хранения.   |
|Еженедельные полные и ежедневные разностные и журналы     |   Медленнее, чем приведенный выше вариант, но быстрее, чем следующий вариант, так как для восстановления до точки во времени требуется один полный и один разностный копирование и журналы.      |    Менее дорогостоящий вариант, так как ежедневная разностная копия обычно меньше, чем полная, а полная копия создается только раз в неделю.      |
|Еженедельные полные и ежедневные добавочные + журналы     |  Самое медленное из-за того, что для восстановления на момент времени требуется одна полная копия + ' n ' добавочные и журналы.       |     Самый ресурсоемкий вариант, так как ежедневное добавочное приращение будет меньше разностной, а полная копия — только еженедельно    |

> [!NOTE]
> Приведенные выше параметры являются наиболее распространенными, но не единственными параметрами. Например, можно создать еженедельное полное резервное копирование и разностные копии дважды в течение недели и журналов.

Таким образом, можно выбрать вариант политики на основе целевых показателей RPO и RTO, а также учитывать затраты.

### <a name="impact-of-modifying-a-policy"></a>Влияние изменения политики

При определении влияния переключения политики резервного копирования с политики 1 (P1) на политику 2 (P2) или изменения политики 1 (P1) следует учитывать несколько принципов.

- Все изменения также применяются задним числом. Последняя политика архивации также применяется к точкам восстановления, сделанным ранее. Например, предположим, что ежедневное полное хранение составляет 30 дней и 10 точек восстановления в соответствии с действующей в настоящее время политикой. Если ежедневное полное хранение изменяется на 10 дней, время окончания срока действия предыдущей точки также пересчитывается как время начала + 10 дней и удаляется, если срок их действия истек.
- Область изменений также включает в себя день резервного копирования, тип резервного копирования и срок хранения. Например, если политика изменяется с ежедневного полного на еженедельное по воскресеньям, все более ранние заполнения, которые не в воскресенье, будут помечены для удаления.
- Родительский элемент не удаляется, пока не будет активен или не истечет срок действия дочернего элемента. Срок действия каждого типа резервной копии зависит от текущей активной политики. Но тип полного резервного копирования считается родительским для последующих "разностных", "добавочных" и "журналов". "Разностный" и "журнал" не являются родительскими для других пользователей. "Добавочный" может быть родительским для последующего "добавочного". Даже если родительский элемент помечен для удаления, он фактически не удаляется, если срок действия дочерних "разностных" или "журналов" не истек. Например, если политика изменяется с ежедневного полного на еженедельное по воскресеньям, все более ранние заполнения, которые не в воскресенье, будут помечены для удаления. Но они не удаляются, пока не истечет срок действия журналов, которые были сделаны раньше. Иными словами, они будут храниться в соответствии с последней длительностью журнала. После истечения срока действия журналов все журналы и эти данные будут удалены.

С помощью этих принципов можно прочитать следующую таблицу, чтобы понять последствия изменения политики.

|Старая политика/новая политика  |Ежедневное заполнение + журналы  | Еженедельные полные и ежедневные разностные копии + журналы  |Еженедельное заполнение + ежедневное приращение + журналы  |
|---------|---------|---------|---------|
|Ежедневное заполнение + журналы     |   -      |    Предыдущее заполнение, которое не входит в тот же день недели, отмечается для удаления, но сохраняется до наступления срока хранения журнала.     |    Предыдущее заполнение, которое не входит в тот же день недели, отмечается для удаления, но сохраняется до наступления срока хранения журнала.     |
|Еженедельные полные и ежедневные разностные копии + журналы     |   Предыдущие еженедельные полные сроки хранения пересчитываются в соответствии с последней политикой. Предыдущие разностные копии немедленно удаляются      |    -     |    Предыдущие разностные копии немедленно удаляются     |
|Еженедельное заполнение + ежедневное приращение + журналы     |     Предыдущие еженедельные полные сроки хранения пересчитываются в соответствии с последней политикой. Предыдущие инкременты немедленно удаляются    |     Предыдущие инкременты немедленно удаляются    |    -     |

## <a name="next-steps"></a>Дальнейшие действия

Узнайте, как [выполнять резервное копирование баз данных SAP HANA](./backup-azure-sap-hana-database.md), работающих на виртуальных машинах Azure.
