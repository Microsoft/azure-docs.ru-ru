---
title: Агент Службы восстановления Microsoft Azure (MARS) — часто задаваемые вопросы
description: Здесь рассматриваются распространенные вопросы о резервном копировании файлов и папок с помощью Azure Backup.
ms.topic: conceptual
ms.date: 07/29/2019
ms.openlocfilehash: 1edfaed99e60409774496c5ae75df8be99a8fe1f
ms.sourcegitcommit: 867cb1b7a1f3a1f0b427282c648d411d0ca4f81f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "94917364"
---
# <a name="frequently-asked-questions---microsoft-azure-recovery-services-mars-agent"></a>Часто задаваемые вопросы — агент Службы восстановления Microsoft Azure (MARS)

В этой статье содержатся ответы на часто задаваемые вопросы о резервном копировании данных с помощью агента Службы восстановления Microsoft Azure (MARS) в службе [Azure Backup](backup-overview.md) .

## <a name="configure-backups"></a>Настройка резервного копирования.

### <a name="where-can-i-download-the-latest-version-of-the-mars-agent"></a>Где можно загрузить последнюю версию агента MARS?

Последний агент MARS, используемый при резервном копировании компьютеров Windows Server, System Center DPM и Microsoft Azure Backup Server, доступен для [загрузки](https://aka.ms/azurebackup_agent).

### <a name="where-can-i-download-the-vault-credentials-file"></a>Где можно скачать файл учетных данных хранилища?

В портал Azure перейдите к **свойствам** хранилища. В разделе **учетные данные архивации** установите флажок, чтобы **уже использовать последний агент служб восстановления**. Выберите **Загрузить**.

![Загрузка учетных данных](./media/backup-azure-file-folder-backup-faq/download-credentials.png)

### <a name="how-long-are-vault-credentials-valid"></a>Как долго учетные данные хранилища действительны?

Срок действия учетных данных хранилища истекает через 10 дней. Если срок действия файла учетных данных истек, скачайте его еще раз из портал Azure.

### <a name="what-characters-are-allowed-for-the-passphrase"></a>Какие символы можно использовать для парольной фразы?

Парольная фраза должна использовать символы из кодировки ASCII со [значениями ASCII, меньшими или равными 127](/office/vba/language/reference/user-interface-help/character-set-0127).

### <a name="from-what-drives-can-i-back-up-files-and-folders"></a>С каких дисков можно создавать резервные копии файлов и папок?

Вы не можете создавать резервные копии дисков и томов следующих типов:

* Съемные носители: все источники элементов резервного копирования должны быть исправлены.
* Тома только для чтения. для работы службы теневого копирования томов (VSS) том должен быть доступен для записи.
* Автономные тома. том должен быть подключен к сети, чтобы служба VSS функционировала.
* Общие сетевые папки. том должен быть локальным для сервера, для которого будет выполняться резервное копирование с помощью оперативной архивации.
* Тома, защищенные с помощью BitLocker. для создания резервной копии том должен быть разблокирован.
* Идентификация файловой системы. Эта служба поддерживает только файловую систему NTFS.

### <a name="what-file-and-folder-types-are-supported"></a>Какие типы файлов и папок поддерживаются?

Дополнительные [сведения](backup-support-matrix-mars-agent.md#supported-file-types-for-backup) о типах файлов и папок, поддерживаемых для резервного копирования.

### <a name="can-i-use-the-mars-agent-to-back-up-files-and-folders-on-an-azure-vm"></a>Можно ли использовать агент MARS для резервного копирования файлов и папок на виртуальной машине Azure?  

Да. Azure Backup предоставляет резервное копирование на уровне ВИРТУАЛЬНОЙ машины для виртуальных машин Azure с помощью расширения виртуальной машины для агента виртуальной машины Azure. Если вы хотите создавать резервные копии файлов и папок в гостевой операционной системе Windows на виртуальной машине, можно установить агент MARS.

### <a name="can-i-use-the-mars-agent-to-back-up-files-and-folders-on-temporary-storage-for-the-azure-vm"></a>Можно ли использовать агент MARS для резервного копирования файлов и папок во временном хранилище для виртуальной машины Azure?

Да. Установите агент MARS и создайте резервные копии файлов и папок в гостевой операционной системе Windows во временном хранилище.

* Задания резервного копирования завершаются сбоем, когда данные временного хранилища очищаются.
* Если временные данные хранилища удалены, вы можете восстановить их только в энергонезависимом хранилище.

### <a name="how-do-i-register-a-server-to-another-region"></a>Разделы справки зарегистрировать сервер в другом регионе?

Данные резервного копирования отправляются в центр обработки данных хранилища, в котором зарегистрирован сервер. Самый простой способ изменить центр обработки данных — это удалить и переустановить агент, а затем зарегистрировать компьютер в новом хранилище в нужном регионе.

### <a name="does-the-mars-agent-support-windows-server-2012-deduplication"></a>Поддерживает ли агент MARS дедупликацию Windows Server 2012?

Да. Агент MARS преобразует дедупликацию данных в обычные данные при подготовке операции резервного копирования. Затем он оптимизирует данные для резервного копирования, шифрует данные, а затем отправляет зашифрованные данные в хранилище.

### <a name="do-i-need-administrator-permissions-to-install-and-configure-the-mars-agent"></a>Требуются ли права администратора для установки и настройки агента MARS?

Да, установка агента MARS и Настройка резервного копирования с помощью консоли MARS требуют, чтобы пользователь был локальным администратором на защищенном сервере.

### <a name="what-is-the-impact-on-mars-agent-backups-of-transferring-the-vault-subscription-to-a-different-azure-ad-directory"></a>Каково влияние на резервное копирование агента MARS на передачу подписки хранилища в другой каталог Azure AD?

Изменение каталога Azure AD не повлияет на резервное копирование агентов MARS. 

## <a name="manage-backups"></a>Управление резервными копиями

### <a name="what-happens-if-i-rename-a-windows-machine-configured-for-backup"></a>Что произойдет, если переименовать компьютер Windows, настроенный для архивации?

При переименовании компьютера Windows все настроенные в данный момент резервные копии останавливаются.

* Необходимо зарегистрировать новое имя компьютера в хранилище службы архивации.
* При регистрации нового имени в хранилище первая операция является *полной* резервной копией.
* Если необходимо восстановить данные из резервной копии в хранилище с прежним именем сервера, используйте параметр для восстановления в альтернативное расположение в мастере восстановления данных. [Подробнее](backup-azure-restore-windows-server.md#use-instant-restore-to-restore-data-to-an-alternate-machine).

### <a name="what-is-the-maximum-file-path-length-for-backup"></a>Какова максимальная длина пути к файлу для резервного копирования?

Агент MARS опирается на NTFS и использует спецификацию длины FilePath, ограниченную [API Windows](/windows/win32/FileIO/naming-a-file#fully-qualified-vs-relative-paths). Если файлы, которые требуется защитить, длиннее допустимого значения, создайте резервную копию родительской папки или диска.  

### <a name="what-characters-are-allowed-in-file-paths"></a>Какие символы разрешены в путях к файлам?

Агент MARS использует NTFS и [поддерживает символы](/windows/win32/FileIO/naming-a-file#naming-conventions) в именах и путях файлов.

### <a name="the-warning-azure-backups-have-not-been-configured-for-this-server-appears"></a>Появится предупреждение "служба архивации Azure не настроена для этого сервера"

Это предупреждение может появиться даже в том случае, если вы настроили политику архивации, если параметры расписания резервного копирования, хранящиеся на локальном сервере, не совпадают с параметрами, хранящимися в хранилище службы архивации.

* Если сервер или параметры восстановлены до известного состояния работоспособности, расписания резервного копирования могут стать несинхронизированными.
* Если вы получаете это предупреждение, [Настройте](backup-azure-manage-windows-server.md) политику архивации еще раз, а затем выполните резервное копирование по запросу, чтобы повторно синхронизировать локальный сервер с Azure.

## <a name="manage-the-backup-cache-folder"></a>Управление папкой кэша резервного копирования

### <a name="whats-the-minimum-size-requirement-for-the-cache-folder"></a>Каков минимальный необходимый размер папки кэша?

Размер папки кэша определяет объем данных, для которых выполняется резервное копирование.

* Тома в папке кэша должны иметь свободное место, равное по крайней мере 5-10% общего размера данных резервной копии.
* Если объем свободного места на томе меньше 5%, увеличьте размер тома или переместите папку кэша на том с достаточным объемом свободного места, выполнив следующие [действия](#how-do-i-change-the-cache-location-for-the-mars-agent).
* При резервном копировании состояния системы Windows потребуется дополнительно 30-35 ГБ свободного места в томе, содержащем папку кэша.

### <a name="how-to-check-if-scratch-folder-is-valid-and-accessible"></a>Как проверить, является ли папка временных файлов допустимой и доступной?

1. По умолчанию вспомогательная папка находится в папке `\Program Files\Microsoft Azure Recovery Services Agent\Scratch`
2. Убедитесь, что путь к расположению временной папки совпадает со значениями разделов реестра, показанными ниже:

    | Путь к элементу реестра | Ключ реестра | Значение |
    | --- | --- | --- |
    | `HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows Azure Backup\Config` |ScratchLocation |*Новое расположение папки кэша* |
    | `HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows Azure Backup\Config\CloudBackupProvider` |ScratchLocation |*Новое расположение папки кэша* |

### <a name="how-do-i-change-the-cache-location-for-the-mars-agent"></a>Разделы справки изменить расположение кэша для агента MARS?

1. Выполните эту команду в командной строке с повышенными привилегиями, чтобы отключить модуль резервного копирования:

    ```Net stop obengine```
2. Если вы настроили резервное копирование состояния системы, откройте оснастку "Управление дисками" и отключите диски с именами в формате `"CBSSBVol_<ID>"` .
3. По умолчанию вспомогательная папка находится в папке `\Program Files\Microsoft Azure Recovery Services Agent\Scratch`
4. Скопируйте всю `\Scratch` папку на другой диск с достаточным объемом свободного места. Убедитесь, что содержимое скопировано, а не перемещено.
5. Обновите следующие записи реестра, указав путь к вновь перемещенной временной папке.

    | Путь к элементу реестра | Ключ реестра | Значение |
    | --- | --- | --- |
    | `HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows Azure Backup\Config` |ScratchLocation |*Новое расположение вспомогательной папки* |
    | `HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows Azure Backup\Config\CloudBackupProvider` |ScratchLocation |*Новое расположение вспомогательной папки* |

6. Перезапустите модуль резервного копирования в командной строке с повышенными привилегиями:

    ```command
    Net stop obengine

    Net start obengine
    ```

7. выполнение резервного копирования по требованию. После успешного завершения резервного копирования в новом расположении можно удалить исходную папку кэша.

### <a name="where-should-the-cache-folder-be-located"></a>Где следует разместить папку кэша?

Не рекомендуется использовать следующие расположения для папки кэша:

* Сетевая папка или съемный носитель. папка кэша должна быть локальной на сервере, для которого требуется резервное копирование с помощью оперативного резервного копирования. Сетевые расположения или съемные носители, такие как USB-накопители, не поддерживаются.
* Автономные тома: папка кэша должна быть в сети для ожидаемого резервного копирования с помощью агента Azure Backup

### <a name="are-there-any-attributes-of-the-cache-folder-that-arent-supported"></a>Существуют ли какие либо атрибуты папки кэша, которые не поддерживаются?

Следующие атрибуты или их сочетания не поддерживаются для папки кэша:

* С шифрованием
* дедупликация;
* Compressed
* разреженные;
* точка повторного анализа.

Папка кэша и виртуальный жесткий диск метаданных не имеют необходимых атрибутов для агента Azure Backup.

### <a name="is-there-a-way-to-adjust-the-amount-of-bandwidth-used-for-backup"></a>Существует ли способ настройки объема пропускной способности, используемой для резервного копирования?

Да, можно использовать параметр **изменить свойства** в АГЕНТе Mars, чтобы настроить пропускную способность и время. [Подробнее](backup-windows-with-mars-agent.md#enable-network-throttling).

## <a name="restore"></a>Восстановить

### <a name="manage"></a>Управление

#### <a name="can-i-recover-if-i-forgot-my-passphrase"></a>Можно ли выполнить восстановление, если забыли парольную фразу?

Агенту Azure Backup требуется парольная фраза (указанная во время регистрации) для расшифровки резервных копий данных во время восстановления. Ознакомьтесь с приведенными ниже сценариями, чтобы узнать о вариантах обработки потерянной парольной фразы.

| Исходный компьютер <br> *(исходный компьютер, на котором были созданы резервные копии)* | Парольная фраза | Доступные параметры |
| --- | --- | --- |
| Доступно |Lost |Если исходный компьютер (где были созданы резервные копии) доступен и по-прежнему зарегистрирован в том же хранилище служб восстановления, вы можете повторно создать парольную фразу, выполнив следующие [действия](./backup-azure-manage-mars.md#re-generate-passphrase).  |
| Lost |Lost |Невозможно восстановить данные или данные недоступны |

Проверьте следующее:

* При удалении и повторной регистрации агента на том же исходном компьютере с
  * *Той же парольной фразы*, вы можете восстановить резервные копии данных.
  * *Другая парольная фраза*, вы не сможете восстановить резервные копии данных.
* Если агент устанавливается на *другом компьютере* с
  * *Той же парольной фразе* (используется на исходном компьютере), вы можете восстановить резервные копии данных.
  * *Другая парольная фраза*, вы не сможете восстановить резервные копии данных.
* Если исходный компьютер поврежден (что предотвращает повторное создание парольной фразы через консоль MARS), но можно восстановить или получить доступ к исходной временной папке, используемой агентом MARS, после чего вы сможете выполнить восстановление (если пароль забыт). За дополнительной помощью обратитесь в службу поддержки пользователей.

#### <a name="how-do-i-recover-if-i-lost-my-original-machine-where-backups-were-taken"></a>Разделы справки восстановить в случае утери исходного компьютера (где были созданы резервные копии)?

Если у вас есть та же парольная фраза (указанная во время регистрации) на исходном компьютере, можно восстановить резервные копии данных на другой компьютер. Ознакомьтесь с приведенными ниже сценариями, чтобы понять параметры восстановления.

| Исходный компьютер | Парольная фраза | Доступные параметры |
| --- | --- | --- |
| Lost |Доступно |Агент MARS можно установить и зарегистрировать на другом компьютере с той же парольной фразой, которую вы указали во время регистрации исходного компьютера. Выберите **вариант восстановления**  >  **другое расположение** , чтобы выполнить восстановление. Дополнительные сведения см. в этой [статье](./backup-azure-restore-windows-server.md#use-instant-restore-to-restore-data-to-an-alternate-machine).
| Lost |Lost |Невозможно восстановить данные или данные недоступны |

### <a name="my-backup-jobs-have-been-failing-or-not-running-for-a-long-time-im-past-the-retention-period-can-i-still-restore"></a>В течение длительного времени задания резервного копирования завершаются сбоем или не выполняются. Я последний срок хранения. Можно ли по-прежнему выполнять восстановление?

В качестве меры безопасности Azure Backup сохранит последнюю точку восстановления, даже если она прошла срок хранения. После того как резервное копирование продолжится и новые точки восстановления станут доступны, старая точка восстановления будет удалена в соответствии с заданным периодом хранения.

### <a name="what-happens-if-i-cancel-an-ongoing-restore-job"></a>Что произойдет, если отменить выполняемое задание восстановления?

Если текущее задание восстановления отменяется, процесс восстановления останавливается. Все файлы, восстановленные до отмены, остаются в настроенном месте (исходное или альтернативное расположение) без каких-либо откатов.

### <a name="does-the-mars-agent-back-up-and-restore-acls-set-on-files-folders-and-volumes"></a>Выполняет ли агент MARS резервное копирование и восстановление списков ACL, заданных для файлов, папок и томов?

* Агент MARS создает резервные наборы ACL, заданные для файлов, папок и томов.
* Для функции восстановления восстановления тома агент MARS предоставляет возможность пропустить восстановление разрешений ACL для восстанавливаемого файла или папки.
* Для параметра восстановления отдельных файлов и папок агент MARS будет восстанавливаться с разрешениями ACL (отсутствует возможность пропустить восстановление списка ACL).

## <a name="next-steps"></a>Дальнейшие действия

[Узнайте](tutorial-backup-windows-server-to-azure.md) , как создать резервную копию компьютера Windows.
