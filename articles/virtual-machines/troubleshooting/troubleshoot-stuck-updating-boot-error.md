---
title: Зависание виртуальной машины при запуске во время обновления Windows | Документация Майкрософт
description: Узнайте, как устранить неполадки при зависании виртуальной машины при запуске во время обновления Windows.
services: virtual-machines-windows
documentationCenter: ''
author: genlin
manager: dcscontentpm
editor: v-jesits
ms.service: virtual-machines-windows
ms.topic: troubleshooting
ms.tgt_pltfrm: vm-windows
ms.workload: infrastructure
ms.date: 10/09/2018
ms.author: genli
ms.openlocfilehash: 3090b7b889d914fc0cdb598b8bf29a73c81f50cb
ms.sourcegitcommit: 484f510bbb093e9cfca694b56622b5860ca317f7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/21/2021
ms.locfileid: "98632009"
---
# <a name="azure-vm-startup-is-stuck-at-windows-update"></a>Зависание виртуальной машины при запуске во время обновления Windows

Эта статья помогает решить проблему, когда виртуальная машина зависает на этапе обновления Windows во время запуска. 


## <a name="symptom"></a>Симптом

 Виртуальная машина Windows не запускается. При проверке снимков экрана в окне [Диагностика загрузки](../troubleshooting/boot-diagnostics.md) вы обнаруживаете, что во время запуска произошло зависание на этапе обновления. Ниже приведены примеры сообщений об ошибках.

- Установка Windows ##%. Не выключайте компьютер. Это займет некоторое время. Компьютер перезагрузится несколько раз.
- Не выключайте компьютер до завершения. Установка обновления # из #... 
- Мы не смогли завершить обновления. Отмена изменений. Не выключайте компьютер.
- Сбой при настройке обновлений Windows. Отмена изменений. Не выключайте компьютер.
- Ошибка <код ошибки> применения операций обновления ##### из ##### (\Regist...)
- Неустранимая ошибка <код ошибки> применения операций обновления ##### из ##### ($$...)


## <a name="solution"></a>Решение
> [!TIP]
> Если у вас есть недавняя резервная копия виртуальной машины, можно попытаться [восстановить виртуальную машину из резервной копии](../../backup/backup-azure-arm-restore-vms.md) , чтобы устранить проблему загрузки.

В зависимости от количества обновлений, которые устанавливаются или откатываются, процесс обновления может занять некоторое время. Оставьте виртуальную машину в этом состоянии на 8 часов. Если по прошествии этого периода виртуальная машина по-прежнему пребывает в этом состоянии, перезапустите ее на портале Azure и проверьте, запускается ли она обычным образом. Если этот шаг не помог, попробуйте следующее решение.

### <a name="remove-the-update-that-causes-the-problem"></a>Удаление обновления, вызвавшего проблему

1. Сделайте снимок диска ОС затронутой виртуальной машины в качестве резервной копии. Дополнительные сведения см. в статье [Создание моментального снимка](../windows/snapshot-copy-managed-disk.md). 
2. [Подключите диск операционной системы к виртуальной машине восстановления](troubleshoot-recovery-disks-portal-windows.md).
3. После подключения диска операционной системы на виртуальной машине восстановления запустите **diskmgmt.msc**, чтобы открыть "Управление дисками", и убедитесь, что подключенный диск **В сети**. Обратите внимание на букву диска, которая назначается присоединенному диску ОС с папкой \Windows. Если диск зашифрован, расшифруйте его, прежде чем приступать к следующим шагам в этом документе.

4. Откройте командную строку с повышенными привилегиями (Запуск от имени администратора). Выполните следующую команду, чтобы получить список пакетов обновления, которые находятся на прилагаемом диске ОС:

    ```console
    dism /image:<Attached OS disk>:\ /get-packages > c:\temp\Patch_level.txt
    ```

    Например, если подключенный диск ОС является диском F, выполните следующую команду:

    ```console
    dism /image:F:\ /get-packages > c:\temp\Patch_level.txt
    ```

5. Откройте файл C:\temp\Patch_level.txt, а затем прочтите его снизу вверх. Найдите обновление, которое находится в состоянии **ожидания установки** или **ожидания удаления**.  Ниже приведен пример состояния обновления.

    ```
    Package Identity : Package_for_RollupFix~31bf3856ad364e35~amd64~~17134.345.1.5
    State : Install Pending
    Release Type : Security Update
    Install Time :
    ```
6. Удалите обновление, вызвавшее проблему:
    
    ```
    dism /Image:<Attached OS disk>:\ /Remove-Package /PackageName:<PACKAGE NAME TO DELETE>
    ```
    Пример: 

    ```
    dism /Image:F:\ /Remove-Package /PackageName:Package_for_RollupFix~31bf3856ad364e35~amd64~~17134.345.1.5
    ```

    > [!NOTE] 
    > В зависимости от размера пакета инструменту DISM понадобится некоторое время для обработки отмены установки. Обычно процесс завершается в течение 16 минут.

7. [Отключение диска операционной системы и повторное создание виртуальной машины](troubleshoot-recovery-disks-portal-windows.md#unmount-and-detach-the-original-virtual-hard-disk). Затем проверьте, устранена ли проблема.
