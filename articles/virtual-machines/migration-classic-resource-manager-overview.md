---
title: Обзор поддерживаемого платформой переноса ресурсов IaaS из классической модели в модель Azure Resource Manager
description: Пройдите по поддерживаемой платформой перенос ресурсов из классической модели в Azure Resource Manager.
author: tanmaygore
manager: vashan
ms.service: virtual-machines
ms.subservice: classic-to-arm-migration
ms.workload: infrastructure-services
ms.topic: conceptual
ms.date: 02/06/2020
ms.author: tagore
ms.openlocfilehash: 116e99339ac79e9e6a2de5e7a6222460a71bf4a1
ms.sourcegitcommit: d135e9a267fe26fbb5be98d2b5fd4327d355fe97
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/10/2021
ms.locfileid: "102615097"
---
# <a name="platform-supported-migration-of-iaas-resources-from-classic-to-azure-resource-manager"></a>Поддерживаемый платформой перенос ресурсов IaaS из классической модели в модель Azure Resource Manager

> [!IMPORTANT]
> Сегодня около 90% виртуальных машин IaaS используют [Azure Resource Manager](https://azure.microsoft.com/features/resource-manager/). По состоянию на 28 февраля 2020, классические виртуальные машины являются устаревшими и будут полностью сняты с 1 марта 2023. [Узнайте больше]( https://aka.ms/classicvmretirement) об этой нерекомендуемости и [о том, как она влияет на вас](classic-vm-deprecation.md#how-does-this-affect-me).



В этой статье содержатся общие сведения о средстве миграции, поддерживаемых платформой, о переносе ресурсов из классической модели Service Manager Azure (ASM) в модель развертывания диспетчер ресурсов (ARM), а также сведения о подключении ресурсов из двух моделей развертывания, сосуществующих в подписке, с помощью шлюза "сеть — сеть" виртуальной сети. Дополнительные сведения о [Azure Resource Manager функциях и преимуществах см](../azure-resource-manager/management/overview.md). здесь. 

ASM поддерживает два различных продукта вычислений: виртуальные машины Azure (классические), которые являются виртуальными машинами IaaS & [облачных службах Azure (классические)](../cloud-services/index.yml) , которые являются виртуальными машинами PaaS или веб-ролями. Этот документ говорит только о переносе виртуальных машин Azure (классическая модель).

## <a name="goal-for-migration"></a>Цель миграции
Resource Manager позволяет развертывать сложные приложения с помощью шаблонов, настраивать виртуальные машины с помощью расширений виртуальных машин и внедрять управление доступом и добавление тегов. Azure Resource Manager позволяет выполнить масштабируемое параллельное развертывание виртуальных машин в группах доступности. Новая модель предоставляет также возможности независимого управления жизненным циклом вычислительных и сетевых ресурсов, а также ресурсов хранилища. И наконец, благодаря принудительному использованию виртуальных машин в виртуальной сети появилась возможность включать защиту по умолчанию.

Почти все функции для выполнения вычислений, работы с сетью и хранилищем из классической модели развертывания поддерживаются в модели Azure Resource Manager. Чтобы использовать преимущества новых возможностей Azure Resource Manager, можно перенести существующие развернутые службы из классической модели развертывания.

## <a name="supported-resources--configurations-for-migration"></a>Поддерживаемые ресурсы & конфигурации для миграции

### <a name="supported-resources-for-migration"></a>Поддерживаемые при миграции ресурсы
* Виртуальные машины
* Группы доступности
* Учетные записи хранения
* Виртуальные сети
* VPN-шлюзы;
* [Шлюзы Express Route](../expressroute/expressroute-howto-move-arm.md) _(в той же подписке, что и виртуальная сеть)_
* группы сетевой безопасности;
* таблицы маршрутов;
* Зарезервированные IP-адреса

## <a name="supported-configurations-for-migration"></a>Поддерживаемые конфигурации для миграции
При миграции поддерживаются следующие классические ресурсы IaaS:

| Служба | Конфигурация |
| --- | --- |
| Доменные службы Azure AD | [Виртуальные сети, содержащие доменные службы Azure AD.](../active-directory-domain-services/migrate-from-classic-vnet.md) |

## <a name="supported-scopes-of-migration"></a>Поддерживаемые области применения миграции
Существуют 4 способа перенести вычислительные ресурсы, ресурсы хранилища и сетевые ресурсы:

* [перенос виртуальных машин (не в виртуальной сети);](#migration-of-virtual-machines-not-in-a-virtual-network)
* [Перенос виртуальных машин (в виртуальной сети)](#migration-of-virtual-machines-in-a-virtual-network)
* [перенос учетных записей хранения](#migration-of-storage-accounts);
* [Перенос неподключенных ресурсов](#migration-of-unattached-resources)

### <a name="migration-of-virtual-machines-not-in-a-virtual-network"></a>перенос виртуальных машин (не в виртуальной сети);
В модели развертывания с помощью Resource Manager защита приложений применяется принудительно по умолчанию. В данной модели все виртуальные машины должны находиться в виртуальной сети. Платформа Azure перезапускает (`Stop`, `Deallocate` и `Start`) виртуальные машины в ходе миграции. Для виртуальной сети, в которую перемещаются виртуальные машины, существует два варианта:

* Вы можете отправить к платформе запрос на создание новой виртуальной сети и перенести виртуальную машину в нее.
* Вы можете перенести виртуальную машину в существующую виртуальную сеть в Resource Manager.

> [!NOTE]
> При такой области применения во время миграции, возможно, какое-то время будет запрещено выполнять операции в плоскости управления и плоскости данных.
>

### <a name="migration-of-virtual-machines-in-a-virtual-network"></a>Перенос виртуальных машин (в виртуальной сети)
Для большинства конфигураций виртуальных машин между классической моделью и моделью развертывания с помощью Resource Manager переносятся только метаданные. Базовые виртуальные машины работают на одном оборудовании, в одной сети и в одном хранилище. При миграции в течение определенного периода, возможно, будет запрещено выполнять операции в плоскости управления. Однако выполнение операций в плоскости данных прерываться не будет. То есть приложения, запущенные в виртуальных машинах (классическая модель), не будут простаивать во время миграции.

Следующие конфигурации сейчас не поддерживаются. В случае добавления поддержки для них в будущем возможен простой некоторых виртуальных машин в этой конфигурации (из-за операций остановки, освобождения и перезапуска).

* В отдельной облачной службе есть несколько групп доступности.
* В отдельной облачной службе есть одна или несколько групп доступности, а также виртуальные машины, которые не входят в группу доступности.

> [!NOTE]
> При такой области применения миграции в течение определенного периода, возможно, будет запрещено выполнять операции в плоскости управления. В некоторых конфигурациях, как описано выше, будет возникать простой операций в плоскости данных.
>

### <a name="migration-of-storage-accounts"></a>Перенос учетных записей хранения
Чтобы обеспечить бесперебойную миграцию, вы можете развернуть виртуальные машины Resource Manager в классической учетной записи хранения. Благодаря этой возможности вычислительные и сетевые ресурсы можно и нужно переносить независимо от учетных записей хранения. После миграции виртуальных машин и виртуальной сети для завершения процесса необходимо перенести учетные записи хранения.

Если у вашей учетной записи хранения отсутствуют связанные диски или данные виртуальных машин, то есть она содержит только большие двоичные объекты, файлы, таблицы и очереди, то можно выполнить изолированный перенос в Azure Resource Manager без зависимостей.

> [!NOTE]
> В модели развертывания с помощью Resource Manager отсутствуют понятия классических образов и дисков. После переноса учетной записи хранения классические образы и диски не будут отображаться в стеке Resource Manager, но резервные виртуальные жесткие диски останутся в учетной записи хранения.

На следующих снимках экрана показано, как обновить классическую учетную запись хранения до Azure Resource Manager учетной записи хранения с помощью портал Azure.
1. Войдите на [портал Azure](https://portal.azure.com).
2. Войдите в свою учетную запись хранения.
3. В разделе **Параметры** щелкните **Миграция в ARM**.
4. Щелкните **проверить** , чтобы определить осуществимость миграции.
5. Если проверка пройдена, щелкните " **подготовить** ", чтобы создать перенесенную учетную запись хранения.
6. Введите **Да** , чтобы подтвердить миграцию, и нажмите кнопку " **зафиксировать** ", чтобы завершить миграцию.

    ![Проверка учетной записи хранения](../../includes/media/storage-account-upgrade-classic/storage-migrate-resource-manager-1.png)
    
    ![Подготовка учетной записи хранения](../../includes/media/storage-account-upgrade-classic/storage-migrate-resource-manager-2.png)
    
    ![Завершение миграции учетной записи хранения](../../includes/media/storage-account-upgrade-classic/storage-migrate-resource-manager-3.png)

### <a name="migration-of-unattached-resources"></a>Перенос неподключенных ресурсов
Учетные записи хранения без связанных дисков или данных виртуальных машин могут быть перенесены независимо друг от друга.

Группы безопасности сети, таблицы маршрутов и зарезервированные IP-адреса, которые не привязаны к виртуальным машинам и виртуальным сетям, также могут быть перенесены независимо друг от друга.

<br>

## <a name="unsupported-features-and-configurations"></a>Неподдерживаемые компоненты и конфигурации
Некоторые функции и конфигурации в настоящее время не поддерживаются. В следующих разделах описаны рекомендации для них.

### <a name="unsupported-features"></a>Неподдерживаемые функции
Следующие функции сейчас не поддерживаются. Дополнительно вы можете удалить эти параметры, перенести виртуальные машины, а затем повторно включить параметры в модели развертывания с помощью Resource Manager.

| Поставщик ресурсов | Компонент | Рекомендация |
| --- | --- | --- |
| Службы вычислений | Несвязанные диски виртуальных машин. | При миграции учетной записи хранения переносятся большие двоичные объекты виртуальных жестких дисков. |
| Службы вычислений | Образы виртуальных машин. | При миграции учетной записи хранения переносятся большие двоичные объекты виртуальных жестких дисков. |
| Сеть | Списки управления доступом для конечной точки. | Удалите списки управления доступом для конечной точки и повторите попытку миграции. |
| Сеть | Шлюз приложений | Удалите шлюз приложений до начала миграции и повторно создайте его по ее завершении. |
| Сеть | Виртуальные сети с использованием пиринга. | Перенесите виртуальную сеть в Resource Manager с последующей реализацией пиринга. Дополнительные сведения см. в статье [Пиринг между виртуальными сетями](../virtual-network/virtual-network-peering-overview.md). |

### <a name="unsupported-configurations"></a>Неподдерживаемые конфигурации
Следующие конфигурации сейчас не поддерживаются.

| Служба | Конфигурация | Рекомендация |
| --- | --- | --- |
| Resource Manager |Управление доступом Role-Based (RBAC) для классических ресурсов |Так как после миграции универсальные коды ресурсов (URI) меняются, рекомендуется спланировать обновления политики RBAC, которые должны быть применены после миграции. |
| Службы вычислений |Несколько подсетей, связанных с одной виртуальной машиной |Обновите конфигурацию подсетей, чтобы в ссылках была указана только одна подсеть. Для этого, возможно, потребуется удалить с виртуальной машины дополнительный сетевой адаптер (со ссылкой на другую подсеть) и повторно подключить его по завершении миграции. |
| Службы вычислений |Виртуальные машины, размещенные в виртуальной сети, но без явно назначенной подсети |При необходимости можно удалить виртуальную машину. |
| Службы вычислений |Виртуальные машины с оповещениями и политиками автомасштабирования |По мере выполнения миграции эти параметры будут удалены. Поэтому перед миграцией настоятельно рекомендуется оценить среду. Как вариант, можно настроить параметры оповещений после завершения миграции. |
| Службы вычислений |Расширения виртуальной машины XML (BGInfo 1.\*, отладчик Visual Studio, веб-развертывание и удаленная отладка) |Такой способ связывания не поддерживается. Рекомендуется удалить эти расширения из виртуальной машины, чтобы продолжить миграцию, иначе они будут удалены автоматически в процессе миграции. |
| Службы вычислений |Диагностика загрузки при использовании хранилища уровня "Премиум" |Отключите функцию диагностики загрузки для виртуальных машин, прежде чем продолжить миграцию. После завершения переноса можно будет включить диагностику загрузки в стеке Resource Manager. Кроме того, следует удалить большие двоичные объекты, которые используются для хранения снимков экрана и последовательных журналов, чтобы больше не оплачивать их. |
| Службы вычислений | Облачные службы, содержащие веб-роли и рабочие роли | В настоящее время это не поддерживается. |
| Службы вычислений | Облачные службы с несколькими или со множеством групп доступности. |В настоящее время это не поддерживается. Перенесите виртуальные машины в одну группу доступности перед выполнением миграции. |
| Службы вычислений | Виртуальная машина с расширением центра безопасности Azure | Центр безопасности Azure автоматически устанавливает расширения на виртуальные машины, чтобы наблюдать за их безопасности и создавать оповещения. Обычно эти расширения устанавливается автоматически, если для подписки включена политика центра безопасности Azure. Чтобы перенести виртуальные машины, отключите политику центра безопасности в подписке, после чего расширение мониторинга центра безопасности будет удалено на виртуальных машинах. |
| Службы вычислений | Виртуальная машина с расширением моментальных снимков или архивации | Эти расширения устанавливаются на виртуальной машине, настроенной с помощью службы архивации Azure. Так как миграции этих виртуальных машин не поддерживаются, ознакомьтесь с [этим](./migration-classic-resource-manager-faq.md#i-backed-up-my-classic-vms-in-a-vault-can-i-migrate-my-vms-from-classic-mode-to-resource-manager-mode-and-protect-them-in-a-recovery-services-vault) руководством, чтобы хранить резервные копии, сделанные до начала миграции.  |
| Службы вычислений | Виртуальная машина с расширением Azure Site Recovery | Эти расширения устанавливаются на виртуальной машине, настроенной с помощью службы Azure Site Recovery. Хотя миграция хранилища, используемого с Site Recovery, будет работать, будет затронута текущая репликация. После миграции хранилища необходимо отключить и включить репликацию виртуальной машины. |
| Сеть |Виртуальные сети, содержащие виртуальные машины, а также веб-роли и рабочие роли |В настоящее время это не поддерживается. Перенесите рабочие роли и веб-роли в виртуальную сеть перед выполнением миграции. Как только классическая виртуальная сеть будет перенесена, к виртуальной сети Azure Resource Manager можно установить пиринговое подключение из классической виртуальной сети для достижения аналогичной конфигурации, как и прежде.|
| Сеть | Классические каналы ExpressRoute |В настоящее время это не поддерживается. Эти каналы нужно перенести в Azure Resource Manager перед началом миграции IaaS. Дополнительные сведения см. в статье [Перемещение каналов ExpressRoute из классической модели развертывания в модель развертывания с помощью Resource Manager](../expressroute/expressroute-move.md).|
| Служба приложений Azure |Виртуальные сети, содержащие среды службы приложений |В настоящее время это не поддерживается. |
| Azure HDInsight |Виртуальные сети, содержащие службы HDInsight |В настоящее время это не поддерживается. |
| Microsoft Dynamics Lifecycle Services |Виртуальные сети, содержащие виртуальные машины под управлением служб Dynamics Lifecycle Services |В настоящее время это не поддерживается. |
| Служба "Управление API Azure" |Виртуальные сети, содержащие развернутые службы управления API Azure. |В настоящее время это не поддерживается. Чтобы перенести виртуальную сеть IaaS, измените виртуальную сеть развернутой службы управления API. Эта операция не влечет за собой простой. |

## <a name="next-steps"></a>Дальнейшие действия

* [Техническое руководство по поддерживаемому платформой переносу из классической модели в модель Azure Resource Manager](migration-classic-resource-manager-deep-dive.md)
* [Planning for migration of IaaS resources from classic to Azure Resource Manager](migration-classic-resource-manager-plan.md) (Планирование переноса ресурсов IaaS из классической модели в модель Azure Resource Manager)
* [Перенос ресурсов IaaS из классической модели в модель Azure Resource Manager с помощью Azure PowerShell](migration-classic-resource-manager-ps.md)
* [Перенос ресурсов IaaS из классической модели в модель Azure Resource Manager с помощью интерфейса командной строки Azure](migration-classic-resource-manager-cli.md)
* [Community tools to migrate IaaS resources from classic to Azure Resource Manager](migration-classic-resource-manager-community-tools.md) (Инструменты сообщества для перемещения ресурсов IaaS из классической модели в модель Azure Resource Manager)
* [Распространенные ошибки миграции](migration-classic-resource-manager-errors.md)
* [Часто задаваемые вопросы о миграции из классической модели в модель Azure Resource Manager](migration-classic-resource-manager-faq.md)
