---
title: Расширение антивредоносного по Майкрософт для виртуальных машин Windows в Azure
description: С помощью расширения вы можете развернуть защиту от вредоносных программ Azure на виртуальной машине Windows.
services: virtual-machines
documentationcenter: ''
author: TerryLanfear
manager: rkarlin
editor: ''
ms.assetid: ''
ms.service: virtual-machines
ms.subservice: extensions
ms.collection: windows
ms.topic: article
ms.tgt_pltfrm: vm-windows
ms.workload: infrastructure-services
ms.date: 02/23/2021
ms.author: terrylan
ms.openlocfilehash: 0ed5d7b1367d40fa5769fc26acfdddf941fea4cc
ms.sourcegitcommit: 772eb9c6684dd4864e0ba507945a83e48b8c16f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "104596354"
---
# <a name="microsoft-antimalware-extension-for-windows"></a>Расширение антивредоносного ПО Майкрософт для Windows

## <a name="overview"></a>Обзор

Спектр современных угроз, с которыми сталкиваются пользователи облачных сред, расширяется чрезвычайно быстро. Поэтому подписчики, использующие облачные технологии в сфере ИТ-бизнеса, вынуждены искать средства эффективной защиты, обеспечивающие соответствие требованиям к безопасности. Антивредоносная программа (Майкрософт) для Azure — это бесплатное средство защиты для обнаружения и удаления вирусов, шпионского ПО и других вредоносных программ в режиме реального времени. Кроме того, вы можете настроить оповещения о попытках установки вредоносного или нежелательного программного обеспечения в системах Azure. Это решение создано на той же платформе для средств защиты от вредоносных программ, что и Microsoft Security Essentials (MSE), Microsoft Forefront Endpoint Protection, Microsoft System Center Endpoint Protection, Windows Intune и Защитник Windows для Windows 8.0 и более поздних версий.
Антивредоносное ПО для Azure — это единый агент для приложений и клиентских сред, работающий в фоновом режиме без стороннего вмешательства. Вы можете развернуть систему защиты, соответствующую рабочим нагрузкам своих приложений, и использовать базовую конфигурацию защиты (по умолчанию) или расширенную настраиваемую конфигурацию, включающую отслеживание вредоносных программ.

## <a name="prerequisites"></a>Предварительные требования

### <a name="operating-system"></a>Операционная система

Антивредоносное ПО Майкрософт для Azure включает в себя клиент и службу защиты от вредоносных программ Майкрософт, классическую модель развертывания антивредоносной программы, командлеты PowerShell для антивредоносной программы и расширение системы диагностики Azure. Антивредоносное ПО Майкрософт поддерживается семействами операционных систем Windows Server 2008 R2, Windows Server 2012 и Windows Server 2012 R2. Операционная система Windows Server 2008 не поддерживает это решение, как и Linux. 

Защитник Windows — это встроенное антивредоносное ПО, включенное в Windows Server 2016. Кроме того, интерфейс Защитника Windows по умолчанию включен для некоторых номеров SKU Windows Server 2016.
Расширение антивредоносного ПО для виртуальных машин Azure по-прежнему можно добавить на виртуальную машину Azure под управлением Windows Server 2016 с Защитником Windows. Но в таком случае применяются все дополнительные политики конфигурации, которые должны использоваться Защитником Windows. При помощи расширения не развертываются какие-либо дополнительные службы защиты от вредоносных программ. Дополнительные сведения об этом обновлении см. [здесь](/archive/blogs/azuresecurity/update-to-azure-antimalware-extension-for-cloud-services).

### <a name="internet-connectivity"></a>Подключение к Интернету

Расширение антивредоносного ПО Майкрософт для Windows требует, чтобы целевая виртуальная машина была подключена к Интернету для получения регулярных обновлений модуля и сигнатур. 

## <a name="template-deployment"></a>Развертывание шаблона
Расширения виртуальной машины Azure можно развернуть с помощью шаблонов Azure Resource Manager. Шаблоны идеально подходят для развертывания одной или нескольких виртуальных машин, требующих настройки после развертывания, например подключения к антивредоносному ПО Azure.

Конфигурацию JSON для расширения виртуальной машины можно вложить в ресурс виртуальной машины или поместить в корень или на верхний уровень JSON-файла шаблона Resource Manager. Размещение конфигурации JSON влияет на значения имени и типа ресурса. Дополнительные сведения см. в разделе [Указание имени и типа дочернего ресурса в шаблоне Resource Manager](../../azure-resource-manager/templates/child-resource-name-type.md). 

В следующем примере предполагается, что расширение виртуальной машины вложено в ресурс виртуальной машины. При вложении ресурса расширения JSON помещается в объект `"resources": []` виртуальной машины.

```json
{
      "type": "Microsoft.Compute/virtualMachines/extensions",
      "name": "[concat(parameters('vmName'),'/', parameters('vmExtensionName'))]",
      "apiVersion": "2019-07-01",
      "location": "[resourceGroup().location]",
      "dependsOn": [
        "[concat('Microsoft.Compute/virtualMachines/', parameters('vmName'))]"
      ],

      "properties": {
        "publisher": "Microsoft.Azure.Security",
        "type": "IaaSAntimalware",
        "typeHandlerVersion": "1.3",
        "autoUpgradeMinorVersion": true,
        "settings": {
          "AntimalwareEnabled": "true",
          "Exclusions": {
            "Extensions": ".log;.ldf",
            "Paths": "D:\\IISlogs;D:\\DatabaseLogs",
            "Processes": "mssence.svc"
          },

          "RealtimeProtectionEnabled": "true",
          "ScheduledScanSettings": {
            "isEnabled": "true",
            "scanType": "Quick",
            "day": "7",
            "time": "120"
          }
        },
        "protectedSettings": null
      }
}
```

## <a name="powershell-deployment"></a>Развертывание с помощью PowerShell
Для развертывания расширения антивредоносного ПО на существующей виртуальной машине следует учитывать тип развертывания и использовать соответствующие команды.

  * [Виртуальная машина на основе Azure Resource Manager](../../security/fundamentals/antimalware-code-samples.md#enable-and-configure-microsoft-antimalware-for-azure-resource-manager-vms)
  * [Кластеры Service Fabric Azure](../../security/fundamentals/antimalware-code-samples.md#add-microsoft-antimalware-to-azure-service-fabric-clusters)
  * [Классическая облачная служба](/powershell/module/servicemanagement/azure.service/set-azureserviceextension)

## <a name="troubleshoot-and-support"></a>Устранение неполадок и поддержка

### <a name="troubleshoot"></a>Диагностика

Журналы расширения антивредоносного ПО Майкрософт можно найти в следующем расположении: %Systemdrive%\WindowsAzure\Logs\Plugins\Microsoft.Azure.Security.IaaSAntimalware(или PaaSAntimalware)\1.5.5.x(номер версии)\CommandExecution.log

### <a name="error-codes-and-their-meanings"></a>Коды ошибок и их описание

| Код ошибки | Значение | Возможное действие |
| :---: | --- | --- |
| –2147156224 | MSI занят другой установкой. | Попробуйте выполнить установку позднее. |
| –2147156221 | Программа установки MSE уже выполняется. | Следует запускать только один экземпляр одновременно. |
| –2147156208 | Недостаточно места на диске — менее 200 МБ. | Удалите неиспользуемые файлы и повторите попытку установки. |
| –2147156187 | Последняя операция установки, обновления или удаления запросила перезагрузку. | Перезагрузите компьютер и повторите попытку установки. |
| –2147156121 | Программой установки предпринята попытка удаления продукта конкурента. Однако произошел сбой удаления продукта конкурента. | Попробуйте вручную удалить продукт конкурента, перезагрузите компьютер и повторите попытку установки.  |
| –2147156116 | Проверка файла политики не пройдена. | Передайте в программу установки допустимый XML-файл политики.  |
| –2147156095 | Программе установки не удалось запустить службу защиты от вредоносных программ. | Проверьте, что все двоичные файлы подписаны должным образом и установлен правильный файл лицензирования. |
| –2147023293 | Во время установки произошла неустранимая ошибка. Она будет возникать в большинстве случаев. EPP.msi не удается зарегистрировать, запустить, остановить службу AM или драйвер мини-фильтра. | Для дальнейшего исследования требуются журналы MSI из EPP.msi. |
| –2147023277 | Не удалось открыть пакет установки. | Проверьте, что пакет существует и доступен или обратитесь к поставщику приложения, чтобы убедиться, что это допустимый пакет установщика Windows. |
| –2147156109 | Защитник является необходимым компонентом. |  |
| –2147205073 | Издатель WebSSO не поддерживается. | |
| –2147024893 | Системе не удается найти указанный путь. |  |
| –2146885619 | Криптографическое сообщение или не зашифровано, или имеет неправильный формат. |  |
| –1073741819 | Инструкция по адресу "0x%p" обратилась к памяти по адресу "0x%p". Память не может быть "%s". |  |
| 1 | Неверная функция |  |


### <a name="support"></a>Поддержка

Если в любой момент при изучении этой статьи вам потребуется дополнительная помощь, вы можете обратиться к экспертам по Azure на [форумах MSDN Azure и Stack Overflow](https://azure.microsoft.com/support/forums/). Кроме того, можно зарегистрировать обращение в службу поддержки Azure. Перейдите на [сайт поддержки Azure](https://azure.microsoft.com/support/options/)и выберите получить поддержку. Дополнительные сведения об использовании службы поддержки Azure см. в статье [Часто задаваемые вопросы о поддержке Microsoft Azure](https://azure.microsoft.com/support/faq/).