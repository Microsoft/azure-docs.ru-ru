---
title: Портал Azure. Включение управляемых пользователем ключей с помощью управляемых дисков SSE
description: Включите управляемые пользователем ключи на управляемых дисках с помощью портал Azure.
author: roygara
ms.date: 08/24/2020
ms.topic: how-to
ms.author: rogarana
ms.service: virtual-machines
ms.subservice: disks
ms.openlocfilehash: 5452b1e2ffc3ca8a11f3acb591c6288806445e1b
ms.sourcegitcommit: 910a1a38711966cb171050db245fc3b22abc8c5f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "96499396"
---
# <a name="use-the-azure-portal-to-enable-server-side-encryption-with-customer-managed-keys-for-managed-disks"></a>Использование портал Azure для включения шифрования на стороне сервера с помощью управляемых клиентом ключей для управляемых дисков

Хранилище дисков Azure позволяет управлять собственными ключами при использовании шифрования на стороне сервера (SSE) для управляемых дисков, если вы решили. Основные сведения о SSE с управляемыми клиентами ключами, а также о других типах шифрования дисков см. в разделе " **ключи, управляемые клиентом** " статьи о шифровании дисков.

- Для Linux: [ключи, управляемые клиентом](./disk-encryption.md#customer-managed-keys)
- Для Windows: [ключи, управляемые клиентом](./disk-encryption.md#customer-managed-keys)

## <a name="restrictions"></a>Ограничения

В настоящее время ключи, управляемые клиентом, имеют следующие ограничения.

- Если эта функция включена для диска, ее нельзя отключить.
    Если необходимо обойти эту ошибку, необходимо скопировать все данные на совершенно другой управляемый диск, не использующий управляемые клиентом ключи:

    - Для Linux: [копирование управляемого диска](./linux/disks-upload-vhd-to-managed-disk-cli.md#copy-a-managed-disk)

    - Для Windows: [копирование управляемого диска](./windows/disks-upload-vhd-to-managed-disk-powershell.md#copy-a-managed-disk)

- Поддерживаются только [ключи RSA для программного обеспечения и HSM](../key-vault/keys/about-keys.md) с размерами 2 048-бит, 3 072-бит и 4 096-bit, без других ключей или размеров.
    - Для ключей [HSM](../key-vault/keys/hsm-protected-keys.md) требуется уровень **Premium** хранилища ключей Azure.
[!INCLUDE [virtual-machines-managed-disks-customer-managed-keys-restrictions](../../includes/virtual-machines-managed-disks-customer-managed-keys-restrictions.md)]

В следующих разделах описано, как включить и использовать управляемые клиентом ключи для управляемых дисков.

[!INCLUDE [virtual-machines-disks-encryption-create-key-vault-portal](../../includes/virtual-machines-disks-encryption-create-key-vault-portal.md)]

## <a name="deploy-a-vm"></a>Развертывание виртуальной машины

Теперь, когда вы создали и настроили хранилище ключей и набор шифрования дисков, вы можете развернуть виртуальную машину с помощью шифрования.
Процесс развертывания виртуальной машины аналогичен стандартному процессу развертывания. единственным различием является то, что необходимо развернуть виртуальную машину в том же регионе, что и другие ресурсы, и использовать управляемый клиентом ключ.

1. Выполните поиск **виртуальных машин** и выберите **+ Добавить** , чтобы создать виртуальную машину.
1. В колонке " **базовый** " выберите тот же регион, что и для набора шифрования диска, и Azure Key Vault.
1. Заполните остальные значения в колонке " **Основная** " по своему усмотрению.

    ![Снимок экрана процесса создания виртуальной машины с выделенным значением региона.](media/virtual-machines-disk-encryption-portal/server-side-encryption-create-a-vm-region.png)

1. В колонке **диски** выберите **Шифрование неактивных ключей с помощью управляемого клиентом ключа**.
1. Выберите набор шифрования дисков в раскрывающемся списке **набор шифрования дисков** .
1. Сделайте оставшиеся варианты выбора нужным образом.

    ![Снимок экрана с процессом создания виртуальной машины, колонка "диски". С выделенным раскрывающимся списком набор шифрования дисков.](media/virtual-machines-disk-encryption-portal/server-side-encryption-create-vm-select-customer-managed-key-disk-encryption-set.png)

## <a name="enable-on-an-existing-disk"></a>Включить на существующем диске

> [!CAUTION]
> Для включения шифрования дисков на всех дисках, подключенных к виртуальной машине, потребуется отключить виртуальную машину.
    
1. Перейдите к виртуальной машине, расположенной в том же регионе, что и один из наборов шифрования диска.
1. Откройте виртуальную машину и выберите команду " **Закрыть**".

    ![Снимок экрана основного наложения для вашего примера виртуальной машины с выделенной кнопкой "прерывать".](media/virtual-machines-disk-encryption-portal/server-side-encryption-stop-vm-to-encrypt-disk-fix.png)

1. После завершения остановки виртуальной машины выберите **диски** , а затем выберите диск, который нужно зашифровать.

    ![Снимок экрана примера виртуальной машины с открытой колонкой "диски". Диск ОС выделяется в качестве примера диска для выбора.](media/virtual-machines-disk-encryption-portal/server-side-encryption-existing-disk-select.png)

1. Выберите **Шифрование** и выберите **Шифрование неактивных данных с помощью управляемого клиентом ключа** , а затем выберите набор шифрования дисков в раскрывающемся списке.
1. Щелкните **Сохранить**.

    ![Снимок экрана с примером диска ОС. Колонка шифрование открыта, выбрано шифрование неактивных ключей с управляемым клиентом ключом, а также пример Azure Key Vault. После выполнения этих выбора будет выбрана кнопка Сохранить.](media/virtual-machines-disk-encryption-portal/server-side-encryption-encrypt-existing-disk-customer-managed-key.png)

1. Повторите эту процедуру для всех дисков, подключенных к виртуальной машине, которую вы хотите зашифровать.
1. Когда диски завершат переключение на управляемые клиентом ключи, если нет других подключенных дисков, которые вы хотите зашифровать, вы можете запустить виртуальную машину.

> [!IMPORTANT]
> Управляемые клиентом ключи используют управляемые удостоверения для ресурсов Azure — функцию Azure Active Directory (Azure AD). При настройке управляемых пользователем ключей управляемое удостоверение автоматически назначается вашим ресурсам. Если впоследствии вы перемещаете подписку, группу ресурсов или управляемый диск из одного каталога Azure AD в другой, управляемое удостоверение, связанное с управляемыми дисками, не передается в новый клиент, поэтому управляемые клиентом ключи могут перестать работать. Дополнительные сведения см. в статье [Передача подписки между каталогами Azure AD](../active-directory/managed-identities-azure-resources/known-issues.md#transferring-a-subscription-between-azure-ad-directories).

## <a name="next-steps"></a>Дальнейшие действия

- [Изучите шаблоны Azure Resource Manager для создания зашифрованных дисков с помощью управляемых клиентом ключей](https://github.com/ramankumarlive/manageddiskscmkpreview)
- [Что такое хранилище ключей Azure?](../key-vault/general/overview.md)
- [Репликация компьютеров, использующих диски с ключами, управляемыми клиентом](../site-recovery/azure-to-azure-how-to-enable-replication-cmk-disks.md)
- [Настройка аварийного восстановления виртуальных машин VMware в Azure с помощью PowerShell](../site-recovery/vmware-azure-disaster-recovery-powershell.md#replicate-vmware-vms)
- [Настройка аварийного восстановления виртуальных машин Hyper-V в Azure с помощью PowerShell и Azure Resource Manager](../site-recovery/hyper-v-azure-powershell-resource-manager.md#step-7-enable-vm-protection)