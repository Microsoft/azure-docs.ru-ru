---
title: Предоставление общего доступа к образам виртуальных машин с помощью общих коллекций
description: Узнайте, как использовать галереи с общими изображениями для совместного использования образов виртуальных машин Linux в Организации.
author: axayjo
ms.service: virtual-machines
ms.subservice: imaging
ms.topic: conceptual
ms.workload: infrastructure
ms.date: 10/14/2020
ms.author: akjosh
ms.reviewer: cynthn
ms.openlocfilehash: 3022e9c694d70359a90e71ecd1232e9274f92f10
ms.sourcegitcommit: 78ecfbc831405e8d0f932c9aafcdf59589f81978
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/23/2021
ms.locfileid: "98730328"
---
# <a name="shared-image-galleries-overview"></a>Обзор коллекций общих образов

Общая коллекция образов — это служба, которая позволяет создавать структуру и организацию на основе образов. Коллекции общих образов поддерживают следующие функции и возможности:

- Глобальная репликация образов.
- Контроль версий и группировка образов для более эффективного управления.
- Высокодоступные образы с учетными записями ZRS (хранилищ, избыточных между зонами), в регионах, где поддерживаются Зоны доступности. Служба ZRS повышает надежность на случай сбоев в зонах.
- Поддержка хранилищ ценовой категории "Премиум" (Premium_LRS).
- Совместное использование в разных подписках и даже разных клиентах Active Directory (AD) на базе RBAC.
- Масштабирование развертывания с репликацией образов в каждом регионе.

Используя коллекцию общих образов, вы можете делиться своими образами с другими пользователями, участниками службы или группами конструктора приложений в вашей организации. Общие образы можно реплицировать в несколько регионов для более быстрого масштабирования развертываний.

Образ представляет собой либо полную копию виртуальной машины (вместе со всеми подключенными дисками данных), либо просто копию диска операционной системы, в зависимости от того, как создается образ. При создании виртуальной машины из образа копии виртуальных жестких дисков в образе используются для создания дисков для новой виртуальной машины. Образ остается в хранилище и может использоваться для создания виртуальных машин снова и снова.

Если у вас большое количество образов, которые нужно сохранить и сделать доступными для всей компании, Общую коллекцию образов можно использовать в качестве репозитория. 

Функция коллекции общих образов имеет несколько типов ресурсов.

| Ресурс | Описание|
|----------|------------|
| **Источник образа** | Это ресурс, который можно использовать для создания **версии образа** в коллекции образов. Источником образа может быть существующая виртуальная машина Azure ([универсальная или специализированная](#generalized-and-specialized-images)), управляемый образ, моментальный снимок, VHD или версия образа в другой коллекции образов. |
| **Коллекция образов** | Как и Azure Marketplace, **коллекция образов** — это репозиторий для управления и совместного использования образов, но в отличие от Azure Marketplace доступ к коллекции образов контролируете вы. |
| **Определение образа** | Определения образов создаются в коллекции и содержат сведения об образе и требованиях для их внутреннего использования. Эти сведения включают в себя: определение, относится ли этот образ к Windows или к Linux, заметки о выпуске, а также минимальные и максимальные требования к памяти. Это определение типа образа. |
| **Версия образа** | **Версия образа** используется для создания виртуальной машины с помощью коллекции. В зависимости от требований для вашей среды, у вас может быть несколько версий образа. Так же как и управляемый образ при использовании **версии образа** для создания виртуальной машины, версия образа используется для создания новых дисков для виртуальной машины. Версии образов можно использовать несколько раз. |

<br>

![Рисунок, показывающий, как использовать несколько версий образа в коллекции](./media/shared-image-galleries/shared-image-gallery.png)

## <a name="image-definitions"></a>Определения образов

Определения образов представляют собой логическую группировку версий образов. Определение образа содержит сведения о том, с какой целью данный образ был создан и для какой ОС он предназначен, а также другую информацию о его использовании. Определение образа напоминает план с подробным описанием всего, что связано с созданием данного образа. Виртуальная машина не развертывается из определения образа: а него основе создаются версии данного образа.

У каждого определения образа есть три параметра: **Издатель**, **Предложение** и **SKU**, которые принимают различные сочетания значений. Они позволяют найти определение нужного образа. У вас могут быть версии образов, которые совместно используют одно или два, но не все три значения.  В качестве примера ниже приведены три определения образа и их значения.

|Определение образа|Издатель|ПРЕДЛОЖЕНИЕ|Sku|
|---|---|---|---|
|myImage1|Contoso|Finance.|Серверная часть|
|myImage2|Contoso|Finance.|Внешний интерфейс|
|myImage3|Тестирование|Finance.|Внешний интерфейс|

Все три определения образа имеют уникальные наборы значений. Формат этих параметров аналогичен формату параметров издателя, предложения и SKU, которые можно указать в Azure PowerShell, чтобы получить текущую версию определенного [образа Azure Marketplace](./windows/cli-ps-findimage.md). У каждого определения образа должен быть меть уникальный набор этих значений.

Следующие параметры определяют типы версий образов, которые могут в них содержаться:

- Состояние операционной системы: операционная система может быть [универсальной или специализированной](#generalized-and-specialized-images). Это обязательное поле.
- Операционная система: Windows или Linux. Это обязательное поле.
-   Hyper-V generation (Поколение Hyper-V): вы можете указать, был ли этот образ создан на основе виртуального диска 1-го или [2-го поколения](generation-2.md) Hyper-V. Значение по умолчанию — поколение 1.


Ниже приведен список других параметров, которые можно задавать для определений образов, чтобы упростить их отслеживание.

- Описание: с помощью этого параметра можно предоставить подробную информацию о назначении образа. Например, можно указать, что определение образа используется для интерфейсного сервера с предустановленными приложениями.
- Лицензионное соглашение: можно указать, какое именно лицензионное соглашение действует для данного определения.
- Заявление о конфиденциальности и Заметки о выпуске: вы можете добавлять в Azure заметки о выпуске и заявления о конфиденциальности и указывать в определении образа их URI.
- Дата прекращения поддержки: вы можете указать в определении образа дату, а затем на ее основе автоматизировать удаление устаревших определений.
- Тег: при создании определений образов в них можно добавлять теги. Дополнительные сведения о тегах см. в статье [Использование тегов для организации ресурсов](../azure-resource-manager/management/tag-resources.md).
- Рекомендации относительно максимальных и минимальных требований к виртуальному ЦП и памяти: если для образа предусмотрены соответствующие рекомендации, эту информацию можно включить в определение.
- Запрещенные типы дисков: здесь можно указать требования к подсистеме хранения виртуальной машины. Например, если образ не предназначен для работы на обычных HDD, их можно добавить в список запрещенных.
- Сведения о плане покупки для образов из Marketplace — `-PurchasePlanPublisher`, `-PurchasePlanName` и `-PurchasePlanProduct`. Дополнительные сведения о плане покупки см. в статьях [Поиск образов в Azure Marketplace](./windows/cli-ps-findimage.md) и [Предоставление сведений о плане покупки Azure Marketplace при создании образов](marketplace-images.md).


## <a name="image-versions"></a>Версии образов

На основе **версии образа** создается виртуальная машина. В зависимости от требований для вашей среды, у вас может быть несколько версий образа. При использовании **версии образа** для создания виртуальной машины версия образа используется для создания новых дисков для виртуальной машины. Версии образов можно использовать несколько раз.

Свойства версии образа:

- Номер версии. Используется в качестве имени версии образа. Он всегда указывается в следующем формате: основной номер версии.дополнительный номер версии.исправление. Если при создании виртуальной машины вы указываете, что нужно использовать **последнюю** версию, выбирается последний образ на основе максимального основного номера версии, затем дополнительного номера версии, а затем номера исправления. 
- Источник. Источником может быть виртуальная машина, управляемый диск, моментальный снимок, управляемый образ или другая версия образа. 
- "Исключить из последних". Вы можете указать, что версию нельзя использовать в качестве последней версии образа. 
- "Дата окончания жизненного цикла". Дата, после которой из этого образа нельзя будет создавать виртуальные машины.


## <a name="generalized-and-specialized-images"></a>Универсальные и специализированные образы

Общая коллекция образов поддерживает два состояния операционной системы. Как правило, перед созданием образа соответствующая виртуальная машина должна быть переведена в универсальное состояние. Универсализация — это процесс, в ходе которого из виртуальной машины удаляются сведения о конкретном компьютере и пользователе. Для Windows с этой целью используется средство Sysprep. Для Linux можно воспользоваться параметрами [waagent](https://github.com/Azure/WALinuxAgent) `-deprovision` и `-deprovision+user`.

Специализированные виртуальные машины не проходят процедуру удаления информации о компьютере и учетных записях. Кроме того, с виртуальными машинами, создаваемыми на основе специализированных образов, не связывается параметр `osProfile`. Это означает, что у специализированных образов есть как определенные преимущества, так и некоторые ограничения.

- Виртуальные машины и масштабируемые наборы, созданные на базе специализированного образа, можно быстрее развернуть и запустить. Поскольку они создаются на основе источника, который уже прошел процедуру первой загрузки, такие виртуальные машины быстрее загружаются.
- Для входа на виртуальные машины, созданные на основе специализированного образа, можно использовать учетные записи виртуальной машины, послужившей источником для данного образа.
- У таких виртуальных машин **имя компьютера** совпадает с именем компьютера виртуальной машины, на базе которой был создан образ. Чтобы избежать конфликтов, это значение нужно изменить.
- `osProfile` используется для передачи на виртуальную машину определенной конфиденциальной информации через `secrets`. Вследствие этого при работе с хранилищем ключей KeyVault, WinRM и другими функциями, которые используют `secrets` в составе `osProfile`, могут возникать определенные проблемы. В ряде случаев для обхода соответствующих ограничений можно использовать идентификаторы управляемых служб (MSI).

## <a name="regional-support"></a>Поддержка в регионах

Целевым регионом может быть любой общедоступный регион, но для репликации в регионах "Центральная Австралия" и "Центральная Австралия 2" ваша подписка должна быть добавлена в список разрешений. Чтобы запросить добавление подписок в список разрешений, перейдите по этой ссылке: https://azure.microsoft.com/global-infrastructure/australia/contact/

## <a name="limits"></a>Ограничения 

В отношении развертывания ресурсов с использованием Общих коллекций ресурсов установлены следующие ограничения в расчете на подписку:
- 100 общих коллекций образов на одну подписку на один регион.
- 1000 определений образов на одну подписку на один регион.
- 10000 версий образов на одну подписку на один регион.
- 10 реплик версий образов на одну подписку на один регион.
- Размер любого подключенного к образу диска не должен превышать 1 ТБ.

Дополнительные сведения и примеры проверки текущего уровня потребления см. в статье [Проверка использования ресурсов в соответствии с ограничениями](../networking/check-usage-against-limits.md).
 
## <a name="scaling"></a>Масштабирование
Коллекция общих образов позволяет указать число реплик, которые вы хотите, чтобы Azure сохранил для образов. Это помогает в сценариях развертывания нескольких виртуальных машин, поскольку их развертывания могут быть распространены на разные реплики, уменьшая вероятность того, что процесс создания экземпляра будет регулироваться из-за перегрузки отдельной реплики.

С помощью Общей коллекции образов можно развернуть до 1000 экземпляров виртуальных машин в масштабируемом наборе виртуальных машин (до 600 — с управляемыми образами). Реплики образов помогают повысить производительность, надежность и согласованность развертывания.   Для каждого целевого региона можно установить собственное число реплик в зависимости от потребностей данного региона в плане масштабирования. Поскольку реплика представляет собой подробную копию образа, каждая дополнительная реплика помогает линейно масштабировать развертывание. Хотя очевидно, что у каждого образа и региона есть свои особенности, вот несколько общих рекомендаций относительно использования реплик в регионе:

- Для развертываний масштабируемых наборов без виртуальных машин — для каждых 20 виртуальных машин, которые вы создаете одновременно, рекомендуется использовать одну реплику. Например, если вы одновременно создаете 120 виртуальных машин на основе одного образа в определенном регионе, рекомендуется иметь хотя бы 6 реплик данного образа. 
- Для развертываний масштабируемых наборов виртуальных машин — для каждого развертывания масштабируемого набора, в котором до 600 экземпляров рекомендуется разместить по крайней мере одну реплику. Например, если вы одновременно создаете 5 масштабируемых наборов по 600 виртуальных машин в каждом на основе одного образа в определенном регионе, рекомендуется иметь хотя бы 5 реплик данного образа. 

Мы также рекомендуем всегда создавать избыточное число реплик с учетом таких факторов, как размер образа, его содержимое и тип операционной системы.

![Рисунок, показывающий, как можно масштабировать образы](./media/shared-image-galleries/scaling.png)

## <a name="make-your-images-highly-available"></a>Обеспечение высокого уровня доступности образов

[Хранилище, избыточное в пределах зоны (ZRS)](https://azure.microsoft.com/blog/azure-zone-redundant-storage-in-public-preview/), повышает надежность на случай сбоев Зон доступности в пределах региона. С учетом общей доступности Общих коллекций образов вы можете выбирать для хранения своих образов учетные записи ZRS в регионах с Зонами доступности. 

Кроме того, для каждого целевого региона можно выбрать тип учетной записи. По умолчанию используется тип учетной записи хранения Standard_LRS, однако для регионов с Зонами доступности можно выбирать тип Standard_ZRS. Доступность службы ZRS в различных регионах можно уточнить [здесь](../storage/common/storage-redundancy.md).

![Изображение ZRS](./media/shared-image-galleries/zrs.png)

## <a name="replication"></a>Репликация
Коллекция общих образов также позволяет автоматически реплицировать свои образы в других регионах Azure. Каждую версию общего образа можно реплицировать в разных регионах в зависимости от того, что лучше всего подходит для вашей организации. Примером может служить репликация последних образов в нескольких регионах, хотя все старые версии доступны только в одном регионе. Это позволяет экономить на стоимости хранения для версий общих образов. 

Области, в которых реплицирована версия общего образа, можно обновить после создания. Время, необходимое для репликации в разных регионах, зависит от объема копируемых данных и количества регионов, в которые реплицируется версия. В некоторых случаях это может занять несколько часов. В процессе репликации можно просмотреть ее состояние для каждого региона. Когда репликация образа в регионе будет завершена, с помощью этой версии в нем можно развернуть виртуальную машину или масштабируемый набор.

![Рисунок, показывающий, как можно реплицировать образы](./media/shared-image-galleries/replication.png)

## <a name="access"></a>Доступ

Поскольку Общая коллекция образов, определение образа и версия образа — это ресурсы, их можно использовать совместно с помощью встроенных средств управления Azure RBAC. RBAC позволяет вам делиться этими ресурсами с другими пользователями, субъектами-службами и группами. Доступ к ним можно предоставлять даже пользователям за пределами клиента, в котором данные ресурсы были созданы. Пользователь, получивший доступ к Общей коллекции образов, может развернуть виртуальную машину или масштабируемый набор виртуальных машин с ее помощью.  Ниже приведена матрица общего доступа, которая помогает понять, к чему пользователь получает доступ.

| Доступ предоставлен пользователю     | Общая коллекция образов | Определение образа | Версия образа |
|----------------------|----------------------|--------------|----------------------|
| Общая коллекция образов | Да                  | Да          | Да                  |
| Определение образа     | Нет                   | Да          | Да                  |

Общий доступ рекомендуется предоставлять на уровне Коллекции. Предоставлять доступ к отдельным версиям образов не рекомендуется. Дополнительные сведения об управлении доступом на основе ролей (RBAC) см. в статье об [использование RBAC для контроля доступа к ресурсам Azure](../role-based-access-control/role-assignments-portal.md).

Доступ к образам в большом масштабе можно предоставлять даже другим клиентам посредством регистрации многоклиентских приложений. Дополнительные сведения о совместном использовании образов в клиентах см. в разделе "совместное использование образов виртуальных машин коллекции в клиентах Azure" с помощью [Azure CLI](./linux/share-images-across-tenants.md) или [PowerShell](./windows/share-images-across-tenants.md).

## <a name="billing"></a>Выставление счетов
За использование службы "Коллекция общих образов" дополнительная оплата не взимается. Плата взимается за следующие ресурсы.
-   Затраты на хранение каждой реплики. Стоимость хранилища оплачивается как моментальный снимок и зависит от того, сколько места занимает версия образа, от количества реплик версии образа и количества регионов, в которые реплицируется версия. 
-   Плата за исходящую сеть для репликации первой версии образа из исходного региона в реплицируемые. Обработка последующих реплик ведется в пределах одного региона, поэтому дополнительные расходы при этом не возникают. 

Например, предположим, что у вас есть образ диска с ОС размером 127 ГБ, который занимает 10 ГБ хранилища, и один пустой диск данных объемом 32 ГБ. Занимаемый объем образа будет составлять всего 10 ГБ. Образ реплицируется в 3 региона, а в каждом регионе по две реплики. Всего будет шесть моментальных снимков, каждый из которых использует 10 ГБ. Плата взимается за хранение каждого моментального снимка в зависимости от занимаемого объема, который составляет 10 ГБ. Будет произведена оплата за исходящий трафик сети для первой реплики, которую необходимо скопировать в дополнительные два региона. Дополнительные сведения о ценах на моментальные снимки в каждом регионе см. на странице [Цены на управляемые диски](https://azure.microsoft.com/pricing/details/managed-disks/). Дополнительные сведения об исходящем трафике сети см. на странице [Сведения о стоимости пропускной способности](https://azure.microsoft.com/pricing/details/bandwidth/).


## <a name="updating-resources"></a>Обновление ресурсов

В ресурсы коллекции образов можно вносить определенные изменения после их создания. Список возможных изменений приведен в таблице ниже.
 
Коллекция общих образов
- Описание

Определение образа
- Рекомендуемое число виртуальных ЦП
- Рекомендуемая память
- Описание
- Дата окончания жизненного цикла

Версия образа
- Количество региональных реплик
- Целевые регионы
- Исключить из последних
- Дата окончания жизненного цикла

## <a name="sdk-support"></a>Поддержка пакетов SDK

Следующие пакеты SDK поддерживают создание коллекций общих образов.

- [.NET](/dotnet/api/overview/azure/virtualmachines/management)
- [Java](/java/azure/)
- [Node.js](/javascript/api/@azure/arm-compute)
- [Python](/python/api/overview/azure/virtualmachines)
- [GO](/azure/go/)

## <a name="templates"></a>Шаблоны

Вы можете создать ресурс коллекции общих образов с помощью шаблонов. Существует несколько шаблонов быстрого запуска Azure: 

- [Создание коллекции общих образов](https://azure.microsoft.com/resources/templates/101-sig-create/)
- [Создание определения образа в коллекции общих образов](https://azure.microsoft.com/resources/templates/101-sig-image-definition-create/)
- [Создание версии образа в коллекции общих образов](https://azure.microsoft.com/resources/templates/101-sig-image-version-create/)
- [Создание виртуальной машины из версии образа](https://azure.microsoft.com/resources/templates/101-vm-from-sig/)

## <a name="frequently-asked-questions"></a>Часто задаваемые вопросы 

* [Как создать список всех ресурсов Общей коллекции образов в разных подписках?](#how-can-i-list-all-the-shared-image-gallery-resources-across-subscriptions) 
* [Можно ли перенести существующий образ в Общую коллекцию образов?](#can-i-move-my-existing-image-to-the-shared-image-gallery)
* [Можно ли создать версию образа из специализированного диска?](#can-i-create-an-image-version-from-a-specialized-disk)
* [Можно ли переместить ресурс Общей коллекции образов в другую подписку после его создания?](#can-i-move-the-shared-image-gallery-resource-to-a-different-subscription-after-it-has-been-created)
* [Можно ли реплицировать версии образов между облаками, например 21Vianet Azure для Китая, Azure для Германии и облако Azure для государственных организаций?](#can-i-replicate-my-image-versions-across-clouds-such-as-azure-china-21vianet-or-azure-germany-or-azure-government-cloud)
* [Можно ли реплицировать версии образов между подписками?](#can-i-replicate-my-image-versions-across-subscriptions)
* [Можно ли предоставлять общий доступ к версиям образов другим клиентам Azure Active Directory?](#can-i-share-image-versions-across-azure-ad-tenants)
* [Сколько времени занимает репликация версии образа между целевыми регионами?](#how-long-does-it-take-to-replicate-image-versions-across-the-target-regions)
* [В чем разница между исходным и целевым регионом?](#what-is-the-difference-between-source-region-and-target-region)
* [Как указать исходный регион при создании версии образа?](#how-do-i-specify-the-source-region-while-creating-the-image-version)
* [Как задать число реплик версии образа, создаваемых в каждом регионе?](#how-do-i-specify-the-number-of-image-version-replicas-to-be-created-in-each-region)
* [Можно ли создать Общую коллекцию образов в расположении, отличном от того, где планируется создать определение и версию образа?](#can-i-create-the-shared-image-gallery-in-a-different-location-than-the-one-for-the-image-definition-and-image-version)
* [Какова стоимость использования коллекции общих образов?](#what-are-the-charges-for-using-the-shared-image-gallery)
* [Какую версию API следует использовать для создания Общей коллекции образов, определения образа и версии образа?](#what-api-version-should-i-use-to-create-shared-image-gallery-and-image-definition-and-image-version)
* [Какую версию API следует использовать для создания общей виртуальной машины или масштабируемого набора виртуальных машин из версии образа?](#what-api-version-should-i-use-to-create-shared-vm-or-virtual-machine-scale-set-out-of-the-image-version)
* [Можно ли обновить масштабируемый набор виртуальных машин, созданный на основе управляемого образа, чтобы использовать в нем образы из Общей коллекции образов?](#can-i-update-my-virtual-machine-scale-set-created-using-managed-image-to-use-shared-image-gallery-images)

### <a name="how-can-i-list-all-the-shared-image-gallery-resources-across-subscriptions"></a>Как создать список всех ресурсов коллекции общих образов в разных подписках?

Чтобы получить список всех ресурсов коллекции общих образов в разных подписках, к которым вы имеете доступ на портале Azure, выполните следующие действия:

1. Откройте [портал Azure](https://portal.azure.com).
1. Прокрутите страницу вниз и выберите **Все ресурсы**.
1. Выберите все подписки, из которых вы хотите включить в список все ресурсы.
1. Найдите ресурсы типа **Общая коллекция образов**.
  
Чтобы получить список всех ресурсов коллекции общих образов в разных подписках, к которым у вас есть доступ, выполните следующую команду в Azure CLI.

```azurecli
   az account list -otsv --query "[].id" | xargs -n 1 az sig list --subscription
```

Дополнительные сведения см. в статьях об **управлении ресурсами коллекции** с помощью [Azure CLI](update-image-resources-cli.md) и [PowerShell](update-image-resources-powershell.md).

### <a name="can-i-move-my-existing-image-to-the-shared-image-gallery"></a>Можно ли перенести существующий образ в коллекцию общих образов?
 
Да. Существует 3 сценария, в зависимости от типов образов, которые у вас могут быть.

 Сценарий 1. Если у вас есть управляемый образ, из него можно создать определение образа и версию образа. Дополнительные сведения см. в статьях о **переходе с управляемых образов на версии образов** с помощью [Azure CLI](image-version-managed-image-cli.md) или [PowerShell](image-version-managed-image-powershell.md).

 Сценарий 2. Если у вас есть неуправляемый образ, из него можно создать управляемый образ, из которого впоследствии можно создать определение образа и версию образа. 

 Сценарий 3. Если у вас есть виртуальный жесткий диск в локальной файловой системе, необходимо отправить его в управляемый образ, из которого впоследствии можно создать определение образа и версию образа.

- Если это виртуальный жесткий диск виртуальной машины Windows, см. раздел об [отправке универсального диска VHD](./windows/upload-generalized-managed.md).
- Если это виртуальный жесткий диск виртуальной машины Linux, см. раздел [Создание виртуальной машины Linux на основе пользовательского диска с помощью Azure CLI](./linux/upload-vhd.md#option-1-upload-a-vhd).

### <a name="can-i-create-an-image-version-from-a-specialized-disk"></a>Можно ли создать версию образа из специализированного диска?

Да, вы можете создавать виртуальные машины на основе специализированных образов с помощью [CLI](vm-specialized-image-version-cli.md), [PowerShell](vm-specialized-image-version-powershell.md) или API. 

### <a name="can-i-move-the-shared-image-gallery-resource-to-a-different-subscription-after-it-has-been-created"></a>Можно ли переместить ресурс Общей коллекции образов в другую подписку после его создания?

Нет, переместить ресурс Общей коллекции образов в другую подписку невозможно. Вы можете реплицировать версии образов из коллекции в другие регионы либо скопировать образ из другой коллекции с помощью [Azure CLI](image-version-another-gallery-cli.md) или [PowerShell](image-version-another-gallery-powershell.md).

### <a name="can-i-replicate-my-image-versions-across-clouds-such-as-azure-china-21vianet-or-azure-germany-or-azure-government-cloud"></a>Можно ли реплицировать версии образов между облаками, например 21Vianet Azure для Китая, Azure для Германии и облако Azure для государственных организаций?

Нет, реплицировать версии образов между облаками невозможно.

### <a name="can-i-replicate-my-image-versions-across-subscriptions"></a>Можно ли реплицировать версии образов между подписками?

Нет, можно реплицировать версии образов между регионами в рамках подписки и использовать их в других подписках с помощью RBAC.

### <a name="can-i-share-image-versions-across-azure-ad-tenants"></a>Возможно ли предоставить общий доступ к версиям образов между клиентами Azure Active Directory? 

Да, для предоставления общего доступа пользователям других клиентов можно использовать функции управления доступом на основе ролей (RBAC). Если же вы планируете использовать эту возможность в большом масштабе, ознакомьтесь с разделом о предоставлении доступа к образам коллекции другим клиентам Azure с помощью [PowerShell](./windows/share-images-across-tenants.md) или [CLI](./linux/share-images-across-tenants.md).

### <a name="how-long-does-it-take-to-replicate-image-versions-across-the-target-regions"></a>Сколько времени занимает репликация версии образа между целевыми регионами?

Время репликации версии образа полностью зависит от размера образа и числа регионов, в которые он реплицируется. Однако для достижения наилучших результатов рекомендуется, чтобы размер образа был маленьким, а исходный и целевые регионы находились близко друг к другу. Можно проверить состояние репликации, используя флажок ReplicationStatus.

### <a name="what-is-the-difference-between-source-region-and-target-region"></a>В чем разница между исходным и целевым регионом?

Исходный регион — это регион, в котором будет создана версия образа. А целевые регионы — это регионы, в которых будет храниться копия вашей версии образа. Для каждой версии образа может быть только один исходный регион. Кроме того, убедитесь, что при создании версии образа вы передали расположение исходного региона как одно из целевых регионов.

### <a name="how-do-i-specify-the-source-region-while-creating-the-image-version"></a>Как указать исходный регион при создании версии образа?

При создании версии образа, чтобы указать исходный регион, можно использовать теги **--location** в интерфейсе командной строки и **-Location** в PowerShell. Убедитесь, что управляемый образ, который используется в качестве базового для создания версии образа, находится в том же расположении, в котором вы хотите создать версию образа. Кроме того, убедитесь, что при создании версии образа вы передали расположение исходного региона как одно из целевых регионов.  

### <a name="how-do-i-specify-the-number-of-image-version-replicas-to-be-created-in-each-region"></a>Как задать число реплик версии образа, создаваемых в каждом регионе?

Задать число реплик версии образа, создаваемых в каждом регионе, можно двумя способами:
 
1. Количество региональных реплик, которое указывает на число реплик, создаваемых на регион. 
2. Общее количество реплик, которое является значением по умолчанию для регионов в случае, если не указано количество региональных реплик. 

Чтобы указать количество региональных реплик, передайте расположение вместе с количеством реплик, которые вы хотите создать в этом регионе: "Центрально-южная часть США = 2". 

Если количество региональных реплик указано не для всех расположений, то количеством по умолчанию будет общее количество реплик, которое вы указали. 

Чтобы указать общее количество реплик в интерфейсе командной строки, используйте аргумент **--replica-count** в команде `az sig image-version create`.

### <a name="can-i-create-the-shared-image-gallery-in-a-different-location-than-the-one-for-the-image-definition-and-image-version"></a>Можно ли создать Общую коллекцию образов в расположении, отличном от того, где планируется создать определение и версию образа?

Да, это возможно. Но мы рекомендуем вам держать группу ресурсов, общую коллекцию образов, определение образа и версию образа в одном расположении.

### <a name="what-are-the-charges-for-using-the-shared-image-gallery"></a>Какова стоимость использования коллекции общих образов?

За использование службы "Коллекция общих образов" плата не взимается, за исключением расходов на хранение версий образов и на исходящий трафик для репликации версий образов из исходного региона в целевые регионы.

### <a name="what-api-version-should-i-use-to-create-shared-image-gallery-and-image-definition-and-image-version"></a>Какую версию API следует использовать для создания Общей коллекции образов, определения образа и версии образа?

Для работы с коллекцией общих образов, определениями образов и версиями образов рекомендуется использовать API версии 2018-06-01. Для работы с хранилищем, избыточным между зонами (ZRS), необходима версия 2019-03-01 или более поздняя.

### <a name="what-api-version-should-i-use-to-create-shared-vm-or-virtual-machine-scale-set-out-of-the-image-version"></a>Какую версию API следует использовать для создания общей виртуальной машины или масштабируемого набора виртуальных машин из версии образа?

Для развертываний виртуальной машины и масштабируемого набора виртуальных машин с помощью версии образа рекомендуется использовать API версии 2018-04-01 или более поздней.

### <a name="can-i-update-my-virtual-machine-scale-set-created-using-managed-image-to-use-shared-image-gallery-images"></a>Можно ли обновить масштабируемый набор виртуальных машин, созданный на основе управляемого образа, чтобы использовать в нем образы из Общей коллекции образов?

Да, вы можете изменить для масштабируемого набора ссылку на исходный образ с управляемого образа на образ в общей коллекции, если в этих образах совпадают тип ОС, поколение Hyper-V и схема дисков данных.

## <a name="troubleshoot-shared-image-gallery-issues"></a>Устранение неполадок с общей коллекцией образов
Если у вас возникли проблемы с выполнением каких либо операций с общими ресурсами коллекции образов, просмотрите список распространенных ошибок в [руководстве по устранению неполадок](troubleshooting-shared-images.md).

Кроме того, вы можете разместить свой вопрос и пометить его в `azure-virtual-machines-images` [Q&A](/answers/topics/azure-virtual-machines-images.html).

## <a name="next-steps"></a>Следующие шаги

Узнайте, как развертывать общие образы с помощью [Azure CLI](shared-images-cli.md) или [PowerShell](shared-images-powershell.md).

