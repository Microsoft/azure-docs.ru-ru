---
title: Группы размещения Azure для приложений SAP | Документация Майкрософт
description: Описание сценариев развертывания SAP с группами размещения с учетом расположения в Azure
services: virtual-machines-linux,virtual-machines-windows
documentationcenter: ''
author: msjuergent
manager: bburns
editor: ''
tags: azure-resource-manager
keywords: ''
ms.service: virtual-machines-linux
ms.subservice: workloads
ms.topic: article
ms.tgt_pltfrm: vm-linux
ms.workload: infrastructure
ms.date: 12/29/2020
ms.author: juergent
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: 1e6aaf1b37073bf93e0aca8237161bf11af3a872
ms.sourcegitcommit: 42922af070f7edf3639a79b1a60565d90bb801c0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/31/2020
ms.locfileid: "97827229"
---
# <a name="azure-proximity-placement-groups-for-optimal-network-latency-with-sap-applications"></a>Группы размещения службы "близость" Azure для оптимальной сетевой задержки с приложениями SAP
Приложения SAP на основе архитектуры SAP NetWeaver или SAP S/4HANA чувствительны к задержке в сети между уровнем приложений SAP и уровнем базы данных SAP. Эта чувствительность является результатом большей части бизнес-логики, выполняемой на уровне приложения. Поскольку уровень приложений SAP выполняет бизнес-логику, он отправляет запросы на уровень базы данных с высокой частотой в тысячах или десятках тысяч в секунду. В большинстве случаев характер этих запросов прост. Они часто могут выполняться на уровне базы данных за 500 МКС или менее.

Время, затраченное в сети на отправку такого запроса с уровня приложения на уровень базы данных и получение результирующего набора, оказывает значительное влияние на время, затрачиваемое на выполнение бизнес-процессов. Эта чувствительность к задержке в сети заключается в том, что в проектах развертывания SAP может потребоваться достигнуть определенной максимальной задержки в сети. Рекомендации по классификации сетевой задержки см. в статье [SAP Note #1100926 — вопросы и ответы: производительность сети](https://launchpad.support.sap.com/#/notes/1100926/E) .

Во многих регионах Azure количество центров обработки данных увеличилось. В то же время клиенты, особенно для высокопроизводительных систем SAP, используют более Специальные номера SKU виртуальных машин семейства M или Mv2 или крупные экземпляры HANA. Эти типы виртуальных машин Azure не всегда доступны во всех центрах обработки данных, дополняющих регион Azure. Эти факты могут создавать возможности для оптимизации задержки в сети между уровнем приложений SAP и уровнем СУБД SAP.

Чтобы обеспечить возможность оптимизации задержки в сети, Azure предлагает [группы размещения](../../linux/co-location.md)с учетом расположения. Группы размещения с учетом расположения можно использовать для принудительного группирования различных типов виртуальных машин в одном центре обработки данных Azure, чтобы оптимизировать сетевую задержку между этими типами виртуальных машин. В процессе развертывания первой виртуальной машины в такой группе размещения с учетом расположения ВИРТУАЛЬная машина привязывается к определенному центру обработки данных. По мере того, как это деловое отношение звучит, использование конструкции также приводит к некоторым ограничениям:

- Вы не можете предположить, что все типы виртуальных машин Azure доступны в каждом и всех центрах обработки данных Azure. В результате сочетание различных типов виртуальных машин в одной группе размещения с учетом расположения может быть ограничено. Эти ограничения возникают из-за того, что оборудование узла, необходимое для запуска определенного типа виртуальной машины, может отсутствовать в центре обработки данных, в котором развернута группа размещения.
- По мере изменения размера частей виртуальных машин, находящихся в одной группе размещения, нельзя автоматически предположить, что во всех случаях новый тип виртуальной машины доступен в том же центре обработки данных, что и другие виртуальные машины, входящие в группу размещения с учетом расположения.
- При списании Azure оборудование может принудительно выполнять определенные виртуальные машины группы размещения с близкой назначением в другой центр обработки данных Azure. Дополнительные сведения об этом случае см. в документе [совместное размещение ресурсов для повышения задержки](../../linux/co-location.md#planned-maintenance-and-proximity-placement-groups) .  

> [!IMPORTANT]
> В результате возможных ограничений следует использовать группы размещения с учетом расположения:
>
> - Только при необходимости
> - Только при детализации одной системы SAP, а не на всей системной или полной ландшафтной среде SAP.
> - Таким образом, чтобы разные типы виртуальных машин и количество виртуальных машин в группе размещения с учетом расположения оставались минимальными

Предположим, что при развертывании виртуальных машин с помощью Зоны доступности и выборе одного и того же Зоны доступности задержка в сети между этими виртуальными машинами должна быть достаточной для работы с системами SAP NetWeaver и S/4HANA с соблюдением производительности и пропускной способности. Это предположение не зависит от того факта, что определенная зона встроена в один центр обработки данных или несколько центров обработки данных. Единственная причина использования групп размещения с близкой назначением в развертываниях зональные — случай, когда необходимо выделить развернутые виртуальные машины в группе доступности Azure вместе с зональные развернутыми виртуальными машинами.


## <a name="what-are-proximity-placement-groups"></a>Что такое группы размещения близкого расположения? 
Группа размещения службы "близость" Azure является логической конструкцией. Если группа размещения с близкой назначением определена, она привязывается к региону Azure и группе ресурсов Azure. При развертывании виртуальных машин ссылка на группу размещения с учетом расположения находится в следующих случаях:

- Первая виртуальная машина Azure, развернутая в центре обработки данных. Первую виртуальную машину можно считать "областью виртуальной машины", развернутой в центре обработки данных на основе алгоритмов распределения Azure, которые в конечном итоге объединяются с определениями пользователей для определенной зоны доступности.
- Все последующие развернутые виртуальные машины, которые ссылаются на группу размещения с учетом расположения, размещают все развернутые виртуальные машины Azure в том же центре обработки данных, что и первая виртуальная машина.

> [!NOTE]
> Если не развернуто оборудование узла, которое может запустить конкретный тип ВИРТУАЛЬНОЙ машины в центре обработки данных, где была размещена первая ВИРТУАЛЬная машина, развертывание запрошенного типа виртуальной машины не будет выполнено. Вы получите сообщение об ошибке.

Одной [группе ресурсов Azure](../../../azure-resource-manager/management/manage-resources-portal.md) может быть назначено несколько групп размещения с учетом расположения. Но группа размещения с учетом расположения может быть назначена только одной группе ресурсов Azure.


## <a name="proximity-placement-groups-with-sap-systems-that-use-only-azure-vms"></a>Группы размещения с учетом расположения с системами SAP, которые используют только виртуальные машины Azure
Большинство развертываний систем SAP NetWeaver и S/4HANA в Azure не используют [крупные экземпляры Hana](./hana-overview-architecture.md). Для развертываний, которые не используют крупные экземпляры HANA, важно обеспечить оптимальную производительность между уровнем приложений SAP и уровнем СУБД. Чтобы сделать это, определите группу размещения для службы близкого взаимодействия Azure только для системы.

В большинстве клиентских развертываний клиенты создают одну [группу ресурсов Azure](../../../azure-resource-manager/management/manage-resources-portal.md) для систем SAP. В этом случае существует связь «один к одному» между, например, группой ресурсов производственной системы ERP и группой размещения с близостьями. В других случаях клиенты упорядочивают группы ресурсов по горизонтали и собираются все рабочие системы в одной группе ресурсов. В этом случае у вас будет связь «один ко многим» между группой ресурсов для производственных систем SAP и несколькими группами размещения для производственной системы SAP ERP, SAP BW и т. д.

Избегайте объединения нескольких производственных и непроизводственных систем SAP в одной группе размещения с учетом расположения. Если небольшому числу систем SAP или системы SAP и некоторым окружающим приложениям требуется сетевое взаимодействие с низкой задержкой, можно рассмотреть возможность перемещения этих систем в одну группу размещения близости. Избегайте пакетов систем, так как чем больше систем группируются в группу размещения с учетом расположения, тем выше вероятность:

- Для этого требуется тип виртуальной машины, который не может выполняться в конкретном центре обработки данных, к которому относится группа размещения с учетом расположения.
- Ресурсы, не являющиеся виртуальными виртуальными машинами, например виртуальные машины серии M, могут в конечном итоге быть неудовлетворенными, так как вы добавляете программное обеспечение в группу размещения с течением времени.

Вот как выглядит идеальная конфигурация, как описано ниже.

![Группы размещения близкого взаимодействия с только виртуальными машинами Azure](./media/sap-proximity-placement-scenarios/ppg-for-all-azure-vms.png)

В этом случае одиночные системы SAP группируются в одну группу ресурсов, каждая из которых имеет одну группу размещения с учетом расположения. Нет никакой зависимости от того, используется ли конфигурация масштабирования HANA или масштабирование СУБД.

## <a name="proximity-placement-groups-and-hana-large-instances"></a>Группы размещения близкого взаимодействия и крупные экземпляры HANA
Если некоторые системы SAP используют [крупные экземпляры Hana](./hana-overview-architecture.md) для уровня приложения, вы можете столкнуться с значительными улучшениями сетевой задержки между единицей крупных экземпляров Hana и виртуальными машинами Azure при использовании единиц крупных экземпляров Hana, развернутых в [строках и метках версии 4](./hana-network-architecture.md#networking-architecture-for-hana-large-instance). Одно из улучшений состоит в том, что крупные экземпляры HANA, как они развернуты, развертываются с группой размещения с близкой нагрузкой. Вы можете использовать эту группу размещения с учетом расположения для развертывания виртуальных машин уровня приложения. В результате эти виртуальные машины будут развернуты в том же центре обработки данных, где размещена единица крупных экземпляров HANA.

Чтобы определить, развернута ли единица крупных экземпляров HANA в отметке или строке редакции 4, ознакомьтесь со статьей [Управление крупными экземплярами Azure Hana с помощью портал Azure](./hana-li-portal.md#look-at-attributes-of-single-hli-unit). В обзоре атрибутов единицы крупных экземпляров HANA можно также определить имя группы размещения с учетом расположения, так как оно было создано при развертывании единицы крупных экземпляров HANA. Имя, отображаемое в разделе Общие сведения об атрибутах, — это имя группы размещения с учетом расположения, в которую следует развернуть виртуальные машины уровня приложения.

По сравнению с системами SAP, которые используют только виртуальные машины Azure, при использовании крупных экземпляров HANA вы получаете меньше гибкости при принятии решения о том, сколько [групп ресурсов Azure](../../../azure-resource-manager/management/manage-resources-portal.md) использовать. Все крупные экземпляры HANA [клиента крупных экземпляров Hana](./hana-know-terms.md) группируются в одну группу ресурсов, как описано в [этой статье](./hana-li-portal.md#display-of-hana-large-instance-units-in-the-azure-portal). Если вы не развертываете в разных клиентах отдельные, например рабочие и непроизводственные системы или другие системы, все единицы крупных экземпляров HANA будут развернуты в одном клиенте крупных экземпляров HANA. Этот клиент имеет связь "один к одному" с группой ресурсов. Но для каждого из этих единиц будет определена отдельная группа размещения с учетом расположения.

В результате отношения между группами ресурсов Azure и группами размещения для одного клиента будут показаны ниже:

![Группы размещения близкого взаимодействия и крупные экземпляры HANA](./media/sap-proximity-placement-scenarios/ppg-for-hana-large-instance-units.png)

## <a name="example-of-deployment-with-proximity-placement-groups"></a>Пример развертывания с группами размещения с близкой нарядом
Ниже приведены некоторые команды PowerShell, которые можно использовать для развертывания виртуальных машин с помощью групп размещения близости к Azure.

Первым шагом после входа в [Azure Cloud Shell](https://azure.microsoft.com/features/cloud-shell/)является проверка того, находится ли ваша подписка Azure, которую вы хотите использовать для развертывания:

<pre><code>
Get-AzureRmContext
</code></pre>

Если необходимо изменить другую подписку, это можно сделать, выполнив следующую команду:

<pre><code>
Set-AzureRmContext -Subscription "my PPG test subscription"
</code></pre>

Создайте новую группу ресурсов Azure, выполнив следующую команду:

<pre><code>
New-AzResourceGroup -Name "myfirstppgexercise" -Location "westus2"
</code></pre>

Создайте новую группу размещения с учетом расположения, выполнив следующую команду:

<pre><code>
New-AzProximityPlacementGroup -ResourceGroupName "myfirstppgexercise" -Name "letsgetclose" -Location "westus2"
</code></pre>

Разверните первую виртуальную машину в группе размещения с учетом расположения с помощью команды, подобной следующей:

<pre><code>
New-AzVm -ResourceGroupName "myfirstppgexercise" -Name "myppganchorvm" -Location "westus2" -OpenPorts 80,3389 -ProximityPlacementGroup "letsgetclose" -Size "Standard_DS11_v2"
</code></pre>

Предыдущая команда развертывает виртуальную машину на основе Windows. После того как развертывание виртуальной машины будет завершено, область центра обработки данных группы размещения с учетом расположения будет определена в регионе Azure. Все последующие развертывания виртуальных машин, которые ссылаются на группу размещения с учетом расположения, как показано в предыдущей команде, будут развернуты в том же центре обработки данных Azure, если тип виртуальной машины можно разместить на оборудовании, размещенном в этом центре обработки данных, а емкость для этого типа виртуальной машины станет доступной.

## <a name="combine-availability-sets-and-availability-zones-with-proximity-placement-groups"></a>Объединение групп доступности и Зоны доступности с группами размещения с учетом расположения
Одним из недостатков использования Зоны доступности для развертываний систем SAP является то, что вы не можете развернуть уровень приложений SAP с помощью групп доступности в определенной зоне. Необходимо, чтобы уровень приложений SAP был развернут в тех же зонах, что и уровень СУБД. Ссылка на зону доступности и группу доступности при развертывании одной виртуальной машины не поддерживается. Итак, ранее было вынуждено развернуть уровень приложения, ссылаясь на зону. Потеряна возможность убедиться, что виртуальные машины уровня приложения были распределены между разными доменами обновления и сбоя.

С помощью групп размещения с учетом расположения можно обойти это ограничение. Вот последовательность развертывания:

- Создайте группу размещения с учетом расположения.
- Разверните виртуальную машину привязки (как правило, сервер СУБД), обратившись к зоне доступности.
- Создание группы доступности, которая ссылается на группу близости Azure. (См. команду Далее в этой статье.)
- Разверните виртуальные машины уровня приложения, ссылаясь на группу доступности и группы размещения с учетом расположения.

Вместо развертывания первой виртуальной машины, как показано в предыдущем разделе, вы ссылаетесь на зону доступности и группу размещения с учетом расположения при развертывании виртуальной машины:

<pre><code>
New-AzVm -ResourceGroupName "myfirstppgexercise" -Name "myppganchorvm" -Location "westus2" -OpenPorts 80,3389 -Zone "1" -ProximityPlacementGroup "letsgetclose" -Size "Standard_E16_v3"
</code></pre>

При успешном развертывании этой виртуальной машины экземпляр базы данных SAP будет размещен в одной зоне доступности. Область группы размещения с учетом расположения фиксируется в одном из центров обработки данных, представляющих определенную зону доступности.

Предположим, что вы развертываете виртуальные машины центральных служб таким же образом, как и виртуальные машины СУБД, ссылающиеся на одну и ту же зону или зоны и те же группы размещения. На следующем шаге необходимо создать наборы доступности, которые будут использоваться для уровня приложения системы SAP.

Определите и создайте группу размещения с учетом расположения. Команда для создания группы доступности требует дополнительной ссылки на идентификатор групп размещения близости (не имя). Идентификатор группы размещения с учетом расположения можно получить с помощью следующей команды:

<pre><code>
Get-AzProximityPlacementGroup -ResourceGroupName "myfirstppgexercise" -Name "letsgetclose"
</code></pre>

При создании группы доступности необходимо рассмотреть дополнительные параметры при использовании управляемых дисков (по умолчанию, если не указано иное) и групп размещения с учетом расположения:

<pre><code>
New-AzAvailabilitySet -ResourceGroupName "myfirstppgexercise" -Name "myppgavset" -Location "westus2" -ProximityPlacementGroupId "/subscriptions/my very long ppg id string" -sku "aligned" -PlatformUpdateDomainCount 3 -PlatformFaultDomainCount 2 
</code></pre>

В идеале следует использовать три домена сбоя. Но количество поддерживаемых доменов сбоя может отличаться от региона к региону. В этом случае максимальное число доменов сбоя для конкретных регионов равно двум. Чтобы развернуть виртуальные машины уровня приложения, необходимо добавить ссылку на имя группы доступности и имя группе размещения с учетом расположения, как показано ниже:

<pre><code>
New-AzVm -ResourceGroupName "myfirstppgexercise" -Name "myppgavsetappvm" -Location "westus2" -OpenPorts 80,3389 -AvailabilitySetName "myppgavset" -ProximityPlacementGroup "letsgetclose" -Size "Standard_DS11_v2"
</code></pre>

Результат этого развертывания:
- Уровень СУБД и центральные службы для системы SAP, расположенные в определенной зоне доступности или Зоны доступности.
- Уровень приложений SAP, расположенный в группах доступности в тех же центрах обработки данных Azure, что и виртуальная машина или виртуальные машины СУБД.

> [!NOTE]
> Поскольку одна виртуальная машина СУБД развертывается в одной зоне, а вторая виртуальная машина СУБД — в другую, для создания конфигурации с высоким уровнем доступности для каждой зоны потребуется другая группа размещения с учетом расположения. Это справедливо и для любой используемой группы доступности.

## <a name="move-an-existing-system-into-proximity-placement-groups"></a>Перемещение существующей системы в группы размещения с учетом расположения
Если вы уже развернули системы SAP, может потребоваться оптимизировать сетевую задержку некоторых критических систем и выбрать уровень приложения и уровень СУБД в одном центре обработки данных. Чтобы переместить виртуальные машины полной группы доступности Azure в существующую группу размещения с областью видимости, которая уже находится в области, необходимо завершить работу всех виртуальных машин группы доступности и назначить группу доступности существующей группе размещения с помощью портал Azure, PowerShell или CLI. Если вы хотите переместить виртуальную машину, которая не является частью группы доступности, в существующую группу размещения, вам нужно просто завершить работу виртуальной машины и назначить ее существующей группе размещения близости. 


## <a name="next-steps"></a>Дальнейшие действия
Ознакомьтесь с документацией:

- [Рабочие нагрузки SAP в Azure: контрольный список для планирования и развертывания](./sap-deployment-checklist.md)
- [Предварительная версия: развертывание виртуальных машин в группах размещения с помощью Azure CLI](../../linux/proximity-placement-groups.md)
- [Предварительная версия: развертывание виртуальных машин в группах размещения с помощью PowerShell](../../windows/proximity-placement-groups.md)
- [Рекомендации по развертыванию СУБД для рабочих нагрузок SAP на виртуальных машинах Azure](./dbms_guide_general.md)