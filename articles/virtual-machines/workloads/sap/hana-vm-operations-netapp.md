---
title: SAP HANA конфигурации использовании виртуальной машины Azure | Документация Майкрософт
description: Azure NetApp Files рекомендации по хранению SAP HANA.
services: virtual-machines-linux,virtual-machines-windows
documentationcenter: ''
author: msjuergent
manager: bburns
editor: ''
tags: azure-resource-manager
keywords: SAP, Azure, использовании, HANA, Azure NetApp Files, моментальный снимок
ms.service: virtual-machines-linux
ms.subservice: workloads
ms.topic: article
ms.tgt_pltfrm: vm-linux
ms.workload: infrastructure
ms.date: 01/23/2021
ms.author: juergent
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: 906879c44a2d7a3248f3d3ac0c9fec7ced7f2a4f
ms.sourcegitcommit: 4d48a54d0a3f772c01171719a9b80ee9c41c0c5d
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/24/2021
ms.locfileid: "98746549"
---
# <a name="nfs-v41-volumes-on-azure-netapp-files-for-sap-hana"></a>Тома NFS версии 4.1 в Azure NetApp Files для SAP HANA

Azure NetApp Files предоставляет собственные общие папки NFS, которые можно использовать для томов **/Hana/Shared**, **/Hana/Data** и **/Hana/log** . Использование общих ресурсов NFS на основе использовании для томов **/Hana/Data** и **/Hana/log** требует использования протокола NFS версии 4.1. Протокол NFS v3 не поддерживается для использования томов **/Hana/Data** и **/Hana/log** при создании общих папок на использовании. 


> [!IMPORTANT]
> Протокол NFS v3, реализованный в Azure NetApp Files, **не** поддерживается для **/Hana/Data** и **/Hana/log**. Использование NFS 4,1 является обязательным для томов **/Hana/Data** и **/Hana/log** из функциональной точки зрения. В то время как для тома **/Hana/Shared** протокол NFS v3 или NFS версии 4.1 можно использовать из функциональной точки зрения.

## <a name="important-considerations"></a>Важные сведения

При выборе Azure NetApp Files для SAP NetWeaver и SAP HANA стоит учитывать следующие важные моменты.

- Пул минимальных мощностей — 4 тиб  
- Минимальный размер тома составляет 100 ГиБ.
- Azure NetApp Files и все виртуальные машины, на которых подключены Azure NetApp Files тома, должны находиться в одной виртуальной сети Azure или в [одноранговой виртуальной сети](../../../virtual-network/virtual-network-peering-overview.md) в том же регионе.
- Важно, чтобы виртуальные машины были развернуты как можно ближе к хранилищу Azure NetApp, чтобы снизить задержку.  
- Выбранная виртуальная сеть должна иметь подсеть, делегированную Azure NetApp Files
- Убедитесь, что задержка от сервера базы данных до тома использовании измеряется и меньше 1 миллисекунда.
- Пропускная способность тома Azure NetApp является функцией квоты тома и уровня обслуживания, как описано в статье [Уровни обслуживания для Azure NetApp Files](../../../azure-netapp-files/azure-netapp-files-service-levels.md). При определении размера томов HANA Azure NetApp убедитесь, что полученная пропускная способность соответствует требованиям к системе HANA.
- Попробуйте "консолидировать" тома, чтобы повысить производительность в более крупном томе, например, используйте один том для/sapmnt,/УСР/САП/транс,... по возможности  
- Azure NetApp Files предлагает [политику экспорта](../../../azure-netapp-files/azure-netapp-files-configure-export-policy.md), которая позволяет управлять разрешенными клиентами, типом доступа (чтение и запись, доступ только для чтения и т. д.). 
- Функция Azure NetApp Files пока еще не поддерживает зоны. В настоящее время Azure NetApp Files не развернута во всех зонах доступности региона Azure. Учитывайте возможную задержку в некоторых регионах Azure.   
- Идентификатор пользователя для <b>sid</b>adm и идентификатор группы для `sapsys` на виртуальных машинах должны соответствовать конфигурации в Azure NetApp Files. 

> [!IMPORTANT]
> Для рабочих нагрузок SAP HANA низкий показатель задержки чрезвычайно важен. Пообщайтесь с представителями корпорации Майкрософт, чтобы убедиться, что виртуальные машины и тома Azure NetApp Files развернуты близко друг от друга.  

> [!IMPORTANT]
> В случае несоответствия между ИДЕНТИФИКАТОРом пользователя <b>SID</b>ADM и идентификатором группы `sapsys` между виртуальной машиной и конфигурацией Azure NetApp разрешения для файлов на томах NetApp в Azure, ПОДКЛЮЧЕННЫХ к виртуальной машине, будут отображаться как `nobody` . Убедитесь, что указали правильный идентификатор пользователя для <b>sid</b>adm и правильный идентификатор группы для `sapsys` во время [установки новой системы ](https://forms.office.com/Pages/ResponsePage.aspx?id=v4j5cvGGr0GRqy180BHbRxjSlHBUxkJBjmARn57skvdUQlJaV0ZBOE1PUkhOVk40WjZZQVJXRzI2RC4u) в среде Azure NetApp Files.


## <a name="sizing-for-hana-database-on-azure-netapp-files"></a>Выбор размера базы данных HANA в Azure NetApp Files

Пропускная способность тома Azure NetApp является функцией размера тома и уровня обслуживания, как описано в статье [Уровни обслуживания для Azure NetApp Files](../../../azure-netapp-files/azure-netapp-files-service-levels.md). 

Важно понимать, что это отношение производительности к размеру и что существуют физические ограничения для Лиф (логического интерфейса) SVM (виртуальная машина хранилища).

В таблице ниже показано, что можно создать большой "Стандартный" том для хранения резервных копий и не иметь смысла создавать "Ultra" тома размером более 12 ТБ из-за превышения емкости физической пропускной способности одного Лиф. 

Максимальная пропускная способность для Лиф и одного сеанса Linux составляет от 1,2 до 1,4 ГБ/с. Если требуется дополнительная пропускная способность для/Hana/Data, можно использовать SAP HANA секционирование томов данных, чтобы создать чередующиеся операции ввода-вывода во время перезагрузки данных или HANA точек сохранения в нескольких файлах данных HANA, расположенных в нескольких общих папках NFS. Дополнительные сведения о чередовании томов данных HANA см. в следующих статьях:

- [Руководством администратора HANA](https://help.sap.com/viewer/6b94445c94ae495c83a19646e7c3fd56/2.0.05/en-US/40b2b2a880ec4df7bac16eae3daef756.html?q=hana%20data%20volume%20partitioning)
- [Блог о SAP HANA — секционирование томов данных](https://blogs.sap.com/2020/10/07/sap-hana-partitioning-data-volumes/)
- [Примечание SAP #2400005](https://launchpad.support.sap.com/#/notes/2400005)
- [Примечание SAP #2700123](https://launchpad.support.sap.com/#/notes/2700123)


| Размер  | Стандартная пропускная способность | Пропускная способность Premium | Пропускная способность Ultra |
| --- | --- | --- | --- |
| 1 TБ | 16 МБ/с | 64 МБ/с | 128 МБ/с |
| 2 ТБ | 32 МБ/с | 128 МБ/с | 256 МБ/с |
| 4 TБ | 64 МБ/с | 256 МБ/с | 512 МБ/с |
| 10 ТБ | 160 МБ/с | 640 МБ/с | 1 280 МБ/с |
| 15 ТБ | 240 МБ/с | 960 МБ/с | 1 400 МБ/с |
| 20 TБ | 320 МБ/с | 1 280 МБ/с | 1 400 МБ/с |
| 40 ТБ | 640 МБ/с | 1 400 МБ/с | 1 400 МБ/с |

Важно понимать, что данные записываются в те же твердотельные накопители в серверной части хранилища. Квота производительности пула емкости была создана для управления средой.
Ключевые показатели эффективности хранилища равны для всех размеров базы данных HANA. В большинстве случаев это предположение не отражает реальность и ожидание клиента. Размер систем HANA не обязательно означает, что небольшая система требует низкой пропускной способности хранилища, а большая система требует высокой пропускной способности хранилища. Но обычно мы можем рассчитывать на более высокие требования к пропускной способности для больших экземпляров базы данных HANA. В результате правил изменения размера SAP для базового оборудования, такого крупного экземпляра HANA, также предоставляет больше ресурсов ЦП и более высокий параллелизм в таких задачах, как загрузка данных после перезапуска экземпляра. В результате размер тома должен быть принят к ожиданиям и требованиям клиента. И не только на основе требований чистой емкости.

При проектировании инфраструктуры для SAP в Azure следует учитывать некоторые минимальные требования к пропускной способности хранилища (для систем производств), которые относятся к минимальным характеристикам пропускной способности:

| Тип тома и тип ввода-вывода | Минимальный ключевой показатель эффективности, требуемый SAP | Уровень обслуживания Premium | Уровень Ultra Service |
| --- | --- | --- | --- |
| Запись тома журнала | 250 МБ/с | 4 TБ | 2 ТБ |
| Запись тома данных | 250 МБ/с | 4 TБ | 2 ТБ |
| Объем данных для чтения | 400 МБ в секунду | 6,3 ТБ | 3,2 ТБ |

Так как требуются все три ключевых показателя эффективности, том **/Hana/Data** должен иметь больший размер, чтобы обеспечить максимальную емкость для выполнения минимальных требований к чтению.

Для систем HANA, для которых не требуется высокая пропускная способность, размеры томов использовании могут быть меньше. А если система HANA требует более высокой пропускной способности, том можно адаптировать путем изменения размера емкости в сети. Для резервных томов не определены ключевые показатели эффективности. Однако пропускная способность тома резервных копий является обязательной для хорошо выполняющейся среды. Производительность журнала — и объем данных должны быть рассчитаны на ожидание клиента.

> [!IMPORTANT]
> Независимо от емкости, развертываемой на одном томе NFS, пропускная способность должна выравниваться в диапазоне от 1,2 до 1,4 ГБ/с, используемом пользователем виртуальной машины. Это связано с базовой архитектурой предложения ANF и связанными с ним ограничениями сеанса Linux в отношении NFS. Показатели производительности и пропускной способности, указанные в статье [Результаты теста производительности для Azure NetApp Files](../../../azure-netapp-files/performance-benchmarks-linux.md), были получены с одним общим томом NFS и несколькими клиентскими виртуальными машинами, в результате нескольких сеансов. Этот сценарий отличается от сценария, измеряемого в SAP. В этом случае измеряется пропускная способность одной виртуальной машины с томом NFS, Размещается в использовании.

Чтобы удовлетворить минимальные требования к пропускной способности SAP для данных и журналов и в соответствии с рекомендациями для **/Hana/Shared**, рекомендованные размеры будут выглядеть следующим образом:

| Том | Размер<br /> Хранилище класса "Premium" | Размер<br /> Хранилище класса "Ультра" | Поддерживаемый протокол NFS |
| --- | --- | --- |
| /hana/log/ | 4 ТиБ | 2 ТиБ | Версия 4.1 |
| hana/data; | 6.3 ТиБ | 3.2 ТиБ | Версия 4.1 |
| масштабирование/Hana/Shared | Min (1 ТБ, 1 x RAM)  | Min (1 ТБ, 1 x RAM) | Версия 3 или версия 4.1 |
| горизонтальное масштабирование/Hana/Shared | 1 x рабочий памяти узла рабочей роли<br /> за 4 рабочих узла  | 1 x рабочий памяти узла рабочей роли<br /> за 4 рабочих узла  | Версия 3 или версия 4.1 |
| /Hana/logbackup. | 3 x ОЗУ  | 3 x ОЗУ | Версия 3 или версия 4.1 |
| /Hana/Backup | 2 x ОЗУ  | 2 x ОЗУ | Версия 3 или версия 4.1 |

Для всех томов настоятельно рекомендуется использовать NFS версии 4.1.

Размеры томов резервных копий — это оценки. Точные требования должны быть определены на основе процессов рабочей нагрузки и операций. Для резервного копирования можно консолидировать множество томов для разных экземпляров SAP HANA до одного (или двух) больших томов, что может иметь более низкий уровень обслуживания использовании.

> [!NOTE]
> Azure NetApp Files, рекомендации по выбору размера, указанные в этом документе, предназначены для минимальных требований SAP Express к поставщикам инфраструктуры. В реальных сценариях развертывания и рабочих нагрузок это может оказаться недостаточным. Поэтому примите эти рекомендации в качестве отправной точки и адаптируйтесь в соответствии с требованиями своей рабочей нагрузки.  

Таким образом, вы можете подумать о том, чтобы развернуть похожую пропускную способность для томов ANF, как это было указано для хранилища "Ультра". Кроме того, следует учесть размеры всех томов для различных номеров SKU виртуальной машины, как это уже было указано в таблицах для диска "Ультра"

> [!TIP]
> Вы можете динамически изменять размер томов Azure NetApp Files без необходимости `unmount` тома, прекращать работу виртуальных машин или прерывать работу SAP HANA. Это позволяет создать гибкий подход, который поможет справиться как с ожидаемыми, так и с непредвиденными обстоятельствами, связанными с пропускной способностью.

Документацию по развертыванию конфигурации горизонтального масштабирования SAP HANA с резервным узлом с помощью томов NFS версии 4.1, размещенных в ANF, можно найти на сервере [SUSE Linux Enterprise, посвященному горизонтальному масштабированию SAP HANA с резервным узлом на виртуальных машинах Azure с Azure NetApp Files](./sap-hana-scale-out-standby-netapp-files-suse.md).


## <a name="availability"></a>Доступность
ИСПОЛЬЗОВАНИИ обновления системы и их обновления применяются без влияния на среду клиента. Определенное [соглашение об уровне обслуживания составляет 99,99%](https://azure.microsoft.com/support/legal/sla/netapp/).


## <a name="volumes-and-ip-addresses-and-capacity-pools"></a>Тома и IP-адреса и пулы ресурсов
С использовании важно понимать, как строится базовая инфраструктура. Пул емкости — это только структура, которая упрощает создание модели выставления счетов для использовании. Пул емкости не имеет физической связи с базовой инфраструктурой. При создании пула емкости создается только оболочка, которая может быть заряжена, а не больше. При создании тома в кластере нескольких NetApp систем создается первый SVM (виртуальная машина хранилища). Для доступа к тому SVM создается отдельный IP-адрес. При создании нескольких томов все тома распределяются в этом SVM через кластер NetApp с несколькими контроллерами. Даже если вы получаете только один IP-адрес, данные распределяются по нескольким контроллерам. ИСПОЛЬЗОВАНИИ имеет логику, которая автоматически распределяет рабочие нагрузки клиентов, когда тома или (или) емкость настроенного хранилища достигает внутреннего предварительно определенного уровня. В таких случаях можно заметить, что для доступа к томам назначен новый IP-адрес.

##<a name="log-volume-and-log-backup-volume"></a>Объем журнала и том резервной копии журнала
"Том журнала" (**/Hana/log**) используется для записи журнала повторов в сети. Таким образом, в этом томе находятся открытые файлы, и нет смысла делать моментальные снимки этого тома. Файлы журнала повтора в сети архивируются или архивируются в том резервной копии журнала после заполнения файла журнала повторного выполнения или резервной копии журнала повтора. Чтобы обеспечить разумную производительность резервного копирования, объем резервной копии журнала требует хорошей пропускной способности. Чтобы оптимизировать затраты на хранение, может быть целесообразно консолидировать журнал резервного копирования для нескольких экземпляров HANA. Так что несколько экземпляров HANA используют один и тот же том и записывают свои резервные копии в разные каталоги. Используя такую консолидацию, вы можете повысить пропускную способность, так как вам нужно сделать так, чтобы том был больше. 

То же самое относится к тому, что используется для записи полных резервных копий базы данных HANA в.  
 

## <a name="backup"></a>Резервное копирование
Помимо потоковых резервных копий и резервного копирования Azure резервное копирование SAP HANA баз данных, как описано в статье [руководство по резервному копированию для SAP HANA на виртуальных машинах Azure](./sap-hana-backup-guide.md), Azure NetApp Files открывает возможность выполнять резервное копирование моментальных снимков на основе хранилища. 

SAP HANA поддерживает:

- Резервные копии моментальных снимков на основе хранилища от SAP HANA 1,0 SPS7 на
- Поддержка резервного копирования моментальных снимков на основе хранилища для сред с несколькими базами данных (MDC) в средах HANA от SAP HANA 2,0 SPS4 on


Создание резервных копий моментальных снимков на основе хранилища — это простая 4-шаговая процедура. 
1. Создание моментального снимка базы данных HANA (внутренний) — действие, которое необходимо выполнить или инструменты 
1. SAP HANA записывает данные в файлы данных для создания стабильного состояния в хранилище. HANA выполняет этот шаг в результате создания моментального снимка HANA.
1. Создание моментального снимка на томе **/Hana/Data** в хранилище — шаг, который необходимо выполнить или инструменты. Нет необходимости создавать моментальный снимок на томе **/Hana/log**
1. Удалите моментальный снимок базы данных HANA (внутренний) и возобновите нормальную работу — шаг, который необходимо выполнить или инструменты

> [!WARNING]
> Отсутствие последнего шага или неуспешное выполнение последнего шага оказывает серьезное влияние на потребность в памяти SAP HANA и может привести к сбою SAP HANA

```
BACKUP DATA FOR FULL SYSTEM CREATE SNAPSHOT COMMENT 'SNAPSHOT-2019-03-18:11:00';
```

![Резервное копирование моментальных снимков использовании для SAP HANA](media/hana-vm-operations-netapp/storage-snapshot-scenario.png)

```
az netappfiles snapshot create -g mygroup --account-name myaccname --pool-name mypoolname --volume-name myvolname --name mysnapname 
```

![Резервное копирование моментальных снимков использовании для SAP HANA M89](media/hana-vm-operations-netapp/storage-snapshot.png)

```
BACKUP DATA FOR FULL SYSTEM CLOSE SNAPSHOT BACKUP_ID 47110815 SUCCESSFUL SNAPSHOT-2020-08-18:11:00';
```

Эту процедуру резервного копирования моментальных снимков можно управлять различными способами, используя различные средства. Одним из примеров является сценарий Python "ntaphana_azure. Корректировка", доступный на сайте GitHub [https://github.com/netapp/ntaphana](https://github.com/netapp/ntaphana) . это пример кода, предоставленный "как есть" без какого-либо обслуживания или поддержки.



> [!CAUTION]
> Моментальный снимок сам по себе не является защищенной резервной копией, так как она находится в том же физическом хранилище, что и том, на котором вы только что сделали моментальный снимок. Обязательно "защищать" по крайней мере один моментальный снимок в день в другом расположении. Это можно сделать в той же среде, в удаленном регионе Azure или в хранилище BLOB-объектов Azure.


Для пользователей продуктов Commvault Backup второй вариант — Commvault Интеллиснап V. 11.21 и более поздних версий. Эта или более поздние версии Commvault предлагают поддержку Azure NetApp Files. Дополнительные сведения см. в статье [Commvault интеллиснап 11,21](https://documentation.commvault.com/11.21/essential/116350_getting_started_with_backup_and_restore_operations_for_azure_netapp_file_services_smb_shares_and_nfs_shares.html) .


### <a name="back-up-the-snapshot-using-azure-blob-storage"></a>Резервное копирование моментального снимка с помощью хранилища BLOB-объектов Azure
Резервное копирование в хранилище BLOB-объектов Azure является экономичным и быстрым методом сохранения резервных копий моментальных снимков хранилища базы данных HANA на основе использовании. Чтобы сохранить моментальные снимки в хранилище BLOB-объектов Azure, рекомендуется использовать средство azcopy. Скачайте последнюю версию этого средства и установите ее, например, в каталог bin, где установлен сценарий Python из GitHub.
Скачайте последнюю версию средства azcopy:

```
root # wget -O azcopy_v10.tar.gz https://aka.ms/downloadazcopy-v10-linux && tar -xf azcopy_v10.tar.gz --strip-components=1
Saving to: ‘azcopy_v10.tar.gz’
```

Наиболее продвинутым компонентом является параметр синхронизации. При использовании параметра синхронизации azcopy сохраняет исходный и целевой каталоги синхронизированными. Использование параметра **--Delete-Destination** имеет важное значение. Без этого параметра azcopy не удаляет файлы на конечном сайте, а использование места на стороне назначения увеличится. Создайте контейнер блочного BLOB-объекта в учетной записи хранения Azure. Затем создайте ключ SAS для контейнера больших двоичных объектов и синхронизируйте папку моментальных снимков с контейнером больших двоичных объектов Azure.

Например, если моментальный снимок ежедневно должен быть синхронизирован с контейнером больших двоичных объектов Azure для защиты данных. И только один моментальный снимок должен быть сохранен, можно использовать приведенную ниже команду.

```
root # > azcopy sync '/hana/data/SID/mnt00001/.snapshot' 'https://azacsnaptmytestblob01.blob.core.windows.net/abc?sv=2021-02-02&ss=bfqt&srt=sco&sp=rwdlacup&se=2021-02-04T08:25:26Z&st=2021-02-04T00:25:26Z&spr=https&sig=abcdefghijklmnopqrstuvwxyz' --recursive=true --delete-destination=true
```

## <a name="next-steps"></a>Следующие шаги
Ознакомьтесь со статьей:

- [Обеспечение высокого уровня доступности для SAP HANA на виртуальных машинах Azure](./sap-hana-availability-overview.md)