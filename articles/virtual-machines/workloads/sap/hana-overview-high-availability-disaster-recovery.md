---
title: Обеспечение высокого уровня доступности и аварийное восстановление решения "SAP HANA в Azure (крупные экземпляры)" | Документация Майкрософт
description: Сведения об обеспечении высокого уровня доступности и о планировании аварийного восстановления решения "SAP HANA в Azure (крупные экземпляры)".
services: virtual-machines-linux
documentationcenter: ''
author: saghorpa
manager: juergent
editor: ''
ms.service: virtual-machines-sap
ms.topic: article
ms.tgt_pltfrm: vm-linux
ms.workload: infrastructure
ms.date: 09/10/2018
ms.author: saghorpa
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: 3e1fd4d53a642052c55bbe5d31bf80133ae89d35
ms.sourcegitcommit: f28ebb95ae9aaaff3f87d8388a09b41e0b3445b5
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/29/2021
ms.locfileid: "101675452"
---
# <a name="sap-hana-large-instances-high-availability-and-disaster-recovery-on-azure"></a>Высокий уровень доступности и аварийное восстановление SAP HANA в Azure (крупные экземпляры) 

>[!IMPORTANT]
>Эта документация не заменяет документацию по администрированию SAP HANA или примечания SAP. Предполагается, что читатель хорошо понимает принципы администрирования и эксплуатации SAP HANA, особенно принципы резервного копирования, восстановления, обеспечения высокой доступности и аварийного восстановления.

Очень важно выполнять шаги и процессы в собственной среде и собственных версиях и выпусках HANA. Некоторые сведения, приведенные в этой документации, упрощены для более понятного общего представления и не предназначены для использования в качестве подробных действий для эксплуатационных справочников. Чтобы создать эксплуатационные справочники конкретной конфигурации, необходимо протестировать, выполнить и задокументировать процессы, связанные с ней. 


Для работы критически важных серверов SAP HANA в Azure (крупные экземпляры) важно обеспечить высокий уровень доступности и реализовать стратегию аварийного восстановления. Важно сотрудничать с SAP, системным интегратором или корпорацией Майкрософт, чтобы правильно создать архитектуру и реализовать подходящую стратегию обеспечения высокой доступности и аварийного восстановления. Важно также учитывать целевую точку восстановления (RPO) и целевое время восстановления, характерные в среде.

Корпорация Майкрософт поддерживает некоторые методы обеспечения высокого уровня доступности SAP HANA с помощью крупных экземпляров HANA. К этим возможностям относятся следующие:

- **Репликация хранилища** — возможность системы хранения данных реплицировать все данные в другой стек крупных экземпляров HANA в другом регионе Azure. SAP HANA работает независимо от этого метода. Эта функция представляет собой механизм аварийного восстановления по умолчанию для HANA (крупные экземпляры).
- **Репликация системы HANA** — [репликация всех данных SAP HANA](https://help.sap.com/viewer/6b94445c94ae495c83a19646e7c3fd56/2.0.01/en-US/b74e16a9e09541749a745f41246a065e.html) в отдельную систему SAP HANA. Целевое время восстановления уменьшается благодаря репликации данных с регулярными интервалами. SAP HANA поддерживает асинхронные, выполняющиеся в памяти синхронные и синхронные режимы. Мы советуем использовать синхронный режим только для систем SAP HANA, расположенных в том же центре обработки данных или на расстоянии менее 100 км от него. В текущей архитектуре стеков крупных экземпляров HANA с помощью репликации системы HANA можно обеспечить высокую доступность в одном регионе. Чтобы использовать репликацию системы HANA, нужен сторонний компонент обратного прокси-сервера или маршрутизации для конфигураций аварийного восстановления в другой регион Azure. 
- **Автоматическая отработка отказа узла** — решение для локального восстановления после сбоя для SAP HANA, используемое в качестве альтернативы репликации системы HANA. Если главный узел становится недоступным, вам нужно настроить один или несколько резервных узлов SAP HANA в режиме развертывания, и SAP HANA автоматически выполнит отработку отказа на резервный узел.

SAP HANA в Azure (крупные экземпляры) предлагается в двух регионах Azure, охватывающих четыре геополитических региона (США, Австралию, Европу и Японию). Два региона в пределах геополитической области, в которых размещены стеки крупных экземпляров HANA, подключены к отдельным выделенным сетевым каналам. Эти каналы используются в процессе репликации моментальных снимков хранилища и обеспечивают методы аварийного восстановления. По умолчанию репликация не выполняется. Этот процесс настраивается в клиентах, которые заказали функциональные возможности аварийного восстановления. Репликация хранилища зависит от использования моментальных снимков хранилища для крупных экземпляров HANA. Невозможно выбрать регион Azure в качестве региона аварийного восстановления, если он находится в другой геополитической области. 

В таблице ниже приведены методы обеспечения высокого уровня доступности и аварийного восстановления и их сочетания, поддерживаемые на текущий момент.

| Сценарий, поддерживаемый крупными экземплярами HANA | Вариант обеспечения высокого уровня доступности | Вариант аварийного восстановления | Комментарии |
| --- | --- | --- | --- |
| Один узел | Недоступно. | Конфигурация выделенного аварийного восстановления,<br /> конфигурация многоцелевого аварийного восстановления. | |
| Автоматическая отработка отказа узла: масштабирование (с ожиданием и без)<br /> включая 1 + 1 | Возможно, если резервный узел становится активным.<br /> Переключением ролей управляет HANA. | Конфигурация выделенного аварийного восстановления,<br /> конфигурация многоцелевого аварийного восстановления.<br /> Синхронизация аварийного восстановления с помощью репликации хранилища. | Наборы томов HANA подключены ко всем узлам.<br /> Сайт аварийного восстановления должен иметь такое же число узлов. |
| Репликация системы HANA | Возможно в конфигурации с первичными или вторичными репликами.<br /> В случае отработки отказа вторичная реплика выполняет роль первичной.<br /> Отработку отказа контролируют служба репликации системы HANA и ОС. | Конфигурация выделенного аварийного восстановления,<br /> конфигурация многоцелевого аварийного восстановления.<br /> Синхронизация аварийного восстановления с помощью репликации хранилища.<br /> Аварийное восстановление с помощью репликации системы HANA пока еще невозможно без использования сторонних компонентов. | Отдельный набор томов дисков подключен к каждому узлу.<br /> Только тома дисков вторичной реплики на рабочем сайте реплицируются в расположение аварийного восстановления.<br /> На сайте аварийного восстановления необходим один набор томов. | 

Под конфигурацией выделенного аварийного восстановления подразумевается конфигурация, в которой единица крупного экземпляра HANA на сайте аварийного восстановления не используется для выполнения другой рабочей нагрузки или непроизводственной системы. Единица является пассивной и развертывается только при выполнении аварийной отработки отказа. Тем не менее этот вариант не является предпочтительным для многих клиентов.

См. руководство по [поддерживаемым сценариям HLI](hana-supported-scenario.md) для получения сведений об Ethernet и изучения макета хранилища для вашей архитектуры.

> [!NOTE]
> [Развертывания MCOD SAP HANA](https://launchpad.support.sap.com/#/notes/1681092) (несколько экземпляров HANA на одну единицу) в рамках сценариев с перекрытием можно использовать с методами обеспечения высокой доступности и аварийного восстановления, указанными в таблице. Исключением является использование службы репликации системы HANA с отказоустойчивым кластером с автоматическим переходом на другой ресурс на базе Pacemaker. В этом случае поддерживается только один экземпляр HANA на единицу. При развертываниях [SAP HANA MDC](https://launchpad.support.sap.com/#/notes/2096000) с несколькими клиентами подходят только методы обеспечения высокой доступности и аварийного восстановления без использования хранилища. При развертывании одного клиента подходят все перечисленные методы.  

Под конфигурацией многоцелевого аварийного восстановления подразумевается конфигурация на сайте аварийного восстановления, в которой единица крупного экземпляра HANA выполняет непроизводственную рабочую нагрузку. В случае аварии необходимо завершить работу этой непроизводственной системы, подключить реплицированные в хранилище (дополнительные) наборы томов и запустить рабочий экземпляр HANA. Большинство клиентов, использующих функции аварийного восстановления на основе крупных экземпляров HANA, применяет эту конфигурацию. 


Дополнительные сведения о высоком уровне доступности SAP HANA см. в следующих источниках о SAP: 

- [Техническая документация по высокому уровню доступности SAP HANA](https://go.sap.com/documents/2016/05/f8e5eeba-737c-0010-82c7-eda71af511fa.html)
- [Руководство по администрированию SAP HANA](https://help.sap.com/hana/SAP_HANA_Administration_Guide_en.pdf)
- [Видеокурс SAP HANA по репликации системы SAP HANA](https://scn.sap.com/community/hana-in-memory/blog/2015/05/19/sap-hana-system-replication)
- [Примечание по SAP № 1999880. Часто задаваемые вопросы о репликации системы SAP HANA](https://apps.support.sap.com/sap/support/knowledge/preview/en/1999880)
- [Примечание по SAP № 2165547. Резервное копирование и восстановление SAP HANA в среде репликации системы SAP HANA](https://websmp230.sap-ag.de/sap(bD1lbiZjPTAwMQ==)/bc/bsp/sno/ui_entry/entry.htm?param=69765F6D6F64653D3030312669765F7361706E6F7465735F6E756D6265723D3231363535343726)
- [Примечание по SAP № 1984882. Использование репликации системы SAP HANA для замены оборудования без простоя](https://websmp230.sap-ag.de/sap(bD1lbiZjPTAwMQ==)/bc/bsp/sno/ui_entry/entry.htm?param=69765F6D6F64653D3030312669765F7361706E6F7465735F6E756D6265723D3139383438383226)

## <a name="network-considerations-for-disaster-recovery-with-hana-large-instances"></a>Рекомендации по сети для аварийного восстановления с помощью крупных экземпляров HANA

Чтобы воспользоваться преимуществами аварийного восстановления крупных экземпляров HANA, потребуется спроектировать сетевое подключение к двум регионам Azure. Нужно создать канал Azure ExpressRoute с подключением между локальной средой и основным регионом Azure и еще один канал с подключением между локальной средой и регионом аварийного восстановления. Это позволит обеспечить работоспособность в случае возникновения проблемы с регионом Azure, в том числе с расположением маршрутизатора Microsoft Enterprise Edge Router (MSEE).

В качестве дополнительной меры можно подключить все виртуальные сети Azure, подключенные к SAP HANA в Azure (крупные экземпляры) в одном из регионов, к каналу ExpressRoute, который соединяет крупные экземпляры HANA в другом регионе. Благодаря такому *перекрестному подключению* службы, работающие в виртуальной сети Azure в регионе 1, могут подключаться к единицам крупных экземпляров HANA в регионе 2 и наоборот. Это позволит устранить проблемы при выходе из обслуживания одного из расположений MSEE, используемых для установки подключения между локальным расположением и Azure.

На рисунке ниже показаны варианты отказоустойчивой конфигурации аварийного восстановления:

![Оптимальная конфигурация для аварийного восстановления](./media/hana-overview-high-availability-disaster-recovery/image1-optimal-configuration.png)



## <a name="other-requirements-with-hana-large-instances-storage-replication-for-disaster-recovery"></a>Прочие требования к использованию репликации крупных экземпляров HANA при аварийном восстановлении

Ниже приведены дополнительные требования к конфигурации аварийного восстановления с помощью крупных экземпляров HANA.

- Закажите номера SKU для SAP HANA в Azure (крупные экземпляры) того же размера, что и рабочие номера SKU, и разверните их в регионе аварийного восстановления. На данный момент в клиентских развертываниях эти экземпляры используются для запуска непроизводственных экземпляров HANA. Эти конфигурации называются *конфигурациями многоцелевого аварийного восстановления*.   
- Закажите дополнительный объем хранилища на сайте аварийного восстановления для каждого номера SKU решения "SAP HANA в Azure (крупные экземпляры)", который вы хотите восстановить на сайте аварийного восстановления. Приобретение дополнительного объема позволит выделить тома хранилища. Вы сможете выделить тома, используемые при репликации хранилища из рабочего региона Azure в регион Azure аварийного восстановления.
- В случае, если вы настроили HSR на основном сайте и настраиваете репликацию на основе хранилища на сайте аварийного восстановления, необходимо приобрести дополнительную емкость хранилища на сайте аварийного восстановления, чтобы данные основных и дополнительных узлов реплицировались на этот сайт.

  **Дальнейшие действия**
- См. [Резервное копирование и восстановление](hana-backup-restore.md).













