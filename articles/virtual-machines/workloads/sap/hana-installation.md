---
title: Установка SAP HANA на сервере SAP HANA в Azure (крупные экземпляры) | Документация Майкрософт
description: Установка SAP HANA на SAP HANA в Azure (крупные экземпляры).
services: virtual-machines-linux
documentationcenter: ''
author: hermanndms
manager: juergent
editor: ''
ms.service: virtual-machines-sap
ms.topic: article
ms.tgt_pltfrm: vm-linux
ms.workload: infrastructure
ms.date: 01/16/2020
ms.author: juergent
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: 20a2639716048a8c549ec6d584e807cb209f83d9
ms.sourcegitcommit: b4647f06c0953435af3cb24baaf6d15a5a761a9c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/02/2021
ms.locfileid: "101670958"
---
# <a name="how-to-install-and-configure-sap-hana-large-instances-on-azure"></a>Как установить и настроить SAP HANA в Azure (крупные экземпляры)

Перед чтением этой статьи ознакомьтесь с [основными терминами в контексте крупных экземпляров HANA](hana-know-terms.md) и [номерами SKU крупных экземпляров HANA](hana-available-skus.md).

Вы ответственны за установку SAP HANA. Установив подключение между виртуальными сетями Azure и единицами крупных экземпляров HANA, можно приступить к установке нового SAP HANA на сервере Azure (крупные экземпляры). 

> [!Note]
> Для каждой политики SAP Установка SAP HANA должна выполняться пользователем, который прошел сертифицированный сертификационный экзамен SAP Technology, SAP HANA установки сертификационного экзамена или кто является сертифицированным системным интегратором SAP (SI).

Если вы планируете установить HANA 2.0, см. документ [SAP Support Note #2235581 — SAP HANA: Supported Operating Systems](https://launchpad.support.sap.com/#/notes/2235581/E) (Примечание по поддержке SAP №2235581. SAP HANA: поддерживаемые операционные системы), чтобы убедиться, что используемая ОС поддерживается выпуском SAP HANA, который вы собираетесь установить. В поддерживаемой ОС для HANA 2.0 больше ограничений, чем в ОС для HANA 1.0. Кроме того, необходимо проверить, не указан ли необходимый выпуск ОС для конкретной единицы ХЛИ в этом опубликованном [списке](https://www.sap.com/dmc/exp/2014-09-02-hana-hardware/enEN/iaas.html#categories=Microsoft%20Azure). Щелкните единицу, чтобы получить всю информацию с помощью списка поддерживаемых ОС этой единицы. 

Перед началом установки HANA проверьте следующее:
- [единицы HLI](#validate-the-hana-large-instance-units);
- [Конфигурация операционной системы](#operating-system)
- [Сетевая конфигурация](#networking)
- [Конфигурация хранилища](#storage)


## <a name="validate-the-hana-large-instance-units"></a>Проверка единиц крупного экземпляра HANA

Когда вы получите единицу крупного экземпляра HANA от корпорации Майкрософт, проверьте указанные ниже параметры и внесите необходимые изменения.

**Первым шагом** после получения крупного экземпляра Hana и установления доступа и подключения к экземплярам является возврат портал Azure, отображаются ли экземпляры с правильными номерами SKU и ОС. Чтение [крупных экземпляров Azure Hana с помощью портал Azure](./hana-li-portal.md) действий, необходимых для выполнения проверок.

**Второй шаг** после получения крупного экземпляра Hana и установления доступа и подключения к экземплярам — регистрация ОС экземпляра в поставщике ОС. Этот шаг также включает регистрацию операционной системы SUSE Linux в экземпляре SUSE SMT, который развернут на виртуальной машине в Azure. 

К этому экземпляру SMT может подключаться единица крупного экземпляра HANA. (Дополнительные сведения см. в статье [Настройка сервера SMT для SUSE Linux](hana-setup-smt.md)). Операционную систему Red Hat также можно зарегистрировать в диспетчере подписок Red Hat, к которому нужно подключиться. Для получения дополнительных сведений см. комментарии в [Что такое SAP HANA в Azure (большие экземпляры)?](./hana-overview-architecture.md?toc=/azure/virtual-machines/linux/toc.json). 

Этот шаг необходим для исправления операционной системы, которая является обязанностью клиента. Для SUSE на странице [установки SMT](https://www.suse.com/documentation/sles-12/book_smt/data/smt_installation.html) найдите документацию по установке и настройке SMT.

**Третий шаг** — проверка наличия новых исправлений и исправлений конкретного выпуска или версии ОС. Проверьте, что используется последняя версия крупного экземпляра HANA. Возможны варианты, которые не включают последние исправления. После получения единицы крупного экземпляра HANA проверьте, нужно ли применить исправления.

**Четвертый шаг** — извлечь соответствующие примечания SAP для установки и настройки SAP HANA в определенной версии или версии ОС. Из-за изменения рекомендаций или примечаний к заметкам SAP, а также конфигураций, которые зависят от отдельных сценариев установки, Майкрософт не всегда может обеспечить правильную настройку единицы крупного экземпляра HANA. 

Вы как клиент должны обязательно ознакомиться с примечаниями к SAP, относящимися к SAP HANA в вашем выпуске Linux. Проверьте настройки выпуска или версии операционной системы и примените параметры конфигурации, если это еще не сделано.

Проверьте приведенные ниже параметры и измените их значения на следующие:

- net.core.rmem_max = 16777216;
- net.core.wmem_max = 16777216;
- net.core.rmem_default = 16777216;
- net.core.wmem_default = 16777216;
- net.core.optmem_max = 16777216;
- net.ipv4.tcp_rmem = 65536 16777216 16777216;
- net.ipv4.tcp_wmem = 65536 16777216 16777216.

Начиная с SLES 12 с пакетом обновления 1 (SP1) и RHEL 7.2, эти параметры необходимо определить в файле конфигурации в каталоге /etc/sysctl.d. Например, в этом каталоге должен находиться файл конфигурации с именем 91-NetApp-HANA.conf. В предыдущих выпусках SLES и RHEL эти параметры необходимо задать в файле /etc/sysctl.conf.

Для всех выпусков RHEL, начиная с версии RHEL 6,3, учитывайте следующее. 
- параметр sunrpc.tcp_slot_table_entries = 128 необходимо задать в файле in/etc/modprobe.d/sunrpc-local.conf. Если файл не существует, его необходимо сначала создать, добавив запись: 
    - options sunrpc tcp_max_slot_table_entries=128.

**Пятый шаг** — Проверка системного времени для единицы крупного экземпляра Hana. Экземпляры развертываются с помощью часового пояса. Этот часовой пояс — это расположение региона Azure, в котором расположен стек крупных экземпляров HANA. Системное время и часовой пояс экземпляров можно изменить. 

При добавлении новых экземпляров к клиенту необходимо соответствующим образом изменить их часовой пояс. Ресурсы Майкрософт не имеют доступ к сведениям о настройке часового пояса системы в экземплярах после передачи их в эксплуатацию. Поэтому часовой пояс новых экземпляров может отличаться от установленного вами. В результате вы как клиент должны проверить и при необходимости изменить часовой пояс полученных экземпляров. 

**Шестой шаг** — проверка и т. д. После передачи в колонках для разных целей назначены отдельные IP-адреса. Проверьте файл/etc/hosts. При добавлении единиц к существующему клиенту в файле etc/hosts новых систем могут быть неправильно настроены IP-адреса предыдущих систем. Вы как пользователь обязаны проверить правильность конфигурации. Это позволит новым экземплярам взаимодействовать с ранее развернутыми единицами в клиенте и разрешать их имена. 


## <a name="operating-system"></a>Операционная система

Для области буфера доставленного образа ОС выделено 2 ГБ в соответствии с документом [SAP Support Note #1999997 — FAQ: SAP HANA Memory](https://launchpad.support.sap.com/#/notes/1999997/E) (Примечание по поддержке SAP №1999997. Часто задаваемые вопросы: память SAP HANA). В качестве клиента необходимо самостоятельно задать требуемый параметр.

Для SAP HANA в Azure (большие экземпляры) используется дистрибутив [SUSE Linux Enterprise Server 12 SP1 для приложений SAP](https://www.suse.com/products/sles-for-sap/download/). Этот дистрибутив предоставляет все необходимые для SAP функции без дополнительной настройки (в том числе предварительно настроенные параметры для эффективного запуска SAP на сервере SLES).

В разделе [библиотеки ресурсов и технической документации](https://www.suse.com/products/sles-for-sap/resource-library#white-papers) на веб-сайте SUSE и на [странице SAP для SUSE](https://wiki.scn.sap.com/wiki/display/ATopics/SAP+on+SUSE) в сетевом сообществе SAP (SCN) доступно несколько полезных ресурсов, в которых описывается развертывание SAP HANA на SLES (в том числе настройки высокой доступности, методы обеспечения безопасности для работы SAP и многое другое).

Дополнительные сведения и полезные ссылки по SAP в SUSE см. ниже.

- [SAP HANA на сайте SUSE Linux](https://wiki.scn.sap.com/wiki/display/ATopics/SAP+on+SUSE).
- [Best Practice for SAP: Enqueue Replication — SAP NetWeaver on SUSE Linux Enterprise 12](https://www.suse.com/media/guide/SLES4SAP-NetWeaver-ha-guide-EnqRepl-12_color_en.pdf) (Рекомендации по SAP. Постановка репликации в очередь — SAP NetWeaver в SUSE Linux Enterprise 12).
- [ClamSAP — SLES Virus Protection for SAP](https://scn.sap.com/community/linux/blog/2014/04/14/clamsap--suse-linux-enterprise-server-integrates-virus-protection-for-sap) (ClamSAP — защита от вирусов на сервере SLES для SAP) (включая SLES 12 для приложений SAP).

Примечания по поддержке SAP, применимые к реализации SAP HANA на SLES 12, см. ниже.

- [SAP Support Note #1944799 — SAP HANA Guidelines for SLES Operating System Installation](http://service.sap.com/sap/support/notes/1944799) (Примечание по поддержке SAP №1944799. Рекомендации по установке SAP HANA в ОС SLES).
- [SAP Support Note #2205917 — SAP HANA DB Recommended OS Settings for SLES 12 for SAP Applications](https://launchpad.support.sap.com/#/notes/2205917/E) (Примечание по поддержке SAP №2205917. База данных SAP HANA: рекомендуемые параметры ОС для SLES 12 для приложений SAP).
- [SAP Support Note #1984787 — SUSE Linux Enterprise Server 12: Installation Notes](https://launchpad.support.sap.com/#/notes/1984787) (Примечание по поддержке SAP №1984787. Заметки об установке SUSE Linux Enterprise Server 12).
- [SAP Support Note #171356 — SAP Software on Linux: General Information](https://launchpad.support.sap.com/#/notes/1984787) (Примечание по поддержке SAP №171356. Общие сведения о ПО SAP на платформе Linux).
- [Примечание о поддержке SAP #1391070 — решения UUID Linux](https://launchpad.support.sap.com/#/notes/1391070)

[Red Hat Enterprise Linux для SAP HANA](https://www.redhat.com/en/resources/red-hat-enterprise-linux-sap-hana) — еще одно решение для запуска SAP HANA на крупных экземплярах HANA. Выпуски RHEL 7,2 и 7,3 доступны и поддерживаются. 

Дополнительные сведения и полезные ссылки по SAP в Red Hat приведены ниже.
- [Сайт SAP HANA в Red Hat Linux](https://wiki.scn.sap.com/wiki/display/ATopics/SAP+on+Red+Hat).

Примечания по поддержке SAP, применимые к реализации SAP HANA на SLES 12, приведены ниже.

- [Примечание о поддержке SAP #2009879-SAP HANA рекомендации по использованию операционной системы Red Hat Enterprise Linux (RHEL)](https://launchpad.support.sap.com/#/notes/2009879/E)
- [SAP Support Note #2292690 — SAP HANA DB: Recommended OS settings for RHEL 7](https://launchpad.support.sap.com/#/notes/2292690) (Примечание по поддержке SAP №2292690. База данных SAP HANA: рекомендуемые параметры операционной системы для RHEL 7).
- [Примечание о поддержке SAP #1391070 — решения UUID Linux](https://launchpad.support.sap.com/#/notes/1391070)
- [SAP Support Note #2228351 — Linux: SAP HANA Database SPS 11 revision 110 (or higher) on RHEL 6 or SLES 11](https://launchpad.support.sap.com/#/notes/2228351) (Примечание по поддержке SAP №2228351. Linux: база данных SAP HANA SPS 11, редакция 110 (или более поздняя), в RHEL 6 или SLES 11).
- [SAP Support Note #2397039 — FAQ: SAP on RHEL](https://launchpad.support.sap.com/#/notes/2397039) (Примечание по поддержке SAP №2397039. Часто задаваемые вопросы: SAP в RHEL).
- [SAP Support Note #2002167 — Red Hat Enterprise Linux 7.x: Installation and Upgrade](https://launchpad.support.sap.com/#/notes/2002167) (Примечание по поддержке SAP №1496410. Установка и обновление Red Hat Enterprise Linux 7.x).

### <a name="time-synchronization"></a>Синхронизация времени

Приложения SAP, построенные на основе архитектуры SAP NetWeaver, чувствительны к разнице системного времени на разных компонентах, образующих систему SAP. Короткие дампы SAP ABAP с ошибкой, озаглавленной ZDATE\_LARGE\_TIME\_DIFF, похожи. Это связано с тем, что эти короткие дампы появляются, когда системное время разных серверов или виртуальных машинах существенно различается.

Для SAP HANA в Azure (крупные экземпляры) синхронизация времени в Azure не применяется к единицам вычисления в стеках больших экземпляров. Эта синхронизация не относится к приложениям SAP, выполняемым на виртуальных машинах Azure, так как Azure гарантирует правильную синхронизацию времени системы. 

В результате потребуется отдельный сервер времени, который будут использовать серверы приложений SAP, работающие на виртуальных машинах Azure, и экземпляры баз данных SAP HANA, работающие на HANA (крупные экземпляры). Для инфраструктуры хранения в стеках крупных экземпляров время синхронизируется с серверами NTP.


## <a name="networking"></a>Сеть
В этом разделе предполагается, что вы следовали рекомендациям по проектированию виртуальных сетей Azure и их подключению к крупным экземплярам HANA, приведенным в следующих документах:

- [Обзор и архитектура SAP HANA (крупные экземпляры) в Azure](./hana-overview-architecture.md)
- [Инфраструктура и возможности подключения SAP HANA (крупные экземпляры) в Azure](hana-overview-infrastructure-connectivity.md)

При проектировании сети отдельной единицы следует учитывать некоторые моменты. Каждой единице крупного экземпляра HANA выделяется два или три IP-адреса, которые назначаются соответствующему числу портов сетевого адаптера. Три IP-адреса используются в масштабируемых конфигурациях HANA или в сценарии репликации системы HANA. Один из IP-адресов, назначенных сетевому адаптеру единицы, выделяется из диапазона серверного пула IP-адресов. Дополнительные сведения см. в статье [Обзор и описание архитектуры SAP HANA в Azure (крупные экземпляры)](./hana-overview-architecture.md).

Дополнительные сведения о Ethernet по архитектуре см. в разделе [Поддерживаемые сценарии для крупных экземпляров HANA](hana-supported-scenario.md).

## <a name="storage"></a>Память

Структура хранилища для SAP HANA в Azure (крупные экземпляры) настраивается SAP HANA в Azure с `service management` помощью рекомендуемых правил SAP. Рекомендации описаны в техническом документе с описанием [требований к хранилищу SAP HANA](https://go.sap.com/documents/2015/03/74cdb554-5a7c-0010-82c7-eda71af511fa.html). 

Приблизительные размеры разных томов с различными SKU крупных экземпляров HANA задокументированы в статье [Что такое SAP HANA в Azure (большие экземпляры)?](hana-overview-architecture.md).

Соглашения об именовании томов хранилища перечислены в следующей таблице.

| Использование хранилища | Имя подключения | Имя тома | 
| --- | --- | ---|
| Данные HANA | /hana/data/SID/mnt0000\<m> | IP хранилища: /hana_data_SID_mnt00001_tenant_vol |
| Журнал HANA | /hana/log/SID/mnt0000\<m> | IP хранилища: /hana_log_SID_mnt00001_tenant_vol |
| Резервная копия журнала HANA | /hana/log/backups | IP хранилища: /hana_log_backups_SID_mnt00001_tenant_vol |
| Общий HANA | /hana/shared/SID | IP хранилища: /hana_shared_SID_mnt00001_tenant_vol/shared |
| usr/sap | /usr/sap/SID | IP хранилища: /hana_shared_SID_mnt00001_tenant_vol/usr_sap |

*SID* — это системный идентификатор экземпляра HANA. 

*Tenant* — это внутреннее перечисление операций при развертывании клиента.

HANA usr/sap предоставляет общий доступ к тому. В спецификацию точек подключения входит системный идентификатор экземпляров HANA, а также номер подключения. В масштабируемых развертываниях существует только одно подключение, например, mnt00001. В масштабируемом развертывании будет отображаться столько подключений, сколько рабочих и главных узлов находится в вашем распоряжении. 

В масштабируемой среде данные, журнал, тома журнала резервного копирования являются общими и присоединяются к каждому узлу в масштабируемой конфигурации. Для конфигураций с несколькими экземплярами SAP создается другой набор томов, который присоединяется к единице крупного экземпляра HAN. См. статью [Поддерживаемые сценарии для крупных экземпляров HANA](hana-supported-scenario.md) для изучения конфигурации хранилища для вашего сценария.

После ознакомления с этим документом и оценки единицы крупного экземпляра HANA вы поймете, что эти единицы имеют крупный том диска HANA/data, а также наличие тома HANA/log/backup. Причина, почему мы выделили больше места для HANA/data, заключается в том, что на этот том диска также сохраняются моментальные снимки, созданные с помощью предоставленной нами функции. Чем больше моментальных снимков вы сделали, тем больше требуется пространства. 

Том HANA/log/backup не используется как том для хранения резервных копий базы данных. Его размер походит для использования в качестве архивного тома для резервных копий журнала транзакций HANA. Дополнительные сведения см. в статье [Высокий уровень доступности и аварийное восстановление SAP HANA в Azure (крупные экземпляры)](hana-overview-high-availability-disaster-recovery.md). 

Кроме предоставленного хранилища можно приобрести дополнительную емкость хранилища с шагом приращения 1 ТБ. Это дополнительное хранилище добавляется к HANA (крупные экземпляры) как новые тома.

Во время адаптации с SAP HANA в Azure `service management` клиент указывает идентификатор пользователя (UID) и идентификатор группы (GID) для пользователя sidadm и группы sapsys (например: 1 000 500). Во время установки системы SAP HANA необходимо использовать эти же значения. Так как вы хотите развернуть несколько экземпляров HANA, вы получите несколько наборов томов (один набор для каждого экземпляра). В результате во время развертывания необходимо определить следующие моменты:

- Идентификатор SID разных экземпляров HANA (на его основе получается sidadm).
- Объемы памяти разных экземпляров HANA. Объем памяти каждого экземпляра определяет размер тома в каждом отдельном наборе томов.

Согласно рекомендациям поставщика хранилища для всех подключенных томов настраиваются следующие параметры подключения (кроме LUN загрузки):

- nfs    rw, vers=4, hard, timeo=600, rsize=1048576, wsize=1048576, intr, noatime, lock 0 0

Эти точки подключения настраиваются в /etc/fstab, как показано на следующих снимках экрана.

![fstab подключенных томов в единице крупного экземпляра HANA](./media/hana-installation/image1_fstab.PNG)

Выходные данные команды df -h в единице крупного экземпляра S72m HANA выглядят следующим образом.

![На снимке экрана показаны выходные данные команды для единицы крупных экземпляров HANA.](./media/hana-installation/image2_df_output.PNG)


Контроллер хранилища и узлы в стеках больших экземпляров синхронизируются с NTP-серверами. Если выполняется синхронизация с NTP-сервером для единиц SAP HANA в Azure (крупные экземпляры) и виртуальных машин Azure, не должно быть заметного смещения времени между инфраструктурой и единицами вычислений в Azure или стеками крупных экземпляров.

Чтобы оптимизировать хранилище, используемое SAP HANA, необходимо задать следующие параметры конфигурации:

- max_parallel_io_requests 128;
- async_read_submit on;
- async_write_submit_active on;
- async_write_submit_blocks all.
 
Начиная с версии SAP HANA 1.0 и до SPS 12, эти параметры можно указать во время установки базы данных SAP HANA, как описано в [примечании к SAP 2267798](https://launchpad.support.sap.com/#/notes/2267798).

С помощью средства hdbparam можно настроить эти параметры после установки базы данных SAP HANA. 

Хранилище, используемое в крупных экземплярах HANA, имеет ограничение на размер файла. [Ограничение по размеру составляет 16 ТБ](https://docs.netapp.com/ontap-9/index.jsp?topic=%2Fcom.netapp.doc.dot-cm-vsmg%2FGUID-AA1419CF-50AB-41FF-A73C-C401741C847C.html) на файл. В отличие от ограничений на размер файлов в файловых системах EXT3, HANA не учитывает неявное ограничение хранилища, принудительно используемое хранилищем крупных экземпляров HANA. В результате HANA не будет автоматически создавать новый файл данных при достижении предельного размера файла 16TB. Так как HANA пытается увеличить размер файла за пределами 16 ТБ, HANA сообщит об ошибках, и сервер индекса завершится сбоем в конце.

> [!IMPORTANT]
> Чтобы предотвратить попытку HANA расширить файлы данных по сравнению с ограничением размера файлов размером в 16 ТБ хранилища крупных экземпляров HANA, необходимо задать следующие параметры в файле конфигурации SAP HANA global.ini
> 
> - datavolume_striping = true
> - datavolume_striping_size_gb = 15000
> - См. также Примечание SAP [#2400005](https://launchpad.support.sap.com/#/notes/2400005)
> - Помните о заметке SAP [#2631285](https://launchpad.support.sap.com/#/notes/2631285)


Это средство не поддерживается в системе SAP HANA 2.0. В таком случае эти параметры необходимо задать, используя команды SQL. Дополнительные сведения см. в [примечании к SAP 2399079 об устранении hdbparam в HANA 2.0](https://launchpad.support.sap.com/#/notes/2399079).

Для изучения макета хранилища вашей архитектуры см. статью [Поддерживаемые сценарии для крупных экземпляров HANA](hana-supported-scenario.md).


**Дальнейшие действия**

- См. статью [Пример установки SAP HANA на крупных экземплярах HANA](hana-example-installation.md).










































 







 
