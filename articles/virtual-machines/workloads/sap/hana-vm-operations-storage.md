---
title: Конфигурации хранилища виртуальных машин SAP HANA в Azure | Документация Майкрософт
description: Рекомендации по хранению виртуальной машины, в которой развернут SAP HANA.
services: virtual-machines-linux,virtual-machines-windows
documentationcenter: ''
author: msjuergent
manager: bburns
editor: ''
tags: azure-resource-manager
keywords: SAP, Azure HANA, хранилище Ultra Disk, хранилище класса Premium
ms.service: virtual-machines-sap
ms.topic: article
ms.tgt_pltfrm: vm-linux
ms.workload: infrastructure
ms.date: 02/03/2021
ms.author: juergent
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: 0c0fbb1280fc2a7eaca1d97e7e016cf480873c8b
ms.sourcegitcommit: b4647f06c0953435af3cb24baaf6d15a5a761a9c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/02/2021
ms.locfileid: "101666591"
---
# <a name="sap-hana-azure-virtual-machine-storage-configurations"></a>Конфигурации хранилища виртуальных машин SAP HANA в Azure

Azure предоставляет различные типы хранилища, подходящие для виртуальных машин Azure, работающих под управлением SAP HANA. **Сертифицированные SAP HANA типы хранилищ**, которые можно рассматривать для списка развертываний SAP HANA, например: 

- SSD Azure Premium или хранилище класса Premium 
- [Диск (цен. категория "Ультра")](../../disks-enable-ultra-ssd.md)
- [Azure NetApp Files](https://azure.microsoft.com/services/netapp/) 

Дополнительные сведения об этих типах дисков см. в статье [типы хранилища Azure для рабочей нагрузки SAP](./planning-guide-storage.md) и [Выбор типа диска](../../disks-types.md) .

Azure предлагает два метода развертывания для виртуальных жестких дисков в хранилище Azure уровня "Стандартный" и "Премиум". Мы планируем использовать преимущества [управляемого диска Azure](https://azure.microsoft.com/services/managed-disks/) для развертывания блочного хранилища Azure. 

Список типов хранилища и их соглашения об уровне обслуживания в отношении операций ввода-вывода в секунду (IOPS) и пропускной способности хранилища см. на странице [Цены на управляемые диски](https://azure.microsoft.com/pricing/details/managed-disks/).

> [!IMPORTANT]
> Вне зависимости от выбранного типа хранилища Azure, файловая система, используемая в этом хранилище, должна поддерживаться SAP для конкретной операционной системы и СУБД. [Примечание о поддержке SAP #2972496](https://launchpad.support.sap.com/#/notes/2972496) список поддерживаемых файловых систем для различных операционных систем и баз данных, включая SAP HANA. Это относится ко всем томам, к которым SAP HANA может получать доступ для чтения и записи, для любой задачи. В частности, при использовании NFS в Azure для SAP HANA дополнительные ограничения версий NFS будут применяться, как указано далее в этой статье. 


Далее представлены минимальные сертифицированные SAP HANA условия для разных типов хранилищ. 

- Хранилище Azure класса Premium — **/Hana/log** должно поддерживаться Azure [ускоритель записи](../../how-to-enable-write-accelerator.md). Том **/Hana/Data** можно разместить в хранилище класса premium без ускоритель записи Azure или на Ultra Disk.
- Azure Ultra Disk по крайней мере для тома **/Hana/log** . Том **/Hana/Data** можно разместить в хранилище класса premium без ускоритель записи Azure или для ускорения перезапуска с помощью Ultra Disk.
- Тома **NFS версии 4.1** поверх Azure NetApp Files для **/Hana/log и/Hana/Data**. Объем/Hana/Shared может использовать протокол NFS v3 или NFS v 4.1.

Некоторые типы хранилищ можно объединять. Например, можно поместить **/Hana/Data** в хранилище уровня "Премиум", а **/Hana/log** — на хранилище Ultra Disk, чтобы получить необходимую низкую задержку. Если вы используете том на основе использовании для **/Hana/Data**,  **/Hana/log** том должен быть основан на NFS поверх использовании. Использование NFS поверх использовании для одного из томов (например,/Hana/Data) и хранилища Azure класса Premium или Ultra Disk для другого тома (например, **/Hana/log**) **не поддерживается**.

До сего дня вам не нужно было беспокоиться о подсистемах ввода-вывода и их возможностях. Это связано с тем, что поставщику оборудования необходимо было убедиться в том, что для SAP HANA соблюдены минимальные требования к хранению. При самостоятельном создании инфраструктуры Azure вам следует знать некоторые из этих требований. Ниже перечислены некоторые из минимальных характеристик пропускной способности, которые рекомендует SAP.

- Чтение и запись в **/Hana/log** от 250 МБ/с с размером операций ввода-вывода 1 МБ
- Операция чтения не менее 400 МБ/с для **/Hana/Data** для размера операций ввода-вывода 16 мб и 64 МБ
- Действие записи не менее 250 МБ/с для **/Hana/Data** с размером 16 мб и 64 МБ операций ввода-вывода

Так как небольшая задержка хранилища для систем СУБД является критической, даже такие системы, как SAP HANA, хранят данные в памяти. Критический путь в хранилище обычно находится рядом с записями журналов транзакций систем СУБД. Кроме того, такие операции, как запись точек сохранения или загрузка данных в памяти после восстановления из-за сбоя, могут быть критическими. Поэтому **обязательно** используйте хранилище Azure класса Premium, Ultra Disk или использовании для томов **/Hana/Data** и **/Hana/log** . 


Некоторые принципы выбора конфигурации хранилища для HANA можно указать следующим образом:

- Выбор типа хранилища на основе [типов хранилища Azure для рабочей нагрузки SAP](./planning-guide-storage.md) и [выбора типа диска](../../disks-types.md)
- Общая пропускная способность операций ввода-вывода виртуальной машины, а также ограничения операций чтения и изменений при определении размера виртуальной машины. Общая пропускная способность хранилища виртуальных машин описана в статье [размеры виртуальных машин, оптимизированных для памяти](../../sizes-memory.md)
- При принятии решения о конфигурации хранилища попробуйте использовать конфигурацию тома **/Hana/Data** ниже общей пропускной способности виртуальной машины. Создавая точки сохранения, SAP HANA могут быть агрессивно выдавать операции ввода-вывода. При написании точки сохранения можно легко передавать ограничения на пропускную способность тома **/Hana/Data** . Если ваши диски, которые создают том **/Hana/Data** , имеют более высокую пропускную способность, чем позволяет виртуальная машина, можно столкнуться с ситуациями, когда пропускная способность, используемая записью точки сохранения, мешает пропускной способности записи журнала повторов. Ситуация, которая может повлиять на пропускную способность приложения


> [!IMPORTANT]
> Рекомендации для конфигураций хранилища предназначены для начинающих. Выполнение рабочей нагрузки и анализ закономерностей использования хранилища, возможно, вы понимаете, что вы не используете всю пропускную способность хранилища или операции ввода-вывода. Вы можете рассмотреть возможность уменьшении в хранилище. Или, напротив, для рабочей нагрузки может потребоваться больше пропускной способности хранилища, чем предложено для этих конфигураций. В результате может потребоваться развернуть больше емкости, операций ввода-вывода или пропускной способности. В поле натяжение между требуемой емкостью хранилища, требуемой задержкой хранилища, пропускной способностью хранилища и объемом операций ввода-вывода в секунду и минимальной настройкой Azure предлагает достаточно различных типов хранения с разными возможностями и разными ценами, чтобы найти и скорректировать подходящую угрозу для вас и вашей рабочей нагрузки HANA.


## <a name="stripe-sets-versus-sap-hana-data-volume-partitioning"></a>Чередующиеся наборы и секционирование томов данных SAP HANA
Использование хранилища Azure класса Premium может привести к наилучшему соотношения цены и производительности при чередующихся томах **/Hana/Data** и **/Hana/log** на нескольких дисках Azure. Вместо развертывания больших томов диска, которые обеспечивают больше операций ввода-вывода или пропускной способности. До сих пор это было выполнено с помощью LVM и MDADM Volume Managers, которые входят в состав Linux. Метод чередования дисков состоит из десятилетий старого и хорошо известного. Так как эти чередующиеся тома могут потребовать выполнения операций ввода-вывода или пропускной способности, это увеличивает сложность управления чередующимися томами. Особенно в случаях, когда томам необходимо получить расширенные возможности. По крайней мере для **/Hana/Data** в SAP появился альтернативный метод, который обеспечивает ту же цель, что и чередование на нескольких дисках Azure. Начиная с SAP HANA 2,0 SPS03, индекссервер HANA может выполнять чередование операций ввода-вывода в несколько файлов данных HANA, расположенных на разных дисках Azure. Преимущество заключается в том, что вам не нужно создавать чередующиеся тома и управлять ими на разных дисках Azure. SAP HANA функциональные возможности секционирования тома данных подробно описаны в следующих разделах:

- [Руководством администратора HANA](https://help.sap.com/viewer/6b94445c94ae495c83a19646e7c3fd56/2.0.05/en-US/40b2b2a880ec4df7bac16eae3daef756.html?q=hana%20data%20volume%20partitioning)
- [Блог о SAP HANA — секционирование томов данных](https://blogs.sap.com/2020/10/07/sap-hana-partitioning-data-volumes/)
- [Примечание SAP #2400005](https://launchpad.support.sap.com/#/notes/2400005)
- [Примечание SAP #2700123](https://launchpad.support.sap.com/#/notes/2700123)

При чтении подробных сведений очевидно, что использование этой функции не требует сложности чередующихся наборов на основе Volume Manager. Вы также понимаете, что секционирование томов данных HANA работает не только для блочного хранилища Azure, например для хранилища Azure класса Premium. Эту функцию также можно использовать для чередования между общими папками NFS, если эти общие ресурсы имеют ограничения операций ввода-вывода или пропускной способности.  


## <a name="linux-io-scheduler-mode"></a>Режим планировщика операций ввода–вывода для Linux
Linux имеет несколько разных режимов планирования операций ввода-вывода. Распространенная рекомендация по поставщикам Linux и SAP заключается в перенастройке режима планировщика ввода-вывода для томов дисков из режима **MQ-крайни** или **кибер** в режим "вне очереди" или " **нет** " для (нескольких очередей **), если** он еще не выполнялся профилями саптуне SLES. Ссылки на подробные сведения приведены в: 

- [Примечание SAP #1984787](https://launchpad.support.sap.com/#/notes/1984787)
- [Примечание SAP #2578899](https://launchpad.support.sap.com/#/notes/2578899) 
- [Ошибка с параметром NOOP в SLES 12 SP4](https://www.suse.com/support/kb/doc/?id=000019547)

На Red Hat оставьте параметры в соответствии с конкретными настройками профилей для различных приложений SAP.


## <a name="solutions-with-premium-storage-and-azure-write-accelerator-for-azure-m-series-virtual-machines"></a>Решения с хранилищем класса Premium и Ускоритель записи Azure для виртуальных машин Azure серии M
Ускоритель записи Azure — это функция, которая предназначена исключительно для виртуальных машин Azure серии M. Как указано в имени, целью функциональности является повышение задержки операций ввода-вывода при записи в хранилище Azure класса Premium. В SAP HANA ускоритель записи нужно использовать только для тома **/hana/log**. Таким образом, **/hana/data** и **/hana/log** являются отдельными томами, а ускоритель записи поддерживает только том **/hana/log**. 

> [!IMPORTANT]
> При использовании хранилища Azure класса Premium использование [ускоритель записи](../../how-to-enable-write-accelerator.md) Azure для тома **/Hana/log** является обязательным. Ускоритель записи доступен только для хранилищ уровня "Премиум" и "серия M" и Mv2-Series виртуальных машин. Ускоритель записи не работает в сочетании с другими семействами виртуальных машин Azure, например Esv3 или Edsv4.

Рекомендации по кэшированию для дисков Azure уровня "Премиум" приведены в описании характеристик ввода-вывода для SAP HANA следующего списка:

- Практически отсутствует рабочая нагрузка чтения файлов данных HANA. Исключениями являются большие по размеру операции ввода-вывода после перезапуска экземпляра HANA или когда данные загружаются в HANA. Еще одним случаем большего размера операций чтения файлов данных является резервное копирование базы данных HANA. В этом случае кэширование чтения практически не имеет смысла, поскольку в большинстве случаев все тома файлов данных необходимо считать полностью. 
- Запись в файлы данных возникает скачкообразно в связи с созданием точек сохранения HANA и восстановления после сбоя. Запись точек сохранения выполняется асинхронно и не задерживает выполнение пользовательских транзакций. При записи данных во время восстановления после сбоя производительность является критически важной, поскольку необходимо восстановить работу системы как можно быстрее. Однако восстановление после сбоя происходит только в исключительных ситуациях
- Вряд ли возникнут другие ситуации, когда понадобится чтение из файлов повторяемых операций HANA. Исключениями являются большие операции ввода-вывода при выполнении резервных копий журналов транзакций, восстановления после сбоя или во время перезапуска экземпляра HANA.  
- Основной нагрузкой на файл журнала повторяемых операций SAP HANA являются операции записи. В зависимости от характера рабочей нагрузки можно иметь операции ввода-вывода размером 4 КБ, тогда как в других случаях размер может превышать 1 МБ. Задержки записи для журнала повторяемых операций SAP HANA являются критическими для производительности.
- Все операции записи необходимо сохранить на диске надежным образом

**Рекомендация. в результате этих наблюдаемых шаблонов ввода-вывода SAP HANA, кэширование для различных томов с использованием хранилища Azure класса Premium должно быть установлено следующим образом:**

- **/Hana/Data** -без кэширования или кэширования чтения
- **/Hana/log** -без кэширования — исключение для виртуальных машин M и Mv2-Series, где необходимо включить ускоритель записи Azure 
- **/hana/shared** — кэширование чтения.
- **Диск ОС** — не изменять кэширование по умолчанию, которое задается Azure во время создания виртуальной машины.


Если вы используете LVM или mdadm для создания чередующихся наборов на нескольких дисках Azure уровня "Премиум", необходимо определить размеры чередования. Эти размеры отличаются между **/Hana/Data** и **/Hana/log**. **Рекомендация: в качестве размеров чередования рекомендуется использовать:**

- 256 КБ для **/hana/data**
- 64 КБ для **/Hana/log**

> [!NOTE]
> Размер блока чередования для **/Hana/Data** был изменен с предыдущих рекомендаций для 64 кб или 128 кб до 256 КБ на основе пользовательских интерфейсов с более поздними версиями Linux. Размер 256 КБ обеспечивает немного более высокую производительность. Мы также изменили рекомендации по размерам чередующихся размеров **/Hana/log** с 32 кб по 64 КБ, чтобы получить достаточно пропускную способность с большими размерами операций ввода-вывода.

> [!NOTE]
> Вам не нужно настраивать уровень избыточности с помощью томов RAID, так как хранилище блоков Azure сохраняет три образа виртуального жесткого диска. Использование чередующегося набора с дисками Azure уровня "Премиум" полностью заключается в настройке томов, обеспечивающих достаточную пропускную способность операций ввода-вывода и (или) операций ввода/вывода.

Накопление ряда виртуальных жестких дисков Azure под чередующимися наборами является совокупностью операций ввода-вывода и пропускной способности хранилища. Таким образом, если вы поместили чередующийся набор на более чем 3 диска хранилища Azure класса Premium P30, он должен дать три раза больше операций ввода-вывода и в три раза больше пропускной способности хранилища для одного диска P30 хранилища Azure класса Premium.

> [!IMPORTANT]
> Если вы используете LVM или mdadm в качестве диспетчера томов для создания чередующихся наборов на нескольких дисках Azure уровня "Премиум", три SAP HANA файловых групп/Дата,/log и/Shared не должны размещаться в группе томов по умолчанию или в корневом каталоге. Настоятельно рекомендуется следовать рекомендациям для поставщиков Linux, которые обычно создают отдельные группы томов для /data, /log и /shared.


### <a name="azure-burst-functionality-for-premium-storage"></a>Функция ускорения Azure для хранилища класса Premium
Для дисков хранилища Azure класса Premium, которые меньше или равны 512 гиб, предлагается Пакетная функциональность. Точный способ работы с пакетной обработкой дисков описан в статье об [ускоренном](../../disk-bursting.md)использовании диска. Когда вы прочитаете статью, вы понимаете концепцию начисления операций ввода-вывода и пропускной способности в то время, когда Рабочая нагрузка ввода и ввода превышает номинальную пропускную способность дисков (для получения дополнительных сведений о номинальной пропускной способности см. [цены на управляемые диски](https://azure.microsoft.com/pricing/details/managed-disks/)). Вы собираетесь начислять разность операций ввода-вывода в секунду и пропускную способность между текущим использованием и номинальными значениями диска. Максимальное число пакетов ограничено 30 минутами.

В идеале, в котором можно планировать эту функцию, скорее всего, будут тома или диски, содержащие файлы данных для разных СУБД. Ожидаемая рабочая нагрузка ввода-вывода для этих томов, особенно с системами с небольшим и средним диапазоном, должна выглядеть следующим образом:

- Низкая и средняя Рабочая нагрузка чтения, так как в идеале данные кэшируются в памяти, или, как и в случае с HANA, должны полностью находиться в памяти
- Пакеты записи, активируемые контрольными точками базы данных или точки сохранения, которые выдаются регулярно
- Рабочая нагрузка резервного копирования, считывающая данные в непрерывном потоке в случаях, когда резервное копирование не выполняется с помощью моментальных снимков хранилища
- Загрузка данных в память после перезапуска экземпляра SAP HANA

Особенно для систем с меньшими СУБД, в которых Рабочая нагрузка обрабатывает не более сотни транзакций в секунду, такой режим работы может также иметь смысл для дисков или томов, в которых хранятся транзакции или журналы повторов. Ожидаемая рабочая нагрузка на таких дисках или томах выглядит следующим образом:

- Обычная запись на диск, зависящая от рабочей нагрузки, и природа рабочей нагрузки, так как каждая фиксация, выданная приложением, может активировать операцию ввода-вывода.
- Повышение пропускной способности в случае рабочих задач, таких как создание или перестроение индексов
- Пакеты чтения при выполнении журналов транзакций или резервных копий журналов повторов


### <a name="production-recommended-storage-solution-based-on-azure-premium-storage"></a>Рекомендуемое рабочее решение для хранения данных на основе хранилища Azure класса Premium

> [!IMPORTANT]
> Сертификация SAP HANA для виртуальных машин Azure серии M предоставлена исключительно для конфигурации, где ускоритель записи Azure используется только для тома **/hana/log**. В результате ожидается, что в развертываниях производственного сценария SAP HANA на виртуальных машинах Azure серии M ускоритель записи Azure будет настроен для тома **/hana/log**.  

> [!NOTE]
> В сценариях, использующих хранилище Azure класса Premium, мы реализуем функции ускорения в конфигурации. Так как вы используете инструменты тестирования хранилища любой формы или формы, не забывайте о том, как [работает функция ускорения работы с дисками Azure класса Premium](../../disk-bursting.md) . При выполнении тестов хранилища, доставляемых с помощью средства SAP ХВККТ или ХКМТ, мы не ожидаем, что все тесты будут удовлетворять критериям, так как некоторые тесты будут превысить количество кредитов, которые можно накапливать. Особенно если все тесты выполняются последовательно без прерывания.


> [!NOTE]
> Для рабочих сред проверьте [в документации SAP для IAAS](https://www.sap.com/dmc/exp/2014-09-02-hana-hardware/enEN/iaas.html), поддерживает ли SAP определенный тип виртуальной машины для SAP HANA.

**Рекомендация. Рекомендуемые конфигурации хранилища Azure класса Premium для рабочих сценариев выглядят следующим образом:**

Конфигурация для тома SAP **/Hana/Data** :

| SKU виртуальной машины | ОЗУ | Макс. пропускная способность<br /> Пропускная способность | hana/data; | Подготовленная пропускная способность | Максимальная пропускная способность | Количество операций ввода-вывода в секунду | Ускоренные операции ввода-вывода |
| --- | --- | --- | --- | --- | --- | --- | 
| M32ts | 192 ГиБ | 500 Мбит/с | 4 x P6 | 200 Мбит/с | 680 Мбит/с | 960 | 14 000 |
| M32ls | 256 Гиб | 500 Мбит/с | 4 x P6 | 200 Мбит/с | 680 Мбит/с | 960 | 14 000 |
| M64ls | 512 ГБ | 1000 Мбит/с | 4 x P10 | 400 Мбит/с | 680 Мбит/с | 2 000 | 14 000 |
| M64s | 1000 ГиБ | 1000 Мбит/с | 4 x p15 | 500 Мбит/с | 680 Мбит/с | 4 400 | 14 000 |
| M64ms | 1750 ГиБ | 1000 Мбит/с | 4 x P20 | 600 Мбит/с | 680 Мбит/с | 9 200 | 14 000 |  
| M128s | 2000 ГиБ | 2 000 Мбит/с | 4 x P20 | 600 Мбит/с | 680 Мбит/с | 9 200| 14 000 | 
| M128ms | 3800 ГиБ | 2 000 Мбит/с | 4 x P30 | 800 Мбит/с | без разбивки на пакеты | 20 000 | без разбивки на пакеты | 
| M208s_v2 | 2850 ГиБ | 1000 Мбит/с | 4 x P30 | 800 Мбит/с | без разбивки на пакеты | 20 000| без разбивки на пакеты | 
| M208ms_v2 | 5700 ГиБ | 1000 Мбит/с | 4 x P40 | 1000 Мбит/с | без разбивки на пакеты | 30 000 | без разбивки на пакеты |
| M416s_v2 | 5700 ГиБ | 2 000 Мбит/с | 4 x P40 | 1000 Мбит/с | без разбивки на пакеты | 30 000 | без разбивки на пакеты |
| M416ms_v2 | 11400 ГБ | 2 000 Мбит/с | 4 x P50 | 2 000 Мбит/с | без разбивки на пакеты | 30 000 | без разбивки на пакеты |


Для тома **/Hana/log** . Конфигурация будет выглядеть следующим образом:

| SKU виртуальной машины | ОЗУ | Макс. пропускная способность<br /> Пропускная способность | том **/Hana/log** | Подготовленная пропускная способность | Максимальная пропускная способность | Количество операций ввода-вывода в секунду | Ускоренные операции ввода-вывода |
| --- | --- | --- | --- | --- | --- | --- | 
| M32ts | 192 ГиБ | 500 Мбит/с | 3 x P10 | 300 Мбит/с | 510 Мбит/с | 1500 | 10 500 | 
| M32ls | 256 Гиб | 500 Мбит/с | 3 x P10 | 300 Мбит/с | 510 Мбит/с | 1500 | 10 500 | 
| M64ls | 512 ГБ | 1000 Мбит/с | 3 x P10 | 300 Мбит/с | 510 Мбит/с | 1500 | 10 500 | 
| M64s | 1000 ГиБ | 1000 Мбит/с | 3 x p15 | 375 Мбит/с | 510 Мбит/с | 3 300 | 10 500 | 
| M64ms | 1750 ГиБ | 1000 Мбит/с | 3 x p15 | 375 Мбит/с | 510 Мбит/с | 3 300 | 10 500 |  
| M128s | 2000 ГиБ | 2 000 Мбит/с | 3 x p15 | 375 Мбит/с | 510 Мбит/с | 3 300 | 10 500|  
| M128ms | 3800 ГиБ | 2 000 Мбит/с | 3 x p15 | 375 Мбит/с | 510 Мбит/с | 3 300 | 10 500 | 
| M208s_v2 | 2850 ГиБ | 1000 Мбит/с | 3 x p15 | 375 Мбит/с | 510 Мбит/с | 3 300 | 10 500 |  
| M208ms_v2 | 5700 ГиБ | 1000 Мбит/с | 3 x p15 | 375 Мбит/с | 510 Мбит/с | 3 300 | 10 500 |  
| M416s_v2 | 5700 ГиБ | 2 000 Мбит/с | 3 x p15 | 375 Мбит/с | 510 Мбит/с | 3 300 | 10 500 |  
| M416ms_v2 | 11400 ГБ | 2 000 Мбит/с | 3 x p15 | 375 Мбит/с | 510 Мбит/с | 3 300 | 10 500 | 


Для других томов конфигурация будет выглядеть следующим образом:

| SKU виртуальной машины | ОЗУ | Макс. пропускная способность<br /> Пропускная способность | /hana/shared | том /root | /usr/sap |
| --- | --- | --- | --- | --- | --- | --- | --- | -- |
| M32ts | 192 ГиБ | 500 Мбит/с | 1 x P15 | 1 x P6 | 1 x P6 |
| M32ls | 256 Гиб | 500 Мбит/с |  1 x P15 | 1 x P6 | 1 x P6 |
| M64ls | 512 ГБ | 1000 Мбит/с | 1 x P20 | 1 x P6 | 1 x P6 |
| M64s | 1000 ГиБ | 1000 Мбит/с | 1 x P30 | 1 x P6 | 1 x P6 |
| M64ms | 1750 ГиБ | 1000 Мбит/с | 1 x P30 | 1 x P6 | 1 x P6 | 
| M128s | 2000 ГиБ | 2 000 Мбит/с | 1 x P30 | 1 x P10 | 1 x P6 | 
| M128ms | 3800 ГиБ | 2 000 Мбит/с | 1 x P30 | 1 x P10 | 1 x P6 |
| M208s_v2 | 2850 ГиБ | 1000 Мбит/с |  1 x P30 | 1 x P10 | 1 x P6 |
| M208ms_v2 | 5700 ГиБ | 1000 Мбит/с | 1 x P30 | 1 x P10 | 1 x P6 | 
| M416s_v2 | 5700 ГиБ | 2 000 Мбит/с |  1 x P30 | 1 x P10 | 1 x P6 | 
| M416ms_v2 | 11400 ГБ | 2 000 Мбит/с | 1 x P30 | 1 x P10 | 1 x P6 | 


Проверьте, будет ли пропускная способность хранилища для разных предлагаемых томов соответствовать рабочей нагрузке, которую вы хотите запускать. Если для рабочей нагрузки требуются более высокие объемы томов для **/Hana/Data** и **/Hana/log**, необходимо увеличить число виртуальных жестких дисков хранилища Azure класса Premium. Изменение размера тома с увеличением количества VHD увеличит пропускную способность операций ввода-вывода и число IOPS в пределах ограничений типа виртуальной машины Azure.

Ускоритель записи Azure работает только с [управляемыми дисками Azure](https://azure.microsoft.com/services/managed-disks/). Поэтому по крайней мере диски хранилища Azure класса Premium, образующие том **/Hana/log** , должны быть развернуты как управляемые диски. Более подробные инструкции и ограничения Ускоритель записи Azure можно найти в статье [ускоритель записи](../../how-to-enable-write-accelerator.md).

Для сертифицированных виртуальных машин HANA семейства Azure [Esv3](../../ev3-esv3-series.md?toc=/azure/virtual-machines/linux/toc.json&bc=/azure/virtual-machines/linux/breadcrumb/toc.json#esv3-series) и [Edsv4](../../edv4-edsv4-series.md?toc=/azure/virtual-machines/linux/toc.json&bc=/azure/virtual-machines/linux/breadcrumb/toc.json#edsv4-series)необходимо использовании для тома **/Hana/Data** и **/Hana/log** . Вы также должны использовать Azure Ultra Storage, а не хранилище Azure класса Premium только для тома **/Hana/log** . В результате конфигурации тома **/Hana/Data** в хранилище Azure класса Premium могут выглядеть следующим образом:

| SKU виртуальной машины | ОЗУ | Макс. пропускная способность<br /> Пропускная способность | hana/data; | Подготовленная пропускная способность | Максимальная пропускная способность | Количество операций ввода-вывода в секунду | Ускоренные операции ввода-вывода |
| --- | --- | --- | --- | --- | --- | --- |
| E20ds_v4 | 160 гиб | 480 Мбит/с | 3 x P10 | 300 Мбит/с | 510 Мбит/с | 1500 | 10 500 |
| E32ds_v4 | 256 Гиб | 768 Мбит/с | 3 x P10 |  300 Мбит/с | 510 Мбит/с | 1500 | 10 500|
| E48ds_v4 | 384 гиб | 1 152 Мбит/с | 3 x p15 |  375 Мбит/с |510 Мбит/с | 3 300  | 10 500 | 
| E64ds_v4 | 504 гиб | 1200 Мбит/с | 3 x p15 |  375 Мбит/с | 510 Мбит/с | 3 300 | 10 500 | 
| E64s_v3 | 432 ГиБ | 1200 МБ/с | 3 x p15 |  375 Мбит/с | 510 Мбит/с | 3 300 | 10 500 | 

Для других томов, включая **/Hana/log** на Ultra Disk, конфигурация может выглядеть следующим образом:

| SKU виртуальной машины | ОЗУ | Макс. пропускная способность<br /> Пропускная способность | Объем /hana/log | Максимальная пропускная способность ввода-вывода /hana/log | Число операции ввода-вывода в секунду /hana/log | /hana/shared | том /root | /usr/sap |
| --- | --- | --- | --- | --- | --- | --- | --- | -- |
| E20ds_v4 | 160 гиб | 480 Мбит/с | 80 ГБ | 250 Мбит/с | 1800 | 1 x P15 | 1 x P6 | 1 x P6 |
| E32ds_v4 | 256 Гиб | 768 Мбит/с | 128 ГБ | 250 Мбит/с | 1800 | 1 x P15 | 1 x P6 | 1 x P6 |
| E48ds_v4 | 384 гиб | 1 152 Мбит/с | 192 ГБ | 250 Мбит/с | 1800 | 1 x P20 | 1 x P6 | 1 x P6 |
| E64ds_v4 | 504 гиб | 1200 Мбит/с | 256 ГБ | 250 Мбит/с | 1800 | 1 x P20 | 1 x P6 | 1 x P6 |
| E64s_v3 | 432 ГиБ | 1200 Мбит/с | 220 ГБ | 250 Мбит/с | 1800 | 1 x P20 | 1 x P6 | 1 x P6 |


## <a name="azure-ultra-disk-storage-configuration-for-sap-hana"></a>Конфигурации хранилища Azure категории "Ультра" для SAP HANA
Другой тип хранилища Azure называется " [Ultra Disk" Azure](../../disks-types.md#ultra-disk). Значительная разница между хранилищем Azure, предлагаемым до сих пор, и новым диском "Ультра" заключается в том, что возможности диска больше не привязаны к размеру диска. Как клиент вы можете определить эти возможности для диска "Ультра":

- Размер диска в диапазоне от 4 ГиБ до 65 536 ГиБ
- Число операций ввода-вывода в секунду в диапазоне от 100 до 160 тысяч операций (максимум также зависит от типов виртуальных машин)
- Пропускная способность хранилища от 300 МБ/с до 2000 МБ/с

Благодаря диску "Ультра" можно выбрать один диск, имеющий все подходящие параметры размера, числа операций ввода-вывода в секунду и пропускной способности. Вместо использования диспетчеров логических томов, таких как LVM или MDADM, поверх хранилища Azure класса Premium, создайте тома, выполняющие требования к операциям ввода-вывода и пропускной способности хранилища. Вы можете запустить набор конфигурации между Ultra Disk и хранилищем класса Premium. В результате можно ограничить использование Ultra Disk критически важными для производительности **/Hana/Data** и **/Hana/log** томами и охватить другие тома с хранилищем Azure класса Premium.

Другими преимуществами использования Ultra Disk может быть лучшая задержка чтения при сравнении с хранилищем класса Premium. Более быстрая задержка чтения может иметь преимущества, если требуется сократить время запуска HANA и последующую загрузку данных в память. Преимущества использования хранилища "Ультра" также становятся заметны, когда HANA записывает точки сохранения. 

> [!NOTE]
> Пока что диски "Ультра" доступны не во всех регионах Azure, а также не поддерживают представленные ниже типы виртуальных машин. Для получения подробной информации о доступности диска "Ультра" и поддерживаемых семействах виртуальных машин ознакомьтесь со статьей [Какие типы дисков доступны в Azure?](../../disks-types.md#ultra-disk).

### <a name="production-recommended-storage-solution-with-pure-ultra-disk-configuration"></a>Рекомендуемое производителями решение для хранения данных с чистой конфигурацией диска "Ультра"
В этой конфигурации тома **/Hana/Data** и **/Hana/log** хранятся отдельно. Предлагаемые значения получены из ключевых показателей эффективности, которые сертифицируются SAP для SAP HANA, и конфигураций хранилища,рекомендованных в [техническом документе по хранилищу SAP TDI](https://www.sap.com/documents/2015/03/74cdb554-5a7c-0010-82c7-eda71af511fa.html).

Рекомендации часто превышают минимальные требования SAP, как и было сказано ранее в этой статье. Данные рекомендации являются компромиссными между рекомендациями по размеру от SAP и параметром максимальной пропускной способности, который предоставляют различные модели виртуальных машин.

> [!NOTE]
> Максимальное количество операций ввода-вывода в секунду для диска Azure составляет 2 ГБ


| SKU виртуальной машины | ОЗУ | Макс. пропускная способность<br /> Пропускная способность | Объем /hana/data | Максимальная пропускная способность ввода-вывода /hana/data | Число операций ввода-вывода в секунду /hana/data | Объем /hana/log | Максимальная пропускная способность ввода-вывода /hana/log | Число операции ввода-вывода в секунду /hana/log |
| --- | --- | --- | --- | --- | --- | --- | --- | -- |
| E20ds_v4 | 160 гиб | 480 МБ/с | 200 ГБ | 400 Мбит/с | 2500 | 80 ГБ | 250 МБ | 1800 |
| E32ds_v4 | 256 Гиб | 768 МБ/с | 300 ГБ | 400 Мбит/с | 2500 | 128 ГБ | 250 Мбит/с | 1800 |
| E48ds_v4 | 384 гиб | 1152 МБ/с | 460 ГБ | 400 Мбит/с | 3000 | 192 ГБ | 250 Мбит/с | 1800 |
| E64ds_v4 | 504 гиб | 1200 МБ/с | 610 ГБ | 400 Мбит/с | 3500 |  256 ГБ | 250 Мбит/с | 1800 |
| E64s_v3 | 432 ГиБ | 1200 МБ/с | 610 ГБ | 400 Мбит/с | 3500 | 220 ГБ | 250 МБ | 1800 |
| M32ts | 192 ГиБ | 500 МБ/с | 250 ГБ | 400 Мбит/с | 2500 | 96 ГБ | 250 Мбит/с  | 1800 |
| M32ls | 256 Гиб | 500 МБ/с | 300 ГБ | 400 Мбит/с | 2500 | 256 ГБ | 250 Мбит/с  | 1800 |
| M64ls | 512 ГБ | 1000 МБ/с | 620 ГБ | 400 Мбит/с | 3500 | 256 ГБ | 250 Мбит/с  | 1800 |
| M64s | 1000 ГиБ | 1000 МБ/с |  1200 ГБ | 600 Мбит/с | 5 000 | 512 ГБ | 250 Мбит/с  | 2500 |
| M64ms | 1750 ГиБ | 1000 МБ/с | 2100 ГБ | 600 Мбит/с | 5 000 | 512 ГБ | 250 Мбит/с  | 2500 |
| M128s | 2000 ГиБ | 2000 МБ/с |2400 ГБ | 750 Мбит/с | 7000 | 512 ГБ | 250 Мбит/с  | 2500 | 
| M128ms | 3800 ГиБ | 2000 МБ/с | 4800 ГБ | 750 Мбит/с |9600 | 512 ГБ | 250 Мбит/с  | 2500 | 
| M208s_v2 | 2850 ГиБ | 1000 МБ/с | 3500 ГБ | 750 Мбит/с | 7000 | 512 ГБ | 250 Мбит/с  | 2500 | 
| M208ms_v2 | 5700 ГиБ | 1000 МБ/с | 7200 ГБ | 750 Мбит/с | 14 400 | 512 ГБ | 250 Мбит/с  | 2500 | 
| M416s_v2 | 5700 ГиБ | 2000 МБ/с | 7200 ГБ | 1000 Мбит/с | 14 400 | 512 ГБ | 400 Мбит/с  | 4000 | 
| M416ms_v2 | 11400 ГБ | 2000 МБ/с | 14400 ГБ | 1500 Мбит/с | 28 800 | 512 ГБ | 400 Мбит/с  | 4000 |   

**Перечисленные значения могут считаться отправной точкой и должны рассматриваться по реальным потребностям.** Преимуществом диска "Ультра" Azure является то, что значения операций ввода-вывода и пропускной способности могут быть адаптированы без необходимости завершать работу виртуальной машины или останавливать рабочую нагрузку на систему.   

> [!NOTE]
> На данный момент снимки хранилища не поддерживаются хранилищем диска "Ультра". Это делает невозможным использование снимков виртуальных машин с помощью Azure Backup Services


## <a name="nfs-v41-volumes-on-azure-netapp-files"></a>Тома NFS версии 4.1 на Azure NetApp Files
Дополнительные сведения о использовании для HANA см. в статье о [томах NFS версии 4.1 на Azure NetApp Files для SAP HANA](./hana-vm-operations-netapp.md)




## <a name="cost-conscious-solution-with-azure-premium-storage"></a>Экономичное решение с хранилищем Azure класса Premium
До сих пор решение для хранения Azure класса Premium, описанное в этом документе в разделе [решения с хранилищем класса Premium и ускоритель записи Azure для виртуальных машин Azure серии M,](#solutions-with-premium-storage-and-azure-write-accelerator-for-azure-m-series-virtual-machines) было предназначено для SAP HANA поддерживаемых рабочих сценариев. Одной из характеристик конфигураций, поддерживающих поддержку в рабочей среде, является разделение томов для SAP HANA данных и повторный вход на два разных тома. Причина такого разделения заключается в том, что характеристики рабочей нагрузки на томах отличаются. И в предлагаемых рабочих конфигурациях может потребоваться разный тип кэширования или даже различные типы блочного хранилища Azure. В непроизводственных сценариях некоторые соображения, предпринятые для производственных систем, могут не применяться к более низким нерабочим системам. В результате можно объединить данные и объем журнала HANA. В конечном итоге с некоторыми недостатками, как в конечном итоге, не следует приудовлетворить определенные ключевые показатели пропускной способности или задержки, необходимые для рабочих систем. Другим аспектом снижения затрат в таких средах может быть использование [хранилища Azure SSD (цен. Категория "Стандартный")](./planning-guide-storage.md#azure-standard-ssd-storage). Помните, что выбор SSD (цен. категория "Стандартный") или HDD (цен. категория "Стандартный") службы хранилища Azure влияют на соглашения об уровне обслуживания для одной виртуальной машины, как описано в статье  [SLA для виртуальных машин](https://azure.microsoft.com/support/legal/sla/virtual-machines).

Менее дорогостоящая альтернатива для таких конфигураций может выглядеть следующим образом:


| SKU виртуальной машины | ОЗУ | Макс. пропускная способность<br /> Пропускная способность | /hana/data и /hana/log,<br /> чередующиеся с диспетчером логических томов или MDADM | /hana/shared | том /root | /usr/sap | comments |
| --- | --- | --- | --- | --- | --- | --- | -- |
| DS14v2 | 112 ГиБ | 768 МБ/с | 4 x P6 | 1 x E10 | 1 x E6 | 1 x E6 | Не будет достигнуто 1 мс задержки в хранилище меньше<sup>1</sup> |
| E16v3 | 128 ГБ | 384 МБ/с | 4 x P6 | 1 x E10 | 1 x E6 | 1 x E6 | Тип виртуальной машины не сертифицирован HANA <br /> Не будет достигнуто 1 мс задержки в хранилище меньше<sup>1</sup> |
| M32ts | 192 ГиБ | 500 МБ/с | 3 x P10 | 1 x E15 | 1 x E6 | 1 x E6 | Использование Ускоритель записи для Объединенных данных и объема журналов ограничит скорость операций ввода-вывода в секунду до 5 000<sup>2</sup> |
| E20ds_v4 | 160 гиб | 480 МБ/с | 4 x P6 | 1 x E15 | 1 x E6 | 1 x E6 | Не будет достигнуто 1 мс задержки в хранилище меньше<sup>1</sup> |
| E32v3 | 256 Гиб | 768 МБ/с | 4 x P10 | 1 x E15 | 1 x E6 | 1 x E6 | Тип виртуальной машины не сертифицирован HANA <br /> Не будет достигнуто 1 мс задержки в хранилище меньше<sup>1</sup> |
| E32ds_v4 | 256 Гиб | 768 Мбит/с | 4 x P10 | 1 x E15 | 1 x E6 | 1 x E6 | Не будет достигнуто 1 мс задержки в хранилище меньше<sup>1</sup> |
| M32ls | 256 Гиб | 500 МБ/с | 4 x P10 | 1 x E15 | 1 x E6 | 1 x E6 | Использование Ускоритель записи для Объединенных данных и объема журналов ограничит скорость операций ввода-вывода в секунду до 5 000<sup>2</sup> |
| E48ds_v4 | 384 гиб | 1 152 Мбит/с | 6 x P10 | 1 x E20 | 1 x E6 | 1 x E6 | Не будет достигнуто 1 мс задержки в хранилище меньше<sup>1</sup> |
| E64v3 | 432 ГиБ | 1200 МБ/с | 6 x P10 | 1 x E20 | 1 x E6 | 1 x E6 | Не будет достигнуто 1 мс задержки в хранилище меньше<sup>1</sup> |
| E64ds_v4 | 504 гиб | 1200 МБ/с |  7 x P10 | 1 x E20 | 1 x E6 | 1 x E6 | Не будет достигнуто 1 мс задержки в хранилище меньше<sup>1</sup> |
| M64ls | 512 ГБ | 1000 МБ/с | 7 x P10 | 1 x E20 | 1 x E6 | 1 x E6 | Использование Ускоритель записи для Объединенных данных и объема журналов ограничит скорость операций ввода-вывода в секунду до 10 000<sup>2</sup> |
| M64s | 1000 ГиБ | 1000 МБ/с | 7 x p15 | 1 x E30 | 1 x E6 | 1 x E6 | Использование Ускоритель записи для Объединенных данных и объема журналов ограничит скорость операций ввода-вывода в секунду до 10 000<sup>2</sup> |
| M64ms | 1750 ГиБ | 1000 МБ/с | 6 x P20 | 1 x E30 | 1 x E6 | 1 x E6 | Использование Ускоритель записи для Объединенных данных и объема журналов ограничит скорость операций ввода-вывода в секунду до 10 000<sup>2</sup> |
| M128s | 2000 ГиБ | 2000 МБ/с |6 x P20 | 1 x E30 | 1 x E10 | 1 x E6 | Использование Ускоритель записи для Объединенных данных и объема журналов ограничит скорость операций ввода-вывода в секунду до 20 000<sup>2</sup> |
| M208s_v2 | 2850 ГиБ | 1000 МБ/с | 4 x P30 | 1 x E30 | 1 x E10 | 1 x E6 | Использование Ускоритель записи для Объединенных данных и объема журналов ограничит скорость операций ввода-вывода в секунду до 10 000<sup>2</sup> |
| M128ms | 3800 ГиБ | 2000 МБ/с | 5 x P30 | 1 x E30 | 1 x E10 | 1 x E6 | Использование Ускоритель записи для Объединенных данных и объема журналов ограничит скорость операций ввода-вывода в секунду до 20 000<sup>2</sup> |
| M208ms_v2 | 5700 ГиБ | 1000 МБ/с | 4 x P40 | 1 x E30 | 1 x E10 | 1 x E6 | Использование Ускоритель записи для Объединенных данных и объема журналов ограничит скорость операций ввода-вывода в секунду до 10 000<sup>2</sup> |
| M416s_v2 | 5700 ГиБ | 2000 МБ/с | 4 x P40 | 1 x E30 | 1 x E10 | 1 x E6 | Использование Ускоритель записи для Объединенных данных и объема журналов ограничит скорость операций ввода-вывода в секунду до 20 000<sup>2</sup> |
| M416ms_v2 | 11400 ГиБ | 2000 МБ/с | 7 x P40 | 1 x E30 | 1 x E10 | 1 x E6 | Использование Ускоритель записи для Объединенных данных и объема журналов ограничит скорость операций ввода-вывода в секунду до 20 000<sup>2</sup> |


<sup>1</sup> [ускоритель записи Azure](../../how-to-enable-write-accelerator.md) нельзя использовать с семействами виртуальных машин Ev4 и Ev4. В результате использования хранилища Azure класса Premium задержка ввода-вывода не будет меньше 1 мс

<sup>2</sup> семейство виртуальных машин поддерживает [Azure ускоритель записи](../../how-to-enable-write-accelerator.md), но существует вероятность, что ограничение количества операций ввода-вывода в секунду может ограничить возможности дисковых конфигураций операций ввода-вывода в секунду.

В случае объединения объема данных и журнала для SAP HANA диски, создающие чередующийся том, не должны иметь кэш чтения или кэш чтения и записи.

В списке присутствуют типы виртуальных машин, которые не сертифицированы SAP и, как таковые, не перечислены в [каталоге оборудования](https://www.sap.com/dmc/exp/2014-09-02-hana-hardware/enEN/iaas.html#categories=Microsoft%20Azure), который называется SAP HANA. Отзывы клиентов были вызваны тем, что эти незарегистрированные типы виртуальных машин были успешно использованы для некоторых нерабочих задач.


## <a name="next-steps"></a>Дальнейшие действия
Дополнительные сведения см. в разделе:

- [Руководство по обеспечению высокого уровня доступности SAP HANA на виртуальных машинах Azure](./sap-hana-availability-overview.md).