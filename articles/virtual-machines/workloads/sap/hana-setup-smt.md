---
title: Настройка сервера SMT для SAP HANA в Azure (большие экземпляры) | Документация Майкрософт
description: Как настроить сервер SMT для SAP HANA в Azure (большие экземпляры).
services: virtual-machines-linux
documentationcenter: ''
author: hermanndms
manager: juergent
editor: ''
ms.service: virtual-machines-sap
ms.topic: article
ms.tgt_pltfrm: vm-linux
ms.workload: infrastructure
ms.date: 09/10/2018
ms.author: hermannd
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: 990274f34dac0234c2c2d521ca6a260f999671bb
ms.sourcegitcommit: 910a1a38711966cb171050db245fc3b22abc8c5f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/20/2021
ms.locfileid: "101674518"
---
# <a name="set-up-smt-server-for-suse-linux"></a>Настройка сервера SMT для SUSE Linux
Большие экземпляры SAP HANA не подключены к Интернету напрямую. Процессы регистрации такой единицы у поставщика ОС, скачивания и применения обновлений вызывают определенные сложности. Решение для SUSE Linux — настроить сервер SMT на виртуальной машине Azure. Разместите виртуальную машину в виртуальной сети Azure, которая подключена к большим экземплярам HANA. При наличии такого сервера SMT единица большого экземпляра HANA может регистрировать и скачивать обновления. 

Дополнительную информацию по SUSE см. в документации [Subscription Management Tool for SLES 12 SP2](https://www.suse.com/documentation/sles-12/pdfdoc/book_smt/book_smt.pdf) (Средство управления подписками для SLES 12 SP2). 

Необходимые условия для установки сервера SMT, выполняющего задачу для больших экземпляров HANA:

- виртуальная сеть Azure, подключенная к цепи ExpressRoute большого экземпляра HANA;
- учетная запись SUSE, связанная с организацией. Организации необходима действительная подписка SUSE.

## <a name="install-smt-server-on-an-azure-virtual-machine"></a>Установка сервера SMT на виртуальной машине Azure

Сначала войдите в [Центр клиентов SUSE](https://scc.suse.com/).

Перейдите к   >  **учетным данным** Организации Организации. В этом разделе вы найдете учетные данные, необходимые для настройки сервера SMT.

Затем установите виртуальную машину SUSE Linux в виртуальной сети Azure. Чтобы развернуть виртуальную машину, требуется образ SLES 12 SP2 из коллекции Azure (выберите образ BYOS SUSE). В процессе развертывания не определяйте имя DNS и не используйте статические IP-адреса.

![Снимок экрана: развертывание виртуальной машины для сервера SMT](./media/hana-installation/image3_vm_deployment.png)

Развернутая виртуальная машина меньше и в виртуальной сети Azure содержит внутренний IP-адрес 10.34.1.4. Имя виртуальной машины — *smtserver*. После установки проверяется возможность подключения к единицам больших экземпляров HANA. В зависимости от того, как организовано разрешение имен, может потребоваться настроить разрешение единиц больших экземпляров HANA в etc/hosts виртуальной машины Azure. 

Добавьте диск к виртуальной машине. Диск используется для сохранения обновлений, а сам загрузочный диск может оказаться слишком маленьким. Здесь диск подключен к /srv/www/htdocs, как показано на следующем снимке экрана. 100 ГБ дискового пространства должно быть достаточно.

![На снимке экрана показан добавленный диск в окне «Вывод».](./media/hana-installation/image4_additional_disk_on_smtserver.PNG)

Войдите на единицу большого экземпляра HANA, выделите /etc/hosts и проверьте, доступна ли виртуальная машина Azure, на которой сервер SMT должен быть запущен по сети.

После этой проверки войдите в виртуальную машину Azure, в который должен быть запущен сервер SMT. Если для входа в виртуальную машину используется PuTTY, выполните следующую последовательность команд в окне bash.

```
cd ~
echo "export NCURSES_NO_UTF8_ACS=1" >> .bashrc
```

Перезапустите bash, чтобы активировать эти параметры. Затем запустите YAST.

Подключите вашу виртуальную машину (smtserver) к сайту SUSE.

```
smtserver:~ # SUSEConnect -r <registration code> -e s<email address> --url https://scc.suse.com
Registered SLES_SAP 12.2 x86_64
To server: https://scc.suse.com
Using E-Mail: email address
Successfully registered system.
```

После подключения виртуальной машины к сайту SUSE установите пакеты smt. Используйте следующую команду PuTTY, чтобы установить необходимые пакеты.

```
smtserver:~ # zypper in smt
Refreshing service 'SUSE_Linux_Enterprise_Server_for_SAP_Applications_12_SP2_x86_64'.
Loading repository data...
Reading installed packages...
Resolving package dependencies...
```


Для установки пакетов smt также можно использовать средство YAST. В YAST перейдите в раздел **Software Maintenance** (Обслуживание программного обеспечения) и выполните поиск smt. Выберите пункт **smt**, который автоматически изменится на yast2-smt.

![Снимок экрана SMT в YAST](./media/hana-installation/image5_smt_in_yast.PNG)


Примите выбор для установки на smtserver. После завершения установки перейдите к конфигурации сервера SMT. Введите учетные данные организации, полученные ранее из Центра клиентов SUSE. Также введите имя узла виртуальной машины Azure в качестве URL-адреса сервера SMT. В этом примере это HTTPS: \/ /смтсервер.

![Снимок экрана конфигурации сервера SMT](./media/hana-installation/image6_configuration_of_smtserver1.png)

Теперь проверьте, работает ли подключение к Центру клиентов SUSE. Как видно на следующем снимке экрана, в этой демонстрации оно работает.

![Снимок экрана: тестирование подключения к Центру клиентов SUSE](./media/hana-installation/image7_test_connect.png)

После начала установки SMT необходимо указать пароль для базы данных. Так как это новая установка, необходимо определить этот пароль, как показано на следующем снимке экрана.

![Снимок экрана: определение пароля для базы данных](./media/hana-installation/image8_define_db_passwd.PNG)

Следующий шаг — создание сертификата.

![Снимок экрана: создание сертификата для сервера SMT](./media/hana-installation/image9_certificate_creation.PNG)

В конце конфигурации может потребоваться несколько минут, чтобы выполнить проверку синхронизации. После установки и настройки сервера SMT вы должны увидеть репозиторий каталога в разделе точки подключения /srv/www/htdocs/. Кроме того, в репозитории также существуют некоторые подкаталоги. 

Перезапустите сервер SMT и его связанные службы, выполнив эти команды.

```
rcsmt restart
systemctl restart smt.service
systemctl restart apache2
```

## <a name="download-packages-onto-smt-server"></a>Загрузка пакетов на сервер SMT

После перезапуска всех служб выберите нужные пакеты в окне управления SMT с помощью YAST. Выбор пакета зависит от образа операционной системы сервера больших экземпляров HANA. Выбор пакета не зависит от выпуска SLES или версии виртуальной машины, на которой запущен сервер SMT. На следующем снимке экрана приведен пример экрана выбора.

![Снимок экрана: выбор пакетов](./media/hana-installation/image10_select_packages.PNG)

Теперь запустите исходную копию выбранных пакетов на сервере SMT, который вы настроили. Эта копия запускается в оболочке с помощью команды smt-mirror.

![Снимок экрана: загрузка пакетов на сервер SMT](./media/hana-installation/image11_download_packages.PNG)

Пакеты следует скопировать в каталоги, созданные в разделе точки подключения /srv/www/htdocs. Этот процесс может занять больше часа в зависимости от того, сколько пакетов выбрано. По завершению этого процесса необходимо перейти к установке клиента SMT. 

## <a name="set-up-the-smt-client-on-hana-large-instance-units"></a>Установка клиента SMT на единицах крупных экземпляров HANA

В нашем случае клиенты представляют собой единицы больших экземпляров HANA. Программа установки сервера SMT скопировала скрипт clientSetup4SMT.sh в виртуальную машину Azure. Скопируйте этот скрипт в единицу крупного экземпляра HANA, которую нужно подключить к серверу SMT. Запустите скрипт с параметром -h и в качестве параметра присвойте ему имя сервера SMT. В этом примере его имя — *smtserver*.

![Снимок экрана: настройка клиента SMT](./media/hana-installation/image12_configure_client.PNG)

Возможно, что при успешной загрузке клиентом сертификата с сервера регистрация завершится ошибкой, как показано на следующем снимке экрана.

![Снимок экрана: сбой регистрации клиента](./media/hana-installation/image13_registration_failed.PNG)

При сбое регистрации обратитесь к [справочному документу по SUSE](https://www.suse.com/de-de/support/kb/doc/?id=7006024) и выполните действия, описанные в нем.

> [!IMPORTANT] 
> В качестве имени сервера укажите имя виртуальной машины (в нашем случае — *smtserver*) без указания полного доменного имени. 

После выполнения этих действий выполните следующую команду на единице большого экземпляра HANA.

```
SUSEConnect –cleanup
```

> [!Note] 
> После выполнения этого шага подождите несколько минут. При немедленном запуске clientSetup4SMT.sh может появиться ошибка.

Если возникают проблемы, которые необходимо исправить на основе шагов, описанных в статье SUSE, перезапустите clientSetup4SMT.sh на единице большого экземпляра HANA. Теперь процесс должен завершиться успешно.

![Снимок экрана: успешная регистрация клиента](./media/hana-installation/image14_finish_client_config.PNG)

Вы настроили клиент SMT единицы большого экземпляра HANA для подключения к серверу SMT, установленному на виртуальной машине Azure. Теперь можно выполнить zypper up или zypper in для установки обновлений операционной системы на большие экземпляры HANA или установки дополнительных пакетов. Можно получить только те обновления, которые были загружены ранее с сервера SMT.

## <a name="next-steps"></a>Дальнейшие действия
- [Пример установки SAP HANA на крупных экземплярах HANA](hana-example-installation.md).











