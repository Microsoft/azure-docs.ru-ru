---
title: Руководство по резервному копированию SAP HANA на виртуальных машинах Azure | Документация Майкрософт
description: Рекомендации по использованию двух основных возможностей резервного копирования SAP HANA на виртуальных машинах Azure.
services: virtual-machines-linux
documentationcenter: ''
author: msjuergent
manager: juergent
editor: ''
ms.service: virtual-machines-sap
ms.topic: article
ums.tgt_pltfrm: vm-linux
ms.workload: infrastructure-services
ms.date: 03/01/2020
ms.author: juergent
ms.openlocfilehash: 0004afb5895d7549e5db8ad5e53b52fa17991520
ms.sourcegitcommit: 910a1a38711966cb171050db245fc3b22abc8c5f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "101667914"
---
# <a name="backup-guide-for-sap-hana-on-azure-virtual-machines"></a>Руководство по резервному копированию SAP HANA на виртуальных машинах Azure

## <a name="getting-started"></a>Приступая к работе

В этом руководстве по резервному копированию для платформы SAP HANA, запущенной на виртуальных машинах Azure, рассматриваются темы, относящиеся только к Azure. Сведения об общих вопросах, связанных с резервным копированием в SAP HANA, см. в документации по SAP HANA. Мы предполагаю, что вы уже знакомы с принципами стратегии резервного копирования базы данных, причинами и мотивацией, чтобы иметь звук и допустимую стратегию резервного копирования и осведомлены о требованиях, предъявляемых вашей компанией к процедуре резервного копирования, сроку хранения резервных копий и процедуре восстановления.

SAP HANA официально поддерживается на различных типах виртуальных машин Azure, таких как Azure серии M. Полный список SAP HANA сертифицированных виртуальных машин Azure и единиц крупных экземпляров HANA см. на этой этой [платформе](https://www.sap.com/dmc/exp/2014-09-02-hana-hardware/enEN/iaas.html#categories=Microsoft%20Azure). Microsoft Azure предлагает ряд единиц, в которых SAP HANA работает на физических серверах без виртуализации. Эта служба называется [крупные экземпляры Hana](hana-overview-architecture.md). В этом руководством не рассматриваются процессы и средства резервного копирования для крупных экземпляров HANA. Но она будет ограничена виртуальными машинами Azure. Дополнительные сведения о процессах резервного копирования и восстановления с крупными экземплярами HANA см. в статье [Хли Backup and Restore](./hana-backup-restore.md).

В этой статье рассматриваются три возможности резервного копирования SAP HANA на виртуальных машинах Azure:

- Резервное копирование HANA через [службы Azure Backup](../../../backup/backup-overview.md) 
- резервное копирование HANA в файловую систему на виртуальной машине Azure под управлением Linux (см. статью [Резервное копирование SAP HANA в Azure на уровне файлов](sap-hana-backup-file-level.md));
- Резервное копирование HANA на основе моментальных снимков хранилища с помощью функции моментальных снимков BLOB-объектов службы хранилища Azure вручную или службы Azure Backup


SAP HANA предоставляет API-интерфейс архивации, который позволяет интегрировать средства резервного копирования сторонних поставщиков непосредственно с SAP HANA. Такие продукты, как Azure Backup Service или [Commvault](https://azure.microsoft.com/resources/protecting-sap-hana-in-azure/) , используют этот собственный интерфейс для активации SAP HANA базы данных или резервных копий журналов повторов. 


Сведения о том, как найти программное обеспечение SAP, поддерживаемое в Azure, можно найти в статье [что такое программное обеспечение SAP поддерживается для развертываний Azure](./sap-supported-product-on-azure.md).

## <a name="azure-backup-service"></a>Служба архивации Azure

Первый показанный сценарий — это сценарий, в котором Azure Backup служба использует интерфейс SAP HANA `backint` для выполнения потоковой архивации из базы данных SAP HANA. Или вы используете более универсальную возможность Azure Backup службы, чтобы создать моментальный снимок диска с единообразным приложением и передать его в службу Azure Backup.

Azure Backup интегрируется и сертифицировано как решение резервного копирования для SAP HANA с помощью собственного интерфейса SAP HANA, именуемого [backint) создание](https://www.sap.com/dmc/exp/2013_09_adpd/enEN/#/d/solutions?id=8f3fd455-a2d7-4086-aa28-51d8870acaa5). Дополнительные сведения о решении, его возможностях и регионах Azure, где он доступен, см. в статье [Поддержка резервного копирования баз данных SAP HANA на виртуальных машинах Azure](../../../backup/sap-hana-backup-support-matrix.md#scenario-support). Дополнительные сведения и принципы Azure Backup службы для HANA см. в статье [резервное копирование SAP HANA базы данных на виртуальных машинах Azure](../../../backup/sap-hana-db-about.md). 

Вторая возможность использовать Azure Backup службу — создать единообразную резервную копию приложения с помощью моментальных снимков дисков хранилища Azure класса Premium. Другие сертифицированные хранилища Azure HANA, такие как [Ultra Disk](../../disks-enable-ultra-ssd.md) и [Azure NetApp Files](https://azure.microsoft.com/services/netapp/) Azure, не поддерживают этот тип моментального снимка с помощью службы Azure Backup. Чтение следующих статей:

- [Планирование инфраструктуры резервного копирования виртуальных машин в Azure](../../../backup/backup-azure-vms-introduction.md)
- [Согласованное с приложениями резервное копирование виртуальных машин Linux в Azure](../../../backup/backup-azure-linux-app-consistent.md) 

Эта последовательность действий появилось:

- Azure Backup необходимо выполнить скрипт, выполняемый перед созданием моментального снимка, который помещает приложение, в данном случае SAP HANA, в противоречивом состоянии.
- После подтверждения этого состояния Azure Backup будет выполнять моментальные снимки диска.
- После завершения создания моментальных снимков Azure Backup отменит действие, выполненное в скрипте перед моментальным снимком.
- После успешного выполнения Azure Backup выполнит потоковую передачу данных в хранилище службы архивации.

В случае SAP HANA большинство клиентов используют Ускоритель записи Azure для томов, содержащих журнал SAP HANA повторяемости. Azure Backup служба будет автоматически исключать эти тома из моментальных снимков. Это исключение не наносит вред возможности HANA для восстановления. Хотя он блокирует возможность восстановления практически всеми другими СУБД, поддерживаемой SAP.

Недостаток этой возможности заключается в том, что необходимо разработать собственный скрипт, выполняемый до и после моментального снимка. Сценарий, выполняемый перед созданием моментального снимка, должен создать моментальный снимок HANA и обменять случаи возникновения исключений. В то время как скрипт, выполняемый после создания моментального снимка, должен снова удалить моментальный снимок HANA. Дополнительные сведения о необходимой логике см. в [заметке о поддержке SAP #2039883](https://launchpad.support.sap.com/#/notes/2039883). Рекомендации раздела "SAP HANA согласованности данных при создании моментальных снимков хранилища" в этой статье полностью применяются к этой резервной копии.

> [!NOTE]
> Резервные копии на основе моментального снимка диска для SAP HANA в развертываниях, где используются несколько контейнеров баз данных, требуется минимальный выпуск HANA 2,0 SP04
> 

Дополнительные сведения о моментальных снимках хранилища см. Далее в этом документе.

![Две возможности сохранения текущего состояния виртуальной машины](media/sap-hana-backup-guide/azure-backup-service-for-hana.png)

## <a name="other-hana-backup-methods"></a>Другие методы резервного копирования HANA
Существует три других метода или пути резервного копирования, которые можно считать:

- Резервное копирование в общую папку NFS, основанную на Azure NetApp Files (использовании). ИСПОЛЬЗОВАНИИ снова может создавать моментальные снимки томов, на которых хранятся резервные копии. Учитывая пропускную способность, которая в конечном итоге затребовалась для написания резервных копий, это решение может стать дорогостоящим методом. Хотя можно легко устанавливать, так как HANA может записывать резервные копии непосредственно в собственную общую папку NFS в Azure.
- Выполните резервное копирование HANA для подключенных к виртуальной машине дисков SSD (цен. категория "Стандартный") или хранилища Azure класса Premium. В качестве следующего шага можно скопировать эти файлы резервных копий в хранилище BLOB-объектов Azure. Эта стратегия может быть привлекательной по цене.
- Выполните резервное копирование HANA для подключенных к виртуальной машине дисков SSD (цен. категория "Стандартный") или хранилища Azure класса Premium. Как и на следующем шаге, диск регулярно получает снапшоттед. После первого моментального снимка можно использовать добавочные моментальные снимки для снижения затрат

![Варианты создания резервной копии файлов SAP HANA на виртуальной машине](media/sap-hana-backup-guide/other-hana-backup-paths.png)

На рисунке выше показаны варианты создания резервной копии файлов SAP HANA на виртуальной машине, а также их сохранение в другое расположение с помощью разных средств. Однако все решения, не включающие сторонние службы резервного копирования или службы Azure Backup, имеют несколько недостатков. Некоторые из них могут быть перечислены, например администрирование хранения, процесс автоматического восстановления и автоматическое восстановление на определенный момент времени, как Azure Backup служба или другие специализированные наборы резервных копий и службы сторонних производителей. Многие из этих служб сторонних разработчиков могут работать в Azure. 


## <a name="sap-resources-for-hana-backup"></a>Ресурсы SAP для резервного копирования HANA

### <a name="sap-hana-backup-documentation"></a>Документация по резервному копированию SAP HANA

- [Introduction to SAP HANA Administration](https://help.sap.com/viewer/6b94445c94ae495c83a19646e7c3fd56/2.0.00/en-US) (Общие сведения об администрировании SAP HANA)
- [Planning Your Backup and Recovery Strategy](https://help.sap.com/saphelp_hanaplatform/helpdata/en/ef/085cd5949c40b788bba8fd3c65743e/content.htm) (Планирование стратегии резервного копирования и восстановления)
- [Schedule HANA Backup using ABAP DBACOCKPIT](https://www.hanatutorials.com/p/schedule-hana-backup-using-abap.html) (Планирование резервного копирования HANA с помощью ABAP DBACOCKPIT)
- [Schedule Data Backups (SAP HANA Cockpit)](https://help.sap.com/saphelp_hanaplatform/helpdata/en/6d/385fa14ef64a6bab2c97a3d3e40292/frameset.htm) (Планирование резервного копирования данных (панель SAP HANA))
- Часто задаваемые вопросы о резервном копировании SAP HANA см. в [примечании к SAP 1642148](https://launchpad.support.sap.com/#/notes/1642148)
- Часто задаваемые вопросы о моментальных снимках базы данных и хранилища SAP HANA см. в [примечании к SAP 2039883](https://launchpad.support.sap.com/#/notes/2039883)
- Сведения о сетевых файловых системах (NFS), неподдерживаемых для резервного копирования и восстановления, см. в [примечании к SAP 1820529](https://launchpad.support.sap.com/#/notes/1820529)

### <a name="how-to-verify-correctness-of-sap-hana-backup"></a>Как проверить правильность резервной копии SAP HANA
Независимо от метода резервного копирования выполнение тестового восстановления для другой системы является абсолютной потребностью. Этот подход позволяет убедиться в правильности резервной копии, а также в том, что внутренние процессы резервного копирования и восстановления выполняются должным образом. В то время как восстановление резервных копий может быть нетрудной задачей в связи с требованиями к инфраструктуре, гораздо проще выполнить в облаке, предоставляя необходимые ресурсы временно для этой цели. Правильно, что существуют средства, предоставляемые HANA, которые могут проверять файлы резервных копий при восстановлении возможности восстановления. Тем не менее цель частого восстановления заключается в тестировании процесса восстановления базы данных и обучении этого процесса сотрудниками.

Обратите внимание, что недостаточно выполнить простое восстановление и проверку, когда платформа HANA настроена и запущена. Следует выполнить проверку согласованности таблицы, чтобы убедиться в том, что восстановленная база данных подойдет. SAP HANA предлагает несколько типов проверок согласованности (см. [примечание к SAP 1977584](https://launchpad.support.sap.com/#/notes/1977584)).

Сведения о проверке согласованности таблицы см. на веб-сайте SAP в [этой статье](https://help.sap.com/saphelp_hanaplatform/helpdata/en/25/84ec2e324d44529edc8221956359ea/content.htm#loio9357bf52c7324bee9567dca417ad9f8b).

### <a name="pros-and-cons-of-hana-backup-versus-storage-snapshot"></a>Преимущества и недостатки резервной копии HANA и резервной копии на основе моментального снимка хранилища

В документации по SAP не указано, какая резервная копия более предпочтительна: резервная копия HANA или резервная копия на основе моментальных снимков хранилища. Там перечислены только преимущества и недостатки каждой из них. Таким образом каждый пользователь может выбрать предпочитаемый вариант в зависимости от ситуации и доступной технологии хранения (см. статью [Планирование стратегии резервного копирования и восстановления](https://help.sap.com/viewer/6b94445c94ae495c83a19646e7c3fd56/2.0.05/en-US/ef085cd5949c40b788bba8fd3c65743e.html)).

В Azure следует учитывать тот факт, что функция моментального снимка больших двоичных объектов Azure не&#39;t обеспечивает согласованность файловой системы на нескольких дисках (см. статью [Использование моментальных снимков BLOB-объектов с помощью PowerShell](/archive/blogs/cie/using-blob-snapshots-with-powershell)). 

Кроме того, пользователи, которые часто работают с моментальными снимками больших двоичных объектов, должны понимать процесс выставления счетов. Дополнительные сведения см. в статье [Understanding How Snapshots Accrue Charges](/rest/api/storageservices/understanding-how-snapshots-accrue-charges) (Общие сведения об увеличении платы при использовании моментальных снимков). Это не так очевидно, как при использовании виртуальных дисков Azure.

### <a name="sap-hana-data-consistency-when-taking-storage-snapshots"></a>Согласованность данных SAP HANA при создании моментальных снимков хранилища

Как описывалось ранее, описание возможностей резервного копирования моментальных снимков Azure Backup, согласованность файловой системы и приложений является обязательной при создании моментальных снимков хранилища. Самый простой способ избежать проблем — завершить работу SAP HANA или даже всей виртуальной машины. Что-то нецелесообразно для рабочего экземпляра.

> [!NOTE]
> Резервные копии на основе моментального снимка диска для SAP HANA в развертываниях, где используются несколько контейнеров баз данных, требуется минимальный выпуск HANA 2,0 SP04
> 

Служба хранилища Azure не обеспечивает согласованность файловой системы на нескольких дисках или томах, подключенных к виртуальной машине во время процесса создания моментального снимка. Это означает, что согласованность приложений во время создания моментального снимка должна доставляться приложением, в данном случае SAP HANA само по себе. [Примечание SAP 2039883](https://launchpad.support.sap.com/#/notes/2039883) содержит важную информацию о SAP HANA резервных копий моментальными снимками хранилища. Например, при использовании файловых систем XFS необходимо выполнить **XFS \_ Freeze** перед запуском моментального снимка хранилища, чтобы обеспечить согласованность приложений (Дополнительные сведения о **XFS \_ замораживании** см. в разделе [XFS \_ Freeze (8) — на справочной странице Linux](https://linux.die.net/man/8/xfs_freeze) ).

Ниже приведены действия для создания согласованного моментального снимка, представляющего область данных HANA, в сценарии, когда файловая система XFS охватывает четыре виртуальных диска Azure.

1. Подготовка моментального снимка данных HANA
1. Закрепление файловых систем всех дисков и томов (например, использование **XFS \_ Freeze**)
1. Создайте все необходимые моментальные снимки больших двоичных объектов в Azure.
1. Освободите файловую систему.
1. Подтвердите моментальный снимок данных HANA (удалит моментальный снимок).

При использовании возможности Azure Backup для создания резервных копий моментальных снимков, сопоставленных с приложениями, шаги #1 необходимо закодировать или создать в скрипте для скрипта, выполняемого перед созданием моментального снимка. Azure Backup служба выполнит шаги #2 и #3. Шаги #4 и #5 необходимо снова предоставить в коде скрипта, выполняемого после моментального снимка. Если вы не используете службу архивации Azure, вам также потребуется выполнить действия по написанию кода и сценария #2 и #3.
Дополнительные сведения о создании моментальных снимков данных HANA можно найти в следующих статьях:

- [Моментальные снимки данных HANA] (https://help.sap.com/viewer/6b94445c94ae495c83a19646e7c3fd56/2.0.04/en-US/ac114d4b34d542b99bc390b34f8ef375.html
- Дополнительные сведения для выполнения шага #1 можно найти в статье [Создание моментального снимка данных (собственный SQL)](https://help.sap.com/viewer/6b94445c94ae495c83a19646e7c3fd56/2.0.04/en-US/9fd1c8bb3b60455caa93b7491ae6d830.html) . 
- Сведения для подтверждения или удаления моментальных снимков данных HANA, необходимых в шаге #5 можно найти в статье [Создание моментального снимка данных (собственный SQL)](https://help.sap.com/viewer/6b94445c94ae495c83a19646e7c3fd56/2.0.04/en-US/9fd1c8bb3b60455caa93b7491ae6d830.html) 

Очень важно подтвердить моментальный снимок HANA. В режиме подготовки моментального снимка системе SAP HANA может потребоваться дополнительное дисковое пространство, так как этот процесс сопровождается &quot;копированием при записи&quot;. Кроме того, вы также не сможете запустить новое резервное копирование до подтверждения моментального снимка SAP HANA.


### <a name="sap-hana-backup-scheduling-strategy"></a>Стратегия планирования резервного копирования SAP HANA

В SAP HANA статье [планирование стратегии резервного копирования и восстановления](https://help.sap.com/saphelp_hanaplatform/helpdata/en/ef/085cd5949c40b788bba8fd3c65743e/content.htm) указывается базовый план создания резервных копий. Используйте документацию SAP по HANA и опыт работы с другими СУБД в определении стратегии резервного копирования и восстановления и процесса SAP HANA. Последовательность различных типов резервных копий и срок хранения сильно зависят от соглашения об уровне обслуживания, которое необходимо предоставить.


### <a name="sap-hana-backup-encryption"></a>Шифрование резервной копии SAP HANA

SAP HANA обеспечивает шифрование данных и журнала. Если SAP HANA данные и журнал не шифруются, резервные копии по умолчанию не шифруются. Однако SAP HANA предлагает отдельное шифрование резервных копий, как описано в [SAP HANA шифровании резервных копий](https://help.sap.com/viewer/6b94445c94ae495c83a19646e7c3fd56/2.0.03/en-US/5f837a57ce5e468d9db21c8683bc84da.html). Если вы используете более старые выпуски SAP HANA, может потребоваться проверить, входит ли шифрование резервных копий в уже имеющиеся функции.  


## <a name="next-steps"></a>Дальнейшие действия
* В статье [Резервное копирование SAP HANA в Azure на уровне файлов](sap-hana-backup-file-level.md) описан вариант резервного копирования на основе файлов,
* Дополнительные сведения об обеспечении высокого уровня доступности и планировании аварийного восстановления SAP HANA в Azure (крупные экземпляры) см. в [этой статье](hana-overview-high-availability-disaster-recovery.md).
