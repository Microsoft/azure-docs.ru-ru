---
title: Доступность SAP HANA в разных регионах Azure | Документация Майкрософт
description: Обзор рекомендаций по обеспечению доступности при запуске SAP HANA на виртуальных машинах Azure в разных регионах Azure.
services: virtual-machines-linux,virtual-machines-windows
documentationcenter: ''
author: msjuergent
manager: patfilot
editor: ''
tags: azure-resource-manager
keywords: ''
ms.service: virtual-machines-sap
ms.topic: article
ms.tgt_pltfrm: vm-linux
ms.workload: infrastructure
ms.date: 09/12/2018
ms.author: juergent
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: f925e72493a94bcdbde64bdfbcef6acf83977f52
ms.sourcegitcommit: b4647f06c0953435af3cb24baaf6d15a5a761a9c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/02/2021
ms.locfileid: "101669734"
---
# <a name="sap-hana-availability-across-azure-regions"></a>Доступность SAP HANA в разных регионах Azure

В этой статье описаны сценарии, связанные с доступностью SAP HANA в разных регионах Azure. Из-за расстояния между регионами Azure при настройке доступности SAP HANA в нескольких регионах следует учитывать соответствующие рекомендации.

## <a name="why-deploy-across-multiple-azure-regions"></a>Причины выполнения развертывания в нескольких регионах Azure

Регионы Azure часто разделены большим расстоянием. В зависимости от геополитического региона, расстояние между регионами Azure может составлять сотни или даже несколько тысяч километров, как, например, в США. В связи с расстоянием при передаче трафика между ресурсами, развернутыми в двух разных регионах Azure, может происходить существенная задержка кругового пути. Настолько значительная, что предотвращает синхронный обмен данными между двумя экземплярами SAP HANA при обычных рабочих нагрузках SAP. 

С другой стороны, организации часто устанавливают условия к расстоянию между расположением основного и дополнительного центра обработки данных. Такие условия помогают поддерживать доступность на случай возникновения стихийного бедствия, охватывающего более широкую территорию. Например, ураганы, обрушившиеся на Карибские острова и Флориду в сентябре и октябре 2017 г. У вашей организации могут быть по крайней мере минимальные требования к расстоянию. Из-за этого для большинства клиентов Azure необходимо планировать развертывание так, чтобы обеспечить доступность между [регионами Azure](https://azure.microsoft.com/regions/). Так как расстояние между двумя регионами Azure слишком большое для использования режима синхронной репликации HANA, в соответствии с требованиями к целевым времени (RTO) и точке восстановления (RPO) вам может потребоваться развернуть конфигурации доступности в пределах одного региона, а затем выполнить дополнительные развертывания в другом регионе.

Другим аспектом, который следует учитывать в этом случае, является отработка отказа и перенаправление клиентов. Предполагается, что отработка отказа между экземплярами SAP HANA в двух разных регионах Azure всегда осуществляется вручную. Так как используется асинхронный режим репликации системы SAP HANA, есть вероятность, что данные, зафиксированные в основном экземпляре HANA, еще не зафиксированы на дополнительном экземпляре HANA. Таким образом, для конфигураций, где репликация выполняется асинхронно, автоматический переход на другой ресурс невозможен. Даже при отработке отказа с управлением вручную, как при тестировании, вам необходимо принять меры, чтобы убедиться, что все зафиксированные данные в основном экземпляре перенесены на дополнительный экземпляр, и только после этого вручную выполнять перемещение в другой регион Azure.
 
Виртуальная сеть Azure использует другой диапазон IP-адресов. IP-адреса развернуты в другом регионе Azure. Поэтому нужно внести изменения в конфигурацию клиента SAP HANA или, что будет лучшим способом, настроить замену разрешения имен. Таким образом, клиенты перенаправляются на IP-адрес сервера в дополнительном регионе. Дополнительные сведения см. в статье SAP о [восстановлении клиентского соединения после перенаправления](https://help.sap.com/doc/6b94445c94ae495c83a19646e7c3fd56/2.0.02/en-US/c93a723ceedc45da9a66ff47672513d3.html).   

## <a name="simple-availability-between-two-azure-regions"></a>Простая доступность между двумя регионами Azure

Вы можете не устанавливать конфигурацию доступности в одном регионе, однако вам все еще требуется обработка рабочей нагрузки в случае аварии. Обычными вариантами для таких сценариев являются непроизводственные системы. Хотя система может находиться в нерабочем состоянии полдня или даже весь день, нельзя допускать, чтобы это длилось больше 48 часов. Чтобы установка была менее затратной, запустите другую менее важную систему на виртуальной машине. Другая система работает в качестве назначения. Кроме того, вы можете создать виртуальную машину меньшего размера в дополнительном регионе и отказаться от предварительной загрузки данных. Так как отработка отказа выполняется вручную и влечет за собой еще много действий по обработке отказа всего стека приложений, дополнительное время, требуемое на отключение виртуальной машины, изменение ее размера и повторный запуск приемлемо.

Если вы применяете сценарий совместного использования целевого объекта аварийного восстановления с системой контроля качества на виртуальной машине, необходимо учитывать следующее:

- Для этого сценария доступны два [режимы работы](https://help.sap.com/viewer/6b94445c94ae495c83a19646e7c3fd56/2.0.02/en-US/627bd11e86c84ec2b9fcdf585d24011c.html) — delta_datashipping и logreplay.
- Оба режима работы имеют разные требования к памяти без предварительной загрузки данных.
- Delta_datashipping может требовать значительно меньше памяти без предварительной загрузки, чем logreplay. См. раздел 4.3 документа SAP [Как выполнить репликацию системы для SAP HANA](https://archive.sap.com/kmuuid2/9049e009-b717-3110-ccbd-e14c277d84a3/How%20to%20Perform%20System%20Replication%20for%20SAP%20HANA.pdf)
- Требования к памяти режима работы logreplay без предварительной загрузки не являются детерминированными и зависят от загруженных структур columnstore. В крайних случаях может потребоваться 50 % памяти первичного экземпляра. Память для режима работы logreplay не зависит от настройки предварительной загрузки данных.


![Схема двух виртуальных машин в двух регионах](./media/sap-hana-availability-two-region/two_vm_HSR_async_2regions_nopreload.PNG)

> [!NOTE]
> В этой конфигурации вы не можете задать значение 0 для целевой точки восстановления (RPO), так как режим системы репликации HANA является асинхронным. Если все же необходимо это сделать, выберите другую конфигурацию.

Вы можете внести небольшое изменение в конфигурацию — настроить предварительную загрузку данных. Однако, учитывая то, что отработка отказа проводится вручную, а прикладные уровни также нужно переместить в другой регион, это может быть нецелесообразно. 

## <a name="combine-availability-within-one-region-and-across-regions"></a>Объединение доступности в пределах одного или нескольких регионов 

Объединение доступности в нескольких регионах может быть обусловлено следующими факторами:

- В регионе Azure в качестве целевой точки восстановления должно быть задано значение 0.
- Недопустимо, чтобы глобальным операциям организации мешало стихийное бедствие, охватывающее большой регион. Как в случае с ураганами, которые обрушивались на Карибские острова за последние несколько лет.
- Нормативы, требующие такого расстояния между основным и дополнительным регионами, которое выходит за рамки возможного зон доступности Azure.

В таких случаях вы можете настроить для SAP [конфигурацию многоуровневой репликации системы SAP HANA](https://help.sap.com/viewer/6b94445c94ae495c83a19646e7c3fd56/2.0.02/en-US/ca6f4c62c45b4c85a109c7faf62881fc.html). Архитектура выглядит следующим образом:

![Схема трех виртуальных машин в двух регионах](./media/sap-hana-availability-two-region/three_vm_HSR_async_2regions_ha_and_dr.PNG)

Компания SAP представила [многоцелевую систему репликации](https://help.sap.com/viewer/42668af650f84f9384a3337bcd373692/2.0.03/en-US/0b2c70836865414a8c65463180d18fec.html) с поддержкой HANA 2.0 SPS3. Многоцелевая система репликации обеспечивает ряд преимуществ в сценариях обновления. Например, когда второй сайт HA не работает из-за обновлений или обслуживания, это не влияет на сайт DR (регион 2). Дополнительные сведения о многоцелевой системе репликации HANA можно найти [здесь](https://help.sap.com/viewer/6b94445c94ae495c83a19646e7c3fd56/2.0.03/en-US/ba457510958241889a459e606bbcf3d3.html).
Возможная архитектура с многоцелевой репликацией будет выглядеть следующим образом.

![Схема трех виртуальных машин в двух многоцелевых регионах](./media/sap-hana-availability-two-region/saphanaavailability_hana_system_2region_HA_and_DR_multitarget_3VMs.PNG)

Если у организации есть требования относительно готовности высокого уровня доступности во втором (DR) регионе Azure, архитектура будет выглядеть следующим образом.

![Схема, на которой показана организация с требованиями к обеспечению высокого уровня доступности во втором регионе Azure (DR).](./media/sap-hana-availability-two-region/saphanaavailability_hana_system_2region_HA_and_DR_multitarget_4VMs.PNG)


При использовании logreplay в качестве режима работы эта конфигурация обеспечивает значение RPO 0 с низким целевым временем восстановления (RTO) в пределах основного региона. Она также предоставляет сниженный показатель RPO, если выполняется перемещение в другой регион. Время RTO второго региона зависит от того, выполняется ли предварительная загрузка данных. Многие клиенты используют виртуальную машину в дополнительном регионе, чтобы запустить тестовую систему. В таком варианте использования данные не могут быть предварительно загружены.

> [!IMPORTANT]
> Режимы работы на различных уровнях должны быть одинаковыми. **Нельзя** использовать режим работы logreply на уровнях 1 и 2 и delta_datashipping на уровне 3. Можно выбрать только один режим работы для всех уровней. Поскольку delta_datashipping не обеспечивает показатель RPO, равный 0, для многоуровневой конфигурации следует использовать только режим работы logreplay. Подробные сведения о режимах работы при репликации системы SAP HANA и некоторые ограничения см. в [этой статье](https://help.sap.com/viewer/6b94445c94ae495c83a19646e7c3fd56/2.0.02/en-US/627bd11e86c84ec2b9fcdf585d24011c.html). 

## <a name="next-steps"></a>Дальнейшие действия

Пошаговое руководство по настройке этих конфигураций в Azure см. в следующих статьях:

- [Высокий уровень доступности SAP HANA на виртуальных машинах Azure](sap-hana-high-availability.md)
- [Your SAP on Azure – Part 4 – High Availability for SAP HANA using System Replication](https://blogs.sap.com/2018/01/08/your-sap-on-azure-part-4-high-availability-for-sap-hana-using-system-replication/) (SAP в Azure (часть 4). Настройка высокого уровня доступности SAP HANA путем использования репликации системы)

 



 
  
