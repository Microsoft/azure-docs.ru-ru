---
title: Масштабирование приложений HPC с виртуальными машинами Azure | Документация Майкрософт
description: Узнайте, как масштабировать приложения HPC на виртуальных машинах Azure.
author: vermagit
ms.service: virtual-machines
ms.subservice: hpc
ms.topic: article
ms.date: 05/15/2019
ms.author: amverma
ms.reviewer: cynthn
ms.openlocfilehash: d560b261e058d01040616f3c59ede60e5986c672
ms.sourcegitcommit: b4647f06c0953435af3cb24baaf6d15a5a761a9c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/02/2021
ms.locfileid: "101666979"
---
# <a name="scaling-hpc-applications"></a>Масштабирование приложений HPC

Оптимальное масштабирование и масштабирование производительности приложений HPC в Azure требуют экспериментов по настройке и оптимизации производительности для конкретной рабочей нагрузки. Этот раздел и страницы, относящиеся к ряду виртуальных машин, содержат общие рекомендации по масштабированию приложений.

## <a name="compiling-applications"></a>Компиляция приложений

Несмотря на то, что компиляция приложений с соответствующими флагами оптимизации обеспечивает наилучшую производительность для виртуальных машин серии ХБ и HC.

### <a name="amd-optimizing-cc-compiler"></a>Оптимизирующий компилятор AMD с/C++

Система компилятора с оптимизацией на C/C++ Compiler (АОКК) обеспечивает высокий уровень расширенной оптимизации, многопоточности и поддержки процессоров, которая включает в себя глобальную оптимизацию, векторную обработку, межпроцедурный анализ, преобразования циклов и создание кода. Двоичные файлы компилятора АОКК подходят для систем Linux с библиотекой GNU C Library (glibc) версии 2,17 и выше. Набор компиляторов состоит из компилятора C/C++ (Clang), компилятора Fortran (ФЛАНГ) и внешнего интерфейса Fortran в Clang (Dragon Egg).

### <a name="clang"></a>Clang

Clang — компилятор C, C++ и цель-C, обрабатывающий предварительную обработку, синтаксический анализ, оптимизацию, создание кода, сборку и компоновку. Clang поддерживает  `-march=znver1` флаг для обеспечения наилучшего создания и настройки кода для архитектуры x86 на основе Zen.

### <a name="flang"></a>фланг

Компилятор ФЛАНГ является последним дополнением к АОКК Suite (Добавлено 2018 апреля) и в настоящее время находится в предварительной версии для разработчиков, которые могут скачать и протестировать. Основываясь на Fortran 2008, AMD расширяет версию GitHub ФЛАНГ ( https://github.com/flang-compiler/flang) . Компилятор ФЛАНГ поддерживает все параметры компилятора Clang и дополнительное число параметров компилятора, характерных для ФЛАНГ.

### <a name="dragonegg"></a>драгонегг

Драгонегг — это подключаемый модуль GCC, который заменяет оптимизаторы и генераторы кода GCC из проекта LLVM. Драгонегг, входящий в состав АОКК, работает с gcc-4.8. x, проверен на наличие целевых платформ x86-32/x86-64 и успешно использовался на различных платформах Linux.

Гфортран — это фактический интерфейс для программ Fortran, отвечающих за предварительную обработку, анализ и семантический анализ, создающие промежуточное представление GCC ГИМПЛЕ (IR). Драгонегг — это подключаемый модуль GNU, подключаемый к потоку компиляции Гфортран. Он реализует API подключаемого модуля GNU. Благодаря архитектуре подключаемых модулей Драгонегг преобразуется в драйвер компилятора, что приводит к различным этапам компиляции.  После выполнения инструкций по загрузке и установке Dragon Egg можно вызвать с помощью: 

```bash
$ gfortran [gFortran flags] 
   -fplugin=/path/AOCC-1.2-Compiler/AOCC-1.2-     
   FortranPlugin/dragonegg.so [plugin optimization flags]     
   -c xyz.f90 $ clang -O3 -lgfortran -o xyz xyz.o $./xyz
```
   
### <a name="pgi-compiler"></a>Компилятор PGI
PGI Community Edition ver. 17 подтверждена работа с AMD ЕПИК. PGI-скомпилированная версия потока обеспечивает полную пропускную способность памяти платформы. Более новая версия Community Edition 18,10 (Ноя 2018) также должна работать правильно. Ниже приведен пример инфраструктуры CLI для оптимального использования компилятором Intel:

```bash
pgcc $(OPTIMIZATIONS_PGI) $(STACK) -DSTREAM_ARRAY_SIZE=800000000 stream.c -o stream.pgi
```

### <a name="intel-compiler"></a>Компилятор Intel
Intel Compiler ver. 18 подтверждена работа с AMD ЕПИК. Ниже приведен пример интерфейса командной строки для оптимального использования компилятором Intel.

```bash
icc -o stream.intel stream.c -DSTATIC -DSTREAM_ARRAY_SIZE=800000000 -mcmodel=large -shared-intel -Ofast –qopenmp
```

### <a name="gcc-compiler"></a>Компилятор GCC 
Для HPC AMD рекомендует компилятору GCC 7,3 или более поздней версии. Более старые версии, например 4.8.5, входящие в состав RHEL/CentOS 7,4, не рекомендуются. GCC 7,3 и более поздние версии обеспечивают значительно более высокую производительность тестов ХПЛ, ХПКГ и ДЖЕММ.

```bash
gcc $(OPTIMIZATIONS) $(OMP) $(STACK) $(STREAM_PARAMETERS) stream.c -o stream.gcc
```

## <a name="scaling-applications"></a>Масштабирование приложений 

Следующие рекомендации относятся к оптимальной эффективности масштабирования приложений, производительности и согласованности.

* Закрепите процессы для ядер 0-59 с помощью последовательного метода закрепления (в отличие от подхода автоматической балансировки). 
* Привязка NUMA/Core/Хвсреад лучше, чем привязка по умолчанию.
* Для гибридных параллельных приложений (OpenMP + MPI) используйте 4 потока и 1 ранг MPI на КККС.
* Для чистых приложений MPI поэкспериментируйте с 1-4ными рангами MPI на КККС для обеспечения оптимальной производительности.
* Некоторые приложения с крайней чувствительностью к пропускной способности памяти могут использовать меньшее количество ядер на КККС. Для этих приложений использование 3 или 2 ядер на КККС может уменьшить количество конфликтов с пропускной способностью памяти и повышает производительность в реальном мире или более последовательную масштабируемость. В частности, MPI онлайн-обучение может выиграть от этого.
* Для выполнения значительно большего масштаба рекомендуется использовать обновления или гибридные транспорты RC + обновления. Многие библиотеки MPI и библиотеки времени выполнения выполняют это внутренне (например, УККС или MVAPICH2). Проверьте конфигурации транспорта для крупномасштабных запусков.

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения о [HPC](/azure/architecture/topics/high-performance-computing/) в Azure.
