---
title: Эталонные архитектуры для баз данных Oracle в Azure | Документация Майкрософт
description: Ссылается на архитектуры для запуска Oracle Database Enterprise Edition баз данных на Виртуальные машины Microsoft Azure.
author: dbakevlar
ms.service: virtual-machines
ms.subservice: oracle
ms.collection: linux
ms.topic: article
ms.date: 12/13/2019
ms.author: kegorman
ms.openlocfilehash: 6bce6f011086d9855c4da2739addbb34e661e2d6
ms.sourcegitcommit: 15d27661c1c03bf84d3974a675c7bd11a0e086e6
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/09/2021
ms.locfileid: "102507489"
---
# <a name="reference-architectures-for-oracle-database-enterprise-edition-on-azure"></a>Эталонные архитектуры для Oracle Database Enterprise Edition в Azure

В этом пошаговом руководству содержатся сведения о развертывании базы данных Oracle высокой доступности в Azure. Кроме того, это руководством подробно к вопросам аварийного восстановления. Эти архитектуры были созданы на основе развертываний клиентов. Это руководством применимо только к Oracle Database Enterprise Edition.

Если вы хотите узнать больше о максимальном увеличении производительности базы данных Oracle, см. статью [проектирование Oracle DB](oracle-design.md).

## <a name="assumptions"></a>Предположения

- Вы имеете представление о различных концепциях Azure, таких как [зоны доступности](../../../availability-zones/az-overview.md) .
- Вы используете Oracle Database Enterprise Edition 12c или более поздней версии
- При использовании решений, описанных в этой статье, вы узнаете о последствиях лицензирования и их подтверждении.

## <a name="high-availability-for-oracle-databases"></a>Высокий уровень доступности для баз данных Oracle

Достижение высокого уровня доступности в облаке является важной частью планирования и проектирования каждой организации. Microsoft Azure предлагает [зоны доступности](../../../availability-zones/az-overview.md) и группы доступности (которые будут использоваться в регионах, где зоны доступности недоступны). Узнайте больше об [управлении доступностью виртуальных машин](../../availability.md) для проектирования в облаке.

Помимо собственных средств и предложений в облаке, Oracle предоставляет решения для обеспечения высокого уровня доступности, например [Oracle Data Guard](https://docs.oracle.com/en/database/oracle/oracle-database/18/sbydb/introduction-to-oracle-data-guard-concepts.html#GUID-5E73667D-4A56-445E-911F-1E99092DD8D7), [Data Guard с фсфо](https://docs.oracle.com/en/database/oracle/oracle-database/12.2/dgbkr/index.html), [сегментирование](https://docs.oracle.com/en/database/oracle/oracle-database/12.2/admin/sharding-overview.html)и [GoldenGate](https://www.oracle.com/middleware/technologies/goldengate.html) , которые можно настроить в Azure. В этом руководстве описываются эталонные архитектуры для каждого из этих решений.

Наконец, при переносе или создании приложений для облака важно настроить код приложения для добавления собственных шаблонов в облаке, таких как [шаблон повтора](/azure/architecture/patterns/retry) и [шаблон автоматического прерывания](/azure/architecture/patterns/circuit-breaker). Дополнительные шаблоны, определенные в статье [руководство по шаблонам проектирования облачных](/azure/architecture/patterns/) приложений, могут помочь повысить устойчивость вашего приложения.

### <a name="oracle-rac-in-the-cloud"></a>Oracle RAC в облаке

Кластер реальных приложений Oracle (RAC) — это решение Oracle, которое помогает клиентам достичь высокой пропускной способности, поскольку многие экземпляры обращаются к одному хранилищу базы данных (общий шаблон архитектуры). Хотя RAC Oracle также можно использовать для обеспечения высокой доступности в локальной среде, нельзя использовать единственную единственную доступность Oracle для обеспечения высокого уровня доступности в облаке, так как она обеспечивает только защиту от сбоев на уровне экземпляра, а не на уровне стойки или центров обработки данных. По этой причине Oracle рекомендует использовать Oracle Data Guard с базой данных (для обеспечения высокой доступности — единственный экземпляр или RAC). Клиентам обычно требуется высокое соглашение об уровне обслуживания для выполнения критически важных приложений. База Oracle RAC в настоящее время не сертифицирована или не поддерживается Oracle в Azure. Тем не менее Azure предлагает такие функции, как Azure, которые предоставляют Зоны доступности и плановые периоды обслуживания для защиты от сбоев на уровне экземпляра. Помимо этого, клиенты могут использовать такие технологии, как Oracle Data Guard, Oracle GoldenGate и Oracle сегментирование для обеспечения высокой производительности и устойчивости, защищая свои базы данных от уровня стойки, а также со сбоями на уровне центра обработки данных и географическими ошибками.

При работе с базами данных Oracle в нескольких [зонах доступности](../../../availability-zones/az-overview.md) совместно с Oracle Data Guard или GoldenGate клиенты могут получить соглашение об уровне обслуживания со временем доступности 99,99%. В регионах Azure, где зоны доступности еще не установлены, клиенты могут использовать [группы доступности](../../availability-set-overview.md) и достичь соглашения об уровне обслуживания на 99,95%.

>Примечание. у вас может быть цель бесперебойной работы, которая намного выше, чем соглашение об уровне обслуживания, предоставляемое корпорацией Майкрософт.

## <a name="disaster-recovery-for-oracle-databases"></a>Аварийное восстановление для баз данных Oracle

При размещении критически важных приложений в облаке важно разработать высокий уровень доступности и аварийное восстановление.

Для Oracle Database Enterprise Edition Oracle Data Guard является полезной функцией аварийного восстановления. Вы можете настроить резервный экземпляр базы данных в [парном регионе Azure](../../../best-practices-availability-paired-regions.md) и настроить отработку отказа Data Guard для аварийного восстановления. Для нулевой потери данных рекомендуется развернуть экземпляр синхронизации Oracle Data Guard в дополнение к активному Data Guard. 

Рекомендуется настроить экземпляр дальней синхронизации Data Guard в другой зоне доступности, чем база данных-источник Oracle, если приложение допускает задержку (требуется тщательное тестирование). Используйте режим **максимальной доступности** , чтобы настроить синхронное передвижение файлов повтора в экземпляр дальней синхронизации. Затем эти файлы передаются асинхронно в резервную базу данных. 

Если приложение не допускает потери производительности при настройке экземпляра дальней синхронизации в другой зоне доступности в режиме **максимальной доступности** (синхронный), вы можете настроить экземпляр дальней синхронизации в той же зоне доступности, что и база данных-источник. Чтобы получить дополнительную доступность, рассмотрите возможность настройки нескольких экземпляров синхронизации, близкого к базе данных-источнику, и по крайней мере одного экземпляра, близкого к резервной базе данных (при переходе роли). Дополнительные сведения о значительной синхронизации Oracle Data Guard в этом [техническом документе по синхронизации данных Oracle Active Data Guard](https://www.oracle.com/technetwork/database/availability/farsync-2267608.pdf).

При использовании баз данных Oracle Standard Edition существуют решения ISV, такие как Дбвисит Standby, которые позволяют настроить высокий уровень доступности и аварийное восстановление.

## <a name="reference-architectures"></a>Эталонные архитектуры

### <a name="oracle-data-guard"></a>Oracle Data Guard

Oracle Data Guard обеспечивает высокий уровень доступности, защиту данных и аварийное восстановление для корпоративных данных. Data Guard поддерживает резервные базы данных как транзакционно согласованные копии базы данных источника. В зависимости от расстояния между базой данных-источником и сервером-получателем и отклонением приложения для задержки можно настроить синхронную или асинхронную репликацию. Затем, если база данных-источник недоступна из-за запланированного или незапланированного сбоя, Data Guard может переключить любую резервную базу данных на основную роль, минимизируя время простоя. 

При использовании Oracle Data Guard вы также можете открыть базу данных-получатель для целей только для чтения. Эта конфигурация называется Active Data Guard. Oracle Database 12c представил функцию, именуемую экземпляром дальней синхронизации Data Guard. Этот экземпляр позволяет настроить автоматическую настройку потери данных базы данных Oracle, не нарушая производительность.

> [!NOTE]
> Для использования активного Data Guard требуется дополнительное лицензирование. Эта лицензия также необходима для использования функции дальней синхронизации. Обратитесь к своему торговому представителя Oracle, чтобы обсудить последствия лицензирования.

#### <a name="oracle-data-guard-with-fsfo"></a>Oracle Data Guard с ФСФО
Oracle Data Guard с Fast-Start отработкой отказа (ФСФО) может обеспечить дополнительную устойчивость, настроив брокер на отдельном компьютере. Брокер Data Guard и база данных-получатель запускают наблюдатель и отключают базу данных-источник на время простоя. Это обеспечивает также избыточность в программе установки наблюдателя Data Guard. 

При использовании Oracle Database версии 12,2 и выше можно также настроить несколько наблюдателей с одной конфигурацией брокера Data Guard в Oracle. Эта настройка обеспечивает дополнительную доступность на случай, если один наблюдатель и база данных-получатель испытывают время простоя. Брокер Data Guard является облегченным и может размещаться на относительно небольшой виртуальной машине. Дополнительные сведения о брокере Data Guard и его преимуществах см. в [документации по Oracle](https://docs.oracle.com/en/database/oracle/oracle-database/12.2/dgbkr/oracle-data-guard-broker-concepts.html) в этой статье.

Следующая схема является рекомендуемой архитектурой для использования Oracle Data Guard в Azure с зонами доступности. Эта архитектура позволяет получить соглашение об уровне обслуживания для времени доступности виртуальной машины на 99,99%.

![Схема, на которой показана Рекомендуемая архитектура для использования Oracle Data Guard в Azure с зонами доступности.](./media/oracle-reference-architecture/oracledb_dg_fsfo_az.png)

На предыдущей схеме клиентская система обращается к пользовательскому приложению с серверной частью Oracle через Интернет. Веб-интерфейс настроен в подсистеме балансировки нагрузки. Веб-интерфейс выполняет вызов к соответствующему серверу приложений, чтобы справиться с работой. Сервер приложений запрашивает основную базу данных Oracle. База данных Oracle была настроена с использованием технологии hyperно [оптимизированной для памяти виртуальной машины](../../sizes-memory.md) с [ограниченным базовым виртуальных ЦП](../../../virtual-machines/constrained-vcpu.md) , чтобы сэкономить на стоимости лицензирования и повысить производительность. Для повышения производительности и высокой доступности используются несколько Premium или Ultra Disks (управляемые диски).

Базы данных Oracle помещаются в несколько зон доступности для обеспечения высокой доступности. Каждая зона состоит из одного или нескольких центров обработки данных, оснащенных независимыми источниками питания, охлаждения и сети. Чтобы обеспечить устойчивость, в всех включенных регионах настраивается как минимум три отдельные зоны. Физическое разделение зон доступности в пределах региона защищает данные от сбоев в центре обработки данных. Кроме того, два ФСФОных наблюдателей настраиваются в двух зонах доступности для инициации и отработки отказа базы данных на сервер-получатель при возникновении сбоя. 

Вы можете настроить дополнительные наблюдатели и (или) резервные базы данных в другой зоне доступности (AZ 1, в данном случае), чем зона, показанная в предыдущей архитектуре. Наконец, отслеживаются базы данных Oracle для бесперебойной работы и производительности с помощью Oracle Enterprise Manager (OEM). Изготовитель оборудования также позволяет создавать различные отчеты о производительности и использовании.

В регионах, где зоны доступности не поддерживаются, группы доступности можно использовать для развертывания Oracle Database в высокодоступном режиме. Группы доступности позволяют достичь бесперебойной работы виртуальной машины 99,95%. На следующей схеме показана Эталонная архитектура этого использования:

![Oracle Database использование групп доступности с брокером Data Guard — ФСФО](./media/oracle-reference-architecture/oracledb_dg_fsfo_as.png)

> [!NOTE]
> * Виртуальную машину Oracle Enterprise Manager не нужно размещать в группе доступности, так как в ней развертываются только один экземпляр OEM.
> * В настоящее время в конфигурации группы доступности не поддерживаются диски Ultra.

#### <a name="oracle-data-guard-far-sync"></a>Синхронизация данных Oracle Data Guard в значительной мере

Синхронная синхронизация Oracle Data Guard обеспечивает возможность защиты от потери данных для баз данных Oracle. Эта возможность позволяет защититься от потери данных в случае сбоя компьютера базы данных. На отдельной виртуальной машине необходимо установить более синхронную синхронизацию Oracle Data Guard. Непрерывная синхронизация — это упрощенный экземпляр Oracle, который содержит только управляющий файл, файл пароля, файл журнала и резервные журналы. Нет файлов данных или файлов журнала Рего. 

Для защиты от потери данных должна быть синхронная связь между базой данных источника и экземпляром дальней синхронизации. Экземпляр дальней синхронизации получает повторы из базы данных-источника в синхронном режиме и передает его сразу всем резервным серверам в асинхронном режиме. Эта установка также сокращает затраты на базу данных-источник, так как она должна отправить повтор только в экземпляр дальней синхронизации, а не во всех резервных базах данных. Если происходит сбой экземпляра дальней синхронизации, Data Guard автоматически использует асинхронный транспорт для базы данных-получателя из базы данных-источника для поддержания защиты от потери данных практически нуля. Для повышения устойчивости клиенты могут развертывать несколько экземпляров дальней синхронизации на каждый экземпляр базы данных (первичный и вторичный).

На следующей схеме показана архитектура высокого уровня доступности с использованием синхронизации данных Oracle Data Guard.

![База данных Oracle с использованием зон доступности с дальней синхронизацией Data Guard & Broker — ФСФО](./media/oracle-reference-architecture/oracledb_dg_fs_az.png)

В предыдущей архитектуре экземпляр синхронизации разворачивается в той же зоне доступности, что и экземпляр базы данных, чтобы уменьшить задержку между ними. В случаях, когда приложение чувствительно к задержке, рассмотрите возможность развертывания базы данных и более длительной синхронизации экземпляров или экземпляров в [группе размещения](../../../virtual-machines/linux/proximity-placement-groups.md)с учетом расположения.

На следующей схеме показана архитектура, использующая Oracle Data Guard ФСФО и большую синхронизацию для обеспечения высокого уровня доступности и аварийного восстановления.

![Oracle Database использование зон доступности для аварийного восстановления с помощью Service Guard в & Broker — ФСФО](./media/oracle-reference-architecture/oracledb_dg_fs_az_dr.png)

### <a name="oracle-goldengate"></a>Oracle GoldenGate

GoldenGate обеспечивает обмен данными и их обработку на уровне транзакций на нескольких разнородных платформах в масштабах предприятия. Он перемещает зафиксированные транзакции с целостностью транзакций и минимальными затратами на существующую инфраструктуру. Его модульная архитектура дает возможность извлекать и реплицировать выбранные записи данных, изменения транзакций и изменения DDL (языка описания данных) в различных топологиях.

Oracle GoldenGate позволяет настроить высокую доступность базы данных, предоставляя двунаправленную репликацию. Это позволяет настроить конфигурацию с **несколькими хозяевами** или с **конфигурацией "активный — активный**". Следующая схема является рекомендуемой архитектурой для программы установки Oracle GoldenGate "активный — активный" в Azure. В следующей архитектуре база данных Oracle была настроена с использованием технологии hyperно [оптимизированной для памяти виртуальной машины](../../sizes-memory.md) с [ограниченными базовыми виртуальных ЦП](../../../virtual-machines/constrained-vcpu.md) , чтобы сэкономить на стоимости лицензирования и повысить производительность. Для повышения производительности и доступности используются несколько расширенных или Ultra дисков (управляемые диски).

![Oracle Database использование зон доступности с брокером Data Guard — ФСФО](./media/oracle-reference-architecture/oracledb_gg_az.png)

> [!NOTE]
> Аналогичную архитектуру можно настроить с помощью групп доступности в регионах, где зоны доступности в настоящее время недоступны.

Oracle GoldenGate содержит такие процессы, как извлечение, насос и репликация, которые помогают выполнять асинхронную репликацию данных с одного сервера базы данных Oracle на другой. Эти процессы позволяют настроить двунаправленную репликацию для обеспечения высокой доступности базы данных в случае простоя уровня зоны доступности. На предыдущей схеме процесс извлечения выполняется на том же сервере, что и база данных Oracle, в то время как процессы сбора данных и репликации выполняются на отдельном сервере в той же зоне доступности. Процесс репликации используется для получения данных из базы данных в другой зоне доступности и фиксации данных в базе данных Oracle в своей зоне доступности. Аналогичным образом процесс приема данных отправляет данные, извлеченные процессом репликации в процесс репликаций в другой зоне доступности. 

Хотя на предыдущей схеме архитектуры показан процесс сбора данных и репликация, настроенная на отдельном сервере, вы можете настроить все процессы Oracle GoldenGate на одном сервере, исходя из емкости и использования вашего сервера. Всегда проконсультируйтесь с отчетами AWR и метриками в Azure, чтобы понять схему использования сервера.

При настройке двунаправленной репликации Oracle GoldenGate в разных зонах доступности или в разных регионах важно убедиться, что задержка между различными компонентами приемлема для вашего приложения. Задержка между зонами и регионами доступности может быть различной и зависит от нескольких факторов. Рекомендуется настроить тесты производительности между уровнем приложения и уровнем базы данных в разных зонах доступности и (или) регионах, чтобы убедиться, что он соответствует требованиям к производительности приложения.

Уровень приложения можно настроить в собственной подсети, а уровень базы данных можно разделить на отдельную подсеть. По возможности рекомендуется использовать [шлюз приложений Azure](../../../application-gateway/overview.md) для балансировки нагрузки трафика между серверами приложений. Шлюз приложений Azure — это надежный балансировщик нагрузки на веб-трафик. Он обеспечивает сходство сеансов на основе файлов cookie, сохраняющее сеанс пользователя на том же сервере, тем самым минимизируя конфликты в базе данных. В качестве альтернативы шлюзу приложений можно [Azure Load Balancer](../../../load-balancer/load-balancer-overview.md) и [диспетчер трафика Azure](../../../traffic-manager/traffic-manager-overview.md).

### <a name="oracle-sharding"></a>Сегментирование Oracle

Сегментирование — это шаблон уровня данных, который появился в Oracle 12,2. Она позволяет горизонтально секционировать и масштабировать данные в независимых базах данных. Это архитектура Share-Nothing, где каждая база данных размещается на выделенной виртуальной машине, что обеспечивает высокую пропускную способность чтения и записи в дополнение к устойчивости и повышению уровня доступности. Этот шаблон устраняет единые точки отказа, обеспечивает изоляцию сбоев и позволяет выполнять последовательные обновления без простоев. Время простоя одного сегмента или сбоя на уровне центра обработки данных не влияет на производительность или доступность других сегментов в других центрах обработки данных. 

Сегментирование подходит для приложений OLTP с высокой пропускной способностью, которые не могут позволить какой-либо простой. Все строки с одинаковым ключом сегментирования всегда будут находиться в одном сегменте, что повышает производительность, обеспечивая высокую согласованность. Приложения, использующие сегментирование, должны иметь четко определенную модель данных и стратегию распределения данных (постоянный хэш, диапазон, список или составной объект), который в основном обращается к данным с помощью ключа сегментирования (например, *customerId* или *accountNum*). Сегментирование также позволяет хранить определенные наборы данных ближе к конечным клиентам, тем самым помогая удовлетворить требования к производительности и соответствию.

Рекомендуется выполнять репликацию сегментов для обеспечения высокой доступности и аварийного восстановления. Эту настройку можно выполнить с помощью технологий Oracle, таких как Oracle Data Guard или Oracle GoldenGate. Единицей репликации может быть сегмент, часть сегмента или группа сегментов. Доступность сегментированной базы данных не зависит от сбоя или замедления одного или нескольких сегментов. Для обеспечения высокой доступности резервные сегменты могут размещаться в той же зоне доступности, в которой размещаются основные сегменты. В случае аварийного восстановления сегменты резервного режима могут находиться в другом регионе. Вы также можете развернуть сегменты в нескольких регионах для обслуживания трафика в этих регионах. Узнайте больше о настройке высокого уровня доступности и репликации сегментированной базы данных в [документации по сегментированию Oracle](https://docs.oracle.com/en/database/oracle/oracle-database/19/shard/sharding-high-availability.html).

Сегментирование Oracle в основном состоит из следующих компонентов. Дополнительные сведения об этих компонентах можно найти в [документации по сегментированию Oracle](https://docs.oracle.com/en/database/oracle/oracle-database/19/shard/sharding-overview.html):

- **Каталог сегментов** — база данных Oracle специального назначения, которая является постоянным хранилищем для всех данных конфигурации базы данных сегментирования. Все изменения конфигурации, такие как добавление или удаление сегментов, сопоставление данных и означающего в базе данных сегментов, инициируются в каталоге сегментов. Каталог сегментов также содержит главную копию всех повторяющихся таблиц в SDB. 

  Каталог сегментов использует материализованные представления для автоматической репликации изменений в повторяющихся таблицах во всех сегментах. База данных каталога сегментов также выступает в качестве координатора запросов, который используется для обработки запросов с несколькими сегментами и запросов, не указывающих ключ сегментирования. 
  
  Рекомендуется использовать Oracle Data Guard в сочетании с зонами доступности или группами доступности для обеспечения высокой доступности каталога сегментов. Доступность каталога сегментов не влияет на доступность сегментированной базы данных. Время простоя в каталоге сегментов влияет только на операции обслуживания и многосегментные запросы в течение короткого периода, в течение которого завершается отработка отказа Data Guard. Интерактивные транзакции по-прежнему направляются и выполняются SDB и не затрагиваются при сбое каталога.

- **Режиссеры сегментов** — облегченные службы, которые необходимо развернуть в каждой зоне региона или доступности, в которой находятся сегменты. Менеджеры по сегментированию — это глобальные Диспетчеры служб, развернутые в контексте сегментирования Oracle. Для обеспечения высокой доступности рекомендуется развернуть по крайней мере один каталог сегментов в каждой зоне доступности, в которой существуют сегменты. 

  При первоначальном подключении к базе данных сведения о маршрутизации настраиваются директором сегментов и кэшируются для последующих запросов, минуя директор сегментов. После того как сеанс установлен с помощью сегмента, все запросы SQL и выполнять DML поддерживаются и выполняются в области заданного сегмента. Эта маршрутизация выполняется быстро и используется для всех рабочих нагрузок OLTP, выполняющих транзакции внутри сегмента. Рекомендуется использовать прямую маршрутизацию для всех рабочих нагрузок OLTP, требующих наивысшей производительности и доступности. Кэш маршрутизации автоматически обновляется, когда сегмент становится недоступным или происходит изменение топологии сегментирования. 
  
  Для высокопроизводительной маршрутизации, зависящей от данных, Oracle рекомендует использовать пул соединений при доступе к данным в сегментированной базе данных. Пулы соединений Oracle, библиотеки для конкретных языков и драйверы поддерживают сегментирование Oracle. Дополнительные сведения см. в [документации по сегментированию Oracle](https://docs.oracle.com/en/database/oracle/oracle-database/19/shard/sharding-overview.html#GUID-3D41F762-BE04-486D-8018-C7A210D809F9) .

- **Глобальная служба — Глобальная** служба аналогична обычной службе базы данных. В дополнение ко всем свойствам службы базы данных, Глобальная служба имеет свойства для сегментированных баз данных, таких как сходство между клиентами и сегмента и допустимость задержки репликации. Для чтения и записи данных в сегментированную базу данных и из нее необходимо создать только одну глобальную службу. При использовании Active Data Guard и настройке реплик только для чтения сегментов можно создать другую службу Ггобал для рабочих нагрузок только для чтения. Клиент может использовать эти глобальные службы для подключения к базе данных.

- **Базы данных сегментов** . базы данных сегментов — это базы данных Oracle. Репликация каждой базы данных выполняется с помощью Oracle Data Guard в конфигурации брокера с включенной Fast-Start отработкой отказа (ФСФО). Вам не нужно настраивать отработку отказа и репликацию Data Guard в каждом сегменте. Это автоматически настраивается и развертывается при создании общей базы данных. В случае сбоя конкретного сегмента совместное использование Oracle автоматически отменяет подключение базы данных от основного к резервному.

Вы можете развертывать сегментированные базы данных Oracle и управлять ими с помощью двух интерфейсов: Диспетчер облачных средств управления для Oracle Enterprise Manager и (или `GDSCTL` ) служебной программы командной строки. Вы даже можете отслеживать различные сегменты для обеспечения доступности и производительности с помощью облачного управления. `GDSCTL DEPLOY`Команда автоматически создает сегменты и соответствующие им прослушиватели. Кроме того, эта команда автоматически развертывает конфигурацию репликации, которая используется для обеспечения высокого уровня доступности на уровне сегментов, заданного администратором.

Существует несколько способов сегментирования базы данных:

* Сегментирование, управляемое системой — автоматическое распределение по сегментам с помощью секционирования
* Определяемые пользователем сегментирования. позволяет указать сопоставление данных сегментам, которые хорошо работают при соблюдении нормативных требований или необходимости локализации данных.
* Составное сегментирование — сочетание управляемого системой и определяемого пользователем сегментирования для различных _шардспацес_
* Подразделы таблиц — похожи на обычную секционированную таблицу.

Дополнительные сведения о различных [методах сегментирования](https://docs.oracle.com/en/database/oracle/oracle-database/19/shard/sharding-methods.html) см. в документации по Oracle.

В то время как сегментированная база данных может выглядеть как отдельная база данных для приложений и разработчиков при переносе из несегментированной базы данных в сегментированную, необходимо тщательное планирование для определения того, какие таблицы будут дублироваться и сегментированы. 

Дубликаты таблиц хранятся во всех сегментах, тогда как сегментированные таблицы распределяются по разным сегментам. Рекомендация состоит в дублировании небольших и многомерных таблиц и распределении или сегментирования таблиц фактов. Данные можно загрузить в сегментированную базу данных с помощью каталога сегментов в качестве центрального координатора или путем запуска конвейера данных для каждого сегмента. Узнайте больше о [переносе данных в сегментированную базу данных](https://docs.oracle.com/en/database/oracle/oracle-database/19/shard/sharding-loading-data.html) в документации по Oracle.

#### <a name="oracle-sharding-with-data-guard"></a>Сегментирование Oracle с помощью Data Guard

Oracle Data Guard можно использовать для сегментирования с помощью управляемых системой, определяемых пользователем и составных сегментированных методов.

Следующая схема представляет собой эталонную архитектуру для сегментирования Oracle с помощью Oracle Data Guard, используемой для обеспечения высокого уровня доступности каждого сегмента. На схеме архитектуры показан _метод составного сегментирования_. Схема архитектуры, скорее всего, будет отличаться для приложений с различными требованиями к локализации данных, балансировке нагрузки, высокой доступности, аварийному восстановлению и т. д., и может использовать другой метод сегментирования. Сегментирование Oracle позволяет выполнять эти требования и масштабировать их по горизонтали и эффективно, предоставляя эти параметры. Подобную архитектуру можно даже развернуть с помощью Oracle GoldenGate.

![Oracle Database сегментирование с использованием зон доступности с помощью брокера Data Guard — ФСФО](./media/oracle-reference-architecture/oracledb_dg_sh_az.png)

Хотя сегментирование, управляемое системой, проще всего настроить и управлять, определяемое пользователем сегментирование или составное сегментирование хорошо подходит для сценариев, в которых данные и приложения распределены по географическому отношению или в сценариях, где необходимо контролировать репликацию каждого сегмента. 

В предыдущей архитектуре составное сегментирование используется для географического распределения данных и горизонтального масштабирования уровней приложения. Составное сегментирование представляет собой сочетание управляемого системой и определяемого пользователем сегментирования и, таким же, предоставляет преимущества обоих методов. В приведенном выше сценарии данные сначала сегментированы между несколькими шардспацес, разделенными по регионам. Затем данные секционированы по согласованному хэшу по нескольким сегментам в шардспаце. Каждый шардспаце содержит несколько шардграупс. Каждый шардграуп имеет несколько сегментов и является "единицей репликации" в данном случае. Каждый шардграуп содержит все данные в шардспаце. Шардграупс a1 и B1 являются первичными шардграупс, а шардграупс a2 и B2 — Standby. Вы можете указать, что отдельные сегменты являются единицей репликации, а не шардграуп.

В предыдущей архитектуре для обеспечения высокой доступности в каждой зоне доступности разворачивается директор GSM/сегментированный. Рекомендуется развернуть по крайней мере один директор GSM/сегментирования на каждый центр обработки данных или регион. Кроме того, экземпляр сервера приложений развертывается в каждой зоне доступности, содержащей шардграуп. Эта программа установки позволяет приложению удерживать задержку между сервером приложений и базой данных или шардграуп низкой. В случае сбоя базы данных сервер приложений в той же зоне, что и резервная база данных, может выполнять запросы после перехода роли базы данных. Шлюз приложений Azure и директор сегментов отслеживают задержку запросов и ответов и соответствующим образом перенаправляют запросы.

С точки зрения приложения клиентская система выполняет запрос к шлюзу приложений Azure (или другим технологиям балансировки нагрузки в Azure), который перенаправляет запрос в ближайший к клиенту регион. Шлюз приложений Azure также поддерживает закрепленные сеансы, поэтому все запросы, поступающие от одного клиента, направляются на один и тот же сервер приложений. Сервер приложений использует пулы подключений в драйверах доступа к данным. Эта функция доступна в таких драйверах, как JDBC, ODP.NET, OCI и т. д. Драйверы могут распознать ключи сегментирования, указанные как часть запроса. [Универсальный пул подключений (UCP) Oracle](https://docs.oracle.com/en/database/oracle/oracle-database/12.2/jjucp/ucp-database-sharding-overview.html) для клиентов JDBC может включать клиенты приложений, не относящиеся к Oracle, такие как Apache TOMCAT и IIS, для работы с сегментированием Oracle. 

Во время первоначального запроса сервер приложений подключается к директории сегментов в своем регионе, чтобы получить сведения о маршрутизации для сегмента, на который должен маршрутизироваться запрос. Основываясь на переданном ключе сегментирования, директор направляет сервер приложений в соответствующий сегмент. Сервер приложений кэширует эти сведения, создавая карту, и для последующих запросов обходит директор сегментов и направляет запросы непосредственно в сегмент.

#### <a name="oracle-sharding-with-goldengate"></a>Сегментирование Oracle с помощью GoldenGate

Следующая схема представляет собой эталонную архитектуру для сегментирования Oracle с Oracle GoldenGate для обеспечения высокого уровня доступности каждого сегмента в регионе. В отличие от предыдущей архитектуры, эта архитектура портрайс только высокий уровень доступности в пределах одного региона Azure (несколько зон доступности). Можно развернуть сегментированную базу данных с высоким уровнем доступности в нескольких регионах (аналогично предыдущему примеру) с помощью Oracle GoldenGate.

![Oracle Database сегментирование с помощью зон доступности с GoldenGate](./media/oracle-reference-architecture/oracledb_gg_sh_az.png)

В предыдущей эталонной архитектуре для сегментирования данных используется метод сегментирования, _управляемый системой_ . Так как репликация Oracle GoldenGate выполняется на уровне блоков, половина данных, реплицируемых в один сегмент, может реплицироваться в другой. Вторая половина может реплицироваться в другой сегмент. 

Способ репликации данных зависит от коэффициента репликаций. С коэффициентом репликации, равным 2, у вас будет две копии каждого фрагмента данных в трех сегментах в шардграуп. Аналогично, с коэффициентом репликации 3 и тремя сегментами в шардграуп все данные в каждом сегменте будут реплицироваться в каждый другой сегмент в шардграуп. Каждый сегмент в шардграуп может иметь другой фактор репликации. Эта программа установки позволяет эффективно определять высокую доступность и аварийное восстановление в рамках шардграуп и нескольких шардграупс.

В предыдущей архитектуре шардграуп A и шардграуп B содержат одни и те же данные, но находятся в разных зонах доступности. Если оба шардграуп A и шардграуп B имеют одинаковый коэффициент репликации 3, каждая строка или фрагмент сегментированной таблицы будет реплицироваться 6 раз между двумя шардграупс. Если шардграуп A имеет коэффициент репликации 3, а шардграуп B имеет коэффициент репликации 2, каждая строка или блок будет реплицироваться 5 раз между двумя шардграупс.

Эта настройка предотвращает потерю данных в случае сбоя уровня экземпляра или зоны доступности. Уровень приложения может выполнять чтение и запись в каждом сегменте. Чтобы избежать конфликтов, сегментирование Oracle обозначает "основной блок" для каждого диапазона хэш-значений. Эта функция гарантирует, что запросы записи для определенного фрагмента направляются в соответствующий фрагмент. Кроме того, Oracle GoldenGate обеспечивает автоматическое обнаружение и разрешение конфликтов для обработки любых возникающих конфликтов. Дополнительные сведения и ограничения по реализации GoldenGate с сегментированием Oracle см. в документации Oracle по использованию [Oracle GoldenGate с сегментированной базой данных](https://docs.oracle.com/en/database/oracle/oracle-database/19/shard/sharding-high-availability.html#GUID-4FC0AC46-0B8B-4670-BBE4-052228492C72).

В предыдущей архитектуре для обеспечения высокой доступности в каждой зоне доступности разворачивается директор GSM/сегментированный. Рекомендуется развернуть по крайней мере один директор GSM/сегментирования для каждого центра обработки данных или региона. Кроме того, экземпляр сервера приложений развертывается в каждой зоне доступности, содержащей шардграуп. Эта программа установки позволяет приложению удерживать задержку между сервером приложений и базой данных или шардграуп низкой. В случае сбоя базы данных сервер приложений в той же зоне, что и резервная база данных, может выполнять запросы после перехода роли базы данных. Шлюз приложений Azure и директор сегментов отслеживают задержку запросов и ответов и соответствующим образом перенаправляют запросы.

С точки зрения приложения клиентская система выполняет запрос к шлюзу приложений Azure (или другим технологиям балансировки нагрузки в Azure), который перенаправляет запрос в ближайший к клиенту регион. Шлюз приложений Azure также поддерживает закрепленные сеансы, поэтому все запросы, поступающие от одного клиента, направляются на один и тот же сервер приложений. Сервер приложений использует пулы подключений в драйверах доступа к данным. Эта функция доступна в таких драйверах, как JDBC, ODP.NET, OCI и т. д. Драйверы могут распознать ключи сегментирования, указанные как часть запроса. [Универсальный пул подключений (UCP) Oracle](https://docs.oracle.com/en/database/oracle/oracle-database/12.2/jjucp/ucp-database-sharding-overview.html) для клиентов JDBC может включать клиенты приложений, не относящиеся к Oracle, такие как Apache TOMCAT и IIS, для работы с сегментированием Oracle. 

Во время первоначального запроса сервер приложений подключается к директории сегментов в своем регионе, чтобы получить сведения о маршрутизации для сегмента, на который должен маршрутизироваться запрос. Основываясь на переданном ключе сегментирования, директор направляет сервер приложений в соответствующий сегмент. Сервер приложений кэширует эти сведения, создавая карту, и для последующих запросов обходит директор сегментов и направляет запросы непосредственно в сегмент.

## <a name="patching-and-maintenance"></a>Установка исправлений и обслуживание

При развертывании рабочих нагрузок Oracle в Azure Корпорация Майкрософт берет на себя все исправления на уровне ОС узла. Любое плановое обслуживание на уровне ОС передается клиентам заранее, чтобы позволить клиенту выполнить плановое обслуживание. Два сервера из двух разных Зоны доступности не обновляются одновременно. Дополнительные сведения об обслуживании и исправлениях виртуальных машин см. в статье [Управление доступностью виртуальной](../../availability.md) машины. 

Исправление для операционной системы виртуальной машины можно автоматизировать с помощью [Управление обновлениями службы автоматизации Azure](../../../automation/update-management/overview.md). Установка исправлений и обслуживания базы данных Oracle может быть автоматизирована и запланирована с помощью [Azure pipelines](/azure/devops/pipelines/get-started/what-is-azure-pipelines) или [Управление обновлениями службы автоматизации Azure](../../../automation/update-management/overview.md) , чтобы сократить время простоя. Сведения о том, как можно использовать в контексте баз данных Oracle, см. в разделе [непрерывная поставка и синие и зеленые развертывания](/azure/devops/learn/what-is-continuous-delivery) .

## <a name="architecture-and-design-considerations"></a>Рекомендации по архитектуре и проектированию

- Рассмотрите возможность использования технологии hyperно [оптимизированной для памяти виртуальной машины](../../sizes-memory.md) с [ограничением Core виртуальных ЦП](../../../virtual-machines/constrained-vcpu.md) для виртуальной машины Oracle Database, чтобы сэкономить на стоимости лицензирования и повысить производительность. Используйте несколько Premium или Ultra Disks (управляемые диски) для повышения производительности и доступности.
- При использовании управляемых дисков имя диска или устройства может измениться при перезагрузке. Вместо имени рекомендуется использовать UUID устройства, чтобы обеспечить сохранение подключений при перезагрузке. Дополнительные сведения см. [здесь](/previous-versions/azure/virtual-machines/linux/configure-raid#add-the-new-file-system-to-etcfstab).
- Используйте зоны доступности для обеспечения высокого уровня доступности в регионе.
- Рассмотрите возможность использования Ultra Disks (если доступно) или дисков уровня "Премиум" для базы данных Oracle.
- Рассмотрите возможность настройки резервной базы данных Oracle в другом регионе Azure с помощью Oracle Data Guard.
- Для уменьшения задержки между приложением и уровнем базы данных рекомендуется использовать [группы размещения близости](../../co-location.md#proximity-placement-groups) .
- Настройка [Oracle Enterprise Manager](https://docs.oracle.com/en/enterprise-manager/) для управления, мониторинга и ведения журнала.
- Рассмотрите возможность использования автоматического управления хранилищем Oracle (ASM) для упрощенного управления хранилищем базы данных.
- Используйте [Azure pipelines](/azure/devops/pipelines/get-started/what-is-azure-pipelines) для управления исправлениями и обновлениями базы данных без простоев.
- Настройте код приложения, чтобы добавить собственные шаблоны для облака, такие как [шаблон повтора](/azure/architecture/patterns/retry), [шаблон](/azure/architecture/patterns/circuit-breaker)автоматического выключения и другие шаблоны, определенные в статье [руководство по шаблонам проектирования в облаке](/azure/architecture/patterns/) , которое может помочь в обеспечении гибкости приложения.

## <a name="next-steps"></a>Дальнейшие действия

Ознакомьтесь со следующими справочными статьями Oracle, которые относятся к вашему сценарию.

- [Введение в Oracle Data Guard](https://docs.oracle.com/en/database/oracle/oracle-database/18/sbydb/introduction-to-oracle-data-guard-concepts.html#GUID-5E73667D-4A56-445E-911F-1E99092DD8D7)
- [Основные понятия брокера Data Guard в Oracle](https://docs.oracle.com/en/database/oracle/oracle-database/12.2/dgbkr/oracle-data-guard-broker-concepts.html)
- [Настройка Oracle GoldenGate для обеспечения высокой доступности Active-Active](https://docs.oracle.com/goldengate/1212/gg-winux/GWUAD/wu_bidirectional.htm#GWUAD282)
- [Общие сведения о сегментировании Oracle](https://docs.oracle.com/en/database/oracle/oracle-database/19/shard/sharding-overview.html)
- [Служба Oracle Active Data Guard имеет нулевую потери данных на любом расстоянии](https://www.oracle.com/technetwork/database/availability/farsync-2267608.pdf)
