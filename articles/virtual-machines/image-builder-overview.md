---
title: Дополнительные сведения о построителе образов Azure (Предварительная версия)
description: Узнайте больше о построителе образов Azure для виртуальных машин в Azure.
author: danielsollondon
ms.author: danis
ms.date: 03/05/2021
ms.topic: conceptual
ms.service: virtual-machines
ms.subservice: image-builder
ms.custom: references_regions
ms.reviewer: cynthn
ms.openlocfilehash: 20bb6925f859d497046eb42bbafb5264826b77b7
ms.sourcegitcommit: 772eb9c6684dd4864e0ba507945a83e48b8c16f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "104604072"
---
# <a name="preview-azure-image-builder-overview"></a>Предварительная версия: Обзор построителя образов Azure

Стандартизированные образы виртуальных машин позволяют организациям выполнять миграцию в облако и обеспечивать согласованность в развертываниях. Образы обычно включают стандартные параметры безопасности и конфигурации, а также необходимое программное обеспечение. Для настройки собственного конвейера работы с образами требуется время, инфраструктура и настройка, но с помощью построителя образов виртуальных машин Azure можно просто предоставить конфигурацию, описывающую образ, отправить его в службу, а затем создать и распространить образ.
 
С помощью построителя образов виртуальных машин Azure (Azure Image Builder) вы можете начать с образа Azure Marketplace на основе Windows или Linux, существующих пользовательских образов и добавить собственные настройки. Поскольку построитель изображений создан на основе [HashiCorp Pack](https://packer.io/) , вы увидите некоторые сходства, но получите преимущество от управляемой службы. Кроме того, вы можете указать, где должны размещаться образы: в [Общей коллекции образов Azure](shared-image-galleries.md), как управляемые образы или виртуальные жесткие диски.

> [!IMPORTANT]
> Конструктор образов Azure сейчас находится на этапе общедоступной предварительной версии.
> Эта предварительная версия предоставляется без соглашения об уровне обслуживания и не рекомендована для использования рабочей среде. Некоторые функции могут не поддерживаться или их возможности могут быть ограничены. Дополнительные сведения см. в статье [Дополнительные условия использования предварительных выпусков Microsoft Azure](https://azure.microsoft.com/support/legal/preview-supplemental-terms/).

## <a name="preview-features"></a>Функции предварительной версии

Для предварительной версии поддерживаются следующие функции.

- Создание базовых образов, включая минимальные конфигурации безопасности и организации, а также позволяет подразделениям настраивать ее.
- Интеграция основных приложений, благодаря чему виртуальная машина может принимать рабочие нагрузки после создания или добавлять конфигурации для поддержки образов виртуальных рабочих столов Windows.
- Исправление существующих образов. Конструктор образов позволит постоянно обновлять существующие пользовательские образы.
- Подключите Конструктор образов к существующим виртуальным сетям, чтобы можно было подключаться к существующим серверам конфигурации (DSC, Chef, Puppet и т. д.), общим файловым ресурсам или любым другим маршрутизируемым серверам и службам.
- Интеграция с Общей коллекцией образов Azure позволяет глобально распространять и масштабировать образы, а также предоставляет систему управления образами.
- Интеграция с существующими конвейерами сборки образов. Просто вызовите Конструктор образов из конвейера или используйте простую задачу Azure DevOps для предварительной версии Конструктора образов.
- Перенос существующего конвейера настройки образов в Azure. Используйте уже существующие сценарии, команды и процессы для настройки образов.
- Создание образов в формате VHD для поддержки Azure Stack.
 

## <a name="regions"></a>Регионы
Служба "Конструктор образов Azure" будет доступна как предварительная версия в следующих регионах. Изображения можно распространять за пределами этих регионов.
- Восточная часть США
- восточная часть США 2
- центрально-западная часть США
- западная часть США
- западная часть США 2
- Северная Европа
- Западная Европа

## <a name="os-support"></a>Поддержка ОС
AIB будет поддерживать базовые образы ОС Azure Marketplace:
- Ubuntu 18.04
- Ubuntu 16.04
- RHEL 7.6, 7.7
- CentOS 7.6, 7.7
- SLES 12 SP4
- SLES 15, SLES 15 SP1
- Windows 10 RS5 Корпоративная/Корпоративная с поддержкой нескольких сеансов/Профессиональная
- Windows 2016
- Windows 2019

## <a name="how-it-works"></a>Принцип работы

Построитель образов виртуальных машин Azure — это полностью управляемая служба Azure, доступная поставщику ресурсов Azure. Укажите конфигурацию службы, которая указывает исходный образ, настройку выполнения и место, куда будет распространяться новый образ, на схеме ниже показан рабочий процесс высокого уровня:

![Концептуальный рисунок процесса построителя образов Azure, в котором показаны источники (Windows/Linux), настройки (оболочка, PowerShell, перезагрузка Windows & обновление, Добавление файлов) и глобальное распространение с помощью коллекции общих образов Azure.](./media/image-builder-overview/image-builder-flow.png)

Конфигурации шаблонов можно передавать с помощью PowerShell, AZ CLI, шаблонов ARM и с помощью задачи DevOps для создания образа виртуальной машины Azure. при их отправке в службу мы создадим ресурс шаблона образа. После создания ресурса шаблона образа в подписке отобразится промежуточная группа ресурсов в формате: IT_ \<DestinationResourceGroup> _\<TemplateName>_ \( GUID). Промежуточная группа ресурсов содержит файлы и сценарии, на которые ссылается файл, оболочка, Настройка PowerShell в свойстве Скриптури.

Чтобы запустить сборку, которая будет вызываться `Run` на ресурсе шаблона образа, служба затем развернет дополнительные ресурсы для сборки, такие как виртуальная машина, сеть, диск, сетевой адаптер и т. д. Если вы создаете образ, не используя существующий построитель образов виртуальной сети, также развертывает общедоступный IP-адрес и NSG, служба подключается к виртуальной машине сборки с помощью SSH или WinRM. Если выбрана существующая виртуальная сеть, то служба будет развернута с помощью частной связи Azure, а общедоступный IP-адрес не потребуется. Дополнительные сведения см. в [сведениях](./linux/image-builder-networking.md)о сети для работы с построителем образов.

После завершения сборки будут удалены все ресурсы, за исключением промежуточной группы ресурсов и учетной записи хранения. чтобы удалить их, необходимо удалить ресурс шаблона образа или оставить его для повторного запуска сборки.

Существует несколько примеров и пошаговые руководства в этой документации, которые ссылаются на шаблоны конфигурации и решения в [репозитории GitHub в Azure Image Builder](https://github.com/azure/azvmimagebuilder).

### <a name="move-support"></a>Поддержка перемещения
Ресурс шаблона изображения является неизменяемым и содержит ссылки на ресурсы и группу ресурсов промежуточного хранения, поэтому тип ресурса не поддерживает перемещение. Если вы хотите переместить ресурс шаблона образа, убедитесь, что у вас есть копия шаблона конфигурации (извлечение существующей конфигурации из ресурса, если у вас ее нет), создайте новый ресурс шаблона образа в новой группе ресурсов с новым именем и удалите ресурс шаблона предыдущего образа. 

## <a name="permissions"></a>Разрешения
При регистрации для (AIB) это предоставляет службе AIB разрешение на создание, удаление и администрирование промежуточной группы ресурсов (IT_ *) и имеет права на добавление в нее ресурсов, необходимых для сборки образа. Это делается с помощью имени субъекта-службы AIB, которое предоставляется в вашей подписке во время успешной регистрации.

Чтобы разрешить Конструктору образов виртуальных машин Azure распространять образы в управляемые образы или в Общую коллекцию образов, необходимо создать назначенное пользователем удостоверение Azure с разрешениями на чтение и запись образов. При доступе к службе хранилища Azure для чтения закрытых и открытых контейнеров потребуются разрешения.

Разрешения более подробно описаны в [PowerShell](./linux/image-builder-permissions-powershell.md)и [AZ CLI](./linux/image-builder-permissions-cli.md).

## <a name="costs"></a>Затраты
При создании, сборке и хранении образов с помощью Конструктора образов Azure потребуются некоторые затраты ресурсов на вычисления, работу сети и хранение. Эти затраты схожи с затратами, возникающими при создании пользовательских образов вручную. Плата за ресурсы будет взиматься по тарифам Azure. 

В процессе создания образа файлы загружаются и сохраняются в группе ресурсов `IT_<DestinationResourceGroup>_<TemplateName>`, что приводит к небольшим затратам на хранение. Если они больше не нужны, удалите **Шаблон образа** после сборки образа.
 
Конструктор образов создает виртуальную машину, используя размер виртуальной машины D1v2, а также хранилище и сетевые подключения, необходимые для виртуальной машины. Эти ресурсы будут существовать на протяжении процесса сборки и удалены после того, как Конструктор образов завершит создание образа. 
 
Конструктор образов Azure распространит образ в выбранные регионы, что может повлечь оплату за исходящий сетевой трафик.

## <a name="hyper-v-generation"></a>Поколение Hyper-V
В настоящее время построитель образов поддерживает создание образов Hyper-V (GEN1) 1 в галерее образов (SIG) или управляемом образе Azure. 
 
## <a name="next-steps"></a>Дальнейшие действия 
 
Чтобы испытать Конструктор образов Azure, ознакомьтесь со статьями о сборке образов [Linux](./linux/image-builder.md) или [Windows](./windows/image-builder.md).