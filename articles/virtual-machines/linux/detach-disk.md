---
title: Отключение диска данных от виртуальной машины Linux в Azure
description: Узнайте, как отключить диск данных от виртуальной машины в Azure с использованием Azure CLI или портала Azure.
author: roygara
ms.service: virtual-machines-linux
ms.topic: how-to
ms.date: 07/18/2018
ms.author: rogarana
ms.subservice: disks
ms.custom: devx-track-azurecli
ms.openlocfilehash: 96586be8be466acf09121518fb71ea1b8ba9d983
ms.sourcegitcommit: 2bd0a039be8126c969a795cea3b60ce8e4ce64fc
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/14/2021
ms.locfileid: "98203207"
---
# <a name="how-to-detach-a-data-disk-from-a-linux-virtual-machine"></a>Отключение диска данных от виртуальной машины Linux

Когда диск данных, подключенный к виртуальной машине, больше не нужен, его можно легко отключить. При данной операции происходит удаление диска из виртуальной машины, но не из хранилища. В этой статье рассматривается дистрибутив Ubuntu 16.04 LTS. Если вы используете другой дистрибутив, инструкции по отключению диска могут отличаться.

> [!WARNING]
> Если отключить диск, он не удаляется автоматически. Если вы подписаны на хранилище уровня "Премиум", с вас по-прежнему будет взиматься плата за хранение этого диска. Дополнительные сведения см. в разделе о [ценах и выставлении счетов при использовании хранилища класса Premium](https://azure.microsoft.com/pricing/details/storage/page-blobs/).

Если вы хотите снова использовать существующие данные на диске, его можно легко повторно подключить как к той же самой, так и к другой виртуальной машине.  


## <a name="connect-to-the-vm-to-unmount-the-disk"></a>Подключение к виртуальной машине для отсоединения диска

Перед тем как отключить диск с помощью CLI или портала, необходимо отсоединить диск и удалить ссылки на него из FSTAB-файла.

Подключитесь к виртуальной машине. В этом примере общедоступный IP-адрес виртуальной машины — *10.0.1.4* с именем пользователя *azureuser*: 

```bash
ssh azureuser@10.0.1.4
```

Сначала найдите диск данных, который необходимо отключить. В следующем примере для фильтрации по дискам SCSI используется команда dmesg:

```bash
dmesg | grep SCSI
```

Вы должны увидеть результат, аналогичный приведенному ниже.

```bash
[    0.294784] SCSI subsystem initialized
[    0.573458] Block layer SCSI generic (bsg) driver version 0.4 loaded (major 252)
[    7.110271] sd 2:0:0:0: [sda] Attached SCSI disk
[    8.079653] sd 3:0:1:0: [sdb] Attached SCSI disk
[ 1828.162306] sd 5:0:0:0: [sdc] Attached SCSI disk
```

В этом примере *sdc* — это имя диска, который нужно отключить. Кроме того, вам следует получить идентификатор UUID диска.

```bash
sudo -i blkid
```

Результат должен быть аналогичным приведенному ниже:

```bash
/dev/sda1: UUID="11111111-1b1b-1c1c-1d1d-1e1e1e1e1e1e" TYPE="ext4"
/dev/sdb1: UUID="22222222-2b2b-2c2c-2d2d-2e2e2e2e2e2e" TYPE="ext4"
/dev/sdc1: UUID="33333333-3b3b-3c3c-3d3d-3e3e3e3e3e3e" TYPE="ext4"
```


Отредактируйте файл */etc/fstab*, чтобы удалить ссылки на диск. 

> [!NOTE]
> Некорректное изменение файла **/etc/fstab** может привести к невозможности загрузить систему. Если у вас есть сомнения, см. инструкции по правильному изменению этого файла в документации дистрибутива. Также рекомендуется перед внесением изменений создать резервную копию файла /etc/fstab.

Откройте файл */etc/fstab* в текстовом редакторе, как показано ниже:

```bash
sudo vi /etc/fstab
```

В этом примере из файла */etc/fstab* необходимо удалить следующую строку:

```bash
UUID=33333333-3b3b-3c3c-3d3d-3e3e3e3e3e3e   /datadrive   ext4   defaults,nofail   1   2
```

Используйте функцию `umount`, чтобы отсоединить жесткий диск. В следующем примере раздел */dev/sdc1* отключается от точки подключения */datadrive*:

```bash
sudo umount /dev/sdc1 /datadrive
```


## <a name="detach-a-data-disk-using-azure-cli"></a>Отключение диска данных с помощью Azure CLI 

В этом примере диск *myDataDisk* отключается от виртуальной машины с именем *myVM* в *myResourceGroup*.

```azurecli
az vm disk detach \
    -g myResourceGroup \
    --vm-name myVm \
    -n myDataDisk
```

Диск остается в хранилище, но он уже не подключен к виртуальной машине.


## <a name="detach-a-data-disk-using-the-portal"></a>Отключение диска данных с помощью портала

1. В меню слева выберите **Виртуальные машины**.
1. В колонке "Виртуальная машина" выберите **Диски**.
1. В верхней части колонки **Диски** выберите **Изменить**.
1. В колонке **Диски** справа от диска данных, который требуется отключить, нажмите кнопку ![Отключить](./media/detach-disk/detach.png).
1. После удаления диска в верхней части колонки нажмите кнопку **Сохранить**.

Диск остается в хранилище, но он уже не подключен к виртуальной машине.



## <a name="next-steps"></a>Дальнейшие действия
Если нужно повторно использовать диск данных, можно просто [подключить его к другой виртуальной машине](add-disk.md).

