---
title: Руководство. Настройка раннего развертывания для виртуальных машины Linux в Azure
description: Из этого руководства вы узнаете, как настроить конвейер непрерывного развертывания (CD). Этот конвейер обновляет группу виртуальных машин Linux в Azure с использованием стратегии сине-зеленого развертывания.
author: moala
tags: azure-devops-pipelines
ms.assetid: ''
ms.service: virtual-machines
ms.collection: linux
ms.topic: tutorial
ms.tgt_pltfrm: azure-pipelines
ms.workload: infrastructure
ms.date: 4/10/2020
ms.author: moala
ms.custom: devops
ms.openlocfilehash: 4545891cce926f049673cd2c2380a8309f2e71a1
ms.sourcegitcommit: 7edadd4bf8f354abca0b253b3af98836212edd93
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/10/2021
ms.locfileid: "102552593"
---
# <a name="tutorial---configure-the-blue-green-deployment-strategy-for-azure-linux-virtual-machines"></a>Руководство. Настройка стратегии сине-зеленого развертывания для виртуальных машин Linux в Azure

## <a name="infrastructure-as-a-service-iaas---configure-cicd"></a>Инфраструктура как услуга (IaaS). Настройка CI/CD

Azure Pipelines предоставляет полнофункциональный набор инструментов для автоматизации CI/CD при развертывании на виртуальных машинах. Вы можете настроить на портале Azure конвейер непрерывной поставки для виртуальной машины Azure.

В этой статье описывается, как настроить конвейер CI/CD, который использует стратегию сине-зеленого развертывания для нескольких компьютеров. Также портал Azure поддерживает другие стратегии, например [последовательного](./tutorial-devops-azure-pipelines-classic.md) и [раннего](./tutorial-azure-devops-canary-strategy.md) развертывания.

### <a name="configure-cicd-on-virtual-machines"></a>Настройка CI/CD для виртуальных машин

Вы можете добавить целевые виртуальные машины в [группу развертывания](/azure/devops/pipelines/release/deployment-groups). Это позволит организовать для них многокомпьютерное обновление. После развертывания на компьютерах просмотрите **журнал развертывания** в группе развертывания. Это представление позволяет выполнять трассировку действий от виртуальной машины до конвейера и далее до фиксации.

### <a name="blue-green-deployments"></a>Сине-зеленые развертывания

Такое развертывание сокращает время простоя при развертывании путем использования идентичной резервной среды. В любой момент времени активной может являться только одна среда.

При подготовке к новому выпуску вы выполняете последний этап тестирования в зеленой среде. Когда программное обеспечение будет нормально работать в зеленой среде, переключите трафик так, чтобы все входящие запросы поступали только в зеленую среду. Теперь синяя среда становится неактивной.

Используя механизм непрерывной поставки, вы можете настроить на портале Azure сине-зеленую схему развертывания для виртуальных машин. Ниже представлены пошаговые инструкции.

1. Войдите на портал Azure и перейдите к нужной виртуальной машине.
1. На крайней левой панели параметров виртуальной машины выберите **Непрерывная поставка**. Затем выберите **Настроить**.

   ![Панель непрерывной поставки с кнопкой настройки](media/tutorial-devops-azure-pipelines-classic/azure-devops-configure.png)

1. На панели конфигурации щелкните **Организация Azure DevOps**, чтобы выбрать существующую учетную запись или создать новую. Затем выберите проект, в котором вы хотите настроить конвейер.  

   ![Панель непрерывной поставки](media/tutorial-devops-azure-pipelines-classic/azure-devops-rolling.png)

1. Группа развертывания — это логический набор целевых компьютеров для развертывания, который представляет определенную физическую среду. Это может быть среда разработки, тестирования или пользовательского приемочного тестирования, а также рабочая среда. Вы можете создать новую группу развертывания или выбрать существующую.
1. Выберите конвейер сборки, который публикует пакет для развертывания на виртуальной машине. Опубликованный пакет должен содержать скрипт развертывания deploy.ps1 или deploy.sh в папке deployscripts, расположенной в корневой папке пакета. Конвейер запускает этот скрипт развертывания.
1. В списке **Стратегия развертывания** выберите вариант **Сине-зеленое**.
1. Добавьте тег blue или green к виртуальным машинам, для которых будет применяться сине-зеленая схема развертывания. Если виртуальной машине назначается роль резервной, добавьте к ней тег green. В противном случае укажите тег blue.

   ![Панель непрерывной поставки с выбранным вариантом стратегии сине-зеленого развертывания](media/tutorial-devops-azure-pipelines-classic/azure-devops-blue-green-configure.png)

1. Нажмите кнопку **ОК**, чтобы настроить конвейер непрерывной поставки для развертывания на виртуальной машине.

   ![Конвейер сине-зеленого развертывания](media/tutorial-devops-azure-pipelines-classic/azure-devops-blue-green-pipeline.png)

1. Отобразятся сведения о развертывании для виртуальной машины. Вы можете щелкнуть здесь ссылку, чтобы перейти к конвейеру выпуска в Azure DevOps. На странице конвейера выпуска щелкните **Изменить**, чтобы просмотреть конфигурацию конвейера. Этот конвейер состоит из трех этапов.

   1. Первым является этап группы развертывания. Приложения развертываются только на резервных виртуальных машинах, которые имеют тег green.
   1. На втором этапе конвейер приостанавливает работу и ожидает возобновления вручную. Пользователь может возобновить выполнение конвейера после того, как вручную проверит стабильность развертывания на виртуальных машинах, помеченных как green.
   1. На этом этапе теги blue и green на виртуальных машинах меняются местами. Это означает, что теперь виртуальные машины с более старыми версиями приложений имеют отметку green. Во время следующего запуска конвейера приложения будут развернуты именно на этих виртуальных машинах.

      ![Панель "Группа развертывания" для задачи "Сине-зеленое развертывание"](media/tutorial-devops-azure-pipelines-classic/azure-devops-blue-green-tasks.png)

1. Задача выполнения скрипта развертывания по умолчанию выполняет скрипт развертывания deploy.ps1 или deploy.sh. Этот скрипт размещается в подпапке deployscripts корневой папки опубликованного пакета. Убедитесь, что выбранный конвейер сборки публикует развертывание в корневой папке пакета.

   ![Панель "Артефакты", где отображается файл deploy.sh в папке deployscripts](media/tutorial-deployment-strategy/package.png)

## <a name="other-deployment-strategies"></a>Другие стратегии развертывания

- [Настройка стратегии последовательного развертывания](./tutorial-devops-azure-pipelines-classic.md)
- [Настройка стратегии раннего развертывания](./tutorial-azure-devops-canary-strategy.md)

## <a name="azure-devops-projects"></a>Azure DevOps Projects

Вам будет легко начать работу с Azure. Функция Azure DevOps Projects позволяет запустить приложение в любой службе Azure, выполнив всего три шага:

- выбор языка приложения;
- выбор среды выполнения;
- выбор службы Azure.

[Подробнее](https://azure.microsoft.com/features/devops-projects/).

## <a name="additional-resources"></a>Дополнительные ресурсы

- [Развертывание на виртуальных машинах Azure с помощью Azure DevOps Projects](../../devops-project/azure-devops-project-vms.md)
- [Реализация непрерывного развертывания приложения в масштабируемом наборе виртуальных машин Azure](/azure/devops/pipelines/apps/cd/azure/deploy-azure-scaleset)