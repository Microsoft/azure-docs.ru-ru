---
title: Виртуальные машины Преимущество гибридного использования Azure и Linux
description: Узнайте, как Преимущество гибридного использования Azure может помочь сэкономить деньги на виртуальных машинах Linux, работающих в Azure.
services: virtual-machines
documentationcenter: ''
author: mathapli
manager: westonh
ms.service: virtual-machines-linux
ms.topic: conceptual
ms.workload: infrastructure-services
ms.date: 09/22/2020
ms.author: mathapli
ms.openlocfilehash: 44d78d9a47f86520a3a4778806c4ddc0f96eec94
ms.sourcegitcommit: 78ecfbc831405e8d0f932c9aafcdf59589f81978
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/23/2021
ms.locfileid: "98737903"
---
# <a name="how-azure-hybrid-benefit-applies-for-linux-virtual-machines"></a>Как Преимущество гибридного использования Azure применяется для виртуальных машин Linux

Преимущество гибридного использования Azure — это преимущество лицензирования, которое помогает значительно снизить затраты на выполнение виртуальных машин Red Hat Enterprise Linux (RHEL) и SUSE Linux Enterprise Server (SLES) в облаке. С помощью этого преимущества вы платите только за затраты инфраструктуры виртуальной машины, так как ваша подписка RHEL или SLES охватывает плату за программное обеспечение. Это преимущество доступно для всех образов RHEL и SLES Marketplace с оплатой по мере использования (PAYG).

Преимущество гибридного использования Azure для виртуальных машин Linux теперь является общедоступной.

## <a name="benefit-description"></a>Описание преимущества

С помощью Преимущество гибридного использования Azure вы можете перенести локальные серверы RHEL и SLES в Azure, преобразовав существующие виртуальные машины RHEL и SLES PAYG в Azure для выставления счетов вашей подписки (BYOS). Как правило, виртуальные машины, развернутые из образов PAYG в Azure, будут взимать плату за инфраструктуру и плату за программное обеспечение. С помощью Преимущество гибридного использования Azure виртуальные машины PAYG можно преобразовать в модель выставления счетов BYOS без повторного развертывания, чтобы избежать риска простоя.

:::image type="content" source="./media/ahb-linux/azure-hybrid-benefit-cost.png" alt-text="Преимущество гибридного использования Azure визуализации затрат на виртуальных машинах Linux.":::

После включения преимущества на виртуальной машине RHEL или SLES вам больше не придется оплачивать дополнительную плату по программному обеспечению, как правило, на виртуальной машине PAYG. Вместо этого ваша виртуальная машина начнет начислять плату за BYOS, которая включает только вычисление платы за оборудование и отсутствие платы за программное обеспечение.

Вы также можете преобразовать виртуальную машину, для которой было включено преимущество, обратно в модель выставления счетов PAYG.

## <a name="scope-of-azure-hybrid-benefit-eligibility-for-linux-vms"></a>Область допустимости Преимущество гибридного использования Azure для виртуальных машин Linux

Преимущество гибридного использования Azure доступны для всех образов RHEL и SLES PAYG из Azure Marketplace. Это преимущество еще не доступно для образов RHEL или SLES BYOS или пользовательских образов из Azure Marketplace.

Зарезервированные экземпляры, экземпляры выделенных узлов Azure и преимущества гибридного использования SQL не подходят для Преимущество гибридного использования Azure, если вы уже используете преимущества виртуальных машин Linux.

## <a name="get-started"></a>Начало работы

### <a name="red-hat-customers"></a>Клиенты Red Hat

Преимущество гибридного использования Azure для RHEL доступна для клиентов Red Hat, отвечающих обоим критериям:

- Наличие активных или неиспользуемых подписок RHEL, доступных для использования в Azure
- Включить одну или несколько подписок для использования в Azure с помощью программы [Cloud Access для Red Hat](https://www.redhat.com/en/technologies/cloud-computing/cloud-access)

> [!IMPORTANT]
> Убедитесь, что в программе [доступа к облаку](https://www.redhat.com/en/technologies/cloud-computing/cloud-access) включена правильная подписка.

Чтобы начать использовать преимущество для Red Hat, сделайте следующее:

1. Включите одну или несколько подходящих подписок RHEL для использования в Azure с помощью [интерфейса пользователя Cloud Access для Red Hat](https://access.redhat.com/management/cloud).

   Для подписок Azure, которые вы предоставляете в процессе включения облачного доступа Red Hat, будет разрешено использовать функцию Преимущество гибридного использования Azure.
1. Примените Преимущество гибридного использования Azure к любым существующим виртуальным машинам RHEL PAYG и новым виртуальным машинам RHEL, которые развертываются из образов Azure Marketplace PAYG. Для реализации преимущества можно использовать портал Azure или Azure CLI.
1. Следуйте рекомендуемым [дальнейшим действиям](https://access.redhat.com/articles/5419341) по настройке источников обновлений для ВИРТУАЛЬНЫХ машин RHEL и правилам соответствия подписок RHEL.


### <a name="suse-customers"></a>Клиенты SUSE

Чтобы приступить к использованию преимущества для SUSE, сделайте следующее:

1. Зарегистрируйтесь в программе общедоступного облака SUSE.
1. Примените преимущество к вновь созданным или существующим виртуальным машинам с помощью портал Azure или Azure CLI.
1. Зарегистрируйте виртуальные машины, которые получают преимущество с помощью отдельного источника обновлений.

## <a name="enable-and-disable-the-benefit-in-the-azure-portal"></a>Включение и отключение преимущества в портал Azure

Вы можете включить преимущества на существующих виртуальных машинах, посетив параметр **конфигурации** слева и выполнив действия, описанные в этой статье. Вы можете включить преимущества для новых виртуальных машин во время создания виртуальной машины.

### <a name="azure-portal-example-to-enable-the-benefit-for-an-existing-vm"></a>Портал Azure пример, чтобы включить преимущество для существующей виртуальной машины:
1. Посетите [портал Microsoft Azure](https://portal.azure.com/)
1. Перейдите на страницу "Создание виртуальной машины" на портале.
 ![АХБ при создании виртуальной машины](./media/azure-hybrid-benefit/create-vm-ahb.png)
1. Установите флажок, чтобы включить преобразование АХБ и использовать лицензии на облачный доступ.
 ![Флажок АХБ при создании виртуальной машины](./media/azure-hybrid-benefit/create-vm-ahb-checkbox.png)
1. Создание виртуальной машины после следующего набора инструкций
1. Проверьте колонку **Конфигурация** , и вы увидите параметр включено. 
![Колонка конфигурации АХБ после создания](./media/azure-hybrid-benefit/create-configuration-blade.png)

### <a name="azure-portal-example-to-enable-the-benefit-during-creation-of-vm"></a>Портал Azure пример, чтобы обеспечить преимущества при создании виртуальной машины:
1. Посетите [портал Microsoft Azure](https://portal.azure.com/)
1. Откройте страницу виртуальной машины, для которой необходимо применить преобразование.
1. Перейдите к параметру **конфигурации** слева. Вы увидите раздел лицензирование. Чтобы включить преобразование АхБ, установите переключатель "Да" и установите флажок подтверждения.
![Колонка конфигурации АХБ после создания](./media/azure-hybrid-benefit/create-configuration-blade.png)


>[!NOTE]
> Если вы создали **Пользовательский моментальный снимок** или **общий образ (SIG)** для образа RHEL или SLES PAYG Marketplace, для включения Преимущество гибридного использования Azure можно использовать только Azure CLI. Это известное ограничение, и в настоящее время нет временной шкалы для предоставления этой возможности на портале Azure.



## <a name="enable-and-disable-the-benefit-in-the-azure-cli"></a>Включение и отключение преимущества в Azure CLI

`az vm update`Для обновления существующих виртуальных машин можно использовать команду. Для виртуальных машин RHEL выполните команду с `--license-type` параметром `RHEL_BYOS` . Для виртуальных машин SLES выполните команду с `--license-type` параметром `SLES_BYOS` .

### <a name="cli-example-to-enable-the-benefit"></a>Пример интерфейса командной строки для включения преимущества
```azurecli
# This will enable the benefit on a RHEL VM
az vm update -g myResourceGroup -n myVmName --license-type RHEL_BYOS

# This will enable the benefit on a SLES VM
az vm update -g myResourceGroup -n myVmName --license-type SLES_BYOS
```
### <a name="cli-example-to-disable-the-benefit"></a>Пример интерфейса командной строки для отключения преимущества
Чтобы отключить преимущество, используйте `--license-type` значение `None` :

```azurecli
# This will disable the benefit on a VM
az vm update -g myResourceGroup -n myVmName --license-type None
```

### <a name="cli-example-to-enable-the-benefit-on-a-large-number-of-vms"></a>Пример интерфейса командной строки для использования преимущества на большом количестве виртуальных машин
Чтобы обеспечить преимущество для большого количества виртуальных машин, можно использовать `--ids` параметр в Azure CLI:

```azurecli
# This will enable the benefit on a RHEL VM. In this example, ids.txt is an
# existing text file that contains a delimited list of resource IDs corresponding
# to the VMs using the benefit
az vm update -g myResourceGroup -n myVmName --license-type RHEL_BYOS --ids $(cat ids.txt)
```

В следующих примерах показаны два способа получения списка идентификаторов ресурсов: один на уровне группы ресурсов и один на уровне подписки.

```azurecli
# To get a list of all the resource IDs in a resource group:
$(az vm list -g MyResourceGroup --query "[].id" -o tsv)

# To get a list of all the resource IDs of VMs in a subscription:
az vm list -o json | jq '.[] | {VMName: .name, ResourceID: .id}'
```

## <a name="apply-the-azure-hybrid-benefit-at-vm-create-time"></a>Применение Преимущество гибридного использования Azure во время создания виртуальной машины
Помимо применения Преимущество гибридного использования Azure к существующим виртуальным машинам с оплатой по мере использования, ее можно вызвать во время создания виртуальной машины. Преимущества этого срифолд:
- Виртуальные машины PAYG и BYOS можно подготавливать с помощью одного и того же образа и процесса.
- Она позволяет вносить изменения в будущие режимы лицензирования, недоступные для образа BYOS или при использовании собственной виртуальной машины.
- По умолчанию виртуальная машина будет подключена к инфраструктуре обновления Red Hat (RHUI), чтобы убедиться в том, что она остается в актуальном состоянии и защищена. Обновленный механизм можно изменить после развертывания в любое время.

## <a name="check-the-azure-hybrid-benefit-status-of-a-vm"></a>Проверка состояния Преимущество гибридного использования Azure виртуальной машины
Состояние Преимущество гибридного использования Azure виртуальной машины можно просмотреть с помощью Azure CLI или службы метаданных экземпляра Azure.

### <a name="azure-cli"></a>Azure CLI

`az vm get-instance-view`Для этой цели можно использовать команду. Найдите `licenseType` поле в ответе. Если `licenseType` поле существует и имеет значение `RHEL_BYOS` или `SLES_BYOS` , для виртуальной машины включено преимущество.

```azurecli
az vm get-instance-view -g MyResourceGroup -n MyVm
```

### <a name="azure-instance-metadata-service"></a>Служба метаданных экземпляров Azure

В самой виртуальной машине можно запросить аттестацию метаданных в службе метаданных экземпляра Azure, чтобы определить значение виртуальной машины `licenseType` . `licenseType`Значение `RHEL_BYOS` или `SLES_BYOS` указывает, что для виртуальной машины включено преимущество. Дополнительные [сведения о аттестации метаданных](./instance-metadata-service.md#attested-data).

## <a name="compliance"></a>Соответствие нормативным требованиям

### <a name="red-hat"></a>Red Hat

Клиенты, использующие Преимущество гибридного использования Azure для RHEL, принимаю [условия соглашения](http://www.redhat.com/licenses/cloud_CSSA/Red_Hat_Cloud_Software_Subscription_Agreement_for_Microsoft_Azure.pdf) [о конфиденциальности](http://www.redhat.com/licenses/cloud_CSSA/Red_Hat_Privacy_Statement_for_Microsoft_Azure.pdf) , связанные с предложениями RHEL в Azure Marketplace.

Клиенты, использующие Преимущество гибридного использования Azure для RHEL, имеют три варианта предоставления обновлений программного обеспечения и исправлений для этих виртуальных машин:

- [Инфраструктура обновления Red Hat](../workloads/redhat/redhat-rhui.md) (параметр по умолчанию)
- Вспомогательный сервер Red Hat
- Диспетчер подписок Red Hat

Клиенты, которые выбирают параметр RHUI, могут продолжать использовать RHUI в качестве основного источника обновлений для своих Преимущество гибридного использования Azure RHEL виртуальных машин, не присоединяя RHEL подписки к этим виртуальным машинам. Клиенты, которые выбирают параметр RHUI, отвечают за обеспечение соответствия подписок RHEL.

Клиенты, которые выбирают либо сервер Red Hat Спутниковое, либо диспетчер подписки Red Hat, должны удалить конфигурацию RHUI, а затем подключить доступ к облачной подписке RHEL Преимущество гибридного использования Azure RHEL виртуальных машин.  

Дополнительные сведения о соответствии требованиям к подписке Red Hat, обновлениям программного обеспечения и источникам Преимущество гибридного использования Azure RHEL VM см. в [статье Red Hat об использовании подписок RHEL с преимущество гибридного использования Azure](https://access.redhat.com/articles/5419341).

### <a name="suse"></a>SUSE

Чтобы использовать Преимущество гибридного использования Azure для виртуальных машин SLES, а также сведения о переходе с SLES PAYG на BYOS или переход с SLES BYOS на PAYG см. в статье [SUSE Linux Enterprise и преимущество гибридного использования Azure](https://www.suse.com/c/suse-linux-enterprise-and-azure-hybrid-benefit/). 

## <a name="frequently-asked-questions"></a>Часто задаваемые вопросы
*Вопрос. можно ли использовать тип лицензии `RHEL_BYOS` с образом SLES или наоборот?*

Ответ. нет, вы не можете. Попытка ввести тип лицензии, которая неправильно соответствует распределению, выполняемому на виртуальной машине, не приведет к обновлению метаданных выставления счетов. Но при случайном вводе неправильного типа лицензии обновление виртуальной машины до правильного типа лицензии по-прежнему позволит получить преимущество.

*Вопрос. я зарегистрировался с помощью облачного доступа Red Hat, но по-прежнему не сможет воспользоваться преимуществами на моих виртуальных машинах RHEL. Что мне делать?*

Ответ. регистрация подписки на облачный доступ Red Hat с помощью Red Hat в Azure может занять некоторое время. Если вы по-прежнему видите ошибку в течение одного рабочего дня, обратитесь в службу поддержки Майкрософт.

*Вопрос. я развернул виртуальную машину с помощью RHEL BYOS "Золотой образ". Можно ли преобразовать выставление счетов на эти образы из BYOS в PAYG?*

Ответ. нет, вы не можете. Преимущество гибридного использования Azure поддерживает преобразование только для изображений с оплатой по мере использования.

*Вопрос. я отправил собственный образ RHEL из локальной среды (с помощью службы "миграция Azure", Azure Site Recovery или иным образом) в Azure. Можно ли преобразовать выставление счетов на эти образы из BYOS в PAYG?*

Ответ. нет, вы не можете. Функция Преимущество гибридного использования Azure в настоящее время доступна только для образов RHEL и SLES в Azure Marketplace. 

*Вопрос. я отправил собственный образ RHEL из локальной среды (с помощью службы "миграция Azure", Azure Site Recovery или иным образом) в Azure. Нужно ли делать что-нибудь, чтобы воспользоваться преимуществами Преимущество гибридного использования Azure?*

Ответ. нет, нет. Отправляемые образы RHEL уже считаются BYOS, и плата взимается только за затраты на инфраструктуру Azure. Вы несете ответственность за RHELную подписку, так же как и в локальных средах. 

*Вопрос. можно ли использовать Преимущество гибридного использования Azure на виртуальных машинах, развернутых из Azure Marketplace RHEL и образов SAP SLES?*

Ответ. Да, можете. Вы можете использовать тип лицензии `RHEL_BYOS` для виртуальных машин RHEL и `SLES_BYOS` для преобразований виртуальных машин, развернутых из Azure Marketplace RHEL и SLES SAP Images.

*Вопрос. можно ли использовать Преимущество гибридного использования Azure в масштабируемых наборах виртуальных машин для RHEL и SLES?*

Ответ. нет, вы не можете. Масштабируемые наборы виртуальных машин не находятся в области Преимущество гибридного использования Azure для RHEL и SLES.

*Вопрос. можно ли использовать Преимущество гибридного использования Azure в зарезервированных экземплярах для RHEL и SLES?*

Ответ. нет, вы не можете. Зарезервированные экземпляры не находятся в области Преимущество гибридного использования Azure для RHEL и SLES.

*Вопрос. можно ли использовать Преимущество гибридного использования Azure на виртуальной машине, развернутой для SQL Server в образах RHEL?*

Ответ. нет, вы не можете. Не существует плана по поддержке этих виртуальных машин.

*Вопрос. можно ли использовать Преимущество гибридного использования Azure в подписке на центр виртуальных данных RHEL?*

Ответ. нет, вы не можете. В Azure не поддерживается постоянного тока, включая АХБ.  
 

## <a name="common-problems"></a>Распространенные проблемы
В этом разделе перечислены распространенные проблемы, которые могут возникнуть, а также приведены действия по их устранению.

| Ошибка | Меры по снижению риска |
| ----- | ---------- |
| "Не удалось выполнить действие, так как наши записи показывают, что вы не включили облачный доступ Red Hat к вашей подписке Azure..." | Чтобы использовать преимущество с виртуальными машинами RHEL, необходимо сначала [зарегистрировать подписки Azure с помощью облачного доступа Red Hat](https://access.redhat.com/management/cloud).

## <a name="next-steps"></a>Следующие шаги
* [Узнайте, как создавать и обновлять виртуальные машины, а также добавлять типы лицензий (RHEL_BYOS, SLES_BYOS) для Преимущество гибридного использования Azure с помощью Azure CLI](/cli/azure/vm)
