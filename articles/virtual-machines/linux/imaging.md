---
title: Общие сведения о создании образов Linux для Azure
description: Как применять свои образы виртуальных машин Linux или создать новые образы для использования в Azure.
author: danielsollondon
ms.service: virtual-machines-linux
ms.subservice: imaging
ms.topic: overview
ms.workload: infrastructure
ms.date: 06/22/2020
ms.author: danis
ms.reviewer: cynthn
ms.openlocfilehash: 223fdc215bc391bea5cad5d4cb9999b9d14ba570
ms.sourcegitcommit: aaa65bd769eb2e234e42cfb07d7d459a2cc273ab
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/27/2021
ms.locfileid: "98878788"
---
# <a name="bringing-and-creating-linux-images-in-azure"></a>Применение и создание образов Linux в Azure

В этом обзоре рассматриваются основные принципы работы с образами, а также способы создания и использования образов Linux в Azure. Прежде чем добавлять пользовательский образ в Azure, следует изучить доступные типы и варианты.

В этой статье мы обсудим точки принятия решений и требования к образам и опишем основные понятия, чтобы вы могли по нашим инструкциям создать собственные пользовательские образы в соответствии со своими требованиями.

## <a name="difference-between-managed-disks-and-images"></a>Разница между управляемыми дисками и образами


Azure позволяет подключать к платформе виртуальные жесткие диски и использовать их в качестве [управляемых дисков](../faq-for-disks.md#managed-disks) или источника для образа. 

Управляемые диски Azure — это отдельные виртуальные жесткие диски. Вы можете взять существующий виртуальный жесткий диск и создать на его основе новый управляемый диск или же создать пустой управляемый диск с нуля. Чтобы создать виртуальные машины на основе управляемых дисков, присоедините нужный диск к виртуальной машине. При этом каждый виртуальный жесткий диск можно использовать только с одной виртуальной машиной. Вы не можете изменять свойства ОС, Azure просто попробует включить и запустить виртуальную машину с использованием выбранного диска. 

Образы Azure могут состоять из нескольких дисков ОС и дисков данных. Если вы используете управляемый образ для создания виртуальной машины, платформа создает копию этого образа и использует ее для создания виртуальной машины, так как управляемые образы поддерживают возможность повторного использования одного и того же образа для нескольких виртуальных машин. Azure также предоставляет расширенные возможности управления для образов, например глобальную репликацию и управление версиями в [Общей коллекции образов](../shared-image-galleries.md). 



## <a name="generalized-and-specialized"></a>Универсальные и специализированные

Azure предлагает два основных типа образов: универсальные и специализированные. Термины "универсальный" и "специализированный" изначально относились к среде Windows, но затем были перенесены в Azure. Эти типы определяют, что будет делать платформа с виртуальной машиной при ее включении. Оба типа имеют свои преимущества, недостатки и необходимые компоненты. Прежде чем приступить к работе, нужно выбрать подходящий тип образа. Ниже описаны разные сценарии с указанием подходящих типов.

| Сценарий      | Тип образа  | Варианты хранилищ |
| ------------- |:-------------:| :-------------:| 
| Создание и настройка образа для использования несколькими виртуальными машинами, чтобы во время первой загрузки можно было задать имя узла, добавить пользователя с правами администратора и выполнить другие задачи. | Универсальный | Общая коллекция образов или автономные управляемые образы |
| Создание образа из моментального снимка виртуальной машины или резервной копии. | Специализированный |Общая коллекция образов или управляемый диск |
| Быстрое создание образа, который не нужно настраивать для создания нескольких виртуальных машин. |Специализированный |Общая коллекция образов |


### <a name="generalized-images"></a>Универсальные образы

Универсальным называют образ, который требует дополнительной настройки при первой загрузке. Например, при первой загрузке вам нужно будет указать имя узла, пользователя с правами администратора и другие конфигурации для конкретной виртуальной машины. Это полезно, если вы хотите многократно использовать один образ или передавать важные параметры во время создания. Если универсальный образ содержит агент Azure, этот агент обработает полученные параметры и сообщит платформе о том, что начальная настройка завершена. Этот процесс называется [подготовкой к работе](./provisioning.md). 

Для подготовки к работе в образ необходимо включить средство подготовки. Есть два доступных средства подготовки:
- [агентом Linux для Azure](../extensions/agent-linux.md)
- [cloud-init](./using-cloud-init.md).

Это [необходимые компоненты](./create-upload-generic.md) для создания образа.


### <a name="specialized-images"></a>Специализированные образы
Так называют образы, которые полностью настроены и не требуют виртуальных машин или настройки специальных параметров. Платформа просто включает виртуальную машину. Но для этого уникальность нужно обеспечить в самой виртуальной машине, например, указав уникальное имя узла, не создающее конфликтов DNS в пределах одной виртуальной сети. 

Для таких образов агенты подготовки не требуются, но могут быть полезны возможности для обработки расширений. Вы можете установить агент Linux с отключенной возможностью подготовки. Хотя агент подготовки не требуется, образ должен удовлетворять всем [предварительным требованиям](./create-upload-generic.md) для образов Azure.


## <a name="image-storage-options"></a>Варианты хранения данных
Для подключения собственного образа Linux у вас есть два варианта:

- Управляемые образы для простого создания виртуальных машин в среде разработки и тестирования.
- [Общая коллекция образов](../shared-image-galleries.md) для создания и совместного использования образов в большом масштабе.


### <a name="managed-images"></a>Управляемые образы

Управляемые образы позволяют создавать несколько виртуальных машин, но имеют много ограничений. Управляемые образы можно создать только из универсального источника (виртуальной машины или виртуального жесткого диска). С их помощью можно создавать виртуальные машины только в одном и том же регионе и нельзя совместно использовать в разных подписках и арендаторах.

Управляемые образы удобно использовать в средах разработки и тестирования, где обычно достаточно пары простых универсальных образов в одних регионе и подписке. 

### <a name="azure-shared-image-gallery-sig"></a>Общая коллекция образов Azure

Для создания, администрирования и совместного использования образов в большом масштабе рекомендуется использовать [Общие галереи образов](../shared-image-galleries.md). Общие галереи образов помогают создавать структуры и организации на основе образов.  

- Поддержка как универсальных, так и специализированных образов.
- Поддержка образов 1-го и 2-го поколений.
- Глобальная репликация образов.
- Контроль версий и группировка образов для более эффективного управления.
- Высокодоступные образы с поддержкой хранилищ, избыточных между зонами, развернутые в регионах, где поддерживаются Зоны доступности. Служба ZRS повышает надежность на случай сбоев в зонах.
- Совместное использование в разных подписках и даже разных клиентах Active Directory (AD) на базе Azure RBAC.
- Масштабирование развертывания с репликацией образов в каждом регионе.

В общем случае создается общая коллекция образов, которая состоит из следующих элементов:
- Определения образов — это контейнеры, содержащие группы образов.
- Версии образов — это и есть сами образы.



## <a name="hyper-v-generation"></a>Поколение Hyper-V

Azure поддерживает Hyper-V поколения 1 (Gen1) и поколения 2 (Gen2). Gen2 на данный момент является последним поколением и предоставляет больше возможностей, чем Gen1. Например, доступно больше памяти, а также есть поддержка расширений Intel Software Guard и виртуализированной персистентной памяти (vPMEM). Виртуальные машины 2-го поколения, работающие в локальной среде, поддерживают некоторые функции, которые еще не поддерживаются в Azure. Дополнительные сведения см. в разделе "Функции и возможности". Дополнительные сведения см. в этой [статье](../generation-2.md). Создайте образы Gen2, если вам нужны расширенные функции.

Если вам нужно создать собственный образ, обеспечьте соответствие [предварительным требованиям для образов](./create-upload-generic.md) и отправьте его в Azure. Требования для конкретных дистрибутивов:


- [Подготовка виртуальной машины на основе CentOS для Azure](create-upload-centos.md)
- [Подготовка виртуального жесткого диска Debian для Azure](debian-create-upload-vhd.md)
- [Flatcar Container Linux](flatcar-create-upload-vhd.md)
- [Oracle Linux](oracle-create-upload-vhd.md)
- [Red Hat Enterprise Linux](redhat-create-upload-vhd.md)
- [Подготовка виртуальной машины SLES или openSUSE для Azure](suse-create-upload-vhd.md)
- [Ubuntu](create-upload-ubuntu.md)


## <a name="next-steps"></a>Дальнейшие действия

Узнайте, как создать [Общую коллекцию образов](tutorial-custom-images.md)