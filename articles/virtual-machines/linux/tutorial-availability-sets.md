---
title: Развертывание виртуальных машин в группе доступности с помощью Azure CLI
description: Из этого руководства вы узнаете, как с помощью Azure CLI развертывать виртуальные машины высокого уровня доступности в группах доступности
documentationcenter: ''
services: virtual-machines
author: mimckitt
ms.service: virtual-machines
ms.topic: how-to
ms.date: 3/8/2021
ms.author: mimckitt
ms.reviewer: mimckitt
ms.custom: ''
ms.openlocfilehash: 7c45f08a339ca8878bb9e2840faa8a412f3e60e0
ms.sourcegitcommit: 4b0e424f5aa8a11daf0eec32456854542a2f5df0
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/20/2021
ms.locfileid: "107765977"
---
# <a name="create-and-deploy-virtual-machines-in-an-availability-set-using-azure-cli"></a>Создание и развертывание виртуальных машин в группе доступности с помощью Azure CLI

В этом руководстве показано, как повысить доступность и надежность решений виртуальных машин в Azure с помощью групп доступности. При развертывании виртуальных машин в Azure группа доступности распределяет их между несколькими изолированными аппаратными кластерами. Таким образом, в случае сбоя оборудования или программного обеспечения в Azure затрагивается только группа виртуальных машин, а общее решение остается доступным для использования.

В этом руководстве описано следующее:

> [!div class="checklist"]
> * "Создать группу доступности"
> * Создание виртуальной машины в группе доступности
> * Проверка доступных размеров виртуальных машин.

При работе с этим руководством используется интерфейс командной строки (CLI) в [Azure Cloud Shell](../../cloud-shell/overview.md), который всегда обновлен до последней версии. Чтобы открыть Cloud Shell, выберите **Попробовать** в верхнем углу любого блока кода.

Если вы решили установить и использовать интерфейс командной строки локально, то для работы с этим руководством вам понадобится Azure CLI 2.0.30 или более поздней версии. Чтобы узнать версию, выполните команду `az --version`. Если вам необходимо выполнить установку или обновление, см. статью [Установка Azure CLI 2.0]( /cli/azure/install-azure-cli).

## <a name="create-an-availability-set"></a>"Создать группу доступности"

Вы можете создать группу доступности с помощью команды [az vm availability-set create](/cli/azure/vm/availability-set). В этом примере число доменов обновления и сбоя равно *2* для группы доступности *myAvailabilitySet* в группе ресурсов *myResourceGroupAvailability*.

Сначала создайте группу ресурсов с помощью команды [az group create](/cli/azure/group#az_group_create), а затем — группа доступности:

```azurecli-interactive
az group create --name myResourceGroupAvailability --location eastus

az vm availability-set create \
    --resource-group myResourceGroupAvailability \
    --name myAvailabilitySet \
    --platform-fault-domain-count 2 \
    --platform-update-domain-count 2
```

Группы доступности позволяют изолировать ресурсы в доменах сбоя и обновления. **Домен сбоя** представляет собой изолированную коллекцию ресурсов сервера, службы хранилища и сетевых ресурсов. В приведенном выше примере группа доступности распределяется по крайней мере между двумя доменами сбоя во время развертывания виртуальных машин. Группа доступности также распределяется между двумя **доменами обновления**. Два домена обновления гарантируют изоляцию ресурсов виртуальной машины при обновлении программного обеспечения в Azure. Так все программное обеспечение виртуальной машины не будет обновляться одновременно.


## <a name="create-vms-inside-an-availability-set"></a>Создание виртуальных машин в группе доступности

Чтобы виртуальные машины правильно распределялись по оборудованию, их нужно создать внутри группы доступности. Существующую виртуальную машину невозможно добавить в группу доступности после создания.

При создании виртуальной машины с помощью команды [az vm create](/cli/azure/vm) можно использовать параметр `--availability-set`, чтобы указать имя группы доступности.

```azurecli-interactive
for i in `seq 1 2`; do
   az vm create \
     --resource-group myResourceGroupAvailability \
     --name myVM$i \
     --availability-set myAvailabilitySet \
     --size Standard_DS1_v2  \
     --vnet-name myVnet \
     --subnet mySubnet \
     --image UbuntuLTS \
     --admin-username azureuser \
     --generate-ssh-keys
done
```

Теперь в группе доступности есть две виртуальные машины. Так как они находятся в одной группе доступности, Azure гарантирует распределение виртуальных машин и всех их ресурсов (включая диски данных) в изолированном физическом оборудовании, за счет чего обеспечивается более высокий уровень доступности всего решения виртуальной машины.

Распределение групп доступности можно просмотреть на портале. Выберите "Группы ресурсов" > myResourceGroupAvailability > myAvailabilitySet. Виртуальные машины распределяются между двумя доменами сбоя и обновления, как показано в следующем примере:

![Группа доступности на портале](./media/tutorial-availability-sets/fd-ud.png)

## <a name="check-for-available-vm-sizes"></a>Знакомство с доступными размерами виртуальной машины

В группу доступности можно добавить дополнительные виртуальные машины позднее, когда станут доступны нужные размеры виртуальных машин для оборудования. Выполните команду [az vm availability-set list-sizes](/cli/azure/vm/availability-set#az_vm_availability_set_list_sizes) для получения списка всех доступных размеров в аппаратном кластере для группы доступности.

```azurecli-interactive
az vm availability-set list-sizes \
     --resource-group myResourceGroupAvailability \
     --name myAvailabilitySet \
     --output table
```

## <a name="next-steps"></a>Дальнейшие действия

В этом руководстве вы узнали, как выполнять следующие задачи:

> [!div class="checklist"]
> * "Создать группу доступности"
> * Создание виртуальной машины в группе доступности
> * Проверка доступных размеров виртуальных машин.

Перейдите к следующему руководству, чтобы узнать о масштабируемых наборах виртуальных машин.

> [!div class="nextstepaction"]
> [Создание масштабируемого набора виртуальных машин](tutorial-create-vmss.md)

* Дополнительные сведения о зонах доступности см. в статье [Что такое Зоны доступности в Azure?](../../availability-zones/az-overview.md).
* Дополнительная документация о группах и зонах доступности также доступна [здесь](../availability.md).
* Чтобы опробовать зоны доступности, ознакомьтесь со статьей [Создание виртуальной машины Linux в зоне доступности с помощью Azure CLI](./create-cli-availability-zone.md)