---
title: Вопросы и ответы. Шифрование дисков Azure для виртуальных машин под управлением Linux
description: В этой статье приведены часто задаваемые вопросы о шифровании дисков Microsoft Azure для виртуальных машин IaaS под управлением Linux.
author: msmbaldwin
ms.service: virtual-machines
ms.collection: linux
ms.subservice: disks
ms.topic: conceptual
ms.author: mbaldwin
ms.date: 06/05/2019
ms.custom: seodec18
ms.openlocfilehash: 6a85af1a5e0603d78dc9bc233fef56417e19c50e
ms.sourcegitcommit: f28ebb95ae9aaaff3f87d8388a09b41e0b3445b5
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/30/2021
ms.locfileid: "102553091"
---
# <a name="azure-disk-encryption-for-linux-virtual-machines-faq"></a>Шифрование дисков Azure для виртуальных машин Linux — вопросы и ответы

В этой статье приведены часто задаваемые вопросы о шифровании дисков Azure для виртуальных машин под управлением Linux. Дополнительные сведения об этой службе см. в статье [Общие сведения о шифровании дисков Azure](disk-encryption-overview.md).

## <a name="what-is-azure-disk-encryption-for-linux-vms"></a>Что такое шифрование дисков Azure для виртуальных машин под управлением Linux?

Шифрование дисков Azure для виртуальных машин под управлением Linux использует функцию dm-crypt в Linux для обеспечения полного шифрования диска операционной системы* и дисков данных. Кроме того, он обеспечивает шифрование временного диска при использовании [функции EncryptFormatAll](disk-encryption-linux.md#use-encryptformatall-feature-for-data-disks-on-linux-vms). Содержимое передается в зашифрованном виде из виртуальной машины в серверную часть хранилища. Таким образом, обеспечивается сквозное шифрование с ключом, управляемым клиентом.
 
Подробнее см. [Поддерживаемые виртуальные машины и операционные системы](disk-encryption-overview.md#supported-vms-and-operating-systems).

## <a name="where-is-azure-disk-encryption-in-general-availability-ga"></a>В каких регионах предоставляется общедоступная версия шифрования дисков Azure?

Шифрование дисков Azure для виртуальных машин под управлением Linux предоставляется в режиме общей доступности во всех общедоступных регионах Azure.

## <a name="what-user-experiences-are-available-with-azure-disk-encryption"></a>Какие возможности предоставляет шифрование дисков Azure?

Шифрование дисков Azure (общедоступная версия) поддерживает шаблоны Azure Resource Manager, Azure PowerShell и Azure CLI. Благодаря таким различным возможностям обеспечивается гибкость. Шифрование дисков на виртуальных машинах можно включить тремя разными способами. Дополнительные сведения о возможностях для пользователей и пошаговые инструкции по работе с шифрованием дисков Azure доступны в [сценариях шифрования дисков Azure для Linux](disk-encryption-linux.md).

## <a name="how-much-does-azure-disk-encryption-cost"></a>Какова стоимость шифрования дисков Azure?

Плата за шифрование дисков виртуальной машины с помощью шифрования дисков Azure не взимается, но оплачивается использование Azure Key Vault. Дополнительные сведения о ценах на Azure Key Vault см. на [этой странице](https://azure.microsoft.com/pricing/details/key-vault/).

## <a name="how-can-i-start-using-azure-disk-encryption"></a>Как приступить к работе с шифрованием дисков Azure?

Чтобы приступить к работе, ознакомьтесь с [обзором шифрования дисков Azure](disk-encryption-overview.md).

## <a name="what-vm-sizes-and-operating-systems-support-azure-disk-encryption"></a>В каких операционных системах и для каких размеров виртуальных машин поддерживается шифрование дисков Azure?

В статье [Общие сведения о шифровании дисков Azure](disk-encryption-overview.md) перечислены все [размеры виртуальных машин](disk-encryption-overview.md#supported-vms) и [операционные системы виртуальных машин](disk-encryption-overview.md#supported-operating-systems), которые поддерживают шифрование дисков Azure.

## <a name="can-i-encrypt-both-boot-and-data-volumes-with-azure-disk-encryption"></a>Можно ли с помощью шифрования дисков Azure зашифровать загрузочные тома и тома данных?

Да, вы можете зашифровать загрузочные тома и тома данных или том данных без предварительного шифрования тома операционной системы. 

После шифрования тома операционной системы шифрование тома ОС невозможно отключить. Для виртуальных машин Linux в масштабируемом наборе может быть зашифрован только том данных.

## <a name="can-i-encrypt-an-unmounted-volume-with-azure-disk-encryption"></a>Можно ли с помощью шифрования дисков Azure зашифровать отключенный том?

Нет, шифрование дисков Azure шифрует только подключенные тома.

## <a name="what-is-storage-server-side-encryption"></a>Что такое шифрование на стороне сервера хранилища?

Шифрование на стороне сервера шифрует управляемые диски Azure в службе хранилища Azure. Управляемые диски по умолчанию шифруются службой шифрования на стороне сервера с ключом, управляемым платформой (начиная с 10 июня 2017 г.). Вы можете применить для управления шифрованием управляемых дисков собственные ключи, настроив использование ключа, управляемого клиентом. Дополнительные сведения см. в разделах: [Шифрование управляемых дисков Azure на стороне сервера](../disk-encryption.md).
 
## <a name="how-is-azure-disk-encryption-different-from-storage-server-side-encryption-with-customer-managed-key-and-when-should-i-use-each-solution"></a>Чем шифрование дисков Azure отличается от шифрования на стороне сервера хранилища с ключом, управляемым клиентом, и в каких условиях лучше применять эти варианты?

Шифрование дисков Azure обеспечивает сквозное шифрование диска операционной системы, дисков данных и временного диска с ключом, управляемым клиентом.
- Если в ваши требования входит шифрование всех указанных выше элементов и применение сквозного шифрования, используйте шифрование дисков Azure. 
- Если вам достаточно шифровать с помощью управляемого клиентом ключа только неактивные данные, выбирайте [шифрование на стороне сервера с ключами, управляемыми клиентом](../disk-encryption.md). Вы не сможете применить к одному диску одновременно шифрование дисков Azure и шифрование на стороне сервера хранилища с ключами, управляемыми клиентом. 
- Если дистрибутив Linux не указан в списке [Поддерживаемые операционные системы для шифрования дисков Azure](disk-encryption-overview.md#supported-operating-systems) или используется один из [неподдерживаемых сценариев для Windows](disk-encryption-linux.md#unsupported-scenarios), рассмотрите возможность [шифрования на стороне сервера с помощью управляемых клиентом ключей](../disk-encryption.md).
- Если политика вашей организации позволяет шифровать содержимое при хранении с помощью ключа, управляемого Azure, то никаких действий выполнять не нужно, так как содержимое уже шифруется по умолчанию. На управляемых дисках содержимое внутри хранилища по умолчанию шифруется с применением шифрования на стороне сервера и ключом, управляемым платформой. Этот ключ управляется службой хранилища Azure. 



## <a name="how-do-i-rotate-secrets-or-encryption-keys"></a>Как сменить секреты или ключи шифрования?

Для смены секретов просто вызовите ту же команду, которую вы выполнили для включения шифрования диска, указав другой Key Vault. Для смены ключа шифрования ключей вызовите ту же команду, которую вы выполнили для включения шифрования диска, указав новый тип шифрования ключей. 

>[!WARNING]
> - Если вы уже использовали [шифрование дисков Azure с использованием приложения Azure AD](disk-encryption-linux-aad.md) и указывали учетные данные AAD для шифрования этой виртуальной машины, продолжайте и далее использовать этот вариант для шифрования виртуальной машины. На такой зашифрованной виртуальной машине нельзя использовать шифрование дисков Azure, так как этот сценарий не поддерживается. Пока невозможно отменить применение приложения AAD для зашифрованной с его помощью виртуальной машины.

## <a name="how-do-i-add-or-remove-a-key-encryption-key-if-i-didnt-originally-use-one"></a>Как мне добавить или удалить ключ шифрования ключа, если я раньше его не использовал?

Чтобы добавить ключ шифрования ключа, повторно вызовите команду включения, передав в параметре нужный ключ шифрования ключа. Чтобы удалить ключ шифрования ключа, повторно вызовите команду включения без параметра ключа шифрования ключа.

## <a name="does-azure-disk-encryption-allow-you-to-bring-your-own-key-byok"></a>Дает ли служба шифрования дисков Azure возможность создания собственных ключей (BYOK)?

Да, вы можете предоставить собственные ключи шифрования ключей. Эти ключи хранятся в Azure Key Vault, что представляет собой хранилище ключей для шифрования дисков Azure. Дополнительные сведения о сценариях поддержки ключа шифрования ключей см. в статье [Создание и настройка хранилища ключей для службы "Шифрование дисков Azure"](disk-encryption-key-vault.md).

## <a name="can-i-use-an-azure-created-key-encryption-key"></a>Можно ли использовать ключ шифрования ключей, созданный в Azure?

Да, можно использовать Azure Key Vault, чтобы создать ключ шифрования ключей для использования шифрования дисков Azure. Эти ключи хранятся в Azure Key Vault, что представляет собой хранилище ключей для шифрования дисков Azure. Дополнительные сведения о ключе шифрования ключей см. в статье [Создание и настройка хранилища ключей для службы "Шифрование дисков Azure"](disk-encryption-key-vault.md).

## <a name="can-i-use-an-on-premises-key-management-service-or-hsm-to-safeguard-the-encryption-keys"></a>Можно ли использовать локальную службу управления ключами или HSM для защиты ключей шифрования?

Использовать локальную службу управления ключами или HSM для защиты ключей шифрования с шифрованием дисков Azure нельзя. Для защиты ключей шифрования можно использовать только Azure Key Vault. Дополнительные сведения о сценариях поддержки ключа шифрования ключей см. в статье [Создание и настройка хранилища ключей для службы "Шифрование дисков Azure"](disk-encryption-key-vault.md).

## <a name="what-are-the-prerequisites-to-configure-azure-disk-encryption"></a>Каковы предварительные требования для настройки шифрования дисков Azure?

Для использования шифрования дисков Azure существуют предварительные требования. Чтобы создать хранилище ключей или установить имеющееся для доступа к шифрованию диска для включения шифрования и обеспечения защиты секретов и ключей, перейдите к статье [Создание и настройка хранилища ключей для службы "Шифрование дисков Azure"](disk-encryption-key-vault.md). Дополнительные сведения о сценариях поддержки ключа шифрования ключей см. в статье [Создание и настройка хранилища ключей для службы "Шифрование дисков Azure"](disk-encryption-key-vault.md).

## <a name="what-are-the-prerequisites-to-configure-azure-disk-encryption-with-an-azure-ad-app-previous-release"></a>Каковы предварительные требования для настройки шифрования дисков Azure с использованием приложения Azure AD (предыдущий выпуск)?

Для использования шифрования дисков Azure существуют предварительные требования. Чтобы создать приложение Azure Active Directory, создать хранилище ключей или установить имеющееся для доступа к шифрованию диска для включения шифрования и обеспечения защиты секретов и ключей, перейдите к статье [Шифрование дисков Azure с помощью Azure AD для виртуальных машин Windows (предыдущий выпуск)](disk-encryption-linux-aad.md). Дополнительные сведения о сценариях поддержки ключа шифрования ключей см. в статье [Создание и настройка хранилища ключей для службы "Шифрование дисков Azure" с помощью Azure AD](disk-encryption-key-vault-aad.md).

## <a name="is-azure-disk-encryption-using-an-azure-ad-app-previous-release-still-supported"></a>Поддерживается ли по-прежнему шифрование дисков Azure с помощью приложения Azure AD (предыдущий выпуск)?
Да. Шифрование дисков с помощью приложения Azure AD по-прежнему поддерживается. Тем не менее при шифровании новых виртуальных машин мы рекомендуем использовать новый метод, а не шифрование с помощью приложения Azure AD. 

## <a name="can-i-migrate-vms-that-were-encrypted-with-an-azure-ad-app-to-encryption-without-an-azure-ad-app"></a>Можно ли перевести виртуальные машины, зашифрованные с помощью приложения Azure AD, на шифрование без приложения Azure AD?
  Сейчас для компьютеров, зашифрованных с помощью приложения Azure AD, нет прямого пути миграции к шифрованию без приложения Azure AD. Кроме того, нет прямого пути от шифрования без приложения Azure AD к шифрованию с помощью приложения AD. 

## <a name="what-version-of-azure-powershell-does-azure-disk-encryption-support"></a>Какую версию Azure PowerShell поддерживает шифрование дисков Azure?

Для настройки шифрования дисков Azure используйте последнюю версию пакета SDK для Azure PowerShell. Скачайте последнюю версию [Azure PowerShell](https://github.com/Azure/azure-powershell/releases). Шифрование дисков Azure *не* поддерживается в пакете SDK для Azure версии 1.1.0.

> [!NOTE]
> Расширение Microsoft.OSTCExtension.AzureDiskEncryptionForLinux для шифрования дисков Linux Azure не рекомендуется. Это расширение опубликовано для предварительной версии Шифрования дисков Azure. Не следует использовать предварительную версию расширения в тестовом или рабочем развертывании.

> Для сценариев развертывания, таких как Azure Resource Manager (ARM), где вам нужно развернуть расширение Шифрования дисков Azure для виртуальной машины Linux, чтобы включить шифрование на виртуальной машине IaaS под управлением Linux, необходимо использовать поддерживаемое в рабочей среде расширение Microsoft.Azure.Security.AzureDiskEncryptionForLinux для шифрования дисков Azure.

## <a name="can-i-apply-azure-disk-encryption-on-my-custom-linux-image"></a>Можно ли применять шифрование дисков Azure в пользовательском образе Linux?

Шифрование дисков Azure применить в пользовательском образе Linux нельзя. Поддерживаются только образы Linux из коллекции поддерживаемых дистрибутивов, приведенных выше. Пользовательские образы Linux сейчас не поддерживаются.

## <a name="can-i-apply-updates-to-a-linux-red-hat-vm-that-uses-the-yum-update"></a>Можно ли применить обновления к виртуальной машине Linux Red Hat с использованием команды yum update?

Да, можно выполнить обновление с использованием команды yum update для виртуальной машины Red Hat Linux.  Дополнительные сведения см. в статье [Шифрование дисков Azure в изолированной сети](disk-encryption-isolated-network.md).

## <a name="what-is-the-recommended-azure-disk-encryption-workflow-for-linux"></a>Какие действия по шифрованию дисков Azure рекомендуется использовать для Linux?

Для достижения наилучших результатов в Linux рекомендуется такая последовательность действий:
* Для начала выберите неизмененный готовый образ из коллекции, соответствующий требуемому дистрибутиву и версии операционной системы.
* Создайте резервные копии всех подключенных дисков, которые будут зашифрованы.  Это позволит выполнить восстановление в случае сбоя, например при перезагрузке виртуальной машины до завершения шифрования.
* Выполните шифрование (этот процесс может занять несколько часов или даже дней в зависимости от характеристик виртуальной машины и размера всех подключенных дисков данных).
* При необходимости настройте образ и добавьте к нему программное обеспечение.

Если эти действия невозможно выполнить, в качестве альтернативы шифрованию всего диска с помощью dm-crypt можно воспользоваться [шифрованием службы хранилища](../../storage/common/storage-service-encryption.md) (SSE) на уровне учетной записи хранения платформы.

## <a name="what-is-the-disk-bek-volume-or-mntazure_bek_disk"></a>Что такое том BEK или /mnt/azure_bek_disk?

Том Bek представляет собой локальный том данных, который надежно хранит ключи шифрования для зашифрованных виртуальных машин Azure.
> [!NOTE]
> Не удаляйте и не изменяйте содержимое на этом диске. Не отключайте диск, так как ключ шифрования необходим для любой операции шифрования на виртуальной машине IaaS.


## <a name="what-encryption-method-does-azure-disk-encryption-use"></a>Какой метод шифрования используется в шифровании дисков Azure?

Шифрование дисков Azure использует метод расшифровки по умолчанию aes-xts-plain64 с 256-разрядным главным ключом тома.

## <a name="if-i-use-encryptformatall-and-specify-all-volume-types-will-it-erase-the-data-on-the-data-drives-that-we-already-encrypted"></a>Если используется параметр EncryptFormatAll и указаны все типы томов, удалятся ли данные из уже зашифрованных дисков?
Нет. Данные не удаляются из дисков, которые уже зашифрованы с помощью службы шифрования дисков Azure. Так же как и в случае с диском ОС, параметр EncryptFormatAll не шифрует повторно уже зашифрованные диски данных. Дополнительные сведения см. в разделе [Использование параметра EncryptFormatAll с Azure CLI](disk-encryption-linux.md#use-encryptformatall-feature-for-data-disks-on-linux-vms).        

## <a name="is-xfs-filesystem-supported"></a>Поддерживается ли файловая система XFS?
Шифрование дисков ОС XFS поддерживается.

Шифрование дисков данных XFS поддерживается только при использовании параметра EncryptFormatAll. Это приведет к переформатированию тома, а также к удалению всех данных, сохраненных ранее. Дополнительные сведения см. в разделе [Использование параметра EncryptFormatAll с Azure CLI](disk-encryption-linux.md#use-encryptformatall-feature-for-data-disks-on-linux-vms).

## <a name="can-i-backup-and-restore-an-encrypted-vm"></a>Можно ли выполнять резервное копирование и восстановление для зашифрованной виртуальной машины? 

Azure Backup предоставляет механизм резервного копирования и восстановления зашифрованных виртуальных машин в пределах одной подписки и одного региона.  Инструкции для этих процессов приводятся в статье [Резервное копирование и восстановление зашифрованной виртуальной машины Azure](../../backup/backup-azure-vms-encryption.md).  Восстановление зашифрованной виртуальной машины в другом регионе в настоящее время не поддерживается.  

## <a name="where-can-i-go-to-ask-questions-or-provide-feedback"></a>Где можно задать вопрос или оставить отзыв?

Вы можете задать вопрос или оставить отзыв на [странице вопросов и ответов на сайте Майкрософт, посвященной шифрованию дисков Azure](/answers/topics/azure-disk-encryption.html).

## <a name="next-steps"></a>Дальнейшие действия
Из этого документа вы получили ответы на самые распространенные вопросы, связанные с шифрованием дисков Azure. Дополнительные сведения об этой службе см. в следующих статьях:

- [Шифрование дисков Azure для виртуальных машин IaaS](disk-encryption-overview.md)
- [Шифрование диска в центре безопасности Azure](../../security-center/asset-inventory.md)
- [Шифрование неактивных данных в Azure](../../security/fundamentals/encryption-atrest.md)