---
title: Использование ключей SSH для подключения к виртуальным машинам Linux
description: Узнайте, как создавать и использовать ключи SSH с компьютера Windows для подключения к виртуальной машине Linux в Azure.
author: cynthn
ms.service: virtual-machines
ms.collection: linux
ms.workload: infrastructure-services
ms.date: 10/31/2020
ms.topic: how-to
ms.author: cynthn
ms.openlocfilehash: aeecdcddaeba385c6dc0773356bcd0e36231e1e4
ms.sourcegitcommit: 772eb9c6684dd4864e0ba507945a83e48b8c16f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "104607472"
---
# <a name="how-to-use-ssh-keys-with-windows-on-azure"></a>Как использовать ключи SSH с Windows в Azure

Эта статья предназначена для пользователей Windows, желающих [создать](#create-an-ssh-key-pair) и использовать ключи *Secure Shell* (SSH) для [подключения](#connect-to-your-vm) к виртуальным машинам Linux в Azure. Вы также можете [создать и сохранить ключи SSH в портал Azure,](../ssh-keys-portal.md) которые будут использоваться при создании виртуальных машин на портале.


Чтобы использовать ключи SSH из клиента Linux или macOS, ознакомьтесь с [краткими инструкциями](mac-create-ssh-keys.md). Более подробный обзор SSH см. в [статье Создание ключей SSH и управление ими для проверки подлинности на виртуальной машине Linux в Azure](create-ssh-keys-detailed.md).

## <a name="overview-of-ssh-and-keys"></a>Общие сведения о SSH и ключах

[SSH](https://www.ssh.com/ssh/) — это протокол зашифрованного соединения, позволяющий выполнять безопасные входы по незащищенным соединениям. SSH — это протокол подключения по умолчанию для виртуальных машин Linux, размещенных в Azure. Хотя протокол SSH и обеспечивает зашифрованное подключение, при использовании паролей с SSH виртуальные машины все равно не защищены от атак методом подбора. Мы рекомендуем подключаться к виртуальной машине по протоколу SSH с помощью пары открытого и закрытого ключей, также называемых *ключами SSH*. 

Пара открытого и закрытого ключей аналогична блокировке передней дверцы. Блокировка предоставляется **общедоступной**, любой пользователь с правом ключом может открыть дверцу. Ключ является **частным** и предоставляется только доверенным людям, так как его можно использовать для разблокировки дверцы. 

- *Открытый ключ* размещается на виртуальной машине Linux при создании виртуальной машины. 

- *Закрытый ключ* остается в локальной системе. Его нужно защищать и нельзя никому предоставлять.

При подключении к виртуальной машине Linux виртуальная машина проверяет SSH-клиент, чтобы убедиться, что он имеет правильный закрытый ключ. Если у клиента есть закрытый ключ, он получает доступ к виртуальной машине. 

В зависимости от политик безопасности Организации можно повторно использовать одну пару ключей для доступа к нескольким виртуальным машинам и службам Azure. Для каждой виртуальной машины не требуется отдельная пара ключей. 

Открытый ключ можно использовать совместно с любым пользователем, но только вы (или ваша локальная инфраструктура безопасности) должны иметь доступ к вашему закрытому ключу.

[!INCLUDE [virtual-machines-common-ssh-support](../../../includes/virtual-machines-common-ssh-support.md)]

## <a name="ssh-clients"></a>SSH-клиенты

В последние версии Windows 10 входят [клиентские команды OpenSSH](https://blogs.msdn.microsoft.com/commandline/2018/03/07/windows10v1803/) для создания и использования ключей SSH и создания SSH-подключений из PowerShell или командной строки. Это самый простой способ создать SSH-подключение к виртуальной машине Linux с компьютера Windows. 

Можно также использовать Bash в [Azure Cloud Shell](../../cloud-shell/overview.md) для подключения к виртуальной машине. Cloud Shell можно использовать в [веб-браузере](https://shell.azure.com/bash), [портал Azure](https://portal.azure.com)или в качестве терминала в Visual Studio Code с помощью [расширения учетной записи Azure](https://marketplace.visualstudio.com/items?itemName=ms-vscode.azure-account).

Вы также можете установить [подсистему Windows для Linux](/windows/wsl/about) , чтобы подключиться к виртуальной машине по протоколу SSH и использовать другие собственные средства Linux в оболочке bash.

## <a name="create-an-ssh-key-pair"></a>Создание пары ключей SSH

Создайте пару ключей SSH с помощью `ssh-keygen` команды. Введите имя файла или используйте значение по умолчанию, показанное в скобках (например, `C:\Users\username/.ssh/id_rsa` ).  Введите парольную фразу для файла или оставьте пустым парольную фразу, если вы не хотите использовать парольную фразу. 

```powershell
ssh-keygen -m PEM -t rsa -b 4096
```

## <a name="create-a-vm-using-your-key"></a>Создание виртуальной машины с помощью ключа

Чтобы создать виртуальную машину Linux, использующую ключи SSH для проверки подлинности, укажите открытый ключ SSH при создании виртуальной машины.

С помощью Azure CLI вы указываете путь и имя файла для открытого ключа с помощью `az vm create` и `--ssh-key-value` параметра.

```azurecli
az vm create \
   --resource-group myResourceGroup \
   --name myVM \
   --image UbuntuLTS\
   --admin-username azureuser \
   --ssh-key-value ~/.ssh/id_rsa.pub
```

В PowerShell используйте `New-AzVM` и добавьте ключ SSH в конфигурацию виртуальной машины с помощью. Пример см. в разделе [Краткое руководство. Создание виртуальной машины Linux в Azure с помощью PowerShell](quick-create-powershell.md).

При выполнении большого количества развертываний с помощью портала может потребоваться передать открытый ключ в Azure, где его можно легко выбрать при создании виртуальной машины на портале. Дополнительные сведения см. [в разделе Отправка ключа SSH](../ssh-keys-portal.md#upload-an-ssh-key).


## <a name="connect-to-your-vm"></a>Подключение к виртуальной машине

С помощью открытого ключа, развернутого на виртуальной машине Azure, и закрытого ключа в локальной системе установите SSH-подключение к виртуальной машине, используя ее IP-адрес или DNS-имя. Замените *azureuser* и *10.111.12.123* в следующей команде на имя пользователя администратора, IP-адрес (или полное доменное имя) и путь к закрытому ключу:

```bash
ssh -i ~/.ssh/id_rsa.pub azureuser@10.111.12.123
```

Если вы настроили парольную фразу при создании пары ключей, введите парольную фразу при появлении запроса.

Если виртуальная машина использует политику доступа JIT, запросите доступ, прежде чем подключиться к виртуальной машине. Дополнительные сведения о политике JIT см. в статье [Управление доступом к виртуальным машинам с помощью JIT-доступа](../../security-center/security-center-just-in-time.md).


## <a name="next-steps"></a>Дальнейшие действия

- Сведения о ключах SSH в портал Azure см. в разделе [Создание и хранение ключей SSH в портал Azure](../ssh-keys-portal.md) , которые используются при создании виртуальных машин на портале.

- Подробные инструкции, параметры и дополнительные примеры работы с ключами SSH приведены в статье [Подробные инструкции: создание ключей SSH для аутентификации на виртуальной машине Linux в Azure и управление этими ключами](create-ssh-keys-detailed.md).

- Для создания ключей SSH и установления SSH-подключений к виртуальным машинам Linux можно также использовать PowerShell в Azure Cloud Shell. Ознакомьтесь с разделом [Краткое руководство по использованию PowerShell в Azure Cloud Shell (предварительная версия)](../../cloud-shell/quickstart-powershell.md#ssh).

- Если при подключении к виртуальным машинам Linux по протоколу SSH возникают трудности, см. статью [Troubleshoot SSH connections to an Azure Linux VM that fails, errors out, or is refused](/troubleshoot/azure/virtual-machines/troubleshoot-ssh-connection?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) (Устранение неполадок с ошибками, сбоем или отклонением SSH-подключения к виртуальной машине Azure Linux).