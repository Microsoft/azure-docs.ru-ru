---
title: 'Предварительная версия: доверенный запуск для виртуальных машин Azure'
description: Сведения о доверенном запуске для виртуальных машин Azure.
author: khyewei
ms.author: khwei
ms.service: virtual-machines
ms.subservice: trusted-launch
ms.topic: conceptual
ms.date: 02/26/2021
ms.reviewer: cynthn
ms.custom: template-concept; references_regions
ms.openlocfilehash: 01c5d4aaa3896e05bc743be309df050471ece5ae
ms.sourcegitcommit: 772eb9c6684dd4864e0ba507945a83e48b8c16f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "104582057"
---
# <a name="trusted-launch-for-azure-virtual-machines-preview"></a>Доверенный запуск для виртуальных машин Azure (Предварительная версия)

Azure предлагает надежный запуск как простой способ повысить безопасность виртуальных машин [поколения 2](generation-2.md) . Надежный запуск защищает от сложных и устойчивых методов атак. Доверенный запуск состоит из нескольких скоординированных технологий инфраструктуры, которые можно включить независимо. Каждая технология обеспечивает другой уровень защиты от сложных угроз.

> [!IMPORTANT]
> Для доверенного запуска требуется создание новых виртуальных машин. Вы не можете включить доверенный запуск на существующих виртуальных машинах, которые изначально были созданы без него.
>
> Доверенный запуск в настоящее время находится в общедоступной предварительной версии.
> Эта предварительная версия предоставляется без соглашения об уровне обслуживания и не рекомендована для использования рабочей среде. Некоторые функции могут не поддерживаться или их возможности могут быть ограничены. 
>
> Дополнительные сведения см. в статье [Дополнительные условия использования предварительных выпусков Microsoft Azure](https://azure.microsoft.com/support/legal/preview-supplemental-terms/).


## <a name="benefits"></a>Преимущества 

- Безопасное развертывание виртуальных машин с проверенными загрузчиками загрузки, ядрами ОС и драйверами.
- Безопасно Защитите ключи, сертификаты и секреты на виртуальных машинах.
- Получите ценные сведения и уверенность в целостности всей цепочки загрузки.
- Убедитесь, что рабочие нагрузки являются доверенными и проверяемыми.

## <a name="public-preview-limitations"></a>Ограничения общедоступной предварительной версии

**Поддержка размера**: все размеры виртуальных машин [поколения 2](generation-2.md) , кроме:

- Серия Lsv2 
- Серия M 
- Серия Mv2 
- Серия NDv4 
- Серия NVv4

**Поддержка ОС**:
- RedHat Enterprise Linux 8,3
- SUSE 15 SP2
- Ubuntu 20.04 LTS
- Ubuntu 18.04 LTS
- Windows Server 2019
- Windows Server 2016
- Windows 10 Pro
- Windows 10 Корпоративная

**Области**. 
- Центрально-южная часть США
- Северная Европа

**Цены**: дополнительные затраты на существующие цены на виртуальные машины не взимается.

**В этой предварительной версии не поддерживаются следующие функции**:
- Резервное копирование
- Azure Site Recovery
- Общая коллекция образов
- Временный диск ОС
- Общий диск
- Управляемый образ
- Выделенный узел Azure 

## <a name="secure-boot"></a>Безопасная загрузка

В корне доверенного запуска выполняется безопасная загрузка виртуальной машины. Этот режим, реализованный в встроенном по платформы, обеспечивает защиту от установки rootkit-программ на основе вредоносного по и комплектов загрузки. Безопасная загрузка обеспечивает возможность загрузки только подписанных операционных систем и драйверов. Он устанавливает "корень доверия" для стека программного обеспечения на виртуальной машине. При включенной безопасной загрузке все компоненты загрузки ОС (загрузчик, ядро, драйверы ядра) должны быть подписаны доверенными издателями. Как Windows, так и выбор дистрибутивов Linux поддерживают безопасную загрузку. Если безопасной загрузкой не удается проверить, что образ был подписан доверенным издателем, то виртуальная машина не сможет загружаться. Дополнительные сведения см. в статье [Безопасная загрузка](/windows-hardware/design/device-experiences/oem-secure-boot).

## <a name="vtpm"></a>vTPM

Доверенный запуск также вводит vTPM для виртуальных машин Azure. Это виртуализированная версия [доверенный платформенный модуль (TPM)](/windows/security/information-protection/tpm/trusted-platform-module-overview)оборудования, соответствующая спецификации TPM 2.0. Он служит выделенным безопасным хранилищем для ключей и измерений. Доверенный запуск предоставляет виртуальной машине собственный выделенный экземпляр TPM, работающий в безопасной среде за пределами виртуальной машины. VTPM включает [аттестацию](/windows/security/information-protection/tpm/tpm-fundamentals#measured-boot-with-support-for-attestation) , измеряя всю цепочку загрузки виртуальной машины (UEFI, ОС, систему и драйверы). 

Доверенный запуск использует vTPM для выполнения удаленной аттестации в облаке. Используется для проверок работоспособности платформы и принятия решений на основе доверия. При проверке работоспособности доверенный запуск может криптографически сертифицировать правильность загрузки виртуальной машины. В случае сбоя процесса, возможно, из-за того, что на виртуальной машине выполняется несанкционированный компонент, центр безопасности Azure выдаст оповещения о целостности. В оповещениях содержатся сведения о том, какие компоненты не прошли проверку целостности.

## <a name="virtualization-based-security"></a>Обеспечение безопасности на основе виртуализации

[Безопасность на основе виртуализации](/windows-hardware/design/device-experiences/oem-vbs) (VBS) использует гипервизор для создания защищенного и изолированного региона памяти. Windows использует эти регионы для выполнения различных решений безопасности с повышенной защитой от уязвимостей и вредоносных эксплойтов. Доверенный запуск позволяет включить целостность кода низкоуровневой оболочки (обязательная политика HVCI) и Credential Guard в Защитнике Windows.

ОБЯЗАТЕЛЬНАЯ политика HVCI — это мощная система, которая защищает процессы режима ядра Windows от внедрения и выполнения вредоносного или непроверенного кода. Он проверяет драйверы и двоичные файлы режима ядра перед их запуском, предотвращая загрузку неподписанных файлов в память. Это гарантирует, что этот исполняемый код нельзя будет изменить после того, как он сможет загрузиться. Дополнительные сведения о VBS и обязательная политика HVCI см. в статье [безопасность на основе виртуализации (VBS) и обеспечение целостности кода в соответствии с гипервизором (обязательная политика hvci)](https://techcommunity.microsoft.com/t5/windows-insider-program/virtualization-based-security-vbs-and-hypervisor-enforced-code/m-p/240571).

С помощью доверенных запусков и VBS вы можете включить Credential Guard в Защитнике Windows. Эта функция изолирует и защищает секреты, чтобы доступ к ним могли получить только привилегированные системные программы. Это помогает предотвратить несанкционированный доступ к секретам и атакам кражи учетных данных, таким как атаки типа "Pass-a-Hash" (PtH). Дополнительные сведения см. в разделе [Credential Guard](/windows/security/identity-protection/credential-guard/credential-guard).


## <a name="security-center-integration"></a>Интеграция центра безопасности

Доверенный запуск интегрируется с центром безопасности Azure, чтобы обеспечить правильную настройку виртуальных машин. Центр безопасности Azure будет непрерывно оценивать совместимые виртуальные машины и выдавать соответствующие рекомендации.

- **Рекомендация по включению безопасной загрузки** . Эта рекомендация применима только к виртуальным машинам, поддерживающим доверенный запуск. Центр безопасности Azure выявляет виртуальные машины, которые могут включить безопасную загрузку, но отключены. Для ее включения будет выдаваться рекомендация низкого уровня серьезности.
- **Рекомендации по включению vTPM** . Если на виртуальной машине включена VTPM, центр безопасности Azure может использовать его для проведения аттестации гостя и обнаружения сложных шаблонов угроз. Если центр безопасности Azure определяет виртуальные машины, которые поддерживают доверенный запуск и vTPM отключены, для ее включения будет выдаваться рекомендация низкого уровня серьезности. 
- **Оценка работоспособности аттестации** . Если на виртуальной машине включена vTPM, расширение центра безопасности Azure может удаленно проверить, что виртуальная машина загружена в работоспособном режиме. Это называется удаленной аттестацией. Центр безопасности Azure выдает оценку, указывая состояние удаленной аттестации.

## <a name="azure-defender-integration"></a>Интеграция с защитником Azure

Если виртуальные машины правильно настроены с доверенным запуском, защитник Azure может обнаружить проблемы работоспособности виртуальной машины и предупредить о них.

- **Оповещение об ошибке аттестации виртуальной машины** . защитник Azure периодически выполняет аттестацию на виртуальных машинах. Это также происходит после загрузки виртуальной машины. В случае сбоя аттестации будет вызвано оповещение со средним уровнем серьезности.
    Аттестация виртуальной машины может завершиться сбоем по следующим причинам:
    - Аттестация информации, которая включает журнал загрузки, отличается от доверенного базового уровня. Это может означать, что ненадежные модули загружены, и операционная система может быть скомпрометирована.
    - Не удалось проверить квоту аттестации, исходя из vTPM аттестации виртуальной машины. Это может означать, что вредоносная программа имеется и может перехватывать трафик к vTPM.
    - Расширение аттестации на виртуальной машине не отвечает. Это может означать атаку типа "отказ в обслуживании" вредоносной программы или администратора операционной системы.

    > [!NOTE]
    >  Это оповещение доступно для виртуальных машин с включенным vTPM, а также с установленным расширением аттестации. Для передачи аттестации должна быть включена безопасная загрузка. Если безопасная загрузка отключена, аттестация завершится ошибкой. Если необходимо отключить безопасную загрузку, можно отключить это предупреждение, чтобы избежать ложных срабатываний.

- **Предупреждение для модуля ядра Linux без доверия** . для доверенного запуска с включенной безопасной загрузкой виртуальная машина может загружаться, даже если драйвер ядра не проходит проверку и его загрузка запрещено. В этом случае защитник Azure выдаст предупреждение низкого уровня серьезности. Хотя ненадежная угроза отсутствует, поскольку ненадежный драйвер не загружен, эти события следует исследовать. Рассмотрим следующий пример.
    - Какой драйвер ядра не удалось выполнить? Я уже знаком с этим драйвером и предполагаю, что он будет загружен?
    - Это именно та версия драйвера, которую я ожидала? Не повреждены ли двоичные файлы драйверов? Если это сторонний драйвер, поставщик прошел проверку на соответствие ОС, чтобы получить подписывание.


## <a name="faq"></a>Вопросы и ответы

Часто задаваемые вопросы о доверенном запуске.

### <a name="why-should-i-use-trusted-launch-what-does-trusted-launch-guard-against"></a>Зачем использовать доверенный запуск? В чем заключается доверенный запуск защиты?

Доверенный запуск защищается комплектами загрузки, программами rootkit и вредоносными программами уровня ядра. Эти сложные типы вредоносных программ выполняются в режиме ядра и остаются скрытыми для пользователей. Пример:
- Пакеты rootkit встроенного по — перезапишут встроенное по BIOS виртуальной машины, чтобы программа rootkit могла начаться раньше операционной системы. 
- Комплекты загрузки. Эти пакеты заменяют загрузчик операционной системы, чтобы виртуальная машина загружала комплект загрузки перед операционной системой.
- Rootkit-программы ядра. Эти наборы заменяют часть ядра ОС, чтобы программа rootkit могла запуститься автоматически при загрузке ОС.
- Программы для работы с драйверами. Эти пакеты представляют собой один из доверенных драйверов, используемых операционной системой для связи с компонентами виртуальной машины.

### <a name="what-are-the-differences-between-secure-boot-and-measured-boot"></a>Каковы различия между безопасной загрузкой и измеряемой загрузкой?

В цепочке безопасной загрузки каждый шаг процесса загрузки проверяет криптографическую подпись последующих шагов. Например, BIOS проверяет подпись загрузчика, и загрузчик проверяет подписи всех загружаемых объектов ядра и т. д. Если какой бы то ни было объект скомпрометирован, подпись не будет совпадать, а виртуальная машина не загрузится. Дополнительные сведения см. в статье [Безопасная загрузка](/windows-hardware/design/device-experiences/oem-secure-boot). Измеряемая загрузка не прерывает процесс загрузки, он измеряет или вычисляет хэш следующих объектов в цепочке и сохраняет хэши в реестрах конфигурации платформы (PCRs) в vTPM. Измеряемые загрузочные записи используются для мониторинга целостности загрузки.

### <a name="what-happens-when-an-integrity-fault-is-detected"></a>Что происходит при обнаружении ошибки целостности?

Доверенный запуск для виртуальных машин Azure отслеживается для опытных угроз. При обнаружении таких угроз будет активировано предупреждение. Оповещения доступны только на уровне " [стандартный](../security-center/security-center-pricing.md) " центра безопасности Azure.
Центр безопасности Azure периодически выполняет аттестацию. В случае сбоя аттестации будет активировано оповещение со средним уровнем серьезности. Надежная аттестация запуска может завершиться сбоем по следующим причинам: 
- Аттестация информации, которая включает в себя журнал доверенной вычислительной системы (TCB), отличается от доверенного базового уровня (например, если включена безопасная загрузка). Это может означать, что ненадежные модули загружены и операционная система может быть скомпрометирована.
- Не удалось проверить квоту аттестации, исходя из vTPM аттестации виртуальной машины. Это может означать, что вредоносная программа имеется и может перехватить трафик в доверенный платформенный модуль. 
- Расширение аттестации на виртуальной машине не отвечает. Это может означать атаку типа "отказ в обслуживании" вредоносной программы или администратора операционной системы.

  
### <a name="how-does-trusted-launch-compared-to-hyper-v-shielded-vm"></a>Как по сравнению с экранированной виртуальной машиной Hyper-V требуется доверенный запуск?
Экранированная виртуальная машина Hyper-V сейчас доступна только в Hyper-V. [Экранированная виртуальная машина Hyper-V](/windows-server/security/guarded-fabric-shielded-vm/guarded-fabric-and-shielded-vms) обычно развертывается вместе с защищенной структурой. Защищенная структура состоит из службы защиты узла (HGS), одного или нескольких защищенных узлов и набора экранированных виртуальных машин. Экранированные виртуальные машины Hyper-V предназначены для использования в структурах, где данные и состояние виртуальной машины должны быть защищены как от администраторов структуры, так и от ненадежного программного обеспечения, которое может выполняться на узлах Hyper-V. Доверенный запуск с другой стороны можно развернуть как автономную виртуальную машину или масштабируемые наборы виртуальных машин в Azure без дополнительного развертывания и управления HGS. Все функции доверенного запуска можно включить с помощью простого изменения в коде развертывания или флажка на портал Azure.  

### <a name="how-can-i-convert-existing-vms-to-trusted-launch"></a>Как преобразовать существующие виртуальные машины в доверенный запуск?
Для виртуальной машины поколения 2 путь миграции для преобразования в доверенный запуск предназначен для общего доступа (общедоступная версия).

## <a name="next-steps"></a>Дальнейшие действия

Разверните [доверенную виртуальную машину запуска с помощью портала](trusted-launch-portal.md).