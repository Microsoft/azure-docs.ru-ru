---
title: Поддержка Azure для виртуальных машин 2-го поколения
description: Общие сведения о поддержке Azure для виртуальных машин 2-го поколения.
author: ju-shim
ms.service: virtual-machines
ms.subservice: generation-2-vm
ms.workload: infrastructure-services
ms.topic: how-to
ms.date: 02/26/2021
ms.author: jushiman
ms.openlocfilehash: a9c832d9a5e90cb2c9ffcbe8a26cdb08ebcddfcc
ms.sourcegitcommit: 7edadd4bf8f354abca0b253b3af98836212edd93
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/10/2021
ms.locfileid: "102553125"
---
# <a name="support-for-generation-2-vms-on-azure"></a>Поддержка виртуальных машин 2-го поколения в Azure

Поддержка виртуальных машин 2-го поколения теперь доступна в Azure. Невозможно изменить поколение виртуальной машины после ее создания, поэтому, прежде чем выбрать поколение, ознакомьтесь с рекомендациями на этой странице.

Виртуальные машины 2-го поколения поддерживают ключевые функции, которые не поддерживаются в 1-м поколении. Эти функции включают увеличенную память, Intel Software Guard Extensions и виртуализированную постоянную память (vPMEM). Виртуальные машины 2-го поколения, работающие в локальной среде, поддерживают некоторые функции, которые еще не поддерживаются в Azure. Дополнительные сведения см. в разделе [Функции и возможности](#features-and-capabilities).

Виртуальные машины 2-го поколения используют новую архитектуру загрузки на основе UEFI, а не архитектуру на основе BIOS, используемую виртуальными машинами 1-го поколения. Виртуальные машины 2-го поколения быстрее загружаются и устанавливаются, чем виртуальные машины 1-го поколения. Общие сведения о виртуальных машинах 2-го поколения и некоторых различиях между 1-м и 2-м поколениями см. в разделе [Следует ли создать виртуальную машину поколения 1 или 2 в Hyper-V?](/windows-server/virtualization/hyper-v/plan/should-i-create-a-generation-1-or-2-virtual-machine-in-hyper-v)

## <a name="generation-2-vm-sizes"></a>Размеры виртуальных машин 2-го поколения

Виртуальные машины 1-го поколения совместимы со всеми размерами виртуальных машин в Azure (за исключением виртуальных машин серии Mv2). Теперь Azure предлагает поддержку 2-го поколения для следующих серий виртуальных машин:


* [серия B](sizes-b-series-burstable.md);
* [серия DCsv2](dcv2-series.md);
* [Серия DSv2](dv2-dsv2-series.md)
* [Серия Dsv3](dv3-dsv3-series.md)
* [Серия Dsv4](dv4-dsv4-series.md)
* [серия Dasv4](dav4-dasv4-series.md);
* [Серия Ddsv4](ddv4-ddsv4-series.md)
* [серия Esv3](ev3-esv3-series.md);
* [Серия Esv4](ev4-esv4-series.md)
* [серия Easv4](eav4-easv4-series.md);
* [Серия Edsv4](edv4-edsv4-series.md)
* [серия Fsv2](fsv2-series.md);
* [серия GS](sizes-previous-gen.md#gs-series);
* [серия HB](hb-series.md);
* [серия HC](hc-series.md);
* [Серия Ls](sizes-previous-gen.md#ls-series) 
* [Серия Lsv2](lsv2-series.md)
* [серия M](m-series.md);
* [серия Mv2](mv2-series.md)<sup>1</sup>;
* [Серия NCv2](ncv2-series.md) 
* [Серия NCv3](ncv3-series.md)
* [серия ND](nd-series.md);
* [серия NVv3](nvv3-series.md).
* [Серия NVv4](nvv4-series.md)
* [Серия NCasT4_v3](nct4-v3-series.md)

<sup>1</sup> Серия Mv2 не поддерживает образы виртуальных машин 1-го поколения и поддерживает только часть образов 2-го поколения. Дополнительные сведения см. в [документации по серии Mv2](mv2-series.md).


## <a name="generation-2-vm-images-in-azure-marketplace"></a>Образы виртуальных машин 2-го поколения в Azure Marketplace

Виртуальные машины 2-го поколения поддерживают следующие образы Marketplace:

* Windows Server 2019, Windows Server 2016, Windows Server 2012 R2, Windows Server 2012 и Windows Server 2019;
* Windows 10 Pro, Windows 10 Корпоративная;
* SUSE Linux Enterprise Server 15 SP1;
* SUSE Linux Enterprise Server 12 SP4;
* Ubuntu Server 16.04, Ubuntu Server 18.04, Ubuntu Server 19.04, Ubuntu Server 19.10; 
* RHEL 8.1, RHEL 8.0, RHEL 7.7, RHEL 7.6, RHEL 7.5, RHEL 7.4, RHEL 7.0;
* Cent OS 8.1, Cent OS 8.0, Cent OS 7.7, Cent OS 7.6, Cent OS 7.5, Cent OS 7.4;
* Oracle Linux 7.7, Oracle Linux 7.7-CI.

> [!NOTE]
> Конкретные размеры виртуальных машин, например серии Mv2, могут поддерживать только часть этих образов. Дополнительные сведения доступны в соответствующей документации по размерам виртуальных машин.

## <a name="on-premises-vs-azure-generation-2-vms"></a>Виртуальные машины 2-го поколения в локальной среде и в облаке Azure

В настоящее время Azure не поддерживает некоторые функции, поддерживаемые локальными средами Hyper-V для виртуальных машин 2-го поколения.

| Функция 2-го поколения                | Локальная среда Hyper-V | Azure |
|-------------------------------------|---------------------|-------|
| Безопасная загрузка                         | :heavy_check_mark:  | С доверенным запуском (Предварительная версия)   |
| Экранированная виртуальная машина                         | :heavy_check_mark:  | :x:   |
| vTPM                                | :heavy_check_mark:  | С доверенным запуском (Предварительная версия)  |
| Безопасность на базе виртуализации (VBS) | :heavy_check_mark:  | С доверенным запуском (Предварительная версия)   |
| Формат VHDX                         | :heavy_check_mark:  | :x:   |

Дополнительные сведения см. в разделе [доверенный запуск (Предварительная версия)](trusted-launch.md).

## <a name="features-and-capabilities"></a>Функции и возможности

### <a name="generation-1-vs-generation-2-features"></a>Функции 1-го и 2-го поколений

| Компонент | Поколение 1 | 2-е поколение |
|---------|--------------|--------------|
| Загрузка             | PCAT                      | UEFI                               |
| Контроллеры дисков | IDE                       | SCSI                               |
| Размеры виртуальной машины         | Все размеры виртуальной машины. | [Просмотреть доступные размеры](#generation-2-vm-sizes) |

### <a name="generation-1-vs-generation-2-capabilities"></a>Возможности 1-го и 2-го поколений

| Функция | Поколение 1 | 2-е поколение |
|------------|--------------|--------------|
| Диск ОС > 2 ТБ                    | :x:                | :heavy_check_mark: |
| Пользовательский диск, образ или замена диска ОС         | :heavy_check_mark: | :heavy_check_mark: |
| Поддержка масштабируемого набора виртуальных машин | :heavy_check_mark: | :heavy_check_mark: |
| Azure Site Recovery               | :heavy_check_mark: | :heavy_check_mark: |
| Резервное копирование и восстановление                    | :heavy_check_mark: | :heavy_check_mark: |
| Коллекция общих образов              | :heavy_check_mark: | :heavy_check_mark: |
| [Шифрование дисков Azure](../security/fundamentals/azure-disk-encryption-vms-vmss.md)             | :heavy_check_mark: | :heavy_check_mark:                |
| [Шифрование на стороне сервера](disk-encryption.md)            | :heavy_check_mark: | :heavy_check_mark: |

## <a name="creating-a-generation-2-vm"></a>Создание виртуальной машины 2-го поколения

### <a name="marketplace-image"></a>Образ Marketplace

С помощью портала Azure или Azure CLI можно создать виртуальные машины 2-го поколения из образа Marketplace, который поддерживает загрузку UEFI.

#### <a name="azure-portal"></a>Портал Azure

Ниже приведены инструкции по созданию виртуальной машины 2-го поколения на портале Azure.

1. Войдите на портал Azure по адресу https://portal.azure.com.
1. Выберите **Создать ресурс**.
1. Щелкните **Просмотреть все** в Azure Marketplace слева.
1. Выберите образ, который поддерживает 2-е поколение.
1. Нажмите кнопку **Создать**.
1. На вкладке **Дополнительно** в разделе **VM generation** (Поколение виртуальной машины) выберите параметр **Gen 2** (2-е поколение).
1. На вкладке **Базовые** в разделе **Сведения об экземпляре** выберите **Размер** и откройте колонку **Выбор размера виртуальной машины**.
1. Выберите [поддерживаемую виртуальную машину 2-го поколения](#generation-2-vm-sizes).
1. Пройдите все остальные страницы, чтобы завершить создание виртуальной машины.

![Выбор виртуальной машины 1-го или 2-го поколения](./media/generation-2/gen1-gen2-select.png)

#### <a name="powershell"></a>PowerShell

Вы также можете создать виртуальную машину с помощью PowerShell, непосредственно указав номер SKU 1-го или 2-го поколения.

Например, используйте приведенный ниже командлет PowerShell, чтобы получить список номеров SKU в предложении `WindowsServer`.

```powershell
Get-AzVMImageSku -Location westus2 -PublisherName MicrosoftWindowsServer -Offer WindowsServer
```

Если вы создаете виртуальную машину с операционной системой Windows Server 2012, выберите номер SKU виртуальной машины 1-го поколения (BIOS) или 2-го поколения (UEFI), который выглядит следующим образом.

```powershell
2012-Datacenter
2012-datacenter-gensecond
```

Актуальный список поддерживаемых образов Marketplace приведен в разделе [Функции и возможности](#features-and-capabilities).

#### <a name="azure-cli"></a>Azure CLI

Кроме того, можно использовать Azure CLI, чтобы просмотреть список всех доступных образов 2-го поколения, указанных по **издателю**.

```azurecli
az vm image list --publisher Canonical --sku gen2 --output table --all
```

### <a name="managed-image-or-managed-disk"></a>Управляемый образ или управляемый диск

Вы можете создать виртуальную машину 2-го поколения из управляемого образа или управляемого диска точно так же, как и виртуальную машину 1-го поколения.

### <a name="virtual-machine-scale-sets"></a>Масштабируемые наборы виртуальных машин

Вы также можете создавать виртуальные машины 2-го поколения с помощью масштабируемых наборов виртуальных машин. В Azure CLI можно использовать масштабируемые наборы Azure для создания виртуальных машин 2-го поколения.

## <a name="frequently-asked-questions"></a>Часто задаваемые вопросы

* **Доступны ли виртуальные машины 2-го поколения во всех регионах Azure?**  
    Да. Но в некоторых регионах доступны не все [размеры виртуальных машин 2-го поколения](#generation-2-vm-sizes). Доступность виртуальной машины 2-го поколения зависит от того, доступен ли соответствующий размер виртуальной машины.

* **Есть ли разница в цене между виртуальными машинами 1-го и 2-го поколений?**  
   Нет.

* **У меня есть VHD-файл локальной виртуальной машины 2-го поколения. Можно ли использовать этот VHD-файл для создания виртуальной машины 2-го поколения в Azure?**
  Да, вы можете перенести VHD-файл 2-го поколения в Azure и использовать его для создания виртуальной машины 2-го поколения. Для этого сделайте следующее.
    1. Передайте VHD-файл в учетную запись хранения в регионе, в котором вы хотите создать виртуальную машину.
    1. Создайте управляемый диск из этого VHD-файла. Задайте для свойства поколения Hyper-V значение "V2". Следующие команды PowerShell задают свойство поколения Hyper-V при создании управляемого диска.

        ```powershell
        $sourceUri = 'https://xyzstorage.blob.core.windows.net/vhd/abcd.vhd'. #<Provide location to your uploaded .vhd file>
        $osDiskName = 'gen2Diskfrmgenvhd'  #<Provide a name for your disk>
        $diskconfig = New-AzDiskConfig -Location '<location>' -DiskSizeGB 127 -AccountType Standard_LRS -OsType Windows -HyperVGeneration "V2" -SourceUri $sourceUri -CreateOption 'Import'
        New-AzDisk -DiskName $osDiskName -ResourceGroupName '<Your Resource Group>' -Disk $diskconfig
        ```

    1. После того как диск станет доступен, создайте виртуальную машину, подключив этот диск. Это будет виртуальная машина 2-го поколения.
    После создания виртуальной машины 2-го поколения можно дополнительно подготовить к использованию ее образ. Этот образ можно будет использовать для создания нескольких виртуальных машин.

* **Как увеличить размер диска ОС?**  

  Диски ОС, размер которых превышает 2 Тиб, являются новыми для виртуальных машин поколения 2. По умолчанию диски ОС имеют размер менее 2 Тиб для виртуальных машин поколения 2. Можно увеличить размер диска до рекомендованного максимума в 4 тиб. Чтобы увеличить размер диска ОС, используйте Azure CLI или портал Azure. Сведения о том, как программно расширять диски, см. **в разделе изменение размера диска** для [Windows](./windows/expand-os-disk.md) или [Linux](./linux/resize-os-disk-gpt-partition.md).

  Вот как можно увеличить размер диска ОС на портале Azure:

  1. На портале Azure перейдите на страницу свойств виртуальной машины.
  1. Чтобы завершить работу виртуальной машины и освободить ее ресурсы, нажмите кнопку **Остановить**.
  1. В разделе **Диски** выберите диск ОС, который требуется увеличить.
  1. В разделе **Диски** выберите **Конфигурация** и укажите требуемое значение параметра **Размер**.
  1. Вернитесь на страницу свойств виртуальной машины и **запустите** виртуальную машину.
  
  Может появиться предупреждение для дисков ОС размером более 2 тиб. Это предупреждение не относится к виртуальным машинам 2-го поколения. Однако размер диска ОС, превышающий 4 Тиб, не поддерживается.

* **Поддерживают ли виртуальные машины 2-го поколения ускоренную сеть?**  
    Да. Дополнительные сведения см. в разделе [Создание виртуальной машины с ускоренной сетью](../virtual-network/create-vm-accelerated-networking-cli.md).

* **Поддерживают ли виртуальные машины поколения 2 безопасную загрузку или vTPM в Azure?**
    Как vTPM, так и безопасная загрузка — это функции доверенного запуска (Предварительная версия) для виртуальных машин поколения 2. Дополнительные сведения см. в разделе [доверенный запуск](trusted-launch.md).
    
* **Поддерживается ли VHDX во 2-м поколении?**  
    Нет, виртуальные машины 2-го поколения поддерживают только виртуальные жесткие диски (VHD).

* **Поддерживают ли виртуальные машины 2-го поколения Хранилище дисков Azure (цен. категория "Ультра")?**  
    Да.

* **Можно ли перенести виртуальную машину 1-го поколения в виртуальную машину 2-го поколения?**  
    Нет, изменить поколение созданной виртуальной машины невозможно. Если необходимо переключиться между разными поколениями виртуальных машин, создайте новую виртуальную машину другого поколения.

* **Почему размер моей виртуальной машины недоступен в селекторе размеров, когдя я пытаюсь создать виртуальную машину 2-го поколения?**

    Эту проблему можно устранить, выполнив следующие действия.

    1. Убедитесь, что на вкладке **Дополнительно** для свойства **Поколение виртуальной машины** задано значение **Поколение 2**.
    1. Убедитесь, что вы ищете [размер виртуальной машины, совместимый с виртуальными машинами 2-го поколения](#generation-2-vm-sizes).

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения о [доверенном запуске (Предварительная версия)](trusted-launch-portal.md) с виртуальными машинами поколения 2.

Узнайте больше о [виртуальных машинах 2-го поколения в Hyper-V](/windows-server/virtualization/hyper-v/plan/should-i-create-a-generation-1-or-2-virtual-machine-in-hyper-v).
