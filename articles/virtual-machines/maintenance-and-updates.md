---
title: Обслуживание и обновления
description: Общие сведения об обслуживании и обновлении виртуальных машин, работающих в Azure.
author: shants123
ms.service: virtual-machines
ms.workload: infrastructure-services
ms.topic: conceptual
ms.date: 05/22/2020
ms.author: shants
ms.openlocfilehash: 51df72e31acaadc83f4c094b99fa938377e5f023
ms.sourcegitcommit: 15d27661c1c03bf84d3974a675c7bd11a0e086e6
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/09/2021
ms.locfileid: "102500008"
---
# <a name="maintenance-for-virtual-machines-in-azure"></a>Обслуживание виртуальных машин Linux в Azure

Azure периодически выполняет обновления своей платформы, чтобы повысить надежность, производительность и безопасность инфраструктуры узлов, в которой работают виртуальные машины. Причины этих обновлений разные: от исправлений программных компонентов в среде размещения до обновления сетевых компонентов или вывода оборудования из эксплуатации. 

Обновления редко влияют на размещенные виртуальные машины. Когда они все же оказывают определенное воздействие, Azure выбирает для обновлений метод, сводящий его к минимуму.

- Если возможно обновление без перезагрузки, виртуальная машина приостанавливается во время обновления узла или динамически переносится на узел, который уже обновлен. 
- Если обслуживание требует перезагрузки, вы получаете уведомление о плановом обслуживании. Azure также предоставляет период, в который можно начать обслуживание самостоятельно, когда это будет удобно. Период самостоятельного обслуживания обычно составляет 35 дней, если обслуживание не является срочным. Azure вкладывается в технологии, позволяющие сократить число случаев, когда для планового обслуживания платформы требуется перезагрузка виртуальных машин. Инструкции по управлению плановым обслуживанием см. в статье "Обработка уведомлений о плановом обслуживании с помощью Azure [CLI](maintenance-notifications-cli.md), [PowerShell](maintenance-notifications-powershell.md) или [портала](maintenance-notifications-portal.md)".

На этой странице описано, как Azure выполняет обслуживание обоих типов. Дополнительные сведения о незапланированных событиях (сбоях) см. в статье [Управление доступностью виртуальных машин для Windows](./availability.md) или соответствующей статьи для [Linux](./availability.md).

Вы можете получать внутренние уведомления виртуальной машины о предстоящем обслуживании [с помощью запланированных событий для Windows](./windows/scheduled-events.md) или [Linux](./linux/scheduled-events.md).



## <a name="maintenance-that-doesnt-require-a-reboot"></a>Обслуживание, не требующее перезагрузки

Большинство обновлений платформы не влияет на виртуальные машины клиента. Если обновление без такого влияния невозможно, Azure выбирает механизм обновления, который в наименьшей мере затрагивает виртуальные машины клиентов. 

Большинство форм обслуживания с ненулевым влиянием приостанавливают работу виртуальной машины менее чем на 10 секунд. В некоторых случаях Azure использует механизмы обслуживания с сохранением памяти. Эти механизмы приостанавливают работу виртуальной машины в течение 30 секунд и сохраняют память в ОЗУ. После возобновления работы часы виртуальной машины автоматически синхронизируются. 

Обслуживание с сохранением памяти доступно более чем для 90 % виртуальных машин Azure. Оно не работает для серий G, M, N и H. В Azure все чаще используются технологии динамической миграции и вносятся улучшения в механизмы обслуживания с сохранением памяти, необходимые для уменьшения длительности приостановок.  

Эти операции обслуживания, для которых не требуется перезагрузка, выполняются поочередно для каждого домена сбоя. Они останавливаются, если получают предупреждающие сигналы от средств мониторинга платформы. 

Эти типы обновлений могут повлиять на некоторые приложения. Когда виртуальная машина динамически перемещается на другой узел, для некоторых чувствительных рабочих нагрузок может наблюдаться небольшое снижение производительности в течение нескольких минут перед приостановкой работы виртуальной машины. При подготовке к обслуживанию виртуальной машины и снижения воздействия обслуживания Azure на такие приложения будет полезно [использовать запланированные события для Windows](./windows/scheduled-events.md) или [Linux](./linux/scheduled-events.md). 

Для более высокого контроля над всеми действиями по обслуживанию, включая обновления с нулевым влиянием и без перезагрузки, можно использовать функцию управления обслуживанием. Необходимо использовать [выделенные узлы Azure](./dedicated-hosts.md) или [изолированную виртуальную машину](../security/fundamentals/isolation-choices.md). Управление обслуживанием дает возможность пропустить все обновления платформы и применить обновления на выбранный момент времени в течение 35-дневного интервала. Дополнительные сведения см. в разделе [Управление обновлениями с помощью управления обслуживанием и Azure CLI](maintenance-control.md).


### <a name="live-migration"></a>Динамическая миграция

Динамическая миграция — это операция, которая не требует перезагрузки и сохраняет содержимое памяти виртуальной машины. Она вызывает паузу или замораживание, обычно не превышающие 5 секунд. За исключением серии G, M, N и H, все виртуальные машины инфраструктуры как услуги (IaaS) подходят для динамической миграции. Подходящие виртуальные машины составляют более 90 процентов виртуальных машин IaaS, развернутых в парке Azure. 

Платформа Azure запускает динамическую миграцию в следующих сценариях.
- Плановое техническое обслуживание
- Сбой оборудования
- Оптимизация распределения

В некоторых сценариях планового обслуживания используется динамическая миграция. Они позволяют использовать Запланированные события, чтобы заранее получить сведения о начале операций динамической миграции.

Динамическая миграция также может использоваться для перемещения виртуальных машин, когда алгоритмы Машинного обучения Azure прогнозируют незапланированный сбой оборудования или если требуется оптимизировать выделение ресурсов виртуальной машины. Дополнительные сведения о прогнозном моделировании, которое обнаруживает случаи понижения функциональности оборудования, см. в статье [Улучшение устойчивости виртуальной машины Azure с помощью прогнозного машинного обучения и динамической миграции](https://azure.microsoft.com/blog/improving-azure-virtual-machine-resiliency-with-predictive-ml-and-live-migration/?WT.mc_id=thomasmaurer-blog-thmaure). Уведомления динамической миграции отображаются на портале Microsoft Azure в журналах мониторинга и работоспособности служб, а также в Запланированных событиях при использовании этих служб.

## <a name="maintenance-that-requires-a-reboot"></a>Обслуживание, требующее перезагрузки

В редких случаях, когда виртуальные машины необходимо перезагрузить при плановом обслуживании, об этом уведомляется заранее. Плановое обслуживание выполняется в два этапа: этап самостоятельного обслуживания и этап запланированного обслуживания.

На *этапе самостоятельного обслуживания*, который обычно длится четыре недели, вы сами запускаете обслуживание своих виртуальных машин. В рамках самостоятельного обслуживания вы можете отправить запрос на каждую виртуальную машину, чтобы оценить ее состояние и проверить результат последнего запроса на обслуживание.

При запуске самостоятельного обслуживания виртуальная машина повторно развертывается на уже обновленном узле. Так как виртуальная машина перезапускается, временный диск удаляется, а связанные с виртуальным сетевым интерфейсом динамические IP-адреса обновляются.

Если во время самостоятельного обслуживания происходит ошибка, операция приостанавливается, виртуальная машина не обновляется, а вы получаете возможность повторить попытку самостоятельного обслуживания. 

После завершения этапа самостоятельного обслуживания начинается *этап запланированного обслуживания*. В течение этого этапа вы все еще можете запрашивать период обслуживания, но вы не сможете инициировать обслуживание самостоятельно.

Дополнительные сведения по управлению обслуживанием, требующим перезагрузки, см. в статье **"Обработка уведомлений о плановом обслуживании** с помощью Azure [CLI](maintenance-notifications-cli.md), [PowerShell](maintenance-notifications-powershell.md) или [портала](maintenance-notifications-portal.md)". 

### <a name="availability-considerations-during-scheduled-maintenance"></a>Рекомендации по обеспечению доступности во время запланированного обслуживания 

Если вы решили дождаться запланированного периода обслуживания, нужно учесть несколько факторов, чтобы обеспечить наивысшую доступность своих виртуальных машин. 

#### <a name="paired-regions"></a>Пары регионов

Каждый регион Azure образует пару с другим регионом в пределах одной географической территории. Вместе они образуют пару регионов. Во время этапа запланированного обслуживания Azure обновляет виртуальные машины только в одном регионе из пары. Например, во время обновления виртуальных машин в центрально-северной части США Azure не будет одновременно обновлять виртуальные машины в центрально-южной части США. Однако в других регионах, например в Северной Европе, обслуживание может происходить одновременно с обслуживанием в восточной части США. Чтобы лучше распределить виртуальные машины по регионам, ознакомьтесь с принципами работы пар регионов. Дополнительные сведения см. в статье [Непрерывность бизнес-процессов и аварийное восстановление в службах BizTalk: пары регионов Azure](../best-practices-availability-paired-regions.md).

#### <a name="availability-sets-and-scale-sets"></a>Группы доступности и масштабируемые наборы

При развертывании рабочей нагрузки на виртуальных машинах Azure вы можете создать виртуальные машины в *группе доступности*, чтобы обеспечить высокую доступность приложения. С помощью групп доступности можно гарантировать, что во время сбоя или события обслуживания, требующего перезагрузки, останется доступна по крайней мере одна виртуальная машина.

Отдельные виртуальные машины в группе доступности могут быть распределены между максимум 20 доменами обновления. Во время запланированного обслуживания в конкретный момент времени всегда изменяется только один домен обновления. Домены обновления не обязательно обновляются последовательно. 

*Масштабируемые наборы* виртуальных машин относятся к вычислительным ресурсам Azure, которые можно использовать для развертывания и администрирования идентичных виртуальных машин как единого ресурса. Масштабируемый набор автоматически развертывается в доменах обновления, как и виртуальные машины в группе доступности. Как и в случае с группами доступности, в каждый конкретный момент времени запланированного обслуживания масштабируемый набор изменяется только в одном домене обновления.

Дополнительные сведения о настройке виртуальных машин для обеспечения высокой доступности см. в статье [Управление доступностью виртуальных машин для Windows](./availability.md) или соответствующей статьи для [Linux](./availability.md).

#### <a name="availability-zones"></a>Зоны доступности

Зоны доступности — уникальные физические расположения в пределах одного региона Azure. Каждая зона состоит из одного или нескольких центров обработки данных, оснащенных независимыми системами электроснабжения, охлаждения и сетевого взаимодействия. Чтобы обеспечить отказоустойчивость, во всех включенных регионах используются минимум три отдельные зоны. 

Зона доступности — это сочетание домена сбоя и домена обновления. Если вы создаете три или более виртуальных машин в трех зонах региона Azure, виртуальные машины эффективно распределяются между тремя доменами сбоя и тремя доменами обновления. Платформа Azure поддерживает такое распределение между доменами обновления, чтобы виртуальные машины в различных зонах не обновлялись одновременно.

Каждое обновление инфраструктуры разворачивается от зоны к зоне в пределах одного региона. Одно развертывание можно выполнять в зоне 1, а другое развертывание в то же время — в зоне 2. Развертывания не всегда являются сериализованными. Однако в одном развертывании только одна зона разворачивается за раз, чтобы снизить риск.

## <a name="next-steps"></a>Дальнейшие действия 

Для управления плановым обслуживанием можно использовать [Azure CLI](maintenance-notifications-cli.md), [Azure PowerShell](maintenance-notifications-powershell.md) или [портал](maintenance-notifications-portal.md).