---
title: Метрики диска
description: Примеры метрик для ускорения работы диска
author: roygara
ms.service: virtual-machines
ms.topic: conceptual
ms.date: 02/12/2021
ms.author: rogarana
ms.subservice: disks
ms.openlocfilehash: 60486c41ad843cf193ee0648dfcfef66f7668e47
ms.sourcegitcommit: b4647f06c0953435af3cb24baaf6d15a5a761a9c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/02/2021
ms.locfileid: "101674979"
---
# <a name="disk-performance-metrics"></a>Метрики производительности диска
Azure предлагает метрики в портал Azure, которые позволяют получить представление о том, как выполняются виртуальные машины и диски. Метрики также можно получить с помощью вызова API. Эта статья разбивается на три подраздела:

- **Метрики ввода-вывода на диск, пропускная способность и глубина очереди** . Эти метрики позволяют просматривать производительность хранилища с точки зрения диска и виртуальной машины.
- **Метрики для ускорения диска** — это метрики, обеспечивающие наблюдение за функцией [разбивки](disk-bursting.md) на наших дисках уровня "Премиум".
- **Метрики использования операций ввода-вывода хранилища** — Эти метрики помогают диагностировать узкие места в производительности хранилища с помощью дисков. 

Все метрики создаются каждую минуту, за исключением метрики процентного кредита, которая создается каждые 5 минут.

## <a name="disk-io-throughput-and-queue-depth-metrics"></a>Метрики ввода-вывода на диск, пропускная способность и длина очереди
Для получения подробных сведений о виртуальных машинах, операциях ввода-вывода, пропускной способности и производительности очереди можно использовать следующие метрики.

- **Длина очереди диска ОС**: количество текущих необработанных запросов ввода-вывода, ожидающих чтения или запись на диск ОС.
- **Скорость чтения с диска ОС (байт/с**): количество байтов, считываемых с диска ОС в секунду.
- **Операций чтения с диска ОС/с**: количество операций ввода, считываемых в секунду с диска операционной системы.
- **Скорость записи на диск ОС (байт/с**): количество байтов, записанных в секунду с диска операционной системы.
- **Операций записи на диск ОС/с**: количество операций вывода, записанных в секунду с диска операционной системы.
- **Глубина диска данных**: количество текущих необработанных запросов ввода-вывода, ожидающих чтения или запись на диск (ы) данных.
- **Скорость чтения с диска данных (байт/с**): количество байтов, считываемых с дисков данных в секунду.
- **Операций чтения с диска данных/с**: количество операций ввода, считываемых в секунду с дисков данных.
- **Скорость записи на диск данных (байт/с**): количество байтов, записываемых в секунду с дисков данных.
- **Операций записи на диск данных/с**: количество операций вывода, записанных в секунду с дисков данных.
- **Скорость чтения с диска (байт/с**): общее количество байтов, считываемых в секунду со всех дисков, подключенных к виртуальной машине.
- **Операций чтения с диска/с**: количество операций ввода, считываемых в секунду со всех дисков, подключенных к виртуальной машине.
- **Скорость записи на диск (байт/с**): количество байтов, записанных в секунду со всех дисков, подключенных к виртуальной машине.
- **Операций записи на диск/с**: количество операций вывода, записанных в секунду со всех дисков, подключенных к виртуальной машине.

## <a name="bursting-metrics"></a>Пакеты метрик
Следующие метрики помогают наблюдать за функцией [разбивки](disk-bursting.md) на диски уровня "Премиум":

- **Максимальная пропускная способность диска данных**: ограничение пропускной способности, с которой диски данных могут подниматься.
- **Максимальная пропускная способность диска ОС**: ограничение пропускной способности, с которой может подниматься диск операционной системы.
- **Максимальное количество операций ввода**-вывода для диска с данными: количество операций ввода-вывода в секунду, на которые могут подниматься диски данных.
- **Максимальное число операций ввода**-вывода для диска ОС. ограничение в операциях ввода-вывода для диска операционной системы.
- **Целевая пропускная способность диска данных**: ограничение пропускной способности, которое может достичь диск данных без разбивки на пакеты.
- **Целевая пропускная способность диска ОС**: ограничение пропускной способности, которое может достичь диск операционной системы без разбивки на пакеты.
- **Целевые объекты диска данных**: количество операций ввода-вывода — ограничение, которое могут достичь диски данных без разбивки на пакеты.
- **Целевые объекты диска ОС**: количество операций ввода-вывода в секунду, которое могут достичь диски данных без разбивки на пакеты.
- **Диск данных использовал кредиты нагрузки в процентах**: накопленный процент пропускной способности, используемый для дисков с данными. Порождено 5-минутным интервалом.
- **Диск ОС использовал кредиты нагрузки в процентах**: накопленный процент пропускной способности, используемый для диска ОС. Порождено 5-минутным интервалом.
- **Диск с данными: процент Закредитов ввода-вывода**: накопленный процент операций ввода-вывода в секунду для дисков данных. Порождено 5-минутным интервалом.
- **Используемый диск ОС. процент кредитов ввода-вывода**: суммарный процент операций ввода-вывода в секунду для диска ОС. Порождено 5-минутным интервалом.

## <a name="storage-io-utilization-metrics"></a>Метрики использования операций ввода-вывода хранилища
Следующие метрики помогают диагностировать узкие места в сочетании виртуальной машины и диска. Эти метрики доступны только при использовании виртуальной машины с включенным Premium. Эти метрики доступны для всех типов дисков, за исключением Ultra. 

Метрики, помогающие диагностировать ограничения дискового ввода-вывода:

- **Процент использования дискового пространства операций ввода-вывода**: процент, вычисляемый диском данных операций ввода-вывода в секунду для подготовленного диска данных. Если это значение равно 100%, ваше приложение работает под пределами операций ввода-вывода, установленным на диске данных.
- **Процент использования пропускной способности диска данных**: процент, вычисленный пропускной способностью диска данных, завершенный по пропускной способности подготовленного диска данных. Если это значение равно 100%, то ваше приложение работает под пределами операций ввода-вывода с ограничением пропускной способности диска данных.
- **Процент использования диска операционной системы (операций ввода**-вывода): процент, вычисленный ДИСКом ОС число операций ввода-вывода в секунду для подготовленного диска операционной системы. Если это значение равно 100%, то запущенное приложение будет превышено на число операций ввода-вывода для диска ОС.
- **Процент использования пропускной способности диска ОС**: процентное значение, вычисленное пропускной СПОСОБНОСТЬЮ диска ОС, выполнено по пропускной способности диска подготовленной ОС. Если это значение равно 100%, то ваше приложение, для которого работает операция ввода-вывода, ограничено пропускной способностью диска ОС.

Метрики, помогающие выполнить диагностику операций ввода-вывода виртуальной машины:

- Объем **кэшированных операций ввода-вывода в кэше виртуальной машины**: процент, вычисленный по общему количеству операций ввода-вывода, выполненных по максимальному пределу кэшированных операций Если это значение равно 100%, то ваше приложение работает под пределами операций ввода-вывода с ограничением в кэшированной виртуальной машине.
- Объем **использованной пропускной способности кэшированной виртуальной машины**: процентное значение, вычисленное по общей пропускной способности диска, завершенное по максимальной пропускной способности виртуальной машины Если это значение равно 100%, то ваше приложение, для которого работает операция ввода-вывода, ограничено объемом кэшированной пропускной способности виртуальной машины.
- **Процент использования некэшированных операций ввода**-вывода виртуальной машины: процентное значение, вычисленное по общему числу операций ввода-вывода на виртуальной машине, завершенных по максимальному ограничению операций ввода-вывода виртуальной машины. Если это значение равно 100%, то запущенное приложение будет превышено на число операций ввода-вывода в кэше виртуальной машины.
- **Процент использования некэшированной пропускной способности виртуальной машины**: процентное значение, вычисленное по общей пропускной способности диска на виртуальной машине, завершилось по максимальной пропускной способности подготовленной виртуальной машины. Если это значение равно 100%, то ваше приложение, для которого работает операция ввода-вывода, ограничено ограничением пропускной способности виртуальной машины.

## <a name="storage-io-metrics-example"></a>Пример метрик операций ввода-вывода хранилища

Давайте проверим, как использовать эти новые метрики использования операций ввода-вывода хранилища для отладки, когда в системе есть узкое место. Настройка системы такая же, как в предыдущем примере, за исключением того, что подключенный диск ОС *не* кэшируется.

**Установки**

- Standard_D8s_v3
  - Кэшированные операции ввода-вывода: 16 000
  - Некэшированные операции ввода-вывода: 12 800
- Диск ОС P30
  - ОПЕРАЦИЙ ВВОДА-ВЫВОДА: 5 000
  - Кэширование узла: **отключено**
- Два диска данных P30 × 2
  - ОПЕРАЦИЙ ВВОДА-ВЫВОДА: 5 000
  - Кэширование узла: **чтение и запись**
- Два диска данных P30 × 2
  - ОПЕРАЦИЙ ВВОДА-ВЫВОДА: 5 000
  - Кэширование узла: **отключено**

Давайте выполним тест производительности на этой виртуальной машине и в сочетании с дисками, создающими операции ввода-вывода. Дополнительные сведения о тестировании производительности операций ввода-вывода в Azure см. в разделе [Тестирование производительности приложения на хранилище дисков Azure](disks-benchmarks.md). В средстве тестирования производительности можно увидеть, что сочетание ВМ и диска может достигать 22 800 операций ввода-вывода в секунду:

![Снимок экрана с выводимыми данными r = 22.8 k в f i o](media/disks-metrics/utilization-metrics-example/fio-output.jpg)



Standard_D8s_v3 может достичь всего 28 600 операций ввода-вывода в секунду. Используя метрики, давайте рассмотрим то, что происходит, и определите узким местом ввода-вывода хранилища. В области слева выберите **метрики**:

![Снимок экрана, показывающий метрики, выделенные на левой панели.](media/disks-metrics/utilization-metrics-example/metrics-menu.jpg)

Сначала давайте посмотрим на наши виртуальные машины, в которых **используются кэшированные значения объема операций ввода-вывода в секунду** :

![Снимок экрана с количеством кэшированных операций ввода-вывода (V M) в процентах.](media/disks-metrics/utilization-metrics-example/vm-cached.jpg)

Эта метрика сообщает нам, что в виртуальной машине используется 61% 16 000 операций ввода-вывода, выделенных для кэшированных операций ввода/вывода. Этот процент означает, что узким местом ввода-вывода хранилища не являются диски, которые кэшируются из-за 100%. Теперь давайте взглянем на нашу **некэшированную виртуальную машину операций ввода-вывода в процентах** :

![Снимок экрана с некэшированным количеством операций ввода-вывода в процентах.](media/disks-metrics/utilization-metrics-example/vm-uncached.jpg)

Эта метрика составляет 100%. Он сообщает нам, что используются все 12 800 операций ввода-вывода в секунду, выделенные для некэшированных операций ввода-вывода на виртуальной машине. Одним из способов устранения этой проблемы является изменение размера виртуальной машины до большего размера, который может справиться с дополнительными операциями ввода-вывода. Но прежде чем это сделать, давайте взглянем на подключенный диск, чтобы узнать, сколько операций ввода-вывода они видят. Проверьте диск операционной системы, просмотрев **процент использования дисковых операций ввода-вывода в секунду**:

![Снимок экрана: O S диск o P S потребленный процент.](media/disks-metrics/utilization-metrics-example/os-disk.jpg)

Эта метрика сообщает нам, что используется около 90% 5 000 операций ввода-вывода, подготовленных для этого диска ОС P30. Этот процент означает отсутствие узких мест на диске операционной системы. Теперь проверим диски данных, подключенные к виртуальной машине, просмотрев объем **использованных операций ввода-вывода диска данных в процентах**:

![Снимок экрана с данными о потреблении дискового пространства в процентах.](media/disks-metrics/utilization-metrics-example/data-disks-no-splitting.jpg)

Эта метрика сообщает нам, что среднее потребление количества операций ввода-вывода для всех подключенных дисков составляет около 42%. Этот процент вычисляется на основе операций ввода-вывода, используемых дисками, и не обслуживается из кэша узлов. Давайте подробно рассмотрим эту метрику, применив *разделение* на эти метрики и разбив их на значение LUN:

![Снимок экрана с данными о потреблении дискового пространства в процентах с разбивкой.](media/disks-metrics/utilization-metrics-example/data-disks-splitting.jpg)

Эта метрика сообщает нам, что диски данных, подключенные к LUN 3 и 2, используют около 85% подготовленных операций ввода-вывода в секунду. Ниже приведена схема операций ввода-вывода из архитектуры виртуальных машин и дисков.

![Схема примера метрик хранилища I O.](media/disks-metrics/utilization-metrics-example/metrics-diagram.jpg)

## <a name="next-steps"></a>Дальнейшие действия

- [Обзор метрик Azure Monitor](../azure-monitor/essentials/data-platform-metrics.md)
- [Описание статистической обработки метрик](../azure-monitor/essentials/metrics-aggregation-explained.md)
- [Создание и просмотр оповещений метрик, а также управление ими с помощью Azure Monitor](../azure-monitor/alerts/alerts-metric.md)