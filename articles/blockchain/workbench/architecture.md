---
title: Архитектура Azure Blockchain Workbench
description: Обзор архитектуры Azure Блокчейн Workbench Preview и ее компонентов.
ms.date: 09/05/2019
ms.topic: conceptual
ms.reviewer: brendal
ms.openlocfilehash: 1fff70ef2eeb1dc27d33769fd48fe5923f56717b
ms.sourcegitcommit: 910a1a38711966cb171050db245fc3b22abc8c5f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "96021611"
---
# <a name="azure-blockchain-workbench-architecture"></a>Архитектура Azure Blockchain Workbench

Предварительная версия Azure Блокчейн Workbench упрощает разработку приложений блокчейн, предоставляя решение с помощью нескольких компонентов Azure. Blockchain Workbench можно развернуть с помощью шаблона решения в Azure Marketplace. Шаблон позволяет выбрать модули и компоненты для развертывания, включая блокчейн-стек, тип клиентского приложения и поддержку интеграции Интернета вещей. После развертывания Blockchain Workbench предоставляет доступ к веб-приложению, iOS-приложению и Android-приложению.

![Архитектура блокчейн Workbench](./media/architecture/architecture.png)

## <a name="identity-and-authentication"></a>Идентификация и аутентификация

Используя Blockchain Workbench, консорциум может объединять свои корпоративные идентификаторы с помощью Azure Active Directory (Azure AD). Workbench создает новые учетные записи пользователей для идентификации по цепочке с корпоративными удостоверениями, хранящимися в Azure AD. Сопоставление удостоверений упрощает проверку подлинности входа в клиентские API и приложения. При этом используются политики аутентификации организаций. Workbench также предоставляет возможность связывать корпоративные удостоверения с определенными ролями в рамках данного смарт-контракта. Кроме того Workbench также предоставляет механизм для определения действий, которые могут выполнять эти роли, и времени, когда они могут выполняться.

После развертывания Blockchain Workbench пользователи взаимодействуют с ним либо с помощью клиентских приложений, либо с клиентским API на основе REST, либо с помощью API обмена сообщениями. В любом случае взаимодействия должны быть аутентифицированы либо с помощью Azure Active Directory (Azure AD), либо с учетными данными конкретного устройства.

Пользователи объединяют свои идентификаторы в консорциум Azure AD, отправляя приглашение по электронной почте участникам по их адресу электронной почты. При входе в систему эти пользователи проходят проверку подлинности с использованием имени, пароля и политик. Например, двухфакторная проверка подлинности их организации.

Azure AD используется для управления всеми пользователями, имеющими доступ к Blockchain Workbench. Каждое устройство, подключаемое к смарт-контракту, также связано с Azure AD.

Azure AD также используется для назначения пользователей к специальной группе администраторов. Пользователи, связанные с группой администраторов, получают в Blockchain Workbench права и действия администратора, такие как развертывание контрактов и предоставление пользователям разрешений на доступ к контрактам. Пользователи вне этой группы не имеют доступа к действиям администратора.

## <a name="client-applications"></a>Клиентские приложения

Workbench предоставляет автоматически создаваемые клиентские приложения для веб и мобильных устройств (iOS, Android), которые могут использоваться для проверки, тестирования и просмотра блокчейн-приложений. Интерфейс приложения формируется динамически на основе метаданных смарт-контракта и может вместить любой вариант использования. Клиентские приложения предоставляют интерфейсную часть пользовательского интерфейса для завершения блокчейн-приложений, созданных Blockchain Workbench. Клиентские приложения аутентифицируют пользователей с помощью Azure Active Directory (Azure AD), а затем представляют пользовательский интерфейс, адаптированный к бизнес-контексту смарт-контракта. Пользовательский интерфейс позволяет создавать новые экземпляры смарт-контрактов уполномоченными лицами, а затем предоставляет возможность выполнять определенные виды транзакций в соответствующих точках бизнес-процесса, которые представляет смарт-контракт.

В веб-приложении авторизованные пользователи могут получить доступ к консоли администратора. Консоль доступна для пользователей группы администраторов в Azure AD и предоставляет доступ к следующим функциям:

* Развертывание Майкрософт предоставило смарт-контракты для популярных сценариев. Например, сценарий переноса ресурса.
* Отправка и развертывание собственных смарт-контрактов.
* Назначение доступа пользователю к смарт-контракту в контексте определенной роли.

Дополнительные сведения см. в разделе [примеров клиентских приложений Azure Blockchain Workbench на сайте GitHub](https://github.com/Azure-Samples/blockchain-devkit/tree/master/connect/mobile).

## <a name="gateway-service-api"></a>API-интерфейс службы шлюза

Blockchain Workbench включает API-интерфейс службы шлюза на основе REST. При записи блокчейна API генерирует и доставляет сообщения брокеру событий. Когда API запрашивает данные, запросы отправляются в базу данных, отсоединенную от цепочки. База данных содержит реплику данных в цепочке и метаданные, которые предоставляют контекст и сведения о конфигурации для поддерживаемых смарт-контрактов. Запросы возвращают требуемые данные из реплики вне сети в формате, указанном метаданными для контракта.

Разработчики могут получить доступ к API службы шлюза, чтобы создавать или интегрировать блокчейн-решения, не полагаясь на клиентские приложения Blockchain Workbench.

> [!NOTE]
> Чтобы включить аутентифицированный доступ к API, два клиентских приложения должны быть зарегистрированы в Azure Active Directory. Azure Active Directory требует отдельных регистраций приложений для каждого типа приложения (собственного и веб-сайта).

## <a name="message-broker-for-incoming-messages"></a>Message Broker для входящих сообщений

Разработчики, которые хотят отправлять сообщения непосредственно в Blockchain Workbench, могут отправлять сообщения непосредственно на служебную шину. Например, API сообщений может использоваться для интеграции между системами или устройствами IoT.

## <a name="message-broker-for-downstream-consumers"></a>Message Broker для последующих объектов-получателей

В течение жизненного цикла приложения происходят события. События могут запускаться API-интерфейсом шлюза или в реестре. Уведомления о событиях могут инициировать последующий код, основанный на событии.

Blockchain Workbench автоматически развертывает два типа пользователей событий. Один из них инициируется блокчейн-событиями для заполнения хранилища SQL вне сети. Другой — для захвата метаданных для событий, генерируемых API, связанными с загрузкой и хранением документов.

## <a name="message-consumers"></a>Объекты-получатели сообщений

 Объекты-получатели сообщений принимают сообщения через служебную шину. Базовая модель событий для объектов-получателей сообщений позволяет расширять дополнительные службы и системы. Например можно добавить поддержку для заполнения CosmosDB или оценки сообщений с помощью Azure Streaming Analytics. В следующих разделах описываются объекты-получатели сообщений, включенные в Blockchain Workbench.

### <a name="distributed-ledger-consumer"></a>Объект-получатель распределенного реестра

В сообщениях с технологией распределенного реестра (DLT) содержатся метаданные для транзакций, которые должны быть записаны в блокчейн. Объект-получатель извлекает сообщения и отправляет данные к конструктору транзакций, подписанту и маршрутизатору.

### <a name="database-consumer"></a>Объект-получатель базы данных

Потребитель базы данных принимает сообщения от служебной шины и передает их в присоединенную базу данных, например базу данных в базе данных SQL Azure.

### <a name="storage-consumer"></a>Объект-получатель хранилища

Объект-получатель хранилища принимает сообщения через служебную шину и отправляет данные в подключенное хранилище. Например, хранение хэшированных документов в Azure Storage.

## <a name="transaction-builder-and-signer"></a>Конструктор транзакции и подписант

Если сообщение в брокере входящих сообщений необходимо записать в блокчейн, оно будет обработано объект-получателем DLT. Объект-получатель DLT — это служба, которая извлекает сообщение, содержащее метаданные для выполнения требуемой транзакции, и затем отправляет информацию в *конструктор транзакций и подписант*. *Конструктор транзакций и подписант* собирают блокчейн-транзакцию на основе данных и желаемого адреса назначения блокчейна. После сборки транзакция подписывается. Закрытые ключи хранятся в хранилище ключей Azure.

 Blockchain Workbench извлекает соответствующий закрытый ключ из Key Vault и подписывает транзакцию за пределами Key Vault. После подписания транзакция отправляется к маршрутизаторам транзакций и реестрам.

## <a name="transaction-routers-and-ledgers"></a>Маршрутизаторы транзакций и реестры

Маршрутизаторы транзакций и реестры берут подписанные транзакции и направляют их в соответствующий блокчейн. В настоящее время Blockchain Workbench поддерживает Ethereum в качестве конечной базы данных блокчейн.

## <a name="dlt-watcher"></a>Наблюдатель DLT

Наблюдатель за технологией распределенного реестра (DLT) отслеживает события, происходящие в цепочках блока, подключенного к Blockchain Workbench.
События отражают информацию, относящуюся к отдельным лицам и системам. Например, создание новых экземпляров контракта, выполнение транзакций и изменение состояния. События фиксируются и отправляются брокеру исходящих сообщений, поэтому они могут быть использованы последующими объектами-получателями.

Например, потребитель SQL отслеживает события, потребляет их и заполняет базу данных включаемыми значениями. Копирование позволяет воссоздать реплику данных по цепочке в хранилище вне сети.

## <a name="azure-sql-database"></a>База данных SQL Azure

База данных, присоединенная к Блокчейн Workbench, хранит определения контрактов, метаданные конфигурации и реплику данных, доступную для SQL, хранимую в блокчейн. Эти данные могут быть легко запрошены, визуализированы или проанализированы путем прямого доступа к базе данных. Разработчики и другие пользователи могут использовать базу данных для отчетности, аналитики или других интеграций, ориентированных на данные. Например, пользователи могут визуализировать данные транзакций с помощью Power BI.

Это хранилище вне сети обеспечивает возможность корпоративным организациям запрашивать данные в SQL, а не в блокчейн-реестре. Кроме того, стандартизировав стандартную схему, которая не зависит от стеков технологии блокчейн, хранилище вне сети позволяет повторно использовать отчеты и другие артефакты по нескольким проектам, сценариям и организациям.

## <a name="azure-storage"></a>Хранилище Azure

Azure Storage используется для хранения контрактов и метаданных, связанных с контрактами.

От заказов на покупку и накладных до изображений, используемых в новостях, и медицинских снимках, до видеороликов получаемых из непрерывного потока с рабочих видеокамер полицейских и основных изображений движения — документы играют определенную роль во многих сценариях, связанных с блокчейном. Документы не подходят для непосредственного размещения в блокчейне.

Blockchain Workbench поддерживает возможность добавления документов или другого содержимого мультимедиа с бизнес-логикой блокчейна. Хэш документа или содержимого мультимедиа хранится в блокчейне, а фактический документ или содержимое мультимедиа хранится в Azure Storage. Связанная информация о транзакции доставляется брокеру входящих сообщений, упаковывается, подписывается и маршрутизируется в блокчейн. Этот процесс запускает события, которые совместно используются брокером исходящих сообщений. База данных SQL использует эту информацию и отправляет ее в базу данных для последующего запроса. Подчиненные системы также могут использовать эти события для принятия соответствующих мер.

## <a name="monitoring"></a>Мониторинг

Workbench обеспечивает ведение журналов приложений с помощью Application Insights и Azure Monitor. Application Insights используется для хранения всей зарегистрированной информации из Blockchain Workbench и содержит ошибки, предупреждения и успешные операции. Application Insights может быть использован разработчиками для отладки проблем с Blockchain Workbench. 

Azure Monitor предоставляет информацию о работоспособности сети блокчейн. 

## <a name="next-steps"></a>Дальнейшие действия

> [!div class="nextstepaction"]
> [Развертывание Azure Blockchain Workbench](./deploy.md)
