---
title: Учебник по созданию, сборке и развертыванию смарт-контрактов в службе "Блокчейн Azure"
description: Руководство по использованию комплекта SDK Блокчейн Azure для расширения Ethereum в Visual Studio Code для создания, сборки и развертывания смарт-контракта в службе Azure Блокчейн.
ms.date: 11/30/2020
ms.topic: tutorial
ms.reviewer: caleteet
ms.openlocfilehash: f7605a0c118a40e52210582d2411569795fb25ee
ms.sourcegitcommit: 867cb1b7a1f3a1f0b427282c648d411d0ca4f81f
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "96763695"
---
# <a name="tutorial-create-build-and-deploy-smart-contracts-on-azure-blockchain-service"></a>Руководство по Создание, сборка и развертывание смарт-контрактов в службе "Блокчейн Azure"

В этом руководстве показано использование комплекта SDK Блокчейн Azure для расширения Ethereum в Visual Studio Code для создания, сборки и развертывания смарт-контракта в службе "Блокчейн Azure". Вы также можете использовать комплект SDK для выполнения функции смарт-контракта путем транзакции.

С помощью комплекта SDK службы "Блокчейн Azure" для Ethereum выполняются такие задачи:

> [!div class="checklist"]
> * Создание смарт-контракта
> * Развертывание смарт-контракта
> * выполнение функции смарт-контракта путем транзакции;

[!INCLUDE [quickstarts-free-trial-note](../../../includes/quickstarts-free-trial-note.md)]

## <a name="prerequisites"></a>Предварительные требования

* См. подробнее об [использовании Подключение к сети консорциума службы "Блокчейн Azure" с помощью Visual Studio Code](connect-vscode.md)
* [Visual Studio Code](https://code.visualstudio.com/Download)
* [расширение "Комплект SDK Блокчейна Azure для Ethereum"](https://marketplace.visualstudio.com/items?itemName=AzBlockchain.azure-blockchain);
* [Node.js 10.15.x или более поздней версии](https://nodejs.org/download).
* [Git 2.10.x или более поздней версии](https://git-scm.com).
* [Truffle 5.0.0](https://www.trufflesuite.com/docs/truffle/getting-started/installation).
* [Ganache CLI 6.0.0](https://github.com/trufflesuite/ganache-cli).

В Windows для модуля node-gyp должен быть установлен компилятор C++. Вы можете использовать средства MSBuild:

* Если установлен Visual Studio 2017, настройте NPM для использования средств MSBuild с помощью команды `npm config set msvs_version 2017 -g`.
* Если установлен Visual Studio 2019, задайте путь к средствам сборки MS для NPM. Например `npm config set msbuild_path "C:\Program Files (x86)\Microsoft Visual Studio\2019\Community\MSBuild\Current\Bin\MSBuild.exe"`.
* В противном случае установите автономные средства сборки VS, используя `npm install --global windows-build-tools` в командной оболочке с повышенными правами *от имени администратора*.

Дополнительные сведения о node-gyp см. в репозитории [node-gyp на сайте GitHub](https://github.com/nodejs/node-gyp).

## <a name="create-a-smart-contract"></a>Создание смарт-контракта

Комплект SDK службы "Блокчейн Azure" для Ethereum использует шаблоны проектов и средства Truffle для создания, сборки и развертывания контрактов. Перед началом работы изучите следующее [краткое руководство: Подключение к сети консорциума Блокчейн Azure с помощью Visual Studio Code](connect-vscode.md). Краткое руководство содержит инструкции по установке и настройке комплекта SDK службы "Блокчейн Azure" для Ethereum.

1. В палитре команд VS Code выберите **Блокчейн: Создать проект Solidity**.
1. Выберите **Create basic project** (Создать базовый проект).
1. Создайте папку с именем `HelloBlockchain` и выберите **Select new project path** (Выбрать путь к новому проекту).

Комплект SDK службы "Блокчейн Azure" создаст и инициализирует проект Solidity. Базовый проект содержит пример смарт-контракта **HelloBlockchain** и все необходимые файлы для сборки и развертывания в участнике консорциума в службе "Блокчейн Azure". Создание проекта может занять несколько минут. Вы можете отслеживать ход выполнения на панели терминала VS Code, выбрав выходные данные для Azure Блокчейн.

Структура проекта выглядит так, как показано в следующем примере.

   ![Проект Solidity](./media/send-transaction/solidity-project.png)

## <a name="build-a-smart-contract"></a>Сборка смарт-контракта

Смарт-контракты находятся в каталоге проекта **contracts**. Нужно выполнить сборку смарт-контрактов перед их развертыванием в блокчейне. Используйте команду **Build Contracts** (Выполнить сборку контрактов), чтобы компилировать все смарт-контракты в проекте.

1. В боковой панели обозревателя VS Code разверните папку **contracts** своего проекта.
1. Щелкните правой кнопкой мыши файл **HelloBlockchain.sol** и в меню выберите пункт **Build Contracts** (Выполнить сборку контрактов).

    ![Выберите меню сборки контрактов ](./media/send-transaction/build-contracts.png)

Комплект SDK службы "Блокчейн Azure" использует Truffle для компиляции смарт-контрактов.

![Выходные данные компилятора Truffle](./media/send-transaction/compile-output.png)

## <a name="deploy-a-smart-contract"></a>Развертывание смарт-контракта

Truffle использует скрипты миграции для развертывания контрактов в сети Ethereum. Скрипты миграции — это файлы JavaScript, которые находятся в каталоге проекта **migrations**.

1. Чтобы развернуть смарт-контракт, щелкните правой кнопкой мыши файл **HelloBlockchain.sol** и в меню выберите пункт **Deploy Contracts** (Развернуть контракты).
1. Выберите сеть консорциума службы "Блокчейн Azure"в палитре команд. Сеть блокчейн-консорциума добавлена в файл конфигурации проекта Truffle при создании проекта.
1. Выберите **Generate mnemonic** (Создать мнемонический код). Задайте имя файлу с мнемоническим кодом и сохраните его в папке проекта. Например, `myblockchainmember.env`. Файл с мнемоническим кодом используется для создания закрытого ключа Ethereum для вашего участника блокчейна.

Комплект SDK службы "Блокчейн Azure" использует Truffle, чтобы выполнить скрипт миграции для развертывания контрактов в блокчейне.

![Успешное развертывание контракта](./media/send-transaction/deploy-contract.png)

## <a name="call-a-contract-function"></a>Вызов функции контракта

Функция **SendRequest** контракта **HelloBlockchain** изменяет переменную состояния **RequestMessage**. Изменение состояния сети блокчейна выполняется через транзакцию. Вы можете использовать страницу взаимодействия со смарт-контрактом комплекта SDK для службы "Блокчейн Azure", чтобы вызвать функцию **SendRequest** путем транзакции.

1. Чтобы взаимодействовать со смарт-контрактом, щелкните правой кнопкой мыши **HelloBlockchain.sol** и выберите в меню пункт **Show Smart Contract Interaction Page** (Показать страницу взаимодействия со смарт-контрактом).

    ![Выберите пункт отображения страницы взаимодействия со смарт-контрактом в меню](./media/send-transaction/contract-interaction.png)

1. На странице взаимодействия можно выбрать развернутую версию контракта, вызвать функции, просмотреть текущее состояние и метаданные.

    ![Пример страницы взаимодействия со смарт-контрактом](./media/send-transaction/interaction-page.png)

1. Чтобы вызвать функцию смарт-контракта, выберите действие контракта и передайте аргументы. Выберите действие контракта **SendRequest** и введите **Hello, Blockchain!** для параметра **requestMessage**. Выберите **Execute** (Выполнить), чтобы вызвать функцию **SendRequest** путем транзакции.

    ![Действие выполнения SendRequest](./media/send-transaction/sendrequest-action.png)

После обработки транзакции в разделе взаимодействия отражаются изменения состояния.

![Изменения состояния контракта](./media/send-transaction/contract-state.png)

Функция SendRequest задает поля **RequestMessage** и **State**. Текущим состоянием для **RequestMessage** является переданный аргумент **Hello, Blockchain**. Для поля **State** по-прежнему остается значение **Request**.

## <a name="clean-up-resources"></a>Очистка ресурсов

Если ресурсы больше не нужны, вы можете удалить их. Для этого удалите группу ресурсов `myResourceGroup`, которую вы создали при выполнении предварительных требований *краткого руководства по созданию участника блокчейна*.

Чтобы удалить группу ресурсов, сделайте следующее:

1. На портале Azure перейдите к **группам ресурсов** в области навигации слева и выберите группу ресурсов, которую необходимо удалить.
1. Выберите **Удалить группу ресурсов**. Подтвердите удаление, введя имя группы ресурсов и выбрав **Удалить**.

## <a name="next-steps"></a>Дальнейшие действия

Из этого руководства вы узнали, как создать проект Solidity с помощью комплекта SDK службы "Блокчейн Azure". Вы создали и развернули смарт-контракт, а также вызывали функцию через транзакцию в сети блокчейн-консорциума, размещенной в службе "Блокчейн Azure".

> [!div class="nextstepaction"]
> [Разработка приложений блокчейна с помощью службы "Блокчейн Azure"](develop.md)
