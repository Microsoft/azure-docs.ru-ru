---
title: Географическое аварийное восстановление и высокая доступность функций Azure
description: Как использовать географические регионы для обеспечения избыточности и отработки отказа в функциях Azure.
ms.assetid: 9058fb2f-8a93-4036-a921-97a0772f503c
ms.topic: conceptual
ms.date: 08/29/2019
ms.openlocfilehash: 446a76b823ce3592a83d0c2f898041951361b47e
ms.sourcegitcommit: 772eb9c6684dd4864e0ba507945a83e48b8c16f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "86506287"
---
# <a name="azure-functions-geo-disaster-recovery"></a>Географическое аварийное восстановление функций Azure

Когда все регионы Azure или центры обработки данных просто будут работать, очень важно, чтобы среда вычислений продолжала обрабатывать в другом регионе.  В этой статье описываются некоторые стратегии, которые можно использовать для развертывания функций, чтобы обеспечить аварийное восстановление.

## <a name="basic-concepts"></a>Основные понятия

Функции Azure выполняются в определенном регионе.  Чтобы получить более высокий уровень доступности, можно развернуть одни и те же функции в нескольких регионах.  В нескольких регионах функции могут работать в шаблоне *активный/активный* или *активный/пассивный* .  

* Шаблон "активный — активный". Оба региона активны и получают события (дублирующиеся или циклические). "Активный/активный" рекомендуется для функций HTTPS в сочетании с передней дверцей Azure.
* Активный/пассивный. Один регион является активным и получает события, а вторичный — бездействие.  Если требуется отработка отказа, дополнительный регион активируется и принимает обработку.  Это рекомендуется для таких функций, как служебная шина и концентраторы событий, отличные от HTTP.

Дополнительные сведения о развертывании в нескольких регионах см. в статье как [запускать приложения в несколько регионов](/azure/architecture/reference-architectures/app-service-web-app/multi-region) .

## <a name="activeactive-for-https-functions"></a>"Активный/активный" для функций HTTPS

Для реализации активных и активных развертываний функций требуется некоторый компонент, который может координировать события между двумя регионами.  Для функций HTTPS Эта координация выполняется с помощью [передней дверцы Azure](../frontdoor/front-door-overview.md).  Передняя дверца Azure может маршрутизировать и циклически пересылать HTTPS-запросы между несколькими региональными функциями.  Он также периодически проверяет работоспособность каждой конечной точки.  Если региональная функция перестает отвечать на проверки работоспособности, то передняя дверца Azure выберет ее из вращения и перенаправит трафик только в работоспособные функции.  

![Архитектура для передней дверцы и функции Azure](media/functions-geo-dr/front-door.png)  

## <a name="activeactive-for-non-https-functions"></a>"Активный"/"активный" для функций, не относящихся к HTTPS

Вы по-прежнему можете выполнять активные и активные развертывания для функций, не относящихся к HTTPS.  Однако необходимо учитывать, как два региона будут взаимодействовать друг с другом.  Если вы развернули одно и то же приложение-функцию в двух регионах, каждое из которых активирует одну и ту же очередь служебной шины, они будут действовать как конкурирующие потребители для отмены очереди этой очереди.  Хотя это означает, что каждое сообщение обрабатывается только одним из экземпляров, оно также означает, что на одной служебной шине остается единственная точка отказа.  При развертывании двух очередей служебной шины (одной в основном регионе, одной в дополнительном регионе) и двух приложений-функций, указывающих на их очередь регионов, теперь проблема состоит в том, как сообщения очереди распределяются между двумя регионами.  Часто это означает, что каждый издатель пытается опубликовать сообщение в *обоих* регионах, и каждое сообщение обрабатывается как активными приложениями-функциями.  Несмотря на то, что создает активный/активный шаблон, он создает другие трудности, связанные с дублированием вычислений и моментом консолидации данных.  По этим причинам рекомендуется использовать шаблон "активный/пассивный" для триггеров, не использующих протокол HTTPS.

## <a name="activepassive-for-non-https-functions"></a>Активный/пассивный для функций, не относящихся к HTTPS

Режим "активный/пассивный" позволяет только одной функции обрабатывать каждое сообщение, но предоставляет механизм для отработки отказа в дополнительный регион в случае аварии.  Функции Azure работают наряду с геовосстановлением в [служебной шине Azure](../service-bus-messaging/service-bus-geo-dr.md) и [географическим восстановлении концентраторов событий Azure](../event-hubs/event-hubs-geo-dr.md).

С помощью триггеров концентраторов событий Azure в качестве примера шаблон "активный/пассивный" будет содержать следующее:

* Концентратор событий Azure, развернутый как в основном, так и в дополнительном регионе.
* Возможность географической аварии для связывания основного и дополнительного концентратора событий.  При этом также создается псевдоним, который можно использовать для подключения к концентраторам событий и переключения с первичного на вторичный, не изменяя сведения о соединении.
* Приложения-функции, развернутые как в основном, так и в дополнительном регионе.
* Приложения-функции активируются в строке подключения *Direct* (не псевдонима) для соответствующего концентратора событий. 
* Издатели для концентратора событий должны публиковать строку подключения псевдонима. 

![Пример архитектуры "активный — пассивный"](media/functions-geo-dr/active-passive.png)

Перед отработкой отказа издатели, отправляющие на общий псевдоним, будут маршрутизироваться к основному концентратору событий.  Основное приложение-функция прослушивает только основной концентратор событий.  Вторичное приложение-функция будет пассивным и бездействующим.  После запуска отработки отказа издатели, отправляющие в общий псевдоним, теперь будут маршрутизироваться к дополнительному концентратору событий.  Вторичное приложение-функция теперь станет активным и начнет автоматический запуск активации.  Эффективная отработка отказа в дополнительный регион может быть полностью получена от концентратора событий, при этом функции становятся активными только тогда, когда активен соответствующий концентратор событий.

Дополнительные сведения и рекомендации по отработке отказа с помощью [служебной шины](../service-bus-messaging/service-bus-geo-dr.md) и [концентраторов событий](../event-hubs/event-hubs-geo-dr.md)см. в этой статье.

## <a name="next-steps"></a>Дальнейшие действия

* [Создание передней дверцы Azure](../frontdoor/quickstart-create-front-door.md)
* [Рекомендации по отработке отказа концентраторов событий](../event-hubs/event-hubs-geo-dr.md#considerations)
