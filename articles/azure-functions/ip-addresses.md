---
title: IP-адреса в Функциях Azure
description: Узнайте, как найти входящий и исходящие IP-адреса для приложений-функций, и по каким причинам они изменяются.
ms.topic: conceptual
ms.date: 12/03/2018
ms.openlocfilehash: 2c248756899459e17082bcab863a4e857b594909
ms.sourcegitcommit: 772eb9c6684dd4864e0ba507945a83e48b8c16f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "104608237"
---
# <a name="ip-addresses-in-azure-functions"></a>IP-адреса в Функциях Azure

В этой статье описываются следующие концепции, связанные с IP-адресами приложений функций.

* Поиск IP-адресов, используемых в настоящее время приложением-функцией.
* Условия, вызывающие изменение IP-адресов приложения функции.
* Ограничьте IP-адреса, которые могут получить доступ к приложению функции.
* Определение выделенных IP-адресов для приложения-функции.

IP-адреса связаны с приложениями-функциями, а не с отдельным функциями. Входящие HTTP-запросы не могут использовать входящий IP-адрес для вызова отдельных функций. В них должно использоваться доменное имя по умолчанию (functionappname.azurewebsites.net) или имя личного домена.

## <a name="function-app-inbound-ip-address"></a>Входящий IP-адрес приложения-функции

У каждого приложения-функции имеется отдельный входящий IP-адрес. Вот как можно найти этот IP-адрес.

1. Войдите на [портал Azure](https://portal.azure.com).
2. Перейдите к приложению-функции.
3. В разделе **Параметры** выберите **Свойства**. Входящий IP-адрес отображается в разделе **виртуальный IP-адрес**.

## <a name="function-app-outbound-ip-addresses"></a><a name="find-outbound-ip-addresses"></a>IP-адреса для исходящего трафика приложения-функции

У каждого приложения-функции имеется набор доступных исходящих IP-адресов. Любое исходящее подключение из функции, например к внутренней базе данных, использует один из доступных исходящих IP-адресов в качестве IP-адреса источника. Невозможно заранее знать, какой IP-адрес будет использован для подключения. По этой причине внутренней службе необходимо разрешить в брандмауэре все исходящие IP-адреса приложения-функции.

Вот как можно найти исходящие IP-адреса, доступные для приложения-функции.

1. Войдите в [обозреватель ресурсов Azure](https://resources.azure.com).
2. Выберите **Подписки > {ваша подписка} > Поставщики > Microsoft.Web > Сайты**.
3. На панели "JSON" найдите сайт со свойством `id`, которое заканчивается именем вашего приложения-функции.
4. См. разделы `outboundIpAddresses` и `possibleOutboundIpAddresses`. 

Для приложения-функции в настоящее время доступен набор адресов `outboundIpAddresses`. Набор `possibleOutboundIpAddresses` включает в себя IP-адреса, которые будут доступны, только когда приложение-функция будет [переведено на другую ценовую категорию](#outbound-ip-address-changes).

Альтернативный способ найти доступные исходящие IP-адреса — воспользоваться [Cloud Shell](../cloud-shell/quickstart.md).

```azurecli-interactive
az webapp show --resource-group <group_name> --name <app_name> --query outboundIpAddresses --output tsv
az webapp show --resource-group <group_name> --name <app_name> --query possibleOutboundIpAddresses --output tsv
```

> [!NOTE]
> При масштабировании приложения-функции, которое выполняется в [плане потребления](consumption-plan.md) или [плана Premium](functions-premium-plan.md) , может быть назначен новый диапазон исходящих IP-адресов. При запуске в любом из этих планов может потребоваться добавить весь центр обработки данных в список разрешений.

## <a name="data-center-outbound-ip-addresses"></a>Исходящие IP-адреса центра обработки данных

Если необходимо добавить исходящие IP-адреса, используемые приложениями-функциями, в разрешенных, можно также добавить в разрешенных приложение-функцию "центр обработки данных" (регион Azure). Вы можете [скачать JSON-файл со списком IP-адресов всех центров обработки данных Azure](https://www.microsoft.com/en-us/download/details.aspx?id=56519). Затем найдите фрагмент JSON, который относится к региону, в котором выполняется приложение-функция.

Например, следующий фрагмент JSON — это то, как может выглядеть разрешенных для Западной Европы:

```
{
  "name": "AzureCloud.westeurope",
  "id": "AzureCloud.westeurope",
  "properties": {
    "changeNumber": 9,
    "region": "westeurope",
    "platform": "Azure",
    "systemService": "",
    "addressPrefixes": [
      "13.69.0.0/17",
      "13.73.128.0/18",
      ... Some IP addresses not shown here
     "213.199.180.192/27",
     "213.199.183.0/24"
    ]
  }
}
```

 Чтобы получить сведения о том, когда этот файл обновляется и изменяются IP-адреса, разверните раздел **Сведения** на [странице Центра загрузки](https://www.microsoft.com/en-us/download/details.aspx?id=56519).

## <a name="inbound-ip-address-changes"></a><a name="inbound-ip-address-changes"></a>Изменения входящего IP-адреса

Входящий IP-адрес **может** измениться, если вы:

- удалите приложение-функцию и создадите его заново в другой группе ресурсов;
- удалите последнее приложение-функцию с некоторым сочетанием группы ресурсов и региона и создадите его заново;
- Удалите привязку TLS, например во время [обновления сертификата](../app-service/configure-ssl-certificate.md#renew-certificate).

Если приложение-функция работает в [плане потребления](consumption-plan.md) или в [плане Premium](functions-premium-plan.md), входящий IP-адрес может также изменяться даже в том случае, если вы не сделали никаких действий, например [перечисленных выше](#inbound-ip-address-changes).

## <a name="outbound-ip-address-changes"></a>Изменения исходящих IP-адресов

Набор доступных исходящих IP-адресов для приложения-функции может измениться, если вы:

* выполните какое-либо действие, которое может изменить входящий IP-адрес;
* измените ценовую категорию для плана служб приложений. Список всех возможных исходящих IP-адресов приложения для всех ценовых категорий указан в свойстве `possibleOutboundIPAddresses`. См. также раздел [Поиск исходящих IP-адресов](#find-outbound-ip-addresses).

Если приложение-функция работает в [плане потребления](consumption-plan.md) или в [плане Premium](functions-premium-plan.md), исходящий IP-адрес может также изменяться даже в том случае, если вы не сделали никаких действий, например [перечисленных выше](#inbound-ip-address-changes).

Используйте следующую процедуру, чтобы намеренно принудительно выполнить изменение исходящего IP-адреса:

1. Изменить масштаб плана службы приложений, перейдя с ценовой категории "Стандартный" на "Премиум V2" (или наоборот).

2. Подождите 10 минут.

3. Вернитесь на исходную ценовую категорию.

## <a name="ip-address-restrictions"></a>Ограничения IP-адресов

Можно настроить список IP-адресов, доступ к которым разрешен или запрещен приложению-функции. Дополнительные сведения см. в статье [Ограничения статических IP-адресов в Службе приложений Azure](../app-service/app-service-ip-restrictions.md).

## <a name="dedicated-ip-addresses"></a>Выделенные IP-адреса

Существует несколько стратегий, которые необходимо изучить, когда приложению-функции требуются статические выделенные IP-адреса. 

### <a name="virtual-network-nat-gateway-for-outbound-static-ip"></a>Шлюз NAT виртуальной сети для исходящего статического IP-адреса

Вы можете управлять IP-адресом исходящего трафика из функций, используя шлюз NAT виртуальной сети для направления трафика через статический общедоступный IP-адрес. Эту топологию можно использовать при работе в [плане Premium](functions-premium-plan.md). Дополнительные сведения см. в разделе [учебник. Управление функциями Azure исходящий IP-адрес с помощью шлюза NAT виртуальной сети Azure](functions-how-to-use-nat-gateway.md).

### <a name="app-service-environments"></a>Среда службы приложений

Для полного контроля над IP-адресами, входящими и исходящими, рекомендуется использовать [среды службы приложений](../app-service/environment/intro.md) ( [изолированный уровень](https://azure.microsoft.com/pricing/details/app-service/) планов службы приложений). Дополнительные сведения см. в разделах [IP-адреса ASE](../app-service/environment/network-info.md#ase-ip-addresses) и [Как управлять входящим трафиком в среде службы приложений](../app-service/environment/app-service-app-service-environment-control-inbound-traffic.md).

Вот как можно узнать, работает ли ваше приложение-функция в среде службы приложений.

1. Войдите на [портал Azure](https://portal.azure.com).
2. Перейдите к приложению-функции.
3. Откройте вкладку **Обзор**.
4. Категория плана службы приложений отображена в разделе **План служб приложений или ценовая категория**. Ценовая категория среды службы приложений — **Изолированный**.
 
Кроме того, можно использовать [Cloud Shell](../cloud-shell/quickstart.md).

```azurecli-interactive
az webapp show --resource-group <group_name> --name <app_name> --query sku --output tsv
```

Номер `sku` среды службы приложений — `Isolated`.

## <a name="next-steps"></a>Дальнейшие действия

Распространенная причина изменения IP-адреса — изменение масштаба приложения-функции. [Узнайте больше о масштабировании приложений-функций](functions-scale.md).
