---
title: Интеграция функций Azure с виртуальной сетью Azure
description: Пошаговое руководство, в котором показано, как подключить функцию к виртуальной сети Azure
ms.topic: article
ms.date: 4/23/2020
ms.openlocfilehash: efc936111d162d73b1cc5465ae6b677c9006ab32
ms.sourcegitcommit: 2aa52d30e7b733616d6d92633436e499fbe8b069
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/06/2021
ms.locfileid: "97937032"
---
# <a name="tutorial-integrate-functions-with-an-azure-virtual-network"></a>Руководство. Интеграция Функций с виртуальной сетью Azure

В этом руководстве показано, как использовать функции Azure для подключения к ресурсам в виртуальной сети Azure. Вы создадите функцию, которая имеет доступ как к Интернету, так и к виртуальной машине, где выполняется WordPress в виртуальной сети.

> [!div class="checklist"]
> * Создание приложения-функции в плане Premium
> * Развертывание сайта WordPress на виртуальной машине в виртуальной сети
> * Подключение приложения функции к виртуальной сети
> * Создание прокси-функции для доступа к ресурсам WordPress
> * Запрос файла WordPress из виртуальной сети

## <a name="topology"></a>Топология

На следующей схеме показана архитектура создаваемого решения.

 ![Пользовательский интерфейс для интеграции виртуальной сети](./media/functions-create-vnet/topology.png)

Функции, выполняемые в плане Premium, имеют те же возможности размещения, что и веб-приложения в службе приложений Azure, включая функцию интеграции с виртуальной сетью. Дополнительные сведения об интеграции виртуальной сети, включая устранение неполадок и расширенную конфигурацию, см. в статье [интеграция приложения с виртуальной сетью Azure](../app-service/web-sites-integrate-with-vnet.md).

## <a name="prerequisites"></a>Предварительные требования

Для работы с этим руководством важно понимать принципы назначения IP-адресов и определения подсети. Вы можете начать с [этой статьи, в которой изложены основы назначения адресов и определения подсети](https://support.microsoft.com/help/164015/understanding-tcp-ip-addressing-and-subnetting-basics). В Интернете доступно множество других статей и видеоматериалов по этой теме.

Если у вас еще нет подписки Azure, [создайте бесплатную учетную запись Azure](https://azure.microsoft.com/free/?WT.mc_id=A261C142F), прежде чем начинать работу.

## <a name="create-a-function-app-in-a-premium-plan"></a>Создание приложения-функции в плане Premium

Сначала вы создадите приложение-функцию в [плане Premium]. Этот план обеспечивает бессерверное масштабирование при поддержке интеграции с виртуальной сетью.

[!INCLUDE [functions-premium-create](../../includes/functions-premium-create.md)]  

Вы можете закрепить приложение-функцию на панели мониторинга, щелкнув значок закрепления в правом верхнем углу. Закрепление упрощает возврат к этому приложению функции после создания виртуальной машины.

## <a name="create-a-vm-inside-a-virtual-network"></a>Создание виртуальной машины в виртуальной сети

Затем создайте предварительно настроенную виртуальную машину, которая будет запускать WordPress в виртуальной сети ([WordPress LEMP7 Max Performance](https://jetware.io/appliances/jetware/wordpress4_lemp7-170526/profile?us=azure) с жетваре). WordPress виртуальная машина используется из-за низкой стоимости и удобства. Такой же сценарий работает с любым ресурсом в виртуальной сети, например с интерфейсами API для остальных компонентов, средами службы приложений и другими службами Azure. 

1. На портале выберите **+ создать ресурс** в области навигации слева в поле поиска тип `WordPress LEMP7 Max Performance` и нажмите клавишу ВВОД.

1. В результатах поиска выберите **WordPress LEMP Max Performance (максимальная производительность** ). Выберите план программного обеспечения **WordPress LEMP максимальная производительность для CentOS** в качестве **плана по** и нажмите кнопку **создать**.

1. На вкладке **Основные сведения** задайте параметры виртуальной машины, указанные в таблице под этим изображением.

    ![Вкладка "основы" для создания виртуальной машины](./media/functions-create-vnet/create-vm-1.png)

    | Параметр      | Рекомендуемое значение  | Описание      |
    | ------------ | ---------------- | ---------------- |
    | **Подписка** | Ваша подписка | Подписка, в рамках которой создан ресурс. | 
    | **[Группа ресурсов](../azure-resource-manager/management/overview.md)**  | myResourceGroup | Выберите `myResourceGroup` или группу ресурсов, созданную с помощью приложения функции. Использование той же группы ресурсов для приложения функции, виртуальной машины WordPress и плана размещения упрощает очистку ресурсов после завершения работы с этим руководством. |
    | **Имя виртуальной машины** | VNET-Wordpress | Имя виртуальной машины должно быть уникальным в группе ресурсов. |
    | **[Регион](https://azure.microsoft.com/regions/)** | Европа Западная Европа | Выберите ближайший регион или рядом с функциями, которые обращаются к виртуальной машине. |
    | **Размер** | B1s | Выберите **изменить размер** , а затем выберите стандартный образ B1s, который содержит 1 виртуальных ЦП и 1 ГБ памяти. |
    | **Тип проверки подлинности** | Пароль | Чтобы использовать проверку подлинности с помощью пароля, необходимо также указать **имя пользователя**, защищенный **пароль**, а затем **подтвердить пароль**. В этом руководстве вам не потребуется входить в виртуальную машину, если не требуется устранение неполадок. |

1. Перейдите на вкладку **сеть** и в разделе Настройка виртуальных сетей выберите **создать**.

1. В разделе **Создание виртуальной сети** задайте параметры, указанные в таблице под изображением.

    ![Вкладка "Сетевые подключения" для создания виртуальной машины](./media/functions-create-vnet/create-vm-2.png)

    | Параметр      | Рекомендуемое значение  | Описание      |
    | ------------ | ---------------- | ---------------- |
    | **имя**; | myResourceGroup-vnet | Вы можете использовать имя по умолчанию, созданное для виртуальной сети. |
    | **Диапазон адресов** | 10.10.0.0/16 | Используйте один диапазон адресов для виртуальной сети. |
    | **Имя подсети** | Tutorial-Net | Имя подсети. |
    | **Диапазон адресов** (подсеть) | 10.10.1.0/24   | От размера подсети зависит, сколько интерфейсов можно в нее добавить. Эта подсеть используется сайтом WordPress.  `/24`Подсеть предоставляет 254 адресов узлов. |

1. Нажмите кнопку **ОК**, чтобы создать виртуальную сеть.

1. Вернитесь на вкладку **сеть** и выберите **нет** для **общедоступного IP-адреса**.

1. Перейдите на вкладку **Управление** , а затем в поле **диагностическая учетная запись хранения** выберите учетную запись хранения, созданную с помощью приложения функции.

1. Выберите **Review + create** (Просмотреть и создать). После завершения проверки щелкните **Создать**. Процесс создания виртуальной машины займет несколько минут. Созданная виртуальная машина может получить доступ только к виртуальной сети.

1. После создания виртуальной машины выберите **Перейти к ресурсу** , чтобы просмотреть страницу для новой виртуальной машины, а затем выберите **сеть** в разделе **Параметры**.

1. Убедитесь, что **общедоступный IP-адрес** отсутствует. Запишите **частный IP-адрес**, который используется для подключения к виртуальной машине из приложения-функции.

    ![Параметры сети в виртуальной машине](./media/functions-create-vnet/vm-networking.png)

Теперь у вас есть сайт WordPress, полностью развернутый в виртуальной сети. Этот сайт недоступен из общедоступного Интернета.

## <a name="connect-your-function-app-to-the-virtual-network"></a>Подключение приложения функции к виртуальной сети

Теперь, когда сайт WordPress работает на виртуальной машине в виртуальной сети, вы можете подключить приложение-функцию к этой виртуальной сети.

1. В новом приложении функции выберите **сеть** в меню слева.

1. В разделе **Интеграция виртуальной сети** выберите **Щелкните здесь для настройки**.

    :::image type="content" source="./media/functions-create-vnet/networking-0.png" alt-text="Выбор сети в приложении функции":::

1. На странице **Интеграция с виртуальной сетью** выберите **добавить виртуальную сеть**.

    :::image type="content" source="./media/functions-create-vnet/networking-2.png" alt-text="Добавление предварительной версии интеграции с виртуальной сетью":::

1. В поле **состояние компонента сети** используйте параметры, приведенные в таблице под изображением.

    ![Определение виртуальной сети приложения функции](./media/functions-create-vnet/networking-3.png)

    | Параметр      | Рекомендуемое значение  | Описание      |
    | ------------ | ---------------- | ---------------- |
    | **Виртуальная сеть** | MyResourceGroup — виртуальная сеть | Это виртуальная сеть, созданная ранее. |
    | **Подсеть** | Создание новой подсети | Создайте подсеть в виртуальной сети для использования приложением-функцией. Интеграция виртуальной сети должна быть настроена для использования пустой подсети. Не имеет значения, что функции используют подсеть, отличную от подсети виртуальной машины. Виртуальная сеть автоматически направляет трафик между двумя подсетями. |
    | **Имя подсети** | Function-Net | Имя новой подсети. |
    | **Блок адресов виртуальной сети** | 10.10.0.0/16 | Выберите тот же блок адресов, который используется сайтом WordPress. Должен быть определен только один блок адресов. |
    | **Диапазон адресов** | 10.10.2.0/24   | Размер подсети позволяет ограничивать общее число экземпляров, на которые может масштабироваться приложение функции плана Premium. В этом примере используется `/24` подсеть с 254 доступных адресов узлов. Эта подсеть не подготовлена, но ее легко вычислить. |

1. Нажмите кнопку **ОК** , чтобы добавить подсеть. Закройте страницы " **Интеграция виртуальной** сети" и " **состояние компонентов сети** ", чтобы вернуться на страницу приложения-функции.

Теперь приложение-функция может получить доступ к виртуальной сети, в которой работает сайт WordPress. Затем используйте [прокси-серверы функций Azure](functions-proxies.md) , чтобы вернуть файл с сайта WordPress.

## <a name="create-a-proxy-to-access-vm-resources"></a>Создание учетной записи-посредника для доступа к ресурсам виртуальной машины

Если интеграция с виртуальной сетью включена, вы можете создать прокси-сервер в приложении функции, чтобы перенаправить запросы на виртуальную машину, работающую в виртуальной сети.

1. В приложении-функции в меню слева выберите  **прокси** , а затем щелкните **Добавить**. Используйте параметры прокси-сервера в таблице под изображением:

    :::image type="content" source="./media/functions-create-vnet/create-proxy.png" alt-text="Определение параметров прокси-сервера":::

    | Параметр  | Рекомендуемое значение  | Описание      |
    | -------- | ---------------- | ---------------- |
    | **имя**; | РасТениЕ | Имя может иметь любое значение. Он используется для обнаружения учетной записи-посредника. |
    | **Шаблон маршрута** | /плант | Маршрут, сопоставляемый с ресурсом виртуальной машины. |
    | **Внутренний URL-адрес** | http://<YOUR_VM_IP>/ВП-контент/семес/твентисевентин/Ассетс/имажес/header.jpg | Замените `<YOUR_VM_IP>` IP-адресом созданной ранее виртуальной машины WordPress. Это сопоставление возвращает один файл с сайта. |

1. Щелкните **создать** , чтобы добавить прокси-сервер в приложение-функцию.

## <a name="try-it-out"></a>Попробуйте сейчас

1. В браузере попытайтесь получить доступ к URL-адресу, который использовался в качестве **URL-адреса внутреннего сервера**. Как и ожидалось, время ожидания запроса истекло. Время ожидания истекает, так как сайт WordPress подключен только к виртуальной сети, а не к Интернету.

1. Скопируйте значение **URL-адреса прокси** из нового прокси-сервера и вставьте его в адресную строку браузера. Возвращенный образ находится на сайте WordPress, работающем в виртуальной сети.

    ![Файл образа завода, возвращенный с сайта WordPress](./media/functions-create-vnet/plant.png)

Приложение-функция подключено как к Интернету, так и к виртуальной сети. Прокси-сервер получает запрос через общедоступный Интернет, а затем выступает в роли простого прокси-сервера HTTP для пересылки этого запроса в подключенную виртуальную сеть. Затем прокси-сервер передает ответ обратно в открытый Интернет.

[!INCLUDE [clean-up-section-portal](../../includes/clean-up-section-portal.md)]

## <a name="next-steps"></a>Дальнейшие действия

В этом руководстве сайт WordPress выступает в качестве API, который вызывается в приложении-функции с помощью прокси. Этот сценарий дает хороший учебник, так как его легко настроить и визуализировать. Вы можете использовать любой другой API, развернутый в виртуальной сети. Можно также создать функцию с кодом, который вызывает API, развернутые в виртуальной сети. Более реалистичный сценарий — это функция, которая использует API-интерфейсы клиента данных для вызова экземпляра SQL Server, развернутого в виртуальной сети.

Функции, выполняемые в плане Premium, используют ту же базовую инфраструктуру службы приложений, что и веб-приложения в категории премиум v2 plans. Вся документация по [веб-приложениям в службе приложений Azure](../app-service/overview.md) относится к функциям плана Premium.

> [!div class="nextstepaction"]
> [Дополнительные сведения о параметрах сети в Функциях](./functions-networking-options.md)

[План категории "Премиум"]: functions-premium-plan.md
