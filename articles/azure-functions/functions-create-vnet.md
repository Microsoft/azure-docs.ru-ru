---
title: Использование частных конечных точек для интеграции функций Azure с виртуальной сетью
description: Пошаговое руководство, в котором показано, как подключить функцию к виртуальной сети Azure и заблокировать ее с помощью частных конечных точек.
ms.topic: article
ms.date: 2/22/2021
ms.openlocfilehash: a7bad58167009b4089724165813eb061996f1e6b
ms.sourcegitcommit: dda0d51d3d0e34d07faf231033d744ca4f2bbf4a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/05/2021
ms.locfileid: "102200212"
---
# <a name="tutorial-integrate-azure-functions-with-an-azure-virtual-network-using-private-endpoints"></a>Руководство. Интеграция функций Azure с виртуальной сетью Azure с помощью частных конечных точек

В этом руководстве показано, как использовать функции Azure для подключения к ресурсам в виртуальной сети Azure с частными конечными точками. Вы создадите функцию с учетной записью хранения, заблокированной за виртуальной сетью, использующей триггер очереди служебной шины.

> [!div class="checklist"]
> * Создание приложения-функции в плане Premium
> * Создание ресурсов Azure (служебная шина, учетная запись хранения, виртуальная сеть)
> * Блокировка учетной записи хранения за закрытой конечной точкой
> * Блокировка служебной шины за закрытой конечной точкой
> * Развертывание приложения-функции с помощью служебной шины и триггеров HTTP.
> * Блокировка приложения-функции за закрытой конечной точкой
> * Протестируйте, чтобы убедиться, что приложение-функция защищено за пределы виртуальной сети.
> * Очистка ресурсов

## <a name="create-a-function-app-in-a-premium-plan"></a>Создание приложения-функции в плане Premium

Сначала вы создадите приложение-функцию .NET в [плане Premium] , так как в этом руководстве будет использоваться C#. Другие языки также поддерживаются в Windows. Этот план обеспечивает бессерверное масштабирование при поддержке интеграции с виртуальной сетью.

1. На **домашней странице** или в меню портала Azure выберите **Создать ресурс**.

1. На странице **Создать** щелкните **Вычислительные ресурсы** > **Приложение-функция**.

1. На странице **Основные сведения** используйте параметры приложения-функции как указано в таблице ниже:

    | Параметр      | Рекомендуемое значение  | Описание |
    | ------------ | ---------------- | ----------- |
    | **Подписка** | Ваша подписка | Подписка, в которой создано приложение-функция. |
    | **[Группа ресурсов](../azure-resource-manager/management/overview.md)** |  *myResourceGroup* | Имя новой группы ресурсов, в которой создается приложение-функция. |
    | **Имя приложения-функции** | Глобально уникальное имя | Имя, которое идентифицирует ваше новое приложение-функцию. Допустимые символы: `a-z` (без учета регистра), `0-9`и `-`.  |
    |**Опубликовать**| Код | Параметр для публикации файлов кода или контейнера Docker. |
    | **Стек среды выполнения** | .NET | В этом руководстве используется .NET |
    |**Регион**| Предпочтительный регион | Выберите ближайший [регион](https://azure.microsoft.com/regions/) или регион рядом с другими службами, к которому получают доступ ваши функции. |

1. По завершении выберите **Next: Размещение**. Введите следующие параметры на странице **Размещение**:

    | Параметр      | Рекомендуемое значение  | Описание |
    | ------------ | ---------------- | ----------- |
    | **[Учетная запись хранения](../storage/common/storage-account-create.md)** |  Глобально уникальное имя |  Создайте учетную запись хранения для использования приложением-функцией. Имя учетной записи хранения должно содержать от 3 до 24 символов и состоять только из цифр и строчных букв. Можно также использовать существующую учетную запись при условии, что она соответствует [требованиям учетной записи хранилища](./storage-considerations.md#storage-account-requirements). |
    |**Операционная система**| Windows | В этом учебнике используется Windows |
    | **[План](./functions-scale.md)** | Premium | План размещения, который определяет выделение ресурсов в приложении-функции. Выберите **Премиум**. По умолчанию создается новый план службы приложений. По умолчанию для параметра **Номер SKU и размер** задано значение **EP1**, где EP означает _Elastic Premium_ (гибкий план "Премиум"). Дополнительные сведения см. в [списке номеров SKU уровня "Премиум"](./functions-premium-plan.md#available-instance-skus).<br/>При запуске функций JavaScript для плана "Премиум" нужно выбрать экземпляр с меньшим количеством виртуальных ЦП. Дополнительные сведения см. в разделе [Выбор планов "Премиум" для конфигурации с одним виртуальным ЦП](./functions-reference-node.md#considerations-for-javascript-functions).  |

1. По завершении выберите **Next: Мониторинг**. Введите следующие параметры на странице **Мониторинг**:

    | Параметр      | Рекомендуемое значение  | Описание |
    | ------------ | ---------------- | ----------- |
    | **[Application Insights](./functions-monitoring.md)** | По умолчанию | Создает ресурс Application Insights с таким же *именем приложения* в ближайшем поддерживаемом регионе. Развернув этот параметр, можно задать **новое имя ресурса** или выбрать другое **расположение** в [географическом регионе Azure](https://azure.microsoft.com/global-infrastructure/geographies/), где будут храниться данные. |

1. Выберите **Просмотр и создание** , чтобы просмотреть выбранные параметры конфигурации приложения.

1. Проверьте параметры на странице **Просмотр и создание**, после чего выберите **Создать** для подготовки и развертывания приложения-функции.

1. Выберите значок **Уведомления** в правом верхнем углу портала. Вы должны увидеть сообщение **Развертывание выполнено**.

1. Выберите **Перейти к ресурсу** для просмотра нового приложения-функции. Можно также установить флажок **Закрепить на панели мониторинга**. Это упростит возвращение к этому ресурсу приложения-функции из панели мониторинга.

1. Поздравляем! Вы успешно создали приложение функции Premium!

## <a name="create-azure-resources"></a>Создание ресурсов Azure

### <a name="create-a-storage-account"></a>Создание учетной записи хранения

Для виртуальных сетей требуется отдельная учетная запись хранения, созданная при первоначальном создании приложения-функции.

1. На **домашней странице** или в меню портала Azure выберите **Создать ресурс**.

1. На новой странице найдите **учетную запись хранения** и выберите **создать** .

1. На вкладке **основы** задайте параметры, как указано в таблице ниже. Остальные можно оставить по умолчанию:

    | Параметр      | Рекомендуемое значение  | Описание      |
    | ------------ | ---------------- | ---------------- |
    | **Подписка** | Ваша подписка | Подписка, в рамках которой создан ресурс. | 
    | **[Группа ресурсов](../azure-resource-manager/management/overview.md)**  | myResourceGroup | Выберите группу ресурсов, созданную с помощью приложения функции. |
    | **имя**; | мисекурестораже| Имя учетной записи хранения, к которой будет применена частная конечная точка. |
    | **[Регион](https://azure.microsoft.com/regions/)** | мифунктионрегион | Выберите регион, в котором вы создали приложение функции. |

1. Выберите **Review + create** (Просмотреть и создать). После завершения проверки щелкните **Создать**.

### <a name="create-a-service-bus"></a>Создание служебной шины

1. На **домашней странице** или в меню портала Azure выберите **Создать ресурс**.

1. На новой странице найдите **служебную шину** и выберите **создать**.

1. На вкладке **основы** задайте параметры, как указано в таблице ниже. Остальные можно оставить по умолчанию:

    | Параметр      | Рекомендуемое значение  | Описание      |
    | ------------ | ---------------- | ---------------- |
    | **Подписка** | Ваша подписка | Подписка, в рамках которой создан ресурс. |
    | **[Группа ресурсов](../azure-resource-manager/management/overview.md)**  | myResourceGroup | Выберите группу ресурсов, созданную с помощью приложения функции. |
    | **имя**; | мисервицебус| Имя служебной шины, к которой будет применена частная конечная точка. |
    | **[Регион](https://azure.microsoft.com/regions/)** | мифунктионрегион | Выберите регион, в котором вы создали приложение функции. |
    | **Ценовая категория** | Premium | Выберите этот уровень, чтобы использовать частные конечные точки с служебной шиной. |

1. Выберите **Review + create** (Просмотреть и создать). После завершения проверки щелкните **Создать**.

### <a name="create-a-virtual-network"></a>Создание виртуальной сети

Ресурсы Azure в этом учебнике интегрируются с или помещаются в виртуальную сеть. Вы будете использовать частные конечные точки для сохранения сетевого трафика, входящего в виртуальную сеть.

В этом руководстве создаются две подсети:
- **по умолчанию**: подсеть для частных конечных точек. Частные IP-адреса предоставляются из этой подсети.
- **функции**: подсеть для интеграции виртуальной сети функций Azure. Эта подсеть делегируется приложению-функции.

Теперь создайте виртуальную сеть, в которой будет интегрироваться приложение функции.

1. На домашней странице или в меню портала Azure выберите **Создать ресурс**.

1. На новой странице выполните поиск по запросу **Виртуальная сеть** и выберите **создать**.

1. На вкладке **Основные сведения** используйте параметры виртуальной сети, как указано ниже.

    | Параметр      | Рекомендуемое значение  | Описание      |
    | ------------ | ---------------- | ---------------- |
    | **Подписка** | Ваша подписка | Подписка, в рамках которой создан ресурс. | 
    | **[Группа ресурсов](../azure-resource-manager/management/overview.md)**  | myResourceGroup | Выберите группу ресурсов, созданную с помощью приложения функции. |
    | **имя**; | мивиртуалнет| Имя виртуальной сети, к которой будет подключаться приложение функции. |
    | **[Регион](https://azure.microsoft.com/regions/)** | мифунктионрегион | Выберите регион, в котором вы создали приложение функции. |

1. На вкладке **IP-адреса** выберите **добавить подсеть**. При добавлении подсети используйте параметры, указанные ниже.

    :::image type="content" source="./media/functions-create-vnet/1-create-vnet-ip-address.png" alt-text="Снимок экрана с представлением &quot;Создание конфигурации виртуальной сети&quot;.":::

    | Параметр      | Рекомендуемое значение  | Описание      |
    | ------------ | ---------------- | ---------------- |
    | **Имя подсети** | functions | Имя подсети, к которой будет подключаться приложение функции. | 
    | **Диапазон адресов подсети** | 10.0.1.0/24 | Обратите внимание на пространство адресов IPv4 на приведенном выше рисунке 10.0.0.0/16. Если выше был 10.1.0.0/16, рекомендуемый *диапазон адресов подсети* будет 10.1.1.0/24. |

1. Выберите **Review + create** (Просмотреть и создать). После завершения проверки щелкните **Создать**.

## <a name="lock-down-your-storage-account-with-private-endpoints"></a>Блокировка учетной записи хранения с частными конечными точками

Частные конечные точки Azure используются для подключения к конкретным ресурсам Azure с помощью частного IP-адреса. Это подключение гарантирует, что сетевой трафик останется в выбранной виртуальной сети, и доступ будет доступен только для определенных ресурсов. Теперь создайте частные конечные точки для хранилища файлов Azure и хранилища BLOB-объектов Azure с помощью учетной записи хранения.

1. В новой учетной записи хранения в меню слева выберите **сеть** .

1. Выберите вкладку **подключения к частным конечным точкам** и выберите **Частная конечная точка**.

    :::image type="content" source="./media/functions-create-vnet/2-navigate-private-endpoint-store.png" alt-text="Снимок экрана с инструкциями по созданию частных конечных точек для учетной записи хранения.":::

1. На вкладке **Основные сведения** используйте параметры частной конечной точки, как указано ниже.

    | Параметр      | Рекомендуемое значение  | Описание      |
    | ------------ | ---------------- | ---------------- |
    | **Подписка** | Ваша подписка | Подписка, в рамках которой создан ресурс. | 
    | **[Группа ресурсов](../azure-resource-manager/management/overview.md)**  | myResourceGroup | Выберите группу ресурсов, созданную с помощью приложения функции. | |
    | **имя**; | файл — конечная точка | Имя частной конечной точки для файлов из вашей учетной записи хранения. |
    | **[Регион](https://azure.microsoft.com/regions/)** | мифунктионрегион | Выберите регион, в котором была создана учетная запись хранения. |

1. На вкладке **ресурс** используйте параметры частной конечной точки, как указано ниже.

    | Параметр      | Рекомендуемое значение  | Описание      |
    | ------------ | ---------------- | ---------------- |
    | **Подписка** | Ваша подписка | Подписка, в рамках которой создан ресурс. | 
    | **Тип ресурса**  | Microsoft.Storage/storageAccounts | Это тип ресурса для учетных записей хранения. |
    | **Ресурс** | мисекурестораже | Учетная запись хранения, которую вы только что создали |
    | **Целевой вспомогательный ресурс** | файл | Эта частная конечная точка будет использоваться для файлов из учетной записи хранения. |

1. На вкладке **Конфигурация** выберите значение **по умолчанию** для параметра подсеть.

1. Выберите **Review + create** (Просмотреть и создать). После завершения проверки щелкните **Создать**. Теперь ресурсы в виртуальной сети могут взаимодействовать с файлами хранилища.

1. Создайте еще одну закрытую конечную точку для больших двоичных объектов. На вкладке **ресурсы** используйте следующие параметры. Для всех остальных параметров используйте те же параметры, что и в действиях по созданию закрытой конечной точки файла.

    | Параметр      | Рекомендуемое значение  | Описание      |
    | ------------ | ---------------- | ---------------- |
    | **Подписка** | Ваша подписка | Подписка, в рамках которой создан ресурс. | 
    | **Тип ресурса**  | Microsoft.Storage/storageAccounts | Это тип ресурса для учетных записей хранения. |
    | **Ресурс** | мисекурестораже | Учетная запись хранения, которую вы только что создали |
    | **Целевой вспомогательный ресурс** | большой двоичный объект | Эта частная конечная точка будет использоваться для больших двоичных объектов из учетной записи хранения. |

## <a name="lock-down-your-service-bus-with-a-private-endpoint"></a>Блокировка служебной шины с помощью частной конечной точки

Теперь создайте закрытую конечную точку для служебной шины Azure.

1. В новой служебной шине выберите **сеть** в меню слева.

1. Выберите вкладку **подключения к частным конечным точкам** и выберите **Частная конечная точка**.

    :::image type="content" source="./media/functions-create-vnet/3-navigate-private-endpoint-service-bus.png" alt-text="Снимок экрана: переход к закрытым конечным точкам служебной шины.":::

1. На вкладке **Основные сведения** используйте параметры частной конечной точки, как указано ниже.

    | Параметр      | Рекомендуемое значение  | Описание      |
    | ------------ | ---------------- | ---------------- |
    | **Подписка** | Ваша подписка | Подписка, в рамках которой создан ресурс. | 
    | **[Группа ресурсов](../azure-resource-manager/management/overview.md)**  | myResourceGroup | Выберите группу ресурсов, созданную с помощью приложения функции. |
    | **имя**; | SB-Endpoint | Имя частной конечной точки для файлов из вашей учетной записи хранения. |
    | **[Регион](https://azure.microsoft.com/regions/)** | мифунктионрегион | Выберите регион, в котором была создана учетная запись хранения. |

1. На вкладке **ресурс** используйте параметры частной конечной точки, как указано ниже.

    | Параметр      | Рекомендуемое значение  | Описание      |
    | ------------ | ---------------- | ---------------- |
    | **Подписка** | Ваша подписка | Подписка, в рамках которой создан ресурс. | 
    | **Тип ресурса**  | Microsoft.ServiceBus/namespaces | Это тип ресурса для служебной шины. |
    | **Ресурс** | мисервицебус | Служебная шина, созданная ранее в этом руководстве. |
    | **Целевой подресурс** | пространство имен | Эта частная конечная точка будет использоваться для пространства имен из служебной шины. |

1. На вкладке **Конфигурация** выберите значение **по умолчанию** для параметра подсеть.

1. Выберите **Review + create** (Просмотреть и создать). После завершения проверки щелкните **Создать**. Теперь ресурсы в виртуальной сети могут взаимодействовать с служебной шиной.

## <a name="create-a-file-share"></a>Создание общей папки

1. В созданной учетной записи хранения выберите **файловые ресурсы** в меню слева.

1. Выберите **+ Общие файловые ресурсы**. Укажите **файлы** в качестве имени для файлового ресурса в рамках этого руководства.

    :::image type="content" source="./media/functions-create-vnet/4-create-file-share.png" alt-text="Снимок экрана создания общей папки в учетной записи хранения.":::

## <a name="get-storage-account-connection-string"></a>Получение строки подключения учетной записи хранения

1. В созданной учетной записи хранения выберите **ключи доступа** в меню слева.

1. Нажмите кнопку **отобразить ключи**. Скопируйте строку подключения key1 и сохраните ее. Эта строка подключения будет потребоваться позже при настройке параметров приложения.

    :::image type="content" source="./media/functions-create-vnet/5-get-store-connection-string.png" alt-text="Снимок экрана, посвященный получению строки подключения учетной записи хранения.":::

## <a name="create-a-queue"></a>Создание очереди

Это будет очередь, из которой триггер служебной шины службы "функции Azure" будет получать события.

1. В служебной шине выберите **очереди** в меню слева.

1. Выберите **Политики общего доступа**. Укажите **очередь** в качестве имени очереди для целей этого учебника.

    :::image type="content" source="./media/functions-create-vnet/6-create-queue.png" alt-text="Снимок экрана создания очереди служебной шины.":::

## <a name="get-service-bus-connection-string"></a>Получение строки подключения служебной шины

1. В служебной шине выберите **политики общего доступа** в меню слева.

1. Выберите **RootManageSharedAccessKey**. Скопируйте **основную строку подключения** и сохраните ее. Эта строка подключения будет потребоваться позже при настройке параметров приложения.

    :::image type="content" source="./media/functions-create-vnet/7-get-service-bus-connection-string.png" alt-text="Снимок экрана: как получить строку подключения к служебной шине.":::

## <a name="integrate-function-app-with-your-virtual-network"></a>Интеграция приложения функции с виртуальной сетью

Чтобы использовать приложение-функцию с виртуальными сетями, необходимо присоединить его к подсети. Мы используем конкретную подсеть для интеграции виртуальной сети функций Azure и подсеть по умолчанию для всех остальных частных конечных точек, созданных в этом руководстве.

1. В приложении функции выберите **сеть** в меню слева.

1. Выберите **щелкните здесь, чтобы настроить** в разделе Интеграция виртуальной сети.

    :::image type="content" source="./media/functions-create-vnet/8-connect-app-vnet.png" alt-text="Снимок экрана: переход к интеграции виртуальной сети.":::

1. Выберите **добавить виртуальную сеть**

1. В колонке, которая открывается в разделе **Виртуальная сеть**, выберите созданную ранее виртуальную сеть.

1. Выберите **подсеть** , созданную ранее с названием **функции**. Теперь приложение-функция интегрировано с вашей виртуальной сетью.

    :::image type="content" source="./media/functions-create-vnet/9-connect-app-subnet.png" alt-text="Снимок экрана: подключение приложения-функции к подсети.":::

## <a name="configure-your-function-app-settings-for-private-endpoints"></a>Настройка параметров приложения функции для частных конечных точек

1. В приложении функции в меню слева выберите **Конфигурация** .

1. Чтобы использовать приложение функции с виртуальными сетями, необходимо обновить следующие параметры приложения. Выберите **+ новый параметр приложения** или **карандаш, изменив в** крайнем правом столбце таблицы параметры приложения нужные значения. Затем нажмите кнопку **Сохранить**.

    :::image type="content" source="./media/functions-create-vnet/10-configure-app-settings.png" alt-text="Снимок экрана настройки параметров приложения функции для частных конечных точек.":::

    | Параметр      | Рекомендуемое значение  | Описание      |
    | ------------ | ---------------- | ---------------- |
    | **AzureWebJobsStorage** | мисекуресторажеконнектионстринг | Строка подключения созданной учетной записи хранения. Это строка подключения к хранилищу из [строки подключения получения учетной записи хранения](#get-storage-account-connection-string). При изменении этого параметра приложение функции теперь будет использовать защищенную учетную запись хранения для нормальной работы во время выполнения. | 
    | **WEBSITE_CONTENTAZUREFILECONNECTIONSTRING**  | мисекуресторажеконнектионстринг | Строка подключения созданной учетной записи хранения. После изменения этого параметра приложение функции будет использовать учетную запись защищенного хранения для файлов Azure, которые будут использоваться при развертывании. |
    | **WEBSITE_CONTENTSHARE** | файлы | Имя общей папки, созданной в учетной записи хранения. Этот параметр приложения используется в сочетании с WEBSITE_CONTENTAZUREFILECONNECTIONSTRING. |
    | **SERVICEBUS_CONNECTION** | мисервицебусконнектионстринг | Создайте параметр приложения для строки подключения служебной шины. Это строка подключения к хранилищу из [строки подключения получения служебной шины](#get-service-bus-connection-string).|
    | **WEBSITE_CONTENTOVERVNET** | 1 | Создайте этот параметр приложения. Значение 1 позволяет масштабировать приложение-функцию, если учетная запись хранения ограничена виртуальной сетью. Этот параметр следует включать при ограничении вашей учетной записи хранения виртуальной сетью. |
    | **WEBSITE_DNS_SERVER** | 168.63.129.16 | Создайте этот параметр приложения. После интеграции приложения с виртуальной сетью он будет использовать тот же DNS-сервер, что и виртуальная сеть. Это один из двух параметров, которые необходимы для работы приложения-функции с Azure DNS частными зонами и обязательными при использовании частных конечных точек. Эти параметры будут отсылать все исходящие вызовы из приложения в виртуальную сеть. |
    | **WEBSITE_VNET_ROUTE_ALL** | 1 | Создайте этот параметр приложения. После интеграции приложения с виртуальной сетью он будет использовать тот же DNS-сервер, что и виртуальная сеть. Это один из двух параметров, которые необходимы для работы приложения-функции с Azure DNS частными зонами и обязательными при использовании частных конечных точек. Эти параметры будут отсылать все исходящие вызовы из приложения в виртуальную сеть. |

1. Поработайте с представлением **конфигурации** , выберите вкладку **Параметры среды выполнения** .

1. Установите для параметра **мониторинг масштабирования среды выполнения** значение **вкл**., а затем выберите **сохранить**. Масштабирование, управляемое средой выполнения, позволяет подключать функции триггеров, отличных от HTTP, к службам, запущенным в виртуальной сети.

    :::image type="content" source="./media/functions-create-vnet/11-enable-runtime-scaling.png" alt-text="Снимок экрана: как включить масштабирование, управляемое средой выполнения для функций Azure.":::

## <a name="deploy-a-service-bus-trigger-and-http-trigger-to-your-function-app"></a>Развертывание триггера служебной шины и триггера HTTP в приложении-функции

1. В GitHub перейдите к следующему примеру репозитория, который содержит приложение-функцию с двумя функциями: триггер HTTP и триггер очереди служебной шины.

    <https://github.com/Azure-Samples/functions-vnet-tutorial>

1. В верхней части страницы нажмите кнопку **разветвления** , чтобы создать вилку этого репозитория в собственной учетной записи GitHub или организации.

1. В приложении функции выберите **центр развертывания** в меню слева. Затем выберите **Параметры**.

1. На вкладке **Параметры** используйте параметры развертывания, как указано ниже.

    | Параметр      | Рекомендуемое значение  | Описание      |
    | ------------ | ---------------- | ---------------- |
    | **Источник** | GitHub | Вы должны создать репозиторий GitHub с примером кода на шаге 2. | 
    | **Организация**  | myOrganization | Это организация, в которую входит репозиторий, обычно ваша учетная запись. |
    | **Репозиторий** | myRepo | Репозиторий, созданный с помощью образца кода. |
    | **Ветвь** | main | Это только что созданный репозиторий, поэтому используйте главную ветвь. |
    | **Стек среды выполнения** | .NET | Пример кода находится в C#. |

1. Нажмите кнопку **Сохранить**. 

    :::image type="content" source="./media/functions-create-vnet/12-deploy-portal.png" alt-text="Снимок экрана: развертывание кода функций Azure с помощью портала.":::

1. Начальное развертывание может занять несколько минут. При успешном развертывании приложения вы увидите сообщение о состоянии **Success (активное)** на вкладке **журналы** . При необходимости обновите страницу. 

1. Поздравляем! Вы успешно развернули пример приложения функции.

## <a name="lock-down-your-function-app-with-a-private-endpoint"></a>Блокировка приложения-функции с помощью частной конечной точки

Теперь создайте закрытую конечную точку для приложения функции. Эта частная конечная точка будет подключаться к приложению-функции в частном порядке и безопасно в вашей виртуальной сети с помощью частного IP-адреса. Дополнительные сведения о частных конечных точках см. в [документации по частным конечным точкам](https://docs.microsoft.com/azure/private-link/private-endpoint-overview).

1. В приложении функции выберите **сеть** в меню слева.

1. Выберите **щелкните здесь, чтобы настроить** в разделе подключения к частным конечным точкам.

    :::image type="content" source="./media/functions-create-vnet/14-navigate-app-private-endpoint.png" alt-text="Снимок экрана: переход к конечной точке приложение-функция Private.":::

1. Нажмите **Добавить**.

1. В открывшемся меню используйте параметры частной конечной точки, как указано ниже.

    :::image type="content" source="./media/functions-create-vnet/15-create-app-private-endpoint.png" alt-text="Снимок экрана создания приложение-функция частной конечной точки.":::

1. Нажмите кнопку **ОК** , чтобы добавить частную конечную точку. Поздравляем! Вы успешно защитили приложение функции, служебную шину и учетную запись хранения с частными конечными точками!

### <a name="test-your-locked-down-function-app"></a>Тестирование заблокированного приложения-функции

1. В приложении функции в меню слева выберите **функции** .

1. Выберите **ServiceBusQueueTrigger**.

1. В меню слева выберите **мониторинг**. Вы увидите, что вы не можете отслеживать приложение. Это связано с тем, что браузер не имеет доступа к виртуальной сети, поэтому он не может напрямую обращаться к ресурсам в виртуальной сети. Теперь мы покажем другой метод, с помощью которого вы по-прежнему можете отслеживать функцию, Application Insights.

1. В приложении функции выберите **Application Insights** в меню слева и выберите **Просмотр Application Insights данных**.

    :::image type="content" source="./media/functions-create-vnet/16-app-insights.png" alt-text="Снимок экрана: Просмотр Application Insights для приложение-функция.":::

1. В меню слева выберите **динамические метрики** .

1. Откройте новую вкладку. В служебной шине выберите **очереди** в меню слева.

1. Выберите очередь.

1. В меню слева выберите **Service Bus Explorer** . В разделе **Send (отправка**) выберите **text/plain** в качестве **типа содержимого** и введите сообщение. 

1. Выберите **Отправить** , чтобы отправить сообщение.

    :::image type="content" source="./media/functions-create-vnet/17-send-service-bus-message.png" alt-text="Снимок экрана: отправка сообщений служебной шины с помощью портала.":::

1. На вкладке, где открыты **динамические метрики** , вы увидите, что триггер очереди служебной шины активирован. В противном случае повторно отправьте сообщение из **обозревателя служебной шины** .

    :::image type="content" source="./media/functions-create-vnet/18-hello-world.png" alt-text="Снимок экрана, посвященный просмотру сообщений с использованием динамических метрик для приложений функций.":::

1. Поздравляем! Вы успешно протестировали свое приложение функции с частными конечными точками!

### <a name="private-dns-zones"></a>Частные зоны DNS
Использование частной конечной точки для подключения к ресурсам Azure означает подключение к частному IP-адресу вместо общедоступной конечной точки. Существующие службы Azure настроены на использование существующих DNS-серверов для подключения к общедоступной конечной точке. Чтобы подключиться к частной конечной точке, необходимо переопределить конфигурацию DNS.

Частная зона DNS была создана для каждого ресурса Azure, настроенного с помощью частной конечной точки. Для каждого частного IP-адреса, связанного с частной конечной точкой, создается запись DNS A.

В этом учебнике были созданы следующие зоны DNS:

- privatelink.file.core.windows.net
- privatelink.blob.core.windows.net
- privatelink.servicebus.windows.net
- privatelink.azurewebsites.net

[!INCLUDE [clean-up-section-portal](../../includes/clean-up-section-portal.md)]

## <a name="next-steps"></a>Дальнейшие действия

В этом руководстве вы создали приложение-функцию Premium, учетную запись хранения и служебную шину, а также защитили их все за закрытыми конечными точками! Дополнительные сведения о различных сетевых функциях, доступных ниже:

> [!div class="nextstepaction"]
> [Дополнительные сведения о параметрах сети в Функциях](./functions-networking-options.md)

[План категории "Премиум"]: functions-premium-plan.md
