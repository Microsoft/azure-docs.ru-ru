---
title: Использование частных конечных точек для интеграции функций Azure с виртуальной сетью
description: В этом руководстве показано, как подключить функцию к виртуальной сети Azure и заблокировать ее с помощью частных конечных точек.
ms.topic: article
ms.date: 2/22/2021
ms.openlocfilehash: 3dd5e700b3081f1c1ef8e4601385c707a5738321
ms.sourcegitcommit: b572ce40f979ebfb75e1039b95cea7fce1a83452
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/11/2021
ms.locfileid: "102630475"
---
# <a name="tutorial-integrate-azure-functions-with-an-azure-virtual-network-by-using-private-endpoints"></a>Руководство. Интеграция функций Azure с виртуальной сетью Azure с помощью частных конечных точек

В этом руководстве показано, как использовать функции Azure для подключения к ресурсам в виртуальной сети Azure с помощью частных конечных точек. Вы создадите функцию с помощью учетной записи хранения, заблокированной за виртуальной сетью. Виртуальная сеть использует триггер очереди служебной шины.

В этом руководстве вы выполните следующие действия.

> [!div class="checklist"]
> * Создайте приложение-функцию в плане Premium.
> * Создайте ресурсы Azure, такие как служебная шина, учетная запись хранения и виртуальная сеть.
> * Заблокируйте учетную запись хранения за закрытой конечной точкой.
> * Заблокировать служебную шину за пределами частной конечной точки.
> * Разверните приложение-функцию, которое использует как служебную шину, так и триггеры HTTP.
> * Заблокируйте приложение-функцию за закрытой конечной точкой.
> * Протестируйте, чтобы убедиться, что приложение-функция защищено внутри виртуальной сети.
> * Очистка ресурсов.

## <a name="create-a-function-app-in-a-premium-plan"></a>Создание приложения-функции в плане Premium

Вы создадите приложение-функцию .NET в плане Premium, так как в этом руководстве используется C#. Другие языки также поддерживаются в Windows. План Premium обеспечивает бессерверное масштабирование при поддержке интеграции с виртуальной сетью.

1. В меню портал Azure или на **домашней** странице выберите **создать ресурс**.

1. На странице **Создание** выберите   >  **приложение-функция** вычислений.

1. На странице **Основные сведения** для настройки параметров приложения-функции используйте следующую таблицу.

    | Параметр      | Рекомендуемое значение  | Описание |
    | ------------ | ---------------- | ----------- |
    | **Подписка** | Ваша подписка | Подписка, в которой создано это новое приложение-функция. |
    | **[Группа ресурсов](../azure-resource-manager/management/overview.md)** |  myResourceGroup | Имя новой группы ресурсов, в которой вы создадите приложение функции. |
    | **Имя приложения-функции** | Глобально уникальное имя | Имя, которое идентифицирует ваше новое приложение-функцию. Допустимые символы: `a-z` (без учета регистра), `0-9`и `-`.  |
    |**Опубликовать**| Код | Выберите публикацию файлов кода или контейнера DOCKER. |
    | **Стек среды выполнения** | .NET | В этом руководстве используется .NET. |
    |**Регион**| Предпочтительный регион | Выберите [регион](https://azure.microsoft.com/regions/) рядом с другими службами, к которым имеют доступ ваши функции. |

1. По завершении выберите **Next: Размещение**. Введите следующие параметры на странице **Размещение**.

    | Параметр      | Рекомендуемое значение  | Описание |
    | ------------ | ---------------- | ----------- |
    | **[Учетная запись хранения](../storage/common/storage-account-create.md)** |  Глобально уникальное имя |  Создайте учетную запись хранения для использования приложением-функцией. Длина имени учетной записи хранения должна составлять от 3 до 24 символов. Они могут содержать только цифры и строчные буквы. Можно также использовать существующую учетную запись при условии, что она соответствует [требованиям учетной записи хранилища](./storage-considerations.md#storage-account-requirements). |
    |**Операционная система**| Windows | В этом руководстве используется Windows. |
    | **[План](./functions-scale.md)** | Premium | План размещения, который определяет выделение ресурсов в приложении-функции. По умолчанию при выборе уровня **Premium** создается новый план службы приложений. **Номер SKU и размер** по умолчанию — **EP1**, где *EP* означает _эластичную версию Premium_. Дополнительные сведения см. в списке [номеров SKU](./functions-premium-plan.md#available-instance-skus)уровня "Премиум".<br/><br/>При запуске функций JavaScript в плане Premium выберите экземпляр с меньшим числом виртуальных ЦП. Дополнительные сведения см. в разделе [Выбор планов "Премиум" для конфигурации с одним виртуальным ЦП](./functions-reference-node.md#considerations-for-javascript-functions).  |

1. По завершении выберите **Next: Мониторинг**. Введите следующие параметры на странице **Мониторинг**.

    | Параметр      | Рекомендуемое значение  | Описание |
    | ------------ | ---------------- | ----------- |
    | **[Application Insights](./functions-monitoring.md)** | По умолчанию | Создайте ресурс Application Insights с тем же именем приложения в ближайшем поддерживаемом регионе. Разверните этот параметр, если вам нужно изменить **новое имя ресурса** или сохранить данные в другом **расположении** в [географическом регионе Azure](https://azure.microsoft.com/global-infrastructure/geographies/). |

1. Выберите **Просмотр и создание** , чтобы просмотреть выбранные параметры конфигурации приложения.

1. На странице " **Проверка и создание** " Проверьте параметры. Затем щелкните **создать** для инициализации и развертывания приложения функции.

1. В правом верхнем углу портала щелкните значок **уведомления** и просмотрите сообщение об **успешности развертывания** .

1. Выберите **Перейти к ресурсу** для просмотра нового приложения-функции. Можно также установить флажок **Закрепить на панели мониторинга**. Это упростит возвращение к этому ресурсу приложения-функции из панели мониторинга.

Поздравляем! Вы успешно создали приложение функции Premium.

## <a name="create-azure-resources"></a>Создание ресурсов Azure

Далее предстоит создать учетную запись хранения, служебную шину и виртуальную сеть. 
### <a name="create-a-storage-account"></a>Создание учетной записи хранения

Виртуальным сетям потребуется учетная запись хранения, которая отличается от созданной вами в приложении-функции.

1. В меню портал Azure или на **домашней** странице выберите **создать ресурс**.

1. На странице **Создание** найдите *учетную запись хранения*. Щелкните **Создать**.

1. На вкладке **Основные сведения** для настройки параметров учетной записи хранения используйте следующую таблицу. Все остальные параметры могут использовать значения по умолчанию.

    | Параметр      | Рекомендуемое значение  | Описание      |
    | ------------ | ---------------- | ---------------- |
    | **Подписка** | Ваша подписка | Подписка, в рамках которой создан ресурс. | 
    | **[Группа ресурсов](../azure-resource-manager/management/overview.md)**  | myResourceGroup | Группа ресурсов, созданная с помощью приложения функции. |
    | **имя**; | мисекурестораже| Имя учетной записи хранения, к которой будет применена частная конечная точка. |
    | **[Регион](https://azure.microsoft.com/regions/)** | мифунктионрегион | Регион, в котором вы создали приложение функции. |

1. Выберите **Review + create** (Просмотреть и создать). После завершения проверки выберите **создать**.

### <a name="create-a-service-bus"></a>Создание служебной шины

1. В меню портал Azure или на **домашней** странице выберите **создать ресурс**.

1. На **новой** странице найдите служебную *шину*. Щелкните **Создать**.

1. На вкладке **Основные сведения** для настройки параметров служебной шины используйте следующую таблицу. Все остальные параметры могут использовать значения по умолчанию.

    | Параметр      | Рекомендуемое значение  | Описание      |
    | ------------ | ---------------- | ---------------- |
    | **Подписка** | Ваша подписка | Подписка, в рамках которой создан ресурс. |
    | **[Группа ресурсов](../azure-resource-manager/management/overview.md)**  | myResourceGroup | Группа ресурсов, созданная с помощью приложения функции. |
    | **имя**; | мисервицебус| Имя служебной шины, к которой будет применяться частная конечная точка. |
    | **[Регион](https://azure.microsoft.com/regions/)** | мифунктионрегион | Регион, в котором вы создали приложение функции. |
    | **Ценовая категория** | Premium | Выберите этот уровень, чтобы использовать частные конечные точки в служебной шине Azure. |

1. Выберите **Review + create** (Просмотреть и создать). После завершения проверки выберите **создать**.

### <a name="create-a-virtual-network"></a>Создание виртуальной сети

Ресурсы Azure в этом учебнике интегрируются с или помещаются в виртуальную сеть. Вы будете использовать частные конечные точки для хранения сетевого трафика в виртуальной сети.

В этом руководстве создаются две подсети:
- **по умолчанию**: подсеть для частных конечных точек. Частные IP-адреса предоставляются из этой подсети.
- **функции**: подсеть для интеграции виртуальной сети функций Azure. Эта подсеть делегируется приложению-функции.

Создайте виртуальную сеть, в которой будет интегрироваться приложение функции:

1. В меню портал Azure или на **домашней** странице выберите **создать ресурс**.

1. На **новой** странице выполните поиск по запросу *Виртуальная сеть*. Щелкните **Создать**.

1. На вкладке **Основные сведения** для настройки параметров виртуальной сети используйте следующую таблицу.

    | Параметр      | Рекомендуемое значение  | Описание      |
    | ------------ | ---------------- | ---------------- |
    | **Подписка** | Ваша подписка | Подписка, в рамках которой создан ресурс. | 
    | **[Группа ресурсов](../azure-resource-manager/management/overview.md)**  | myResourceGroup | Группа ресурсов, созданная с помощью приложения функции. |
    | **имя**; | мивиртуалнет| Имя виртуальной сети, к которой будет подключаться приложение функции. |
    | **[Регион](https://azure.microsoft.com/regions/)** | мифунктионрегион | Регион, в котором вы создали приложение функции. |

1. На вкладке **IP-адреса** выберите **добавить подсеть**. Для настройки параметров подсети используйте следующую таблицу.

    :::image type="content" source="./media/functions-create-vnet/1-create-vnet-ip-address.png" alt-text="Снимок экрана с представлением &quot;Создание конфигурации виртуальной сети&quot;.":::

    | Параметр      | Рекомендуемое значение  | Описание      |
    | ------------ | ---------------- | ---------------- |
    | **Имя подсети** | functions | Имя подсети, к которой будет подключаться приложение функции. | 
    | **Диапазон адресов подсети** | 10.0.1.0/24 | Диапазон адресов подсети. На предыдущем рисунке обратите внимание, что адресное пространство IPv4 — 10.0.0.0/16. Если значение было 10.1.0.0/16, рекомендуемый диапазон адресов подсети будет 10.1.1.0/24. |

1. Выберите **Review + create** (Просмотреть и создать). После завершения проверки выберите **создать**.

## <a name="lock-down-your-storage-account"></a>Блокировка учетной записи хранения

Частные конечные точки Azure используются для подключения к конкретным ресурсам Azure с помощью частного IP-адреса. Это подключение гарантирует, что сетевой трафик останется в выбранной виртуальной сети, и доступ будет доступен только для определенных ресурсов. 

Создайте частные конечные точки для хранилища файлов Azure и хранилища BLOB-объектов Azure с помощью учетной записи хранения.

1. В новой учетной записи хранения в меню слева выберите **сеть**.

1. На вкладке **частные конечные точки подключения** выберите **Частная конечная точка**.

    :::image type="content" source="./media/functions-create-vnet/2-navigate-private-endpoint-store.png" alt-text="Снимок экрана создания частных конечных точек для учетной записи хранения.":::

1. На вкладке **Основные сведения** используйте параметры частной конечной точки, приведенные в следующей таблице.

    | Параметр      | Рекомендуемое значение  | Описание      |
    | ------------ | ---------------- | ---------------- |
    | **Подписка** | Ваша подписка | Подписка, в рамках которой создан ресурс. | 
    | **[Группа ресурсов](../azure-resource-manager/management/overview.md)**  | myResourceGroup | Выберите группу ресурсов, созданную с помощью приложения функции. | |
    | **имя**; | файл — конечная точка | Имя частной конечной точки для файлов из вашей учетной записи хранения. |
    | **[Регион](https://azure.microsoft.com/regions/)** | мифунктионрегион | Выберите регион, в котором была создана учетная запись хранения. |

1. На вкладке **ресурс** используйте параметры частной конечной точки, приведенные в следующей таблице.

    | Параметр      | Рекомендуемое значение  | Описание      |
    | ------------ | ---------------- | ---------------- |
    | **Подписка** | Ваша подписка | Подписка, в рамках которой создан ресурс. | 
    | **Тип ресурса**  | Microsoft.Storage/storageAccounts | Тип ресурса для учетных записей хранения. |
    | **Ресурс** | мисекурестораже | Созданная учетная запись хранения. |
    | **Целевой вспомогательный ресурс** | файл | Частная конечная точка, которая будет использоваться для файлов из учетной записи хранения. |

1. На вкладке **Конфигурация** для параметра **подсеть** выберите **значение по умолчанию**.

1. Выберите **Review + create** (Просмотреть и создать). После завершения проверки выберите **создать**. Теперь ресурсы в виртуальной сети могут взаимодействовать с файлами хранилища.

1. Создайте еще одну закрытую конечную точку для больших двоичных объектов. На вкладке **ресурсы** используйте параметры, приведенные в следующей таблице. Для всех остальных параметров используйте те же значения, которые использовались для создания частной конечной точки для файлов.

    | Параметр      | Рекомендуемое значение  | Описание      |
    | ------------ | ---------------- | ---------------- |
    | **Подписка** | Ваша подписка | Подписка, в рамках которой создан ресурс. | 
    | **Тип ресурса**  | Microsoft.Storage/storageAccounts | Тип ресурса для учетных записей хранения. |
    | **Ресурс** | мисекурестораже | Созданная учетная запись хранения. |
    | **Целевой вспомогательный ресурс** | большой двоичный объект | Частная конечная точка, которая будет использоваться для больших двоичных объектов из учетной записи хранения. |

## <a name="lock-down-your-service-bus"></a>Блокировка служебной шины

Создайте закрытую конечную точку для блокировки служебной шины:

1. В новой служебной шине в меню слева выберите **сеть**.

1. На вкладке **частные конечные точки подключения** выберите **Частная конечная точка**.

    :::image type="content" source="./media/functions-create-vnet/3-navigate-private-endpoint-service-bus.png" alt-text="Снимок экрана, посвященный переходу к частным конечным точкам служебной шины.":::

1. На вкладке **Основные сведения** используйте параметры частной конечной точки, приведенные в следующей таблице.

    | Параметр      | Рекомендуемое значение  | Описание      |
    | ------------ | ---------------- | ---------------- |
    | **Подписка** | Ваша подписка | Подписка, в рамках которой создан ресурс. | 
    | **[Группа ресурсов](../azure-resource-manager/management/overview.md)**  | myResourceGroup | Группа ресурсов, созданная с помощью приложения функции. |
    | **имя**; | SB-Endpoint | Имя частной конечной точки для файлов из вашей учетной записи хранения. |
    | **[Регион](https://azure.microsoft.com/regions/)** | мифунктионрегион | Регион, в котором была создана учетная запись хранения. |

1. На вкладке **ресурс** используйте параметры частной конечной точки, приведенные в следующей таблице.

    | Параметр      | Рекомендуемое значение  | Описание      |
    | ------------ | ---------------- | ---------------- |
    | **Подписка** | Ваша подписка | Подписка, в рамках которой создан ресурс. | 
    | **Тип ресурса**  | Microsoft.ServiceBus/namespaces | Тип ресурса для служебной шины. |
    | **Ресурс** | мисервицебус | Служебная шина, созданная ранее в этом руководстве. |
    | **Целевой подресурс** | namespace | Частная конечная точка, которая будет использоваться для пространства имен из служебной шины. |

1. На вкладке **Конфигурация** для параметра **подсеть** выберите **значение по умолчанию**.

1. Выберите **Review + create** (Просмотреть и создать). После завершения проверки выберите **создать**. 

Теперь ресурсы в виртуальной сети могут взаимодействовать с служебной шиной.

## <a name="create-a-file-share"></a>Создание общей папки

1. В созданной учетной записи хранения в меню слева выберите **Общие файловые ресурсы**.

1. Выберите **+ Общие файловые ресурсы**. В рамках этого руководства назовите *файловый ресурс.*

    :::image type="content" source="./media/functions-create-vnet/4-create-file-share.png" alt-text="Снимок экрана создания общей папки в учетной записи хранения.":::

1. Нажмите кнопку **создания**.

## <a name="get-the-storage-account-connection-string"></a>Получение строки подключения учетной записи хранения

1. В созданной учетной записи хранения в меню слева выберите **ключи доступа**.

1. Нажмите кнопку **отобразить ключи**. Скопируйте и сохраните строку подключения **Key1**. Эта строка подключения потребуется при настройке параметров приложения.

    :::image type="content" source="./media/functions-create-vnet/5-get-store-connection-string.png" alt-text="Снимок экрана, посвященный получению строки подключения учетной записи хранения.":::

## <a name="create-a-queue"></a>Создание очереди

Создайте очередь, в которой триггер служебной шины службы "функции Azure" будет получать события:

1. В служебной шине в меню слева выберите **очереди**.

1. Выберите **Политики общего доступа**. В рамках этого руководства назовите *очередь* List.

    :::image type="content" source="./media/functions-create-vnet/6-create-queue.png" alt-text="Снимок экрана создания очереди служебной шины.":::

1. Нажмите кнопку **создания**.

## <a name="get-a-service-bus-connection-string"></a>Получение строки подключения служебной шины

1. В служебной шине в меню слева выберите **политики общего доступа**.

1. Выберите **RootManageSharedAccessKey**. Скопируйте и сохраните **основную строку подключения**. Эта строка подключения потребуется при настройке параметров приложения.

    :::image type="content" source="./media/functions-create-vnet/7-get-service-bus-connection-string.png" alt-text="Снимок экрана: как получить строку подключения к служебной шине.":::

## <a name="integrate-the-function-app"></a>Интеграция приложения функции

Чтобы использовать приложение-функцию с виртуальными сетями, необходимо присоединить его к подсети. Вы будете использовать определенную подсеть для интеграции виртуальной сети функций Azure. Вы будете использовать подсеть по умолчанию для других частных конечных точек, создаваемых в этом руководстве.

1. В приложении функции в меню слева выберите **сеть**.

1. В разделе **Интеграция виртуальной сети** выберите **Щелкните здесь для настройки**.

    :::image type="content" source="./media/functions-create-vnet/8-connect-app-vnet.png" alt-text="Снимок экрана, посвященный переходу к интеграции виртуальной сети.":::

1. Выберите **Добавить виртуальную сеть**.

1. В разделе **Виртуальная сеть** выберите созданную ранее виртуальную сеть.

1. Выберите созданную ранее подсеть **функций** . Теперь приложение-функция интегрировано с вашей виртуальной сетью.

    :::image type="content" source="./media/functions-create-vnet/9-connect-app-subnet.png" alt-text="Снимок экрана: подключение приложения-функции к подсети.":::

## <a name="configure-your-function-app-settings"></a>Настройка параметров приложения функции

1. В приложении функции в меню слева выберите **Конфигурация**.

1. Чтобы использовать приложение функции с виртуальными сетями, обновите параметры приложения, приведенные в следующей таблице. Чтобы добавить или изменить параметр, выберите **+ новый параметр приложения** или значок **изменения** в крайнем правом столбце таблицы параметры приложения. По завершении нажмите кнопку **Сохранить**.

    :::image type="content" source="./media/functions-create-vnet/10-configure-app-settings.png" alt-text="Снимок экрана настройки параметров приложения функции для частных конечных точек.":::

    | Параметр      | Рекомендуемое значение  | Описание      |
    | ------------ | ---------------- | ---------------- |
    | **AzureWebJobsStorage** | мисекуресторажеконнектионстринг | Строка подключения созданной учетной записи хранения. Эта строка подключения к хранилищу находится в разделе [Получение строки подключения учетной записи хранения](#get-the-storage-account-connection-string) . Этот параметр позволяет приложению функции использовать защищенную учетную запись хранения для нормальной работы во время выполнения. | 
    | **WEBSITE_CONTENTAZUREFILECONNECTIONSTRING**  | мисекуресторажеконнектионстринг | Строка подключения созданной учетной записи хранения. Этот параметр позволяет приложению-функции использовать защищенную учетную запись хранения для файлов Azure, которая используется во время развертывания. |
    | **WEBSITE_CONTENTSHARE** | файлы | Имя общей папки, созданной в учетной записи хранения. Используйте этот параметр совместно с WEBSITE_CONTENTAZUREFILECONNECTIONSTRING. |
    | **SERVICEBUS_CONNECTION** | мисервицебусконнектионстринг | Создайте этот параметр приложения для строки подключения служебной шины. Эта строка подключения к хранилищу находится в разделе " [Получение строки подключения к служебной шине](#get-a-service-bus-connection-string) ".|
    | **WEBSITE_CONTENTOVERVNET** | 1 | Создайте этот параметр приложения. Значение 1 позволяет масштабировать приложение-функцию, если ваша учетная запись хранения ограничена виртуальной сетью. |
    | **WEBSITE_DNS_SERVER** | 168.63.129.16 | Создайте этот параметр приложения. Когда приложение интегрируется с виртуальной сетью, оно будет использовать тот же DNS-сервер, что и виртуальная сеть. Приложению функции требуется этот параметр, чтобы он мог работать с Azure DNS частными зонами. Он необходим при использовании частных конечных точек. Этот параметр и WEBSITE_VNET_ROUTE_ALL будут отсылать все исходящие вызовы из приложения в виртуальную сеть. |
    | **WEBSITE_VNET_ROUTE_ALL** | 1 | Создайте этот параметр приложения. Когда приложение интегрируется с виртуальной сетью, оно использует тот же DNS-сервер, что и виртуальная сеть. Приложению функции требуется этот параметр, чтобы он мог работать с Azure DNS частными зонами. Он необходим при использовании частных конечных точек. Этот параметр и WEBSITE_DNS_SERVER будут отсылать все исходящие вызовы из приложения в виртуальную сеть. |

1. В представлении **Конфигурация** выберите вкладку **Параметры среды выполнения** .

1. Задайте значение **On** для **наблюдения за масштабом среды выполнения** . Затем нажмите кнопку **Save** (Сохранить). Масштабирование на основе среды выполнения позволяет подключать функции триггеров, отличных от HTTP, к службам, выполняемым внутри виртуальной сети.

    :::image type="content" source="./media/functions-create-vnet/11-enable-runtime-scaling.png" alt-text="Снимок экрана: как включить масштабирование на основе среды выполнения для функций Azure.":::

## <a name="deploy-a-service-bus-trigger-and-http-trigger"></a>Развертывание триггера служебной шины и триггера HTTP

1. В GitHub перейдите к следующему примеру репозитория. Он содержит приложение-функцию и две функции, триггер HTTP и триггер очереди служебной шины.

    <https://github.com/Azure-Samples/functions-vnet-tutorial>

1. В верхней части страницы выберите **вилку** , чтобы создать вилку этого репозитория в собственной учетной записи GitHub или организации.

1. В приложении функции в меню слева выберите **центр развертывания**. Затем выберите **Параметры**.

1. На вкладке **Параметры** используйте параметры развертывания, приведенные в следующей таблице.

    | Параметр      | Рекомендуемое значение  | Описание      |
    | ------------ | ---------------- | ---------------- |
    | **Источник** | GitHub | Вы должны создать репозиторий GitHub для примера кода на шаге 2. | 
    | **Организация**  | myOrganization | Организация, в которой зарегистрирован репозиторий. Обычно это ваша учетная запись. |
    | **Репозиторий** | myRepo | Репозиторий, созданный для примера кода. |
    | **Ветвь** | main | Главная ветвь созданного репозитория. |
    | **Стек среды выполнения** | .NET | Пример кода находится в C#. |

1. Щелкните **Сохранить**. 

    :::image type="content" source="./media/functions-create-vnet/12-deploy-portal.png" alt-text="Снимок экрана: развертывание кода функций Azure с помощью портала.":::

1. Начальное развертывание может занять несколько минут. После успешного развертывания приложения на вкладке **журналы** отображается сообщение о состоянии **Success (активное)** . Если потребуется, обновите страницу.

Поздравляем! Вы успешно развернули пример приложения функции.

## <a name="lock-down-your-function-app"></a>Блокировка приложения функции

Теперь создайте закрытую конечную точку, чтобы заблокировать приложение функции. Эта частная конечная точка будет подключаться к приложению-функции в частном порядке и безопасно в виртуальной сети с помощью частного IP-адреса. 

Дополнительные сведения см. в [документации по частной конечной точке](https://docs.microsoft.com/azure/private-link/private-endpoint-overview).

1. В приложении функции в меню слева выберите **сеть**.

1. В разделе **подключения к частным конечным точкам** выберите **настроить подключения к частным конечным точкам**.

    :::image type="content" source="./media/functions-create-vnet/14-navigate-app-private-endpoint.png" alt-text="Снимок экрана: переход к закрытой конечной точке приложения-функции.":::

1. Выберите **Добавить**.

1. В открывшейся области используйте следующие параметры частной конечной точки:

    :::image type="content" source="./media/functions-create-vnet/15-create-app-private-endpoint.png" alt-text="Снимок экрана создания закрытой конечной точки приложения-функции. Имя — functionapp-Endpoint. Подписка — &quot;частный тест КАЧХАИ&quot;. Виртуальная сеть — Мивиртуалнет — учебник. Подсеть по умолчанию.":::

1. Нажмите кнопку **ОК** , чтобы добавить частную конечную точку. 
 
Поздравляем! Вы успешно защитили приложение функции, служебную шину и учетную запись хранения, добавив частные конечные точки!

### <a name="test-your-locked-down-function-app"></a>Тестирование заблокированного приложения-функции

1. В приложении функции в меню слева выберите **функции**.

1. Выберите **ServiceBusQueueTrigger**.

1. В меню слева выберите **Монитор**. 
 
Вы увидите, что вы не можете отслеживать приложение. Браузер не имеет доступа к виртуальной сети, поэтому он не может напрямую обращаться к ресурсам в виртуальной сети. 
 
Ниже приведен альтернативный способ мониторинга функции с помощью Application Insights.

1. В приложении функции в меню слева выберите **Application Insights**. Затем выберите **просмотр Application Insights данных**.

    :::image type="content" source="./media/functions-create-vnet/16-app-insights.png" alt-text="Снимок экрана, посвященный просмотру Application Insights для приложения-функции.":::

1. В меню слева выберите **динамические метрики**.

1. Откройте новую вкладку. В служебной шине в меню слева выберите **очереди**.

1. Выберите очередь.

1. В меню слева выберите **Service Bus Explorer**. В разделе **Send**( **тип содержимого**) выберите **text/plain (текст/обычный**). Затем введите сообщение. 

1. Выберите **Отправить** , чтобы отправить сообщение.

    :::image type="content" source="./media/functions-create-vnet/17-send-service-bus-message.png" alt-text="Снимок экрана: отправка сообщений служебной шины с помощью портала.":::

1. На вкладке " **динамические метрики** " вы увидите, что триггер очереди служебной шины запущен. В противном случае повторно отправьте сообщение из **обозревателя служебной шины**.

    :::image type="content" source="./media/functions-create-vnet/18-hello-world.png" alt-text="Снимок экрана, посвященный просмотру сообщений с помощью динамических метрик для приложений функций.":::

Поздравляем! Установка приложения функции успешно протестирована с частными конечными точками.

## <a name="understand-private-dns-zones"></a>Общие сведения о частных зонах DNS
Вы использовали частную конечную точку для подключения к ресурсам Azure. Вы подключаетесь к частному IP-адресу вместо общедоступной конечной точки. Существующие службы Azure настроены на использование существующего DNS-сервера для подключения к общедоступной конечной точке. Необходимо переопределить конфигурацию DNS для подключения к частной конечной точке.

Для каждого ресурса Azure, настроенного с помощью частной конечной точки, создается частная зона DNS. Для каждого частного IP-адреса, связанного с частной конечной точкой, создается запись DNS.

В этом учебнике были созданы следующие зоны DNS:

- privatelink.file.core.windows.net
- privatelink.blob.core.windows.net
- privatelink.servicebus.windows.net
- privatelink.azurewebsites.net

[!INCLUDE [clean-up-section-portal](../../includes/clean-up-section-portal.md)]

## <a name="next-steps"></a>Дальнейшие действия

В этом руководстве вы создали приложение-функцию Premium, учетную запись хранения и служебную шину. Вы защитили все эти ресурсы за частные конечные точки. 

Чтобы узнать больше о доступных сетевых функциях, воспользуйтесь следующими ссылками:

> [!div class="nextstepaction"]
> [Сетевые параметры в функциях Azure](./functions-networking-options.md)


> [!div class="nextstepaction"]
> [План функций Azure Premium](./functions-premium-plan.md)
