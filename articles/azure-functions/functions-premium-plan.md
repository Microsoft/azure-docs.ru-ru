---
title: План функций Azure Premium
description: Сведения и параметры конфигурации (VNet, без холодного запуска, длительности выполнения) для плана функций Azure Premium.
author: jeffhollan
ms.topic: conceptual
ms.date: 08/28/2020
ms.author: jehollan
ms.custom:
- references_regions
- fasttrack-edit
- devx-track-azurecli
ms.openlocfilehash: 3061329ad9dcb368dab586acc2146e6fb4e23028
ms.sourcegitcommit: c27a20b278f2ac758447418ea4c8c61e27927d6a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/03/2021
ms.locfileid: "101708719"
---
# <a name="azure-functions-premium-plan"></a>План функций Azure Premium

План функций Azure Premium (иногда называемый планом эластичного уровня "Премиум") является вариантом размещения для приложений-функций. Другие варианты плана размещения см. в [статье о плане размещения](functions-scale.md).

Размещение плана Premium предоставляет следующие преимущества для ваших функций:

* Избегайте холодного запуска с бессрочными горячими экземплярами
* Подключение к виртуальной сети.
* Неограниченная длительность выполнения с гарантированным 60 минутами.
* Размеры экземпляров класса Premium: одно ядро, два ядра и четыре основных экземпляра.
* Более прогнозируемые цены по сравнению с планом потребления.
* Распределение приложений с высокой плотностью для планов с несколькими приложениями-функциями.

Если вы используете план Premium, экземпляры узла функций Azure добавляются и удаляются в зависимости от числа входящих событий, как и в [плане потребления](consumption-plan.md). В один и тот же план Premium можно развернуть несколько приложений с функциями, а план позволяет настроить размер вычислительных экземпляров, базовый размер плана и максимальный размер плана. 

## <a name="billing"></a>Выставление счетов

Выставление счетов за план Premium основано на количестве основных секунд и памяти, выделенной для каждого экземпляра. Выставление счетов отличается от плана потребления, за который взимается плата за выполнение и потребление памяти. Плата за выполнение плана Premium не взимается. По крайней мере один экземпляр должен быть выделен для каждого плана в любое время. Выставление счетов приводит к минимальным месячным затратам на активный план, независимо от того, активна или бездействует. Помните, что все приложения-функции в плане Premium совместно используют выделенные экземпляры. Дополнительные сведения см. на [странице с ценами на функции Azure](https://azure.microsoft.com/pricing/details/functions/).

## <a name="create-a-premium-plan"></a>Создание плана "Премиум"

При создании приложения-функции в портал Azure план потребления используется по умолчанию. Чтобы создать приложение-функцию, выполняемое в плане Premium, необходимо явно создать план службы приложений, используя один из номеров SKU _эластичного уровня Premium_ . Затем создаваемое приложение-функция размещается в этом плане. Портал Azure упрощает одновременное создание плана Premium и приложения функции. Вы можете запустить несколько приложений-функций в одном и том же плане Premium, но в большинстве случаев они работают в одной операционной системе (Windows или Linux). 

В следующих статьях показано, как создать приложение-функцию с помощью плана Premium либо программно, либо в портал Azure:

+ [Портал Azure](create-premium-plan-function-app-portal.md)
+ [Azure CLI](scripts/functions-cli-create-premium-plan.md)
+ [Шаблон Azure Resource Manager](functions-infrastructure-as-code.md#deploy-on-premium-plan)

## <a name="eliminate-cold-starts"></a>Устранение холодного запуска

Если в плане потребления не происходит событий или выполнений, приложение может масштабироваться до нулевых экземпляров. При поступлении новых событий в него должен быть специализирован новый экземпляр с выполняемым приложением. Специализация новых экземпляров может занять некоторое время в зависимости от приложения. Эта дополнительная задержка при первом вызове часто называется _холодный запуском_ приложения.

План "Премиум" предоставляет две функции, которые совместно позволяют эффективно устранять холодный запуск в ваших функциях: _всегда готовые экземпляры_ и _предварительно_ заданные экземпляры. 

### <a name="always-ready-instances"></a>Всегда готовые экземпляры

В плане "Премиум" приложение можно всегда подготовить к заданному количеству экземпляров. Максимальное число экземпляров всегда готовности — 20. Когда события начинают запускать приложение, они сначала направляются в экземпляры Always Ready. По мере активации функции дополнительные экземпляры будут заключаться в буфер. Этот буфер предотвращает холодный запуск для новых экземпляров, необходимых во время масштабирования. Эти буферизованные экземпляры называются [предварительно](#pre-warmed-instances)заданными экземплярами. Благодаря сочетанию готовых экземпляров Always и предварительно загруженного буфера приложение может эффективно исключить холодный запуск.

> [!NOTE]
> Каждый план Premium имеет по крайней мере один активный (оплачивается) экземпляр в любое время.

# <a name="portal"></a>[Портал](#tab/portal)

Вы можете настроить количество всегда готовых экземпляров в портал Azure, выбрав **приложение-функция**, перейдите на вкладку **функции платформы** и выберите параметры **Scale out** . В окне Изменение приложения функции всегда готовые экземпляры относятся только к этому приложению.

![Параметры эластичного масштабирования](./media/functions-premium-plan/scale-out.png)

# <a name="azure-cli"></a>[Azure CLI](#tab/azurecli)

Вы также можете настроить для приложения всегда готовые экземпляры с Azure CLI.

```azurecli-interactive
az resource update -g <resource_group> -n <function_app_name>/config/web --set properties.minimumElasticInstanceCount=<desired_always_ready_count> --resource-type Microsoft.Web/sites
```
---

### <a name="pre-warmed-instances"></a>Предварительно заданный экземпляр

Предварительно подготовленные экземпляры являются экземплярами, которые загружаются в буфер во время событий масштабирования и активации. Предварительно зарезервированные экземпляры продолжают работать в буфере до достижения максимального предела масштабирования. Число предварительно зарезервированных экземпляров по умолчанию равно 1, и в большинстве случаев это значение должно оставаться равным 1.

Если в приложении есть длительное прогревное приложение (например, пользовательский образ контейнера), может потребоваться увеличить этот буфер. Предварительно запущенный экземпляр активируется только после того, как все активные экземпляры будут достаточно использованы.

Рассмотрим этот пример того, как готовые экземпляры и предварительно подготовленные экземпляры работают вместе. В приложении-функции уровня "Премиум" настроено пять готовых экземпляров, и по умолчанию используется один предварительно заданный экземпляр. Когда приложение бездействует и события не запускаются, приложение подготавливается и выполняется с пятью экземплярами. В настоящее время вы не оплачиваете предварительный экземпляр, так как экземпляры, которые всегда готовы к использованию, не используются, а предварительно не выделены экземпляры.

Как только первый триггер поступает в, все пять готовых экземпляров становятся активными и выделяется предварительно заданный экземпляр. Теперь приложение работает с шестью подготовленными экземплярами: пять готовых экземпляров всегда готово и шестой предварительно заданный и неактивный буфер. Если частота выполнения по мере роста возрастает, то в конечном итоге используются пять активных экземпляров. Когда платформа принимает решение о масштабировании за пределами пяти экземпляров, она масштабируется до заранее подготовленного экземпляра. В этом случае теперь у вас шесть активных экземпляров, и седьмой экземпляр мгновенно подготавливаются и заполняется готовый буфер. Эта последовательность масштабирования и предварительного прогрева сохраняется до тех пор, пока не будет достигнуто максимальное число экземпляров для приложения. Ни один экземпляр не был предварительно отключен или не активирован сверх максимального значения.

Число предварительно заданных экземпляров для приложения можно изменить с помощью Azure CLI.

```azurecli-interactive
az resource update -g <resource_group> -n <function_app_name>/config/web --set properties.preWarmedInstanceCount=<desired_prewarmed_count> --resource-type Microsoft.Web/sites
```

### <a name="maximum-function-app-instances"></a>Максимальное число экземпляров приложения функции

Помимо [счетчика максимальное число экземпляров плана](#plan-and-sku-settings), можно настроить максимум для каждого приложения. Максимальное число приложений можно настроить с помощью [ограничения масштабирования приложения](./event-driven-scaling.md#limit-scale-out).

## <a name="private-network-connectivity"></a>Подключение к частной сети

Приложения-функции, развернутые в плане Premium, могут воспользоваться преимуществами [интеграции с виртуальной сетью для приложений](../app-service/web-sites-integrate-with-vnet.md). При настройке приложение может взаимодействовать с ресурсами в виртуальной сети или защищено с помощью конечных точек службы. Ограничения IP-адресов также доступны в приложении для ограничения входящего трафика.

При назначении подсети для приложения-функции в плане Premium требуется подсеть с достаточной IP-адресацией для каждого возможного экземпляра. Для этого требуется блок IP-адресов, в котором по меньшей мере 100.

Дополнительные сведения см. в статье [интеграция приложения-функции с виртуальной](functions-create-vnet.md)сетью.

## <a name="rapid-elastic-scale"></a>Быстрое Эластичное масштабирование

Дополнительные расчетные экземпляры автоматически добавляются в приложение с использованием той же логики быстрого масштабирования, что и план потребления. Приложения в одном плане службы приложений масштабируются независимо друг от друга в зависимости от потребностей отдельного приложения. Однако приложения функций в одном плане службы приложений совместно используют ресурсы виртуальных машин, чтобы снизить затраты, когда это возможно. Число приложений, связанных с виртуальной машиной, зависит от объема каждого приложения и размера виртуальной машины.

Дополнительные сведения о том, как работает масштабирование, см. [в статье масштабирование на основе событий в функциях Azure](event-driven-scaling.md).

## <a name="longer-run-duration"></a>Длительность длительного выполнения

Использование функций Azure в плане потребления ограничено 10 минутами для одного выполнения. В плане Premium длительность выполнения по умолчанию составляет 30 минут, чтобы предотвратить неконтролируемые выполнения. Однако вы можете [изменить host.jsв конфигурации](./functions-host-json.md#functiontimeout) , чтобы сделать продолжительность без ограничений для приложений плана Premium. Если задано неограниченное время, приложение-функция гарантированно будет выполняться в течение не менее 60 минут. 

## <a name="plan-and-sku-settings"></a>Параметры плана и номера SKU

При создании плана существует два параметра размера плана: минимальное число экземпляров (или размер плана) и максимальное количество пакетов.

Если приложению требуются экземпляры за пределами готовых экземпляров, можно продолжить масштабирование до тех пор, пока количество экземпляров не достигнет максимального количества пакетов. Счет за экземпляры за пределами вашего плана выставляется только в том случае, если они выполняются и выделяются вам в течение секунды. Платформа предоставляет лучшие усилия при масштабировании приложения до заданного максимального предела.

Можно настроить размер и максимум для плана в портал Azure, выбрав параметры **Scale out** в плане или приложение-функцию, развернутое в этом плане (в разделе **функции платформы**).

Кроме того, можно увеличить максимальное число пакетов от Azure CLI:

```azurecli-interactive
az functionapp plan update -g <resource_group> -n <premium_plan_name> --max-burst <desired_max_burst>
```

Минимум для каждого плана будет по крайней мере один экземпляр. Фактическое минимальное количество экземпляров будет настроено на основе всегда готовых экземпляров, запрошенных приложениями в плане. Например, если приложение а запрашивает пять готовых экземпляров, а приложение б запрашивает два всегда готовых экземпляра в одном плане, минимальный размер плана будет вычисляться как пять. Приложение а будет выполняться на всех 5, а приложение б будет работать только на 2.

> [!IMPORTANT]
> За каждый экземпляр, выделенный в качестве минимального числа экземпляров, выставляются счета независимо от того, выполняются ли функции.

В большинстве случаев достаточно автоматически вычисляемого минимума. Тем не менее, масштабирование сверх минимального значения выполняется наилучшим образом. Возможно, хотя маловероятно, что в определенное время горизонтальное масштабирование может быть отложено, если дополнительные экземпляры недоступны. Установив минимальное значение, превышающее автоматически вычисленное минимальное значение, вы резервируете экземпляры перед горизонтальным масштабированием.

Увеличение вычисленного минимума для плана можно выполнить с помощью Azure CLI.

```azurecli-interactive
az functionapp plan update -g <resource_group> -n <premium_plan_name> --min-instances <desired_min_instances>
```

### <a name="available-instance-skus"></a>Номера SKU доступных экземпляров

При создании или масштабировании плана можно выбрать один из трех размеров экземпляра. Вам будет выставлен счет за общее количество ядер и подготовленной памяти в секунду, когда каждый экземпляр выделяется вам. Приложение может автоматически масштабироваться на несколько экземпляров по мере необходимости.

|SKU|Ядра|Память|Память|
|--|--|--|--|
|EP1|1|3,5 ГБ|Гбайт|
|EP2|2|7 ГБ|Гбайт|
|EP3|4|14 ГБ|Гбайт|

### <a name="memory-usage-considerations"></a>Рекомендации по использованию памяти

Выполнение на компьютере с большим объемом памяти не всегда означает, что приложение-функция использует всю доступную память.

Например, приложение-функция JavaScript ограничено ограничением памяти по умолчанию в Node.js. Чтобы увеличить этот фиксированный предел памяти, добавьте параметр приложения `languageWorkers:node:arguments` со значением `--max-old-space-size=<max memory in MB>` .

А для планов с объемом памяти более 4 ГБ убедитесь, что для параметра платформа разрядности задано значение `64 Bit` в разделе [Общие параметры](../app-service/configure-common.md#configure-general-settings).

## <a name="region-max-scale-out"></a>Максимальный Scale Out региона

Ниже приведены максимальные значения, которые поддерживаются в настоящее время для одного плана в каждом регионе и конфигурации ОС. Чтобы запросить увеличение, можно открыть запрос в службу поддержки.

См. полную региональную доступность функций на [веб-сайте Azure](https://azure.microsoft.com/global-infrastructure/services/?products=functions).

|Регион| Windows | Linux |
|--| -- | -- |
|Центральная Австралия| 100 | Недоступно |
|Центральная Австралия 2| 100 | Недоступно |
|Восточная Австралия| 100 | 20 |
|Australia Southeast | 100 | 20 |
|Brazil South| 100 | 20 |
|Центральная Канада| 100 | 20 |
|Центральная часть США| 100 | 20 |
|Восточный Китай 2| 100 | 20 |
|Северный Китай 2| 100 | 20 |
|Восточная Азия| 100 | 20 |
|Восточная часть США | 100 | 20 |
|восточная часть США 2| 100 | 20 |
|Центральная Франция| 100 | 20 |
|Центрально-Западная Германия| 100 | Недоступно |
|Japan East| 100 | 20 |
|Западная Япония| 100 | 20 |
|Республика Корея, центральный регион| 100 | 20 |
|Республика Корея, южный регион| Недоступно | 20 |
|Центрально-северная часть США| 100 | 20 |
|Северная Европа| 100 | 20 |
|Восточная Норвегия;| 100 | 20 |
|Центрально-южная часть США| 100 | 20 |
|Южная Индия | 100 | Недоступно |
|Юго-Восточная Азия| 100 | 20 |
|Северная Швейцария| 100 | Недоступно |
|Западная Швейцария| 100 | Недоступно |
|южная часть Соединенного Королевства| 100 | 20 |
|западная часть Соединенного Королевства| 100 | 20 |
|US Gov (Аризона)| 100 | 20 |
|US Gov (Вирджиния)| 100 | 20 |
|Уснат Восток| 100 | Недоступно |
|Уснат Запад| 100 | Недоступно |
|Западная Европа| 100 | 20 |
|Западная Индия| 100 | 20 |
|центрально-западная часть США| 100 | 20 |
|Западная часть США| 100 | 20 |
|Западная часть США 2| 100 | 20 |

## <a name="next-steps"></a>Дальнейшие действия

> [!div class="nextstepaction"]
> [Общие сведения о вариантах размещения функций Azure](functions-scale.md)