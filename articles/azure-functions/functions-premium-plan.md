---
title: План ценовой категории "Премиум" решения "Функции Azure"
description: В этой статье приводятся сведения и параметры конфигурации (виртуальная сеть, отсутствие холодного запуска, неограниченная продолжительность выполнения) для плана ценовой категории "Премиум" решения "Функции Azure".
author: jeffhollan
ms.topic: conceptual
ms.date: 08/28/2020
ms.author: jehollan
ms.custom:
- references_regions
- fasttrack-edit
- devx-track-azurecli
ms.openlocfilehash: 3061329ad9dcb368dab586acc2146e6fb4e23028
ms.sourcegitcommit: f28ebb95ae9aaaff3f87d8388a09b41e0b3445b5
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/29/2021
ms.locfileid: "101708719"
---
# <a name="azure-functions-premium-plan"></a>План ценовой категории "Премиум" решения "Функции Azure"

План Функций Azure категории "Премиум" (иногда называемый эластичным планом "Премиум") является вариантом размещения для приложений-функций. С другими вариантами плана размещения можно ознакомиться в [статье о плане размещения](functions-scale.md).

Размещение в соответствии с планом "Премиум" предоставляет следующие преимущества для функций:

* Исключение холодного запуска благодаря постоянно "теплым" экземплярам
* Подключение к виртуальной сети.
* Неограниченная продолжительность выполнения с гарантированными 60 минутами.
* Размеры экземпляров класса "Премиум": одно ядро, два ядра и четыре базовых экземпляра.
* Более предсказуемые цены по сравнению с планом "Потребление".
* Распределение приложений с высокой плотностью для планов с несколькими приложениями-функциями.

При использовании плана "Премиум" экземпляры узла "Функции Azure" добавляются и удаляются динамически в зависимости от количества входящих событий, как и при [плане "Потребление"](consumption-plan.md). В рамках одного и того же плана "Премиум" можно развернуть несколько приложений-функций, и план позволяет настроить размер вычислительных экземпляров, базовый размер плана и максимальный размер плана. 

## <a name="billing"></a>Выставление счетов

Выставление счетов для плана "Премиум" основано на количестве секунд использования процессорных ядер и объема памяти, выделенной для каждого экземпляра. Выставление счетов отличается от плана "Потребление", в соответствии с которым плата взимается за выполнение и потребление памяти. По плану "Премиум" плата за выполнение не взимается. Для каждого плана в любое время должен быть выделен по крайней мере один экземпляр. Такой принцип выставления счетов приводит к минимизации месячных затрат по действующему плану, независимо от того, активна функция или бездействует. Следует учитывать, что все приложения-функции в плане "Премиум" используют выделенные экземпляры совместно. Дополнительные сведения см. на [странице цен для Функций Azure](https://azure.microsoft.com/pricing/details/functions/).

## <a name="create-a-premium-plan"></a>Создание плана "Премиум"

При создании приложения-функции на портале Azure по умолчанию используется план "Потребление". Чтобы создать приложение-функцию, которое работает по плану "Премиум", необходимо явно создать план службы приложений, используя один из номеров SKU уровня _Эластичный "Премиум"_ . Затем создаваемое приложение-функция размещается в этом плане. Портал Azure упрощает одновременное создание плана "Премиум" и приложения-функции. Вы можете запустить несколько приложений-функций в одном и том же плане "Премиум", но они должны работать на одной и той же операционной системе (Windows или Linux). 

В следующих статьях показано, как создать приложение-функцию с планом "Премиум": либо программно, либо на портале Azure:

+ [Портал Azure](create-premium-plan-function-app-portal.md)
+ [Azure CLI](scripts/functions-cli-create-premium-plan.md)
+ [Шаблон Azure Resource Manager](functions-infrastructure-as-code.md#deploy-on-premium-plan)

## <a name="eliminate-cold-starts"></a>Устранение холодного запуска

Если в плане потребления не происходит событий или выполнений, приложение может масштабироваться до экземпляров нулевого размера. При поступлении новых событий должен выделяться новый экземпляр с выполняемым приложением. Выделение новых экземпляров может занимать некоторое время в зависимости от приложения. Эта дополнительная задержка при первом вызове часто называется _холодным запуском_ приложения.

План "Премиум" обеспечивает предоставление двух функций, которые при совместной работе позволяют эффективно устранять холодный запуск в функциях: _постоянно готовые экземпляры_ и _предварительно подготовленные экземпляры_. 

### <a name="always-ready-instances"></a>Постоянно готовые экземпляры

В плане "Премиум" можно обеспечить постоянную готовность приложения на определенном количестве экземпляров. Максимальное число экземпляров с постоянной готовностью — 20. Когда события начинают запускать приложение, они сначала направляются в экземпляры с режимом постоянной готовности. По мере активации функции дополнительные экземпляры будут подготавливаться ("прогреваться") в качестве буферных. Этот буфер предотвращает холодный запуск для новых экземпляров, необходимых во время масштабирования. Эти буферизованные экземпляры называются [предварительно подготовленными экземплярами](#pre-warmed-instances). Благодаря сочетанию постоянно готовых экземпляров и предварительно подготовленного буфера для приложения можно действительно исключить холодный запуск.

> [!NOTE]
> В каждом плане "Премиум" в любое время имеется по крайней мере один активный (оплачиваемый) экземпляр.

# <a name="portal"></a>[Портал](#tab/portal)

Вы можете настроить количество постоянно готовых экземпляров на портале Azure: выберите пункт **Приложение-функция**, перейдите на вкладку **Функции платформы** и выберите параметры **Горизонтальное масштабирование (Scale out)** . В окне "Изменение приложения-функции" постоянно готовые экземпляры относятся только к этому приложению.

![Параметры эластичного масштабирования](./media/functions-premium-plan/scale-out.png)

# <a name="azure-cli"></a>[Azure CLI](#tab/azurecli)

Вы также можете настроить постоянно готовые экземпляры для приложения с помощью Azure CLI.

```azurecli-interactive
az resource update -g <resource_group> -n <function_app_name>/config/web --set properties.minimumElasticInstanceCount=<desired_always_ready_count> --resource-type Microsoft.Web/sites
```
---

### <a name="pre-warmed-instances"></a>Предварительно подготовленные экземпляры

Предварительно подготовленными экземплярами являются экземпляры, подготовленные в качестве буфера во время событий масштабирования и активации. Предварительно подготовленные экземпляры продолжают буферизироваться до достижения максимального предела масштабирования. Число предварительно подготовленных экземпляров по умолчанию равно 1, и в большинстве случаев это значение должно оставаться равным 1.

Если приложению требуется длительная подготовка (например, пользовательскому образу контейнера), может потребоваться увеличение этого буфера. Предварительно подготовленный экземпляр активируется только после того, как в надлежащем порядке будут использованы все активные экземпляры.

Рассмотрим следующий пример, иллюстрирующий то, как готовые экземпляры и предварительно подготовленные экземпляры работают вместе. В приложении-функции уровня "Премиум" настроено пять постоянно готовых экземпляров, и по умолчанию используется один предварительно подготовленный экземпляр. Когда приложение бездействует и нет событий, запускающих это приложение, для работы этому приложению предоставляется пять экземпляров. В это время оплата за предварительно подготовленный экземпляр не взимается, так как постоянно готовые экземпляры не используются, и ни одного предварительно подготовленного экземпляра не выделено.

Как только срабатывает первый триггер, все пять готовых экземпляров становятся активными и происходит выделение предварительно подготовленного экземпляра. Теперь приложение работает с шестью подготовленными экземплярами: пять постоянного готовых и активных в данное время экземпляров и шестой предварительно подготовленный и неактивный буферный экземпляр. Если показатель выполнения продолжает увеличиваться, то в конечном итоге будут использованы пять активных экземпляров. Когда платформа примет решение о масштабировании, превышающем пять экземпляров, она выполнит масштабирование с включением заранее подготовленного экземпляра. В таком случае в наличии будет шесть активных экземпляров, а седьмой экземпляр будет мгновенно выделен и помещен в буфер предварительной готовности. Эта последовательность масштабирования и предварительной подготовки продолжится до тех пор, пока не будет достигнуто максимальное число экземпляров, предусмотренных для приложения. Количество предварительно подготовленных или активированных экземпляров не превышает максимально допустимых значений.

Число предварительно подготовленных экземпляров для приложения можно изменить с помощью Azure CLI.

```azurecli-interactive
az resource update -g <resource_group> -n <function_app_name>/config/web --set properties.preWarmedInstanceCount=<desired_prewarmed_count> --resource-type Microsoft.Web/sites
```

### <a name="maximum-function-app-instances"></a>Максимальное количество экземпляров для приложения-функции

Помимо [максимального количества экземпляров по плану](#plan-and-sku-settings), можно настроить максимальное количество экземпляров для каждого приложения. Максимальное количество экземпляров для приложения можно настроить с помощью [ограничения масштабирования приложения](./event-driven-scaling.md#limit-scale-out).

## <a name="private-network-connectivity"></a>Подключение к частной сети

Работу приложений-функций, развернутых в плане "Премиум", можно оптимизировать посредством [интеграции с виртуальной сетью для веб-приложений](../app-service/web-sites-integrate-with-vnet.md). При соответствующей настройке приложение может взаимодействовать с ресурсами в виртуальной сети или быть защищенным с помощью конечных точек служб. Ограничение входящего трафика также доступно в приложении и реализуется через ограничения IP-адресов.

Приложению-функции в плане "Премиум" требуется для назначения подсеть с диапазоном IP-адресов, достаточным для подготовки каждого возможного экземпляра. Для этого требуется блок, в котором не менее 100 IP-адресов.

Дополнительные сведения см. в статье [Интеграция приложения-функции с виртуальной сетью](functions-create-vnet.md).

## <a name="rapid-elastic-scale"></a>Быстрое эластичное масштабирование

Дополнительные вычислительные экземпляры автоматически добавляются в приложение с использованием той же логики быстрого масштабирования, что и в плане "Потребление". Приложения в одном плане службы приложений масштабируются независимо друг от друга в соответствии с потребностями отдельного приложения. Однако приложения-функции в одном плане службы приложений совместно используют ресурсы виртуальных машин, чтобы снижать затраты, когда это возможно. Число приложений, связанных с виртуальной машиной, зависит от объема каждого приложения и размера виртуальной машины.

Дополнительные сведения о том, как реализуется масштабирование, см. в статье [Масштабирование на основе событий в Функциях Azure](event-driven-scaling.md).

## <a name="longer-run-duration"></a>Выполнение с увеличенной продолжительностью

Использование Функций Azure в плане "Потребление" ограничено 10 минутами для одного выполнения. В плане "Премиум" продолжительность выполнения по умолчанию составляет 30 минут, чтобы исключить появление неконтролируемых выполнений. Однако вы можете [изменить конфигурацию в файле host.json](./functions-host-json.md#functiontimeout), чтобы сделать эту продолжительность неограниченной для приложений плана "Премиум". При задании неограниченной продолжительности приложение-функция будет гарантированно выполняться в течение по меньшей мере 60 минут. 

## <a name="plan-and-sku-settings"></a>Параметры плана и номера SKU

Имеется два параметра, определяющих размер плана при его создании: минимальное число экземпляров (или размер плана) и предельно максимальное значение.

Если приложению потребуются экземпляры помимо постоянно готовых, можно продолжить масштабирование до тех пор, пока количество экземпляров не достигнет предельно максимального значения. Счет за экземпляры, превышающие размер вашего плана, начисляется на посекундной основе и только за период, пока эти экземпляры выполняются и выделяются вам. Платформа обеспечивает оптимальное функционирование при масштабировании приложения до заданного максимального предела.

Размер и максимальные значения для плана можно настроить на портале Azure заданием параметров **Горизонтальное масштабирование (Scale out)** в плане или настройкой приложения-функции, развернутого в этом плане (в разделе **Функции платформы**).

Кроме того, предельно максимальное значение можно увеличить с помощью Azure CLI:

```azurecli-interactive
az functionapp plan update -g <resource_group> -n <premium_plan_name> --max-burst <desired_max_burst>
```

Минимально для каждого плана выделяется по крайней мере один экземпляр. Фактическое минимальное количество экземпляров настраивается автоматически в соответствии с количеством постоянно готовых экземпляров, запрошенных приложениями в плане. Например, если приложение A запрашивает пять постоянно готовых экземпляров, а приложение B — два постоянно готовых экземпляра в этом же плане, в результате расчета в качестве минимального размера плана будет назначено пять экземпляров. Приложение A будет выполняться на всех 5 экземплярах, а приложение B будет работать только на 2 экземплярах.

> [!IMPORTANT]
> Оплата за каждый экземпляр, выделенный в составе минимально востребованного количества экземпляров, взимается независимо от того, выполняются на нем функции или нет.

В большинстве случаев автоматически рассчитанного количества экземпляров оказывается достаточно для работы. Тем не менее масштабирование сверх минимального значения выполняется для обеспечения оптимальной работы. Возможно, хотя и маловероятно, что в определенное время горизонтальное масштабирование может быть отложено, если дополнительные экземпляры недоступны. Установив минимальное значение, превышающее автоматически рассчитанное минимальное значение, вы можете зарезервировать экземпляры заранее перед горизонтальным масштабированием.

Увеличение рассчитанного минимального значения для плана можно выполнить с помощью Azure CLI.

```azurecli-interactive
az functionapp plan update -g <resource_group> -n <premium_plan_name> --min-instances <desired_min_instances>
```

### <a name="available-instance-skus"></a>Номера SKU доступных экземпляров

При создании или масштабировании плана можно выбрать один из трех размеров экземпляра. Счет выставляется за общее количество процессорных ядер и подготовленной памяти посекундно при выделении каждого экземпляра. Приложение может автоматически масштабироваться на несколько экземпляров по мере необходимости.

|номер SKU|Ядра|Память|Память|
|--|--|--|--|
|EP1|1|3,5 ГБ|250 ГБ|
|EP2|2|7 ГБ|250 ГБ|
|EP3|4|14 ГБ|250 ГБ|

### <a name="memory-usage-considerations"></a>Рекомендации по использованию памяти

Выполнение на машине с большим объемом памяти не всегда означает, что приложение-функция будет использовать всю доступную память.

Например, для приложения-функции JavaScript объем используемой памяти ограничен предельным значением, заданным по умолчанию в Node.js. Чтобы увеличить этот фиксированный предельный объем памяти, добавьте для приложения параметр `languageWorkers:node:arguments` со значением `--max-old-space-size=<max memory in MB>`.

А для планов с объемом памяти более 4 ГБ нужно проверить, чтобы для параметра разрядности платформы было задано значение `64 Bit` в разделе [Общие параметры](../app-service/configure-common.md#configure-general-settings).

## <a name="region-max-scale-out"></a>Максимальное горизонтальное масштабирование для региона

Ниже приведены максимальные значения горизонтального масштабирования, которые поддерживаются в настоящее время для одного плана в каждом регионе и каждой конфигурации ОС. Чтобы увеличить это значение, можно направить запрос в службу поддержки.

С полной доступностью Функций по регионам можно ознакомиться на [веб-сайте Azure](https://azure.microsoft.com/global-infrastructure/services/?products=functions).

|Регион| Windows | Linux |
|--| -- | -- |
|Центральная Австралия| 100 | Недоступно |
|Центральная Австралия 2| 100 | Недоступно |
|Восточная Австралия| 100 | 20 |
|Australia Southeast | 100 | 20 |
|Brazil South| 100 | 20 |
|Центральная Канада| 100 | 20 |
|Центральная часть США| 100 | 20 |
|Восточный Китай 2| 100 | 20 |
|Северный Китай 2| 100 | 20 |
|Восточная Азия| 100 | 20 |
|Восточная часть США | 100 | 20 |
|восточная часть США 2| 100 | 20 |
|Центральная Франция| 100 | 20 |
|Центрально-Западная Германия| 100 | Недоступно |
|Восточная Япония| 100 | 20 |
|Западная Япония| 100 | 20 |
|Республика Корея, центральный регион| 100 | 20 |
|Республика Корея, южный регион| Недоступно | 20 |
|Центрально-северная часть США| 100 | 20 |
|Северная Европа| 100 | 20 |
|Восточная Норвегия;| 100 | 20 |
|Центрально-южная часть США| 100 | 20 |
|Южная Индия | 100 | Недоступно |
|Юго-Восточная Азия| 100 | 20 |
|Северная Швейцария| 100 | Недоступно |
|Западная Швейцария| 100 | Недоступно |
|южная часть Соединенного Королевства| 100 | 20 |
|западная часть Соединенного Королевства| 100 | 20 |
|US Gov (Аризона)| 100 | 20 |
|US Gov (Вирджиния)| 100 | 20 |
|Восточная часть USNat| 100 | Недоступно |
|Западная часть USNat| 100 | Недоступно |
|Западная Европа| 100 | 20 |
|Западная Индия| 100 | 20 |
|центрально-западная часть США| 100 | 20 |
|западная часть США| 100 | 20 |
|Западная часть США 2| 100 | 20 |

## <a name="next-steps"></a>Дальнейшие действия

> [!div class="nextstepaction"]
> [Общие сведения о вариантах размещения Функций Azure](functions-scale.md)