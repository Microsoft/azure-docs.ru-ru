---
title: Обзор версий среды выполнения для решения "Функции Azure"
description: Решение "Функции Azure" поддерживает разные версии среды выполнения. В этой статье приводятся различия между ними и рекомендации по выбору подходящей для вас версии.
ms.topic: conceptual
ms.custom: devx-track-dotnet
ms.date: 12/09/2019
ms.openlocfilehash: b37cf33a96452f9f3e86f853d3d87fd3b4b3879c
ms.sourcegitcommit: ba676927b1a8acd7c30708144e201f63ce89021d
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/07/2021
ms.locfileid: "102431864"
---
# <a name="azure-functions-runtime-versions-overview"></a>Обзор версий среды выполнения для решения "Функции Azure"

Сейчас функции Azure поддерживают три версии хоста среды выполнения: 3. x, 2. x и 1. x. В рабочих сценариях поддерживаются все три версии.  

> [!IMPORTANT]
> Версия 1. x находится в режиме обслуживания и поддерживает только разработку на портал Azure, Azure Stack портале концентратора или локально на компьютерах Windows. Усовершенствования предоставляются только в более поздних версиях. 

В этой статье описаны некоторые различия между различными версиями, способы создания каждой версии и изменения версий.

## <a name="languages"></a>Языки

Начиная с версии 2. x, среда выполнения использует модель расширяемости языка, и все функции в приложении-функции должны использовать один и тот же язык. Язык функций в приложении-функции выбирается при создании приложения и сохраняется в параметре [ \_ \_ среды выполнения рабочих функций](functions-app-settings.md#functions_worker_runtime) . 

В следующей таблице перечислены языки программирования, которые в настоящее время поддерживаются для каждой версии среды выполнения.

[!INCLUDE [functions-supported-languages](../../includes/functions-supported-languages.md)]

## <a name="run-on-a-specific-version"></a><a name="creating-1x-apps"></a>Запуск в определенной версии

По умолчанию приложения функций, созданные в портал Azure и Azure CLI, имеют значение версии 3. x. При необходимости эту версию можно изменить. Версию среды выполнения можно понизить до версии 1. x после создания приложения функции, но перед добавлением каких бы то ни было функций.  Перемещение между 2. x и 3. x разрешено даже с приложениями, имеющими существующие функции. Перед перемещением приложения с существующими функциями из 2. x в 3. x следует учитывать все [критические изменения между 2. x и 3. x](#breaking-changes-between-2x-and-3x). 

Прежде чем вносить изменения в основную версию среды выполнения, необходимо протестировать существующий код, развернув его в другом приложении-функции, работающем в последней основной версии. Это тестирование помогает убедиться, что оно правильно работает после обновления. 

Переход на более раннюю версию с v3. x до версии v2. x не поддерживается. По возможности следует всегда запускать приложения в последней поддерживаемой версии среды выполнения функций. 

### <a name="changing-version-of-apps-in-azure"></a>Изменение версии приложений в Azure

Версия среды выполнения функций, используемая опубликованными приложениями в Azure, зависит от [`FUNCTIONS_EXTENSION_VERSION`](functions-app-settings.md#functions_extension_version) параметра приложения. Поддерживаются следующие основные значения версии среды выполнения:

| Значение | Целевой объект среды выполнения |
| ------ | -------- |
| `~3` | 3.x |
| `~2` | 2.x |
| `~1` | 1.x |

>[!IMPORTANT]
> Не меняйте этот параметр произвольно, так как могут потребоваться другие изменения параметров приложения и изменения кода функции.

Дополнительные сведения см. в инструкциях по [нацеливанию версий среды выполнения службы "Функции Azure"](set-runtime-version.md).  

### <a name="pinning-to-a-specific-minor-version"></a>Закрепление для определенной дополнительной версии

Чтобы устранить проблемы с приложением-функцией, выполняемым в последней основной версии, необходимо закрепить приложение к определенной дополнительной версии. Это дает вам время, чтобы приложение правильно выполнялось на последней основной версии. Способ закрепления во вспомогательной версии отличается от Windows и Linux. Дополнительные сведения см. в инструкциях по [нацеливанию версий среды выполнения службы "Функции Azure"](set-runtime-version.md).

Более старые промежуточные версии периодически удаляются из функций. Последние новости о выпусках функций Azure, включая удаление некоторых старых дополнительных версий, см. в статье [объявления службы приложений Azure](https://github.com/Azure/app-service-announcements/issues). 

### <a name="pinning-to-version-20"></a>Закрепление в версии ~ 2,0

Приложения-функции .NET, выполняющиеся в версии 2. x ( `~2` ), автоматически обновляются для работы в .NET core 3,1, которая является долгосрочной версией .NET Core 3. Выполнение функций .NET в .NET Core 3,1 позволяет воспользоваться новейшими обновлениями для системы безопасности и улучшениями продукта. 

Любое приложение функции закрепляется для `~2.0` работы в .NET Core 2,2, которое больше не получает безопасность и другие обновления. Дополнительные сведения см. в статье [рекомендации по функциям версии 2. x](functions-dotnet-class-library.md#functions-v2x-considerations).   

## <a name="migrating-from-2x-to-3x"></a>Миграция с 2. x на 3. x

Функции Azure версии 3. x имеют высокую обратную совместимость с версией 2. x.  Многие приложения должны иметь возможность безопасно выполнить обновление до 3. x без каких бы то ни было изменений кода.  При переходе на 3. x рекомендуется выполнять сложные тесты перед изменением основной версии в рабочих приложениях.

### <a name="breaking-changes-between-2x-and-3x"></a>Критические изменения между 2. x и 3. x

Ниже приведены изменения, которые следует учитывать перед обновлением приложения 2. x до 3. x.

#### <a name="javascript"></a>JavaScript

* Выходные привязки, назначенные с помощью `context.done` или возвращаемые значения, теперь ведут себя так же, как и параметр в `context.bindings` .

* Объект триггера таймера — это camelCase, а не PascalCase

* Функции, активируемые концентратором событий с `dataType` двоичными данными, получают массив `binary` вместо `string` .

* Полезные данные HTTP-запроса больше не могут быть доступны через `context.bindingData.req` .  Доступ к нему по-прежнему можно получить в качестве входного параметра, `context.req` и в `context.bindings` .

* Node.js 8 больше не поддерживается и не будет выполняться в функциях 3. x.

#### <a name="net-core"></a>.NET Core

Основные различия между версиями при запуске функций библиотеки классов .NET — это среда выполнения .NET Core. Функции версии 2. x предназначены для работы в .NET Core 2,2, а версия 3. x предназначена для работы в .NET Core 3,1.  

* [Синхронные операции сервера по умолчанию отключены](/dotnet/core/compatibility/2.2-3.0#http-synchronous-io-disabled-in-all-servers).

* Критические изменения, появившиеся в .NET Core в [версии 3,1](/dotnet/core/compatibility/3.1) и [3,0](/dotnet/core/compatibility/3.0), не относятся к функциям, но могут по-прежнему повлиять на работу приложения.

>[!NOTE]
>Из-за поддержки проблем в .NET Core 2,2 приложения-функции, закрепленные в версии 2 ( `~2` ), по сути, работают на платформе .NET core 3,1. Дополнительные сведения см. в статье [режим совместимости функций v2. x](functions-dotnet-class-library.md#functions-v2x-considerations).

## <a name="migrating-from-1x-to-later-versions"></a>Переход с версии 1. x на более позднюю версию

Вы можете выбрать миграцию существующего приложения, написанного для использования среды выполнения версии 1. x, вместо этого использовать более новую версию. Большинство изменений, которые необходимо внести, связаны с изменениями в языковой среде выполнения, такими как изменения API C# между платформа .NET Framework 4,7 и .NET Core. Также нужно убедиться, что код и библиотеки совместимы с выбранными языковыми средами выполнения. И наконец, обязательно обратите внимание на все изменения в триггерах, привязках и функциях, указанные ниже. Для достижения наилучших результатов миграции следует создать новое приложение-функцию в новой версии и перенести существующий код функции версии 1. x в новое приложение.  

Хотя можно выполнить обновление на месте путем ручного обновления конфигурации приложения, переход от 1. x к более поздней версии включает некоторые критические изменения. Например, в C# объект отладки изменяется с `TraceWriter` на `ILogger` . Создание нового проекта версии 3. x начинается с обновленных функций на основе последних шаблонов версии 3. x.

### <a name="changes-in-triggers-and-bindings-after-version-1x"></a>Изменения в триггерах и привязках после версии 1. x

Начиная с версии 2. x, необходимо установить расширения для конкретных триггеров и привязок, используемых функциями в приложении. Единственное исключение — триггеры HTTP и таймера, для которых не требуется расширение.  Для получения дополнительной информации ознакомьтесь с разделом [Регистрация расширений привязки](./functions-bindings-register.md).

Существует также несколько изменений в *function.js* атрибутов функции или между версиями. Например, свойство `path` для концентратора событий теперь имеет атрибут `eventHubName`. Для получения ссылок на документацию для каждой привязки см. [таблицу существующих привязок](#bindings).

### <a name="changes-in-features-and-functionality-after-version-1x"></a>Изменения в функциях и функциях после версии 1. x

Некоторые функции были удалены, обновлены или заменены после версии 1. x. В этом разделе описаны изменения, которые отображаются в более поздних версиях после использования версии 1. x.

В версии 2.x внесены следующие изменения.

* Ключи для вызова конечных точек HTTP всегда хранятся в зашифрованном виде в хранилище BLOB-объектов Azure. В версии 1. x ключи хранились в хранилище файлов Azure по умолчанию. При обновлении приложения с версии 1.x до версии 2.x выполняется сброс существующих секретных данных, которые находятся в хранилище файлов.

* Среда выполнения версии 2.x не имеет встроенной поддержки для поставщиков веб-перехватчиков. Это изменение внесено для повышения производительности. Вы по-прежнему можете использовать HTTP-триггеры как конечные точки для веб-перехватчиков.

* Файл конфигурации узла (host.json) должен быть пустым или содержать строку `"version": "2.0"`.

* Чтобы улучшить наблюдение, панель мониторинга веб-заданий на портале, которая использовала этот [`AzureWebJobsDashboard`](functions-app-settings.md#azurewebjobsdashboard) параметр, заменяется Application Insights Azure, которая использует этот [`APPINSIGHTS_INSTRUMENTATIONKEY`](functions-app-settings.md#appinsights_instrumentationkey) параметр. Дополнительные сведения см. в разделе [Мониторинг функций Azure](functions-monitoring.md).

* Все функции в приложении-функции должны использовать один язык. При создании приложения-функции необходимо выбрать для приложения стек среды выполнения. Стек среды выполнения задается [`FUNCTIONS_WORKER_RUNTIME`](functions-app-settings.md#functions_worker_runtime) значением в параметрах приложения. Это требование добавлено для уменьшения занимаемого места и ускорения запуска. При локальной разработке также необходимо включить этот параметр в [файл local.settings.json](functions-run-local.md#local-settings-file).

* По умолчанию для функций в плане службы приложений устанавливается время ожидания 30 минут. Вы можете вручную снять это ограничение, изменив параметр [functionTimeout](functions-host-json.md#functiontimeout) в файле host.json.

* Ограничения параллелизма HTTP реализуются по умолчанию для функций плана потребления со значением по умолчанию 100 одновременных запросов на экземпляр. Его можно изменить в [`maxConcurrentRequests`](functions-host-json.md#http) параметре в host.jsдля файла.

* Из-за [ограничений .NET Core](https://github.com/Azure/azure-functions-host/issues/3414)поддержка функций сценария F # (. fsx) была удалена. Скомпилированные функции F# (.fs) по-прежнему поддерживаются.

* Для веб-перехватчиков триггера сетки событий формат URL-адреса изменен на `https://{app}/runtime/webhooks/{triggerName}`.

### <a name="locally-developed-application-versions"></a>Локально разработанные версии приложений

Вы можете внести следующие обновления в приложения для работы с приложениями, чтобы локально изменить целевые версии.

#### <a name="visual-studio-runtime-versions"></a>Версии среды выполнения Visual Studio

В Visual Studio вы выбираете версию среды выполнения при создании проекта. Инструменты функций Azure для Visual Studio поддерживают три основные версии среды выполнения. При отладке и публикации правильная версия применяется автоматически на основе настроек проекта. Параметры версии определяются в файле `.csproj` в следующих свойствах:

##### <a name="version-3x"></a>Версия 3.x

```xml
<TargetFramework>netcoreapp3.1</TargetFramework>
<AzureFunctionsVersion>v3</AzureFunctionsVersion>
```

> [!NOTE]
> Для функций Azure 3. x и .NET требуется `Microsoft.NET.Sdk.Functions` расширение по крайней мере `3.0.0` .

##### <a name="version-2x"></a>Версия 2.x

```xml
<TargetFramework>netcoreapp2.1</TargetFramework>
<AzureFunctionsVersion>v2</AzureFunctionsVersion>
```

##### <a name="version-1x"></a>Версия 1.x

```xml
<TargetFramework>net472</TargetFramework>
<AzureFunctionsVersion>v1</AzureFunctionsVersion>
```

###### <a name="updating-2x-apps-to-3x-in-visual-studio"></a>Обновление приложений 2. x до 3. x в Visual Studio

Можно открыть существующую функцию, предназначенную для 2. x, и перейти к 3. x, изменив `.csproj` файл и обновив значения, приведенные выше.  Visual Studio управляет версиями среды выполнения автоматически на основе метаданных проекта.  Однако это возможно, если вы никогда не создавали приложение 3. x, прежде чем в Visual Studio еще не будут созданы шаблоны и среда выполнения для 3. x на вашем компьютере.  Это может представлять собой сообщение об ошибке, например "не доступна среда выполнения функций, соответствующая версии, указанной в проекте".  Чтобы получить последние шаблоны и среду выполнения, ознакомьтесь с возможностями по созданию нового проекта функции.  При появлении страницы Выбор версии и шаблона подождите, пока Visual Studio не завершит выборку последних шаблонов. После того как будут доступны и отображены последние шаблоны .NET Core 3, можно запустить и отладить любой проект, настроенный для версии 3. x.

> [!IMPORTANT]
> Функции версии 3. x можно разрабатывать только в Visual Studio, если используется Visual Studio версии 16,4 или более поздней.

#### <a name="vs-code-and-azure-functions-core-tools"></a>Основные инструменты VS Code и Функций Azure

[Azure functions Core Tools](functions-run-local.md) используется для разработки из командной строки, а также с помощью [расширения функций Azure](https://marketplace.visualstudio.com/items?itemName=ms-azuretools.vscode-azurefunctions) для Visual Studio Code. Для разработки на базе версии 3. x установите версию 3. x основных средств. Для разработки версии 2. x требуется версия 2. x основных средств и т. д. Дополнительные сведения см. в разделе [Установка основных инструментов Функций Azure](functions-run-local.md#install-the-azure-functions-core-tools).

Для разработки в Visual Studio Code следует также изменить параметры пользователя, чтобы `azureFunctions.projectRuntime` соответствовал версии установленных инструментов.  Этот параметр также обновляет шаблоны и языки, используемые при создании приложения-функции.  Для создания приложений в `~3` необходимо обновить `azureFunctions.projectRuntime` параметр пользователя на `~3` .

![Параметр среды выполнения расширения функций Azure](./media/functions-versions/vs-code-version-runtime.png)

#### <a name="maven-and-java-apps"></a>Приложения Maven и Java

Вы можете перенести приложения Java с версии 2. x на 3. x, [установив версию 3. x основных средств](functions-run-local.md#install-the-azure-functions-core-tools) , необходимых для локального запуска.  Убедившись, что приложение правильно работает локально в версии 3. x, обновите файл приложения, `POM.xml` чтобы изменить `FUNCTIONS_EXTENSION_VERSION` значение параметра на `~3` , как показано в следующем примере:

```xml
<configuration>
    <resourceGroup>${functionResourceGroup}</resourceGroup>
    <appName>${functionAppName}</appName>
    <region>${functionAppRegion}</region>
    <appSettings>
        <property>
            <name>WEBSITE_RUN_FROM_PACKAGE</name>
            <value>1</value>
        </property>
        <property>
            <name>FUNCTIONS_EXTENSION_VERSION</name>
            <value>~3</value>
        </property>
    </appSettings>
</configuration>
```

## <a name="bindings"></a>Привязки

Начиная с версии 2. x среда выполнения использует новую [модель расширяемости привязки](https://github.com/Azure/azure-webjobs-sdk-extensions/wiki/Binding-Extensions-Overview) , которая предоставляет следующие преимущества:

* Поддержка сторонних расширений привязок.

* Разделение среды выполнения и привязок. Это изменение позволяет отдельно управлять версиями расширений привязок и выпускать эти расширения. Например, можно выполнить обновление до версии расширения на основе более новой версии базового пакета SDK.

* Менее ресурсоемкая среда выполнения, где в среде выполнения известны только используемые привязки и только они загружаются в нее.

За исключением триггеров HTTP и таймера, все привязки теперь необходимо вручную добавлять в проект приложения-функции или регистрировать на портале. Для получения дополнительной информации ознакомьтесь с разделом [Регистрация расширений привязки](./functions-bindings-expressions-patterns.md).

В следующей таблице перечислены поддерживаемые привязки для каждой версии среды выполнения.

[!INCLUDE [Full bindings table](../../includes/functions-bindings.md)]

[!INCLUDE [Timeout Duration section](../../includes/functions-timeout-duration.md)]

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения см. в следующих ресурсах:

* [Как программировать и тестировать функции Azure в локальной среде](functions-run-local.md)
* [Выбор целевых версий среды выполнения Функций Azure](set-runtime-version.md)
* [Заметки о выпуске](https://github.com/Azure/azure-functions-host/releases)
