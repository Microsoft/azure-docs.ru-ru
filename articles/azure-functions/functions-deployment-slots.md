---
title: Слоты развертывания функций Azure
description: Узнайте, как создавать и использовать слоты развертывания с помощью функций Azure.
author: craigshoemaker
ms.topic: conceptual
ms.date: 04/15/2020
ms.author: cshoe
ms.openlocfilehash: 2dbf7c31e6b0b40fa9dc2d59e86c0ecc731657e1
ms.sourcegitcommit: 24a12d4692c4a4c97f6e31a5fbda971695c4cd68
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/05/2021
ms.locfileid: "102172415"
---
# <a name="azure-functions-deployment-slots"></a>Слоты развертывания функций Azure

Слоты развертывания функций Azure позволяют приложению-функции запускать различные экземпляры, называемые "слотами". Слоты — это разные среды, предоставляемые через общедоступную конечную точку. Один экземпляр приложения всегда сопоставляется с рабочим слотом, и вы можете поменять экземпляры, назначенные слоту, по запросу. Приложения-функции, выполняемые в плане службы приложений, могут иметь несколько слотов, в то время как в рамках плана потребления допускается только один слот.

Ниже показано, как зависят функции подкачки слотов:

- Перенаправление трафика неэффективно; запросы не отбрасываются из-за переключения.
- Если во время переключения выполняется функция, выполнение продолжится, и следующие триггеры направляются в перенаправляемый экземпляр приложения.

> [!NOTE]
> В настоящее время слоты недоступны для плана потребления Linux.

## <a name="why-use-slots"></a>Зачем использовать слоты?

Использование слотов развертывания имеет ряд преимуществ. В следующих сценариях описываются распространенные способы использования слотов.

- **Разные среды для разных целей**. Использование разных слотов позволяет различать экземпляры приложений перед переключением на рабочую или промежуточный слот.
- Предварительная **Подготовка: развертывание** в слот, а не непосредственно в рабочую среду, позволяет подготовить приложение перед началом работы. Кроме того, использование слотов сокращает задержку для рабочих нагрузок, активируемых HTTP. Экземпляры загружаются перед развертыванием, что сокращает холодный запуск для вновь развернутых функций.
- **Простые резервные** варианты. После переключения в рабочее состояние слот с ранее подготовленным приложением теперь имеет предыдущее рабочее приложение. Если изменения, переставляемые в рабочий слот, не так, как вы планируете, можно немедленно отменить переключение, чтобы получить «последний удачный экземпляр» назад.

## <a name="swap-operations"></a>Операции переключения

Во время переключения один слот считается источником и другим целевым объектом. Исходный слот содержит экземпляр приложения, который применяется к целевому слоту. Следующие шаги гарантируют, что целевой слот не будет испытывать простои во время переключения.

1. **Применить параметры:** Параметры из целевого слота применяются ко всем экземплярам исходного слота. Например, к промежуточному экземпляру применяются параметры рабочей среды. К примененным параметрам относятся следующие категории:
    - Параметры приложения и строки подключения для [конкретного слота](#manage-settings) (если применимо)
    - Параметры [непрерывного развертывания](../app-service/deploy-continuous-deployment.md) (если включены)
    - Параметры [проверки подлинности службы приложений](../app-service/overview-authentication-authorization.md) (если включены)

1. **Ожидание перезагрузки и доступности:** Переключение ожидает завершения перезагрузки каждого экземпляра в слоте источника и должно быть доступно для запросов. Если какой либо экземпляр не перезапускается, операция переключения вернет все изменения в исходный слот и прекратит выполнение операции.

1. **Маршрутизация обновлений:** Если все экземпляры в исходном слоте успешно загружены, переключение правил маршрутизации завершается двумя слотами. После выполнения этого шага в целевом слоте (например, в рабочем слоте) приложение, которое ранее было перегревается в исходном слоте.

1. **Операция повтора:** Теперь, когда исходный слот имеет предварительно переставляемое приложение в целевом слоте, выполните ту же операцию, применив все параметры и перезапуская экземпляры для исходного слота.

Помните на следующие моменты.

- В любой момент операции переключения происходит инициализация переключенных приложений в исходном слоте. Целевой слот остается в сети во время подготовки исходного слота, независимо от того, успешно ли выполнено переключение.

- Чтобы переключить промежуточный слот на рабочий слот, убедитесь, что рабочий слот *всегда* является целевым слотом. Таким образом, операция переключения не влияет на рабочее приложение.

- Параметры, связанные с источниками событий и привязками, должны быть настроены в качестве [параметров слота развертывания](#manage-settings) *перед началом переключения*. Помечая их как «прикрепленные», вы гарантируете, что события и выходные данные будут направлены к нужному экземпляру.

## <a name="manage-settings"></a>Управление параметрами

Некоторые параметры конфигурации зависят от гнезда. Ниже перечислены параметры, которые изменяются при переключении слотов и остаются неизменными.

**Параметры для каждого слота**:

* Конечные точки публикации
* Имена личных доменов
* Не являющиеся общедоступными сертификаты и параметры TLS/SSL
* Настройки масштабирования
* Планировщики веб-заданий
* Ограничения IP-адресов
* Всегда включено
* Параметры диагностики
* Общий доступ к ресурсам независимо от источника (CORS)

**Параметры, не относящиеся к слоту**:

* Общие параметры, такие как версия платформы, 32/64-разрядная, веб-сокеты
* Параметры приложения (их также можно привязать к слоту)
* Строки подключения (их также можно привязать к слоту)
* Сопоставления обработчиков
* Открытые сертификаты
* Содержимое веб-заданий
* Гибридные подключения *
* Интеграция виртуальной сети *
* Конечные точки службы *
* Сеть доставки содержимого Azure *

Функции, отмеченные звездочкой (*), планируется отменять. 

> [!NOTE]
> Некоторые параметры приложения, применяемые к неизменяемым параметрам, также не меняются местами. Например, поскольку параметры диагностики не меняются, связанные параметры приложения, такие как `WEBSITE_HTTPLOGGING_RETENTION_DAYS` и, `DIAGNOSTICS_AZUREBLOBRETENTIONDAYS` также не меняются, даже если они не отображаются как параметры слота.
>

### <a name="create-a-deployment-setting"></a>Создание параметра развертывания

Параметры можно пометить как параметр развертывания, что сделает его «прикрепленным». Параметр закрепления не переключается на экземпляр приложения.

Если вы создаете параметр развертывания в одном слоте, обязательно создайте тот же параметр с уникальным значением в любом другом слоте, который участвует в замене. Таким образом, хотя значение параметра не меняется, имена параметров остаются согласованными между слотами. Согласованность имен гарантирует, что код не пытается получить доступ к параметру, определенному в одном слоте, но не к другому.

Чтобы создать параметр развертывания, выполните следующие действия.

1. Перейдите в раздел **слоты развертывания** в приложении функции и выберите имя слота.

    :::image type="content" source="./media/functions-deployment-slots/functions-navigate-slots.png" alt-text="Поиск слотов в портал Azure." border="true":::

1. Выберите **Конфигурация**, а затем выберите имя параметра, которое нужно прикрепить к текущему слоту.

    :::image type="content" source="./media/functions-deployment-slots/functions-configure-deployment-slot.png" alt-text="Настройте параметр приложения для слота в портал Azure." border="true":::

1. Выберите **параметр слот развертывания** и нажмите кнопку **ОК**.

    :::image type="content" source="./media/functions-deployment-slots/functions-deployment-slot-setting.png" alt-text="Настройте параметр слота развертывания." border="true":::

1. После того, как раздел настройки исчезнет, нажмите кнопку **сохранить** , чтобы сохранить изменения.

    :::image type="content" source="./media/functions-deployment-slots/functions-save-deployment-slot-setting.png" alt-text="Сохраните параметр слота развертывания." border="true":::

## <a name="deployment"></a>Развертывание

При создании слота слоты пусты. Для развертывания приложения в слот можно использовать любую из [поддерживаемых технологий развертывания](./functions-deployment-technologies.md) .

## <a name="scaling"></a>Масштабирование

Все слоты масштабируются на то же количество рабочих областей, что и рабочий слот.

- Для планов потребления слот масштабируется по мере масштабирования приложения функции.
- Для планов службы приложений приложение масштабируется до фиксированного числа рабочих ролей. Слоты работают на том же числе рабочих ролей, что и план приложения.

## <a name="add-a-slot"></a>Добавление слота

Добавить слот можно с помощью [интерфейса командной строки](/cli/azure/functionapp/deployment/slot#az-functionapp-deployment-slot-create) или портала. Ниже показано, как создать новый слот на портале.

1. Перейдите к приложению функции.

1. Выберите **слоты развертывания** и щелкните **+ Добавить слот**.

    :::image type="content" source="./media/functions-deployment-slots/functions-deployment-slots-add.png" alt-text="Добавление слота развертывания функций Azure." border="true":::

1. Введите имя слота и нажмите кнопку **Добавить**.

    :::image type="content" source="./media/functions-deployment-slots/functions-deployment-slots-add-name.png" alt-text="Назовите слот развертывания функций Azure." border="true":::

## <a name="swap-slots"></a>Поменять местами слоты

Вы можете поменять местами слоты с помощью [интерфейса командной строки](/cli/azure/functionapp/deployment/slot#az-functionapp-deployment-slot-swap) или портала. Ниже показано, как поменять местами слоты на портале.

1. Перейдите к приложению-функции.
1. Выберите **слоты развертывания**, а затем щелкните **заменить**.

    :::image type="content" source="./media/functions-deployment-slots/functions-swap-deployment-slot.png" alt-text="Снимок экрана, на котором показана страница &quot;слот развертывания&quot; с выбранным действием &quot;добавить слот&quot;." border="true":::

1. Проверьте параметры конфигурации для переключения и выберите **Переключение** .
    
    :::image type="content" source="./media/functions-deployment-slots/azure-functions-deployment-slots-swap-config.png" alt-text="Переключить слот развертывания." border="true":::

Операция может занять некоторое время, пока выполняется операция переключения.

## <a name="roll-back-a-swap"></a>Откат переключения

Если переключение приводит к ошибке или вы просто хотите отменить переключение, можно вернуться к начальному состоянию. Чтобы вернуться к состоянию до перекачки, выполните другую замену, чтобы отменить переключение.

## <a name="remove-a-slot"></a>Удаление слота

Вы можете удалить слот с помощью [интерфейса командной строки](/cli/azure/functionapp/deployment/slot#az-functionapp-deployment-slot-delete) или портала. Ниже показано, как удалить слот на портале.

1. Перейдите в раздел **слоты развертывания** в приложении функции и выберите имя слота.

    :::image type="content" source="./media/functions-deployment-slots/functions-navigate-slots.png" alt-text="Поиск слотов в портал Azure." border="true":::

1. Выберите команду **Удалить**.

    :::image type="content" source="./media/functions-deployment-slots/functions-delete-deployment-slot.png" alt-text="Снимок экрана, на котором показана страница &quot;Обзор&quot; с выбранным действием &quot;Удалить&quot;." border="true":::

1. Введите имя слота развертывания, который необходимо удалить, и нажмите кнопку **Удалить**.

    :::image type="content" source="./media/functions-deployment-slots/functions-delete-deployment-slot-details.png" alt-text="Удалите слот развертывания в портал Azure." border="true":::

1. Закройте панель подтверждение удаления.

    :::image type="content" source="./media/functions-deployment-slots/functions-deployment-slot-deleted.png" alt-text="Подтверждение удаления слота развертывания." border="true":::

## <a name="automate-slot-management"></a>Автоматизация управления слотами

С помощью [Azure CLI](/cli/azure/functionapp/deployment/slot)можно автоматизировать следующие действия для слота:

- [create](/cli/azure/functionapp/deployment/slot#az-functionapp-deployment-slot-create)
- [delete](/cli/azure/functionapp/deployment/slot#az-functionapp-deployment-slot-delete)
- [list](/cli/azure/functionapp/deployment/slot#az-functionapp-deployment-slot-list)
- [позиции](/cli/azure/functionapp/deployment/slot#az-functionapp-deployment-slot-swap)
- [Автоматическая замена](/cli/azure/functionapp/deployment/slot#az-functionapp-deployment-slot-auto-swap)

## <a name="change-app-service-plan"></a>Изменение плана службы приложений

С помощью приложения-функции, которое выполняется в рамках плана службы приложений, можно изменить базовый план службы приложений для слота.

> [!NOTE]
> Невозможно изменить план службы приложений слота в плане потребления.

Чтобы изменить план службы приложений для слота, выполните следующие действия.

1. Перейдите в раздел **слоты развертывания** в приложении функции и выберите имя слота.

    :::image type="content" source="./media/functions-deployment-slots/functions-navigate-slots.png" alt-text="Поиск слотов в портал Azure." border="true":::

1. В разделе **план службы приложений** выберите **изменить план службы приложений**.

1. Выберите план, до которого требуется выполнить обновление, или создайте новый план.

    :::image type="content" source="./media/functions-deployment-slots/azure-functions-deployment-slots-change-app-service-apply.png" alt-text="Измените план службы приложений в портал Azure." border="true":::

1. Щелкните **ОК**.

## <a name="limitations"></a>Ограничения

Слоты развертывания функций Azure имеют следующие ограничения.

- Количество слотов, доступных для приложения, зависит от плана. План потребления допускает только один слот развертывания. Дополнительные слоты доступны для приложений, работающих в рамках плана службы приложений.
- Переключение слота сбрасывает ключи для приложений с `AzureWebJobsSecretStorageType` параметром приложения, равным `files` .
- Слоты недоступны для плана потребления Linux.

## <a name="support-levels"></a>Уровни поддержки

Существует два уровня поддержки слотов развертывания.

- **Общая доступность (общедоступная версия)**: полностью поддерживается и утверждено для использования в рабочей среде.
- **Предварительная версия**: пока не поддерживается, но в будущем ожидается, что она будет доступна в общедоступном состоянии.

| План ОС и размещения           | Уровень поддержки     |
| ------------------------- | -------------------- |
| Использование Windows       | Общедоступная версия |
| Windows Premium           | Общедоступная версия  |
| Выделенные Windows         | Общедоступная версия |
| Использование Linux         | Не поддерживается          |
| Linux Premium             | Общедоступная версия  |
| Выделенные Linux           | Общедоступная версия |

## <a name="next-steps"></a>Дальнейшие действия

- [Технологии развертывания в функциях Azure](./functions-deployment-technologies.md)
