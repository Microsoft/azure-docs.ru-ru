---
title: Руководство по разработке функций Azure
description: Узнайте о концепциях и методах Функций Azure, необходимых для разработки функции в Azure, для всех языков программирования и привязок.
ms.assetid: d8efe41a-bef8-4167-ba97-f3e016fcd39e
ms.topic: conceptual
ms.date: 10/12/2017
ms.openlocfilehash: fdc898c02cfd20ecfdd72dece4fb1e92d803dbb0
ms.sourcegitcommit: d4734bc680ea221ea80fdea67859d6d32241aefc
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/14/2021
ms.locfileid: "100386906"
---
# <a name="azure-functions-developer-guide"></a>Руководство разработчиков Функций Azure
Некоторые из Функций Azure имеют ряд общих технических особенностей и компонентов вне зависимости от используемого языка или привязки. Прежде чем приступать к детальному изучению особенностей, характерных для определенного языка или привязки, ознакомьтесь с этими общими сведениями.

В этой статье предполагается, что вы уже прочли статью [Общие сведения о Функциях Azure](functions-overview.md).

## <a name="function-code"></a>Код функции
Ключевым элементом решения "Функции Azure" является *функция* . Функция состоит из двух важных частей: ваш код, написан на разных языках, и файл конфигурации function.json. Для компилируемых языков этот файл создается автоматически из заметки к вашему коду. Для сценарных языков вы должны предоставить файл конфигурации самостоятельно.

Файл function.json определяет триггер, привязки и другие параметры конфигурации функции. Каждая функция имеет только один триггер. В среде выполнения этот файл используется для определения событий, которые необходимо отслеживать, и способа передачи данных в выполнение функции и возвращения данных из него. Ниже приведен пример файла function.json.

```json
{
    "disabled":false,
    "bindings":[
        // ... bindings here
        {
            "type": "bindingType",
            "direction": "in",
            "name": "myParamName",
            // ... more depending on binding
        }
    ]
}
```

Дополнительные сведения см. в разделе [Основные понятия триггеров и привязок в Функциях Azure](functions-triggers-bindings.md).

В свойстве `bindings` указываются свойства триггеров и привязок. Каждая привязка имеет ряд общих параметров и некоторые параметры, характерные для данного типа привязки. Для каждой привязки требуются указанные ниже параметры.

| Свойство    | Значения | Type | Комментарии|
|---|---|---|---|
| тип  | Имя привязки.<br><br>Например, `queueTrigger`. | строка | |
| direction | `in`, `out`  | строка | Указывает, служит ли привязка для получения данных в функции или для отправки их из функции. |
| name | Идентификатор функции.<br><br>Например, `myQueue`. | строка | Имя, используемое для связанных данных в функции. Для C# это имя аргумента, а для JavaScript — ключ в списке ключей и значений. |

## <a name="function-app"></a>Приложение-функция
Приложение-функция предоставляет контекст выполнения в Azure, в котором выполняются функции. Таким образом, это единица развертывания и управления для ваших функций. Приложение-функция состоит из одной или нескольких независимых функций, которые управляются, развертываются и масштабируются вместе. Все функции в приложении-функции совместно используют один план ценообразования, метод развертывания и версию среды выполнения. Приложение-функцию можно рассматривать как способ упорядочения функций и совместного управления ими. Дополнительные сведения см. в разделе [Управление приложением-функцией](functions-how-to-use-azure-function-app-settings.md). 

> [!NOTE]
> Все функции в приложении-функции должны использовать один язык. Это не было обязательным в [предыдущих версиях](functions-versions.md) среды выполнения "Функции Azure".

## <a name="folder-structure"></a>Структура папок
[!INCLUDE [functions-folder-structure](../../includes/functions-folder-structure.md)]

Выше приведена структура папки по умолчанию (рекомендуемая) для приложения-функции. Если вы желаете изменить расположение файла кода функции, измените раздел `scriptFile` в файле _function.json_. Мы рекомендуем развертывать проект в приложение-функцию в Azure путем [развертывания пакета](deployment-zip-push.md). Вы также можете использовать имеющиеся средства, такие как [непрерывная интеграция и развертывание](functions-continuous-deployment.md) и Azure DevOps.

> [!NOTE]
> Если вы развертываете пакет вручную, убедитесь, что развертываете файл _host.json_ и папки функций непосредственно в папку `wwwroot`. Не включайте папку `wwwroot` в развертывания. В противном случае вы получите папки `wwwroot\wwwroot`.

#### <a name="use-local-tools-and-publishing"></a>Использование локальных инструментов и публикация
Приложения-функции можно разрабатывать и публиковать с помощью различных средств, включая [Visual Studio](./functions-develop-vs.md), [Visual Studio Code](./create-first-function-vs-code-csharp.md), [IntelliJ](./functions-create-maven-intellij.md), [Eclipse](./functions-create-maven-eclipse.md) и [Azure Functions Core Tools](./functions-develop-local.md). Дополнительные сведения см. в статье [Как программировать и тестировать Функции Azure в локальной среде](./functions-develop-local.md).

<!--NOTE: I've removed documentation on FTP, because it does not sync triggers on the consumption plan --glenga -->

## <a name="how-to-edit-functions-in-the-azure-portal"></a><a id="fileupdate"></a> Редактирование функций на портале Azure
Редактор функций на портале Azure позволяет обновлять файл *function.json* и файл кода для функции непосредственно на портале. Рекомендуется использовать его только для небольших изменений или для подтверждения концепции. Наиболее оптимальным способом является использование локального средства разработки, например, VS Code.

## <a name="parallel-execution"></a>Параллельное выполнение
Если однопотоковая среда выполнения функций не успевает обрабатывать активируемые события, она может вызывать функцию несколько раз в параллельном режиме.  Если для приложения-функции используется [план потребления](event-driven-scaling.md), это приложение может автоматически развертываться.  Каждый экземпляр приложения-функции, как при использовании плана потребления, так и при использовании обычного [плана размещения службы приложений](../app-service/overview-hosting-plans.md), может обрабатывать несколько параллельных вызовов функции с помощью нескольких потоков.  Максимальное количество одновременных вызовов функции в каждом экземпляре приложения-функции зависит от типа триггера и ресурсов, используемых функциями в приложении-функции.

## <a name="functions-runtime-versioning"></a>Управление версиями среды выполнения Функций

Версию среды выполнения Функций можно настроить с помощью параметра приложения `FUNCTIONS_EXTENSION_VERSION`. Например, значение "~ 3" указывает, что приложение функции будет использовать 3. x в качестве основной версии. Приложения функций обновляются до каждой новой дополнительной версии по мере их выпуска. Дополнительные сведения, в том числе инструкции по просмотру точной версии приложения-функции см. в статье [Выбор целевых версий среды выполнения Функций Azure](set-runtime-version.md).

## <a name="repositories"></a>Репозитории
Код функций Azure имеет вид открытого исходного кода и хранится в репозиториях GitHub:

* [Функции Azure](https://github.com/Azure/Azure-Functions)
* [Узел функций Azure](https://github.com/Azure/azure-functions-host/)
* [портал функций Azure;](https://github.com/azure/azure-functions-ux)
* [шаблоны функций Azure;](https://github.com/azure/azure-functions-templates)
* [Пакет SDK для веб-заданий Azure](https://github.com/Azure/azure-webjobs-sdk/)
* [Расширения пакета SDK для веб-заданий Azure](https://github.com/Azure/azure-webjobs-sdk-extensions/)

## <a name="bindings"></a>Привязки
В таблице ниже приведены все поддерживаемые привязки.

[!INCLUDE [dynamic compute](../../includes/functions-bindings.md)]

Проблемы с ошибками, поступающими от привязок? См. документацию по [кодам ошибок Функций Azure](functions-bindings-error-pages.md).


## <a name="connections"></a>Соединения

Проект функции ссылается на сведения о соединении по имени от поставщика конфигурации. Он не принимает напрямую сведения о подключении, позволяя изменять их в разных средах. Например, определение триггера может включать в себя `connection` свойство. Это может указывать на строку подключения, но нельзя задать строку подключения непосредственно в `function.json` . Вместо этого следует задать `connection` имя переменной среды, содержащей строку подключения.

Поставщик конфигурации по умолчанию использует переменные среды. Они могут быть заданы [параметрами приложения](./functions-how-to-use-azure-function-app-settings.md?tabs=portal#settings) при работе в службе "функции Azure" или в [локальном файле параметров](functions-run-local.md#local-settings-file) при локальной разработке.

### <a name="connection-values"></a>Значения соединения

Если имя соединения разрешается в одно точное значение, среда выполнения определяет значение как _строку подключения_, которая обычно включает секрет. Сведения о строке подключения определяются службой, к которой вы хотите подключиться.

Однако имя соединения также может ссылаться на коллекцию нескольких элементов конфигурации. Переменные среды можно рассматривать как коллекцию с помощью общего префикса, заканчивающегося двойными символами подчеркивания `__` . На эту группу можно ссылаться, задавая имя соединения этому префиксу.

Например, `connection` свойство для определения триггера большого двоичного объекта Azure может иметь значение `Storage1` . Если в качестве имени для свойства соединения не настроено ни одно строковое значение `Storage1` , будет `Storage1__serviceUri` использовано `serviceUri` свойство. Свойства соединения для каждой службы отличаются. Сведения о расширении, использующем подключение, см. в документации.

### <a name="configure-an-identity-based-connection"></a>Настройка подключения на основе удостоверений

Некоторые подключения в функциях Azure настроены на использование удостоверения, а не секрета. Поддержка зависит от расширения, использующего соединение. В некоторых случаях строка подключения по-прежнему может потребоваться в функциях, даже если служба, к которой выполняется подключение, поддерживает подключения на основе удостоверений.

> [!IMPORTANT]
> Даже если расширение привязки поддерживает подключения на основе удостоверений, такая конфигурация может не поддерживаться в плане потребления. См. таблицу поддержки ниже.

Подключения на основе удостоверений поддерживаются следующими модулями триггера и привязки:

| Имя расширения | версия расширения;                                                                                     | Поддерживает подключения на основе удостоверений в плане потребления |
|----------------|-------------------------------------------------------------------------------------------------------|---------------------------------------|
| Большой двоичный объект Azure     | [Версия 5.0.0-beta1 или более поздняя](./functions-bindings-storage-blob.md#storage-extension-5x-and-higher)  | Нет                                    |
| Очередь Azure    | [Версия 5.0.0-beta1 или более поздняя](./functions-bindings-storage-queue.md#storage-extension-5x-and-higher) | Нет                                    |

> [!NOTE]
> Поддержка подключений на основе удостоверений пока недоступна для подключений к хранилищу, используемых средой выполнения функций для основных поведений. Это означает, что `AzureWebJobsStorage` параметр должен быть строкой подключения.

#### <a name="connection-properties"></a>Свойства подключения

Подключение на основе удостоверений для службы Azure принимает следующие свойства:

| Свойство    | Переменная среды | Обязательный | Описание |
|---|---|---|---|
| URI службы | `<CONNECTION_NAME_PREFIX>__serviceUri` | Да | Универсальный код ресурса (URI) плоскости данных службы, к которой выполняется подключение. |

Для данного типа соединения могут поддерживаться дополнительные параметры. Ознакомьтесь с документацией по компоненту, который делает подключение.

При размещении в службе функций Azure для подключений на основе удостоверений используется [управляемое удостоверение](../app-service/overview-managed-identity.md?toc=%2fazure%2fazure-functions%2ftoc.json). Назначенное системой удостоверение используется по умолчанию. При выполнении в других контекстах, таких как локальная разработка, вместо этого используется удостоверение разработчика, хотя это можно настроить с помощью альтернативных параметров соединения.

##### <a name="local-development"></a>Локальная разработка

При локальном запуске описанная выше конфигурация сообщает среде выполнения о необходимости использовать локальное удостоверение разработчика. При подключении будет предпринята попытка получить маркер из следующих расположений в указанном порядке:

- Локальный кэш, совместно используемый приложениями Майкрософт
- Контекст текущего пользователя в Visual Studio
- Контекст текущего пользователя в Visual Studio Code
- Контекст текущего пользователя в Azure CLI

Если ни один из этих параметров не будет успешным, возникнет ошибка.

В некоторых случаях может потребоваться указать другое удостоверение. Можно добавить свойства конфигурации для подключения, которые указывают на альтернативное удостоверение.

> [!NOTE]
> Следующие параметры конфигурации не поддерживаются при размещении в службе "функции Azure".

Чтобы подключиться с помощью субъекта-службы Azure Active Directory с ИДЕНТИФИКАТОРом клиента и секретом, определите подключение со следующими свойствами:

| Свойство    | Переменная среды | Обязательный | Описание |
|---|---|---|---|
| URI службы | `<CONNECTION_NAME_PREFIX>__serviceUri` | Да | Универсальный код ресурса (URI) плоскости данных службы, к которой выполняется подключение. |
| Идентификатор клиента | `<CONNECTION_NAME_PREFIX>__tenantId` | Да | Идентификатор Azure Active Directory клиента (каталога). |
| Идентификатор клиента | `<CONNECTION_NAME_PREFIX>__clientId` | Да |  Идентификатор клиента (приложения) для регистрации приложения в клиенте. |
| Секрет клиента | `<CONNECTION_NAME_PREFIX>__clientSecret` | Да | Секрет клиента, созданный для регистрации приложения. |

#### <a name="grant-permission-to-the-identity"></a>Предоставление удостоверению разрешения

Любое используемое удостоверение должно иметь разрешения на выполнение предполагаемых действий. Обычно это делается путем назначения роли в Azure RBAC или указания удостоверения в политике доступа в зависимости от службы, к которой выполняется подключение. Дополнительные сведения о необходимых разрешениях и их настройке см. в документации по каждой службе.

> [!IMPORTANT]
> Некоторые разрешения могут предоставляться службой, которые не являются обязательными для всех контекстов. Там, где это возможно, придерживайтесь **принципа минимальных привилегий**, предоставляя удостоверению только необходимые привилегии. Например, если приложению нужно только считывать данные из большого двоичного объекта, используйте роль [считывателя данных BLOB-объекта хранилища](../role-based-access-control/built-in-roles.md#storage-blob-data-reader) , так как [владелец данных большого двоичного объекта хранилища](../role-based-access-control/built-in-roles.md#storage-blob-data-owner) включает в себя излишние разрешения для операции чтения.


## <a name="reporting-issues"></a>Создание отчетов о проблемах
[!INCLUDE [Reporting Issues](../../includes/functions-reporting-issues.md)]

## <a name="next-steps"></a>Следующие шаги
Дополнительные сведения см. в следующих ресурсах:

* [Azure Functions triggers and bindings (Триггеры и привязки в Функциях Azure)](functions-triggers-bindings.md)
* [Как программировать и тестировать функции Azure в локальной среде](./functions-develop-local.md)
* [Рекомендации по использованию функций Azure](functions-best-practices.md)
* [Справочник разработчика C# по функциям Azure](functions-dotnet-class-library.md)
* [Справочник по функциям Azure Node.js разработчиков](functions-reference-node.md)
