---
title: Масштабирование на основе событий в функциях Azure
description: Описание поведения масштабирования плана потребления и приложений функций плана Premium.
ms.date: 10/29/2020
ms.topic: conceptual
ms.service: azure-functions
ms.openlocfilehash: 8aca1ab6629f95ef9162e1247434bd3189d5a7d2
ms.sourcegitcommit: 910a1a38711966cb171050db245fc3b22abc8c5f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "97937752"
---
# <a name="event-driven-scaling-in-azure-functions"></a>Масштабирование на основе событий в функциях Azure

В планах потребления и Premium функции Azure масштабируют ресурсы ЦП и памяти, добавляя дополнительные экземпляры узла функций. Количество экземпляров определяется по числу событий, которые активируют функцию. 

Каждый экземпляр узла функций в плане потребления ограничен 1,5 ГБ памяти и одним ЦП.  Экземпляром узла является полное приложение-функция, означающее, что все функции в приложении-функции совместно используют ресурс в экземпляре и масштабируются в то же время. Приложения функций, которые совместно используют один и тот же масштаб плана потребления независимо друг от друга.  В плане Premium Размер плана определяет доступную память и ЦП для всех приложений в этом плане на этом экземпляре.  

Файлы кода функции хранятся в общих папках службы файлов Azure в основной учетной записи хранения функции. При удалении основной учетной записи хранения приложения-функции, файлы кода функции будут удалены без возможности восстановления.

## <a name="runtime-scaling"></a>Масштабирование среды выполнения

Решение "Функции Azure" использует компонент, называемый *контроллером масштабирования*, чтобы отслеживать скорость событий и определять, необходимо ли выполнять масштабирование. Контроллер масштабирования использует эвристику для каждого типа триггеров. Например, при использовании триггера хранилища очередей Azure масштабирование выполняется в зависимости от длины запроса и возраста самого старого сообщения в очереди.

Единицей масштабирования для функций Azure является приложение-функция. При масштабировании приложения-функции выделяются дополнительные ресурсы для выполнения нескольких экземпляров узла службы "Функции Azure". И наоборот, когда потребность в вычислительных ресурсах уменьшается, контроллер масштабирования удаляет экземпляры узла функции. Если в приложении-функции не выполняется ни одной функции, количество экземпляров в конечном итоге "масштабируется" в ноль.

![Мониторинг событий и создание экземпляров с помощью контроллера масштабирования](./media/functions-scale/central-listener.png)

## <a name="cold-start"></a>Холодный запуск

После бездействия приложения-функции в течение нескольких минут платформа может масштабировать количество экземпляров, на которых приложение работает, до нуля. В следующем запросе добавлена задержка масштабирования от нуля до единицы. Эта задержка называется _холодный запуском_. Количество зависимостей, необходимых для приложения функции, может повлиять на время холодного запуска. Холодный запуск — это больше проблем с синхронными операциями, такими как триггеры HTTP, которые должны возвращать ответ. Если холодный запуск влияет на ваши функции, рассмотрите возможность запуска в плане Premium или в выделенном плане с включенным параметром **Always on** .   

## <a name="understanding-scaling-behaviors"></a>Основные сведения о действиях при масштабировании

Масштабирование может зависеть от ряда факторов и выполняться по-разному в зависимости от выбранного триггера и языка. Существует несколько тонкостей поведения масштабирования, которые следует учитывать:

* **Максимальное число экземпляров:** Одно приложение-функция масштабируется до максимума в 200 экземпляров. Один экземпляр может обрабатывать одновременно более одного сообщения или запроса, поэтому для количества одновременных выполнений не установлено ограничение.  При необходимости можно [указать меньшее](#limit-scale-out) значение для регулирования масштаба.
* **Частота нового экземпляра:** Для триггеров HTTP новые экземпляры выделяются не чаще одного раза в секунду. Для триггеров, отличных от HTTP, новые экземпляры выделяются не чаще, чем каждые 30 секунд. Масштабирование выполняется быстрее при работе в [плане Premium](functions-premium-plan.md).
* **Эффективность масштабирования:** Для триггеров служебной шины используйте _Управление_ правами на ресурсы для наиболее эффективного масштабирования. При наличии прав _прослушивания_ масштабирование не так точное, поскольку длина очереди не может быть использована для информирования решений о масштабировании. Дополнительные сведения о настройке прав в политиках доступа служебной шины см. в разделе [Политика авторизации общего доступа](../service-bus-messaging/service-bus-sas.md#shared-access-authorization-policies). Сведения о триггерах концентратора событий см. в [руководстве по масштабированию](functions-bindings-event-hubs-trigger.md#scaling) в справочной статье. 

## <a name="limit-scale-out"></a>Ограничить масштабирование

Может потребоваться ограничить максимальное число экземпляров, которое приложение использует для масштабирования.  Это наиболее распространено в случаях, когда нисходящий компонент, например база данных, имеет ограниченную пропускную способность.  По умолчанию функции плана потребления масштабируются до 200 экземпляров, и функции плана Premium будут масштабироваться до уровня 100 экземпляров.  Можно указать более низкое значение для конкретного приложения, изменив его `functionAppScaleLimit` .  Для параметра `functionAppScaleLimit` может быть задано `0` `null` значение или для неограниченного значения, а для параметра `1` максимум приложения —.

```azurecli
az resource update --resource-type Microsoft.Web/sites -g <RESOURCE_GROUP> -n <FUNCTION_APP-NAME>/config/web --set properties.functionAppScaleLimit=<SCALE_LIMIT>
```

## <a name="best-practices-and-patterns-for-scalable-apps"></a>Рекомендации и шаблоны для масштабируемых приложений

Существует множество аспектов приложения-функции, которые влияют на его масштабирование, включая настройку узла, объем среды выполнения и эффективность ресурсов.  Дополнительные сведения см. в разделе [Рекомендации по масштабируемости](functions-best-practices.md#scalability-best-practices). Вам также следует учитывать поведение подключений при масштабировании приложения-функции. См. дополнительные сведения об [управлении подключениями в службе "Функции Azure"](manage-connections.md).

Дополнительные сведения о масштабировании в Python и Node.js см. в статье [Управление функциями Azure для разработчиков Python. масштабирование и параллелизм](functions-reference-python.md#scaling-and-performance) и [функции Azure Node.js руководств разработчика — масштабирование и параллелизм](functions-reference-node.md#scaling-and-concurrency).

## <a name="billing-model"></a>Модель выставления счетов

Сведения о выставлении счетов для разных планов подробно описаны на [странице цен на функции Azure](https://azure.microsoft.com/pricing/details/functions/). Использование вычисляется на уровне приложения-функции. При этом учитывается только время выполнения кода функции. Счета выставляются по следующим единицам:

* **Потребление ресурсов в гигабайтах в секунду (ГБ/с)**. Вычисляется как сочетание объема памяти и времени выполнения для всех функций, выполняемых в приложении-функции. 
* **Выполнения**. Вычисляются при каждом выполнении функции в ответ на событие.

Полезные запросы и сведения о том, как узнать счет о потреблении, можно найти [в статье вопросы и ответы по выставлению счетов](https://github.com/Azure/Azure-Functions/wiki/Consumption-Plan-Cost-Billing-FAQ).

[Azure Functions pricing page]: https://azure.microsoft.com/pricing/details/functions

## <a name="next-steps"></a>Дальнейшие действия

+ [Варианты размещения функций Azure](functions-scale.md)

