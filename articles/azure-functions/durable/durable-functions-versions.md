---
title: 'Обзор Устойчивые функции версий: функции Azure'
description: Дополнительные сведения о Устойчивые функции версиях.
author: cgillum
ms.topic: conceptual
ms.date: 12/23/2020
ms.author: azfuncdf
ms.openlocfilehash: c4d10bab06428295bbc8c5319bd47787d7b1fb34
ms.sourcegitcommit: 799f0f187f96b45ae561923d002abad40e1eebd6
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/24/2020
ms.locfileid: "97763376"
---
# <a name="durable-functions-versions-overview"></a>Обзор версий Устойчивые функции

*Устойчивые функции* являются расширением [Функций Azure](../functions-overview.md) и [веб-заданий Azure](../../app-service/webjobs-create.md), которое позволяет писать функции с отслеживанием состояния в безсерверной среде. Расширение управляет состоянием, создает контрольные точки и перезагружается. Если вы еще не знакомы с Устойчивые функции, см. [обзорную документацию](durable-functions-overview.md).

## <a name="new-features-in-2x"></a>Новые возможности в 2. x

В этом разделе описаны функции Устойчивые функции, добавленные в версии 2. x.

### <a name="durable-entities"></a>Устойчивые сущности

В Устойчивые функции 2. x мы предоставили новую концепцию [функций сущностей](durable-functions-entities.md) .

Функции сущностей определяют операции чтения и обновления мелких частей состояния, известных как *устойчивые сущности*. Как и функции оркестратора, функции сущностей — это функции с особым типом триггера, *триггером сущности*. В отличие от функций Orchestrator, функции сущностей не имеют конкретных ограничений кода. Функции сущностей также управляют состоянием явным образом, а не неявно представляют состояние с помощью потока управления.

Дополнительные сведения см. в статье о [устойчивых сущностях](durable-functions-entities.md) .

### <a name="durable-http"></a>Устойчивый протокол HTTP

В Устойчивые функции 2. x мы предоставили новую [устойчивую функцию HTTP](durable-functions-http-features.md#consuming-http-apis) , которая позволяет:

* Вызывайте API HTTP непосредственно из функций оркестрации (с некоторыми задокументированными ограничениями).
* Реализация автоматического опроса состояния HTTP 202 на стороне клиента.
* Встроенная поддержка [управляемых удостоверений Azure](../../active-directory/managed-identities-azure-resources/overview.md).

Дополнительные сведения см. в статье о [функциях HTTP](durable-functions-http-features.md#consuming-http-apis) .

## <a name="migrate-from-1x-to-2x"></a>Миграция с 1. x на 2. x

В этом разделе описано, как перенести существующую версию 1. x Устойчивые функции в версию 2. x, чтобы воспользоваться преимуществами новых функций.

### <a name="upgrade-the-extension"></a>Обновление расширения

Установите последнюю версию версии 2. x расширения привязок Устойчивые функции в проекте.

#### <a name="javascript-python-and-powershell"></a>JavaScript, Python и PowerShell

Устойчивые функции 2. x доступен в версии 2. x [пакета расширений функций Azure](../functions-bindings-register.md#extension-bundles).

Для поддержки Python в Устойчивые функции требуется Устойчивые функции 2. x.

Чтобы обновить версию пакета расширений в проекте, откройте host.jsна и обновите раздел, `extensionBundle` чтобы использовать версию 2. x ( `[2.*, 3.0.0)` ).

```json
{
    "version": "2.0",
    "extensionBundle": {
        "id": "Microsoft.Azure.Functions.ExtensionBundle",
        "version": "[2.*, 3.0.0)"
    }
}
```

> [!NOTE]
> Если после изменения версии пакета расширений Visual Studio Code не отображает нужные шаблоны, перезагрузите окно, запустив команду " *разработчик: перезагрузить окно* " (<kbd>Ctrl + r</kbd> в Windows и Linux, <kbd>Command + r</kbd> в macOS).

#### <a name="net"></a>.NET

Обновите проект .NET, чтобы использовать последнюю версию [расширения привязок устойчивые функции](https://www.nuget.org/packages/Microsoft.Azure.WebJobs.Extensions.DurableTask).

Дополнительные сведения см. в разделе [Регистрация расширений привязки функций Azure](../functions-bindings-register.md#local-csharp) .

### <a name="update-your-code"></a>Обновление кода

Устойчивые функции 2. x вводит несколько критических изменений. Приложения Устойчивые функции 1. x несовместимы с Устойчивые функции 2. x без изменений кода. В этом разделе перечислены некоторые изменения, которые необходимо внести при обновлении функций версии 1. x до 2. x.

#### <a name="hostjson-schema"></a>Host.jsсхемы

Устойчивые функции 2. x использует новую host.jsсхемы. Основные изменения из 1. x включают:

* `"storageProvider"` (и `"azureStorage"` подраздела) для конфигурации, относящейся к хранилищу.
* `"tracing"` для настройки трассировки и ведения журнала.
* `"notifications"` (и `"eventGrid"` подраздела) для конфигурации уведомлений сетки событий.

Дополнительные сведения см. в [Устойчивые функции host.jsсправочной документации](durable-functions-bindings.md#durable-functions-2-0-host-json) .

#### <a name="default-taskhub-name-changes"></a>Изменения имени таскхуб по умолчанию

В версии 1. x, если имя центра задач не было указано в host.js, оно было по умолчанию равно «Дураблефунктионшуб». В версии 2. x имя центра задач по умолчанию теперь является производным от имени приложения-функции. Поэтому, если вы не указали имя центра задач при обновлении до версии 2. x, ваш код будет работать с новым концентратором задач, и все согласованные в полете оркестрации больше не будут обрабатывать приложение. Чтобы обойти эту задачу, можно либо явно задать имя центра задач в версии v1. x по умолчанию ("Дураблефунктионшуб"), либо воспользоваться нашим [руководством по развертыванию без простоев](durable-functions-zero-downtime-deployment.md) для получения сведений об обработке критических изменений в оркестрации.

#### <a name="public-interface-changes-net-only"></a>Изменения открытого интерфейса (только .NET)

В версии 1. x различные объекты _контекста_ , поддерживаемые устойчивые функции, имеют абстрактные базовые классы, предназначенные для использования в модульном тестировании. В состав Устойчивые функции 2. x эти абстрактные базовые классы заменяются интерфейсами.

В следующей таблице представлены основные изменения.

| 1.x | 2.x |
|----------|----------|
| `DurableOrchestrationClientBase` | `IDurableOrchestrationClient` либо `IDurableClient` |
| `DurableOrchestrationContext` или `DurableOrchestrationContextBase` | `IDurableOrchestrationContext` |
| `DurableActivityContext` или `DurableActivityContextBase` | `IDurableActivityContext` |
| `OrchestrationClientAttribute` | `DurableClientAttribute` |

В случае, когда абстрактный базовый класс содержал виртуальные методы, эти виртуальные методы были заменены методами расширения, определенными в `DurableContextExtensions` .

#### <a name="functionjson-changes-javascript-and-c-script"></a>function.jsизменений (скрипт JavaScript и C#)

В Устойчивые функции 1. x привязка клиента оркестрации использует объект `type` из `orchestrationClient` . Вместо этого используется версия 2. x `durableClient` .

#### <a name="raise-event-changes"></a>Возвести изменения событий

В Устойчивые функции 1. x вызов API [события raise](durable-functions-external-events.md#send-events) и указание экземпляра, который не существовал, привело к автоматическому сбою. Начиная с 2. x, создание события для несуществующего оркестрации приводит к возникновению исключения.
