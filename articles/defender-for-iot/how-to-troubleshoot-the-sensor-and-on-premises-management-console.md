---
title: Устранение неполадок с датчиком и локальной консолью управления
description: Устраните неполадки, связанные с датчиком и локальной консолью управления.
author: shhazam-ms
manager: rkarlin
ms.author: shhazam
ms.date: 12/12/2020
ms.topic: article
ms.service: azure
ms.openlocfilehash: a57db4f88de4a3b32b4fb315fb331500f955d501
ms.sourcegitcommit: 8be279f92d5c07a37adfe766dc40648c673d8aa8
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/31/2020
ms.locfileid: "97843004"
---
# <a name="troubleshoot-the-sensor-and-on-premises-management-console"></a>Устранение неполадок с датчиком и локальной консолью управления

В этой статье описываются основные средства устранения неполадок для датчика и локальной консоли управления. В дополнение к описанным здесь элементам можно проверить работоспособность системы следующими способами.

**Оповещения**. предупреждение создается, когда интерфейс датчика, отслеживающий трафик, не работает. 

**SNMP**: Отслеживание работоспособности датчика осуществляется через SNMP. Служба "защитник Azure для Интернета вещей" реагирует на SNMP-запросы, отправленные с полномочного сервера мониторинга. 

**Системные уведомления**: когда консоль управления управляет датчиком, можно пересылать оповещения о неудачных резервных копиях датчика и отключенных датчиках.

## <a name="sensor-troubleshooting-tools"></a>Средства устранения неполадок датчика

### <a name="investigate-password-failure-at-initial-sign-in"></a>Проверка сбоя пароля при первоначальном входе в систему

При первом входе в систему с предварительно настроенным датчиком стрелок необходимо выполнить следующие действия по восстановлению пароля:

1. На экране входа в защитник для IoT выберите параметр **восстановления пароля** . 

   Откроется экран **восстановления паролей** . Вам будет предложено выбрать пользователя и подписку, и вы получите уникальный идентификатор.

1. Перейдите на страницу "защитник для **сайтов и датчиков** Интернета вещей" и выберите вкладку **Восстановление пароля** .

1. Введите уникальный идентификатор, полученный на экране **восстановления пароля** , и нажмите кнопку **восстановить**. `password_recovery.zip`Файл будет скачан.

   > [!NOTE]
   > Не изменяйте файл активации. Это подписанный файл, который не будет работать в случае его изменения.

1. На экране **восстановления пароля** отправьте `password_recovery.zip` файл и нажмите кнопку **Далее**.

Затем вы получите пароль, созданный системой для консоли управления. 

### <a name="investigate-a-lack-of-traffic"></a>Исследование недостатка трафика

Индикатор отображается в верхней части консоли, когда датчик распознает, что нет трафика по одному из настроенных портов. Этот индикатор видим для всех пользователей.

:::image type="content" source="media/how-to-troubleshoot-the-sensor-and-on-premises-management-console/no-traffic-detected.png" alt-text="Снимок экрана предупреждения о том, что трафик не обнаружен.":::
 
При появлении этого сообщения можно исследовать, где нет трафика. Убедитесь, что кабель span подключен и в архитектуре span изменений не было.  

Для получения сведений о поддержке и устранении неполадок обратитесь в службу [Служба поддержки Майкрософт](https://support.serviceshub.microsoft.com/supportforbusiness/create?sapId=82c88f35-1b8e-f274-ec11-c6efdd6dd099).

### <a name="check-system-performance"></a>Проверьте производительность системы. 

При развертывании нового датчика или, например, если датчик работает медленно или не отображает предупреждения, можно проверить производительность системы.

Чтобы проверить производительность системы, выполните следующие действия.

1. На панели мониторинга убедитесь, что `PPS > 0` .

   :::image type="content" source="media/how-to-troubleshoot-the-sensor-and-on-premises-management-console/dashboard-view-v2.png" alt-text="Снимок экрана примера панели мониторинга."::: 

2. В боковом меню выберите **устройства**.

3. Убедитесь, что в окне **устройства** обнаружены устройства.

    :::image type="content" source="media/how-to-troubleshoot-the-sensor-and-on-premises-management-console/discovered-devices.png" alt-text="Убедитесь, что устройства обнаружены.":::

4. В боковом меню выберите **интеллектуальный анализ данных**.

5. В окне **интеллектуальный анализ данных** выберите **все** и создайте отчет.

    :::image type="content" source="media/how-to-troubleshoot-the-sensor-and-on-premises-management-console/new-report-generated.png" alt-text="Создание нового отчета с помощью интеллектуального анализа данных.":::

6. Убедитесь, что отчет содержит данные.

    :::image type="content" source="media/how-to-troubleshoot-the-sensor-and-on-premises-management-console/new-report-generated.png" alt-text="Убедитесь, что отчет содержит данные.":::

7. В боковом меню выберите **тренды & статистики**.

8. В окне **тенденции & статистики** выберите **Добавить мини**-приложение.

    :::image type="content" source="media/how-to-troubleshoot-the-sensor-and-on-premises-management-console/add-widget.png" alt-text="Добавьте мини-приложение, выбрав его.":::

9. Добавьте мини-приложение и убедитесь, что оно отображает данные.

    :::image type="content" source="media/how-to-troubleshoot-the-sensor-and-on-premises-management-console/widget-data.png" alt-text="Убедитесь, что мини-приложение отображает данные.":::

10. В боковом меню выберите **оповещения**. Откроется окно **оповещения** .

11. Убедитесь, что оповещения созданы.

    :::image type="content" source="media/how-to-troubleshoot-the-sensor-and-on-premises-management-console/alerts-created.png" alt-text="Убедитесь, что оповещения созданы.":::


### <a name="investigate-a-lack-of-expected-alerts"></a>Исследование отсутствия ожидаемых оповещений

Если в окне **оповещения** не отображается ожидаемое предупреждение, проверьте следующее:

- Проверьте, отображается ли это предупреждение в окне " **оповещения** " в качестве реакции на другой экземпляр безопасности. Если да, и это предупреждение еще не обработано, консоль датчика не отображает новое оповещение.

- Убедитесь, что это предупреждение не было исключено с помощью правил **исключения предупреждений** в консоли управления. 

### <a name="investigate-widgets-that-show-no-data"></a>Исследование мини-приложений, которые не отображают данные

Когда мини-приложения в окне **тенденции & статистики** не отображают данные, выполните следующие действия.

- [Проверьте производительность системы](#check-system-performance).

- Убедитесь, что параметры времени и региона правильно настроены и не установлены в будущем. 

### <a name="investigate-a-device-map-that-shows-only-broadcasting-devices"></a>Исследование схемы устройств, отображающей только широковещательные устройства

Если устройства, отображаемые на карте, не подключены друг к другу, то может быть, что-то неверно в конфигурации порта SPAN. То есть вы можете видеть только широковещательные устройства и без одноадресного трафика.

:::image type="content" source="media/how-to-troubleshoot-the-sensor-and-on-premises-management-console/broadcasting-devices.png" alt-text="Просмотр устройств вещания.":::

В этом случае необходимо проверить, что вы видите только широковещательный трафик. Затем попросите инженера сети исправить конфигурацию порта SPAN, чтобы можно было видеть трафик одноадресной рассылки.

Чтобы убедиться, что вы видите только широковещательный трафик, выполните следующие действия.

- На экране **интеллектуальный анализ данных** создайте отчет с помощью параметра **все** . Затем проверьте, не появился ли в отчете широковещательный и многоадресный трафик (без одноадресного трафика).

Или сделайте так:

- Запишите ПКАП непосредственно из коммутатора или подключите портативный компьютер с помощью Wireshark.

### <a name="connect-the-sensor-to-ntp"></a>Подключение датчика к NTP

Для подключения к NTP-серверу можно настроить автономный датчик и консоль управления с датчиками, связанными с ним.

Чтобы подключить автономный датчик к NTP:

- [Обратитесь за помощью в службу поддержки](https://support.microsoft.com/en-us/supportforbusiness/productselection?sapId=82c88f35-1b8e-f274-ec11-c6efdd6dd099).

Чтобы подключить датчик, управляемый консолью управления, к NTP:

- Подключение к NTP настраивается в консоли управления. Все датчики, управляющие консолью управления, получают NTP-подключение автоматически.

### <a name="investigate-when-devices-arent-shown-on-the-map-or-you-have-multiple-internet-related-alerts"></a>Проверьте, не отображаются ли устройства на карте, или имеется несколько оповещений, связанных с Интернетом.

Иногда для устройств ICS настраиваются внешние IP-адреса. Эти устройства ICS не отображаются на карте. Вместо устройств на карте отображается Интернет — облако. IP-адреса этих устройств включены в облачный образ.

Еще одним указанием этой проблемы является отображение нескольких оповещений, связанных с Интернетом.

:::image type="content" source="media/how-to-troubleshoot-the-sensor-and-on-premises-management-console/alert-problems.png" alt-text="Несколько оповещений, связанных с Интернетом.":::

Чтобы исправить конфигурацию, выполните следующие действия.

1. Щелкните правой кнопкой мыши значок облака на карте устройств и выберите **Экспорт IP-адресов**. Скопируйте закрытые общедоступные диапазоны и добавьте их в список подсетей. Дополнительные сведения см. в разделе [Настройка подсетей](how-to-control-what-traffic-is-monitored.md#configure-subnets).

2. Создание нового отчета интеллектуального анализа данных для подключений к Интернету.

3. В отчете интеллектуального анализа данных выберите, :::image type="icon" source="media/how-to-troubleshoot-the-sensor-and-on-premises-management-console/administrator-mode.png" border="false"::: чтобы перейти в режим администратора и удалить IP-адреса ваших устройств ICS.

### <a name="tweak-the-sensors-quality-of-service"></a>Корректировка качества обслуживания датчика

Чтобы сохранить сетевые ресурсы, можно ограничить пропускную способность интерфейса, которую датчик использует для повседневных процедур.

Чтобы ограничить пропускную способность интерфейса, используйте `cyberx-xsense-limit-interface` средство CLI, которое должно выполняться с разрешениями sudo. Средство получает следующие аргументы:

  - `* -i`: интерфейсы (пример: eth0).

  - `* -l`: Limit (например: 30 Кбит/1 Мбит). Можно использовать следующие единицы пропускной способности: кбит/с, Мбит/с, Кбит, Мбит или bps.

  - `* -c`: Clear (для снятия ограничения пропускной способности интерфейса).

Чтобы настроить качество обслуживания, выполните следующие действия.

1. Войдите в CLI датчика как защитник для пользователя IoT и введите `sudo cyberx-xsense-limit-interface-I eth0 -l value` .

   Пример: `sudo cyberx-xsense-limit-interface -i eth0 -l 30kbit`

   > [!NOTE]
   > Для физического устройства используйте интерфейс em1.

2. Чтобы очистить ограничение интерфейса, введите `sudo cyberx-xsense-limit-interface -i eth0 -l 1mbps -c` .

## <a name="on-premises-management-console-troubleshooting-tools"></a>Средства устранения неполадок в локальной консоли управления

### <a name="investigate-a-lack-of-expected-alerts"></a>Исследование отсутствия ожидаемых оповещений

Если ожидаемое предупреждение не отображается в окне **оповещения** , проверьте следующее:

- Проверьте, отображается ли это предупреждение в окне " **оповещения** " в качестве реакции на другой экземпляр безопасности. Если да, и это предупреждение еще не обработано, новое предупреждение не отображается.

- Убедитесь, что это предупреждение не было исключено с помощью правил **исключения предупреждений** в локальной консоли управления.  

### <a name="tweak-the-quality-of-service"></a>Настройка качества обслуживания

Чтобы сохранить сетевые ресурсы, можно ограничить число предупреждений, отправляемых во внешние системы (например, сообщения электронной почты или SIEM) в рамках одной операции синхронизации между устройством и локальной консолью управления.

Число по умолчанию — 50. Это означает, что в одном сеансе связи между устройством и локальной консолью управления не будет более 50 предупреждений для внешних систем. 

Чтобы ограничить количество оповещений, используйте свойство, `notifications.max_number_to_report` доступное в `/var/cyberx/properties/management.properties` . После изменения этого свойства перезагрузка не требуется.

Чтобы настроить качество обслуживания, выполните следующие действия.

1. Войдите в систему как защитник для пользователя IoT. 

2. Проверьте значения по умолчанию:

   ```bash
   grep \"notifications\" /var/cyberx/properties/management.properties
   ```

   Отобразятся следующие значения по умолчанию:

   ```bash
   notifications.max_number_to_report=50
   notifications.max_time_to_report=10 (seconds)
   ```

3. Измените параметры по умолчанию.

   ```bash
   sudo nano /var/cyberx/properties/management.properties
   ```

4. Измените параметры следующих строк:

   ```bash
   notifications.max_number_to_report=50
   notifications.max_time_to_report=10 (seconds)
   ```

5. Сохраните изменения. Перезагрузка не требуется.

## <a name="export-information-for-troubleshooting"></a>Экспорт сведений для устранения неполадок

Помимо средств для мониторинга и анализа сети, вы можете отправить сведения в службу поддержки для дальнейшего изучения. При экспорте журналов датчик автоматически создает одноразовый пароль (OTP), уникальный для экспортируемых журналов, в отдельный текстовый файл. 

Для экспорта журналов выполните следующие действия.

1. На левой панели выберите **Параметры системы**.

2. Щелкните **Экспорт журналов**.

    :::image type="content" source="media/how-to-export-information-for-troubleshooting/export-a-log.png" alt-text="Экспортируйте журнал в системную поддержку.":::

3. В поле **имя файла** введите имя файла, которое будет использоваться для экспорта журнала. По умолчанию используется текущая дата.

4. Чтобы определить, какие данные необходимо экспортировать, выберите категории данных:  

    | Экспорт категории | Описание |
    |--|--|
    | **Журналы операционной системы** | Выберите этот параметр, чтобы получить сведения о состоянии операционной системы. |
    | **Журналы установки и обновления** | Выберите этот параметр для изучения параметров конфигурации установки и обновления. |
    | **Выходные данные работоспособности системы** | Выберите этот параметр, чтобы проверить производительность системы. |
    | **Журналы отсечения** | Выберите этот параметр, чтобы разрешить расширенную проверку в разделе "протокол". |
    | **Дампы ядра ОС** | Выберите этот параметр, чтобы экспортировать дамп памяти ядра. Дамп памяти ядра содержит всю память, используемую ядром во время проблемы, возникшей в этом ядре. Размер файла дампа меньше, чем полный дамп памяти. Как правило, файл дампа — это примерно один третий размер физической памяти в системе. |
    | **Пересылка журналов** | Выберите этот параметр для изучения правил пересылки. |
    | **Журналы SNMP** | Выберите этот параметр, чтобы получить сведения о проверке работоспособности SNMP. |
    | **Основные журналы приложений** | Выберите этот параметр, чтобы экспортировать данные о конфигурации и операции основного приложения. |
    | **Взаимодействие с журналами CM** | Выберите этот параметр, если имеются непрерывные проблемы или прерывания подключения к консоли управления. |
    | **Журналы веб-приложений** | Выберите этот параметр, чтобы получить сведения обо всех запросах, отправленных из веб-интерфейса приложения. |
    | **Резервное копирование системы** | Выберите этот параметр, чтобы экспортировать резервную копию всех системных данных для изучения точного состояния системы. |
    | **Статистика по разделам** | Выберите этот параметр, чтобы разрешить расширенную проверку статистики протокола. |
    | **Журналы базы данных** | Выберите этот параметр, чтобы экспортировать журналы из системной базы данных. Исследование системных журналов помогает выявить системные проблемы. |
    | **Конфигурация** | Выберите этот параметр, чтобы экспортировать сведения обо всех настраиваемых параметрах, чтобы убедиться, что все настроено правильно. |

5. Чтобы выбрать все параметры, щелкните **выбрать все** далее, чтобы выбрать **категории**.

6. Щелкните **Экспорт журналов**.

Экспортированные журналы добавляются в список **архивированные журналы** . Отправьте OTP команде поддержки в отдельном сообщении и среднем из экспортированных журналов. Группа поддержки сможет извлекать экспортированные журналы только с помощью уникального OTP, который используется для шифрования журналов.

Список архивных журналов может содержать до пяти элементов. Если число элементов в списке выходит за пределы этого числа, самый ранний элемент удаляется.

## <a name="see-also"></a>См. также раздел

- [Просмотр оповещений](how-to-view-alerts.md)

- [Настройка мониторинга SNMP MIB](how-to-set-up-snmp-mib-monitoring.md)

- [Общие сведения о событиях отключения датчика](how-to-manage-sensors-from-the-on-premises-management-console.md#understand-sensor-disconnection-events)
