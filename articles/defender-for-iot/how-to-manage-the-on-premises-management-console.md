---
title: Управление локальной консолью управления
description: Сведения о локальных параметрах консоли управления, таких как резервное копирование и восстановление, определение имени узла и настройка прокси-сервера для датчиков.
author: shhazam-ms
manager: rkarlin
ms.author: shhazam
ms.date: 1/12/2021
ms.topic: article
ms.service: azure
ms.openlocfilehash: 80dbad919e9446100bdeebb7cde71c147abfc8bc
ms.sourcegitcommit: fc23b4c625f0b26d14a5a6433e8b7b6fb42d868b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/17/2021
ms.locfileid: "98539350"
---
# <a name="manage-the-on-premises-management-console"></a>Управление локальной консолью управления

В этой статье рассматриваются локальные параметры консоли управления, такие как резервное копирование и восстановление, Загрузка файла активации устройства комитетов, обновление сертификатов и настройка прокси-сервера для датчиков.

Локальную консоль управления можно подключить из портал Azure.

## <a name="upload-an-activation-file"></a>Отправка файла активации

При первом входе в систему загружается файл активации для локальной консоли управления. Этот файл содержит совокупные зафиксированные устройства, которые определяются во время процесса адаптации. Список включает датчики, связанные с несколькими подписками.

После начальной активации число отслеживаемых устройств может превышать количество зафиксированных устройств, определенных во время адаптации. Это событие может произойти, например, при подключении дополнительных датчиков к консоли управления. При обнаружении несоответствия между числом отслеживаемых устройств и количеством зафиксированных устройств в консоли управления появляется предупреждение. При возникновении этого события следует передать новый файл активации.

Чтобы отправить файл активации, выполните следующие действия.

1. Перейдите на страницу **цен** на Azure Defender для IOT.
1. Выберите **скачать файл активации для вкладки консоль управления** . Загружается файл активации.

   :::image type="content" source="media/how-to-manage-sensors-from-the-on-premises-management-console/cloud_download_opm_activation_file.png" alt-text="Скачайте файл активации.":::

1. В консоли управления выберите **Параметры системы** .
1. Выберите **Активация**.
1. Выберите **выбрать файл** и выберите сохраненный файл.

## <a name="manage-certificates"></a>Управление сертификатами

После установки локальной консоли управления создается локальный самозаверяющий сертификат, который используется для доступа к веб-приложению консоли управления. Когда пользователи с правами администратора впервые входят в консоль управления, им предлагается предоставить сертификат SSL/TLS. Дополнительные сведения о настройке в первый раз см. [в разделе Активация и Настройка локальной консоли управления](how-to-activate-and-set-up-your-on-premises-management-console.md).

Следующие разделы содержат сведения об обновлении сертификатов, работе с командами интерфейса командной строки, а также о поддерживаемых сертификатах и параметрах сертификатов.

### <a name="about-certificates"></a>Сведения о сертификатах

Защитник Azure для Интернета вещей использует сертификаты SSL и TLS в следующих целях:

- Выполните требования к сертификату и шифрованию, запрошенные вашей организацией, загружая сертификат, подписанный ЦС.

- Разрешить проверку между консолью управления и подключенными датчиками, а также между консолью управления и консолью управления высокого уровня доступности. Проверка проверяется по списку отзыва сертификатов и дате окончания срока действия сертификата. *В случае сбоя проверки связь между консолью управления и датчиком прерывается, и в консоли появляется ошибка проверки*. Этот параметр включен по умолчанию после установки.

Правила переадресации сторонних производителей не проверяются. Примерами являются сведения о предупреждениях, отправляемые в SYSLOG, Splunk или ServiceNow; и связи с Active Directory.

#### <a name="ssl-certificates"></a>SSL-сертификаты

Защитник для датчика Интернета вещей и локальная консоль управления используют SSL и TLS-сертификаты для следующих функций: 

 - Обеспечьте безопасность обмена данными между пользователями и веб-консолью устройства. 
 
 - Безопасная связь с REST API на датчике и локальной консоли управления.
 
 - Обеспечьте безопасность обмена данными между датчиками и локальной консолью управления. 

После установки устройство создает локальный самозаверяющий сертификат, чтобы разрешить предварительный доступ к веб-консоли. Сертификаты Enterprise SSL и TLS можно установить с помощью [`cyberx-xsense-certificate-import`](#cli-commands) программы командной строки. 

 > [!NOTE]
 > Для интеграции и правил пересылки, в которых устройство является клиентом и инициатором сеанса, используются определенные сертификаты и они не связаны с системными сертификатами.  
 >
 >В таких случаях сертификаты обычно принимаются с сервера или используют асимметричное шифрование, где для настройки интеграции будет предоставлен конкретный сертификат. 

### <a name="update-certificates"></a>Обновление сертификатов

Пользователи с правами администратора локальной консоли управления могут обновлять сертификаты.

Чтобы обновить сертификат, выполните следующие действия.  

1. Выберите **Параметры системы**.

1. Выберите **сертификаты SSL/TLS**.
1. Удалите или измените сертификат и добавьте новый.
   
   - Добавьте имя сертификата.
   
   - Отправьте файл CRT и файл ключа и введите парольную фразу.
   - При необходимости отправьте файл PEM.

Чтобы изменить параметр проверки, выполните следующие действия.

1. Включите или выключите переключатель **включить проверку сертификата** .

1. Щелкните **Сохранить**.

Если параметр включен и проверка завершается неудачно, связь между консолью управления и датчиком прерывается и в консоли появляется ошибка проверки.

### <a name="certificate-support"></a>Поддержка сертификатов

Поддерживаются следующие сертификаты:

- Инфраструктура закрытых и корпоративных ключей (частная PKI)
 
- Инфраструктура открытых ключей (общедоступная PKI) 

- Локально создано на устройстве (локально самозаверяющий) 

  > [!IMPORTANT]
  > Не рекомендуется использовать самозаверяющие сертификаты. Этот тип соединения не является безопасным и должен использоваться только для тестовых сред. Так как владелец сертификата не может быть проверен и безопасность системы не поддерживается, самозаверяющие сертификаты никогда не следует использовать для рабочих сетей.

### <a name="supported-ssl-certificates"></a>Поддерживаемые SSL-сертификаты 

Поддерживаются следующие параметры: 

**CRT сертификата**

- Основной файл сертификата для доменного имени

- Алгоритм подписи = SHA256RSA
- Хэш-алгоритм подписи = SHA256
- Действителен с = допустимая прошедшая Дата
- Действителен до = допустимая дата в будущем
- Открытый ключ = RSA 2048 бит (минимум) или 4096 бит
- Точка распространения списка отзыва сертификатов = URL-адрес в файл. CRL
- Subject CN = URL, может быть универсальным сертификатом; Например, Sensor. contoso. <span> com или *. contoso. <span> -
- Subject (C) аунтри = определено, например, US
- Подразделение субъекта (OU) = определено; Например, Contoso Labs
- Subject (O) рганизатион = определен; Например, Contoso Inc

**Файл ключа**

- Файл ключа, созданный при создании CSR

- RSA 2048 бит (минимум) или 4096 бит

 > [!Note]
 > Использование длины ключа 4096bits:
 > - Подтверждение SSL в начале каждого соединения будет выполняться медленнее.  
 > - Во время подтверждения нагрузка на ЦП увеличивается. 

**Цепочка сертификатов**

- Промежуточный файл сертификата (если таковой имеется), предоставленный центром сертификации.

- Сертификат ЦС, выдавший сертификат сервера, должен быть первым в файле, за которым следуют все остальные, вплоть до корня. 
- Цепочка может включать атрибуты контейнера.

**Кодов**

- Поддерживается один ключ.

- Настройка при импорте сертификата.

Сертификаты с другими параметрами могут работать, но корпорация Майкрософт не поддерживает их.

#### <a name="encryption-key-artifacts"></a>Артефакты ключа шифрования

**. pem: файл контейнера сертификата**

Файлы Privacy Enhanced Mail (PEM) были общим типом файлов, используемым для защиты электронной почты. Настоящее время файлы PEM используются с сертификатами и используют ключи x509 в ASN1.  

Файл контейнера определяется в RFC 1421 до 1424, в формате контейнера, который может включать только общедоступный сертификат. Например, установка Apache, сертификат ЦС, файлы и т. д., SSL или сертификаты. Это может быть вся цепочка сертификатов, включая открытый ключ, закрытый ключ и корневые сертификаты.  

Он также может кодировать CSR в формате PKCS10, который можно преобразовать в PEM.

**. CERT. cer. CRT: файл контейнера сертификата**

`.pem`Или `.der` форматированный файл с другим расширением. Этот файл распознается проводником Windows как сертификат. `.pem`   Файл не распознается проводником Windows.

**. Key: файл закрытого ключа**

Файл ключа имеет тот же формат, что и PEM-файл, но имеет другое расширение. 

#### <a name="additional-commonly-available-key-artifacts"></a>Дополнительные часто доступные артефакты ключей

**. CSR — запрос подписи сертификата**.  

Этот файл используется для отправки в центры сертификации. Фактический формат — PKCS10, который определен в RFC 2986, и может включать некоторые или все основные сведения о запрошенном сертификате. Например, тема, Организация и штат. Это открытый ключ сертификата, который подписывается центром сертификации и возвращает сертификат.  

Возвращенный сертификат — это открытый сертификат, который включает открытый ключ, но не закрытый ключ. 

**. PKCS12. pfx. p12 — контейнер пароля**. 

Изначально было определено RSA в Public-Key криптографических стандартах (PKCS), то 12-вариант был изначально усовершенствован корпорацией Майкрософт, а затем отправлен как RFC 7292.  

Для этого формата контейнера требуется пароль, который содержит пары открытого и закрытого сертификатов. В отличие от `.pem`   файлов, этот контейнер полностью зашифрован.  

С помощью OpenSSL можно преобразовать файл в `.pem`   файл с открытыми и закрытыми ключами. `openssl pkcs12 -in file-to-convert.p12 -out converted-file.pem -nodes`  

**. der — двоично-закодированный PEM**.

Способ кодирования синтаксиса ASN. 1 в двоичном файле — это `.pem`   файл, который представляет собой только файл в кодировке Base64 `.der` . 

OpenSSL может преобразовать эти файлы в `.pem` :  `openssl x509 -inform der -in to-convert.der -out converted.pem` .  

Windows будет распознавать эти файлы как файлы сертификатов. По умолчанию Windows будет экспортировать сертификаты в виде `.der` форматированных файлов с другим расширением.

**. CRL — список отзыва сертификатов**.  

Центры сертификации создают их в качестве способа отмены авторизации сертификатов до истечения срока их действия. 

#### <a name="cli-commands"></a>Команды CLI

Используйте `cyberx-xsense-certificate-import` команду CLI для импорта сертификатов. Чтобы использовать это средство, необходимо отправить файлы сертификатов на устройство с помощью таких средств, как WinSCP или wget.

Команда поддерживает следующие входные флаги:

- `-h`: Показывает синтаксис справки командной строки.

- `--crt`: Путь к файлу сертификата (расширение CRT).

- `--key`:  \* . key. Длина ключа должна быть не менее 2 048 бит.

- `--chain`: Путь к файлу цепочки сертификатов (необязательно).

- `--pass`: Парольная фраза, используемая для шифрования сертификата (необязательно).

- `--passphrase-set`: Default = `False` , не используется. Задайте для значение, `True` чтобы использовать предыдущую парольную фразу, указанную в предыдущем сертификате (необязательно).

При использовании команды CLI:

- Убедитесь, что файлы сертификатов доступны для чтения на устройстве.

- Убедитесь, что доменное имя и IP-адрес в сертификате соответствуют конфигурации, запланированной ИТ-отделом.

### <a name="use-openssl-to-manage-certificates"></a>Использование OpenSSL для управления сертификатами

Управляйте своими сертификатами с помощью следующих команд:

| Описание | Команда CLI |
|--|--|
| Создание нового закрытого ключа и запроса подписи сертификата | `openssl req -out CSR.csr -new -newkey rsa:2048 -nodes -keyout privateKey.key` |
| Создание самозаверяющего сертификата | `openssl req -x509 -sha256 -nodes -days 365 -newkey rsa:2048 -keyout privateKey.key -out certificate.crt` |
| Создание запроса подписи сертификата (CSR) для существующего закрытого ключа | `openssl req -out CSR.csr -key privateKey.key -new` |
| Создание запроса подписи сертификата на основе существующего сертификата | `openssl x509 -x509toreq -in certificate.crt -out CSR.csr -signkey privateKey.key` |
| Удаление парольной фразы из закрытого ключа | `openssl rsa -in privateKey.pem -out newPrivateKey.pem` |

Если необходимо проверить сведения в сертификате, CSR или закрытом ключе, используйте следующие команды.

| Описание | Команда CLI |
|--|--|
| Проверка запроса подписи сертификата (CSR) | `openssl req -text -noout -verify -in CSR.csr` |
| Проверка закрытого ключа | `openssl rsa -in privateKey.key -check` |
| Проверка сертификата | `openssl x509 -in certificate.crt -text -noout`  |

Если вы получаете сообщение об ошибке, когда закрытый ключ не соответствует сертификату или сертификат, установленный на сайте, не является доверенным, используйте эти команды для исправления ошибки.

| Описание | Команда CLI |
|--|--|
| Проверьте хэш MD5 открытого ключа, чтобы убедиться, что он соответствует тому, что находится в CSR или закрытом ключе. | одного. `openssl x509 -noout -modulus -in certificate.crt | openssl md5` <br /> 2. `openssl rsa -noout -modulus -in privateKey.key | openssl md5` <br /> 3. `openssl req -noout -modulus -in CSR.csr | openssl md5 ` |

Чтобы преобразовать сертификаты и ключи в различные форматы, чтобы обеспечить их совместимость с конкретными типами серверов или программным обеспечением, используйте эти команды.

| Описание | Команда CLI |
|--|--|
| Преобразование DER-файла (. CRT. cer. der) в PEM  | `openssl x509 -inform der -in certificate.cer -out certificate.pem`  |
| Преобразование PEM-файла в DER-файл | `openssl x509 -outform der -in certificate.pem -out certificate.der`  |
| Преобразование файла PKCS # 12 (. pfx. p12), содержащего закрытый ключ и сертификаты, в PEM | `openssl pkcs12 -in keyStore.pfx -out keyStore.pem -nodes` <br />Можно добавить `-nocerts` только к выходному частному ключу или добавить `-nokeys` только к выводу сертификатов. |
| Преобразование файла сертификата PEM и закрытого ключа в PKCS # 12 (. pfx. p12) | `openssl pkcs12 -export -out certificate.pfx -inkey privateKey.key -in certificate.crt -certfile CACert.crt` |

## <a name="define-backup-and-restore-settings"></a>Определение параметров резервного копирования и восстановления

Резервное копирование локальной системы консоли управления выполняется автоматически, ежедневно. Данные сохраняются на другом диске. Расположение по умолчанию: `/var/cyberx/backups`. 

Этот файл можно автоматически переместить во внутреннюю сеть. 

> [!NOTE]
> Процедуру резервного копирования и восстановления можно выполнять только в той же версии. 

Чтобы создать резервную копию локального компьютера консоли управления, выполните следующие действия. 

- Войдите в учетную запись администратора и введите `sudo cyberx-management-backup -full` .

Чтобы восстановить последнюю версию файла резервной копии, выполните следующие действия.

- Войдите в учетную запись администратора и введите `$ sudo cyberx-management-system-restore` .

Чтобы сохранить резервную копию на внешнем сервере SMB, выполните следующие действия.

1. Создайте общую папку на внешнем SMB-сервере.  

   Получите путь к папке, имя пользователя и пароль, необходимые для доступа к серверу SMB. 

2. В защитнике для IoT создайте каталог для резервных копий:

   - `sudo mkdir /<backup_folder_name_on_ server>` 

   - `sudo chmod 777 /<backup_folder_name_on_c_server>/` 

3. Изменить fstab:  

   - `sudo nano /etc/fstab` 

   - `add - //<server_IP>/<folder_path> /<backup_folder_name_on_server> cifs rw,credentials=/etc/samba/user,vers=3.0,uid=cyberx,gid=cyberx,file_mode=0777,dir_mode=0777 0 0` 

4. Измените или создайте учетные данные для общего сервера SMB: 

   - `sudo nano /etc/samba/user` 

5. Добавьте следующие пакеты: 

   - `username=<user name>`

   - `password=<password>` 

6. Подключите каталог: 

   - `sudo mount -a` 

7. Настройте каталог резервного копирования для общей папки в локальной консоли управления в защитнике IoT:  

   - `sudo nano /var/cyberx/properties/backup.properties` 

   - `set Backup.shared_location to <backup_folder_name_on_server>`

## <a name="edit-the-host-name"></a>Изменение имени узла

Чтобы изменить имя узла консоли управления, настроенное на DNS-сервере организации, выполните следующие действия.

1. В левой области консоли управления выберите **Параметры системы**.  

2. В разделе Сетевые подключения консоли выберите **сеть**. 

3. Введите имя узла, настроенное в DNS-сервере организации. 

4. Щелкните **Сохранить**.

## <a name="define-vlan-names"></a>Определение имен виртуальных ЛС

Имена виртуальных ЛС не синхронизируются между датчиком и консолью управления. Необходимо определить идентичные имена для компонентов.

В области Сетевые подключения выберите **VLAN** и добавьте имена в обнаруженные ИДЕНТИФИКАТОРЫ виртуальной ЛС. Затем нажмите кнопку **Save** (Сохранить).

## <a name="define-a-proxy-to-sensors"></a>Определение прокси-сервера для датчиков

Повышение безопасности системы за счет предотвращения входа пользователя непосредственно в датчик. Вместо этого используйте туннелирование прокси-сервера, чтобы разрешить пользователям доступ к датчику из локальной консоли управления с одним правилом брандмауэра. Это расширение ограничивает возможность несанкционированного доступа к сетевой среде за пределами датчика.

Используйте прокси-сервер в средах, где нет прямого подключения к датчикам.

:::image type="content" source="media/how-to-access-sensors-using-a-proxy/proxy-diagram.png" alt-text="Нажат.":::

Следующая процедура подключает датчик к локальной консоли управления и включает туннелирование на этой консоли:

1. Войдите в локальную консоль управления CLI с помощью учетных данных администратора.

2. Введите `sudo cyberx-management-tunnel-enable` и нажмите клавишу **Ввод**.

4. Введите `--port 10000` и нажмите клавишу **Ввод**.

## <a name="adjust-system-properties"></a>Настройка системных свойств

Системные свойства управляют различными операциями и параметрами в консоли управления. Изменение или изменение этих файлов может повредить работу консоли управления. Перед изменением параметров обратитесь к [Служба поддержки Майкрософт](https://support.microsoft.com) .

Для доступа к свойствам системы: 

1. Войдите в локальную консоль управления или датчик.

2. Выберите **Параметры системы**.

3. В разделе **Общие** выберите **Свойства системы** .

## <a name="change-the-name-of-the-on-premises-management-console"></a>Изменение имени локальной консоли управления

Вы можете изменить имя локальной консоли управления. Новые имена отображаются в веб-браузере консоли, в различных окнах консоли и в журналах устранения неполадок. Имя по умолчанию — **консоль управления**.

Чтобы изменить имя:

1. В нижней части левой области выберите текущее имя.

   :::image type="content" source="media/how-to-change-the-name-of-your-azure-consoles/console-name.png" alt-text="Снимок экрана локальной версии консоли управления.":::

2. В диалоговом окне " **изменение конфигурации консоли управления** " введите новое имя. Имя не может содержать более 25 символов.

   :::image type="content" source="media/how-to-change-the-name-of-your-azure-consoles/edit-management-console-configuration.png" alt-text="Снимок экрана: изменение конфигурации защитника для платформы IoT.":::

3. Щелкните **Сохранить**. Будет применено новое имя.

   :::image type="content" source="media/how-to-change-the-name-of-your-azure-consoles/name-changed.png" alt-text="Снимок экрана, на котором показано измененное имя консоли.":::

## <a name="password-recovery"></a>Восстановление пароля

Восстановление пароля для локальной консоли управления связано с подпиской, к которой подключено устройство. Невозможно восстановить пароль, если неизвестно, к какой подписке подключено устройство.

Чтобы сбросить пароль, выполните следующие действия.

1. Перейдите на страницу входа в локальную консоль управления.
1. Выберите **Восстановление пароля**.
1. Скопируйте уникальный идентификатор.
1. Перейдите на страницу "защитник для **сайтов и датчиков** Интернета вещей" и выберите вкладку **Восстановление пароля** .
1. Введите уникальный идентификатор и нажмите кнопку **восстановить**. Загружается файл активации.
1. Перейдите на страницу **восстановления пароля** и отправьте файл активации.
1. Выберите **Далее**.
 
   Теперь у вас есть имя пользователя и новый пароль, созданный системой.

> [!NOTE]
> Датчик связан с подпиской, к которой она была изначально подключена. Пароль можно восстановить только с помощью той же подписки, к которой он подключен.

## <a name="update-the-software-version"></a>Обновление версии программного обеспечения

В следующей процедуре описывается, как обновить версию программного обеспечения локальной консоли управления. Процесс обновления займет около 30 минут.

1. Перейдите на [портал Azure](https://portal.azure.com/).

1. Перейдите в раздел "защитник для Интернета вещей".

1. Перейдите на страницу **обновления** .

1. Выберите версию из раздела локальная консоль управления.

1. Щелкните **Скачать** и сохраните файл.

1. Войдите в локальную консоль управления и выберите **Параметры системы** в боковом меню.

1. На панели **Обновление версии** выберите **Обновить**.

1. Выберите файл, скачанный на странице защитник для **обновлений** IOT.

## <a name="see-also"></a>См. также

[Управление датчиками из консоли управления](how-to-manage-sensors-from-the-on-premises-management-console.md)

[Управление отдельными датчиками](how-to-manage-individual-sensors.md)
