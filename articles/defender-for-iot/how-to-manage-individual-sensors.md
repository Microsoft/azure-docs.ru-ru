---
title: Управление отдельными датчиками
description: Узнайте, как управлять отдельными датчиками, включая Управление файлами активации, выполнение резервного копирования и обновление автономного датчика.
author: shhazam-ms
manager: rkarlin
ms.author: shhazam
ms.date: 01/10/2021
ms.topic: how-to
ms.service: azure
ms.openlocfilehash: 25f47be98b11f05ee6ac27018152ece05c0de4e4
ms.sourcegitcommit: 08458f722d77b273fbb6b24a0a7476a5ac8b22e0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/15/2021
ms.locfileid: "98246695"
---
# <a name="manage-individual-sensors"></a>Управление отдельными датчиками

В этой статье описывается, как управлять отдельными датчиками. Задачи включают управление файлами активации, выполнение резервного копирования и обновление автономного датчика.

Можно также выполнять определенные задачи управления датчиками из локальной консоли управления, где можно управлять несколькими датчиками одновременно.

Для адаптации и регистрации датчика используется портал Azure.

## <a name="manage-sensor-activation-files"></a>Управление файлами активации датчика

Ваш датчик был подключен к службе "защитник Azure для Интернета вещей" из портал Azure. Каждый датчик был подключен как датчик с локальным подключением или датчик, подключенный к облаку.

Для каждого развертываемого датчика загружается уникальный файл активации. Дополнительные сведения о том, когда и как использовать новый файл, см. в разделе [Отправка новых файлов активации](#upload-new-activation-files). Если не удается отправить файл, см. раздел [Устранение неполадок при отправке файла активации](#troubleshoot-activation-file-upload).

### <a name="about-activation-files-for-locally-connected-sensors"></a>Сведения о файлах активации для локально подключенных датчиков

Датчики, подключенные локально, связаны с подпиской Azure. Файл активации для локально подключенных датчиков содержит дату окончания срока действия. За один месяц до этой даты в верхней части консоли датчика появится предупреждающее сообщение. Предупреждение остается до тех пор, пока вы не обновите файл активации.

:::image type="content" source="media/how-to-manage-individual-sensors/system-setting-screenshot.png" alt-text="Снимок экрана параметров системы.":::

Вы можете продолжить работу с защитником для функций IoT, даже если срок действия файла активации истек. 

### <a name="about-activation-files-for-cloud-connected-sensors"></a>Сведения о файлах активации для датчиков, подключенных к облаку

Датчики, подключенные к облаку, связаны с защитником для центра Интернета вещей. Эти датчики не ограничиваются периодами времени для файла активации. Файл активации для датчиков, подключенных к облаку, используется для обеспечения соединения с защитником для центра Интернета вещей.

### <a name="upload-new-activation-files"></a>Отправка новых файлов активации

Может потребоваться передать новый файл активации для встроенного датчика, если:

- Срок действия файла активации истекает через датчик, подключенный локально. 

- Вы хотите работать в другом режиме управления датчика. 

- Вы хотите назначить новый защитник для центра Интернета вещей датчику, подключенному к облаку.

Чтобы добавить новый файл активации, выполните следующие действия.

1. Перейдите на страницу **Управление датчиками** .

2. Выберите датчик, для которого требуется отправить новый файл активации.

3. Удалите его.

4. Снова подключите датчик со страницы **адаптации** в новом режиме или с новым центром защитника для центра Интернета вещей.

5. Скачайте файл активации со страницы **скачать файл активации** .

6. Сохраните файл.

    :::image type="content" source="media/how-to-manage-individual-sensors/download-activation-file.png" alt-text="Скачайте файл активации из защитника для центра Интернета вещей.":::

7. Войдите в консоль "защитник для датчика IoT".

8. В консоли датчика выберите **Параметры системы** повторная  >  **Активация**.

    :::image type="content" source="media/how-to-manage-individual-sensors/reactivation.png" alt-text="Выбор повторной активации на экране параметров системы.":::

9. Выберите **Отправить** и выберите сохраненный файл.

    :::image type="content" source="media/how-to-manage-individual-sensors/upload-the-file.png" alt-text="Отправьте сохраненный файл.":::

10. Выберите **Активировать**.

### <a name="troubleshoot-activation-file-upload"></a>Устранение неполадок при отправке файла активации

Если не удалось отправить файл активации, появится сообщение об ошибке. Возможно, возникли следующие события:

- **Для локально подключенных датчиков**: недопустимый файл активации. Если файл недействителен, перейдите на портал защитника для Интернета вещей. На странице **Управление датчиками** выберите датчик с недопустимым файлом и Скачайте новый файл активации.

- **Для датчиков, подключенных к облаку**: датчик не может подключиться к Интернету. Проверьте конфигурацию сети датчика. Если датчику необходимо подключиться через веб-прокси для доступа к Интернету, убедитесь, что прокси-сервер настроен правильно на экране **Конфигурация сети датчика** . Убедитесь, что параметр \* . Azure-Devices.NET:443 разрешен в брандмауэре и (или) прокси-сервере. Если подстановочные знаки не поддерживаются или требуется более полный контроль, полное доменное имя для конкретного защитника центра Интернета вещей должно быть открыто в брандмауэре или прокси-сервере. Дополнительные сведения см. в разделе [Reference-Endpoints центра Интернета вещей](../iot-hub/iot-hub-devguide-endpoints.md).  

- **Для датчиков, подключенных к облаку**: файл активации допустим, но защитник для Интернета вещей отклонил его. Если не удается разрешить эту проблему, можно скачать еще одну активацию со страницы **Управление датчиками** защитника для портала IOT. Если это не поможет, обратитесь в служба поддержки Майкрософт.

## <a name="manage-certificates"></a>Управление сертификатами

После установки датчика создается локальный самозаверяющий сертификат, который используется для доступа к веб-приложению датчика. При первом входе в датчик пользователи с правами администратора получат запрос на предоставление сертификата SSL/TLS.  Дополнительные сведения о первом запуске программы установки см. [в разделе Вход и активация датчика](how-to-activate-and-set-up-your-sensor.md).

Эта статья содержит сведения об обновлении сертификатов, работе с командами интерфейса командной строки сертификатов, а также о поддерживаемых сертификатах и параметрах сертификатов.

### <a name="about-certificates"></a>Сведения о сертификатах

Защитник Azure для Интернета вещей использует сертификаты SSL/TLS для:

1. Выполните требования к сертификату и шифрованию, запрошенные вашей организацией, загружая сертификат, подписанный ЦС.

1. Разрешить проверку между консолью управления и подключенными датчиками, а также между консолью управления и консолью управления высокой доступностью. Проверки оцениваются на основе списка отзыва сертификатов и даты окончания срока действия сертификата. **Если проверка завершается неудачно, связь между консолью управления и датчиком останавливается и в консоли отображается ошибка проверки. Этот параметр включен по умолчанию после установки.**

 Правила переадресации сторонних производителей, например сведения об оповещениях, отправляемые в SYSLOG, Splunk или ServiceNow; или связь с Active Directory не проверяется.

### <a name="update-certificates"></a>Обновление сертификатов

Пользователи с правами администратора датчика могут обновлять сертификаты.

Чтобы обновить сертификат, выполните следующие действия.  

1. Выберите **Параметры системы**.
1. Выберите **сертификаты SSL/TLS.**
1. Удалите или измените сертификат и добавьте новый.
    - Добавьте имя сертификата.
    - Отправьте файл CRT и файл ключа и введите парольную фразу.
    - При необходимости отправьте файл PEM.

Чтобы изменить параметр проверки, выполните следующие действия.

1. Включите или отключите переключатель **включить проверку сертификата** .
1. Щелкните **Сохранить**.

Если параметр включен и проверка завершается неудачно, связь между консолью управления и датчиком останавливается и в консоли отображается ошибка проверки.

### <a name="certificate-support"></a>Поддержка сертификатов

Поддерживаются следующие сертификаты:

- Инфраструктура закрытых и корпоративных ключей (частная PKI) 
- Инфраструктура открытых ключей (общедоступная PKI) 
- Локально создано на устройстве (локально с самоподписанным). **Использовать самозаверяющие сертификаты не рекомендуется.** Это подключение *небезопасно* и должно использоваться только в тестовых средах. Владелец сертификата не может быть проверен, и безопасность системы поддерживаться не будет. Самозаверяющие сертификаты никогда не следует использовать для рабочих сетей.  

Поддерживаются следующие параметры. CRT сертификата

- Основной файл сертификата для доменного имени
- Алгоритм подписи = SHA256RSA
- Хэш-алгоритм подписи = SHA256
- Действителен с = допустимая прошедшая Дата
- Действителен до = допустимая дата в будущем
- Открытый ключ = RSA 2048bits (минимум) или 4096bits
- Точка распространения списка отзыва сертификатов = URL-адрес в файл. CRL
- Subject CN = URL, может быть универсальным сертификатом, например example.contoso.com или  *. contoso.com**
- Subject (C) аунтри = определено, например US
- Подразделение субъекта (OU) = определено, например contoso Labs
- Subject (O) рганизатион = определено, например contoso Inc.

Файл ключа

- Файл ключа, созданный при создании CSR
- RSA 2048bits (минимум) или 4096bits

Цепочка сертификатов

- Промежуточный файл сертификата (если таковой имеется), предоставленный центром сертификации
- Сертификат ЦС, выдавший сертификат сервера, должен быть первым в файле, за которым следуют все остальные, вплоть до корня. 
- Может включать атрибуты сумки.

Парольная фраза

- поддерживается 1 ключ
- Программа установки при импорте сертификата

Сертификаты с другими параметрами могут работать, но не могут поддерживаться корпорацией Майкрософт.

#### <a name="encryption-key-artifacts"></a>Артефакты ключа шифрования

**. pem — файл контейнера сертификата**

Это имя получено из Privacy Enhanced Mail (PEM), исторического метода для защиты электронной почты, но используемого в нем формата контейнера и является переводом Base64 для ключей x509 ASN. 1.  

В документах RFC 1421 по 1424: формат контейнера, который может включать только общедоступный сертификат (например, при установке Apache и файлов сертификатов ЦС/ЕТК/ССЛ/цертс), или может включать всю цепочку сертификатов, включая открытый ключ, закрытый ключ и корневые сертификаты.  

Он также может кодировать CSR, так как формат PKCS10 можно преобразовать в PEM.

**. CERT. cer. CRT — файл контейнера сертификата**

Форматированный файл PEM (или редко. der) с другим расширением. Проводник Windows распознает его как сертификат. PEM-файл не распознается проводником Windows.

**. ключ — файл закрытого ключа**

Файл ключа имеет тот же формат, что и PEM-файл, но имеет другое расширение.
##### <a name="use-cli-commands-to-deploy-certificates"></a>Использование команд CLI для развертывания сертификатов

Используйте команду CLI *циберкс-кссенсе-Certificate-Import* для импорта сертификатов. Чтобы использовать это средство, необходимо отправить файлы сертификатов на устройство (с помощью таких средств, как WinSCP или wget).

Команда поддерживает следующие входные флаги:

-h вывод синтаксиса справки командной строки

--CRT путь к файлу сертификата (расширение CRT)

--Key *. файл ключа, длина ключа должна быть не менее 2048 бит

--Путь цепочки к файлу цепочки сертификатов (необязательно)

--Передайте парольную фразу, используемую для шифрования сертификата (необязательно)

--фразой-Set Default = false, не используется. Задайте значение TRUE, чтобы использовать предыдущую парольную фразу, указанную в предыдущем сертификате (необязательно)

При использовании команды CLI:

- Убедитесь, что файлы сертификатов доступны для чтения на устройстве.

- Убедитесь, что доменное имя и IP-адрес в сертификате соответствуют конфигурации, запланированной ИТ-отделом.


## <a name="connect-a-sensor-to-the-management-console"></a>Подключение датчика к консоли управления

В этом разделе описывается, как обеспечить подключение между датчиком и локальной консолью управления. Это необходимо сделать, если вы работаете в сети Air-гаппед и хотите отправить сведения об активе и оповещении в консоль управления из датчика. Это подключение также позволяет консоли управления отправлять параметры системы на датчик и выполнять другие задачи управления на датчике.

Для подключения:

1. Войдите в локальную консоль управления.

2. Выберите **Параметры системы**.

3. В разделе **Настройка датчика — строка подключения** скопируйте автоматически созданную строку подключения.

   :::image type="content" source="media/how-to-manage-individual-sensors/connection-string-screen.png" alt-text="Скопируйте строку подключения с этого экрана."::: 

4. Войдите в консоль датчика.

5. На левой панели выберите **Параметры системы**.

6. Выберите **Подключение консоли управления**.

    :::image type="content" source="media/how-to-manage-individual-sensors/management-console-connection-screen.png" alt-text="Снимок экрана: диалоговое окно подключения консоли управления.":::

7. Вставьте строку подключения в поле **строка подключения** и выберите **подключить**.

8. В локальной консоли управления в окне **Управление сайтом** назначьте датчик для зоны.

## <a name="change-the-name-of-a-sensor"></a>Изменение имени датчика

Вы можете изменить имя консоли датчика. Новое имя будет отображаться в веб-браузере консоли, в различных окнах консоли и в журналах устранения неполадок.

Процесс изменения имен датчиков может различаться для локально подключенных датчиков и датчиков, подключенных к облаку. Имя по умолчанию — **датчик**.

### <a name="change-the-name-of-a-locally-connected-sensor"></a>Изменение имени локально подключенного датчика

Чтобы изменить имя:

1. В нижней части левой области консоли выберите текущую метку датчика.

   :::image type="content" source="media/how-to-change-the-name-of-your-azure-consoles/label-name.png" alt-text="Снимок экрана, на котором показана метка датчика.":::

1. В диалоговом окне **изменение имени датчика** введите имя.

1. Щелкните **Сохранить**. Будет применено новое имя.

### <a name="change-the-name-of-a-cloud-connected-sensor"></a>Изменение имени датчика, подключенного к облаку

Если датчик зарегистрирован как датчик с подключением к облаку, имя датчика определяется именем, назначенным во время регистрации. Имя включается в файл активации, который был отправлен при первом входе. Чтобы изменить имя датчика, необходимо отправить новый файл активации.

Чтобы изменить имя:

1. На портале защитника Azure для IoT перейдите на страницу **Управление датчиками** .

1. Удалите датчик из окна **управления датчиками** .

1. Зарегистрируйте с новым именем.

1. Скачайте и новый файл активации.

1. Войдите в датчик и отправьте новый файл активации.

## <a name="update-the-sensor-network-configuration"></a>Обновление сетевой конфигурации датчика

Конфигурация сети датчика была определена во время установки датчика. Параметры конфигурации можно изменить. Можно также настроить конфигурацию прокси-сервера.

Если вы создаете новый IP-адрес, возможно, потребуется выполнить вход еще раз.

Чтобы изменить конфигурацию, выполните следующие действия.

1. В боковом меню выберите **Параметры системы**.

2. В окне **Параметры системы** выберите **сеть**.

    :::image type="content" source="media/how-to-manage-individual-sensors/edit-network-configuration-screen.png" alt-text="Настройте параметры сети.":::

3. Задайте следующие параметры:

    | Параметр | Описание |
    |--|--|
    | IP-адрес | IP-адрес датчика |
    | Маска подсети | Адрес маски |
    | Шлюз по умолчанию | Адрес шлюза по умолчанию |
    | DNS | Адрес DNS-сервера |
    | Hostname (Имя узла) | Имя узла датчика |
    | Proxy (Прокси) | Узел прокси-сервера и имя порта |

4. Щелкните **Сохранить**.

## <a name="synchronize-time-zones-on-the-sensor"></a>Синхронизация часовых поясов на датчике

Вы можете настроить время и регион датчика, чтобы все пользователи могли видеть одно и то же время и регион.

:::image type="content" source="media/how-to-manage-individual-sensors/time-and-region.png" alt-text="Настройте время и регион.":::

| Параметр | Описание |
|--|--|
| Часовой пояс | Определение часового пояса для:<br />— Оповещения<br />— Мини-приложения для тенденций и статистики<br />— Отчеты интеллектуального анализа данных<br />   — Отчеты по оценке рисков<br />— Векторы атак |
| Формат даты | Выберите один из следующих параметров формата.<br />-дд/мм/гггг чч: мм: СС<br />-MM/дд/гггг чч: мм: СС<br />-гггг/мм/дд чч: мм: СС |
| Дата и время | Отображает текущую дату и местное время в выбранном формате.<br />Например, если фактическое расположение — America и Нью-Йорк, но для часового пояса задано значение Европа и Берлин, то время отображается в соответствии с местным временем Берлин. |

Чтобы настроить время датчика, сделайте следующее:

1. В боковом меню выберите **Параметры системы**.

2. В окне **системные параметры** выберите **время & региональный**.

3. Задайте параметры и нажмите кнопку **сохранить**.

## <a name="set-up-backup-and-restore-files"></a>Настройка файлов резервного копирования и восстановления

Резервное копирование системы выполняется автоматически в 3:00 ежедневно. Данные сохраняются на другом диске датчика. Расположение по умолчанию: `/var/cyberx/backups`.

Этот файл можно автоматически переместить во внутреннюю сеть.

> [!NOTE]
> - Процедуру резервного копирования и восстановления можно выполнять только в одной версии.
> - В некоторых архитектурах резервное копирование отключено. Его можно включить в `/var/cyberx/properties/backup.properties` файле.

При управлении датчиком с помощью локальной консоли управления можно использовать расписание резервного копирования датчика, чтобы получить эти резервные копии и сохранить их в консоли управления или на внешнем резервном сервере.

**Что такое резервное копирование:** Конфигурации и данные.

**Что резервное копирование не выполнено:** ПКАП файлы и журналы. Вы можете вручную создать резервную копию и восстановить Пкапс и журналы.

Файлы резервной копии датчика автоматически именуются в следующем формате: `<sensor name>-backup-version-<version>-<date>.tar` . Например, `Sensor_1-backup-version-2.6.0.102-2019-06-24_09:24:55.tar`.

Чтобы настроить резервное копирование, сделайте следующее:

- Войдите в учетную запись администратора и введите `$ sudo cyberx-xsense-system-backup` .

Чтобы восстановить последнюю версию файла резервной копии, выполните следующие действия.

- Войдите в учетную запись администратора и введите `$ sudo cyberx-xsense-system-restore` .

Чтобы сохранить резервную копию на внешнем сервере SMB, выполните следующие действия.

1. Создайте общую папку на внешнем SMB-сервере.

    Получите путь к папке, имя пользователя и пароль, необходимые для доступа к серверу SMB.

2. В датчике создайте каталог для резервных копий:

    - `sudo mkdir /<backup_folder_name_on_cyberx_server>`

    - `sudo chmod 777 /<backup_folder_name_on_cyberx_server>/`

3. Отредактируйте файл `fstab`: 

    - `sudo nano /etc/fstab`

    - `add - //<server_IP>/<folder_path> /<backup_folder_name_on_cyberx_server> cifsrw,credentials=/etc/samba/user,vers=X.X,uid=cyberx,gid=cyberx,file_mode=0777,dir_mode=0777 0 0`

4. Измените и создайте учетные данные для общего доступа к SMB Server:

    `sudo nano /etc/samba/user` 

5. Добавьте следующие пакеты:

    - `username=&gt:user name&lt:`

    - `password=<password>`

6. Подключите каталог:

    `sudo mount -a`

7. Настройте каталог резервного копирования для общей папки на датчике защитника IoT:  

    - `sudo nano /var/cyberx/properties/backup.properties`

    - `set backup_directory_path to <backup_folder_name_on_cyberx_server>`

### <a name="restore-sensors"></a>Датчики восстановления

Резервные копии можно восстановить из консоли датчика и с помощью интерфейса командной строки.

**Чтобы выполнить восстановление из консоли, выполните следующие действия.**

- Выберите пункт **восстановить изображение** из окна **системных параметров** датчика.

:::image type="content" source="media/how-to-manage-individual-sensors/restore-image-screen.png" alt-text="Восстановите образ, нажав кнопку.":::

В консоли будут отображаться ошибки восстановления.

**Чтобы выполнить восстановление с помощью интерфейса командной строки:**

- Войдите в учетную запись администратора и введите `$ sudo cyberx-management-system-restore` .

## <a name="update-a-standalone-sensor-version"></a>Обновление автономной версии датчика

Следующая процедура описывает, как обновить автономный датчик с помощью консоли датчика. Процесс обновления займет около 30 минут.

1. Перейдите на [портал Azure](https://portal.azure.com/).

2. Перейдите в раздел "защитник для Интернета вещей".

3. Перейдите на страницу **обновления** .

   :::image type="content" source="media/how-to-manage-individual-sensors/updates-page.png" alt-text="Снимок экрана со страницей &quot;обновления&quot; защитника для IoT.":::

4. Выберите **скачать** в разделе **датчики** и сохраните файл.

5. На боковой панели консоли датчика выберите **Параметры системы**.

6. На панели **Обновление версии** выберите **Обновить**.

    :::image type="content" source="media/how-to-manage-individual-sensors/upgrade-pane-v2.png" alt-text="Снимок экрана: панель обновления.":::

7. Выберите файл, скачанный на странице защитник для **обновлений** IOT.

8. Начнется процесс обновления, в течение которого система будет перезагружена дважды. После первой перезагрузки (до завершения процесса обновления) система откроется с окном входа. После входа в нижнем левом углу боковой панели появится версия обновления.

    :::image type="content" source="media/how-to-manage-individual-sensors/defender-for-iot-version.png" alt-text="Снимок экрана версии обновления, отображаемой после входа в систему.":::

## <a name="forward-sensor-failure-alerts"></a>Оповещения о сбоях датчика пересылки 

Вы можете пересылать оповещения третьим сторонам, чтобы предоставить следующие сведения:

- Отключенные датчики

- Сбои при удаленном резервном копировании

Эти сведения отправляются при создании правила пересылки для системных уведомлений.

> [!NOTE]
> Администраторы могут отправлять системные уведомления.

Для отправки уведомлений:

1. Войдите в локальную консоль управления.
1. Выберите **Перенаправление** в боковом меню.
1. Создайте правило пересылки.
1. Выберите **отчет уведомления системы**.

Дополнительные сведения о правилах пересылки см. в разделе [Пересылка сведений о предупреждениях](how-to-forward-alert-information-to-partners.md).

## <a name="adjust-system-properties"></a>Настройка системных свойств

Системные свойства управляют различными операциями и параметрами в датчике. Изменение или изменение этих данных может привести к повреждению работы консоли датчика.

Перед изменением параметров обратитесь к [Служба поддержки Майкрософт](https://support.microsoft.com/) .

Для доступа к свойствам системы:

1. Войдите в локальную консоль управления или датчик.

2. Выберите **Параметры системы**.

3. В разделе **Общие** выберите **Свойства системы** .

## <a name="see-also"></a>См. также

[Исследование и пакеты аналитики угроз](how-to-work-with-threat-intelligence-packages.md)

[Управление датчиками из консоли управления](how-to-manage-sensors-from-the-on-premises-management-console.md)