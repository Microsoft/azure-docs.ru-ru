---
title: Работа с Azure Defender для Интернета вещей с помощью команд CLI
description: В этой статье описывается защитник для команд интерфейса командной строки IoT для датчиков и локальных консолей управления.
author: shhazam-ms
manager: rkarlin
ms.author: shhazam
ms.date: 12/12/2020
ms.topic: article
ms.service: azure
ms.openlocfilehash: 2ec682bf76e35b54f58acc1956972c57128edd75
ms.sourcegitcommit: 27d616319a4f57eb8188d1b9d9d793a14baadbc3
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/15/2021
ms.locfileid: "100523147"
---
# <a name="work-with-defender-for-iot-cli-commands"></a>Работа с Azure Defender для Интернета вещей с помощью команд CLI

В этой статье описываются команды интерфейса командной строки для датчиков и локальных консолей управления. Команды доступны администраторам, циберкс пользователям и пользователям службы поддержки.

Определите правила исключения при планировании действий по обслуживанию или действиях, которые не нуждаются в предупреждении.

## <a name="create-local-alert-exclusion-rules"></a>Создание локальных правил исключения предупреждений

Правило исключения можно создать, введя следующую команду в CLI:

```azurecli-interactive
alerts exclusion-rule-create [-h] -n NAME [-ts TIMES] [-dir DIRECTION]  
[-dev DEVICES] [-a ALERTS]
```

Ниже перечислены атрибуты, которые можно определить в правилах исключения предупреждений.

| attribute | Описание: |
|--|--|
| [-h] | Выводит справочные сведения для команды. |
| -n имя | Имя создаваемого правила. |
| [-TS время] | Интервал времени, в течение которого правило активно. Он должен быть указан как:<br />`xx:yy-xx:yy`<br />Можно определить более одного периода времени, используя запятую между ними. Например: `xx:yy-xx:yy, xx:yy-xx:yy`. |
| [-DIR DIRECTION] | Направление применения правила. Он должен быть указан как:<br />`both | src | dst` |
| [-dev DEVICEs] | IP-адрес и тип адреса устройств, исключаемых правилом, указанных в качестве:<br />`ip-x.x.x.x`<br />`mac-xx:xx:xx:xx:xx:xx`<br />`subnet: x.x.x.x/x` |
| [-a ALERTs] | Имя предупреждения, которое будет исключено правилом:<br />`0x00000`<br />`0x000001` |

## <a name="append-local-alert-exclusion-rules"></a>Добавить локальные правила исключения предупреждений

Вы можете добавить новые правила к текущим правилам исключения предупреждений, введя следующую команду в CLI:

```azurecli-interactive
alerts exclusion-rule-append [-h] -n NAME [-ts TIMES] [-dir DIRECTION]  
[-dev DEVICES] [-a ALERTS]
```

Используемые здесь атрибуты похожи на атрибуты, описанные при создании локальных правил исключения предупреждений. При использовании здесь атрибуты применяются к существующим правилам.

## <a name="show-local-alert-exclusion-rules"></a>Показывать локальные правила исключения предупреждений

Введите следующую команду, чтобы просмотреть все существующие правила исключения:

```azurecli-interactive
alerts exclusion-rule-list [-h] -n NAME [-ts TIMES] [-dir DIRECTION]  
[-dev DEVICES] [-a ALERTS]
```

## <a name="delete-local-alert-exclusion-rules"></a>Удалить локальные правила исключения предупреждений

Вы можете удалить существующее правило исключения предупреждений, введя следующую команду:

```azurecli-interactive
alerts exclusion-rule-remove [-h] -n NAME [-ts TIMES] [-dir DIRECTION]  
[-dev DEVICES] [-a ALERTS]
```

С правилами исключения предупреждений можно использовать следующий атрибут:

| attribute | Описание:|
| --------- | ---------------------------------- |
| -n имя | Имя удаляемого правила. |

## <a name="sync-time-from-the-ntp-server"></a>Время синхронизации с NTP-сервера

Вы можете включить и отключить синхронизацию времени на NTP-сервере.

### <a name="enable-ntp-sync"></a>Включить NTP-синхронизацию

Чтобы включить периодическое получение текущего времени с указанного NTP-сервера, введите следующую команду:

```azurecli-interactive
ntp enable IP
```

Атрибут, который можно определить в команде, является IP-адресом сервера NTP.

### <a name="disable-ntp-sync"></a>Отключить NTP-синхронизацию

При вводе следующей команды будет отключена синхронизация времени с указанным NTP-сервером:

```azurecli-interactive
ntp disable IP
```

Атрибут, который можно определить в команде, является IP-адресом сервера NTP.

## <a name="configure-the-network"></a>Настройка сети

В следующей таблице описаны команды, доступные для настройки параметров сети для защитника Azure для IoT.

|Имя|Get-Help|Описание|
|-----------|-------|-----------|
|Проверка связи|`ping IP `| Проверяет связь с адресами за пределами защитника для платформы IoT.|
|Blink|`network blink`|Включает изменение параметров конфигурации сети.|
|Перенастройка сети |`network edit-settings`| Включает изменение параметров конфигурации сети. |
|Отображение параметров сети |`network list`|Отображает параметры сетевого адаптера. |
|Проверка конфигурации сети |`network validate` |Представляет выходные параметры сети. <br /> <br />Например: <br /> <br />Текущие параметры сети: <br /> интерфейс: eth0 <br /> IP-адрес: 10.100.100.1 <br />подсеть: 255.255.255.0 <br />шлюз по умолчанию: 10.100.100.254 <br />DNS: 10.100.100.254 <br />интерфейсы монитора: eth1|
|Импорт сертификата |`certificate import FILE` |Импортирует HTTPS сертификат. Необходимо указать полный путь, который ведет к \* CRT-файлу. |
|Отображение даты |`date` |Возвращает текущую дату на узле в формате GMT. |

## <a name="filter-network-configurations"></a>Фильтрация конфигураций сети

`network capture-filter`Команда позволяет администраторам устранить сетевой трафик, который не нужно анализировать. Фильтрация трафика с помощью списка включения или списка исключений.

```azurecli-interactive
network capture-filter
```

После ввода команды вам будет предложено ввести следующий вопрос:

>`Would you like to supply devices and subnet masks you wish to include in the capture filter? [Y/N]:`

Выберите `Y` этот пункт, чтобы открыть файл Nano, в который можно добавить устройства, каналы, порты и подмножества в соответствии со следующим синтаксисом:

| attribute | Описание: |
|--|--|
| 1.1.1.1 | Включает весь трафик для этого устройства. |
| 1.1.1.1, 2.2.2.2 | Включает весь трафик для этого канала. |
| 1.1.1, 2.2.2 | Включает весь трафик для этой подсети. |

Отдельные аргументы путем удаления строки.

При включении устройства, канала или подсети датчик обрабатывает весь допустимый трафик для этого аргумента, включая порты и трафик, которые обычно не обрабатывались.

Затем вам будет предложено следующее:

>`Would you like to supply devices and subnet masks you wish to exclude from the capture filter? [Y/N]:`

Выберите `Y` этот пункт, чтобы открыть файл Nano, в который можно добавить устройства, каналы, порты и подмножества в соответствии со следующим синтаксисом:

| attribute | Описание: |
|--|--|
| 1.1.1.1 | Исключает весь трафик для этого устройства. |
| 1.1.1.1, 2.2.2.2 | Исключает весь трафик для этого канала, то есть весь трафик между двумя устройствами. |
| 1.1.1.1, 2.2.2.2, 443 | Исключает весь трафик для этого канала по порту. |
| 1.1.1 | Исключает весь трафик для этой подсети. |
| 1.1.1, 2.2.2 | Исключает весь трафик между подсетями. |

Отдельные аргументы путем удаления строки.

При исключении устройства, канала или подсети датчик будет исключать весь допустимый трафик для этого аргумента.

### <a name="ports"></a>Порты

Включение или исключение портов UDP и TCP для всего трафика.

>`502`: один порт

>`502,443`: оба порта

>`Enter tcp ports to include (delimited by comma or Enter to skip):`

>`Enter udp ports to include (delimited by comma or Enter to skip):`

>`Enter tcp ports to exclude (delimited by comma or Enter to skip):`

>`Enter udp ports to exclude (delimited by comma or Enter to skip):`

### <a name="components"></a>Компоненты

Вам будет предложено следующее:

>`In which component do you wish to apply this capture filter?`

Возможные варианты:  `all` , `dissector` , `collector` , `statistics-collector` , `rpc-parser` или `smb-parser` .

В большинстве случаев использования выберите `all` .

### <a name="custom-base-capture-filter"></a>Настраиваемый фильтр базовой записи

Базовый фильтр записи является базовым для компонентов. Например, фильтр определяет, какие порты доступны для компонента.

Выберите `Y` для всех следующих параметров. После установки изменений все фильтры добавляются к базовому плану. При внесении изменений будет перезаписан существующий базовый план.

>`Would you like to supply a custom base capture filter for the dissector component? [Y/N]:`

>`Would you like to supply a custom base capture filter for the collector component? [Y/N]:`

>`Would you like to supply a custom base capture filter for the statistics-collector component? [Y/N]:`

>`Would you like to supply a custom base capture filter for the rpc-parser component? [Y/N]:`

>`Would you like to supply a custom base capture filter for the smb-parser component? [Y/N]:`

>`Type Y for "internal" otherwise N for "all-connected" (custom operation mode enabled) [Y/N]:`

Если вы решили исключить подсеть, например 1.1.1:

- `internal` будет исключена только эта подсеть.

- `all-connected` исключит эту подсеть и весь трафик из этой подсети и из нее.

Рекомендуется выбрать `internal` .

> [!NOTE]
> Выбранные параметры используются для всех фильтров в средстве и не зависят от сеанса. Иными словами, вы никогда не можете выбрать `internal`   для некоторых фильтров и  `all-connected`   для других.

### <a name="comments"></a>Комментарии

Фильтры можно просмотреть в  ```/var/cyberx/properties/cybershark.properties``` :

- **Статистика — сборщик**:  `bpf_filter property` в ```/var/cyberx/properties/net.stats.collector.properties```

- **рассекторировать**: `override.capture_filter`   свойство в ```/var/cyberx/properties/cybershark.properties```

- **RPC-Parser**: `override.capture_filter` свойство в ```/var/cyberx/properties/rpc-parser.properties```

- **средство синтаксического анализа SMB**:  `override.capture_filter`   свойство в ```/var/cyberx/properties/smb-parser.properties```

- **сборщик**: `general.bpf_filter`   свойство в ```/var/cyberx/properties/collector.properties```

Конфигурацию по умолчанию можно восстановить, введя следующий код для пользователя циберкс:

```azurecli-interactive
sudo cyberx-xsense-capture-filter -p all -m all-connected
```

## <a name="define-client-and-server-hosts"></a>Определение узлов клиента и сервера

Если защитник для Интернета вещей не обнаруживает узлы клиента и сервера автоматически, введите следующую команду, чтобы задать узлы клиента и сервера:

```azurecli-interactive
directions [-h] [--identifier IDENTIFIER] [--port PORT] [--remove] [--add]  
[--tcp] [--udp]
```

С помощью команды можно использовать следующие атрибуты `directions` :

| attribute | Описание: |
|--|--|
| [-h] | Выводит справочную информацию для команды. |
| [--идентификатор идентификатора] | Идентификатор сервера. |
| [--порт порта] | Порт сервера. |
| [--Remove] | Удаляет узел клиента или сервера из списка. |
| [--Добавить] | Добавляет узел клиента или сервера в список. |
| [--TCP] | При обмене данными с этим узлом используйте протокол TCP. |
| [--UDP] | При обмене данными с этим узлом используйте UDP. |

## <a name="system-actions"></a>Системные действия
В следующей таблице описаны команды, доступные для выполнения различных системных действий в защитнике для Интернета вещей.

|Имя|Код|Описание|
|----|----|-----------|
|Перезагрузка узла|`system reboot`|Перезагружает устройство узла.|
|Завершение работы узла|`system shutdown`|Завершает работу узла.|
|Резервное копирование системы|`system backup`|Инициирует немедленную архивацию (незапланированное резервное копирование).|
|Восстановление системы из резервной копии|`system restore`|Восстановление из последней резервной копии.|
|Вывод списка файлов резервных копий|`system backup-list`|Список доступных файлов резервных копий.|
|Отображение состояния всех защитников для служб платформы IoT|`system sanity`|Проверяет производительность системы, вычисляя текущее состояние всех защитников для служб платформы IoT.|
|Отображение версии программного обеспечения|`system version`|Отображает версию программного обеспечения, выполняющегося в системе в данный момент.|

## <a name="deploy-ssl-and-tls-certificates-to-appliances"></a>Развертывание сертификатов SSL и TLS для устройств

Введите следующую команду, чтобы импортировать сертификаты SSL и TLS предприятия в CLI:

```azurecli-interactive
cyberx-xsense-certificate-import
```
Чтобы использовать это средство, необходимо передать файлы сертификата на устройство. Это можно сделать с помощью таких средств, как WinSCP или wget. 

Команда поддерживает следующие входные флаги:

| Flag | Описание |
|--|--|
| -H | Отображает синтаксис справки командной строки. |
| --CRT | Путь к файлу сертификата (расширение CRT). |
| --key | \*Файл ключа. Длина ключа должна быть не менее 2 048 бит. |
| --цепочка | Путь к файлу цепочки сертификатов (необязательно). |
| --Pass | Парольная фраза, используемая для шифрования сертификата (необязательно). |
| --пароль-Set | Значение по умолчанию — **false**, не **используется**. <br />Задайте значение **true** , чтобы использовать предыдущую парольную фразу, указанную в предыдущем сертификате (необязательно). |  |

При использовании средства:

- Убедитесь, что файлы сертификатов доступны для чтения на устройстве. 

- Убедитесь в том, что он является доменом устройства (как он отображается в сертификате) с DNS-сервером и соответствующим IP-адресом. 
    
## <a name="next-steps"></a>Дальнейшие шаги

[API-интерфейсы для датчиков и консоли управления в защитнике Интернета вещей](references-work-with-defender-for-iot-apis.md)
