---
title: Образец. изучение приложения для обработки изображений на C#
titleSuffix: Azure Cognitive Services
description: Изучите базовое приложение для Windows, в котором используется API компьютерного зрения в Azure Cognitive Services. Узнайте, как выполнять распознавание текста, создавать эскизы и работать с визуальными компонентами в изображении.
services: cognitive-services
author: PatrickFarley
manager: nolachar
ms.service: cognitive-services
ms.subservice: computer-vision
ms.topic: sample
ms.date: 04/17/2019
ms.author: pafarley
ms.custom: seodec18, devx-track-csharp
ms.openlocfilehash: 0a1878268beb135151a23b87d03839f3a51f4a96
ms.sourcegitcommit: ba676927b1a8acd7c30708144e201f63ce89021d
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/07/2021
ms.locfileid: "102432593"
---
# <a name="sample-explore-an-image-processing-app-with-c"></a>Образец. изучение приложения для обработки изображений с использованием C#

Изучите базовое приложение Windows, в котором используется API компьютерного зрения для оптического распознавания символов и создания интеллектуально обрезанных эскизов, а также для обнаружения, классификации, добавления тегов и описания визуальных признаков изображения, включая лица. Приведенный ниже пример позволяет отправить URL-адрес изображения или локально хранящийся файл. Вы можете использовать этот пример с открытым кодом в качестве шаблона для создания собственного приложения для Windows с использованием API компьютерного зрения и Windows Presentation Foundation (WPF), входящего в состав .NET Framework.

> [!div class="checklist"]
> * Получите пример приложения из GitHub
> * Откройте и создайте пример приложения в Visual Studio
> * Запустите пример приложения и поэкспериментируйте в нем с разными сценариями
> * Изучите различные сценарии в примере приложения

## <a name="prerequisites"></a>Предварительные требования

Прежде чем исследовать пример приложения, убедитесь, что выполнены следующие предварительные требования:

* У вас должна быть [Visual Studio 2015 или более поздней версии](https://visualstudio.microsoft.com/downloads/).
* подписка Azure — [создайте бесплатную учетную запись](https://azure.microsoft.com/free/cognitive-services/).
* Получив подписку Azure, <a href="https://portal.azure.com/#create/Microsoft.CognitiveServicesComputerVision"  title="создайте ресурс Компьютерного зрения"  target="_blank">create a Computer Vision resource </a> на портале Azure, чтобы получить ключ и конечную точку. После развертывания щелкните **Перейти к ресурсам**.
    * Для подключения приложения к API Компьютерного зрения потребуется ключ и конечная точка из созданного ресурса. Ключ и конечная точка будут вставлены в приведенный ниже код в кратком руководстве.
    * Используйте бесплатную ценовую категорию (`F0`), чтобы опробовать службу, а затем выполните обновление до платного уровня для рабочей среды.

## <a name="get-the-sample-app"></a>Получение примера приложения

Пример приложения API компьютерного зрения можно найти на GitHub в репозитории `Microsoft/Cognitive-Vision-Windows`. Этот репозиторий также включает репозиторий `Microsoft/Cognitive-Common-Windows` как подмодуль Git. Вы можете рекурсивно клонировать этот репозиторий, включая подмодуль, с помощью команды `git clone --recurse-submodules` из командной строки или с помощью GitHub Desktop.

Например, чтобы рекурсивно клонировать репозиторий для примера приложения API компьютерного зрения из командной строки, выполните следующую команду:

```Console
git clone --recurse-submodules https://github.com/Microsoft/Cognitive-Vision-Windows.git
```

> [!IMPORTANT]
> Не загружайте этот репозиторий как ZIP-файл. Git не включает подмодули при загрузке репозитория как ZIP-файла.

### <a name="get-optional-sample-images"></a>Получите примеры изображений (необязательно)

При необходимости вы можете использовать примеры изображений в примере приложения [API распознавания лиц](../../Face/Overview.md), доступном на GitHub в репозитории `Microsoft/Cognitive-Face-Windows`. Этот образец приложения включает папку `/Data` с несколькими изображениями людей. Вы можете рекурсивно клонировать и этот репозиторий, с помощью методов, описанных для примера приложения API компьютерного зрения.

Например, чтобы рекурсивно клонировать репозиторий для примера приложения API распознавания лиц из командной строки, выполните следующую команду:

```Console
git clone --recurse-submodules https://github.com/Microsoft/Cognitive-Face-Windows.git
```

## <a name="open-and-build-the-sample-app-in-visual-studio"></a>Откройте и создайте пример приложения в Visual Studio

Сначала необходимо создать пример приложения, чтобы разрешить зависимости в Visual Studio, прежде чем можно будет запустить или изучить пример приложения. Чтобы открыть и создать пример приложения, выполните следующие действия:

1. Откройте файл решения Visual Studio `/Sample-WPF/VisionAPI-WPF-Samples.sln` в Visual Studio.
1. Убедитесь, что решение Visual Studio содержит два проекта:  

   * SampleUserControlLibrary
   * VisionAPI-WPF-Samples  

   Если проект SampleUserControlLibrary отсутствует, убедитесь, что рекурсивно клонировали репозиторий `Microsoft/Cognitive-Vision-Windows`.
1. В Visual Studio нажмите клавиши CTRL+SHIFT+B или выберите **Сборка** в меню ленты, а затем **Сборка решения**, чтобы собрать решение.

## <a name="run-and-interact-with-the-sample-app"></a>Запустите пример приложения и испытайте его

Вы можете запустить пример приложения, чтобы увидеть, как он взаимодействует с вами и с клиентской библиотекой API компьютерного зрения при выполнении различных задач, таких как создание эскизов или добавления тегов. Чтобы запустить пример приложения и испытать его, выполните следующие действия:

1. После завершения сборки нажмите клавишу **F5** или выберите **Отладка** в меню ленты, а затем **Начать отладку**, чтобы запустить пример приложения.
1. При отображении примера приложения выберите **Управление ключами подписки** в области навигации, чтобы перейти на страницу управления ключами подписки.
   ![Страница управления ключами подписки](../Images/Vision_UI_Subscription.PNG)  
1. Введите ключ подписки в поле **Ключ подписки**.
1. Введите URL-адрес конечной точки в поле **Конечная точка**.  
   [!INCLUDE [Custom subdomains notice](../../../../includes/cognitive-services-custom-subdomains-note.md)]
1. Если вы не хотите вводить ключ подписки и URL-адрес конечной точки при следующем запуске примера приложения, выберите **Сохранить параметр**, чтобы сохранить ключ подписки и URL-адрес конечной точки на компьютере. Если вы хотите удалить ранее сохраненный ключ подписки и URL-адрес конечной точки, выберите **Удалить параметр**.

   > [!NOTE]
   > В примере приложения используется изолированное хранилище и `System.IO.IsolatedStorage` для хранения вашего ключа подписки и URL-адреса конечной точки.

1. В разделе **Выбрать сценарий** на панели навигации выберите один из сценариев, включенных в пример приложения:  

   | Сценарий | Описание |
   |----------|-------------|
   |Анализ изображения | Использует операцию [Анализ изображения](https://westcentralus.dev.cognitive.microsoft.com/docs/services/5adf991815e1060e6355ad44/operations/56f91f2e778daf14a499e1fa) для анализа локальных или удаленных изображений. Вы можете выбрать визуальные характеристики и язык для анализа и просмотреть изображение и результаты.  |
   |Анализ изображения с помощью модели предметной области | Использует операцию [Список моделей для предметной области](https://westcentralus.dev.cognitive.microsoft.com/docs/services/5adf991815e1060e6355ad44/operations/56f91f2e778daf14a499e1fd), чтобы получить список моделей предметной области, из которых можно выбирать, и операцию [Распознавание содержимого предметной области](https://westcentralus.dev.cognitive.microsoft.com/docs/services/5adf991815e1060e6355ad44/operations/56f91f2e778daf14a499e200) для анализа локальных или удаленных изображений с помощью выбранной модели предметной области. Вы также можете выбрать язык для анализа. |
   |Описание изображения | Использует операцию [Описание изображения](https://westcentralus.dev.cognitive.microsoft.com/docs/services/5adf991815e1060e6355ad44/operations/56f91f2e778daf14a499e1fe), чтобы создать понятное описание локального или удаленного изображения. Вы также можете выбрать язык описания. |
   |Создание тегов | Использует операцию [Тег изображения](https://westcentralus.dev.cognitive.microsoft.com/docs/services/5adf991815e1060e6355ad44/operations/56f91f2e778daf14a499e1ff), чтобы помечать тегами визуальные характеристики локального или удаленного изображения. Вы также можете выбрать язык для тегов. |
   |Распознавание текста (OCR) | Использует операцию [OCR](https://westcentralus.dev.cognitive.microsoft.com/docs/services/5adf991815e1060e6355ad44/operations/56f91f2e778daf14a499e1fc), чтобы распознать и извлечь печатный текст из изображения. Вы можете выбрать язык самостоятельно или разрешить API компьютерного зрения определить язык автоматически. |
   |Распознавание текста V2 (на английском языке) | Использует операции [Распознавание текста](https://westcentralus.dev.cognitive.microsoft.com/docs/services/5adf991815e1060e6355ad44/operations/587f2c6a154055056008f200) и [Получить результат операции распознавания текста](https://westcentralus.dev.cognitive.microsoft.com/docs/services/5adf991815e1060e6355ad44/operations/587f2cf1154055056008f201), чтобы асинхронно распознать и извлечь рукописный или печатный текст из изображения. |
   |Получение эскиза | Использует операцию [Получить эскиз](https://westcentralus.dev.cognitive.microsoft.com/docs/services/5adf991815e1060e6355ad44/operations/56f91f2e778daf14a499e1fb), чтобы создать эскиз для локального или удаленного изображения. |

   На снимке экрана показана страница, предоставленная для сценария анализа изображений после анализа примера изображения.
   ![Снимок экрана страницы "Анализ изображений"](../Images/Analyze_Image_Example.PNG)

## <a name="explore-the-sample-app"></a>Изучите пример приложения

Решение Visual Studio для примера приложения API компьютерного зрения содержит два проекта:

* SampleUserControlLibrary  
  Проект SampleUserControlLibrary предоставляет функциональные возможности, общие для нескольких примеров Cognitive Services. Проект содержит следующие элементы:
  * SampleScenarios  
    Элемент управления UserControl, который предоставляет стандартизированное представление, например заголовок окна, панель навигации и панель содержимого, для примеров. Пример приложения API компьютерного зрения использует этот элемент управления в окне MainWindow.xaml для отображения страницы со сценариями и получения доступа к информации, которая используется совместно в разных сценариях, например ключ подписки и URL-адрес конечной точки.
  * SubscriptionKeyPage  
    Страница Page, которая предоставляет стандартизированный макет для ввода ключа подписки и URL-адреса конечной точки для примера приложения. Пример приложения API компьютерного зрения использует эту страницу для управления ключом подписки и URL-адресом конечной точки для страниц сценариев.
  * VideoResultControl  
    Элемент управления UserControl, который предоставляет стандартизированное представление для сведений о видео. Пример приложения API компьютерного зрения не использует этот элемент управления.
* VisionAPI-WPF-Samples  
  Основной проект для примера приложения компьютерного зрения. Он содержит все функциональные возможности для API компьютерного зрения. Проект содержит следующие элементы:
  * AnalyzeInDomainPage.xaml  
    Страница со сценарием для сценария анализа изображения с помощью модели предметной области.
  * AnalyzeImage.xaml  
    Страница со сценарием для сценария анализа изображения.
  * DescribePage.xaml  
    Страница со сценарием для сценария описания изображения.
  * ImageScenarioPage.cs  
    Класс ImageScenarioPage, от которого происходят все страницы сценариев в примере приложения. Этот класс управляет функциональными возможностями, например, предоставление учетных данных и форматирование выходных данных, которые используются всеми страницами сценариев.
  * MainWindow.xaml:  
    Главное окно для примера приложения. Оно использует элемент управления SampleScenarios для представления SubscriptionKeyPage и страниц сценариев.
  * OCRPage.xaml  
    Страница сценария для сценария распознавания текста (OCR).
  * RecognizeLanguage.cs  
    Класс RecognizeLanguage, который предоставляет сведения о языках, поддерживаемых различными методами в примере приложения.
  * TagsPage.xaml  
    Страница сценария для сценария создания тегов.
  * TextRecognitionPage.xaml  
    Страница сценария для сценария распознавания текста V2 (на английском языке).
  * ThumbnailPage.xaml  
    Страница сценария для сценария получения эскиза.

### <a name="explore-the-sample-code"></a>Изучение примера кода

Важные фрагменты примера кода выделены примечаниями, которые начинаются с `KEY SAMPLE CODE STARTS HERE` и заканчиваются `KEY SAMPLE CODE ENDS HERE`, чтобы упростить изучение примера приложения. Эти важные фрагменты примера кода содержат код, лучше всего демонстрирующий, как использовать клиентскую библиотеку API компьютерного зрения для выполнения различных задач. Найдите `KEY SAMPLE CODE STARTS HERE` в Visual Studio для перемещения между наиболее интересными разделами кода в примере приложения API компьютерного зрения. 

Например, метод `UploadAndAnalyzeImageAsync`, показанный ниже и включенный в AnalyzePage.xaml, демонстрирует, как использовать клиентскую библиотеку для анализа локального изображения путем вызова метода `ComputerVisionClient.AnalyzeImageInStreamAsync`.

```csharp
private async Task<ImageAnalysis> UploadAndAnalyzeImageAsync(string imageFilePath)
{
    // -----------------------------------------------------------------------
    // KEY SAMPLE CODE STARTS HERE
    // -----------------------------------------------------------------------

    //
    // Create Cognitive Services Vision API Service client.
    //
    using (var client = new ComputerVisionClient(Credentials) { Endpoint = Endpoint })
    {
        Log("ComputerVisionClient is created");

        using (Stream imageFileStream = File.OpenRead(imageFilePath))
        {
            //
            // Analyze the image for all visual features.
            //
            Log("Calling ComputerVisionClient.AnalyzeImageInStreamAsync()...");
            VisualFeatureTypes[] visualFeatures = GetSelectedVisualFeatures();
            string language = (_language.SelectedItem as RecognizeLanguage).ShortCode;
            ImageAnalysis analysisResult = await client.AnalyzeImageInStreamAsync(imageFileStream, visualFeatures, null, language);
            return analysisResult;
        }
    }

    // -----------------------------------------------------------------------
    // KEY SAMPLE CODE ENDS HERE
    // -----------------------------------------------------------------------
}
```

### <a name="explore-the-client-library"></a>Клиентская библиотека

В этом примере приложение использует клиентскую библиотеку API компьютерного зрения, тонкую клиентскую программу-оболочку C# для API компьютерного зрения в Azure Cognitive Services. Клиентская библиотека доступна в NuGet в пакете [Microsoft.Azure.CognitiveServices.Vision.ComputerVision](https://www.nuget.org/packages/Microsoft.Azure.CognitiveServices.Vision.ComputerVision/). При сборке приложения Visual Studio вы извлекли клиентскую библиотеку из соответствующего пакета NuGet. Вы также можете просмотреть исходный код для клиентской библиотеки в папке `/ClientLibrary` репозитория `Microsoft/Cognitive-Vision-Windows`.

Функциональные возможности клиентской библиотеки сосредоточены вокруг класса `ComputerVisionClient` в пространстве имен `Microsoft.Azure.CognitiveServices.Vision.ComputerVision`, а модели, используемые классом `ComputerVisionClient` при взаимодействии с API компьютерного зрения, находятся в пространстве имен `Microsoft.Azure.CognitiveServices.Vision.ComputerVision.Models`. На различных страницах сценариев XAML, включенных в пример приложения, вы найдете следующие директивы `using` для этих пространств имен:

```csharp
// -----------------------------------------------------------------------
// KEY SAMPLE CODE STARTS HERE
// Use the following namespace for ComputerVisionClient.
// -----------------------------------------------------------------------
using Microsoft.Azure.CognitiveServices.Vision.ComputerVision;
using Microsoft.Azure.CognitiveServices.Vision.ComputerVision.Models;
// -----------------------------------------------------------------------
// KEY SAMPLE CODE ENDS HERE
// -----------------------------------------------------------------------
```

Подробнее о различных методах, включенных в класс `ComputerVisionClient`, вы узнаете при изучении сценариев из примера приложения API компьютерного зрения.

## <a name="explore-the-analyze-image-scenario"></a>Сценарий анализа изображений

Этот сценарий управляется страницей AnalyzePage.xaml. Вы можете выбрать визуальные характеристики и язык для анализа и просмотреть изображение и результаты. Для этого страница сценария использует один из следующих методов в зависимости от источника изображения:

* UploadAndAnalyzeImageAsync  
  Этот метод используется для локальных изображений, в которых изображение должно быть закодировано как `Stream` и отправлено в API компьютерного зрения путем вызова метода `ComputerVisionClient.AnalyzeImageInStreamAsync`.
* AnalyzeUrlAsync  
  Этот метод используется для удаленных изображений, в которых URL-адрес изображения отправляется в API компьютерного зрения путем вызова метода `ComputerVisionClient.AnalyzeImageAsync`.

Метод `UploadAndAnalyzeImageAsync` создает новый экземпляр `ComputerVisionClient` с помощью указанного ключа подписки и URL-адреса конечной точки. Так как пример приложения анализирует локальное изображение, он должен отправить содержимое этого изображения в API компьютерного зрения. Он открывает локальный файл, указанный в `imageFilePath`, для чтения в виде `Stream`, а затем получает визуальные характеристики и язык, выбранные на странице сценария. Он вызывает метод `ComputerVisionClient.AnalyzeImageInStreamAsync`, передавая `Stream` для файла, визуальные характеристики и язык, а затем возвращает результат в виде экземпляра `ImageAnalysis`. Методы, наследуемые от класса `ImageScenarioPage`, представляют возвращенные результаты на странице сценария.

Метод `AnalyzeUrlAsync` создает новый экземпляр `ComputerVisionClient` с помощью указанного ключа подписки и URL-адреса конечной точки. Он возвращает визуальные характеристики и язык, выбранные на странице сценария. Он вызывает метод `ComputerVisionClient.AnalyzeImageInStreamAsync`, передавая URL-адрес изображения, визуальные характеристики и язык, а затем возвращает результат в виде экземпляра `ImageAnalysis`. Методы, наследуемые от класса `ImageScenarioPage`, представляют возвращенные результаты на странице сценария.

## <a name="explore-the-analyze-image-with-domain-model-scenario"></a>Сценарий анализа изображения с помощью модели предметной области

Этот сценарий управляется страницей AnalyzeInDomainPage.xaml. Вы можете выбрать модель предметной области, например `celebrities` или `landmarks`, и язык для выполнения анализа изображения для определенной предметной области, и просмотреть изображение и результаты. Страница сценария использует следующие методы в зависимости от источника изображения:

* GetAvailableDomainModelsAsync  
  Этот метод возвращает список моделей предметной области из API компьютерного зрения и заполняет элемент управления ComboBox `_domainModelComboBox` на странице с помощью метода `ComputerVisionClient.ListModelsAsync`.
* UploadAndAnalyzeInDomainImageAsync  
  Этот метод используется для локальных изображений, в которых изображение должно быть закодировано как `Stream` и отправлено в API компьютерного зрения путем вызова метода `ComputerVisionClient.AnalyzeImageByDomainInStreamAsync`.
* AnalyzeInDomainUrlAsync  
  Этот метод используется для удаленных изображений, в которых URL-адрес изображения отправляется в API компьютерного зрения путем вызова метода `ComputerVisionClient.AnalyzeImageByDomainAsync`.

Метод `UploadAndAnalyzeInDomainImageAsync` создает новый экземпляр `ComputerVisionClient` с помощью указанного ключа подписки и URL-адреса конечной точки. Так как пример приложения анализирует локальное изображение, он должен отправить содержимое этого изображения в API компьютерного зрения. Он открывает локальный файл, указанный в `imageFilePath`, для чтения в виде `Stream`, а затем получает язык, выбранный на странице сценария. Он вызывает метод `ComputerVisionClient.AnalyzeImageByDomainInStreamAsync`, передавая `Stream` для файла, имя предметной области и язык, а затем возвращает результат в виде экземпляра `DomainModelResults`. Методы, наследуемые от класса `ImageScenarioPage`, представляют возвращенные результаты на странице сценария.

Метод `AnalyzeInDomainUrlAsync` создает новый экземпляр `ComputerVisionClient` с помощью указанного ключа подписки и URL-адреса конечной точки. Он возвращает язык, выбранный на странице сценария. Он вызывает метод `ComputerVisionClient.AnalyzeImageByDomainAsync`, передавая URL-адрес изображения, визуальные характеристики и язык, а затем возвращает результат в виде экземпляра `DomainModelResults`. Методы, наследуемые от класса `ImageScenarioPage`, представляют возвращенные результаты на странице сценария.

## <a name="explore-the-describe-image-scenario"></a>Сценарий описания изображений

Этот сценарий управляется страницей DescribePage.xaml. Вы можете выбрать язык для создания понятного описания изображения и просмотреть изображение и результаты. Страница сценария использует следующие методы в зависимости от источника изображения:

* UploadAndDescribeImageAsync  
  Этот метод используется для локальных изображений, в которых изображение должно быть закодировано как `Stream` и отправлено в API компьютерного зрения путем вызова метода `ComputerVisionClient.DescribeImageInStreamAsync`.
* DescribeUrlAsync  
  Этот метод используется для удаленных изображений, в которых URL-адрес изображения отправляется в API компьютерного зрения путем вызова метода `ComputerVisionClient.DescribeImageAsync`.

Метод `UploadAndDescribeImageAsync` создает новый экземпляр `ComputerVisionClient` с помощью указанного ключа подписки и URL-адреса конечной точки. Так как пример приложения анализирует локальное изображение, он должен отправить содержимое этого изображения в API компьютерного зрения. Он открывает локальный файл, указанный в `imageFilePath`, для чтения в виде `Stream`, а затем получает язык, выбранный на странице сценария. Он вызывает метод `ComputerVisionClient.DescribeImageInStreamAsync`, передавая `Stream` для файла, максимальное количество кандидатов (в этом случае 3) и язык, а затем возвращает результат в виде экземпляра `ImageDescription`. Методы, наследуемые от класса `ImageScenarioPage`, представляют возвращенные результаты на странице сценария.

Метод `DescribeUrlAsync` создает новый экземпляр `ComputerVisionClient` с помощью указанного ключа подписки и URL-адреса конечной точки. Он возвращает язык, выбранный на странице сценария. Он вызывает метод `ComputerVisionClient.DescribeImageAsync`, передавая URL-адрес изображения, максимальное количество кандидатов (в этом случае 3) и язык, а затем возвращает результат в виде экземпляра `ImageDescription`. Методы, наследуемые от класса `ImageScenarioPage`, представляют возвращенные результаты на странице сценария.

## <a name="explore-the-generate-tags-scenario"></a>Сценарий создания тегов

Этот сценарий управляется страницей TagsPage.xaml. Вы можете выбрать язык для тегов визуальных характеристик изображения и просмотреть изображение и результаты. Страница сценария использует следующие методы в зависимости от источника изображения:

* UploadAndGetTagsForImageAsync  
  Этот метод используется для локальных изображений, в которых изображение должно быть закодировано как `Stream` и отправлено в API компьютерного зрения путем вызова метода `ComputerVisionClient.TagImageInStreamAsync`.
* GenerateTagsForUrlAsync  
  Этот метод используется для удаленных изображений, в которых URL-адрес изображения отправляется в API компьютерного зрения путем вызова метода `ComputerVisionClient.TagImageAsync`.

Метод `UploadAndGetTagsForImageAsync` создает новый экземпляр `ComputerVisionClient` с помощью указанного ключа подписки и URL-адреса конечной точки. Так как пример приложения анализирует локальное изображение, он должен отправить содержимое этого изображения в API компьютерного зрения. Он открывает локальный файл, указанный в `imageFilePath`, для чтения в виде `Stream`, а затем получает язык, выбранный на странице сценария. Он вызывает метод `ComputerVisionClient.TagImageInStreamAsync`, передавая `Stream` для файла и язык, а затем возвращает результат в виде экземпляра `TagResult`. Методы, наследуемые от класса `ImageScenarioPage`, представляют возвращенные результаты на странице сценария.

Метод `GenerateTagsForUrlAsync` создает новый экземпляр `ComputerVisionClient` с помощью указанного ключа подписки и URL-адреса конечной точки. Он возвращает язык, выбранный на странице сценария. Он вызывает метод `ComputerVisionClient.TagImageAsync`, передавая URL-адрес изображения и язык, а затем возвращает результат в виде экземпляра `TagResult`. Методы, наследуемые от класса `ImageScenarioPage`, представляют возвращенные результаты на странице сценария.

## <a name="explore-the-recognize-text-ocr-scenario"></a>Сценарий распознавания текста (OCR)

Этот сценарий управляется страницей OCRPage.xaml. Вы можете выбрать язык для распознавания и извлечения печатного текста с изображения и просмотреть изображение и результаты. Страница сценария использует следующие методы в зависимости от источника изображения:

* UploadAndRecognizeImageAsync  
  Этот метод используется для локальных изображений, в которых изображение должно быть закодировано как `Stream` и отправлено в API компьютерного зрения путем вызова метода `ComputerVisionClient.RecognizePrintedTextInStreamAsync`.
* RecognizeUrlAsync  
  Этот метод используется для удаленных изображений, в которых URL-адрес изображения отправляется в API компьютерного зрения путем вызова метода `ComputerVisionClient.RecognizePrintedTextAsync`.

Метод `UploadAndRecognizeImageAsync` создает новый экземпляр `ComputerVisionClient` с помощью указанного ключа подписки и URL-адреса конечной точки. Так как пример приложения анализирует локальное изображение, он должен отправить содержимое этого изображения в API компьютерного зрения. Он открывает локальный файл, указанный в `imageFilePath`, для чтения в виде `Stream`, а затем получает язык, выбранный на странице сценария. Он вызывает метод `ComputerVisionClient.RecognizePrintedTextInStreamAsync`, указывающий, что ориентация не распознана, и передающий `Stream` для файла и язык, а затем возвращает результат в виде экземпляра `OcrResult`. Методы, наследуемые от класса `ImageScenarioPage`, представляют возвращенные результаты на странице сценария.

Метод `RecognizeUrlAsync` создает новый экземпляр `ComputerVisionClient` с помощью указанного ключа подписки и URL-адреса конечной точки. Он возвращает язык, выбранный на странице сценария. Он вызывает метод `ComputerVisionClient.RecognizePrintedTextAsync`, указывающий, что ориентация не распознана, и передающий URL-адрес изображения и язык, а затем возвращает результат в виде экземпляра `OcrResult`. Методы, наследуемые от класса `ImageScenarioPage`, представляют возвращенные результаты на странице сценария.

## <a name="explore-the-recognize-text-v2-english-scenario"></a>Сценарий распознавания текста V2 (на английском языке)

Этот сценарий управляется страницей TextRecognitionPage.xaml. Вы можете выбрать режим распознавания и язык для асинхронного распознавания и извлечения рукописного или печатного текста с изображения и просмотреть изображение и результаты. Страница сценария использует следующие методы в зависимости от источника изображения:

* UploadAndRecognizeImageAsync  
  Этот метод используется для локальных изображений, в которых изображение должно быть закодировано как `Stream` и отправлено в API компьютерного зрения путем вызова метода `RecognizeAsync` и передачи параметризованного делегата для метода `ComputerVisionClient.RecognizeTextInStreamAsync`.
* RecognizeUrlAsync  
  Этот метод используется для удаленных изображений, в которых URL-адрес изображения отправляется в API компьютерного зрения путем вызова метода `RecognizeAsync` и передачи параметризованного делегата для метода `ComputerVisionClient.RecognizeTextAsync`.
* RecognizeAsync Этот метод обрабатывает асинхронные вызовы для методов `UploadAndRecognizeImageAsync` и `RecognizeUrlAsync`, а также проводит опрос для сбора результатов путем вызова метода `ComputerVisionClient.GetTextOperationResultAsync`.

В отличие от других сценариев, включенных в пример приложения API компьютерного зрения, этот сценарий является асинхронным, так как для запуска процесса вызывается один метод, а для проверки состояния и возврата результатов процесса вызывается другой метод. Логический поток в этом сценарии несколько отличается от других сценариев.

Метод `UploadAndRecognizeImageAsync` открывает локальный файл, указанный в `imageFilePath`, для чтения в виде `Stream`, затем вызывает метод `RecognizeAsync`, передавая:

* Лямбда-выражение для параметризованного асинхронного делегата метода `ComputerVisionClient.RecognizeTextInStreamAsync` с `Stream` для файла и режимом распознавания в качестве параметров в `GetHeadersAsyncFunc`.
* Лямбда-выражение для делегата для получения значения заголовка ответа `Operation-Location` в `GetOperationUrlFunc`.

Метод `RecognizeUrlAsync` вызывает метод `RecognizeAsync`, передавая:

* Лямбда-выражение для параметризованного асинхронного делегата метода `ComputerVisionClient.RecognizeTextAsync` с URL-адресом удаленного изображения и режимом распознавания в качестве параметров в `GetHeadersAsyncFunc`.
* Лямбда-выражение для делегата для получения значения заголовка ответа `Operation-Location` в `GetOperationUrlFunc`.

Когда метод `RecognizeAsync` завершается, методы `UploadAndRecognizeImageAsync` и `RecognizeUrlAsync` возвращают результат в виде экземпляра `TextOperationResult`. Методы, наследуемые от класса `ImageScenarioPage`, представляют возвращенные результаты на странице сценария.

Метод `RecognizeAsync` вызывает параметризованный делегат для метода `ComputerVisionClient.RecognizeTextInStreamAsync` или `ComputerVisionClient.RecognizeTextAsync`, переданного в `GetHeadersAsyncFunc`, и ожидает ответа. Затем метод вызывает делегат, переданный в `GetOperationUrlFunc`, чтобы получить значение заголовка ответа `Operation-Location` из ответа. Это значение представляет собой URL-адрес, использованный для получения результатов метода, переданного в `GetHeadersAsyncFunc` из API компьютерного зрения.

Затем метод `RecognizeAsync` вызывает метод `ComputerVisionClient.GetTextOperationResultAsync`, передавая URL-адрес, полученный из заголовка ответа `Operation-Location`, чтобы получить состояние и результат метода, переданного в `GetHeadersAsyncFunc`. Если состояние не указывает, что метод завершен, успешно или неуспешно, метод `RecognizeAsync` вызывает `ComputerVisionClient.GetTextOperationResultAsync` еще три раза и ждет три секунды между вызовами. Метод `RecognizeAsync` возвращает результаты в метод, который его вызвал.

## <a name="explore-the-get-thumbnail-scenario"></a>Сценарий получения эскиза

Этот сценарий управляется страницей ThumbnailPage.xaml. Вы можете указать, следует ли использовать интеллектуальную обрезку, а также задать требуемую высоту и ширину, чтобы создать эскиз из изображения и просмотреть изображение и результаты. Страница сценария использует следующие методы в зависимости от источника изображения:

* UploadAndThumbnailImageAsync  
  Этот метод используется для локальных изображений, в которых изображение должно быть закодировано как `Stream` и отправлено в API компьютерного зрения путем вызова метода `ComputerVisionClient.GenerateThumbnailInStreamAsync`.
* ThumbnailUrlAsync  
  Этот метод используется для удаленных изображений, в которых URL-адрес изображения отправляется в API компьютерного зрения путем вызова метода `ComputerVisionClient.GenerateThumbnailAsync`.

Метод `UploadAndThumbnailImageAsync` создает новый экземпляр `ComputerVisionClient` с помощью указанного ключа подписки и URL-адреса конечной точки. Так как пример приложения анализирует локальное изображение, он должен отправить содержимое этого изображения в API компьютерного зрения. Он открывает локальный файл, указанный в `imageFilePath`, для чтения в виде `Stream`. Он вызывает метод `ComputerVisionClient.GenerateThumbnailInStreamAsync`, передавая ширину, высоту и `Stream` для файла, а также указывая, следует ли использовать интеллектуальную обрезку, а затем возвращает результат в виде `Stream`. Методы, наследуемые от класса `ImageScenarioPage`, представляют возвращенные результаты на странице сценария.

Метод `RecognizeUrlAsync` создает новый экземпляр `ComputerVisionClient` с помощью указанного ключа подписки и URL-адреса конечной точки. Он вызывает метод `ComputerVisionClient.GenerateThumbnailAsync`, передавая ширину, высоту и URL-адрес для изображения, а также указывая, следует ли использовать интеллектуальную обрезку, а затем возвращает результат в виде `Stream`. Методы, наследуемые от класса `ImageScenarioPage`, представляют возвращенные результаты на странице сценария.

## <a name="clean-up-resources"></a>Очистка ресурсов

Удалите папку, куда вы клонировали репозиторий `Microsoft/Cognitive-Vision-Windows`, если она вам больше не нужна. Если вы решили использовать примеры изображений, также удалите папку, в которую вы клонировали репозиторий `Microsoft/Cognitive-Face-Windows`.

## <a name="next-steps"></a>Дальнейшие действия

> [!div class="nextstepaction"]
> [Начало работы с API Распознавания лиц](../../Face/Tutorials/FaceAPIinCSharpTutorial.md)
