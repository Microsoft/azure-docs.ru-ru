---
title: Руководство по Применение пользовательского средства обнаружения логотипов для распознавания служб Azure. Средство "Пользовательское визуальное распознавание"
titleSuffix: Azure Cognitive Services
description: В этом руководстве описан пример приложения, в котором средство "Пользовательское визуальное распознавание" используется в сценарии обнаружения логотипа. Узнайте, как средство "Пользовательское визуальное распознавание" используется с другими компонентами для создания комплексного приложения.
services: cognitive-services
author: PatrickFarley
manager: nitinme
ms.service: cognitive-services
ms.subservice: custom-vision
ms.topic: tutorial
ms.date: 11/23/2020
ms.author: pafarley
ms.custom: devx-track-csharp, devx-track-azurecli
ms.openlocfilehash: 76e7b061670f603007cefd6d7aed503e0e0d3d6b
ms.sourcegitcommit: 910a1a38711966cb171050db245fc3b22abc8c5f
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "98941783"
---
# <a name="tutorial-recognize-azure-service-logos-in-camera-pictures"></a>Руководство по Распознавание логотипов служб Azure на изображениях с камеры

В этом руководстве вы изучите приложение, в котором средство "Пользовательское визуальное распознавание" используется на одном из этапов сложного сценария. Приложение AI Visual Provision (на базе Xamarin.Forms) для мобильных платформ анализирует изображения логотипов служб Azure с камеры, а затем развертывает эти службы в учетной записи пользователя Azure. В этой статье описано, как применять средство "Пользовательское визуальное распознавание" совместно с другими компонентами для создания эффективного комплексного приложения. Вы можете самостоятельно создать весь сценарий для приложения или настроить только средство "Пользовательское визуальное распознавание" и изучить его применение в приложении.

В этом учебнике показано, как выполнять следующие действия.

> [!div class="checklist"]
> - создание пользовательского средства обнаружения объектов для распознавания логотипов служб Azure;
> - подключение приложения к службам Azure "Компьютерное зрение" и "Пользовательское визуальное распознавание";
> - создание учетной записи субъекта-службы Azure для развертывания служб Azure из приложения.

Если у вас еще нет подписки Azure, [создайте бесплатную учетную запись](https://azure.microsoft.com/free/cognitive-services/), прежде чем начинать работу. 

## <a name="prerequisites"></a>Предварительные требования

- [Visual Studio 2017 или более поздней версии](https://www.visualstudio.com/downloads/)
- Рабочая нагрузка Xamarin для Visual Studio (см. дополнительные сведения в статье [Установка Xamarin в Visual Studio 2017](/xamarin/cross-platform/get-started/installation/windows)).
- эмулятор iOS или Android для Visual Studio;
- [Azure CLI](/cli/azure/install-azure-cli-windows) (необязательно).

## <a name="get-the-source-code"></a>Получение исходного кода

Если вы хотите использовать предоставленное веб-приложение, клонируйте или скачайте его исходный код из репозитория [AI Visual Provision](https://github.com/Microsoft/AIVisualProvision) на сайте GitHub. Откройте файл *Source/VisualProvision.sln* в Visual Studio. Позже вы измените некоторые файлы проекта, чтобы запустить приложение.

## <a name="create-an-object-detector"></a>Создание средства обнаружения объектов

Войдите на веб-сайт [Пользовательского визуального распознавания](https://customvision.ai/) и создайте проект. Укажите тип проекта Object Detection (Обнаружение объектов) и выберите в разделе Domains (Области) пункт Logo (Логотип). Это позволит службе использовать алгоритм, оптимизированный для обнаружения логотипов. 

![Окно создания проекта на веб-сайте Пользовательского визуального распознавания в браузере Chrome](media/azure-logo-tutorial/new-project.png)

## <a name="upload-and-tag-images"></a>Отправка и снабжение тегами изображений

Теперь обучите алгоритм обнаружения логотипов, отправив изображения логотипов служб Azure и вручную присвоив им теги. В репозитории AIVisualProvision есть набор изображений, которые можно использовать для обучения. Нажмите на веб-сайте кнопку **Add images** (Добавить изображения), которую вы найдете на вкладке **Training Images** (Изображения для обучения). Затем перейдите к папке репозитория **Documents/Images/Training_DataSet**. Вам придется вручную добавить теги логотипов к каждому изображению. Если этот проект вам нужен только для теста, лучше загрузить только часть изображений. Отправьте по меньшей мере 15 примеров для каждого тега, который вы намерены использовать.

После загрузки обучающих изображений выберите на экране первое из них. Откроется окно расстановки тегов. На каждом изображении выделите рамкой каждый логотип и присвойте ему тег. 

![Добавление тегов на веб-сайте службы "Пользовательское визуальное распознавание"](media/azure-logo-tutorial/tag-logos.png)

Это приложение настроено на работу с конкретным форматом строк для тегов. Определения можно найти в файле *Source\VisualProvision\Services\Recognition\RecognitionService.cs*:

[!code-csharp[Tag definitions](~/AIVisualProvision/Source/VisualProvision/Services/Recognition/RecognitionService.cs?name=snippet_constants)]

Присвоив тег, перейдите к следующему изображению. Завершив процесс, закройте окно добавления тегов.

## <a name="train-the-object-detector"></a>Обучение средства обнаружения объектов

На панели слева установите переключатель **Tags** (Теги) в положение **Tagged** (С тегом), чтобы отобразить нужные изображения. Затем нажмите зеленую кнопку в верхней части страницы, чтобы начать обучение модели. Вы обучите алгоритм распознавать одинаковые теги на новых изображениях. Алгоритм также протестирует модель на нескольких существующих изображениях, чтобы создать оценки точности.

![Сайт Пользовательского визуального распознавания, на котором открыта вкладка Training Images (Изображения для обучения). На этом снимке экрана выделена кнопка Train (Обучение)](media/azure-logo-tutorial/train-model.png)

## <a name="get-the-prediction-url"></a>Получение URL-адреса прогнозирования

Завершив обучение модели, вы можете интегрировать ее в свое приложение. Вам нужно получить URL-адрес конечной точки (адрес вашей модели, запрашиваемый приложением) и ключ прогнозирования (чтобы предоставить приложению доступ к запросам прогнозирования). В верхней части страницы на вкладке **Performance** (Производительность) нажмите кнопку **Prediction URL** (URL-адрес прогнозирования).

![Веб-сайт Пользовательского визуального распознавания, на котором открыто окно API прогнозирования со значениями URL-адреса и ключа API](media/azure-logo-tutorial/cusvis-endpoint.png)

Скопируйте URL-адрес конечной точки и значение **Prediction-Key** в соответствующие поля в файле *Source\VisualProvision\AppSettings.cs*:

[!code-csharp[Custom Vision fields](~/AIVisualProvision/Source/VisualProvision/AppSettings.cs?name=snippet_cusvis_keys)]

## <a name="examine-custom-vision-usage"></a>Проверка работы Пользовательского визуального распознавания

Откройте файл *Source/VisualProvision/Services/Recognition/CustomVisionService.cs*, чтобы проверить, как ключ и URL-адрес конечной точки Пользовательского визуального распознавания используются в приложении. Метод **PredictImageContentsAsync** принимает поток байтов файла изображения с токеном отмены (для управления асинхронными задачами), вызывает API прогнозирования Пользовательского визуального распознавания и возвращает результат прогнозирования. 

[!code-csharp[Custom Vision fields](~/AIVisualProvision/Source/VisualProvision/Services/Recognition/CustomVisionService.cs?name=snippet_prediction)]

Этот результат принимает форму экземпляра **PredictionResult**, который в свою очередь содержит список экземпляров **Prediction**. Экземпляр **Prediction** содержит обнаруженный тег и расположение ограничивающего прямоугольника на изображении.

[!code-csharp[Custom Vision fields](~/AIVisualProvision/Source/VisualProvision/Services/Recognition/Prediction.cs?name=snippet_prediction_class)]

Чтобы узнать больше о том, как приложение обрабатывает эти данные, изучите метод **GetResourcesAsync**. Этот метод определен в файле *Source/VisualProvision/Services/Recognition/RecognitionService.cs*.  

## <a name="add-computer-vision"></a>Добавление API "Компьютерное зрение"

Итак, мы завершили настройку службы "Пользовательское визуальное распознавание" для примера из этого руководства. Если вы хотите запустить это приложение, интегрируйте в него еще и службу "Компьютерное зрение". Приложение использует функцию распознавания текста из службы "Компьютерное зрение", чтобы дополнить процесс обнаружения логотипов. Логотип Azure можно распознать как по внешнему виду, так *и* по размещенному рядом с ним тексту. В отличие от моделей Пользовательского визуального распознавания, служба "Компьютерное зрение" предварительно обучена для выполнения определенных операций с изображениями или видео.

Оформите подписку на службу "Компьютерное зрение", чтобы получить ключ и URL-адрес конечной точки. Дополнительные инструкции по этому шагу см. в статье [Получение ключей подписки](../cognitive-services-apis-create-account.md?tabs=singleservice%2Cwindows).

![Служба Компьютерного зрения на портале Azure, где в меню выбран элемент "Быстрый запуск". Здесь выделены ссылка на ключи и URL-адрес конечной точки API.](media/azure-logo-tutorial/comvis-keys.png)

Теперь откройте файл *Source\VisualProvision\AppSettings.cs* и задайте переменным `ComputerVisionEndpoint` и `ComputerVisionKey` правильные значения.

[!code-csharp[Computer Vision fields](~/AIVisualProvision/Source/VisualProvision/AppSettings.cs?name=snippet_comvis_keys)]

## <a name="create-a-service-principal"></a>Создание субъекта-службы

Для развертывания служб в подписке Azure приложению потребуется учетная запись субъекта-службы. Субъект-служба позволяет делегировать приложению определенные разрешения с помощью управления доступом на основе ролей в Azure. Дополнительные сведения см. в статье [Предоставление приложениям доступа к ресурсам Azure Stack за счет создания субъектов-служб](/azure-stack/operator/azure-stack-create-service-principals).

Вы можете создать субъект-службу с помощью Azure Cloud Shell или Azure CLI, как показано далее. Для начала выполните вход и выберите подписку, которую вы намерены использовать.

```azurecli
az login
az account list
az account set --subscription "<subscription name or subscription id>"
```

Затем создайте субъект-службу. (Этот процесс может занять некоторое время.)

```azurecli
az ad sp create-for-rbac --name <servicePrincipalName> --password <yourSPStrongPassword>
```

После успешного завершения в выходных данных вы увидите представленный ниже код JSON, который содержит необходимые учетные данные.

```json
{
  "clientId": "(...)",
  "clientSecret": "(...)",
  "subscriptionId": "(...)",
  "tenantId": "(...)",
  ...
}
```

Запишите значения `clientId` и `tenantId`. Введите их в соответствующие поля в файле *Source\VisualProvision\AppSettings.cs*.

[!code-csharp[Computer Vision fields](~/AIVisualProvision/Source/VisualProvision/AppSettings.cs?name=snippet_serviceprincipal)]

## <a name="run-the-app"></a>Запустите приложение

На этом этапе вы предоставили приложению доступ к:

- обученной модели Пользовательского визуального распознавания;
- службе "Компьютерное зрение";
- учетной записи субъекта-службы.

Чтобы запустить приложение, сделайте следующее.

1. В обозревателе решений Visual Studio выберите проект **VisualProvision.Android** или **VisualProvision.iOS**. Выберите подходящий эмулятор или подключенное мобильное устройство в раскрывающемся меню на главной панели инструментов. Затем запустите приложение.

    > [!NOTE]
    > Для выполнения эмулятора iOS вам потребуется устройство MacOS.

1. На первом экране введите идентификатор клиента для субъекта-службы, идентификатор арендатора и пароль. Нажмите кнопку **Вход**.

    > [!NOTE]
    > В некоторых эмуляторах кнопка **Вход** может быть неактивной на этом этапе. В таком случае остановите приложение и откройте файл *Source/VisualProvision/Pages/LoginPage.xaml*. Найдите в нем элемент `Button` с меткой **LOGIN BUTTON** и удалите следующую строку, а затем снова запустите приложение.
    >  ```xaml
    >  IsEnabled="{Binding IsValid}"
    >  ```
    
    ![Экран приложения с полями для ввода учетных данных субъекта-службы](media/azure-logo-tutorial/app-credentials.png)

1. На следующем экране выберите подписку Azure в раскрывающемся списке. (Это меню должно содержать все подписки, к которым субъект-служба имеет доступ.) Нажмите кнопку **Продолжить**. На этом этапе приложение может выдать запрос на доступ к камере и хранилищу фотографий на вашем устройстве. Предоставьте требуемый доступ.

    ![Экран приложения с раскрывающимся полем "Целевая подписка Azure"](media/azure-logo-tutorial/app-az-subscription.png)


1. После этого на вашем устройстве включится камера. Сделайте снимок одного из логотипов служб Azure, который вы включили в обучение. В окне развертывания вам будет предложено выбрать регион и группу ресурсов для новых служб (как при развертывании на портале Azure). 

    ![Видоискатель камеры смартфона, наведенной на распечатанные логотипы Azure](media/azure-logo-tutorial/app-camera-capture.png)

    ![Экран приложения с полями для выбора региона развертывания и группы ресурсов](media/azure-logo-tutorial/app-deployment-options.png)

## <a name="clean-up-resources"></a>Очистка ресурсов

Если вы выполнили все шаги этого сценария и использовали приложение для развертывания служб Azure в своей учетной записи, перейдите на [портал Azure](https://ms.portal.azure.com/). Отключите здесь службы, которые вы не будете использовать.

Если вы планируете в будущем создать собственный проект обнаружения объектов с использованием Пользовательского визуального распознавания, лучше будет удалить проект обнаружения логотипов, созданный при работе с этим руководством. При работе в бесплатной подписке на Пользовательское визуальное распознавание можно создать только два проекта. Чтобы удалить проект обнаружения логотипов, откройте раздел **Projects** (Проекты) на [веб-сайте Пользовательского визуального распознавания](https://customvision.ai) и выберите значок корзины в разделе **My New Project** (Мой новый проект).

## <a name="next-steps"></a>Дальнейшие действия

Изучая это руководство, вы настроили и освоили полнофункциональное приложение Xamarin.Forms, в котором применяется Пользовательское визуальное распознавание для обнаружения логотипов на изображениях с камер мобильных устройств. Теперь изучите рекомендации по созданию модели Пользовательского визуального распознавания, чтобы научиться создавать эффективно функционирующие модели для собственных приложений.

> [!div class="nextstepaction"]
> [Как улучшить классификатор](getting-started-improving-your-classifier.md)
