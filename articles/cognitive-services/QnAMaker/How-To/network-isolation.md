---
title: Сетевая изоляция
description: Пользователи могут ограничить общий доступ к ресурсам QnA Maker.
ms.service: cognitive-services
ms.subservice: qna-maker
ms.topic: conceptual
ms.date: 11/09/2020
ms.openlocfilehash: 8fe8c07866b23e5d990b71bfc9cd556c338634d3
ms.sourcegitcommit: dda0d51d3d0e34d07faf231033d744ca4f2bbf4a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/05/2021
ms.locfileid: "102203374"
---
# <a name="recommended-settings-for-network-isolation"></a>Рекомендуемые параметры для сетевой изоляции

Выполните следующие действия, чтобы ограничить общий доступ к ресурсам QnA Maker. Защитите ресурс Cognitive Services от общего доступа, [настроив виртуальную сеть](../../cognitive-services-virtual-networks.md?tabs=portal).

## <a name="restrict-access-to-cognitive-search-resource"></a>Ограничение доступа к Когнитивный поиск ресурсу

# <a name="qna-maker-ga-stable-release"></a>[Общедоступная версия QnA Maker (стабильный выпуск)](#tab/v1)

Настройка Когнитивный поиск в качестве частной конечной точки в виртуальной сети. Когда экземпляр поиска создается во время создания QnA Maker ресурса, можно принудительно Когнитивный поиск для поддержки конфигурации частной конечной точки, созданной полностью в виртуальной сети клиента.

Чтобы использовать закрытую конечную точку, все ресурсы должны быть созданы в одном регионе.

* Ресурс QnA Maker
* новый ресурс Когнитивный поиск
* новый ресурс виртуальной сети

Выполните следующие действия в [портал Azure](https://portal.azure.com).

1. Создайте [ресурс QnA Maker](https://ms.portal.azure.com/#create/Microsoft.CognitiveServicesQnAMaker).
2. Создайте новый ресурс Когнитивный поиск с подключением к конечной точке (Data), имеющим значение _частный_. Создайте ресурс в том же регионе, в котором находится ресурс QnA Maker, созданный на шаге 1. Узнайте больше о [создании когнитивный поиск ресурса](../../../search/search-create-service-portal.md), а затем используйте эту ссылку, чтобы перейти непосредственно на [страницу создания ресурса](https://ms.portal.azure.com/#create/Microsoft.Search).
3. Создайте новый [ресурс виртуальной сети](https://ms.portal.azure.com/#create/Microsoft.VirtualNetwork-ARM).
4. Настройте виртуальную сеть на ресурсе службы приложений, созданном на шаге 1 этой процедуры. Создайте новую запись DNS в виртуальной сети для нового ресурса Когнитивный поиск, созданного на шаге 2. в Когнитивный поискный IP-адрес.
5. [Свяжите службу приложений с новым когнитивный Поиск ресурсом,](../how-to/set-up-qnamaker-service-azure.md) созданным на шаге 2. Затем можно удалить исходный ресурс Когнитивный поиск, созданный на шаге 1.
    
На [портале QnA Maker](https://www.qnamaker.ai/)Создайте первую базу знаний.

#  <a name="qna-maker-managed-preview-release"></a>[Управляемая служба QnA Maker (предварительный выпуск)](#tab/v2)

[Создайте частные конечные точки](../reference-private-endpoint.md) для ресурса поиска Azure.

---

## <a name="restrict-access-to-app-service-qna-runtime"></a>Ограничение доступа к службе приложений (среда выполнения QnA)

Вы можете добавить IP-адреса в службу приложений разрешенных, чтобы ограничить доступ или настроить среду службы приложений для размещения службы приложений QnA Maker.

#### <a name="add-ips-to-app-service-allowlist"></a>Добавление IP-адресов в службу приложений разрешенных

1. Разрешать трафик только с Cognitive Services IP-адресов. Они уже включены в тег службы `CognitiveServicesManagement` . Это необходимо для создания API-интерфейсов (создания или обновления базы знаний), чтобы вызвать службу приложений и соответствующим образом обновить службу поиска Azure. Ознакомьтесь с [дополнительными сведениями о тегах служб.](../../../virtual-network/service-tags-overview.md)
2. Убедитесь, что вы также Разрешите другим точкам входа, таким как служба Azure Bot, QnA Maker портал и т. д., для доступа к API прогнозирования "Женератеансвер".
3. Выполните следующие действия, чтобы добавить диапазоны IP-адресов в разрешенных:

   1. Скачайте [диапазоны IP-адресов для всех тегов служб](https://www.microsoft.com/download/details.aspx?id=56519).
   2. Выберите IP-адреса для "Когнитивесервицесманажемент".
   3. Перейдите к разделу "сети" ресурса службы приложений и щелкните "настроить ограничение доступа", чтобы добавить IP-адреса в разрешенных.

    ![исключения входящих портов](../media/inbound-ports.png)

Кроме того, у нас есть автоматизированный сценарий для того, чтобы сделать то же самое для службы приложений. Вы можете найти [сценарий PowerShell для настройки разрешенных](https://github.com/pchoudhari/QnAMakerBackupRestore/blob/master/AddRestrictedIPAzureAppService.ps1) на GitHub. Необходимо ввести идентификатор подписки, группу ресурсов и фактическое имя службы приложений в качестве параметров скрипта. При выполнении скрипта будут автоматически добавлены IP-адреса в службу приложений разрешенных.

#### <a name="configure-app-service-environment-to-host-qna-maker-app-service"></a>Настройка Среда службы приложений для размещения службы приложений QnA Maker
    
Среда службы приложений (ASE) можно использовать для размещения службы приложений QnA Maker. Выполните следующие действия.

1. Создайте Среда службы приложений и пометьте ее как "внешний". Инструкции см. в [руководстве](../../../app-service/environment/create-external-ase.md) .
2.  Создайте службу приложений в Среда службы приложений.
    1. Проверьте конфигурацию службы приложений и добавьте "Примарендпоинткэй" в качестве параметра приложения. Для параметра "Примарендпоинткэй" должно быть задано значение " \<app-name\> -примарендпоинткэй". Имя приложения определяется в URL-адресе службы приложений. Например, если URL-адрес службы приложений имеет значение "mywebsite.myase.p.azurewebsite.net", то имя приложения — "mywebsite". В этом случае для параметра "Примарендпоинткэй" должно быть задано значение "mywebsite-Примарендпоинткэй".
    2. Создайте службу поиска Azure.
    3. Убедитесь, что параметры поиска Azure и приложения настроены соответствующим образом. 
          Следуйте указаниям в этом [руководстве](../reference-app-service.md?tabs=v1#app-service).
3.  Обновите группу безопасности сети, связанную с Среда службы приложений
    1. Обновите предварительно созданные правила безопасности для входящего трафика в соответствии с вашими требованиями.
    2. Добавьте новое правило безопасности входящего трафика с исходным кодом как тег службы и тегом исходной службы как "Когнитивесервицесманажемент".
4.  Создайте QnA Makerный экземпляр службы (Microsoft. CognitiveServices/Accounts) с помощью Azure Resource Manager, где QnA Maker конечной точке должна быть установлена конечная точка службы приложений, созданная выше (https://mywebsite.myase.p.azurewebsite.net).
    
---
