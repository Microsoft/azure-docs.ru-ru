---
title: Тестирование DevOps для приложений LUIS
description: Как протестировать приложение Распознавание речи (LUIS) в среде DevOps.
ms.service: cognitive-services
ms.subservice: language-understanding
ms.topic: conceptual
ms.date: 06/3/2020
ms.openlocfilehash: cd2fd8dc8c10864089b198db1ca1089f994a3ffb
ms.sourcegitcommit: a055089dd6195fde2555b27a84ae052b668a18c7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/26/2021
ms.locfileid: "98788457"
---
# <a name="testing-for-luis-devops"></a>Тестирование для LUIS DevOps

Разработчики программного обеспечения, которые разрабатывают приложение Распознавание речи (LUIS), могут применять DevOps рекомендации по управлению [версиями](luis-concept-devops-sourcecontrol.md), [автоматизированным сборкам](luis-concept-devops-automation.md), [тестированию](luis-concept-devops-testing.md)и [управлению выпусками](luis-concept-devops-automation.md#release-management) , следуя этим рекомендациям.

В методиках гибкой разработки программного обеспечения тестирование играет важную роль в разработке качественного программного обеспечения. Каждое существенное изменение приложения LUIS должно сопровождаться тестами, предназначенными для тестирования новых функциональных возможностей, создаваемых разработчиком в приложении. Эти тесты возвращаются в репозиторий исходного кода вместе с `.lu` источником приложения Luis. Реализация изменения завершается, когда приложение удовлетворяет тестам.

Тесты являются важной частью [рабочих процессов CI/CD](luis-concept-devops-automation.md). Если изменения в приложении LUIS предложены в запросе на включение внесенных изменений или после их слияния в основную ветвь, то рабочие процессы CI должны выполнить тесты, чтобы убедиться, что обновления не привели к регрессии.

## <a name="how-to-do-unit-testing-and-batch-testing"></a>Как выполнять модульное тестирование и пакетное тестирование

Существует два различных типа тестирования для приложения LUIS, которые необходимо выполнить в рабочих процессах непрерывной интеграции:

- **Модульные тесты** — сравнительно простые тесты, которые проверяют ключевую функциональность приложения Luis. Модульный тест проходит, когда для заданного тестового utterance возвращается ожидаемое намерение и ожидаемые сущности. Для успешного выполнения тестового запуска должны пройти все модульные тесты.  
Этот тип тестирования похож на [интерактивное тестирование](./luis-concept-test.md) , которое можно выполнить на [портале Luis](https://www.luis.ai/).

- **Пакетные тесты** — пакетное тестирование — это комплексный тест текущей обученной модели для измерения производительности. В отличие от модульных тестов, пакетное тестирование не проходит | тестирование сбоя. Ожидание в пакетном тестировании — это не то, что каждый тест будет возвращать ожидаемое намерение и ожидаемые сущности. Вместо этого пакетный тест позволяет просматривать точность каждой цели и сущности в приложении и помогает сравнивать их с течением времени по мере внесения усовершенствований.  
Этот тип тестирования аналогичен [пакетному тестированию](./luis-how-to-batch-test.md) , которое можно выполнять в интерактивном режиме на портале Luis.

Модульное тестирование можно использовать в начале проекта. Пакетное тестирование действительно является значением только после того, как вы разработали схему приложения LUIS и работаете над улучшением его точности.

Для модульных тестов и пакетных тестов убедитесь, что тестовый фразы продолжительностью хранится отдельно от обучающего фразы продолжительностью. При тестировании на те же данные, которые вы обучили, вы получаете ложное впечатление, что приложение работает нормально, когда оно просто перемещается на проверочные данные. В модели тесты должны быть невидимыми для проверки того, насколько хорошо она обобщается.

### <a name="writing-tests"></a>Написание тестов

При написании набора тестов для каждого теста необходимо определить:

* Тестовая фраза
* Ожидаемое намерение
* Ожидаемые сущности.

Используйте [синтаксис пакетного файла](./luis-how-to-batch-test.md#batch-syntax-template-for-intents-with-entities) Luis для определения группы тестов в файле в формате JSON. Пример:

```JSON
[
  {
    "text": "example utterance goes here",
    "intent": "intent name goes here",
    "entities":
    [
        {
            "entity": "entity name 1 goes here",
            "startPos": 14,
            "endPos": 23
        },
        {
            "entity": "entity name 2 goes here",
            "startPos": 14,
            "endPos": 23
        }
    ]
  }
]
```

Некоторые инструменты тестирования, например [НЛУ. DevOps](https://github.com/microsoft/NLU.DevOps) также поддерживает файлы тестов в формате лудовн.

#### <a name="designing-unit-tests"></a>Проектирование модульных тестов

Модульные тесты должны быть разработаны для тестирования основных функций приложения LUIS. В каждой итерации или спринте разработки приложения необходимо написать достаточное количество тестов, чтобы убедиться в правильной работе ключевых функций, реализуемых в этой итерации.

В каждом модульном тесте для данного теста utterance можно:

* Проверка того, что возвращается правильное намерение
* Проверка того, что возвращаются сущности "Key", которые являются критически важными для вашего решения.
* Проверка того, что [Оценка прогноза](./luis-concept-prediction-score.md) для цели и сущностей превышает заданное пороговое значение. Например, можно принять решение о том, что тест прошел успешно, если оценка прогноза для цели и для ключевых сущностей превышает 0,75.

В модульных тестах рекомендуется проверить, что ключевые сущности были возвращены в ответе прогноза, но игнорировать любые ложные срабатывания. *Ложные срабатывания* — это сущности, обнаруженные в отклике прогноза, но не определенные в ожидаемых результатах для теста. Игнорируя ложные срабатывания, это позволяет меньше обременительным создавать модульные тесты, не позволяя сосредоточиться на тестировании того, что данные, которые являются ключевыми для решения, возвращаются в виде прогнозирующего ответа.

> [!TIP]
> [НЛУ. Средство DevOps](https://github.com/microsoft/NLU.DevOps) поддерживает все ваши потребности в тестировании Luis. `compare`Команда при использовании в [режиме модульного тестирования](https://github.com/microsoft/NLU.DevOps/blob/master/docs/Analyze.md#unit-test-mode) будет утверждать, что все тесты пройдены, и будет игнорировать ложные положительные результаты для сущностей, которые не помечены в ожидаемых результатах.

#### <a name="designing-batch-tests"></a>Проектирование пакетных тестов

Наборы пакетных тестов должны содержать большое количество тестовых случаев, предназначенных для тестирования всех целей и всех сущностей в приложении LUIS. Сведения об определении набора пакетных тестов см. [в разделе пакетное тестирование на портале Luis](./luis-how-to-batch-test.md) .

### <a name="running-tests"></a>Выполнение тестов

Портал LUIS предлагает функции для интерактивного тестирования:

* [**Интерактивное тестирование**](./luis-concept-test.md) позволяет отправить пример utterance и получить ответ на ПРИЗНАНные LUISы и сущности. Проверка успешности теста выполняется визуальной проверкой.

* [**Пакетное тестирование**](./luis-how-to-batch-test.md) использует файл пакетного теста в качестве входных данных для проверки своей активной обученной версии для измерения точности прогнозов. Пакетный тест позволяет просматривать точность каждой цели и сущности в активной версии, отображая результаты с диаграммой.

#### <a name="running-tests-in-an-automated-build-workflow"></a>Выполнение тестов в рабочем процессе автоматической сборки

Функции интерактивного тестирования на портале LUIS полезны, но для DevOps автоматизированное тестирование, выполняемое в рабочем процессе CI/CD, приводит к определенным требованиям.

* Инструменты тестирования должны выполняться на шаге рабочего процесса на сервере сборки. Это означает, что средства должны быть способны работать в командной строке.
* Средства тестирования должны иметь возможность выполнять группу тестов для конечной точки и автоматически проверять ожидаемые результаты по реальным результатам.
* Если тесты завершаются ошибкой, средства тестирования должны возвращать код состояния для остановки рабочего процесса и "Завершить сборку".

LUIS не предлагает средство командной строки или интерфейс API высокого уровня, предлагающий эти функции. Рекомендуется использовать [НЛУ. Средство DevOps](https://github.com/microsoft/NLU.DevOps) для выполнения тестов и проверки результатов как в командной строке, так и во время автоматического тестирования в рамках рабочего процесса CI/CD.

Возможности тестирования, доступные на портале LUIS, не нуждаются в опубликованной конечной точке и являются частью возможностей создания LUIS. При реализации тестирования в рабочем процессе автоматизированной сборки необходимо опубликовать версию приложения LUIS для тестирования в конечной точке, чтобы средства тестирования, такие как НЛУ. DevOps может отсылать прогнозирующие запросы в ходе тестирования.

> [!TIP]
> * Если вы реализуете собственное решение для тестирования и пишете код для отправки тестового фразы продолжительностью в конечную точку, помните, что если вы используете ключ разработки LUIS, допустимая скорость транзакции ограничена 5TPS. Вместо этого следует регулировать скорость отправки или использовать ключ прогнозирования.
> * При отправке тестовых запросов в конечную точку не забудьте использовать `log=false` в строке запроса прогнозирующего запроса. Это гарантирует, что тест фразы продолжительностью не записался в журнал LUIS и завершится в списке проверки конечной точки фразы продолжительностью, представленном функцией LUIS [Active Learning](./luis-concept-review-endpoint-utterances.md) , и в результате они случайно добавляются в обучающий фразы продолжительностью приложения.

#### <a name="running-unit-tests-at-the-command-line-and-in-cicd-workflows"></a>Выполнение модульных тестов в командной строке и в рабочих процессах CI/CD

Можно использовать [НЛУ. Пакет DevOps](https://github.com/microsoft/NLU.DevOps) для запуска тестов из командной строки:

* Используйте НЛУ. [Команда теста](https://github.com/microsoft/NLU.DevOps/blob/master/docs/Test.md) DevOps для отправки тестов из тестового файла в конечную точку и для записи фактических результатов прогноза в файл.
* Используйте НЛУ. DevOps [Compare](https://github.com/microsoft/NLU.DevOps/blob/master/docs/Analyze.md) , чтобы сравнить фактические результаты с ожидаемыми результатами, определенными во входном тестовом файле. `compare`Команда создает выходные данные теста NUnit и при использовании в [режиме модульного тестирования](https://github.com/microsoft/NLU.DevOps/blob/master/docs/Analyze.md#unit-test-mode) с помощью `--unit-test` флага будет утверждать, что все тесты пройдены.

### <a name="running-batch-tests-at-the-command-line-and-in-cicd-workflows"></a>Выполнение пакетных тестов в командной строке и в рабочих процессах CI/CD

Можно также использовать НЛУ. Пакет DevOps для выполнения пакетных тестов из командной строки.

* Используйте НЛУ. DevOps [Test команда](https://github.com/microsoft/NLU.DevOps/blob/master/docs/Test.md) для отправки тестов из тестового файла в конечную точку и сбора фактических результатов прогноза в файле, как и при использовании модульных тестов.
* Используйте НЛУ. [Команда сравнения](https://github.com/microsoft/NLU.DevOps/blob/master/docs/Analyze.md) DevOps в [режиме тестирования производительности](https://github.com/microsoft/NLU.DevOps/blob/master/docs/Analyze.md#performance-test-mode) для измерения производительности приложения можно также сравнить производительность приложения с базовым показателем производительности, например результатами последней фиксации с основной или текущей версией. В режиме тестирования производительности `compare` команда создает выходные данные теста NUnit и [результаты пакетного теста](./luis-glossary.md#batch-test) в формате JSON.

## <a name="luis-non-deterministic-training-and-the-effect-on-testing"></a>LUIS недетерминированное обучение и воздействие на тестирование

Когда LUIS обучить модель, например, ей требуются как положительные данные, так и обучающие фразы продолжительностью, которые вы указали для обучения приложения для модели, и отрицательные *данные — недопустимые* примеры использования этой модели. Во время обучения LUIS создает отрицательные данные одной модели из всех положительных данных, предоставленных для других моделей, но в некоторых случаях может привести к дисбалансу данных. Чтобы избежать этого дисбаланса, LUIS выберет подмножество отрицательных данных в недетерминированном виде, чтобы оптимизировать для более сбалансированного обучающего набора, повысить производительность модели и ускорить обучение.

Результатом этого недетерминированного обучения является то, что вы можете получить несколько [иной прогнозирующий ответ между различными обучающими сеансами](./luis-concept-prediction-score.md), обычно для целей и (или) сущностей, в которых [Оценка прогноза](./luis-concept-prediction-score.md) не высока.

Если вы хотите отключить недетерминированное обучение для тех версий приложений LUIS, которые вы собираетесь использовать для тестирования, используйте [API параметров версии](https://westus.dev.cognitive.microsoft.com/docs/services/5890b47c39e2bb17b84a55ff/operations/versions-update-application-version-settings) с `UseAllTrainingData` параметром, для которого задано значение `true` .

## <a name="next-steps"></a>Дальнейшие действия

* Дополнительные сведения о [реализации рабочих процессов CI/CD](luis-concept-devops-automation.md)
* Узнайте, как [реализовать DevOps для Luis с GitHub](luis-how-to-devops-with-github.md)