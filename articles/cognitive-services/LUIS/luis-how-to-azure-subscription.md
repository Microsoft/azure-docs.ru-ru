---
title: Использование создания и ключей времени выполнения — LUIS
description: При первом использовании LUIS вам не нужно создавать ключ разработки. Если вы хотите опубликовать приложение, а затем использовать конечную точку среды выполнения, необходимо создать и назначить приложению ключ среды выполнения.
services: cognitive-services
ms.service: cognitive-services
ms.subservice: language-understanding
ms.topic: how-to
ms.date: 09/07/2020
ms.custom: devx-track-azurecli
ms.openlocfilehash: 168833ea0a451913f4ed019cba832a16207e0d9c
ms.sourcegitcommit: 867cb1b7a1f3a1f0b427282c648d411d0ca4f81f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "99988156"
---
# <a name="create-luis-resources"></a>Создание ресурсов LUIS

Создание и запрос ресурсов среды выполнения прогнозирующих запросов обеспечивает проверку подлинности для приложения Распознавание речи (LUIS) и конечной точки прогнозирования.

<a name="azure-resources-for-luis"></a>
<a name="programmatic-key" ></a>
<a name="endpoint-key"></a>
<a name="authoring-key"></a>

## <a name="luis-resources"></a>Ресурсы LUIS

LUIS позволяет выполнять три типа ресурсов Azure и один ресурс, не относящийся к Azure:

|Ресурс|Назначение|Служба для переприятия `kind`|Служба для переприятия `type`|
|--|--|--|--|
|Создание ресурса|Позволяет создавать, выполнять обучение, тестировать и публиковать приложения, а также управлять ими. [Создайте ресурс для создания Luis,](luis-how-to-azure-subscription.md#create-luis-resources-in-the-azure-portal) если вы планируете создавать приложения Luis программно или с портала Luis. Перед связыванием ресурсов разработки Azure с приложением необходимо [перенести учетную запись Luis](luis-migration-authoring.md#what-is-migration) . Вы можете управлять разрешениями на ресурсы разработки, назначив им [роль участника](#contributions-from-other-authors). <br><br> Для ресурса, LUISего создание, доступен один уровень:<br> <ul> <li>**Бесплатный ресурс для создания F0**, который предоставляет 1 000 000 бесплатных транзакций по созданию и 1 000 бесплатных запросов на конечную точку прогнозирования. |`LUIS.Authoring`|`Cognitive Services`|
|Ресурс для прогнозирования| После публикации приложения LUIS используйте прогнозирующий ресурс или ключ для запроса конечной точки прогнозирования. Создайте ресурс прогноза LUIS, прежде чем клиентское приложение запросит прогнозы за пределами 1 000 запросов, предоставляемых авторским или начальным ресурсом. <br><br> Для прогнозирующего ресурса доступны два уровня:<br><ul> <li> **Бесплатный F0ный ресурс прогнозирования**, который 10 000 предоставляет ежемесячные запросы на конечные точки прогнозирования.<br> <li> **Стандартный прогнозируемый ресурс S0**, который является платным уровнем. [Дополнительные сведения о ценах.](https://azure.microsoft.com/pricing/details/cognitive-services/language-understanding-intelligent-services/)|`LUIS`|`Cognitive Services`|
|Начальный или пробный ресурс|Позволяет создавать, выполнять обучение, тестировать и публиковать приложения, а также управлять ими. Этот ресурс создается по умолчанию, если при первом входе в LUIS вы выбираете параметр начальный ресурс. В конечном итоге начальный ключ будет устаревшим. Всем пользователям LUIS потребуется [перенести свои учетные записи](luis-migration-authoring.md#what-is-migration) и связать их Luis приложения с ресурсами для разработки. В отличие от ресурса разработки, этот ресурс не предоставляет разрешения на управление доступом на основе ролей в Azure. <br><br> Как и ресурс для разработки, начальный ресурс предоставляет 1 000 000 бесплатных транзакций по созданию и 1 000 бесплатных запросов на конечную точку прогнозирования.|-|Не является ресурсом Azure.|
|[Cognitive Services многосервисный ключ ресурса](../cognitive-services-apis-create-account-cli.md?tabs=windows#create-a-cognitive-services-resource)|Запросы конечной точки прогнозирования запросов, используемые совместно с LUIS и другими поддерживаемыми службами.|`CognitiveServices`|`Cognitive Services`|


> [!Note]
> LUIS предоставляет два типа ресурсов F0 (Free): один для создания транзакций и один для прогнозирующих транзакций. Если у вас не хватает квоты для прогнозирующих транзакций, убедитесь, что вы используете ресурс прогнозирования F0, который позволяет ежемесячно получить 10 000 бесплатных транзакций, а не ресурс для разработки, который выдает 1 000 прогнозирующих транзакций ежемесячно.

По завершении процесса создания ресурсов Azure [назначьте ресурс](#assign-a-resource-to-an-app) приложению на портале Luis.

> [!important]
> Вы должны создавать приложения LUIS в [регионах](luis-reference-regions.md#publishing-regions) , где вы хотите публиковать и запрашивать.

## <a name="resource-ownership"></a>Владение ресурсом

Ресурс Azure, например ресурс LUIS, принадлежит подписке, содержащей ресурс.

Чтобы изменить принадлежность ресурса, можно выполнить одно из следующих действий.
* Перенесите [владение](../../cost-management-billing/manage/billing-subscription-transfer.md) подпиской.
* Экспортируйте приложение LUIS в виде файла, а затем импортируйте приложение в другую подписку. Экспорт доступен на странице " **Мои приложения** " на портале Luis.

## <a name="resource-limits"></a>Ограничения ресурсов

### <a name="authoring-key-creation-limits"></a>Ограничения на создание ключа создания ключей

На одну подписку можно создать до 10 ключей разработки для каждого региона. Регионы публикации отличаются от регионов разработки. Убедитесь, что вы создали в области разработки приложение, соответствующее региону публикации, в котором должно располагаться клиентское приложение. Сведения о том, как области разработки сопоставляются с регионами публикации, см. в разделе [Создание и публикация регионов](luis-reference-regions.md). 

Дополнительные сведения об ограничениях ключей см. в разделе [ограничения ключей](luis-limits.md#key-limits).

### <a name="errors-for-key-usage-limits"></a>Ошибки для ограничений использования ключа

Ограничения использования основаны на ценовой категории.

При превышении квоты на количество транзакций в секунду вы получите ошибку HTTP 429. Если вы превысили квоту на один месяц (TPM), вы получите ошибку HTTP 403.


### <a name="reset-an-authoring-key"></a>Сброс ключа разработки

Для [перенесенных](luis-migration-authoring.md) приложений с ресурсами: Если ваш ключ разработки скомпрометирован, сбросьте ключ в портал Azure на странице **ключи** для ресурса разработки.

Для приложений, которые не были перенесены: ключ сброшен для всех приложений на портале LUIS. При создании приложения через веб-сайт разработки API необходимо изменить значение `Ocp-Apim-Subscription-Key` на новый ключ.

### <a name="regenerate-an-azure-key"></a>Повторное создание ключа Azure

Ключ Azure можно повторно создать на странице " **ключи** " в портал Azure.


<a name="securing-the-endpoint"></a>

## <a name="app-ownership-access-and-security"></a>Владение приложениями, доступ и безопасность

Приложение определяется ресурсами Azure, которые определяются подпиской владельца.

Вы можете переместить приложение LUIS. Используйте следующие ресурсы, чтобы сделать это с помощью портал Azure или Azure CLI.

* [Перемещение приложения между ресурсами по разработке LUIS](https://westus.dev.cognitive.microsoft.com/docs/services/5890b47c39e2bb17b84a55ff/operations/apps-move-app-to-another-luis-authoring-azure-resource)
* [Перемещение ресурса в новую группу ресурсов или подписку](../../azure-resource-manager/management/move-resource-group-and-subscription.md)
* [Перемещение ресурса в пределах одной подписки или нескольких подписок](../../azure-resource-manager/management/move-limitations/app-service-move-limitations.md)


### <a name="contributions-from-other-authors"></a>Вклады других авторов

Для [перенесенных](luis-migration-authoring.md) приложений с ресурсами: вы можете управлять _участниками_ для ресурса-разработчика в портал Azure с помощью страницы **управления доступом (IAM)** . Узнайте, [как добавить пользователя](luis-how-to-collaborate.md) с помощью адреса электронной почты участника совместной работы и роли участника.

Для приложений, которые еще не перенесены: вы можете управлять всеми _участниками совместной работы_ на странице " **Управление участниками >** " на портале Luis.

### <a name="query-prediction-access-for-private-and-public-apps"></a>Доступ к прогнозирующим запросам для частных и общедоступных приложений

Для частных приложений доступ к среде выполнения прогнозирующих запросов доступен для владельцев и участников. Для общедоступных приложений доступ к среде выполнения предоставляется пользователям, имеющим собственные ресурсы [службы](../cognitive-services-apis-create-account.md) "Поиск в Azure" или "Среда выполнения [Luis](#create-resources-in-the-azure-portal) " и идентификатор общедоступного приложения.

В настоящее время каталог общедоступных приложений отсутствует.

### <a name="authoring-permissions-and-access"></a>Создание разрешений и доступ
Доступ к приложению с портала [Luis](luis-reference-regions.md#luis-website) или [API-интерфейсов разработки](https://go.microsoft.com/fwlink/?linkid=2092087) управляется ресурсом разработки Azure.

Владелец и все участники имеют доступ для создания приложения.

|Доступ для разработки включает:|Примечания|
|--|--|
|Добавление или удалений ключей конечных точек||
|Экспорт версии||
|Экспорт журналов конечных точек||
|Импорт версии||
|Предоставление к приложению общего доступа|Если приложение является общедоступным, любой пользователь, у которого есть автор или ключ конечной точки, может запрашивать приложение.|
|Изменение модели|
|Публикация|
|Проверка высказываний конечной точки для [активного обучения](luis-how-to-review-endpoint-utterances.md)|
|Обучение|

<a name="prediction-endpoint-runtime-key"></a>

### <a name="prediction-endpoint-runtime-access"></a>Доступ к среде выполнения для конечной точки прогнозирования

Доступ для запросов к конечной точке прогнозирования управляется параметром на странице **сведения о приложении** в разделе **Управление** .

|[Частная конечная точка](#runtime-security-for-private-apps)|[Общедоступная конечная точка](#runtime-security-for-public-apps)|
|:--|:--|
|Доступно для владельца и участников|Доступно для владельца, участников и других пользователей, знающих идентификатор приложения|

Вы можете контролировать, кто видит ключ среды выполнения LUIS, вызывая его в среде "сервер-сервер". Если вы используете LUIS из программы-робота, соединение между Bot и LUIS уже более безопасно. При непосредственном вызове конечной точки LUIS необходимо создать серверный API (например, [функцию](https://azure.microsoft.com/services/functions/)Azure) с контролируемым доступом (через [Azure AD](https://azure.microsoft.com/services/active-directory/)). При вызове API на стороне сервера и проверке подлинности и авторизации, передайте вызов в LUIS. Эта стратегия не мешает атаке "злоумышленник в середине". Но он скрывает ключ и URL-адрес конечной точки от пользователей, позволяя вам отключать доступ и добавлять ведение журнала ответов на конечные точки (например, [Application Insights](https://azure.microsoft.com/services/application-insights/)).

### <a name="runtime-security-for-private-apps"></a>Безопасность среды выполнения для частных приложений

Среда выполнения частного приложения доступна только для следующих ключей:

|Ключ и пользователь|Пояснение|
|--|--|
|Ключ разработки владельца| До 1 000 конечных точек|
|Ключи для совместной работы и создания участников| До 1 000 конечных точек|
|Любой ключ, назначенный LUIS автору или участнику совместной работы|В зависимости от уровня использования ключей|

### <a name="runtime-security-for-public-apps"></a>Безопасность среды выполнения для общедоступных приложений

Если приложение настроено как общедоступное, _любой_ допустимый ключ создания Luis или ключ КОНЕЧНОЙ точки Luis может запросить его, если ключ не использовал всю квоту на конечную точку.

Пользователь, не являющийся владельцем или участником, может получить доступ к среде выполнения общедоступного приложения только при наличии идентификатора приложения. LUIS не имеет общедоступного рынка или каким-либо другим способом для поиска общедоступного приложения.

Общедоступное приложение публикуется во всех регионах. Поэтому пользователь с ключом ресурса LUIS на основе региона может получить доступ к приложению в любом регионе, связанном с ключом ресурса.


### <a name="control-access-to-your-query-prediction-endpoint"></a>Управление доступом к конечной точке прогнозирования запросов

Вы можете контролировать, кто может просматривать ключ конечной точки среды выполнения LUIS PREDICTION, вызывая его в среде "сервер-сервер". Если вы используете LUIS из программы-робота, соединение между Bot и LUIS уже более безопасно. При непосредственном вызове конечной точки LUIS необходимо создать серверный API (например, [функцию](https://azure.microsoft.com/services/functions/)Azure) с контролируемым доступом (через [Azure AD](https://azure.microsoft.com/services/active-directory/)). После вызова серверного API и прохождения авторизации и проверки подлинности нужно передать вызов в LUIS. Эта стратегия не мешает атаке "злоумышленник в середине". Но это средство скрывает конечную точку от пользователей, позволяет относить доступ и добавлять ведение журнала ответов на конечные точки (например, [Application Insights](https://azure.microsoft.com/services/application-insights/)).

<a name="starter-key"></a>

## <a name="sign-in-to-the-luis-portal-and-begin-authoring"></a>Войдите на портал LUIS и начните создание

1. Войдите на [портал Luis](https://www.luis.ai) и примите условия использования.
1. Начните создавать приложение LUIS, выбрав свой ключ разработки Azure LUIS:

   ![Снимок экрана, на котором показан экран приветствия.](./media/luis-how-to-azure-subscription/sign-in-create-resource.png)

1. После завершения процесса выбора ресурсов [Создайте новое приложение](luis-how-to-start-new-app.md#create-new-app-in-luis).


<a name="create-azure-resources"></a>
<a name="create-resources-in-the-azure-portal"></a>

[!INCLUDE [Create LUIS resource in Azure portal](includes/create-luis-resource.md)]

### <a name="create-resources-in-the-azure-cli"></a>Создание ресурсов в Azure CLI

Используйте [Azure CLI](/cli/azure/install-azure-cli) , чтобы создать каждый ресурс по отдельности.

Ресурс `kind` :

* Работы `LUIS.Authoring`
* Прогнозирующее `LUIS`

1. Войдите в Azure CLI:

    ```azurecli
    az login
    ```

    Эта команда открывает браузер, чтобы можно было выбрать правильную учетную запись и обеспечить проверку подлинности.

1. Создайте ресурс LUIS для создания ресурсов типа `LUIS.Authoring` с именем `my-luis-authoring-resource` . Создайте его в _существующей_ группе ресурсов с именем `my-resource-group` для `westus` региона.

    ```azurecli
    az cognitiveservices account create -n my-luis-authoring-resource -g my-resource-group --kind LUIS.Authoring --sku F0 -l westus --yes
    ```

1. Создайте ресурс LUIS прогнозной конечной точки типа `LUIS` с именем `my-luis-prediction-resource` . Создайте его в _существующей_ группе ресурсов с именем `my-resource-group` для `westus` региона. Если требуется более высокая пропускная способность, чем уровень Free, измените `F0` на `S0` . [Дополнительные сведения о ценовых категориях и пропускной способности.](luis-limits.md#key-limits)

    ```azurecli
    az cognitiveservices account create -n my-luis-prediction-resource -g my-resource-group --kind LUIS --sku F0 -l westus --yes
    ```

    > [!Note]
    > Эти ключи не используются порталом Luis, пока они не будут назначены на странице **Управление**  >  **ресурсами Azure** на портале Luis.

<a name="assign-an-authoring-resource-in-the-luis-portal-for-all-apps"></a>

### <a name="assign-resources-in-the-luis-portal"></a>Назначение ресурсов на портале LUIS

Вы можете назначить ресурс для создания отдельного приложения или для всех приложений в LUIS. Следующая процедура назначает всем приложениям один ресурс для создания.

1. Войдите на портал [LUIS](https://www.luis.ai).
1. В правом верхнем углу выберите учетную запись пользователя, а затем щелкните **Параметры**.
1. На странице **Параметры пользователя** выберите **Добавить ресурс для разработки**, а затем выберите существующий ресурс создания. Щелкните **Сохранить**.

## <a name="assign-a-resource-to-an-app"></a>Назначение ресурса для приложения

>[!NOTE]
>Если у вас нет подписки Azure, вы не сможете назначить или создать новый ресурс. Вам потребуется создать [бесплатную учетную запись Azure](https://azure.microsoft.com/en-us/free/) , а затем вернуться в Luis, чтобы создать новый ресурс на портале.

С помощью этой процедуры можно создать ресурс создания или прогнозирования или назначить его приложению. 

1. Войдите на портал [LUIS](https://www.luis.ai). Выберите приложение в списке **Мои приложения**.
1. Перейдите к разделу **Управление**  >  **ресурсами Azure**:

    ![Снимок экрана, на котором показана страница ресурсов Azure.](./media/luis-how-to-azure-subscription/manage-azure-resources-prediction.png)

1. На вкладке **прогнозирующий ресурс** или **ресурс создания** щелкните кнопку **Добавить прогнозирующий** ресурс или **Добавить ресурс для создания ресурса** .
1. Используйте поля в форме, чтобы найти нужный ресурс, а затем нажмите кнопку **сохранить**.
1. Если у вас нет ресурса, вы можете создать его, выбрав **создать новый ресурс Luis** в нижней части окна.


### <a name="assign-a-query-prediction-runtime-resource-without-using-the-luis-portal"></a>Назначение ресурса среды выполнения прогнозирующих запросов без использования портала LUIS

Для автоматизированных процессов, таких как конвейеры CI/CD, может потребоваться автоматизировать назначение ресурса среды выполнения LUIS приложению LUIS. Для этого выполните следующие действия.

1. Получите токен Azure Resource Manager на [этом веб-сайте](https://resources.azure.com/api/token?plaintext=true). Срок действия маркера истекает, поэтому используйте его сразу. По запросу возвращается маркер Azure Resource Manager.

    ```azurecli
    az account get-access-token --resource=https://management.core.windows.net/ --query accessToken --output tsv
    ```
    
    ![Снимок экрана, на котором показан веб-сайт для запроса маркера Azure Resource Manager.](./media/luis-manage-keys/get-arm-token.png)

1. Используйте маркер, чтобы запросить ресурсы среды выполнения LUIS в подписках. Используйте [API получения учетных записей Azure Luis](https://westus.dev.cognitive.microsoft.com/docs/services/5890b47c39e2bb17b84a55ff/operations/5be313cec181ae720aa2b26c), к которому имеет доступ ваша учетная запись пользователя.

    Этот API-интерфейс POST требует наличия следующих значений:

    |Заголовок|Значение|
    |--|--|
    |`Authorization`|Значение `Authorization` равно `Bearer {token}`. Значению маркера должно предшествовать слово `Bearer` и пробел.|
    |`Ocp-Apim-Subscription-Key`|Ваш ключ разработки.|

    API возвращает массив объектов JSON, представляющих ваши подписки LUIS. Возвращаемые значения включают идентификатор подписки, группу ресурсов и имя ресурса, возвращаемое как `AccountName` . Найдите в массиве элемент, который является ресурсом LUIS, который требуется назначить приложению LUIS.

1. Назначьте маркер ресурсу LUIS, используя [учетные записи назначения Luis Azure для API приложения](https://westus.dev.cognitive.microsoft.com/docs/services/5890b47c39e2bb17b84a55ff/operations/5be32228e8473de116325515) .

    Этот API-интерфейс POST требует наличия следующих значений:

    |Type|Параметр|Значение|
    |--|--|--|
    |Header|`Authorization`|Значение `Authorization` равно `Bearer {token}`. Значению маркера должно предшествовать слово `Bearer` и пробел.|
    |Header|`Ocp-Apim-Subscription-Key`|Ваш ключ разработки.|
    |Header|`Content-type`|`application/json`|
    |Строка запроса|`appid`|Идентификатор приложения LUIS.
    |Текст||{"AzureSubscriptionId":"ddda2925-af7f-4b05-9ba1-2155c5fe8a8e",<br>"ResourceGroup": "resourcegroup-2",<br>"AccountName": "luis-uswest-S0-2"}|

    После успешного выполнения этого API возвращается `201 - created status` .

## <a name="unassign-a-resource"></a>Отменить назначение ресурса

1. Войдите на [портал Luis](https://www.luis.ai), а затем выберите приложение из списка **Мои приложения** .
1. Перейдите к разделу **Управление**  >  **ресурсами Azure**.
1. На вкладке **прогнозирующий ресурс** или **ресурс для создания** ресурса нажмите кнопку Отменить **назначение ресурса** .

При удалении ресурса он не удаляется из Azure. Только отменяется связь с LUIS.


## <a name="delete-an-account"></a>Удаление учетной записи

Дополнительные сведения о том, какие данные удаляются при удалении учетной записи см. статью [Data storage and removal](luis-concept-data-storage.md#accounts) (Хранение и удаление данных).

## <a name="change-the-pricing-tier"></a>Изменение ценовой категории

1.  В [портал Azure](https://portal.azure.com)найдите и выберите свою подписку Luis:

    ![Снимок экрана, на котором показана подписка LUIS в портал Azure.](./media/luis-usage-tiers/find.png)
1.  Выберите **ценовую** категорию, чтобы просмотреть доступные ценовые категории:

    ![Снимок экрана, показывающий пункт меню ценовой категории.](./media/luis-usage-tiers/subscription.png)
1.  Выберите ценовую категорию и нажмите кнопку **выбрать** , чтобы сохранить изменения:

    ![Снимок экрана, на котором показано, как выбрать и сохранить ценовую категорию.](./media/luis-usage-tiers/plans.png)

    По завершении изменения цены во всплывающем окне будет проверено обновление ценовой категории:

    ![Снимок экрана всплывающего окна, проверяющего обновление цен.](./media/luis-usage-tiers/updated.png)
1. Не забудьте [назначить этот ключ конечной точки](#assign-a-resource-to-an-app) на странице **публикации** и использовать его во всех запросах конечной точки.

## <a name="view-azure-resource-metrics"></a>Просмотр метрик ресурсов Azure

### <a name="view-a-summary-of-azure-resource-usage"></a>Просмотр сводки об использовании ресурсов Azure
Сведения об использовании LUIS можно просмотреть в портал Azure. На странице **Обзор** отображается сводка, включая последние вызовы и ошибки. При создании запроса к конечной точке LUIS подождите до пяти минут, пока не появится изменение.

![Снимок экрана, на котором показана страница обзора.](./media/luis-usage-tiers/overview.png)

### <a name="customizing-azure-resource-usage-charts"></a>Настройка диаграмм использования ресурсов Azure
На странице **метрики** представлено более подробное представление данных:

![Снимок экрана, на котором показана страница метрики.](./media/luis-usage-tiers/metrics-default.png)

Вы можете настроить диаграммы метрик за определенный период времени и тип метрики:

![Снимок экрана, на котором показана настроенная диаграмма.](./media/luis-usage-tiers/metrics-custom.png)

### <a name="total-transactions-threshold-alert"></a>Оповещение о пороговом значении "Всего транзакций"
Если вы хотите получить сведения о достижении определенного порога транзакции, например 10 000 транзакций, можно создать оповещение:

![Снимок экрана, на котором показана страница правил генерации оповещений.](./media/luis-usage-tiers/alert-default.png)

Добавьте оповещение для метрики **общее число вызовов** за определенный период времени. Добавьте адреса электронной почты всех пользователей, которые должны получать оповещение. Добавьте веб-перехватчики для всех систем, которые должны получать оповещение. При запуске оповещения также может выполняться приложение логики.

## <a name="next-steps"></a>Дальнейшие действия

* Узнайте [, как использовать версии](luis-how-to-manage-versions.md) для управления жизненным циклом приложения.
* Переход на новый [ресурс создания](luis-migration-authoring.md).
