---
title: Выполнение пакетного теста — LUIS
titleSuffix: Azure Cognitive Services
description: Использование наборов высказываний для пакетного тестирования Интеллектуальной службы распознавание речи (LUIS) для поиска фрагментов речи с неправильными намерениями и сущностями.
services: cognitive-services
manager: nitinme
ms.custom: seodec18
ms.service: cognitive-services
ms.subservice: language-understanding
ms.topic: how-to
ms.date: 12/29/2020
ms.openlocfilehash: 0834b8f00e4c414b3a36314b80f6c99fb8f2aea2
ms.sourcegitcommit: 19ffdad48bc4caca8f93c3b067d1cf29234fef47
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/06/2021
ms.locfileid: "97955218"
---
# <a name="batch-testing-with-a-set-of-example-utterances"></a>Пакетное тестирование с помощью набора примеров высказываний

Пакетное тестирование проверяет активную обученную версию для измерения точности прогнозов. Пакетный тест позволяет просматривать точность каждой цели и сущности в активной версии. Изучите результаты пакетного теста, чтобы предпринять соответствующие действия для повышения точности, например добавить дополнительный пример фразы продолжительностью к намерениям, если приложение часто не может найти правильные намерения или метки в utterance.

## <a name="group-data-for-batch-test"></a>Группировка данных для пакетного тестирования

Очень важно применять для пакетного тестирования высказывания, еще не знакомые службе LUIS. Если у вас есть набор данных фразы продолжительностью, разделите фразы продолжительностью на три набора: пример фразы продолжительностью добавлен в намерение, фразы продолжительностью, полученный от опубликованной конечной точки, и фразы продолжительностью, используемый для пакетного тестирования LUIS после его обучения.

Используемый файл JSON пакетной службы должен включать фразы продолжительностью с сущностями машинного обучения верхнего уровня, помеченными, включая начальную и конечную должности. Речевые фрагменты не должны принадлежать к примерам, которые уже есть в приложении. Это должны быть речевые фрагменты, которые необходимо положительно прогнозировать для намерений и сущностей.

Вы можете разделить тестовые элементы по намерению и (или) сущности или расположить все эти элементы (до 1000 речевых фрагментов) в одном файле. 

### <a name="common-errors-importing-a-batch"></a>Распространенные ошибки при импорте пакета

Если при отправке пакетного файла в LUIS возникли ошибки, проверьте наличие следующих распространенных проблем.

* Более 1 000 фразы продолжительностью в пакетном файле
* Объект JSON, содержащий высказывание, не имеет свойства entities. Свойство может быть пустым массивом.
* Слова, которые были помечены в нескольких сущностях.
* Метки сущностей начинаются или заканчивались пробелами.

## <a name="fixing-batch-errors"></a>Исправление ошибок, выявленных при пакетном тестировании

Если при пакетном тестировании будут обнаружены ошибки, вы можете добавить в намерение больше высказываний и (или) сопоставить дополнительные высказывания с сущностью, чтобы служба LUIS лучше различала намерения. Если вы уже добавили все нужные высказывания и присвоили все метки, но в прогнозировании при пакетном тестировании по-прежнему возникают ошибки, попробуйте добавить [список фраз](luis-concept-feature.md) с характерным для предметной области словарем, который поможет LUIS обучаться быстрее.


<a name="batch-testing"></a>

## <a name="batch-testing-using-the-luis-portal"></a>Пакетное тестирование с помощью портала LUIS 

### <a name="import-and-train-an-example-app"></a>Импорт и обучение примера приложения

Импортируйте приложение для заказа пиццы, например `1 pepperoni pizza on thin crust`.

1.  Загрузите и сохраните [JSON-файл приложения](https://github.com/Azure-Samples/cognitive-services-sample-data-files/blob/master/luis/apps/pizza-with-machine-learned-entity.json?raw=true).

1. Войдите на портал [LUIS](https://www.luis.ai) и выберите **Подписка** и **Ресурс для разработки**, чтобы просмотреть приложения, назначенные этому ресурсу для разработки.
1. Щелкните стрелку рядом с полем **новое приложение** и выберите **Импорт как JSON** , чтобы импортировать JSON в новое приложение. Назовите приложение `Pizza app` .


1. Выберите **Обучение** в правом верхнем углу области навигации, чтобы обучить приложение.


[!INCLUDE [Entity roles in batch testing - currently not supported](../../../includes/cognitive-services-luis-roles-not-supported-in-batch-testing.md)]

### <a name="batch-test-file"></a>Файл пакетного теста

Пример JSON включает в себя один речевой фрагмент с помеченной сущностью, чтобы проиллюстрировать, как выглядит тестовый файл. В собственных тестах у вас должно быть много речевых фрагментов с правильными намерениями и помеченными сущностями машинного обучения.

1. Создайте файл `pizza-with-machine-learned-entity-test.json` в текстовом редакторе или [скачайте](https://github.com/Azure-Samples/cognitive-services-sample-data-files/blob/master/luis/batch-tests/pizza-with-machine-learned-entity-test.json?raw=true) его.

2. В пакетный файл в формате JSON добавьте речевой фрагмент с **намерением**, которое должно быть спрогнозировано в тесте.

   [!code-json[Add the intents to the batch test file](~/samples-cognitive-services-data-files/luis/batch-tests/pizza-with-machine-learned-entity-test.json "Add the intent to the batch test file")]

## <a name="run-the-batch"></a>Запуск пакетного теста

1. Нажмите кнопку **Test** (Тестировать) в верхней панели навигации.

2. На правой панели щелкните ссылку **Batch testing panel** (Панель пакетного тестирования).

    ![Ссылка на пакетное тестирование](./media/luis-how-to-batch-test/batch-testing-link.png)

3. Выберите **Импортировать**. В открывшемся диалоговом окне выберите **выбрать файл** и укажите файл JSON с правильным форматом JSON, который содержит *не более 1 000* фразы продолжительностью для тестирования.

    Ошибки импорта выводятся в красной строке уведомлений в верхней части браузера. Если при импорте возникают ошибки, набор данных не создается. Дополнительные сведения см. в разделе об [общих ошибках](#common-errors-importing-a-batch).

4. Выберите расположение для файла `pizza-with-machine-learned-entity-test.json`.

5. Назовите набор данных `pizza test` и выберите **Готово**.

6. Нажмите кнопку **Запустить**. После выполнения пакетного теста выберите **Просмотреть результаты**. 

    > [!TIP]
    > * При выборе пункта **скачать** будет скачан тот же файл, который вы перегрузили.
    > * Если вы видите, что пакетный тест не пройден, по крайней мере одна utterance цель не совпала с прогнозом.

<a name="access-batch-test-result-details-in-a-visualized-view"></a>

### <a name="review-batch-results-for-intents"></a>Просмотр намерений в результатах пакетного тестирования

Чтобы просмотреть результаты пакетного тестирования, щелкните **See results** (Просмотреть результаты). Результаты теста графически показывают, как тестовые речевые фрагменты спрогнозированы для активной версии.

Пакетная диаграмма отображает четыре квадранта результатов. В правой части диаграммы находится фильтр. Фильтр содержит намерения и сущности. При выборе [раздела диаграммы](luis-concept-batch-test.md#batch-test-results) или точки внутри диаграммы соответствующие высказывания отображаются под диаграммой.

При наведении курсора на диаграмму с помощью колеса мыши можно увеличить или уменьшить отображение. Это полезно в тех случаях, когда на диаграмме собрано много плотно сгруппированных точек.

Диаграмма состоит из четырех квадрантов, два из которых выделены красным цветом.

1. В списке фильтров выберите намерение **ModifyOrder**. Речевой фрагмент спрогнозирован как **истинно положительный результат**. Это означает, что речевой фрагмент совпал с его положительным прогнозом, указанным в пакетном файле.

    > [!div class="mx-imgBorder"]
    > ![Речевой фрагмент совпал с его положительным прогнозом](./media/luis-tutorial-batch-testing/intent-predicted-true-positive.png)

    Зеленые флажки в списке фильтров также указывают на успешное выполнение теста для каждого намерения. Все остальные намерения перечислены с положительным результатом 1/1, потому что речевой фрагмент был протестирован для каждого намерения и является отрицательным для любых намерений, не перечисленных в пакетном тесте.

1. Выберите намерение **Confirmation**. Это намерение не указано в пакетном тестировании, поэтому является отрицательным для речевого фрагмента, который указан в пакетном тесте.

    > [!div class="mx-imgBorder"]
    > ![Речевой фрагмент спрогнозирован как отрицательный для неуказанного намерения в пакетном файле](./media/luis-tutorial-batch-testing/true-negative-intent.png)

    Отрицательный тест выполнен успешно, как отмечено зеленым текстом в фильтре и на сетке.

### <a name="review-batch-test-results-for-entities"></a>Проверка результатов пакетного тестирования для сущностей

Сущность Модифйордер, как сущность компьютера с вложенными сущностями, показывает, совпадает ли сущность верхнего уровня и как прогнозируется вложенные сущности.

1. Выберите сущность **ModifyOrder** в списке фильтров, а затем выберите круг на сетке.

1. Прогнозирование сущности отображается под диаграммой. При этом отображаются сплошные линии для прогнозов, которые соответствуют ожиданиям, и пунктирные линии — для тех, которые не соответствуют.

    > [!div class="mx-imgBorder"]
    > ![Родительская сущность спрогнозирована в пакетном файле](./media/luis-tutorial-batch-testing/labeled-entity-prediction.png)

<a name="filter-chart-results-by-intent-or-entity"></a>

#### <a name="filter-chart-results"></a>Фильтрация результатов на диаграмме

Чтобы отфильтровать диаграмму по определенному намерению или сущности, выберите намерение или сущность на панели фильтрации справа. Точки данных и их распределение на диаграмме обновляются в зависимости от выбора.

![Визуализированный результат пакетного тестирования](./media/luis-how-to-batch-test/filter-by-entity.png)

### <a name="chart-result-examples"></a>Примеры результатов диаграммы

Диаграмма на портале LUIS позволяет выполнять следующие действия:
 
#### <a name="view-single-point-utterance-data"></a>Просмотр данных высказывания для одной точки

На диаграмме наведите указатель мыши на точку данных, чтобы увидеть оценку достоверности ее прогнозирования. Выберите точку данных для извлечения ее соответствующего высказывания из списка высказываний в нижней части страницы.

![Выбранное высказывание](./media/luis-how-to-batch-test/selected-utterance.png)


<a name="relabel-utterances-and-retrain"></a>
<a name="false-test-results"></a>

#### <a name="view-section-data"></a>Просмотр данных раздела

В диаграмме из четырех частей выберите имя раздела, например **False Positive** (Ложноположительный результат), в правой верхней части диаграммы. Под диаграммой в списке отображаются все высказывания в указанном разделе.

![Высказывания, выбранные по разделу](./media/luis-how-to-batch-test/selected-utterances-by-section.png)

На предыдущем рисунке высказывание `switch on` помечено с намерением TurnAllOn, но получило прогнозирование намерения None. Это указывает на то, что для выполнения ожидаемого прогнозирования намерению TurnAllOn необходимы дополнительные высказывания.

Два красных раздела на диаграмме указывают на высказывания, которые не соответствуют ожидаемому прогнозированию. Это значит, что LUIS требуется дополнительное обучение.

Два зеленых раздела на диаграмме означают соответствие ожидаемому прогнозированию.

## <a name="batch-testing-using-the-rest-api"></a>Пакетное тестирование с использованием REST API 

LUIS позволяет выполнять пакетный тест с помощью портала LUIS и REST API. Ниже перечислены конечные точки для REST API. Сведения о пакетном тестировании с помощью портала LUIS см. в разделе [учебник. наборы данных пакетного теста](luis-tutorial-batch-testing.md). Используйте полные URL-адреса, приведенные ниже, заменив значения заполнителей собственным ключом и конечной точкой LUIS прогнозирования. 

Не забудьте добавить ключ LUIS в `Ocp-Apim-Subscription-Key` заголовок и присвоить ему `Content-Type` значение `application/json` .

### <a name="start-a-batch-test"></a>Запуск пакетного теста

Запустите пакетный тест с помощью идентификатора версии приложения или слота публикации. Отправьте запрос **POST** в один из следующих форматов конечной точки. Добавьте пакетный файл в текст запроса.

Слот публикации
* `<YOUR-PREDICTION-ENDPOINT>/luis/prediction/v3.0-preview/apps/<YOUR-APP-ID>/slots/<YOUR-SLOT-NAME>/evaluations`

Идентификатор версии приложения
* `<YOUR-PREDICTION-ENDPOINT>/luis/prediction/v3.0-preview/apps/<YOUR-APP-ID>/versions/<YOUR-APP-VERSION-ID>/evaluations`

Эти конечные точки будут возвращать идентификатор операции, который будет использоваться для проверки состояния и получения результатов. 


### <a name="get-the-status-of-an-ongoing-batch-test"></a>Получение состояния текущего пакетного теста

Используйте идентификатор операции из пакетного теста, который вы начали, чтобы получить его состояние из следующих форматов конечной точки: 

Слот публикации
* `<YOUR-PREDICTION-ENDPOINT>/luis/prediction/v3.0-preview/apps/<YOUR-APP-ID>/slots/<YOUR-SLOT-ID>/evaluations/<YOUR-OPERATION-ID>/status`

Идентификатор версии приложения
* `<YOUR-PREDICTION-ENDPOINT>/luis/prediction/v3.0-preview/apps/<YOUR-APP-ID>/versions/<YOUR-APP-VERSION-ID>/evaluations/<YOUR-OPERATION-ID>/status`

### <a name="get-the-results-from-a-batch-test"></a>Получение результатов пакетного теста

Чтобы получить результаты из следующих форматов конечной точки, используйте идентификатор операции из пакетного теста, который вы начали. 

Слот публикации
* `<YOUR-PREDICTION-ENDPOINT>/luis/prediction/v3.0-preview/apps/<YOUR-APP-ID>/slots/<YOUR-SLOT-ID>/evaluations/<YOUR-OPERATION-ID>/result`

Идентификатор версии приложения
* `<YOUR-PREDICTION-ENDPOINT>/luis/prediction/v3.0-preview/apps/<YOUR-APP-ID>/versions/<YOUR-APP-VERSION-ID>/evaluations/<YOUR-OPERATION-ID>/result`


### <a name="batch-file-of-utterances"></a>Пакетный файл фразы продолжительностью

Отправьте пакетный файл фразы продолжительностью, известный как *набор данных*, для пакетного тестирования. Набор данных — это файл в формате JSON, содержащий не более 1 000 с меткой фразы продолжительностью. В приложении можно проверить до 10 наборов данных. Если необходимо протестировать больше, удалите набор данных, а затем добавьте новый. Все пользовательские сущности в модели отображаются в фильтре сущностей пакетного тестирования, даже если в данных пакетного файла нет соответствующих сущностей.

Пакетный файл содержит высказывания. Каждый utterance должен иметь ожидаемый прогноз намерения вместе с любыми [сущностями машинного обучения](luis-concept-entity-types.md#types-of-entities) , которые вы ожидаете обнаружить.

### <a name="batch-syntax-template-for-intents-with-entities"></a>Шаблон синтаксиса пакета для намерений с сущностями

Чтобы запустить файл пакета, используйте следующий шаблон.

```JSON
{
    "LabeledTestSetUtterances": [
        {
            "text": "play a song",
            "intent": "play_music",
            "entities": [
                {
                    "entity": "song_parent",
                    "startPos": 0,
                    "endPos": 15,
                    "children": [
                        {
                            "entity": "pre_song",
                            "startPos": 0,
                            "endPos": 3
                        },
                        {
                            "entity": "song_info",
                            "startPos": 5,
                            "endPos": 15
                        }
                    ]
                }
            ]
        }
    ]
}

```

Чтобы уведомить о начале и конце сущности, в файле пакета используются свойства **startPos** и **endPos**. Их значения отсчитываются, начиная с нуля, и не должны начинаться или заканчиваться пробелом. В этом и состоит основное отличие от журналов запросов, для которых используются свойства startIndex и endIndex.

Если вы не хотите тестировать сущности, включите свойство `entities` и задайте в качестве значения пустой массив `[]`.

### <a name="rest-api-batch-test-results"></a>REST API результатов пакетного теста

API возвращает несколько объектов:

* Сведения о моделях целей и сущностей, таких как точность, отзыв и F-Score.
* Сведения о моделях сущностей, таких как точность, отзыв и F-Оценка, для каждой сущности 
  * С помощью `verbose` флага можно получить дополнительные сведения о сущности, такие как `entityTextFScore` и `entityTypeFScore` .
* Предоставлены имена фразы продолжительностью с прогнозируемыми и помеченными намерениями
* Список ложных положительных сущностей и список ложных отрицательных сущностей.

## <a name="next-steps"></a>Дальнейшие действия

Если тестирование показывает, что приложение LUIS не распознает правильные намерения и сущности, вы можете повысить производительность приложения LUIS, пометив дополнительные высказывания или добавив компоненты.

* [Label suggested utterances with LUIS](luis-how-to-review-endpoint-utterances.md) (Добавление меток к предлагаемым фразам в LUIS)
* [Use features to improve your LUIS app's performance](luis-how-to-add-features.md) (Использование функций для повышения производительности приложения LUIS)
* [Understand batch testing with this tutorial](luis-tutorial-batch-testing.md) (Общие сведения о пакетном тестировании в этом руководстве)
* [Learn batch testing concepts](luis-concept-batch-test.md) (Общие сведения о принципах пакетного тестирования)
