---
title: Руководство. Разработка пользовательских команд приложения — речевая служба
titleSuffix: Azure Cognitive Services
description: Узнайте, как разрабатывать и настраивать приложения с пользовательскими командами. Эти приложения для работы с голосовыми командами лучше всего подходят для выполнения задач или сценариев управления.
services: cognitive-services
author: trevorbye
manager: nitinme
ms.service: cognitive-services
ms.subservice: speech-service
ms.topic: conceptual
ms.date: 12/15/2020
ms.author: trbye
ms.openlocfilehash: 1a002b6efbe2603ae254c19f9e3cc7377198cea2
ms.sourcegitcommit: 910a1a38711966cb171050db245fc3b22abc8c5f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "97935824"
---
# <a name="develop-custom-commands-applications"></a>Разработка приложений с пользовательскими командами

В этом пошаговом руководстве вы узнаете, как разрабатывать и настраивать приложения с пользовательскими командами. Функция пользовательских команд позволяет создавать приложения с голосовыми командами, оптимизированные для взаимодействия с голосовым интерфейсом. Эта функция лучше всего подходит для выполнения задач или сценариев управления и команд. Он особенно хорошо подходит для устройств Интернет вещей (IoT) и для внешних и бездисплейных устройств.

В этой статье вы создадите приложение, которое может включать и выключать Телевизор, устанавливать температуру и задавать будильник. После создания этих основных команд вы узнаете о следующих параметрах настройки команд:

* Добавление параметров в команды
* Добавление конфигураций в параметры команды
* Создание правил взаимодействия
* Создание шаблонов создания языков для речевых ответов
* Использование пользовательских средств Voice

## <a name="create-an-application-by-using-simple-commands"></a>Создание приложения с помощью простых команд

Начните с создания пустого приложения пользовательских команд. Дополнительные сведения см. в [кратком руководстве](quickstart-custom-commands-application.md). В этом приложении вместо импорта проекта создается пустой проект.

1. В поле **имя** введите имя проекта *Smart-комната-Lite* (или другое имя по своему усмотрению).
1. В списке **язык** выберите **Английский (США)**.
1. Выберите или создайте ресурс LUIS.

   > [!div class="mx-imgBorder"]
   > ![Снимок экрана, показывающий окно "новый проект".](media/custom-commands/create-new-project.png)

### <a name="update-luis-resources-optional"></a>Обновление ресурсов LUIS (необязательно)

Вы можете обновить ресурс разработки, выбранный в окне **Новый проект** . Можно также задать прогнозирующий ресурс. 

Прогнозирующий ресурс используется для распознавания при публикации приложения пользовательских команд. Вам не нужен прогнозирующий ресурс на этапах разработки и тестирования.

### <a name="add-a-turnon-command"></a>Добавление команды Турнон

В пустом созданном приложении "настраиваемые команды" смарт-комнаты — Lite добавьте команду. Команда обработает utterance, `Turn on the tv` . Он будет реагировать на сообщение `Ok, turning the tv on` .

1. Создайте новую команду, выбрав **команду Создать** в верхней части левой панели. Откроется **новое командное** окно.
1. В поле **имя** укажите значение `TurnOn` .
1. Нажмите кнопку **создания**.

В средней области перечислены свойства команды. 

В следующей таблице описаны свойства конфигурации команды. Дополнительные сведения см. в разделе [Основные понятия и определения пользовательских команд](./custom-commands-references.md).

| Конфигурация            | Описание                                                                                                                 |
| ---------------- | --------------------------------------------------------------------------------------------------------------------------- |
| Примеры предложений | Например, фразы продолжительностью пользователь может сказать, что нужно активировать эту команду.                                                                 |
| Параметры       | Сведения, необходимые для выполнения команды.                                                                                |
| Правила завершения | Действия, выполняемые для выполнения команды. Примеры: реагирование на пользователя или взаимодействие с веб-службой. |
| Правила взаимодействия   | Другие правила для решения более конкретных или сложных ситуаций.                                                              |


> [!div class="mx-imgBorder"]
> ![Снимок экрана, на котором показано, где можно создать команду.](media/custom-commands/add-new-command.png)

#### <a name="add-example-sentences"></a>Добавить примеры предложений

В разделе " **примеры предложений** " вы можете указать пример того, что может сказать пользователь.

1. В средней области выберите **примеры предложений**.
1. В области справа добавьте примеры:

    ```
    Turn on the tv
    ```

1.  В верхней части области щелкните **Сохранить**.

У вас еще нет параметров, поэтому можно перейти к разделу **правила завершения** .

#### <a name="add-a-completion-rule"></a>Добавление правила завершения

Далее команде требуется правило завершения. Это правило сообщает пользователю о том, что предпринимается действие выполнения. 

Дополнительные сведения о правилах и правилах завершения см. в разделе [Основные понятия и определения пользовательских команд](./custom-commands-references.md).

1. Выберите **правило завершения** по умолчанию. Затем измените его следующим образом:

    
    | Параметр    | Рекомендуемое значение                          | Описание                                        |
    | ---------- | ---------------------------------------- | -------------------------------------------------- |
    | **имя**;       | `ConfirmationResponse`                  | Имя, описывающее назначение правила.          |
    | **Условия** | Нет                                     | Условия, определяющие, когда может выполняться правило    |
    | **Действия**    | **Отправка речевого ответа**  >  **Простой редактор**  >  **Первый вариант** > `Ok, turning the tv on` | Действие, выполняемое, если условие правила имеет значение true |

   > [!div class="mx-imgBorder"]
   > ![Снимок экрана, на котором показано, где можно создать речевой ответ.](media/custom-commands/create-speech-response-action.png)

1. Нажмите кнопку **сохранить** , чтобы сохранить действие.
1. В разделе **правила завершения** нажмите кнопку **сохранить** , чтобы сохранить все изменения. 

    > [!NOTE]
    > Не нужно использовать правило завершения по умолчанию, которое входит в состав команды. Можно удалить правило завершения по умолчанию и добавить собственное правило.

### <a name="add-a-settemperature-command"></a>Добавление команды SetTemperature

Теперь добавьте еще одну команду, `SetTemperature` . Эта команда будет принимать одно utterance, `Set the temperature to 40 degrees` и реагировать на сообщение `Ok, setting temperature to 40 degrees` .

Чтобы создать новую команду, выполните действия, использованные для `TurnOn` команды, но используйте пример предложения `Set the temperature to 40 degrees` .

Затем **измените существующие правила завершения,** как показано ниже.

| Параметр    | Рекомендуемое значение                          |
| ---------- | ---------------------------------------- |
| **имя**;  | `ConfirmationResponse`                  |
| **Условия** | Нет                                     |
| **Действия**    | **Отправка речевого ответа**  >  **Простой редактор**  >  **Первый вариант** > `Ok, setting temperature to 40 degrees` |

Нажмите кнопку **сохранить** , чтобы сохранить все изменения, внесенные в команду.

### <a name="add-a-setalarm-command"></a>Добавление команды Сеталарм

Создайте новую `SetAlarm` команду. Используйте пример предложения `Set an alarm for 9 am tomorrow` . Затем **измените существующие правила завершения,** как показано ниже.

| Параметр    | Рекомендуемое значение                          |
| ---------- | ---------------------------------------- |
| **имя**;  | `ConfirmationResponse`                  |
| **Условия** | Нет                                     |
| **Действия**    | **Отправка речевого ответа**  >  **Простой редактор**  >  **Первый вариант** > `Ok, setting an alarm for 9 am tomorrow` |

Нажмите кнопку **сохранить** , чтобы сохранить все изменения, внесенные в команду.

### <a name="try-it-out"></a>Попробуйте сейчас

Протестируйте поведение приложения с помощью области тестирования: 

1. В правом верхнем углу панели щелкните значок **обучение** . 
1. По завершении обучения выберите **тест**. 

Ознакомьтесь со следующими примерами utterance с помощью голоса или текста:

- Введите: *установите температуру в 40 градусов* .
- Ожидаемый ответ: ОК, установка температуры в 40 градусов
- Введите: *Включите телевизор* .
- Ожидаемый ответ: ОК, включение ТВ
- Введите: *задать оповещение для 9 завтра*
- Ожидаемый ответ: ОК, Установка будильника для 9 завтра

> [!div class="mx-imgBorder"]
> ![Снимок экрана, показывающий тест в интерфейсе веб-чата.](media/custom-commands/create-basic-test-chat.png)

> [!TIP]
> В области тестирования **можно выбрать сведения о том** , как обрабатывался ввод голоса или ввод текста.

## <a name="add-parameters-to-commands"></a>Добавление параметров в команды

В этом разделе вы узнаете, как добавлять параметры в команды. Командам требуются параметры для выполнения задачи. В сложных сценариях параметры можно использовать для определения условий, которые активируют настраиваемые действия.

### <a name="configure-parameters-for-a-turnon-command"></a>Настройка параметров для команды Турнон

Начните с изменения существующей `TurnOn` команды, чтобы включить и отключить несколько устройств.

1. Теперь, когда команда будет работать как в сценариях включения, так и в случае отключения, переименуйте команду как *турнонофф*.
   1. На панели слева выберите команду **Турнон** . Затем рядом с **новой командой** в верхней части панели нажмите кнопку с многоточием (**...**).
   
   1. Выберите **Переименовать**. В окне **команда переименования** измените имя на *турнонофф*.

1. Добавьте в команду Новый параметр. Параметр указывает, нужно ли включать или отключать устройство.
   1. В верхней части средней области щелкните  **Добавить**. В раскрывающемся меню выберите **параметр**.
   1. В области справа в разделе **Параметры** в поле **имя** введите `OnOff` .
   1. Выберите **обязательный**. В окне **Добавление ответа для обязательного параметра** выберите **простой редактор**. В **первом поле варианта** добавьте *или отключите?*.
   1. Нажмите кнопку **Обновить**.

       > [!div class="mx-imgBorder"]
       > ![Снимок экрана, на котором показан раздел "Добавление ответа для требуемого параметра" с выбранной вкладкой "простой редактор".](media/custom-commands/add-required-on-off-parameter-response.png)
   
   1. Настройте свойства параметра с помощью следующей таблицы. Сведения обо всех свойствах конфигурации команды см. в разделе [Основные понятия и определения пользовательских команд](./custom-commands-references.md).
      

       | Конфигурация      | Рекомендуемое значение     | Описание                                                      |
       | ------------------ | ----------------| ---------------------------------------------------------------------|
       | **имя**;               | `OnOff`           | Описательное имя параметра                                                                           |
       | **Является глобальным**          | Unselected       | Флажок, указывающий, будет ли значение этого параметра глобально применено ко всем командам в приложении.|
       | **Обязательно**           | Выбрано         | Флажок, указывающий, требуется ли значение этого параметра перед завершением команды. |
       | **Ответ на обязательный параметр**      |**Простой редактор** > `On or Off?`      | Запрос на получение значения этого параметра, если он неизвестен. |
       | **Тип**               | **String**          | Тип параметра, например число, строка, Дата и время или география.   |
       | **Конфигурация**      | **Принимать предопределенные входные значения из внутреннего каталога** | Для строк этот параметр ограничивает входные данные набором возможных значений. |
       | **Предопределенные входные значения**     | `on`, `off`           | Набор возможных значений и их псевдонимов.         |
       
        
   1. Чтобы добавить предопределенные входные значения, выберите **Добавить предопределенный ввод**. В окне **новый элемент**  введите *Name* , как показано в предыдущей таблице. В этом случае псевдонимы не используются, поэтому это поле можно оставить пустым.
   
      > [!div class="mx-imgBorder"]
      > ![Снимок экрана, показывающий, как создать параметр.](media/custom-commands/create-on-off-parameter.png)

   1. Нажмите кнопку **сохранить** , чтобы сохранить все конфигурации параметра.
 
#### <a name="add-a-subjectdevice-parameter"></a>Добавление параметра Субжектдевице

1. Чтобы добавить второй параметр для представления имени устройств, которыми можно управлять с помощью этой команды, выберите **Добавить**. Используйте следующую конфигурацию.


    | Параметр            | Рекомендуемое значение       |
    | ------------------ | --------------------- |
    | **имя**;               | `SubjectDevice`         |
    | **Является глобальным**          | Unselected             |
    | **Обязательно**           | Выбрано               |
    | **Ответ на обязательный параметр**     | **Простой редактор** > `Which device do you want to control?`    | 
    | **Тип**               | **String**                |          |
    | **Конфигурация**      | **Принимать предопределенные входные значения из внутреннего каталога** | 
    | **Предопределенные входные значения** | `tv`, `fan`               |
    | **Псевдонимы** ( `tv` )      | `television`, `telly`     |

1. Щелкните **Сохранить**.

#### <a name="modify-example-sentences"></a>Изменение примеров предложений

Для команд, использующих параметры, рекомендуется добавить примеры предложений, охватывающие все возможные сочетания. Пример:

* Полные сведения о параметрах: `turn {OnOff} the {SubjectDevice}`
* Сведения о частичном параметре: `turn it {OnOff}`
* Нет сведений о параметрах: `turn something`

Примеры предложений, в которых используются различные сведения, позволяют приложению настраиваемых команд разрешать как разрешение одного снимка, так и разрешение с множественным включением, используя частичную информацию.

Учитывая эти сведения, измените примеры предложений, чтобы использовать предложенные параметры:

```
turn {OnOff} the {SubjectDevice}
{SubjectDevice} {OnOff}
turn it {OnOff}
turn something {OnOff}
turn something
```

Щелкните **Сохранить**.

> [!TIP]
> В редакторе примеров-предложений используйте фигурные скобки для ссылки на параметры. Например, `turn {OnOff} the {SubjectDevice}`.
> Используйте вкладку для автоматического завершения с помощью ранее созданных параметров.

#### <a name="modify-completion-rules-to-include-parameters"></a>Изменение правил завершения для включения параметров

Измените существующее правило завершения `ConfirmationResponse` .

1. В разделе **условия** выберите **Добавить условие**.
1. В окне **новое условие** в списке **тип** выберите **обязательные параметры**. В списке ниже выберите **онофф** и **субжектдевице**.
1. Оставьте  невыбранным.
1. Нажмите кнопку **создания**.
1. В разделе **действия** измените действие **Отправка речевого ответа** , наведя на него указатель мыши и нажав кнопку Изменить. На этот раз используйте только что созданные `OnOff` `SubjectDevice` Параметры и:

    ```
    Ok, turning the {SubjectDevice} {OnOff}
    ```
1. Щелкните **Сохранить**.

Попробуйте внести изменения, щелкнув значок **обучения** в верхней части панели справа. 

По завершении обучения выберите **тест**. Откроется окно **тестирования приложения** . Попробуйте выполнить следующие действия:

- Входные данные: *Отключение телевизора*
- Выходные данные: ОК, отключение телевизора
- Входные данные: *Отключение телевизора*
- Выходные данные: ОК, отключение телевизора
- Входные данные: *Отключить*
- Выходные данные: какое устройство вы хотите контролировать?
- Входные данные: *ТВ*
- Выходные данные: ОК, отключение телевизора

### <a name="configure-parameters-for-a-settemperature-command"></a>Настройка параметров для команды SetTemperature

Измените `SetTemperature` команду, чтобы она настроила температуру в соответствии с пользовательским направлением.

Добавьте `Temperature` параметр. Используйте следующую конфигурацию:

| Конфигурация      | Рекомендуемое значение     |
| ------------------ | ----------------|
| **имя**;               | `Temperature`           |
| **Обязательно**           | Выбрано         |
| **Ответ на обязательный параметр**      | **Простой редактор** > `What temperature would you like?`
| **Тип**               | `Number`          |


Измените пример фразы продолжительностью, чтобы использовать следующие значения.

```
set the temperature to {Temperature} degrees
change the temperature to {Temperature}
set the temperature
change the temperature
```

Измените существующие правила завершения. Используйте следующую конфигурацию.

| Конфигурация      | Рекомендуемое значение     |
| ------------------ | ----------------|
| **Условия**         | **Обязательный параметр**  >  **Температура**           |
| **Действия**           | **Отправка речевого ответа** > `Ok, setting temperature to {Temperature} degrees` |

### <a name="configure-parameters-for-a-setalarm-command"></a>Настройка параметров для команды Сеталарм

Добавьте параметр с именем `DateTime` . Используйте следующую конфигурацию.

   | Параметр                           | Рекомендуемое значение                     | 
   | --------------------------------- | ----------------------------------------|
   | **имя**;                              | `DateTime`                               |
   | **Обязательно**                          | Выбрано                                 |
   | **Ответ на обязательный параметр**   | **Простой редактор** > `For what time?`            | 
   | **Тип**                              | **DateTime**                                |
   | **Значения по умолчанию для даты**                     | Если дата отсутствует, используйте Today.            |
   | **Значения времени по умолчанию**                     | Если время отсутствует, используйте начало дня.     |


> [!NOTE]
> В этой статье в основном используются типы параметров String, number и DateTime. Список всех поддерживаемых типов параметров и их свойств см. в разделе [Основные понятия и определения пользовательских команд](./custom-commands-references.md).


Измените пример фразы продолжительностью. Используйте указанные ниже значения.

```
set an alarm for {DateTime}
set alarm {DateTime}
alarm for {DateTime}
```

Измените существующие правила завершения. Используйте следующую конфигурацию.

   | Параметр    | Рекомендуемое значение                               |
   | ---------- | ------------------------------------------------------- |
   | **Действия**    | **Отправка речевого ответа** > `Ok, alarm set for {DateTime}`  |

Протестируйте три команды, используя фразы продолжительностью, связанные с различными командами. (Можно переключаться между различными командами.)

- Входные данные: *задать оповещение*
- Выходные данные: сколько времени?
- Входные данные: *включить телевизор*
- Выходные данные: ОК, включение телевизора
- Входные данные: *задать оповещение*
- Выходные данные: сколько времени?
- Входные данные: *5 PM*
- Выходные данные: ОК, оповещение установлено для 2020-05-01 17:00:00

## <a name="add-configurations-to-command-parameters"></a>Добавление конфигураций в параметры команды

В этом разделе вы узнаете больше о конфигурации расширенных параметров, включая:

 - Как значения параметров могут принадлежать к набору, определенному вне приложения пользовательских команд.
 - Добавление предложений проверки для значений параметров.

### <a name="configure-a-parameter-as-an-external-catalog-entity"></a>Настройка параметра в качестве сущности внешнего каталога

Функция "настраиваемые команды" позволяет настроить параметры строкового типа для ссылки на внешние каталоги, размещенные в веб-конечной точке. Поэтому внешний каталог можно обновлять независимо, не редактируя приложение пользовательских команд. Этот подход полезен в случаях, когда записи каталога являются многочисленными.

Повторно используйте `SubjectDevice` параметр из `TurnOnOff` команды. Текущая конфигурация этого параметра **принимает предопределенные входные данные из внутреннего каталога**. Эта конфигурация относится к статическому списку устройств в конфигурации параметров. Переместите это содержимое во внешний источник данных, который можно обновлять независимо.

Чтобы переместить содержимое, начните с добавления новой конечной точки веб-узла. На панели слева перейдите к разделу **веб-конечные точки** . В нем добавьте новую конечную точку веб-сайта. Используйте следующую конфигурацию.

| Параметр | Рекомендуемое значение |
|----|----|
| **имя**; | `getDevices` |
| **URL-адрес** | `https://aka.ms/speech/cc-sampledevices` |
| **Метод** | **GET** |


Если предлагаемое значение для URL-адреса не подходит для вас, настройте и разместите конечную веб-точку, которая возвращает файл JSON, состоящий из списка устройств, которыми можно управлять. Конечная точка веб-сайта должна вернуть файл JSON, как показано ниже.
    
```json
{
    "fan" : [],
    "refrigerator" : [
        "fridge"
    ],
    "lights" : [
        "bulb",
        "bulbs",
        "light"
        "light bulb"
    ],
    "tv" : [
        "telly",
        "television"
        ]
}

```

Далее перейдите на страницу параметров параметра **субжектдевице** . Настройте следующие свойства.

| Параметр | Рекомендуемое значение |
| ----| ---- |
| **Конфигурация** | **Принять предопределенные входные данные из внешнего каталога** |                               
| **Конечная точка каталога** | `getDevices` |
| **Метод** | **GET** |

Затем нажмите кнопку **Save** (Сохранить).

> [!IMPORTANT]
> Вы не увидите параметр, позволяющий настроить параметр для приема входных данных из внешнего каталога, если в области слева отсутствует веб-конечная точка, заданная в разделе **веб-конечная** точка.

Попробуйте, выбрав **обучение**. По завершении обучения выберите **тест** и попробуйте несколько взаимодействий.

* Входные данные: *включить*
* Выходные данные: какое устройство вы хотите контролировать?
* Входные данные: *индикаторы*
* Выходные данные: ОК, включение освещения

> [!NOTE]
> Теперь вы можете управлять всеми устройствами, размещенными в конечной веб-точке. Но по-прежнему необходимо обучить приложение для тестирования новых изменений, а затем повторно опубликовать приложение.

### <a name="add-validation-to-parameters"></a>Добавить проверку в параметры

*Проверки* — это конструкции, которые применяются к определенным типам параметров, которые позволяют настроить ограничения для значения параметра. Они запрашивают исправления, если значения не попадают в ограничения. Список типов параметров, расширяющих конструкцию проверки, см. в разделе [Основные понятия и определения пользовательских команд](./custom-commands-references.md).

Проверьте правильность проверки с помощью `SetTemperature` команды. Чтобы добавить проверку для параметра, выполните следующие действия `Temperature` .

1. На панели слева выберите команду **SetTemperature** .
1. В средней области выберите **температура**.
1. На панели справа выберите **добавить проверку**.
1. В окне **Новая проверка** настройте проверку, как показано в следующей таблице. Щелкните **Создать**.


    | Конфигурация параметров | Рекомендуемое значение | Описание |
    | ---- | ---- | ---- |
    | **Минимальное значение** | `60` | Для числовых параметров — минимальное значение, которое может предположить этот параметр. |
    | **Максимальное значение** | `80` | Для числовых параметров — максимальное значение, которое может предположить этот параметр. |
    | **Неудачный ответ** |  **Простой редактор**  >  **Первый вариант** > `Sorry, I can only set temperature between 60 and 80 degrees. What temperature do you want?` | Запрос на запрос нового значения, если проверка не пройдена |

    > [!div class="mx-imgBorder"]
    > ![Снимок экрана, показывающий, как добавить проверку диапазона.](media/custom-commands/add-validations-temperature.png)

Попробуйте, щелкнув значок **обучения** в верхней части области справа. По завершении обучения выберите **тест**. Попробуйте несколько взаимодействий:

- Входные данные: *установите температуру в 72 градусов* .
- Выходные данные: ОК, установка температуры в 72 градусов
- Входные данные: *установите температуру в 45 градусов* .
- Выходные данные: можно установить только температуру между 60 и 80 градусов
- Входные данные: *сделайте его 72 градусов*
- Выходные данные: ОК, установка температуры в 72 градусов

## <a name="add-interaction-rules"></a>Добавление правил взаимодействия

Правила взаимодействия — это *Дополнительные* правила, которые обрабатывают определенные или сложные ситуации. Хотя вы можете создавать собственные правила взаимодействия, в этом примере вы используете правила взаимодействия для следующих сценариев:

* Подтверждение команд
* Добавление одноэтапного исправления в команды

Дополнительные сведения о правилах взаимодействия см. в разделе [Основные понятия и определения пользовательских команд](./custom-commands-references.md).

### <a name="add-confirmations-to-a-command"></a>Добавление подтверждений для команды

Чтобы добавить подтверждение, используйте `SetTemperature` команду. Чтобы получить подтверждение, создайте правила взаимодействия, выполнив следующие действия.

1. На панели слева выберите команду **SetTemperature** .
1. В средней области добавьте правила взаимодействия, выбрав **Добавить**. Затем выберите команду **правила взаимодействия**  >  **проверить**.

    Это действие добавляет три правила взаимодействия. Правила запрашивают у пользователя подтверждение даты и времени оповещения. Они предполагают подтверждение (да или нет) для следующей очереди.

    1. Измените правило взаимодействия **команды Confirm** , используя следующую конфигурацию:
        1. Измените имя, чтобы **подтвердить температуру**.
        1. Добавить новое условие: **обязательные параметры**  >  **температура**.
        1. Добавить новое действие: **тип**  >  **Отправить речевой ответ**. вы  >  **действительно хотите задать температуру как {температура} градусов?**
        1. В разделе **ожидания** оставьте значение по умолчанию для параметра **ожидается подтверждение от пользователя**.
      
         > [!div class="mx-imgBorder"]
         > ![Снимок экрана, показывающий, как создать ответ требуемого параметра.](media/custom-speech-commands/add-validation-set-temperature.png)
    

    1. Измените правило взаимодействия **успешно подтверждено** , чтобы обрабатывалось успешное подтверждение (пользователь сказал да).
      
          1. Измените имя на « **температура подтверждения**».
          1. Оставить существующее **Подтверждение успешным** .
          1. Добавить новое условие: **введите**  >  **обязательные параметры**  >  **температура**.
          1. Оставьте значение **состояния после выполнения** , заданное по умолчанию, как **правила** выполнения выполнения.

    1. Изменение правила взаимодействия с **отклонением подтверждения** для выполнения сценариев в случае отказа в подтверждении (пользователь сказал No).

          1. Измените имя на " **контрольная температура отклонено**".
          1. Оставьте условие для существующего **подтверждения отклонено** .
          1. Добавить новое условие: **введите**  >  **обязательные параметры**  >  **температура**.
          1. Добавить новое действие: **тип**  >  **Отправить речевое реагирование**  >  **проблема. Какова температура?**
          1. Измените значение **состояния после выполнения** по умолчанию, чтобы **дождаться ввода данных пользователем**.

> [!IMPORTANT]
> В этой статье вы используете встроенную функцию подтверждения. Можно также вручную добавить правила взаимодействия по одному.
   
Попробуйте внести изменения, выбрав " **обучение**". По завершении обучения выберите **тест**.

- **Входные данные**: *установите температуру в 80 градусов* .
- **Выходные данные**: вы действительно хотите задать температуру как 80 градусов?
- **Входные данные**: *нет*
- **Выходные данные**: нет проблем. Какова температура?
- **Входные данные**: *72 градусов*
- **Выходные данные**: вы действительно хотите задать температуру как 72 градусов?
- **Входные данные**: *Да*
- **Выходные данные**: ОК, установка температуры в 72 градусов

### <a name="implement-corrections-in-a-command"></a>Реализация исправлений в команде

В этом разделе вы настроите исправление для одного шага. Это исправление используется после выполнения действия по выполнению. Вы также увидите пример того, как исправление включено по умолчанию, если команда еще не выполнена. Чтобы добавить исправление, если команда не завершена, добавьте новый параметр `AlarmTone` .

В левой области выберите команду **сеталарм** . Затем добавьте новый параметр **алармтоне**.
        
- **Безымян** > `AlarmTone`
- **Тип**  >  **Строка**
- Значение по умолчанию   >  **Чимес**
- **Конфигурация**  >  **Принять предопределенные входные значения из внутреннего каталога**
- **Предопределенные входные значения**  >  **Чимес**, **позвякивание** и **echo** (эти значения являются отдельными предопределенными входными данными).


Затем обновите ответ для параметра **DateTime** , чтобы **присвоить сигналу будильника значение {алармтоне}. За какое время?**. Затем измените правило завершения следующим образом:

1. Выберите существующее правило завершения **конфирматионреспонсе**.
1. На панели справа наведите указатель мыши на существующее действие и выберите **изменить**.
1. Обновите речевой ответ на `OK, alarm set for {DateTime}. The alarm tone is {AlarmTone}` .

> [!IMPORTANT]
> Сигнал будильника может измениться без какой бы то ни было явной настройки в текущей команде. Например, он может измениться, если команда еще не завершена. *По умолчанию* исправление включено для всех параметров команды, независимо от номера, если команда еще не выполнена.

#### <a name="implement-a-correction-when-a-command-is-finished"></a>Реализовать исправление после завершения выполнения команды

Платформа настраиваемых команд позволяет выполнять одношаговое исправление даже после завершения выполнения команды. Эта функция не включена по умолчанию. Он должен быть явно настроен. 

Чтобы настроить одношаговое исправление, выполните следующие действия.

1. В команде **сеталарм** добавьте правило взаимодействия для **команды Type Update Previous** , чтобы обновить ранее установленный сигнал. Переименуйте правило взаимодействия как **обновление предыдущего оповещения**.
1. Оставьте условие по умолчанию: **Предыдущая команда должна быть обновлена**.
1. Добавить новое условие: **тип**  >  **обязательный параметр**  >  **DateTime**.
1. Добавление нового действия: **тип**  >  **Отправить речевой отклик**  >  **простой редактор**  >  **, обновляющий время предыдущего оповещения до {DateTime}**.
1. Оставьте значение **состояния после выполнения** по умолчанию, так как **команда выполнена**.

Попробуйте внести изменения, выбрав " **обучение**". Дождитесь завершения обучения и выберите **проверить**.

- **Входные данные**: *установите оповещение.*
- **Выходные данные**: готово к установке сигнала будильника как чимес. За какое время?
- **Входные данные**: *установите будильник со значением позвякивание для 9 завтра.*
- **Выходные данные**: ОК, оповещение установлено для 2020-05-21 09:00:00. Сигнал будильника — позвякивание.
- **Входные данные**: *нет, 8 AM.*
- **Выходные данные**: обновление предыдущего времени оповещения до 2020-05-29 08:00.

> [!NOTE]
> В реальном приложении в разделе **действия** этого правила исправления также необходимо отправить обратно клиенту действие или вызвать конечную точку HTTP, чтобы обновить время оповещения в системе. Это действие должно отвечать исключительно за обновление времени оповещения. Он не должен отвечать за любой другой атрибут команды. В этом случае этот атрибут будет иметь сигнал будильника.

## <a name="add-language-generation-templates-for-speech-responses"></a>Добавление шаблонов создания языков для речевых ответов

Шаблоны создания языка (LG) позволяют настраивать отклики, отправляемые клиенту. Они представляют дисперсию для ответов. Создание языка можно реализовать с помощью следующих средств:

* Шаблоны создания языка.
* Адаптивные выражения.

Шаблоны пользовательских команд основаны на [шаблонах LG](/azure/bot-service/file-format/bot-builder-lg-file-format#templates)платформы Bot. Поскольку функция пользовательских команд создает новый шаблон LG при необходимости (для речевых ответов в параметрах или действиях), указывать имя шаблона LG не нужно. 

Поэтому не нужно определять шаблон следующим образом:

 ```
    # CompletionAction
    - Ok, turning {OnOff} the {SubjectDevice}
    - Done, turning {OnOff} the {SubjectDevice}
    - Proceeding to turn {OnOff} {SubjectDevice}
 ```

Вместо этого можно определить текст шаблона без имени следующим образом:

> [!div class="mx-imgBorder"]
> ![Снимок экрана, показывающий пример редактора шаблонов.](./media/custom-commands/template-editor-example.png)


Это изменение вводит вариации в речевые ответы, отправляемые клиенту. Для utterance соответствующий речевой ответ выбирается случайным образом из указанных параметров.

Используя преимущества шаблонов LG, можно также определять сложные речевые ответы для команд с помощью адаптивных выражений. Дополнительные сведения см. в разделе [Формат шаблонов LG](/azure/bot-service/file-format/bot-builder-lg-file-format#templates). 

По умолчанию функция пользовательских команд поддерживает все возможности, а также следующие небольшие отличия.

* В шаблонах LG сущности представлены как `${entityName}` . Функция пользовательских команд не использует сущности. Однако параметры можно использовать в качестве переменных с `${parameterName}` представлением или представлением `{parameterName}` .
* Функция пользовательских команд не поддерживает композицию и расширение шаблона, так как вы никогда не изменяете файл *LG* напрямую. Вы редактируете только ответы автоматически созданных шаблонов.
* Функция пользовательских команд не поддерживает пользовательские функции, LG внедрение. Поддерживаются стандартные функции.
* Функция пользовательских команд не поддерживает такие параметры, как `strict` , `replaceNull` и `lineBreakStyle` .

### <a name="add-template-responses-to-a-turnonoff-command"></a>Добавление ответов шаблона в команду Турнонофф

Измените `TurnOnOff` команду, чтобы добавить новый параметр. Используйте следующую конфигурацию.

| Параметр            | Рекомендуемое значение       | 
| ------------------ | --------------------- | 
| **имя**;               | `SubjectContext`         | 
| **Является глобальным**          | Unselected             | 
| **Обязательно**           | Unselected               | 
| **Тип**               | **String**                |
| **Значение по умолчанию**      | `all` |
| **Конфигурация**      | **Принять предопределенные входные значения из внутреннего каталога** | 
| **Предопределенные входные значения** | `room`, `bathroom`, `all`|

#### <a name="modify-a-completion-rule"></a>Изменение правила завершения

Измените раздел **действия** существующего правила завершения **конфирматионреспонсе**. В окне **изменение действия** переключитесь в **Редактор шаблонов**. Затем замените текст следующим примером.

```
- IF: @{SubjectContext == "all" && SubjectDevice == "lights"}
    - Ok, turning all the lights {OnOff}
- ELSEIF: @{SubjectDevice == "lights"}
    - Ok, turning {OnOff} the {SubjectContext} {SubjectDevice}
- ELSE:
    - Ok, turning the {SubjectDevice} {OnOff}
    - Done, turning {OnOff} the {SubjectDevice}
```

Обучить и протестируйте приложение с помощью следующих входных и выходных данных. Обратите внимание на разновидность ответов. Вариант создается несколькими альтернативами значения шаблона, а также применением адаптивных выражений.

* Входные данные: *включить телевизор*
* Выходные данные: ОК, включение телевизора
* Входные данные: *включить телевизор*
* Выходные данные: готово, включен ТВ
* Входные данные: *Отключение индикаторов*
* Выходные данные: ОК, отключение всех световых индикаторов
* Входные данные: *Отключение освещения комнаты*
* Выходные данные: ОК, выключение освещения комнаты

## <a name="use-a-custom-voice"></a>Использование пользовательского голоса

Другим способом настройки ответов на пользовательские команды является выбор выходного голоса. Чтобы переключить голоса по умолчанию на пользовательские голоса, выполните следующие действия.

1. В приложении "пользовательские команды" в области слева щелкните **Параметры**.
1. В средней области выберите **Настраиваемый Voice**.
1. В таблице выберите пользовательский голосовой или общедоступный голосовое значение.
1. Щелкните **Сохранить**.

> [!div class="mx-imgBorder"]
> ![Снимок экрана, на котором показаны примеры предложений и параметров.](media/custom-commands/select-custom-voice.png)

> [!NOTE]
> Для общих голосов типы нейронов доступны только для конкретных регионов. Дополнительные сведения см. в разделе [Поддерживаемые службы речи регионы](./regions.md#standard-and-neural-voices).
>
> Пользовательские голоса можно создавать на странице **настраиваемого голосового** проекта. Дополнительные сведения см. в статье Начало [работы с пользовательским голосовым стандартом](./how-to-custom-voice.md).

Теперь приложение будет отвечать на выбранный голоса вместо голоса по умолчанию.

## <a name="next-steps"></a>Дальнейшие действия

* Узнайте, как [интегрировать приложение пользовательских команд](how-to-custom-commands-setup-speech-sdk.md) с клиентским приложением с помощью РЕЧЕВОГО пакета SDK.
* [Настройка непрерывного развертывания](how-to-custom-commands-deploy-cicd.md) для приложения настраиваемых команд с помощью Azure DevOps. 
                      
