---
title: Справочник по API для преобразования речи в текст (RESTFUL) — служба речи
titleSuffix: Azure Cognitive Services
description: Узнайте, как использовать REST API преобразования речи в текст. Из этой статьи вы узнаете о вариантах авторизации, параметрах запроса, структуре запроса и получении ответа.
services: cognitive-services
author: trevorbye
manager: nitinme
ms.service: cognitive-services
ms.subservice: speech-service
ms.topic: conceptual
ms.date: 01/08/2021
ms.author: trbye
ms.custom: devx-track-csharp
ms.openlocfilehash: 70c5593f29b5e83d5d3f318179d365a9235849ca
ms.sourcegitcommit: a055089dd6195fde2555b27a84ae052b668a18c7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/26/2021
ms.locfileid: "98790619"
---
# <a name="speech-to-text-rest-api"></a>REST API преобразования речи в текст;

Речь-to-Text имеет два разных интерфейса API-интерфейсов RESTFUL. Каждый API-интерфейс обслуживает свое особое назначение и использует разные наборы конечных точек.

API-интерфейсы RESTFUL для преобразования речи в текст:
- Преобразование [речи в текст REST API v 3.0](#speech-to-text-rest-api-v30) используется для [пакетной](batch-transcription.md) записи и [пользовательское распознавание речи](custom-speech-overview.md). Версия 3.0 является [последователем версии 2.0](./migrate-v2-to-v3.md).
- [Речь-текстовая REST API для коротких аудиозаписей](#speech-to-text-rest-api-for-short-audio) используется для транскрипции в качестве альтернативы [речевому пакету SDK](speech-sdk.md). Запросы, использующие этот API, могут передавать до 60 секунд звука на каждый запрос. 

## <a name="speech-to-text-rest-api-v30"></a>Преобразование речи в текст REST API v 3.0

Преобразование речи в текст REST API v 3.0 используется для [пакетной](batch-transcription.md) записи и [пользовательское распознавание речи](custom-speech-overview.md). Если вам нужно обмениваться сообщениями через Интернет с помощью функции RESTFUL, используйте [REST API преобразования речи в текст для коротких аудио](#speech-to-text-rest-api-for-short-audio).

Используйте REST API версии 3.0 для:
- Копирование моделей в другие подписки в случае, если требуется, чтобы у коллег есть доступ к созданной модели или в тех случаях, когда требуется развернуть модель в нескольких регионах.
- Транскрипция данные из контейнера (с массовыми транскрипциями), а также укажите несколько URL-адресов звуковых файлов.
- Отправка данных из учетных записей хранения Azure с помощью URI SAS
- Получение журналов для каждой конечной точки, если для этой конечной точки были запрошены журналы
- Запросите манифест создаваемых моделей для настройки локальных контейнеров.

REST API v 3.0 включает такие функции, как:
- **Уведомления — веб-перехватчики**. все запущенные процессы службы теперь поддерживают уведомления веб-перехватчика. REST API v 3.0 предоставляет вызовы, позволяющие регистрировать веб-перехватчики, в которых отправляются уведомления.
- **Обновление моделей за конечными точками** 
- **Адаптация модели с несколькими наборами данных**— адаптация модели с помощью нескольких сочетаний данных, таких как акустические, языковые и произношение.
- Использование собственного **хранилища**— используйте собственные учетные записи хранения для журналов, файлов транскрипции и других данных.

В [этой статье](batch-transcription.md)приведены примеры использования REST API v 3.0 с записью пакета.

Если вы используете REST API версии 2.0 для преобразования речи в текст, [см. инструкции по](./migrate-v2-to-v3.md)переходу на версию 3.0.

Полный справочник по REST API версии 3.0 для преобразования речи в текст см. [здесь](https://centralus.dev.cognitive.microsoft.com/docs/services/speech-to-text-api-v3-0).

## <a name="speech-to-text-rest-api-for-short-audio"></a>REST API речи в текст для коротких аудио

В качестве альтернативы [речевому пакету SDK](speech-sdk.md)служба распознавания речи позволяет преобразовать речь в текст с помощью REST API. Каждая доступная конечная точка связана с регионом. Приложению нужен ключ подписки для конечной точки, которую вы планируете использовать. REST API для коротких звуков очень ограничена, и ее следует использовать только в случаях, когда речь задействуется с помощью [речевого пакета SDK](speech-sdk.md) .

Прежде чем использовать REST API преобразования речи в текст для коротких аудио, учитывайте следующее.

* Запросы, использующие REST API для коротких аудио и передачи аудио, могут содержать не более 60 секунд звука.
* REST API речи в текст для коротких аудиозаписей возвращает только окончательные результаты. Частичные результаты не предоставляются.

Если отправка длинного звука является обязательным требованием для вашего приложения, рассмотрите возможность использования [речевого пакета SDK](speech-sdk.md) или преобразования [речи в текст REST API v 3.0](#speech-to-text-rest-api-v30).

> [!TIP]
> Ознакомьтесь с [этой статьей](sovereign-clouds.md) для конечных точек Azure для государственных организаций и Azure для Китая.

[!INCLUDE [](../../../includes/cognitive-services-speech-service-rest-auth.md)]

### <a name="regions-and-endpoints"></a>Регионы и конечные точки

Конечная точка для REST API для краткого аудио имеет следующий формат:

```
https://<REGION_IDENTIFIER>.stt.speech.microsoft.com/speech/recognition/conversation/cognitiveservices/v1
```

Замените `<REGION_IDENTIFIER>` идентификатором, соответствующим региону подписки, из следующей таблицы:

[!INCLUDE [](../../../includes/cognitive-services-speech-service-region-identifier.md)]

> [!NOTE]
> К URL-адресу нужно добавить параметр языка, чтобы не возникало сообщение об ошибке HTTP 4xx. Например, выбор английского языка (США) с использованием конечной точки "Западная часть США" будет выглядеть так: `https://westus.stt.speech.microsoft.com/speech/recognition/conversation/cognitiveservices/v1?language=en-US`.

### <a name="query-parameters"></a>Параметры запроса

Следующие параметры можно включать в строку запроса REST.

| Параметр | Описание | Обязательный или необязательный |
|-----------|-------------|---------------------|
| `language` | Определяет распознаваемую устную речь. См. раздел [Поддерживаемые языки](language-support.md#speech-to-text). | Обязательно |
| `format` | Указывает формат результатов. Допустимые значения: `simple` и `detailed`. К простым результатам относятся `RecognitionStatus`, `DisplayText`, `Offset` и `Duration`. Подробные ответы включают четыре различных представления отображаемого текста. Значение по умолчанию — `simple`. | Необязательно |
| `profanity` | Указывает, как обрабатывать ненормативную лексику в результатах распознавания. Допустимые значения: `masked` , что заменяет ненормативную лексику на звездочки, `removed` которая удаляет всю ненормативную лексику из результата или `raw` , в том числе ненормативную лексику, в результате. Значение по умолчанию — `masked`. | Необязательно |
| `cid` | При использовании [портала пользовательское распознавание речи](./custom-speech-overview.md) для создания пользовательских моделей можно использовать пользовательские модели с помощью **идентификатора конечной точки** , найденного на странице **развертывания** . Используйте **идентификатор конечной точки** в качестве аргумента для `cid` параметра строки запроса. | Необязательно |

### <a name="request-headers"></a>Заголовки запроса

В этой таблице перечислены обязательные и необязательные заголовки для запросов преобразования речи в текст.

|Header| Описание | Обязательный или необязательный |
|------|-------------|---------------------|
| `Ocp-Apim-Subscription-Key` | Ключ подписки службы "Речь". | Обязательный, если не предоставлен заголовок `Authorization`. |
| `Authorization` | Маркеру авторизации предшествует слово `Bearer`. Дополнительные сведения см. в разделе [Authenticate to the Speech API](#authentication) (Аутентификация в API речи). | Обязательный, если не предоставлен заголовок `Ocp-Apim-Subscription-Key`. |
| `Pronunciation-Assessment` | Задает параметры для отображения оценок произношения в результатах распознавания, которые оценивают качество речевого ввода с помощью индикаторов точности, владение, полноты и т. д. Этот параметр представляет собой JSON в кодировке Base64, содержащий несколько подробных параметров. См. раздел [параметры оценки произношения](#pronunciation-assessment-parameters) для создания этого заголовка. | Необязательно |
| `Content-type` | Описывает формат и кодек предоставленных аудиоданных. Допустимые значения: `audio/wav; codecs=audio/pcm; samplerate=16000` и `audio/ogg; codecs=opus`. | Обязательно |
| `Transfer-Encoding` | Указывает, что отправляются фрагментированные аудиоданные, а не один файл. Используйте этот заголовок только при фрагментации аудиоданных. | Необязательно |
| `Expect` | Если используется блочная передача (в предыдущем параметре задано chunked), отправьте `Expect: 100-continue`. Служба "Речь" подтверждает первоначальный запрос и ожидает дополнительные данные.| Обязательный, если отправляются фрагментированные аудиоданные. |
| `Accept` | Если указан, этот заголовок должен иметь значение `application/json`. Служба распознавания речи предоставляет результаты в формате JSON. Некоторые платформы запросов предоставляют несовместимое значение по умолчанию. Рекомендуется всегда включать `Accept` . | Необязательный, но рекомендуется включать. |

### <a name="audio-formats"></a>Форматы аудио

Аудио отправляется в тексте HTTP-запроса `POST`. Аудиопоток должен иметь один из форматов, приведенных в следующей таблице:

| Формат | Кодек | Скорость потока | Частота выборки  |
|--------|-------|----------|--------------|
| WAV    | PCM   | 256 кбит/с | 16 кГц, моно |
| OGG    | OPUS  | 256 кпбс | 16 кГц, моно |

>[!NOTE]
>Приведенные выше форматы поддерживаются с помощью REST API для коротких аудио и WebSocket в службе речи. В настоящее время [пакет SDK для распознавания речи](speech-sdk.md) поддерживает формат WAV с кодеком PCM и [другими форматами](how-to-use-codec-compressed-audio-input-streams.md).

### <a name="pronunciation-assessment-parameters"></a>Параметры оценки произношения

В этой таблице перечислены обязательные и необязательные параметры для оценки произношения.

| Параметр | Описание | Необходим? |
|-----------|-------------|---------------------|
| референцетекст | Текст, по которому будет оцениваться произношение. | Обязательно |
| градингсистем | Система точек для калибровки оценок. `FivePoint`Система дает 0-5 оценку с плавающей запятой и `HundredMark` предоставляет 0-100 с плавающей запятой. Значение по умолчанию: `FivePoint`. | Необязательно |
| Степень детализации данных | Гранулярность оценки. Допустимые значения: `Phoneme` , которые показывают оценку для полного текста, Word и phoneme Level, `Word` который показывает оценку на полном тексте и на уровне слов, то `FullText` есть только на уровне Full Text. Значение по умолчанию — `Phoneme`. | Необязательно |
| Измерение | Определяет выходные условия. Допустимые значения: `Basic` , в которых показана только оценка точности, `Comprehensive` показывает оценки для большего количества измерений (например, оценка владениености и оценка полноты на уровне полнотекстового текста, тип ошибки на уровне Word). Проверьте [параметры ответа](#response-parameters) , чтобы просмотреть определения различных измерений оценки и типов ошибок Word. Значение по умолчанию — `Basic`. | Необязательно |
| енаблемискуе | Включает вычисление мискуе. Если этот параметр включен, то произведение слов будет сравниваться с текстом ссылки и будет отмечено с помощью пропуска или вставки на основе сравнения. Допустимые значения: `False` и `True`. Значение по умолчанию — `False`. | Необязательно |
| сценариоид | Идентификатор GUID, указывающий настроенную систему точек. | Необязательно |

Ниже приведен пример JSON, содержащий параметры оценки произношения:

```json
{
  "ReferenceText": "Good morning.",
  "GradingSystem": "HundredMark",
  "Granularity": "FullText",
  "Dimension": "Comprehensive"
}
```

В следующем примере кода показано, как создать параметры оценки произношения в `Pronunciation-Assessment` заголовке:

```csharp
var pronAssessmentParamsJson = $"{{\"ReferenceText\":\"Good morning.\",\"GradingSystem\":\"HundredMark\",\"Granularity\":\"FullText\",\"Dimension\":\"Comprehensive\"}}";
var pronAssessmentParamsBytes = Encoding.UTF8.GetBytes(pronAssessmentParamsJson);
var pronAssessmentHeader = Convert.ToBase64String(pronAssessmentParamsBytes);
```

Мы настоятельно рекомендуем передавать потоковые (фрагментированные) данные при публикации аудиоданных, что может значительно снизить задержку. Сведения о включении потоковой передачи см. [в разделе пример кода на различных языках программирования](https://github.com/Azure-Samples/Cognitive-Speech-TTS/tree/master/PronunciationAssessment) .

>[!NOTE]
>Функция оценки произношения в настоящее время доступна только `westus` для `eastasia` `centralindia` регионов и. Эта функция в настоящее время доступна только на `en-US` языке.

### <a name="sample-request"></a>Пример запроса

Приведенный ниже пример включает имя узла и обязательные заголовки. Важно отметить, что служба также ожидает передачи аудиоданных, которые не включены в этом примере. Как упоминалось ранее, фрагментация рекомендуется, но не обязательна.

```HTTP
POST speech/recognition/conversation/cognitiveservices/v1?language=en-US&format=detailed HTTP/1.1
Accept: application/json;text/xml
Content-Type: audio/wav; codecs=audio/pcm; samplerate=16000
Ocp-Apim-Subscription-Key: YOUR_SUBSCRIPTION_KEY
Host: westus.stt.speech.microsoft.com
Transfer-Encoding: chunked
Expect: 100-continue
```

Чтобы включить оценку произношения, можно добавить следующий заголовок. См. раздел [параметры оценки произношения](#pronunciation-assessment-parameters) для создания этого заголовка.

```HTTP
Pronunciation-Assessment: eyJSZWZlcm...
```

### <a name="http-status-codes"></a>Коды состояния HTTP

Код состояния HTTP для каждого ответа указывает на успешное выполнение или возникновение распространенных ошибок.

| Код состояния HTTP | Описание | Возможная причина |
|------------------|-------------|-----------------|
| `100` | Продолжить | Первоначальный запрос принят. Перейдите к отправке данных, которые остались. (Используется с фрагментированным перемещением) |
| `200` | OK | Запрос выполнен успешно; текст ответа представляет собой объект JSON. |
| `400` | Недопустимый запрос | Не указан языковой код, неподдерживаемый язык, недопустимый звуковой файл и т. д. |
| `401` | Не авторизовано | Ключ подписки или маркер авторизации является недопустимым в указанном регионе, или недопустимая конечная точка. |
| `403` | Запрещено | Отсутствует ключ подписки или маркер авторизации. |

### <a name="chunked-transfer"></a>Блочная передача

Поблочное перемещение ( `Transfer-Encoding: chunked` ) может помочь снизить задержку при распознавании. Он позволяет службе распознавания речи начать обработку звукового файла во время его передачи. REST API для коротких аудиозаписей не предоставляет частичные или промежуточные результаты.

Этот пример кода показывает, как отправлять фрагментированное аудио. Только первый фрагмент данных должен содержать заголовок звукового файла. `request` — `HttpWebRequest` объект, подключенный к соответствующей конечной точке RESTful. `audioFile` — путь к звуковому файлу на диске.

```csharp
var request = (HttpWebRequest)HttpWebRequest.Create(requestUri);
request.SendChunked = true;
request.Accept = @"application/json;text/xml";
request.Method = "POST";
request.ProtocolVersion = HttpVersion.Version11;
request.Host = host;
request.ContentType = @"audio/wav; codecs=audio/pcm; samplerate=16000";
request.Headers["Ocp-Apim-Subscription-Key"] = "YOUR_SUBSCRIPTION_KEY";
request.AllowWriteStreamBuffering = false;

using (var fs = new FileStream(audioFile, FileMode.Open, FileAccess.Read))
{
    // Open a request stream and write 1024 byte chunks in the stream one at a time.
    byte[] buffer = null;
    int bytesRead = 0;
    using (var requestStream = request.GetRequestStream())
    {
        // Read 1024 raw bytes from the input audio file.
        buffer = new Byte[checked((uint)Math.Min(1024, (int)fs.Length))];
        while ((bytesRead = fs.Read(buffer, 0, buffer.Length)) != 0)
        {
            requestStream.Write(buffer, 0, bytesRead);
        }

        requestStream.Flush();
    }
}
```

### <a name="response-parameters"></a>Параметры ответа

Результаты предоставляются в формате JSON. Формат `simple` включает эти поля верхнего уровня.

| Параметр | Описание  |
|-----------|--------------|
|`RecognitionStatus`|Состояние, например, `Success` в случае успешного распознавания. Ознакомьтесь со следующей таблицей.|
|`DisplayText`|Распознанный текст после капитализации, пунктуации, обратная нормализация текста (преобразование речевого текста в более короткие формы, например 200 для "200" или "Dr. Иванов" для "врач Смит") и маскировка ненормативной лексики. Появляется только в случае успешного распознавания.|
|`Offset`|Время (в единицах 100 нс), с которого в звуковом потоке начинается распознанная речь.|
|`Duration`|Длительность (в единицах 100 нс) распознанной речи в звуковом потоке.|

Поле `RecognitionStatus` может содержать следующие значения:

| Состояние | Описание |
|--------|-------------|
| `Success` | Речь распознана, и присутствует поле `DisplayText`. |
| `NoMatch` | В аудиопотоке был обнаружена речь, но не были сопоставлены слова в целевом языке. Обычно означает, что язык распознавания — это не тот язык, на котором разговаривает пользователь. |
| `InitialSilenceTimeout` | Начало аудиопотока содержит только тишину, и время ожидания на появление речи в службе истекло. |
| `BabbleTimeout` | Начало аудиопотока содержит только шум, и время ожидания на появление речи в службе истекло. |
| `Error` | Служба распознавания обнаружила внутреннюю ошибку и не может продолжить работу. Повторите попытку, если это возможно. |

> [!NOTE]
> Если звуковой файл содержит только ненормативную лексику, а параметр запроса `profanity` имеет значение `remove`, служба не возвращает результат распознавания речи.

`detailed`Формат включает дополнительные формы распознанных результатов.
При использовании формата `detailed` параметр `DisplayText` указывается как `Display` для каждого результата в списке `NBest`.

Объект в `NBest` списке может включать:

| Параметр | Описание |
|-----------|-------------|
| `Confidence` | Оценка достоверности записи, от 0,0 (недостоверно) до 1,0 (полная достоверность) |
| `Lexical` | Лексическая форма распознанного текста: конкретные распознанные слова. |
| `ITN` | Форма распознанного текста после обратной нормализации ("каноническая" форма) с номерами телефонов, числами, сокращениями ("профессор Преображенский" до "проф. Преображенский") и другими выполненными преобразованиями. |
| `MaskedITN` | Форма ITN с применением маскировки ненормативной лексики, если запрашивалась. |
| `Display` | Отображаемая форма распознанного текста с расстановкой знаков препинания и прописных букв. Этот параметр совпадает с параметром `DisplayText`, если указан формат `simple`. |
| `AccuracyScore` | Точность произношения речи. Точность указывает, насколько близко фонемы соответствует произношению собственного динамика. Оценка точности слов и полнотекстового индекса вычисляется из оценки точности на уровне phoneme. |
| `FluencyScore` | Владение заданной речи. Владение указывает, насколько близко речь соответствует использованию собственного динамика для автоматического разрыва слов. |
| `CompletenessScore` | Полнота речи, определяемая путем вычисления соотношения слов со словами для ссылки на ввод текста. |
| `PronScore` | Общая оценка, показывающая качество произношения заданной речи. Это статистическое вычисление `AccuracyScore` из `FluencyScore` и `CompletenessScore` с весом. |
| `ErrorType` | Это значение указывает, пропущено ли слово, вставлено или неверно, по сравнению с `ReferenceText` . Возможными значениями являются `None` (это означает отсутствие ошибок в этом слове), `Omission` `Insertion` и `Mispronunciation` . |

### <a name="sample-responses"></a>Образцы ответов

Типичный ответ на `simple` Распознавание:

```json
{
  "RecognitionStatus": "Success",
  "DisplayText": "Remind me to buy 5 pencils.",
  "Offset": "1236645672289",
  "Duration": "1236645672289"
}
```

Типичный ответ на `detailed` Распознавание:

```json
{
  "RecognitionStatus": "Success",
  "Offset": "1236645672289",
  "Duration": "1236645672289",
  "NBest": [
      {
        "Confidence" : "0.87",
        "Lexical" : "remind me to buy five pencils",
        "ITN" : "remind me to buy 5 pencils",
        "MaskedITN" : "remind me to buy 5 pencils",
        "Display" : "Remind me to buy 5 pencils.",
      }
  ]
}
```

Типичный ответ на распознавание с оценкой произношения:

```json
{
  "RecognitionStatus": "Success",
  "Offset": "400000",
  "Duration": "11000000",
  "NBest": [
      {
        "Confidence" : "0.87",
        "Lexical" : "good morning",
        "ITN" : "good morning",
        "MaskedITN" : "good morning",
        "Display" : "Good morning.",
        "PronScore" : 84.4,
        "AccuracyScore" : 100.0,
        "FluencyScore" : 74.0,
        "CompletenessScore" : 100.0,
        "Words": [
            {
              "Word" : "Good",
              "AccuracyScore" : 100.0,
              "ErrorType" : "None",
              "Offset" : 500000,
              "Duration" : 2700000
            },
            {
              "Word" : "morning",
              "AccuracyScore" : 100.0,
              "ErrorType" : "None",
              "Offset" : 5300000,
              "Duration" : 900000
            }
        ]
      }
  ]
}
```

## <a name="next-steps"></a>Дальнейшие действия

- [Создание бесплатной учетной записи Azure.](https://azure.microsoft.com/free/cognitive-services/)
- [Настройка акустических моделей](./how-to-custom-speech-train-model.md)
- [Настройка языковых моделей](./how-to-custom-speech-train-model.md)
- [Знакомство с пакетной обработкой пакетов](batch-transcription.md)