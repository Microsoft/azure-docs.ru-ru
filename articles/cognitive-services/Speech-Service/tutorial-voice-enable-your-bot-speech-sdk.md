---
title: Учебник. Использование голосов для работы с роботами с помощью речевого пакета SDK — служба речи
titleSuffix: Azure Cognitive Services
description: В этом учебнике вы создадите эхо-робот с помощью Microsoft Bot Framework, развернете его в Azure и зарегистрируете в канале голосовой речи прямой линии. Затем вы настроите пример клиентского приложения для Windows, который позволит вам поговорить с программой-роботом и слышать ответ.
services: cognitive-services
author: trevorbye
manager: nitinme
ms.service: cognitive-services
ms.subservice: speech-service
ms.topic: conceptual
ms.date: 02/25/2020
ms.author: trbye
ms.custom: devx-track-csharp
ms.openlocfilehash: d91bfee228b946ff564f6d080976f9ce5c12caa4
ms.sourcegitcommit: 867cb1b7a1f3a1f0b427282c648d411d0ca4f81f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/20/2021
ms.locfileid: "102426269"
---
# <a name="tutorial-voice-enable-your-bot-using-the-speech-sdk"></a>Учебник. Включение программы-робота с помощью речевого пакета SDK

Вы можете использовать голосовую службу, чтобы включить программу-робот чата.

В этом руководстве вы создадите робот, который повторяет то, что вы говорите.
Вы создадите программу-робот с помощью Microsoft Bot Framework, развернете ее в Azure и зарегистрируете в канале голосовой речи прямой линии.
Затем вы настроите пример клиентского приложения для Windows, который позволит вам говорить на роботе и слышать, что он снова говорит вам.

Этот учебник предназначен для разработчиков, которые не знакомы с Azure, Bot Framework программы-роботы, прямой голосовой речи или речевым пакетом SDK, и хотят быстро создать рабочую систему с ограниченным кодом. Нет опыта или знакомства с этими службами.

В этом учебнике используется программа-робот разговора с поддержкой голоса, которая выполняется следующим образом.

1. Пример клиентского приложения настроен для подключения к каналу голосовой речи и поэхо-роботу.
1. Когда пользователь нажимает кнопку, голосовые звуковые потоки из микрофона. (Или звук постоянно записывается при использовании пользовательского ключевого слова.)
1. Если используется настраиваемое ключевое слово, на локальном устройстве выполняется обнаружение ключевых слов, а также ограничение потоковой передачи звука в облако.
1. С помощью пакета SDK для распознавания речи пример клиентского приложения подключается к каналу голосовой речи и потокам аудио.
1. При необходимости в службе происходит проверка ключевых слов с более высокой точностью.
1. Звук передается в службу распознавания речи и расшифрованной в текст.
1. Распознанный текст передается в эхо-робот в качестве действия платформы Bot.
1. Текст ответа включается службой преобразования текста в речь (TTS) и передается обратно клиентскому приложению для воспроизведения.

<!-- svg src in User Story 1754106 -->
![Тег схемы](media/tutorial-voice-enable-your-bot-speech-sdk/diagram.png "Поток речевого канала")

> [!NOTE]
> Для выполнения действий, описанных в этом руководстве, не требуется платная служба. Как новый пользователь Azure, вы сможете использовать кредиты бесплатной пробной подписки Azure и бесплатный уровень службы речи для выполнения этого руководства.

Темы, рассматриваемые в этом руководстве:
> [!div class="checklist"]
> * Создание ресурсов Azure
> * Создание, тестирование и развертывание образца Echo Bot в службе приложений Azure
> * Регистрация программы-робота с помощью канала прямого перевода строки
> * Создание и запуск клиента Windows Voice Assistant для взаимодействия с эхо-роботом
> * Добавить активацию настраиваемого ключевого слова
> * Узнайте, как изменить язык распознанной и речевой речи

## <a name="prerequisites"></a>Предварительные требования

Для работы с этим руководством необходимо выполнить следующие действия.

- КОМПЬЮТЕР с Windows 10 с рабочим микрофоном и динамиками (или наушниками)
- [Visual Studio 2017](https://visualstudio.microsoft.com/downloads/) или более поздней версии с установленной рабочей нагрузкой **ASP.NET и Web Development**
- [Платформа .NET Framework среды выполнения 4.6.1](https://dotnet.microsoft.com/download) или выше
- Учетная запись Azure. [Зарегистрируйтесь бесплатно](https://azure.microsoft.com/free/cognitive-services/)
- Учетная запись [GitHub](https://github.com/)
- [Git для Windows](https://git-scm.com/download/win)

## <a name="create-a-resource-group"></a>Создание группы ресурсов

В клиентском приложении, которое вы создадите в этом руководстве, используется несколько служб Azure. Чтобы сократить время приема-передачи для ответов от программы-робота, необходимо убедиться, что эти службы расположены в одном регионе Azure. В этом разделе вы создадите группу ресурсов в регионе " **Западная часть США** ". Эта группа ресурсов будет использоваться при создании отдельных ресурсов для Bot Framework, канала речевого перевода строки и службы распознавания речи.

1. <a href="https://ms.portal.azure.com/#create/Microsoft.ResourceGroup" target="_blank">Создание группы ресурсов </a>
1. Вам будет предложено ввести некоторые сведения:
   * Установите **бесплатную пробную версию** **подписки** (можно также использовать существующую подписку).
   * Введите имя **группы ресурсов**. Рекомендуется **спичечоботтуториал-ResourceGroup**.
   * В раскрывающемся списке **регион** выберите **Западная часть США**.
1. Щелкните **Проверка и создание**. Вы увидите баннер, **прошедший проверку** на прочтение.
1. Нажмите кнопку **Создать**. Создание группы ресурсов может занять несколько минут.
1. Как и в случае с ресурсами, которые будут созданы далее в этом учебнике, рекомендуется закрепить эту группу ресурсов на панели мониторинга для упрощения доступа. Если вы хотите закрепить эту группу ресурсов, щелкните значок закрепления справа от имени группы ресурсов.

### <a name="choosing-an-azure-region"></a>Выбор региона Azure

Если вы хотите использовать другой регион для этого руководства, эти факторы могут ограничить выбор:

* Убедитесь, что вы используете [поддерживаемый регион Azure](regions.md#voice-assistants).
* В канале голосового перевода прямой линии используется служба преобразования текста в речь, которая имеет стандартные и нейронные голоса. Нейронные голоса [ограничены конкретными регионами Azure](regions.md#standard-and-neural-voices).

Дополнительные сведения о регионах см. в разделе [расположения Azure](https://azure.microsoft.com/global-infrastructure/locations/).

## <a name="create-resources"></a>Создание ресурсов

Теперь, когда у вас есть группа ресурсов в поддерживаемом регионе, необходимо создать отдельные ресурсы для каждой службы, которая будет использоваться в этом руководстве.

### <a name="create-a-speech-service-resource"></a>Создание ресурса службы "Речь"

Чтобы создать речевой ресурс, выполните следующие инструкции:

1. <a href="https://ms.portal.azure.com/#create/Microsoft.CognitiveServicesSpeechServices" target="_blank">Создание ресурса службы речи </a>
4. Вам будет предложено ввести некоторые сведения:
   * Присвойте ресурсу **имя**. Рекомендуем **спичечоботтуториал-речь**
   * Убедитесь, что для **подписки** выбрана **Бесплатная пробная версия** .
   * В качестве **расположения** выберите **Западная часть США**.
   * В качестве **ценовой** категории выберите **F0**. Это бесплатный уровень.
   * В качестве **группы ресурсов** выберите **спичечоботтуториал-ResourceGroup**.
5. После введения всех необходимых сведений нажмите кнопку **создать**. Создание ресурса может занять несколько минут.
6. Далее в этом учебнике вам понадобятся ключи подписки для этой службы. Доступ к этим ключам можно получить в любое время из **обзора** ресурса (управление ключами) или **ключей**.

На этом этапе убедитесь, что в группе ресурсов (**спичечоботтуториал-ResourceGroup**) есть ресурс речи:

| Имя | Тип  | Расположение |
|------|-------|----------|
| SpeechEchoBotTutorial-Speech | Службы Cognitive Services | Западная часть США |

### <a name="create-an-azure-app-service-plan"></a>Создание плана службы приложений Azure

Следующим шагом является создание плана службы приложений. План службы приложений определяет набор вычислительных ресурсов, на которых выполняется веб-приложение.

1. <a href="https://ms.portal.azure.com/#create/Microsoft.AppServicePlanCreate" target="_blank">Создание плана службы приложений Azure </a>
4. Вам будет предложено ввести некоторые сведения:
   * Установите **бесплатную пробную версию** **подписки** (можно также использовать существующую подписку).
   * В качестве **группы ресурсов** выберите **спичечоботтуториал-ResourceGroup**.
   * Присвойте ресурсу **имя**. Рекомендуется **спичечоботтуториал-AppServicePlan**
   * В качестве **операционной системы** выберите **Windows**.
   * В качестве **региона** выберите **Западная часть США**.
   * Убедитесь, что для **ценовой** категории выбрано " **стандартный S1** ". Это должно быть значение по умолчанию. Если это не так, убедитесь, что установлена **Операционная система** **Windows** , как описано выше.
5. Щелкните **Проверка и создание**. Вы увидите баннер, **прошедший проверку** на прочтение.
6. Нажмите кнопку **Создать**. Создание группы ресурсов может занять несколько минут.

На этом этапе убедитесь, что ваша группа ресурсов (**спичечоботтуториал-ResourceGroup**) имеет два ресурса:

| Имя | Тип  | Расположение |
|------|-------|----------|
| SpeechEchoBotTutorial-AppServicePlan | План службы приложений | Западная часть США |
| SpeechEchoBotTutorial-Speech | Службы Cognitive Services | Западная часть США |

## <a name="build-an-echo-bot"></a>Создание эхо-робота

Теперь, когда вы создали некоторые ресурсы, давайте создадим робот. Мы начнем с образца Echo Bot, который, как следует из названия, отображает текст, введенный в качестве ответа. Не беспокойтесь, пример кода готов к использованию без каких-либо изменений. Он настроен для работы с каналом голосовых речевых операций, который мы будем подключать после развертывания программы-робота в Azure.

> [!NOTE]
> Приведенные ниже инструкции, а также дополнительные сведения о программе Echo Bot доступны в [файле сведений примера на сайте GitHub](https://github.com/microsoft/BotBuilder-Samples/blob/master/samples/csharp_dotnetcore/02.echo-bot/README.md).

### <a name="run-the-bot-sample-on-your-machine"></a>Запуск примера программы Bot на компьютере

1. Клонировать репозиторий примеров:

   ```bash
   git clone https://github.com/Microsoft/botbuilder-samples.git
   ```

2. Запустите Visual Studio.
3. На панели инструментов выберите **файл**  >  **Открыть**  >  **проект/решение** и откройте решение Echo Bot проекта:

   ```
   samples\csharp_dotnetcore\02.echo-bot\EchoBot.sln
   ```

4. После загрузки проекта нажмите клавишу <kbd>F5</kbd> , чтобы построить и запустить проект.
5. Будет запущен браузер, и появится экран, аналогичный приведенному выше.
    > [!div class="mx-imgBorder"]
    > [![На снимке экрана показана страница Ечобот с сообщением о готовности ленты.](media/tutorial-voice-enable-your-bot-speech-sdk/echobot-running-on-localhost.png "Ечобот, выполняемый на localhost")](media/tutorial-voice-enable-your-bot-speech-sdk/echobot-running-on-localhost.png#lightbox)

### <a name="test-the-bot-sample-with-the-bot-framework-emulator"></a>Тестирование образца Bot с помощью эмулятора Bot Framework

[Эмулятор Bot](https://github.com/microsoft/botframework-emulator) -приложения — это классическое приложение, позволяющее Bot-разработчикам тестировать и отлаживать свои программы-роботы локально (или удаленно через туннель). Эмулятор принимает введенный текст в качестве входных данных (а не голоса). Bot также будет реагировать на текст. Выполните следующие действия, чтобы использовать эмулятор Bot-канала для проверки запуска эхо-робота на локальном компьютере с текстовым входом и выводом текста. После развертывания Bot в Azure мы протестируем его с голосовым входом и голосовым выходом.

1. Установка [эмулятора Bot Framework](https://github.com/Microsoft/BotFramework-Emulator/releases/latest) версии 4.3.0 или более поздней
2. Запустите эмулятор Bot Framework и откройте программу Bot:
   * **Файл**  ->  **Откройте Bot**.
3. Введите URL-адрес для Bot. Пример:

   ```
   http://localhost:3978/api/messages
   ```
   и нажмите кнопку "подключить".
4. Программа-робот должна greet вас с «Привет и Добро пожаловать!». . Введите любое текстовое сообщение и подтвердите получение ответа от программы-робота.
5. Вот как может выглядеть обмен данными с экземпляром эхо-робота: [ ![на снимке экрана показан эмулятор ленты.](media/tutorial-voice-enable-your-bot-speech-sdk/bot-framework-emulator.png "Эмулятор Bot Framework")](media/tutorial-voice-enable-your-bot-speech-sdk/bot-framework-emulator.png#lightbox)

## <a name="deploy-your-bot-to-an-azure-app-service"></a>Развертывание программы Bot в службе приложений Azure

Следующим шагом является развертывание эхо-робота в Azure. Существует несколько способов развертывания программы-робота, но в этом учебнике мы рассмотрим публикацию непосредственно из Visual Studio.

> [!NOTE]
> Кроме того, программу-робот можно развернуть с помощью шаблонов [Azure CLI](/azure/bot-service/bot-builder-deploy-az-cli) и [развертывания](https://github.com/microsoft/BotBuilder-Samples/tree/master/samples/csharp_dotnetcore/adaptive-dialog/03.core-bot).

> [!NOTE]
> Если **Публикация...** не отображается при выполнении следующих действий, используйте Visual Studio Installer, чтобы добавить рабочую нагрузку **ASP.NET и веб-разработка** .

1. В Visual Studio откройте эхо-робот, настроенный для использования с прямым каналом речи:

   ```
   samples\csharp_dotnetcore\02.echo-bot\EchoBot.sln
   ```

1. В **Обозреватель решений** щелкните правой кнопкой мыши проект **Ечобот** и выберите **Опубликовать...**
1. Откроется новое окно Publish ( **Публикация** ).
1. Выберите **Azure**, нажмите кнопку **Далее**, выберите **служба приложений Azure (Windows)**, нажмите кнопку **Далее** и щелкните **создать новую службу приложений Azure...** рядом с зеленым знаком «плюс».
1. Когда появится окно **службы приложений (Windows)** :
   * Щелкните **Добавить учетную запись** и выполните вход с использованием учетных данных учетной записи Azure. Если вы уже вошли, выберите нужную учетную запись из раскрывающегося списка.
   * В качестве **имени** необходимо ввести глобально уникальное имя для программы-робота. Это имя используется для создания уникального URL-адреса Bot. Будет заполнено значение по умолчанию, включая дату и время (например, "EchoBot20190805125647"). Для этого руководства можно использовать имя по умолчанию.
   * Для параметра **Подписка** установите значение **Бесплатная пробная версия** .
   * В качестве **группы ресурсов** выберите **спичечоботтуториал-ResourceGroup** .
   * Для **плана размещения** выберите **спичечоботтуториал-AppServicePlan** .
1. Нажмите кнопку **Создать**. На последнем экране мастера нажмите кнопку **Готово**.
1. Щелкните **опубликовать** в правой части экрана публикации. Visual Studio развертывает Bot в Azure.
1. В окне вывода Visual Studio должно отобразиться сообщение об успешном выполнении, которое выглядит следующим образом:

   ```
   Publish Succeeded.
   Web App was published successfully https://EchoBot20190805125647.azurewebsites.net/
   ```

1. Браузер по умолчанию должен открыть и отобразить страницу, которая читает: "ваш робот готов!".
1. На этом этапе проверьте группу ресурсов **спичечоботтуториал-ResourceGroup** в портал Azure и убедитесь, что эти три ресурса:

| Имя | Тип  | Расположение |
|------|-------|----------|
| EchoBot20190805125647 | Служба приложений | Западная часть США |
| SpeechEchoBotTutorial-AppServicePlan | План службы приложений | Западная часть США |
| SpeechEchoBotTutorial-Speech | Службы Cognitive Services | Западная часть США |

## <a name="enable-web-sockets"></a>Включение протокола WebSocket

Необходимо внести небольшое изменение в конфигурацию, чтобы программа Bot могла обмениваться данными с каналом голосовой речи с помощью веб-сокетов. Чтобы включить веб-сокеты, выполните следующие действия.

1. Перейдите к [портал Azure](https://portal.azure.com)и щелкните службу приложений. Ресурс должен называться похожим на **EchoBot20190805125647** (уникальное имя приложения).
2. В области навигации слева в разделе **Параметры** щелкните **Конфигурация**.
3. Перейдите на вкладку **Общие параметры** .
4. Выберите переключатель для **веб-сокетов** и установите для него значение **вкл**.
5. Выберите команду **Сохранить**.

> [!TIP]
> Вы можете использовать элементы управления в верхней части страницы службы приложений Azure, чтобы прерывать или перезапускать службу. Это может быть полезным при устранении неполадок.

## <a name="create-a-channel-registration"></a>Создание регистрации канала

Теперь, когда вы создали службу приложений Azure для размещения программы Bot, следующим шагом является создание **регистрации каналов Bot**. Создание регистрации канала является необходимым условием для регистрации программы-робота с каналами ленты, включая прямой канал речи. Если вы хотите узнать больше о том, как программы-роботы использовать каналы, см. статью [Подключение канала Bot к каналам](/azure/bot-service/bot-service-manage-channels).

1. <a href="https://ms.portal.azure.com/#create/Microsoft.BotServiceConnectivityGalleryPackage" target="_blank">Создание регистрации каналов Azure Bot </a>
2. Вам будет предложено ввести некоторые сведения:
   * В качестве **маркера Bot** введите **спичечоботтуториал-ботрегистратион-# # # #** и замените **####** вашим выбором. Обратите внимание, что маркер Bot должен быть глобально уникальным. При вводе маркера Bot, но при получении сообщения об ошибке _запрошенный идентификатор Bot недоступен_, а затем выбирается другое число. В приведенных ниже примерах мы использовали 8726
   * В качестве **подписки** выберите **Бесплатная пробная версия**.
   * В качестве **группы ресурсов** выберите **спичечоботтуториал-ResourceGroup**.
   * В качестве **расположения** выберите **Западная часть США**.
     * В качестве **ценовой** категории выберите **F0**.
     * В поле **Конечная точка обмена сообщениями** введите URL-адрес для веб – приложения, `/api/messages` к которому добавляется путь в конце. Например, если глобально уникальное имя приложения было **EchoBot20190805125647**, конечная точка обмена сообщениями будет выглядеть так: `https://EchoBot20190805125647.azurewebsites.net/api/messages/` .
     * Для **Application Insights** можно установить значение **Off**. Дополнительные сведения см. в статье [Bot Analytics](/azure/bot-service/bot-service-manage-analytics).
     * Игнорировать **Автоматическое создание идентификатора приложения и пароля**.
5. В нижней части колонки **регистрации каналов Bot** щелкните **создать**.

На этом этапе проверьте группу ресурсов **спичечоботтуториал-ResourceGroup** в портал Azure. Теперь он должен отображать по крайней мере четыре ресурса:

| Имя | Тип  | Расположение |
|------|-------|----------|
| EchoBot20190805125647 | Служба приложений | Западная часть США |
| SpeechEchoBotTutorial-AppServicePlan | План службы приложений | Западная часть США |
| Спичечоботтуториал-Ботрегистратион-8726 | Регистрация каналов Bot | Глобальный |
| SpeechEchoBotTutorial-Speech | Службы Cognitive Services | Западная часть США |

> [!IMPORTANT]
> В ресурсе регистрации каналов Bot будет показан глобальный регион, даже если вы выбрали "Западная часть США". Это ожидаемое поведение.

## <a name="optional-test-in-web-chat"></a>Необязательно: тестирование в веб-чате

На странице регистрации каналов Azure Bot в разделе "Управление программой- **Bot**" находится параметр " **Проверка в Интернете** ". По умолчанию он не будет работать с программой-роботом, так как для работы с Bot требуется проверка подлинности в Интернете. Если вы хотите протестировать развернутую программу-робот с текстовым входом, выполните следующие действия. Обратите внимание, что эти шаги являются необязательными и не являются обязательными для продолжения работы со следующими шагами учебника. 

1. Перейдите к ресурсу **ечоботтуториал-ботрегистратион-# # # #** в [портал Azure](https://portal.azure.com) и откройте его.
1. На панели навигации по **управлению Bot** выберите **Параметры**. Скопируйте значение под **идентификатором приложения Microsoft**
1. Откройте решение Visual Studio Ечобот. В обозревателе решений перейдите на **appsettings.js** и дважды щелкните на
1. Замените пустую строку рядом с **микрософтаппид** в файле JSON значением СКОПИРОВАНного идентификатора
1. Вернитесь к портал Azureу, в области навигации по **управлению Bot** выберите **Параметры** и щелкните **(управление)** рядом с **идентификатором приложения Microsoft** .
1. Щелкните **новый секрет клиента**. Добавьте описание (например, "Интернет-чат") и нажмите кнопку **Добавить**. Копировать новый секрет
1. Замените пустую строку рядом с **микрософтапппассворд** в файле JSON значением скопированного секрета
1. Сохраните файл JSON. Должно отобразиться примерно следующее:
```json
{
  "MicrosoftAppId": "3be0abc2-ca07-475e-b6c3-90c4476c4370",
  "MicrosoftAppPassword": "-zRhJZ~1cnc7ZIlj4Qozs_eKN.8Cq~U38G"
}
```
9. Повторно опубликуйте приложение (щелкните правой кнопкой мыши проект **ечобот** в обозревателе решений Visual Studio, выберите **Опубликовать...** и нажмите кнопку " **опубликовать** ").
10. Теперь вы готовы к тестированию программы-робота в Интернете.

## <a name="register-the-direct-line-speech-channel"></a>Регистрация канала речи прямой линии

Теперь пришло время зарегистрировать программу-робот с помощью канала голосовой речи прямой линии. Этот канал создает подключение между Bot и клиентским приложением, скомпилированным с помощью речевого пакета SDK.

1. В [портал Azure](https://portal.azure.com)перейдите на ресурс **спичечоботтуториал-ботрегистратион-# # # #** и откройте его.
1. На панели навигации по **управлению Bot** выберите **каналы**.
   * В разделе **дополнительные каналы** выберите пункт **прямое речевое распознавание**.
   * Просмотрите текст на странице **Настройка прямого перевода строки**, а затем раскройте раскрывающееся меню **учетной записи службы** .
   * Выберите созданный ранее ресурс речи (например, **спичечоботтуториал-Speech**) в меню, чтобы связать робот с ключом подписки на речь.
   * Игнорировать остальные необязательные поля.
   * Выберите команду **Сохранить**.

1. На панели навигации по **управлению Bot** щелкните **Параметры**.
   * Установите флажок **включить конечную точку потоковой передачи**. Это необходимо для создания протокола связи, созданного на основе веб-сокетов между программой Bot и каналом голосовой речи прямой линии.
   * Выберите команду **Сохранить**.

> [!TIP]
> Дополнительные сведения см. в статье [Подключение программы-робота к прямой речи](/azure/bot-service/bot-service-channel-connect-directlinespeech). На этой странице содержатся дополнительные сведения и известные проблемы.

## <a name="run-the-windows-voice-assistant-client"></a>Запуск клиента Windows Voice Assistant

На этом шаге вы запустите клиент помощника по Windows Voice. Клиент — это приложение Windows Presentation Foundation (WPF) на C#, которое использует [речевой пакет SDK](./speech-sdk.md) для управления связью с программой-роботом с помощью канала голосовой речи Direct Line. Используйте его для взаимодействия с и тестирования ленты перед написанием пользовательского клиентского приложения. Это открытый исходный код, поэтому можно загрузить исполняемый файл и запустить его или создать его самостоятельно.

Клиент помощника Windows Voice имеет простой пользовательский интерфейс, позволяющий настроить подключение к Bot, просмотреть текстовую беседу, просмотреть действия программы-робота в формате JSON и отобразить адаптивные карты. Он также поддерживает использование пользовательских ключевых слов. Этот клиент будет использоваться для разговора с программой Bot и получения голосового ответа.

> [!NOTE]
> На этом этапе убедитесь, что микрофон и динамики включены и работают.

1. Перейдите в репозиторий GitHub для [клиента Windows Voice Assistant](https://github.com/Azure-Samples/Cognitive-Services-Voice-Assistant/blob/master/clients/csharp-wpf/README.md).
1. Следуйте инструкциям, приведенным в этой статье.
   * Скачайте предварительно собранный исполняемый файл в ZIP-пакете для запуска или
   * Создайте исполняемый файл самостоятельно, клонировать репозиторий и создав проект.

1. Запустите `VoiceAssistantClient.exe` клиентское приложение и настройте его для подключения к роботу, следуя инструкциям в репозитории GitHub.
1. Нажмите кнопку **Повторное соединение** и убедитесь, что отображается сообщение **Новый диалог начато — введите или нажмите кнопку с микрофоном**.
1. Давайте протестируем ее. Нажмите кнопку микрофон и говорите несколько слов на английском языке. Распознанный текст будет отображаться при диктовке. Когда речь закончится, Bot ответит на свой собственный голос, говорящий «Echo», за которым следует распознанные слова.
1. Можно также использовать текст для взаимодействия с Bot. Просто введите текст на нижней панели. 

### <a name="troubleshooting-errors-in-windows-voice-assistant-client"></a>Устранение ошибок в клиенте Windows Voice Assistant

Если в главном окне приложения появляется сообщение об ошибке, используйте следующую таблицу для обнаружения и устранения ошибки:

| Ошибка | Что следует сделать? |
|-------|----------------------|
|Ошибка (Аусентикатионфаилуре): сбой обновления WebSocket с ошибкой проверки подлинности (401). Проверьте правильность ключа подписки (или маркера авторизации) и имя региона.| На странице Параметры приложения убедитесь, что вы правильно указали ключ подписки на речь и его регион.<br>Убедитесь, что ваш ключ речи и область ключей введены правильно. |
|Ошибка (Коннектионфаилуре): соединение было закрыто удаленным узлом. Код ошибки: 1011. Сведения об ошибке: не удалось подключиться к Bot перед отправкой сообщения | Убедитесь, что [установлен флажок "включить конечную точку потоковой передачи"](#register-the-direct-line-speech-channel) и/или [переключаемые **веб-сокеты**](#enable-web-sockets) .<br>Убедитесь, что служба приложений Azure запущена. Если это так, попробуйте перезапустить службу приложений.|
|Ошибка (Коннектионфаилуре): соединение было закрыто удаленным узлом. Код ошибки: 1002. Сведения об ошибке: сервер вернул код состояния "503", когда ожидался код состояния "101" | Убедитесь, что [установлен флажок "включить конечную точку потоковой передачи"](#register-the-direct-line-speech-channel) и/или [переключаемые **веб-сокеты**](#enable-web-sockets) .<br>Убедитесь, что служба приложений Azure запущена. Если это так, попробуйте перезапустить службу приложений.|
|Ошибка (Коннектионфаилуре): соединение было закрыто удаленным узлом. Код ошибки: 1011. Сведения об ошибке: код состояния ответа не указывает на успешное выполнение: 500 (InternalServerError)| Ваш Bot указал нейронный голос [в поле](https://github.com/microsoft/botframework-sdk/blob/master/specs/botframework-activity/botframework-activity.md#speak) выходного действия, но регион Azure, связанный с ключом подписки на речь, не поддерживает нейронные голоса. См. раздел [Стандартные и нейронные голоса](./regions.md#standard-and-neural-voices).|

Если эта ошибка не устранена в таблице, см. раздел ["помощники для голоса": часто задаваемые вопросы](faq-voice-assistants.md). Если после выполнения всех действий, описанных в этом руководстве, по-прежнему не удается устранить проблему, введите новую проблему на  [странице GitHub для голоса](https://github.com/Azure-Samples/Cognitive-Services-Voice-Assistant/issues).

#### <a name="a-note-on-connection-time-out"></a>Примечание об истечении времени ожидания подключения

Если вы подключены к Bot и никакие действия не происходили за последние 5 минут, служба автоматически закроет соединение WebSocket с клиентом и с помощью программы-робота. Это сделано намеренно. На нижней панели появится сообщение: *"активное подключение превышено, но готово к повторному подключению по запросу"*. Не нужно нажимать кнопку "повторное подключение". просто нажмите кнопку "микрофон" и начните говорить, вводите текстовое сообщение или скажите ключевое слово (если оно включено). Соединение будет автоматически восстановлено.  
### <a name="view-bot-activities"></a>Просмотр действий программы-робота

Каждый Bot отправляет и получает сообщения о **действиях** . В окне **Журнал действий** клиента Windows Voice Assistant Вы увидите журналы с метками времени с каждым действием, полученным клиентом от Bot. Вы также можете просмотреть действия, отправленные клиентом в Bot с помощью [`DialogServiceConnector.SendActivityAsync`](/dotnet/api/microsoft.cognitiveservices.speech.dialog.dialogserviceconnector.sendactivityasync)  метода. При выборе элемента журнала отображаются сведения о связанном действии в формате JSON.

Ниже приведен пример JSON действия, полученного клиентом.

```json
{
    "attachments":[],
    "channelData":{
        "conversationalAiData":{
             "requestInfo":{
                 "interactionId":"8d5cb416-73c3-476b-95fd-9358cbfaebfa",
                 "version":"0.2"
             }
         }
    },
    "channelId":"directlinespeech",
    "conversation":{
        "id":"129ebffe-772b-47f0-9812-7c5bfd4aca79",
        "isGroup":false
    },
    "entities":[],
    "from":{
        "id":"SpeechEchoBotTutorial-BotRegistration-8726"
    },
    "id":"89841b4d-46ce-42de-9960-4fe4070c70cc",
    "inputHint":"acceptingInput",
    "recipient":{
        "id":"129ebffe-772b-47f0-9812-7c5bfd4aca79|0000"
    },
    "replyToId":"67c823b4-4c7a-4828-9d6e-0b84fd052869",
    "serviceUrl":"urn:botframework:websocket:directlinespeech",
    "speak":"<speak version='1.0' xmlns='https://www.w3.org/2001/10/synthesis' xml:lang='en-US'><voice name='Microsoft Server Speech Text to Speech Voice (en-US, AriaRUS)'>Echo: Hello and welcome.</voice></speak>",
    "text":"Echo: Hello and welcome.",
    "timestamp":"2019-07-19T20:03:51.1939097Z",
    "type":"message"
}
```

Дополнительные сведения о возможностях, возвращаемых в выходных данных JSON, см. в разделе [поля в действии](https://github.com/microsoft/botframework-sdk/blob/master/specs/botframework-activity/botframework-activity.md). В рамках этого руководства вы можете сосредоточиться на [тексте](https://github.com/microsoft/botframework-sdk/blob/master/specs/botframework-activity/botframework-activity.md#text) и [поговорить](https://github.com/microsoft/botframework-sdk/blob/master/specs/botframework-activity/botframework-activity.md#speak) с полями.

### <a name="view-client-source-code-for-calls-to-the-speech-sdk"></a>Просмотр исходного кода клиента для вызовов пакета SDK для распознавания речи

Клиент помощника по Windows Voice использует пакет NuGet [Microsoft. CognitiveServices. Speech](https://www.nuget.org/packages/Microsoft.CognitiveServices.Speech/), который содержит РЕЧЕВОЙ пакет SDK. Хорошим местом для начала рассмотрения примера кода является метод Инитспичконнектор () в файле [`VoiceAssistantClient\MainWindow.xaml.cs`](https://github.com/Azure-Samples/Cognitive-Services-Voice-Assistant/blob/master/clients/csharp-wpf/VoiceAssistantClient/MainWindow.xaml.cs) , который создает эти два объекта SDK для речи:
- [`DialogServiceConfig`](/dotnet/api/microsoft.cognitiveservices.speech.dialog.dialogserviceconfig) — Для параметров конфигурации (например, ключа подписки на речь, региона ключей);
- [`DialogServiceConnector`](/dotnet/api/microsoft.cognitiveservices.speech.dialog.dialogserviceconnector.-ctor) — Управление подключением канала и событиями клиентской подписки для обработки распознанных речевых ответов и сообщений Bot.

## <a name="add-custom-keyword-activation"></a>Добавить активацию настраиваемого ключевого слова

Пакет SDK для распознавания речи поддерживает пользовательскую активацию ключевого слова. Как и в случае с "Привет, Кортана" для помощника Майкрософт, вы можете написать приложение, которое будет постоянно прослушивать ключевое слово по своему усмотрению. Помните, что ключевое слово может быть одиночным словом или словосочетанием из нескольких слов.

> [!NOTE]
> *Ключевое слово* Term часто используется с термином « *пробуждение слова*» и может отображаться и в документации Майкрософт.

Обнаружение ключевых слов выполняется в клиентском приложении. Если используется ключевое слово, то при обнаружении ключевого слова звук будет передаваться только в канал прямого перевода строки. Канал распознавания речи прямой линии включает компонент, именуемый *проверкой ключевого слова (КВВ)*, который выполняет более сложную обработку в облаке, чтобы убедиться, что выбранное ключевое слово находится в начале аудиопотока. Если проверка ключевых слов выполняется, канал будет взаимодействовать с Bot.

Выполните следующие действия, чтобы создать модель ключевых слов, настроить клиент помощника по Windows Voice для использования этой модели и, наконец, проверить ее с помощью программы Bot.

1. Выполните эти инструкции, чтобы [создать настраиваемое ключевое слово с помощью службы распознавания речи](./custom-keyword-basics.md).
2. Распакуйте файл модели, скачанный на предыдущем шаге. Он должен называться для ключевого слова. Выполняется поиск файла с именем `kws.table` .
3. В клиенте Windows Voice Assistant найдите меню **Параметры** (найдите значок шестеренки в правом верхнем углу). Выберите **путь к файлу модели** и введите полный путь к `kws.table` файлу из шага 2.
4. Убедитесь, что установлен флажок **включено**. Это сообщение должно появиться рядом с флажком: "будет прослушивать ключевое слово при следующем соединении". Если вы указали неправильный файл или недопустимый путь, появится сообщение об ошибке.
5. Введите **ключ подписки** на речь и **регион ключа подписки**, а затем нажмите кнопку **ОК** , чтобы закрыть меню **параметров** .
6. Нажмите кнопку **Повторное соединение**. Должно отобразиться сообщение: "новый диалог начал работать — тип, нажмите кнопку" микрофон "или скажите ключевое слово". Теперь приложение постоянно ожидает передачи данных.
7. Говорите любую фразу, которая начинается с ключевого слова. Например: "**{ваше ключевое слово}**, какое время это?". Не нужно приостанавливать после уттеринг ключевого слова. По завершении происходят две вещи:
   * Вы увидите транскрипцию того, что вы используете.
   * Вскоре после этого вы услышите ответ Bot
8. Продолжайте экспериментировать с тремя типами входных данных, которые поддерживает Bot:
   * Типизированный текст на нижней панели
   * Нажатие клавиши со значком микрофона и речи
   * Произнести фразу, которая начинается с ключевого слова

### <a name="view-the-source-code-that-enables-keyword"></a>Просмотр исходного кода, включающего ключевое слово

В исходном коде клиента помощника Windows Voice просмотрите эти файлы, чтобы просмотреть код, используемый для включения обнаружения ключевых слов:

1. [`VoiceAssistantClient\Models.cs`](https://github.com/Azure-Samples/Cognitive-Services-Voice-Assistant/blob/master/clients/csharp-wpf/VoiceAssistantClient/Models.cs) включает вызов метода Speech SDK [`KeywordRecognitionModel.fromFile()`](/javascript/api/microsoft-cognitiveservices-speech-sdk/keywordrecognitionmodel#fromfile-string-) , который используется для создания экземпляра модели из локального файла на диске.
1. [`VoiceAssistantClient\MainWindow.xaml.cs`](https://github.com/Azure-Samples/Cognitive-Services-Voice-Assistant/blob/master/clients/csharp-wpf/VoiceAssistantClient/MainWindow.xaml.cs) включает в себя вызов метода Speech SDK [`DialogServiceConnector.StartKeywordRecognitionAsync()`](/dotnet/api/microsoft.cognitiveservices.speech.dialog.dialogserviceconnector.startkeywordrecognitionasync) , который активирует непрерывное обнаружение ключевых слов.

## <a name="optional-change-the-language-and-bot-voice"></a>Используемых Изменение языка и Bot-голоса

Созданная программа-робот будет прослушивать и отвечать на английском языке, а также по умолчанию голосовая речь для английского языка (США). Однако вы не ограничены использованием английского языка или голоса по умолчанию. В этом разделе вы узнаете, как изменить язык, который будет прослушивать Bot и реагировать на него. Вы также узнаете, как выбрать другой голоса для этого языка.

### <a name="change-the-language"></a>Изменение языка

Вы можете выбрать один из языков, упомянутых в таблице преобразования [речи в текст](language-support.md#speech-to-text) . В приведенном ниже примере мы изменим язык на немецкий.

1. Откройте клиентское приложение голосового помощника Windows, нажмите кнопку параметров (значок с правом верхнего правого значка) и введите `de-de` в поле Language (это значение локали, указанное в таблице преобразования [речи в текст](language-support.md#speech-to-text) ). Это задает распознавание речевого языка, переопределяя значение по умолчанию `en-us` . Это также указывает каналу прямого перевода строки на использование немецкого голоса по умолчанию для ответа Bot.
2. Закройте страницу параметры и нажмите кнопку повторного подключения, чтобы установить новое подключение к роботу Echo.
3. Нажмите кнопку микрофон и скажите фразу на немецком языке. Вы увидите распознанный текст и эхо-робот, отвечающий на немецком языке по умолчанию.

### <a name="change-the-default-bot-voice"></a>Изменение голоса для ленты по умолчанию

Выбор голоса для преобразования текста в речь и контроль произношения можно выполнить, если программа-робот задает ответ в виде [языка разметки речи](speech-synthesis-markup.md) (SSML) вместо простого текста. Программа Echo Bot не использует SSML, но можно легко изменить код, чтобы сделать это. В приведенном ниже примере мы добавим SSML к ответу эхо-робота, чтобы вместо розетки по умолчанию использовался немецкий Voice Стефан Apollo (папа). См. список [стандартных голосов](language-support.md#standard-voices) и [нейронных голосов](language-support.md#neural-voices) , поддерживаемых для вашего языка.

1. Начнем с открытия `samples\csharp_dotnetcore\02.echo-bot\echo-bot.cs` .
2. Нахождение следующих двух строк:
    ```csharp
    var replyText = $"Echo: {turnContext.Activity.Text}";
    await turnContext.SendActivityAsync(MessageFactory.Text(replyText, replyText), cancellationToken);
    ```
3. Замените их следующим:
    ```csharp
    var replyText = $"Echo: {turnContext.Activity.Text}";
    var replySpeak = @"<speak version='1.0' xmlns='https://www.w3.org/2001/10/synthesis' xml:lang='de-DE'>
                    <voice name='Microsoft Server Speech Text to Speech Voice (de-DE, Stefan, Apollo)'>" +
                    $"{replyText}" + "</voice></speak>";
    await turnContext.SendActivityAsync(MessageFactory.Text(replyText, replySpeak), cancellationToken);
    ```
4. Создайте решение в Visual Studio и исправьте все ошибки сборки.

Второй аргумент в методе ' Мессажефактори. Text ' задает [поле действия говорите](https://github.com/Microsoft/botframework-sdk/blob/master/specs/botframework-activity/botframework-activity.md#speak) в ответе Bot. При приведенном выше изменении он был заменен простым текстом на SSML для указания немецкого голоса по умолчанию.

### <a name="redeploy-your-bot"></a>Повторное развертывание программы-робота

Теперь, когда вы внесли необходимые изменения в Bot, следующим шагом является повторная публикация в службе приложений Azure и пробная работа:

1. В окне обозреватель решений щелкните правой кнопкой мыши проект **ечобот** и выберите **Publish (опубликовать**).
2. Предыдущая конфигурация развертывания уже загружена по умолчанию. Просто щелкните **Publish (опубликовать** ) рядом с **EchoBot20190805125647-веб-развертывание**.
3. В окне вывода Visual Studio появится сообщение « **Публикация завершена** », и откроется веб-страница с сообщением «ваш робот готов!».
4. Откройте клиентское приложение Windows Voice Assistant, нажмите кнопку параметров (значок с правом верхнем углу) и убедитесь, что у вас все еще есть `de-de` в поле язык.
5. Следуйте инструкциям в разделе [Запуск клиента голосового помощника Windows](#run-the-windows-voice-assistant-client) для повторного подключения к вновь развернутому роботу, говорите на новом языке и поговорите о том, что на этом языке я говорю с новым голосом.

## <a name="clean-up-resources"></a>Очистка ресурсов

Если вы не собираетесь продолжать использовать Echo-Bot, развернутые в этом руководстве, вы можете удалить его и все связанные с ним ресурсы Azure, просто удалив группу ресурсов Azure **спичечоботтуториал-ResourceGroup**.

1. В [портал Azure](https://portal.azure.com)щелкните **группы ресурсов** в области навигации **служб Azure** .
2. Найдите группу ресурсов с именем: **спичечоботтуториал-ResourceGroup**. Щелкните три точки (...).
3. Выберите команду **Удалить группу ресурсов**.

## <a name="next-steps"></a>Следующие шаги

> [!div class="nextstepaction"]
> [Создание собственного клиентского приложения с помощью пакета SDK для распознавания речи](./quickstarts/voice-assistants.md?pivots=programming-language-csharp)

## <a name="see-also"></a>См. также раздел

* Развертывание в [регионе Azure рядом с вами](https://azure.microsoft.com/global-infrastructure/locations/) , чтобы увидеть улучшение времени ответа Bot
* Развертывание в [регионе Azure, поддерживающем высококачественные голосовые нейроны TTS](./regions.md#standard-and-neural-voices)
* Цены, связанные с прямым каналом голосового перевода строки:
  * [Расценки службы ботов](https://azure.microsoft.com/pricing/details/bot-service/)
  * [Служба распознавания речи](https://azure.microsoft.com/pricing/details/cognitive-services/speech-services/)
* Создание и развертывание собственного робота с поддержкой голоса:
  * Создайте [оболочку](https://dev.botframework.com/)Bot-Bot. Зарегистрируйте его с помощью прямого голосового [канала](/azure/bot-service/bot-service-channel-connect-directlinespeech) и [Настройте робот для голосовой связи](/azure/bot-service/directline-speech-bot)
  * Знакомство с существующими [решениями для Bot-платформы](https://microsoft.github.io/botframework-solutions/index): создание [виртуального помощника](https://microsoft.github.io/botframework-solutions/overview/virtual-assistant-solution/) и [его расширение для перевода голосовых голосов](https://microsoft.github.io/botframework-solutions/clients-and-channels/tutorials/enable-speech/1-intro/)
