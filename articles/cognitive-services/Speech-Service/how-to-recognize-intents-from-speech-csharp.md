---
title: 'Распознавание целей распознавания речи с помощью речевого пакета SDK C #'
titleSuffix: Azure Cognitive Services
description: В этом руководство вы узнаете, как распознать способы распознавания речи с помощью речевого пакета SDK для C#.
services: cognitive-services
author: trevorbye
manager: nitinme
ms.service: cognitive-services
ms.subservice: speech-service
ms.topic: conceptual
ms.date: 02/10/2020
ms.author: trbye
ms.custom: devx-track-csharp
ms.openlocfilehash: 93a3adf00203e317be912e3e72de7a3f7ca666c6
ms.sourcegitcommit: 867cb1b7a1f3a1f0b427282c648d411d0ca4f81f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "96001114"
---
# <a name="how-to-recognize-intents-from-speech-using-the-speech-sdk-for-c"></a>Распознавание целей распознавания речи с помощью речевого пакета SDK для C #

[Пакет SDK службы "Речь"](speech-sdk.md) в Cognitive Services интегрируется с [Интеллектуальной службой распознавания речи (LUIS)](https://www.luis.ai/home) для предоставления возможности **распознавания намерений**. Намерение — это действие, которое хочет выполнить пользователь, например забронировать билет на самолет, проверить прогноз погоды или совершить звонок. Пользователь может использовать любые термины, которые кажутся естественными. С помощью машинного обучения LUIS сопоставляет пользовательские запросы с определенными намерениями.

> [!NOTE]
> Приложение LUIS используется для определения намерений и сущностей, которые требуется распознать. Оно работает отдельно от приложения C#, в котором используется служба "Речь". В этой статье под словом "приложение" подразумевается приложение LUIS, а под "программа" — код C#.

В этом руководство используется речевой пакет SDK для разработки консольного приложения C#, которое извлекает из пользователя фразы продолжительностью через микрофон устройства. Вы узнаете, как:

> [!div class="checklist"]
>
> - создать проект в Visual Studio, ссылающийся на пакет SDK для службы "Речь" для NuGet;
> - выполнить настройки речи и получить распознаватель намерений;
> - создать модель для приложения LUIS и добавить необходимые намерения;
> - указать язык распознавания речи;
> - распознать речь из файла;
> - использовать асинхронное непрерывное распознавание при определенном событии.

## <a name="prerequisites"></a>Предварительные условия

Прежде чем приступить к работе с этим руководством, убедитесь, что у вас есть следующие элементы:

- Учетная запись LUIS. На [портале LUIS](https://www.luis.ai/home) ее можно получить бесплатно.
- [Visual Studio 2019](https://visualstudio.microsoft.com/downloads/) (любой выпуск).

## <a name="luis-and-speech"></a>LUIS и речь

Чтобы распознать намерения в речи LUIS интегрируется в службу "Речь". Подписка на службу "Речь" не требуется.

В LUIS используется три типа ключей:

| Тип ключа  | Назначение                                               |
| --------- | ----------------------------------------------------- |
| Разработка | Позволяет программно создавать и изменять приложения LUIS. |
| Ключ для начала работы   | Позволяет тестировать приложение LUIS только с помощью текста   |
| Конечная точка  | Разрешает доступ к определенному приложению LUIS.            |

Для этого руководством требуется тип ключа конечной точки. В этом руководстве используется пример приложения LUIS для домашней службы автоматизации, который можно создать, следуя инструкциям в кратком руководстве по использованию предварительно [подготовленного приложения службы автоматизации](../luis/luis-get-started-create-app.md) . Также вместо него можно использовать собственное приложение LUIS.

Начальный ключ автоматически создается при создании приложения LUIS. Это позволяет проверять приложения с помощью текстовых запросов. Этот ключ не включает интеграцию со службой речи и не будет работать с этим руководством. На панели мониторинга Azure создайте ресурс LUIS и назначьте его приложению LUIS. Для этого руководством можно использовать бесплатный уровень подписки.

После создания ресурса LUIS на панели мониторинга Azure необходимо войти на [портал LUIS](https://www.luis.ai/home) и выбрать свою программу на странице **Мои приложения**, а затем перейти на страницу **Управление**. И наконец, на боковой панели выберите **Keys and Endpoints** (Ключи и конечные точки).

![Параметры конечной точки и ключей на портале LUIS](media/sdk/luis-keys-endpoints-page.png)

Выполните следующие действия на странице параметров **Keys and Endpoints** (Ключи и конечные точки).

1. Прокрутите вниз к разделу **Resources and Keys** (Ресурсы и ключи) и выберите **Назначить ресурс**.
1. Выполните следующие изменения в диалоговом окне **Assign a key to your app** (Назначение ключа приложению).

   - В разделе **Клиент** выберите **Корпорация Майкрософт**.
   - В разделе **Имя подписки** выберите подписку Azure, содержащую ресурс LUIS, который будет использован.
   - В разделе **Key** (Ключ) выберите ресурс LUIS, который необходимо использовать в приложении.

   Через мгновение новая подписка появится в таблице в нижней части страницы.

1. Чтобы скопировать ее в буфер обмена, выберите значок рядом с ключом. (Можно использовать любой ключ.)

![Ключи подписки приложения LUIS](media/sdk/luis-keys-assigned.png)

## <a name="create-a-speech-project-in-visual-studio"></a>Создание проекта "Речь" в Visual Studio

[!INCLUDE [Create project](../../../includes/cognitive-services-speech-service-create-speech-project-vs-csharp.md)]

## <a name="add-the-code"></a>Добавление кода

Далее добавьте код в проект.

1. В **Обозревателе решений** откройте файл **Program.cs**.

1. Замените блок операторов `using`, который находится в начале файла, следующими объявлениями.

   [!code-csharp[Top-level declarations](~/samples-cognitive-services-speech-sdk/samples/csharp/sharedcontent/console/intent_recognition_samples.cs#toplevel)]

1. Замените предоставленный `Main()` метод следующим асинхронным эквивалентом:

   ```csharp
   public static async Task Main()
   {
       await RecognizeIntentAsync();
       Console.WriteLine("Please press Enter to continue.");
       Console.ReadLine();
   }
   ```

1. Создайте пустой асинхронный метод `RecognizeIntentAsync()`, как показано ниже.

   ```csharp
   static async Task RecognizeIntentAsync()
   {
   }
   ```

1. Добавьте следующий код в текст метода:

   [!code-csharp[Intent recognition by using a microphone](~/samples-cognitive-services-speech-sdk/samples/csharp/sharedcontent/console/intent_recognition_samples.cs#intentRecognitionWithMicrophone)]

1. В методе необходимо заменить заполнители на ключ подписки LUIS, регион и идентификатор приложения следующим образом.

   | Заполнитель | Заменить на |
   | ----------- | ------------ |
   | `YourLanguageUnderstandingSubscriptionKey` | Ключ конечной точки LUIS. Опять же, вы должны получить с панели мониторинга Azure этот элемент, а не "стартовый ключ". Его можно найти на странице приложения **Keys and Endpoints** (Ключи и конечные точки) в разделе **Manage** (Управление) на [портале LUIS](https://www.luis.ai/home). |
   | `YourLanguageUnderstandingServiceRegion` | Короткий идентификатор региона, в котором находится подписка LUIS, например `westus` для западной части США. См. статью [Регионы и конечные точки службы "Речь"](regions.md). |
   | `YourLanguageUnderstandingAppId` | Идентификатор приложения LUIS. Его можно найти на странице **Параметры** приложения на [портале LUIS](https://www.luis.ai/home). |

После внесения этих изменений можно выполнить сборку (**Управление + Shift + B**) и запустить (**F5**) приложение. При появлении запроса в микрофон компьютера следует произнести фразу "выключить свет". Приложение отображает результат в окне консоли.

В следующих разделах приводится описание кода.

## <a name="create-an-intent-recognizer"></a>Создание распознавателя намерений

Во-первых, необходимо создать конфигурацию речи из ключа конечной точки LUIS и региона. Конфигурации речи могут использоваться для создания распознавателей, обладающих различными возможностями, используемыми в пакете SDK службы "Речь". При использовании конфигурации речи вы можете указать подписку несколькими способами. В данном руководстве будет использован способ `FromSubscription`, для которого требуется ключ подписки и регион.

> [!NOTE]
> Используйте ключ и регион вашей подписки LUIS, а не подписку на службу распознавания речи.

Затем с помощью `new IntentRecognizer(config)` создайте распознаватель намерений. Поскольку в конфигурации уже было указано, какую из подписок использовать, повторное указание ключа подписки и конечной точки при создании распознавателя не требуется.

## <a name="import-a-luis-model-and-add-intents"></a>Добавление намерений и импорт модели

Теперь импортируйте модель из приложения LUIS с помощью идентификатора `LanguageUnderstandingModel.FromAppId()` и добавьте те намерения LUIS, которые требуется распознать, с помощью метода `AddIntent()`. С помощью двух приведенных шагов улучшается точность распознавания речи путем указания слов, которые пользователь может использовать в запросах. Если в программе не планируется распознавать все намерения приложений, их добавление не нужно.

Для добавления намерений нужно обеспечить три аргумента. Модель LUIS (которая была создана с именем `model`), имя намерения и его идентификатор. Разница между идентификатором и именем приведена в следующей таблице.

| `AddIntent()`&nbsp;аргумент | Назначение |
| --------------------------- | ------- |
| `intentName` | Имя намерения, определенного в приложении LUIS. Это значение должно совпадать с именем намерения LUIS. |
| `intentID` | Идентификатор, присвоенный намерению, распознанному пакетом SDK для службы "Речь". Это значение может быть любым. Оно не обязательно должно соответствовать имени намерения, определенному в приложении LUIS. Для обработки нескольких намерений может использоваться один код, как и один идентификатор используется для всех намерений. |

Приложение LUIS для системы домашней автоматики содержит два намерения. Первое — включение устройства, второе — выключение. С помощью приведенных ниже строк намерения будут добавлены в распознаватель. Замените приведенным ниже кодом три строки `AddIntent` в методе `RecognizeIntentAsync()`.

```csharp
recognizer.AddIntent(model, "HomeAutomation.TurnOff", "off");
recognizer.AddIntent(model, "HomeAutomation.TurnOn", "on");
```

Вместо добавления отдельных намерения можно также использовать метод `AddAllIntents`, чтобы добавить в распознаватель все намерения из модели.

## <a name="start-recognition"></a>Начало распознавания

После создания распознавателя и добавления намерений можно начать процесс распознавания. В пакете SDK для службы "Речь" поддерживается краткое и непрерывное распознавание.

| Режим распознавания | Вызываемые методы | Результат |
| ---------------- | --------------- | ------ |
| Одиночный | `RecognizeOnceAsync()` | Возвращает распознанное намерение, извлеченное из одного высказывания. |
| С задержкой | `StartContinuousRecognitionAsync()`<br>`StopContinuousRecognitionAsync()` | Распознает множественные речевые фрагменты; выдает события (например, `IntermediateResultReceived`), если результаты доступны. |

Приложение использует Однофакторный режим и поэтому вызывает метод `RecognizeOnceAsync()` , чтобы начать распознавание. Результат — объект `IntentRecognitionResult`, который содержит информацию о распознанном намерении. Ответ LUIS в формате JSON извлекается с помощью следующего выражения:

```csharp
result.Properties.GetProperty(PropertyId.LanguageUnderstandingServiceResponse_JsonResult)
```

Приложение не анализирует результат JSON. Оно только отображает текст JSON в окне консоли.

![Единые результаты распознавания LUIS](media/sdk/luis-results.png)

## <a name="specify-recognition-language"></a>Указание языка распознавания

По умолчанию язык распознавания намерений — английский (США) (`en-us`). Чтобы распознавать намерения на других языках, свойству `SpeechRecognitionLanguage` необходимо присвоить код языкового стандарта. Например, добавьте `config.SpeechRecognitionLanguage = "de-de";` в наше приложение перед созданием распознавателя для распознавания целей на немецком языке. Дополнительные сведения см. в разделе [Поддержка языков Luis](../LUIS/luis-language-support.md#languages-supported).

## <a name="continuous-recognition-from-a-file"></a>Непрерывное распознавание из файла

В следующем коде иллюстрируются две дополнительные возможности распознавания намерений с использованием пакета SDK для службы "Речь". Первая из возможностей, которая была упомянута ранее, — непрерывное распознавание, используя которое распознаватель извлекает события при получении результата. Затем эти события могут обрабатываться предоставленными обработчиками событий. При непрерывном распознавании вызывается метод распознавания `StartContinuousRecognitionAsync()`, который начнет работать вместо `RecognizeOnceAsync()`.

К другим возможностям можно отнести считывание звукового файла в формате WAV, содержащего речь, подлежащую обработке. Реализация включает создание конфигурации звука, которую можно использовать при создании распознавателя намерений. Файл должен состоять из одного канала (моно) с уровнем дискретизации 16 000 Гц.

Чтобы опробовать эти возможности, удалите или прокомментируйте текст метода `RecognizeIntentAsync()` и добавьте вместо него следующий код.

[!code-csharp[Intent recognition by using events from a file](~/samples-cognitive-services-speech-sdk/samples/csharp/sharedcontent/console/intent_recognition_samples.cs#intentContinuousRecognitionWithFile)]

Пересмотрите код на наличие ключа конечной точки LUIS, региона и идентификатора приложения и, как и в предыдущем примере, добавьте намерения Home Automation. Измените имя `whatstheweatherlike.wav` на имя вашего звукового файла. Затем выполните сборку, скопируйте звуковой файл в каталог сборки и запустите приложение.

Например, если вы скажете "Выключить свет", приостановитесь, а затем скажите "Включить свет" в записанном звуковом файле, может появиться консольный вывод, аналогичный следующему:

![Звуковой файл результатов распознавания LUIS](media/sdk/luis-results-2.png)

[!INCLUDE [Download the sample](../../../includes/cognitive-services-speech-service-speech-sdk-sample-download-h2.md)]
Код, используемый в данной статье, можно найти в папке **samples/csharp/sharedcontent/console**.

## <a name="next-steps"></a>Дальнейшие действия

> [!div class="nextstepaction"]
> [Краткое руководство. по распознаванию речи с микрофона](./get-started-speech-to-text.md?pivots=programming-language-csharp&tabs=dotnetcore)