---
title: Ведение журнала диагностики
titleSuffix: Azure Cognitive Services
description: Это краткое описание содержит пошаговые инструкции по включению ведения журнала диагностики для службы "Поиск в Azure". Эти журналы предоставляют широкие, часто встречающиеся данные о работе ресурса, которые используются для идентификации и отладки проблем.
services: cognitive-services
author: erhopf
manager: nitinme
ms.service: cognitive-services
ms.topic: article
ms.date: 06/14/2019
ms.author: erhopf
ms.openlocfilehash: a2005ca7b32136ff0032d27e04035c46b2e4e904
ms.sourcegitcommit: e559daa1f7115d703bfa1b87da1cf267bf6ae9e8
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/17/2021
ms.locfileid: "100595365"
---
# <a name="enable-diagnostic-logging-for-azure-cognitive-services"></a>Включение ведения журнала диагностики для Azure Cognitive Services

Это краткое описание содержит пошаговые инструкции по включению ведения журнала диагностики для службы "Поиск в Azure". Эти журналы предоставляют широкие, часто встречающиеся данные о работе ресурса, которые используются для идентификации и отладки проблем. Прежде чем продолжить, необходимо иметь учетную запись Azure с подпиской хотя бы для одной службы, например [Поиск в Интернете Bing](./bing-web-search/overview.md), [Speech Services](./speech-service/overview.md)или [Luis](./luis/what-is-luis.md).

## <a name="prerequisites"></a>Предварительные требования

Чтобы включить ведение журнала диагностики, необходимо хранить данные журнала в любом месте. В этом руководстве используется служба хранилища Azure и Log Analytics.

* Служба [хранилища Azure](../azure-monitor/essentials/resource-logs.md#send-to-azure-storage) — хранение журналов диагностики для аудита политики, статического анализа или резервного копирования. Учетная запись хранения не обязательно должна находиться в той же подписке, что и ресурс, создающий журналы, если пользователь, который настраивает этот параметр, имеет соответствующий доступ к обеим подпискам в Azure RBAC.
* [Log Analytics](../azure-monitor/essentials/resource-logs.md#send-to-log-analytics-workspace) — гибкий инструмент поиска по журналам и анализа, позволяющий анализировать необработанные журналы, созданные ресурсом Azure.

> [!NOTE]
> Доступны дополнительные параметры конфигурации. Дополнительные сведения см. в статье [Получение и использование данных журнала из ресурсов Azure](../azure-monitor/essentials/platform-logs-overview.md).

## <a name="enable-diagnostic-log-collection"></a>Включить сбор журналов диагностики  

Начнем с включения ведения журнала диагностики с помощью портал Azure.

> [!NOTE]
> Чтобы включить эту функцию с помощью PowerShell или Azure CLI, следуйте инструкциям, приведенным в статье [Получение и использование данных журнала из ресурсов Azure](../azure-monitor/essentials/platform-logs-overview.md).

1. Перейдите на портал Azure. Затем найдите и выберите ресурс Cognitive Services. Например, подписка на Поиск в Интернете Bing.   
2. Затем в меню навигации слева перейдите к разделу **мониторинг** и выберите **параметры диагностики**. Этот экран содержит все ранее созданные параметры диагностики для этого ресурса.
3. Если вы хотите использовать ранее созданный ресурс, его можно выбрать сейчас. В противном случае выберите **+ Добавить параметр диагностики**.
4. Введите имя параметра. Затем выберите **Архив в учетной записи хранения** и **отправьте его в log Analytics**.
5. При появлении запроса на настройку выберите учетную запись хранения и рабочую область OMS, которую вы хотите использовать для хранения журналов диагностики. **Примечание**. Если у вас нет учетной записи хранения или рабочей области OMS, следуйте инструкциям на экране, чтобы создать ее.
6. Выберите **Audit**, **рекуестреспонсе** и **аллметрикс**. Затем задайте срок хранения для данных журнала диагностики. Если политика хранения имеет значение 0, события для этой категории журнала хранятся бессрочно.
7. Выберите команду **Сохранить**.

Для запроса и анализа данных журнала может пройти до двух часов. Не беспокойтесь, если вы не видите ничего сразу же.

## <a name="view-and-export-diagnostic-data-from-azure-storage"></a>Просмотр и экспорт диагностических данных из службы хранилища Azure

Служба хранилища Azure — это надежное решение для хранения объектов, оптимизированное для хранения больших объемов неструктурированных данных. В этом разделе вы узнаете, как запрашивать учетную запись хранения для общего количества транзакций в течение 30 дней и экспортировать данные в Excel.

1. В портал Azure выберите ресурс хранилища Azure, созданный в предыдущем разделе.
2. В меню навигации слева перейдите к разделу **мониторинг** и выберите **метрики**.
3. Чтобы настроить запрос, воспользуйтесь раскрывающимися списками. Для этого примера давайте создадим диапазон времени за **последние 30 дней** , а метрику — на **Transaction**.
4. По завершении запроса вы увидите визуализацию транзакции за последние 30 дней. Чтобы экспортировать эти данные, используйте кнопку **Экспорт в Excel** , расположенную в верхней части страницы.

Узнайте больше о том, что можно делать с диагностическими данными в [службе хранилища Azure](../storage/blobs/storage-blobs-introduction.md).

## <a name="view-logs-in-log-analytics"></a>Просмотр журналов в Log Analytics

Выполните эти инструкции, чтобы изучить данные log Analytics для вашего ресурса.

1. В портал Azure выберите **log Analytics** в меню навигации слева.
2. Выберите ресурс, созданный при включении диагностики.
3. В разделе **Общие** перейдите к пункту **журналы**. На этой странице можно выполнять запросы к журналам.

### <a name="sample-queries"></a>Примеры запросов

Ниже приведено несколько основных запросов Kusto, которые можно использовать для просмотра данных журнала.

Выполнить этот запрос для всех журналов диагностики из Cognitive Services Azure за указанный период времени:

```kusto
AzureDiagnostics
| where ResourceProvider == "MICROSOFT.COGNITIVESERVICES"
```

Выполните этот запрос, чтобы просмотреть 10 последних журналов:

```kusto
AzureDiagnostics
| where ResourceProvider == "MICROSOFT.COGNITIVESERVICES"
| take 10
```

Выполните этот запрос, чтобы сгруппировать операции по **ресурсам**:

```kusto
AzureDiagnostics
| where ResourceProvider == "MICROSOFT.COGNITIVESERVICES" |
summarize count() by Resource
```
Выполните этот запрос, чтобы найти среднее время, затрачиваемое на выполнение операции:

```kusto
AzureDiagnostics
| where ResourceProvider == "MICROSOFT.COGNITIVESERVICES"
| summarize avg(DurationMs)
by OperationName
```

Выполните этот запрос, чтобы просмотреть объем операций с разбивкой по времени по параметру Имя_операции с количеством Binned для каждого 10.

```kusto
AzureDiagnostics
| where ResourceProvider == "MICROSOFT.COGNITIVESERVICES"
| summarize count()
by bin(TimeGenerated, 10s), OperationName
| render areachart kind=unstacked
```

## <a name="next-steps"></a>Дальнейшие шаги

* Чтобы понять, как включить ведение журнала, а также метрики и категории журналов, которые поддерживаются различными службами Azure, прочитайте [Обзор метрик](../azure-monitor/data-platform.md) в Microsoft Azure и обзор статей о [журналах диагностики Azure](../azure-monitor/essentials/platform-logs-overview.md) .
* Прочтите эти статьи, чтобы узнать о концентраторах событий:
  * [Что такое Центры событий Azure?](../event-hubs/event-hubs-about.md)
  * [Приступая к работе с Центрами событий](../event-hubs/event-hubs-dotnet-standard-getstarted-send.md)
* Ознакомьтесь с разделом [скачивании метрик и журналов диагностики из службы хранилища Azure](../storage/blobs/storage-quickstart-blobs-dotnet.md#download-blobs).
* Прочитайте [сведения о поиске по журналам в Azure Monitor журналах](../azure-monitor/logs/log-query-overview.md).