---
title: Анализ тональности и интеллектуальный анализ мнений с помощью REST API Анализа текста
titleSuffix: Azure Cognitive Services
description: В этой статье показано, как определить тональность и выполнить интеллектуальный анализ мнений в тексте с помощью API Анализа текста в Azure Cognitive Services.
services: cognitive-services
author: aahill
manager: nitinme
ms.service: cognitive-services
ms.subservice: text-analytics
ms.topic: sample
ms.date: 12/04/2020
ms.author: aahi
ms.openlocfilehash: 6ea7b992a682537471ce0e78385b37674199d687
ms.sourcegitcommit: d79513b2589a62c52bddd9c7bd0b4d6498805dbe
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/18/2020
ms.locfileid: "97673059"
---
# <a name="how-to-sentiment-analysis-and-opinion-mining"></a>Практическое руководство. Анализ тональности и интеллектуальный анализ мнений

Функция анализа тональности в API Анализа текста предоставляет два способа определения положительной и отрицательной тональности. Если вы отправите запрос на анализ тональности, API вернет метки тональности (отрицательные, нейтральные и положительные) и оценки достоверности на уровне предложения и документа. Кроме того, вы можете отправлять запросы на интеллектуальный анализ мнений с помощью конечной точки анализа тональности. Она предоставляет более детализированные сведения о мнениях, связанных с аспектами (например, атрибуты продуктов или услуг) в тексте. 

Модели ИИ для этого API предоставляются службой, вам нужно лишь отправить содержимое для анализа.

## <a name="sentiment-analysis-versions-and-features"></a>Версии и компоненты анализа тональности

| Компонент                                   | Анализ тональности версии 3 | Анализ тональности версии 3.1 (предварительная версия) |
|-------------------------------------------|-----------------------|-----------------------------------|
| Методы для одиночных и пакетных запросов    | X                     | X                                 |
| Оценки и маркировка при анализе тональности             | X                     | X                                 |
| [Контейнер Docker](text-analytics-how-to-install-containers.md) на основе Linux | X  |  |
| Интеллектуальный анализ мнений                            |                       | X                                 |

## <a name="sentiment-analysis"></a>Анализ тональности

Анализ тональности в версии 3.x применяет к тексту метки тональности, возвращаемые на уровне предложения и документа, с оценкой достоверности для каждого из них. 

Применяются такие метки: *positive*, *negative* и *neutral*. На уровне документа может также возвращаться метка тональности *mixed*. Тональность документа определяется следующим образом.

| Тональность предложения                                                                            | Полученная метка документа |
|-----------------------------------------------------------------------------------------------|-------------------------|
| В документе есть по меньшей мере одно предложение `positive`. Остальные предложения оценены как `neutral`. | `positive`              |
| В документе есть по меньшей мере одно предложение `negative`. Остальные предложения оценены как `neutral`. | `negative`              |
| В документе есть по меньшей мере одно предложение `negative` и одно предложение `positive`.    | `mixed`                 |
| Все предложения в документе оценены как `neutral`.                                                  | `neutral`               |

Оценки достоверности колеблются в диапазоне от 1 до 0. Оценки, близкие к 1, указывают на более высокую достоверность в классификации метки, а более низкие оценки указывают на более низкую достоверность. Для каждого документа или предложения прогнозируемые оценки, связанные с метками (positive, negative и neutral), в сумме составляют 1. Дополнительные сведения см. в [заметке о прозрачности Анализа текста](/legal/cognitive-services/text-analytics/transparency-note?context=/azure/cognitive-services/text-analytics/context/context). 

## <a name="opinion-mining"></a>Интеллектуальный анализ мнений

Интеллектуальный анализ мнений — это функция анализа тональности, предоставляющаяся, начиная с версии 3.1 (предварительная версия). Эта функция также известна как анализ тональности на основе аспекта обработки естественного языка (NLP). Она предоставляет более детализированные сведения о мнениях, связанных с аспектами (например, атрибуты продуктов или услуг) в тексте.

Например, если клиент оставляет отзыв о гостинице, например "комната отличная, но персонал был недружелюбным", функция интеллектуального анализа мнений будет искать аспекты в тексте, а также связанные с ними мнения и тональности. Функция анализа тональности может оправлять сведения только об отрицательной тональности.

:::image type="content" source="../media/how-tos/opinion-mining.png" alt-text="Схема: пример интеллектуального анализа мнений" lightbox="../media/how-tos/opinion-mining.png":::

Чтобы получить в результатах интеллектуальный анализ мнений, необходимо включить флаг `opinionMining=true` в запрос для анализа тональности. Результаты интеллектуального анализа мнений будут включены в ответ анализа тональности. Интеллектуальный анализ мнений — это расширение анализа тональности, включенное в текущую [ценовую категорию](https://azure.microsoft.com/pricing/details/cognitive-services/text-analytics/).


## <a name="sending-a-rest-api-request"></a>Отправка запроса к REST API 

### <a name="preparation"></a>Подготовка

Анализ тональности дает более качественный результат, если ему передаются более мелкие блоки текста. Это является противоположностью извлечению ключевой фразы, которая выполняется лучше на более крупных блоках текста. Для получения наилучших результатов обеих операций советуем реструктуризировать входные данные соответствующим образом.

Необходимы документы JSON в следующем формате: ID, текст и язык. Анализ тональности поддерживает широкий спектр языков, и еще несколько сейчас находятся в режиме предварительной версии. Дополнительные сведения см. в [списке поддерживаемых языков](../language-support.md).

Размер документа должен быть менее 5120 символов. Максимальное число документов, которые могут содержаться в коллекции, см. в статье об [ограничениях данных](../concepts/data-limits.md?tabs=version-3) в разделе "Основные понятия". Коллекция передается в тексте запроса.

## <a name="structure-the-request"></a>Структурирование запроса

Создайте запрос POST. Вы можете использовать [средство Postman](text-analytics-how-to-call-api.md) или **консоль тестирования API**, доступные по следующим ссылкам, чтобы быстро оформить и отправить запрос. 

#### <a name="version-31-preview3"></a>[Версия 3.1 (предварительная версия 3)](#tab/version-3-1)

[Справочные материалы по анализу тональности версии 3.1](https://westcentralus.dev.cognitive.microsoft.com/docs/services/TextAnalytics-v3-1-preview-3/operations/Sentiment)

#### <a name="version-30"></a>[Версия 3.0](#tab/version-3)

[Справочник по анализу тональности версии 3](https://westus2.dev.cognitive.microsoft.com/docs/services/TextAnalytics-v3-0/operations/Sentiment)

---

### <a name="request-endpoints"></a>Конечные точки запроса

Задайте конечную точку HTTPS для анализа тональности с помощью ресурса API анализа текста в Azure или созданного при [установке и запуске контейнеров анализа текста](text-analytics-how-to-install-containers.md) экземпляра. Обязательно укажите правильный URL-адрес конечной точки для выбранной версии. Пример:

> [!NOTE]
> Ключ и конечную точку для ресурса Анализа текста можно найти на портале Azure. Они находятся на странице ресурса **Быстрый запуск** в разделе **Управление ресурсами**. 

#### <a name="version-31-preview3"></a>[Версия 3.1 (предварительная версия 3)](#tab/version-3-1)

**анализ тональности**;

`https://<your-custom-subdomain>.cognitiveservices.azure.com/text/analytics/v3.1-preview.3/sentiment`

**Интеллектуальный анализ мнений**

Чтобы получить результаты интеллектуального анализа мнений, необходимо добавить параметр `opinionMining=true`. Пример:

`https://<your-custom-subdomain>.cognitiveservices.azure.com/text/analytics/v3.1-preview.3/sentiment?opinionMining=true`

По умолчанию этот параметр имеет значение `false`. 

#### <a name="version-30"></a>[Версия 3.0](#tab/version-3)

**анализ тональности**;

В версии 3.0 единственная доступная конечная точка предназначена для анализа тональности.
 
`https://<your-custom-subdomain>.cognitiveservices.azure.com/text/analytics/v3.0/sentiment`

---

Включите ключ API Анализа текста в заголовок запроса. В тексте запроса укажите набор документов JSON, которые подготовлены для этого анализа.

### <a name="example-request-for-sentiment-analysis-and-opinion-mining"></a>Пример запроса для анализа тональности и интеллектуального анализа мнений  

Ниже приведен пример содержимого, который вы можете представить для анализа тональности. Формат запроса для `v3.0` и `v3.1-preview` аналогичен.
    
```json
{
  "documents": [
    {
      "language": "en",
      "id": "1",
      "text": "The restaurant had great food and our waiter was friendly."
    }
  ]
}
```

### <a name="post-the-request"></a>Передача запроса

Анализ выполняется при получении запроса. Сведения о размере и числе запросов, которые можно отправлять в минуту и секунду, см. в разделе об [ограничениях данных](../overview.md#data-limits).

API Анализа текста не учитывает состояние. Никакие данные в учетной записи не сохраняются, а все результаты немедленно возвращаются в ответе.


### <a name="view-the-results"></a>Просмотр результатов

Вывод возвращается немедленно. Результаты можно передать в приложение, которое принимает JSON, или сохранить результаты в файл в локальной системе. Затем импортируйте выходные данные в приложение, которое можно использовать для сортировки, поиска и управления данными. В связи с поддержкой многоязычности и эмодзи, ответ может содержать смещения текста. Дополнительные сведения см. в статье [Смещение текста в выводе API Анализа текста](../concepts/text-offsets.md).

#### <a name="version-31-preview3"></a>[Версия 3.1 (предварительная версия 3)](#tab/version-3-1)

### <a name="sentiment-analysis-and-opinion-mining-example-response"></a>Пример ответа от функций анализа тональности и интеллектуального анализа мнений

> [!IMPORTANT]
> Ниже приведен пример JSON для использования функций интеллектуального анализа мнений и анализа тональности, которые предоставляются в версии 3.1 API. Если вы не запрашиваете интеллектуальный анализ мнений, ответ API будет таким же, как на вкладке **версии 3.0**.  

Анализ тональности версии 3.1 может возвращать объекты ответа для интеллектуального анализа мнений и анализа тональности.
  
Анализ тональности возвращает метку тональности и оценку достоверности для всего документа и каждого предложения внутри него. Оценки, близкие к 1, указывают на более высокую достоверность в классификации метки, а более низкие оценки указывают на более низкую достоверность. Документ может содержать несколько предложений, а оценки достоверности в каждом документе или предложении в сумме составляют 1.

При интеллектуальном анализе мнений в тексте выявляются общие аспекты, а также связанные с ними мнения и тональности. В приведенном ниже ответе предложение *Еда в ресторане была очень вкусной и официант был приветливым* имеет 2 аспекта: *еда* и *официант*. Свойство `relations` каждого аспекта содержит значение `ref` со ссылкой URI на связанные объекты `documents`, `sentences`и `opinions`.

```json
{
    "documents": [
        {
            "id": "1",
            "sentiment": "positive",
            "confidenceScores": {
                "positive": 1.0,
                "neutral": 0.0,
                "negative": 0.0
            },
            "sentences": [
                {
                    "sentiment": "positive",
                    "confidenceScores": {
                        "positive": 1.0,
                        "neutral": 0.0,
                        "negative": 0.0
                    },
                    "offset": 0,
                    "length": 58,
                    "text": "The restaurant had great food and our waiter was friendly.",
                    "aspects": [
                        {
                            "sentiment": "positive",
                            "confidenceScores": {
                                "positive": 1.0,
                                "negative": 0.0
                            },
                            "offset": 25,
                            "length": 4,
                            "text": "food",
                            "relations": [
                                {
                                    "relationType": "opinion",
                                    "ref": "#/documents/0/sentences/0/opinions/0"
                                }
                            ]
                        },
                        {
                            "sentiment": "positive",
                            "confidenceScores": {
                                "positive": 1.0,
                                "negative": 0.0
                            },
                            "offset": 38,
                            "length": 6,
                            "text": "waiter",
                            "relations": [
                                {
                                    "relationType": "opinion",
                                    "ref": "#/documents/0/sentences/0/opinions/1"
                                }
                            ]
                        }
                    ],
                    "opinions": [
                        {
                            "sentiment": "positive",
                            "confidenceScores": {
                                "positive": 1.0,
                                "negative": 0.0
                            },
                            "offset": 19,
                            "length": 5,
                            "text": "great",
                            "isNegated": false
                        },
                        {
                            "sentiment": "positive",
                            "confidenceScores": {
                                "positive": 1.0,
                                "negative": 0.0
                            },
                            "offset": 49,
                            "length": 8,
                            "text": "friendly",
                            "isNegated": false
                        }
                    ]
                }
            ],
            "warnings": []
        }
    ],
    "errors": [],
    "modelVersion": "2020-04-01"
}
```

#### <a name="version-30"></a>[Версия 3.0](#tab/version-3)

### <a name="sentiment-analysis-example-response"></a>Пример ответа от функции анализа тональности

Анализ тональности возвращает метку тональности и оценку достоверности для всего документа и каждого предложения внутри него. Оценки, близкие к 1, указывают на более высокую достоверность в классификации метки, а более низкие оценки указывают на более низкую достоверность. Документ может содержать несколько предложений, а оценки достоверности в каждом документе или предложении в сумме составляют 1.

Ответы от API анализа тональности версии 3 содержат метки и оценки тональности для каждого проанализированного предложения и документа.

```json
{
    "documents": [
        {
            "id": "1",
            "sentiment": "positive",
            "confidenceScores": {
                "positive": 1.0,
                "neutral": 0.0,
                "negative": 0.0
            },
            "sentences": [
                {
                    "sentiment": "positive",
                    "confidenceScores": {
                        "positive": 1.0,
                        "neutral": 0.0,
                        "negative": 0.0
                    },
                    "offset": 0,
                    "length": 58,
                    "text": "The restaurant had great food and our waiter was friendly."
                }
            ],
            "warnings": []
        }
    ],
    "errors": [],
    "modelVersion": "2020-04-01"
}
```

---

## <a name="summary"></a>Сводка

В этой статье вы изучили основные понятия и рабочий процесс анализа тональности с помощью API Анализа текста. В разделе "Сводка" сделайте следующее.

+ Анализ тональности и интеллектуальный анализ мнений доступны для некоторых языков.
+ В тексте запроса передаются документы JSON, которые содержат идентификатор, текст и код языка.
+ Запрос POST передается в конечную точку `/sentiment` используя личный [ключ доступа и конечную точку](../../cognitive-services-apis-create-account.md#get-the-keys-for-your-resource), допустимые для вашей подписки.
+ Для получения результатов интеллектуального анализа мнений используйте `opinionMining=true` в запросах на анализ тональности.
+ Выходные данные ответа, состоящие из оценки тональности для каждого идентификатора документа, могут передаваться в любое приложение, принимающее JSON. Например, в Excel или Power BI.

## <a name="see-also"></a>См. также раздел

* [Text Analytics overview](../overview.md) (Общие сведения об анализе текста)
* [Использование клиентской библиотеки Анализа текста](../quickstarts/client-libraries-rest-api.md)
* [Новые возможности](../whats-new.md)
