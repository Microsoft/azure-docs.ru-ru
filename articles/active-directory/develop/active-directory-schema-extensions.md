---
title: Использование атрибутов расширения схемы Azure AD в заявках
titleSuffix: Microsoft identity platform
description: Описывает, как использовать атрибуты расширения схемы каталога для отправки пользовательских данных в приложения в утверждениях маркеров.
services: active-directory
author: rwike77
manager: CelesteDG
ms.service: active-directory
ms.subservice: develop
ms.custom: aaddev
ms.workload: identity
ms.topic: how-to
ms.date: 07/29/2020
ms.author: ryanwi
ms.reviewer: paulgarn, hirsin, jeedes, luleon
ms.openlocfilehash: 0127c8d796126d1e99b1fa38a9506df477c7eb49
ms.sourcegitcommit: 5cdd0b378d6377b98af71ec8e886098a504f7c33
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/25/2021
ms.locfileid: "98755725"
---
# <a name="using-directory-schema-extension-attributes-in-claims"></a>Использование атрибутов расширения схемы каталога в заявках

Атрибуты расширения схемы каталога предоставляют способ хранения дополнительных данных в Azure Active Directory для объектов пользователя и других объектов каталога, таких как группы, сведения о клиенте, субъекты-службы.  Только атрибуты расширения для объектов User можно использовать для выпуска заявок в приложения. В этой статье описывается, как использовать атрибуты расширения схемы каталога для отправки пользовательских данных в приложения в заявках на маркеры.

> [!NOTE]
> Microsoft Graph предоставляет два других механизма расширения для настройки объектов Graph. Они называются Microsoft Graph открытыми расширениями и Microsoft Graph расширениями схемы. Дополнительные сведения см. в [документации по Microsoft Graph](/graph/extensibility-overview) . Данные, хранящиеся в Microsoft Graph объектах с помощью этих возможностей, недоступны в качестве источников для утверждений в токенах.

Атрибуты расширения схемы каталога всегда связаны с приложением в клиенте и на них ссылается имя *приложения в имени* .

Идентификатор для атрибута расширения схемы каталога имеет форму *Extension_xxxxxxxxx_AttributeName*.  Где *XXXXXXXXX* *— это идентификатор* приложения, для которого было определено расширение.

## <a name="registering-and-using-directory-schema-extensions"></a>Регистрация и использование расширений схемы каталога
Атрибуты расширения схемы каталога могут быть зарегистрированы и заполнены одним из двух способов:

- Настроив AD Connect для создания и синхронизации данных в них из локальной службы AD. См. раздел [Azure AD Connect Синхронизация расширений каталогов](../hybrid/how-to-connect-sync-feature-directory-extensions.md).
- С помощью Microsoft Graph для регистрации, установки значений и чтения из [расширений схемы](/graph/extensibility-overview). Также доступны [командлеты PowerShell](/powershell/azure/active-directory/using-extension-attributes-sample) .

### <a name="emitting-claims-with-data-from-directory-schema-extension-attributes-created-with-ad-connect"></a>Эмиссия утверждений с данными из атрибутов расширения схемы каталога, созданных с помощью AD Connect
Атрибуты расширения схемы каталога, созданные и синхронизированные с помощью AD Connect, всегда связаны с ИДЕНТИФИКАТОРом приложения, используемым AD Connect. Их можно использовать в качестве источника для заявок, настроив их в качестве утверждений в конфигурации **корпоративных приложений** в пользовательском интерфейсе портала для приложений SAML, зарегистрированных с помощью коллекции, или с помощью политики сопоставления утверждений для **приложений, зарегистрированных** с помощью функции регистрации приложений.  После того как атрибут расширения каталога, созданный с помощью AD Connect, находится в каталоге, он будет отображаться в пользовательском интерфейсе настройки заявок единого входа SAML.

### <a name="emitting-claims-with-data-from-directory-schema-extension-attributes-created-for-an-application-using-graph-or-powershell"></a>Создание утверждений с данными из атрибутов расширения схемы каталога, созданных для приложения с помощью Graph или PowerShell
Если атрибут расширения схемы каталога зарегистрирован для приложения, использующего Microsoft Graph или PowerShell (через начальную настройку приложений или шаг подготовки для экземпляра), то одно и то же приложение можно настроить в Azure Active Directory для получения данных этого атрибута из объекта пользователя в утверждении при входе пользователя в систему.  Приложение может быть настроено для получения данных в расширениях схемы каталога, зарегистрированных в том же приложении с использованием [необязательных утверждений](active-directory-optional-claims.md#configuring-directory-extension-optional-claims).  Их можно задать в манифесте приложения.  Это позволяет многоклиентским приложениям регистрировать атрибуты расширения схемы каталога для собственного использования. Когда приложение подготавливается в клиенте, можно настроить связанные расширения схемы каталога для пользователей в этом клиенте и использовать их.  После настройки в клиенте и предоставлении согласия его можно использовать для хранения и извлечения данных с помощью Graph, а также для соотнесения с утверждениями в маркерах, которые платформа Microsoft Identity выдает приложениям.

Атрибуты расширения схемы каталога могут быть зарегистрированы и заполнены для любого приложения.

Если приложению требуется отправить утверждения с данными из атрибута расширения, зарегистрированного в другом приложении, необходимо использовать [политику сопоставления утверждений](active-directory-claims-mapping.md) для сопоставления атрибута расширения с утверждением.  Распространенным шаблоном для управления атрибутами расширения схемы каталога является создание приложения, предназначенного специально для того, чтобы быть точкой регистрации всех необходимых расширений схемы.  Это не обязательно должно быть реальным приложением, и этот метод означает, что все расширения имеют одинаковый идентификатор приложения в имени.

Например, ниже приведена Политика сопоставления утверждений для выдачи одного утверждения из атрибута расширения схемы каталога в токене OAuth/OIDC:

```json
{
    "ClaimsMappingPolicy": {
        "Version": 1,
        "IncludeBasicClaimSet": "false",
        "ClaimsSchema": [{
                "Source": "User",
                "ExtensionID": "extension_xxxxxxx_test",
                "JWTClaimType": "http://schemas.contoso.com/identity/claims/exampleclaim"
            },
        ]
    }
}
```

Где *XXXXXXX* — это идентификатор приложения, с которым было зарегистрировано расширение.

> [!TIP]
> Согласованность регистра важна при задании атрибутов расширения каталога для объектов.  Имена атрибутов расширения не учитывают регистр при настройке, но при чтении из каталога службой маркеров учитывается регистр.  Если атрибут расширения задан для объекта пользователя с именем "Легациид" и другим объектом-пользователем с именем "легациид", то при сопоставлении с утверждением с помощью имени "Легациид" данные будут успешно получены и утверждение будет включено в маркер для первого пользователя, но не для второго.
>
> Параметр ID в схеме утверждений, используемой для встроенных атрибутов каталога, — это "ExtensionID" для атрибутов расширения каталога.

## <a name="next-steps"></a>Следующие шаги
- Узнайте, как [добавить настраиваемые или дополнительные утверждения в токены SAML 2,0 и JSON Web tokens (JWT)](active-directory-optional-claims.md).
- Узнайте, как [настроить утверждения, созданные в токенах для конкретного приложения](active-directory-claims-mapping.md).