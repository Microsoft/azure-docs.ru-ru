---
title: Инфраструктура согласия Azure AD
titleSuffix: Microsoft identity platform
description: Сведения о платформе предоставления согласия Azure Active Directory и о том, как с ее помощью легко разрабатывать мультитенантные веб-приложения и собственные клиентские приложения.
services: active-directory
author: rwike77
manager: CelesteDG
ms.service: active-directory
ms.subservice: develop
ms.topic: conceptual
ms.workload: identity
ms.date: 10/21/2020
ms.author: ryanwi
ms.reviewer: zachowd, lenalepa, jesakowi
ms.openlocfilehash: 74321bc75fa760727e7896f47cdfc5b2929047e5
ms.sourcegitcommit: 910a1a38711966cb171050db245fc3b22abc8c5f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "92366094"
---
# <a name="azure-active-directory-consent-framework"></a>Платформа предоставления согласия Azure Active Directory

Платформа предоставления согласия Azure Active Directory (Azure AD) упрощает разработку мультитенантных веб-приложений и собственных клиентских приложений. Эти приложения позволяют входить в учетные записи пользователей с клиентов Azure AD, отличных от тех, где было зарегистрировано приложение. Им также может потребоваться доступ к веб-API, таким как Microsoft Graph API (для доступа к Azure AD, Intune и службам Microsoft 365) и другим API служб Майкрософт, в дополнение к собственным веб-API.

Эта платформа использует согласие пользователя или администратора на регистрацию приложения в своем каталоге, что может включать в себя доступ к данным каталога. Например, если приложению веб-клиента требуется считывать данные календаря о пользователе из Microsoft 365, этот пользователь должен сначала предоставить согласие на клиентское приложение. После предоставления такого разрешения клиентское приложение сможет вызывать API Microsoft Graph от имени этого пользователя и пользоваться сведениями календаря по мере необходимости. [Microsoft Graph API](https://developer.microsoft.com/graph) предоставляет доступ к данным в Microsoft 365 (таких как календари и сообщения из Exchange, сайты и списки из SharePoint, документы из OneDrive, записные книжки OneNote, задачи планировщика и книги из Excel), а также пользователи и группы из Azure AD и другие объекты данных из других облачных служб Майкрософт.

Платформа согласия основана на OAuth 2.0 и различных его процедурах, таких как предоставление кода авторизации и учетных данных пользователя, с помощью общедоступных или конфиденциальных клиентов. Благодаря OAuth 2.0 среда Azure AD позволяет создавать различные клиентские приложения, например на телефоне, планшете, сервере или в Интернете, и получать доступ к необходимым ресурсам.

Дополнительные сведения об использовании платформы предоставления согласия с разрешениями на авторизацию OAuth 2.0 см. в статьях [Авторизация доступа к веб-приложениям Azure Active Directory с помощью последовательности предоставления кода OAuth 2.0](v2-oauth2-auth-code-flow.md) и [Сценарии проверки подлинности в Azure AD](./authentication-vs-authorization.md). Сведения о получении полномочного доступа к Microsoft 365 через Microsoft Graph см. [в статье Проверка подлинности приложения с помощью Microsoft Graph](/graph/).

## <a name="consent-experience---an-example"></a>Пример процедуры предоставления согласия

Ниже описывается, как работает процедура предоставления согласия для разработчика приложений и пользователя.

1. Предположим, у вас есть приложение веб-клиента, которому необходимо запросить конкретные разрешения для получения доступа к ресурсу или API. В следующем разделе показано, как выполнить эту настройку, однако фактически портал Azure используется для объявления запросов разрешений во время настройки. Как и другие параметры конфигурации, они становятся частью регистрации Azure AD приложения:

    ![Разрешения для других приложений](./media/consent-framework/permissions.png)

1. Представим себе, что разрешения вашего приложения были обновлены, само приложение запущено, а пользователь собирается воспользоваться им в первый раз. Сначала приложение должно получить код авторизации из конечной точки `/authorize` Azure AD. Код авторизации можно использовать для получения новых маркеров доступа или обновления.

1. Если пользователь еще не выполнил проверку подлинности, конечная точка `/authorize` Azure AD запросит данные пользователя для входа.

    ![Вход пользователя или администратора в Azure AD](./media/consent-framework/usersignin.png)

1. После входа Azure AD определяет, требуется ли отобразить этому пользователю страницу согласия. Принятие этого решения основано на том, дал ли этот пользователь (или администратор его организации) свое согласие для приложения. Если согласие еще не было дано, Azure AD запрашивает у пользователя согласие и отображает необходимые для этого разрешения. В диалоговом окне согласия отображается тот же набор разрешений, который совпадает с набором **Делегированные разрешения** на портале Azure.

    ![Показывает пример разрешений, отображаемых в диалоговом окне согласия.](./media/consent-framework/consent.png)

1. После того как пользователь дает свое согласие, в ваше приложение возвращается код авторизации, который используется для получения токена доступа и токена обновления. Дополнительные сведения об этом потоке см. в статье [поток кода авторизации OAuth 2,0](v2-oauth2-auth-code-flow.md).

1. Обладая правами администратора, вы можете также согласиться использовать делегированные разрешения приложения от имени всех пользователей в клиенте. Административное согласие предотвращает появление диалогового окна согласия для каждого пользователя в клиенте и может выполняться в [портал Azure](https://portal.azure.com) пользователями с ролью администратора. Сведения о том, администраторы каких ролей могут предоставлять делегированные разрешения, см. в статье [Разрешения роли администратора в Azure Active Directory](../roles/permissions-reference.md).

    **Предоставление согласия на делегированные разрешения приложения**

   1. Перейдите на страницу **разрешений API** для своего приложения.
   1. Нажмите кнопку **предоставить согласие администратора** .

      ![Предоставление разрешений, на которые требуется явное согласие администратора](./media/consent-framework/grant-consent.png)

   > [!IMPORTANT]
   > Для одностраничных приложений (SPA), использующих ADAL.js, сейчас требуется предоставление явного разрешения с помощью кнопки **Предоставить разрешения**. В противном случае происходит сбой приложения при запросе маркера доступа.

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения см. в руководстве по [преобразованию приложения в мультитенантное](howto-convert-app-to-be-multi-tenant.md).
