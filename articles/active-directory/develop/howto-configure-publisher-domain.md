---
title: Настройка домена издателя приложения | Службы
titleSuffix: Microsoft identity platform
description: Узнайте, как настроить домен издателя приложения, чтобы пользователи могли узнать, куда отправляются данные.
services: active-directory
author: rwike77
manager: CelesteDG
ms.service: active-directory
ms.subservice: develop
ms.topic: how-to
ms.workload: identity
ms.date: 07/23/2020
ms.author: ryanwi
ms.reviewer: lenalepa, sureshja, zachowd
ms.custom: aaddev
ms.openlocfilehash: d793ed912af1c6fdd6e0da417b8709cad8bf08b9
ms.sourcegitcommit: 42a4d0e8fa84609bec0f6c241abe1c20036b9575
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "98013640"
---
# <a name="how-to-configure-an-applications-publisher-domain"></a>Как настроить домен издателя приложения

Домен издателя приложения отображается для пользователей в [запросе согласия приложения](application-consent-experience.md) , чтобы пользователи могли понять, куда отправляются данные. Приложения с несколькими клиентами, зарегистрированные после 21 мая, 2019, у которых нет домена издателя, не отображаются как **непроверенные**. Приложения с несколькими клиентами — это приложения, которые поддерживают учетные записи за пределами единого каталога организации. Например, поддерживаются все учетные записи Azure AD или поддерживаются все учетные записи Azure AD и личные учетные записи Майкрософт.

## <a name="new-applications"></a>Новые приложения

При регистрации нового приложения домен издателя приложения может быть установлен в значение по умолчанию. Это значение зависит от того, где зарегистрировано приложение, в частности, зарегистрировано ли приложение в клиенте и имеются ли у клиента домены, прошедшие проверку клиента.

При наличии доменов, проверяемых клиентом, домен издателя приложения по умолчанию будет основным проверенным доменом клиента. Если нет проверенных доменов клиента (что происходит в случае, если приложение не зарегистрировано в клиенте), домен издателя приложения будет установлен в значение null.

В следующей таблице перечислены действия по умолчанию для значения домена издателя.  

| Домены, проверенные клиентом | Значение по умолчанию для домена издателя |
|-------------------------|----------------------------|
| null | null |
| *. onmicrosoft.com | *. onmicrosoft.com |
| -*. onmicrosoft.com<br/>-domain1.com<br/>-domain2.com (основной) | domain2.com |

Если домен издателя многопользовательского приложения не задан или для него задан домен, который заканчивается на. onmicrosoft.com, запрос согласия приложения будет отображаться на **непроверенном** месте в домене издателя.

## <a name="grandfathered-applications"></a>Грандфасеред приложения

Если приложение было зарегистрировано до 21 мая, 2019, запрос согласия вашего приложения не будет отображаться как **непроверенный** , если не задан домен издателя. Рекомендуется задать значение домена издателя, чтобы пользователи могли видеть эти сведения в запросе согласия вашего приложения.

## <a name="configure-publisher-domain-using-the-azure-portal"></a>Настройка домена издателя с помощью портал Azure

Чтобы задать домен издателя приложения, выполните следующие действия.

1. Войдите в <a href="https://portal.azure.com/" target="_blank">портал Azure <span class="docon docon-navigate-external x-hidden-focus"></span> </a> с помощью рабочей или учебной учетной записи или личного учетная запись Майкрософт.

1. Если ваша учетная запись присутствует в нескольких клиентах Azure AD:
   1. Выберите свой профиль в меню в правом верхнем углу страницы, а затем **Переключение каталога**.
   1. Измените сеанс на арендатор Azure AD, в котором нужно создать приложение.

1. Перейдите к [Azure Active Directory > регистрация приложений](https://go.microsoft.com/fwlink/?linkid=2083908) , чтобы найти и выбрать приложение, которое требуется настроить.

   Выбрав приложение, вы увидите страницу **обзора** приложения.

1. На странице **Обзор** приложения выберите раздел **фирменная символика** .

1. Найдите поле **домен издателя** и выберите один из следующих вариантов:

   - Выберите **настроить домен** , если вы еще не настроили домен.
   - Выберите **обновить домен** , если домен уже настроен.

Если приложение зарегистрировано в клиенте, вы увидите две вкладки для выбора: **выберите проверенный домен** и **Проверьте новый домен**.

Если приложение не зарегистрировано в клиенте, вы увидите только параметр проверки нового домена для приложения.

### <a name="to-verify-a-new-domain-for-your-app"></a>Проверка нового домена для приложения

1. Создайте файл с именем `microsoft-identity-association.json` и вставьте следующий фрагмент кода JSON.

   ```json
   {
      "associatedApplications": [
         {
            "applicationId": "{YOUR-APP-ID-HERE}"
         },
         {
            "applicationId": "{YOUR-OTHER-APP-ID-HERE}"
         }
      ]
    }
   ```

1. Замените заполнитель *{My-App-ID-here}* идентификатором приложения (клиентом), который соответствует вашему приложению.

1. Разместите файл по адресу: `https://{YOUR-DOMAIN-HERE}.com/.well-known/microsoft-identity-association.json` . Замените заполнитель *{My-Domain-here}* соответствующим проверенным доменом.

1. Нажмите кнопку **проверить и сохранить домен** .

### <a name="to-select-a-verified-domain"></a>Выбор проверенного домена

- Если у клиента есть проверенные домены, выберите один из доменов в раскрывающемся списке **выберите проверенный домен** .

>[!Note]
> Ожидался ожидаемый заголовок Content-Type, который должен быть возвращен `application/json` . Вы можете получить сообщение об ошибке, как упоминалось ниже, если вы используете что-нибудь вроде `application/json; charset=utf-8` 
> 
>``` "Verification of publisher domain failed. Error getting JSON file from https:///.well-known/microsoft-identity-association. The server returned an unexpected content type header value. " ```
>

## <a name="implications-on-the-app-consent-prompt"></a>Влияние на запрос согласия приложения

Настройка домена издателя влияет на то, что пользователи видят в запросе согласия приложения. Чтобы полностью понять компоненты запроса на согласие, ознакомьтесь с разрешениями [на получение согласия приложения](application-consent-experience.md).

В следующей таблице описывается поведение приложений, созданных до 21 мая, 2019.

![Запрос согласия для приложений, созданных до 21 мая, 2019](./media/howto-configure-publisher-domain/old-app-behavior-table.png)

Поведение новых приложений, созданных после 21 мая, 2019 будет зависеть от домена издателя и типа приложения. В следующей таблице описаны изменения, которые должны отображаться с различными сочетаниями конфигураций.

![Запрос согласия для приложений, созданных после 21 мая, 2019](./media/howto-configure-publisher-domain/new-app-behavior-table.png)

## <a name="implications-on-redirect-uris"></a>Влияние на URI перенаправления

При указании URI перенаправления для приложений, которые входят в систему пользователей с любой рабочей или учебной учетной записью или личными учетными записями Майкрософт ([несколько клиентов](single-and-multi-tenant-apps.md)), действуют некоторые ограничения.

### <a name="single-root-domain-restriction"></a>Ограничение для одного корневого домена

Если в качестве значения домена издателя для приложений с несколькими клиентами установлено значение null, приложения могут использовать только один корневой домен для URI перенаправления. Например, следующее сочетание значений не допускается, так как корневой домен contoso.com не соответствует fabrikam.com.

```
"https://contoso.com",
"https://fabrikam.com",
```

### <a name="subdomain-restrictions"></a>Ограничения поддомена

Дочерние домены разрешены, но необходимо явным образом зарегистрировать корневой домен. Например, хотя следующие URI совместно используют один корневой домен, сочетание запрещено.

```
"https://app1.contoso.com",
"https://app2.contoso.com",
```

Однако если разработчик явно добавляет корневой домен, это сочетание разрешено.

```
"https://contoso.com",
"https://app1.contoso.com",
"https://app2.contoso.com",
```

### <a name="exceptions"></a>Исключения

Ограничение единственного корневого домена не подчиняется следующим случаям.

- Приложения с одним клиентом или приложения, предназначенные для учетных записей в одном каталоге
- Использование localhost в качестве URI перенаправления
- Перенаправление URI с пользовательскими схемами (не HTTP или HTTPS)

## <a name="configure-publisher-domain-programmatically"></a>Программная настройка домена издателя

В настоящее время отсутствует REST API или поддержка PowerShell для настройки домена издателя программным способом.
