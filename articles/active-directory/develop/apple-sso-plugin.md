---
title: Подключаемый модуль единого входа Microsoft Enterprise для устройств Apple
titleSuffix: Microsoft identity platform | Azure
description: Узнайте о подключаемом модуле единого входа Microsoft Azure Active Directory для устройств iOS, Ипадос и macOS.
services: active-directory
author: brandwe
manager: CelesteDG
ms.service: active-directory
ms.subservice: develop
ms.topic: conceptual
ms.workload: identity
ms.date: 09/15/2020
ms.author: brandwe
ms.reviewer: brandwe
ms.custom: aaddev
ms.openlocfilehash: 96fbf23128896f23beee70a6b3d32b4b87a454ea
ms.sourcegitcommit: ba676927b1a8acd7c30708144e201f63ce89021d
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/07/2021
ms.locfileid: "102427102"
---
# <a name="microsoft-enterprise-sso-plug-in-for-apple-devices-preview"></a>Подключаемый модуль единого входа Microsoft Enterprise для устройств Apple (Предварительная версия)

>[!IMPORTANT]
> Эта функция [!INCLUDE [PREVIEW BOILERPLATE](../../../includes/active-directory-develop-preview.md)]

*Подключаемый модуль единого входа Microsoft Enterprise для устройств Apple* обеспечивает единый вход (SSO) для учетных записей Azure Active Directory (Azure AD) в MacOS, iOS и ипадос во всех приложениях, поддерживающих функцию [единого входа Apple Enterprise](https://developer.apple.com/documentation/authenticationservices) . Сюда входят старые приложения, от которых может зависеть ваш бизнес, но не поддерживающие последние библиотеки или протоколы удостоверений. Корпорация Майкрософт тесно работала с компанией Apple для разработки этого подключаемого модуля, чтобы повысить удобство использования приложения и обеспечить лучшую защиту, которую могут предоставить компании Apple и Майкрософт.

Подключаемый модуль единого входа предприятия в настоящее время доступен в виде встроенной функции следующих приложений:

* [Microsoft Authenticator](../user-help/user-help-auth-app-overview.md) -iOS, ипадос
* Microsoft Intune [Корпоративный портал](/mem/intune/apps/apps-company-portal-macos) macOS

## <a name="features"></a>Компоненты

Подключаемый модуль единого входа Microsoft Enterprise для устройств Apple предоставляет следующие преимущества.

- Предоставляет единый вход для учетных записей Azure AD во всех приложениях, поддерживающих единую Sign-Onную функцию Apple Enterprise.
- Может быть включено любым решением управления мобильными устройствами (MDM).
- Расширяет единый вход для приложений, которые еще не используют библиотеки платформы Microsoft Identity.
- Расширяет единый вход для приложений, использующих OAuth2, OpenID Connect Connect и SAML.

## <a name="requirements"></a>Требования

Чтобы использовать подключаемый модуль единого входа Microsoft Enterprise для устройств Apple, выполните следующие действия.

- Устройство должно **поддерживать** и иметь приложение, включающее подключаемый модуль единого входа Microsoft Enterprise **для устройств Apple**:
  - iOS 13.0 +: [Microsoft Authenticator приложение](../user-help/user-help-auth-app-overview.md)
  - Ипадос 13.0 +: [Microsoft Authenticator приложение](../user-help/user-help-auth-app-overview.md)
  - macOS 10.15 +: [Корпоративный портал Intune приложение](/mem/intune/user-help/enroll-your-device-in-intune-macos-cp)
- Устройство должно быть **зарегистрировано в MDM** (например, с Microsoft Intune).
- Чтобы включить подключаемый модуль единого входа предприятия на устройстве, необходимо **принудительно отправить конфигурацию на устройство** . Это ограничение безопасности является обязательным для Apple.

### <a name="ios-requirements"></a>требования iOS:
- на устройстве должен быть установлен iOS 13,0 или более поздней версии.
- На устройстве должно быть установлено приложение Майкрософт, которое предоставляет подключаемый модуль единого входа Microsoft Enterprise для устройств Apple. Для общедоступной предварительной версии эти приложения являются [Microsoft Authenticatorным приложением](/intune/user-help/user-help-auth-app-overview.md).


### <a name="macos-requirements"></a>требования к macOS:
- на устройстве должен быть установлен macOS 10,15 или более поздней версии. 
- На устройстве должно быть установлено приложение Майкрософт, которое предоставляет подключаемый модуль единого входа Microsoft Enterprise для устройств Apple. Для общедоступной предварительной версии эти приложения включают [Корпоративный портал Intune приложение](/intune/user-help/enroll-your-device-in-intune-macos-cp.md).

## <a name="enable-the-sso-plug-in-with-mobile-device-management-mdm"></a>Включение подключаемого модуля единого входа с помощью управления мобильными устройствами (MDM)

### <a name="microsoft-intune-configuration"></a>Конфигурация Microsoft Intune

При использовании Microsoft Intune в качестве службы MDM можно использовать встроенные параметры профиля конфигурации, чтобы включить подключаемый модуль единого входа Microsoft Enterprise.

Сначала настройте параметры [расширения приложения единого входа](/mem/intune/configuration/device-features-configure#single-sign-on-app-extension) для профиля конфигурации и [назначьте профиль группе пользователей или устройств](/mem/intune/configuration/device-profile-assign) (если она еще не назначена).

Параметры профиля, включающие подключаемый модуль единого входа, автоматически применяются к устройствам группы при следующем входе каждого устройства в Intune.

### <a name="manual-configuration-for-other-mdm-services"></a>Настройка вручную для других служб MDM

Если вы не используете Microsoft Intune для управления мобильными устройствами, используйте следующие параметры для настройки подключаемого модуля единого входа Microsoft Enterprise для устройств Apple.

#### <a name="ios-settings"></a>Параметры iOS:

- **Идентификатор расширения**: `com.microsoft.azureauthenticator.ssoextension`
- **Идентификатор команды**: (это поле не требуется для iOS)

#### <a name="macos-settings"></a>Параметры macOS:

- **Идентификатор расширения**: `com.microsoft.CompanyPortalMac.ssoextension`
- **Идентификатор команды**: `UBF8T346G9`

#### <a name="common-settings"></a>Общие параметры:

- **Тип**: перенаправление
  - `https://login.microsoftonline.com`
  - `https://login.microsoft.com`
  - `https://sts.windows.net`
  - `https://login.partner.microsoftonline.cn`
  - `https://login.chinacloudapi.cn`
  - `https://login.microsoftonline.de`
  - `https://login.microsoftonline.us`
  - `https://login.usgovcloudapi.net`
  - `https://login-us.microsoftonline.com`
  
### <a name="additional-configuration-options"></a>Дополнительные параметры конфигурации.
Дополнительные параметры конфигурации можно добавить для расширения функциональности единого входа для дополнительных приложений.

#### <a name="enable-sso-for-apps-that-dont-use-a-microsoft-identity-platform-library"></a>Включение единого входа для приложений, не использующих библиотеку платформы Microsoft Identity

Подключаемый модуль единого входа позволяет любому приложению участвовать в едином входе, даже если оно не было разработано с помощью пакета Microsoft SDK, такого как библиотека проверки подлинности Майкрософт (MSAL).

Подключаемый модуль единого входа устанавливается автоматически устройствами, которые загрузили Microsoft Authenticatorное приложение в iOS и Ипадос или Корпоративный портал Intune приложение на macOS и зарегистрировали свое устройство в Организации. Организация, скорее всего, использует приложение Authenticator сегодня для таких сценариев, как многофакторная идентификация, проверка подлинности без пароля и условный доступ. Его можно включить для приложений с помощью любого поставщика MDM, хотя корпорация Майкрософт упростила настройку в Microsoft Endpoint Manager для Intune. Список разрешений используется для настройки этих приложений на использование подключаемого модуля единого входа.

>[!IMPORTANT]
> Поддерживаются только приложения, использующие собственные сетевые технологии Apple или веб – представления. Если приложение поставляется с собственной реализацией сетевого уровня, подключаемый модуль единого входа Microsoft Enterprise не поддерживается.  

Используйте следующие параметры для настройки подключаемого модуля единого входа Microsoft Enterprise для приложений, которые не используют библиотеку платформ Microsoft Identity.

Если вы хотите предоставить список конкретных приложений:

- **Ключ:** `AppAllowList`
- **Тип**: `String`
- **Значение**: разделенный запятыми список идентификаторов наборов приложений для приложений, которые могут УЧАСТВОВАТЬ в SSO.
- **Например**: `com.contoso.workapp, com.contoso.travelapp`.

Или, если требуется предоставить список префиксов:
- **Ключ:** `AppPrefixAllowList`
- **Тип**: `String`
- **Значение**: разделенный запятыми список ПРЕФИКСов идентификаторов наборов приложений для приложений, которым разрешено принимать участие в SSO. Обратите внимание, что при этом все приложения, начинающиеся с определенного префикса, будут включены в единый вход.
- **Например**: `com.contoso., com.fabrikam.`.

[Приложения](./application-consent-experience.md) с ограниченным участием, разрешенные администратором MDM для участия в SSO, могут получать маркер для конечного пользователя автоматически. Поэтому важно добавлять в список разрешений только доверенные приложения. 

>[!NOTE]
> В этот список не нужно добавлять приложения, использующие MSAL или Асвебаусентикатионсессион. Эти приложения включены по умолчанию. 

##### <a name="how-to-discover-app-bundle-identifiers-on-ios-devices"></a>Обнаружение идентификаторов наборов приложений на устройствах iOS

Apple не предоставляет простого способа обнаружения идентификаторов пакетов из магазина приложений. Самый простой способ обнаружить идентификаторы пакетов приложений, которые хотят использовать для единого входа, — попросить поставщика или разработчика приложения. Если этот параметр недоступен, можно использовать конфигурацию MDM для обнаружения идентификаторов пакетов. 

Временно включите следующий флаг в конфигурации MDM:

- **Ключ:** `admin_debug_mode_enabled`
- **Тип**: `Integer`
- **Значение**: 1 или 0

Если этот флаг включен для входа в приложения iOS на устройстве, для которого необходимо получить идентификатор пакета. Затем откройте Microsoft Authenticator приложение > Справка > журналы отправки — > Просмотр журналов. 

В файле журнала найдите следующую строку:

`[ADMIN MODE] SSO extension has captured following app bundle identifiers:`

При этом должны быть записаны все идентификаторы пакетов приложений, видимые для расширения единого входа. Затем эти идентификаторы можно использовать для настройки единого входа для этих приложений. 

#### <a name="allow-user-to-sign-in-from-unknown-applications-and-the-safari-browser"></a>Разрешить пользователю входить из неизвестных приложений и браузера Safari.

По умолчанию подключаемый модуль единого входа Майкрософт предоставляет единый вход для разрешенных приложений только в том случае, если пользователь выполнил вход из приложения, использующего библиотеку платформы удостоверений Майкрософт, например ADAL или MSAL. Подключаемый модуль единого входа Microsoft Enterprise может также получать общие учетные данные при вызове из другого приложения, использующего библиотеку платформы Microsoft Identity во время получения нового маркера.

`browser_sso_interaction_enabled`Флаг включения позволяет приложению, не использующему библиотеку платформы Microsoft Identity, выполнять начальную начальную загрузку и получать общие учетные данные. Он также позволяет браузеру Safari выполнить начальную начальную загрузку и получить общие учетные данные. Если у подключаемого модуля единого входа Microsoft Enterprise нет общих учетных данных, он попытается получить его каждый раз, когда запрос на вход будет запрошен из URL-адреса Azure AD в браузере Safari, Асвебаусентикатионсессион, Сафаривиевконтроллер или другого разрешенного собственного приложения.  

- **Ключ:** `browser_sso_interaction_enabled`
- **Тип**: `Integer`
- **Значение**: 1 или 0

Для macOS этот параметр необходим для более согласованного взаимодействия во всех приложениях. Для iOS и Ипадос этот параметр не требуется, так как большинство приложений используют Microsoft Authenticator приложение для входа. Однако если у вас есть приложения, которые не используют Microsoft Authenticator в iOS или Ипадос этот флаг улучшит работу, поэтому мы рекомендуем включить этот параметр. Он отключен по умолчанию.

#### <a name="disable-asking-for-mfa-on-initial-bootstrapping"></a>Отключить запрос MFA при начальной загрузке

По умолчанию подключаемый модуль единого входа Microsoft Enterprise всегда предлагает пользователю выполнить многофакторную проверку подлинности (MFA) при начальной начальной загрузке и получении общих учетных данных, даже если это не требуется для текущего приложения, запущенного пользователем. Это значит, что общие учетные данные можно легко использовать во всех дополнительных приложениях без запроса пользователя, если MFA потребуется позже. Это сокращает время, необходимое пользователю для запроса на устройстве и, как правило, хорошее решение.

Включение `browser_sso_disable_mfa` этого параметра отключает этот режим и запрашивает у пользователя только то время, когда MFA требуется для приложения или ресурса. 

- **Ключ:** `browser_sso_disable_mfa`
- **Тип**: `Integer`
- **Значение**: 1 или 0

Рекомендуется отключить этот флаг, так как он сокращает время, необходимое пользователю для запроса на устройстве. Если в вашей организации редко используется MFA, вы можете включить этот флаг, но мы рекомендуем использовать MFA чаще. По этой причине она отключена по умолчанию.

#### <a name="disable-oauth2-application-prompts"></a>Отключить запросы приложения OAuth2

Подключаемый модуль SSO Microsoft Enterprise обеспечивает единый вход, добавляя общие учетные данные к сетевым запросам, поступающим из разрешенных приложений. Однако некоторые OAuth2 приложения могут неправильно применять запросы конечных пользователей на уровне протокола. Если это происходит, вы увидите, что общие учетные данные для этих приложений игнорируются, и пользователю предлагается выполнить вход, даже несмотря на то, что подключаемый модуль единого входа Microsoft Enterprise работает для других приложений.  

Флаг включения позволяет `disable_explicit_app_prompt` использовать как собственные, так и веб-приложения для принудительного выполнения запроса конечным пользователем на уровне протокола и обходить единый вход.

- **Ключ:** `disable_explicit_app_prompt`
- **Тип**: `Integer`
- **Значение**: 1 или 0

Рекомендуется включить этот флаг, чтобы обеспечить более согласованную работу во всех приложениях. Он отключен по умолчанию. 

#### <a name="enable-sso-through-cookies-for-specific-application"></a>Включение единого входа с помощью файлов cookie для конкретного приложения

Небольшое количество приложений может быть несовместимо с расширением единого входа. В частности, приложения с дополнительными сетевыми параметрами могут столкнуться с непредвиденными проблемами, если они включены для единого входа (например, может появиться сообщение об ошибке, в результате которой сетевой запрос был отменен или прерван). 

Если при входе в систему с помощью метода, описанного в `Enable SSO for apps that don't use MSAL` разделе, возникают проблемы, можно попробовать альтернативную конфигурацию этих приложений. 

Используйте следующие параметры для настройки подключаемого модуля единого входа Microsoft Enterprise для конкретных приложений:

- **Ключ:** `AppCookieSSOAllowList`
- **Тип**: `String`
- **Значение**: разделенный запятыми список ПРЕФИКСов идентификаторов наборов приложений для приложений, которым разрешено принимать участие в SSO. Обратите внимание, что при этом все приложения, начинающиеся с определенного префикса, будут включены в единый вход.
- **Например**: `com.contoso.myapp1, com.fabrikam.myapp2`.

Обратите внимание, что приложения, поддерживающие единый вход с помощью этого механизма, должны быть добавлены в `AppCookieSSOAllowList` и `AppPrefixAllowList` .

Рекомендуется использовать этот параметр только для приложений, которые столкнулись с непредвиденными ошибками при входе. 

#### <a name="use-intune-for-simplified-configuration"></a>Использование Intune для упрощения настройки

Как упоминалось ранее, вы можете использовать Microsoft Intune в качестве службы MDM, чтобы упростить настройку подключаемого модуля единого входа Microsoft Enterprise, включая Включение подключаемого модуля и добавление старых приложений в список разрешений для получения единого входа. Дополнительные сведения см. в [документации по конфигурации Intune](/intune/configuration/ios-device-features-settings).

## <a name="using-the-sso-plug-in-in-your-application"></a>Использование подключаемого модуля единого входа в приложении

[Библиотека проверки подлинности Microsoft (MSAL) для устройств Apple](https://github.com/AzureAD/microsoft-authentication-library-for-objc) версии 1.1.0 и выше поддерживает подключаемый модуль единого входа Microsoft Enterprise для устройств Apple. Это рекомендуемый способ добавления поддержки для подключаемого модуля единого входа Microsoft Enterprise и получения всех возможностей платформы Microsoft Identity.

Если вы создаете приложение для рабочих сценариев оказался, см. раздел [режим общего устройства для устройств iOS](msal-ios-shared-devices.md) для дополнительной настройки компонента.

## <a name="how-the-sso-plug-in-works"></a>Принцип работы подключаемого модуля единого входа

Подключаемый модуль единого входа Майкрософт использует [корпоративную платформу Apple enterprise Sign-On Framework](https://developer.apple.com/documentation/authenticationservices/asauthorizationsinglesignonprovider?language=objc). Поставщики удостоверений, подключенные к платформе, могут перехватывать сетевой трафик для своих доменов, а также улучшать или изменять способ обработки этих запросов. Например, подключаемый модуль единого входа может отображать дополнительный пользовательский интерфейс для безопасного получения учетных данных пользователя, требовать MFA или автоматически предоставлять токены для приложения.

Собственные приложения также могут реализовывать пользовательские операции и обращаться непосредственно к подключаемому модулю единого входа.
Вы можете узнать об инфраструктуре единого входа в этом [2019 ввдк видео из Apple](https://developer.apple.com/videos/play/tech-talks/301/) .

### <a name="applications-that-use-a-microsoft-identity-platform-library"></a>Приложения, использующие библиотеку платформы удостоверений Майкрософт

[Библиотека проверки подлинности Microsoft (MSAL) для устройств Apple](https://github.com/AzureAD/microsoft-authentication-library-for-objc) версии 1.1.0 и выше поддерживает подключаемый модуль единого входа Microsoft Enterprise для устройств Apple в собственном режиме для рабочих и учебных учетных записей. 

При соблюдении [всех рекомендуемых действий](./quickstart-v2-ios.md) и использовании [формата URI перенаправления](./redirect-uris-ios.md)по умолчанию не требуется специальной настройки. При запуске на устройстве, где имеется подключаемый модуль единого входа, MSAL автоматически вызывает его для всех интерактивных и автоматических запросов маркеров, а также для операций перечисления учетных записей и удаления учетных записей. Так как MSAL реализует собственный протокол единого входа, который использует пользовательские операции, эта программа установки обеспечивает самый гладкий собственный интерфейс для конечного пользователя. 

Если подключаемый модуль SSO не включен в MDM, но на устройстве имеется Microsoft Authenticator приложение, MSAL будет использовать Microsoft Authenticatorное приложение для любых интерактивных запросов маркеров. Подключаемый модуль единого входа использует единый вход с приложением Microsoft Authenticator.

### <a name="applications-that-dont-use-a-microsoft-identity-platform-library"></a>Приложения, которые не используют библиотеку платформы идентификации Майкрософт

Приложения, которые не используют библиотеку платформы идентификации Майкрософт, например MSAL, могут по-прежнему получать единый вход, если администратор добавил их в список разрешений явным образом. 

В этих приложениях не требуется вносить изменения в код, если выполняются следующие условия.

- Приложение использует платформы Apple для выполнения сетевых запросов (например, [вквебвиев](https://developer.apple.com/documentation/webkit/wkwebview), [NSURLSession](https://developer.apple.com/documentation/foundation/nsurlsession)). 
- Приложение использует стандартные протоколы для взаимодействия с Azure AD (например, OAuth2, SAML, WS-Federation).
- Приложение не соберет имя пользователя и пароль открытого текста в собственном пользовательском интерфейсе

В этом случае единый вход предоставляется, когда приложение создает сетевой запрос и открывает веб-браузер для входа пользователя. Когда пользователь перенаправляется на URL-адрес входа в Azure AD, подключаемый модуль единого входа проверяет URL-адрес и проверяет наличие учетных данных единого входа для этого URL-адреса. Если это так, подключаемый модуль единого входа передает учетные данные единого входа в Azure AD, что разрешает приложению завершить сетевой запрос, не запрашивая от пользователя ввода учетных данных. Кроме того, если устройство известно для Azure AD, подключаемый модуль единого входа также передаст сертификат устройства для удовлетворения проверки условного доступа на основе устройств. 

Для поддержки единого входа для MSAL приложений подключаемый модуль единого входа реализует протокол, аналогичный подключаемому модулю браузера Windows, описанному в разделе [что такое основной маркер обновления?](../devices/concept-primary-refresh-token.md#browser-sso-using-prt). 

По сравнению с приложениями на основе MSAL подключаемый модуль единого входа работает более прозрачно для приложений, не являющихся MSAL, путем интеграции с существующим интерфейсом входа в браузер, предоставляемым приложениями. Конечный пользователь увидит свои привычные возможности, и вам не нужно выполнять дополнительные операции входа в каждое приложение. Например, вместо того чтобы отображать средство выбора собственной учетной записи, подключаемый модуль единого входа добавляет сеансы единого входа к веб-интерфейсу выбора учетных записей. 

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения о режиме общего устройства в iOS см. в статье [режим общего устройства для устройств iOS](msal-ios-shared-devices.md).
