---
title: Подключаемый модуль единого входа Microsoft Enterprise для устройств Apple
titleSuffix: Microsoft identity platform | Azure
description: Сведения о подключаемом модуле единого входа Azure Active Directory для устройств iOS, Ипадос и macOS.
services: active-directory
author: brandwe
manager: CelesteDG
ms.service: active-directory
ms.subservice: develop
ms.topic: conceptual
ms.workload: identity
ms.date: 09/15/2020
ms.author: brandwe
ms.reviewer: brandwe
ms.custom: aaddev
ms.openlocfilehash: 24a538686e101d40daba008f30a72ffc5078047a
ms.sourcegitcommit: 867cb1b7a1f3a1f0b427282c648d411d0ca4f81f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "104674535"
---
# <a name="microsoft-enterprise-sso-plug-in-for-apple-devices-preview"></a>Подключаемый модуль единого входа Microsoft Enterprise для устройств Apple (Предварительная версия)

>[!IMPORTANT]
> Эта функция [!INCLUDE [PREVIEW BOILERPLATE](../../../includes/active-directory-develop-preview.md)]

*Подключаемый модуль единого входа Microsoft Enterprise для устройств Apple* обеспечивает единый вход (SSO) для учетных записей Azure Active Directory (Azure AD) в MacOS, iOS и ипадос во всех приложениях, поддерживающих функцию [единого входа Apple Enterprise](https://developer.apple.com/documentation/authenticationservices) . Подключаемый модуль предоставляет единый вход для даже старых приложений, от которых может зависеть ваш бизнес, но не поддерживающих последние библиотеки удостоверений или протоколы. Корпорация Майкрософт тесно работала с компанией Apple для разработки этого подключаемого модуля, чтобы повысить удобство использования приложения и обеспечить лучшую защиту.

В настоящее время подключаемый модуль единого входа предприятия является встроенной функцией следующих приложений:

* [Microsoft Authenticator](../user-help/user-help-auth-app-overview.md): iOS, ипадос
* Microsoft Intune [Корпоративный портал](/mem/intune/apps/apps-company-portal-macos): macOS

## <a name="features"></a>Компоненты

Подключаемый модуль единого входа Microsoft Enterprise для устройств Apple предоставляет следующие преимущества.

- Он предоставляет единый вход для учетных записей Azure AD во всех приложениях, поддерживающих функцию единого входа Apple Enterprise.
- Его можно включить с помощью любого решения по управлению мобильными устройствами (MDM).
- Он расширяет единый вход для приложений, которые еще не используют библиотеки платформы Microsoft Identity.
- Он расширяет единый вход для приложений, использующих OAuth 2, OpenID Connect Connect и SAML.

## <a name="requirements"></a>Требования

Чтобы использовать подключаемый модуль единого входа Microsoft Enterprise для устройств Apple, выполните следующие действия.

- Устройство должно *поддерживать* и иметь установленное приложение с подключаемым модулем единого входа Microsoft Enterprise для устройств Apple:
  - iOS 13,0 и более поздние версии: [Microsoft Authenticator приложение](../user-help/user-help-auth-app-overview.md)
  - Ипадос 13,0 и более поздних версий: [приложение Microsoft Authenticator](../user-help/user-help-auth-app-overview.md)
  - macOS 10,15 и более поздних версий: [приложение корпоративный портал Intune](/mem/intune/user-help/enroll-your-device-in-intune-macos-cp)
- Устройство должно быть *зарегистрировано в MDM*, например с помощью Microsoft Intune.
- Чтобы включить подключаемый модуль единого входа предприятия, необходимо *принудительно отправить конфигурацию на устройство* . Apple требует этого ограничения безопасности.

требования iOS:
- на устройстве должен быть установлен iOS 13,0 или более поздней версии.
- На устройстве должно быть установлено приложение Майкрософт, которое предоставляет подключаемый модуль единого входа Microsoft Enterprise для устройств Apple. В общедоступной предварительной версии это приложение [Microsoft Authenticator](/intune/user-help/user-help-auth-app-overview.md).


требования к macOS:
- на устройстве должен быть установлен macOS 10,15 или более поздней версии. 
- На устройстве должно быть установлено приложение Майкрософт, которое предоставляет подключаемый модуль единого входа Microsoft Enterprise для устройств Apple. В общедоступной предварительной версии это приложение [Корпоративный портал Intune](/intune/user-help/enroll-your-device-in-intune-macos-cp.md).

## <a name="enable-the-sso-plug-in"></a>Включение подключаемого модуля единого входа

Используйте следующие сведения, чтобы включить подключаемый модуль SSO с помощью MDM.
### <a name="microsoft-intune-configuration"></a>Конфигурация Microsoft Intune

При использовании Microsoft Intune в качестве службы MDM можно использовать встроенные параметры профиля конфигурации, чтобы включить подключаемый модуль единого входа Microsoft Enterprise.

1. Настройте параметры [расширения приложения единого входа](/mem/intune/configuration/device-features-configure#single-sign-on-app-extension) для профиля конфигурации. 
1. Если профиль еще не назначен, [назначьте профиль группе пользователей или устройств](/mem/intune/configuration/device-profile-assign).

Параметры профиля, включающие подключаемый модуль единого входа, автоматически применяются к устройствам группы при следующем входе каждого устройства в Intune.

### <a name="manual-configuration-for-other-mdm-services"></a>Настройка вручную для других служб MDM

Если вы не используете Intune для MDM, используйте следующие параметры для настройки подключаемого модуля единого входа Microsoft Enterprise для устройств Apple.

Параметры iOS:

- **Идентификатор расширения**: `com.microsoft.azureauthenticator.ssoextension`
- **Идентификатор команды**: это поле не требуется для iOS.

Параметры macOS:

- **Идентификатор расширения**: `com.microsoft.CompanyPortalMac.ssoextension`
- **Идентификатор команды**: `UBF8T346G9`

Общие параметры:

- **Тип**: перенаправление
  - `https://login.microsoftonline.com`
  - `https://login.microsoft.com`
  - `https://sts.windows.net`
  - `https://login.partner.microsoftonline.cn`
  - `https://login.chinacloudapi.cn`
  - `https://login.microsoftonline.de`
  - `https://login.microsoftonline.us`
  - `https://login.usgovcloudapi.net`
  - `https://login-us.microsoftonline.com`
  
### <a name="more-configuration-options"></a>Дополнительные параметры конфигурации
Вы можете добавить дополнительные параметры конфигурации, чтобы расширить функциональность единого входа для других приложений.

#### <a name="enable-sso-for-apps-that-dont-use-a-microsoft-identity-platform-library"></a>Включение единого входа для приложений, не использующих библиотеку платформы Microsoft Identity

Подключаемый модуль единого входа позволяет любому приложению участвовать в работе единого входа, даже если оно не было разработано с помощью пакета Microsoft SDK, такого как библиотека проверки подлинности Майкрософт (MSAL).

Подключаемый модуль единого входа устанавливается автоматически устройствами, которые имеют следующие компоненты:
* Скачано приложение для проверки подлинности в iOS или Ипадос или скачано Корпоративный портал Intuneное приложение в macOS.
* Зарегистрировали свое устройство в Организации. 

Скорее всего, ваша организация использует приложение Authenticator для таких сценариев, как многофакторная проверка подлинности (MFA), проверка подлинности без пароля и условный доступ. С помощью поставщика MDM можно включить подключаемый модуль единого входа для приложений. Корпорация Майкрософт упростила настройку подключаемого модуля внутри Microsoft Endpoint Manager в Intune. Разрешенных используется для настройки этих приложений на использование подключаемого модуля единого входа.

>[!IMPORTANT]
> Подключаемый модуль единого входа Microsoft Enterprise поддерживает только приложения, использующие собственные сетевые технологии Apple или веб-представления. Он не поддерживает приложения, поставляющие собственные реализации сетевого уровня.  

Используйте следующие параметры для настройки подключаемого модуля единого входа Microsoft Enterprise для приложений, которые не используют библиотеку платформ Microsoft Identity.

Чтобы предоставить список конкретных приложений, используйте следующие параметры:

- **Ключ:** `AppAllowList`
- **Тип**: `String`
- **Значение**: разделенный запятыми список идентификаторов наборов приложений для приложений, которые могут УЧАСТВОВАТЬ в SSO.
- **Например**: `com.contoso.workapp, com.contoso.travelapp`.

Чтобы предоставить список префиксов, используйте следующие параметры:
- **Ключ:** `AppPrefixAllowList`
- **Тип**: `String`
- **Значение**: разделенный запятыми список ПРЕФИКСов идентификаторов наборов приложений для приложений, которые могут УЧАСТВОВАТЬ в SSO. Этот параметр позволяет принимать участие в использовании единого входа для всех приложений, начинающихся с определенного префикса.
- **Например**: `com.contoso., com.fabrikam.`.

[Приложения](./application-consent-experience.md) с ограниченным участием, которые администратор MDM разрешает УЧАСТВОВАТЬ в SSO, может автоматически получить маркер для конечного пользователя. Поэтому добавляйте в разрешенных только доверенные приложения. 

>[!NOTE]
> Вам не нужно добавлять приложения, использующие MSAL или Асвебаусентикатионсессион, в список приложений, которые могут участвовать в SSO. Эти приложения включены по умолчанию. 

##### <a name="find-app-bundle-identifiers-on-ios-devices"></a>Поиск идентификаторов наборов приложений на устройствах iOS

Компания Apple не предоставляет простого способа получения идентификаторов пакетов из магазина приложений. Самый простой способ получить идентификаторы пакетов приложений, которые вы хотите использовать для единого входа, — попросить поставщика или разработчика приложения. Если этот параметр недоступен, можно использовать конфигурацию MDM для поиска идентификаторов пакетов: 

1. Временно включите следующий флаг в конфигурации MDM:

    - **Ключ:** `admin_debug_mode_enabled`
    - **Тип**: `Integer`
    - **Значение**: 1 или 0
1. Если этот флаг включен, войдите в приложения iOS на устройстве, для которого необходимо получить идентификатор пакета. 
1. В приложении Authenticator выберите **Справка**  >  **отправить журналы**  >  **Просмотреть журналы**. 
1. В файле журнала найдите следующую строку: `[ADMIN MODE] SSO extension has captured following app bundle identifiers` . В этой строке должны быть записаны все идентификаторы наборов приложений, которые видимы для расширения единого входа. 

Используйте идентификаторы пакетов, чтобы настроить единый вход для приложений. 

#### <a name="allow-users-to-sign-in-from-unknown-applications-and-the-safari-browser"></a>Разрешить пользователям входить из неизвестных приложений и браузера Safari

По умолчанию подключаемый модуль единого входа Microsoft предоставляет единый вход для разрешенных приложений только в том случае, если пользователь выполнил вход из приложения, использующего библиотеку платформы идентификации Майкрософт, например MSAL или библиотеку проверки подлинности Azure Active Directory (ADAL). Подключаемый модуль единого входа Microsoft Enterprise может также получать общие учетные данные при вызове из другого приложения, использующего библиотеку платформы Microsoft Identity во время получения нового маркера.

При включении `browser_sso_interaction_enabled` флага приложения, которые не используют библиотеку платформы Microsoft Identity, могут выполнять начальную начальную загрузку и получать общие учетные данные. Браузер Safari также может выполнить начальную загрузку и получить общие учетные данные. 

Если у подключаемого модуля Microsoft Enterprise SSO нет общих учетных данных, он попытается получить его каждый раз, когда запрос на вход будет запрошен из URL-адреса Azure AD в браузере Safari, Асвебаусентикатионсессион, Сафаривиевконтроллер или в другом разрешенном собственном приложении. 

Используйте эти параметры, чтобы включить флаг: 

- **Ключ:** `browser_sso_interaction_enabled`
- **Тип**: `Integer`
- **Значение**: 1 или 0

для macOS требуется этот параметр, чтобы обеспечить согласованную работу во всех приложениях. iOS и Ипадос не нуждаются в этом параметре, так как большинство приложений используют приложение проверки подлинности для входа. Но рекомендуется включить этот параметр, так как если некоторые приложения не используют приложение проверки подлинности в iOS или Ипадос, этот флаг повысит эффективность работы. По умолчанию этот параметр отключен.

#### <a name="disable-asking-for-mfa-during-initial-bootstrapping"></a>Отключить запрос MFA во время начальной загрузки

По умолчанию подключаемый модуль единого входа Microsoft Enterprise всегда запрашивает у пользователя MFA во время начальной загрузки и при получении общих учетных данных. Пользователю предлагается указать MFA, даже если он не требуется для приложения, которое открывал пользователь. Такое поведение позволяет легко использовать общие учетные данные во всех других приложениях без запроса пользователя, если MFA потребуется позже. Так как пользователь получает меньшее количество запросов, обычно это хорошее решение.

Включение `browser_sso_disable_mfa` MFA во время начальной начальной загрузки и получения общих учетных данных. В этом случае пользователю предлагается только в том случае, если для приложения или ресурса требуется MFA. 

Чтобы включить этот флаг, используйте следующие параметры:

- **Ключ:** `browser_sso_disable_mfa`
- **Тип**: `Integer`
- **Значение**: 1 или 0

Рекомендуется отключить этот флаг, так как он сокращает количество запросов пользователя на вход. Если в организации редко используется MFA, может потребоваться включить этот флаг. Но рекомендуется чаще использовать MFA. По этой причине флаг по умолчанию отключен.

#### <a name="disable-oauth-2-application-prompts"></a>Отключение запросов приложения OAuth 2

Подключаемый модуль SSO Microsoft Enterprise обеспечивает единый вход, добавляя общие учетные данные к сетевым запросам, которые поступают из разрешенных приложений. Однако некоторые приложения OAuth 2 могут неправильно применять запросы конечных пользователей на уровне протокола. Если вы видите эту проблему, вы также увидите, что общие учетные данные для этих приложений игнорируются. Пользователю предлагается выполнить вход, даже если подключаемый модуль единого входа Microsoft Enterprise работает для других приложений.  

Включение `disable_explicit_app_prompt` флага позволяет использовать как собственные приложения, так и веб-приложения для принудительного выполнения запроса конечным пользователем на уровне протокола и обходить единый вход. Чтобы включить этот флаг, используйте следующие параметры:

- **Ключ:** `disable_explicit_app_prompt`
- **Тип**: `Integer`
- **Значение**: 1 или 0

Рекомендуется включить этот флаг, чтобы обеспечить согласованную работу во всех приложениях. Она отключена по умолчанию. 

#### <a name="enable-sso-through-cookies-for-a-specific-application"></a>Включение единого входа с помощью файлов cookie для определенного приложения

Некоторые приложения могут быть несовместимы с расширением единого входа. В частности, приложения с расширенными сетевыми параметрами могут столкнуться с непредвиденными проблемами, если они включены для единого входа. Например, может появиться сообщение об ошибке, показывающее, что сетевой запрос был отменен или прерван. 

Если при входе возникли проблемы с помощью метода, описанного в разделе [приложения, для которых не используется MSAL](#applications-that-dont-use-msal) , попробуйте использовать другую конфигурацию. Используйте эти параметры для настройки подключаемого модуля.

- **Ключ:** `AppCookieSSOAllowList`
- **Тип**: `String`
- **Значение**: разделенный запятыми список ПРЕФИКСов идентификаторов наборов приложений для приложений, которым разрешено принимать участие в SSO. Все приложения, начинающиеся с указанных префиксов, могут участвовать в SSO.
- **Например**: `com.contoso.myapp1, com.fabrikam.myapp2`.

Приложения, поддерживающие единый вход с помощью этой программы установки, необходимо добавить в `AppCookieSSOAllowList` и `AppPrefixAllowList` .

Используйте эту конфигурацию только для приложений с непредвиденными ошибками при входе. 

#### <a name="use-intune-for-simplified-configuration"></a>Использование Intune для упрощения настройки

Intune можно использовать в качестве службы MDM для упрощения настройки подключаемого модуля единого входа Microsoft Enterprise. Например, с помощью Intune можно включить подключаемый модуль и добавить старые приложения к разрешенных, чтобы они могли получить единый вход. 

Дополнительные сведения см. в [документации по конфигурации Intune](/intune/configuration/ios-device-features-settings).

## <a name="use-the-sso-plug-in-in-your-application"></a>Использование подключаемого модуля SSO в приложении

[MSAL для устройств Apple](https://github.com/AzureAD/microsoft-authentication-library-for-objc) версии 1.1.0 и более поздних версий поддерживает подключаемый модуль единого входа Microsoft Enterprise для устройств Apple. Это рекомендуемый способ добавления поддержки для подключаемого модуля единого входа Microsoft Enterprise. Это гарантирует, что вы получите все возможности платформы Microsoft Identity.

Если вы создаете приложение для сценариев оказался-Worker, см. сведения об установке в разделе [режим общего устройства для устройств iOS](msal-ios-shared-devices.md) .

## <a name="understand-how-the-sso-plug-in-works"></a>Общие сведения о работе подключаемого модуля единого входа

Подключаемый модуль SSO Microsoft Enterprise использует [платформу Apple Enterprise SSO Framework](https://developer.apple.com/documentation/authenticationservices/asauthorizationsinglesignonprovider?language=objc). Поставщики удостоверений, которые присоединяются к инфраструктуре, могут перехватывать сетевой трафик для своих доменов, а также улучшать или изменять способ обработки этих запросов. Например, подключаемый модуль единого входа может показывать больше пользовательских интерфейсов для безопасного получения учетных данных пользователя, потребовать MFA или автоматически предоставлять токены для приложения.

Собственные приложения также могут реализовывать пользовательские операции и напрямую взаимодействовать с подключаемым модулем единого входа. Дополнительные сведения см. в этом [видеоролике по Всемирной конференции для разработчиков 2019](https://developer.apple.com/videos/play/tech-talks/301/).

### <a name="applications-that-use-msal"></a>Приложения, использующие MSAL

[MSAL для устройств Apple](https://github.com/AzureAD/microsoft-authentication-library-for-objc) версии 1.1.0 и более поздних версий поддерживает подключаемый модуль единого входа Microsoft Enterprise для устройств Apple в собственном режиме для рабочих и учебных учетных записей. 

При соблюдении [всех рекомендуемых действий](./quickstart-v2-ios.md) и использовании [формата URI перенаправления](./redirect-uris-ios.md)по умолчанию вам не нужна специальная конфигурация. На устройствах с подключаемым модулем единого входа MSAL автоматически вызывает его для всех интерактивных и автоматических запросов маркеров. Он также вызывает его для операций перечисления учетных записей и удаления учетных записей. Так как MSAL реализует собственный подключаемый протокол единого входа, который использует пользовательские операции, эта программа установки обеспечивает самый гладкий собственный интерфейс для конечного пользователя. 

Если подключаемый модуль SSO не включен в MDM, но на устройстве имеется Microsoft Authenticator приложение, MSAL использует приложение для проверки подлинности для любых интерактивных запросов маркеров. Подключаемый модуль единого входа использует единый вход с приложением для проверки подлинности.

### <a name="applications-that-dont-use-msal"></a>Приложения, которые не используют MSAL

Приложения, которые не используют библиотеку платформы идентификации Майкрософт, например MSAL, могут по-прежнему получать единый вход, если администратор добавил эти приложения в разрешенных. 

Вам не нужно изменять код в этих приложениях при условии соблюдения следующих условий.

- Приложение использует платформы Apple для выполнения сетевых запросов. К таким платформам относятся [вквебвиев](https://developer.apple.com/documentation/webkit/wkwebview) и [NSURLSession](https://developer.apple.com/documentation/foundation/nsurlsession), например. 
- Приложение использует стандартные протоколы для взаимодействия с Azure AD. К таким протоколам относятся, например, OAuth 2, SAML и WS-Federation.
- Приложение не соберет имена пользователей и пароли с открытым текстом в собственном пользовательском интерфейсе.

В этом случае единый вход предоставляется, когда приложение создает сетевой запрос и открывает веб-браузер для входа пользователя. Когда пользователь перенаправляется на URL-адрес входа в Azure AD, подключаемый модуль единого входа проверяет URL-адрес и проверяет наличие учетных данных единого входа для этого URL-адреса. При обнаружении учетных данных подключаемый модуль единого входа передает его в Azure AD, который разрешает приложению выполнить сетевой запрос, не запрашивая от пользователя ввода учетных данных. Кроме того, если устройство известно для Azure AD, подключаемый модуль единого входа передает сертификат устройства в соответствии с проверками условного доступа на основе устройств. 

Для поддержки единого входа для MSAL приложений подключаемый модуль единого входа реализует протокол, аналогичный подключаемому модулю браузера Windows, описанному в разделе [что такое основной маркер обновления?](../devices/concept-primary-refresh-token.md#browser-sso-using-prt). 

По сравнению с приложениями на основе MSAL, подключаемый модуль единого входа работает более прозрачно для приложений, не являющихся MSAL. Она интегрируется с существующим интерфейсом входа в браузер, предоставляемым приложениями. 

Конечный пользователь видит знакомый опыт и не должен снова входить в каждое приложение. Например, вместо того чтобы отображать средство выбора собственной учетной записи, подключаемый модуль единого входа добавляет сеансы единого входа к веб-интерфейсу выбора учетных записей. 

## <a name="next-steps"></a>Дальнейшие действия

Сведения о [режиме общего устройства для устройств iOS](msal-ios-shared-devices.md).
