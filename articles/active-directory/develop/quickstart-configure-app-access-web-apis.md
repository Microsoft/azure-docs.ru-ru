---
title: Краткое руководство. Настройка приложения для доступа к веб-API | Azure
titleSuffix: Microsoft identity platform
description: В этом кратком руководстве рассматривается регистрация приложения, представляющего веб-API на платформе удостоверений Microsoft, чтобы обеспечить ограниченный доступ к ресурсу (разрешения) для клиентских приложений.
services: active-directory
author: mmacy
manager: CelesteDG
ms.service: active-directory
ms.subservice: develop
ms.topic: quickstart
ms.workload: identity
ms.date: 09/03/2020
ms.author: marsma
ms.custom: aaddev, contperf-fy21q1
ms.reviewer: lenalepa, aragra, sureshja
ms.openlocfilehash: 0b064e8491b5d4fa988e9f476143cc0711e3934a
ms.sourcegitcommit: 227b9a1c120cd01f7a39479f20f883e75d86f062
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/18/2021
ms.locfileid: "100651380"
---
# <a name="quickstart-configure-a-client-application-to-access-a-web-api"></a>Краткое руководство. Настройка клиентского приложения для доступа к веб-API

В этом кратком руководстве вы предоставляете клиентское приложение, зарегистрированное на платформе удостоверений Microsoft, с ограниченным доступом на основе разрешений к своему веб-API. Вы также предоставляете клиентскому приложению доступ к Microsoft Graph.

Если при регистрации клиентского приложения указать области веб-API, клиентское приложение может получить маркер доступа, содержащий эти области, из платформы удостоверений Microsoft. В своем коде веб-API может предоставлять доступ к своим ресурсам на основе разрешений с учетом областей, указанных в маркере доступа.

## <a name="prerequisites"></a>Предварительные требования

* Учетная запись Azure с активной подпиской. [Создайте бесплатную учетную запись](https://azure.microsoft.com/free/?WT.mc_id=A261C142F).
* Завершение [краткого руководства по регистрации веб-приложения в Azure Active Directory B2C](quickstart-register-app.md).
* Завершение [краткого руководства по настройке приложения для предоставления веб-API](quickstart-configure-app-expose-web-apis.md).

## <a name="add-permissions-to-access-your-web-api"></a>Добавление разрешений для доступа к веб-API

В первом сценарии вы предоставляете клиентскому приложению доступ к вашему веб-API, который должен быть предварительно зарегистрирован. Если у вас еще нет зарегистрированных клиентского приложения и веб-API, выполните действия, описанные в двух статьях [Предварительные требования](#prerequisites).

На этой схеме показано, как регистрации двух приложений связаны друг с другом. В этом разделе вы добавите разрешения в регистрацию клиентского приложения.

:::image type="content" source="media/quickstart-configure-app-access-web-apis/diagram-01-app-permission-to-api-scopes.svg" alt-text="График, на котором показаны веб-API с выделенными областями справа и клиентским приложением слева, где эти области выбраны в качестве разрешений" border="false":::

После регистрации клиентского приложения и веб-API и предоставления API путем создания областей можно настроить клиентские разрешения для API, выполнив следующие действия.

1. Войдите на <a href="https://portal.azure.com/" target="_blank">портал Azure</a>.
1. Если у вас есть доступ к нескольким клиентам, в верхнем меню используйте фильтр **Каталог и подписка** :::image type="icon" source="./media/quickstart-configure-app-access-web-apis/portal-01-directory-subscription-filter.png" border="false":::, чтобы выбрать клиент, содержащий регистрацию клиентского приложения.
1. Выберите **Azure Active Directory** > **Регистрация приложений**, а затем выберите свое клиентское приложение (а *не* свой веб-API).
1. Выберите **Разрешения API** > **Добавить разрешение** > **Мои API**.
1. Выберите предварительно зарегистрированный веб-API.

    Параметр **Делегированные разрешения** выбран по умолчанию. Делегированные разрешения подходят для клиентских приложений, которые обращаются к веб-API в качестве пользователя, выполнившего вход, и доступ которых должен быть ограничен разрешениями, выбираемыми на следующем шаге. Для этого примера оставьте параметр **Делегированные разрешения** выбранным.

    Параметр **Разрешения приложения** предназначен для приложений типа службы или управляющей программы, которым необходим доступ к веб-API без участия пользователя при входе или предоставлении согласия. Пока вы не определите роли приложений для веб-API, этот параметр будет отключен.
1. В разделе **Выбор разрешений** разверните ресурс, области которого определены для веб-API, и выберите разрешения, которым клиентское приложение должно обладать от имени пользователя, выполнившего вход.

    Если вы использовали примеры имен областей, указанные в предыдущем кратком руководстве, вы увидите имена **Employees.Read.All** и **Employees.Write.All**.
    Выберите **Employees.Read.All** или другое разрешение, которое могло быть создано заранее.
1. Чтобы завершить процесс, выберите **Добавление разрешений**.

После добавления разрешений в API вы увидите выбранные разрешения в разделе **Настроенные разрешения**. На следующем рисунке показан пример делегированного разрешения *Employees.Read.All*, добавленного в регистрацию клиентского приложения.

:::image type="content" source="media/quickstart-configure-app-access-web-apis/portal-02-configured-permissions-pane.png" alt-text="Панель настроенных разрешений на портале Azure, где показано только что добавленное разрешение":::

Вы также можете увидеть разрешение *User.Read* для API Microsoft Graph. Это разрешение добавляется автоматически при регистрации приложения на портале Azure.

## <a name="add-permissions-to-access-microsoft-graph"></a>Добавление разрешений для доступа к Microsoft Graph

Помимо доступа к вашему веб-API от имени пользователя, выполнившего вход, приложению также может потребоваться доступ к данным этого (или другого) пользователя, хранящимся в Microsoft Graph, или их изменение. Возможно, у вас есть приложение в виде службы или управляющей программы, которому требуется доступ к Microsoft Graph от своего имени для выполнения операций без вмешательства пользователя.

### <a name="delegated-permission-to-microsoft-graph"></a>Делегированное разрешение для Microsoft Graph

Настройте делегированное разрешение для Microsoft Graph, чтобы разрешить клиентскому приложению выполнять операции от имени вошедшего в систему пользователя, например читать электронную почту или изменять профиль. По умолчанию у пользователя клиентского приложения при входе в систему запрашивается согласие на делегированные разрешения, которые вы настроили для него.

1. Войдите на <a href="https://portal.azure.com/" target="_blank">портал Azure</a>.
1. Если у вас есть доступ к нескольким клиентам, в верхнем меню используйте фильтр **Каталог и подписка** :::image type="icon" source="./media/quickstart-configure-app-access-web-apis/portal-01-directory-subscription-filter.png" border="false":::, чтобы выбрать клиент, содержащий регистрацию клиентского приложения.
1. Выберите **Azure Active Directory** > **Регистрация приложений**, а затем выберите свое клиентское приложение.
1. Выберите **Разрешения API** > **Добавить разрешение** > **Microsoft Graph**
1. Нажмите **Делегированные разрешения**. Microsoft Graph предоставляет множество разрешений, наиболее часто используемые из которых отображаются в верхней части списка.
1. В разделе **Выбор разрешений** выберите следующие разрешения.

    | Разрешение       | Описание                                         |
    |------------------|-----------------------------------------------------|
    | `email`          | Просмотр пользовательских адресов электронной почты.                           |
    | `offline_access` | Организация доступа к данным, к которым вам был предоставлен доступ |
    | `openid`         | Вход пользователей                                       |
    | `profile`        | Просмотр базовых профилей всех пользователей.                           |
1. Чтобы завершить процесс, выберите **Добавление разрешений**.

После настройки разрешений пользователи приложения при входе получают запрос, чтобы разрешить приложению доступ к API ресурса от их имени.

Администратор может также предоставить согласие от имени сразу *всех пользователей*, чтобы они не получали запрос вообще. Согласие администратора обсуждается далее в разделе [Дополнительные сведения о разрешениях API и согласии администратора](#more-on-api-permissions-and-admin-consent) этой статьи.

### <a name="application-permission-to-microsoft-graph"></a>Разрешение приложения для Microsoft Graph

Настройте разрешения для приложения, которое должно проходить проверку подлинности без участия пользователя или его согласия. Разрешения приложения обычно используются фоновыми службами или управляющими программами, которые обращаются к API в режиме без монитора, и веб-API, которые обращаются к другому (подчиненному) API.

В последующих шагах в качестве примера вы предоставляете разрешение *Files.Read.All* Microsoft Graph.

1. Войдите на <a href="https://portal.azure.com/" target="_blank">портал Azure</a>.
1. Если у вас есть доступ к нескольким клиентам, в верхнем меню используйте фильтр **Каталог и подписка** :::image type="icon" source="./media/quickstart-configure-app-access-web-apis/portal-01-directory-subscription-filter.png" border="false":::, чтобы выбрать клиент, содержащий регистрацию клиентского приложения.
1. Выберите **Azure Active Directory** > **Регистрация приложений**, а затем выберите свое клиентское приложение.
1. Выберите **Разрешения API** > **Добавить разрешение** > **Microsoft Graph** > **Разрешения приложения**.
1. Все разрешения, предоставляемые Microsoft Graph, отображаются в разделе **Выбор разрешений**.
1. Выберите разрешение или разрешения, которые вы хотите предоставить приложению. Например, вы можете использовать управляющее приложение, которое сканирует файлы в вашей организации, уведомляя об определенном типе или имени файла.

    В разделе **Выбор разрешения** разверните **Файлы**, а затем выберите разрешение *Files.Read.All*.
1. Выберите **Добавить разрешения**.

Некоторые разрешения, такие как разрешение Microsoft Graph *Files.Read.All*, требуют согласия администратора. Чтобы предоставить согласие администратора, выберите **Предоставление согласия администратора**, как описано далее в разделе [Кнопка "Согласие администратора"](#admin-consent-button).

### <a name="configure-client-credentials"></a>Настройка учетных данных клиента

Приложения, использующие разрешения приложения, проходят проверку подлинности самостоятельно, используя собственные учетные данные, без вмешательства пользователя. Прежде чем приложение (или API) сможет получить доступ к Microsoft Graph, вашему веб-API или другому API с помощью разрешений приложения, необходимо настроить учетные данные клиентского приложения.

Дополнительные сведения о настройке учетных данных приложения см. в разделе [Добавление учетных данных](quickstart-register-app.md#add-credentials) в статье [Краткое руководство. Регистрация приложения с помощью платформы удостоверений Майкрософт](quickstart-register-app.md)

## <a name="more-on-api-permissions-and-admin-consent"></a>Дополнительные сведения о разрешениях API и согласии администратора

Панель **Разрешения API** для регистрации приложения содержит таблицу [Настроенные разрешения](#configured-permissions), а также может содержать таблицу [Другие предоставленные разрешения](#other-permissions-granted). Обе таблицы и [кнопка согласия администратора](#admin-consent-button) описаны в следующих разделах.

### <a name="configured-permissions"></a>Настроенные разрешения

В таблице **Настроенные разрешения** на панели **Разрешения API** отображается список разрешений, необходимых приложению для базовой работы — список *требуемого доступа к ресурсам*. Пользователям или их администраторам необходимо согласиться с этими разрешениями перед использованием приложения. Кроме того, позже во время выполнения могут запрашиваться дополнительные разрешения (с использованием динамического согласия).

Это минимальный список разрешений, которые должны быть предоставлены пользователями вашему приложению. Их может быть больше, но эти всегда будут обязательно. Для обеспечения безопасности и, чтобы помочь пользователям и администраторам комфортнее работать с приложением, не следует запрашивать ничего, что вам не понадобиться.

Разрешения, отображаемые в этой таблице, можно добавить или удалить, выполнив описанные выше действия или указания из раздела [Другие предоставленные разрешения](#other-permissions-granted) (ниже). Администратор может предоставить согласие администратора для всех разрешений API, отображаемых в таблице, и отозвать согласие на индивидуальные разрешения.

### <a name="other-permissions-granted"></a>Другие предоставленные разрешения

Кроме того, вы можете увидеть таблицу **Другие предоставленные разрешения для {имя_вашего_клиента}** на панели **Разрешения API**. В таблице **Другие предоставленные разрешения для {имя_вашего_клиента}** показаны предоставленные клиенту разрешения, которые не были настроены явно на объекте приложения. Для этих разрешений были динамически выполнены запрос и предоставлено согласие. Этот раздел отображается, только если имеется хотя бы одно подходящее разрешение.

Можно добавить полный набор разрешений API или отдельные разрешения, отображаемые в этой таблице, в таблице **Настроенные разрешения**. Администратор может отозвать согласие для API или отдельных разрешений в этом разделе.

### <a name="admin-consent-button"></a>Кнопка согласия администратора

Кнопка **Предоставление согласия администратора для {имя_вашего_клиента}** позволяет администратору предоставить согласие администратора для разрешений, настроенных для приложения. После нажатия кнопки отображается диалоговое окно с запросом на согласие выполнить действие.

:::image type="content" source="media/quickstart-configure-app-access-web-apis/portal-03-grant-admin-consent-button.png" alt-text="Кнопка предоставления согласия администратора выделена на панели настроенных разрешений на портале Azure":::

После предоставления согласия разрешения, для которых необходимо предоставить согласие администратора, показаны как разрешения с предоставленным согласием.

:::image type="content" source="media/quickstart-configure-app-access-web-apis/portal-04-admin-consent-granted.png" alt-text="В таблице &quot;Настройка разрешений&quot; на портале Azure отображается согласие администратора, предоставленное для разрешения Files.Read.All":::

Кнопка **Предоставить согласие администратора** *отключена*, если вы не являетесь администратором или если для приложения не настроены разрешения. Если у вас есть разрешения, которые были предоставлены, но еще не настроены, кнопка согласия администратора поможет вам их обработать. Их можно добавить в настроенные разрешения или удалить.

## <a name="next-steps"></a>Дальнейшие действия

Перейдите к следующему краткому руководству в серии, чтобы узнать, как настроить доступ к приложению для определенных типов учетных записей. Например, вы можете предоставить доступ только пользователям в организации (один арендатор) или разрешить доступ пользователям из других арендаторов Azure AD (несколько арендаторов) и пользователям с личными учетными записями Майкрософт (MSA).

> [!div class="nextstepaction"]
> [Краткое руководство. Изменение учетных записей, поддерживаемых приложением (предварительная версия)](quickstart-modify-supported-accounts.md)
