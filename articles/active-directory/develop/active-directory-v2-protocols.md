---
title: Протоколы OAuth 2,0 и OpenID Connect Connect на платформе Microsoft Identity | Службы
titleSuffix: Microsoft identity platform
description: Рекомендации по протоколам OAuth 2,0 и OpenID Connect Connect, которые поддерживаются платформой Microsoft Identity.
services: active-directory
author: hpsin
manager: CelesteDG
ms.service: active-directory
ms.subservice: develop
ms.workload: identity
ms.topic: conceptual
ms.date: 07/21/2020
ms.author: hirsin
ms.reviewer: hirsin
ms.custom: aaddev
ms.openlocfilehash: 765c363542b07deac44d47b94731e1109fcba045
ms.sourcegitcommit: 910a1a38711966cb171050db245fc3b22abc8c5f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "98755751"
---
# <a name="oauth-20-and-openid-connect-protocols-on-the-microsoft-identity-platform"></a>Протоколы OAuth 2,0 и OpenID Connect Connect на платформе Microsoft Identity

Конечная точка платформы Microsoft Identity для идентификации как услуга реализует проверку подлинности и авторизацию с помощью стандартных протоколов OpenID Connect Connect (OIDC) и OAuth 2,0 соответственно. Хотя эта служба соответствует стандартам, между любыми двумя реализациями этих протоколов могут быть незначительные различия. Сведения в этой статье могут оказаться полезными, если вы планируете писать код с использованием прямой отправки и обработки HTTP-запросов или сторонней библиотеки с открытым кодом вместо одной из наших [библиотек с открытым кодом](reference-v2-libraries.md).

## <a name="the-basics"></a>Основные сведения

Почти во всех потоках обмена данными в OAuth 2.0 и OpenID Connect участвуют четыре стороны.

![Схема, показывающая роли OAuth 2.0](./media/active-directory-v2-flows/protocols-roles.svg)

* **Сервер авторизации** — это платформа Microsoft Identity, которая отвечает за обеспечение удостоверения пользователя, предоставление и отзыв доступа к ресурсам, а также выдачу маркеров. Сервер авторизации также известен как поставщик удостоверений — он безопасно обрабатывает любые действия с информацией пользователя, их доступом и отношениями доверия между сторонами в последовательности.
* **Владелец ресурса** — это, как правило, пользователь. Это сторона, которая владеет данными и обладает возможностями, позволяющими клиентам получать доступ к данным или ресурсам.
* **Клиент OAuth** — это приложение, определяемое идентификатором приложения. Обычно именно с этой стороной взаимодействует конечный пользователь. Клиент OAuth также запрашивает маркеры у сервера авторизации. Владелец ресурса должен предоставить клиенту разрешение на доступ к ресурсу.
* **Сервер ресурсов** — место размещения ресурса или данных. Он позволяет серверу авторизации выполнять безопасную аутентификацию и авторизацию клиента OAuth и использует маркеры доступа носителя, позволяя предоставлять доступ к ресурсу.

## <a name="app-registration"></a>Регистрация приложения

Все приложения, которые должны принимать и персональные, и рабочие или учебные учетные записи, нужно зарегистрировать с помощью **Регистрации приложений** на [портале Azure](https://aka.ms/appregistrations), прежде чем пользователи смогут входить в них с помощью OAuth 2.0 или OpenID Connect. В процессе регистрации для приложения будет собрано и назначено несколько значений.

* **идентификатор приложения**, который определяет конкретное приложение;
* **универсальный код ресурса (URI)** (необязательный), который можно использовать для отправки ответов в приложение;
* Несколько других зависящих от сценария значений.

Дополнительные сведения см. в статье о [регистрации приложения](quickstart-register-app.md).

## <a name="endpoints"></a>Конечные точки

После регистрации приложение взаимодействует с платформой Microsoft Identity, отправляя запросы в конечную точку:

```
https://login.microsoftonline.com/{tenant}/oauth2/v2.0/authorize
https://login.microsoftonline.com/{tenant}/oauth2/v2.0/token
```

Где `{tenant}` может принимать одно из четырех значений:

| Значение | Описание |
| --- | --- |
| `common` | Позволяет пользователям с личными учетными записями Майкрософт и рабочими учетными записями Azure AD выполнять вход в приложение. |
| `organizations` | Позволяет выполнять вход в приложение только пользователям с рабочими учетными записями Azure AD. |
| `consumers` | Позволяет выполнять вход в приложение только пользователям с личными учетными записями Майкрософт. |
| `8eaef023-2b34-4da1-9baa-8bc8c9d6a490` либо `contoso.onmicrosoft.com` | Позволяет выполнять вход в приложение только пользователям с рабочими учетными записями определенного клиента Azure AD. Можно использовать понятное доменное имя клиента Azure AD или идентификатор GUID клиента. |

Чтобы узнать, как взаимодействовать с этими конечными точками, выберите определенный тип приложения в разделе [Протоколы](#protocols) и перейдите по ссылкам для получения дополнительной информации.

> [!TIP]
> Любое приложение, зарегистрированное в Azure AD, может использовать платформу Microsoft Identity, даже если они не входят в личные учетные записи.  Таким образом можно перенести существующие приложения на платформу Microsoft Identity и [MSAL](reference-v2-libraries.md) без повторного создания приложения.

## <a name="tokens"></a>Токены

OAuth 2,0 и OpenID Connect Connect широко используют **токены носителя**, обычно представленные в виде [JWT (веб-маркеры JSON)](https://tools.ietf.org/html/rfc7519). Токен носителя — это упрощенный маркер безопасности, предоставляющий его носителя (предъявителю) доступ к защищенному ресурсу. В этом смысле «Bearer» — это любой, кто получает копию маркера. Хотя сторона должна сначала пройти проверку подлинности на платформе Microsoft Identity, чтобы получить маркер носителя, если необходимые действия не предпринимаются для защиты маркера в передаче и хранении, оно может быть перехвачено и использовано непреднамеренной стороной. Хотя в некоторых маркерах безопасности для предотвращения несанкционированного использования применяется специальный встроенный механизм, в токенах носителя такого механизма нет, и они должны передаваться по защищенному каналу, например с использованием стандарта безопасности транспортного уровня (HTTPS). Если токен носителя передается в незашифрованном виде, злоумышленник может использовать атаку "злоумышленник в середине", чтобы получить токен и использовать его для несанкционированного доступа к защищенному ресурсу. Те же принципы безопасности применяются при сохранении или кэшировании маркеров носителя для последующего использования. Необходимо всегда проверять, что приложение передает и сохраняет токены носителя безопасным образом. Дополнительные сведения о безопасности в случае применения токенов носителя см. в [RFC 6750, раздел 5](https://tools.ietf.org/html/rfc6750).

В OAuth 2,0/OIDC в основном используются три типа токенов:

* [Маркеры доступа](access-tokens.md) — токены, получаемые сервером ресурсов от клиента, содержащие разрешения, предоставленные клиенту.  
* [Токены идентификаторов](id-tokens.md) — токены, которые клиент получает от сервера авторизации, который используется для входа пользователя и получения основных сведений о них.
* Маркеры обновления — используются клиентом для получения новых маркеров доступа и ИДЕНТИФИКАТОРов с течением времени.  Это непрозрачные строки, которые понятны только серверу авторизации.

## <a name="protocols"></a>Протоколы

Если вы готовы просмотреть некоторые примеры запросов, приступайте к работе с одним из следующих протоколов. Каждый из них соответствует определенному сценарию аутентификации. Сведения о том, как выбрать правильный поток, см. в статье о [типах приложений, которые можно создать с помощью платформы удостоверений Майкрософт](v2-app-types.md).

* [Создание мобильных, собственных и веб-приложений с помощью OAuth 2,0](v2-oauth2-auth-code-flow.md)
* [Вход пользователей с помощью OpenID Connect Connect](v2-protocols-oidc.md)
* [Создание управляющих программ или серверных процессов с использованием потока учетных данных клиентов OAuth 2.0](v2-oauth2-client-creds-grant-flow.md)
* [Получение маркеров в веб-API с помощью последовательности OAuth 2.0 On-Behalf-Of](v2-oauth2-on-behalf-of-flow.md)
* [Создание одностраничных приложений с помощью неявного потока OAuth 2,0](v2-oauth2-implicit-grant-flow.md)
