---
title: Конфигурация клиентского приложения (MSAL) | Службы
titleSuffix: Microsoft identity platform
description: Сведения о параметрах конфигурации для общедоступных клиентов и конфиденциальных клиентских приложений с помощью библиотеки проверки подлинности Майкрософт (MSAL).
services: active-directory
author: mmacy
manager: CelesteDG
ms.service: active-directory
ms.subservice: develop
ms.topic: conceptual
ms.workload: identity
ms.date: 11/20/2020
ms.author: marsma
ms.reviewer: saeeda
ms.custom: aaddev
ms.openlocfilehash: 46626c3ebe9d70600be1cc5f73c43677f67bcd09
ms.sourcegitcommit: 3c3ec8cd21f2b0671bcd2230fc22e4b4adb11ce7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/25/2021
ms.locfileid: "98761374"
---
# <a name="application-configuration-options"></a>Параметры конфигурации приложения

Для проверки подлинности и получения маркеров в коде инициализируется новое общедоступное или конфиденциальное клиентское приложение. При инициализации клиентского приложения в библиотеке проверки подлинности Майкрософт (MSAL) можно задать несколько параметров конфигурации. Эти параметры делятся на две группы:

- Параметры регистрации, включая:
  - [Центр](#authority) (состоящий из [экземпляра](#cloud-instance) поставщика удостоверений и [аудитории](#application-audience) для входа в приложение и, возможно, идентификатор клиента)
  - [Идентификатор клиента](#client-id)
  - [URI перенаправления](#redirect-uri)
  - [Секрет клиента](#client-secret) (для конфиденциальных клиентских приложений)
- [Параметры ведения журнала](#logging), в том числе уровень ведения журнала, Управление личными данными и имя компонента с помощью библиотеки

## <a name="authority"></a>Authority

Центр — это URL-адрес, указывающий каталог, из которого MSAL может запрашивать маркеры.

Общие центры:

| Общие URL-адреса центра сертификации | Назначение |
|--|--|
| `https://login.microsoftonline.com/<tenant>/` | Вход пользователей только в определенной организации. `<tenant>`В URL-адресе это идентификатор клиента Azure Active Directory (Azure AD) или его домена клиента. |
| `https://login.microsoftonline.com/common/` | Вход пользователей с рабочими и учебными учетными записями или личными учетными записями Майкрософт. |
| `https://login.microsoftonline.com/organizations/` | Войдите в систему пользователей с рабочими и учебными учетными записями. |
| `https://login.microsoftonline.com/consumers/` | Вход пользователей только с личной учетной записью Майкрософт (MSA). |

Центр, указанный в коде, должен соответствовать **поддерживаемым типам учетных записей** , указанным для приложения в **Регистрация приложений** в портал Azure.

Центр может иметь следующие права:

- Облачный центр Azure AD.
- Центр Azure AD B2C. См. раздел [особенности B2C](https://github.com/AzureAD/microsoft-authentication-library-for-dotnet/wiki/AAD-B2C-specifics).
- Центр службы федерации Active Directory (AD FS) (AD FS). См. раздел [поддержка AD FS](https://aka.ms/msal-net-adfs-support).

Облачные центры Azure AD состоит из двух частей:

- *Экземпляр* поставщика удостоверений
- *Аудитория* входа для приложения

Экземпляр и аудиторию можно объединить и предоставить в качестве URL-адреса центра сертификации. На этой схеме показано, как состоит URL-адрес центра:

![Как состоит URL-адрес центра](media/msal-client-application-configuration/authority.png)

## <a name="cloud-instance"></a>Облачный экземпляр

*Экземпляр* используется для указания того, подписывает ли приложение пользователей из общедоступного облака Azure или из национальных облаков. Используя MSAL в коде, вы можете задать экземпляр облака Azure с помощью перечисления или передать URL-адрес в [Национальный облачный экземпляр](authentication-national-cloud.md#azure-ad-authentication-endpoints) в качестве `Instance` члена (если это известно).

MSAL.NET выдаст явное исключение, если `Instance` указаны и, и `AzureCloudInstance` .

Если экземпляр не указан, приложение будет ориентироваться на экземпляр общедоступного облака Azure (экземпляр URL-адреса `https://login.onmicrosoftonline.com` ).

## <a name="application-audience"></a>Аудитория приложения

Аудитория входа зависит от бизнес-потребностей вашего приложения:

- Если вы являетесь бизнес-разработчиком (LOB), возможно, вы создадите приложение с одним клиентом, которое будет использоваться только в вашей организации. В этом случае необходимо указать организацию по ее ИДЕНТИФИКАТОРу клиента (ИДЕНТИФИКАТОРу экземпляра Azure AD) или доменному имени, связанному с экземпляром Azure AD.
- Если вы являетесь независимым поставщиком программного обеспечения, вам может потребоваться войти в систему пользователей с помощью рабочих и учебных учетных записей в любой организации или в некоторых организациях (многоклиентское приложение). Но вам также может потребоваться войти в систему с помощью личных учетных записей Майкрософт.

### <a name="how-to-specify-the-audience-in-your-codeconfiguration"></a>Как указать аудиторию в коде или конфигурации

Используя MSAL в коде, вы указываете аудиторию, используя одно из следующих значений:

- Перечисление аудитории центра Azure AD
- Идентификатор клиента, который может быть следующим:
  - Идентификатор GUID (идентификатор вашего экземпляра Azure AD) для приложений с одним клиентом.
  - Доменное имя, связанное с экземпляром Azure AD (также для приложений с одним клиентом).
- Один из этих заполнителей в качестве идентификатора клиента вместо перечисления аудитории центра Azure AD:
  - `organizations` для многоклиентского приложения
  - `consumers` Вход пользователей только с помощью личных учетных записей
  - `common` Вход пользователей с помощью рабочих и учебных учетных записей или их личных учетных записей Майкрософт

MSAL выдаст осмысленное исключение, если указать как аудиторию центра Azure AD, так и идентификатор клиента.

Если вы не укажете аудиторию, приложение будет ориентироваться на Azure AD и личные учетные записи Майкрософт в качестве аудитории. (То есть он будет вести себя так, как будто `common` были указаны.)

### <a name="effective-audience"></a>Эффективная аудитория

Действующая аудитория для вашего приложения будет минимальной (если есть пересечение) аудитории, заданной в приложении, и аудиторией, указанной в регистрации приложения. Фактически [Регистрация приложений](https://aka.ms/appregistrations) возможности позволяют указать аудиторию (поддерживаемые типы учетных записей) для приложения. Дополнительные сведения см. [в разделе Краткое руководство. Регистрация приложения на платформе Microsoft Identity](quickstart-register-app.md).

В настоящее время для входа в приложение только для пользователей с личными учетными записями Майкрософт достаточно настроить оба этих параметра:

- Задайте для аудитории регистрации приложений значение `Work and school accounts and personal accounts` .
- Задайте для аудитории в коде или конфигурации значение `AadAuthorityAudience.PersonalMicrosoftAccount` (или `TenantID` = "потребители").

## <a name="client-id"></a>Идентификатор клиента

Идентификатор клиента — уникальный идентификатор приложения (клиента), назначенный приложению Azure AD при регистрации приложения.

## <a name="redirect-uri"></a>URI перенаправления

URI перенаправления — это универсальный код ресурса (URI), по которому поставщик удостоверений отправляет маркеры безопасности обратно.

### <a name="redirect-uri-for-public-client-apps"></a>URI перенаправления для общедоступных клиентских приложений

Если вы являетесь общедоступным клиентским приложением-разработчиком, использующим MSAL:

- Вы хотите использовать `.WithDefaultRedirectUri()` в приложениях для настольных компьютеров или UWP (MSAL.NET 4.1 +). Этот метод задаст свойству URI перенаправления общедоступного клиентского приложения значение рекомендуемого URI перенаправления по умолчанию для общедоступных клиентских приложений.

  | Платформа | URI перенаправления |
  |--|--|
  | Классическое приложение (FW .NET) | `https://login.microsoftonline.com/common/oauth2/nativeclient` |
  | UWP | значение `WebAuthenticationBroker.GetCurrentApplicationCallbackUri()` . Это позволяет осуществлять единый вход с браузером, присвоив значение результату Вебаусентикатионброкер. Жеткуррентаппликатионкаллбаккури (), который необходимо зарегистрировать. |
  | .NET Core | `https://localhost`. Это позволяет пользователю использовать системный браузер для интерактивной проверки подлинности, так как .NET Core в данный момент не имеет пользовательского интерфейса для встроенного веб-представления. |

- Вам не нужно добавлять URI перенаправления при создании приложения Xamarin Android и iOS, которое не поддерживает брокер (универсальный код ресурса (URI) перенаправления автоматически устанавливается в `msal{ClientId}://auth` для Xamarin Android и iOS

- URI перенаправления необходимо настроить в [Регистрация приложений](https://aka.ms/appregistrations):

   ![URI перенаправления в Регистрация приложений](media/msal-client-application-configuration/redirect-uri.png)

URI перенаправления можно переопределить с помощью `RedirectUri` Свойства (например, при использовании брокеров). Ниже приведены некоторые примеры URI перенаправления для этого сценария.

- `RedirectUriOnAndroid` = "msauth-5a434691-CCB2-4fd1-b97b-b64bcfbc03fc://ком.Микрософт.идентити.клиент.сампле";
- `RedirectUriOnIos` = $ "msauth. {Пучок. ID}://АУС ";

Дополнительные сведения о iOS см. в статье [Перенос приложений iOS, использующих Microsoft Authenticator из ADAL.NET в MSAL.NET и использование](msal-net-migration-ios-broker.md) [брокера в iOS](https://github.com/AzureAD/microsoft-authentication-library-for-dotnet/wiki/Leveraging-the-broker-on-iOS).
Дополнительные сведения о Android см. [в разделе Проверка подлинности через посредника в Android](msal-android-single-sign-on.md).

### <a name="redirect-uri-for-confidential-client-apps"></a>URI перенаправления для конфиденциальных клиентских приложений

Для веб-приложений URI перенаправления (или URL-адрес ответа) — это универсальный код ресурса (URI), который Azure AD будет использовать для отправки маркера обратно в приложение. Этот универсальный код ресурса (URI) может быть URL веб-приложения или веб-API, если конфиденциальное приложение является одним из указанных. URI перенаправления должен быть зарегистрирован в регистрации приложения. Эта регистрация особенно важна при развертывании приложения, изначально протестированного локально. Затем необходимо добавить URL-адрес ответа развернутого приложения на портале регистрации приложений.

Для приложений управляющей программы не нужно указывать URI перенаправления.

## <a name="client-secret"></a>Секрет клиента

Этот параметр указывает секрет клиента для конфиденциального клиентского приложения. Этот секрет (пароль приложения) предоставляется порталом регистрации приложений или предоставляется Azure AD во время регистрации приложения с помощью PowerShell AzureAD, PowerShell AzureRM или Azure CLI.

## <a name="logging"></a>Ведение журнала
Для упрощения отладки и устранения ошибок проверки подлинности в библиотеке проверки подлинности Майкрософт предусмотрена встроенная поддержка ведения журнала. Ведение журнала — каждая библиотека рассматривается в следующих статьях:

:::row:::
    :::column:::
        - [Ведение журнала в MSAL.NET](msal-logging-dotnet.md)
        - [Ведение журналов в MSAL для Android](msal-logging-android.md)
        - [Ведение журнала в MSAL.js](msal-logging-js.md)
    :::column-end:::
    :::column:::
        - [Вход в MSAL для iOS или macOS](msal-logging-ios.md)
        - [Вход в MSAL для Java](msal-logging-java.md)
        - [Ведение журналов в MSAL для Python](msal-logging-python.md)
    :::column-end:::
:::row-end:::

## <a name="next-steps"></a>Дальнейшие действия

Сведения о [создании экземпляров клиентских приложений](msal-net-initializing-client-applications.md) с помощью MSAL.NET и [создании экземпляров клиентских приложений с помощью MSAL.js](msal-js-initializing-client-applications.md).
