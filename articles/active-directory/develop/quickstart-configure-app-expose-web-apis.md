---
title: Краткое руководство. Регистрация и предоставление веб-API | Azure
titleSuffix: Microsoft identity platform
description: В этом кратком руководстве вы зарегистрируете веб-API с помощью платформы удостоверений Майкрософт и настроите его области, предоставляя клиентам доступ к ресурсам API на основе разрешений.
services: active-directory
author: mmacy
manager: CelesteDG
ms.service: active-directory
ms.subservice: develop
ms.topic: quickstart
ms.workload: identity
ms.date: 09/03/2020
ms.author: marsma
ms.custom: aaddev, contperf-fy21q1
ms.reviewer: aragra, lenalepa, sureshja
ms.openlocfilehash: 820bc7dfe9123db495c151cd5cd0ea5ae337619f
ms.sourcegitcommit: 126ee1e8e8f2cb5dc35465b23d23a4e3f747949c
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/10/2021
ms.locfileid: "100103980"
---
# <a name="quickstart-configure-an-application-to-expose-a-web-api"></a>Краткое руководство. Настройка приложения для предоставления веб-API

В этом кратком руководстве вы зарегистрируете веб-API с помощью платформы удостоверений Майкрософт и предоставите его клиентским приложениям, добавив пример области. Зарегистрировав веб-API и предоставив к нему доступ через области, вы можете дать доступ к его ресурсам на основе разрешений полномочным пользователям и клиентским приложениям, обращающимся к API.

## <a name="prerequisites"></a>Предварительные требования

* Учетная запись Azure с активной подпиской. [Создайте бесплатную учетную запись](https://azure.microsoft.com/free/?WT.mc_id=A261C142F).
* Завершение [краткого руководства по настройке клиента](quickstart-create-new-tenant.md).

## <a name="register-the-web-api"></a>Регистрация веб-API

Чтобы предоставить в вашем веб-API доступ к ресурсам по областям, сначала необходимо зарегистрировать API с помощью платформы удостоверений Майкрософт.

1. Выполните действия, описанные в разделе **Регистрация приложения** [краткого руководства по регистрации приложения с помощью платформы удостоверений Майкрософт](quickstart-register-app.md).
1. Пропустите разделы **Добавление URI перенаправления** и **Настройка параметров платформы**. Вам не нужно настраивать URI перенаправления для веб-API, так как пользователи не входят в систему в интерактивном режиме.
1. Пропустите пока раздел **Добавление учетных данных**. Если бы ваш API обращался к нисходящему API, ему понадобились бы собственные учетные данные. Такой сценарий не рассматривается в этой статье.

Зарегистрировав веб-API, вы можете добавлять области, которые код API может использовать для предоставления детализированных разрешений для потребителей API.

## <a name="add-a-scope"></a>Добавление области

Код в клиентском приложении запрашивает разрешение на выполнение операций, определенных веб-API, передавая маркер доступа вместе с его запросами к защищенному ресурсу (веб-API). Затем веб-API выполняет запрошенную операцию, только если полученный маркер доступа содержит области, необходимые для операции.

Для начала выполните указанные ниже действия, чтобы создать пример области с именем `Employees.Read.All`:

1. Войдите на <a href="https://portal.azure.com/" target="_blank">портал Azure</a>.
1. Если у вас есть доступ к нескольким клиентам, в верхнем меню используйте фильтр **Каталог и подписка** :::image type="icon" source="./media/quickstart-configure-app-expose-web-apis/portal-01-directory-subscription-filter.png" border="false":::, чтобы выбрать клиент, содержащий регистрацию клиентского приложения.
1. Выберите **Azure Active Directory** > **Регистрация приложений**, а затем — регистрацию приложения API.
1. Выберите **Предоставление API** > **Добавить группу**.

    :::image type="content" source="media/quickstart-configure-app-expose-web-apis/portal-02-expose-api.png" alt-text="Панель &quot;Предоставление API&quot; регистрации приложения на портале Azure":::

1. Вам будет предложено задать **URI идентификатора приложения**, если он еще не настроен.

   URI идентификатора приложения выступает в качестве префикса для областей, на которые вы будете ссылаться в коде API, и должен быть глобально уникальным. Вы может использовать значение по умолчанию в форме `api://<application-client-id>` или указать более удобный для чтения универсальный код ресурса (URI), например `https://contoso.com/api`.

1. Затем укажите атрибуты области на панели **Добавить группу**. В этом пошаговом руководстве вы можете использовать примеры значений или указать собственные.

    | Поле | Описание | Пример |
    |-------|-------------|---------|
    | **Имя области** | Имя вашей области. Соглашение об именовании общей области — `resource.operation.constraint`. | `Employees.Read.All` |
    | **Кто может давать согласие** | Выберите, могут ли пользователи предоставлять согласие этой области или требуется согласие администратора. Выберите **Admins only** (Только администраторы) для более высокого уровня разрешений. | **Администраторы и пользователи** |
    | **Отображаемое имя согласия администратора** | Краткое описание назначения области, которое будут видеть только администраторы. | `Read-only access to Employee records` |
    | **Описание согласия администратора** | Более детальное описание предоставленного областью разрешения, которое будут видеть только администраторы. | `Allow the application to have read-only access to all Employee data.` |
    | **Отображаемое имя согласия пользователя** | Краткое описание назначения области. Отображается для пользователей, только если вы задали для параметра **Кто может давать согласие** значение **Admins and users** (Администраторы и пользователи). | `Read-only access to your Employee records` |
    | **Описание согласия пользователя** | Более детальное описание предоставленного областью разрешения. Отображается для пользователей, только если вы задали для параметра **Кто может давать согласие** значение **Admins and users** (Администраторы и пользователи). | `Allow the application to have read-only access to your Employee data.` |

1. Задайте параметру **Состояние** значение **Включено**, а затем выберите **Добавить область**.

1. (Необязательно.) Чтобы отключить запрос согласия пользователей вашего приложения к определенным областям, можно выполнить *предварительную авторизацию* клиентского приложения для доступа к веб-API. Выполните предварительную авторизацию *только* тех клиентских приложений, которым вы доверяете, так как у пользователей не будет возможности отклонить согласие.
    1. В разделе **Авторизованные клиентские приложения** выберите **Добавить клиентское приложение**.
    1. Введите **идентификатор приложения (клиента)** , для которого хотите выполнить предварительную авторизацию. Например веб-приложение, которое вы зарегистрировали ранее.
    1. В разделе **Авторизованные области** выберите области, для которых необходимо отключить запрос согласия, а затем щелкните **Добавить приложение**.

    Если вы выполнили необязательный шаг, клиентское приложение теперь является предварительно авторизованным (PCA) и пользователи не получат запрос на согласие при выполнении входа.

## <a name="add-a-scope-requiring-admin-consent"></a>Добавление области, требующей согласие администратора

Затем добавьте еще один пример области с именем `Employees.Write.All`, для которого могут предоставлять согласие только администраторы. Области, требующие согласия администратора, обычно используются для предоставления доступа к операциям с более высоким уровнем привилегий. Они также часто используются клиентскими приложениями, которые работают как серверные службы или управляющие программы, которые не поддерживают вход пользователя в интерактивном режиме.

Чтобы добавить пример области `Employees.Write.All`, выполните действия из раздела [Добавление области](#add-a-scope) и укажите эти значения на панели **Добавить группу**:

| Поле                          | Пример значения                                                      |
|--------------------------------|--------------------------------------------------------------------|
| **Имя области**                 | `Employees.Write.All`                                              |
| **Кто может давать согласие**            | **Admins only** (Только администраторы)                                                    |
| **Отображаемое имя согласия администратора** | `Write access to Employee records`                                 |
| **Описание согласия администратора**  | `Allow the application to have write access to all Employee data.` |
| **Отображаемое имя согласия пользователя**  | *Нет (оставить пустым)*                                               |
| **Описание согласия пользователя**   | *Нет (оставить пустым)*                                               |

## <a name="verify-the-exposed-scopes"></a>Проверка предоставленных областей

Если вы успешно добавили оба примера областей, описанные в предыдущих разделах, они отобразятся в области **Предоставление API** регистрации приложения веб-API, как показано на следующем рисунке:

:::image type="content" source="media/quickstart-configure-app-expose-web-apis/portal-03-scopes-list.png" alt-text="Снимок экрана: панели &quot;Предоставление API&quot; с двумя предоставленными областями.":::

Как показано на рисунке, полной строкой области является объединение **URI идентификатора приложения** веб-API и **имени области**.

Например, если URI идентификатора приложения веб-API является `https://contoso.com/api`, а именем области — `Employees.Read.All`, полная область будет выглядеть так:

`https://contoso.com/api/Employees.Read.All`

## <a name="using-the-exposed-scopes"></a>Использование предоставленных областей

В следующей статье этой серии вы настроите регистрацию клиентского приложения с доступом к своему веб-API и областям, определенным вами в этой статье.

После того как для регистрации клиентского приложения предоставлено разрешение на доступ к веб-API, клиенту может быть выдан маркер доступа OAuth 2.0 платформы удостоверений Майкрософт. Во время вызова веб-API клиент предоставляет маркер доступа с утверждением области (`scp`), для которого заданы разрешения, указанные в регистрации клиентского приложения.

Позднее вы можете по мере необходимости предоставлять дополнительные области доступа. Помните о том, что веб-API может предоставлять несколько областей, связанных с рядом операций. Ресурс может управлять доступом к веб-API в среде выполнения, вычисляя утверждения области (`scp`) в полученном маркере доступа OAuth 2.0.

## <a name="next-steps"></a>Дальнейшие действия

Теперь, когда вы предоставили свой веб-API, настроив его области, выполните настройку регистрации клиентского приложения с разрешением на доступ к этим областям.

> [!div class="nextstepaction"]
> [Краткое руководство. Настройка клиентского приложения для доступа к веб-API](quickstart-configure-app-access-web-apis.md)

<!-- REF LINKS -->
[ms-graph-application]: /graph/api/resources/application
