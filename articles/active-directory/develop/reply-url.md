---
title: Ограничения URI перенаправления (URL-адрес ответа) | Службы
titleSuffix: Microsoft identity platform
description: Описание ограничений и ограничений в формате URI перенаправления (URL-адрес ответа), принудительно применяемый платформой Microsoft Identity.
author: SureshJa
ms.author: sureshja
manager: CelesteDG
ms.date: 11/23/2020
ms.topic: conceptual
ms.subservice: develop
ms.custom: aaddev
ms.service: active-directory
ms.reviewer: marsma, lenalepa, manrath
ms.openlocfilehash: 91df89a69368056c1967e641562cf8515f44ade0
ms.sourcegitcommit: 2817d7e0ab8d9354338d860de878dd6024e93c66
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/05/2021
ms.locfileid: "99582814"
---
# <a name="redirect-uri-reply-url-restrictions-and-limitations"></a>Ограничения URI перенаправления (URL-адрес ответа)

URI перенаправления или URL-адрес ответа — это расположение, в котором сервер авторизации отправляет пользователя после успешной авторизации приложения и предоставления ему кода авторизации или маркера доступа. Сервер авторизации отправляет код или маркер в универсальный код ресурса (URI) перенаправления, поэтому важно зарегистрировать правильное расположение в рамках процесса регистрации приложения.

 На URI перенаправления налагаются следующие ограничения.

* URI перенаправления должен начинаться со схемы `https` . Существуют некоторые [исключения для](#localhost-exceptions) URI перенаправления localhost.

* В URI перенаправления учитывается регистр. Его регистр должен соответствовать регистру URL-пути выполняющегося приложения. Например, если приложение включает в себя часть пути `.../abc/response-oidc` , не указывайте `.../ABC/response-oidc` в URI перенаправления. Так как веб-браузер обрабатывает пути с учетом регистра, файлы cookie, связанные с `.../abc/response-oidc`, могут быть исключены при перенаправлении на не совпадающий по регистру знаков URL-адрес `.../ABC/response-oidc`.

## <a name="maximum-number-of-redirect-uris"></a>Максимальное число URI перенаправления

В этой таблице показано максимальное число URI перенаправления, которые можно добавить в регистрацию приложения на платформе Microsoft Identity.

| Учетные записи для входа | Максимальное число URI перенаправления | Описание |
|--------------------------|---------------------------------|-------------|
| Рабочие или учебные учетные записи Майкрософт в клиенте Azure Active Directory (Azure AD) любой организации | 256 | Для поля `signInAudience` в манифесте приложения установлено *AzureADMyOrg* или *AzureADMultipleOrgs* |
| Личные учетные записи Майкрософт и рабочие и учебные учетные записи | 100 | Для поля `signInAudience` в манифесте приложения установлено *AzureADandPersonalMicrosoftAccount* |

## <a name="maximum-uri-length"></a>Максимальная длина URI

Для каждого URI перенаправления, добавляемого в регистрацию приложения, можно использовать не более 256 символов.

## <a name="supported-schemes"></a>Поддерживаемые схемы

Модель приложения Azure Active Directory (Azure AD) в настоящее время поддерживает как схемы HTTP, так и HTTPS для приложений, которые входят в рабочие или учебные учетные записи в клиенте Azure AD Организации. Эти типы учетных записей задаются `AzureADMyOrg` `AzureADMultipleOrgs` значениями и в `signInAudience` поле манифеста приложения. Для приложений, которые входят в личные учетные записи Майкрософт (MSA) *, рабочие и* учебные учетные записи (то есть `signInAudience` для параметра задано значение `AzureADandPersonalMicrosoftAccount` ), разрешена только схема HTTPS.

Чтобы добавить URI перенаправления с помощью схемы HTTP в регистрации приложений, которые входят в рабочие или учебные учетные записи, используйте редактор манифеста приложения в [Регистрация приложений](https://go.microsoft.com/fwlink/?linkid=2083908) в портал Azure. Однако, хотя можно задать URI перенаправления на основе HTTP с помощью редактора манифестов, *настоятельно* рекомендуется использовать схему HTTPS для URI перенаправления.

## <a name="localhost-exceptions"></a>Исключения localhost

В соответствии с [разделом RFC 8252, разделами 8,3](https://tools.ietf.org/html/rfc8252#section-8.3) и [7,3](https://tools.ietf.org/html/rfc8252#section-7.3), "замыкание на себя" или "localhost" перенаправлением являются два особых замечания:

1. `http` Схемы URI приемлемы, поскольку перенаправление никогда не покидает устройство. Таким образом, оба этих URI являются приемлемыми:
    - `http://localhost/myApp`
    - `https://localhost/myApp`
1. Из-за временных диапазонов портов, часто используемых собственными приложениями, компонент порта (например, `:5001` или `:443` ) игнорируется в целях сопоставления URI перенаправления. В результате все эти URI считаются эквивалентными:
    - `http://localhost/MyApp`
    - `http://localhost:1234/MyApp`
    - `http://localhost:5000/MyApp`
    - `http://localhost:8080/MyApp`

С точки зрения разработки это означает несколько моментов:

* Не регистрировать несколько URI перенаправления, если только порт отличается. Сервер входа будет выбирать один произвольным образом и использовать поведение, связанное с этим URI перенаправления (например, является ли это `web` `native` перенаправление "-,-" или `spa` -типом).

    Это особенно важно, если вы хотите использовать разные потоки проверки подлинности в одной регистрации приложения, например, как предоставление кода авторизации, так и неявный поток. Чтобы связать правильное поведение ответа с каждым URI перенаправления, сервер входа должен иметь возможность различать URI перенаправления и не может сделать это, если только порт отличается.
* Чтобы зарегистрировать несколько URI перенаправления на localhost для тестирования различных потоков во время разработки, следует отличать их с помощью компонента *пути* URI. Например, `http://localhost/MyWebApp` не соответствует `http://localhost/MyNativeApp` .
* IPv6-адрес замыкания на себя ( `[::1]` ) в настоящее время не поддерживается.

#### <a name="prefer-127001-over-localhost"></a>Предпочитать 127.0.0.1 через localhost

Чтобы предотвратить невозможность нарушения работы приложения с помощью неправильно настроенных брандмауэров или переименованных сетевых интерфейсов, используйте IP-адрес замыкания на себя `127.0.0.1` в URI перенаправления вместо `localhost` . Например, `https://127.0.0.1`.

Однако нельзя использовать текстовое поле **Перенаправление URI** в портал Azure для добавления URI перенаправления на основе замыкания на себя, который использует `http` схему:

:::image type="content" source="media/reply-url/portal-01-no-http-loopback-redirect-uri.png" alt-text="Диалоговое окно с сообщением об ошибке в портал Azure показывает недопустимый URI перенаправления замыкания на себя HTTP":::

Чтобы добавить URI перенаправления, который использует `http` схему с `127.0.0.1` адресом замыкания на себя, в настоящее время необходимо изменить атрибут [реплюрлсвистипе](reference-app-manifest.md#replyurlswithtype-attribute) в [манифесте приложения](reference-app-manifest.md).

## <a name="restrictions-on-wildcards-in-redirect-uris"></a>Ограничения для подстановочных знаков в URI перенаправления

Подстановочные знаки URI `https://*.contoso.com` , например, могут показаться удобными, но их следует избегать из-за особенностей безопасности. Согласно спецификации OAuth 2.0 ([раздел 3.1.2 RFC 6749](https://tools.ietf.org/html/rfc6749#section-3.1.2)), URI конечной точки перенаправления должен быть абсолютным.

Подстановочные знаки URI в настоящее время не поддерживаются в регистрациях приложений, настроенных для входа в личные учетные записи Майкрософт и рабочие или учебные учетные записи. Однако подстановочные знаки URI разрешены для приложений, которые настроены для входа только в рабочие или учебные учетные записи в клиенте Azure AD Организации.

Чтобы добавить URI перенаправления с подстановочными знаками в регистрации приложений, которые входят в рабочие или учебные учетные записи, используйте редактор манифеста приложения в [Регистрация приложений](https://go.microsoft.com/fwlink/?linkid=2083908) в портал Azure. Хотя можно задать URI перенаправления с подстановочным знаком с помощью редактора манифеста, мы *настоятельно* рекомендуем придерживаться [раздела 3.1.2 RFC 6749](https://tools.ietf.org/html/rfc6749#section-3.1.2) и использовать только абсолютные URI.

Если для сценария требуется больше URI перенаправления, чем разрешено, рассмотрите следующий [подход к параметру состояния](#use-a-state-parameter) вместо добавления URI перенаправления с подстановочным знаком.

#### <a name="use-a-state-parameter"></a>Использование параметра состояния

Если у вас есть несколько поддоменов и сценарий требует, чтобы при успешной проверке подлинности пользователи перенаправлялись на ту же страницу, с которой они начали, может оказаться полезным использование параметра state.

Если вы используете этот подход:

1. Создайте "общий" URI перенаправления для каждого приложения, чтобы обрабатывать маркеры безопасности, полученные от конечной точки авторизации.
1. Приложение может отсылать параметры, зависящие от приложения (например, URL-адрес поддомена, в котором пользователь поступил, или нечто вроде информации о фирменной символике) в параметре state. При использовании параметра состояния необходимо предотвратить защиту CSRF, как указано [в разделе 10.12 стандарта RFC 6749](https://tools.ietf.org/html/rfc6749#section-10.12)).
1. Параметры, зависящие от приложения, будут включать всю информацию, необходимую приложению для корректного отображения для пользователя, то есть для создания соответствующего состояния приложения. Конечная точка авторизации Azure AD удаляет HTML-код из параметра состояния, поэтому не передавайте HTML-содержимое в этом параметре.
1. Когда Azure AD отправляет ответ на общий URI перенаправления, он отправляет параметр состояния обратно в приложение.
1. Затем приложение может использовать значение в параметре состояния, чтобы определить URL-адрес для отправки пользователю. Убедитесь, что вы проверили защиту CSRF.

> [!WARNING]
> Такой подход позволяет скомпрометированному клиенту изменять дополнительные параметры, отправляемые в параметре состояния, поэтому пользователь перенаправляется на другой URL-адрес, что является [угрозой открытого перенаправления](https://tools.ietf.org/html/rfc6819#section-4.2.4), как описано в стандарте RFC 6819. Таким образом, клиент должен защищать эти параметры, шифруя состояние или проверяя его с помощью других средств, таких как проверка доменного имени в URI перенаправления для маркера.

## <a name="next-steps"></a>Следующие шаги

Сведения о [манифесте приложения](reference-app-manifest.md)регистрации приложений.
