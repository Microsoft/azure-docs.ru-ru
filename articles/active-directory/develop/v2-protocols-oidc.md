---
title: Платформа удостоверений Майкрософт и протокол подключения OpenID | Azure
titleSuffix: Microsoft identity platform
description: Создайте веб-приложение, используя реализацию платформы удостоверений Майкрософт с протоколом аутентификации OpenID Connect.
services: active-directory
author: hpsin
manager: CelesteDG
ms.service: active-directory
ms.subservice: develop
ms.workload: identity
ms.topic: conceptual
ms.date: 05/22/2020
ms.author: hirsin
ms.reviewer: hirsin
ms.custom: aaddev, identityplatformtop40
ms.openlocfilehash: de1fcdc259de3f72e35feb411bcc836354352eb4
ms.sourcegitcommit: 5cdd0b378d6377b98af71ec8e886098a504f7c33
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/25/2021
ms.locfileid: "98752586"
---
# <a name="microsoft-identity-platform-and-openid-connect-protocol"></a>Платформа удостоверений Майкрософт и протокол OpenID Connect

OpenID Connect Connect (OIDC) — это протокол проверки подлинности, созданный на основе OAuth 2,0, который можно использовать для безопасного входа пользователя в приложение. При использовании реализации OpenID Connect Connect платформы Microsoft Identity можно добавить доступ к приложениям для входа и API. В этой статье показано, как сделать это независимо от языка и как отправлять и получать сообщения HTTP без использования библиотек с [открытым исходным кодом Майкрософт](reference-v2-libraries.md).

[OpenID Connect Connect](https://openid.net/specs/openid-connect-core-1_0.html) расширяет протокол *авторизации* OAuth 2,0 для использования в качестве протокола *проверки подлинности* , чтобы можно было выполнять единый вход с помощью OAuth. В OpenID Connect вводится понятие *маркера идентификации*, который представляет собой маркер безопасности, позволяющий клиенту проверять личность пользователя. Маркер идентификации также позволяет получить базовые сведения о профиле пользователя. В нем также введена [Конечная точка UserInfo](userinfo.md)— API, возвращающий сведения о пользователе. 


## <a name="protocol-diagram-sign-in"></a>Схема протокола. Вход

На следующей схеме показаны этапы самого простого потока входа. Каждый этап подробно описан в этой статье.

![Протокол OpenID Connect. Вход](./media/v2-protocols-oidc/convergence-scenarios-webapp.svg)

## <a name="fetch-the-openid-connect-metadata-document"></a>Получение документа метаданных OpenID Connect

OpenID Connect Connect описывает документ метаданных [(RFC)](https://openid.net/specs/openid-connect-discovery-1_0.html) , который содержит большую часть сведений, необходимых приложению для входа. Сюда входят такие сведения, как используемые URL-адреса и расположение открытых ключей подписывания службы. Этот документ можно найти, добавив путь к документу обнаружения в URL-адрес центра сертификации:

Путь к документу обнаружения: `/.well-known/openid-configuration`

Авторизации `https://login.microsoftonline.com/{tenant}/v2.0`

`{tenant}` может принимать одно из четырех значений.

| Значение | Описание |
| --- | --- |
| `common` |Пользователи с личной учетной записью Майкрософт и рабочей или учебной учетной записью Azure AD могут выполнять вход в приложение. |
| `organizations` |Вход в приложение могут выполнять только пользователи с рабочими или учебными учетными записями Azure AD. |
| `consumers` |Вход в приложение могут выполнять только пользователи с личной учетной записью Майкрософт. |
| `8eaef023-2b34-4da1-9baa-8bc8c9d6a490` либо `contoso.onmicrosoft.com` | Только пользователи из определенного клиента Azure AD (участники в каталоге с рабочей или учебной учетной записью или гости в каталоге с личной учетной записью Майкрософт) могут выполнить вход в приложение. Можно использовать понятное доменное имя клиента Azure AD или идентификатор GUID клиента. Можно также использовать клиент-потребитель `9188040d-6c67-4c5b-b112-36a304b66dad` (вместо клиента `consumers`).  |

Этот центр отличается в разных национальных облаках, например `https://login.microsoftonline.de` для экземпляра Azure AD для Германии. Если вы не используете общедоступное облако, проверьте [национальные конечные точки национального облака](authentication-national-cloud.md#azure-ad-authentication-endpoints) , чтобы найти подходящий. Убедитесь, что клиент и есть `/v2.0/` в запросе, чтобы можно было использовать версию версии 2.0 конечной точки.

> [!TIP]
> Тестирование Щелкните, [https://login.microsoftonline.com/common/v2.0/.well-known/openid-configuration](https://login.microsoftonline.com/common/v2.0/.well-known/openid-configuration) чтобы просмотреть `common` конфигурацию.

### <a name="sample-request"></a>Пример запроса

Чтобы вызвать конечную точку UserInfo для общих полномочий в общедоступном облаке, используйте следующую команду:

```http
GET /common/v2.0/.well-known/openid-configuration
Host: login.microsoftonline.com
```

### <a name="sample-response"></a>Пример ответа

Метаданные — это простой документ JSON. В качестве примера ниже приведен фрагмент кода. Содержимое полностью описано в [спецификации OpenID Connect Connect](https://openid.net/specs/openid-connect-discovery-1_0.html#rfc.section.4.2).

```json
{
  "authorization_endpoint": "https://login.microsoftonline.com/{tenant}/oauth2/v2.0/authorize",
  "token_endpoint": "https://login.microsoftonline.com/{tenant}/oauth2/v2.0/token",
  "token_endpoint_auth_methods_supported": [
    "client_secret_post",
    "private_key_jwt"
  ],
  "jwks_uri": "https://login.microsoftonline.com/{tenant}/discovery/v2.0/keys",
  "userinfo_endpoint": "https://graph.microsoft.com/oidc/userinfo",
  "subject_types_supported": [
      "pairwise"
  ],
  ...

}
```

Если в приложении есть настраиваемые ключи подписывания в результате использования функции [сопоставления утверждений](active-directory-claims-mapping.md), необходимо добавить параметр запроса `appid`, содержащий идентификатор приложения, чтобы получить `jwks_uri`, указывающий на сведения о ключе подписывания приложения. Например: `https://login.microsoftonline.com/{tenant}/v2.0/.well-known/openid-configuration?appid=6731de76-14a6-49ae-97bc-6eba6914391e` содержит `jwks_uri` для `https://login.microsoftonline.com/{tenant}/discovery/v2.0/keys?appid=6731de76-14a6-49ae-97bc-6eba6914391e`.

Как правило, этот документ метаданных используется для настройки библиотеки OpenID Connect или пакета SDK. Метаданные будут использоваться для работы библиотеки. Однако если вы не используете предварительно созданную библиотеку OpenID Connect Connect, вы можете выполнить действия, описанные в оставшейся части этой статьи, чтобы выполнить вход в веб-приложение с помощью платформы Microsoft Identity.

## <a name="send-the-sign-in-request"></a>Отправка запроса на вход

Если веб-приложению требуется проверить подлинность пользователя, оно может направить его к конечной точке `/authorize` . Этот запрос похож на первый этап [потока кода авторизации OAuth 2.0](v2-oauth2-auth-code-flow.md) с несколькими важными различиями, которые приведены ниже.

* Запрос должен содержать область `openid` в параметре `scope`.
* Параметр `response_type` должен включать `id_token`.
* Запрос должен содержать параметр `nonce` .

> [!IMPORTANT]
> Чтобы успешно выполнить запрос маркера идентификации из конечной точки /authorization, на вкладке "Проверка подлинности" для регистрации приложения на [портале регистрации](https://portal.azure.com) нужно включить неявное предоставление разрешения id_tokens (что устанавливает флаг `oauth2AllowIdTokenImplicitFlow` в [манифесте приложения](reference-app-manifest.md) равным `true`). Если его не включить, возникнет следующая ошибка `unsupported_response`: "The provided value for the input parameter 'response_type' isn't allowed for this client. Expected value is 'code'" (Указанное значение параметра response_type запрещено для данного клиента. Ожидаемое значение: code).

Пример:

```HTTP
// Line breaks are for legibility only.

GET https://login.microsoftonline.com/{tenant}/oauth2/v2.0/authorize?
client_id=6731de76-14a6-49ae-97bc-6eba6914391e
&response_type=id_token
&redirect_uri=http%3A%2F%2Flocalhost%2Fmyapp%2F
&response_mode=form_post
&scope=openid
&state=12345
&nonce=678910
```

| Параметр | Условие | Описание |
| --- | --- | --- |
| `tenant` | Обязательно | Значение `{tenant}` в пути запроса можно использовать для того, чтобы контролировать вход пользователей в приложение. Допустимые значения: `common`, `organizations`, `consumers`, а также идентификаторы клиента. Чтобы узнать больше, ознакомьтесь с [основами протокола](active-directory-v2-protocols.md#endpoints). |
| `client_id` | Обязательно | **Идентификатор приложения (клиента)** , назначенный вашему приложению функцией [Регистрация приложений портала Azure](https://go.microsoft.com/fwlink/?linkid=2083908). |
| `response_type` | Обязательно | Должен включать `id_token` для входа в OpenID Connect. Кроме того, может включать другие значения `response_type`, например `code`. |
| `redirect_uri` | Рекомендуемая | Универсальный код ресурса (URI) перенаправления приложения, на который можно отправлять ответы аутентификации для их получения приложением. Он должен в точности соответствовать одному из универсальных кодов ресурсов (URI) перенаправления, зарегистрированных на портале, но иметь форму URL-адреса. Если он отсутствует, конечная точка будет случайным образом выбирать один зарегистрированный redirect_uri, чтобы отправить обратно пользователю. |
| `scope` | Обязательно | Список областей с разделителями-пробелами. При использовании протокола OpenID Connect он должен содержать область `openid`, что преобразуется в разрешение "Вход" в пользовательском интерфейсе предоставления согласия. Для предоставления согласия этот запрос может также включать в себя другие области. |
| `nonce` | Обязательно | Значение, включенное в запрос и созданное приложением, которое будет добавлено в полученное значение id_token в качестве утверждения. Приложение может проверить это значение во избежание атак с использованием воспроизведения маркера. Как правило, это значение представляет собой случайную уникальную строку, которую можно использовать для определения источника запроса. |
| `response_mode` | Рекомендуемая | Указывает метод, с помощью которого следует отправлять полученный код авторизации приложению. Может иметь значение `form_post` или `fragment`. Для веб-приложений рекомендуется использовать `response_mode=form_post`, чтобы обеспечить наиболее безопасную передачу маркеров в приложение. |
| `state` | Рекомендуемая | Значение, включенное в запрос, которое также возвращается в ответе маркера. Это может быть строка любого содержания. Как правило, с целью [предотвращения подделки межсайтовых запросов](https://tools.ietf.org/html/rfc6749#section-10.12) используется генерируемое случайным образом уникальное значение. Параметр state используется также для кодирования сведений о состоянии пользователя в приложении перед созданием запроса на аутентификацию, например сведений об открытой на тот момент странице или представлении. |
| `prompt` | Необязательно | Указывает требуемый тип взаимодействия с пользователем. На текущий момент единственные допустимые значения — `login`, `none` и `consent`. Утверждение `prompt=login` требует от пользователя ввести учетные данные по запросу. Единый вход не сработает. Утверждение `prompt=none` является противоположным. Оно гарантирует, что для пользователя не будут выводиться интерактивные запросы. Если запрос не может быть выполнен автоматически с помощью единого входа, платформа Microsoft Identity возвращает ошибку. Утверждение `prompt=consent` активирует диалоговое окно предоставления согласия OAuth после входа пользователя в систему. В нем у пользователя запрашиваются разрешения для приложения. |
| `login_hint` | Необязательно | Этот параметр можно применять для предварительного заполнения полей имени пользователя и электронного адреса на странице входа пользователя (если имя пользователя известно заранее). Зачастую этот параметр используется в приложениях при повторной аутентификации. При этом имя пользователя, указанное во время предыдущего входа, извлекается с помощью утверждения `preferred_username`. |
| `domain_hint` | Необязательно | Область пользователя в федеративном каталоге.  Если используется этот параметр, процесс обнаружения на основе электронной почты, который проходит пользователь на странице входа, пропускается, что немного оптимизирует работу. Для клиентов, объединяемых в федерацию на основе локального каталога, например AD FS, это часто позволяет автоматически входить в систему благодаря наличию текущего сеанса. |

На текущем этапе пользователю предлагается ввести учетные данные и завершить аутентификацию. Платформа Microsoft Identity проверяет, что пользователь предоставил разрешения, указанные в `scope` параметре запроса. Если пользователь не предоставил никаких разрешений, платформа удостоверений Майкрософт предлагает пользователю подтвердить необходимые разрешения. Вы можете прочитать дополнительные сведения о [разрешениях, согласии и мультитенантных приложениях](v2-permissions-and-consent.md).

После того как пользователь пройдет проверку подлинности и предоставит согласие, платформа удостоверений Майкрософт возвращает ответ на ваше приложение на указанном URI перенаправления с помощью метода, указанного в `response_mode` параметре.

### <a name="successful-response"></a>Успешный ответ

Успешный ответ при использовании `response_mode=form_post` выглядит следующим образом.

```HTTP
POST /myapp/ HTTP/1.1
Host: localhost
Content-Type: application/x-www-form-urlencoded

id_token=eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6Ik1uQ19WWmNB...&state=12345
```

| Параметр | Описание |
| --- | --- |
| `id_token` | Маркер идентификации, запрошенный приложением. Вы можете использовать параметр `id_token` для проверки личности пользователя и запуска сеанса пользователя. См. дополнительные сведения о маркерах идентификации и их содержимом в [справочнике по `id_tokens`](id-tokens.md). |
| `state` | Если запрос содержит параметр `state`, то в ответе должно отображаться то же значение. Приложение должно проверить, совпадают ли значения параметра "state" в запросе и ответе. |

### <a name="error-response"></a>Сообщение об ошибке

Сообщения об ошибках также можно отправлять на универсальный код ресурса (URI) перенаправления, чтобы приложение могло их обработать. Сообщение об ошибке выглядит следующим образом.

```HTTP
POST /myapp/ HTTP/1.1
Host: localhost
Content-Type: application/x-www-form-urlencoded

error=access_denied&error_description=the+user+canceled+the+authentication
```

| Параметр | Описание |
| --- | --- |
| `error` | Строка кода ошибки, которую можно использовать для классификации типов возникших ошибок и реагирования на них. |
| `error_description` | Конкретное сообщение об ошибке, с помощью которого можно определить первопричину возникновения ошибки аутентификации. |

### <a name="error-codes-for-authorization-endpoint-errors"></a>Коды ошибок конечной точки авторизации

В таблице ниже описаны коды ошибок, которые могут возвращаться в параметре `error` сообщения об ошибке.

| Код ошибки | Описание | Действие клиента |
| --- | --- | --- |
| `invalid_request` | Ошибка протокола, например отсутствует обязательный параметр. |Исправьте запрос и отправьте его повторно. Это ошибка разработки, которая, как правило, обнаруживается во время первоначального тестирования. |
| `unauthorized_client` | Клиентское приложение не может запрашивать код авторизации. |Как правило, это происходит, если клиентское приложение не зарегистрировано в Azure AD или не добавлено в клиент Azure AD пользователя. Приложение может отобразить для пользователя запрос с инструкцией по установке приложения и его добавлению в Azure AD. |
| `access_denied` | Владелец ресурса не дал согласия. |Клиентское приложение может уведомить пользователя, что для продолжения работы необходимо согласие пользователя. |
| `unsupported_response_type` |Сервер авторизации не поддерживает тип ответа в запросе. |Исправьте запрос и отправьте его повторно. Это ошибка разработки, которая, как правило, обнаруживается во время первоначального тестирования. |
| `server_error` | Сервер обнаружил непредвиденную ошибку. |Повторите запрос. Эти ошибки могут возникать в связи с временными условиями. Из клиентского приложения может поступить сообщение о том, что его ответ задерживается из-за временной ошибки. |
| `temporarily_unavailable` | Сервер временно занят и не может обработать запрос. |Повторите запрос. Из клиентского приложения может поступить сообщение о том, что его ответ задерживается из-за временного состояния. |
| `invalid_resource` | Целевой ресурс является недопустимым, так как он не существует. Azure AD не удается найти ресурс, или он настроен неправильно. |Это означает, что ресурс, если он существует, не настроен в клиенте. Приложение может отобразить для пользователя запрос с инструкциями по установке приложения и его добавлению в Azure AD. |

## <a name="validate-the-id-token"></a>Проверка маркера идентификации

Простое получение id_token не всегда достаточно для проверки подлинности пользователя; Вам также может потребоваться проверить подпись id_token и проверить утверждения в маркере на соответствие требованиям приложения. Как и все платформы OIDC, платформа Microsoft Identity использует [токены JSON Web tokens (JWT)](https://tools.ietf.org/html/rfc7519) и шифрование с открытым ключом для подписи маркеров идентификации и проверки их допустимости.

Не все приложения получают преимущества от проверки маркера идентификации — собственных приложений и одностраничных приложений, например, редкое преимущество проверки маркера идентификации.  Пользователь с физическим доступом к устройству (или браузеру) может обходить проверку различными способами — от изменения веб-трафика до устройства, чтобы предоставить фиктивные токены и ключи для простого отладки приложения, чтобы пропустить логику проверки.  С другой стороны, веб-приложения и API, использующие маркер идентификации для авторизации, должны тщательно проверять маркер идентификации, так как они определяют доступ к данным.

После проверки подписи токена id_token вам потребуется проверить несколько утверждений. См. [справочник по `id_token`](id-tokens.md) и дополнительные сведения о [проверке маркеров](id-tokens.md#validating-an-id_token) и [смене ключей подписывания](active-directory-signing-key-rollover.md). Советуем использовать библиотеку для синтаксического анализа и проверки токенов. Для большинства языков и платформ доступна по крайней мере одна такая библиотека.

Вам также может потребоваться проверить дополнительные утверждения в зависимости от сценария. Ниже приведены некоторые из стандартных проверок:

* Обеспечение регистрации пользователя или организации в приложении.
* Предоставление пользователю необходимого уровня авторизации и привилегий.
* Обеспечение определенного уровня аутентификации, например [многофакторной проверки подлинности](../authentication/concept-mfa-howitworks.md).

После полной проверки токена id_token вы можете начать сеанс с пользователем и использовать утверждения в токене id_token для получения сведений о пользователе в приложении. Эти сведения можно использовать для отображения, регистрации, персонализации и т. д.

## <a name="protocol-diagram-access-token-acquisition"></a>Схема протокола. Получение маркера доступа

Многим веб-приложениям требуется не только выполнить вход пользователя, но и получить доступ к веб-службе от имени этого пользователя с помощью OAuth. Этот сценарий совмещает применение OpenID Connect для аутентификации пользователей и одновременное получение кода авторизации, который можно использовать для получения маркеров доступа с помощью потока кода авторизации OAuth.

Полный поток входа OpenID Connect и получения маркера представлен на следующей схеме. Каждый этап подробно описан в следующих разделах статьи.

![Протокол OpenID Connect. Получение маркеров](./media/v2-protocols-oidc/convergence-scenarios-webapp-webapi.svg)

## <a name="get-an-access-token-to-call-userinfo"></a>Получение маркера доступа для вызова UserInfo

Чтобы получить маркер для конечной точки UserInfo OIDC, измените запрос на вход:

```HTTP
// Line breaks are for legibility only.

GET https://login.microsoftonline.com/{tenant}/oauth2/v2.0/authorize?
client_id=6731de76-14a6-49ae-97bc-6eba6914391e        // Your registered Application ID
&response_type=id_token%20token                       // this will return both an id_token and an access token
&redirect_uri=http%3A%2F%2Flocalhost%2Fmyapp%2F       // Your registered redirect URI, URL encoded
&response_mode=form_post                              // 'form_post' or 'fragment'
&scope=openid+profile+email                           // `openid` is required.  `profile` and `email` provide additional information in the UserInfo endpoint the same way they do in an ID token. 
&state=12345                                          // Any value, provided by your app
&nonce=678910                                         // Any value, provided by your app
```

Можно также использовать [поток кода авторизации](v2-oauth2-auth-code-flow.md), [поток кода устройства](v2-oauth2-device-code.md)или [маркер обновления](v2-oauth2-auth-code-flow.md#refresh-the-access-token) вместо того, `response_type=token` чтобы получить маркер для приложения.

> [!TIP]
> Чтобы выполнить этот запрос, щелкните приведенную ниже ссылку. После входа в систему браузер перенаправляется в `https://localhost/myapp/` , с маркером идентификации и маркером в адресной строке. Обратите внимание, что этот запрос используется `response_mode=fragment` только в демонстрационных целях. для webapp мы рекомендуем использовать `form_post` для обеспечения дополнительной безопасности, когда это возможно. 
> <a href="https://login.microsoftonline.com/common/oauth2/v2.0/authorize?client_id=6731de76-14a6-49ae-97bc-6eba6914391e&response_type=id_token%20token&redirect_uri=http%3A%2F%2Flocalhost%2Fmyapp%2F&response_mode=fragment&scope=openid+profile+email&state=12345&nonce=678910" target="_blank">https://login.microsoftonline.com/common/oauth2/v2.0/authorize...</a>

### <a name="successful-token-response"></a>Успешный ответ маркера

Успешный ответ с использованием `response_mode=form_post` выглядит следующим образом.

```HTTP
POST /myapp/ HTTP/1.1
Host: localhost
Content-Type: application/x-www-form-urlencoded
 access_token=eyJ0eXAiOiJKV1QiLCJub25jZSI6I....
 &token_type=Bearer
 &expires_in=3598
 &scope=email+openid+profile
 &id_token=eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI....
 &state=12345
```

Параметры ответа означают одно и то же действие независимо от последовательности, используемой для их получения.

| Параметр | Описание |
| --- | --- |
| `access_token` | Токен, который будет использоваться для вызова конечной точки UserInfo.|
| `token_type` | Всегда является "Bearer" |
| `expires_in`| Время до истечения срока действия маркера доступа в секундах. |
| `scope` | Разрешения, предоставленные маркеру доступа.  Обратите внимание, что так как конечная точка UserInfo размещается в Microsoft Graph, могут отображаться дополнительные области графа (например, пользователь. Read), если они были ранее предоставлены приложению.  Это обусловлено тем, что маркер для данного ресурса всегда включает в себя все разрешения, которые в настоящее время предоставлены клиенту.  |
| `id_token` | Маркер идентификации, запрошенный приложением. Вы можете использовать маркер идентификации для проверки личности пользователя и запуска сеанса пользователя. См. дополнительные сведения о маркерах идентификации и их содержимом в [справочнике по `id_tokens`](id-tokens.md). |
| `state` | Если в запрос включен этот параметр состояния, идентичное значение должно содержаться и в ответе на этот запрос. Приложение должно проверить, совпадают ли значения параметра "state" в запросе и ответе. |

### <a name="error-response"></a>Сообщение об ошибке

Сообщения об ошибках также можно отправлять на универсальный код ресурса (URI) перенаправления, чтобы приложение могло их правильно обработать. Сообщение об ошибке выглядит следующим образом.

```HTTP
POST /myapp/ HTTP/1.1
Host: localhost
Content-Type: application/x-www-form-urlencoded

error=access_denied&error_description=the+user+canceled+the+authentication
```

| Параметр | Описание |
| --- | --- |
| `error` | Строка кода ошибки, которую можно использовать для классификации типов возникших ошибок и реагирования на них. |
| `error_description` | Конкретное сообщение об ошибке, с помощью которого можно определить первопричину возникновения ошибки аутентификации. |

Описание возможных кодов ошибок и рекомендуемые ответы клиента см. в разделе [Коды ошибок конечной точки авторизации](#error-codes-for-authorization-endpoint-errors).

После получения кода авторизации и маркера идентификации можно выполнить вход пользователя в систему и получить маркеры доступа от его имени. Для входа пользователя необходимо проверить маркер идентификации [в точности, как описано выше](id-tokens.md#validating-an-id_token). Для получения маркеров доступа следует выполнить действия, описанные в [документации по потоку кода OAuth](v2-oauth2-auth-code-flow.md#request-an-access-token).

### <a name="calling-the-userinfo-endpoint"></a>Вызов конечной точки UserInfo

Просмотрите [документацию UserInfo](userinfo.md#calling-the-api) , чтобы узнать, как вызвать конечную точку UserInfo с помощью этого маркера.

## <a name="send-a-sign-out-request"></a>Отправка запроса на выход

Для выхода пользователя из приложения недостаточно очистить файлы cookie или каким-то другим образом завершить сеанс пользователя. Необходимо также перенаправить пользователя на платформу Microsoft Identity для выхода. Если этого не сделать, то пользователь повторно выполняет проверку подлинности в приложении без ввода учетных данных, так как у них будет действительный сеанс единого входа с платформой Microsoft Identity.

Можно перенаправить пользователя на адрес, указанный в параметре `end_session_endpoint` в документе метаданных OpenID Connect:

```HTTP
GET https://login.microsoftonline.com/common/oauth2/v2.0/logout?
post_logout_redirect_uri=http%3A%2F%2Flocalhost%2Fmyapp%2F
```

| Параметр | Условие | Описание |
| ----------------------- | ------------------------------- | ------------ |
| `post_logout_redirect_uri` | Рекомендуемая | URL-адрес, на который перенаправляется пользователь после успешного выхода. Если параметр не включен, пользователь показывает общее сообщение, созданное платформой идентификации Майкрософт. URL-адрес должен в точности соответствовать одному из универсальных кодов ресурсов (URI) перенаправления, зарегистрированных для приложения на портале регистрации приложений. |

## <a name="single-sign-out"></a>Единый выход

При перенаправлении пользователя в `end_session_endpoint` платформа Microsoft Identity очищает сеанс пользователя из браузера. Тем не менее пользователь может оставаться вошедшим в другие приложения, использующие учетные записи Майкрософт для аутентификации. Чтобы разрешить этим приложениям одновременный выход пользователя из системы, платформа Microsoft Identity отправляет запрос HTTP GET зарегистрированным `LogoutUrl` приложениям, на которые пользователь вошел в систему. Приложения должны ответить на него, удалив любой сеанс, который идентифицирует пользователя, и возвратив ответ `200`. Для поддержки единого входа в приложении необходимо реализовать `LogoutUrl` в коде приложения. `LogoutUrl` можно задать на портале регистрации приложения.

## <a name="next-steps"></a>Следующие шаги

* Ознакомьтесь с [документацией по UserInfo](userinfo.md)
* Узнайте, как [настроить значения в маркере](active-directory-claims-mapping.md) с помощью данных из локальных систем. 
* Узнайте, как [включить дополнительные стандартные утверждения в токены](active-directory-optional-claims.md).  
