---
title: Руководство по интеграции Azure Active Directory с SAP Cloud Platform | Документация Майкрософт
description: Узнайте, как настроить единый вход Azure Active Directory в SAP Cloud Platform.
services: active-directory
author: jeevansd
manager: CelesteDG
ms.reviewer: celested
ms.service: active-directory
ms.subservice: saas-app-tutorial
ms.workload: identity
ms.topic: tutorial
ms.date: 12/27/2020
ms.author: jeedes
ms.openlocfilehash: b15c5a9f9f1e4e144caa2ddaa36d42a2a225b31b
ms.sourcegitcommit: f6f928180504444470af713c32e7df667c17ac20
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "97964054"
---
# <a name="tutorial-azure-active-directory-integration-with-sap-cloud-platform"></a>Руководство по интеграции Azure Active Directory с SAP Cloud Platform

Из этого руководства вы узнаете, как интегрировать SAP Cloud Platform с Azure Active Directory (Azure AD). Интеграция SAP Cloud Platform с Azure AD обеспечивает следующие возможности:

* Контроль доступа к SAP Cloud Platform с помощью Azure AD.
* Включение автоматического входа пользователей в SAP Cloud Platform с учетными записями Azure AD.
* Централизованное управление учетными записями через портал Azure.

## <a name="prerequisites"></a>Предварительные требования

Чтобы настроить интеграцию Azure AD с SAP Cloud Platform, вам потребуется:

* подписка Azure AD; (если у вас нет среды Azure AD, вы можете получить пробную версию на один месяц по [этой ссылке](https://azure.microsoft.com/pricing/free-trial/));
* Подписка SAP Cloud Platform с поддержкой единого входа

По завершении работы с этим руководством пользователи Azure AD, назначенные SAP Cloud Platform, смогут выполнять единый вход в приложение следуя указаниям в статье [Что такое панель доступа?](../user-help/my-apps-portal-end-user-access.md).

>[!IMPORTANT]
>Для тестирования единого входа необходимо развернуть собственное приложение или оформить подписку на приложение в учетной записи SAP Cloud Platform. В этом учебнике используется развертывание приложения в учетной записи.
> 

## <a name="scenario-description"></a>Описание сценария

В рамках этого руководства вы настроите и проверите единый вход Azure AD в тестовой среде.

* SAP Cloud Platform поддерживает единый вход, инициированный **поставщиком услуг**.

## <a name="adding-sap-cloud-platform-from-the-gallery"></a>Добавление SAP Cloud Platform из коллекции

Чтобы настроить интеграцию SAP Cloud Platform с Azure AD, необходимо добавить SAP Cloud Platform из коллекции в список управляемых приложений SaaS.

1. Войдите на портал Azure с помощью личной учетной записи Майкрософт либо рабочей или учебной учетной записи.
1. В области навигации слева выберите службу **Azure Active Directory**.
1. Перейдите в колонку **Корпоративные приложения** и выберите **Все приложения**.
1. Чтобы добавить новое приложение, выберите **Новое приложение**.
1. В разделе **Добавление из коллекции** в поле поиска введите **SAP Cloud Platform**.
1. Выберите **SAP Cloud Platform** на панели результатов, а затем добавьте приложение. Подождите несколько секунд, пока приложение не будет добавлено в ваш клиент.

## <a name="configure-and-test-azure-ad-sso-for-sap-cloud-platform"></a>Настройка и проверка единого входа Azure AD для SAP Cloud Platform

Настройте и проверьте единый вход Azure AD в SAP Cloud Platform с помощью тестового пользователя **B.Simon**. Для обеспечения единого входа необходимо установить связь между пользователем Azure AD и соответствующим пользователем в SAP Cloud Platform.

Чтобы настроить и проверить единый вход Azure AD в SAP Cloud Platform, выполните следующие действия:

1. **[Настройка единого входа Azure AD](#configure-azure-ad-sso)** необходима, чтобы пользователи могли использовать эту функцию.
    1. **[Создание тестового пользователя Azure AD](#create-an-azure-ad-test-user)** требуется для проверки работы единого входа Azure AD от имени пользователя Britta Simon.
    1. **[Назначение тестового пользователя Azure AD](#assign-the-azure-ad-test-user)** необходимо, чтобы разрешить пользователю Britta Simon использовать единый вход Azure AD.
2. **[Настройка единого входа в SAP Cloud Platform](#configure-sap-cloud-platform-sso)** необходима, чтобы настроить параметры единого входа на стороне приложения.
    1. **[Создание тестового пользователя SAP Cloud Platform](#create-sap-cloud-platform-test-user)** нужно для того, чтобы в SAP Cloud Platform также существовал пользователь Britta Simon, связанный с одноименным пользователем в Azure AD.
1. **[Проверка единого входа](#test-sso)** позволяет убедиться в правильности конфигурации.

### <a name="configure-azure-ad-sso"></a>Настройка единого входа Azure AD

Выполните следующие действия, чтобы включить единый вход Azure AD на портале Azure.

1. На портале Azure на странице интеграции с приложением **SAP Cloud Platform** найдите раздел **Управление** и выберите элемент **Единый вход**.
1. На странице **Выбрать метод единого входа** выберите **SAML**.
1. На странице **Настройка единого входа с помощью SAML** щелкните значок карандаша, чтобы открыть диалоговое окно **Базовая конфигурация SAML** для изменения параметров.

   ![Изменение базовой конфигурации SAML](common/edit-urls.png)

1. На странице **Базовая конфигурация SAML** введите значения следующих полей.

    ![Сведения о домене и URL-адресах единого входа для приложения SAP Cloud Platform](common/sp-identifier-reply.png)

    а. В текстовом поле **URL-адрес входа** введите URL-адрес, который пользователи используют для входа в приложение **Sign On URL**. Это URL-адрес защищенного ресурса для конкретной учетной записи в приложении SAP Cloud Platform. URL-адрес имеет следующий формат: `https://<applicationName><accountName>.<landscape host>.ondemand.com/<path_to_protected_resource>`.
      
    >[!NOTE]
    >Это URL-адрес в приложении SAP Cloud Platform, запрашивающий аутентификацию пользователя.
    > 

    - `https://<subdomain>.hanatrial.ondemand.com/<instancename>`
    - `https://<subdomain>.hana.ondemand.com/<instancename>`

    b. В текстовом поле **Идентификатор** укажите URL-адрес SAP Cloud Platform в одном из следующих форматов: 

    - `https://hanatrial.ondemand.com/<instancename>`
    - `https://hana.ondemand.com/<instancename>`
    - `https://us1.hana.ondemand.com/<instancename>`
    - `https://ap1.hana.ondemand.com/<instancename>`

    c. В текстовом поле **URL-адрес ответа** введите URL-адрес в следующем формате: .

    - `https://<subdomain>.hanatrial.ondemand.com/<instancename>`
    - `https://<subdomain>.hana.ondemand.com/<instancename>`
    - `https://<subdomain>.us1.hana.ondemand.com/<instancename>`
    - `https://<subdomain>.dispatcher.us1.hana.ondemand.com/<instancename>`
    - `https://<subdomain>.ap1.hana.ondemand.com/<instancename>`
    - `https://<subdomain>.dispatcher.ap1.hana.ondemand.com/<instancename>`
    - `https://<subdomain>.dispatcher.hana.ondemand.com/<instancename>`

    > [!NOTE] 
    > Эти значения приведены для примера. Укажите вместо них фактические значения URL-адреса для входа, идентификатора и URL-адреса ответа. Чтобы получить URL-адрес входа и идентификатор, обратитесь к [службе поддержки клиентов SAP Cloud Platform](https://help.sap.com/viewer/65de2977205c403bbc107264b8eccf4b/Cloud/5dd739823b824b539eee47b7860a00be.html). URL-адрес ответа можно получить в разделе управления доверием, который рассматривается далее в этом руководстве.
    > 
4. На странице **Настройка единого входа с помощью SAML** в разделе **Сертификат подписи SAML** щелкните **Скачать**, чтобы скачать нужный вам **XML метаданных федерации**, и сохраните его на компьютере.

    ![Ссылка для скачивания сертификата](common/metadataxml.png)

### <a name="create-an-azure-ad-test-user"></a>Создание тестового пользователя Azure AD

В этом разделе описано, как на портале Azure создать тестового пользователя с именем B.Simon.

1. На портале Azure в области слева выберите **Azure Active Directory**, **Пользователи**, а затем — **Все пользователи**.
1. В верхней части экрана выберите **Новый пользователь**.
1. В разделе **Свойства пользователя** выполните следующие действия.
   1. В поле **Имя** введите `B.Simon`.  
   1. В поле **Имя пользователя** введите username@companydomain.extension. Например, `B.Simon@contoso.com`.
   1. Установите флажок **Показать пароль** и запишите значение, которое отображается в поле **Пароль**.
   1. Нажмите кнопку **Создать**.

### <a name="assign-the-azure-ad-test-user"></a>Назначение тестового пользователя Azure AD

В этом разделе объясняется, как включить единый вход Azure для пользователя B.Simon, предоставив этому пользователю доступ к SAP Cloud Platform.

1. На портале Azure выберите **Корпоративные приложения**, а затем — **Все приложения**.
1. В списке приложений выберите **SAP Cloud Platform**.
1. На странице "Обзор" приложения найдите раздел **Управление** и выберите **Пользователи и группы**.
1. Выберите **Добавить пользователя**, а в диалоговом окне **Добавление назначения** выберите **Пользователи и группы**.
1. В диалоговом окне **Пользователи и группы** выберите **B.Simon** в списке пользователей, а затем в нижней части экрана нажмите кнопку **Выбрать**.
1. Если пользователям необходимо назначить роль, вы можете выбрать ее из раскрывающегося списка **Выберите роль**. Если для этого приложения не настроена ни одна роль, будет выбрана роль "Доступ по умолчанию".
1. В диалоговом окне **Добавление назначения** нажмите кнопку **Назначить**.

## <a name="configure-sap-cloud-platform-sso"></a>Настройка единого входа в SAP Cloud Platform

1. В другом окне браузера войдите на панель SAP Cloud Platform по адресу `https://account.<landscape host>.ondemand.com/cockpit` (например, https://account.hanatrial.ondemand.com/cockpit) ).

2. Щелкните вкладку **Доверие** .
   
    ![Доверие](./media/sap-hana-cloud-platform-tutorial/ic790800.png "Доверие")

3. В разделе управления доверием на вкладке **Local Service Provider** (Поставщик локальных служб) выполните следующие действия:

    ![Снимок экрана, на котором показан раздел управления доверием с выбранной вкладкой поставщика локальных услуг и выделены все текстовые поля.](./media/sap-hana-cloud-platform-tutorial/ic793931.png "Управление доверием")
   
    а. Нажмите кнопку **Изменить**.

    b. Для параметра **Configuration Type** (Тип конфигурации) выберите значение **Custom** (Настраиваемая).

    c. В поле **Имя поставщика локальных служб** оставьте значение по умолчанию. Скопируйте это значение и вставьте его в поле **Идентификатор** в конфигурации Azure AD для SAP Cloud Platform.

    d. Чтобы создать пару ключей **Signing Key** (Ключ подписывания) и **Signing Certificate** (Сертификат подписывания), щелкните **Generate Key Pair** (Создать пару ключей).

    д) Для параметра **Principal Propagation** (Распространение субъектов) выберите значение **Disabled** (Отключено).

    е) Для параметра **Force Authentication** (Принудительная аутентификация) выберите значение **Disabled** (Отключено).

    ж. Выберите команду **Сохранить**.

4. После сохранения параметров на вкладке **Local Service Provider** (Поставщик локальных служб) выполните следующие действия, чтобы получить URL-адрес ответа:
   
    ![Получение метаданных](./media/sap-hana-cloud-platform-tutorial/ic793930.png "Получить метаданные")

    а. Скачайте файл метаданных SAP Cloud Platform, щелкнув ссылку **Get Metadata** (Получить метаданные).

    b. Откройте скачанный XML-файл метаданных SAP Cloud Platform, а затем найдите тег **ns3:AssertionConsumerService**.
 
    c. Скопируйте значение атрибута **Location** и вставьте его в текстовое поле **URL-адрес ответа** в конфигурации Azure AD для SAP Cloud Platform.

5. Откройте вкладку **Trusted Identity Provider** (Доверенный поставщик удостоверений) и щелкните **Add Trusted Identity Provider** (Добавить доверенный поставщик удостоверений).
   
    ![Снимок экрана, на котором показана страница управления доверием с выбранной вкладкой доверенного поставщика удостоверений.](./media/sap-hana-cloud-platform-tutorial/ic790802.png "Управление доверием")
   
    >[!NOTE]
    >Для управления списком доверенных поставщиков удостоверений необходимо выбрать тип конфигурации «Настраиваемая» в разделе «Поставщик локальных служб». В качестве типа конфигурации по умолчанию используется неизменяемое неявное доверие к службе SAP ID Service. Для значения «Нет» параметры доверия отсутствуют.
    > 
    > 

6. Откройте вкладку **General** (Общие) и нажмите кнопку **Browse** (Обзор), чтобы передать скачанный файл метаданных.
    
    ![Управление доверием](./media/sap-hana-cloud-platform-tutorial/ic793932.png "Управление доверием")
    
    >[!NOTE]
    >После передачи файла метаданных поля **Single Sign-on URL** (URL-адрес единого входа), **Single Logout URL** (URL-адрес единого выхода) и **Signing Certificate** (Сертификат для подписи) заполняются автоматически.
    > 
     
7. Перейдите на вкладку **Атрибуты** .

8. На вкладке **Атрибуты** сделайте следующее:
    
    ![Атрибуты](./media/sap-hana-cloud-platform-tutorial/ic790804.png "Атрибуты") 

    а. Щелкните **Add Assertion-Based Attribute** (Добавить атрибут на основе утверждений) и добавьте следующие атрибуты на основе утверждений:
       
    | Атрибут утверждения | Атрибут субъекта |
    | --- | --- |
    | `http://schemas.xmlsoap.org/ws/2005/05/identity/claims/givenname` |firstname |
    | `http://schemas.xmlsoap.org/ws/2005/05/identity/claims/surname` |lastname |
    | `http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress` |email |
   
     >[!NOTE]
     >Конфигурация атрибутов зависит от способа разработки приложений в SCP, т. е. какие атрибуты предполагается использовать в ответе SAML и какое имя (атрибут субъекта) используется для доступа к этому атрибуту в коде.
     > 
    
    b. **Атрибут по умолчанию** на снимке экрана предоставляется только для примера. Он не требуется для того, чтобы сценарий работал.  
 
    c. Имена и значения для **атрибута субъекта** , показанные на снимке экрана, зависят от способа разработки приложения. Возможно, приложению требуются другие сопоставления.

### <a name="assertion-based-groups"></a>Группы на основе утверждений

При необходимости для поставщика удостоверений Azure Active Directory можно настроить группы на основе утверждений.

Использование групп на SAP Cloud Platform позволяет динамически назначать одного или нескольких пользователей одной или нескольким ролям в приложениях SAP Cloud Platform, которые определяются по значениям атрибутов в утверждении SAML 2.0. 

Например, если утверждение содержит атрибут *contract=temporary*, возможно, вам потребуется добавить всех затронутых пользователей в группу *TEMPORARY*. Группа *TEMPORARY* может содержать одну или несколько ролей из одного или нескольких приложений, развернутых в учетной записи SAP Cloud Platform.
 
Используйте группы на основе утверждений, чтобы одновременно назначить большое число пользователей для одной или нескольких ролей приложений в учетной записи SAP Cloud Platform. Если требуется назначить одного или небольшое число пользователей конкретным ролям, мы советуем назначить их непосредственно на вкладке **Authorizations** (Разрешения) панели SAP Cloud Platform.

### <a name="create-sap-cloud-platform-test-user"></a>Создание тестового пользователя SAP Cloud Platform

Чтобы разрешить пользователям Azure AD входить в SAP Cloud Platform, им необходимо назначить роли в SAP Cloud Platform.

**Чтобы назначить роль пользователю, сделайте следующее:**

1. Войдите на панель **SAP Cloud Platform**.

2. Выполните следующие действия.
   
    ![Авторизации](./media/sap-hana-cloud-platform-tutorial/ic790805.png "Authorizations")
   
    а. Щелкните **Авторизация**.

    b. Откройте вкладку **Пользователи** .

    c. В тестовом поле **Пользователь** введите электронный адрес пользователя.

    d. Щелкните **Назначить** , чтобы назначить роль пользователю.

    д) Выберите команду **Сохранить**.

## <a name="test-sso"></a>Проверка единого входа 

В этом разделе описано, как проверить конфигурацию единого входа Azure AD с помощью указанных ниже способов. 

* Выберите **Тестировать приложение** на портале Azure. Откроется URL-адрес для входа в SAP Cloud Platform, где можно инициировать поток входа. 

* Вручную введите URL-адрес для входа в SAP Cloud Platform и инициируйте поток входа.

* Вы можете использовать портал "Мои приложения" корпорации Майкрософт. Щелкнув плитку SAP Cloud Platform на портале "Мои приложения", вы автоматически войдете в приложение SAP Cloud Platform, для которого настроили единый вход. Дополнительные сведения о портале "Мои приложения" см. в [этой статье](../user-help/my-apps-portal-end-user-access.md).

## <a name="next-steps"></a>Дальнейшие действия

После настройки SAP Cloud Platform вы можете применить управление сеансами, которое в реальном времени защищает конфиденциальные данные вашей организации от кражи и несанкционированного доступа. Управление сеансом является расширением функции условного доступа. [Узнайте, как применять управление сеансами с помощью Microsoft Cloud App Security](/cloud-app-security/proxy-deployment-any-app).