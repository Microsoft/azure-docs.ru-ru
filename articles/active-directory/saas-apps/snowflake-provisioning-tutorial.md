---
title: Руководство по настройке Snowflake для автоматической подготовки пользователей с помощью Azure Active Directory | Документация Майкрософт
description: Узнайте о настройке Azure Active Directory для автоматической подготовки и отзыва учетных записей пользователей в Snowflake.
services: active-directory
author: zchia
writer: zchia
manager: CelesteDG
ms.service: active-directory
ms.subservice: saas-app-tutorial
ms.workload: identity
ms.topic: tutorial
ms.date: 07/26/2019
ms.author: zhchia
ms.openlocfilehash: 06f11763498e3e8393d688a71e1c37b466be3f6f
ms.sourcegitcommit: f28ebb95ae9aaaff3f87d8388a09b41e0b3445b5
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/29/2021
ms.locfileid: "99539541"
---
# <a name="tutorial-configure-snowflake-for-automatic-user-provisioning"></a>Руководство по настройке Snowflake для автоматической подготовки пользователей

В этом руководстве описаны действия, которые необходимо выполнить в Snowflake и Azure Active Directory (Azure AD), чтобы настроить Azure AD для автоматической подготовки и отзыва пользователей или групп в [Snowflake](https://www.Snowflake.com/pricing/). Подробные сведения о том, что делает эта служба, как она работает, и часто задаваемые вопросы см. в статье [Что представляет собой автоматическая подготовка пользователей для приложений SaaS в Azure AD?](../app-provisioning/user-provisioning.md) 

> [!NOTE]
> Сейчас этот соединитель предоставляется в общедоступной предварительной версии. См. подробные сведения о [дополнительных условиях использования Microsoft Azure](https://azure.microsoft.com/support/legal/preview-supplemental-terms/).

## <a name="capabilities-supported"></a>Поддерживаемые возможности
> [!div class="checklist"]
> * Создание пользователей в Snowflake.
> * Удаление пользователей из Snowflake, когда доступ им больше не нужен.
> * Синхронизация атрибутов пользователей между Azure AD и Snowflake.
> * Подготовка групп и членства в группах в Snowflake.
> * Разрешение [единого входа](./snowflake-tutorial.md) в Snowflake (рекомендуется).

## <a name="prerequisites"></a>Предварительные требования

В сценарии, описанном в этом руководстве, предполагается, что у вас уже имеется:

* [Клиент Azure AD.](../develop/quickstart-create-new-tenant.md)
* Учетная запись пользователя в Azure AD с [разрешением](../roles/permissions-reference.md) настраивать подготовку (администратор приложений, администратор облачных приложений, владелец приложения или глобальный администратор).
* [Арендатор Snowflake.](https://www.Snowflake.com/pricing/)
* Учетная запись пользователя в Snowflake с разрешениями администратора.

## <a name="step-1-plan-your-provisioning-deployment"></a>Шаг 1. Планирование развертывания для подготовки
1. Узнайте, [как работает служба подготовки](../app-provisioning/user-provisioning.md).
2. Определите, кто будет находиться в [области подготовки](../app-provisioning/define-conditional-rules-for-provisioning-user-accounts.md).
3. Определите, какие данные следует [сопоставлять между Azure AD и Snowflake](../app-provisioning/customize-application-attributes.md). 

## <a name="step-2-configure-snowflake-to-support-provisioning-with-azure-ad"></a>Шаг 2. Настройка Snowflake для поддержки подготовки с помощью Azure AD

Перед настройкой автоматической подготовки пользователей с помощью Azure AD в Snowflake необходимо включить подготовку SCIM (System for Cross-domain Identity Management).

1. Войдите в консоль администрирования Snowflake. Введите следующий запрос на выделенном листе, а затем выберите **Запустить**.

    ![Снимок экрана: консоль администрирования Snowflake с запросом и кнопкой "Запустить".](media/Snowflake-provisioning-tutorial/image00.png)

2.  Для арендатора Snowflake будет создан маркер доступа SCIM. Чтобы получить его, щелкните ссылку, которая выделена на следующем снимке экрана.

    ![Снимок экрана: лист в пользовательском интерфейсе Snowflake с выделенным маркером доступа SCIM.](media/Snowflake-provisioning-tutorial/image01.png)

3. Скопируйте значение созданного токена и щелкните **Done** (Готово). Его нужно будет ввести в поле **Токен секрета** на вкладке **Подготовка** для приложения Snowflake на портале Azure.

    ![Снимок экрана: область Details (Сведения), в которой показан токен, скопированный в текстовое поле, и выделенная кнопка Done (Готово).](media/Snowflake-provisioning-tutorial/image02.png)

## <a name="step-3-add-snowflake-from-the-azure-ad-application-gallery"></a>Шаг 3. Добавление Snowflake из коллекции приложений Azure AD

Добавьте Snowflake из коллекции приложений Azure AD, чтобы начать управление подготовкой в Snowflake. Если вы уже настроили единый вход в Snowflake, вы можете использовать то же приложение. Но мы рекомендуем создать отдельное приложение для исходной проверки интеграции. Дополнительные сведения о добавлении приложения из коллекции см. [здесь](../manage-apps/add-application-portal.md). 

## <a name="step-4-define-who-will-be-in-scope-for-provisioning"></a>Шаг 4. Определение пользователей для включения в область подготовки 

Служба подготовки Azure AD позволяет определить пользователей, которые будут подготовлены, на основе назначения приложению или атрибутов пользователя либо группы. Если вы решили определить пользователей на основе назначения, выполните следующие [действия](../manage-apps/assign-user-or-group-access-portal.md), чтобы назначить пользователей и группы приложению. Если вы решили определить пользователей только на основе атрибутов пользователя или группы, примените фильтр области, как описано [здесь](../app-provisioning/define-conditional-rules-for-provisioning-user-accounts.md). 

Помните о следующем:

* При назначении пользователей и групп для Snowflake необходимо выбрать роль, отличную от роли "Доступ по умолчанию". Пользователи с такой ролью исключаются из подготовки и будут помечены в журналах подготовки как не имеющие разрешений. Если в приложении доступна только эта роль, можно [изменить манифест приложения](../develop/howto-add-app-roles-in-azure-ad-apps.md), чтобы добавить другие роли. 

* Начните с малого. Протестируйте небольшой набор пользователей и групп, прежде чем выполнять развертывание для всех. Если в область подготовки включены назначенные пользователи и группы, проверьте этот механизм, назначив приложению одного или двух пользователей либо одну или две группы. Если в область включены все пользователи и группы, можно указать [фильтр области на основе атрибутов](../app-provisioning/define-conditional-rules-for-provisioning-user-accounts.md). 


## <a name="step-5-configure-automatic-user-provisioning-to-snowflake"></a>Шаг 5. Настройка автоматической подготовки пользователей в Snowflake 

В этом разделе описывается, как настроить службу подготовки Azure AD для создания, обновления и отключения пользователей и групп в Snowflake. Конфигурацию можно создать на основе назначений пользователей и групп в Azure AD.

Чтобы настроить автоматическую подготовку пользователей в Snowflake, сделайте следующее:

1. Войдите на [портал Azure](https://portal.azure.com). Щелкните **Корпоративные приложения** > **Все приложения**.

    ![Снимок экрана: панель "Корпоративные приложения".](common/enterprise-applications.png)

2. В списке приложений выберите **Snowflake**.

    ![Снимок экрана: список приложений.](common/all-applications.png)

3. Выберите вкладку **Подготовка**.

    ![Снимок экрана: раздел "Управление" с выделенным параметром "Подготовка".](common/provisioning.png)

4. Для параметра **Режим подготовки к работе** выберите значение **Автоматически**.

    ![Снимок экрана: раскрывающийся список "Режим подготовки" с выделенным параметром "Автоматически".](common/provisioning-automatic.png)

5. В разделе **Учетные данные администратора** введите полученные ранее значения базового URL-адреса SCIM 2.0 и маркера аутентификации в поля **URL-адрес арендатора** и **Токен секрета** соответственно. 

   Выберите **Проверить подключение**, чтобы убедиться, что Azure AD может подключиться к Snowflake. Если установить подключение не удалось, убедитесь, что у учетной записи Snowflake есть разрешения администратора, и повторите попытку.

    ![Снимок экрана: поля для URL-адреса арендатора и маркера секрета, а также кнопка "Проверить подключение".](common/provisioning-testconnection-tenanturltoken.png)

6. В поле **Почтовое уведомление** введите адрес электронной почты пользователя или группы, которые должны получать уведомления об ошибках подготовки. Установите флажок **Отправить уведомление по электронной почте при сбое**.

    ![Снимок экрана: флажки для уведомления по электронной почте.](common/provisioning-notification-email.png)

7. Щелкните **Сохранить**.

8. В разделе **Сопоставления** выберите **Синхронизировать пользователей Azure Active Directory со Snowflake**.

9. В разделе **Сопоставление атрибутов** просмотрите атрибуты пользователей, синхронизированные из Azure AD в Snowflake. Атрибуты, выбранные как свойства **сопоставления**, используются для сопоставления учетных записей пользователей в Snowflake для операций обновления. Нажмите кнопку **Сохранить**, чтобы зафиксировать все изменения.

   |attribute|Тип|
   |---|---|
   |active|Логическое|
   |displayName|Строка|
   |emails[type eq "work"].value|Строка|
   |userName|Строка|
   |name.givenName|Строка|
   |name.familyName|Строка|
   |urn:ietf:params:scim:schemas:extension:enterprise:2.0:User:defaultRole|Строка|
   |urn:ietf:params:scim:schemas:extension:enterprise:2.0:User:defaultWarehouse|Строка|

10. В разделе **Сопоставления** выберите **Синхронизировать группы Azure Active Directory со Snowflake**.

11. В разделе **Сопоставление атрибутов** просмотрите атрибуты группы, которые синхронизированы из Azure AD в Snowflake. Атрибуты, выбранные как свойства **сопоставления**, используются для сопоставления групп в Snowflake для операций обновления. Нажмите кнопку **Сохранить**, чтобы зафиксировать все изменения.

    |attribute|Тип|
    |---|---|
    |displayName|Строка|
    |members|Справочник|

12. Чтобы настроить фильтры области, ознакомьтесь с инструкциями в [этом учебнике](../app-provisioning/define-conditional-rules-for-provisioning-user-accounts.md).

13. Чтобы включить службу подготовки Azure AD для Snowflake, в разделе **Параметры** измените значение параметра **Состояние подготовки** на **Включено**.

     ![Снимок экрана: подготовка включена.](common/provisioning-toggle-on.png)

14. Определите пользователей и группы для подготовки в Snowflake, выбрав нужные значения в поле **Область** в разделе **Параметры**. 

    Если этот параметр недоступен, настройте обязательные поля в разделе **Учетные данные администратора**, нажмите кнопку **Сохранить** и обновите страницу. 

     ![Снимок экрана: варианты для области подготовки.](common/provisioning-scope.png)

15. Когда будете готовы выполнить подготовку, нажмите кнопку **Сохранить**.

     ![Снимок экрана: кнопка для сохранения конфигурации подготовки.](common/provisioning-configuration-save.png)

После этого начнется начальная синхронизация пользователей и групп, определенных в поле **Область** раздела **Параметры**. Начальная синхронизация занимает больше времени, чем последующие операции синхронизации. Последующие операции синхронизации выполняются приблизительно каждые 40 минут (если запущена служба подготовки Azure AD).

## <a name="step-6-monitor-your-deployment"></a>Шаг 6. Мониторинг развертывания
Завершив настройку подготовки, используйте следующие ресурсы для мониторинга развертывания:

- Используйте [журналы подготовки](../reports-monitoring/concept-provisioning-logs.md), чтобы определить, какие пользователи были подготовлены успешно или неудачно.
- Используйте [индикатор выполнения](../app-provisioning/application-provisioning-when-will-provisioning-finish-specific-user.md), чтобы узнать состояние цикла подготовки и близость его завершения.
- Если конфигурация подготовки, вероятно, находится в неработоспособном состоянии, приложение перейдет в карантин. [Подробнее о режимах карантина](../app-provisioning/application-provisioning-quarantine-status.md).  

## <a name="connector-limitations"></a>Ограничения соединителя

Срок действия токенов SCIM, созданных Snowflake, истекает через 6 месяцев. Учтите, что их необходимо обновить до истечения срока действия, чтобы синхронизация подготовки продолжала работать. 

## <a name="troubleshooting-tips"></a>Советы по устранению неполадок

Сейчас служба подготовки Azure AD работает в определенных [диапазонах IP-адресов](../app-provisioning/use-scim-to-provision-users-and-groups.md#ip-ranges). При необходимости можно задать другие диапазоны IP-адресов и добавить их в список разрешений приложения. Этот метод позволяет разрешить трафик от службы подготовки Azure AD к приложению.

## <a name="change-log"></a>Журнал изменений

* 21.07.2020 г. — включение обратимого удаления для всех пользователей (с помощью активного атрибута).

## <a name="additional-resources"></a>Дополнительные ресурсы

* [Управление подготовкой учетных записей пользователей для корпоративных приложений](../app-provisioning/configure-automatic-user-provisioning-portal.md)
* [Что такое доступ к приложениям и единый вход с помощью Azure Active Directory?](../manage-apps/what-is-single-sign-on.md)

## <a name="next-steps"></a>Дальнейшие действия
* [Сведения о просмотре журналов и получении отчетов о действиях по подготовке](../app-provisioning/check-status-user-account-provisioning.md)
