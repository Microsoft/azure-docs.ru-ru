---
title: Руководство по Настройка ServiceNow для автоматической подготовки пользователей с помощью Azure Active Directory | Документация Майкрософт
description: Узнайте, как настроить автоматическую подготовку и отзыв учетных записей пользователей из Azure AD в ServiceNow.
services: active-directory
author: jeevansd
manager: CelesteDG
ms.reviewer: celested
ms.service: active-directory
ms.subservice: saas-app-tutorial
ms.workload: identity
ms.topic: tutorial
ms.date: 12/10/2019
ms.author: jeedes
ms.openlocfilehash: b3b62e7c16106fd9d94d4a3438331dab4ce8b6e8
ms.sourcegitcommit: 44188608edfdff861cc7e8f611694dec79b9ac7d
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/04/2021
ms.locfileid: "99539049"
---
# <a name="tutorial-configure-servicenow-for-automatic-user-provisioning"></a>Руководство по Настройка ServiceNow для автоматической подготовки пользователей

В этом руководстве описаны действия, которые необходимо выполнить в ServiceNow и Azure Active Directory (Azure AD) для настройки автоматической подготовки пользователей. После настройки Azure AD автоматически осуществляет и отменяет подготовку пользователей и групп для [ServiceNow](https://www.servicenow.com/) с помощью службы подготовки Azure AD. 

Подробные сведения о том, что делает эта служба, как она работает, и часто задаваемые вопросы см. в статье [Автоматическая подготовка пользователей и ее отзыв для приложений SaaS в Azure Active Directory](../app-provisioning/user-provisioning.md). 


## <a name="capabilities-supported"></a>Поддерживаемые возможности
> [!div class="checklist"]
> * Создание пользователей в ServiceNow.
> * Удаление пользователей из ServiceNow, когда им больше не нужен доступ.
> * Синхронизация атрибутов пользователей между Azure AD и ServiceNow.
> * Подготовка групп и членства в группах в ServiceNow.
> * Разрешение [единого входа](servicenow-tutorial.md) в ServiceNow (рекомендуется).

## <a name="prerequisites"></a>Предварительные требования

В сценарии, описанном в этом руководстве, предполагается, что у вас уже имеется:

* [Клиент Azure AD.](../develop/quickstart-create-new-tenant.md) 
* Учетная запись пользователя в Azure AD с [разрешением](../roles/permissions-reference.md) настраивать подготовку (администратор приложений, администратор облачных приложений, владелец приложения или глобальный администратор).
* [Экземпляр ServiceNow](https://www.servicenow.com/) версии Calgary или выше.
* [Экземпляр ServiceNow Express](https://www.servicenow.com/) версии Helsinki или выше.
* Учетная запись пользователя в ServiceNow с разрешениями администратора группы.

## <a name="step-1-plan-your-provisioning-deployment"></a>Шаг 1. Планирование развертывания для подготовки
1. Узнайте, [как работает служба подготовки](../app-provisioning/user-provisioning.md).
2. Определите, кто будет находиться в [области подготовки](../app-provisioning/define-conditional-rules-for-provisioning-user-accounts.md).
3. Определите, какие данные следует [сопоставлять между Azure AD и ServiceNow](../app-provisioning/customize-application-attributes.md). 

## <a name="step-2-configure-servicenow-to-support-provisioning-with-azure-ad"></a>Шаг 2. Настройка ServiceNow для поддержки подготовки с помощью Azure AD

1. Найдите имя экземпляра ServiceNow. Это имя экземпляра можно взять из URL-адреса, который используется для доступа к ServiceNow. В следующем примере экземпляр имеет имя **dev35214**.

   ![Снимок экрана: экземпляр ServiceNow.](media/servicenow-provisioning-tutorial/servicenow-instance.png)

2. Получите учетные данные для администратора в ServiceNow. Перейдите к профилю пользователя в ServiceNow и убедитесь, что у этого пользователя есть роль администратора. 

   ![Снимок экрана: роль администратора ServiceNow.](media/servicenow-provisioning-tutorial/servicenow-admin-role.png)


## <a name="step-3-add-servicenow-from-the-azure-ad-application-gallery"></a>Шаг 3. Добавление ServiceNow из коллекции приложений Azure AD

Добавьте ServiceNow из коллекции приложений Azure AD, чтобы начать управление подготовкой в ServiceNow. Если вы уже настроили единый вход в ServiceNow, вы можете использовать то же приложение. Но мы рекомендуем создать отдельное приложение для проверки интеграции. Дополнительные сведения о добавлении приложения из коллекции см. [здесь](../manage-apps/add-application-portal.md). 

## <a name="step-4-define-who-will-be-in-scope-for-provisioning"></a>Шаг 4. Определение пользователей для включения в область подготовки 

Служба подготовки Azure AD позволяет определить пользователей, которые будут подготовлены, на основе назначения приложению или атрибутов пользователя либо группы. Если вы решили определить пользователей на основе назначения, выполните следующие [действия](../manage-apps/assign-user-or-group-access-portal.md), чтобы назначить пользователей и группы приложению. Если вы решили определить пользователей только на основе атрибутов пользователя или группы, примените фильтр области, как описано [здесь](../app-provisioning/define-conditional-rules-for-provisioning-user-accounts.md). 

Помните о следующем:

* При назначении пользователей и групп для ServiceNow необходимо выбрать роль, отличную от роли "Доступ по умолчанию". Пользователи с такой ролью исключаются из подготовки и будут помечены в журналах подготовки как не имеющие разрешений. Если в приложении доступна только эта роль, можно [изменить манифест приложения](../develop/howto-add-app-roles-in-azure-ad-apps.md), чтобы добавить другие роли. 

* Начните с малого. Протестируйте небольшой набор пользователей и групп, прежде чем выполнять развертывание для всех. Если в область подготовки включены назначенные пользователи и группы, проверьте этот механизм, назначив приложению одного или двух пользователей либо одну или две группы. Если в область включены все пользователи и группы, можно указать [фильтр области на основе атрибутов](../app-provisioning/define-conditional-rules-for-provisioning-user-accounts.md). 


## <a name="step-5-configure-automatic-user-provisioning-to-servicenow"></a>Шаг 5. Настройка автоматической подготовки пользователей в ServiceNow 

В этом разделе описывается, как настроить службу подготовки Azure AD для создания, обновления и отключения пользователей и групп в TestApp. Конфигурацию можно создать на основе назначений пользователей и групп в Azure AD.

Чтобы настроить автоматическую подготовку пользователей в ServiceNow, сделайте следующее:

1. Войдите на [портал Azure](https://portal.azure.com). Щелкните **Корпоративные приложения** > **Все приложения**.

    ![Снимок экрана: панель "Корпоративные приложения".](common/enterprise-applications.png)

2. В списке приложений выберите **ServiceNow**.

    ![Снимок экрана: список приложений.](common/all-applications.png)

3. Выберите вкладку **Подготовка**.

    ![Снимок экрана: раздел "Управление" с выделенным параметром "Подготовка".](common/provisioning.png)

4. Для параметра **Режим подготовки к работе** выберите значение **Автоматически**.

    ![Снимок экрана: раскрывающийся список "Режим подготовки" с выделенным параметром "Автоматически".](common/provisioning-automatic.png)

5. В разделе **Учетные данные администратора** введите учетные данные администратора ServiceNow и имя пользователя. Выберите **Проверить подключение**, чтобы убедиться, что Azure AD может подключиться к ServiceNow. Если установить подключение не удалось, убедитесь, что у учетной записи ServiceNow есть разрешения администратора, и повторите попытку.

    ![Снимок экрана: страница "Подготовка службы", где можно ввести учетные данные администратора.](./media/servicenow-provisioning-tutorial/servicenow-provisioning.png)

6. В поле **Почтовое уведомление** введите адрес электронной почты пользователя или группы, которые должны получать уведомления об ошибках подготовки. Установите флажок **Отправить уведомление по электронной почте при сбое**.

    ![Снимок экрана: флажки для уведомления по электронной почте.](common/provisioning-notification-email.png)

7. Щелкните **Сохранить**.

8. В разделе **Сопоставления** выберите **Синхронизировать пользователей Azure Active Directory с ServiceNow**.

9. В разделе **Сопоставления атрибутов** просмотрите пользовательские атрибуты, которые синхронизируются из Azure AD в ServiceNow. Атрибуты, выбранные как свойства **Matching**, используются для сопоставления учетных записей пользователей в ServiceNow для операций обновления. 

   Если вы решили изменить [соответствующий атрибут сопоставления](../app-provisioning/customize-application-attributes.md), сначала убедитесь, что API ServiceNow поддерживает фильтрацию пользователей по этому атрибуту. 
   
   Нажмите кнопку **Сохранить**, чтобы зафиксировать все изменения.

10. В разделе **Сопоставления** выберите **Синхронизировать группы Azure Active Directory с ServiceNow**.

11. В разделе **Сопоставления атрибутов** просмотрите атрибуты группы, которые синхронизируются из Azure AD в ServiceNow. Атрибуты, выбранные как свойства **сопоставления**, используются для сопоставления групп в ServiceNow в операциях обновления. Нажмите кнопку **Сохранить**, чтобы зафиксировать все изменения.

12. Чтобы настроить фильтры области, ознакомьтесь с инструкциями в [этом учебнике](../app-provisioning/define-conditional-rules-for-provisioning-user-accounts.md).

13. Чтобы включить службу подготовки Azure AD для ServiceNow, измените значение параметра **Состояние подготовки** на **Включено** в разделе **Параметры**.

    ![Снимок экрана: подготовка включена.](common/provisioning-toggle-on.png)

14. Определите пользователей и группы для подготовки в ServiceNow, выбрав нужные значения в поле **Область** раздела **Параметры**.

    ![Снимок экрана: варианты для области подготовки.](common/provisioning-scope.png)

15. Когда будете готовы выполнить подготовку, нажмите кнопку **Сохранить**.

    ![Снимок экрана: кнопка для сохранения конфигурации подготовки.](common/provisioning-configuration-save.png)

После этого начнется цикл начальной синхронизации всех пользователей и групп, определенных в поле **Область** в разделе **Параметры**. Начальный цикл занимает больше времени, чем последующие циклы. Последующие циклы выполняются приблизительно каждые 40 минут (если запущена служба подготовки Azure AD). 

## <a name="step-6-monitor-your-deployment"></a>Шаг 6. Мониторинг развертывания
Завершив настройку подготовки, используйте следующие ресурсы для мониторинга развертывания:

- Используйте [журналы подготовки](../reports-monitoring/concept-provisioning-logs.md), чтобы определить, какие пользователи были подготовлены успешно или неудачно.
- Используйте [индикатор выполнения](../app-provisioning/application-provisioning-when-will-provisioning-finish-specific-user.md), чтобы узнать состояние цикла подготовки и близость его завершения.
- Если конфигурация подготовки, вероятно, находится в неработоспособном состоянии, приложение перейдет в карантин. [Подробнее о режимах карантина](../app-provisioning/application-provisioning-quarantine-status.md).  

## <a name="troubleshooting-tips"></a>Советы по устранению неполадок
* При подготовке некоторых атрибутов, таких как **Department** и **Location** в ServiceNow, эти значения должны уже существовать в ссылочной таблице в ServiceNow. В противном случае отобразится ошибка **InvalidLookupReference**. 

   Предположим, что у вас есть два расположения (Seattle, Los Angeles) и три отдела (Sales, Finance, Marketing) в определенной таблице в ServiceNow. При попытке подготовить пользователя, для которого указаны отдел Sales и расположение Seattle, подготовка завершится успешно. При попытке подготовить пользователя, для которого указаны отдел Sales и расположение LA, подготовка не будет выполнена. Необходимо либо добавить значение LA в ссылочную таблицу в ServiceNow, либо изменить атрибут пользователя в Azure AD, чтобы он соответствовал формату ServiceNow. 
* Если отображается ошибка **EntryJoiningPropertyValueIsMissing**, просмотрите [сопоставления атрибутов](../app-provisioning/customize-application-attributes.md), чтобы определить соответствующий атрибут. Это значение должно присутствовать у пользователя или группы, которые вы пытаетесь подготавливать. 
* Чтобы понять все требования и ограничения (например, формат для указания кода страны для пользователя), изучите статью по [API ServiceNow SOAP](https://docs.servicenow.com/bundle/newyork-application-development/page/integrate/web-services-apis/reference/r_DirectWebServiceAPIFunctions.html).
* По умолчанию запросы на подготовку отправляются на адрес https://{имя_вашего_экземпляра}.service-now.com/{имя_таблицы}. Если вам нужно использовать собственный URL-адрес арендатора, введите этот URL-адрес полностью в поле "Имя экземпляра".
* Ошибка **ServiceNowInstanceInvalid** указывает на проблему при обмене данными с экземпляром ServiceNow. Текст сообщения об ошибке:
  
  `Details: Your ServiceNow instance name appears to be invalid.  Please provide a current ServiceNow administrative user name and          password along with the name of a valid ServiceNow instance.`                                                              

  При возникновении проблем при проверке подключения попробуйте выбрать **Нет** для следующих параметров в ServiceNow:
   
  - **System Security** > **High security settings** > **Require basic authentication for incoming SCHEMA requests** (Безопасность системы > Параметры высокого уровня безопасности > Требовать базовую аутентификацию для входящих запросов SCHEMA).
  - **System Properties** > **Web Services** > **Require basic authorization for incoming SOAP requests** (Свойства системы > Веб-службы > Требовать базовую авторизацию для входящих запросов SOAP).

     ![Снимок экрана: вариант для авторизации запросов SOAP.](media/servicenow-provisioning-tutorial/servicenow-webservice.png)

  Если это не помогает решить проблему, обратитесь в службу поддержки ServiceNow и попросите включить отладку SOAP для устранения неполадок. 

* Сейчас служба подготовки Azure AD работает в определенных [диапазонах IP-адресов](../app-provisioning/use-scim-to-provision-users-and-groups.md#ip-ranges). При необходимости можно задать другие диапазоны IP-адресов и добавить их в список разрешений приложения. Этот метод позволяет разрешить трафик от службы подготовки Azure AD к приложению.

## <a name="additional-resources"></a>Дополнительные ресурсы

* [Управление подготовкой учетных записей пользователей для корпоративных приложений](../app-provisioning/configure-automatic-user-provisioning-portal.md)
* [Что такое доступ к приложениям и единый вход с помощью Azure Active Directory?](../manage-apps/what-is-single-sign-on.md)

## <a name="next-steps"></a>Дальнейшие действия

* [Сведения о просмотре журналов и получении отчетов о действиях по подготовке](../app-provisioning/check-status-user-account-provisioning.md)
