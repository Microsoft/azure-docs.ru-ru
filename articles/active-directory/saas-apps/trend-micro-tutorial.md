---
title: Руководство по Интеграция единого входа AAD с Trend Micro Web Security (TMWS)
description: Узнайте, как настроить единый вход Azure Active Directory в Trend Micro Web Security (TMWS).
services: active-directory
author: jeevansd
manager: CelesteDG
ms.reviewer: celested
ms.service: active-directory
ms.subservice: saas-app-tutorial
ms.workload: identity
ms.topic: tutorial
ms.date: 04/21/2020
ms.author: jeedes
ms.openlocfilehash: b76c41787d7a35fb3024fa18c0122bc966243bbc
ms.sourcegitcommit: 910a1a38711966cb171050db245fc3b22abc8c5f
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "96008401"
---
# <a name="tutorial-azure-active-directory-single-sign-on-sso-integration-with-trend-micro-web-security-tmws"></a>Руководство по Интеграция единого входа Azure Active Directory с Trend Micro Web Security (TMWS)

В этом руководстве описано, как интегрировать Trend Micro Web Security (TMWS) с Azure Active Directory (Azure AD). Интеграция TMWS с Azure AD обеспечивает следующие возможности.

* Управление доступом к TMWS с помощью Azure AD.
* Автоматический вход пользователей в TMWS с учетными записями Azure AD.
* Централизованное управление учетными записями через портал Azure.

Дополнительные сведения об интеграции приложений SaaS с Azure AD см. в статье [Единый вход в приложениях в Azure Active Directory](../manage-apps/what-is-single-sign-on.md).

## <a name="prerequisites"></a>Предварительные требования

Для начала работы необходимы перечисленные ниже компоненты и данные.

* Подписка Azure AD. Если у вас нет подписки, вы можете получить [бесплатную учетную запись](https://azure.microsoft.com/free/).
* Подписка TMWS с поддержкой единого входа.

## <a name="scenario-description"></a>Описание сценария

В рамках этого учебника вы настроите и проверите единый вход Azure AD в тестовой среде.

* TMWS поддерживает единый вход, инициируемый поставщиком услуг.
* После настройки TMWS вы можете применить функцию управления сеансом, которая в реальном времени защищает конфиденциальные данные вашей организации от хищения и несанкционированного доступа. Управление сеансом является расширением функции условного доступа. См. сведения о том, как применить управление сеансами с помощью Microsoft Cloud App Security, в руководстве по [подключению и развертыванию Управления условным доступом к приложениям для любого приложения](/cloud-app-security/proxy-deployment-any-app).

## <a name="add-tmws-from-the-gallery"></a>Добавление TMWS из коллекции

Чтобы настроить интеграцию TMWS с Azure AD, необходимо добавить TMWS из коллекции в список управляемых приложений SaaS.

1. Войдите на [портал Azure](https://portal.azure.com) с личной учетной записью Майкрософт либо рабочей или учебной учетной записью.
1. Слева выберите службу **Azure Active Directory**.
1. Перейдите в колонку **Корпоративные приложения** и выберите **Все приложения**.
1. Чтобы добавить новое приложение, выберите **Новое приложение**.
1. В разделе **Добавление из коллекции** в поле поиска введите **Trend Micro Web Security (TMWS)** .
1. Выберите **Trend Micro Web Security (TMWS)** в области результатов и добавьте это приложение. Подождите несколько секунд, пока приложение не будет добавлено в ваш клиент.

## <a name="configure-and-test-azure-ad-sso-for-tmws"></a>Настройка и проверка единого входа Azure AD для TMWS

Настройте и проверьте единый вход Azure AD в TMWS с помощью тестового пользователя B.Simon. Для обеспечения работы единого входа необходимо установить связь между пользователем Azure AD и соответствующим пользователем в TMWS.

Чтобы настроить и проверить единый вход Azure AD в TMWS, выполните действия в следующих стандартных блоках.

1. [Настройка единого входа Azure AD](#configure-azure-ad-sso) — чтобы ваши пользователи могли использовать эту функцию.
    1. [Создание тестового пользователя Azure AD](#create-an-azure-ad-test-user) для проверки работы единого входа Azure AD.
    1. [Предоставление доступа тестовому пользователю AAD](#grant-the-azure-ad-test-user-access-to-tmws) к TMWS.
    1. [Настройка параметров синхронизации для пользователей и групп в Azure AD](#configure-user-and-group-synchronization-settings-in-azure-ad).
1. [Настройка единого входа для TMWS](#configure-tmws-sso) на стороне приложения.
1. [Проверка единого входа](#test-sso), чтобы убедиться в правильности конфигурации.

## <a name="configure-azure-ad-sso"></a>Настройка единого входа Azure AD

Выполните следующие действия, чтобы включить единый вход Azure AD на портале Azure.

1. На [портале Azure](https://portal.azure.com/) на странице интеграции с приложением **Trend Micro Web Security (TMWS)** найдите раздел **Управление** и выберите **Единый вход**.
1. На странице **Выбрать метод единого входа** выберите **SAML**.
1. На странице **Настройка единого входа с помощью SAML** щелкните значок ручки, чтобы открыть диалоговое окно **Базовая конфигурация SAML** и изменить эти параметры:

   ![Изменение параметров базовой конфигурации SAML](common/edit-urls.png)

1. На странице **Базовая конфигурация SAML** введите значения в следующие поля.

    а. В текстовом поле **Идентификатор (сущности)** введите URL-адрес в формате:

    `https://auth.iws-hybrid.trendmicro.com/([0-9a-f]{16})`

    b. В текстовом поле **URL-адрес ответа** введите такой URL-адрес:

    `https://auth.iws-hybrid.trendmicro.com/simplesaml/module.php/saml/sp/saml2-acs.php/ics-sp`

    > [!NOTE]
    > Значение идентификатора, указанное на предыдущем шаге, не совпадает с тем, которое вам нужно ввести. Используйте реальный идентификатор. Это значение можно получить в разделе **Параметры поставщика услуг для портала администрирования Azure** на странице **Метод проверки подлинности** для Azure AD, щелкнув **Администрирование > Службы каталогов**.

1. TMWS ожидает проверочные утверждения SAML в определенном формате, и для этого нужно добавить настраиваемые сопоставления атрибутов в конфигурацию атрибутов токена SAML. На этом снимке экрана показаны атрибуты по умолчанию.

    ![Атрибуты по умолчанию](common/default-attributes.png)

1. Кроме описанных выше атрибутов TMWS ожидает несколько дополнительных атрибутов в ответе SAML. Эти атрибуты представлены в следующей таблице. Эти атрибуты заранее заполнены, но вы можете изменить их в соответствии с вашими требованиями.
    
    | Имя | Атрибут источника|
    | --------------- | --------- |
    | sAMAccountName | user.onpremisessamaccountname |
    | uPN | user.userprincipalname |

1. На странице **Настройка единого входа с помощью SAML** в разделе **Сертификат подписи SAML** выберите **Сертификат (Base64)** . Щелкните ссылку **Скачать** рядом с именем сертификата, чтобы скачать его и сохранить на локальном компьютере.

    ![Ссылка для скачивания сертификата](common/certificatebase64.png)

1. Скопируйте один или несколько нужных URL-адресов из раздела **Настройка Trend Micro Web Security (TMWS)** .

    ![Копирование URL-адресов настройки](common/copy-configuration-urls.png)

### <a name="create-an-azure-ad-test-user"></a>Создание тестового пользователя Azure AD

В этом разделе описано, как создать на портале Azure тестового пользователя с именем B.Simon.

1. На портале Azure в области слева щелкните **Azure Active Directory**. Щелкните **Пользователи**, а затем **Все пользователи**.
1. В верхней части экрана выберите **Новый пользователь**.
1. В разделе **Свойства пользователя** выполните следующие действия.
   1. В поле **Имя** введите `B.Simon`.  
   1. В поле **Имя пользователя** введите **_имя_пользователя_@* домен_компании *.* расширение***. Например, `B.Simon@contoso.com`.
   1. Выберите **Показать пароль** и запишите значение, которое отображается в поле **Пароль**.
   1. Нажмите кнопку **создания**.

### <a name="grant-the-azure-ad-test-user-access-to-tmws"></a>Предоставление доступа тестовому пользователю AAD к TMWS

В этом разделе описано, как включить единый вход в Azure для пользователя B.Simon, предоставив этому пользователю доступ к TMWS.

1. На портале Azure выберите **Корпоративные приложения**, а затем — **Все приложения**.
1. В списке приложений выберите **Trend Micro Web Security (TMWS)** .
1. В разделе **Управление** на странице сводных данных о приложении выберите **Пользователи и группы**:

   ![Выбор параметра "Пользователи и группы"](common/users-groups-blade.png)

1. Выберите **Добавить пользователя**, а в диалоговом окне **Добавление назначения** — **Пользователи и группы**.

    ![Выбор элемента "Добавить пользователя"](common/add-assign-user.png)

1. В диалоговом окне **Пользователи и группы** выберите **B. Simon** в списке **Пользователи**, а затем в нижней части экрана нажмите кнопку **Выбрать**.
1. Если вы ожидаете, что в утверждении SAML будет получено значение роли, в диалоговом окне **Выбор роли** нужно выбрать соответствующую роль для пользователя в списке и нажать кнопку **Выбрать**, расположенную в нижней части экрана.
1. В диалоговом окне **Добавление назначения** выберите **Назначить**.

### <a name="configure-user-and-group-synchronization-settings-in-azure-ad"></a>Настройка параметров синхронизации для пользователей и групп в Azure AD

1. В области слева выберите **Azure Active Directory**.

1. В разделе **Управление** щелкните **Регистрация приложений** и выберите новое корпоративное приложение в области **Все приложения**.

1. В разделе **Управление** выберите **Сертификаты и секреты**.

1. В области **Секреты клиента** выберите **Новый секрет клиента**.

1. На открывшемся экране **Добавление секрета клиента** введите описание и выберите срок действия этого секрета клиента, а затем нажмите кнопку **Добавить**. Новый секрет клиента отобразится в области **Секреты клиента**.

1. Запишите значение секрета клиента. Позже вы введете его в TMWS.

1. В разделе **Управление** выберите **Разрешения API**. 

1. В окне **Разрешения API** щелкните **Добавить разрешение**.

1. На вкладке **API Майкрософт** в окне **Запрос разрешений API** последовательно выберите **Microsoft Graph**, **Разрешения приложения**.

1. Найдите и добавьте следующие разрешения: 

    * Group.Read.All;
    * User.Read.All.

1. Выберите **Добавить разрешения**. Появится сообщение с подтверждением сохранения параметров. Новые разрешения появятся в окне **Разрешения API**.

1. В области **Предоставление согласия** щелкните **Предоставить согласие администратора для *учетная запись администратора* (каталог по умолчанию)** , а затем нажмите **Да**. Появится сообщение о том, что предоставлено согласие администратора на запрошенные разрешения.

1. Щелкните **Обзор**. 

1. Запишите значения **идентификатора приложения (клиента)** и **идентификатора каталога (клиента)** , которые отображаются в области справа. Позже вы введете эти данные в TMWS. Вы также можете выбрать элемент **Имена личных доменов** в разделе **Azure Active Directory > Управление** и записать имя домена, указанное в области справа.

## <a name="configure-tmws-sso"></a>Настройка единого входа TMWS

Выполните следующие шаги, чтобы настроить единый вход для TMWS на стороне приложения.

1. Войдите в консоль управления TMWS и последовательно выберите **Administration** > **USERS & AUTHENTICATION** > **Directory Services**. (Администрирование > Пользователи и проверка подлинности > Службы каталогов).

1. Щелкните **here** (Здесь) в верхней области экрана.

1. На странице **Authentication Method** (Метод проверки подлинности) выберите **Azure AD**.

1. Выберите **On** (Вкл.) или **Off** (Выкл.), чтобы указать, смогут ли пользователи AAD из вашей организации посещать веб-сайты через TMWS, если их данные не синхронизированы с TMWS.

    > [!NOTE]
    > Пользователи, которые не синхронизированы из Azure AD, смогут проходить проверку подлинности только через известные шлюзы TMWS или выделенный порт для вашей организации.

1. В разделе **Identity Provider Settings** (Настройки поставщика удостоверений) выполните следующие действия.

    а. В поле **Service URL** (URL-адрес службы) вставьте значение **URL-адреса входа**, скопированное на портале Azure.

    b. В поле **Logon name attribute** (Атрибут имени входа) вставьте **имя утверждения пользователя** для исходного атрибута **user.onpremisessamaccountname**, полученное на портале Azure.

    c. В поле **Public SSL certificate** (Открытый сертификат SSL) вставьте **сертификат (Base64)** , который скачан на портале Azure.

1. В разделе **Synchronization Settings** (Параметры синхронизации) выполните следующие действия.

    а. В поле **Tenant** (Клиент) введите **идентификатор каталога (клиента)** или **имя личного домена**, полученные на портале Azure.

    b. В поле **Application ID** (Идентификатор приложения) введите **идентификатор приложения (клиента)** , полученный на портале Azure.

    c. В поле **Client secret** (Секрет клиента) введите **секрет клиента**, полученный на портале Azure.

    d. В поле **Synchronization schedule** (Расписание синхронизации) выберите метод синхронизации с Azure AD: вручную или по расписанию. Если вы выберете синхронизацию **вручную**, после любых изменениях сведений о пользователе в Active Directory нужно будет открыть страницу **Службы каталогов** и запустить синхронизацию, чтобы информация в TMWS была актуальной.

    д) Щелкните **Test Connection** (Проверить подключение), чтобы проверить возможность подключения к службе Azure AD.
    
    е) Щелкните **Сохранить**.
 
 > [!NOTE]
 > См. сведения о [настройке ТМВС с помощью Azure AD](https://docs.trendmicro.com/en-us/enterprise/trend-micro-web-security-online-help/administration_001/directory-services/azure-active-directo/configuring-azure-ad.aspx).

## <a name="test-sso"></a>Проверка единого входа 

Когда вы закончите настройку службы Azure AD и укажете Azure AD в качестве метода аутентификации пользователей, войдите на прокси-сервер TMWS для проверки настроек. После того как интерфейс входа в Azure AD проверит вашу учетную запись, вы сможете выйти в Интернет.

> [!NOTE]
> TMWS не поддерживает тестирование единого входа через портал Azure AD, поэтому выберите **Overview** > **Single sign-on**  > **Set up Single Sign-on with SAML** > **Test**  (Обзор > Единый вход > Настройка SAML для единого входа > Проверить) в интерфейсе нового корпоративного приложения.

1. Очистите все файлы cookie в браузере и перезапустите браузер. 

1. Введите в браузере адрес прокси-сервера TMWS. Подробные сведения см. в статье [о переадресации трафика с помощью PAC-файлов](https://docs.trendmicro.com/en-us/enterprise/trend-micro-web-security-online-help/administration_001/pac-files/traffic-forwarding-u.aspx#GUID-A4A83827-7A29-4596-B866-01ACCEDCC36B).

1. Зайдите на любой веб-сайт в Интернете. TMWS перенаправит вас на портал TMWS Captive Portal.

1. Укажите учетную запись Active Directory (в формате *domain*\\*sAMAccountName* или *sAMAccountName*@*domain*), адрес электронной почты или имя участника-пользователя, а затем нажмите **Log On** (Войти в систему). TMWS перенаправит вас в окно входа в Azure AD.

1. В окне входа в AAD введите учетные данные для службы Azure AD. После этого вы войдете в TMWS.

## <a name="additional-resources"></a>Дополнительные ресурсы

- [Учебники по интеграции приложений SaaS с Azure Active Directory](./tutorial-list.md).

- [Что такое доступ к приложениям и единый вход с помощью Azure Active Directory?](../manage-apps/what-is-single-sign-on.md)

- [Что представляет собой условный доступ в Azure Active Directory?](../conditional-access/overview.md)

- [Попробуйте использовать Trend Micro Web Security с AAD](https://aad.portal.azure.com/)

- [Что такое управление сеансами в Microsoft Cloud App Security?](/cloud-app-security/proxy-intro-aad)

- [Сведения о защите приложений с помощью управления настройками условного доступа](/cloud-app-security/proxy-intro-aad)