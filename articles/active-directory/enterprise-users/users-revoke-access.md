---
title: Отзыв доступа пользователей в экстренной ситуации Azure Active Directory | Документация Майкрософт
description: Отмена доступа для пользователя в Azure Active Directory
services: active-directory
ms.service: active-directory
ms.subservice: enterprise-users
ms.workload: identity
ms.topic: how-to
author: curtand
ms.author: curtand
manager: daveba
ms.reviewer: krbain
ms.date: 12/02/2020
ms.custom: it-pro
ms.collection: M365-identity-device-management
ms.openlocfilehash: 826ca9fc20d8bbcf9a5f90ccc895b9f9867a6be1
ms.sourcegitcommit: 867cb1b7a1f3a1f0b427282c648d411d0ca4f81f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "96860581"
---
# <a name="revoke-user-access-in-azure-active-directory"></a>Отозвать доступ пользователей в Azure Active Directory

В сценариях, которые могут потребовать от администратора отмены всех прав доступа для пользователя, относятся скомпрометированные учетные записи, увольнение сотрудников и другие угрозы для предварительной оценки. В зависимости от сложности среды администраторы могут предпринять несколько шагов, чтобы обеспечить отзыв доступа. В некоторых сценариях может существовать период между инициацией обращения к доступу и при эффективном отзыве доступа.

Чтобы снизить риски, необходимо понимать, как работают маркеры. Существует много видов токенов, которые относятся к одному из шаблонов, упомянутых в следующих разделах.

## <a name="access-tokens-and-refresh-tokens"></a>Маркеры доступа и маркеры обновления

Маркеры доступа и маркеры обновления часто используются с толстыми клиентскими приложениями, а также в приложениях на основе браузера, таких как одностраничные приложения.

- При проверке подлинности пользователей в Azure AD политики авторизации оцениваются, чтобы определить, может ли пользователь предоставить доступ к определенному ресурсу.  

- В случае авторизации Azure AD выдает маркер доступа и маркер обновления для ресурса.  

- Маркеры доступа, выданные Azure AD по умолчанию, последний раз в течение 1 часа. Если протокол проверки подлинности разрешает, приложение может автоматически повторно пройти проверку подлинности пользователя, передав маркер обновления в Azure AD по истечении срока действия маркера доступа.

Затем Azure AD переоценивает политики авторизации. Если пользователь все еще является полномочным, Azure AD выдает новый маркер доступа и маркер обновления.

Маркеры доступа могут представлять проблему безопасности, если доступ должен быть отозван в течение времени, меньшего времени существования маркера, что обычно занимает около часа. По этой причине корпорация Майкрософт активно работает над обеспечением [непрерывного доступа](../conditional-access/concept-continuous-access-evaluation.md) для Microsoft 365 приложений, что помогает обеспечить недействительность маркеров доступа практически в реальном времени.  

## <a name="session-tokens-cookies"></a>Токены сеансов (файлы cookie)

Большинство приложений на основе браузеров используют токены сеанса вместо маркеров доступа и обновления.  

- Когда пользователь открывает браузер и выполняет проверку подлинности в приложении через Azure AD, он получает два токена сеанса. Один из Azure AD и другой из приложения.  

- Когда приложение выдает собственный маркер сеанса, доступ к приложению регулируется сеансом приложения. На этом этапе на пользователя влияют только те политики авторизации, которые знают приложение.

- Политики авторизации Azure AD повторно оцениваются так часто, как приложение отправляет пользователя обратно в Azure AD. Повторная оценка обычно происходит автоматически, хотя частота зависит от настройки приложения. Возможно, приложение никогда не отправляет пользователя обратно в Azure AD, пока маркер сеанса является допустимым.

- Чтобы токен сеанса был отозван, приложение должно отозвать доступ на основе собственных политик авторизации. Azure AD не может напрямую отозвать маркер сеанса, выданный приложением.  

## <a name="revoke-access-for-a-user-in-the-hybrid-environment"></a>Отмена доступа для пользователя в гибридной среде

Для гибридной среды, в которой локальная Active Directory синхронизирована с Azure Active Directory, корпорация Майкрософт рекомендует ИТ-администраторам выполнять следующие действия.  

### <a name="on-premises-active-directory-environment"></a>Локальная среда Active Directory

В качестве администратора в Active Directory подключитесь к локальной сети, откройте PowerShell и выполните следующие действия.

1. Отключите пользователя в Active Directory. Дополнительные сведения см. в разделе [Disable-адаккаунт](/powershell/module/addsadministration/disable-adaccount).

    ```PowerShell
    Disable-ADAccount -Identity johndoe  
    ```

1. Дважды сбросьте пароль пользователя в Active Directory. Обратитесь к командлету [Set-адаккаунтпассворд](/powershell/module/addsadministration/set-adaccountpassword).

    > [!NOTE]
    > Изменение пароля пользователя в два раза заключается в снижении риска передаваемого хэша, особенно при наличии задержек в локальной репликации паролей. Если вы можете безопасно предположить, что эта учетная запись не скомпрометирована, вы можете сбросить пароль только один раз.

    > [!IMPORTANT] 
    > Не используйте примеры паролей в следующих командлетах. Не забудьте изменить пароли на случайные строки.

    ```PowerShell
    Set-ADAccountPassword -Identity johndoe -Reset -NewPassword (ConvertTo-SecureString -AsPlainText "p@ssw0rd1" -Force)
    Set-ADAccountPassword -Identity johndoe -Reset -NewPassword (ConvertTo-SecureString -AsPlainText "p@ssw0rd2" -Force)
    ```

### <a name="azure-active-directory-environment"></a>Среда Azure Active Directory

В качестве администратора в Azure Active Directory откройте PowerShell, выполните ``Connect-AzureAD`` и выполните следующие действия.

1. Отключите пользователя в Azure AD. Обратитесь к командлету [Set-AzureADUser](/powershell/module/azuread/Set-AzureADUser).

    ```PowerShell
    Set-AzureADUser -ObjectId johndoe@contoso.com -AccountEnabled $false
    ```
1. Отозвать маркеры обновления Azure AD пользователя. Дополнительные сведения см. в разделе [REVOKE-азуреадусераллрефрештокен](/powershell/module/azuread/revoke-azureaduserallrefreshtoken).

    ```PowerShell
    Revoke-AzureADUserAllRefreshToken -ObjectId johndoe@contoso.com
    ```

1. Отключите устройства пользователя. См. статью [Get-азуреадусеррегистереддевице](/powershell/module/azuread/get-azureaduserregistereddevice).

    ```PowerShell
    Get-AzureADUserRegisteredDevice -ObjectId johndoe@contoso.com | Set-AzureADDevice -AccountEnabled $false
    ```

## <a name="optional-steps"></a>Другие возможные шаги

- [Очистка корпоративных данных из приложений, управляемых Intune](/mem/intune/apps/apps-selective-wipe).

- [Для очистки корпоративных устройств необходимо сбросить параметры устройства до заводских настроек по умолчанию](/mem/intune/remote-actions/devices-wipe).

> [!NOTE]
> Данные на устройстве невозможно восстановить после очистки.

## <a name="when-access-is-revoked"></a>При отмене доступа

После того как администраторы выберут указанные выше действия, пользователь не сможет получить новые маркеры для любого приложения, привязанного к Azure Active Directory. Время, прошедшее между вызовом и потерей доступа, зависит от того, как приложение предоставляет доступ:

- Для **приложений, использующих маркеры доступа**, пользователь теряет доступ при истечении срока действия маркера доступа.

- Для **приложений, использующих маркеры сеанса**, существующие сеансы завершаются после истечения срока действия маркера. Если отключенное состояние пользователя синхронизировано с приложением, приложение может автоматически отозвать существующие сеансы пользователя, если оно настроено для этого.  Время, необходимое для работы, зависит от частоты синхронизации между приложением и Azure AD.

## <a name="next-steps"></a>Дальнейшие действия

- [Рекомендации по обеспечению безопасного доступа для администраторов Azure AD](../roles/security-planning.md)
- [Добавление или обновление сведений о профиле пользователя](../fundamentals/active-directory-users-profile-azure-portal.md)
