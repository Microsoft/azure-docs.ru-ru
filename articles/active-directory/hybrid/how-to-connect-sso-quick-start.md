---
title: 'Azure AD Connect: простое одноSign-Onное краткое руководство | Документация Майкрософт'
description: В этой статье описывается, как приступить к работе простым единым входом Azure Active Directory.
services: active-directory
keywords: что такое Azure AD Connect, установка Active Directory, необходимые компоненты для Azure AD, единый вход
documentationcenter: ''
author: billmath
manager: daveba
ms.assetid: 9f994aca-6088-40f5-b2cc-c753a4f41da7
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: how-to
ms.date: 04/16/2019
ms.subservice: hybrid
ms.author: billmath
ms.collection: M365-identity-device-management
ms.openlocfilehash: c320c8497506a0269e65cd79e18aea1972354729
ms.sourcegitcommit: 772eb9c6684dd4864e0ba507945a83e48b8c16f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "104589528"
---
# <a name="azure-active-directory-seamless-single-sign-on-quickstart"></a>Azure Active Directory простой единый вход: Краткое руководство

## <a name="deploy-seamless-single-sign-on"></a>Развертывание простого единого входа

Простой единый вход Azure Active Directory (Azure AD) автоматически обеспечивает пользователям вход в систему, когда они работают на корпоративных компьютерах, подключенных к корпоративной сети. Данная функция предоставляет пользователям удобный доступ к облачным приложениям и не требует установки каких-либо дополнительных локальных компонентов.

Чтобы развернуть прозрачный единый вход, выполните следующие действия.

## <a name="step-1-check-the-prerequisites"></a>Шаг 1. Проверка соблюдения предварительных требований

Выполните указанные ниже предварительные требования.

* **Настройка сервера Azure AD Connect**. Если в качестве метода входа вы используете [сквозную аутентификацию](how-to-connect-pta.md), никакие дополнительные проверки предварительных требований не нужны. Если вы используете [синхронизацию хэшей паролей](how-to-connect-password-hash-synchronization.md) в качестве метода входа и при наличии брандмауэра между Azure AD Connect и Azure AD, убедитесь, что:
   - Используется Azure AD Connect версии 1.1.644.0 или более поздней версии. 
   - Если брандмауэр или прокси-сервер допускает, добавьте подключения к списку разрешенных URL-адресов **\* msappproxy.NET** через порт 443. Если для настройки прокси-сервера требуется конкретный URL-адрес, а не подстановочный знак, можно настроить **tenantid.Registration.msappproxy.NET**, где tenantid — это идентификатор GUID клиента, на котором настраивается функция. Если в вашей организации могут возобновляться исключения прокси-сервера на основе URL-адресов, можно разрешить доступ к [диапазонам IP-адресов центра обработки данных Azure](https://www.microsoft.com/download/details.aspx?id=41653), которые обновляются еженедельно. Это предварительное условие применяется только в том случае, если вы включаете функцию. Его выполнение не обязательно для фактического входа пользователя.

    >[!NOTE]
    >В Azure AD Connect версий 1.1.557.0, 1.1.558.0, 1.1.561.0 и 1.1.614.0 есть проблема, связанная с синхронизацией хэшей паролей. Если вы _не_ планируете использовать синхронизацию хэша паролей в сочетании с сквозной проверкой подлинности, ознакомьтесь с [заметками о выпуске Azure AD Connect](./reference-connect-version-history.md) , чтобы получить дополнительные сведения.
    
    >[!NOTE]
    >Если у вас есть исходящий прокси-сервер HTTP, убедитесь, что этот URL-адрес, autologon.microsoftazuread-sso.com, является список разрешений. Этот URL-адрес следует указать явно, так как подстановочный знак не может быть принят. 

* **Использование поддерживаемой топологии Azure AD Connect**. Убедитесь, что вы используете одну из поддерживаемых топологий Azure AD Connect, описанных [здесь](plan-connect-topologies.md).

    >[!NOTE]
    >Простой единый вход поддерживает несколько лесов AD, вне зависимости от того, существуют ли между ними отношения доверия AD.

* **Настройка учетных данных администратора домена**. Необходимы учетные данные администратора домена для каждого леса Active Directory, который:
    * синхронизируется с Azure AD через Azure AD Connect;
    * содержит пользователей, для которых нужно включить простой единый вход.
    
* **Включение современной аутентификации**. Для работы этой функции необходимо включить [современную аутентификацию](/office365/enterprise/modern-auth-for-office-2013-and-2016) на клиенте.

* **Используйте последние версии Microsoft 365 клиентов**: чтобы получить возможность автоматического входа с помощью Microsoft 365 клиентов (Outlook, Word, Excel и др.), пользователям необходимо использовать версии 16.0.8730. xxxx или более поздней.

## <a name="step-2-enable-the-feature"></a>Шаг 2. Включение компонента

Включите простой единый вход через [Azure AD Connect](whatis-hybrid-identity.md).

>[!NOTE]
> Вы также можете [включить простой единый вход с помощью PowerShell](tshoot-connect-sso.md#manual-reset-of-the-feature), если Azure AD Connect не соответствует вашим требованиям. Используйте этот параметр, если у вас есть несколько доменов на один лес Active Directory и вы хотите точнее определить домен, для которого необходимо включить простой единый вход.

В случае выполнения новой установки Azure AD Connect выберите [пользовательский путь установки](how-to-connect-install-custom.md). На странице **Вход пользователя** установите флажок **Включить единый вход**.

>[!NOTE]
> Этот флажок можно будет установить, если для единого входа используется метод **Синхронизация хэшей паролей** или **Сквозная проверка подлинности**.

![Azure AD Connect: страница "Вход пользователя"](./media/how-to-connect-sso-quick-start/sso8.png)

Если уже имеется установленный экземпляр Azure AD Connect, выберите страницу **Смена имени пользователя для входа** в Azure AD Connect и нажмите кнопку **Далее**. Если используется Azure AD Connect версии 1.1.880.0 или выше, флажок **Включить единый вход** будет установлен по умолчанию. Если же вы используете предыдущие версии Azure AD Connect, установите флажок **Включить единый вход**.

![Azure AD Connect: страница "Смена имени пользователя для входа"](./media/how-to-connect-sso-quick-start/changeusersignin.png)

Продолжайте работу с мастером до перехода на страницу **Включение единого входа** . Укажите учетные данные администратора домена для каждого леса Active Directory, который:

* синхронизируется с Azure AD через Azure AD Connect;
* содержит пользователей, для которых нужно включить простой единый вход.

После завершения работы мастера на вашем клиенте будет включен простой единый вход.

>[!NOTE]
> Учетные данные администратора домена не хранятся в Azure AD Connect или в Azure AD. Они используются только для включения функции.

Выполните следующие инструкции, чтобы проверить, правильно ли включен простой единый вход.

1. Войдите в [центр администрирования Azure Active Directory](https://aad.portal.azure.com), используя учетные данные глобального администратора для своего клиента.
2. В области слева выберите **Azure Active Directory**.
3. Выберите **Azure AD Connect**.
4. Убедитесь, что функция **Эффективный единый вход****включена**.

![Портал Azure: область "Azure AD Connect"](./media/how-to-connect-sso-quick-start/sso10.png)

>[!IMPORTANT]
> Простой единый вход создает учетную запись компьютера с именем `AZUREADSSOACC` в локальном Active Directory (AD) в каждом лесу AD. `AZUREADSSOACC`Учетная запись компьютера должна быть строго защищена по соображениям безопасности. Только администраторы домена должны иметь возможность управлять учетной записью компьютера. Убедитесь, что делегирование Kerberos для учетной записи компьютера отключено и что другие учетные записи в Active Directory не имеют разрешений на делегирование `AZUREADSSOACC` учетной записи компьютера. Храните учетную запись компьютера в подразделении (OU), где они защищены от случайного удаления и когда доступ имеют только администраторы домена.

>[!NOTE]
> Если вы используете в локальной среде архитектуру защиты от имени и кражи учетных данных, внесите соответствующие изменения, чтобы убедиться, что `AZUREADSSOACC` учетная запись компьютера не находится в карантинном контейнере. 

## <a name="step-3-roll-out-the-feature"></a>Шаг 3. Развертывание компонента

Вы можете постепенно развертывать простой единый вход для пользователей с помощью инструкций, приведенных ниже. Сначала нужно добавить приведенный ниже URL-адрес Azure AD в параметры зоны интрасети всех или выбранных пользователей с помощью групповой политики Active Directory.

- `https://autologon.microsoftazuread-sso.com`

Кроме того, необходимо включить параметр политики зоны интрасети (с помощью групповой политики), который называется **Разрешить обновление строки состояния в сценарии**. 

>[!NOTE]
> Приведенные ниже инструкции работают только с Internet Explorer, Microsoft ребр и Google Chrome в Windows (если он использует набор URL-адресов надежных сайтов с Internet Explorer). В следующем разделе приведены инструкции по настройке Mozilla Firefox и Google Chrome для macOS.

### <a name="why-do-you-need-to-modify-users-intranet-zone-settings"></a>Зачем нужно изменять параметры зоны интрасети пользователей?

По умолчанию браузер автоматически вычисляет соответствующую зону (Интернета или интрасети) по конкретному URL-адресу. Например, `http://contoso/` сопоставляется с зоной интрасети, а `http://intranet.contoso.com/` — с зоной Интернета (так как этот URL-адрес содержит точку). Браузеры не будут отправлять билеты Kerberos в облачную конечную точку (как URL-адрес Azure AD), если только ее URL-адрес не добавлен явным образом в зону интрасети в браузере.

Существуют два способа изменения параметров зоны интрасети пользователей.

| Параметр | Решение администратора | Возможности для пользователя |
| --- | --- | --- |
| Групповая политика | Администратор блокирует изменение параметров зоны интрасети. | Пользователи не могут изменить свои параметры. |
| Предпочтение групповой политики |  Администратор разрешает изменение параметров зоны интрасети. | Пользователи могут изменить свои параметры. |

### <a name="group-policy-option---detailed-steps"></a>Параметр "Групповая политика:" подробные инструкции

1. Откройте редактор "Управление групповыми политиками".
2. Измените групповую политику, которая применяется к некоторым или всем пользователям. В этом примере используется **политика домена по умолчанию**.
3. Перейдите к   >  **политикам** конфигурации пользователей  >  **Административные шаблоны**  >  **компоненты Windows**  >  **Internet Explorer**  >  Страница Безопасность **панели управления Интернет**  >  . Выберите **Список назначений зоны для веб-сайтов**.
    ![Снимок экрана, на котором показана страница "безопасность" с выбранным параметром "сайт в список назначений зоны".](./media/how-to-connect-sso-quick-start/sso6.png)
4. Включите политику и введите следующие значения в диалоговом окне.
   - **Имя значения**. Это URL-адрес Azure AD, на который пересылаются билеты Kerberos.
   - **Значение** (данные). **1** указывает зону интрасети.

     Результат имеет следующий вид:

     Имя значения: `https://autologon.microsoftazuread-sso.com`
  
     Значение (данные): 1

   >[!NOTE]
   > Если вы хотите запретить отдельным пользователям использовать простой единый вход, например, если эти пользователи выполняют вход на общедоступных киосках, установите для указанных выше параметров значение **4**. Это действие добавляет URL-адрес Azure AD в зону с ограниченным доступом и блокирует все попытки простого единого входа.
   >

5. Щелкните **ОК**, а затем снова **ОК**.

    ![Снимок экрана, на котором показано окно "Показать содержимое" с выбранным назначением зоны.](./media/how-to-connect-sso-quick-start/sso7.png)

6. Перейдите к   >  **политикам** конфигурации пользователей  >  **Административные шаблоны**  >  **компоненты Windows**  >  **Internet Explorer** Интернет  >  **Панель управления**  >  **Страница Безопасность**  >  **зона интрасети**. Выберите **Разрешить обновление строки состояния в сценарии**.

    ![Снимок экрана, на котором отображается страница "зона интрасети" с выбранным параметром "разрешить обновления в строке состояния с помощью сценария".](./media/how-to-connect-sso-quick-start/sso11.png)

7. Включите параметр политики и нажмите кнопку **ОК**.

    ![Снимок экрана с включенным параметром политики "разрешить обновления в строке состояния с помощью сценария".](./media/how-to-connect-sso-quick-start/sso12.png)

### <a name="group-policy-preference-option---detailed-steps"></a>Параметр "Предпочтение групповой политики:" подробные инструкции

1. Откройте редактор "Управление групповыми политиками".
2. Измените групповую политику, которая применяется к некоторым или всем пользователям. В этом примере используется **политика домена по умолчанию**.
3. Перейдите к параметрам **конфигурации пользователя**  >    >  **Параметры Windows**  >  **Реестр**  >  **Новый**  >  **элемент реестра**.

    ![Снимок экрана с выбранным параметром "реестр" и выбранным параметром "элемент реестра".](./media/how-to-connect-sso-quick-start/sso15.png)

4. Введите в соответствующие поля приведенные ниже значения и нажмите кнопку **ОК**.
   - **Путь к ключу**: **_софтваре\микрософт\виндовс\куррентверсион\интернет сеттингс\зонемап\домаинс\микрософтазуреад-ССО.ком\аутологон_**
   - **Имя значения**: **_HTTPS_**
   - **Тип значения**: **_REG_DWORD_**
   - **Данные значения**: **_00000001_ .**
 
     ![Снимок экрана, показывающий окно "Свойства нового реестра".](./media/how-to-connect-sso-quick-start/sso16.png)
 
     ![Единый вход](./media/how-to-connect-sso-quick-start/sso17.png)

### <a name="browser-considerations"></a>Рекомендации для браузера

#### <a name="mozilla-firefox-all-platforms"></a>Mozilla Firefox (все платформы)

Mozilla Firefox не выполняет аутентификацию Kerberos автоматически. Каждый пользователь должен вручную добавить URL-адрес Azure AD в параметры Firefox, выполнив следующие действия:
1. Запустите Firefox и введите `about:config` в адресной строке. Проигнорируйте все отображаемые уведомления.
2. Найдите параметр **network.negotiate-auth.trusted-uris**. Этот параметр выводит список доверенных сайтов в Firefox для проверки подлинности Kerberos.
3. Щелкните правой кнопкой мыши и выберите **изменить**.
4. Введите `https://autologon.microsoftazuread-sso.com` в поле.
5. Нажмите кнопку **ОК** и вновь откройте браузер.

#### <a name="safari-macos"></a>Safari (macOS)

Убедитесь, что компьютер под управлением macOS присоединен к Active Directory. Инструкции по присоединению устройства macOS к AD выходят за рамки данной статьи.

#### <a name="microsoft-edge-based-on-chromium-all-platforms"></a>Microsoft Edge на базе Chromium (все платформы)

Если вы переопределили параметры политики [ауснеготиатеделегатеалловлист](/DeployEdge/microsoft-edge-policies#authnegotiatedelegateallowlist) или [ауссервералловлист](/DeployEdge/microsoft-edge-policies#authserverallowlist) в своей среде, убедитесь, что вы также добавили URL-адрес Azure AD ( `https://autologon.microsoftazuread-sso.com` ).

#### <a name="microsoft-edge-based-on-chromium-macos-and-other-non-windows-platforms"></a>Microsoft ребро на основе Chromium (macOS и других платформ, отличных от Windows)

Сведения о том, как добавить URL-адрес Azure AD для встроенной проверки подлинности в список разрешений, см. в [статье Microsoft ребр](/DeployEdge/microsoft-edge-policies#authserverallowlist) на основе Chromium на macOS и других платформах, отличных от Windows.

#### <a name="google-chrome-all-platforms"></a>Google Chrome (все платформы)

Если вы переопределили параметры политики [AuthNegotiateDelegateWhitelist](https://www.chromium.org/administrators/policy-list-3#AuthNegotiateDelegateWhitelist) или [AuthServerWhitelist](https://www.chromium.org/administrators/policy-list-3#AuthServerWhitelist) в своей среде, обязательно добавьте к ним URL-адрес Azure AD (`https://autologon.microsoftazuread-sso.com`).

#### <a name="google-chrome-macos-and-other-non-windows-platforms"></a>Google Chrome (macOS и другие платформы, кроме Windows)

Для Google Chrome на macOS и других платформах, отличных от Windows, см. [список политики проекта Chromium](https://dev.chromium.org/administrators/policy-list-3#AuthServerWhitelist) для получения сведений о том, как управлять списком разрешений для URL-адреса Azure AD для встроенной проверки подлинности.

Применение сторонних расширений групповой политики Active Directory для развертывания URL-адреса Azure AD для Firefox и Google Chrome на платформе Mac в этой статье не рассматривается.

#### <a name="known-browser-limitations"></a>Известные ограничения браузеров

Простой единый вход не работает в частном режиме обзора в браузерах Firefox и Microsoft (прежних версий). а также в Internet Explorer, если браузер работает в режиме повышенной защиты. Простой единый вход поддерживает следующую версию Microsoft ребра, основанную на Chromium, и работает в режиме InPrivate и гостевого режима по проекту.

## <a name="step-4-test-the-feature"></a>Шаг 4. Тестирование компонента

Чтобы проверить функцию для конкретного пользователя, убедитесь, что соблюдаются все следующие условия:
  - Пользователь выполняет вход на корпоративном устройстве.
  - Это устройство присоединено к домену Active Directory. Устройство _не_ требуется [присоединять к Azure AD](../devices/overview.md).
  - У него должно быть прямое подключение к контроллеру домена по корпоративной проводной или беспроводной сети или через подключение удаленного доступа, например VPN-подключение.
  - Вы [развернули функцию](#step-3-roll-out-the-feature) для этого пользователя с помощью групповой политики.

Для тестирования сценария, когда пользователь вводит только имя пользователя, но не пароль.
   - Войдите в " https://myapps.microsoft.com/ . Не забудьте очистить кэш браузера или использовать новый частный сеанс браузера с любым из поддерживаемых браузеров в частном режиме.

Для тестирования сценария, когда пользователю не нужно вводить имя пользователя или пароль, выполните один из следующих шагов. 
   - Войдите в систему, чтобы `https://myapps.microsoft.com/contoso.onmicrosoft.com` не забудьте очистить кэш браузера или использовать новый частный сеанс браузера с любым из поддерживаемых браузеров в частном режиме. Замените *contoso* именем своего клиента.
   - Войдите в `https://myapps.microsoft.com/contoso.com` в новом частном сеансе браузера. Введите вместо *contoso.com* проверенный домен (не федеративный домен) в клиенте.

## <a name="step-5-roll-over-keys"></a>Шаг 5. Смена ключей

На шаге 2 Azure AD Connect создает учетные записи компьютеров (представляющие Azure AD) во всех лесах Active Directory, для которых включен простой единый вход. Чтобы узнать больше, изучите [Подробное техническое руководство по простому единому входу Azure Active Directory](how-to-connect-sso-how-it-works.md).

>[!IMPORTANT]
>В случае утечки ключ расшифровки Kerberos в учетной записи компьютера можно использовать для создания билетов Kerberos для любого пользователя в его лесу AD. Злоумышленники могут олицетворять операции входа Azure AD для скомпрометированных пользователей. Мы настоятельно рекомендуем, чтобы вы периодически меняли ключ расшифровки Kerberos (хотя бы раз в 30 дней).

Инструкции по смене ключей приведены в разделе [Часто задаваемые вопросы о простом едином входе Azure Active Directory](how-to-connect-sso-faq.md). Мы работаем над возможностью автоматического развертывания ключей.

>[!IMPORTANT]
>Этот шаг не требуется выполнять _немедленно_ после включения функции. Меняйте ключи расшифровки Kerberos по крайней мере каждые 30 дней.

## <a name="next-steps"></a>Дальнейшие действия

- [Подробное техническое руководство](how-to-connect-sso-how-it-works.md). Поймите, как работает функция простого единого входа.
- [Часто задаваемые вопросы](how-to-connect-sso-faq.md). Получите ответы на часто задаваемые вопросы о простом едином входе.
- [Устранение неполадок](tshoot-connect-sso.md). Узнайте, как устранять распространенные проблемы с функцией простого единого входа.
- [UserVoice](https://feedback.azure.com/forums/169401-azure-active-directory/category/160611-directory-synchronization-aad-connect). Оставить запрос на новые функции можно на форуме по Azure Active Directory.
