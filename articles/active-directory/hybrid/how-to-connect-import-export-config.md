---
title: Импорт и экспорт параметров конфигурации Azure AD Connect
description: В этой статье описываются часто задаваемые вопросы о подготовке облака.
services: active-directory
author: billmath
manager: daveba
ms.service: active-directory
ms.workload: identity
ms.topic: how-to
ms.date: 07/13/2020
ms.subservice: hybrid
ms.author: billmath
ms.collection: M365-identity-device-management
ms.openlocfilehash: d67460c654c854c5a855560dde1d67732fa818c7
ms.sourcegitcommit: 910a1a38711966cb171050db245fc3b22abc8c5f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "98681961"
---
# <a name="import-and-export-azure-ad-connect-configuration-settings"></a>Импорт и экспорт Azure AD Connect параметров конфигурации 

Azure Active Directory (Azure AD) Connect deployments отличаются от установки единого леса в режиме экспресс-развертывания до сложных развертываний, синхронизируемых в нескольких лесах с помощью настраиваемых правил синхронизации. Из-за большого количества параметров и механизмов конфигурации важно понимать, какие параметры действуют и могут быстро развернуть сервер с идентичной конфигурацией. Эта функция предоставляет возможность каталогизации конфигурации данного сервера синхронизации и импорта параметров в новое развертывание. Можно сравнивать разные моментальные снимки параметров синхронизации, чтобы легко визуализировать различия между двумя серверами или одним сервером с течением времени.

Каждый раз, когда конфигурация изменяется с помощью мастера Azure AD Connect, новый файл параметров JSON с отметкой времени автоматически экспортируется в **%ProgramData%\AADConnect**. Имя файла параметров имеет вид, примененный к формату **синчронизатионполици-*. JSON**, где последняя часть имени файла — это метка времени.

> [!IMPORTANT]
> Автоматически экспортируются только изменения, внесенные Azure AD Connect. Любые изменения, внесенные с помощью PowerShell, Synchronization Service Manager или редактор правил синхронизации, необходимо экспортировать по требованию, чтобы поддерживать актуальную копию. Экспорт по запросу также можно использовать для размещения копии параметров в безопасном месте для аварийного восстановления.

## <a name="export-azure-ad-connect-settings"></a>Экспорт параметров Azure AD Connect 

Чтобы просмотреть сводку параметров конфигурации, откройте средство Azure AD Connect и выберите дополнительную задачу с именем **Просмотр или экспорт текущей конфигурации**. Кроме того, в нем отображается краткая сводка параметров, а также возможность экспорта полной конфигурации сервера.

По умолчанию параметры экспортируются в **%ProgramData%\AADConnect**. Вы также можете сохранить параметры в защищенном расположении, чтобы обеспечить доступность в случае аварии. Параметры экспортируются с помощью формата JSON и не должны создаваться вручную или редактироваться для обеспечения логической согласованности. Импорт созданного вручную или измененного файла не поддерживается и может привести к непредвиденным результатам.

## <a name="import-azure-ad-connect-settings"></a>Импорт параметров Azure AD Connect

Чтобы импортировать ранее экспортированные параметры, выполните следующие действия.
 
1. Установите **Azure AD Connect** на новом сервере.
1. Выберите параметр **Настройка** после страницы **приветствия** .
1. Выберите **Импорт параметров синхронизации**. Найдите ранее экспортированный файл параметров JSON.
1. Нажмите кнопку **Установить**.

   ![Снимок экрана, на котором показаны компоненты, необходимые для установки](media/how-to-connect-import-export-config/import1.png)

> [!NOTE]
> Переопределите параметры на этой странице, такие как использование SQL Server вместо LocalDB или использование существующей учетной записи службы вместо VSA по умолчанию. Эти параметры не импортируются из файла параметров конфигурации. Они предназначены для получения сведений и сравнения.

### <a name="import-installation-experience"></a>Импорт процесса установки 

Процесс установки импорта намеренно сохраняется с минимальными входными данными пользователя, что позволяет легко предоставить воспроизводимость существующего сервера.

Ниже приведены единственные изменения, которые могут быть сделаны во время установки. Все остальные изменения могут быть сделаны после установки из мастера Azure AD Connect.
- **Azure Active Directory учетные данные**. имя учетной записи глобального администратора Azure, используемое для настройки исходного сервера, предлагается по умолчанию. Его *необходимо*   изменить, если требуется синхронизировать данные с новым каталогом.
- **Вход пользователя**. параметры входа, настроенные для исходного сервера, выбираются по умолчанию и автоматически запрашивают учетные данные или другие сведения, необходимые во время настройки. В редких случаях может потребоваться настроить сервер с разными параметрами, чтобы избежать изменения поведения активного сервера. В противном случае нажмите кнопку **Далее** , чтобы использовать те же параметры.
- **Учетные данные локального каталога**. для каждого локального каталога, включенного в параметры синхронизации, необходимо предоставить учетные данные для создания учетной записи синхронизации или предоставить предварительно созданную настраиваемую учетную запись синхронизации. Эта процедура идентична возможности чистой установки с исключением, которое не позволяет добавлять или удалять каталоги.
- **Параметры конфигурации**. как и при чистой установке, можно настроить начальные параметры для запуска автоматической синхронизации или включения промежуточного режима. Основное отличие состоит в том, что промежуточный режим намеренно включен по умолчанию, чтобы обеспечить сравнение конфигурации и результатов синхронизации до активного экспорта результатов в Azure.

![Снимок экрана, на котором показан экран подключения к каталогам](media/how-to-connect-import-export-config/import2.png)

> [!NOTE]
> Только один сервер синхронизации может находиться в первичной роли и активно экспортирует изменения конфигурации в Azure. Все остальные серверы должны быть переведены в промежуточный режим.

## <a name="migrate-settings-from-an-existing-server"></a>Перенос параметров с существующего сервера 

Если существующий сервер не поддерживает управление параметрами, можно либо обновить сервер на месте, либо перенести параметры для использования на новом промежуточном сервере.

Для миграции требуется запустить сценарий PowerShell, который извлекает существующие параметры для использования в новой установке.Используйте этот метод для каталогизации параметров существующего сервера и их применения к вновь установленному промежуточному серверу.Сравнение параметров исходного сервера с вновь созданным сервером позволяет быстро визуализировать изменения между серверами.Как всегда, следуйте процедуре сертификации организации, чтобы не требовалось никаких дополнительных настроек.

### <a name="migration-process"></a>Процесс миграции 
Чтобы перенести параметры, выполните следующие действия.

1. Запустите **AzureADConnect.msi** на новом промежуточном сервере и завершите работу на странице **приветствия** Azure AD Connect.

1. Скопируйте **MigrateSettings.ps1** из каталога Microsoft Azure AD коннект\тулс в расположение на существующем сервере. Например, C:\setup, где программа установки — это каталог, созданный на существующем сервере.

   ![Снимок экрана, на котором показаны Azure AD Connect каталоги.](media/how-to-connect-import-export-config/migrate1.png)

1. Запустите скрипт, как показано ниже, и сохраните весь каталог конфигурации сервера нижнего уровня. Скопируйте этот каталог на новый промежуточный сервер. Необходимо скопировать всю папку exportd **-серверконфигуратион-*** на новый сервер.

   ![Снимок экрана, на котором показан сценарий в Windows PowerShell. ](media/how-to-connect-import-export-config/migrate2.png)
    ![ Снимок экрана, на котором показано копирование экспортированной папки-Серверконфигуратион-*.](media/how-to-connect-import-export-config/migrate3.png)

1. Запустите **Azure AD Connect** , дважды щелкнув значок на рабочем столе. Примите условия лицензионного соглашения на использование программного обеспечения корпорации Майкрософт и на следующей странице щелкните **настроить**.
1. Установите флажок **импортировать параметры синхронизации** . Нажмите кнопку **Обзор** , чтобы просмотреть скопированную папку exportd-серверконфигуратион-*. Выберите MigratedPolicy.js, чтобы импортировать перенесенные параметры.

   ![Снимок экрана, на котором показан параметр Импорт параметров синхронизации.](media/how-to-connect-import-export-config/migrate4.png)

## <a name="post-installation-verification"></a>Проверка после установки 

Сравнение первоначально импортированного файла параметров с экспортированным файлом параметров нового развернутого сервера — важный шаг в понимании различий между предполагаемым и итоговым развертыванием. Используя любимое приложение для сравнения текста, можно получить мгновенное представление, в котором быстро выделяются все необходимые или случайные изменения.

Несмотря на то что многие действия по настройке, описанные выше, теперь устранены, вы по-прежнему должны следовать процессу сертификации организации, чтобы не требовать дополнительной настройки. Такая конфигурация может возникать при использовании дополнительных параметров, которые сейчас не были захвачены в этом выпуске управления параметрами.

Ниже приведены известные ограничения.
- **Правила синхронизации**. приоритет для настраиваемого правила должен быть в зарезервированном диапазоне от 0 до 99, чтобы избежать конфликтов с стандартными правилами Майкрософт. Размещение настраиваемого правила за пределами зарезервированного диапазона может привести к тому, что пользовательское правило переместится по мере добавления к конфигурации стандартных правил. Аналогичная ошибка возникает, если конфигурация содержит измененные стандартные правила. Не рекомендуется изменять стандартное правило, и размещение правил, скорее всего, будет неправильным.
- **Обратная запись устройств**. Эти параметры хранятся в каталоге. В настоящее время они не применяются во время настройки. Если функция обратной записи устройств была включена для исходного сервера, необходимо вручную настроить эту функцию на развернутом сервере.
- **Синхронизированные типы объектов**. Хотя можно ограничить список синхронизированных типов объектов (например, пользователей, контактов и групп) с помощью Synchronization Service Manager, эта функция сейчас не поддерживается с помощью параметров синхронизации. После завершения установки необходимо вручную применить расширенную конфигурацию.
- **Настраиваемые профили выполнения**. Хотя можно изменить набор профилей запуска по умолчанию с помощью Synchronization Service Manager, эта функция сейчас не поддерживается через параметры синхронизации. После завершения установки необходимо вручную применить расширенную конфигурацию.
- **Настройка иерархии подготовки**. Эта дополнительная функция Synchronization Service Manager не поддерживается через параметры синхронизации. После завершения первоначального развертывания его необходимо перенастроить вручную.
- **Службы федерации Active Directory (AD FS) (AD FS) и проверка подлинности PingFederate**: методы входа, связанные с этими функциями проверки подлинности, выбираются автоматически. Необходимо указать все остальные необходимые параметры конфигурации в интерактивном режиме.
- **Отключенное настраиваемое правило синхронизации будет импортировано как включенное**. отключенное настраиваемое правило синхронизации импортируется как включенное. Обязательно отключите его на новом сервере.

 ## <a name="next-steps"></a>Дальнейшие действия

- [Оборудование и предварительные требования](how-to-connect-install-prerequisites.md) 
- [Стандартные параметры](how-to-connect-install-express.md)
- [Настраиваемые параметры](how-to-connect-install-custom.md)
- [Установка агентов Azure AD Connect Health](how-to-connect-health-agent-install.md) 
