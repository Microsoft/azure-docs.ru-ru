---
title: Выборочная Синхронизация хэша паролей для Azure AD Connect
description: В этой статье описывается настройка и настройка выборочной синхронизации хэшей паролей для использования с Azure AD Connect.
services: active-directory
author: billmath
manager: daveba
ms.service: active-directory
ms.workload: identity
ms.topic: how-to
ms.date: 03/16/2021
ms.subservice: hybrid
ms.author: billmath
ms.reviewer: ''
ms.collection: M365-identity-device-management
ms.openlocfilehash: 248d5e163eb046edd130d69307a1c553d434b92d
ms.sourcegitcommit: 73d80a95e28618f5dfd719647ff37a8ab157a668
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/26/2021
ms.locfileid: "105604674"
---
# <a name="selective-password-hash-synchronization-configuration-for-azure-ad-connect"></a>Выборочная конфигурация синхронизации хэша паролей для Azure AD Connect

[Синхронизация хэшей паролей](whatis-phs.md) — один из методов входа, используемых для выполнения гибридной идентификации. Azure AD Connect синхронизирует хэш пользовательских паролей между локальным экземпляром службы Active Directory и облачным экземпляром службы Azure AD.  По умолчанию после установки синхронизация хэша паролей выполняется для всех синхронизируемых пользователей.

Если вы хотите исключить подмножество пользователей, исключающих синхронизацию хэша паролей с Azure AD, можно настроить выборочную синхронизацию хэшей паролей, выполнив инструкции, описанные в этой статье.

>[!Important]
> Мы поддерживаем изменение или использование служб синхронизации Azure AD Connect только в контексте официально задокументированных конфигураций или действий. Любая из этих конфигураций или действий может привести к несогласованному или неподдерживаемому состоянию Azure AD Connect синхронизации. В результате корпорация Майкрософт не гарантирует, что мы сможем предоставить эффективную техническую поддержку для таких развертываний. 


## <a name="consider-your-implementation"></a>Рассмотрите реализацию  
Чтобы сократить усилия по администрированию, необходимо сначала определить число объектов-пользователей, которые вы хотите исключить из синхронизации хэшей паролей. Проверьте, какие сценарии ниже, которые являются взаимоисключающими, соответствует вашим требованиям, чтобы выбрать подходящий вариант конфигурации.
- Если число **исключаемых** пользователей **меньше** числа **включаемых** пользователей, выполните действия, описанные в этом [разделе](#excluded-users-is-smaller-than-included-users).
- Если число **исключаемых** пользователей **превышает** число **включаемых** пользователей, выполните действия, описанные в этом [разделе](#excluded-users-is-larger-than-included-users).

> [!Important]
> Если выбран любой из выбранных параметров конфигурации, необходимая начальная синхронизация (полная синхронизация) для применения изменений будет выполнена автоматически при следующем цикле синхронизации.

> [!Important]
> Настройка выборочной синхронизации хэша паролей напрямую влияет на обратную запись паролей. Изменения паролей или сбросы паролей, инициированные в Azure Active Directory обратной записи в локальную Active Directory только в том случае, если пользователь находится в области синхронизации хэшей паролей. 

### <a name="the-admindescription-attribute"></a>Атрибут Админдескриптион
Оба сценария зависят от установки для атрибута Админдескриптион пользователей определенного значения.  Это позволяет применять правила и выполняет выборочную PHS работу.

|Сценарий|значение Админдескриптион|
|-----|-----|
|Исключенные пользователи меньше, чем включенные пользователи|фсфилтеред|
|Исключенные пользователи больше, чем включенные пользователи|фсинклудед|

Этот атрибут можно задать либо:

- Использование пользовательского интерфейса Active Directory пользователи и компьютеры
- с помощью `Set-ADUser` командлета PowerShell.  Дополнительные сведения см. в разделе [Set-ADUser](https://docs.microsoft.com/powershell/module/addsadministration/set-aduser).

 


### <a name="disable-the-synchronization-scheduler"></a>Отключить Планировщик синхронизации:
Перед запуском любого сценария необходимо отключить Планировщик синхронизации при внесении изменений в правила синхронизации.
 1. Запустите Windows PowerShell Enter.

     ```Set-ADSyncScheduler -SyncCycleEnabled $false``` 
 
2.  Убедитесь, что планировщик отключен, выполнив следующий командлет:
     
    ```Get-ADSyncScheduler```

Дополнительные сведения о планировщике см. в разделе [Планировщик синхронизации Azure AD Connect](how-to-connect-sync-feature-scheduler.md).




## <a name="excluded-users-is-smaller-than-included-users"></a>Исключенные пользователи меньше, чем включенные пользователи
В следующем разделе описано, как включить выборочную синхронизацию хэша паролей, если число **исключаемых** пользователей **меньше** числа **включаемых** пользователей.

>[!Important]
> Прежде чем продолжать, убедитесь, что Планировщик синхронизации отключен, как описано выше.

- Создание редактируемой копии объекта **in из AD — user AccountEnabled** с параметром **включения синхронизации хэша паролей** и определения ее фильтра области 
- Создайте другую редактируемую копию по умолчанию **в from AD-user AccountEnabled** с параметром **включить синхронизацию хэша паролей** и определить его фильтр области. 
- Повторное включение планировщика синхронизации 
- Задайте значение атрибута в Active Directory, которое было определено как атрибут определения области для пользователей, которым вы хотите разрешить синхронизацию хэшей паролей. 

>[!Important]
>Шаги по настройке выборочной синхронизации хэшированных паролей влияют только на пользовательские объекты, у которых атрибут **админдескриптион** заполнен в Active Directory со значением **фсфилтеред**.
Если этот атрибут не заполнен или значение отличается от **фсфилтеред** , то эти правила не будут применены к объектам-пользователям.


### <a name="configure-the-necessary-synchronization-rules"></a>Настройте необходимые правила синхронизации.

 1. Запустите редактор правил синхронизации и установите для параметра **Синхронизация паролей** значение **вкл** . в поле **тип правила** выберите значение **стандартный**.
     ![Запуск редактора правил синхронизации](media/how-to-connect-selective-password-hash-synchronization/exclude-1.png)
 2. Выберите правило **в from AD — user AccountEnabled** для соединителя леса Active Directory, для которого требуется настроить выборочный пароль, и нажмите кнопку **изменить**. Выберите **Да** в следующем диалоговом окне, чтобы создать редактируемую копию исходного правила.
     ![Выбор правила](media/how-to-connect-selective-password-hash-synchronization/exclude-2.png)
 3. Первое правило отключит синхронизацию хэша паролей. Укажите следующее имя для нового настраиваемого правила: **в из AD-user AccountEnabled — Фильтрация пользователей из PHS**.
 Измените значение приоритета на число ниже 100 (например, **90** или какое-либо наименьшее значение, доступное в вашей среде).
 Убедитесь, что флажки **включить синхронизацию паролей** и **отключены** , и c.
 Нажмите кнопку **Далее**.
  ![Изменить входящее](media/how-to-connect-selective-password-hash-synchronization/exclude-3.png)
 4. В **фильтре области** нажмите кнопку **Добавить предложение**.
 В столбце Атрибут выберите **админдескриптион** , **равное** в столбце Оператор, и введите **фсфилтеред** в качестве значения.
     ![Фильтр области](media/how-to-connect-selective-password-hash-synchronization/exclude-4.png)
 5. Дальнейшие изменения не требуются. Правила и **преобразования** **Присоединение** должны быть оставлены скопированными параметрами по умолчанию, чтобы можно было нажать кнопку **сохранить** сейчас.
 Нажмите кнопку **ОК** в диалоговом окне предупреждения, чтобы выполнить полную синхронизацию, в следующем цикле синхронизации соединителя.
     ![Сохранить правило](media/how-to-connect-selective-password-hash-synchronization/exclude-5.png)
 6. Затем создайте другое настраиваемое правило с включенной синхронизацией хэшей паролей. Выберите еще раз правило по умолчанию **в from AD — user AccountEnabled** для леса Active Directory, для которого требуется настроить выборочный пароль, и нажмите кнопку **изменить**. Выберите **Да** в следующем диалоговом окне, чтобы создать редактируемую копию исходного правила.
     ![Пользовательское правило](media/how-to-connect-selective-password-hash-synchronization/exclude-6.png)
 7. Укажите следующее имя для нового настраиваемого правила: **в из AD-user AccountEnabled — пользователи, входящие в PHS**.
 Измените значение приоритета на число ниже ранее созданного правила (в этом примере это будет **89**).
 Убедитесь, что установлен флажок **включить синхронизацию паролей** и снят флажок **отключено** .
 Нажмите кнопку **Далее**.  
     ![Изменить новое правило](media/how-to-connect-selective-password-hash-synchronization/exclude-7.png)
 8. В **фильтре области** нажмите кнопку **Добавить предложение**.
 Выберите **админдескриптион** в столбце атрибут, **NOTEQUAL** в столбце Оператор и введите **фсфилтеред** в качестве значения.
     ![Правило области](media/how-to-connect-selective-password-hash-synchronization/exclude-8.png)
 9. Дальнейшие изменения не требуются. Правила и **преобразования** **Присоединение** должны быть оставлены скопированными параметрами по умолчанию, чтобы можно было нажать кнопку **сохранить** сейчас.
 Нажмите кнопку **ОК** в диалоговом окне предупреждения, чтобы выполнить полную синхронизацию, в следующем цикле синхронизации соединителя.
     ![Правила объединения](media/how-to-connect-selective-password-hash-synchronization/exclude-9.png)
 10. Подтвердите создание правил. Удалите фильтры для **синхронизации паролей** **по** **стандарту** и **типу правила** . Вы должны увидеть оба новых правила, которые вы только что создали.
     ![Подтверждение правил](media/how-to-connect-selective-password-hash-synchronization/exclude-10.png) 


### <a name="re-enable-synchronization-scheduler"></a>Повторно включить Планировщик синхронизации:  
После завершения действий по настройке необходимых правил синхронизации повторно включите Планировщик синхронизации, выполнив следующие действия.
 1. В Windows PowerShell выполните следующие действия.

     ```Set-ADSyncScheduler -SyncCycleEnabled $true```
 2. Затем подтвердите, что она была успешно включена, выполнив команду.

     ```Get-ADSyncScheduler```

Дополнительные сведения о планировщике см. в разделе [Планировщик синхронизации Azure AD Connect](how-to-connect-sync-feature-scheduler.md).

### <a name="edit-users-admindescription-attribute"></a>Edit Users **админдескриптион** Attribute:
После завершения всех конфигураций необходимо изменить атрибут **админдескриптион** для всех пользователей, которые вы хотите **исключить** из синхронизации хэшей паролей, в Active Directory и добавить строку, используемую в фильтре области: **фсфилтеред**.
   
  ![Изменение атрибута](media/how-to-connect-selective-password-hash-synchronization/exclude-11.png)

Для изменения атрибута **админдескриптион** пользователя можно также использовать следующую команду PowerShell:

```Set-ADUser myuser -Replace @{adminDescription="PHSFiltered"}```

## <a name="excluded-users-is-larger-than-included-users"></a>Исключенные пользователи больше, чем включенные пользователи
В следующем разделе описано, как включить выборочную синхронизацию хэша паролей, если число **исключаемых** пользователей **превышает число** **включаемых** пользователей.

>[!Important]
> Прежде чем продолжать, убедитесь, что Планировщик синхронизации отключен, как описано выше.

Ниже приведена сводка действий, которые будут выполнены в следующих шагах.

- Создание редактируемой копии объекта **in из AD — user AccountEnabled** с параметром **включения синхронизации хэша паролей** и определения ее фильтра области 
- Создайте другую редактируемую копию по умолчанию **в from AD-user AccountEnabled** с параметром **включить синхронизацию хэша паролей** и определить его фильтр области. 
- Повторное включение планировщика синхронизации 
- Задайте значение атрибута в Active Directory, которое было определено как атрибут определения области для пользователей, которым вы хотите разрешить синхронизацию хэшей паролей. 

>[!Important]
>Шаги по настройке выборочной синхронизации хэшированных паролей влияют только на пользовательские объекты, у которых атрибут **админдескриптион** заполнен в Active Directory со значением **фсинклудед**.
Если этот атрибут не заполнен или значение отличается от **фсинклудед** , то эти правила не будут применены к объектам-пользователям.


### <a name="configure-the-necessary-synchronization-rules"></a>Настройте необходимые правила синхронизации.

 1. Запустите редактор правил синхронизации и задайте фильтры **для** параметра **Синхронизация паролей** и стандартный **тип правила** .
     ![Тип правила](media/how-to-connect-selective-password-hash-synchronization/include-1.png)
 2. Выберите правило **в from AD — user AccountEnabled** для леса Active Directory, для которого требуется настроить выборочный пароль, и нажмите кнопку **изменить**. Выберите **Да** в следующем диалоговом окне, чтобы создать редактируемую копию исходного правила.
     ![В из AD](media/how-to-connect-selective-password-hash-synchronization/include-2.png)
 3. Первое правило отключит синхронизацию хэша паролей. Укажите следующее имя для нового настраиваемого правила: **в из AD-user AccountEnabled — Фильтрация пользователей из PHS**.
 Измените значение приоритета на число ниже 100 (например, **90** или какое-либо наименьшее значение, доступное в вашей среде).
 Убедитесь, что флажки **включить синхронизацию паролей** и **отключены** .
 Нажмите кнопку **Далее**.
  ![Задать приоритет](media/how-to-connect-selective-password-hash-synchronization/include-3.png)
 4. В **фильтре области** нажмите кнопку **Добавить предложение**.
Выберите **админдескриптион** в столбце атрибут, **NOTEQUAL** в столбце Оператор и введите **фсинклудед** в качестве значения.
     ![Добавить предложение](media/how-to-connect-selective-password-hash-synchronization/include-4.png)
 5. Дальнейшие изменения не требуются. Правила и **преобразования** **Присоединение** должны быть оставлены скопированными параметрами по умолчанию, чтобы можно было нажать кнопку **сохранить** сейчас.
 Нажмите кнопку **ОК** в диалоговом окне предупреждения, чтобы выполнить полную синхронизацию, в следующем цикле синхронизации соединителя.
     ![Преобразование](media/how-to-connect-selective-password-hash-synchronization/include-5.png)
 6. Затем создайте другое настраиваемое правило с включенной синхронизацией хэшей паролей. Выберите еще раз правило по умолчанию **в from AD — user AccountEnabled** для леса Active Directory, для которого требуется настроить выборочный пароль, и нажмите кнопку **изменить**. Выберите **Да** в следующем диалоговом окне, чтобы создать редактируемую копию исходного правила.
     ![AccountEnabled пользователя](media/how-to-connect-selective-password-hash-synchronization/include-6.png)
 7. Укажите следующее имя для нового настраиваемого правила: **в из AD-user AccountEnabled — пользователи, входящие в PHS**.
 Измените значение приоритета на число ниже ранее созданного правила (в этом примере это будет **89**).
 Убедитесь, что установлен флажок **включить синхронизацию паролей** и снят флажок **отключено** .
 Нажмите кнопку **Далее**.
     ![Включить синхронизацию паролей](media/how-to-connect-selective-password-hash-synchronization/include-7.png)
 8. В **фильтре области** нажмите кнопку **Добавить предложение**.
 В столбце Атрибут выберите **админдескриптион** , **равное** в столбце Оператор, и введите **фсинклудед** в качестве значения.
     ![фсинклудед](media/how-to-connect-selective-password-hash-synchronization/include-8.png)
 9. Дальнейшие изменения не требуются. Правила и **преобразования** **Присоединение** должны быть оставлены скопированными параметрами по умолчанию, чтобы можно было нажать кнопку **сохранить** сейчас.
 Нажмите кнопку **ОК** в диалоговом окне предупреждения, чтобы выполнить полную синхронизацию, в следующем цикле синхронизации соединителя.
     ![Сохранить сейчас](media/how-to-connect-selective-password-hash-synchronization/include-9.png)
 10.    Подтвердите создание правил. Удалите фильтры для **синхронизации паролей** **по** **стандарту** и **типу правила** . Вы должны увидеть оба новых правила, которые вы только что создали.
     ![Синхронизация](media/how-to-connect-selective-password-hash-synchronization/include-10.png)

### <a name="re-enable-synchronization-scheduler"></a>Повторно включить Планировщик синхронизации:  
После завершения действий по настройке необходимых правил синхронизации повторно включите Планировщик синхронизации, выполнив следующие действия.
 1. В Windows PowerShell выполните следующие действия.

     ```Set-ADSyncScheduler -SyncCycleEnabled $true```
 2. Затем подтвердите, что она была успешно включена, выполнив команду.

     ```Get-ADSyncScheduler```

Дополнительные сведения о планировщике см. в разделе [Планировщик синхронизации Azure AD Connect](how-to-connect-sync-feature-scheduler.md).

### <a name="edit-users-admindescription-attribute"></a>Edit Users **админдескриптион** Attribute:
После завершения всех конфигураций необходимо изменить атрибут **админдескриптион** для всех пользователей, которые вы хотите **включить** в синхронизацию хэшей паролей, в Active Directory и добавить строку, используемую в фильтре области: **фсинклудед**.

  ![Изменить атрибуты](media/how-to-connect-selective-password-hash-synchronization/include-11.png)
 
 Для изменения атрибута **админдескриптион** пользователя можно также использовать следующую команду PowerShell:

 ```Set-ADUser myuser -Replace @{adminDescription="PHSIncluded"}``` 

## <a name="next-steps"></a>Next Steps
- [Что такое синхронизация хэша паролей](whatis-phs.md)
- [Как работает синхронизация хэша паролей](how-to-connect-password-hash-synchronization.md)
