---
title: Управление согласия для приложений и оценка запросов согласия в Azure Active Directory
description: Узнайте, как управлять запросами на согласие, когда согласие пользователя отключено или ограничено, и как вычислить запрос согласия администратора на уровне клиента для приложения в Azure Active Directory.
services: active-directory
author: kenwith
manager: daveba
ms.service: active-directory
ms.subservice: app-mgmt
ms.workload: identity
ms.topic: how-to
ms.date: 12/27/2019
ms.author: kenwith
ms.reviewer: phsignor
ms.openlocfilehash: 189a89276d922665dd1ad0fbacc77ba499137048
ms.sourcegitcommit: 867cb1b7a1f3a1f0b427282c648d411d0ca4f81f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "99253108"
---
# <a name="managing-consent-to-applications-and-evaluating-consent-requests"></a>Управление согласия для приложений и оценка запросов на согласие

Корпорация Майкрософт [рекомендует](../../security/fundamentals/steps-secure-identity.md#restrict-user-consent-operations) отключать согласие конечных пользователей на приложения. Это позволит централизовать процесс принятия решений с группой безопасности и администратора удостоверений вашей организации.

После отключения или ограничения разрешения для конечных пользователей существует несколько важных вопросов, которые необходимо учитывать при обеспечении безопасности Организации, обеспечивая возможность использования критически важных для бизнеса приложений. Эти действия крайне важны для того, чтобы снизить влияние группы поддержки Организации и ИТ-администраторов, одновременно предотвращая использование неуправляемых учетных записей в сторонних приложениях.

## <a name="process-changes-and-education"></a>Обработка изменений и образования

 1. Рассмотрите возможность включения [рабочего процесса согласия администратора (Предварительная версия)](configure-admin-consent-workflow.md) , чтобы разрешить пользователям запрашивать утверждение администратором непосредственно с экрана согласия.

 2. Убедитесь, что все администраторы понимают [разрешения и инфраструктуру согласия](../develop/consent-framework.md), как работает [запрос согласия](../develop/application-consent-experience.md) и как [оценивать запрос на согласие администратора на уровне клиента](#evaluating-a-request-for-tenant-wide-admin-consent).
 3. Изучите существующие процессы Организации, чтобы пользователи могли запрашивать одобрение администратора для приложения и при необходимости выполнять обновления. При изменении процессов:
    * Обновите соответствующую документацию, мониторинг, автоматизацию и т. д.
    * Сообщите изменениям процесса всем затронутым пользователям, разработчикам, группам поддержки и ИТ администраторам.

## <a name="auditing-and-monitoring"></a>Аудит и мониторинг

1. [Аудит приложений и предоставление разрешений](../../security/fundamentals/steps-secure-identity.md#audit-apps-and-consented-permissions) в Организации, чтобы гарантировать, что непроверенные или подозрительные приложения ранее не предоставили доступ к данным.

2. Ознакомьтесь с разрешениями [на обнаружение и устранение незаконных согласия в Office 365](/microsoft-365/security/office-365-security/detect-and-remediate-illicit-consent-grants) , чтобы получить дополнительные рекомендации и защититься от подозрительных приложений, запрашивающих согласие OAuth.

3. Если у вашей организации есть соответствующая лицензия:

    * Используйте дополнительные [функции аудита приложений OAuth в Microsoft Cloud App Security](/cloud-app-security/investigate-risky-oauth).
    * Используйте [Azure Monitor книги для наблюдения за разрешениями и](../reports-monitoring/howto-use-azure-monitor-workbooks.md) действиями, связанными с согласия. Книга " *Советы по согласию* " предоставляет представление о приложениях по количеству неудачных запросов на согласие. Это может быть полезно для определения приоритетов приложений для администраторов и принятия решения о предоставлении им согласия администратора.

### <a name="additional-considerations-for-reducing-friction"></a>Дополнительные соображения по снижению трения

Чтобы снизить влияние на надежные, критически важные приложения, которые уже используются, рассмотрите возможность заблаговременного предоставления согласия администратора для приложений с большим числом предоставленных пользователей.

1. Проведите инвентаризацию приложений, уже добавленных в вашу организацию с высоким уровнем использования, на основе журналов входа или действия предоставления согласия. [Сценарий](https://gist.github.com/psignoret/41793f8c6211d2df5051d77ca3728c09) PowerShell можно использовать для быстрого и простого обнаружения приложений с большим количеством предоставленных пользователями разрешений.

2. Оцените лучшие приложения, для которых еще не было предоставлено согласие администратора.

   > [!IMPORTANT]
   > Тщательно оцените приложение перед предоставлением согласия администратора на уровне клиента, даже если многие пользователи в Организации уже продавали согласие на их выполнение.

3. Для каждого утвержденного приложения предоставьте согласие администратора на уровне клиента, используя один из методов, описанных ниже.

4. Для каждого утвержденного приложения рекомендуется [ограничивать доступ пользователей](configure-user-consent.md).

## <a name="evaluating-a-request-for-tenant-wide-admin-consent"></a>Оценка запроса согласия администратора на уровне клиента

Предоставление согласия администратора на уровне клиента является конфиденциальной операцией.  Разрешения будут предоставлены от имени всей Организации и могут включать разрешения на попытки выполнения операций с высоким уровнем привилегий. Например, управление ролями, полный доступ ко всем почтовым ящикам или всем сайтам и полное олицетворение пользователя.

Перед предоставлением согласия администратора на уровне клиента необходимо убедиться, что вы доверяете приложению и издателю приложения, для уровня доступа, который вы предоставляете. Если вы не уверены, кто управляет приложением и почему приложение запрашивает разрешения, не *предоставляйте согласие*.

В следующем списке приведены некоторые рекомендации, которые следует учитывать при оценке запроса на предоставление согласия администратора.

* **Ознакомьтесь с [разрешениями и инфраструктурой согласия](../develop/consent-framework.md) на платформе Microsoft Identity.**

* **Изучите разницу между [делегированными разрешениями и разрешениями приложения](../develop/v2-permissions-and-consent.md#permission-types).**

   Разрешения приложения позволяют приложению получать доступ к данным для всей Организации без участия пользователя. Делегированные разрешения позволяют приложению действовать от имени пользователя, который в какой-то момент вошел в приложение.

* **Ознакомьтесь с запрашиваемыми разрешениями.**

   Разрешения, запрашиваемые приложением, перечислены в [запросе согласия](../develop/application-consent-experience.md). При раскрытии заголовка разрешения будет отображаться описание разрешения. Описание разрешений приложения обычно заканчивается на "без входа пользователя". Описание делегированных разрешений, как правило, заканчивается на "от имени пользователя, выполнившего вход". Разрешения для Microsoft Graph API описаны в [справочнике по Разрешениям Microsoft Graph](/graph/permissions-reference) . сведения о предоставляемых им разрешениях см. в документации по другим API.

   Если вы не понимаете запрошенное разрешение, не *предоставляйте согласие*.

* **Узнайте, какое приложение запрашивает разрешения и кто опубликовал приложение.**

   Будьте осторожны с вредоносными приложениями, которые пытаются выглядеть как другие приложения.

   Если вы сомневаетесь в законности приложения или его издателя, не *предоставляйте согласие*. Вместо этого следует искать дополнительное подтверждение (например, непосредственно у издателя приложения).

* **Убедитесь, что запрошенные разрешения согласованы с функциями, которые вы должны получить от приложения.**

   Например, приложению, предлагающему Управление сайтом SharePoint, может потребоваться делегированный доступ для чтения всех семейств веб-сайтов, но ему не обязательно нужен полный доступ ко всем почтовым ящикам или полный набор привилегий олицетворения в каталоге.

   Если вы считаете, что приложение запрашивает больше разрешений, чем требуется, не *предоставляйте согласие*. Чтобы получить дополнительные сведения, обратитесь к издателю приложения.

## <a name="granting-consent-as-an-administrator"></a>Предоставление согласия в качестве администратора

### <a name="granting-tenant-wide-admin-consent"></a>Предоставление согласия администратора на уровне клиента
Пошаговые инструкции по предоставлению согласия администратора на уровне клиента в портал Azure с помощью Azure AD PowerShell или в самом запросе согласия см. в разделе [предоставление согласия администратора на уровне клиента для приложения](grant-admin-consent.md) .

### <a name="granting-consent-on-behalf-of-a-specific-user"></a>Предоставление согласия от имени определенного пользователя
Вместо предоставления согласия для всей организации администратор может также использовать [Microsoft Graph API](/graph/use-the-api) , чтобы предоставить согласие на делегированные разрешения от имени одного пользователя. Дополнительные сведения см. [в разделе Получение доступа от имени пользователя](/graph/auth-v2-user).

## <a name="limiting-user-access-to-applications"></a>Ограничение доступа пользователей к приложениям
Доступ пользователей к приложениям по-прежнему может быть ограничен, даже если предоставлено согласие администратора на уровне клиента. Дополнительные сведения о том, как требовать назначения пользователей приложению, см. в разделе [методы назначения пользователей и групп](./assign-user-or-group-access-portal.md).

Более широкий обзор, в том числе способы решения дополнительных сложных сценариев, см. в статье [Использование Azure AD для управления доступом к приложениям](what-is-access-management.md).

## <a name="disable-all-future-user-consent-operations-to-any-application"></a>Отключить все будущие операции согласия пользователя для любого приложения
Если вы отключите для всего каталога возможность предоставлять согласие, пользователь не сможет согласиться с условиями использования приложения. Администраторы могут по-прежнему предоставлять согласие от имени пользователя. Дополнительные сведения о согласии в приложениях и возможных мотивах для его отключения или предоставления см. в разделе [Получение согласия пользователя и администратора](../develop/howto-convert-app-to-be-multi-tenant.md).

Чтобы отключить все последующие операции по предоставлению согласия пользователя во всем каталоге, выполните следующие действия:
1.  Откройте [**портал Azure**](https://portal.azure.com/) и войдите в систему как **глобальный администратор**.
2.  Откройте **расширение Azure Active Directory**, щелкнув **Все службы** в верхней части главного меню навигации слева.
3.  В поле фильтра поиска введите **Azure Active Directory** и выберите элемент **Azure Active Directory**.
4.  В меню навигации выберите **Пользователи и группы** .
5.  Выберите **Параметры пользователя**.
6.  Отключите все будущие операции пользователей по предоставлению согласия, установив переключатель **Пользователи могут разрешать приложениям доступ к своим данным** в положение **Нет** и нажав кнопку **Сохранить**.

## <a name="next-steps"></a>Дальнейшие действия
* [Пять шагов по защите инфраструктуры удостоверений](../../security/fundamentals/steps-secure-identity.md#before-you-begin-protect-privileged-accounts-with-mfa)
* [Настройка рабочего процесса согласия администратора](configure-admin-consent-workflow.md)
* [Настройка согласия конечных пользователей для приложений](configure-user-consent.md)
* [Разрешения и согласие для платформы удостоверений Майкрософт](../develop/v2-permissions-and-consent.md)