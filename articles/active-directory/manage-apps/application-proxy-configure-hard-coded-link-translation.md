---
title: Преобразование ссылок и URL-адресов прокси приложения Azure AD | Документация Майкрософт
description: Узнайте, как перенаправить жестко запрограммированные ссылки для приложений, опубликованных с помощью прокси приложения Azure AD.
services: active-directory
documentationcenter: ''
author: kenwith
manager: daveba
ms.service: active-directory
ms.subservice: app-mgmt
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: how-to
ms.date: 08/15/2019
ms.author: kenwith
ms.reviewer: japere
ms.custom: it-pro
ms.collection: M365-identity-device-management
ms.openlocfilehash: 44266f7a7485b44ba60a27aadd7422e8d1c3acf4
ms.sourcegitcommit: d49bd223e44ade094264b4c58f7192a57729bada
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/02/2021
ms.locfileid: "99259412"
---
# <a name="redirect-hard-coded-links-for-apps-published-with-azure-ad-application-proxy"></a>Перенаправление жестко запрограммированных ссылок для приложений, опубликованных с помощью Azure AD Application Proxy

С помощью прокси приложения Azure AD ваши локальные приложения доступны удаленным пользователям или пользователям со своими устройствами. Тем не менее, некоторые приложения были разработаны с помощью локальных ссылок, внедренных в HTML-код. Эти ссылки могут работать некорректно при использовании приложения удаленно. Если несколько локальных приложений указывают друг на друга, то пользователям требуется, чтобы ссылки продолжали работать, когда их нет в офисе. 

Чтобы гарантировать работу ссылок как внутри корпоративной сети, так и за ее пределами, лучше всего настроить внешние URL-адреса приложений таким образом, чтобы они совпадали с их внутренними URL-адресами. При настройке внешних URL-адресов используйте [личные домены](application-proxy-configure-custom-domain.md), чтобы вместо домена прокси приложения по умолчанию адреса содержали ваше корпоративное доменное имя.


Если использовать личные домены в клиенте невозможно, следует рассмотреть несколько других вариантов для предоставления этой функциональности. Все они также совместимы с личными доменами и друг с другом, поэтому при необходимости можно настроить личные домены и другие решения.

> [!NOTE]
> Преобразование ссылок не поддерживается для жестко запрограммированных внутренних URL-адресов, созданных с помощью JavaScript.

**Вариант 1. Использование Microsoft ребро.** это решение применимо только в том случае, если вы планируете рекомендовать или требовать, чтобы пользователи обращаются к приложению через браузер Microsoft ребра. Он будет обрабатывать все опубликованные URL-адреса. 

**Вариант 2. Использование расширения MyApps**. В этом случае для работы решения пользователи должны установить расширение браузера на стороне клиента. Оно будет обрабатывать все опубликованные URL-адреса и работает с большинством распространенных браузеров. 

**Вариант 3. Использование параметра преобразования ссылок**. Этот параметр задается администратором и недоступен для пользователей. Однако он будет работать с URL-адресами только в HTML и CSS.   

Благодаря этим особенностям ссылки работают независимо от того, где находятся ваши пользователи. При наличии приложений, которые указывают непосредственно на внутренние конечные точки или порты, эти внутренние URL-адреса можно сопоставить с опубликованными внешними URL-адресами прокси приложения. 

 
> [!NOTE]
> Последний вариант предназначен только для клиентов, которые по какой-либо причине не могут использовать личные домены, имеющие те же внутренние и внешние URL-адреса в своих приложениях. Прежде чем включать эту функцию, проверьте, можете ли вы использовать [личные домены в прокси приложения Azure AD](application-proxy-configure-custom-domain.md). 
> 
> А если преобразование ссылок необходимо настроить в приложении SharePoint, то см. статью [Настройка альтернативных сопоставлений доступа для SharePoint 2013](/SharePoint/administration/configure-alternate-access-mappings), где описан другой подход к сопоставлению ссылок. 

 
### <a name="option-1-microsoft-edge-integration"></a>Вариант 1. интеграция Microsoft ребра 

Для дальнейшей защиты приложения и содержимого можно использовать Microsoft ребро. Чтобы использовать это решение, необходимо потребовать от пользователей получить доступ к приложению через Microsoft ребро. Все внутренние URL-адреса, опубликованные с помощью прокси приложения, будут располагаться по границе и перенаправляться на соответствующий внешний URL-адрес. Это гарантирует работоспособность всех жестко заданных внутренних URL-адресов. Кроме того, если пользователь введет внутренний URL-адрес в браузере, этот адрес будет работать всегда, независимо от местонахождения пользователя.  

Дополнительные сведения о том, как настроить этот параметр, см. в статье [Управление веб-доступом с помощью пограничных устройств для iOS и Android с Microsoft Intuneной](/mem/intune/apps/manage-microsoft-edge) документацией.  

### <a name="option-2-myapps-browser-extension"></a>Вариант 2. Расширение браузера MyApps 

При использовании расширения браузера MyApps все внутренние URL-адреса, опубликованные с помощью Application Proxy, распознаются и перенаправляются на соответствующий внешний URL-адрес. Это гарантирует работоспособность всех жестко заданных внутренних URL-адресов. Кроме того, если пользователь введет внутренний URL-адрес в браузере, этот адрес будет работать всегда, независимо от местонахождения пользователя.  

Чтобы использовать эту возможность, пользователю необходимо скачать расширение и выполнить вход. Выполнять другие настройки не требуется. 

Дополнительные сведения, включая настройку этого параметра, см. в документации по [расширению обозревателя MyApps](../user-help/my-apps-portal-end-user-access.md#download-and-install-the-my-apps-secure-sign-in-extension) .

### <a name="option-3-link-translation-setting"></a>Вариант 3. Параметр преобразования ссылок 

Если включено преобразование ссылок, служба Application Proxy выполняет поиск опубликованных внутренних ссылок в HTML и CSS и преобразует их, чтобы пользователи могли не прерывать работу. Использование расширения обозревателя MyApp является предпочтительным для настройки преобразования ссылок, так как оно обеспечивает более производительную работу для пользователей.

> [!NOTE]
> Если используется вариант 2 или 3, в каждый момент времени должен быть включен только один из них.

## <a name="how-link-translation-works"></a>Как работает преобразование ссылок

После проверки подлинности, когда прокси-сервер передает данные приложения пользователю, прокси приложения просматривает приложение на наличие жестко заданных ссылок и заменяет их соответствующими опубликованными внешними URL-адресами.

Прокси приложения предполагает, что приложения имеют кодировку UTF-8. Если это не так, укажите тип кодировки в заголовке HTTP-ответа, например `Content-Type:text/html;charset=utf-8` .

### <a name="which-links-are-affected"></a>Какие ссылки будут затронуты

Функция преобразования ссылок ищет только ссылки, которые находятся в тегах кода в основной части приложения. Прокси приложения имеет отдельную функцию для преобразования файлов cookie и URL-адресов в заголовках. 

Существует два общих типа внутренних ссылок в локальных приложениях:

- **Относительные внутренние ссылки**, которые указывают на общедоступный ресурс в локальной структуре файлов, такой как `/claims/claims.html`. Эти ссылки автоматически работают в приложениях, которые опубликованы через прокси приложения, и продолжают работать с преобразованием или без него. 
- **Жестко запрограммированные внутренние ссылки** на другие локальные приложения, такие как `http://expenses` или опубликованные файлы, например `http://expenses/logo.jpg` . Функция преобразования ссылок работает на жестко запрограммированных внутренних ссылках и изменяет их так, чтобы они указывали на внешние URL-адреса, которые должны пройти удаленные пользователи.

Полный список атрибутов в тегах кода HTML, которые прокси приложения поддерживает для включения преобразования ссылок:
* a (href)
* звук (src)
* Базовый (href)
* Кнопка (формактион)
* Div (данные — фон, стиль, Data-src)
* внедрить (src)
* форма (действие)
* рамка (src)
* головной (профиль)
* HTML (манифест)
* IFRAME (лонгдеск, src)
* IMG (лонгдеск, src)
* входные данные (формактион, src, Value)
* ссылка (href)
* MenuItem (значок)
* Meta (содержимое)
* объект (Архив, данные, база кода)
* Скрипт (src)
* Источник (src)
* Трассировка (src)
* видео (src, афиша)

Кроме того, в CSS переводится атрибут URL-адреса.

### <a name="how-do-apps-link-to-each-other"></a>Как приложения ссылаются друг на друга

Преобразование ссылок включено для каждого приложения, чтобы у вас был контроль над работой пользователя на уровне отдельных приложений. Включите преобразование ссылок для приложения, если необходимо, чтобы преобразовывались ссылки *из* этого приложения, а не ссылки *на* него. 

Например, предположим, имеется три приложения, которые опубликованы через прокси приложения и содержат ссылки друг на друга: "Преимущества", "Расходы" и "Путешествия". Имеется четвертое приложение, "Отзыв", которое не опубликовано через прокси приложения.

При включении преобразования ссылок для приложения "Преимущества" ссылки на "Расходы" и "Путешествия" перенаправляются на внешние URL-адреса этих приложений, но ссылка на "Отзывы" не перенаправляется, так как у нее нет внешнего URL-адреса. Ссылки из приложений "Расходы" и "Путешествия" обратно в "Преимущества" не работают из-за того, что для этих двух приложений не было включено преобразование.

![Ссылки из приложения "Преимущества" на другие приложения при включенном преобразовании ссылок](./media/application-proxy-configure-hard-coded-link-translation/one_app.png)

### <a name="which-links-arent-translated"></a>Какие ссылки не преобразовываются

Для повышения производительности и безопасности некоторые ссылки не преобразовываются:

- Ссылки вне тегов кода. 
- Ссылки в формате, отличном от HTML или CSS. 
- Ссылки в кодировке URL-адресов.
- Внутренние ссылки, открываемые из других программ. Ссылки, отправленные по электронной почте или через мгновенные сообщения либо включенные в другие документы. Пользователи должны знать, как переходить по внешним URL-адресам.

Если вам необходима поддержка одного из этих двух сценариев, то вместо преобразования ссылок используйте одинаковые внутренние и внешние URL-адреса.  

## <a name="enable-link-translation"></a>Включение преобразования ссылок

Приступить к работе с преобразованием ссылок очень просто:

1. Войдите на [портал Azure](https://portal.azure.com) с использованием учетной записи администратора.
2. Перейдите в раздел **Azure Active Directory**  >  **корпоративные приложения**  >  **все приложения** > выберите приложение, которым вы хотите управлять > **прокси приложения**.
3. Переведите переключатель **Translate URLs in application body** (Преобразовывать URL-адреса в коде приложения) в состояние **Да**.

   ![Выберите "Да" для преобразования URL-адресов в коде приложения](./media/application-proxy-configure-hard-coded-link-translation/select_yes.png)
4. Выберите **Сохранить**, чтобы применить изменения.

Теперь, когда пользователи получают доступ к этому приложению, прокси будет автоматически проверять внутренние ссылки, которые были опубликованы через прокси приложения на вашем клиенте.

## <a name="send-feedback"></a>Отправить отзыв

Нам нужна ваша помощь, чтобы обеспечить работу функции во всех ваших приложениях. Мы поддерживаем поиск более 30 тегов в HTML и CSS. Если у вас есть пример созданных ссылок, которые не были преобразованы, отправьте фрагмент кода [сюда](mailto:aadapfeedback@microsoft.com). 

## <a name="next-steps"></a>Дальнейшие действия
[Использование личных доменов с AD application proxy Azure](application-proxy-configure-custom-domain.md) для того же внутреннего и внешнего URL-адреса

[Настройка альтернативных сопоставлений доступа для SharePoint 2013](/SharePoint/administration/configure-alternate-access-mappings)
