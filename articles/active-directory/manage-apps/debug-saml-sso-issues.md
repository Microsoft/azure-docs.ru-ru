---
title: Отладка единого входа на основе SAML-Azure Active Directory
description: Отладка единого входа на основе SAML в приложениях в Azure Active Directory.
services: active-directory
ms.author: kenwith
author: kenwith
manager: daveba
ms.service: active-directory
ms.subservice: app-mgmt
ms.topic: troubleshooting
ms.workload: identity
ms.date: 02/18/2019
ms.reviewer: luleon, hirsin, paulgarn
ms.openlocfilehash: 4a5fbef3380db8c9b357c83b4cb8240a41a0012c
ms.sourcegitcommit: d49bd223e44ade094264b4c58f7192a57729bada
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/02/2021
ms.locfileid: "99259293"
---
# <a name="debug-saml-based-single-sign-on-to-applications-in-azure-active-directory"></a>Отладка единого входа на основе SAML в приложениях в Azure Active Directory

Узнайте, как найти и исправить проблемы с [единым входом](what-is-single-sign-on.md) для приложений в Azure Active Directory (Azure AD), использующих единый вход на основе SAML. 

## <a name="before-you-begin"></a>Подготовка к работе

Мы рекомендуем установить [расширение защищенного входа в мои приложения](../user-help/my-apps-portal-end-user-troubleshoot.md#im-having-trouble-installing-the-my-apps-secure-sign-in-extension). Это расширение браузера упрощает сбор данных запроса SAML и ответа SAML, необходимых для разрешения проблем с единым входом. Если вы не можете установить расширение, ознакомьтесь с этой статьей, которая описывает решение проблем при наличии или отсутствии этого расширения.

Перейдите по одной из следующих ссылок, чтобы загрузить и установить расширение защищенного входа в мои приложения.

- [Chrome](https://go.microsoft.com/fwlink/?linkid=866367)
- [Microsoft Edge](https://go.microsoft.com/fwlink/?linkid=845176)
- [Firefox](https://go.microsoft.com/fwlink/?linkid=866366)

## <a name="test-saml-based-single-sign-on"></a>Тестирование единого входа на основе SAML

Чтобы проверить единый вход на основе SAML между Azure AD и целевым приложением, выполните следующие действия.

1. Войдите на [портал Azure](https://portal.azure.com) как глобальный администратор или другой администратор с правами на управление приложениями.
1. В левой колонке выберите **Azure Active Directory**, а затем выберите **корпоративные приложения**. 
1. В списке корпоративных приложений выберите приложение, для которого требуется проверить единый вход, а затем в параметрах слева выберите **единый вход**.
1. Чтобы открыть интерфейс проверки единого входа на основе SAML, перейдите к разделу **Проверка единого входа** (шаг 5). Если кнопка **тестирования** неактивна, необходимо сначала заполнить и сохранить обязательные атрибуты в разделе **Basic Configuration SAML** .
1. В колонке **Тестирование единого входа** введите корпоративные учетные данные, чтобы войти в целевое приложение. Вы можете выполнить вход как текущий пользователь или как другой пользователь. Если вы войдете от имени другого пользователя, откроется окно проверки подлинности.

    ![Снимок экрана: страница "Проверка единого входа SAML"](./media/debug-saml-sso-issues/test-single-sign-on.png)

Если вы успешно выполнили вход, тест пройден. В этом случае Azure AD выдает маркер ответа SAML приложению. Приложение использует маркер SAML, чтобы обработать ваш вход.

Если на странице входа компании или на странице приложения отображается ошибка, воспользуйтесь инструкциями из следующих разделов, чтобы решить ее.

## <a name="resolve-a-sign-in-error-on-your-company-sign-in-page"></a>Решение ошибки входа на странице входа компании

При попытке входа в систему может появиться сообщение об ошибке на странице входа в компанию, как в следующем примере.

![Пример, отображающий ошибку на странице входа в компанию](./media/debug-saml-sso-issues/error.png)

Чтобы устранить эту ошибку, вам понадобится сообщение об ошибке и запрос SAML. Расширение защищенного входа в мои приложения автоматически собирает эту информацию и отображает инструкции по решению проблемы в Azure AD.

### <a name="to-resolve-the-sign-in-error-with-the-my-apps-secure-sign-in-extension-installed"></a>Устранение ошибки входа в систему с установленным расширением защищенного входа в мои приложения

1. При возникновении ошибки расширение перенаправляет вас обратно в колонку **тест единого входа** Azure AD.
1. В колонке **Проверка единого входа** выберите **скачать запрос SAML**.
1. Отобразятся инструкции по устранению в зависимости от ошибки и значений в запросе SAML.
1. Вы увидите кнопку **исправить** , чтобы автоматически обновить конфигурацию в Azure AD, чтобы устранить проблему. Если эта кнопка не отображается, проблема входа не связана с неверной настройкой в Azure AD.

Если для ошибки входа не предоставлено разрешение, мы рекомендуем использовать текстовое поле Feedback (отзыв), чтобы сообщить нам об этом.

### <a name="to-resolve-the-error-without-installing-the-my-apps-secure-sign-in-extension"></a>Устранение ошибки без установки расширения безопасного входа в мои приложения

1. Скопируйте сообщение об ошибке в нижнем правом углу страницы. В сообщении об ошибке указывается:
    - CorrelationID и Timestamp. Эти значения важно указать при обращении в службу поддержки корпорации Майкрософт. Это поможет нашим инженерам быстрее определить проблему и найти ей решение.
    - Инструкция, определяющая первопричину проблемы.
1. Вернитесь в Azure AD и найдите колонку **Тестирование единого входа**.
1. В текстовое поле над пунктом **Получить рекомендации по устранению** вставьте сообщение об ошибке.
1. Нажмите **Получить рекомендации по устранению**, чтобы просмотреть инструкции по устранению ошибки. Для рекомендаций может потребоваться информация из запроса SAML или ответа SAML. Если вы не используете безопасное расширение для входа в мои приложения, может потребоваться средство, например [Fiddler](https://www.telerik.com/fiddler) , для получения запроса SAML и ответа.
1. Убедитесь, что назначение в запросе SAML соответствует URL-адресу одиночной Sign-On службы SAML, полученному из Azure AD.
1. Убедитесь, что издатель в запросе SAML совпадает с идентификатором, настроенным для приложения в Azure AD. В Azure AD значение издателя используется для поиска приложения в каталоге.
1. Убедитесь, что AssertionConsumerServiceURL, где приложение должно получить токен SAML из Azure AD. Это значение можно настроить в Azure AD, но не обязательно, если оно является частью запроса SAML.


## <a name="resolve-a-sign-in-error-on-the-application-page"></a>Устранение ошибки входа на странице приложения

Ошибка на странице приложения может отображаться даже после успешного входа. Это происходит в случае, когда Azure AD выдает приложению маркер, но приложение не принимает ответ.

Чтобы устранить эту ошибку, выполните следующие действия или просмотрите [короткое видео об использовании Azure AD для устранения неполадок единого входа SAML](https://www.youtube.com/watch?v=poQCJK0WPUk&list=PLLasX02E8BPBm1xNMRdvP6GtA6otQUqp0&index=8).

1. Если приложение находится в коллекции Azure AD, убедитесь, что выполнены все действия по интеграции приложения с Azure AD. Инструкции по интеграции для приложения вы найдете в [руководствах по интеграции приложений SaaS](../saas-apps/tutorial-list.md).
1. Получите ответ SAML.
    - Если расширение защищенного входа в мои приложения установлено, в колонке **Тестирование единого входа** нажмите **Загрузить ответ SAML**.
    - Если расширение не установлено, получите ответ SAML с помощью дополнительного средства, например [Fiddler](https://www.telerik.com/fiddler).
1. Обратите внимание на следующие элементы в маркере ответа SAML:
   - Уникальный идентификатор пользователя значения и формата NameID
   - Утверждения, выданные в маркере
   - Сертификат, использованный для подписи маркера.

     Дополнительные сведения об ответе SAM см. в статье [Протокол единого входа SAML](../develop/single-sign-on-saml-protocol.md?toc=/azure/active-directory/azuread-dev/toc.json&bc=/azure/active-directory/azuread-dev/breadcrumb/toc.json).

1. Теперь, когда вы проверили ответ SAML, ознакомьтесь со статьей [Ошибка на странице приложения после входа в](application-sign-in-problem-application-error.md) систему, чтобы получить рекомендации по устранению проблемы. 
1. Если вы по-прежнему не можете войти в систему, можно попросить поставщика приложения, что отсутствует в ответе SAML.

## <a name="next-steps"></a>Дальнейшие действия

Теперь, когда единый вход работает в вашем приложении, вы можете [автоматизировать подготовку пользователей и отменить подготовку к приложениям SaaS](../app-provisioning/user-provisioning.md) или начать [работу с условным доступом](../conditional-access/app-based-conditional-access.md).
