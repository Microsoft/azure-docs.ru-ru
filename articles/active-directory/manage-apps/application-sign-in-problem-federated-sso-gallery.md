---
title: Проблемы при входе в приложения, настроенные для единого входа на основе SAML
description: Рекомендации по конкретным ошибкам при входе в приложение, настроенное для федеративного единого входа на основе SAML, с Azure Active Directory
services: active-directory
author: kenwith
manager: celestedg
ms.service: active-directory
ms.subservice: app-mgmt
ms.workload: identity
ms.topic: troubleshooting
ms.date: 02/18/2019
ms.author: kenwith
ms.reviewer: luleon, asteen
ms.custom: contperf-fy21q2
ms.openlocfilehash: 62b828a23805c6d3ab544dd2b9f78b45a3327cde
ms.sourcegitcommit: d1e56036f3ecb79bfbdb2d6a84e6932ee6a0830e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/29/2021
ms.locfileid: "99053403"
---
# <a name="problems-signing-in-to-saml-based-single-sign-on-configured-apps"></a>Проблемы при входе в приложения, настроенные для единого входа на основе SAML
Чтобы устранить проблемы при входе ниже, рекомендуется выполнить следующие действия для оптимизации диагностики и автоматизации действий по устранению неполадок.

- Установите [расширение браузера "Безопасный вход в мои приложения"](my-apps-deployment-plan.md), чтобы помочь Azure Active Directory (Azure AD) обеспечить лучшую диагностику и решения при использовании средств тестирования на портале Azure.
- Воспроизведите ошибку с помощью средств тестирования на странице конфигурации приложения портала Azure. Дополнительные сведения об [отладке приложений единого входа на основе SAML](./debug-saml-sso-issues.md)

Если вы используете [опыт тестирования](./debug-saml-sso-issues.md) в портал Azure с расширением "Защищенный браузер" Мои приложения ", вам не нужно вручную выполнять указанные ниже действия, чтобы открыть страницу настройки единого входа на основе SAML.

Чтобы открыть страницу настройки единого входа на основе SAML, выполните следующие действия:
1.  Откройте [**портал Azure**](https://portal.azure.com/) и войдите в систему как **глобальный администратор** или **Соадминистратор**.
1.  Откройте **расширение Azure Active Directory** , выбрав **все службы** в верхней части главного меню навигации слева.
1.  В поле фильтра поиска введите **"Azure Active Directory"** и выберите элемент **Azure Active Directory** .
1.  В меню навигации Azure Active Directory слева выберите **Корпоративные приложения**.
1.  Щелкните **Все приложения**, чтобы просмотреть полный список приложений.

    Если нужное приложение отсутствует в списке, обратитесь к элементу управления **Фильтр** в верхней части списка **Все приложения** и для параметра **Показать** выберите значение **Все приложения**.

1.  Выберите приложение, для которого нужно настроить единый вход.
1. После загрузки приложения выберите **единый вход** в меню навигации слева приложения.
1. Выберите параметр SAML-based SSO (Единый вход на основе SAML).

## <a name="application-not-found-in-directory"></a>Приложение не найдено в каталоге
`Error AADSTS70001: Application with Identifier 'https:\//contoso.com' was not found in the directory.`

**Возможные причины**

`Issuer`Атрибут, отправленный из приложения в Azure AD в запросе SAML, не соответствует значению идентификатора, настроенному для приложения в Azure AD.

**Решение**

Убедитесь, что `Issuer` атрибут в запросе SAML соответствует значению идентификатора, настроенному в Azure AD.

На странице Настройка единого входа на основе SAML в разделе **Базовая конфигурация SAML** убедитесь, что значение в текстовом поле идентификатор соответствует значению идентификатора, отображаемому в сообщении об ошибке.

## <a name="the-reply-address-does-not-match-the-reply-addresses-configured-for-the-application"></a>Адрес отклика не соответствует адресам ответа, настроенным для приложения
`Error AADSTS50011: The reply address 'https:\//contoso.com' does not match the reply addresses configured for the application.`

**Возможные причины**

`AssertionConsumerServiceURL`Значение в запросе SAML не соответствует значению URL-адреса ответа или шаблону, настроенному в Azure AD. `AssertionConsumerServiceURL`Значение в запросе SAML — это URL-адрес, который вы видите в ошибке.

**Решение**

Убедитесь, что `AssertionConsumerServiceURL` значение в запросе SAML соответствует значению URL-адреса ответа, настроенному в Azure AD. 

Проверьте или обновите значение в текстовом поле URL-адрес ответа, чтобы оно совпадало со `AssertionConsumerServiceURL` значением в запросе SAML.   

После обновления значения URL-адреса ответа в Azure AD, которое соответствует значению, отправленному приложением в запросе SAML, вы сможете войти в приложение.

## <a name="user-not-assigned-a-role"></a>Не назначена роль пользователя
`Error AADSTS50105: The signed in user 'brian\@contoso.com' is not assigned to a role for the application.`

**Возможные причины**

Пользователю не предоставлен доступ к приложению в Azure AD.

**Решение**

Сведения о назначении одного или нескольких пользователей приложению напрямую см. в разделе [Краткое руководство. Назначение пользователей приложению](add-application-portal-assign-users.md).

## <a name="not-a-valid-saml-request"></a>Недопустимый запрос SAML
`Error AADSTS75005: The request is not a valid Saml2 protocol message.`

**Возможные причины**

Azure AD не поддерживает запрос SAML, отправленный приложением для единого входа. К наиболее распространенным проблемам относятся:
- Отсутствие обязательных полей в запросе SAML
- Метод кодировки запроса SAML

**Решение**

1. Запишите запрос SAML. Следуйте указаниям в руководстве по [отладке единого входа на основе SAML в приложения в Azure AD](./debug-saml-sso-issues.md) , чтобы узнать, как записать запрос SAML.
1. Свяжитесь с поставщиком приложения и передайте ему следующие сведения:
    - Запрос SAML
    - [Требования к протоколу SAML единого входа в Azure](../develop/single-sign-on-saml-protocol.md)

Поставщик приложения должен проверить, что он поддерживает реализацию SAML в Azure AD для единого входа.

## <a name="misconfigured-application"></a>Неправильно настроенное приложение
`Error AADSTS650056: Misconfigured application. This could be due to one of the following: The client has not listed any permissions in the requested permissions in the client's application registration. Or, The admin has not consented in the tenant. Or, Check the application identifier in the request to ensure it matches the configured client application identifier. Please contact your admin to fix the configuration or consent on behalf of the tenant.`

**Возможные причины**

`Issuer`Атрибут, отправленный из приложения в Azure AD в запросе SAML, не соответствует значению идентификатора, настроенному для приложения в Azure AD.

**Решение**

Убедитесь, что `Issuer` атрибут в запросе SAML соответствует значению идентификатора, настроенному в Azure AD. 

Убедитесь, что значение в текстовом поле идентификатор совпадает со значением идентификатора, отображаемого в ошибке.

## <a name="certificate-or-key-not-configured"></a>Не настроен сертификат или ключ
`Error AADSTS50003: No signing key configured.`

**Возможные причины**

Поврежден объект приложения, и Azure AD не распознает сертификат, настроенный для приложения.

**Решение**

Чтобы удалить и создать сертификат, выполните следующие действия:
1. На экране Настройка единого входа на основе SAML выберите **создать новый сертификат** в разделе **сертификат подписи SAML** .
1. Выберите срок действия и нажмите кнопку **сохранить**.
1. Установите флажок **сделать новый сертификат активным** , чтобы переопределить активный сертификат. Нажмите кнопку **Сохранить** в верхней части области и активируйте сертификат возобновления.
1. В разделе **сертификат подписи SAML** нажмите кнопку **Удалить** , чтобы удалить **неиспользуемый** сертификат.

## <a name="saml-request-not-present-in-the-request"></a>Отсутствие запроса SAML в запросе
`Error AADSTS750054: SAMLRequest or SAMLResponse must be present as query string parameters in HTTP request for SAML Redirect binding.`

**Возможные причины**

Azure AD не удалось определить запрос SAML в параметрах URL-адреса в HTTP-запросе. Это может произойти, если приложение не использует привязку перенаправления HTTP при отправке запроса SAML в Azure AD.

**Решение**

Приложению необходимо отправить запрос SAML, закодированный в заголовке Location, с помощью привязки перенаправления HTTP. Дополнительные сведения о реализации см. в разделе о HTTP перенаправлении привязки в документе спецификации протокола SAML [здесь](https://docs.oasis-open.org/security/saml/v2.0/saml-bindings-2.0-os.pdf).

## <a name="azure-ad-is-sending-the-token-to-an-incorrect-endpoint"></a>Azure AD отправляет маркер в неправильную конечную точку
**Возможные причины**

Во время единого входа, если запрос на вход не содержит явных URL-адресов ответа (URL-адрес службы утверждения), Azure AD выберет для этого приложения любой из настроенных URL-адресов ответа. Даже если для приложения настроен явный URL-адрес ответа, пользователь может перенаправить его https://127.0.0.1:444 . 

Когда приложение добавлялось как не входящее в коллекцию, служба Azure Active Directory создавала этот URL-адрес ответа как значение по умолчанию. Эта схема изменена, и теперь Azure Active Directory больше не добавляет по умолчанию этот URL-адрес. 

**Решение**

Удалите неиспользуемые URL-адреса ответа, настроенные для приложения.

На странице Настройка единого входа на основе SAML в разделе **URL-адрес ответа (URL-адрес службы утверждения)** удалите неиспользуемые или URL-адреса ответа по умолчанию, созданные системой. Например, `https://127.0.0.1:444/applications/default.aspx`.


## <a name="authentication-method-by-which-the-user-authenticated-with-the-service-doesnt-match-requested-authentication-method"></a>Метод проверки подлинности, по которому пользователь, прошедший проверку подлинности в службе, не соответствует запрошенному методу
`Error: AADSTS75011 Authentication method by which the user authenticated with the service doesn't match requested authentication method 'AuthnContextClassRef'. `

**Возможные причины**

Объект `RequestedAuthnContext` находится в запросе SAML. Это означает, что приложение ожидает объект, указанный параметром `AuthnContext` `AuthnContextClassRef` . Тем не менее, пользователь уже прошел проверку подлинности до доступа к приложению и `AuthnContext` (метод проверки подлинности), используемый для предыдущей проверки подлинности, отличается от запрашиваемой. Например, произошла попытка федеративного пользователя получить доступ к myappам и WIA. `AuthnContextClassRef`Будет иметь значение `urn:federation:authentication:windows` . AAD не выполняет новый запрос проверки подлинности, он будет использовать контекст проверки подлинности, переданный в IdP (ADFS или любая другая служба Федерации в этом случае). Поэтому при запросе приложения, кроме, будет обнаружено несовпадение `urn:federation:authentication:windows` . Другой сценарий — использование многофакторного факта: `'X509, MultiFactor` .

**Решение**


`RequestedAuthnContext` является необязательным значением. Если это возможно, запросите приложение, если оно может быть удалено.

Другой вариант — убедиться, что `RequestedAuthnContext` будет учитываться. Это будет сделано путем запроса новой проверки подлинности. Таким образом, при обработке запроса SAML будет выполнена новая проверка подлинности и `AuthnContext` будет учитываться. Чтобы запросить новую проверку подлинности, запрос SAML, который больше всего содержит это значение `forceAuthn="true"` . 



## <a name="problem-when-customizing-the-saml-claims-sent-to-an-application"></a>Проблема при настройке утверждений SAML, отправляемых в приложение
Сведения о настройке утверждений атрибута SAML, отправляемых в приложение, см. [в разделе Сопоставление утверждений в Azure Active Directory](../develop/active-directory-claims-mapping.md).

## <a name="errors-related-to-misconfigured-apps"></a>Ошибки, связанные с неправильно настроенными приложениями
Убедитесь, что конфигурации на портале соответствуют значениям в приложении. В частности, сравните идентификатор клиента и приложения, URL-адреса ответа, ключи и секреты клиентов, а также URI идентификатора приложения.

Сравните ресурсы, к которым вы обращаетесь из кода с помощью настроенных на вкладке **Необходимые ресурсы** разрешений, чтобы запрашивались только настроенные ресурсы.

## <a name="next-steps"></a>Дальнейшие действия
- [Серия кратких руководств по управлению приложениями](add-application-portal-assign-users.md)
- [Отладка единого входа на основе SAML в приложения в Azure Active Directory](./debug-saml-sso-issues.md)
- [Требования к протоколу SAML единого входа в Azure](../develop/single-sign-on-saml-protocol.md)