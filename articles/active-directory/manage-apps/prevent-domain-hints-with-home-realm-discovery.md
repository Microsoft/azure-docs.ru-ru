---
title: Предотвращение автоматического ускорения входа в Azure AD с помощью политики обнаружения домашней области
description: Узнайте, как предотвратить domain_hint автоматическое ускорение в Федеративные поставщиков удостоверений.
services: active-directory
documentationcenter: ''
author: kenwith
manager: daveba
ms.service: active-directory
ms.subservice: app-mgmt
ms.workload: infrastructure-services
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: how-to
ms.date: 02/12/2021
ms.author: hirsin
ms.openlocfilehash: 53dfdfaf37695059d6d52428c2ba109970d9f7f7
ms.sourcegitcommit: 772eb9c6684dd4864e0ba507945a83e48b8c16f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "104589384"
---
# <a name="disable-auto-acceleration-to-a-federated-idp-during-user-sign-in-with-home-realm-discovery-policy"></a>Отключение автоматического ускорения для федеративного IDP во время входа пользователя с помощью политики обнаружения домашней области

[Политика обнаружения домашних областей](/graph/api/resources/homeRealmDiscoveryPolicy) (обнаружения домашней области) предоставляет администраторам несколько способов контроля над тем, как и где пользователи проходят проверку подлинности. `domainHintPolicy`Раздел политики обнаружения домашней области используется для миграции федеративных пользователей на облачные управляемые учетные данные, такие как [Fido](../authentication/howto-authentication-passwordless-security-key.md), гарантируя, что они всегда будут посещать страницу входа в Azure AD и не будут использовать автоматическое УСКОРЕНИЕ в Федеративной IDP из-за указания домена.

Эта политика необходима в тех случаях, когда приложения, которыми администратор не может управлять или обновлять Добавление подсказок в домене во время входа.  Например, `outlook.com/contoso.com` отправляет пользователя на страницу входа с `&domain_hint=contoso.com` добавленным параметром для автоматического ускорения пользователя к Федеративной IDP для `contoso.com` домена. Пользователи с управляемыми учетными данными, отправленными в федеративный IDP, не могут войти в систему с использованием своих управляемых учетных данных, уменьшая безопасность и испытывающие неприятности пользователей с случайным входом в систему. При развертывании управляемых учетных данных администраторами [также следует настроить эту политику](#suggested-use-within-a-tenant) , чтобы пользователи всегда могли использовать свои управляемые учетные данные.

## <a name="domainhintpolicy-details"></a>Сведения о Домаинхинтполици

Раздел Домаинхинтполици политики обнаружения домашней области — это объект JSON, позволяющий администратору отказаться от использования определенных доменов и приложений из указания домена.  Функционально, это указывает на то, что страница входа в Azure AD будет работать так, как если бы `domain_hint` параметр в запросе на вход отсутствовал.

### <a name="the-respect-and-ignore-policy-sections"></a>Разделы политики «соблюдение и игнорирование»

|Section | Значение | Значения |
|--------|---------|--------|
|`IgnoreDomainHintForDomains` |Если это указание домена отправляется в запросе, игнорируйте его. |Массив адресов домена (например `contoso.com` ,). Также поддерживает `all_domains`|
|`RespectDomainHintForDomains`| Если это указание домена отправляется в запросе, соблюдайте его, даже если `IgnoreDomainHintForApps` указывает, что приложение в запросе не должно использовать автоматическое ускорение. Это используется для снижения развертывания нерекомендуемых подсказок домена в сети. можно указать, что некоторые домены должны работать быстрее. | Массив адресов домена (например `contoso.com` ,). Также поддерживает `all_domains`|
|`IgnoreDomainHintForApps`| Если запрос из этого приложения поставляется с указанием домена, игнорируйте его. | Массив идентификаторов приложений (GUID). Также поддерживает `all_apps`|
|`RespectDomainHintForApps` |Если запрос из этого приложения поставляется с указанием домена, соблюдайте его даже при `IgnoreDomainHintForDomains` включении этого домена. Используется для того, чтобы некоторые приложения продолжали работать при обнаружении прерывания без указания домена. | Массив идентификаторов приложений (GUID). Также поддерживает `all_apps`|

### <a name="policy-evaluation"></a>Оценка политики

Логика Домаинхинтполици выполняется для каждого входящего запроса, содержащего указание домена, и ускоряется на основе двух фрагментов данных в запросе — домена в указании домена и идентификатора клиента (приложения). В сокращенном варианте "уважение" для домена или приложения имеет приоритет над инструкцией, чтобы игнорировать Указание домена для данного домена или приложения.

1. При отсутствии политики указания предметной области или если ни один из 4 разделов не ссылается на указанную подсказку приложения или домена, [будет вычислена остальная часть политики обнаружения домашней области](configure-authentication-for-federated-users-portal.md#priority-and-evaluation-of-hrd-policies).
1. Если один (или оба) `RespectDomainHintForApps` `RespectDomainHintForDomains` раздела или содержит указание приложения или домена в запросе, то пользователь будет выполнять автоматическое ускорение в Федеративной IDP по мере запроса.
1. Если один (или оба) `IgnoreDomainHintsForApps` или `IgnoreDomainHintsForDomains` ссылается на приложение или подсказку домена в запросе и на них нет ссылок в разделах "уважение", запрос не будет выполнен без автоматического ускорения, и пользователь останется на странице входа в Azure AD, чтобы указать имя пользователя.

Когда пользователь вводит имя пользователя на странице входа, он может использовать свои управляемые учетные данные, если они зарегистрированы.  Если они решили не использовать управляемые учетные данные или они не зарегистрированы, они будут переведены на Федеративные IDP для учетных данных в обычном режиме.

## <a name="suggested-use-within-a-tenant"></a>Предлагаемое использование в клиенте

Администраторы федеративных доменов должны настроить этот раздел политики обнаружения домашней области в 4-фазном плане. Цель этого плана — в конечном итоге, чтобы все пользователи в клиенте могли использовать свои управляемые учетные данные независимо от домена или приложения, сохраняйте эти приложения с жесткими зависимостями при `domain_hint` использовании.  Этот план помогает администраторам найти эти приложения, исключить их из новой политики и продолжить развертывание изменений в остальной части клиента.

1. Выберите домен, чтобы изначально выполнить это изменение.  Это будет ваш тестовый домен, поэтому выберите один из них, который может быть более порожден для изменений в UX (т. е. просматривать другую страницу входа).  При этом будут проигнорированы все указания домена для всех приложений, использующих это доменное имя. [Задайте](#configuring-policy-through-graph-explorer) эту политику в клиенте — политика обнаружения домашней области по умолчанию:

```json
 "DomainHintPolicy": { 
    "IgnoreDomainHintForDomains": [ "testDomain.com" ], 
    "RespectDomainHintForDomains": [], 
    "IgnoreDomainHintForApps": [], 
    "RespectDomainHintForApps": [] 
} 
```

2. Сбор отзывов от пользователей тестовых доменов. Собирайте сведения о приложениях, которые были нарушены в результате этого изменения — они имеют зависимость от использования указания домена и должны быть обновлены. Пока добавьте их в `RespectDomainHintForApps` раздел:

```json
 "DomainHintPolicy": { 
    "IgnoreDomainHintForDomains": [ "testDomain.com" ], 
    "RespectDomainHintForDomains": [], 
    "IgnoreDomainHintForApps": [], 
    "RespectDomainHintForApps": ["app1-clientID-Guid", "app2-clientID-Guid] 
} 
```

3. Продолжите развертывание политики в новых доменах, чтобы собрать дополнительные отзывы.

```json
 "DomainHintPolicy": { 
    "IgnoreDomainHintForDomains": [ "testDomain.com", "otherDomain.com", "anotherDomain.com"], 
    "RespectDomainHintForDomains": [], 
    "IgnoreDomainHintForApps": [], 
    "RespectDomainHintForApps": ["app1-clientID-Guid", "app2-clientID-Guid] 
} 
```

4. Завершите развертывание — целевую платформу для всех доменов, исключая те, которые должны продолжать ускоряться:

```json
 "DomainHintPolicy": { 
    "IgnoreDomainHintForDomains": [ "*" ], 
    "RespectDomainHintForDomains": ["guestHandlingDomain.com"], 
    "IgnoreDomainHintForApps": [], 
    "RespectDomainHintForApps": ["app1-clientID-Guid", "app2-clientID-Guid] 
} 
```

После выполнения шага 4 все пользователи, за исключением тех, кто в `guestHandlingDomain.com` , могут войти на страницу входа в Azure AD, даже если в других подсказках домена это привело бы к автоматическому ускорению ФЕДЕРАТИВНОГО IDP.  Исключением является то, что приложение, запрашивающее вход, является одним из исключенных для этих приложений. все указания домена все равно будут приняты.

## <a name="configuring-policy-through-graph-explorer"></a>Настройка политики с помощью Graph Explorer

Задайте [политику обнаружения домашней области](/graph/api/resources/homeRealmDiscoveryPolicy) обычным образом с помощью Microsoft Graph.  

1. Предоставьте разрешение Policy. ReadWrite. Аппликатионконфигуратион в [обозревателе Graph](https://developer.microsoft.com/graph/graph-explorer).  
1. Использовать URL-адрес `https://graph.microsoft.com/v1.0/policies/homeRealmDiscoveryPolicies`
1. Опубликуйте новую политику по этому URL-адресу или выполните исправление для `/policies/homerealmdiscoveryPolicies/{policyID}` него, если перезаписать существующий.

Содержимое публикации или исправления:

```json
{
    "displayName":"Home Realm Discovery Domain Hint Exclusion Policy",
    "definition":[
        "{\"HomeRealmDiscoveryPolicy\" : {\"DomainHintPolicy\": { \"IgnoreDomainHintForDomains\": [ \"Contoso.com\" ], \"RespectDomainHintForDomains\": [], \"IgnoreDomainHintForApps\": [\"sample-guid-483c-9dea-7de4b5d0a54a\"], \"RespectDomainHintForApps\": [] } } }"
    ],
    "isOrganizationDefault":true
}
```

Не забудьте использовать косую черту для переключения `Definition` раздела JSON при использовании Graph.  

`isOrganizationDefault` должно иметь значение true, но displayName и Definition могут измениться.

## <a name="next-steps"></a>Дальнейшие действия

* [Включить вход с помощью ключа безопасности без пароля](../authentication/howto-authentication-passwordless-security-key.md)
* [Включение входа без пароля с помощью приложения Microsoft Authenticator](../authentication/howto-authentication-passwordless-phone.md)