---
title: Общие сведения об едином входе на основе SAML для приложений в Azure Active Directory
description: Общие сведения об едином входе на основе SAML для приложений в Azure Active Directory
services: active-directory
author: kenwith
manager: celestedg
ms.service: active-directory
ms.subservice: app-mgmt
ms.topic: conceptual
ms.workload: identity
ms.date: 07/28/2020
ms.author: kenwith
ms.reviewer: arvinh,luleon
ms.openlocfilehash: 32e654f002e3ba0c8bf72fb781b32d9098d83c00
ms.sourcegitcommit: d59abc5bfad604909a107d05c5dc1b9a193214a8
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/14/2021
ms.locfileid: "98219850"
---
# <a name="understand-saml-based-single-sign-on"></a>Общие сведения о едином входе на основе SAML

В [серии "быстрый](view-applications-portal.md) запуск" по управлению приложениями вы узнали, как использовать Azure AD в качестве поставщика удостоверений (IDP) для приложения. В этой статье подробно рассматривается параметр единого входа на основе SAML. 


## <a name="before-you-begin"></a>Перед началом

Использование Azure AD в качестве поставщика удостоверений (IdP) и Настройка единого входа (SSO) могут быть простыми или сложными в зависимости от используемого приложения. Некоторые приложения можно настроить с помощью всего нескольких действий. Для других требуется подробная конфигурация. Для быстрого увеличения знаний пошаговые [руководства](view-applications-portal.md) по управлению приложениями. Если добавляемое приложение является простым, вам, скорее всего, не придется читать эту статью. Если для добавляемого приложения требуется настраиваемая Настройка единого входа на основе SAML, то эта статья предназначена для вас.

В [серии "быстрый](add-application-portal-setup-sso.md)запуск" приведена статья о настройке единого входа. В нем вы узнаете, как получить доступ к странице конфигурации SAML для приложения. Страница настройки SAML включает пять разделов. Эти разделы подробно обсуждаются в этой статье.

> [!IMPORTANT] 
> Существует несколько сценариев, в которых параметр **единого входа** отсутствует в навигации для приложения в **корпоративных приложениях**. 
>
> Если приложение было зарегистрировано с помощью **Регистрация приложений** то функция единого входа по умолчанию настроена на использование OAuth OIDC. В этом случае параметр **единого входа** не отображается в области навигации в разделе **корпоративные приложения**. При использовании **Регистрация приложений** для добавления пользовательского приложения необходимо настроить параметры в файле манифеста. Дополнительные сведения о файле манифеста см. в разделе [Azure Active Directory App manifest](../develop/reference-app-manifest.md). Дополнительные сведения о стандартах единого входа см. в статье [Проверка подлинности и авторизация с помощью платформы Microsoft Identity](../develop/authentication-vs-authorization.md#authentication-and-authorization-using-the-microsoft-identity-platform). 
>
> В других сценариях, где в переходе будет отсутствовать **единый вход** , появится сообщение о том, что приложение размещено в другом клиенте или если у вашей учетной записи нет необходимых разрешений (глобальный администратор, администратор облачных приложений, администратор приложения или владелец субъекта-службы). Кроме того, разрешения могут вызвать сценарий, в котором можно открыть **единый вход** , но сохранить его не удастся. Дополнительные сведения об административных ролях Azure AD см. в разделе ( https://docs.microsoft.com/azure/active-directory/users-groups-roles/directory-assign-admin-roles) .


## <a name="basic-saml-configuration"></a>Базовая конфигурация SAML

Их можно получить у поставщика приложения. Вы можете вручную ввести значения или отправить файл метаданных, чтобы извлечь значения полей.

> [!TIP]
> Многие приложения уже были предварительно настроены для работы с Azure AD. Эти приложения перечислены в коллекции приложений, которые можно просматривать при добавлении приложения в клиент Azure AD. Этот процесс описан в [серии](add-application-portal-setup-sso.md) быстрого запуска. Для приложений в коллекции можно просмотреть подробные пошаговые инструкции. Чтобы получить доступ к шагам, щелкните ссылку на странице конфигурации SAML для приложения, как описано в разделе Быстрый запуск, или просмотрите список всех руководств по настройке приложений в руководстве по [настройке приложений SaaS](../saas-apps/tutorial-list.md).

| Параметр "Базовая конфигурация SAML" | Инициированный поставщиком услуг | Инициированный поставщиком удостоверений | Описание |
|:--|:--|:--|:--|
| **Идентификатор (идентификатор сущности)** | Требуется для некоторых приложений | Требуется для некоторых приложений | Служит для уникальной идентификации приложения. Azure AD отправляет идентификатор в приложение в качестве параметра "Аудитория" токена SAML. Приложение должно проверить его. Это значение также отображается как идентификатор сущности во всех метаданных SAML, предоставленных приложением. Введите URL-адрес в следующем формате: https://<subdomain>. contoso.com *. Это значение можно найти в элементе **Издатель** в запросе **AuthnRequest** (запросе SAML), отправленном приложением.* |
| **URL-адрес ответа** | Обязательно | Обязательно | Этот параметр указывает место, где приложение ожидает токен SAML. URL-адрес ответа также называется URL-адресом службы обработчика утверждений (ACS). Для указания нескольких URL-адресов ответа можно использовать дополнительные поля URL-адреса ответа. Например, для нескольких поддоменов могут потребоваться дополнительные URL-адреса ответа. Также в целях тестирования можно одновременно указать несколько URL-адресов ответа (локальный узел и общедоступные URL-адреса). |
| **URL-адрес входа** | Обязательно | Не указывайте | Когда пользователь открывает этот URL-адрес, поставщик услуг выполняет перенаправление в Azure AD для аутентификации и входа пользователя в систему. Azure AD использует URL-адрес для запуска приложения из Microsoft 365 или Azure AD мои приложения. Если это поле не указано, Azure AD выполняет IdP вход, когда пользователь запускает приложение из Microsoft 365, Azure AD мои приложения или URL-адрес единого входа Azure AD.|
| **Состояние ретранслятора** | Необязательно | Необязательно | Указывает приложению, куда перенаправить пользователя после аутентификации. Обычно здесь указывается допустимый URL-адрес приложения. Но некоторые приложения используют это поле по-другому. Чтобы получить дополнительные сведения, обратитесь к поставщику приложения.
| **URL-адрес выхода**. | Необязательно | Необязательно | Используется для отправки приложению ответов при завершении сеанса SAML.

## <a name="user-attributes-and-claims"></a>Атрибуты и утверждения пользователя 

Когда пользователь проходит проверку подлинности в приложении, Azure AD выдает приложению токен SAML. В нем собрана информация (утверждения), которая однозначно идентифицирует пользователя. По умолчанию в нем указаны имя для входа, адрес электронной почты, имя и фамилия пользователя. Может потребоваться настроить эти утверждения, например, если приложению требуются определенные значения утверждений или **Имя** в формате, отличном от имени пользователя. 

> [!IMPORTANT]
> Многие приложения уже предварительно настроены и в коллекции приложений, и вам не нужно беспокоиться о настройке утверждений для пользователей и групп. В [серии](add-application-portal.md) быстрого запуска содержатся инструкции по добавлению и настройке приложений.


**Уникальный идентификатор пользователя (идентификатор имени)** — это обязательное утверждение, которое имеет важное значение. Значение по умолчанию — *User. userPrincipalName*. Идентификатор пользователя является уникальным идентификатором для каждого пользователя в приложении. Например, если адрес электронной почты является и именем пользователя, и уникальным идентификатором, задайте значение *user.mail*.

Дополнительные сведения о настройке утверждений SAML см. в разделе [как настроить утверждения, выданные в токене SAML для корпоративных приложений](../develop/active-directory-saml-claims-customization.md).

Вы можете добавить новые утверждения, дополнительные сведения [см. в разделе о](../hybrid/how-to-connect-fed-group-claims.md)добавлении утверждений для [конкретных приложений](../develop/active-directory-saml-claims-customization.md#adding-application-specific-claims) или добавлении групповых утверждений.


> [!NOTE]
> Дополнительные способы настройки токена SAML из Azure AD в приложение см. в следующих ресурсах.
>- Сведения о создании пользовательских ролей с помощью портала Azure см. в статье о [настройке утверждений роли](../develop/active-directory-enterprise-app-role-management.md).
>- Сведения о настройке утверждений с помощью PowerShell см. в статье о [настройке утверждений в PowerShell](../develop/active-directory-claims-mapping.md).
>- Сведения об изменении манифеста приложения для настройки необязательных утверждений для вашего приложения см. в [этой статье](../develop/active-directory-optional-claims.md).
>- Сведения о настройке политик времени жизни маркера для маркеров обновления, доступа, сеансов и идентификатора см. в статье [Configurable token lifetimes in Azure Active Directory (Preview)](../develop/active-directory-configurable-token-lifetimes.md) (Время существования маркеров с возможностью настройки в Azure Active Directory (предварительная версия)). Сведения об ограничении сеансов проверки подлинности с помощью условного доступа Azure AD см. в [этой статье](../conditional-access/howto-conditional-access-session-lifetime.md).

## <a name="saml-signing-certificate"></a>Сертификат подписи SAML

Azure AD использует сертификат для подписи токенов SAML, отправляемых в приложение. Этот сертификат необходим для настройки доверия между Azure AD и приложением. Дополнительные сведения о формате сертификата см. в документации по SAML приложения. Дополнительные сведения см. в разделах [Управление сертификатами для федеративного единого входа](manage-certificates-for-federated-single-sign-on.md) и [Дополнительные параметры подписи сертификата в токене SAML](certificate-signing-options.md).

> [!IMPORTANT]
> Многие приложения уже предварительно настроены и в коллекции приложений, и вам не нужно углубляться в сертификаты. В [серии](add-application-portal.md) быстрого запуска содержатся инструкции по добавлению и настройке приложений.

Из Azure AD можно скачать активный сертификат в формате Base64 или RAW непосредственно на главной странице **Настройка единого входа с помощью SAML**. Кроме того, активный сертификат можно получить, загрузив XML-файл метаданных приложения или указав URL-адрес метаданных федерации приложения. Чтобы просмотреть, создать или скачать сертификаты (активные или неактивные), выполните следующие действия.

Ниже перечислены некоторые распространенные моменты, которые необходимо выполнить для проверки сертификата. 
   - *Правильная дата окончания срока действия.* Вы можете настроить срок действия до трех лет в будущем.
   - *Состояние активности для правильного сертификата.* Если сертификат находится в **неактивном** состоянии, переведите его в **активное** состояние. Чтобы изменить состояние, щелкните правой кнопкой мыши строку сертификата и выберите **сделать сертификат активным**.
   - *Правильный параметр подписывания и алгоритм.*
   - *Правильные адреса электронной почты для отправки уведомлений.* Если приближается дата окончания срока действия активного сертификата, Azure AD отправляет соответствующее уведомление на электронный адрес, указанный в этом поле.

Иногда может потребоваться Скачать сертификат. Будьте внимательны при сохранении. Чтобы скачать сертификат, выберите один из параметров в формате Base64, RAW или в формате XML-файла метаданных федерации. Azure AD также предоставляет **URL-адрес метаданных федерации приложений**, в котором можно получить доступ к метаданным, уникальным для приложения, в формате `https://login.microsoftonline.com/<Directory ID>/federationmetadata/2007-06/federationmetadata.xml?appid=<Application ID>`.

> [!NOTE]
> Приложение должно поддерживать обработку маркера порядка байтов, присутствующего в XML-коде, подготовленном при использовании https://login.microsoftonline.com/{tenant-id}/federationmetadata/2007-06/federationmetadata.xml?appid={app-id} . Метка порядка байтов представляется как непечатный символ ASCII «¿», а в шестнадцатеричном формате он представлен как EF BB BF при просмотре XML-данных.

Чтобы изменить сертификат, нажмите кнопку Изменить. На странице **сертификата подписи SAML** можно выполнить несколько действий.
   - Создать новый сертификат: выберите **новый сертификат**, выберите **дату окончания срока действия** и нажмите кнопку **сохранить**. Чтобы активировать сертификат, выберите контекстное меню ( **...** ) и пункт **Активировать сертификат**.
   - Отправьте сертификат с закрытым ключом и учетными данными PFX: выберите **Импорт сертификата** и перейдите к сертификату. Введите **пароль PFX**, а затем щелкните **Добавить**.  
   - Настройка расширенной подписи сертификата. Дополнительные сведения об этих параметрах см. в разделе [Расширенные параметры подписи сертификатов](certificate-signing-options.md).
   - Уведомлять дополнительных пользователей, если срок действия активного сертификата приближается к дате окончания срока его годности: введите адреса электронной почты в полях **уведомления по электронной почте** .

## <a name="set-up-the-application-to-use-azure-ad"></a>Настройка использования Azure AD в приложении

В разделе **Настройка \<applicationName>** перечислены значения, которые необходимо настроить в приложении, поэтому он будет использовать Azure AD в качестве поставщика удостоверений SAML. Значения задаются на странице Конфигурация на веб-сайте приложения. Например, если вы настраиваете GitHub, перейдите на сайт github.com и задайте значения. Если приложение уже предварительно настроено и в коллекции Azure AD вы найдете ссылку для просмотра пошаговых **инструкций**. В противном случае необходимо найти документацию для настраиваемого приложения. 

Значения **URL-адреса входа** и **URL-адреса выхода** разрешаются в одну и ту же конечную точку, которая является КОНЕЧНОЙ точкой обработки запросов SAML для клиента Azure AD. 

**Идентификатор Azure AD** — это значение **издателя** в токене SAML, выданном приложению.

## <a name="test-single-sign-on"></a>Проверка единого входа

После настройки приложения на использование Azure AD в качестве поставщика удостоверений на основе SAML можно проверить параметры, чтобы узнать, работает ли единый вход для вашей учетной записи. 

Выберите **тест** , а затем щелкните, чтобы проверить текущий пользователь. 

Если вход выполнен успешно, можно приступить к назначению пользователей и групп для приложения SAML. Поздравляем!

Если появится сообщение об ошибке, сделайте следующее:

1. Скопируйте и вставьте сведения об ошибке в поле **Как выглядит ошибка**.

    ![Получение рекомендаций по устранению](media/configure-single-sign-on-non-gallery-applications/error-guidance.png)

2. Щелкните **Получить рекомендации по устранению**. Отобразятся сведения о причине ошибки и рекомендации по ее устранению.  В этом примере пользователь не был назначен приложению.

3. Ознакомьтесь с руководством по разрешению и попытайтесь устранить проблему.

4. Выполните проверку еще раз, чтобы она завершилась успешно.

Дополнительные сведения см. в статье [Отладка единого входа на основе SAML в приложениях в Azure Active Directory](./debug-saml-sso-issues.md).


## <a name="next-steps"></a>Дальнейшие действия

- [Серия кратких руководств по управлению приложениями](view-applications-portal.md)
- [Assign users and groups to an application in Azure Active Directory](./assign-user-or-group-access-portal.md) (Назначение пользователей и групп для приложения в Azure Active Directory)
- [Managing user account provisioning for enterprise apps in the Azure portal](../app-provisioning/configure-automatic-user-provisioning-portal.md) (Управление подготовкой учетных записей пользователей для корпоративных приложений на портале Azure)
- [Протокол единого входа SAML](../develop/single-sign-on-saml-protocol.md)
