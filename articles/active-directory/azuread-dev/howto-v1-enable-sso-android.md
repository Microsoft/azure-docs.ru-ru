---
title: Включение единого входа для нескольких приложений Android с помощью ADAL | Документация Майкрософт
description: Использование функций пакета SDK для ADAL для включения единого входа в приложениях.
services: active-directory
author: rwike77
manager: CelesteDG
ms.service: active-directory
ms.subservice: azuread-dev
ms.workload: identity
ms.tgt_pltfrm: android
ms.devlang: java
ms.topic: how-to
ms.date: 09/24/2018
ms.author: ryanwi
ms.reviewer: brandwe, jmprieur
ms.custom: aaddev, devx-track-java
ROBOTS: NOINDEX
ms.openlocfilehash: 9d1faf7aed5cf4c4975925c7a56d169dc99a7bd5
ms.sourcegitcommit: 772eb9c6684dd4864e0ba507945a83e48b8c16f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "87313597"
---
# <a name="how-to-enable-cross-app-sso-on-android-using-adal"></a>Включение единого входа для нескольких приложений Android с помощью ADAL

[!INCLUDE [active-directory-azuread-dev](../../../includes/active-directory-azuread-dev.md)]

Единый вход позволяет пользователям единожды ввести свои учетные данные, и в дальнейшем эти учетные данные будут автоматически использоваться в приложениях и платформах, используемых другими приложениями (например, учетные записи Майкрософт или рабочие учетные записи Microsoft 365) независимо от издателя.

Платформа удостоверений Майкрософт вместе с пакетами SDK упрощает включение единого входа в собственный набор приложений или с возможностями брокера и приложениями Authenticator на всем устройстве.

В этих инструкциях описывается, как в приложении настроить пакет SDK, чтобы ваши клиенты смогли воспользоваться функцией единого входа.

## <a name="prerequisites"></a>Предварительные требования

В этих инструкциях предполагается, что вы знаете следующее.

- Как подготовить приложение с помощью предыдущей версии портала для Azure Active Directory (Azure AD). Дополнительные сведения см. в статье [Регистрация приложения](../develop/quickstart-register-app.md?toc=/azure/active-directory/azuread-dev/toc.json&bc=/azure/active-directory/azuread-dev/breadcrumb/toc.json) .
- Как интегрировать приложение с помощью [пакета SDK Azure AD для Android](https://github.com/AzureAD/azure-activedirectory-library-for-android).

## <a name="single-sign-on-concepts"></a>Основные понятия единого входа

### <a name="identity-brokers"></a>Брокеры удостоверений

Корпорация Майкрософт предоставляет приложения для всех мобильных платформ, которые позволяют привязывать учетные данные к приложениям разных поставщиков и использовать расширенные возможности, требующие единого безопасного места для проверки учетных данных. Такие приложения называются **брокерами**.

В iOS и Android брокеры доступны в скачиваемых приложениях, которые пользователи устанавливают самостоятельно, либо их может передавать на устройство сотрудника компания, частично или полностью управляющая устройствами своих сотрудников. Брокеры поддерживают управление безопасностью только для некоторых приложений или для всего устройства в зависимости от конфигурации, выполненной ИТ-администратором. В Windows этот компонент предоставляется средством выбора учетной записи, встроенным в операционную систему (его техническое название — брокер веб-аутентификации).

#### <a name="broker-assisted-login"></a>Вход с брокером

Входы с помощью брокера — это взаимодействия, которые происходят в рамках приложения брокера и используют хранилища и системы безопасности брокера для обмена учетными данными между всеми приложениями на устройстве, которое использует платформу удостоверений. Подразумевается, что ваши приложения будут использовать брокер для входа пользователей в систему. В iOS и Android брокеры доступны в виде скачиваемых приложений. Эти приложения устанавливаются пользователями самостоятельно либо принудительно передаются на устройство компанией, которая управляет устройствами. Пример этого типа приложений — приложение Microsoft Authenticator в iOS. В Windows этот компонент предоставляется средством выбора учетной записи, встроенным в операционную систему (его техническое название — брокер веб-аутентификации).
Этот способ входа зависит от платформы. При неправильном управлении он может мешать работе пользователей. Возможно, вы знакомы с этим способом входа, если у вас установлено приложение Facebook и вы используете Facebook Connect для входа в другие приложения. Платформа удостоверений использует тот же шаблон.

В Android для удобства пользователя средство выбора учетной записи отображается поверх приложения.

#### <a name="how-the-broker-gets-invoked"></a>Способы вызова брокера

Если на устройство установлен совместимый брокер, например, приложение Microsoft Authenticator, пакеты SDK удостоверений автоматически будут вызывать брокера, когда пользователь укажет, что хочет войти с помощью любой учетной записи платформы удостоверений.

#### <a name="how-microsoft-ensures-the-application-is-valid"></a>Как корпорация Майкрософт проверяет допустимость приложения

Необходимо убедиться, что удостоверение приложения, вызывающего брокер, имеет решающее значение для безопасности, обеспечиваемой в компонентах входа с помощью брокера. iOS и Android не предоставляют уникальные идентификаторы, действующие только для конкретного приложения, поэтому любое вредоносное ПО может имитировать идентификатор уполномоченного приложения и получать предназначенные для него маркеры. Чтобы убедиться, что во время выполнения корпорация Майкрософт всегда взаимодействует с надежным приложением, разработчику предлагается при регистрации приложений в корпорации Майкрософт предоставлять собственный универсальный код ресурса (URI) для перенаправления. **Ниже подробно описано, как разработчикам следует создавать этот универсальный код ресурса (URI) для перенаправления.** Этот пользовательский URI для перенаправления содержит отпечаток сертификата приложения и служит уникальным идентификатором приложения в магазине Google Play. Когда приложение вызывает брокер, тот запрашивает у операционной системы Android отпечаток сертификата, с которым был вызван этот брокер. Затем брокер предоставляет этот отпечаток сертификата в корпорацию Майкрософт в рамках обращения к системе идентификаций. Если отпечаток сертификата, указанный приложением, не соответствует тому отпечатку сертификата, который разработчик предоставил нам во время регистрации, доступ к запрошенным приложением маркерам ресурса блокируется. Такая проверка гарантирует, что только зарегистрированные разработчиком приложения получат маркеры.

Единый вход с использованием брокеров отличается следующими преимуществами:

* пользователь выполняет единый вход во всех приложениях независимо от поставщика;
* в приложении можно использовать расширенные бизнес-функции и компоненты, включая условный доступ и поддержку сценариев Intune.
* приложение может поддерживать аутентификацию бизнес-пользователей на основе сертификата;
* более безопасная процедура входа — удостоверение приложения и пользователь проверяются приложением брокера с использованием шифрования и дополнительных алгоритмов безопасности.

Ниже показано, как с помощью пакетов SDK можно включить единый вход, используя приложение брокера.

```
+------------+ +------------+   +-------------+
|            | |            |   |             |
|   App 1    | |   App 2    |   |   Someone   |
|            | |            |   |    else's   |
|            | |            |   |     App     |
+------------+ +------------+   +-------------+
|  ADAL SDK  | |  ADAL SDK  |   |  ADAL SDK   |
+-----+------+-+-----+------+-  +-------+-----+
      |              |                  |
      |       +------v------+           |
      |       |             |           |
      |       | Microsoft   |           |
      +-------> Broker      |^----------+
              | Application
              |             |
              +-------------+
              |             |
              |   Broker    |
              |   Storage   |
              |             |
              +-------------+

```

### <a name="turning-on-sso-for-broker-assisted-sso"></a>Включение единого входа с брокером

Возможность приложения использовать любой брокер, который установлен на устройстве, по умолчанию отключена. Чтобы пользоваться приложением с брокером, необходимо выполнить дополнительную настройку и добавить код в приложение.

Шаги для выполнения:

1. Включите режим брокера в вызов MS SDK кода приложения
2. Укажите новый код URI перенаправления для самого приложения и его регистрации.
3. Настройте требуемые разрешения в манифесте Android.

#### <a name="step-1-enable-broker-mode-in-your-application"></a>Шаг 1. Включение режима брокера в приложении

Возможность использовать в приложении брокер включается во время создания параметров или при первоначальной настройке экземпляра проверки подлинности. Чтобы сделать это в приложении:

```
AuthenticationSettings.Instance.setUseBroker(true);
```

#### <a name="step-2-establish-a-new-redirect-uri-with-your-url-scheme"></a>Шаг 2. Настройка нового кода URI перенаправления в схеме URL-адреса

Чтобы убедиться, что правильное приложение получает возвращенные маркеры учетных данных, необходимо убедиться в обратном вызове приложения способом, который операционная система Android может проверить. Операционная система Android использует хэш сертификата в магазине Google Play. Этот хэш сертификата не может быть подделан мошенническим приложением. Вместе с кодом URI приложения брокера корпорация Майкрософт следит за тем, чтобы маркеры возвращались в нужное приложение. Для регистрации в приложении требуется уникальный код URI перенаправления.

Формат кода URI перенаправления должен быть таким:

`msauth://packagename/Base64UrlencodedSignature`

Например, *msauth://com.example.userapp/IcB5PxIyvbLkbFVtBI%2FitkW%2Fejk%3D*

Вы можете указать этот код URI перенаправления при регистрации приложения на [портале Azure](https://portal.azure.com/). Дополнительные сведения о регистрации приложения Azure AD см. в статье, посвященной [интеграции с Azure Active Directory](../develop/active-directory-how-to-integrate.md?toc=/azure/active-directory/azuread-dev/toc.json&bc=/azure/active-directory/azuread-dev/breadcrumb/toc.json).

#### <a name="step-3-set-up-the-correct-permissions-in-your-application"></a>Шаг 3. Настройка требуемых разрешений в приложении

Приложение брокера в Android использует функцию диспетчера учетных записей ОС Android для управления учетными данными в разных приложениях. Чтобы использовать брокер в приложении Android, ваш манифест приложения должен содержать разрешения на использование учетных записей AccountManager. Дополнительные сведения об этих разрешениях см. в [документации Google по использованию диспетчера учетных записей](https://developer.android.com/reference/android/accounts/AccountManager.html).

Речь идет о следующих разрешениях:

```
GET_ACCOUNTS
USE_CREDENTIALS
MANAGE_ACCOUNTS
```

### <a name="youve-configured-sso"></a>Вы настроили единый вход!

Теперь пакет SDK для удостоверений будет автоматически предоставлять учетные данные в приложения и вызывать брокер, если он установлен на устройстве.

## <a name="next-steps"></a>Дальнейшие действия

* Дополнительные сведения см. в статье [Протокол единого входа SAML](../develop/single-sign-on-saml-protocol.md?toc=/azure/active-directory/azuread-dev/toc.json&bc=/azure/active-directory/azuread-dev/breadcrumb/toc.json).
