---
title: Собственные приложения в Azure Active Directory
description: Узнайте о собственных приложениях веб-API и потоке использования протокола, регистрации и сроке действия маркера для приложений такого типа.
services: active-directory
author: rwike77
manager: CelesteDG
ms.service: active-directory
ms.subservice: azuread-dev
ms.workload: identity
ms.topic: conceptual
ms.date: 09/24/2018
ms.author: ryanwi
ms.reviewer: saeeda, jmprieur
ms.custom: aaddev
ROBOTS: NOINDEX
ms.openlocfilehash: 9ecf711f5442b6f21de53d2735ad1c94d7cb6223
ms.sourcegitcommit: 867cb1b7a1f3a1f0b427282c648d411d0ca4f81f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "80154803"
---
# <a name="native-apps"></a>Собственные приложения

[!INCLUDE [active-directory-azuread-dev](../../../includes/active-directory-azuread-dev.md)]

Собственное приложение вызывает веб-API от имени пользователя. Этот сценарий построен на основе типа предоставления кода авторизации OAuth 2.0 с общедоступным клиентом, как описано в разделе 4.1 в документе [Спецификация OAuth 2.0](https://tools.ietf.org/html/rfc6749). Нативное приложение получает маркер доступа для пользователя с помощью протокола OAuth 2.0. Затем этот маркер передается в запросе к веб-интерфейсу API, который авторизует пользователя и возвращает нужный ресурс.

## <a name="diagram"></a>Схема

![Схема "из нативного приложения в веб-интерфейс API"](./media/authentication-scenarios/native-app-to-web-api.png)

## <a name="protocol-flow"></a>Поток использования протокола

В случае использования библиотек проверки подлинности AD они обрабатывают большинство описанных ниже операций протокола, например всплывающее окно браузера, кэширование маркера и обработка маркеров обновления.

1. С помощью всплывающего окна браузера нативное приложение отправляет запрос в конечную точку авторизации в Azure AD. Данный запрос содержит идентификатор приложения и URI перенаправления собственного приложения, как показано на портале Azure, а также URI идентификатора приложения для веб-API. Если пользователь еще не вошел в систему, ему будет предложено войти снова.
1. Azure AD выполняет проверку подлинности пользователя. Если это приложение с несколькими клиентами, и для использования приложения требуется согласие, пользователь должен принять согласие, если он еще не сделал этого. После предоставления согласия и после успешной проверки подлинности Azure AD выдает ответ кода авторизации обратно в URI перенаправления клиентского приложения.
1. Когда Azure AD отправляет обратно ответ с кодом авторизации на URI перенаправления, клиентское приложение прекращает взаимодействие с браузером и извлекает код авторизации из ответа. Используя этот код авторизации, клиентское приложение отправляет запрос в конечную точку маркера Azure AD, включающую код авторизации, сведения о клиентском приложении (идентификатор приложения и URI перенаправления) и требуемый ресурс (URI идентификатора приложения для веб-API).
1. Azure AD проверяет код авторизации, сведения о клиентских приложениях и веб-интерфейс API. После успешной проверки Azure AD возвращает два маркера: маркер доступа JWT и маркер обновления JWT. Кроме того, Azure AD возвращает основные сведения о пользователе, например его отображаемое имя и идентификатор клиента.
1. По протоколу HTTPS клиентское приложение использует возвращенный маркер доступа JWT для добавления строки JWT с обозначением носителя в заголовке авторизации запроса к веб-API. Затем веб-интерфейс API проверяет этот маркер JWT, и, если проверка будет выполнена успешно, возвращает требуемый ресурс.
1. По истечении срока действия маркера доступа клиентское приложение получит сообщение об ошибке с информацией о том, что пользователь должен снова пройти проверку подлинности. Если приложение имеет действительный маркер обновления, он может использоваться для получения нового маркера доступа (при этом пользователю не будет предлагаться снова выполнить вход). По истечении срока действия маркера обновления приложение должно выполнить еще раз интерактивную проверку подлинности пользователя.

> [!NOTE]
> Маркер обновления, выданный системой Azure AD, может применяться для доступа к нескольким ресурсам. Например, если у вас есть клиентское приложение, которое имеет разрешение на вызов двух веб-интерфейсов API, маркер обновления может также использоваться для получения маркера доступа к другому веб-интерфейсу API.

## <a name="code-samples"></a>Примеры кода

Просмотрите примеры кода для сценариев "из нативного приложения в веб-интерфейс API". Регулярно возвращайтесь к этому разделу — мы часто добавляем новые примеры. [Собственного приложения в веб-API](sample-v1-code.md#desktop-and-mobile-public-client-applications-calling-microsoft-graph-or-a-web-api).

## <a name="app-registration"></a>Регистрация приложений

Чтобы зарегистрировать приложение в конечной точке Azure AD версии 1.0, см. статью [Регистрация приложения](../develop/quickstart-register-app.md?toc=/azure/active-directory/azuread-dev/toc.json&bc=/azure/active-directory/azuread-dev/breadcrumb/toc.json).

* Однотенантное. Собственное приложение и веб-интерфейс API должны быть зарегистрированы в одном и том же каталоге в Azure AD. Веб-API можно настроить для предоставления набора разрешений, которые используются для ограничения доступа собственного приложения к его ресурсам. Затем клиентское приложение выбирает необходимые разрешения из раскрывающегося меню "разрешения для других приложений" в портал Azure.
* Несколько клиентов — первое приложение, которое всегда зарегистрировано в каталоге разработчика или издателя. Во-вторых, нативное приложение настраивается, чтобы пользователь мог указать разрешения, необходимые для его функционирования. Список необходимых разрешений отображается в диалоговом окне, и когда пользователь или администратор в каталоге назначения предоставляет эти разрешения, это делает приложение доступным для его организации. Некоторым приложениям требуются только разрешения на уровне пользователя, предоставить которые может любой пользователь в организации. Другим приложениям требуются разрешения на уровне администратора, предоставить которые не может обычный пользователь в организации. Предоставить такие разрешения может только администратор каталога. Когда пользователь или администратор предоставляет разрешения, в его каталоге регистрируется только веб-интерфейс API. 

## <a name="token-expiration"></a>Срок действия маркера

Если нативное приложение использует свой код авторизации для получения маркера доступа JWT, оно также получает маркер обновления JWT. По истечении срока действия маркера доступа маркер обновления может быть использован для повторной проверки подлинности пользователя без необходимости повторного входа. Затем этот маркер обновления используется для проверки подлинности пользователя, в результате чего появляется новый маркер доступа и маркер обновления.

## <a name="next-steps"></a>Дальнейшие действия

- Дополнительные сведения см. в статье [о других типах приложений и сценариях](app-types.md)
- Сведения об [основах проверки подлинности](v1-authentication-scenarios.md) Azure AD
