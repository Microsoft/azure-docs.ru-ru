---
title: Приложения для взаимодействия между службами в Azure Active Directory
description: Узнайте о приложениях веб-API и основных понятиях о потоке использования протокола, а также регистрации и сроке действия маркера для приложений такого типа.
services: active-directory
author: rwike77
manager: CelesteDG
ms.service: active-directory
ms.subservice: azuread-dev
ms.workload: identity
ms.topic: conceptual
ms.date: 11/20/2019
ms.author: ryanwi
ms.reviewer: saeeda, jmprieur
ms.custom: aaddev
ROBOTS: NOINDEX
ms.openlocfilehash: 179034533d90dbbb6ca362fc6f72996f32873729
ms.sourcegitcommit: 867cb1b7a1f3a1f0b427282c648d411d0ca4f81f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "80154769"
---
# <a name="service-to-service-apps"></a>Приложения для взаимодействия между службами

[!INCLUDE [active-directory-azuread-dev](../../../includes/active-directory-azuread-dev.md)]

Приложения для взаимодействия между службами могут быть управляющими программами или серверными приложениями, которым требуется получить ресурсы из веб-интерфейса API. Ниже представлены примеры таких приложений.

- Управляющая программа, которому нужно вызывать веб-API, на основе типа предоставления разрешений учетных данных клиента OAuth 2.0.

    В этом сценарии важно понимать некоторые моменты. Во-первых, пользователь не может взаимодействовать с управляющей программой, которой требуется собственное удостоверение приложения. Примером управляющей программы является пакетное задание или служба операционной системы, которая выполняется в фоновом режиме. Приложение данного типа запрашивает маркер доступа с помощью своего удостоверения и предоставляет Azure AD свои идентификатор приложения, учетные данные (пароль или сертификат), а также универсальный код ресурса (URI) идентификатора приложения. После успешной проверки подлинности управляющая программа получает маркер доступа из Azure AD, который затем используется для вызова веб-интерфейса API.

- Серверное приложение (например, веб-API), которому нужно вызывать веб-API, на основе проекта спецификации On-Behalf-Of в OAuth 2.0.

    Предположим, что в этом сценарии пользователь прошел аутентификацию для нативного приложения, и этому приложению требуется вызвать веб-интерфейс API. Azure AD выдает маркер доступа JWT для вызова веб-интерфейса API. Если веб-API должен вызывать другой нисходящий веб-API, он может использовать поток "от имени" для делегирования удостоверения пользователя и проверки подлинности в веб-API второго уровня.

## <a name="diagram"></a>Схема

![Схема "из управляющей программы или серверного приложения в веб-интерфейс API"](./media/authentication-scenarios/daemon-server-app-to-web-api.png)

## <a name="protocol-flow"></a>Поток использования протокола

### <a name="application-identity-with-oauth-20-client-credentials-grant"></a>Удостоверение приложения с предоставлением учетных данных клиента OAuth 2.0

1. Сначала серверное приложение должно пройти проверку подлинности в Azure AD от своего имени, без участия пользователя (то есть без интерактивного диалогового окна входа). Он выполняет запрос к конечной точке маркера Azure AD, предоставляя учетные данные, идентификатор приложения и URI идентификатора приложения.
1. Azure AD проверяет подлинность приложения и возвращает маркер доступа JWT, который используется для вызова веб-интерфейса API.
1. По протоколу HTTPS веб-приложение использует возвращенный маркер доступа JWT для добавления строки JWT с обозначением носителя в заголовке авторизации запроса к веб-API. Затем веб-интерфейс API проверяет этот маркер JWT, и, если проверка будет выполнена успешно, возвращает требуемый ресурс.

### <a name="delegated-user-identity-with-oauth-20-on-behalf-of-draft-specification"></a>Делегированное удостоверение пользователя с проектом спецификации OAuth 2.0 On-Behalf-Of

Поток, описанный ниже, предполагает, что пользователь прошел проверку подлинности в другом приложении (например, в нативном приложении), и его учетные данные были использован для получения маркера доступа к веб-интерфейсу API первого уровня.

1. Нативное приложение отправляет маркер доступа в веб-интерфейс API первого уровня.
1. Веб-API первого уровня отправляет запрос в конечную точку маркера Azure AD, предоставляя идентификатор приложения и учетные данные, а также маркер доступа пользователя. Кроме того, запрос отправляется с параметром on_behalf_of, указывающим, что веб-интерфейс API запрашивает новые маркеры для вызова нисходящего (подчиненного) веб-интерфейса API от имени исходного пользователя.
1. Azure AD проверяет, что веб-интерфейс API первого уровня имеет разрешения на доступ к веб-интерфейсу API второго уровня, и проверяет запрос, возвращая маркер доступа JWT и маркер обновления JWT в веб-интерфейс API первого уровня.
1. Затем по протоколу HTTPS веб-интерфейс API первого уровня вызывает веб-интерфейс API второго уровня, добавляя строку маркера в заголовок авторизации в запросе. Веб-интерфейс API первого уровня может продолжать вызывать веб-интерфейс API второго уровня до тех пор, пока маркеры доступа и обновления остаются действительными.

## <a name="code-samples"></a>Примеры кода

См. примеры кода для управляющей программы или серверного приложения для сценариев веб-API: [Серверная или управляющая программа для веб-API](sample-v1-code.md#daemon-applications-accessing-web-apis-with-the-applications-identity) .

## <a name="app-registration"></a>Регистрация приложений

* Однотенантный: и для удостоверения приложения, и для делегированного удостоверения пользователя управляющая программа или серверное приложение должны быть зарегистрированы в одном и том же каталоге Azure AD. Веб-API можно настроить для предоставления набора разрешений, которые используются для ограничения доступа управляющей программы или сервера к его ресурсам. Если используется делегированный тип удостоверения пользователя, серверное приложение должно выбрать нужные разрешения. На странице **разрешения API** для регистрации приложения после выбора **Добавить разрешение** и выбрать семейство API, выберите **делегированные разрешения**, а затем выберите нужные разрешения. Этот шаг не является обязательным, если используется тип удостоверения приложения.
* Мультитенантный: сначала настраивается управляющая программа или серверное приложение, чтобы пользователь мог указать требуемые для работы разрешения. Список необходимых разрешений отображается в диалоговом окне, и когда пользователь или администратор в каталоге назначения предоставляет эти разрешения, это делает приложение доступным для его организации. Некоторым приложениям требуются только разрешения на уровне пользователя, предоставить которые может любой пользователь в организации. Другим приложениям требуются разрешения на уровне администратора, предоставить которые не может обычный пользователь в организации. Предоставить такие разрешения может только администратор каталога. Если пользователь или администратор предоставляет требуемые разрешения, в его каталоге регистрируются оба веб-API.

## <a name="token-expiration"></a>Срок действия маркера

Если первое приложение использует свой код авторизации для получения маркера доступа JWT, оно также получает маркер обновления JWT. По истечении срока действия маркера доступа маркер обновления может использоваться для повторной проверки подлинности пользователя без запроса учетных данных. Затем этот маркер обновления используется для проверки подлинности пользователя, в результате чего появляется новый маркер доступа и маркер обновления.

## <a name="next-steps"></a>Дальнейшие действия

- Дополнительные сведения см. в статье [о других типах приложений и сценариях](app-types.md)
- Сведения об [основах проверки подлинности](v1-authentication-scenarios.md) Azure AD
