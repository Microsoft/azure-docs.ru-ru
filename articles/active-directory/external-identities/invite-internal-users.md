---
title: Приглашение внутренних пользователей в службу совместной работы B2B — Azure AD
description: Если у вас есть внутренние учетные записи для партнеров, дистрибуторов, поставщиков, поставщиков и других гостей, вы можете перейти на службу совместной работы Azure AD B2B, приглашая их к входу с использованием собственных внешних учетных данных или имени входа. Используйте PowerShell или API приглашения Microsoft Graph.
services: active-directory
ms.service: active-directory
ms.subservice: B2B
ms.topic: how-to
ms.date: 04/12/2020
ms.author: mimart
author: msmimart
manager: celestedg
ms.reviewer: mal
ms.collection: M365-identity-device-management
ms.openlocfilehash: 8acc547552cecaebb60888bb7b9777f6279b9b7c
ms.sourcegitcommit: 42a4d0e8fa84609bec0f6c241abe1c20036b9575
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "98015765"
---
# <a name="invite-internal-users-to-b2b-collaboration"></a>Пригласите внутренних пользователей в службу совместной работы B2B

> [!NOTE]
> Приглашение внутренних пользователей использовать службу совместной работы B2B — это общедоступная Предварительная версия функции Azure Active Directory. См. подробные сведения о [дополнительных условиях использования предварительных выпусков Microsoft Azure](https://azure.microsoft.com/support/legal/preview-supplemental-terms/).

Прежде чем обеспечить доступность службы совместной работы Azure AD B2B, организации могут совместно работать с распространителями, поставщиками, поставщиками и другими гостевыми пользователями, настроив для них внутренние учетные данные. Если у вас есть внутренние гостевые пользователи, вы можете пригласить их на использование службы совместной работы B2B, чтобы вы могли воспользоваться преимуществами Azure AD B2B. Гостевые пользователи B2B смогут использовать свои удостоверения и учетные данные для входа, и вам не потребуется сохранять пароли или управлять жизненным циклом учетных записей.

Отправка приглашения в существующую внутреннюю учетную запись позволяет хранить идентификатор объекта пользователя, UPN, членство в группах и назначения приложений. Вам не нужно вручную удалять и повторно приглашать пользователей или переназначить ресурсы. Чтобы пригласить пользователя, вы будете использовать API приглашения для передачи внутреннего объекта пользователя и адреса электронной почты гостевого пользователя вместе с приглашением. Когда пользователь принимает приглашение, служба B2B изменяет существующего внутреннего объекта пользователя на пользователя B2B. После этого пользователь должен войти в облачные службы ресурсов, используя свои учетные данные B2B. Они по-прежнему могут использовать свои внутренние учетные данные для доступа к локальным ресурсам, но вы можете предотвратить это путем сброса или изменения пароля во внутренней учетной записи.

> [!NOTE]
> Приглашение является односторонним. Вы можете пригласить внутренних пользователей использовать службу совместной работы B2B, но вы не сможете удалить учетные данные B2B после их добавления. Чтобы изменить пользователя на "только для внутреннего пользователя", необходимо удалить объект пользователя и создать новый.

В общедоступной предварительной версии метод, описанный в этой статье для приглашения внутренних пользователей в службу совместной работы B2B, не может использоваться в следующих экземплярах:

- У внутреннего пользователя есть назначенная лицензия Exchange.
- Пользователь входит в домен, настроенный на прямую федерацию в вашем каталоге.
- Внутренний пользователь является учетной записью только для облака, а ее Главная учетная запись не находится в Azure AD.

В этих случаях, если внутренний пользователь должен быть изменен для пользователя B2B, следует удалить внутреннюю учетную запись и отправить пользователю приглашение для совместной работы B2B.

**Локальные синхронизированные пользователи**. для учетных записей пользователей, синхронизированных между локальной средой и облаком, локальный каталог остается источником полномочий после того, как они приглашались использовать службу совместной работы B2B. Любые изменения, вносимые в локальную учетную запись, будут синхронизироваться с облачной учетной записью, включая отключение или удаление учетной записи. Таким образом, невозможно предотвратить вход пользователя в локальную учетную запись, сохранив свою облачную учетную запись, просто удалив локальную учетную запись. Вместо этого можно задать для локального пароля учетной записи случайный идентификатор GUID или другое неизвестное значение.

## <a name="how-to-invite-internal-users-to-b2b-collaboration"></a>Как пригласить внутренних пользователей в службу совместной работы B2B

Вы можете использовать PowerShell или API приглашения для отправки приглашения B2B внутреннему пользователю. Убедитесь, что адрес электронной почты, который вы хотите использовать для приглашения, задан как внешний адрес электронной почты во внутреннем объекте пользователя.

- Необходимо использовать адрес электронной почты в свойстве User. mail приглашения.
- Домен в свойстве mail пользователя должен соответствовать учетной записи, используемой для входа. В противном случае некоторые службы, например команды, не смогут пройти проверку подлинности пользователя.

По умолчанию приглашение отправляет пользователю сообщение электронной почты с просьбой о том, что оно было приглашено, но вы можете отключить это сообщение и отправить его.

> [!NOTE]
> Для отправки собственного сообщения электронной почты или другого обмена данными можно использовать New-AzureADMSInvitation с параметром-Сендинвитатионмессаже: $false, чтобы пригласить пользователей в автоматическом режиме, а затем отправить собственное сообщение электронной почты преобразованному пользователю. См. раздел [API службы совместной работы Azure AD B2B и настройка](customize-invitation-api.md).

## <a name="use-powershell-to-send-a-b2b-invitation"></a>Отправка приглашения B2B с помощью PowerShell

Чтобы пригласить пользователя в службу совместной работы B2B, используйте следующую команду:

```powershell
Uninstall-Module AzureADPreview
Install-Module AzureADPreview
$ADGraphUser = Get-AzureADUser -objectID "UPN of Internal User"
$msGraphUser = New-Object Microsoft.Open.MSGraph.Model.User -ArgumentList $ADGraphUser.ObjectId
New-AzureADMSInvitation -InvitedUserEmailAddress <<external email>> -SendInvitationMessage $True -InviteRedirectUrl "http://myapps.microsoft.com" -InvitedUser $msGraphUser
```

## <a name="use-the-invitation-api-to-send-a-b2b-invitation"></a>Отправка приглашения B2B с помощью API приглашения

В примере ниже показано, как вызвать API приглашения, чтобы пригласить внутреннего пользователя в качестве пользователя B2B.

```json
POST https://graph.microsoft.com/v1.0/invitations
Authorization: Bearer eyJ0eX...
ContentType: application/json
{
    "invitedUserEmailAddress": "<<external email>>",
    "sendInvitationMessage": true,
    "invitedUserMessageInfo": {
        "messageLanguage": "en-US",
        "ccRecipients": [
            {
                "emailAddress": {
                    "name": null,
                    "address": "<<optional additional notification email>>"
                }
            }
        ],
        "customizedMessageBody": "<<custom message>>"
    },
    "inviteRedirectUrl": "https://myapps.microsoft.com?tenantId=",
    "invitedUser": {
        "id": "<<ID for the user you want to convert>>"
    }
}
```

Ответ на API — это тот же ответ, который вы получаете при приглашении нового гостевого пользователя в каталог.

## <a name="next-steps"></a>Дальнейшие действия

- [Активация приглашения службы совместной работы B2B](redemption-experience.md)
