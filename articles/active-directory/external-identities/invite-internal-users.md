---
title: Приглашение внутренних пользователей в службу совместной работы B2B — Azure AD
description: Если у вас есть внутренние учетные записи для партнеров, дистрибуторов, поставщиков, поставщиков и других гостей, вы можете перейти на службу совместной работы Azure AD B2B, приглашая их к входу с использованием собственных внешних учетных данных или имени входа. Используйте PowerShell или API приглашения Microsoft Graph.
services: active-directory
ms.service: active-directory
ms.subservice: B2B
ms.topic: how-to
ms.date: 02/03/2021
ms.author: mimart
author: msmimart
manager: celestedg
ms.collection: M365-identity-device-management
ms.openlocfilehash: 802307a21873d15242c2e387ec0defe35f50bb20
ms.sourcegitcommit: 867cb1b7a1f3a1f0b427282c648d411d0ca4f81f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "99576436"
---
# <a name="invite-internal-users-to-b2b-collaboration"></a>Пригласите внутренних пользователей в службу совместной работы B2B

Прежде чем обеспечить доступность службы совместной работы Azure AD B2B, организации могут совместно работать с распространителями, поставщиками, поставщиками и другими гостевыми пользователями, настроив для них внутренние учетные данные. Если у вас есть внутренние гостевые пользователи, вы можете пригласить их на использование службы совместной работы B2B. Эти гостевые пользователи B2B смогут использовать собственные удостоверения и учетные данные для входа, а также не нужно сохранять пароли или управлять жизненным циклом учетных записей.

Отправка приглашения в существующую внутреннюю учетную запись позволяет хранить идентификатор объекта пользователя, UPN, членство в группах и назначения приложений. Вам не нужно вручную удалять и повторно приглашать пользователей или переназначить ресурсы. Чтобы пригласить пользователя, используйте API приглашения для передачи внутреннего объекта пользователя и адреса электронной почты гостевого пользователя вместе с приглашением. Когда пользователь принимает приглашение, служба B2B изменяет существующего внутреннего объекта пользователя на пользователя B2B. После этого пользователь должен войти в облачные службы ресурсов, используя свои учетные данные B2B.

## <a name="things-to-consider"></a>Полезная информация

- **Доступ к локальным ресурсам**. После того как пользователь приглашен в службу совместной работы B2B, он по-прежнему может использовать свои внутренние учетные данные для доступа к локальным ресурсам. Это можно предотвратить путем сброса или изменения пароля во внутренней учетной записи. Исключением является [одноразовая проверка подлинности по электронной почте](one-time-passcode.md). Если метод проверки подлинности пользователя изменен на одноразовый секретный код, он больше не сможет использовать свои внутренние учетные данные.

- **Выставление счетов**. Эта функция не изменяет usertype для пользователя, поэтому она не переключается автоматически на модель выставления счетов пользователя по [ценам на месячный активный пользователь (MAU)](external-identities-pricing.md). Чтобы активировать цены MAU для пользователя, измените UserType для пользователя на `guest` . Также обратите внимание, что клиент Azure AD должен быть [связан с подпиской Azure](external-identities-pricing.md#link-your-azure-ad-tenant-to-a-subscription) для активации выставления счетов MAU.

- **Приглашение является односторонним**: вы можете пригласить внутренних пользователей использовать службу совместной работы B2B, но вы не сможете удалить учетные данные B2B после их добавления. Чтобы изменить пользователя на "только для внутреннего пользователя", необходимо удалить объект пользователя и создать новый.

- **Команды**. когда пользователь обращается к командам, использующим свои внешние учетные данные, их клиенты изначально не будут доступны в средстве выбора клиентов группы. Пользователь может получить доступ к командам, используя URL-адрес, который содержит контекст клиента, например: `https://team.microsoft.com/?tenantId=<TenantId>` . После этого клиент станет доступен в средстве выбора клиента группы.

- **Локальные синхронизированные пользователи**. для учетных записей пользователей, синхронизированных между локальной средой и облаком, локальный каталог остается источником полномочий после того, как они приглашались использовать службу совместной работы B2B. Любые изменения, вносимые в локальную учетную запись, будут синхронизироваться с облачной учетной записью, включая отключение или удаление учетной записи. Таким образом, невозможно предотвратить вход пользователя в локальную учетную запись, сохранив свою облачную учетную запись, просто удалив локальную учетную запись. Вместо этого можно задать для локального пароля учетной записи случайный идентификатор GUID или другое неизвестное значение.

## <a name="how-to-invite-internal-users-to-b2b-collaboration"></a>Как пригласить внутренних пользователей в службу совместной работы B2B

Вы можете использовать PowerShell или API приглашения для отправки приглашения B2B внутреннему пользователю. Убедитесь, что адрес электронной почты, который вы хотите использовать для приглашения, задан как внешний адрес электронной почты во внутреннем объекте пользователя.

- Необходимо использовать адрес электронной почты в свойстве User. mail приглашения.
- Домен в свойстве mail пользователя должен соответствовать учетной записи, используемой для входа. В противном случае некоторые службы, например команды, не смогут пройти проверку подлинности пользователя.

По умолчанию приглашение отправляет пользователю сообщение электронной почты с просьбой о том, что оно было приглашено, но вы можете отключить это сообщение и отправить его.

> [!NOTE]
> Для отправки собственного сообщения электронной почты или другого обмена данными можно использовать `New-AzureADMSInvitation` с, `-SendInvitationMessage:$false` чтобы пригласить пользователей в автоматическом режиме, а затем отправить собственное сообщение электронной почты преобразованному пользователю. См. раздел [API службы совместной работы Azure AD B2B и настройка](customize-invitation-api.md).

## <a name="use-powershell-to-send-a-b2b-invitation"></a>Отправка приглашения B2B с помощью PowerShell

Вам потребуется модуль Azure AD PowerShell 2.0.2.130 или более поздней версии. Используйте следующую команду, чтобы выполнить обновление до последней версии модуля PowerShell AzureAD и пригласить внутреннего пользователя в службу совместной работы B2B:

```powershell
Uninstall-Module AzureAD
Install-Module AzureAD
$ADGraphUser = Get-AzureADUser -objectID "UPN of Internal User"
$msGraphUser = New-Object Microsoft.Open.MSGraph.Model.User -ArgumentList $ADGraphUser.ObjectId
New-AzureADMSInvitation -InvitedUserEmailAddress <<external email>> -SendInvitationMessage $True -InviteRedirectUrl "http://myapps.microsoft.com" -InvitedUser $msGraphUser
```

## <a name="use-the-invitation-api-to-send-a-b2b-invitation"></a>Отправка приглашения B2B с помощью API приглашения

В примере ниже показано, как вызвать API приглашения, чтобы пригласить внутреннего пользователя в качестве пользователя B2B.

```json
POST https://graph.microsoft.com/v1.0/invitations
Authorization: Bearer eyJ0eX...
ContentType: application/json
{
    "invitedUserEmailAddress": "<<external email>>",
    "sendInvitationMessage": true,
    "invitedUserMessageInfo": {
        "messageLanguage": "en-US",
        "ccRecipients": [
            {
                "emailAddress": {
                    "name": null,
                    "address": "<<optional additional notification email>>"
                }
            }
        ],
        "customizedMessageBody": "<<custom message>>"
    },
    "inviteRedirectUrl": "https://myapps.microsoft.com?tenantId=",
    "invitedUser": {
        "id": "<<ID for the user you want to convert>>"
    }
}
```

Ответ на API — это тот же ответ, который вы получаете при приглашении нового гостевого пользователя в каталог.
## <a name="next-steps"></a>Дальнейшие действия

- [Активация приглашения службы совместной работы B2B](redemption-experience.md)
