---
title: Проверка подлинности на основе одноразового секретного кода для гостевых пользователей B2B — Azure Active Directory
description: Использование одноразового секретного кода, отправляемого по почте, для проверки подлинности гостевых пользователей B2B без использования учетной записи Майкрософт.
services: active-directory
ms.service: active-directory
ms.subservice: B2B
ms.topic: how-to
ms.date: 12/18/2020
ms.author: mimart
author: msmimart
manager: CelesteDG
ms.reviewer: mal
ms.custom: it-pro, seo-update-azuread-jan, seoapril2019
ms.collection: M365-identity-device-management
ms.openlocfilehash: b1aebfaa176992b7e20824518bc214a6688ae493
ms.sourcegitcommit: e7152996ee917505c7aba707d214b2b520348302
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/20/2020
ms.locfileid: "97703591"
---
# <a name="email-one-time-passcode-authentication"></a>Проверка подлинности по одноразовому секретному коде

В этой статье описывается, как включить одноразовую проверку подлинности по электронной почте для гостевых пользователей B2B. Функция одноразового секретного кода для электронной почты проверяет подлинность гостевых пользователей B2B, когда они не могут пройти проверку подлинности с помощью других средств, таких как Azure AD, учетная запись Майкрософт (MSA) или Google Federation. Благодаря проверке подлинности на основе одноразового секретного кода больше не нужно создавать учетную запись Майкрософт. Если гостевой пользователь активирует приглашение или обращается к общему ресурсу, он может запросить временный код, который будет отправлен на адрес электронной почты этого пользователя. Этот код нужно ввести, чтобы войти в систему.

![Обзорная схема секретного кода однократного выполнения](media/one-time-passcode/email-otp.png)

> [!IMPORTANT]
> **Начиная с 2021 марта** функция однократного секретного кода будет включена для всех существующих клиентов и включена по умолчанию для новых клиентов. Если вы не хотите разрешить этой функции Автоматический включение, можно отключить ее. См. раздел [Отключение однократного секретного кода электронной почты](#disable-email-one-time-passcode) ниже.

> [!NOTE]
> Если пользователь применяет для входа одноразовый секретный код, ему необходимо войти по ссылке, содержащей контекст клиента (например, `https://myapps.microsoft.com/?tenantid=<tenant id>` или `https://portal.azure.com/<tenant id>`, а в случае проверенного домена — `https://myapps.microsoft.com/<verified domain>.onmicrosoft.com`). Прямые ссылки на приложения и ресурсы также работают, если они содержат контекст клиента. В настоящее время пользователи не могут войти в систему, используя конечные точки, которые не имеют контекста клиента. Например, при использовании `https://myapps.microsoft.com` функции `https://portal.azure.com` будет возникать ошибка.

## <a name="user-experience-for-one-time-passcode-guest-users"></a>Применение одноразового секретного кода гостевыми пользователями

Если включена функция однократного секретного кода электронной почты, то вновь приглашенные пользователи [, которые отвечают определенным условиям](#when-does-a-guest-user-get-a-one-time-passcode) , будут использовать одноразовую проверку подлинности с использованием секретного кода. Гостевые пользователи, которые активировали приглашение до включения одноразового секретного кода, продолжают использовать тот же метод проверки подлинности.

При использовании проверки подлинности на основе одноразового секретного кода гостевой пользователь может активировать ваше приглашение, перейдя по прямой ссылке или используя письмо с приглашением. В обоих случаях в браузере отобразится сообщение о том, что секретный код будет отправлен на адрес электронной почты гостевого пользователя. Гостевому пользователю необходимо щелкнуть **Отправить код**:

   ![Снимок экрана с кнопкой "Отправить код"](media/one-time-passcode/otp-send-code.png)

Секретный код отправляется на адрес электронной почты пользователя. Пользователь получает секретный код в письме и вводит его в окне браузера:

   ![Снимок экрана со страницей для ввода кода](media/one-time-passcode/otp-enter-code.png)

После проверки подлинности гостевой пользователь может просмотреть общий ресурс или продолжить вход.

> [!NOTE]
> Одноразовый секретный код действителен в течение 30 минут. По истечении 30 минут этот одноразовый секретный код станет недействительным, и пользователю придется запросить новый. Сеансы пользователя завершаются через 24 часа. По прошествии этого времени для доступа к ресурсу гостевому пользователю необходимо получить новый секретный код. Срок действия сеанса позволяет повысить уровень безопасности, особенно если гостевой пользователь увольняется из компании или ему больше не нужен доступ к ресурсам.

## <a name="when-does-a-guest-user-get-a-one-time-passcode"></a>Когда гостевой пользователь получает одноразовый секретный код?

Когда гостевой пользователь активирует приглашение или использует ссылку на ресурс, к которому был предоставлен общий доступ, он получит одноразовый секретный код, если:

- у него нет учетной записи в Azure AD;
- у него нет учетной записи Майкрософт;
- клиент, отправивший приглашение, не настроил федерацию с Google для пользователей доменов @gmail.com и @googlemail.com.

Во время отправки приглашения нельзя определить, что приглашаемый пользователь будет применять проверку подлинности на основе одноразового секретного кода. Но если невозможно использовать другие методы проверки подлинности, когда гостевой пользователь входит в систему, в качестве резервного метода применяется проверка подлинности на основе одноразового секретного кода.

Вы можете увидеть, прошел ли гостевой пользователь проверку подлинности с помощью одноразовых секретных кодов, просмотрев свойство **Source** в сведениях о пользователе. В портал Azure перейдите к **Azure Active Directory**  >  **Пользователи**, а затем выберите пользователя, чтобы открыть страницу сведений.

![Снимок экрана со сведениями о пользователе, выполнившем вход с помощью одноразового секретного кода](media/one-time-passcode/guest-user-properties.png)

> [!NOTE]
> Если пользователь активирует одноразовый секретный код, а затем вводит данные MSA, учетной записи Azure AD или другой федеративной учетной записи, он по-прежнему считается пользователем с проверкой подлинности на основе одноразового секретного кода. Если необходимо обновить метод проверки подлинности пользователя, вы можете удалить учетную запись гостевого пользователя и пригласить его повторно.

### <a name="example"></a>Пример

Гостевой пользователь teri@gmail.com приглашен в компанию Fabrikam, которая не поддерживает настройку федерации Google. Тери не имеет учетная запись Майкрософт. Он получит одноразовый секретный код для проверки подлинности.

## <a name="disable-email-one-time-passcode"></a>Отключить одноразовый секретный код электронной почты

Начиная с 2021 марта функция однократного секретного кода будет включена для всех существующих клиентов и включена по умолчанию для новых клиентов. В этот момент корпорация Майкрософт больше не будет поддерживать погашение приглашений, создавая неуправляемые ("вирусные" или "JIT") учетные записи Azure AD и клиенты для сценариев совместной работы B2B. Мы создаем функцию одноразового секретного кода по электронной почте, так как она обеспечивает простой метод проверки подлинности для гостевых пользователей. Однако вы можете отключить эту функцию, если вы решили не использовать ее.

> [!NOTE]
>
> Если функция секретного кода одноразового пароля включена в клиенте и отключена, все гостевые пользователи, которые активировали одноразовый секретный код, не смогут войти в систему. Вы можете удалить гостевой пользователь и повторно пригласить его, чтобы снова выполнить вход с помощью другого метода проверки подлинности.

### <a name="to-disable-the-email-one-time-passcode-feature"></a>Отключение функции одноразового секретного кода для электронной почты

1. Войдите на [портал Azure](https://portal.azure.com/) с правами глобального администратора Azure AD.

2. В области навигации выберите **Azure Active Directory**.

3. Выберите **Внешние удостоверения** > **Параметры внешнего взаимодействия**.

4. В разделе одноразовый **секретный код по электронной почте для гостей** выберите **Отключить однократный секретный код для гостей**.

    ![Параметры секретного кода одноразовых сообщений электронной почты](media/one-time-passcode/otp-admin-settings.png)

   > [!NOTE]
   > Если вместо показанных выше параметров отображается следующий переключатель, это означает, что вы ранее включили, отключили или выбрали предварительную версию функции. Выберите **нет** , чтобы отключить эту функцию.
   >
   >![Включить одноразовый секретный код для электронной почты](media/delegate-invitations/enable-email-otp-opted-in.png)

5. Щелкните **Сохранить**.

## <a name="note-for-public-preview-customers"></a>Примечание для пользователей общедоступной предварительной версии

Если вы ранее включили в общедоступную предварительную версию одноразового секретного кода по электронной почте, 2021 Дата марта для автоматического включения функций не применяется, поэтому связанные бизнес-процессы не будут затронуты. Кроме того, в портал Azure в поле **секретный код одноразового пароля для гостей** вы не увидите возможность **автоматического включения одноразового секретного кода для гостей в 2021 марта**. Вместо этого вы увидите следующий переключатель **Да** или **нет** :

![Включить одноразовый секретный код для электронной почты](media/delegate-invitations/enable-email-otp-opted-in.png)

Однако если вы предпочитаете отказаться от этой функции и разрешить ее автоматическое включение в марте 2021, можно вернуться к параметрам по умолчанию, используя [тип ресурса конфигурации метода проверки подлинности электронной почты](https://aka.ms/exid-graphemailauth)API Microsoft Graph. После возврата к значениям по умолчанию будут доступны следующие параметры в разделе одноразовый **пароль для гостей по электронной почте**:

- **Автоматически включить одноразовый секретный код электронной почты для гостей в 2021 марта**. Параметры Если функция секретного кода одноразового пароля для вашего клиента еще не включена, она будет автоматически включена в марте 2021. Если вы хотите включить функцию в это время, никаких дополнительных действий не требуется. Если функция уже включена или отключена, этот параметр будет недоступен.

- **Включите одноразовый секретный код электронной почты для действующих гостей сейчас**. Включает функцию одноразового секретного кода по электронной почте для вашего клиента.

- **Отключить одноразовый секретный код электронной почты для гостей**. Отключает функцию одноразового секретного кода по электронной почте для клиента и предотвращает ее включение в марте 2021.
