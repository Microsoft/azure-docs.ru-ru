---
title: Проверка подлинности на основе одноразового секретного кода для гостевых пользователей B2B — Azure Active Directory
description: Использование одноразового секретного кода, отправляемого по почте, для проверки подлинности гостевых пользователей B2B без использования учетной записи Майкрософт.
services: active-directory
ms.service: active-directory
ms.subservice: B2B
ms.topic: how-to
ms.date: 03/02/2021
ms.author: mimart
author: msmimart
manager: CelesteDG
ms.reviewer: mal
ms.custom: it-pro, seo-update-azuread-jan, seoapril2019
ms.collection: M365-identity-device-management
ms.openlocfilehash: 7961997c6a6736c154b6217ee3f21682d0c4c3fc
ms.sourcegitcommit: c27a20b278f2ac758447418ea4c8c61e27927d6a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/03/2021
ms.locfileid: "101688473"
---
# <a name="email-one-time-passcode-authentication"></a>Проверка подлинности по одноразовому секретному коде

В этой статье описывается, как включить одноразовую проверку подлинности по электронной почте для гостевых пользователей B2B. Функция одноразового секретного кода для электронной почты проверяет подлинность гостевых пользователей B2B, когда они не могут пройти проверку подлинности с помощью других средств, таких как Azure AD, учетная запись Майкрософт (MSA) или Google Federation. Благодаря проверке подлинности на основе одноразового секретного кода больше не нужно создавать учетную запись Майкрософт. Если гостевой пользователь активирует приглашение или обращается к общему ресурсу, он может запросить временный код, который будет отправлен на адрес электронной почты этого пользователя. Этот код нужно ввести, чтобы войти в систему.

![Обзорная схема секретного кода однократного выполнения](media/one-time-passcode/email-otp.png)

> [!IMPORTANT]
> - **Начиная с 2021 октября** функция однократного секретного кода по электронной почте будет включена для всех существующих клиентов и включена по умолчанию для новых клиентов. Если вы не хотите разрешить этой функции Автоматический включение, можно отключить ее. См. раздел [Отключение однократного секретного кода электронной почты](#disable-email-one-time-passcode) ниже.
> - Параметры секретного кода одноразового пользователя были перемещены в портал Azure из **внешних параметров совместной работы** во **все поставщики удостоверений**.

> [!NOTE]
> Если пользователь применяет для входа одноразовый секретный код, ему необходимо войти по ссылке, содержащей контекст клиента (например, `https://myapps.microsoft.com/?tenantid=<tenant id>` или `https://portal.azure.com/<tenant id>`, а в случае проверенного домена — `https://myapps.microsoft.com/<verified domain>.onmicrosoft.com`). Прямые ссылки на приложения и ресурсы также работают, если они содержат контекст клиента. В настоящее время пользователи не могут войти в систему, используя конечные точки, которые не имеют контекста клиента. Например, при использовании `https://myapps.microsoft.com` функции `https://portal.azure.com` будет возникать ошибка.

## <a name="user-experience-for-one-time-passcode-guest-users"></a>Применение одноразового секретного кода гостевыми пользователями

Если включена функция однократного секретного кода электронной почты, то вновь приглашенные пользователи [, которые отвечают определенным условиям](#when-does-a-guest-user-get-a-one-time-passcode) , будут использовать одноразовую проверку подлинности с использованием секретного кода. Гостевые пользователи, которые активировали приглашение до включения одноразового секретного кода, продолжают использовать тот же метод проверки подлинности.

При использовании проверки подлинности на основе одноразового секретного кода гостевой пользователь может активировать ваше приглашение, перейдя по прямой ссылке или используя письмо с приглашением. В обоих случаях в браузере отобразится сообщение о том, что секретный код будет отправлен на адрес электронной почты гостевого пользователя. Гостевому пользователю необходимо щелкнуть **Отправить код**:

   ![Снимок экрана с кнопкой "Отправить код"](media/one-time-passcode/otp-send-code.png)

Секретный код отправляется на адрес электронной почты пользователя. Пользователь получает секретный код в письме и вводит его в окне браузера:

   ![Снимок экрана со страницей для ввода кода](media/one-time-passcode/otp-enter-code.png)

После проверки подлинности гостевой пользователь может просмотреть общий ресурс или продолжить вход.

> [!NOTE]
> Одноразовый секретный код действителен в течение 30 минут. По истечении 30 минут этот одноразовый секретный код станет недействительным, и пользователю придется запросить новый. Сеансы пользователя завершаются через 24 часа. По прошествии этого времени для доступа к ресурсу гостевому пользователю необходимо получить новый секретный код. Срок действия сеанса позволяет повысить уровень безопасности, особенно если гостевой пользователь увольняется из компании или ему больше не нужен доступ к ресурсам.

## <a name="when-does-a-guest-user-get-a-one-time-passcode"></a>Когда гостевой пользователь получает одноразовый секретный код?

Когда гостевой пользователь активирует приглашение или использует ссылку на ресурс, к которому был предоставлен общий доступ, он получит одноразовый секретный код, если:

- у него нет учетной записи в Azure AD;
- у него нет учетной записи Майкрософт;
- клиент, отправивший приглашение, не настроил федерацию с Google для пользователей доменов @gmail.com и @googlemail.com.

Во время отправки приглашения нельзя определить, что приглашаемый пользователь будет применять проверку подлинности на основе одноразового секретного кода. Но если невозможно использовать другие методы проверки подлинности, когда гостевой пользователь входит в систему, в качестве резервного метода применяется проверка подлинности на основе одноразового секретного кода.

Вы можете увидеть, прошел ли гостевой пользователь проверку подлинности с помощью одноразовых секретных кодов, просмотрев свойство **Source** в сведениях о пользователе. В портал Azure перейдите к **Azure Active Directory**  >  **Пользователи**, а затем выберите пользователя, чтобы открыть страницу сведений.

![Снимок экрана со сведениями о пользователе, выполнившем вход с помощью одноразового секретного кода](media/one-time-passcode/guest-user-properties.png)

> [!NOTE]
> Если пользователь активирует одноразовый секретный код, а затем вводит данные MSA, учетной записи Azure AD или другой федеративной учетной записи, он по-прежнему считается пользователем с проверкой подлинности на основе одноразового секретного кода. Если необходимо обновить метод проверки подлинности пользователя, вы можете удалить учетную запись гостевого пользователя и пригласить его повторно.

### <a name="example"></a>Пример

Гостевой пользователь teri@gmail.com приглашен в компанию Fabrikam, которая не поддерживает настройку федерации Google. Тери не имеет учетная запись Майкрософт. Он получит одноразовый секретный код для проверки подлинности.

## <a name="disable-email-one-time-passcode"></a>Отключить одноразовый секретный код электронной почты

Начиная с 2021 октября функция однократного секретного кода по электронной почте будет включена для всех существующих клиентов и включена по умолчанию для новых клиентов. В этот момент корпорация Майкрософт больше не будет поддерживать погашение приглашений, создавая неуправляемые ("вирусные" или "JIT") учетные записи Azure AD и клиенты для сценариев совместной работы B2B. Мы создаем функцию одноразового секретного кода по электронной почте, так как она обеспечивает простой метод проверки подлинности для гостевых пользователей. Однако вы можете отключить эту функцию, если вы решили не использовать ее.

> [!NOTE]
>
> Если функция секретного кода одноразового пароля включена в клиенте и отключена, все гостевые пользователи, которые активировали одноразовый секретный код, не смогут войти в систему. Вы можете удалить гостевой пользователь и повторно пригласить его, чтобы снова выполнить вход с помощью другого метода проверки подлинности.

### <a name="to-disable-the-email-one-time-passcode-feature"></a>Отключение функции одноразового секретного кода для электронной почты

1. Войдите на [портал Azure](https://portal.azure.com/) с правами глобального администратора Azure AD.

2. В области навигации выберите **Azure Active Directory**.

3. Выберите **Внешние удостоверения** > **Все поставщики удостоверений**.

4. Выберите **одноразовый секретный код электронной почты**, а затем выберите **Отключить одноразовый секретный код для гостей**.

   > [!NOTE]
   > Параметры секретного кода одноразового пользователя были перемещены в портал Azure из **внешних параметров совместной работы** во **все поставщики удостоверений**.
   > Если вместо параметров секретного кода одного раза отображается переключатель, это означает, что вы ранее включили, отключили или выбрали предварительную версию функции. Выберите **нет** , чтобы отключить эту функцию.
   >
   >![Переключение секретного кода на один раз отключено](media/one-time-passcode/enable-email-otp-disabled.png)

5. Щелкните **Сохранить**.

## <a name="note-for-public-preview-customers"></a>Примечание для пользователей общедоступной предварительной версии

Если вы ранее включили в общедоступную предварительную версию одноразового секретного кода для отправки по электронной почте, 2021 Дата выпуска для автоматического включения функций не применяется, поэтому связанные бизнес-процессы не будут затронуты. Кроме того, в портал Azure в поле **секретный код одноразового пароля для гостей** вы не увидите возможность **автоматического включения одноразового секретного кода для гостей, начиная с 2021 октября**. Вместо этого вы увидите следующий переключатель **Да** или **нет** :

![Одноразовый секретный код для отправки по электронной почте](media/one-time-passcode/enable-email-otp-opted-in.png)

Однако если вы предпочитаете отказаться от этой функции и разрешить ее автоматическое включение в октябре 2021, можно вернуться к параметрам по умолчанию, используя [тип ресурса конфигурации метода проверки подлинности электронной почты](/graph/api/resources/emailauthenticationmethodconfiguration)API Microsoft Graph. После возврата к значениям по умолчанию будут доступны следующие параметры в разделе одноразовый **пароль для гостей по электронной почте**:

![Включить одноразовый секретный код для электронной почты](media/one-time-passcode/email-otp-options.png)

- **Автоматически включить одноразовый секретный код электронной почты для гостей, начиная с 2021 октября**. Параметры Если функция секретного кода одноразового пароля еще не включена для вашего клиента, она будет автоматически включена с 2021 октября. Если вы хотите включить функцию в это время, никаких дополнительных действий не требуется. Если функция уже включена или отключена, этот параметр будет недоступен.

- **Включите одноразовый секретный код электронной почты для действующих гостей сейчас**. Включает функцию одноразового секретного кода по электронной почте для вашего клиента.

- **Отключить одноразовый секретный код электронной почты для гостей**. Отключает функцию одноразового секретного кода по электронной почте для клиента и предотвращает включение этой функции в октябре 2021.

## <a name="note-for-azure-us-government-customers"></a>Примечание для клиентов Azure для государственных организаций США

Функция одноразового секретного кода по электронной почте отключена по умолчанию в облаке Azure для государственных организаций США.  

 ![Секретный код одноразового сообщения электронной почты отключен](media/one-time-passcode/enable-email-otp-disabled.png)

Чтобы включить функцию одноразового секретного кода электронной почты в облаке Azure для государственных организаций США:

1. Войдите на [портал Azure](https://portal.azure.com) с правами глобального администратора Azure AD.
2. В области навигации выберите **Azure Active Directory**.
3. Выберите **Параметры организационных связей**   >  ****.

   > [!NOTE]
   > - Если вы не видите **организационные отношения**, выполните поиск по запросу "внешние удостоверения" в строке поиска вверху.

4. Выберите **одноразовый секретный код электронной почты**, а затем нажмите **кнопку Да**.
5. Щелкните **Сохранить**.

Дополнительные сведения о текущих ограничениях см. в разделе [облака Azure для государственных организаций США](current-limitations.md#azure-us-government-clouds).