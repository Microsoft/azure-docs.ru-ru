---
title: Условный доступ для пользователей службы совместной работы B2B — Azure AD
description: Узнайте, как применять политики многофакторной идентификации для пользователей Azure Active Directory B2B.
services: active-directory
ms.service: active-directory
ms.subservice: B2B
ms.topic: conceptual
ms.date: 01/21/2020
ms.author: mimart
author: msmimart
manager: celestedg
ms.reviewer: elisolMS
ms.collection: M365-identity-device-management
ms.openlocfilehash: 42b3c3d4d474c61cbe472b4122ac2f80f218bf8d
ms.sourcegitcommit: 95c2cbdd2582fa81d0bfe55edd32778ed31e0fe8
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/26/2021
ms.locfileid: "98797267"
---
# <a name="conditional-access-for-b2b-collaboration-users"></a>Условный доступ для пользователей службы совместной работы B2B

В этой статье описывается, как организации могут ограничить область применения политик условного доступа (CA) для гостевых пользователей B2B для доступа к своим ресурсам.
>[!NOTE]
>Этот поток проверки подлинности или авторизации немного отличается для гостевых пользователей, чем для существующих пользователей этого поставщика удостоверений (IdP).

## <a name="authentication-flow-for-b2b-guest-users-from-an-external-directory"></a>Поток проверки подлинности для гостевых пользователей B2B из внешнего каталога

На следующей схеме показан поток ![ проверки подлинности для гостевых пользователей B2B из внешнего каталога.](./media/conditional-access-b2b/authentication-flow-b2b-guests.png)

| Шаг | Описание |
|--------------|-----------------------|
| 1. | Гостевой пользователь B2B запрашивает доступ к ресурсу. Ресурс перенаправляет пользователя к своему клиенту ресурса, доверенному IdP.|
| 2. | Клиент ресурсов определяет пользователя как внешний и перенаправляет пользователя в IdP гостя. Пользователь выполняет первичную проверку подлинности в IdP.
| 3. | IdP гостевой пользователь B2B выдает маркер пользователю. Пользователь перенаправляется обратно в клиент ресурсов с помощью токена. Клиент ресурсов проверяет маркер, а затем оценивает пользователя в соответствии с политиками ЦС. Например, клиент ресурсов может потребовать от пользователя выполнить многофакторную проверку подлинности Azure Active Directory (AD).
| 4. | Когда все политики ЦС клиента ресурсов удовлетворяются, клиент ресурсов выдает собственный маркер и перенаправляет пользователя к его ресурсу.

## <a name="authentication-flow-for-b2b-guest-users-with-one-time-passcode"></a>Поток проверки подлинности для гостевых пользователей B2B с одним секретным кодом

На следующей схеме показан поток ![ проверки подлинности для гостевых пользователей B2B с одним секретным кодом.](./media/conditional-access-b2b/authentication-flow-b2b-guests-otp.png)

| Шаг | Описание |
|--------------|-----------------------|
| 1. |Пользователь запрашивает доступ к ресурсу в другом клиенте. Ресурс перенаправляет пользователя к своему клиенту ресурса, доверенному IdP.|
| 2. | Клиент ресурсов идентифицирует пользователя в качестве внешнего пользователя с одноразовым [секретным кодом (OTP)](https://docs.microsoft.com/azure/active-directory/external-identities/one-time-passcode) и отправляет пользователю сообщение электронной почты с OTP.|
| 3. | Пользователь получает OTP и отправляет код. Клиент ресурсов оценивает пользователя в соответствии с политиками ЦС.
| 4. | После соблюдения всех политик ЦС клиент ресурсов выдает маркер и перенаправляет пользователя к его ресурсу. |

>[!NOTE]
>Если пользователь получен из внешнего клиента ресурса, то политики ЦС IdP для гостевого пользователя невозможно будет оценить. На сегодняшний день к своим гостям применяются только политики ЦС клиента ресурсов.

## <a name="azure-ad-multi-factor-authentication-for-b2b-users"></a>Многофакторная идентификация Azure AD для пользователей B2B

Организации могут применять несколько политик многофакторной идентификации Azure AD для гостевых пользователей B2B. Эти политики могут быть применены на уровне клиента, приложения или отдельного пользователя так же, как они включены для сотрудников с полным временем и членов Организации.
Клиент ресурсов всегда несет ответственность за многофакторную идентификацию Azure AD для пользователей, даже если у гостевой Организации есть возможности многофакторной проверки подлинности. Вот пример.

1. Администратор или информационный работник компании Fabrikam приглашает пользователя из другой компании Contoso для использования своего приложения Woodgrove.

2. Приложение Woodgrove в Fabrikam настроено для использования многофакторной идентификации Azure AD в доступе.

3. Когда гостевой пользователь B2B из компании Contoso пытается получить доступ к Woodgrove в клиенте Fabrikam, ему предлагается выполнить запрос многофакторной идентификации Azure AD.

4. После этого гостевой пользователь может настроить многофакторную идентификацию Azure AD в Fabrikam и выбрать параметры.

5. Этот сценарий работает для любого удостоверения — Azure AD или личной учетной записи Майкрософт (MSA). Например, если пользователь в Contoso выполняет проверку подлинности с помощью идентификатора социальных сетей.

6. Fabrikam должна иметь достаточное количество лицензий Azure AD уровня "Премиум", поддерживающих многофакторную идентификацию Azure AD. Затем пользователь из компании Contoso использует эту лицензию из Fabrikam. Сведения о лицензировании B2B см. в статье [модель выставления счетов для внешних удостоверений Azure AD](https://docs.microsoft.com/azure/active-directory/external-identities/external-identities-pricing) .

>[!NOTE]
>Многофакторная идентификация Azure AD выполняется в ресурсе "Аренда ресурсов" для обеспечения предсказуемости.

### <a name="set-up-azure-ad-multi-factor-authentication-for-b2b-users"></a>Настройка многофакторной идентификации Azure AD для пользователей B2B

Чтобы настроить многофакторную идентификацию Azure AD для пользователей службы совместной работы B2B, просмотрите это видео:

>[!VIDEO https://channel9.msdn.com/Blogs/Azure/b2b-conditional-access-setup/Player]

### <a name="b2b-users-azure-ad-multi-factor-authentication-for-offer-redemption"></a>Пользователи B2B. многофакторная идентификация Azure AD для активации предложения

Дополнительные сведения об активации многофакторной идентификации Azure AD см. в этом видео:

>[!VIDEO https://channel9.msdn.com/Blogs/Azure/MFA-redemption/Player]

### <a name="azure-ad-multi-factor-authentication-reset-for-b2b-users"></a>Сброс многофакторной идентификации Azure AD для пользователей B2B

Теперь для подтверждения гостевых пользователей B2B доступны следующие командлеты PowerShell:

1. Подключение к Azure AD

   ```
   $cred = Get-Credential
   Connect-MsolService -Credential $cred
   ```
2. Получение сведений о методах проверки для всех пользователей.

   ```
   Get-MsolUser | where { $_.StrongAuthenticationMethods} | select UserPrincipalName, @{n="Methods";e={($_.StrongAuthenticationMethods).MethodType}}
   ```
   Пример:

   ```
   Get-MsolUser | where { $_.StrongAuthenticationMethods} | select UserPrincipalName, @{n="Methods";e={($_.StrongAuthenticationMethods).MethodType}}
   ```

3. Сбросьте метод многофакторной проверки подлинности Azure AD для конкретного пользователя, чтобы пользователь службы совместной работы B2B снова установил методы проверки. 
   Пример:

   ```
   Reset-MsolStrongAuthenticationMethodByUpn -UserPrincipalName gsamoogle_gmail.com#EXT#@ WoodGroveAzureAD.onmicrosoft.com
   ```

## <a name="conditional-access-for-b2b-users"></a>Условный доступ для пользователей B2B

Существуют различные факторы, влияющие на политики ЦС для гостевых пользователей B2B.

### <a name="device-based-conditional-access"></a>Условный доступ на основе информации об устройстве

В ЦС есть возможность требовать, [чтобы устройство пользователя было соответствующим или гибридным, присоединенным к Azure AD](https://docs.microsoft.com/azure/active-directory/conditional-access/concept-conditional-access-conditions#device-state-preview). Гостевые пользователи B2B могут соответствовать требованиям только в том случае, если клиент ресурсов может управлять своим устройством. За один раз устройства не могут управляться несколькими организациями. Гостевые пользователи B2B не могут удовлетворить гибридную присоединение к Azure AD, так как у них нет локальной учетной записи AD. Только если устройство гостевого пользователя является неуправляемым, оно может зарегистрировать свое устройство в клиенте ресурсов, а затем сделать устройство соответствующим. После этого пользователь может удовлетворить элемент управления GRANT.

>[!Note]
>Не рекомендуется требовать для внешних пользователей управляемое устройство.

### <a name="mobile-application-management-policies"></a>Политики управления мобильными приложениями

ЦС предоставляет элементам управления, таким как " **требовать утвержденные клиентские приложения** " и " **требовать применения политик защиты приложений** ", регистрацию устройства в клиенте. Эти элементы управления можно применять только к [устройствам iOS и Android](https://docs.microsoft.com/azure/active-directory/conditional-access/concept-conditional-access-conditions#device-platforms). Однако ни один из этих элементов управления не может быть применен к гостевым пользователям B2B, если устройство пользователя уже управляется другой организацией. Мобильное устройство нельзя зарегистрировать одновременно в нескольких клиентах. Если мобильное устройство управляется другой организацией, он будет заблокирован. Только если устройство гостевого пользователя является неуправляемым, оно может зарегистрировать свое устройство в клиенте ресурса. После этого пользователь может удовлетворить элемент управления GRANT.  

>[!NOTE]
>Не рекомендуется требовать политику защиты приложений для внешних пользователей.

### <a name="location-based-conditional-access"></a>Условный доступ на основе расположения

[Политика на основе расположения](https://docs.microsoft.com/azure/active-directory/conditional-access/concept-conditional-access-conditions#locations) , основанная на ДИАПАЗОНАХ IP-адресов, может быть применена, если в приглашенной Организации можно создать диапазон доверенных IP-адресов, определяющий Организации партнеров.

Политики также можно применять на основе **географических расположений**.

### <a name="risk-based-conditional-access"></a>Условный доступ на основе рисков

[Политика риска входа](https://docs.microsoft.com/azure/active-directory/conditional-access/concept-conditional-access-conditions#sign-in-risk) применяется, если гостевой пользователь B2B удовлетворяет требованиям управления предоставлением. Например, Организация может потребовать многофакторную идентификацию Azure AD для среднего или высокого риска при входе. Однако если пользователь ранее не зарегистрировался для многофакторной идентификации Azure AD в клиенте ресурса, он будет заблокирован. Это делается для того, чтобы пользователи-злоумышленники не могли регистрировать свои учетные данные многофакторной идентификации Azure AD в случае нарушения законного пароля пользователя.

Однако [Политика риска пользователя](https://docs.microsoft.com/azure/active-directory/conditional-access/concept-conditional-access-conditions#user-risk) не может быть разрешена в клиенте ресурса. Например, если требуется изменить пароль для гостевых пользователей с высоким риском, они будут заблокированы из-за невозможности сбросить пароли в каталоге ресурсов.

### <a name="conditional-access-client-apps-condition"></a>Условие для клиентских приложений условного доступа

[Условия для клиентских приложений](https://docs.microsoft.com/azure/active-directory/conditional-access/concept-conditional-access-conditions#client-apps) ведут себя одинаково для гостевых пользователей B2B, как и для любого другого типа пользователей. Например, можно предотвратить использование устаревших протоколов проверки подлинности гостевыми пользователями.

### <a name="conditional-access-session-controls"></a>Элементы управления для сеанса условного доступа

[Элементы управления сеансом](https://docs.microsoft.com/azure/active-directory/conditional-access/concept-conditional-access-session) ведут себя одинаково для гостевых пользователей B2B, как и для любого другого типа пользователей.

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения см. в следующих статьях о службе совместной работы Azure AD B2B.

- [Что такое служба совместной работы Azure AD B2B?](https://docs.microsoft.com/azure/active-directory/external-identities/what-is-b2b)
- [Защита идентификации и пользователи B2B](https://docs.microsoft.com/azure/active-directory/identity-protection/concept-identity-protection-b2b)
- [Цены на внешние удостоверения](https://azure.microsoft.com/pricing/details/active-directory/)
- [Часто задаваемые вопросы (FAQ)](https://docs.microsoft.com/azure/active-directory/external-identities/faq)

