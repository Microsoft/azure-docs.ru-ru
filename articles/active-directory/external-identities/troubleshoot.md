---
title: Устранение неполадок службы совместной работы B2B — Azure Active Directory | Документация Майкрософт
description: Способы устранения распространенных проблем со службой совместной работы Azure Active Directory B2B.
services: active-directory
ms.service: active-directory
ms.subservice: B2B
ms.topic: troubleshooting
ms.date: 02/12/2021
tags: active-directory
ms.author: mimart
author: msmimart
ms.reviewer: mal
ms.custom:
- it-pro
- seo-update-azuread-jan"
ms.collection: M365-identity-device-management
ms.openlocfilehash: 60cd944ecb144a30e872259f6e959a11c3ea6319
ms.sourcegitcommit: d4734bc680ea221ea80fdea67859d6d32241aefc
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/14/2021
ms.locfileid: "100365435"
---
# <a name="troubleshooting-azure-active-directory-b2b-collaboration"></a>Устранение неполадок службы совместной работы Azure Active Directory B2B

В этой статье описаны способы устранения распространенных проблем, возникающих в службе совместной работы Azure Active Directory (Azure AD) B2B.

   > [!IMPORTANT]
   > - **Начиная с 4 января 2021 г.** компания Google [прекращает поддержку входа через веб-представление](https://developers.googleblog.com/2020/08/guidance-for-our-effort-to-block-less-secure-browser-and-apps.html). Если вы используете федерацию Google или самостоятельную регистрацию с помощью Gmail, вам нужно [проверить нативные бизнес-приложения на совместимость](google-federation.md#deprecation-of-webview-sign-in-support).
   > - **Начиная с 2021 октября** Корпорация Майкрософт больше не будет поддерживать погашение приглашений, создавая неуправляемые учетные записи и клиенты Azure AD для сценариев совместной работы B2B. В ходе подготовки мы советуем клиентам перейти на [проверку подлинности с использованием одноразового секретного кода](one-time-passcode.md). Мы будем рады вашим отзывам об этой функции, предоставляемой в общедоступной предварительной версии, и с радостью создадим другие способы для совместной работы.

## <a name="ive-added-an-external-user-but-do-not-see-them-in-my-global-address-book-or-in-the-people-picker"></a>После добавления внешнего пользователя он не отображается в глобальной адресной книге или в средстве выбора пользователей

В тех случаях, когда данные внешних пользователей не заполняются в списке, репликация объекта может занять несколько минут.

## <a name="a-b2b-guest-user-is-not-showing-up-in-sharepoint-onlineonedrive-people-picker"></a>Гостевой пользователь B2B не отображается в средстве выбора людей SharePoint Online или OneDrive

Возможность поиска существующих гостевых пользователей в средстве выбора пользователей SharePoint Online (SPO) отключена по умолчанию для согласования с поведением предыдущих версий.

Вы можете включить эту функцию, используя параметр ShowPeoplePickerSuggestionsForGuestUsers на уровне семейства веб-сайтов и коллекции клиентов. Задать параметр этой функции можно с помощью командлетов SPOTenant и SPOSite, которые позволяют участникам искать всех существующих гостевых пользователей в каталоге. Изменения в области клиента не влияют на уже подготовленные сайты SPO.

## <a name="invitations-have-been-disabled-for-directory"></a>Приглашения отключены для каталога

Если вы получили уведомления о том, что у вас нет разрешений на приглашение пользователей, убедитесь, что учетная запись пользователя имеет право приглашать внешних пользователей в разделе Azure Active Directory > параметры пользователя > внешних пользователей > управления внешними параметрами совместной работы:

![Снимок экрана, показывающий параметры внешних пользователей](media/troubleshoot/external-user-settings.png)

Если вы недавно изменили эти параметры или назначили пользователю роль лица, приглашающего гостей, то изменения вступят в силу примерно через 15–60 минут.

## <a name="the-user-that-i-invited-is-receiving-an-error-during-redemption"></a>Пользователь, которого я пригласил, в процессе активации получает сообщение об ошибке

Ниже перечислены распространенные ошибки.

### <a name="invitees-admin-has-disallowed-emailverified-users-from-being-created-in-their-tenant"></a>Администратор приглашенного пользователя запретил создавать в клиенте пользователей с атрибутом EmailVerified

Если приглашаются пользователи из организации, в которой используется каталог Azure Active Directory, где отсутствует учетная запись определенного пользователя (например, пользователь не существует в каталоге AAD contoso.com). Администратор contoso.com мог настроить политику, которая запрещает создавать пользователей. Пользователь должен уточнить у администратора, разрешается ли приглашать внешних пользователей. Администратору внешнего пользователя может потребоваться разрешить в своем домене пользователей с проверенным адресом электронной почты (сведения о разрешении пользователей с проверенным адресом электронной почты см. в этой [статье](/powershell/module/msonline/set-msolcompanysettings)).

![Ошибка, указывающая, что клиент не допускает проверку подлинности пользователей по электронной почте](media/troubleshoot/allow-email-verified-users.png)

### <a name="external-user-does-not-exist-already-in-a-federated-domain"></a>Внешний пользователь уже не существует в федеративном домене

Если используется проверка подлинности федерации, и пользователь уже не существует в Azure Active Directory, пригласить его невозможно.

Для устранения этой проблемы администратор внешнего пользователя должен синхронизировать учетную запись этого пользователя с Azure Active Directory.

## <a name="how-does--which-is-not-normally-a-valid-character-sync-with-azure-ad"></a>Как символ "\#", который обычно является недопустимым, синхронизируется с Azure AD?

Знак "\#" зарезервирован для имен участников-пользователей службы совместной работы Azure AD B2B или внешних пользователей (имя учетной записи приглашенного пользователя user@contoso.com преобразуется в user_contoso.com#EXT#@fabrikam.onmicrosoft.com). Поэтому при входе на портал Azure не разрешается использовать знак "\#" в именах участников-пользователей из локальной среды. 

## <a name="i-receive-an-error-when-adding-external-users-to-a-synchronized-group"></a>При добавлении внешних пользователей в синхронизированную группу появляется сообщение об ошибке

Внешних пользователей можно добавлять только в "назначенные" группы или группы "безопасности", а не в локально управляемые группы.

## <a name="my-external-user-did-not-receive-an-email-to-redeem"></a>Внешний пользователь не получил оправленное ему сообщение для активации

Приглашенному пользователю следует обратиться к своему поставщику услуг Интернета или проверить настройки фильтра нежелательной почты и убедиться, что этот адрес разрешен: Invites@microsoft.com

## <a name="i-notice-that-the-custom-message-does-not-get-included-with-invitation-messages-at-times"></a>Пользовательское сообщение иногда не включаются в сообщение с приглашением

Для соблюдения требований законов о защите конфиденциальности данных наши API-интерфейсы не включают пользовательские сообщения в текст сообщений с приглашением:

- если в приглашающем клиенте не указан адрес электронной почты приглашающего;
- если приглашение отправляет субъект-служба приложения.

Если вам важно использовать именно этот сценарий, вы можете запретить отправку сообщения с приглашением из API-интерфейса, и отправить его через любой другой механизм отправки электронной почты. Проконсультируйтесь к юристом своей организации, чтобы убедиться, что отправляемые таким образом сообщения не нарушают требования законов о защите конфиденциальности данных.

## <a name="you-receive-an-aadsts65005-error-when-you-try-to-log-in-to-an-azure-resource"></a>При попытке входа в ресурс Azure появляется сообщение об ошибке "AADSTS65005"

Пользователь с гостевой учетной записью не может войти в систему и получает следующее сообщение об ошибке:

```plaintext
    AADSTS65005: Using application 'AppName' is currently not supported for your organization contoso.com because it is in an unmanaged state. An administrator needs to claim ownership of the company by DNS validation of contoso.com before the application AppName can be provisioned.
```

Пользователь имеет учетную запись пользователя Azure и является вирусным клиентом, который был отменен или неуправляем. Кроме того, в клиенте нет глобальных администраторов.

Чтобы устранить эту проблему, необходимо принять отброшенный клиент. Ознакомьтесь с  [разработкой неуправляемого каталога от имени администратора в Azure Active Directory](../enterprise-users/domains-admin-takeover.md). Кроме того, необходимо получить доступ к Интернету DNS для суффикса домена, чтобы предоставить прямые доказательства, которыми вы управляете пространством имен. После возвращения клиента в управляемое состояние следует обсудить с клиентом, следует ли выпустить пользователей и проверенное доменное имя, наилучшим способом для своей организации.

## <a name="a-guest-user-with-a-just-in-time-or-viral-tenant-is-unable-to-reset-their-password"></a>Гостевому пользователю клиента JIT или "вирусного" клиента не удается сбросить пароль

Если клиентом удостоверений является клиент JIT или вирусный клиент (то есть отдельный неуправляемый клиент Azure), только гостевой пользователь может сбросить пароль. Иногда организация будет [управлять вирусными клиентами](../enterprise-users/domains-admin-takeover.md), которые создаются, когда сотрудники используют свои рабочие электронные адреса для регистрации в службах. После получения организацией контроля над вирусным клиентом только администратор в организации может сбросить пароль пользователя или включить SSPR. При необходимости приглашающая организация может удалить учетную запись гостя из каталога и повторно отправить приглашение.

## <a name="a-guest-user-is-unable-to-use-the-azuread-powershell-v1-module"></a>Гостевой пользователь не может использовать модуль AzureAD PowerShell v1

С 18 ноября 2019 г. гостевые пользователи в каталоге (определенные как учетные записи пользователей, для которых свойство **userType** имеет значение **Guest**) блокируются с помощью модуля AzureAD PowerShell v1. В дальнейшем пользователь должен быть пользователем-членом (где **userType** равен **member**) или использовать модуль AzureAD PowerShell v2.

## <a name="in-an-azure-us-government-tenant-i-cant-invite-a-b2b-collaboration-guest-user"></a>В клиенте Azure для государственных организаций США не удается пригласить гостевого пользователя службы совместной работы B2B

В облаке Azure для государственных организаций США служба совместной работы B2B поддерживается только между клиентами, которые находятся в облаке Azure для государственных организаций США и поддерживают службу совместной работы B2B. Если вы приглашаете пользователя в клиенте, который не входит в облако Azure для государственных организаций США или что еще не поддерживает службу совместной работы B2B, вы получите сообщение об ошибке. Дополнительные сведения и ограничения см. в разделе [варианты Azure Active Directory Premium P1 и P2](../../azure-government/compare-azure-government-global-azure.md#azure-active-directory-premium-p1-and-p2).

## <a name="i-receive-the-error-that-azure-ad-cannot-find-the-aad-extensions-app-in-my-tenant"></a>Я получаю сообщение об ошибке, в которой Azure AD не удается найти приложение AAD-Extensions-App в моем клиенте

При использовании функций самостоятельной регистрации, таких как пользовательские атрибуты пользователя или потоки пользователей, автоматически создается приложение с именем `aad-extensions-app. Do not modify. Used by AAD for storing user data.` . Он используется внешними удостоверениями Azure AD для хранения сведений о пользователях, которые подписываются и собирают настраиваемые атрибуты.

Если вы случайно удалили приложение `aad-extensions-app`, его можно восстановить в течение 30 дней. Вы можете восстановить приложение с помощью модуля Azure AD PowerShell.

1. Запустите модуль Azure AD PowerShell и запустите `Connect-AzureAD` .
1. Войдите в систему как глобальный администратор для клиента Azure AD, для которого требуется восстановить удаленное приложение.
1. Выполните команду PowerShell `Get-AzureADDeletedApplication` .
1. Найдите в списке приложение, в котором начинается отображаемое имя, `aad-extensions-app` и скопируйте его `ObjectId` значение свойства.
1. Выполните команду PowerShell `Restore-AzureADDeletedApplication -ObjectId {id}` . Замените `{id}` часть команды на `ObjectId` из предыдущего шага.

Теперь восстановленное приложение появится в портал Azure.

## <a name="next-steps"></a>Следующие шаги

[Получение поддержки для службы совместной работы B2B](../fundamentals/active-directory-troubleshooting-support-howto.md)
