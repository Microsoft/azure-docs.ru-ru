---
title: Активация приглашения в службе совместной работы Azure Active Directory B2B
description: Здесь описан процесс активации приглашения в службе совместной работы Azure AD B2B для пользователей, включая принятие условий конфиденциальности.
services: active-directory
ms.service: active-directory
ms.subservice: B2B
ms.topic: conceptual
ms.date: 03/02/2021
ms.author: mimart
author: msmimart
manager: celestedg
ms.reviewer: elisol
ms.collection: M365-identity-device-management
ms.openlocfilehash: 95c7ca826eaf7d72cb35985b154458f149ef4a0e
ms.sourcegitcommit: b4647f06c0953435af3cb24baaf6d15a5a761a9c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/02/2021
ms.locfileid: "101649324"
---
# <a name="azure-active-directory-b2b-collaboration-invitation-redemption"></a>Активация приглашения службы совместной работы Azure Active Directory B2B

В этой статье описываются способы доступа гостевых пользователей к ресурсам и процесс согласия, c которыми они могут столкнуться. Если вы отправляете гостю электронное письмо с приглашением, то оно содержит ссылку, которую гость может активировать для получения доступа к вашему приложению или порталу. Сообщение электронной почты с приглашением — лишь один из способов получения гостями доступа к вашим ресурсам. В качестве альтернативы можно добавить гостей в каталог и предоставить им прямую ссылку на портал или приложение, к которому вы хотите предоставить общий доступ. Независимо от используемого метода, гости проходят через процесс получения первоначального согласия. Этот процесс гарантирует, что ваши гости согласны с условиями конфиденциальности и принимают все настроенные [условия использования](../conditional-access/terms-of-use.md).

Когда вы добавляете гостя в свой каталог, его учетная запись имеет статус согласия (просматриваемый в PowerShell), для которого изначально установлено значение **PendingAcceptance**. Эта настройка сохраняется до тех пор, пока гость не примет ваше приглашение и не согласится с вашей политикой конфиденциальности и условиями использования. После этого состояние согласия изменяется на **Принято** и страницы согласия больше не представляются гостю.

   > [!IMPORTANT]
   > - **Начиная с 4 января 2021 г.** компания Google [прекращает поддержку входа через веб-представление](https://developers.googleblog.com/2020/08/guidance-for-our-effort-to-block-less-secure-browser-and-apps.html). Если вы используете федерацию Google или самостоятельную регистрацию с помощью Gmail, вам нужно [проверить нативные бизнес-приложения на совместимость](google-federation.md#deprecation-of-webview-sign-in-support).
   > - **Начиная с октября 2021 г.** корпорация Майкрософт прекратит поддержку активации через приглашение при создании неуправляемых учетных записей и арендаторов Azure AD для сценариев совместной работы B2B. В ходе подготовки мы советуем клиентам перейти на [проверку подлинности с использованием одноразового секретного кода](one-time-passcode.md). Мы будем рады вашим отзывам об этой функции, предоставляемой в общедоступной предварительной версии, и с радостью создадим другие способы для совместной работы.

## <a name="redemption-and-sign-in-through-a-common-endpoint"></a>Активация и вход через общую конечную точку;

Гостевые пользователи теперь могут входить в приложения с несколькими клиентами или сторонними приложениями Майкрософт через общую конечную точку (URL-адрес), например `https://myapps.microsoft.com` . Ранее общий URL-адрес перенаправит гостевой пользователь на домашний клиент, а не клиент ресурсов для проверки подлинности, поэтому требуется ссылка для конкретного клиента (например, `https://myapps.microsoft.com/?tenantid=<tenant id>` ). Теперь гостевой пользователь может зайти на общий URL-адрес приложения, выбрать **Параметры входа**, а затем нажать кнопку **войти в организацию**. Затем пользователь вводит имя Организации.

![Общий вход в конечную точку](media/redemption-experience/common-endpoint-flow-small.png)

Затем пользователь перенаправляется в клиентскую конечную точку, где можно выполнить вход с помощью адреса электронной почты или выбрать настроенного поставщика удостоверений.
## <a name="redemption-through-a-direct-link"></a>Активация с помощью прямой ссылки

В качестве альтернативы почтовому приглашению или общему URL-адресу приложения вы можете предоставить Гостевой веб-каналу прямую ссылку на приложение или портал. Сначала необходимо добавить гостевого пользователя в каталог с помощью [портала Azure](./b2b-quickstart-add-guest-users-portal.md) или [PowerShell](./b2b-quickstart-invite-powershell.md). Затем можно использовать любой из [настраиваемых способов развертывания приложений для пользователей](../manage-apps/end-user-experiences.md), включая ссылки для прямого входа. Когда гость использует прямую ссылку вместо приглашения по электронной почте, он все равно пройдет процедуру получения первоначального согласия.

> [!NOTE]
> Прямая ссылка зависит от клиента. Иными словами, он включает идентификатор клиента или проверенный домен, чтобы можно было пройти проверку подлинности гостя в клиенте, где расположено общее приложение. Ниже приведены некоторые примеры прямых ссылок с контекстом клиента.
 > - Панель доступа к приложениям: `https://myapps.microsoft.com/?tenantid=<tenant id>`
 > - Панель доступа к приложениям для проверенного домена: `https://myapps.microsoft.com/<;verified domain>`
 > - Портал Azure: `https://portal.azure.com/<tenant id>`
 > - Отдельное приложение: см. статью об использовании [ссылки для прямого входа](../manage-apps/end-user-experiences.md#direct-sign-on-links).

В некоторых случаях рекомендуется использовать приглашение по электронной почте вместо прямой ссылки. Если эти особые случаи актуальны для организации, рекомендуем приглашать пользователей с отправкой приглашения по электронной почте.
 - У пользователя нет учетной записи Azure AD, MSA или учетной записи электронной почты в федеративной организации. Если вы не используете одноразовую функцию секретного кода, гостевой службе необходимо активировать электронное письмо с приглашением, чтобы получить инструкции по созданию MSA.
 - Иногда объект приглашенного пользователя не может использовать адрес электронной почты из-за конфликта с контактным объектом (например, контактным объектом Outlook). В этом случае пользователю необходимо щелкнуть URL-адрес активации в приглашении, полученном по электронной почте.
 - Пользователь может выполнить вход с псевдонимом адреса электронной почты, по которому поступило приглашение (псевдоним — это дополнительный адрес электронной почты, связанный с учетной записью электронной почты). В этом случае пользователю необходимо щелкнуть URL-адрес активации в приглашении, полученном по электронной почте.

## <a name="redemption-through-the-invitation-email"></a>Активация с помощью приглашения по электронной почте

Когда вы добавляете гостя в свой каталог с помощью [портала Azure](./b2b-quickstart-add-guest-users-portal.md), в этом процессе ему отправляется электронное письмо с приглашением. Вы также можете отправить приглашения по электронной почте, когда [используете](./b2b-quickstart-invite-powershell.md) PowerShell, чтобы добавить гостевых пользователей в каталог. Ниже приведено описание процесса активации ссылки гостем в сообщении электронной почты.

1. Гость получает [приглашение](./invitation-email-elements.md), отправленное **Microsoft Invitations**.
2. Он выбирает пункт **Принять приглашение** в сообщении электронной почты.
3. Гость будет использовать свои собственные учетные данные для входа в ваш каталог. Если у гостя нет учетной записи, которая может быть объединена с вашим каталогом, и функция отправки [одноразового пароля электронной почты (OTP)](./one-time-passcode.md) не включена, ему будет предложено создать личную учетную запись [MSA](https://support.microsoft.com/help/4026324/microsoft-account-how-to-create) или [учетную запись самообслуживания Azure AD](../enterprise-users/directory-self-service-signup.md). Дополнительные сведения см. в разделе о [потоке активации приглашения](#invitation-redemption-flow).
4. Для работы с гостевыми системами используется [процедура согласия](#consent-experience-for-the-guest), описанная ниже.
## <a name="invitation-redemption-flow"></a>Поток активации приглашения

Когда пользователь щелкает ссылку **Принять приглашение** в [сообщении электронной почты с приглашением](invitation-email-elements.md), Azure AD автоматически активирует приглашение на основе потока активации, как показано ниже:

![Снимок экрана, показывающий схему потока активации](media/redemption-experience/invitation-redemption-flow.png)

**Если имя субъекта-пользователя (UPN) совпадает с существующей учетной записью Azure AD и личной учетной записью MSA, пользователю будет предложено выбрать учетную запись, которую нужно активировать.*

1. Azure AD выполняет обнаружение пользователей, чтобы определить, существует ли пользователь в [имеющемся клиенте Azure AD](./what-is-b2b.md#easily-invite-guest-users-from-the-azure-ad-portal).

2. Если администратор включил [прямую федерацию](./direct-federation.md), Azure AD проверяет, соответствует ли суффикс домена пользователя домену настроенного поставщика удостоверений SAML/WS-Fed, и перенаправляет пользователя к предварительно настроенному поставщику удостоверений.

3. Если администратор включил [федерацию Google](./google-federation.md), Azure AD проверяет, является ли суффикс домена пользователя gmail.com или googlemail.com и перенаправляет пользователя в Google.

4. Процесс активации проверяет наличие у пользователя [существующей учетной записи Майкрософт (MSA)](https://support.microsoft.com/help/4026324/microsoft-account-how-to-create).

5. После идентификации **домашнего каталога пользователя** он перенаправляется соответствующему поставщику удостоверений для входа в систему.  

6. Если на шагах 1 и 4 не удается найти корневой каталог для приглашенного пользователя, Azure AD определяет, включена ли в приглашенном клиенте функция [одноразового секретного кода (OTP) по электронной почте](./one-time-passcode.md) для гостей.

7. Если для гостей [включен одноразовый секретный код](./one-time-passcode.md#when-does-a-guest-user-get-a-one-time-passcode), он отправляется пользователю через адрес электронной почты приглашенного лица. Пользователь получит и введет этот секретный код на странице входа в Azure AD.

8. Если секретный код одноразового пароля для гостей отключен, Azure AD проверяет суффикс домена, чтобы определить, принадлежит ли он учетной записи потребителя. В этом случае пользователю предлагается создать личную [учетную запись Майкрософт](https://support.microsoft.com/help/4026324/microsoft-account-how-to-create). В противном случае пользователю будет предложено создать [учетную запись самообслуживания Azure AD](../enterprise-users/directory-self-service-signup.md).

9. Azure AD попытается создать [учетную запись самообслуживания Azure AD](../enterprise-users/directory-self-service-signup.md), проверив доступ к электронной почте. Проверка учетной записи выполняется путем отправки кода с помощью сообщения электронной почты, когда пользователь получает и отправляет его в Azure AD. Однако если клиент приглашенного пользователя является федеративным или в поле AllowEmailVerifiedUsers клиента приглашенного пользователя установлено значение false, то пользователь не сможет завершить процедуру активации и поток активации приглашения приведет к ошибке. Дополнительные сведения см. в разделе [Пользователь, которого я пригласил, в процессе активации получает сообщение об ошибке](./troubleshoot.md#the-user-that-i-invited-is-receiving-an-error-during-redemption).

10. В этом случае пользователю предлагается создать личную [учетную запись Майкрософт (MSA)](https://support.microsoft.com/help/4026324/microsoft-account-how-to-create).

11. После проверки подлинности на правильного поставщика удостоверений пользователь перенаправляется в Azure AD для [завершения процедуры согласия](#consent-experience-for-the-guest).  

Для JIT-активации, которая осуществляется с помощью ссылки на клиентское приложение, шаги с 8 по 10 недоступны. Если пользователь переходит на шаг 6 и функция секретного кода одноразового пароля не включена, пользователь получает сообщение об ошибке и не может активировать приглашение. Чтобы предотвратить эту ошибку, администраторы должны или [активировать одноразовый секретный код, отправляемый по электронной почте,](./one-time-passcode.md#when-does-a-guest-user-get-a-one-time-passcode) или убедиться, что пользователь щелкнет ссылку с приглашением.

## <a name="consent-experience-for-the-guest"></a>Условия предоставления согласия для гостей

Когда гость впервые получает доступ к ресурсам в партнерской организации, он выполняет переход по следующим страницам. 

1. Гость просматривает страницу **Проверка разрешений** с описанием заявления о конфиденциальности в приглашенной организации. Чтобы продолжить, пользователь должен **принять** условия использования своих данных в соответствии с политиками конфиденциальности приглашающей организации.

   ![Снимок экрана со страницей "Проверить разрешения"](media/redemption-experience/review-permissions.png) 

   > [!NOTE]
   > Сведения о том, как администратор клиента может создать ссылку на заявление о конфиденциальности вашей организации, см. в разделе [Практическое руководство. Добавление сведений о конфиденциальности организации в Azure Active Directory](../fundamentals/active-directory-properties-area.md).

2. Если условия использования настроены, гостю необходимо открыть и изучить их, а затем нажать кнопку **Принять**. 

   ![Снимок экрана с новыми условиями использования](media/redemption-experience/terms-of-use-accept.png) 

   Вы можете настроить [условия использования](../conditional-access/terms-of-use.md) в разделе **Внешние удостоверения** > **Условия использования**.

3. Если не указано иное, гость перенаправляется на панель доступа к приложениям, в которой перечислены приложения, доступные гостю.

   ![Снимок экрана: панель доступа к приложениям](media/redemption-experience/myapps.png) 

В вашем каталоге значение для гостя **Приглашение принято** изменяется на **Да**. Если вы создали MSA, гостевой параметр **Источник** будет иметь значение **Учетная запись Майкрософт**. Дополнительные сведения о свойствах учетной записи гостевого пользователя см. в статье [Свойства пользователя службы совместной работы Azure Active Directory B2B](user-properties.md). 

## <a name="next-steps"></a>Дальнейшие действия

- [Что такое служба совместной работы Azure AD B2B?](what-is-b2b.md)
- [Add Azure Active Directory B2B collaboration users in the Azure portal](add-users-administrator.md) (Добавление пользователей службы совместной работы Azure Active Directory B2B на портале Azure)
- [How do information workers add B2B collaboration users to Azure Active Directory?](add-users-information-worker.md) (Как информационные работники могут добавить пользователей для совместной работы B2B в Azure Active Directory)
- [Добавление пользователей службы совместной работы Azure Active Directory B2B с помощью PowerShell](customize-invitation-api.md#powershell)
- [Leave an organization as a guest user](leave-the-organization.md) (Выход гостевого пользователя из организации)