---
title: Оценка непрерывного доступа в Azure AD
description: Более быстрое реагирование на изменения пользовательской среды благодаря оценке непрерывного доступа в Azure AD
services: active-directory
ms.service: active-directory
ms.subservice: conditional-access
ms.topic: conceptual
ms.date: 08/28/2020
ms.author: joflore
author: MicrosoftGuyJFlo
manager: daveba
ms.reviewer: jlu
ms.collection: M365-identity-device-management
ms.openlocfilehash: 9a2c83fc0f4776e1ded2c8c12cb990ab227f048b
ms.sourcegitcommit: bed20f85722deec33050e0d8881e465f94c79ac2
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/25/2021
ms.locfileid: "105109018"
---
# <a name="continuous-access-evaluation"></a>Непрерывная оценка доступа

Срок действия маркера и обновление являются стандартным механизмом в отрасли. Когда клиентское приложение, например Outlook, подключается к службе, например Exchange Online, запросы API разрабатываются с помощью маркеров доступа OAuth 2,0. По умолчанию эти маркеры доступа действительны в течение одного часа, когда срок их действия истекает, клиент перенаправляется обратно в Azure AD, чтобы обновить их. Этот период обновления дает возможность повторно оценивать политики для доступа пользователей. Например, можно отказаться от обновления маркера из-за политики условного доступа или из-за того, что пользователь отключен в каталоге. 

У клиентов есть вопросы о задержке между изменением условий для пользователя, таких как сетевое расположение или кража учетных данных, а также когда политики могут быть принудительно связаны с этим изменением. Мы экспериментируем с подходом "тупыми Object" к уменьшению времени существования маркеров, но обнаружили, что они могут снизить удобство работы и надежность пользователей, не устраняя риски.

Для своевременного реагирования на нарушения политик или проблемы безопасности действительно требуется "разговор" между издателем маркера, например Azure AD, и проверяющей стороной, например Exchange Online. Эта двусторонняя беседа дает нам две важные возможности. Проверяющая сторона может заметить, что изменились, например, клиент, поступающий из нового расположения, и сообщить поставщику маркера. Он также дает поставщику маркера возможность сообщить проверяющей стороне о необходимости прекратить соблюдение маркеров для данного пользователя из-за компрометации учетной записи, невозможности или других проблем. Механизм для этого диалога — это оценка непрерывного доступа (автоматизированного конструирования). Цель состоит в том, чтобы реагировать практически в реальном времени, но в некоторых случаях может наблюдаться задержка до 15 минут из-за времени распространения событий.

Первоначальная реализация оценки непрерывного доступа сосредоточена на Exchange, командах и SharePoint Online.

Сведения о подготовке приложений для использования автоматизированного конструирования см. [в статье Использование интерфейсов API с поддержкой оценки непрерывного доступа в приложениях](../develop/app-resilience-continuous-access-evaluation.md).

### <a name="key-benefits"></a>Основные преимущества

- Завершение работы пользователя или изменение или сброс пароля. отзыв сеанса пользователя будет применяться практически в реальном времени.
- Изменение расположения в сети. политики расположения условного доступа будут принудительно применены практически в реальном времени.
- Экспорт токенов на компьютер за пределами доверенной сети может быть предотвращен политиками расположения условного доступа.

## <a name="scenarios"></a>Сценарии 

Существует два сценария, которые составляют оценку непрерывного доступа, критическое вычисление событий и оценку политики условного доступа.

### <a name="critical-event-evaluation"></a>Оценка критических событий

Оценка непрерывного доступа реализуется путем включения служб, таких как Exchange Online, SharePoint Online и групп, для подписки на критические события в Azure AD, чтобы эти события можно было оценивать и применять в режиме реального времени. Оценка критических событий не зависит от политик условного доступа, которые доступны в любом клиенте. В настоящее время оцениваются следующие события:

- Учетная запись пользователя удалена или отключена
- Пароль для пользователя изменен или сброшен
- Для пользователя включена многофакторная идентификация
- Администратор явно отменяет все маркеры обновления для пользователя
- Высокая риск для пользователей, обнаруженный защита идентификации Azure AD

Этот процесс позволяет использовать сценарий, при котором пользователи теряют доступ к файлам, электронной почте, календарю или задачам Организации, а также командам из Microsoft 365 клиентских приложений в минутах после одного из этих критических событий. 

> [!NOTE] 
> Команды пока не поддерживают события рисков пользователей.

### <a name="conditional-access-policy-evaluation-preview"></a>Оценка политики условного доступа (Предварительная версия)

Exchange и SharePoint могут синхронизировать ключевые политики условного доступа, чтобы их можно было оценивать в самой службе.

Этот процесс включает ситуацию, когда пользователи теряют доступ к файлам Организации, электронной почте, календарю или задачам из Microsoft 365 клиентских приложений или SharePoint Online сразу после изменения сетевого расположения.

> [!NOTE]
> Поддерживаются не все сочетания приложений и поставщиков ресурсов. См. таблицу ниже. Office относится к Word, Excel и PowerPoint.

| | Outlook Web | Win32 для Outlook | Outlook iOS | Outlook для Android | Mac-адрес Outlook |
| :--- | :---: | :---: | :---: | :---: | :---: |
| **SharePoint Online** | Поддерживается | Поддерживается | Поддерживается | Поддерживается | Поддерживается |
| **Exchange Online** | Поддерживается | Поддерживается | Поддерживается | Поддерживается | Поддерживается |

| | Office Web Apps | Приложения Office Win32 | Office для iOS | Office для Android | Office для Mac |
| :--- | :---: | :---: | :---: | :---: | :---: |
| **SharePoint Online** | Не поддерживается | Поддерживается | Поддерживается | Поддерживается | Поддерживается |
| **Exchange Online** | Не поддерживается | Поддерживается | Поддерживается | Поддерживается | Поддерживается |

| | Веб-узел OneDrive | Win32 в OneDrive | OneDrive для iOS | OneDrive для Android | Mac-адрес OneDrive |
| :--- | :---: | :---: | :---: | :---: | :---: |
| **SharePoint Online** | Поддерживается | Поддерживается | Поддерживается | Поддерживается | Поддерживается |

### <a name="client-side-claim-challenge"></a>Запрос на утверждение на стороне клиента

Перед оценкой непрерывного доступа клиенты всегда пытаются воспроизвести маркер доступа из своего кэша, если срок его действия не истек. В автоматизированного конструирования мы представляем новый случай, когда поставщик ресурсов может отклонить маркер, даже если срок его действия не истек. Чтобы уведомить клиентов о необходимости обхода кэша, несмотря на то, что срок действия кэшированных токенов не истек, мы представили механизм, именуемый **запросом на утверждение** , чтобы указать, что маркер был отклонен, и в Azure AD должен быть выдан новый маркер доступа. АВТОМАТИЗИРОВАННОГО конструирования требует обновления клиента, чтобы разобраться в запросах на утверждение. Последняя версия следующих приложений ниже поддерживает запрос на утверждение.

| | Интернет | Win32 | iOS | Android | Mac |
| :--- | :---: | :---: | :---: | :---: | :---: |
| **Outlook** | Поддерживается | Поддерживается | Поддерживается | Поддерживается | Поддерживается |
| **Teams** | Поддерживается | Поддерживается | Поддерживается | Поддерживается | Поддерживается |
| **Office** | Не поддерживается | Поддерживается | Поддерживается | Поддерживается | Поддерживается |
| **OneDrive** | Поддерживается | Поддерживается | Поддерживается | Поддерживается | Поддерживается |

### <a name="token-lifetime"></a>Время существования маркера

Так как риск и политика оцениваются в режиме реального времени, клиенты, которые согласовывают сеансы с непрерывным доступом для оценки, будут полагаться на автоматизированного конструирования, а не на существующие статические политики времени жизни маркера доступа. Это означает, что настраиваемая политика времени существования маркеров больше не будет учитываться для клиентов с поддержкой автоматизированного конструирования, которые согласовывают сеансы с

Время существования маркера увеличивается до длительного времени (до 28 часов) в автоматизированного конструирования сеансах. Отзыв управляется критически важными событиями и оценкой политики, а не только произвольным периодом времени. Это изменение повышает стабильность приложений, не влияя на безопасность. 

Если вы не используете клиенты с поддержкой автоматизированного конструирования, срок жизни маркера доступа по умолчанию остается 1 часу, если вы не настроили время существования маркера доступа с помощью функции предварительной версии [срока действия маркера (CTL)](../develop/active-directory-configurable-token-lifetimes.md) .

## <a name="example-flows"></a>Примеры потоков

### <a name="user-revocation-event-flow"></a>Поток событий отзыва пользователя:

![Поток событий отзыва пользователя](./media/concept-continuous-access-evaluation/user-revocation-event-flow.png)

1. Клиент с поддержкой автоматизированного конструирования предоставляет учетные данные или маркер обновления для Azure AD с запросом маркера доступа для некоторого ресурса.
1. Маркер доступа возвращается вместе с другими артефактами клиенту.
1. Администратор явным образом [отменяет все маркеры обновления для пользователя](/powershell/module/azuread/revoke-azureaduserallrefreshtoken). Событие отзыва будет отправлено поставщику ресурсов из Azure AD.
1. Маркер доступа предоставляется поставщику ресурсов. Поставщик ресурсов оценивает допустимость маркера и проверяет наличие какого-либо события отзыва для пользователя. Поставщик ресурсов использует эти сведения для принятия решения о предоставлении доступа к ресурсу.
1. В этом случае поставщик ресурсов запрещает доступ и отправляет клиенту запрос на утверждение 401 +.
1. Клиент, поддерживающий автоматизированного конструирования, понимает запрос 401 +. Он обходит кэши и снова переходит к шагу 1, отправляя его маркер обновления вместе с запросом заявки обратно в Azure AD. Затем Azure AD переопределит все условия и предложит пользователю выполнить повторную проверку подлинности в этом случае.

### <a name="user-condition-change-flow-preview"></a>Поток изменения условия пользователя (Предварительная версия):

В следующем примере администратор условного доступа настроил политику условного доступа на основе расположения, чтобы разрешить доступ только из конкретных диапазонов IP-адресов:

![Поток событий условия пользователя](./media/concept-continuous-access-evaluation/user-condition-change-flow.png)

1. Клиент с поддержкой автоматизированного конструирования предоставляет учетные данные или маркер обновления для Azure AD с запросом маркера доступа для некоторого ресурса.
1. Azure AD оценивает все политики условного доступа, чтобы определить, соответствуют ли пользователи и клиенты условиям.
1. Маркер доступа возвращается вместе с другими артефактами клиенту.
1. Пользователь перемещается из допустимого диапазона IP-адресов
1. Клиент предоставляет маркер доступа к поставщику ресурсов за пределами допустимого диапазона IP-адресов.
1. Поставщик ресурсов оценивает допустимость маркера и проверяет политику расположения, синхронизированную из Azure AD.
1. В этом случае поставщик ресурсов отказывает в доступе и отправляет клиенту запрос на утверждение 401 +, так как он не поступает из допустимого диапазона IP-адресов.
1. Клиент, поддерживающий автоматизированного конструирования, понимает запрос 401 +. Он обходит кэши и снова переходит к шагу 1, отправляя его маркер обновления вместе с запросом заявки обратно в Azure AD. Azure AD производит повторное вычисление всех условий и запрещает доступ в этом случае.

## <a name="enable-or-disable-cae-preview"></a>Включение и отключение автоматизированного конструирования (Предварительная версия)

1. Войдите в **портал Azure** в качестве администратора условного доступа, администратора безопасности или глобального администратора.
1. Перейдите к **Azure Active Directory**  >    >  **оценке непрерывного доступа к** системе безопасности.
1. Выберите **включить предварительный просмотр**.

На этой странице можно дополнительно ограничить количество пользователей и групп, которые будут подвергаться предварительной версии.

![Включение предварительной версии автоматизированного конструирования в портал Azure](./media/concept-continuous-access-evaluation/enable-cae-preview.png)

## <a name="troubleshooting"></a>Устранение неполадок

### <a name="supported-location-policies"></a>Поддерживаемые политики расположения

Для автоматизированного конструирования мы получаем аналитические сведения только по именованным расположениям, основанным на IP. У нас нет сведений о других параметрах расположения, таких как [Надежные IP-адреса MFA](../authentication/howto-mfa-mfasettings.md#trusted-ips) или расположения на основе стран. Когда пользователь поступает из доверенного IP-адреса MFA или надежных расположений, включающих доверенные IP MFA или расположение страны, автоматизированного конструирования не будет принудительно применен после перемещения пользователя в другое место. В таких случаях будет выдаваться автоматизированного конструирования маркер, не требующий немедленной проверки IP-адресов.

> [!IMPORTANT]
> При настройке расположений для оценки непрерывного доступа используйте только [условие расположения условного доступа на основе IP-](../conditional-access/location-condition.md#preview-features) адресов и настройте все IP-адреса, **включая IPv4 и IPv6**, которые могут видеть поставщик удостоверений и поставщик ресурсов. Не используйте условия расположения страны или функции надежных IP-адресов, доступные на странице параметров службы многофакторной идентификации Azure AD.

### <a name="ip-address-configuration"></a>Настройка IP-адресов

Поставщик удостоверений и поставщики ресурсов могут видеть разные IP-адреса. Это несоответствие может произойти из-за реализации сетевых прокси-серверов в вашей организации или неверной конфигурации IPv4/IPv6 между поставщиком удостоверений и поставщиком ресурсов. Пример:

- Поставщик удостоверений видит один IP-адрес от клиента.
- Поставщик ресурсов видит другой IP-адрес от клиента после передачи через прокси-сервер.
- IP-адрес, отображаемый поставщиком удостоверений, является частью допустимого диапазона IP-адресов в политике, но IP-адрес от поставщика ресурсов — нет.

Если этот сценарий существует в вашей среде во избежание бесконечного циклов, Azure AD выдаст один час автоматизированного конструирования маркер и не будет натребовать изменения расположения клиента. Даже в этом случае безопасность повышается по сравнению с традиционными одноразовыми маркерами, так как мы все еще оцениваем [другие события](#critical-event-evaluation) , помимо событий изменения расположения клиента.

### <a name="office-and-web-account-manager-settings"></a>Параметры диспетчера учетных записей Office и Web

| Канал обновления Office | дисаблеадалатопвамоверриде | дисаблеаадвам |
| --- | --- | --- |
| Semi-Annual Enterprise Channel | Если задано значение Enabled или 1, автоматизированного конструирования не поддерживается. | Если задано значение Enabled или 1, автоматизированного конструирования не поддерживается. |
| Current Channel <br> или <br> Monthly Channel (корпоративный) | АВТОМАТИЗИРОВАННОГО конструирования поддерживается независимо от параметра | АВТОМАТИЗИРОВАННОГО конструирования поддерживается независимо от параметра |

Описание каналов обновления Office см. в [статье Обзор каналов обновления для Microsoft 365 приложений](/deployoffice/overview-update-channels). Не рекомендуется, чтобы организации не отключили Диспетчер учетных записей Web (WAM).

### <a name="policy-change-timing"></a>Время изменения политики

Изменения политик, внесенные администраторами, могут быть эффективными в течение одного дня. Для уменьшения задержки до двух часов была выполнена оптимизация. Однако он еще не охватывает все сценарии. 

Если у вас есть неотложная работа и вам необходимо немедленно применить обновленные политики к определенным пользователям, следует использовать эту [команду PowerShell](/powershell/module/azuread/revoke-azureaduserallrefreshtoken?view=azureadps-2.0) или "отозвать сеанс" на странице профиля пользователя, чтобы отозвать сеанс пользователя, что обеспечит немедленное применение обновленных политик.

### <a name="coauthoring-in-office-apps"></a>Совместное создание приложений Office

Когда несколько пользователей одновременно совместно работают над одним и тем же документом, доступ пользователя к документу может не быть немедленно отменен автоматизированного конструирования на основе отзыва пользователя или событий изменения политики. В этом случае пользователь теряет доступ полностью после, закрывает документ, закрывает Word, Excel или PowerPoint или через некоторое время 10 часов.

Чтобы сократить это время, администратор SharePoint может дополнительно уменьшить максимальное время существования сеансов совместной разработки для документов, хранящихся в SharePoint Online и OneDrive для бизнеса, [настроив политику сетевого расположения в SharePoint Online](/sharepoint/control-access-based-on-network-location). После изменения этой конфигурации максимальное время существования сеансов совместной разработки будет сокращено до 15 минут и может быть изменено с помощью команды PowerShell SharePoint Online "Set-SPOTenant – Ипаддрессвактокенлифетиме".

### <a name="enable-after-a-user-is-disabled"></a>Включить после отключения пользователя

Если вы включили права пользователя после отключения. Для включения учетной записи будет определена задержка. SPO и команды будут иметь 15-минутную задержку. Задержка составляет 35-40 минут для ЕКСО.

## <a name="faqs"></a>Часто задаваемые вопросы

### <a name="how-will-cae-work-with-sign-in-frequency"></a>Как будет автоматизированного конструирования работать с частотой входа?

Частота входа будет соблюдаться с автоматизированного конструирования или без них.

## <a name="next-steps"></a>Следующие шаги

[Объявление о непрерывном доступе](https://techcommunity.microsoft.com/t5/azure-active-directory-identity/moving-towards-real-time-policy-and-security-enforcement/ba-p/1276933)
