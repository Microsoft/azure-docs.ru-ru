---
title: Состояние подготовки приложений в карантине | Документация Майкрософт
description: Когда вы настроили приложение для автоматической подготовки пользователей, Узнайте, что такое состояние подготовки карантина, и как его очистить.
services: active-directory
author: kenwith
manager: celestedg
ms.service: active-directory
ms.subservice: app-provisioning
ms.workload: identity
ms.topic: troubleshooting
ms.date: 09/24/2020
ms.author: kenwith
ms.reviewer: arvinh
ms.openlocfilehash: aa0df4e18e89ecf366da0ddf79e5241bca99bcc1
ms.sourcegitcommit: 67b44a02af0c8d615b35ec5e57a29d21419d7668
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/06/2021
ms.locfileid: "97915272"
---
# <a name="application-provisioning-in-quarantine-status"></a>Подготовка приложений в карантинном состоянии

Служба подготовки Azure AD отслеживает работоспособность вашей конфигурации. Он также помещает неработоспособные приложения в состояние "карантина". Если большинство или все вызовы, выполненные для целевой системы, постоянно завершаются сбоем, задание подготовки помечается как помещенное в карантин. Пример сбоя — это ошибка, полученная из-за недопустимых учетных данных администратора.

В карантине:
- Частота добавочных циклов постепенно сокращается до одного раза в день.
- Задание подготовки удаляется из карантина после устранения всех ошибок и начала следующего цикла синхронизации. 
- Если задание подготовки остается в карантине более четырех недель, задание подготовки отключается (остановка выполняется).

## <a name="how-do-i-know-if-my-application-is-in-quarantine"></a>Разделы справки понять, находится ли мое приложение в карантине?

Существует три способа проверить, находится ли приложение в карантине:
  
- В портал Azure перейдите к **Azure Active Directory**  >  **корпоративные приложения**  >  &lt; *Подготовка имени приложения* &gt;  >   и просмотрите индикатор выполнения для сообщения карантина.   

  ![Строка состояния подготовки, показывающая состояние карантина](./media/application-provisioning-quarantine-status/progress-bar-quarantined.png)

- В портал Azure перейдите к **Azure Active Directory**  >  **аудита журналы** > фильтр по **действию: карантин** и просмотрите историю карантина. В представлении на индикаторе выполнения, как описано выше, показано, находится ли подготовка в карантине. В журналах аудита отображается журнал карантина для приложения. 

- Используйте Microsoft Graph запрос [Get синчронизатионжоб](/graph/api/synchronization-synchronizationjob-get?tabs=http&view=graph-rest-beta&preserve-view=true) , чтобы программно получить состояние задания подготовки:

```microsoft-graph
        GET https://graph.microsoft.com/beta/servicePrincipals/{id}/synchronization/jobs/{jobId}/
```

- Проверьте электронную почту. Когда приложение помещается в карантин, отправляется одноразовое уведомление по электронной почте. При изменении причины карантина отправляется обновленное сообщение электронной почты с новой причиной помещения в карантин. Если вы не видите сообщение электронной почты, сделайте следующее:

  - Убедитесь, что в конфигурации подготовки для приложения указан допустимый **адрес электронной почты для уведомлений** .
  - Убедитесь, что в папке "Входящие" электронной почты для уведомлений отсутствует фильтрация нежелательной почты.
  - Убедитесь, что вы не отменили подписывание сообщений электронной почты.
  - Проверять сообщения электронной почты от `azure-noreply@microsoft.com`

## <a name="why-is-my-application-in-quarantine"></a>Почему мое приложение находится в карантине?

|Описание|Рекомендуемое действие|
|---|---|
|**Проблемы с соответствием scim:** Возвращен ответ HTTP/404 не найден, а не ожидаемый ответ HTTP/200 OK. В этом случае служба подготовки Azure AD выполнила запрос к целевому приложению и получил непредвиденный ответ.|Проверьте раздел учетные данные администратора. Проверьте, требуется ли для приложения указание URL-адреса клиента и правильность URL-адреса. Если вы не видите проблемы, обратитесь к разработчику приложения, чтобы убедиться, что его служба соответствует SCIM. https://tools.ietf.org/html/rfc7644#section-3.4.2 |
|**Недопустимые учетные данные:** При попытке авторизовать доступ к целевому приложению мы получили ответ от целевого приложения, который указывает, что указанные учетные данные недопустимы.|Перейдите к разделу учетные данные администратора в пользовательском интерфейсе конфигурации подготовки и снова Авторизуйте доступ с действительными учетными данными. Если приложение находится в коллекции, ознакомьтесь с руководством по настройке приложения, чтобы выполнить необходимые действия.|
|**Дублирование ролей:** Роли, импортированные из некоторых приложений, таких как Salesforce и Zendesk, должны быть уникальными. |Перейдите к [манифесту](../develop/reference-app-manifest.md) приложения в портал Azure и удалите повторяющуюся роль.|

 Запрос Microsoft Graph для получения состояния задания подготовки показывает следующую причину для карантина:
- `EncounteredQuarantineException` Указывает, что были предоставлены недопустимые учетные данные. Службе подготовки не удается установить соединение между исходной системой и целевой системой.
- `EncounteredEscrowProportionThreshold` Указывает, что подготовка превысила пороговое значение. Это состояние возникает при сбое более 40% событий подготовки. Дополнительные сведения см. в разделе сведения о депонировании пороговых значений ниже.
- `QuarantineOnDemand` означает, что мы обнаружили проблемы с приложением и вручную настроили его в карантин.

**Депонированные пороговые значения**

Если соблюдено пропорциональное пороговое значение, задание подготовки перейдет в карантин. Эта логика может быть изменена, но работает примерно так, как описано ниже. 

Задание может переключиться в карантин независимо от количества сбоев для таких проблем, как учетные данные администратора или соответствие SCIM. Однако в общем случае ошибки 5 000 являются минимальными, чтобы начать оценку необходимости помещения в карантин из-за слишком большого количества сбоев. Например, задание с 4 000 сбоями не будет отправлено в карантин. Однако задание с 5 000 сбоями вызовет оценку. Для оценки используются следующие критерии.  
- Если более 40% событий подготовки завершаются сбоем или более 40 000 сбоев, задание подготовки перейдет в карантин. Ошибки ссылок не учитываются как часть порогового значения 40% или 40 000. Например, сбой обновления руководителя или члена группы является ошибкой ссылки.
- Задание, в котором 45 000 пользователей не удалось подготовить, привело к появлению карантина, так как оно превышает пороговое значение 40 000.
- Задание, в котором 30 000 пользователей, не прошедших подготовку и 5 000, привело к появлению карантина, так как оно превышает порог 40% и минимум 5 000.
- Задание с ошибками 20 000 и 100 000 успешно перейдет в карантин, так как оно не превысит пороговое значение сбоя 40% или не превышает максимально возможный сбой 40 000.  
- Существует абсолютное пороговое значение 60 000 сбоев, при котором учетные записи и ссылки не ссылаются на ошибки. Например, не удалось подготовить пользователей 40 000 и обновить диспетчер 21 000. Общий объем составляет 61 000 ошибок и превышает ограничение 60 000.


## <a name="how-do-i-get-my-application-out-of-quarantine"></a>Разделы справки получить мое приложение из карантина?

Сначала устраните проблему, которая привела к помещению приложения в карантин.

- Проверьте параметры подготовки приложения, чтобы убедиться, что [введены действительные учетные данные администратора](../app-provisioning/configure-automatic-user-provisioning-portal.md#configuring-automatic-user-account-provisioning). Azure AD должен установить отношение доверия с целевым приложением. Убедитесь, что введены допустимые учетные данные, а учетная запись имеет необходимые разрешения.

- Просмотрите [журналы подготовки](../reports-monitoring/concept-provisioning-logs.md) , чтобы исследовать ошибки, приводящие к возникновению ошибок в карантине, и устраните ошибку. Перейдите в  &gt;  &gt; раздел **действия** Azure Active Directory **журналы подготовки корпоративных приложений (Предварительная версия)** .

После устранения проблемы перезапустите задание подготовки. Некоторые изменения параметров подготовки приложения, такие как сопоставление атрибутов или фильтры области, автоматически перезапускают подготовку. В индикаторе выполнения на странице **подготовки** приложения отображается время последнего запуска подготовки. Если необходимо вручную перезапустить задание подготовки, используйте один из следующих методов.  

- Используйте портал Azure, чтобы перезапустить задание подготовки. На странице **Подготовка** приложения в разделе **Параметры** выберите **очистить состояние и перезапустить синхронизацию** и задайте для параметра **состояние подготовки** значение **вкл**. Это действие полностью перезапускает службу подготовки, которая может занять некоторое время. Будет снова выполнен полный начальный цикл, который очищает депонирование, удаляет приложение из карантина и очищает все водяные знаки.

- Используйте Microsoft Graph, чтобы [перезапустить задание подготовки](/graph/api/synchronization-synchronizationjob-restart?tabs=http&view=graph-rest-beta&preserve-view=true). Вы получите полный контроль над перезапусками. Вы можете снять флажки (чтобы перезапустить счетчик депонирования, который начисляется в сторону состояния карантина), Очистить карантин (чтобы удалить приложение из карантина) или снять пределы. Используйте следующий запрос:
 
```microsoft-graph
        POST /servicePrincipals/{id}/synchronization/jobs/{jobId}/restart
```

Замените "{ID}" значением идентификатора приложения и замените "{jobId}" [идентификатором задания синхронизации](/graph/api/resources/synchronization-configure-with-directory-extension-attributes?tabs=http&view=graph-rest-beta&preserve-view=true#list-synchronization-jobs-in-the-context-of-the-service-principal).
