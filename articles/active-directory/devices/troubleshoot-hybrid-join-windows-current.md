---
title: Устранение неполадок на устройствах с гибридным присоединением к Azure Active Directory
description: Устранение неполадок на устройствах под управлением Windows 10 и Windows Server 2016 с гибридным присоединением к Azure Active Directory .
services: active-directory
ms.service: active-directory
ms.subservice: devices
ms.topic: troubleshooting
ms.date: 11/21/2019
ms.author: joflore
author: MicrosoftGuyJFlo
manager: daveba
ms.reviewer: jairoc
ms.collection: M365-identity-device-management
ms.custom: has-adal-ref
ms.openlocfilehash: 1eb4194354a07d5b580f07cfe5962785a4e100bd
ms.sourcegitcommit: 772eb9c6684dd4864e0ba507945a83e48b8c16f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "104578028"
---
# <a name="troubleshooting-hybrid-azure-active-directory-joined-devices"></a>Устранение неполадок на устройствах с гибридным присоединением к Azure Active Directory

Содержимое этой статьи применимо к устройствам под Windows 10 или Windows Server 2016.

Сведения о других клиентах Windows см. в статье [Устранение неполадок гибридных Azure Active Directory Соединенных с устройствами нижнего уровня](troubleshoot-hybrid-join-windows-legacy.md).

В этой статье предполагается, что вы [настроили гибридное присоединение устройств к Azure Active Directory](hybrid-azuread-join-plan.md) для поддержки следующих сценариев:

- Условный доступ на основе информации об устройстве
- [Корпоративное перемещение параметров](./enterprise-state-roaming-overview.md)
- [Windows Hello для бизнеса](/windows/security/identity-protection/hello-for-business/hello-identity-verification)

В этом документе содержатся рекомендации по устранению потенциальных проблем.

Для Windows 10 и Windows Server 2016 гибридное присоединение к Azure Active Directory поддерживает обновление Windows 10 от ноября 2015 г.

## <a name="troubleshoot-join-failures"></a>Устранение ошибок при присоединении

### <a name="step-1-retrieve-the-join-status"></a>Шаг 1. Получение сведений о состоянии присоединения

**Для получения сведений о состоянии присоединения выполните следующие действия:**

1. Откройте командную строку от имени администратора.
2. Введите `dsregcmd /status`

```
+----------------------------------------------------------------------+
| Device State                                                         |
+----------------------------------------------------------------------+

    AzureAdJoined: YES
 EnterpriseJoined: NO
         DeviceId: 5820fbe9-60c8-43b0-bb11-44aee233e4e7
       Thumbprint: B753A6679CE720451921302CA873794D94C6204A
   KeyContainerId: bae6a60b-1d2f-4d2a-a298-33385f6d05e9
      KeyProvider: Microsoft Platform Crypto Provider
     TpmProtected: YES
     KeySignTest: : MUST Run elevated to test.
              Idp: login.windows.net
         TenantId: 72b988bf-xxxx-xxxx-xxxx-2d7cd011xxxx
       TenantName: Contoso
      AuthCodeUrl: https://login.microsoftonline.com/msitsupp.microsoft.com/oauth2/authorize
   AccessTokenUrl: https://login.microsoftonline.com/msitsupp.microsoft.com/oauth2/token
           MdmUrl: https://enrollment.manage-beta.microsoft.com/EnrollmentServer/Discovery.svc
        MdmTouUrl: https://portal.manage-beta.microsoft.com/TermsOfUse.aspx
  dmComplianceUrl: https://portal.manage-beta.microsoft.com/?portalAction=Compliance
      SettingsUrl: eyJVcmlzIjpbImh0dHBzOi8va2FpbGFuaS5vbmUubWljcm9zb2Z0LmNvbS8iLCJodHRwczovL2thaWxhbmkxLm9uZS5taWNyb3NvZnQuY29tLyJdfQ==
   JoinSrvVersion: 1.0
       JoinSrvUrl: https://enterpriseregistration.windows.net/EnrollmentServer/device/
        JoinSrvId: urn:ms-drs:enterpriseregistration.windows.net
    KeySrvVersion: 1.0
        KeySrvUrl: https://enterpriseregistration.windows.net/EnrollmentServer/key/
         KeySrvId: urn:ms-drs:enterpriseregistration.windows.net
     DomainJoined: YES
       DomainName: CONTOSO

+----------------------------------------------------------------------+
| User State                                                           |
+----------------------------------------------------------------------+

             NgcSet: YES
           NgcKeyId: {C7A9AEDC-780E-4FDA-B200-1AE15561A46B}
    WorkplaceJoined: NO
      WamDefaultSet: YES
WamDefaultAuthority: organizations
       WamDefaultId: https://login.microsoft.com
     WamDefaultGUID: {B16898C6-A148-4967-9171-64D755DA8520} (AzureAd)
         AzureAdPrt: YES
```

### <a name="step-2-evaluate-the-join-status"></a>Шаг 2. Анализ состояния присоединения

Просмотрите следующие поля и убедитесь, что для них заданы ожидаемые значения.

#### <a name="domainjoined--yes"></a>DomainJoined: YES

Это поле показывает, присоединено ли устройство к локальному каталогу Active Directory или нет. Если отображается значение **NO**, то устройство не может выполнить гибридное присоединение к Azure AD.

#### <a name="workplacejoined--no"></a>WorkplaceJoined: NO

Это поле показывает, зарегистрировано ли устройство в Azure AD в качестве личного устройства (с пометкой *Присоединено к рабочей области*). Этот параметр должен иметь значение **NO** для присоединенных к домену компьютеров, на которых также настроено гибридное присоединение к Azure AD. Если этот параметр имеет значение **YES**, то рабочая или учебная учетная запись была добавлена до завершения гибридного присоединения к Azure AD. В этом случае учетная запись игнорируется при использовании Windows 10 версии 1607 или более поздней.

#### <a name="azureadjoined--yes"></a>AzureAdJoined: YES

Это поле указывает, присоединено ли устройство. Если устройство является либо присоединенным к Azure AD, либо гибридным устройством, присоединенным к Azure AD, будет указано значение **Да** .
Если отображается значение **NO**, то присоединение к Azure AD еще не завершено.

Перейдите к дальнейшим действиям для дальнейшего устранения неполадок.

### <a name="step-3-find-the-phase-in-which-join-failed-and-the-errorcode"></a>Шаг 3. Поиск этапа, в котором произошел сбой соединения, и код ошибки

#### <a name="windows-10-1803-and-above"></a>Windows 10 1803 и более поздние версии

Подраздел "Предыдущая регистрация" находится в разделе "диагностические данные" в выходных данных состояния объединения. Этот раздел отображается только в том случае, если устройство присоединено к домену и не может выполнить гибридное присоединение к Azure AD.
Поле "фаза ошибки" обозначает фазу сбоя соединения, когда "код ошибки клиента" обозначает код ошибки операции соединения.

```
+----------------------------------------------------------------------+
     Previous Registration : 2019-01-31 09:16:43.000 UTC
         Registration Type : sync
               Error Phase : join
          Client ErrorCode : 0x801c03f2
          Server ErrorCode : DirectoryError
            Server Message : The device object by the given id (e92325d0-xxxx-xxxx-xxxx-94ae875d5245) is not found.
              Https Status : 400
                Request Id : 6bff0bd9-820b-484b-ab20-2a4f7b76c58e
+----------------------------------------------------------------------+
```

#### <a name="older-windows-10-versions"></a>Более старые версии Windows 10

Используйте журналы Просмотр событий, чтобы указать этап и код ошибки для ошибок соединения.

1. Откройте журналы событий **регистрации пользователей и устройств** в средстве просмотра событий. Находится в папке **Applications and Services журнал**  >    >    >  **регистрации пользователей и устройств** Microsoft Windows
2. Найдите события со следующими идентификаторами eventID 304, 305, 307.

:::image type="content" source="./media/troubleshoot-hybrid-join-windows-current/1.png" alt-text="Снимок экрана средства просмотра событий. Выделено событие с I D 304, и отображаются сведения о нем с выделенным кодом ошибки и стадией." border="false":::

:::image type="content" source="./media/troubleshoot-hybrid-join-windows-current/2.png" alt-text="Снимок экрана средства просмотра событий. Отображается событие с I D 305, и отображается его информация с выделенным кодом ошибки." border="false":::

### <a name="step-4-check-for-possible-causes-and-resolutions-from-the-lists-below"></a>Шаг 4. Проверьте возможные причины и способы их устранения в списках ниже.

#### <a name="pre-check-phase"></a>Этап предварительной проверки

Возможные причины сбоя:

- Устройство не имеет линии анализа контроллера домена.
   - Устройство должно находиться в внутренней сети организации или в VPN с сетевым представлением локального контроллера домена Active Directory (AD).

#### <a name="discover-phase"></a>Фаза обнаружения

Возможные причины сбоя:

- Объект точки подключения службы (SCP) неправильно настроен или не может прочитать объект SCP из контроллера домена.
   - В лесу AD требуется допустимый объект SCP, к которому принадлежит устройство, которое указывает на проверенное доменное имя в Azure AD.
   - Подробные сведения можно найти в разделе [Настройка точки подключения службы](hybrid-azuread-join-federated-domains.md#configure-hybrid-azure-ad-join).
- Не удалось подключиться и получить метаданные обнаружения из конечной точки обнаружения.
   - Устройство должно иметь доступ к `https://enterpriseregistration.windows.net` , в контексте системы, для обнаружения конечных точек регистрации и авторизации.
   - Если в локальной среде требуется исходящий прокси-сервер, администратор должен убедиться, что учетная запись компьютера устройства может обнаруживать и автоматически проходить проверку подлинности для исходящего прокси-сервера.
- Не удалось подключиться к конечной точке пользователя и выполнить обнаружение области. (Только Windows 10 версии 1809 и более поздние)
   - Устройство должно иметь доступ к `https://login.microsoftonline.com` контексту системы, чтобы выполнить обнаружение области для проверенного домена и определить тип домена (управляемый/федеративный).
   - Если в локальной среде требуется исходящий прокси-сервер, он должен гарантировать, что контекст системы на устройстве сможет обнаружить и автоматически пройти проверку подлинности для исходящего прокси-сервера.

**Распространенные коды ошибок:**

- **DSREG_AUTOJOIN_ADCONFIG_READ_FAILED** (0x801c001d/-2145648611)
   - Причина: не удалось прочитать объект SCP и получить сведения о клиенте Azure AD.
   - Решение. см. раздел [Настройка точки подключения службы](hybrid-azuread-join-federated-domains.md#configure-hybrid-azure-ad-join).
- **DSREG_AUTOJOIN_DISC_FAILED** (0x801c0021/-2145648607)
   - Причина: сбой общего обнаружения. Не удалось получить метаданные обнаружения из DRS.
   - Решение. Найдите подошибку ниже для дальнейшего изучения.
- **DSREG_AUTOJOIN_DISC_WAIT_TIMEOUT**  (0x801c001f/-2145648609)
   - Причина: истекло время ожидания операции при выполнении обнаружения.
   - Решение. Убедитесь, что `https://enterpriseregistration.windows.net` оно доступно в контексте системы. Дополнительные сведения см. в разделе [требования к сетевым подключениям](hybrid-azuread-join-managed-domains.md#prerequisites).
- **DSREG_AUTOJOIN_USERREALM_DISCOVERY_FAILED** (0x801c0021/-2145648611)
   - Причина: ошибка обнаружения универсальной области. Не удалось определить тип домена (управляемый или федеративный) от службы STS.
   - Решение. Найдите подошибку ниже для дальнейшего изучения.

**Общие коды ошибок:**

Чтобы найти код подошибки для кода ошибки обнаружения, используйте один из следующих методов.

##### <a name="windows-10-1803-and-above"></a>Windows 10 1803 и более поздние версии

Найдите "DRS Discovery Test" в разделе "диагностические данные" в выходных данных состояния объединения. Этот раздел отображается только в том случае, если устройство присоединено к домену и не может выполнить гибридное присоединение к Azure AD.

```
+----------------------------------------------------------------------+
| Diagnostic Data                                                      |
+----------------------------------------------------------------------+

     Diagnostics Reference : www.microsoft.com/aadjerrors
              User Context : UN-ELEVATED User
               Client Time : 2019-06-05 08:25:29.000 UTC
      AD Connectivity Test : PASS
     AD Configuration Test : PASS
        DRS Discovery Test : FAIL [0x801c0021/0x80072ee2]
     DRS Connectivity Test : SKIPPED
    Token acquisition Test : SKIPPED
     Fallback to Sync-Join : ENABLED

+----------------------------------------------------------------------+
```

##### <a name="older-windows-10-versions"></a>Более старые версии Windows 10

Используйте журналы Просмотр событий, чтобы указать этап и код ошибки для ошибок соединения.

1. Откройте журналы событий **регистрации пользователей и устройств** в средстве просмотра событий. Находится в папке **Applications and Services журнал**  >    >    >  **регистрации пользователей и устройств** Microsoft Windows
2. Ищите события со следующими идентификаторами событий (eventID) 201

:::image type="content" source="./media/troubleshoot-hybrid-join-windows-current/5.png" alt-text="Снимок экрана средства просмотра событий. Выбрано событие с I D 201, и отображается его информация, а также выделен код ошибки." border="false":::

###### <a name="network-errors"></a>Ошибки сети.

- **WININET_E_CANNOT_CONNECT** (0x80072EFD/-2147012867)
   - Причина: не удалось установить подключение к серверу
   - Решение. Обеспечьте сетевое подключение к необходимым ресурсам Майкрософт. Дополнительные сведения см. в статье [требования к сетевому подключению](hybrid-azuread-join-managed-domains.md#prerequisites).
- **WININET_E_TIMEOUT** (0x80072ee2/-2147012894)
   - Причина: Общая длительность ожидания сети.
   - Решение. Обеспечьте сетевое подключение к необходимым ресурсам Майкрософт. Дополнительные сведения см. в статье [требования к сетевому подключению](hybrid-azuread-join-managed-domains.md#prerequisites).
- **WININET_E_DECODING_FAILED** (0х80072f8f/-2147012721)
   - Причина: сетевому стеку не удалось декодировать ответ сервера.
   - Решение. Убедитесь, что сетевой прокси не мешает и не изменяет ответ сервера.

###### <a name="http-errors"></a>Ошибки HTTP

- **DSREG_DISCOVERY_TENANT_NOT_FOUND** (0x801c003a/-2145648582)
   - Причина: объект SCP настроен с неправильным ИДЕНТИФИКАТОРом клиента. Или в клиенте не найдены активные подписки.
   - Решение. Убедитесь, что для объекта SCP настроен правильный идентификатор клиента Azure AD и активные подписки или он есть в клиенте.
- **DSREG_SERVER_BUSY** (0x801c0025/-2145648603)
   - Причина: HTTP 503 с сервера DRS.
   - Решение. сервер сейчас недоступен. будущие попытки присоединиться к серверу, скорее всего, будут выполнены снова.

###### <a name="other-errors"></a>Другие ошибки

- **E_INVALIDDATA** (0x8007000d/-2147024883)
   - Причина: не удалось выполнить синтаксический анализ JSON ответа сервера. Вероятно, из-за возврата прокси-сервера HTTP 200 на страницу проверки подлинности HTML.
   - Решение. Если в локальной среде требуется исходящий прокси-сервер, он должен гарантировать, что контекст системы на устройстве сможет обнаружить и автоматически пройти проверку подлинности для исходящего прокси-сервера.

#### <a name="authentication-phase"></a>Этап проверки подлинности

Применяется только для федеративных учетных записей домена.

Причины сбоя:

- Не удалось автоматически получить маркер доступа для ресурса DRS.
   - Устройства Windows 10 получают токен авторизации из службы федерации, используя встроенную проверку подлинности Windows для активной конечной точки WS-Trust. Сведения: [конфигурация служба федерации](hybrid-azuread-join-manual.md#set-up-issuance-of-claims)

**Распространенные коды ошибок:**

Используйте журналы Просмотр событий, чтобы узнать код ошибки, код ошибки, код ошибки сервера и сообщение об ошибке сервера.

1. Откройте журналы событий **регистрации пользователей и устройств** в средстве просмотра событий. Находится в папке **Applications and Services журнал**  >    >    >  **регистрации пользователей и устройств** Microsoft Windows
2. Найдите события со следующим кодом eventID 305.

:::image type="content" source="./media/troubleshoot-hybrid-join-windows-current/3.png" alt-text="Снимок экрана средства просмотра событий. Отображается событие с I D 305. Отобразится его информация с выделенными кодами ошибок D A L и состоянием." border="false":::

##### <a name="configuration-errors"></a>Ошибки конфигурации

- **ERROR_ADAL_PROTOCOL_NOT_SUPPORTED** (0xcaa90017/-894894057)
   - Причина: протокол проверки подлинности не является WS-Trust.
   - Решение. локальный поставщик удостоверений должен поддерживать WS-Trust
- **ERROR_ADAL_FAILED_TO_PARSE_XML** (0xcaa9002c/-894894036)
   - Причина: локальная служба федерации не вернула XML-ответ.
   - Решение. Убедитесь, что конечная точка обмена метаданными возвращает допустимый XML-код. Убедитесь, что прокси-сервер не мешает и не возвращает ответы, отличные от XML.
- **ERROR_ADAL_COULDNOT_DISCOVER_USERNAME_PASSWORD_ENDPOINT** (0xcaa90023/-894894045)
   - Причина: не удалось обнаружить конечную точку для проверки подлинности имени пользователя и пароля.
   - Решение. Проверьте параметры локального поставщика удостоверений. Убедитесь, что WS-Trust конечные точки включены и что ответ обмена метаданными содержит эти правильные конечные точки.

##### <a name="network-errors"></a>Ошибки сети.

- **ERROR_ADAL_INTERNET_TIMEOUT** (0xcaa82ee2/-894947614)
   - Причина: Общая длительность ожидания сети.
   - Решение. Убедитесь, что `https://login.microsoftonline.com` оно доступно в контексте системы. Убедитесь, что локальный поставщик удостоверений доступен в СИСТЕМном контексте. Дополнительные сведения см. в статье [требования к сетевому подключению](hybrid-azuread-join-managed-domains.md#prerequisites).
- **ERROR_ADAL_INTERNET_CONNECTION_ABORTED** (0xcaa82efe/-894947586)
   - Причина: подключение к конечной точке проверки подлинности прервано.
   - Решение. Повторите попытку через некоторое время или попробуйте присоединиться к альтернативному стабильному сетевому расположению.
- **ERROR_ADAL_INTERNET_SECURE_FAILURE** (0xcaa82f8f/-894947441)
   - Причина: безопасность транспортного уровня (TLS), ранее известная как SSL (SSL), не может быть проверена на сервере.
   - Решение. Проверьте отклонение времени клиента. Повторите попытку через некоторое время или попробуйте присоединиться к альтернативному стабильному сетевому расположению.
- **ERROR_ADAL_INTERNET_CANNOT_CONNECT** (0xcaa82efd/-894947587)
   - Причина: попытка подключения `https://login.microsoftonline.com` не удалась.
   - Решение. Проверьте сетевое подключение к `https://login.microsoftonline.com` .

##### <a name="other-errors"></a>Другие ошибки

- **ERROR_ADAL_SERVER_ERROR_INVALID_GRANT** (0xcaa20003/-895352829)
   - Причина: токен SAML от локального поставщика удостоверений не был принят Azure AD.
   - Решение. Проверьте параметры сервера федерации. Найдите код ошибки сервера в журналах проверки подлинности.
- **ERROR_ADAL_WSTRUST_REQUEST_SECURITYTOKEN_FAILED** (0xcaa90014/-894894060)
   - Причина: ответ сервера WS-Trust сообщил об ошибке сбоя, и ему не удалось получить утверждение
   - Решение. Проверьте параметры сервера федерации. Найдите код ошибки сервера в журналах проверки подлинности.
- **ERROR_ADAL_WSTRUST_TOKEN_REQUEST_FAIL** (0xcaa90006/-894894074)
   - Причина: при попытке получить маркер доступа из конечной точки токена получена ошибка.
   - Решение. Найдите основную ошибку в журнале ADAL.
- **ERROR_ADAL_OPERATION_PENDING** (0xcaa1002d/-895418323)
   - Причина: Общая ошибка ADAL
   - Решение. Найдите код ошибки или код ошибки сервера из журналов проверки подлинности.

#### <a name="join-phase"></a>Фаза присоединения

Причины сбоя:

Найдите тип регистрации и найдите код ошибки из приведенного ниже списка.

#### <a name="windows-10-1803-and-above"></a>Windows 10 1803 и более поздние версии

Подраздел "Предыдущая регистрация" находится в разделе "диагностические данные" в выходных данных состояния объединения. Этот раздел отображается только в том случае, если устройство присоединено к домену и не может выполнить гибридное присоединение к Azure AD.
Поле "тип регистрации" обозначает тип выполненного объединения.

```
+----------------------------------------------------------------------+
     Previous Registration : 2019-01-31 09:16:43.000 UTC
         Registration Type : sync
               Error Phase : join
          Client ErrorCode : 0x801c03f2
          Server ErrorCode : DirectoryError
            Server Message : The device object by the given id (e92325d0-7ac4-4714-88a1-94ae875d5245) is not found.
              Https Status : 400
                Request Id : 6bff0bd9-820b-484b-ab20-2a4f7b76c58e
+----------------------------------------------------------------------+
```

#### <a name="older-windows-10-versions"></a>Более старые версии Windows 10

Используйте журналы Просмотр событий, чтобы указать этап и код ошибки для ошибок соединения.

1. Откройте журналы событий **регистрации пользователей и устройств** в средстве просмотра событий. Находится в папке **Applications and Services журнал**  >    >    >  **регистрации пользователей и устройств** Microsoft Windows
2. Ищите события со следующими идентификаторами событий (eventID) 204

:::image type="content" source="./media/troubleshoot-hybrid-join-windows-current/4.png" alt-text="Снимок экрана средства просмотра событий. Отображается информация о событии с I D 204 с кодом ошибки, состоянием H T T и выделенным сообщением." border="false":::

##### <a name="http-errors-returned-from-drs-server"></a>Ошибки HTTP, возвращенные с сервера DRS

- **DSREG_E_DIRECTORY_FAILURE** (0x801c03f2/-2145647630)
   - Причина: получен ответ об ошибке от DRS с ErrorCode: "счетчику регистраций"
   - Решение. Возможные причины и способы их устранения см. в коде ошибки сервера.
- **DSREG_E_DEVICE_AUTHENTICATION_ERROR** (0x801c0002/-2145648638)
   - Причина: получен ответ об ошибке от DRS с ErrorCode: "Аусентикатионеррор", а Еррорсубкоде — не "Девиценотфаунд".
   - Решение. Возможные причины и способы их устранения см. в коде ошибки сервера.
- **DSREG_E_DEVICE_INTERNALSERVICE_ERROR** (0x801c0006/-2145648634)
   - Причина: получен ответ об ошибке от DRS с ErrorCode: "счетчику регистраций"
   - Решение. Возможные причины и способы их устранения см. в коде ошибки сервера.

##### <a name="tpm-errors"></a>Ошибки TPM

- **NTE_BAD_KEYSET** (0x80090016/-2146893802)
   - Причина: операция TPM завершилась сбоем или недопустима
   - Решение. вероятно, это вызвано неправильным образом Sysprep. Убедитесь, что компьютер, с которого был создан образ Sysprep, не присоединен к Azure AD, присоединению гибридной службы Azure AD или зарегистрированному Azure AD.
- **TPM_E_PCP_INTERNAL_ERROR** (0x80290407/-2144795641)
   - Причина: Общая ошибка доверенного платформенного модуля.
   - Решение. Отключите доверенный платформенный модуль на устройствах с этой ошибкой. Windows 10 версии 1809 и выше автоматически обнаруживает сбои доверенного платформенного модуля и выполняет гибридное присоединение к Azure AD без использования доверенного платформенного модуля.
- **TPM_E_NOTFIPS** (0x80280036/-2144862154)
   - Причина: в настоящее время доверенный платформенный модуль в режиме FIPS не поддерживается.
   - Решение. Отключите доверенный платформенный модуль на устройствах с этой ошибкой. Windows 1809 автоматически обнаруживает сбои доверенного платформенного модуля и выполняет гибридное присоединение к Azure AD без использования доверенного платформенного модуля.
- **NTE_AUTHENTICATION_IGNORED** (0x80090031/-2146893775)
   - Причина: TPM заблокирован.
   - Решение. Временная ошибка. Дождитесь периода cooldown. Попытки присоединиться через некоторое время. Дополнительные сведения можно найти в статье [основы TPM](/windows/security/information-protection/tpm/tpm-fundamentals#anti-hammering)

##### <a name="network-errors"></a>Ошибки сети

- **WININET_E_TIMEOUT** (0x80072ee2/-2147012894)
   - Причина: общее время ожидания в сети при попытке регистрации устройства по адресу DRS
   - Решение. Проверьте сетевое подключение к `https://enterpriseregistration.windows.net` .
- **WININET_E_NAME_NOT_RESOLVED** (0x80072EE7/-2147012889)
   - Причина: не удалось разрешить имя или адрес сервера.
   - Решение. Проверьте сетевое подключение к `https://enterpriseregistration.windows.net` . Убедитесь, что разрешение DNS для имени узла является точным в отношении устройства чтения/записи и на устройстве.
- **WININET_E_CONNECTION_ABORTED** (0x80072EFE/-2147012866)
   - Причина: подключение к серверу было аварийно завершено.
   - Решение. Повторите попытку через некоторое время или попробуйте присоединиться к альтернативному стабильному сетевому расположению.

##### <a name="federated-join-server-errors"></a>Ошибки федеративных присоединение к серверу

| Код ошибки сервера | Сообщение об ошибке сервера | Возможные причины | Решение |
| --- | --- | --- | --- |
| Счетчику регистраций | Ваш запрос временно регулируется. Повторите попытку через 300 секунд. | Ожидаемая ошибка. Возможно, из-за выполнения нескольких запросов на регистрацию в ходе быстрой успешной операции. | Повторить попытку Join после cooldown периода |

##### <a name="sync-join-server-errors"></a>Ошибки синхронизации присоединение к серверу

| Код ошибки сервера | Сообщение об ошибке сервера | Возможные причины | Решение |
| --- | --- | --- | --- |
| Счетчику регистраций | AADSTS90002: клиент <UUID> не найден. Эта ошибка может возникать, если для клиента нет активных подписок. Обратитесь к администратору подписки. | Недопустимый идентификатор клиента в объекте SCP | Убедитесь, что объект SCP настроен с правильным ИДЕНТИФИКАТОРом клиента Azure AD и активными подписками и содержится в клиенте. |
| Счетчику регистраций | Объект устройства с указанным ИДЕНТИФИКАТОРом не найден. | Ожидаемая ошибка при синхронизации соединений. Объект устройства не синхронизирован из AD в Azure AD | Дождитесь завершения синхронизации Azure AD Connect и следующей попытки объединения после завершения синхронизации, устраните проблему. |
| аусентикатионеррор | Проверка идентификатора безопасности целевого компьютера | Сертификат на устройстве Azure AD не соответствует сертификату, используемому для подписи большого двоичного объекта во время подключения синхронизации. Обычно эта ошибка означает, что синхронизация еще не завершена. |  Дождитесь завершения синхронизации Azure AD Connect и следующей попытки объединения после завершения синхронизации, устраните проблему. |

### <a name="step-5-collect-logs-and-contact-microsoft-support"></a>Шаг 5. получение журналов и контактных служба поддержки Майкрософт

Скачайте файл Auth.zip из [https://github.com/CSS-Identity/DRS/tree/main/Auth](https://github.com/CSS-Identity/DRS/tree/main/Auth)

1. Распакуйте файлы и переименуйте добавленные файлы **start-auth.txt** и **stop-auth.txt** в **старт-АУС. cmd** и **стоп-АУС. cmd**.
1. В командной строке с повышенными привилегиями запустите **старт-АУС. cmd**.
1. Используйте параметр Учетная запись для переключения на другой сеанс с проблемным пользователем.
1. Воспроизведите проблему.
1. Используйте параметр Учетная запись для переключения обратно в сеанс администрирования, выполняющий трассировку.
1. В командной строке с повышенными привилегиями запустите **стоп-АУС. cmd**.
1. ZIP и отправьте папку **ауслогс** из папки, из которой выполнялись сценарии.

## <a name="troubleshoot-post-join-issues"></a>Устранение проблем после объединения

### <a name="retrieve-the-join-status"></a>Получение сведений о состоянии присоединения

#### <a name="wamdefaultset-yes-and-azureadprt-yes"></a>Вамдефаултсет: YES и Азуреадпрт: YES

Эти поля показывают, прошел ли пользователь аутентификацию в Azure AD при входе в устройство.
Если эти параметры имеют значение **NO**, то причины могут быть следующими:

- Неверный ключ хранилища в доверенном платформенном модуле, связанном с устройством при регистрации (проверьте Кэйсигнтест при запуске с повышенными правами).
- Наличие альтернативного имени пользователя.
- Прокси-сервер HTTP не найден.

## <a name="known-issues"></a>Известные проблемы
- В разделе "Параметры" — "учетные записи > — > доступ или учебное заведение, гибридные устройства, присоединенные к Azure AD, могут показывать две разные учетные записи: одну для Azure AD и одну для локальной службы AD при подключении к мобильным хот-спотам или внешним сетям Wi-Fi. Это лишь проблема пользовательского интерфейса, которая не влияет на функциональность.

## <a name="next-steps"></a>Дальнейшие действия

Продолжение [устранения неполадок устройств с помощью команды dsregcmd](troubleshoot-device-dsregcmd.md)

Ответы на вопросы можно найти в статье [Azure Active Directory device management FAQ](faq.md) (Часто задаваемые вопросы по управлению устройствами Azure Active Directory).
