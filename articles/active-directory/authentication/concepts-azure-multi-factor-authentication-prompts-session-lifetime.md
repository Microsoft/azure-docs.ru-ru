---
title: Запросы многофакторной идентификации Azure AD и время существования сеанса
description: Сведения о рекомендуемой конфигурации для запросов повторной проверки подлинности с помощью многофакторной идентификации Azure AD и времени существования сеанса.
services: multi-factor-authentication
ms.service: active-directory
ms.subservice: authentication
ms.topic: conceptual
ms.date: 08/31/2020
ms.author: justinha
author: justinha
manager: daveba
ms.reviewer: inbarc
ms.collection: M365-identity-device-management
ms.openlocfilehash: 8789015c239aae58ec25f0f644d4c497da477c2b
ms.sourcegitcommit: 6d6030de2d776f3d5fb89f68aaead148c05837e2
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/05/2021
ms.locfileid: "97881248"
---
# <a name="optimize-reauthentication-prompts-and-understand-session-lifetime-for-azure-ad-multi-factor-authentication"></a>Оптимизация запросов на повторное аутентификацию и изучение времени жизни сеанса для многофакторной идентификации Azure AD

Azure Active Directory (Azure AD) имеет несколько параметров, определяющих частоту повторной проверки подлинности пользователей. При такой повторной проверке подлинности может использоваться первый фактор, например password, FIDO или без Microsoft Authenticator пароля, или для выполнения многофакторной проверки подлинности (MFA). Эти параметры повторной проверки подлинности можно настроить по мере необходимости для вашей среды и взаимодействия с пользователем.

Конфигурация по умолчанию Azure AD для частоты входа пользователя — это период в 90 дней. Запрос на ввод учетных данных часто имеет такое разумное действие, но может баккфире. Если пользователи обучены для ввода учетных данных без необходимости думать, они могут случайно предоставить их вредоносным запросам учетных данных.

Может показаться, что пользователь не просит пользователя войти в систему, несмотря на то что нарушение политик ИТ отменяет сеанс. Некоторые примеры включают изменение пароля, несоответствующее устройство или операцию отключения учетной записи. Вы также можете явно [отозвать сеансы пользователей с помощью PowerShell](/powershell/module/azuread/revoke-azureaduserallrefreshtoken).

В этой статье описаны рекомендуемые конфигурации и принципы работы различных параметров и взаимодействия друг с другом.

## <a name="recommended-settings"></a>Рекомендуемые параметры

Чтобы предоставить пользователям правильный баланс безопасности и простоту использования, попросите их войти с правильной частотой, мы рекомендуем использовать следующие конфигурации:

* Если у вас Azure AD Premium:
    * Включение единого входа (SSO) между приложениями с помощью [управляемых устройств](../devices/overview.md) или [простого единого входа](../hybrid/how-to-connect-sso.md).
    * Если требуется перепроверка подлинности, используйте [политику частоты входа](../conditional-access/howto-conditional-access-session-lifetime.md)условного доступа.
    * Для пользователей, которые входят с неуправляемых устройств или сценариев мобильных устройств, используйте условный доступ, чтобы включить постоянные сеансы браузера и политики частоты входа.
* Если у вас есть лицензии на Microsoft 365 приложений или бесплатный уровень Azure AD:
    * Включение единого входа (SSO) между приложениями с помощью [управляемых устройств](../devices/overview.md) или [простого единого входа](../hybrid/how-to-connect-sso.md).
    * Оставьте включенным параметр продолжить *Вход* и попросите пользователей принять его.
* В сценариях с мобильными устройствами убедитесь, что пользователи используют приложение Microsoft Authenticator. Это приложение используется в качестве брокера для других федеративных приложений Azure AD и сокращает запросы проверки подлинности на устройстве.

В нашем исследовании видно, что эти параметры верны для большинства клиентов. Некоторые сочетания этих параметров, такие как *запоминание MFA* и *Сохранение посторонних*, могут привести к появлению запросов на проверку подлинности пользователей слишком часто. Обычные запросы на перепроверку подлинности являются недопустимыми для повышения производительности пользователей и могут сделать их более уязвимыми для атак.

## <a name="azure-ad-session-lifetime-configuration-settings"></a>Параметры конфигурации времени жизни сеанса Azure AD

Чтобы оптимизировать частоту запросов проверки подлинности для пользователей, можно настроить параметры времени существования сеанса Azure AD. Необходимо понимать потребности бизнеса и пользователей, а также настраивать параметры, обеспечивающие оптимальный баланс для вашей среды.

### <a name="evaluate-session-lifetime-policies"></a>Оценка политик времени жизни сеанса

Без параметров времени существования сеанса в сеансе браузера нет постоянных файлов cookie. Каждый раз, когда пользователь закрывает и открывает браузер, он получает запрос на перепроверку подлинности. В клиентах Office период времени по умолчанию — это интервал в 90 дней. Если эта конфигурация настроена по умолчанию, то если пользователь сбрасывает пароль или в течение более 90 дней не выполнялся никаких действий, пользователю необходимо выполнить повторную проверку подлинности с использованием всех необходимых факторов (первый и второй фактор).

Пользователь может видеть несколько запросов MFA на устройстве, которое не имеет удостоверения в Azure AD. Если каждое приложение имеет собственный маркер обновления OAuth, который не используется совместно с другими клиентскими приложениями, появляется несколько запросов. В этом сценарии MFA запрашивается несколько раз, так как каждое приложение запрашивает маркер обновления OAuth для проверки с помощью MFA.

В Azure AD наиболее ограничивающая политика для времени существования сеанса определяет, когда пользователю требуется повторная проверка подлинности. Рассмотрим следующий сценарий.

* Вы включили функцию *Продолжить вход*, которая использует постоянный файл cookie браузера, и
* Вы также включаете функцию " *Запомнить MFA" в течение 14 дней* .

В этом примере сценария пользователю требуется повторная проверка подлинности каждые 14 дней. Это поведение соответствует наиболее политике, несмотря на то, что после *входа* в систему пользователь не потребует от пользователя повторную проверку подлинности в браузере.

### <a name="managed-devices"></a>Управляемые устройства

Устройства, присоединенные к Azure AD с помощью присоединения к Azure AD или гибридного соединения Azure AD, получают [первичные маркеры обновления (PRT)](../devices/concept-primary-refresh-token.md) для использования единого входа (SSO) между приложениями. Эта PRT позволяет пользователю войти на устройство один раз и позволяет ИТ-специалистам обеспечить соблюдение стандартов безопасности и соответствия. Если пользователю необходимо чаще выполнять вход на присоединенном устройстве для некоторых приложений или сценариев, это можно сделать с помощью [частоты входа условного доступа](../conditional-access/howto-conditional-access-session-lifetime.md).

### <a name="show-option-to-remain-signed-in"></a>Отображение параметра для сохранения входа

Когда пользователь выбирает **"Да"** для параметра " *оставаться в системе?* " во время входа, в браузере задается постоянный файл cookie. Этот постоянный файл cookie запоминает как первый, так и второй фактор и применяется только для запросов проверки подлинности в браузере.

![Снимок экрана с примером запроса на сохранение после входа](./media/concepts-azure-multi-factor-authentication-prompts-session-lifetime/stay-signed-in-prompt.png)

Если у вас есть лицензия Azure AD Premium 1, рекомендуется использовать политику условного доступа для *постоянного сеанса браузера*. Эта политика перезаписывает параметры " *оставаться в* системе"? Этот параметр позволяет улучшить взаимодействие с пользователем. Если у вас нет лицензии Azure AD Premium 1, рекомендуется включить параметр остаться в системе для пользователей.

Дополнительные сведения о настройке параметра для того, чтобы разрешить пользователям оставаться в системе, см. в разделе [Настройка страницы входа в Azure AD](../fundamentals/customize-branding.md#customize-your-azure-ad-sign-in-page).

### <a name="remember-multi-factor-authentication"></a>Сохранение данных многофакторной идентификации  

Этот параметр позволяет настроить значения в диапазоне от 1-365 дней и задает постоянный файл cookie в браузере, когда пользователь выбирает параметр **больше не спрашивать в течение X дней** при входе.

![Снимок экрана примера запроса на утверждение запроса на вход](./media/concepts-azure-multi-factor-authentication-prompts-session-lifetime/approve-sign-in-request.png)

Хотя этот параметр сокращает количество проверок подлинности в веб-приложениях, он увеличивает число проверок подлинности для современных клиентов проверки подлинности, например клиентов Office. Обычно эти клиенты запрашивают только после сброса пароля или бездействия в течение 90 дней. Однако при установке этого значения менее 90 дней сокращается число запросов MFA по умолчанию для клиентов Office, а также увеличивается частота проверки подлинности. При использовании в сочетании с параметром **сохранить вход** или политики условного доступа может увеличиться число запросов проверки подлинности.

Если вы используете параметр *Запомнить MFA* и у вас есть лицензии Azure AD Premium 1, рассмотрите возможность переноса этих параметров на частоту входа условного доступа. В противном случае рассмотрите возможность использования команды " *оставаться в системе?* ".

Дополнительные сведения см. в статье [запоминание многофакторной проверки подлинности](howto-mfa-mfasettings.md#remember-multi-factor-authentication).

### <a name="authentication-session-management-with-conditional-access"></a>Управление сеансом проверки подлинности с помощью условного доступа

**Частота входа** позволяет администратору выбрать частоту входа, которая применяется как для первого, так и для второго фактора в клиенте и в браузере. Рекомендуется использовать эти параметры вместе с управляемыми устройствами в сценариях, если требуется ограничить сеанс проверки подлинности, например для критически важных бизнес-приложений.

**Постоянный сеанс браузера** позволяет пользователям оставаться в системе после закрытия и повторного открытия окна браузера. Аналогично параметру " *остаться в* системе", он задает для браузера постоянный файл cookie. Однако, так как она настроена администратором, пользователю не требуется выбирать да в поле **"** *оставаться в системе?* ", что обеспечивает более эффективное взаимодействие с пользователем. Если вы используете параметр *Продолжить вход?* , рекомендуется включить политику **постоянного сеанса браузера** .

Дополнительные сведения см. в записи блога см. раздел [Настройка управления сеансами проверки подлинности с помощью условного доступа](../conditional-access/howto-conditional-access-session-lifetime.md).

### <a name="configurable-token-lifetimes"></a>Настраиваемые времена жизни маркеров

Этот параметр позволяет настроить время существования маркера, выданного Azure Active Directory. Эта политика заменяется *управлением сеансами проверки подлинности с условным доступом*. Если сейчас вы используете *Настраиваемые сроки существования маркеров* , рекомендуем начать миграцию на политики условного доступа.

## <a name="review-your-tenant-configuration"></a>Проверка конфигурации клиента  

Теперь, когда вы понимаете, как работают различные параметры и рекомендуемая конфигурация, настало время проверить конфигурацию клиентов и внести соответствующие изменения.

Чтобы настроить или проверить параметр " *остаться в* системе", выполните следующие действия.

1. На портале Azure AD найдите и выберите *Azure Active Directory*.
1. Выберите **Корпоративная фирменная символика**, а затем для каждого языкового стандарта выберите **параметр Показывать, чтобы остаться в** системе.
1. Выберите *Да*, а затем нажмите кнопку **сохранить**.

Чтобы запомнить параметры многофакторной проверки подлинности на доверенных устройствах, выполните следующие действия.

1. На портале Azure AD найдите и выберите *Azure Active Directory*.
1. Выберите **Безопасность**, а затем **MFA**.
1. В разделе **Настройка** выберите **Дополнительные параметры MFA на основе облака**.
1. На странице *Параметры службы многофакторной проверки подлинности* прокрутите экран, чтобы **Запомнить параметры многофакторной проверки подлинности**. Отключите этот параметр, сняв флажок.

Чтобы настроить политики условного доступа для частоты входа и постоянного сеанса браузера, выполните следующие действия.

1. На портале Azure AD найдите и выберите *Azure Active Directory*.
1. Выберите **Безопасность**, а затем — **Условный доступ**.
1. Настройте политику, используя Рекомендуемые параметры управления сеансами, описанные в этой статье.

Чтобы проверить время существования маркеров, [Используйте Azure AD PowerShell для запроса любых политик Azure AD](../develop/configure-token-lifetimes.md#prerequisites). Отключите все политики, которые есть на месте.

Если в клиенте включено несколько параметров, рекомендуется обновить параметры на основе доступных лицензий. Например, если у вас есть лицензии Azure AD Premium, следует использовать только политику условного доступа " *Частота входа* " и " *постоянный сеанс браузера*". Если у вас есть Microsoft 365 приложений или бесплатных лицензий Azure AD, следует использовать конфигурацию " *Продолжить вход* ".

Если вы включили настраиваемые сроки существования маркеров, эта возможность скоро будет удалена. Планирование миграции на политику условного доступа.

В следующей таблице перечислены рекомендации, основанные на лицензиях.

|              | Приложения Azure AD Free и Microsoft 365 | Azure AD Premium |
|------------------------------|-----------------------------------|------------------|
| **Единый вход**                      | [Присоединение к Azure AD](../devices/concept-azure-ad-join.md) или [гибридное присоединение к Azure AD](../devices/concept-azure-ad-join-hybrid.md)или [простой единый вход](../hybrid/how-to-connect-sso.md) для неуправляемых устройств. | присоединение к Azure AD;<br />гибридное присоединение к Azure AD; |
| **Параметры перепроверки подлинности** | Продолжить вход                  | Использование политик условного доступа для частоты входа и постоянного сеанса браузера |

## <a name="next-steps"></a>Дальнейшие действия

Чтобы приступить к работе, выполните инструкции из руководства по [защите событий входа пользователей с помощью многофакторной идентификации Azure AD](tutorial-enable-azure-mfa.md) или с [помощью обнаружения рисков для входа пользователей в систему для активации многофакторной идентификации Azure AD](tutorial-risk-based-sspr-mfa.md).
