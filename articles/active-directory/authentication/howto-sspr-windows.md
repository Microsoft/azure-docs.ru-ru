---
title: Самостоятельный сброс пароля для устройств Windows — Azure Active Directory
description: Сведения о включении Azure Active Directory самостоятельного сброса пароля на экране входа в Windows.
services: active-directory
ms.service: active-directory
ms.subservice: authentication
ms.topic: how-to
ms.date: 07/17/2020
ms.author: justinha
author: justinha
manager: daveba
ms.reviewer: rhicock
ms.collection: M365-identity-device-management
ms.openlocfilehash: fa2d910c017d3cc626f737bdab50315aef8d1e77
ms.sourcegitcommit: 740698a63c485390ebdd5e58bc41929ec0e4ed2d
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/03/2021
ms.locfileid: "99491391"
---
# <a name="enable-azure-active-directory-self-service-password-reset-at-the-windows-sign-in-screen"></a>Включение Azure Active Directory самостоятельного сброса пароля на экране входа Windows

Самостоятельный сброс пароля (SSPR) дает пользователям в Azure Active Directory (Azure AD) возможность изменить или сбросить пароль без участия администратора или службы поддержки. Как правило, пользователи открывают веб-браузер на другом устройстве для доступа к [порталу SSPR](https://aka.ms/sspr). Чтобы улучшить работу на компьютерах под управлением Windows 7, 8, 8,1 и 10, можно разрешить пользователям сбрасывать пароль на экране входа в Windows.

![Примеры экранов входа в Windows 7 и 10, где отмечена ссылка SSPR](./media/howto-sspr-windows/windows-reset-password.png)

> [!IMPORTANT]
> В этом руководстве описано, как включить SSPR для устройств Windows на предприятии.
>
> Если ваша группа ИТ не включила возможность использовать SSPR на устройстве Windows или возникли проблемы во время входа, обратитесь в службу технической поддержки за дополнительной помощью.

## <a name="general-limitations"></a>Общие ограничения

Следующие ограничения применяются к использованию SSPR на экране входа Windows.

- В настоящее время сброс пароля не поддерживается удаленный рабочий стол или из расширенных сеансов Hyper-V.
- Некоторые сторонние поставщики учетных данных могут вызывать проблемы с этой функцией.
- Известно, что отключение контроля учетных записей путем изменения ключа реестра [EnableLUA](/openspecs/windows_protocols/ms-gpsb/958053ae-5397-4f96-977f-b7700ee461ec) приводит к проблемам с этой функцией.
- Эта функция не работает для сетей с развернутой сетевой аутентификацией 802.1 x и параметром "выполнять непосредственно перед входом пользователя". Для сетей с развернутой сетевой аутентификацией 802.1 x рекомендуется использовать проверку подлинности компьютера, чтобы включить эту функцию.
- Гибридные компьютеры, присоединенные к Azure AD, должны иметь прямую сетевую видимость контроллера домена, чтобы применить новый пароль и обновить кэшированные учетные данные. Это означает, что устройство должно находиться во внутренней сети организации или использовать VPN-подключение с сетевым доступом к контроллеру домена в локальной сети.
- Если используется образ, то перед выполнением sysprep обязательно очистите веб-кэш для встроенной учетной записи администратора и затем выполните шаг CopyProfile. Дополнительные сведения об этом шаге можно найти в статье службы поддержки о [низкой производительности при использовании профилей по умолчанию](https://support.microsoft.com/help/4056823/performance-issue-with-custom-default-user-profile).
- Следующие параметры могут влиять на возможность использования и сброса паролей на устройствах Windows 10:
    - Если для политики в Windows 10 требуется сочетание клавиш Ctrl + Alt + Del, **сбросить пароль** не удастся.
    - Если уведомления на экране блокировки отключены, **сбросить пароль** не удастся.
    - Для *хидефастусерсвитчинг* задано значение Enabled или 1
    - Для *донтдисплайластусернаме* задано значение Enabled или 1
    - Параметру *Onэкрана* присвоено значение Enabled или 1
    - *Енаблелостмоде* установлен на устройстве
    - файл Explorer.exe, замененный на файл пользовательской оболочки.
- Сочетание следующих трех параметров может привести к неработоспособности этой функции.
    - Интерактивный вход: не требовать нажатия CTRL+ALT+DEL = "Отключено"
    - *Дисаблелоккскринаппнотификатионс* = 1 или включено
    - Ценовая категория Windows — любая, кроме Домашняя или Профессиональная.

> [!NOTE]
> Эти ограничения также применяются к сбросу ПИН-кода Windows Hello для бизнеса с экрана блокировки устройства.
>

## <a name="windows-10-password-reset"></a>Сброс пароля в Windows 10

Чтобы настроить устройство Windows 10 для SSPR на экране входа, ознакомьтесь со следующими предварительными требованиями и действиями по настройке.

### <a name="windows-10-prerequisites"></a>Необходимые компоненты для Windows 10

- Администратор [должен включить самостоятельный сброс пароля Azure AD из портал Azure](tutorial-enable-sspr.md).
- Пользователи должны зарегистрироваться для SSPR перед использованием этой функции в [https://aka.ms/ssprsetup](https://aka.ms/ssprsetup)
    - Не является уникальным для использования SSPR на экране входа Windows. все пользователи должны предоставить контактную информацию для проверки подлинности, прежде чем они смогут сбросить пароль.
- Требования к сетевому прокси-серверу:
    - Порт 443 для `passwordreset.microsoftonline.com` и `ajax.aspnetcdn.com`.
    - Устройства Windows 10 поддерживают только конфигурацию прокси-сервера на уровне компьютера.
- Система под управлением Windows 10 с обновлением за апрель 2018 г. (версия 1803) или более поздних версий. Для устройства должно быть выполнено:
    - присоединение к Azure AD;
    - присоединение к Azure AD (гибридные устройства).

### <a name="enable-for-windows-10-using-intune"></a>Подготовка для Windows 10 с помощью Intune

Развертывание изменения конфигурации для включения SSPR с экрана входа в систему с помощью Intune является наиболее гибким методом. Intune позволяет развертывать изменения конфигурации для определенной группы компьютеров. Этот метод требует регистрации устройства в Intune.

#### <a name="create-a-device-configuration-policy-in-intune"></a>Создание политики конфигурации устройства в Intune

1. Войдите в [портал Azure](https://portal.azure.com) и выберите **Intune**.
1. Создайте профиль конфигурации устройства, перейдя в профиль **конфигурации устройства**  >  , а затем выберите **+ создать профиль** .
   - Для **платформы** выберите *Windows 10 и более поздние версии*
   - В качестве **типа профиля** выберите *Пользовательский* .
1. Выберите **создать**, а затем укажите понятное имя для профиля, например *экран входа Windows 10 SSPR*

    При необходимости укажите понятное описание профиля, а затем нажмите кнопку **Далее**.
1. В разделе *Параметры конфигурации* выберите **Добавить** и укажите следующий параметр OMA-URI, чтобы включить ссылку для сброса пароля:
      - Введите понятное имя, чтобы объяснить, что делает параметр, например *Добавить ссылку SSPR*.
      - При необходимости укажите понятное описание параметра.
      - Для параметра **OMA-URI** укажите значение `./Vendor/MSFT/Policy/Config/Authentication/AllowAadPasswordReset`.
      - Для параметра **Тип данных** задайте значение **Целое число**.
      - Для параметра **Значение** установите значение **1**.

    Выберите **Добавить**, а затем **Далее**.
1. Политику можно назначить конкретным пользователям, устройствам или группам. Сначала назначьте профиль для своей среды, в идеале — для тестовой группы устройств, а затем нажмите кнопку **Далее**.

    Дополнительные сведения см. [в разделе Назначение профилей пользователей и устройств в Microsoft Intune](/mem/intune/configuration/device-profile-assign).

1. Настройте правила применимости для вашей среды, например для *назначения профиля, если выпуск ОС — Windows 10 Корпоративная*, а затем нажмите кнопку **Далее**.
1. Проверьте профиль и нажмите кнопку **создать**.

### <a name="enable-for-windows-10-using-the-registry"></a>Подготовка для Windows 10 с помощью реестра

Чтобы включить SSPR на экране входа с помощью раздела реестра, выполните следующие действия.

1. Войдите на компьютер с Windows, используя учетные данные администратора.
1. Нажмите **Windows**  +  **R** , чтобы открыть диалоговое окно " *выполнить* ", а затем запустите **программу Regedit** от имени администратора.
1. Настройте следующий раздел реестра:

    ```cmd
    HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft\AzureADAccount
       "AllowPasswordReset"=dword:00000001
    ```

#### <a name="troubleshooting-windows-10-password-reset"></a>Устранение неполадок при сбросе пароля в Windows 10

Если у вас возникли проблемы с использованием SSPR на экране входа в Windows, журнал аудита Azure AD включает сведения о IP-адресе и *клиенттипе* , где был сброшен пароль, как показано в следующем примере выходных данных:

![Пример события сброса пароля Windows 7 в журнале аудита Azure AD](media/howto-sspr-windows/windows-7-sspr-azure-ad-audit-log.png)

Когда пользователи сбрасывают пароль на экране входа на устройстве с Windows 10, создается временная учетная запись с низким уровнем привилегий с именем `defaultuser1` . Эта учетная запись используется для обеспечения безопасности процесса сброса пароля.

Сама учетная запись имеет случайно созданный пароль, не отображается для входа устройства и автоматически удаляется после сброса пароля пользователем. Может существовать сразу несколько профилей `defaultuser`, но вы можете спокойно их игнорировать.

## <a name="windows-7-8-and-81-password-reset"></a>Сброс паролей в Windows 7, 8 и 8.1

Чтобы настроить устройство Windows 7, 8 или 8,1 для SSPR на экране входа, ознакомьтесь со следующими предварительными требованиями и действиями по настройке.

### <a name="windows-7-8-and-81-prerequisites"></a>Предварительные условия для Windows 7, 8 и 8.1

- Администратор [должен включить самостоятельный сброс пароля Azure AD из портал Azure](tutorial-enable-sspr.md).
- Пользователи должны зарегистрироваться для SSPR перед использованием этой функции в [https://aka.ms/ssprsetup](https://aka.ms/ssprsetup)
    - Не является уникальным для использования SSPR на экране входа Windows. все пользователи должны предоставить контактную информацию для проверки подлинности, прежде чем они смогут сбросить пароль.
- Требования к сетевому прокси-серверу:
    - Порт 443 для `passwordreset.microsoftonline.com`.
- В операционной системе Windows 7 или Windows 8.1 должны быть установлены исправления.
- Должен быть включен протокол TLS 1.2 (см. руководство по [настройке параметров реестра для протокола TLS](/windows-server/security/tls/tls-registry-settings#tls-12)).
- Если на компьютере включен более одного стороннего поставщика учетных данных, на экране входа в систему пользователи видят более одного профиля пользователя.

> [!WARNING]
> Протокол TLS 1.2 должен быть включен, а не просто настроен на автоматический обмен записями.

### <a name="install"></a>Установка

Для Windows 7, 8 и 8,1 на компьютере должен быть установлен небольшой компонент, чтобы включить SSPR на экране входа. Чтобы установить этот компонент SSPR, выполните следующие действия.

1. Скачайте соответствующий установщик для версии Windows, в которой следует включить этот протокол.

    Установщик программного обеспечения доступен в центре загрузки Майкрософт по адресу [https://aka.ms/sspraddin](https://aka.ms/sspraddin)
1. Войдите на компьютер, где следует выполнить установку, и запустите программу установки.
1. После установки настоятельно рекомендуется выполнить перезагрузку.
1. После перезагрузки на экране входа выберите пользователя и нажмите кнопку "Забыли пароль?". чтобы инициировать процесс сброса пароля.
1. Завершите процесс, следуя указаниям на экране для сброса пароля.

![Пример для Windows 7 со ссылкой "Забыли пароль?", Поток SSPR](media/howto-sspr-windows/windows-7-sspr.png)

#### <a name="silent-installation"></a>Автоматическая установка

Компонент SSPR может быть установлен или удален без запросов с помощью следующих команд:

- Для автоматической установки выполните команду "msiexec /i SsprWindowsLogon.PROD.msi /qn".
- Для автоматического удаления выполните команду "msiexec /x SsprWindowsLogon.PROD.msi /qn"

#### <a name="troubleshooting-windows-7-8-and-81-password-reset"></a>Устранение неполадок при сбросе пароля в Windows 7, 8 и 8.1

Если у вас возникли проблемы с использованием SSPR на экране входа в Windows, события регистрируются как на компьютере, так и в Azure AD. События Azure AD включают в себя сведения об IP-адресе и Клиенттипе, где был сброшен пароль, как показано в следующем примере выходных данных:

![Пример события сброса пароля Windows 7 в журнале аудита Azure AD](media/howto-sspr-windows/windows-7-sspr-azure-ad-audit-log.png)

При необходимости для включения подробного ведения журнала можно изменить соответствующий раздел реестра на компьютере. Включите подробное ведение журнала в целях устранения неполадок, используя только следующее значение раздела реестра:

```cmd
HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Authentication\Credential Providers\{86D2F0AC-2171-46CF-9998-4E33B3D7FD4F}
```

- Чтобы включить ведение журнала, создайте `REG_DWORD: "EnableLogging"` и присвойте ему значение 1.
- Чтобы отключить подробное ведение журнала, измените для `REG_DWORD: "EnableLogging"` значение на 0.

## <a name="what-do-users-see"></a>Что видят пользователи?

Какие изменения для пользователя SSPR настроены для устройств Windows? Как они узнают, что можно сбросить пароль на экране входа в систему? На снимках экрана ниже показаны дополнительные параметры сброса пароля пользователем с помощью SSPR:

![Примеры экранов входа в Windows 7 и 10, где отмечена ссылка SSPR](./media/howto-sspr-windows/windows-reset-password.png)

Когда пользователь пытается войти в систему, он увидит ссылку **сбросить** пароль или **забыли пароль** , который открывает средство самостоятельного сброса пароля на экране входа. С помощью этой функции пользователи могут сбросить пароль, не используя другое устройство для получения доступа к браузеру.

Дополнительные сведения для пользователей, использующих эту функцию, можно найти в статьях [Сброс рабочего или учебного пароля](../user-help/active-directory-passwords-update-your-own-password.md) .

## <a name="next-steps"></a>Дальнейшие действия

Чтобы упростить регистрацию пользователей, можно [предварительно заполнить контактную информацию для проверки подлинности пользователя для SSPR](howto-sspr-authenticationdata.md).
