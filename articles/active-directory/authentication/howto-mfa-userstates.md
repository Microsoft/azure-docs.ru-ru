---
title: Включение Многофакторной идентификации для отдельных пользователей в Azure Active Directory
description: Узнайте, как включить многофакторную идентификацию Azure AD для отдельных пользователей, изменив пользовательское состояние
services: multi-factor-authentication
ms.service: active-directory
ms.subservice: authentication
ms.topic: how-to
ms.date: 08/17/2020
ms.author: justinha
author: justinha
manager: daveba
ms.reviewer: michmcla
ms.collection: M365-identity-device-management
ms.custom: devx-track-azurepowershell
ms.openlocfilehash: 749829f641119273813d3c8ca826daf8b4dc4d11
ms.sourcegitcommit: 772eb9c6684dd4864e0ba507945a83e48b8c16f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "96742669"
---
# <a name="enable-per-user-azure-ad-multi-factor-authentication-to-secure-sign-in-events"></a>Включение многофакторной идентификации Azure AD на уровне пользователя для защиты событий входа

Чтобы защитить события входа пользователя в Azure AD, можно потребовать многофакторную проверку подлинности (MFA). Для защиты пользователей рекомендуется включить многофакторную идентификацию Azure AD с помощью политик условного доступа. Условный доступ — это функция Azure AD Premium P1 или P2, которая позволяет применять правила для использования MFA в определенных сценариях. Чтобы приступить к работе с условным доступом, см. раздел [учебник. Защита событий входа пользователя с помощью многофакторной идентификации Azure AD](tutorial-enable-azure-mfa.md).

Для бесплатных клиентов Azure AD без условного доступа можно [использовать параметры безопасности по умолчанию для защиты пользователей](../fundamentals/concept-fundamentals-security-defaults.md). При необходимости пользователям предлагается указать MFA, но нельзя определить собственные правила для управления поведением.

При необходимости можно включить каждую учетную запись для каждой пользовательской многофакторной идентификации Azure AD. Если пользователи включены по отдельности, они выполняют многофакторную проверку подлинности при каждом входе (с некоторыми исключениями, например при входе с доверенных IP-адресов или при включении функции " _Запомнить MFA на доверенных устройствах_ ").

Изменение состояний пользователей не рекомендуется, если лицензии Azure AD не включают условный доступ и вы не хотите использовать параметры безопасности по умолчанию. Дополнительные сведения о различных способах включения MFA см. в статье [функции и лицензии для многофакторной идентификации Azure AD](concept-mfa-licensing.md).

> [!IMPORTANT]
>
> В этой статье подробно описано, как просмотреть и изменить состояние многофакторной идентификации Azure AD для каждого пользователя. При использовании условного доступа или параметров безопасности по умолчанию вы не просматриваете или не включаете учетные записи пользователей, выполнив эти действия.
>
> Включение многофакторной идентификации Azure AD с помощью политики условного доступа не изменяет состояние пользователя. Если пользователи отображаются как отключенные — это не повод для беспокойства. Условный доступ не изменяет состояние.
>
> **Не включайте или не применяйте многофакторную проверку подлинности Azure AD для отдельных пользователей, если используются политики условного доступа.**

## <a name="azure-ad-multi-factor-authentication-user-states"></a>Пользовательские состояния многофакторной идентификации Azure AD

Состояние пользователя показывает, зарегистрирован ли администратор в службе многофакторной идентификации Azure AD на уровне пользователя. Учетные записи пользователей в службе многофакторной идентификации Azure AD имеют следующие три различных состояния:

| Состояние | Описание | Затронутая устаревшая аутентификация | Затронутые приложения, использующие браузер | Затронутая современная аутентификация |
|:---:| --- |:---:|:--:|:--:|
| Выключено | Состояние по умолчанию для пользователя, не зарегистрированного в многофакторной идентификации Azure AD для каждого пользователя. | Нет | Нет | нет |
| Активировано | Пользователь зарегистрирован в многофакторной идентификации Azure AD для каждого пользователя, но по-прежнему может использовать пароль для устаревшей проверки подлинности. Если пользователь еще не зарегистрировал методы проверки подлинности MFA, он получит запрос на регистрацию при следующем входе с использованием современной проверки подлинности (например, через веб-браузер). | Нет. Устаревшая проверка подлинности продолжит работать до завершения процесса регистрации. | Да. После истечения срока действия сеанса требуется регистрация многофакторной идентификации Azure AD.| Да. После истечения срока действия маркера доступа требуется регистрация многофакторной идентификации Azure AD. |
| Принудительно | Пользователь зарегистрирован в многофакторной идентификации Azure AD для каждого пользователя. Если пользователь еще не зарегистрировал методы проверки подлинности, он получит запрос на регистрацию при следующем входе с использованием современной проверки подлинности (например, через веб-браузер). Пользователи, которые завершают регистрацию в *включенном* состоянии, автоматически перемещаются в состояние *принудительно* . | Да. Для приложений нужны пароли приложений. | Да. При входе в систему требуется многофакторная идентификация Azure AD. | Да. При входе в систему требуется многофакторная идентификация Azure AD. |

Все пользователи начинают с состояния *Отключено*. При регистрации пользователей в многофакторной идентификации Azure AD для каждого пользователя их состояние изменяется на *включено*. После включения пользователи входят в систему и завершают регистрацию, затем их состояние меняется на *Enforced* (Принудительно). Администраторы могут перемещать пользователей между состояниями, включая  " *включено* " или " *отключено*".

> [!NOTE]
> Если многопользовательский MFA повторно включен для пользователя и пользователь не регистрирует повторную регистрацию, состояние MFA не переходит от состояния *включено* к *принудительному применению* в ПОЛЬЗОВАТЕЛЬСКОМ интерфейсе управления mfa. Администратор должен напрямую переместить пользователя в *принудительное применение*.

## <a name="view-the-status-for-a-user"></a>Просмотр состояния пользователя

Чтобы просмотреть состояния пользователей и управлять ими, выполните следующие действия для доступа к портал Azure странице:

1. Войдите на [портал Azure](https://portal.azure.com) с использованием учетной записи администратора.
1. Найдите и выберите *Azure Active Directory*, а затем выберите **Пользователи** > **Все пользователи**.
1. Выберите **Многофакторная идентификация**. Возможно, чтобы увидеть этот пункт меню, вам понадобится прокрутить экран вправо. Щелкните приведенный ниже снимок экрана, чтобы просмотреть полный портал Azure окно и расположение меню: [ ![ выберите многофакторная идентификация в окне "Пользователи" в Azure AD.](media/howto-mfa-userstates/selectmfa-cropped.png)](media/howto-mfa-userstates/selectmfa.png#lightbox)
1. Откроется новая страница со сведениями о состоянии пользователя, как показано в следующем примере.
   ![Снимок экрана, показывающий пример сведений о пользовательской информации для многофакторной идентификации Azure AD](./media/howto-mfa-userstates/userstate1.png)

## <a name="change-the-status-for-a-user"></a>Изменение состояния пользователя

Чтобы изменить состояние многофакторной проверки подлинности Azure AD для каждого пользователя, выполните следующие действия.

1. Выполните описанные выше действия, чтобы [Просмотреть состояние пользователя](#view-the-status-for-a-user) , чтобы перейти на страницу **пользователей** Azure AD с многофакторной идентификацией.
1. Найдите пользователя, которого вы хотите включить для многофакторной идентификации Azure AD на уровне пользователя. Возможно, потребуется перейти на представление **Пользователи** в верхней части страницы.
   ![На вкладке "Пользователи" выберите пользователя, состояние которого нужно изменить.](./media/howto-mfa-userstates/enable1.png)
1. Установите флажки рядом с именами пользователей, состояния которых нужно изменить.
1. Справа, в разделе **быстрых действий**, выберите **Включить** или **Отключить**. В следующем примере рядом с именем пользователя *John Smith* установлен флажок, и он включается для использования: ![Включите выбранного пользователя, щелкнув "Включить" в меню быстрых действий](./media/howto-mfa-userstates/user1.png)

   > [!TIP]
   > *Включенные* пользователи автоматически переключаются на *принудительное применение* при регистрации для многофакторной идентификации Azure AD. Не следует вручную изменять пользовательское состояние на *принудительное* , если пользователь еще не зарегистрирован, или если пользователь может столкнуться с перерывами в подключениях к устаревшим протоколам проверки подлинности.

1. Подтвердите свой выбор во всплывающем окне, которое откроется.

После включения уведомите пользователей по электронной почте. Сообщите пользователям о том, что при следующем входе в систему им будет показан запрос на регистрацию. Кроме того, если ваша организация использует небраузерные приложения, не поддерживающие современную аутентификацию, потребуется создать пароли приложений. Дополнительные сведения см. в разделе [Руководство пользователя по многофакторной идентификации Azure AD](../user-help/multi-factor-authentication-end-user-first-time.md) , которое поможет им приступить к работе.

## <a name="change-state-using-powershell"></a>Изменение состояния с помощью PowerShell

Чтобы изменить состояние пользователя с помощью [Azure AD PowerShell](/powershell/azure/), измените параметр `$st.State` для учетной записи пользователя. Существует три возможных состояния учетной записи пользователя:

* *Enabled*
* *Enforced* (Применено);
* *Отключено*  

Как правило, не переносите пользователей непосредственно в состояние " *принудительно* ", если они еще не зарегистрированы для mfa. В этом случае устаревшие приложения проверки подлинности перестают работать, так как пользователь не прошел регистрацию многофакторной проверки подлинности Azure AD и не получил [пароль приложения](howto-mfa-app-passwords.md). В некоторых случаях такое поведение может быть желательным, но влияет на взаимодействие с пользователем, пока пользователь не зарегистрирует.

Чтобы начать работу, установите модуль *MSOnline* с помощью командлета [Install-Module](/powershell/module/powershellget/install-module) следующим образом:

```PowerShell
Install-Module MSOnline
```

Затем подключитесь с помощью командлета [Connect-MsolService](/powershell/module/msonline/connect-msolservice):

```PowerShell
Connect-MsolService
```

В следующем примере сценарий PowerShell включает Многофакторную идентификацию Azure (MFA) для отдельного пользователя с именем *bsimon@contoso.com* :

```PowerShell
$st = New-Object -TypeName Microsoft.Online.Administration.StrongAuthenticationRequirement
$st.RelyingParty = "*"
$st.State = "Enabled"
$sta = @($st)

# Change the following UserPrincipalName to the user you wish to change state
Set-MsolUser -UserPrincipalName bsimon@contoso.com -StrongAuthenticationRequirements $sta
```

PowerShell — удобный инструмент для массового включения многофакторной проверки подлинности для пользователей. Следующий сценарий обрабатывает список пользователей и включает MFA для их учетных записей. Определите учетные записи пользователей, заданные в первой строке для `$users`, следующим образом:

   ```PowerShell
   # Define your list of users to update state in bulk
   $users = "bsimon@contoso.com","jsmith@contoso.com","ljacobson@contoso.com"

   foreach ($user in $users)
   {
       $st = New-Object -TypeName Microsoft.Online.Administration.StrongAuthenticationRequirement
       $st.RelyingParty = "*"
       $st.State = "Enabled"
       $sta = @($st)
       Set-MsolUser -UserPrincipalName $user -StrongAuthenticationRequirements $sta
   }
   ```

Чтобы отключить MFA, код в следующем примере получает пользователя с помощью командлета [Get-MsolUser](/powershell/module/msonline/get-msoluser), а затем удаляет значение параметра *StrongAuthenticationRequirements* для пользователя, заданного с помощью [Set-MsolUser](/powershell/module/msonline/set-msoluser):

```PowerShell
Get-MsolUser -UserPrincipalName bsimon@contoso.com | Set-MsolUser -StrongAuthenticationRequirements @()
```

Можно также напрямую отключить MFA для пользователя с помощью командлета [Set-MsolUser](/powershell/module/msonline/set-msoluser) следующим образом:

```PowerShell
Set-MsolUser -UserPrincipalName bsimon@contoso.com -StrongAuthenticationRequirements @()
```

## <a name="convert-users-from-per-user-mfa-to-conditional-access"></a>Преобразование пользователей из многопользовательского MFA в условный доступ

Приведенный ниже пример PowerShell поможет выполнить преобразование в условный доступ на основе многофакторной идентификации Azure AD.

```PowerShell
# Sets the MFA requirement state
function Set-MfaState {

    [CmdletBinding()]
    param(
        [Parameter(ValueFromPipelineByPropertyName=$True)]
        $ObjectId,
        [Parameter(ValueFromPipelineByPropertyName=$True)]
        $UserPrincipalName,
        [ValidateSet("Disabled","Enabled","Enforced")]
        $State
    )

    Process {
        Write-Verbose ("Setting MFA state for user '{0}' to '{1}'." -f $ObjectId, $State)
        $Requirements = @()
        if ($State -ne "Disabled") {
            $Requirement =
                [Microsoft.Online.Administration.StrongAuthenticationRequirement]::new()
            $Requirement.RelyingParty = "*"
            $Requirement.State = $State
            $Requirements += $Requirement
        }

        Set-MsolUser -ObjectId $ObjectId -UserPrincipalName $UserPrincipalName `
                     -StrongAuthenticationRequirements $Requirements
    }
}

# Disable MFA for all users
Get-MsolUser -All | Set-MfaState -State Disabled
```

> [!NOTE]
> Если MFA повторно включается для пользователя и пользователь не регистрируется повторно, состояние MFA не переходит из состояния *включено* *в пользовательский* интерфейс управления mfa. В этом случае администратор должен напрямую переместить пользователя в *принудительное применение*.

## <a name="next-steps"></a>Дальнейшие действия

Сведения о настройке параметров многофакторной идентификации Azure AD см. в статье  [Настройка параметров многофакторной идентификации Azure AD](howto-mfa-mfasettings.md).

Сведения об управлении параметрами пользователей для многофакторной идентификации Azure AD см. в статье [Управление параметрами пользователей с помощью многофакторной идентификации Azure AD](howto-mfa-userdevicesettings.md).

Сведения о том, почему пользователю было предложено или не предлагается выполнить MFA, см. в разделе [отчеты многофакторной идентификации Azure AD](howto-mfa-reporting.md).
