---
title: Включение проверки подлинности с использованием компонента обратной записи паролей Azure Active Directory
description: Из этого руководства вы узнаете, как в Azure AD включить самостоятельный сброс пароля с обратной записью с помощью Azure AD Connect для синхронизации изменений в локальной среде доменных служб Active Directory.
services: active-directory
ms.service: active-directory
ms.subservice: authentication
ms.topic: tutorial
ms.date: 07/13/2020
ms.author: justinha
author: justinha
ms.reviewer: rhicock
ms.collection: M365-identity-device-management
ms.custom: contperf-fy20q4
ms.openlocfilehash: 444ca19732921b336cae32a9b1eb5755a08e4bd3
ms.sourcegitcommit: 867cb1b7a1f3a1f0b427282c648d411d0ca4f81f
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "97028059"
---
# <a name="tutorial-enable-azure-active-directory-self-service-password-reset-writeback-to-an-on-premises-environment"></a>Руководство по Включение самостоятельного сброса пароля в Azure Active Directory с использованием обратной записи в локальную среду

Используя самостоятельный сброс пароля (SSPR) Azure Active Directory (Azure AD), пользователи могут изменить пароль или разблокировать учетную запись, используя веб-браузер. В гибридной среде, в которой Azure AD подключается к локальной среде доменных служб Active Directory (AD DS), пароли в двух каталогах могут отличаться.

Компонент обратной записи паролей позволяет синхронизировать изменения паролей в Azure AD с локальной средой AD DS. Azure AD Connect предоставляет безопасный механизм отправки изменений паролей из Azure AD в существующий локальный каталог.

> [!IMPORTANT]
> В этом руководстве рассказывается, как администратор может включить самостоятельный сброс пароля в локальной среде. Если вы обычный пользователь, для вас разрешен самостоятельный сброс пароля и вы хотите восстановить доступ к учетной записи, перейдите на страницу https://aka.ms/sspr.
>
> Если ваша группа ИТ пока не включила возможность самостоятельно сбрасывать пароль, обратитесь за помощью в службу поддержки.

В этом руководстве описано следующее:

> [!div class="checklist"]
> * настройка требуемых разрешений для обратной записи паролей;
> * включение обратной записи паролей в Azure AD Connect;
> * включение обратной записи паролей в Azure AD SSPR.

## <a name="prerequisites"></a>Предварительные требования

Для работы с этим учебником требуются следующие ресурсы и разрешения:

* Рабочий клиент Azure AD, для которого включена по меньшей мере лицензия Azure AD Premium P1 или пробная лицензия.
    * [Создайте ее бесплатно](https://azure.microsoft.com/free/?WT.mc_id=A261C142F), если нужно.
    * См. [требования к лицензированию для Azure AD SSPR](concept-sspr-licensing.md).
* Учетная запись с привилегиями *глобального администратора*.
* Azure AD с поддержкой самостоятельного сброса пароля.
    * При необходимости [завершите работу с предыдущим руководством, чтобы включить Azure AD SSPR](tutorial-enable-sspr.md).
* Локальная среда AD DS с поддержкой текущей версии Azure AD Connect.
    * При необходимости настройте Azure AD Connect с помощью [стандартных](../hybrid/how-to-connect-install-express.md) или [пользовательских](../hybrid/how-to-connect-install-custom.md) параметров.
    * Для использования компонента обратной записи паролей контроллеры домена должны управляться Windows Server 2012 или более поздней версии.

## <a name="configure-account-permissions-for-azure-ad-connect"></a>Настройка разрешений учетной записи для Azure AD Connect

Azure AD Connect позволяет синхронизировать пользователей, группы и учетные данные между локальной средой AD DS и Azure AD. Обычно Azure AD Connect устанавливается на компьютере под управлением Windows Server 2012 или более поздней версии, присоединенном к локальному домену AD DS.

Для правильной работы компонента обратной записи паролей SSPR учетной записи, указанной в Azure AD Connect, должны быть назначены соответствующие разрешения и параметры. Если вы не уверены, какая учетная запись сейчас используется, откройте Azure AD Connect и выберите элемент **Просмотр текущей конфигурации**. Учетная запись, для которой необходимо добавить разрешение, указана в разделе **Синхронизированные каталоги**. Для учетной записи необходимо задать следующие разрешения и параметры:

* **Сброс пароля**
* **разрешения на запись** для `lockoutTime`;
* **разрешения на запись** для `pwdLastSet`;
* **расширенные права** для пароля без истекшего срока действия в корневом объекте *каждого домена* в таком лесу (если они еще не заданы).

Если эти разрешения не будут назначены, даже при кажущейся правильной настройке обратной записи паролей пользователи столкнутся с ошибками при попытке управления своими локальными паролями из облака. Чтобы функция "Отмена истечения срока пароля" отображалась, разрешения должны распространятся на **Этот объект и все дочерние объекты**.  

> [!TIP]
>
> Если пароли для некоторых учетных записей пользователей не записываются обратно в локальный каталог, убедитесь, что наследование не отключено для учетной записи в локальной среде AD DS. Чтобы функция работала правильно, разрешения на запись паролей должны быть применены к дочерним объектам.

Чтобы задать соответствующие разрешения для компонента обратной записи паролей, сделайте следующее.

1. В локальной среде AD DS откройте оснастку **Пользователи и компьютеры Active Directory** с учетной записью с правами *администратора соответствующего домена*.
1. В меню **Представление** включите параметр **Расширенные возможности**.
1. На панели слева щелкните правой кнопкой мыши объект, который представляет корень домена, и выберите **Свойства** > **Безопасность** > **Дополнительно**.
1. На вкладке **Разрешения** нажмите кнопку **Добавить**.
1. В качестве **основной** выберите учетную запись, к которой должны применяться разрешения (учетная запись, используемая Azure AD Connect).
1. Из раскрывающегося списка **Применяется к** выберите **Descendent User objects** (Дочерние объекты-пользователи).
1. В разделе *Разрешения* установите флажок для следующего варианта:
    * **Сброс пароля**
1. В разделе *Свойства* установите флажки для следующих параметров. Прокрутите список, чтобы найти эти параметры; они уже могут быть установлены по умолчанию:
    * **Write lockoutTime** (Запись времени блокировки);
    * **Write pwdLastSet** (Запись времени последней установки пароля).

    [ ![Установка соответствующих разрешений для активных пользователей и компьютеров в рамках учетной записи, используемой Azure AD Connect](media/tutorial-enable-sspr-writeback/set-ad-ds-permissions-cropped.png) ](media/tutorial-enable-sspr-writeback/set-ad-ds-permissions.png#lightbox)

1. Когда все будет готово, щелкните **Применить** и "ОК", чтобы применить изменения, а затем закройте все открытые диалоговые окна.

При обновлении разрешений их репликация на всех объектах каталога может занять час или больше.

Политики паролей в локальной среде AD DS могут препятствовать правильной обработке сброса паролей. Чтобы компонент обратной записи паролей работал как можно эффективнее, значение групповой политики для *минимального срока действия пароля* должно быть равно 0. Этот параметр можно найти в разделе **Конфигурация компьютера > Политики > Параметры Windows > Параметры безопасности > Политики учетных записей** в `gpedit.msc`.

При обновлении групповой политики дождитесь завершения репликации обновленной политики или используйте команду `gpupdate /force`.

> [!Note]
> Чтобы пароли изменялись немедленно, нужно установить для компонента обратной записи паролей значение 0. Но если пользователи придерживаются локальных политик и для *минимального срока действия пароля* задано значение больше нуля, компонент обратной записи паролей по-прежнему будет работать после оценки локальных политик.

## <a name="enable-password-writeback-in-azure-ad-connect"></a>Включение обратной записи паролей в Azure AD Connect

Один из параметров конфигурации в Azure AD Connect предназначен для обратной записи паролей. Если этот параметр включен, события изменения пароля приведут к тому, что Azure AD Connect начнет синхронизировать обновленные учетные данные с локальной средой AD DS.

Чтобы включить самостоятельный сброс пароля с использованием обратной записи паролей, сначала включите параметр обратной записи в Azure AD Connect. На сервере Azure AD Connect сделайте следующее:

1. Войдите на сервер Azure AD Connect и запустите мастер настройки **Azure AD Connect**.
1. На странице **Приветствие** нажмите кнопку **Настроить**.
1. Выберите **Настроить параметры синхронизации** на странице **Дополнительные задачи** и нажмите кнопку **Далее**.
1. На странице **Подключение к Azure AD** введите учетные данные глобального администратора для клиента Azure и нажмите кнопку **Далее**.
1. На страницах фильтров **Подключить каталоги** и **Домен или подразделение** нажмите кнопку **Далее**.
1. На странице **Дополнительные компоненты** установите флажок рядом с параметром **Обратная запись паролей** и нажмите кнопку **Далее**.

    ![Настройка Azure AD Connect для обратной записи паролей](media/tutorial-enable-sspr-writeback/enable-password-writeback.png)

1. На странице **Готово к настройке** щелкните **Настроить** и дождитесь завершения процесса.
1. После завершения настройки нажмите кнопку **Выход**.

## <a name="enable-password-writeback-for-sspr"></a>Включение обратной записи паролей для SSPR

Включив обратную запись паролей в Azure AD Connect, настройте в Azure AD SSPR поддержку обратной записи. При включении SSPR для использования обратной записи паролей пользователи, которые меняют или сбрасывают свой пароль, синхронизируют этот пароль с локальной средой AD DS.

Чтобы включить обратную запись паролей в SSPR, сделайте следующее:

1. Войдите на [портал Azure](https://portal.azure.com), используя учетную запись глобального администратора.
1. Найдите и выберите **Azure Active Directory**, а затем щелкните **Сброс пароля** и **Локальная интеграция**.
1. Задайте параметру **Обратная запись паролей в локальный каталог** значение *Да*.
1. Задайте параметру **Разрешить пользователям разблокировать учетные записи без сброса пароля** значение *Да*.

    ![Включение самостоятельного сброса пароля в Azure AD для обратной записи паролей](media/tutorial-enable-sspr-writeback/enable-sspr-writeback.png)

1. Когда все будет готово, щелкните **Сохранить**.

## <a name="clean-up-resources"></a>Очистка ресурсов

Если вы больше не хотите использовать функцию обратной записи SSPR, настроенную с помощью этого руководства, сделайте следующее:

1. Войдите на [портал Azure](https://portal.azure.com).
1. Найдите и выберите **Azure Active Directory**, а затем щелкните **Сброс пароля** и **Локальная интеграция**.
1. Задайте параметру **Обратная запись паролей в локальный каталог** значение *Нет*.
1. Задайте параметру **Разрешить пользователям разблокировать учетные записи без сброса пароля** значение *Нет*.

Если вы больше не хотите использовать возможности работы с паролями, на сервере Azure AD Connect сделайте следующее:

1. Войдите на сервер Azure AD Connect и запустите мастер настройки **Azure AD Connect**.
1. На странице **Приветствие** нажмите кнопку **Настроить**.
1. Выберите **Настроить параметры синхронизации** на странице **Дополнительные задачи** и нажмите кнопку **Далее**.
1. На странице **Подключение к Azure AD** введите учетные данные глобального администратора для клиента Azure и нажмите кнопку **Далее**.
1. На страницах фильтров **Подключить каталоги** и **Домен или подразделение** нажмите кнопку **Далее**.
1. На странице **Дополнительные компоненты** снимите флажок рядом с параметром **Обратная запись паролей** и нажмите кнопку **Далее**.
1. На странице **Готово к настройке** щелкните **Настроить** и дождитесь завершения процесса.
1. После завершения настройки нажмите кнопку **Выход**.

## <a name="next-steps"></a>Дальнейшие действия

Из этого руководства вы узнали, как включить обратную запись Azure AD SSPR в локальную среду AD DS. Вы ознакомились с выполнением следующих задач:

> [!div class="checklist"]
> * настройка требуемых разрешений для обратной записи паролей;
> * включение обратной записи паролей в Azure AD Connect;
> * включение обратной записи паролей в Azure AD SSPR.

> [!div class="nextstepaction"]
> [Tutorial: Use risk events to trigger Multi-Factor Authentication and password changes](tutorial-risk-based-sspr-mfa.md) (Руководство. Использование событий риска для запуска Многофакторной идентификации и изменений пароля)
