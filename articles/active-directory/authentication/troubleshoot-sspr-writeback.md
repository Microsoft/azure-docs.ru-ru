---
title: Устранение неполадок обратной записи при самостоятельном сбросе пароля — Azure Active Directory
description: Узнайте, как устранять распространенные проблемы и способы их устранения для самостоятельной обратной записи паролей в Azure Active Directory
services: active-directory
ms.service: active-directory
ms.subservice: authentication
ms.topic: troubleshooting
ms.date: 08/26/2020
ms.author: justinha
author: justinha
manager: daveba
ms.reviewer: rhicock
ms.collection: M365-identity-device-management
ms.openlocfilehash: 0620304de1866d24719b137836419502cd25bee9
ms.sourcegitcommit: 910a1a38711966cb171050db245fc3b22abc8c5f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "98682243"
---
# <a name="troubleshoot-self-service-password-reset-writeback-in-azure-active-directory"></a>Устранение неполадок самостоятельного сброса пароля в Azure Active Directory

Azure Active Directory (Azure AD) самостоятельный сброс пароля (SSPR) позволяет пользователям сбрасывать пароли в облаке. Обратная запись паролей — это функция на основе [Azure AD Connect](../hybrid/whatis-hybrid-identity.md), позволяющая записывать изменения паролей, внесенные в облаке, в имеющийся локальный каталог в режиме реального времени.

Если у вас возникли проблемы с обратной записью SSPR, могут помочь следующие действия по устранению неполадок и распространенные ошибки. Если вы не можете найти ответ на проблему, [наши группы поддержки всегда доступны](#contact-microsoft-support) для дальнейшей помощи.

## <a name="troubleshoot-connectivity"></a>Устранение неполадок с подключением

Если у вас возникли проблемы с обратной записью паролей для Azure AD Connect, ознакомьтесь со следующими шагами, которые могут помочь устранить проблему. Чтобы восстановить службу, рекомендуется выполнить следующие действия в указанном порядке.

* [Проверка наличия сетевого подключения](#confirm-network-connectivity)
* [Перезапуск службы синхронизации Azure AD Connect](#restart-the-azure-ad-connect-sync-service)
* [Отключение и повторное включение функции обратной записи паролей](#disable-and-re-enable-the-password-writeback-feature)
* [Установка новейшей версии Azure AD Connect](#install-the-latest-azure-ad-connect-release)
* [Устранение неполадок с обратной записью паролей](#common-password-writeback-errors)

### <a name="confirm-network-connectivity"></a>Проверка наличия сетевого подключения

Наиболее распространенная точка отказа заключается в том, что брандмауэр или порты прокси-сервера или время ожидания простоя неправильно настроены.

Для Azure AD Connect версии *1.1.443.0* и выше *исходящий HTTPS* -доступ требуется для следующих адресов:

* *\*. passwordreset.microsoftonline.com*
* *\*. servicebus.windows.net*

[Конечные точки gov](../../azure-government/compare-azure-government-global-azure.md#guidance-for-developers)для Azure:

* *\*. passwordreset.microsoftonline.us*
* *\*. servicebus.usgovcloudapi.net*

Если требуется дополнительная детализация, см. [список диапазонов IP-адресов центра обработки данных Microsoft Azure](https://www.microsoft.com/download/details.aspx?id=41653). Этот список обновляется каждую среду и переходит к следующему понедельнику.

Дополнительные сведения см. в разделе [Предварительные требования к подключению для Azure AD Connect](../hybrid/how-to-connect-install-prerequisites.md).

### <a name="restart-the-azure-ad-connect-sync-service"></a>Перезапуск службы синхронизации Azure AD Connect

Чтобы устранить проблемы с подключением или другие временные проблемы со службой, выполните следующие действия, чтобы перезапустить службу синхронизации Azure AD Connect.

1. В качестве администратора на сервере, на котором выполняется Azure AD Connect, нажмите кнопку **запустить**.
1. Введите *services.msc* в поле поиска и нажмите клавишу **ВВОД**.
1. Найдите запись *Microsoft Azure AD Sync*.
1. Щелкните правой кнопкой мыши запись службы, выберите пункт **перезапустить** и дождитесь завершения операции.

    :::image type="content" source="./media/troubleshoot-sspr-writeback/service-restart.png" alt-text="Перезапуск службы Azure AD Sync с помощью графического пользовательского интерфейса" border="false":::

Эти шаги позволяют повторно установить подключение к Azure AD и устранить проблемы с подключением.

Если перезапуск службы Azure AD Connect Sync не решит проблему, попробуйте отключить и снова включить функцию обратной записи паролей в следующем разделе.

### <a name="disable-and-re-enable-the-password-writeback-feature"></a>Отключение и повторное включение функции обратной записи паролей

Чтобы продолжить устранение неполадок, выполните следующие действия, чтобы отключить и снова включить функцию обратной записи паролей.

1. В качестве администратора на сервере, на котором выполняется Azure AD Connect, откройте **Мастер настройки Azure AD Connect**.
1. В окне **Подключение к Azure AD** введите учетные данные глобального администратора Azure AD.
1. В окне **Подключение к AD DS** введите учетные данные администратора локальных домен Active Directory служб.
1. В окне **Уникальная идентификация пользователей** нажмите кнопку **Далее**.
1. В окне **Дополнительные компоненты** снимите флажок **Обратная запись паролей**.
1. Нажимайте кнопку **Далее** на следующих страницах диалогового окна, ничего не изменяя, пока не перейдете на страницу **Ready to configure page** (Готово к настройке).
1. Убедитесь, что на **странице Готово к настройке** параметр *обратной записи паролей* отображается как *отключенный*. Нажмите зеленую кнопку **настроить** , чтобы зафиксировать изменения.
1. В окне **Завершение** снимите флажок **Синхронизировать сейчас**, а затем нажмите кнопку **Готово**, чтобы закрыть мастер.
1. Снова откройте **Мастер настройки Azure AD Connect**.
1. Повторите шаги 2-8, на этот раз выбрав параметр *обратная запись паролей* на странице **Дополнительные компоненты** , чтобы снова включить службу.

Эти шаги позволяют повторно установить подключение к Azure AD и устранить проблемы с подключением.

Если отключить и повторно включить функцию обратной записи паролей не удается устранить проблему, переустановите Azure AD Connect в следующем разделе.

### <a name="install-the-latest-azure-ad-connect-release"></a>Установка новейшей версии Azure AD Connect

Переустановка Azure AD Connect может устранить проблемы с конфигурацией и подключением между Azure AD и локальной средой служб домен Active Directory. Этот шаг рекомендуется выполнять только после выполнения предыдущих действий для проверки подключения и устранения неполадок.

> [!WARNING]
> Если вы настроили готовые правила синхронизации, *создайте их резервную копию, прежде чем продолжить обновление, а затем вручную повторно разверните их после завершения.*

1. Скачайте последнюю версию Azure AD Connect в [Центре загрузки Майкрософт](https://go.microsoft.com/fwlink/?LinkId=615771).
1. Так как вы уже установили Azure AD Connect, выполните обновление на месте, чтобы обновить установку Azure AD Connect до последней версии.

    Запустите скачанный пакет и следуйте инструкциям на экране, чтобы обновить Azure AD Connect.

Эти действия должны повторно установить подключение к Azure AD и устранить проблемы с подключением.

Если установка последней версии сервера Azure AD Connect не решает проблему, попробуйте отключить и повторно включить обратную запись паролей в качестве последнего шага после установки последнего выпуска.

## <a name="verify-that-azure-ad-connect-has-the-required-permissions"></a>Убедитесь, что Azure AD Connect имеет необходимые разрешения

Azure AD Connect требует разрешения AD DS **Сброс пароля** для выполнения обратной записи паролей. Чтобы проверить, имеет ли Azure AD Connect необходимое разрешение для данной локальной AD DS учетной записи пользователя, используйте функцию **действующих разрешений Windows** .

1. Войдите на сервер Azure AD Connect и запустите **Synchronization Service Manager**, выбрав **Запуск** > **Synchronization Service** (Служба синхронизации).
1. На вкладке **Соединители** выберите локальный соединитель **доменных служб Active Directory**, а затем щелкните **Свойства**.

    :::image type="content" source="./media/troubleshoot-sspr-writeback/synchronization-service-manager.png" alt-text="Synchronization Service Manager, демонстрирующий, как изменить свойства" border="false":::.
  
1. Во всплывающем окне выберите вкладку **Connect to Active Directory Forest** (Подключение к лесу Active Directory) и запишите свойство **Имя пользователя**. Это свойство является учетной записью AD DS, используемой службой Azure AD Connect для выполнения синхронизации каталогов.

    Чтобы Azure AD Connect выполнила обратную запись паролей, учетной записи AD DS нужно иметь разрешение на сброс пароля. Проверьте разрешения для этой учетной записи пользователя, выполнив следующие действия.

    :::image type="content" source="./media/troubleshoot-sspr-writeback/synchronization-service-manager-properties.png" alt-text="Поиск учетной записи пользователя службы синхронизации Active Directory" border="false":::
  
1. Войдите в локальный контроллер домена и запустите приложение **Пользователи и компьютеры Active Directory**.
1. Выберите **Просмотр** и убедитесь, что параметр **Advanced Features** (Дополнительные функции) включен.  

    :::image type="content" source="./media/troubleshoot-sspr-writeback/view-advanced-features.png" alt-text="Демонстрация расширенных возможностей для пользователей и компьютеров Active Directory" border="false":::
  
1. Найдите учетную запись пользователя AD DS, которую требуется проверить. Щелкните учетную запись правой кнопкой мыши и выберите **Свойства**.  
1. Во всплывающем окне перейдите на вкладку **Безопасность** и выберите **Дополнительно**.  
1. Во всплывающем окне **Advanced Security Settings for Administrator** (Дополнительные параметры безопасности для администратора) перейдите на вкладку **Действующие права доступа**.
1. Выберите **выбрать пользователя**, выберите учетную запись AD DS, используемую Azure AD Connect, а затем выберите **Просмотреть эффективный доступ**.

    :::image type="content" source="./media/troubleshoot-sspr-writeback/view-effective-access.png" alt-text="Демонстрация учетной записи синхронизации на вкладке &quot;Действующие права доступа&quot;" border="false":::
  
1. Прокрутите список вниз и найдите **Сброс пароля**. Если возле записи установлен флажок, учетная запись AD DS имеет разрешение на сброс пароля выбранной учетной записи пользователя Active Directory.  

    :::image type="content" source="./media/troubleshoot-sspr-writeback/check-permissions.png" alt-text="Проверка наличия разрешения на сброс пароля для учетной записи синхронизации" border="false":::

## <a name="common-password-writeback-errors"></a>Общие ошибки обратной записи паролей

Следующие более конкретные проблемы могут возникать при обратной записи паролей. Если у вас есть одна из этих ошибок, просмотрите предлагаемое решение и проверьте, правильно ли работает обратная запись паролей.

| Error | Решение |
| --- | --- |
| Служба сброса паролей не запускается локально. Ошибка 6800 отображается в журнале событий приложений Azure AD Connect машины. <br> <br> После подключения федеративные пользователи и пользователи, применяющие сквозную аутентификацию либо синхронизацию хэшей паролей, не могут сбрасывать пароли. | Если включена обратная запись паролей, обработчик синхронизации вызывает библиотеку обратной записи, чтобы выполнить настройку (адаптацию), обратившись к облачной службе адаптации. Все ошибки, обнаруженные во время подключения или при запуске конечной точки Windows Communication Foundation (WCF) для обратной записи паролей, приведут к ошибкам в журнале событий компьютера Azure AD Connect. <br> <br> Если при перезапуске службы Azure AD Sync была настроена обратная запись, запускается конечная точка WCF. Но если при запуске конечной точки происходит сбой, регистрируется событие 6800 и запускается служба синхронизации. Наличие этого события означает, что конечная точка обратной записи паролей не запустилась. Подробные сведения в журнале об этом событии (6800) наряду с записями журнала событий, созданными компонентом PasswordResetService, покажут, почему конечную точку не удалось запустить. Проверьте эти ошибки в журнале событий и попробуйте перезапустить Azure AD Connect если обратная запись паролей все еще не работает. Если проблема сохранится, попробуйте отключить и повторно включить обратную запись паролей.
| Когда пользователь пытается сбросить пароль или разблокировать учетную запись с включенным компонентом обратной записи паролей, операция завершается ошибкой. <br> <br> Кроме того, в журнале событий Azure AD Connect отображается событие, содержащее: "обработчик синхронизации вернул ошибку HR = 800700CE, сообщение = имя файла или расширение слишком длинное" после операции разблокировки. | Найдите учетную запись Active Directory для Azure AD Connect и сбросьте пароль так, чтобы он содержал не более 256 знаков. Затем откройте **службу синхронизации** из меню " **Пуск** ". В разделе **Соединители** найдите **Соединитель Active Directory**. Выберите его, а затем щелкните **Свойства**. На странице **Учетные данные** введите новый пароль. Нажмите кнопку **ОК**, чтобы закрыть страницу. |
| На последнем шаге процесса установки Azure AD Connect появляется ошибка с сообщением о том, что обратную запись паролей не удалось настроить. <br> <br> Журнал событий приложения Azure AD Connect содержит ошибку 32009 с текстом "ошибка при получении маркера проверки подлинности". | Эта ошибка возникает в следующих двух случаях: <br><ul><li>Вы указали неверный пароль для учетной записи глобального администратора, указанной в начале процесса установки Azure AD Connect.</li><li>Предпринята попытка использования федеративного пользователя для учетной записи глобального администратора, указанной в начале процесса установки Azure AD Connect.</li></ul> Чтобы устранить эту проблему, убедитесь, что вы не используете федеративный учетную запись для глобального администратора, указанного в начале процесса установки, и что указан правильный пароль. |
| Журнал событий компьютера Azure AD Connect содержит ошибку 32002, выданную службой PasswordResetService. <br> <br> Ошибка чтения: "ошибка подключения к ServiceBus. Поставщику маркеров не удалось предоставить маркер безопасности ". | Локальной среде не удалось подключиться к конечной точке служебной шины Azure в облаке. Эту ошибку обычно вызывает правило брандмауэра, блокирующее исходящее подключение к конкретному порту или веб-адресу. Дополнительные сведения см. в статье [Необходимые условия для Azure AD Connect](../hybrid/how-to-connect-install-prerequisites.md). После обновления этих правил перезапустите сервер Azure AD Connect и обратная запись паролей должны начать работать снова. |
| Поработав некоторое время, федеративные пользователи и пользователи, применяющие сквозную аутентификацию либо синхронизацию хэшей паролей, не могут сбросить свой пароль. | В некоторых редких случаях службе обратной записи паролей не удается перезапуститься после перезапуска Azure AD Connect. В таких случаях сначала проверьте, включена ли обратная запись паролей в локальной среде. Проверить можно с помощью мастера Azure AD Connect или PowerShell. Если функция включена, попробуйте снова включить или отключить эту функцию. Если этот шаг устранения неполадок не работает, попробуйте завершить удаление и переустановить Azure AD Connect. |
| Федеративные пользователи или пользователи, применяющие сквозную аутентификацию либо синхронизацию хэшей паролей, которые пытаются сбросить свои пароли, после попытки отправить пароль видят ошибку, указывающую, что возникла проблема со службой. <br ><br> Кроме того, во время операций сброса пароля вы можете увидеть ошибку, связанную с тем, что агенту управления было отказано в доступе к журналам событий в локальной системе. | Если эти ошибки отображаются в вашем журнале событий, убедитесь, что учетная запись Active Directory Management Agent (которая была указана в мастере во время настройки) обладает необходимыми разрешениями для обратной записи паролей. <br> <br> После предоставления этого разрешения может потребоваться до 1 часа для распространения разрешений путем выполнения фоновой задачи `sdprop` на контроллере домена. <br> <br> Для работы сброса пароля разрешение необходимо установить на дескрипторе безопасности объекта пользователя, пароль которого сбрасывается. Пока это разрешение не отобразится на объекте пользователя, сброс пароля будет завершаться отказом в доступе. |
| Федеративные пользователи или пользователи, применяющие сквозную аутентификацию либо синхронизацию хэшей паролей, которые пытаются сбросить свои пароли, после отправки пароля видят ошибку, указывающую, что возникла проблема со службой. <br> <br> В дополнение к этой проблеме во время операций сброса пароля в журналах событий может появиться сообщение об ошибке из службы Azure AD Connect, указывающей на ошибку "не удалось найти объект". | Эта ошибка обычно указывает, что обработчику синхронизации не удалось найти либо объект пользователя в пространстве соединителя Azure AD, либо связанный объект пространства соединителя метавселенной (MV) или Azure AD. <br> <br> Для решения этой проблемы убедитесь, что пользователь действительно синхронизирован из локальной среды в Azure AD через текущий экземпляр Azure AD Connect, и проверьте состояние объектов в пространствах соединителей и MV. Убедитесь, что объект служб сертификатов Active Directory (AD CS) подключен к объекту MV с помощью правила "Microsoft.InfromADUserAccountEnabled.xxx".|
| Федеративные пользователи или пользователи, применяющие сквозную аутентификацию либо синхронизацию хэшей паролей, которые пытаются сбросить свои пароли, после отправки пароля видят ошибку, указывающую, что возникла проблема со службой. <br> <br> В дополнение к этой проблеме во время операций сброса пароля в журналах событий может появиться сообщение об ошибке из службы Azure AD Connect, которая указывает на наличие ошибки "несколько соответствий найдено". | Это означает, что модуль синхронизации обнаружил, что объект MV подключен к более чем одному объекту AD CS через "Microsoft.InfromADUserAccountEnabled.xxx". Это означает, что у пользователя включена учетная запись в нескольких лесах. Такой сценарий не поддерживается для обратной записи паролей. |
| Операции с паролем вызывают ошибку конфигурации. Журнал событий приложений содержит ошибку Azure AD Connect 6329 с текстом: "0x8023061f (Операция не удалась, поскольку для данного агента управления не включена синхронизация паролей)". | Это происходит, если вы изменяете конфигурацию Azure AD Connect для добавления нового леса Active Directory (или удаления и повторного добавления существующего леса) после включения функции обратной записи паролей. Операции с паролями для пользователей в недавно добавленных лесах завершаются ошибкой. Чтобы исправить эту проблему, отключите и повторно включите обратную запись паролей после изменения конфигурации леса. |

## <a name="password-writeback-event-log-error-codes"></a>Коды ошибок журнала событий обратной записи паролей

При устранении неполадок с компонентом обратной записи паролей мы рекомендуем проверять журнал событий приложения на компьютере Azure AD Connect. Этот журнал событий содержит события из двух источников для обратной записи паролей. Источник *PasswordResetService* описывает операции и проблемы, связанные с операцией обратной записи паролей. Источник *ADSync* описывает операции и проблемы, связанные с установкой паролей в среде служб домен Active Directory.

### <a name="if-the-source-of-the-event-is-adsync"></a>Источник событий — ADSync

| Код | Имя или сообщение | Описание |
| --- | --- | --- |
| 6329 | Хранитель: MMS (4924) 0x80230619: "ограничение предотвращает изменение пароля на текущий указанный." | Это событие возникает, когда служба обратной записи паролей пытается задать пароль в локальном каталоге, который не соответствует требованиям домена к сроку действия пароля, истории, сложности или фильтрации. <br> <br> Если установлен минимальный срок действия пароля и пароль был недавно изменен в пределах заданного окна времени, вы не сможете изменить пароль снова, пока не истечет определенный период времени в вашем домене. При тестировании установите для минимального срока действия паролей значение 0. <br> <br> Если включены требования к журналу паролей, необходимо выбрать пароль, который не использовался в последние *n* раз, где *n* — это параметр журнала паролей. При выборе пароля, который использовался в последние *N* раз, в данном случае возникнет ошибка. При тестировании установите для журнала паролей значение 0. <br> <br> Если включены требования к сложности пароля, все они будут применяться при попытке пользователя изменить или сбросить пароль. <br> <br> Если включены фильтры паролей и пользователь выбирает пароль, который не соответствует критериям фильтрации, операция сброса или изменения завершается ошибкой. |
| 6329 | MMS (3040): адмаекспорт. cpp (2837): сервер не содержит элемент управления политики паролей LDAP. | Эта проблема возникает, если элемент управления LDAP_SERVER_POLICY_HINTS_OID (1.2.840.113556.1.4.2066) не включен на контроллерах доменов. Чтобы использовать функцию обратной записи паролей, необходимо включить этот элемент управления. Для этого контроллеры доменов должны работать под управлением Windows Server 2008R2 или более поздней версии. |
| HR 8023042 | Обработчик синхронизации вернул ошибку hr=80230402 с сообщением: "Попытка получить объект завершилась ошибкой, так как существуют повторяющиеся записи с одной привязкой". | Это ошибка возникает, когда один идентификатор пользователя включен в нескольких доменах. Например, если идет синхронизация лесов учетных записей и ресурсов, и в каждом из них включен один и тот же идентификатор пользователя. <br> <br> Также эта ошибка может возникнуть, если вы используете атрибут неуникальной привязки (например, псевдоним или имя участника-пользователя) и два пользователя используют одинаковый атрибут привязки. <br> <br> Чтобы устранить эту проблему, убедитесь, что в пределах доменов нет повторяющихся пользователей и для каждого пользователя используется атрибут уникальной привязки. |

### <a name="if-the-source-of-the-event-is-passwordresetservice"></a>Источник событий — PasswordResetService

| Код | Имя или сообщение | Описание |
| --- | --- | --- |
| 31001 | PasswordResetStart | Это событие указывает, что локальная служба обнаружила исходящий из облака запрос на сброс пароля для федеративного пользователя или пользователя, применяющего сквозную аутентификацию либо синхронизацию хэшей паролей. Это событие является первым событием в каждой операции обратной записи сброса пароля. |
| 31002 | PasswordResetSuccess | Это событие указывает, что пользователь выбрал новый пароль во время операции сброса пароля. Мы определили, что пароль соответствует требованиям организации к паролю. Он был успешно записан обратно в локальную среду Active Directory. |
| 31003 | PasswordResetFail | Это событие указывает, что пользователь выбрал пароль, который был успешно передан в локальную среду. Однако при попытке установить его в локальной среде Active Directory произошел сбой. Это может произойти по нескольким причинам. <br><ul><li>Пароль пользователя не соответствует требованиям к возрасту, истории, сложности или фильтрации для домена. Чтобы устранить эту проблему, создайте пароль.</li><li>Учетная запись службы ADMA не имеет соответствующих разрешений на установку нового пароля для учетной записи пользователя.</li><li>Учетная запись пользователя находится в защищенной группе, например в группе администраторов домена или предприятия, которая запрещает операции с набором паролей.</li></ul>|
| 31004 | OnboardingEventStart | Это событие возникает, если вы включили обратную запись паролей с Azure AD Connect и начали подключать свою организацию к веб-службе обратной записи паролей. |
| 31005 | OnboardingEventSuccess | Это событие указывает, что процесс адаптации прошел успешно и возможности обратной записи паролей готовы к использованию. |
| 31006 | ChangePasswordStart | Это событие указывает, что локальная служба обнаружила исходящий из облака запрос на изменение пароля для федеративного пользователя или пользователя, применяющего сквозную аутентификацию либо синхронизацию хэшей паролей. Это событие является первым событием в каждой операции обратной записи изменения пароля. |
| 31007 | ChangePasswordSuccess | Это событие указывает, что пользователь выбрал новый пароль во время операции изменения пароля, мы определили, что этот пароль соответствует требованиям организации к паролю, и он успешно был записан обратно в локальную среду Active Directory. |
| 31008 | ChangePasswordFail | Это событие указывает, что пользователь выбрал пароль, этот пароль успешно поступил в локальную среду, но при попытке установить его в локальной среде Active Directory произошел сбой. Это может произойти по нескольким причинам. <br><ul><li>Пароль пользователя не соответствует требованиям к возрасту, истории, сложности или фильтрации для домена. Чтобы устранить эту проблему, создайте пароль.</li><li>Учетная запись службы ADMA не имеет соответствующих разрешений на установку нового пароля для учетной записи пользователя.</li><li>Учетная запись пользователя находится в защищенной группе, такой как Администраторы домена или предприятия, что запрещает операции с набором паролей.</li></ul> |
| 31009 | ResetUserPasswordByAdminStart | Локальная служба обнаружила запрос на сброс пароля для федеративного пользователя или пользователя, применяющего сквозную аутентификацию либо синхронизацию хэшей паролей, исходящий от администратора от имени пользователя. Это событие является первым событием в каждой операции обратной записи для сброса пароля, инициированной администратором. |
| 31010 | ResetUserPasswordByAdminSuccess | Администратор выбрал новый пароль во время операции сброса пароля, инициированной администратором. Мы определили, что пароль соответствует требованиям организации к паролю. Он был успешно записан обратно в локальную среду Active Directory. |
| 31011 | ResetUserPasswordByAdminFail | Администратор выбрал пароль от имени пользователя. Этот пароль был успешно передан в локальную среду. Однако при попытке установить его в локальной среде Active Directory произошел сбой. Это может произойти по нескольким причинам. <br><ul><li>Пароль пользователя не соответствует требованиям к возрасту, истории, сложности или фильтрации для домена. Попробуйте устранить эту проблему, указав новый пароль.</li><li>Учетная запись службы ADMA не имеет соответствующих разрешений на установку нового пароля для учетной записи пользователя.</li><li>Учетная запись пользователя находится в защищенной группе, такой как Администраторы домена или предприятия, что запрещает операции с набором паролей.</li></ul>  |
| 31012 | OffboardingEventStart | Это событие возникает, если отключить обратную запись паролей с помощью Azure AD Connect, и указывает, что начата отмена адаптации вашей организации к веб-службе обратной записи паролей. |
| 31013| OffboardingEventSuccess| Это событие указывает, что процесс отмены адаптации прошел успешно и возможности обратной записи паролей успешно отключены. |
| 31014| OffboardingEventFail| Это событие означает, что процесс отключения завершился неудачно. Это могло произойти из-за ошибки в облаке или локальной учетной записи администратора, указанной во время настройки. Она также могла возникнуть, если вы пытались использовать федеративного облачного глобального администратора при отключении обратной записи паролей. Чтобы устранить эту проблему, проверьте свои разрешения на администрирование и убедитесь, что вы не используете никакую федеративную учетную запись при настройке функции обратной записи паролей.|
| 31015| WriteBackServiceStarted| Это событие указывает, что служба обратной записи паролей успешно запущена. Она готова к приему запросов на управление паролями из облака.|
| 31016| WriteBackServiceStopped| Это событие указывает, что служба обратной записи паролей была остановлена. Любые запросы на управление паролями из облака не будут успешными.|
| 31017| AuthTokenSuccess| Это событие указывает, что мы успешно получили токен авторизации для глобального администратора, указанного во время установки Azure AD Connect, для запуска процесса адаптации или отмены адаптации.|
| 31018| KeyPairCreationSuccess| Это событие указывает, что мы успешно создали ключ шифрования паролей. Он используется для шифрования паролей из облака для отправки в локальную среде.|
| 31034| сервицебуслистенереррор| Это событие означает, что произошла ошибка при подключении к прослушивателю служебной шины клиента. Если сообщение об ошибке содержит "Недопустимый удаленный сертификат", убедитесь, что сервер Azure AD Connect имеет все необходимые корневые центры сертификации, как описано в статье [изменения сертификатов Azure TLS](../../security/fundamentals/tls-certificate-changes.md). |
| 32000| UnknownError| Это событие указывает на неизвестную ошибку во время операции управления паролями. Просмотрите текст исключения в событии для получения дополнительных сведений. Если проблемы продолжаются, попробуйте отключить и повторно включить обратную запись паролей. Если это не поможет, включите копию журнала событий вместе с ИДЕНТИФИКАТОРом отслеживания, указанным при открытии запроса в службу поддержки.|
| 32001| ServiceError| Это событие указывает, что произошла ошибка при подключении к облачной службе сброса паролей. Она обычно возникает, если локальной службе не удается подключиться к веб-службе сброса паролей.|
| 32002| ServiceBusError| Это событие указывает, что произошла ошибка при подключении к экземпляру служебной шины клиента. Это может произойти, если в вашей локальной среде блокируются исходящие подключения. Проверьте, разрешены ли в брандмауэре подключения через TCP-порт 443 и к странице https://ssprdedicatedsbprodncu.servicebus.windows.net, а затем повторите попытку. Если проблемы продолжаются, попробуйте отключить и повторно включить обратную запись паролей.|
| 32003| InPutValidationError| Это событие указывает, что входные данные, переданные в API нашей веб-службы, были недопустимыми. Попробуйте выполнить операцию заново.|
| 32004| DecryptionError| Это событие указывает, что произошла ошибка при расшифровке пароля, который поступил из облака. Это может быть из-за несовпадения ключей расшифровки между облачной службой и локальной средой. Чтобы решить эту проблему, отключите и снова включите обратную запись паролей в локальной среде.|
| 32005| ConfigurationError| Во время адаптации мы сохраняем сведения для конкретного клиента в файле конфигурации в локальной среде. Это событие указывает, что произошла ошибка при сохранении этого файла или при запуске службы произошла ошибка чтения файла. Чтобы устранить эту проблему, попробуйте отключить и повторно включить обратную запись паролей для принудительной перезаписи данного файла конфигурации.|
| 32007| OnBoardingConfigUpdateError| Во время адаптации мы отправляем данные из облака в локальную службу сброса паролей. Эти данные затем записываются в файл, размещенный в памяти, перед отправкой в службу синхронизации для безопасного хранения на диске. Это событие означает, что возникла проблема с записью или обновлением этих данных в памяти. Чтобы устранить эту проблему, попробуйте отключить и повторно включить обратную запись паролей для принудительной перезаписи данного файла конфигурации.|
| 32008| ValidationError| Это событие указывает, что был получен недопустимый ответ от веб-службы сброса паролей. Чтобы устранить эту проблему, попробуйте отключить и повторно включить обратную запись паролей.|
| 32009| AuthTokenError| Это событие указывает, что нам не удалось получить токен авторизации для учетной записи глобального администратора, указанной во время установки Azure AD Connect. Эта ошибка может быть вызвана неверным именем пользователя или паролем, указанным для учетной записи глобального администратора. Она может возникнуть, если указанная учетная запись глобального администратора является федеративной. Чтобы устранить эту проблему, повторно запустите конфигурацию с правильными именем пользователя и паролем и убедитесь, что учетная запись администратора является управляемой (только облачной или с синхронизацией паролей).|
| 32010| CryptoError| Это событие указывает, что произошла ошибка при создании ключа шифрования пароля или при расшифровке пароля, поступившего из облачной службы. Скорее всего, эта ошибка указывает на возможную неполадку среды. Просмотрите подробности в журнале событий для получения дополнительных сведений об устранении этой проблемы. Вы также можете попробовать отключить и повторно включить службу обратной записи паролей.|
| 32011| OnBoardingServiceError| Это событие указывает, что локальной службе не удалось правильно связаться с веб-службой сброса паролей для запуска процесса адаптации. Это может произойти в результате правила брандмауэра или при возникновении проблемы при получении маркера проверки подлинности для клиента. Чтобы устранить эту проблему, проверьте, не блокируются ли исходящие подключения через TCP-порты 443 и 9350–9354 или к странице https://ssprdedicatedsbprodncu.servicebus.windows.net. Кроме того, убедитесь в том, что учетная запись администратора Azure Active Directory, используемая для этого процесса, не федеративная.|
| 32013| OffBoardingError| Это событие указывает, что локальной службе не удалось правильно связаться с веб-службой сброса паролей для запуска процесса отмены адаптации. Это может произойти в результате правила брандмауэра или при возникновении проблемы при получении маркера авторизации для клиента. Чтобы устранить эту проблему, проверьте, не блокируются ли исходящие подключения через TCP-порт 443 или к странице https://ssprdedicatedsbprodncu.servicebus.windows.net. Кроме того, учетная запись администратора Azure Active Directory, используемая для этого процесса, не должна быть федеративной.|
| 32014| ServiceBusWarning| Это событие означает, что нам пришлось повторить попытку подключения к экземпляру служебной шины клиента. В нормальных условиях это не должно быть проблемой, но если это событие встречается много раз, попробуйте проверить сетевое подключение к служебной шине, особенно если это подключение с высокой задержкой или с низкой пропускной способностью.|
| 32015| ReportServiceHealthError| Для мониторинга работоспособности службы обратной записи паролей мы отправляем сведения о пульсе в веб-службу сброса паролей каждые пять минут. Это событие указывает, что произошла ошибка при отправке такой информации о работоспособности обратно в облачную веб-службу. Эта информация о работоспособности не включает персональные данные и является исключительно пульсом и базовой статистикой службы, чтобы мы могли предоставлять сведения о состоянии службы в облаке.|
| 33001| ADUnKnownError| Это событие указывает, что возникла неизвестная ошибка, возвращенная службой Active Directory. Проверьте журнал событий сервера Azure AD Connect на наличие событий из источника ADSync для получения дополнительных сведений об ошибке.|
| 33002| ADUserNotFoundError| Это событие указывает, что пользователь, который пытается сбросить или изменить пароль, не найден в локальном каталоге. Это может произойти, если пользователь был удален локально, а не в облаке. Эта ошибка также может возникать при наличии проблемы с синхронизацией. Чтобы получить дополнительные сведения, проверьте журналы синхронизации и последние сведения о выполнении синхронизации.|
| 33003| ADMutliMatchError| Если запрос на сброс или изменение пароля исходит из облака, мы используем облачную привязку, указанную в процессе установки Azure AD Connect, для определения способа связи этого запроса обратно с пользователем в локальной среде. Это событие указывает, что в локальном каталоге найдены два пользователя с одним и тем же атрибутом облачной привязки. Проверьте журналы синхронизации, а также подробности о последних нескольких запусках синхронизации для получения дополнительных сведений.|
| 33004| ADPermissionsError| Это событие означает, что учетная запись службы Active Directory Management Agent (ADMA) не имеет соответствующих разрешений на рассматриваемую учетную запись, чтобы задать новый пароль. Убедитесь, что учетная запись ADMA в лесу пользователя имеет разрешения на сброс пароля для всех объектов в лесу. Дополнительные сведения о том, как задать разрешения, см. в разделе "Шаг 4. Настройка соответствующих разрешений Active Directory". Эта ошибка также возникает, если атрибуту пользователя AdminCount присвоено значение 1.|
| 33005| ADUserAccountDisabled| Это событие указывает, что мы пытались сбросить или изменить пароль для учетной записи, которая была отключена на локальном компьютере. Включите учетную запись и повторите попытку.|
| 33006| ADUserAccountLockedOut| Это событие указывает, что мы пытались сбросить или изменить пароль для учетной записи, которая была заблокирована на локальном компьютере. Блокировки могут происходить при слишком большом количестве попыток пользователя изменить или сбросить пароль за короткий период. Разблокируйте учетную запись и повторите попытку.|
| 33007| ADUserIncorrectPassword| Это событие указывает, что пользователь задал неверный текущий пароль при выполнении операции смены пароля. Укажите правильный текущий пароль и повторите попытку.|
| 33008| ADPasswordPolicyError| Это событие возникает, когда служба обратной записи паролей пытается задать пароль в локальном каталоге, который не соответствует требованиям домена к сроку действия пароля, истории, сложности или фильтрации. <br> <br> Если установлен минимальный срок действия пароля и пароль был недавно изменен в пределах заданного окна времени, вы не сможете изменить пароль снова, пока не истечет определенный период времени в вашем домене. При тестировании установите для минимального срока действия паролей значение 0. <br> <br> Если включены требования к истории паролей, то необходимо выбрать пароль, который не использовался последние *N* раз, где *N* — настройка истории паролей. При выборе пароля, который использовался в последние *N* раз, в данном случае возникнет ошибка. При тестировании установите для журнала паролей значение 0. <br> <br> Если включены требования к сложности пароля, все они будут применяться при попытке пользователя изменить или сбросить пароль. <br> <br> Если включены фильтры паролей и пользователь выбирает пароль, который не соответствует критериям фильтрации, операция сброса или изменения завершается ошибкой.|
| 33009| ADConfigurationError| Это событие указывает, что возникла проблема при записи пароля обратно в локальный каталог из-за неполадки с конфигурацией в Active Directory. Дополнительные сведения о том, какая ошибка возникла, см. в журнале событий приложений на Azure AD Connect компьютере для получения сообщений от службы ADSync.|

## <a name="azure-ad-forums"></a>Форумы Azure AD

Если у вас есть общие вопросы об Azure AD и самостоятельном сбросе пароля, обратитесь за помощью к сообществу, чтобы получить помощь на [странице Microsoft Q&A вопроса для Azure Active Directory](/answers/topics/azure-active-directory.html). В сообщество входят инженеры, менеджеры по продуктам, MVP и ИТ-специалисты.

## <a name="contact-microsoft-support"></a>Обратиться в службу поддержки Майкрософт

Если вам не удается найти решение проблемы, специалисты группы поддержки всегда готовы помочь.

Чтобы мы могли предоставить вам соответствующую помощь, укажите в запросе как можно больше подробностей. Ниже приведены эти сведения.

* **Общее описание ошибки**. В чем заключается ошибка? Как вела себя система? Как можно воспроизвести ошибку? Опишите проблему максимально подробно.
* **Страницу.** На какой странице вы находились, когда произошла ошибка? По возможности предоставьте URL-адрес страницы и снимок экрана.
* **Код поддержки.** Какой код поддержки был сформирован, когда пользователь увидел ошибку?
   * Чтобы найти его, воспроизведите ошибку, затем щелкните ссылку **Код поддержки** внизу экрана и отправьте специалисту службы поддержки идентификатор GUID, который отобразится в результате.

    :::image type="content" source="./media/troubleshoot-sspr-writeback/view-support-code.png" alt-text="Код поддержки находится в правом нижнем углу окна веб-браузера.":::

  * Если вы находитесь на странице, внизу которой отсутствует код поддержки, нажмите клавишу F12 и поищите SID и CID, после чего отправьте два найденных результата специалисту службы поддержки.
* **Дату, время и часовой пояс.** Укажите точную дату и время возникновения ошибки, а также *часовой пояс*.
* **Идентификатор пользователя.** Какой пользователь увидел ошибку? Например, *пользователь\@contoso.com*.
   * Это федеративный пользователь?
   * Это пользователь, применяющий сквозную аутентификацию?
   * Это пользователь с синхронизацией хэшей паролей?
   * Это облачный пользователь?
* **Лицензирование.** Назначена ли пользователю лицензия Azure AD?
* **Журнал событий приложений.** Если используется компонент обратной записи паролей и код ошибки находится в локальной инфраструктуре, включите сжатую копию журнала событий приложения с сервера Azure AD Connect.

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения о SSPR см. в статье [как это работает: самостоятельный сброс пароля Azure AD](concept-sspr-howitworks.md) или [самостоятельная обратная запись сброса пароля в Azure AD](concept-sspr-writeback.md).