---
title: Защита Microsoft 365 от локальных атак
description: Руководство по обеспечению локальной атаки не влияет на Microsoft 365
services: active-directory
author: BarbaraSelden
manager: daveba
ms.service: active-directory
ms.workload: identity
ms.subservice: fundamentals
ms.topic: conceptual
ms.date: 12/22/2020
ms.author: baselden
ms.reviewer: ajburnle
ms.custom: it-pro, seodec18
ms.collection: M365-identity-device-management
ms.openlocfilehash: 97893dece068dfdde85159f734095401288231d2
ms.sourcegitcommit: 2bd0a039be8126c969a795cea3b60ce8e4ce64fc
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/14/2021
ms.locfileid: "98201354"
---
# <a name="protecting-microsoft-365-from-on-premises-attacks"></a>Защита Microsoft 365 от локальных атак

Многие клиенты соединяются с частными корпоративными сетями, чтобы Microsoft 365, чтобы воспользоваться преимуществами их пользователей, устройств и приложений. Однако существует множество хорошо документированных способов взлома этих частных сетей. Поскольку Microsoft 365 выступает в качестве «нервной системы» для многих организаций, крайне важно защитить ее от скомпрометированной локальной инфраструктуры.

В этой статье показано, как настроить системы для защиты Microsoft 365 облачной среды от несанкционированного доступа в локальной среде. В основном основное внимание уделяется параметрам конфигурации клиента Azure AD, способам безопасного подключения клиентов Azure AD к локальным системам и компромиссам, необходимым для работы систем в целях защиты облачных систем от несанкционированного доступа в локальной среде.

Мы настоятельно рекомендуем реализовать это руководство для защиты Microsoft 365 облачной среды.
> [!NOTE]
> Эта статья изначально опубликована в записи блога. Она перемещена сюда для долговечности и обслуживания. <br>
Чтобы создать автономную версию этой статьи, используйте функции печати в браузере в формате PDF. Регулярно посещайте эту ссылку для установки обновлений.

## <a name="primary-threat-vectors-from-compromised-on-premises-environments"></a>Основные векторы угроз от скомпрометированных локальных сред


Microsoft 365 облачной среды — преимущества обширной инфраструктуры мониторинга и безопасности. Использование машинного обучения и функции человеческого интеллекта, которые осуществляют поиск по всему миру, могут быстро обнаруживать атаки и выполнять повторную настройку практически в реальном времени. В гибридных развертываниях, которые соединяют локальную инфраструктуру с Microsoft 365, многие организации делегируют доверие локальным компонентам для критически важных решений проверки подлинности и управления состоянием объектов каталога.
К сожалению, если локальная среда скомпрометирована, эти доверительные отношения приведут к нарушению работы злоумышленников в Microsoft 365ной среде.

Двумя основными векторами угроз являются **отношения доверия федерации** и **Синхронизация учетных записей.** Оба вектора могут предоставить злоумышленнику административный доступ к вашему облаку.

* **Федеративные отношения доверия**, такие как проверка подлинности SAML, используются для проверки подлинности Microsoft 365 с помощью локальной инфраструктуры идентификации. Если сертификат для подписи токена SAML скомпрометирован, Федерация позволит любому пользователю с этим сертификатом олицетворять любого пользователя в облаке. **Мы рекомендуем отключить отношения доверия федерации для проверки подлинности, чтобы Microsoft 365 по возможности.**

* **Синхронизацию учетных записей** можно использовать для изменения привилегированных пользователей (включая их учетные данные) или групп, которым предоставлены права администратора в Microsoft 365. **Рекомендуется гарантировать, что синхронизированные объекты не будут иметь привилегий за пределами пользователя в Microsoft 365,** напрямую или посредством включения в доверенные роли или группы. Убедитесь, что эти объекты не имеют прямого или вложенного назначения в ролях или группах доверенного облака.

## <a name="protecting-microsoft-365-from-on-premises-compromise"></a>Защита Microsoft 365 от несанкционированного доступа в локальной среде


Чтобы устранить описанные выше векторы угроз, мы рекомендуем придерживаться следующих принципов:

![Эталонная архитектура для защиты Microsoft 365 ](media/protect-m365/protect-m365-principles.png)

*  **Полностью изолируйте учетные записи администратора Microsoft 365.** Они должны быть

    * В Azure AD.

     * Проверка подлинности с использованием многофакторной проверки подлинности (MFA).

     *  Защищено с помощью условного доступа Azure AD.

     *  Доступно только с помощью управляемых рабочих станций Azure.

Это ограниченные учетные записи использования. **В Microsoft 365 не должно быть локальных учетных записей с правами администратора.** Дополнительные сведения см. в этом [обзоре Microsoft 365 ролей администратора](https://docs.microsoft.com/microsoft-365/admin/add-users/about-admin-roles?view=o365-worldwide).
См. также [роли для Microsoft 365 в Azure Active Directory](../roles/m365-workload-docs.md).

*  **Управление устройствами из Microsoft 365.** Используйте присоединение к Azure AD и управление мобильными устройствами на основе облачных устройств (MDM), чтобы исключить зависимости от инфраструктуры управления локальными устройствами, что может нарушить безопасность устройств и средств безопасности.

* **Ни одна локальная учетная запись не имеет повышенных привилегий для Microsoft 365.**
    Учетным записям, обращающимся к локальным приложениям, для которых требуется проверка подлинности NTLM, LDAP или Kerberos, требуется учетная запись в локальной инфраструктуре идентификации Организации. Убедитесь, что эти учетные записи, включая учетные записи служб, не включены в привилегированные облачные роли или группы и что изменения этих учетных записей не могут повлиять на целостность облачной среды. Привилегированное локальное программное обеспечение не должно быть способно влиять на Microsoft 365 привилегированных учетных записей или ролей.

*  **Используйте проверку подлинности в облаке Azure AD** , чтобы исключить зависимости от локальных учетных данных. Всегда используйте строгую проверку подлинности, например Windows Hello, FIDO, Microsoft Authenticator или Azure AD MFA.

## <a name="specific-recommendations"></a>Конкретные рекомендации


В следующих разделах приводятся конкретные рекомендации по реализации описанных выше принципов.

### <a name="isolate-privileged-identities"></a>Изоляция привилегированных удостоверений


В Azure AD пользователи с привилегированными ролями, такими как администраторы, являются корнем доверия для создания и управления остальной частью среды. Реализуйте следующие методы, чтобы снизить влияние компрометации.

* Используйте учетные записи только для облака для Azure AD и Microsoft 365 привилегированных ролей. d

* Развертывание [устройств привилегированного доступа](https://docs.microsoft.com/security/compass/privileged-access-devices#device-roles-and-profiles) для привилегированного доступа для управления Microsoft 365 и Azure AD.

*  Развертывайте [Azure AD privileged Identity Management](../privileged-identity-management/pim-configure.md) (PIM) для доступа только по времени (JIT) ко всем учетным записям, имеющим привилегированные роли, и требует строгой проверки подлинности для активации ролей.

* Предоставьте административные роли [для выполнения задач с минимальными правами](../roles/delegate-by-task.md).

* Чтобы обеспечить более широкие возможности назначения ролей, включающие делегирование и несколько ролей одновременно, рекомендуется использовать группы безопасности Azure AD или группы Microsoft 365 (совокупно "облачные группы") и [включить управление доступом на основе ролей](../roles/groups-assign-role.md). Можно также использовать [административные единицы](../roles/administrative-units.md) , чтобы ограничить область действия ролей частью Организации.

* Развертывайте [учетные записи аварийного доступа](../roles/security-emergency-access.md) и не используйте локальные хранилища паролей для хранения учетных данных.

Дополнительные сведения см. в разделе [Защита привилегированного доступа](https://aka.ms/SPA)с подробным руководством по этому вопросу. См. также [рекомендации по обеспечению безопасности для администраторов в Azure AD](../roles/security-planning.md).

### <a name="use-cloud-authentication"></a>Использовать проверку подлинности в облаке 

Учетные данные являются основным вектором атак. Чтобы сделать учетные данные более безопасными, реализуйте следующие методы.

* [Развертывание проверки подлинности с паролем](../authentication/howto-authentication-passwordless-deployment.md). при развертывании учетных данных, защищенных паролем, сократите количество используемых паролей. Эти учетные данные управляются и проверяются изначально в облаке. Выберите один из следующих типов.

   * [Windows Hello для бизнеса](https://docs.microsoft.com/windows/security/identity-protection/hello-for-business/passwordless-strategy)

   * [Приложение Authenticator](../authentication/howto-authentication-passwordless-phone.md)

   * [Ключи безопасности FIDO2](../authentication/howto-authentication-passwordless-security-key-windows.md)

* [Развертывание многофакторной проверки подлинности](https://aka.ms/deploymentplans/mfa). подготавливает [несколько надежных учетных данных с помощью Azure AD MFA](../fundamentals/resilience-in-credentials.md). Таким образом, для доступа к облачным ресурсам потребуется учетные данные, управляемые в Azure AD, а также локальный пароль, который можно изменять.

   * Дополнительные сведения см. в статье [Создание отказоустойчивой стратегии управления доступом с помощью Azure Active Directory](https://aka.ms/resilientaad).

**Ограничения и компромиссы**

* Для управления паролями гибридной учетной записи требуются Гибридные компоненты, такие как агенты защиты паролей и агенты обратной записи паролей. Если ваша локальная инфраструктура скомпрометирована, злоумышленники могут управлять компьютерами, на которых находятся эти агенты. Хотя это не приведет к нарушению безопасности облачной инфраструктуры, облачные учетные записи не будут защищать эти компоненты от несанкционированного доступа в локальной среде.

*  Локальные учетные записи, синхронизированные с Active Directory, помечаются как бессрочные в Azure AD. Исходя из предположения, что политики паролей в локальной службе AD будут устранены. Если ваша локальная служба AD скомпрометирована и необходимо отключить синхронизацию из AD Connect, необходимо задать параметр [енфорцеклаудпассвордполицифорпассвордсинцедусерс](../hybrid/how-to-connect-password-hash-synchronization.md).

## <a name="provision-user-access-from-the-cloud"></a>Предоставление пользователям доступа из облака

Подготовка подразумевает создание учетных записей пользователей и групп в приложениях или поставщиках удостоверений.

![Схема архитектуры подготовки](media/protect-m365/protect-m365-provision.png)

* **Подготавливается из облачных приложений отдела кадров к Azure AD:** Это позволяет изолироваться в локальной среде, не нарушая цикл приостановки работы и выхода из облачных приложений отдела кадров в Azure AD.

* **Облачные приложения:** По возможности развертывайте [Azure AD App подготовки](../app-provisioning/user-provisioning.md) в отличие от локальных решений подготовки. Это обеспечит защиту некоторых приложений SaaS от вредоносных профилей пользователей из-за локальных нарушений. 

* **Внешние удостоверения:** Используйте [службу совместной работы Azure AD B2B](../external-identities/what-is-b2b.md).
    Это снизит зависимость от локальных учетных записей для внешней совместной работы с партнерами, клиентами и поставщиками. Тщательно оцените любую прямую федерацию с другими поставщиками удостоверений. Мы рекомендуем ограничить учетные записи гостя B2B следующими способами.

   *  Ограничьте гостевой доступ для обзора групп и других свойств в каталоге. Используйте параметры внешней совместной работы, чтобы запретить гостевой доступ к группам, не входящим в них. 

    *   Блокировка доступа к портал Azure. Вы можете делать нередко необходимые исключения.  Создайте политику условного доступа, включающую всех гостей и внешних пользователей, а затем [реализуйте политику для блокировки доступа](/azure/role-based-access-control/conditional-access-azure-management). 

* **Отключенные леса:** Используйте [подготовку облачных служб Azure AD](../cloud-provisioning/what-is-cloud-provisioning.md). Это позволяет подключаться к отключенным лесам, устраняя необходимость подключения между лесами или доверия, что может расширить влияние локального нарушения. * 
 
**Ограничения и компромиссы:**

* При использовании для инициализации гибридных учетных записей Azure AD из облачных систем отдела кадров использует локальную синхронизацию для завершения потока данных из AD в Azure AD. Если синхронизация прервана, новые записи сотрудников не будут доступны в Azure AD.

## <a name="use-cloud-groups-for-collaboration-and-access"></a>Использование облачных групп для совместной работы и доступа

Облачные группы позволяют отделить совместную работу и доступ из локальной инфраструктуры.

* **Совместная работа:** Используйте группы Microsoft 365 и Microsoft Teams для современной совместной работы. Списание локальных списков рассылки и [Обновление списков рассылки до Microsoft 365 групп в Outlook](https://docs.microsoft.com/office365/admin/manage/upgrade-distribution-lists?view=o365-worldwide).

* **Доступ:** Используйте группы безопасности Azure AD или группы Microsoft 365 для авторизации доступа к приложениям в Azure AD.
* **Лицензирование Office 365:** Используйте Групповое лицензирование для обеспечения готовности к работе с Office 365 с помощью групп, предназначенных только для облака. Это разделяет Управление членством в группе из локальной инфраструктуры.

Владельцы групп, используемых для доступа, должны считаться привилегированными удостоверениями, чтобы не перенаправление членство в локальной системе безопасности.
Отработка отказа включает непосредственное управление членством в локальной группе или манипуляции с локальными атрибутами, которые могут повлиять на динамическое членство в группе Microsoft 365.

## <a name="manage-devices-from-the-cloud"></a>Управление устройствами из облака


Используйте возможности Azure AD для безопасного управления устройствами.

-   **Использование рабочих станций Windows 10:** [развертывание присоединенных к Azure AD](../devices/azureadjoin-plan.md) устройств с помощью политик MDM. Включите [Windows автопилот](https://docs.microsoft.com/mem/autopilot/windows-autopilot) для полностью автоматизированного процесса подготовки.

    -   Устаревшие Windows 8.1 и более ранние компьютеры.

    -   Не развертывайте компьютеры серверных ОС в качестве рабочих станций.

    -   Используйте [Microsoft Intune](https://www.microsoft.com/en/microsoft-365/enterprise-mobility-security/microsoft-intune) в качестве источника полномочий всех рабочих нагрузок по управлению устройствами.

-   [**Развертывание устройств привилегированного доступа**](https://docs.microsoft.com/security/compass/privileged-access-devices#device-roles-and-profiles) для привилегированного доступа для управления Microsoft 365 и Azure AD.

 ## <a name="workloads-applications-and-resources"></a>Рабочие нагрузки, приложения и ресурсы 

-   **Локальные системы единого входа:** Не рекомендуется использовать локальную инфраструктуру управления службами федерации и Веб-доступ и настраивать приложения для использования Azure AD.  

-   **SaaS и бизнес-приложения, поддерживающие современные протоколы проверки подлинности:** [Используйте Azure AD для единого входа](../manage-apps/what-is-single-sign-on.md). Чем больше приложений вы настраиваете для использования Azure AD для проверки подлинности, тем меньше риск в случае локального нарушения безопасности.


* **Устаревшие приложения** 

   * С помощью [Azure AD application proxy](../manage-apps/application-proxy.md)можно включить проверку подлинности, авторизацию и удаленный доступ к устаревшим приложениям, которые не поддерживают современные проверки подлинности. Их также можно включить с помощью решения контроллера доставки приложений в сети или приложения, используя  [безопасные интеграции с партнером по гибридному доступу](../manage-apps/secure-hybrid-access.md).   

   * Выберите поставщика VPN, который поддерживает современную проверку подлинности и интегрируйте проверку подлинности с Azure AD. В случае компрометации провер можно использовать Azure AD, чтобы отключить или заблокировать доступ, отключив VPN.

*  **Серверы приложений и рабочих нагрузок**

   * Приложения или ресурсы, необходимые для переноса требуемых серверов в Azure IaaS, и использование [доменных служб Azure AD](https://docs.microsoft.com/azure/active-directory-domain-services/overview) (Azure AD DS) для отделения доверия и зависимости от локальной службы AD. Чтобы достичь этой разсвязи, виртуальные сети, используемые для AD DS Azure, не должны иметь подключения к корпоративным сетям.

   * Следуйте указаниям по [уровню учетных данных](https://aka.ms/TierModel). Серверы приложений обычно считаются ресурсами уровня 1.

 ## <a name="conditional-access-policies"></a>Политики условного доступа

Используйте условный доступ Azure AD для интерпретации сигналов и принятия решений о проверке подлинности на основе их. Дополнительные сведения см. в разделе [план развертывания условного доступа.](https://aka.ms/deploymentplans/ca)

* [Устаревшие протоколы проверки подлинности](../fundamentals/auth-sync-overview.md). Используйте условный доступ для [блокирования устаревших протоколов проверки подлинности](../conditional-access/howto-conditional-access-policy-block-legacy.md) везде Кроме того, отключите устаревшие протоколы проверки подлинности на уровне приложения, используя конфигурацию для конкретного приложения.

   * Ознакомьтесь с подробными сведениями о [Exchange Online](https://docs.microsoft.com/exchange/clients-and-mobile-in-exchange-online/disable-basic-authentication-in-exchange-online#how-basic-authentication-works-in-exchange-online) и [SharePoint Online](https://docs.microsoft.com/powershell/module/sharepoint-online/set-spotenant?view=sharepoint-ps).

* Реализуйте Рекомендуемые [конфигурации удостоверений и доступа к устройствам.](https://docs.microsoft.com/microsoft-365/security/office-365-security/identity-access-policies?view=o365-worldwide)

* Если вы используете версию Azure AD, которая не включает условный доступ, убедитесь, что используются [Параметры безопасности Azure AD по умолчанию](../fundamentals/concept-fundamentals-security-defaults.md).

   * Дополнительные сведения о лицензировании функций Azure AD см. в статье о [ценах на Azure AD](https://azure.microsoft.com/pricing/details/active-directory/).

## <a name="monitoring"></a>Наблюдение 

После настройки среды для защиты Microsoft 365 от несанкционированного доступа в локальной среде [проследите за работой среды заранее](../reports-monitoring/overview-monitoring.md) .
### <a name="scenarios-to-monitor"></a>Отслеживаемые сценарии

В дополнение к любым сценариям, относящимся к вашей организации, отслеживайте следующие ключевые сценарии. Например, вы должны заранее отслеживать доступ к важнейшим бизнес-приложениям и ресурсам.

* **Подозрительные действия**. все [события риска Azure AD](https://docs.microsoft.com/azure/active-directory/identity-protection/overview-identity-protection#risk-detection-and-remediation) должны отслеживаться для подозрительных действий. [Защита идентификации Azure AD](https://docs.microsoft.com/azure/active-directory/identity-protection/overview-identity-protection) изначально интегрирована с центром безопасности Azure.

   * Определите сетевые [расположения](../reports-monitoring/quickstart-configure-named-locations.md) , чтобы избежать обнаружения помех в сигналах на основе расположения. 
*  **Предупреждения анализа поведения сущностей пользователя (уеба)** Используйте УЕБА для получения ценной информации об обнаружении аномалий.
   * Microsoft Cloudное Обнаружение приложений (МКАС) предоставляет [уеба в облаке](https://docs.microsoft.com/cloud-app-security/tutorial-ueba).

   * [Локальную уеба можно интегрировать из Azure ATP](https://docs.microsoft.com/defender-for-identity/install-step2). МКАС считывает сигналы из защита идентификации Azure AD. 

* **Действия с учетными записями аварийного доступа**. необходимо отслеживать любой доступ, используя [учетные записи аварийного доступа](../roles/security-emergency-access.md) , и оповещения, созданные для расследования. Этот мониторинг должен включать: 

   * Входы в систему. 

   * Управление учетными данными. 

   * Любые обновления в отношении членства в группах. 

   *    Назначения приложений. 
* **Активность привилегированных ролей**. Настройка и проверка [оповещений системы безопасности, созданных с помощью Azure AD PIM](https://docs.microsoft.com/azure/active-directory/privileged-identity-management/pim-how-to-configure-security-alerts?tabs=new#security-alerts).
    Отслеживание прямого назначения привилегированных ролей за пределами PIM за счет создания предупреждений при непосредственном назначении пользователя.
* **Конфигурации на уровне клиента Azure AD**. любые изменения в конфигурациях на уровне клиента должны создавать предупреждения в системе. К ним относятся, но не ограничиваются
  *  Обновление пользовательских доменов  

  * Список разрешенных и запрещенных изменений в Azure AD B2B.
  * Azure AD B2B разрешенные поставщики удостоверений (SAML поставщиков удостоверений через прямые Федерации или социальные имена входа).  
  * Изменение политики условного доступа или риска 

* **Объекты приложения и субъекта-службы**:
   * Новые приложения или субъекты-службы, которые могут требовать применения политик условного доступа. 

   * Дополнительные учетные данные, добавленные в субъекты-службы.
   * Действие согласия приложения. 

* **Пользовательские роли**:
   * Обновления определений пользовательских ролей. 

   * Созданы новые пользовательские роли. 

### <a name="log-management"></a>Управление журналами;

Определение хранилища журналов и стратегии хранения, проектирования и реализации для обеспечения единообразного набора инструментов, такого как SIEMные системы, такие как Azure Sentinel, общие запросы, исследования и судебные модули playbookы.

* **Журналы Azure AD** Журналы приема и сигнала, созданные после единообразных рекомендаций, включая параметры диагностики, срок хранения журнала и прием SIEM. Стратегия журнала должна включать следующие журналы Azure AD:
   * Действия при входе 

   * Журналы аудита 

   * События риска 

Azure AD предоставляет [Azure Monitor интеграцию](../reports-monitoring/concept-activity-logs-azure-monitor.md) журналов действий входа и журналов аудита. События риска могут быть приняты через [API Microsoft Graph](https://aka.ms/AzureADSecuredAzure/32b). Вы можете выполнять [потоковую передачу журналов Azure AD в журналы Azure Monitor](../reports-monitoring/howto-integrate-activity-logs-with-log-analytics.md).

* **Журналы безопасности операционной системы гибридной инфраструктуры.** Все журналы ОС гибридной инфраструктуры идентификации должны быть архивированы и тщательно отслеживаться как <br>Система уровня 0 с учетом особенностей контактной зоны. В том числе: 

   *  Azure AD Connect. Для мониторинга синхронизации удостоверений необходимо развернуть [Azure AD Connect Health](https://aka.ms/AzureADSecuredAzure/32e) .

   *  Агенты прокси приложения 


   * Агенты обратной записи паролей 

   * Компьютеры шлюза защиты паролей  

   * Сервер политики сети с расширением RADIUS Azure MFA 

## <a name="next-steps"></a>Next Steps
* [Обеспечение устойчивости для управления удостоверениями и доступом с помощью Azure AD](resilience-overview.md)

* [Безопасный внешний доступ к ресурсам](secure-external-access-resources.md) 
* [Интеграция всех приложений с Azure AD](five-steps-to-full-application-integration-with-azure-ad.md)
