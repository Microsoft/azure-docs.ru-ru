---
title: Защита управляемых удостоверений в Azure Active Directory
description: Описание способов поиска, оценки и повышения безопасности управляемых удостоверений.
services: active-directory
author: BarbaraSelden
manager: daveba
ms.service: active-directory
ms.workload: identity
ms.subservice: fundamentals
ms.topic: conceptual
ms.date: 3/1/2021
ms.author: baselden
ms.reviewer: ajburnle
ms.custom: it-pro, seodec18
ms.collection: M365-identity-device-management
ms.openlocfilehash: 32ba630d5e2f8e3e581f394af2ee687a971d3a7a
ms.sourcegitcommit: c27a20b278f2ac758447418ea4c8c61e27927d6a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/03/2021
ms.locfileid: "101693282"
---
# <a name="securing-managed-identities"></a>Защита управляемых удостоверений

Разработчики часто вызывают управление секретами и учетными данными, используемыми для защиты обмена данными между различными службами. Управляемые удостоверения — это безопасные Azure Active Directory удостоверения (Azure AD), созданные для предоставления удостоверений для ресурсов Azure.

## <a name="benefits-of-using-managed-identities-for-azure-resources"></a>Преимущества использования управляемых удостоверений для ресурсов Azure

Ниже приведены преимущества использования управляемых удостоверений.

* Управление учетными данными не требуется. С помощью управляемых удостоверений учетные данные полностью управляются, поворачиваются и защищаются с помощью Azure. Удостоверения автоматически предоставляются и удаляются с помощью ресурсов Azure. Управляемые удостоверения позволяют ресурсам Azure взаимодействовать со всеми службами, поддерживающими проверку подлинности Azure AD.

* Ни один из них (включая любого глобального администратора) не имеет доступа к учетным данным, поэтому они не могут случайно быть утечками, например, включенными в код.

## <a name="when-to-use-managed-identities"></a>Когда следует использовать управляемые удостоверения?

Управляемые удостоверения лучше использовать для обмена данными между службами, которые поддерживают проверку подлинности Azure AD. 

Исходная система запрашивает доступ к целевой службе. Любой ресурс Azure может быть исходной системой. Например, виртуальная машина Azure, экземпляр функции Azure и экземпляры служб приложений Azure поддерживают управляемые удостоверения.

[!VIDEO https://www.youtube.com/embed/5lqayO_oeEo]

### <a name="how-authentication-and-authorization-work"></a>Как работает проверка подлинности и авторизация

При использовании управляемых удостоверений исходная система может получить маркер из Azure AD, не имея исходного владельца для управления учетными данными. Azure управляет учетными данными. Маркер, полученный исходной системой, представлен целевой системе для проверки подлинности. 

Перед предоставлением доступа целевой системе необходимо пройти проверку подлинности (определение) и авторизовать исходную систему. Если целевая служба поддерживает аутентификацию на основе Azure AD, она принимает маркер доступа, выданный Azure AD. 

В Azure есть плоскость управления и плоскость данных. В плоскости управления вы создадите ресурсы и в плоскости данных, к которой вы обращаетесь. Например, вы создаете базу данных Cosmos на плоскости управления, но запрашиваете ее в плоскости данных.

После того как целевая система принимает маркер для проверки подлинности, она может поддерживать различные механизмы авторизации для своей плоскости управления и плоскости данных.

Все операции плоскости управления Azure управляются [Azure Resource Manager](https://docs.microsoft.com/azure/azure-resource-manager/management/overview) и используют [Управление доступом на основе ролей Azure](https://docs.microsoft.com/azure/role-based-access-control/overview). В плоскости данных каждая целевая система имеет собственный механизм авторизации. Служба хранилища Azure поддерживает Azure RBAC в плоскости данных. Например, приложения, использующие службы приложений Azure, могут считывать данные из хранилища Azure, а приложения, использующие службу Kubernetes Azure, могут считывать секреты, хранящиеся в Azure Key Vault.

Дополнительные сведения о плоскостях управления и данных см. в статье [операции с плоскостью управления и плоскостью данных — Azure Resource Manager](https://docs.microsoft.com/azure/azure-resource-manager/management/control-plane-and-data-plane).

В конечном итоге все службы Azure будут поддерживать управляемые удостоверения. Дополнительные сведения см. в статье [службы, поддерживающие управляемые удостоверения для ресурсов Azure](https://docs.microsoft.com/azure/active-directory/managed-identities-azure-resources/services-support-managed-identities).

##  

## <a name="types-of-managed-identities"></a>Типы управляемых удостоверений

Существует два типа управляемых удостоверений — назначенные системой и назначенные пользователем.

Управляемое удостоверение, назначенное системой, имеет следующие свойства:

* У них есть 1:1 отношений с ресурсом Azure. Например, существует уникальное управляемое удостоверение, связанное с каждой виртуальной машиной.

* Они привязаны к жизненному циклу ресурсов Azure. При удалении ресурса управляемое удостоверение, связанное с ним, автоматически удаляется, устраняя риск, связанный с потерянными учетными записями. 

Управляемые удостоверения, назначаемые пользователем, имеют следующие свойства:

* Жизненный цикл этих удостоверений не зависит от ресурса Azure, и вам необходимо управлять жизненным циклом. При удалении ресурса Azure назначенное ему управляемое удостоверение не удаляется автоматически.

* Одному назначенному пользователем управляемому удостоверению можно назначить любое количество ресурсов Azure (ноль или больше).

* Их можно создать заранее, а затем назначить ресурсу.

## <a name="find-managed-identity-service-principals-in-azure-ad"></a>Поиск субъектов-служб управляемых удостоверений в Azure AD

Существует несколько способов поиска управляемых удостоверений.

* Использование страницы "корпоративные приложения" в портал Azure

* Использование Microsoft Graph

### <a name="using-the-azure-portal"></a>Использование портала Azure

1. В Azure AD выберите корпоративное приложение.

2. Выберите фильтр "управляемые удостоверения". 

   ![Изображение экрана "все приложения" с раскрывающимся списком типов приложений "управляемые удостоверения".](./media/securing-service-accounts/service-accounts-managed-identities.png)

 

### <a name="using-microsoft-graph"></a>Использование Microsoft Graph

Список всех управляемых удостоверений в клиенте можно получить, выполнив следующий запрос GET для Microsoft Graph:

`https://graph.microsoft.com/v1.0/servicePrincipals?$filter=(servicePrincipalType eq 'ManagedIdentity') `

Эти запросы можно отфильтровать. Дополнительные сведения см. в документации Graph по [Get servicePrincipal](https://docs.microsoft.com/graph/api/serviceprincipal-get?view=graph-rest-1.0&tabs=http).

## <a name="assess-the-security-of-managed-identities"></a>Оценка безопасности управляемых удостоверений 

Оценить безопасность управляемых удостоверений можно следующими способами.

* Проверьте привилегии и убедитесь, что выбрана модель с наименьшим уровнем привилегий. Используйте следующий командлет PowerShell, чтобы получить разрешения, назначенные управляемым удостоверениям.

   ` Get-AzureADServicePrincipal | % { Get-AzureADServiceAppRoleAssignment -ObjectId $_ }`

 
* Убедитесь, что управляемое удостоверение не входит в состав каких-либо привилегированных групп, например группы администраторов.  
Это можно сделать, перечисляя членов групп с высоким уровнем привилегий с помощью PowerShell.

   `Get-AzureADGroupMember -ObjectId <String> [-All <Boolean>] [-Top <Int32>] [<CommonParameters>]`

* [Убедитесь, что вам известно, к каким ресурсам обращается управляемое удостоверение](https://docs.microsoft.com/azure/role-based-access-control/role-assignments-list-powershell).

## <a name="move-to-managed-identities"></a>Перейти к управляемым удостоверениям

Если вы используете субъект-службу или учетную запись пользователя Azure AD, оцените, можно ли использовать управляемый объект, чтобы исключить необходимость защиты учетных данных, их смены и управления ими. 

## <a name="next-steps"></a>Дальнейшие действия

**Сведения о создании управляемых удостоверений см. в следующих статьях:** 

[Создание управляемого удостоверения, назначенного пользователем](https://docs.microsoft.com/azure/active-directory/managed-identities-azure-resources/how-to-manage-ua-identity-portal). 

[Включение управляемого удостоверения, назначенного системой, во время создания ресурса](https://docs.microsoft.com/azure/active-directory/managed-identities-azure-resources/qs-configure-portal-windows-vm)

[Включение управляемого удостоверения, назначенного системой, в существующем ресурсе](https://docs.microsoft.com/azure/active-directory/managed-identities-azure-resources/qs-configure-portal-windows-vm)

**Дополнительные сведения об учетных записях служб см. в следующих статьях:**

[Общие сведения об учетных записях служб Azure Active Directory](service-accounts-introduction-azure.md)

[Защита субъектов-служб](service-accounts-principal.md)

[Управление учетными записями служб Azure](service-accounts-governing-azure.md)

[Вводные сведения о локальных учетных записях служб](service-accounts-on-poremises.md)

 

 

 
