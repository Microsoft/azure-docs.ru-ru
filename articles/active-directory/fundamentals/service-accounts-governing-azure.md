---
title: Управление учетными записями служб Azure Active Directory
description: Принципы и процедуры управления жизненным циклом учетных записей служб в Azure Active Directory.
services: active-directory
author: BarbaraSelden
manager: daveba
ms.service: active-directory
ms.workload: identity
ms.subservice: fundamentals
ms.topic: conceptual
ms.date: 3/1/2021
ms.author: baselden
ms.reviewer: ajburnle
ms.custom: it-pro, seodec18
ms.collection: M365-identity-device-management
ms.openlocfilehash: 7f540ab40a14af09aa8667860286021f572eb6f1
ms.sourcegitcommit: 772eb9c6684dd4864e0ba507945a83e48b8c16f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "104587905"
---
# <a name="governing-azure-ad-service-accounts"></a>Управление учетными записями службы Azure AD

В Azure Active Directory (Azure AD) есть три типа учетных записей служб: [управляемые удостоверения](service-accounts-managed-identities.md), [субъекты-службы](service-accounts-principal.md)и учетные записи пользователей, используемые как учетные записи служб. При создании этих учетных записей служб для автоматического использования им предоставляются разрешения на доступ к ресурсам в Azure и Azure AD. К ресурсам могут относиться службы Microsoft 365 Services, программное обеспечение как услуга (SaaS), пользовательские приложения, базы данных, системы отдела кадров и т. д. Управление учетными записями службы Azure AD означает, что вы управляете созданием, разрешениями и жизненным циклом, чтобы обеспечить безопасность и непрерывность.

> [!IMPORTANT] 
> Не рекомендуется использовать учетные записи пользователей как учетные записи служб, так как они по своей природе менее безопасны. Сюда входят локальные учетные записи служб, которые синхронизируются с Azure AD, так как они не преобразуются в субъекты-службы. Вместо этого рекомендуется использовать управляемые удостоверения или субъекты-службы. Обратите внимание, что в настоящее время использование политик условного доступа недоступно для субъектов-служб, но эта функция поступает.


## <a name="plan-your-service-account"></a>Планирование учетной записи службы

Перед созданием учетной записи службы или регистрацией приложения Задокументируйте сведения о ключе учетной записи службы. Наличие документированных сведений упрощает эффективное отслеживание и управление учетной записью. Мы рекомендуем собирать следующие данные и отслеживать их в централизованной базе данных управления конфигурацией (CMDB).

| Данные| Описание| Сведения |
| - | - | - |
| Владелец| Пользователь или группа, которые являются учетными записями для управления учетной записью службы и наблюдения за ними.| Подготавливает владельца с необходимыми разрешениями для мониторинга учетной записи и реализации способа устранения проблем. Устранение проблем может осуществляться владельцем или с помощью запроса. |
| Цель| Как будет использоваться учетная запись.| Сопоставьте учетную запись службы с определенной службой, приложением или сценарием. Избегайте создания нескольких учетных записей служб. |
| Разрешения (области)| Ожидаемый набор разрешений.| Задокументируйте ресурсы, к которым он будет обращаться, и разрешения для этих ресурсов. |
| Ссылка CMDB| Ссылка на ресурсы для доступа и сценарии, в которых используется учетная запись службы.| Убедитесь, что вы документально задокументированы владельцы ресурсов и сценариев, чтобы вы могли передавать все необходимые изменения. |
| Оценка угроз для безопасности| Риск и влияние на бизнес, если учетная запись должна быть скомпрометирована.| Используйте эти сведения, чтобы ограничить область разрешений и определить, кто должен иметь доступ к данным учетной записи. |
| Период для проверки| Расписание, в соответствии с которым учетная запись службы должна быть проверена владельцем.| Используйте этот раздел, чтобы запланировать проверку связи и проверок. Документирование действий, которые необходимо выполнить, если проверка не выполняется в определенное время после запланированного периода проверки. |
| Время существования| Ожидаемое максимальное время существования учетной записи.| Используйте этот параметр, чтобы запланировать обмен данными с владельцем, а в конце концов удалить учетные записи. Там, где это возможно, задайте дату истечения срока действия учетных данных, при которой учетные данные не могут быть автоматически изменяться. |
| Имя| Стандартизированное имя учетной записи| Создайте схему именования для всех учетных записей служб, чтобы можно было легко выполнять поиск, сортировку и фильтрацию учетных записей служб. |


## <a name="use-the-principle-of-least-privileges"></a>Использование принципа наименьших привилегий
Предоставьте учетной записи службы только те разрешения, которые необходимы для выполнения ее задач. Если учетной записи службы требуются высокоуровневые разрешения, например уровень привилегий глобального администратора, то следует оценить причину и попробовать уменьшить необходимые разрешения.

Для привилегий учетной записи службы рекомендуются следующие методы.

**Разрешения**

* Не присваивайте учетным записям служб встроенные роли. Вместо этого используйте [модель предоставления разрешений OAuth2 для Microsoft Graph](/graph/api/resources/oauth2permissiongrant),

* Если субъекту-службе должна быть назначена привилегированная роль, рассмотрите возможность назначения [пользовательской роли](../roles/custom-create.md) с конкретными обязательными привилегированными пользователями в режиме с ограниченным временем.

* Не включайте учетные записи служб в качестве членов групп с повышенными разрешениями. 

* [Используйте PowerShell для перечисления членов привилегированных ролей](/powershell/module/azuread/get-azureaddirectoryrolemember), таких как   
`Get-AzureADDirectoryRoleMember`и фильтр для ObjectType "субъект-служба".

   или используйте  
`Get-AzureADServicePrincipal | % { Get-AzureADServiceAppRoleAssignment -ObjectId $_ }`

* [Используйте области OAuth 2,0](../develop/v2-permissions-and-consent.md) , чтобы ограничить функциональность, с помощью которой учетная запись службы может получить доступ к ресурсу.
* Субъекты-службы и управляемые удостоверения могут использовать области OAuth 2,0 в делегированном контексте, который олицетворяет пользователя, выполнившего вход, или как учетную запись службы в контексте приложения. В контексте приложения нет входа в систему.

* Убедитесь, что учетные записи службы области запрашивают ресурсы, чтобы убедиться, что они подходят. Например, если учетная запись запрашивает файлы. ReadWrite. ALL, оцените, действительно ли она требует только File. Read. ALL. Дополнительные сведения о разрешениях см. в разделе [Microsoft Graph ссылки на разрешения](/graph/permissions-reference).

* Убедитесь, что вы доверяете разработчику приложения или API с доступом к ресурсам.

**Длительность**

* Ограничьте учетные данные учетной записи службы (секрет клиента, сертификат) до ожидаемого периода использования.

* Планирование периодических проверок использования и назначения учетных записей служб. Убедитесь, что проверки проведены до истечения срока действия учетной записи.

Получив четкое представление о назначении, области и необходимых разрешениях, создайте учетную запись службы. 

[Создание и использование управляемых удостоверений](../../app-service/overview-managed-identity.md?tabs=dotnet)

[Создание и использование субъектов-служб](../develop/howto-create-service-principal-portal.md)

По возможности используйте управляемое удостоверение. Если вы не можете использовать управляемое удостоверение, используйте субъект-службу. Если вы не можете использовать субъект-службу, то будет использоваться только учетная запись пользователя Azure AD.

 

## <a name="build-a-lifecycle-process"></a>Создание процесса жизненного цикла

Управление жизненным циклом учетной записи службы начинается с планирования и заканчивается окончательным удалением. 

В этой статье ранее была рассмотрена часть планирования и создания. Кроме того, необходимо отслеживать, просматривать разрешения, определять непрерывное использование учетной записи и в конечном счете отменять предоставление учетной записи.

### <a name="monitor-service-accounts"></a>Мониторинг учетных записей служб

Упреждающий мониторинг учетных записей служб позволяет убедиться, что шаблоны использования учетной записи службы отражают предполагаемые закономерности и что учетная запись службы по-прежнему используется активно.

**Собирайте и отслеживайте входы в учетную запись службы с помощью одного из следующих методов:**

* Использование журналов Sign-In Azure AD на портале Azure AD.

* Экспорт журналов Sign-In Azure AD в службу [хранилища Azure](../../storage/index.yml), [концентраторы событий Azure](../../event-hubs/index.yml)или [Azure Monitor](../../azure-monitor/logs/data-platform-logs.md).


![Снимок экрана, демонстрирующий экран входа субъекта-службы.](./media/securing-service-accounts/service-accounts-govern-azure-1.png)

**Аналитика, которую следует искать в журналах Sign-In, включает:**

* Существуют ли учетные записи служб, которые больше не входят в клиент?

* Меняются ли шаблоны входа учетных записей служб?

Мы рекомендуем экспортировать журналы входа в Azure AD и импортировать их в существующие средства управления сведениями о безопасности и событий (SIEM), такие как Azure Sentinel. Используйте SIEM для создания предупреждений и панелей мониторинга.

### <a name="review-service-account-permissions"></a>Проверка разрешений учетной записи службы

Регулярно просматривайте предоставленные разрешения и области, доступ к которым осуществляется с помощью учетных записей служб, чтобы узнать, можно ли их сократить.

* Используйте [PowerShell](/powershell/module/azuread/get-azureadserviceprincipaloauth2permissiongrant) , чтобы [создать автоматизацию для проверки и документирования](https://gist.github.com/psignoret/41793f8c6211d2df5051d77ca3728c09) областей, в которые предоставляется разрешение на предоставление учетной записи службы.

* Используйте PowerShell для [просмотра учетных данных существующих субъектов-служб](https://github.com/AzureAD/AzureADAssessment) и проверки их допустимости.

* Не устанавливайте учетные данные субъекта-службы в значение "никогда не истекает".

* По возможности используйте сертификаты или учетные данные, хранящиеся в Azure KeyVault.

Бесплатный пример PowerShell от Майкрософт собирает сведения о предоставлении и учетных данных субъекта-службы OAuth2, записывает их в файл значений с разделителями-запятыми (CSV) и Power BI образец панели мониторинга для интерпретации и использования данных. Дополнительные сведения см. в разделе [AzureAD/азуреадассессмент: Инструментарий для оценки состояния и конфигурации клиента Azure AD (GitHub.com).](https://github.com/AzureAD/AzureADAssessment)

### <a name="recertify-service-account-use"></a>Использование учетной записи службы повторной сертификации

Создайте процесс проверки, чтобы учетные записи служб регулярно рассматривались владельцами, а также группой безопасности или ИТ-специалистами через регулярные интервалы. 

**Этот процесс должен включать:**

* Как определить цикл проверки учетных записей служб (должен быть документирован в CMDB).

* Взаимодействие с владельцем и безопасностью или группами ИТ перед началом рецензирования.

* Время и содержимое предупреждающего сообщения, если проверка пропущена.

* Инструкции о том, что делать, если владельцам не удается проверить или ответить. Например, может потребоваться отключить (но не удалить) учетную запись до завершения проверки.

* Инструкции по определению вышестоящей и подчиненной зависимостей, а также уведомление других владельцев ресурсов о любых эффектах.

**В ходе проверки должен быть указан владелец и ИТ-партнер, подтверждающий, что:**

* Учетная запись все еще необходима.

* Разрешения, предоставленные учетной записи, являются достаточными и необходимыми, или запрашивается изменение.

* Доступ к учетной записи и ее учетным данным контролируется.

* Учетные данные, используемые учетной записью, подходят в отношении риска, с которым была оценена учетная запись (тип учетных данных и время существования учетных данных).

* Оценка риска учетной записи не изменилась с момента последней пересертификации

* Обновление на ожидаемое время существования учетной записи и Следующая дата пересертификации.

### <a name="deprovision-service-accounts"></a>Отменить подготовку учетных записей служб

* * Отмените предоставление учетных записей служб при следующих обстоятельствах: * * * *

* Скрипт или приложение, для которых была создана учетная запись службы, снято с учета.

* Функция в скрипте или приложении, для которой используется учетная запись службы (например, доступ к определенному ресурсу), будет прекращена.


* Учетная запись службы заменяется другой учетной записью службы.

* Срок действия учетных данных истек, или учетная запись не является функциональной, и нет жалоб.

**Процессы для отмены инициализации должны включать следующие задачи.**

1. После отмены подготовки связанного приложения или скрипта с помощью учетной записи службы [Отслеживайте входы](../reports-monitoring/concept-sign-ins.md#sign-ins-report) и доступ к ресурсам.

   * Если учетная запись все еще активна, определите, как она используется, прежде чем выполнять дальнейшие действия.
 
2. Если это управляемое удостоверение службы, отключите учетную запись службы от входа, но не удаляйте ее из каталога.

3. Отозвать назначения ролей и предоставление согласия OAuth2 для учетной записи службы.

4. После определенного периода и появлении достаточного предупреждения владельцам удалите учетную запись службы из каталога.

## <a name="next-steps"></a>Дальнейшие действия
Дополнительные сведения о защите учетных записей служб Azure см. в следующих статьях:

[Общие сведения об учетных записях служб Azure](service-accounts-introduction-azure.md)

[Защита управляемых удостоверений](service-accounts-managed-identities.md)

[Обеспечение безопасности принципов служб](service-accounts-principal.md)




 

