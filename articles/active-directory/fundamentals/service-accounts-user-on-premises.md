---
title: Защита учетных записей служб на основе пользователей | Azure Active Directory
description: Рекомендации по защите локальных учетных записей пользователей.
services: active-directory
author: BarbaraSelden
manager: daveba
ms.service: active-directory
ms.workload: identity
ms.subservice: fundamentals
ms.topic: conceptual
ms.date: 2/15/2021
ms.author: baselden
ms.reviewer: ajburnle
ms.custom: it-pro, seodec18
ms.collection: M365-identity-device-management
ms.openlocfilehash: e484bdda33142024f2067649eaa67042fe7776f8
ms.sourcegitcommit: 867cb1b7a1f3a1f0b427282c648d411d0ca4f81f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "100417957"
---
# <a name="securing-user-based-service-accounts-in-active-directory"></a>Защита учетных записей служб на основе пользователей в Active Directory

Локальные учетные записи пользователей являются традиционным подходом к защите служб, работающих под управлением Windows. Используйте эти учетные записи в качестве последнего средства, если служба не поддерживает глобальные управляемые учетные записи служб (Gmsa) и автономные управляемые учетные записи служб (Смсас). Сведения о выборе лучшего типа учетной записи см. в статье обзор учетных записей локальной службы. Также проверьте, можно ли переместить службу для использования учетной записи службы Azure, такой как управляемое удостоверение или принцип службы. 

Можно создать локальные учетные записи пользователей, чтобы предоставить контекст безопасности для служб и предоставить привилегии, необходимые службам для доступа к локальным и сетевым ресурсам. Для них требуется ручное управление паролями, аналогично любой учетной записи пользователя Active Directory (AD). Администраторы служб и доменов должны наблюдать за надежными процессами управления паролями, чтобы обеспечить безопасность этих учетных записей.

При использовании учетной записи пользователя в качестве учетной записи службы используйте ее только для одной службы. Назовите его таким образом, чтобы он был ясно, что это учетная запись службы и для какой службы. 

## <a name="benefits-and-challenges"></a>Преимущества и проблемы

Преимущества

Локальные учетные записи пользователей — это наиболее универсальный тип учетной записи для использования со службами. Учетные записи пользователей, используемые в качестве учетных записей служб, могут управляться всеми политиками, регулирующими обычные учетные записи пользователей. С другой стороны, используйте их только в том случае, если вы не можете использовать MSA. Также оцените, является ли учетная запись компьютера лучшим вариантом. 

Проблемы с локальными учетными записями пользователей

При использовании локальных учетных записей пользователей связаны следующие проблемы.

| Сложности| Устранение проблем |
| - | - |
| Управление паролями — это процесс, выполняемый вручную, который может привести к более слабому снижению безопасности и простою службы.| Убедитесь, что сложность и изменение пароля управляются надежным процессом, который гарантирует регулярное обновление с помощью надежного пароля. <br> Координирование смены пароля с помощью обновления пароля в службе, что приведет к простою службы. |
| Определение локальных учетных записей пользователей, которые работают как учетные записи служб, может быть трудной задачей.| Документирование и обслуживание записей учетных записей служб, развернутых в среде. <br> Отследите имя учетной записи и ресурсы, к которым им назначен доступ. <br> Рассмотрите возможность добавления префикса svc_ ко всем учетным записям пользователей, используемым в качестве учетных записей служб. |


## <a name="find-on-premises-user-accounts-used-as-service-accounts"></a>Поиск локальных учетных записей пользователей, используемых в качестве учетных записей служб

Локальные учетные записи пользователей аналогичны учетным записям других пользователей AD. Следовательно, может быть трудно найти эти учетные записи, так как не существует одного атрибута учетной записи пользователя, идентифицирующего ее как учетную запись службы. 

Рекомендуется создать легко узнаваемое соглашение об именовании для любой учетной записи пользователя, используемой в качестве учетной записи службы.

Например, добавьте в качестве префикса "Service-" и назовите службу: "Service-Хрдатаконнектор".

Для поиска этих учетных записей служб можно использовать некоторые из приведенных ниже индикаторов. Однако они могут не найти все эти учетные записи.

* Учетные записи, доверенные для делегирования.

* Учетные записи с именами субъектов-служб.

* Учетные записи, пароли которых не ограничены.

Чтобы найти локальные учетные записи пользователей, созданные для служб, можно выполнить следующие команды PowerShell.

### <a name="find-accounts-trusted-for-delegation"></a>Поиск учетных записей, заслуживающих доверия для делегирования

```PowerShell

Get-ADObject -Filter {(msDS-AllowedToDelegateTo -like '*') -or (UserAccountControl -band 0x0080000) -or (UserAccountControl -band 0x1000000)} -prop samAccountName,msDS-AllowedToDelegateTo,servicePrincipalName,userAccountControl | select DistinguishedName,ObjectClass,samAccountName,servicePrincipalName, @{name='DelegationStatus';expression={if($_.UserAccountControl -band 0x80000){'AllServices'}else{'SpecificServices'}}}, @{name='AllowedProtocols';expression={if($_.UserAccountControl -band 0x1000000){'Any'}else{'Kerberos'}}}, @{name='DestinationServices';expression={$_.'msDS-AllowedToDelegateTo'}}

```

### <a name="find-accounts-with-service-principle-names"></a>Поиск учетных записей с именами субъектов служб

```PowerShell

Get-ADUser -Filter * -Properties servicePrincipalName | where {$_.servicePrincipalName -ne $null}

```

 

### <a name="find-accounts-with-passwords-set-to-never-expire"></a>Поиск учетных записей с паролями, для которых задан бессрочный срок действия

```PowerShell

Get-ADUser -Filter * -Properties PasswordNeverExpires | where {$_.PasswordNeverExpires -eq $true}

```


Кроме того, можно проводить аудит доступа к конфиденциальным ресурсам и архивировать журналы аудита в систему управления сведениями о безопасности и событиями (SIEM). Используя такие системы, как Azure Log Analytics или Azure Sentinel, вы можете искать и анализировать учетные записи служб и выполнять их анализ.

## <a name="assess-security-of-on-premises-user-accounts"></a>Оценка безопасности локальных учетных записей пользователей

Оцените безопасность локальных учетных записей пользователей, используемых в качестве учетных записей служб, с помощью следующих критериев.

* Что такое политика управления паролями?

* Является ли учетная запись членом любой привилегированной группы?

* Имеет ли учетная запись доступ на чтение и запись к важным ресурсам?

### <a name="mitigate-potential-security-issues"></a>Устранение потенциальных проблем безопасности

В следующей таблице показаны потенциальные проблемы безопасности и соответствующие меры по их устранению для локальных учетных записей пользователей.

| Проблемы с безопасностью| Устранение проблем |
| - | - |
| Управление паролями|* Убедитесь, что сложность и изменение пароля управляются надежным процессом, который гарантирует регулярное обновление с соблюдением требований к надежному паролю. <br> * Координация смены пароля с помощью обновления пароля позволяет сократить время простоя службы. |
| Учетная запись является членом привилегированных групп.| Проверка членства в группах. Удалите учетную запись из привилегированных групп. Предоставьте учетной записи только права и разрешения, необходимые для запуска службы (обратитесь к поставщику услуг). Например, вы можете запретить локальный вход или запретить интерактивный вход. |
| Учетная запись имеет доступ на чтение и запись к конфиденциальным ресурсам.| Аудит доступа к конфиденциальным ресурсам. Архивируйте журналы аудита в SIEM (Azure Log Analytics или Azure Sentinel) для анализа. Исправлять разрешения для ресурсов, если обнаружен нежелательный уровень доступа. |


## <a name="move-to-more-secure-account-types"></a>Переход к более безопасным типам учетных записей

Корпорация Майкрософт не рекомендует, чтобы клиенты использовали локальные учетные записи пользователей в качестве учетных записей служб. Для любой службы, использующей этот тип учетной записи, следует оценить, можно ли настроить ее для использования gMSA или sMSA.

Кроме того, оцените, может ли сама служба быть перемещена в Azure, чтобы можно было использовать более безопасные типы учетных записей служб. 

## <a name="next-steps"></a>Дальнейшие действия
См. следующие статьи о защите учетных записей служб.

* [Вводные сведения о локальных учетных записях служб](service-accounts-on-premises.md)

* [Безопасная групповая управляемая учетная запись службы](service-accounts-group-managed.md)

* [Защищенные автономные управляемые учетные записи служб](service-accounts-standalone-managed.md)

* [Защита учетных записей компьютеров](service-accounts-computer.md)

* [Защита учетных записей пользователей](service-accounts-user-on-premises.md)

* [Управление локальными учетными записями служб](service-accounts-govern-on-premises.md)

 
