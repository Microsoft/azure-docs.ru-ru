---
title: Журналы подготовки на портале Azure Active Directory (Предварительная версия) | Документация Майкрософт
description: Общие сведения о подготовке журналов подготовки отчетов на портале Azure Active Directory
services: active-directory
documentationcenter: ''
author: MarkusVi
manager: daveba
editor: ''
ms.assetid: 4b18127b-d1d0-4bdc-8f9c-6a4c991c5f75
ms.service: active-directory
ms.devlang: na
ms.topic: conceptual
ms.tgt_pltfrm: na
ms.workload: identity
ms.subservice: report-monitor
ms.date: 1/19/2021
ms.author: markvi
ms.reviewer: arvinh
ms.collection: M365-identity-device-management
ms.openlocfilehash: 4c7d02b48d30fa558f8fd12f92705046dab74057
ms.sourcegitcommit: a0c1d0d0906585f5fdb2aaabe6f202acf2e22cfc
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/21/2021
ms.locfileid: "98624241"
---
# <a name="provisioning-reports-in-the-azure-active-directory-portal-preview"></a>Подготовка отчетов на портале Azure Active Directory (Предварительная версия)

Архитектура создания отчетов в Azure Active Directory (Azure AD) состоит из следующих компонентов:

- **Действие** 
    - **Входы** — сведения об использовании управляемых приложений и действиях входа пользователей.
    - **Журналы аудита**  -  [Журналы аудита](concept-audit-logs.md) предоставляют сведения о действиях пользователей и управления группами, управляемых приложениях и действиях с каталогами.
    - **Журналы подготовки** — укажите системные действия для пользователей, групп и ролей, подготовленных службой подготовки Azure AD. 

- **Безопасность** 
    - **Рискованные входы** . [рискованный вход](../identity-protection/overview-identity-protection.md) — это индикатор попытки входа, которая могла быть выполнена пользователем, который не является законным владельцем учетной записи пользователя.
    - **Пользователи, помеченные для риска** — [рискованный пользователь](../identity-protection/overview-identity-protection.md) является индикатором для учетной записи пользователя, которая могла быть скомпрометирована.

В этом разделе приводятся общие сведения о журналах подготовки. Они дают ответы на такие вопросы: 

* Какие группы были успешно созданы в ServiceNow?
* Какие пользователи были успешно удалены из Adobe?
* Какие пользователи из Workday были успешно созданы в Active Directory? 

## <a name="prerequisites"></a>Предварительные требования

### <a name="who-can-access-the-data"></a>Кто имеет доступ к данным?
* Владельцы приложений могут просматривать журналы для приложений, которыми они владеют
* Пользователи в роли "администратор безопасности", "читатель отчетов", "читатель отчета", "Администратор приложения" и "Администратор облачных приложений"
* Пользователи в пользовательской роли с [разрешением провисионинглогс](https://docs.microsoft.com/azure/active-directory/roles/custom-enterprise-app-permissions#full-list-of-permissions)
* Глобальные администраторы.


### <a name="what-azure-ad-license-do-you-need-to-access-provisioning-activities"></a>Какая лицензия Azure AD необходима для доступа к действиям по подготовке?

С вашим клиентом должна быть связана лицензия Azure AD Premium, чтобы просмотреть отчет о действиях по подготовке. Чтобы обновить выпуск Azure Active Directory, ознакомьтесь со статьей [Регистрация для работы с выпусками Azure Active Directory Premium](../fundamentals/active-directory-get-started-premium.md). 


## <a name="ways-of-interacting-with-the-provisioning-logs"></a>Способы взаимодействия с журналами подготовки 
У клиентов есть четыре способа взаимодействия с журналами подготовки:

1. Доступ к журналам из портал Azure, как описано ниже.
1. Потоковая передача журналов подготовки в [Azure Monitor](https://docs.microsoft.com/azure/active-directory/app-provisioning/application-provisioning-log-analytics), что обеспечивает расширенное хранение данных, создание пользовательской панели мониторинга, оповещений и запросов.
1. Запрос [Microsoft Graph API](https://docs.microsoft.com/graph/api/resources/provisioningobjectsummary?view=graph-rest-beta) для журналов подготовки.
1. Загрузка журналов подготовки в виде CSV-файла или JSON.

## <a name="access-the-logs-from-the-azure-portal"></a>Доступ к журналам из портал Azure
Чтобы получить доступ к журналам подготовки, выберите **журналы подготовки** в разделе **мониторинг** колонки **Azure Active Directory** в [портал Azure](https://portal.azure.com). Для отображения некоторых записей подготовки на портале может потребоваться до двух часов.

![Подготовка журналов](./media/concept-provisioning-logs/access-provisioning-logs.png "Подготовка журналов")


Журнал подготовки имеет представление списка по умолчанию, которое показывает:

- Удостоверение
- Действие
- Исходная система
- Целевая система
- Состояние
- Дата


![Столбцы по умолчанию](./media/concept-provisioning-logs/default-columns.png "Столбцы по умолчанию")

Можно настроить представление списка, щелкнув **столбцы** на панели инструментов.

![Выбор столбца](./media/concept-provisioning-logs/column-chooser.png "Выбор столбца")

Здесь вы можете добавить или удалить отображаемые поля.

![Доступные столбцы](./media/concept-provisioning-logs/available-columns.png "Доступные столбцы")

Чтобы получить более подробную информацию, выберите элемент в списке.

![Подробные сведения](./media/concept-provisioning-logs/steps.png "Filter")


## <a name="filter-provisioning-activities"></a>Фильтрация действий по подготовке

Вы можете отфильтровать данные подготовки. Некоторые значения фильтров заполняются динамически на основе клиента. Если, например, у вас нет каких-либо событий создания в клиенте, параметр фильтра создать не будет.
В представлении по умолчанию можно выбрать следующие фильтры:

- Идентификация
- Дата
- Состояние
- Действие


![Добавление фильтров](./media/concept-provisioning-logs/default-filter.png "Filter")

Фильтр **удостоверений** позволяет указать имя или удостоверение, которое вас интересуют. Этим удостоверением может быть пользователь, группа, роль или другой объект. Можно выполнить поиск по имени или ИДЕНТИФИКАТОРу объекта. Идентификатор зависит от сценария. Например, при подготовке объекта из Azure AD в SalesForce идентификатор источника — это идентификатор объекта пользователя в Azure AD, а TargetID — идентификатор пользователя в Salesforce. При подготовке от Workday к Active Directoryу идентификатор источника — это идентификатор сотрудника рабочего дня Workday. Обратите внимание, что имя пользователя может не всегда присутствовать в столбце идентификаторов. Всегда будет один идентификатор. 


Фильтр **дат** позволяет определить интервал времени для возвращаемых данных.  
Доступны следующие значения:

- 1 месяц
- 7 дней
- 30 дней
- 24 часа
- Настраиваемый интервал

При выборе настраиваемого временного интервала можно настроить начальную и конечную даты.


В фильтре **Состояние** можете выбрать:

- Все
- Успешно
- Failure
- Пропущено



Фильтр **действий** позволяет фильтровать:

- Создание 
- Update
- DELETE
- Отключить
- Другие

Кроме того, в фильтры представления по умолчанию можно также задать следующие фильтры:

- Идентификатор задания
- Идентификатор цикла
- Идентификатор изменения
- Идентификатор источника
- Идентификатор целевого объекта
- Развертывание


![Выбор поля](./media/concept-provisioning-logs/add-filter.png "Выбор поля")


- **Идентификатор задания** — уникальный идентификатор задания, связанный с каждым приложением, для которого включена подготовка.   

- **ИД цикла** — уникальный идентификатор цикла подготовки. Вы можете предоставить этот идентификатор для поддержки, чтобы найти цикл, в котором произошло это событие.

- **Изменить идентификатор** — уникальный идентификатор события подготовки. Вы можете поделиться этим ИДЕНТИФИКАТОРом для поддержки поиска события подготовки.   


- **Исходная система** — позволяет указать, откуда будет подготовлено удостоверение. Например, при подготовке объекта из Azure AD в ServiceNow исходная система — это Azure AD. 

- **Целевая система** — позволяет указать, куда будет подготовлено удостоверение. Например, при подготовке объекта из Azure AD в ServiceNow используется целевая система ServiceNow. 

- **Приложение** — позволяет отображать только записи приложений с отображаемым именем, содержащим определенную строку.

 

## <a name="provisioning-details"></a>Сведения о подготовке 

При выборе элемента в представлении списка подготовки вы получите дополнительные сведения об этом элементе.
Подробные сведения группируются по следующим категориям:

- Шаги

- Устранение неполадок и рекомендации

- Измененные свойства

- Сводка


![Сведения о подготовке](./media/concept-provisioning-logs/provisioning-tabs.png "Вкладки")



### <a name="steps"></a>Шаги

На вкладке **шаги** описаны действия по подготовке объекта. Подготовка объекта может состоять из четырех шагов: 

- Импорт объекта
- Определить, находится ли объект в области
- Совпадение между источником и целевым объектом
- Инициализация объекта (выполнение действия. это может быть создание, обновление, удаление или отключение)



![На снимке экрана показана вкладка действия, на которой показаны этапы подготовки.](./media/concept-provisioning-logs/steps.png "Filter")


### <a name="troubleshoot-and-recommendations"></a>Устранение неполадок и рекомендации


На вкладке **Диагностика и рекомендации** содержится код и причина ошибки. Сведения об ошибке доступны только в случае сбоя. 


### <a name="modified-properties"></a>Измененные свойства

**Измененные свойства** показывают старое значение и новое значение. В случаях, когда нет старого значения, столбец старого значения остается пустым. 

### <a name="summary"></a>Сводка

На вкладке **Сводка** представлен обзор того, что случилось и идентификаторы для объекта в исходной и целевой системе. 

## <a name="download-logs-as-csv-or-json"></a>Скачать журналы в формате CSV или JSON

Журналы подготовки можно загрузить для последующего использования, перейдя к журналам в портал Azure и нажав кнопку Загрузить. Файл будет отфильтрован на основе выбранных критериев фильтра. Вы можете сделать фильтры более конкретными, чтобы сократить время загрузки и размер загружаемых данных. Загрузка CSV-файла состоит из трех файлов:

* Провисионинглогс: скачивает все журналы, за исключением шагов подготовки и измененных свойств.
* ProvisioningLogs_ProvisioningSteps: содержит шаги подготовки и идентификатор изменения. Идентификатор изменения можно использовать для объединения события с другими двумя файлами.
* ProvisioningLogs_ModifiedProperties: содержит атрибуты, которые были изменены, и идентификатор изменения. Идентификатор изменения можно использовать для объединения события с другими двумя файлами.

#### <a name="opening-the-json-file"></a>Открытие JSON файла
Чтобы открыть JSON-файл, используйте текстовый редактор, например [код Microsoft Visual Studio](https://aka.ms/vscode). Visual Studio Code облегчает чтение, предоставляя выделение синтаксиса. JSON-файл также можно открыть с помощью браузеров в неизменяемом формате, например [Microsoft ребро](https://aka.ms/msedge) 

#### <a name="prettifying-the-json-file"></a>Преттифинг JSON файл
Файл JSON загружается в формате минифицированные, чтобы уменьшить размер загружаемого файла. Это, в свою очередь, может усложнить чтение полезных данных. Ознакомьтесь с двумя вариантами переработаны файла:

1. Использование Visual Studio Code для форматирования JSON

Следуйте инструкциям, указанным [здесь](https://code.visualstudio.com/docs/languages/json#_formatting) , чтобы отформатировать JSON файл с помощью Visual Studio Code.

2. Использование PowerShell для форматирования JSON

Этот скрипт выводит JSON в формате доработан с символами табуляции и пробелами. 

` $JSONContent = Get-Content -Path "<PATH TO THE PROVISIONING LOGS FILE>" | ConvertFrom-JSON`

`$JSONContent | ConvertTo-Json > <PATH TO OUTPUT THE JSON FILE>`

#### <a name="parsing-the-json-file"></a>Анализ JSON файла

Ниже приведены примеры команд для работы с файлом JSON с помощью PowerShell. Вы можете использовать любой язык программирования, с которым вам удобно работать.  

Сначала [прочтите файл JSON](https://docs.microsoft.com/powershell/module/microsoft.powershell.utility/convertfrom-json?view=powershell-7.1) , выполнив команду:

` $JSONContent = Get-Content -Path "<PATH TO THE PROVISIONING LOGS FILE>" | ConvertFrom-JSON`

Теперь данные можно анализировать по сценарию. Вот несколько примеров: 

1. Вывод всех Жобидс в Жсонфиле

`foreach ($provitem in $JSONContent) { $provitem.jobId }`

2. Выводить все Чанжеидс для событий, в которых действие было "создать"

`foreach ($provitem in $JSONContent) { `
`   if ($provItem.action -eq 'Create') {`
`       $provitem.changeId `
`   }`
`}`

## <a name="what-you-should-know"></a>Необходимая информация

- Портал Azure сохраняет данные о подготовке в течение 30 дней, если у вас выпуск Premium и 7 дней, если у вас есть бесплатный выпуск. Журналы подготовки можно опубликовать в [log Analytics](../app-provisioning/application-provisioning-log-analytics.md) для хранения за пределами 30 дней. 

- Атрибут идентификатора изменения можно использовать в качестве уникального идентификатора. Это, например, полезно при взаимодействии со службой поддержки продукта.

- Для пользователей, которые не находятся в области, могут отображаться пропущенные события. Это ожидается, особенно если для области синхронизации задано значение все пользователи и группы. Наша служба будет оценивать все объекты в клиенте, даже те, которые выходят за пределы области. 

- Журналы подготовки сейчас недоступны в облаке для государственных организаций. Если вы не можете получить доступ к журналам подготовки, используйте журналы аудита в качестве временного решения. 

- Журналы подготовки не отображают импорты ролей (применяется к AWS, SalesForce и ZenDesk). Журналы для импорта ролей можно найти в журналах аудита. 

## <a name="error-codes"></a>Коды ошибок

Используйте таблицу ниже, чтобы лучше понять, как устранять ошибки, которые могут находиться в журналах подготовки. Для получения сведений об отсутствующих кодах ошибок оставьте отзыв, используя ссылку в нижней части этой страницы. 

|Код ошибки|Описание|
|---|---|
|Конфликт, Ентриконфликт|Исправьте конфликтующие значения атрибутов в Azure AD или приложении или проверьте соответствующую конфигурацию атрибута, если конфликтующая учетная запись пользователя должна быть сопоставлена и сделана. Дополнительные сведения о настройке соответствующих атрибутов см. в следующей [документации](../app-provisioning/customize-application-attributes.md) .|
|TooManyRequests|Целевое приложение отклонило попытку обновления пользователя, так как оно перегружено и получает слишком много запросов. Ничего делать не нужно. Эта попыток будет автоматически прекращена. Корпорация Майкрософт также уведомила об этой ошибке.|
|InternalServerError |Целевое приложение вернуло непредвиденную ошибку. Возможно, существует проблема службы с целевым приложением, препятствующее его работе. Эта попытки будет автоматически прекращена через 40 минут.|
|ИнсуффиЦиентригхтс, Месодноталловед, Нотпермиттед, несанкционированный| Azure AD удалось пройти проверку подлинности в целевом приложении, но ему не разрешено выполнять обновление. Ознакомьтесь с инструкциями, предоставленными целевым приложением, а также с [руководством](../saas-apps/tutorial-list.md)по соответствующему приложению.|
|унпроцессаблинтити|Целевое приложение вернуло непредвиденный ответ. Конфигурация целевого приложения может быть неправильной, либо может возникнуть проблема с целевым приложением, которое препятствует работе этого приложения.|
|вебексцептионпротоколеррор |При подключении к целевому приложению произошла ошибка протокола HTTP. Ничего делать не нужно. Эта попытки будет автоматически прекращена через 40 минут.|
|инвалиданчор|Пользователь, который ранее был создан или сопоставлен с помощью службы подготовки, больше не существует. Убедитесь, что пользователь существует. Чтобы принудительно выполнить повторное сопоставление всех пользователей, используйте MS API Graph для [перезапуска задания](/graph/api/synchronization-synchronizationjob-restart?tabs=http&view=graph-rest-beta). Перезапуск подготовки приведет к запуску начального цикла, выполнение которого может занять некоторое время. Он также удаляет кэш, используемый службой подготовки, что означает, что все пользователи и группы в клиенте должны повторно оцениваться, а некоторые события подготовки могут быть удалены.|
|NotImplemented | Целевое приложение вернуло непредвиденный ответ. Возможно, Конфигурация приложения неверна или существует проблема с целевым приложением, которое препятствует работе этого приложения. Ознакомьтесь со всеми инструкциями, предоставленными в целевом приложении, и в [руководстве](../saas-apps/tutorial-list.md)по соответствующему приложению. |
|Мандаторифиелдсмиссинг, Миссингвалуес |Не удалось создать пользователя, так как отсутствуют необходимые значения. Исправьте отсутствующие значения атрибутов в исходной записи или проверьте конфигурацию соответствующего атрибута, чтобы убедиться, что обязательные поля не пропущены. Дополнительные [сведения](../app-provisioning/customize-application-attributes.md) о настройке соответствующих атрибутов.|
|счемааттрибутенотфаунд |Не удалось выполнить операцию, поскольку был указан атрибут, не существующий в целевом приложении. См. [документацию](../app-provisioning/customize-application-attributes.md) по настройке атрибутов и правильность настройки.|
|InternalError |Произошла внутренняя ошибка службы в службе подготовки Azure AD. Ничего делать не нужно. Эта попытка будет автоматически повторена через 40 минут.|
|InvalidDomain |Не удалось выполнить операцию из-за значения атрибута, содержащего недопустимое имя домена. Обновите доменное имя пользователя или добавьте его в список разрешенных в целевом приложении. |
|Время ожидания |Не удалось выполнить операцию, так как целевое приложение заняло слишком много времени для ответа. Ничего делать не нужно. Эта попытка будет автоматически повторена через 40 минут.|
|лиценселимитексцеедед|Не удалось создать пользователя в целевом приложении из-за отсутствия доступных лицензий для этого пользователя. Либо получите дополнительные лицензии для целевого приложения, либо проверьте назначения пользователей и конфигурацию сопоставления атрибутов, чтобы убедиться, что им назначены правильные атрибуты.|
|дупликатетаржетентриес  |Не удалось выполнить операцию, так как найдено более одного пользователя в целевом приложении с настроенными атрибутами сопоставления. Удалите дублирующего пользователя из целевого приложения или измените сопоставления атрибутов, как описано [здесь](../app-provisioning/customize-application-attributes.md).|
|дупликатесаурцеентриес | Не удалось выполнить операцию, так как обнаружено несколько пользователей с настроенными соответствующими атрибутами. Удалите дублирующего пользователя или перенастройте сопоставления атрибутов, как описано [здесь](../app-provisioning/customize-application-attributes.md).|
|импортскиппед | При оценке каждого пользователя выполняется попытка импортировать пользователя из исходной системы. Эта ошибка обычно возникает, когда импортируемый пользователь не имеет соответствующего свойства, определенного в сопоставлении атрибутов. Без значения, присутствующего в объекте пользователя для атрибута сопоставления, невозможно вычислить изменения области, сопоставления или экспорта. Обратите внимание, что эта ошибка не указывает на то, что пользователь находится в области, так как мы еще не оценили области для пользователя.|
|ентрисинчронизатионскиппед | Служба подготовки успешно запросила исходную систему и определила пользователя. Никаких дополнительных действий пользователя не было выполнено, и они были пропущены. Пропуск может быть вызван тем, что пользователь выходит из области действия или пользователь уже существует в целевой системе, но дальнейшие изменения не требуются.|
|системфоркроссдомаинидентитиманажементмултиплинтриесинреспонсе| При выполнении запроса GET для получения пользователя или группы в ответе было получено несколько пользователей или групп. Ожидалось, что в ответе будет получен только один пользователь или группа. Если, [например](../app-provisioning/use-scim-to-provision-users-and-groups.md#get-group), мы выполняем запрос GET для получения группы и предложит фильтр для исключения членов, а конечная точка scim возвращает элементы, мы выдаем эту ошибку.|

## <a name="next-steps"></a>Следующие шаги

* [Проверка состояния подготовки пользователей](../app-provisioning/application-provisioning-when-will-provisioning-finish-specific-user.md)
* [Проблема при настройке подготовки пользователей для приложения из коллекции Azure AD](../app-provisioning/application-provisioning-config-problem.md)
* [API Graph подготовки журналов](/graph/api/resources/provisioningobjectsummary?view=graph-rest-beta)
