---
title: Создание кластеров на базе Windows Server и Linux
description: Кластеры Service Fabric работают в Windows Server и Linux. Вы можете развертывать и размещать Service Fabric приложения в любом месте, где можно запускать Windows Server или Linux.
services: service-fabric
documentationcenter: .net
ms.topic: conceptual
ms.date: 02/01/2019
ms.openlocfilehash: bbfdc0a30aa673e8602ec9233fde4236c99ef5aa
ms.sourcegitcommit: 910a1a38711966cb171050db245fc3b22abc8c5f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "97882217"
---
# <a name="overview-of-service-fabric-clusters-on-azure"></a>Общие сведения о кластерах Service Fabric в Azure
Кластер Service Fabric — это подключенный к сети набор виртуальных машин или физических компьютеров, в котором вы развертываете микрослужбы и управляете ими. Узлом кластера называется компьютер или виртуальная машина, которая входит в состав кластера. Кластеры можно масштабировать до нескольких тысяч узлов. Если вы добавите новые узлы в кластер, реплики раздела службы подвергнутся повторной балансировке Service Fabric с учетом этих узлов. Общая производительность приложения улучшится, а конфликт доступа к памяти уменьшится. При неэффективном использовании узлов в кластере вы можете уменьшить их количество. Service Fabric снова перераспределит реплики и экземпляры секции по меньшему количеству узлов, чтобы эффективно использовать оборудование на каждом узле.

Тип узла определяет размер, количество и свойства набора узлов (виртуальных машин) в кластере. Каждый тип узла поддерживает возможность независимого масштабирования, имеет разные наборы открытых портов и собственные метрики емкости. Типы узлов используются для определения ролей набора узлов кластера, например "интерфейсная часть" или "серверная часть". В кластере могут быть узлы нескольких типов. Тип основных узлов должен включать не менее пяти виртуальных машин для производственных кластеров и не менее трех виртуальных машин для тестовых кластеров. [Системные службы Service Fabric](service-fabric-technical-overview.md#system-services) размещаются на узлах основного типа. 

## <a name="cluster-components-and-resources"></a>Компоненты и ресурсы кластера
Кластер Service Fabric в Azure — это ресурс Azure, который использует другие ресурсы Azure и взаимодействует с ними, в частности:
* виртуальными машинами и виртуальными сетевыми картами;
* Наборы для масштабирования виртуальных машин
* виртуальными сетями;
* подсистемами балансировки нагрузки;
* учетными записями хранения;
* общедоступными IP-адресами.

![Кластер Service Fabric][Image]

### <a name="virtual-machine"></a>Виртуальная машина
[Виртуальная машина](../virtual-machines/index.yml) в составе кластера называется узлом, хотя технически узел кластера является процессом среды выполнения Service Fabric. Каждому узлу назначается имя (строка). Узлы имеют свои характеристики, в частности [свойства размещения](service-fabric-cluster-resource-manager-cluster-description.md#node-properties-and-placement-constraints). У каждого компьютера или виртуальной машины есть автоматически запускаемая служба *FabricHost.exe*. Она запускается во время загрузки системы и запускает два исполняемых файла: *Fabric.exe* и *FabricGateway.exe*, которые формируют узел. Развертывание в рабочей среде — это один узел на физическую или виртуальную машину. В сценариях тестирования на одном компьютере или виртуальной машине можно разместить несколько узлов. Для этого нужно запустить несколько экземпляров *Fabric.exe* и *FabricGateway.exe*.

Каждая виртуальная машина связана с картой виртуального сетевого интерфейса (NIC), и каждой сетевой карте назначается частный IP-адрес.  Виртуальная машина назначается виртуальной сети и локальной подсистеме балансировки с использованием сетевой карты.

Все виртуальные машины в кластере размещаются в виртуальной сети.  Все узлы одного типа и масштабируемого набора размещаются в одной подсети виртуальной сети.  Эти узлы имеют только частные IP-адреса и не могут быть напрямую адресуемыми вне виртуальной сети.  Клиенты могут получать доступ к службам на узлах с помощью подсистемы балансировки нагрузки Azure.

### <a name="scale-setnode-type"></a>Масштабируемый набор и тип узла
При создании кластера определяется один или несколько типов узлов.  Узлы, или виртуальные машины, в типе узла имеют одинаковый размер и характеристики, такие как количество ЦП, объем памяти, количество дисков и дисковые операции ввода-вывода.  Например, один тип узла может быть предназначен для небольших интерфейсных виртуальных машин с портами, открытыми для доступа в Интернет, а другой — для больших внутренних виртуальных машин, обрабатывающих данные. В кластерах Azure каждый тип узла сопоставляется [масштабируемому набору виртуальных машин](../virtual-machine-scale-sets/index.yml).

Их можно использовать для развертывания коллекций виртуальных машин и управления ими в качестве набора. Каждый тип узла, который вы определяете в Azure Service Fabric, настраивает отдельный масштабируемый набор. Среда выполнения Service Fabric загружается на каждую виртуальную машину в масштабируемом наборе с помощью расширений виртуальных машин Azure. Все типы узлов можно масштабировать независимо друг от друга, изменять номер SKU операционной системы, работающей на узле кластера, открывать разные наборы портов и использовать различные метрики производительности. Масштабируемый набор содержит пять [доменов обновления](service-fabric-cluster-resource-manager-cluster-description.md#upgrade-domains) и пять [доменов сбоя](service-fabric-cluster-resource-manager-cluster-description.md#fault-domains) и может содержать до 100 виртуальных машин.  Вы можете создавать кластеры из более чем 100 узлов путем создания нескольких масштабируемых наборов и типов узлов.

> [!IMPORTANT]
> Важно выбрать правильное количество типов узлов для кластера и свойства каждого типа узла (размер, первичный узел, выход в Интернет, количество виртуальных машин и т. д.).  Дополнительные сведения см. в статье [Рекомендации по планированию загрузки кластера Service Fabric](service-fabric-cluster-capacity.md).

Дополнительные сведения см. в статье [Типы узлов Azure Service Fabric и масштабируемые наборы виртуальных машин](service-fabric-cluster-nodetypes.md).

### <a name="azure-load-balancer"></a>Azure Load Balancer
Экземпляры виртуальных машин объединяются за [подсистемой балансировки нагрузки Azure](../load-balancer/load-balancer-overview.md), которая связана с [общедоступным IP-адресом](../virtual-network/public-ip-addresses.md) и меткой DNS.  При подготовке кластера с параметром *&lt; имя_кластера &gt;* DNS-имя *&lt; имя_кластера &gt; . &lt; Location &gt; . cloudapp.Azure.com* — это метка DNS, связанная с подсистемой балансировки нагрузки перед масштабируемым набором.

Виртуальные машины в кластере имеют только [частные IP-адреса](../virtual-network/private-ip-addresses.md).  Трафик управления и трафик служб маршрутизируются через общедоступную подсистему балансировки нагрузки.  Сетевой трафик на эти машины маршрутизируется через правила NAT (клиенты подключаются к определенным узлам или экземплярам) или правила балансировки нагрузки (трафик поступает на виртуальные машины циклически).  С подсистемой балансировки нагрузки связан общедоступный IP-адрес с DNS-именем в формате: *&lt; имя_кластера &gt; . &lt; Location &gt; . cloudapp.Azure.com*.  Общедоступный IP-адрес представляет собой еще один ресурс Azure в группе ресурсов.  При определении нескольких типов узлов в кластере для каждого типа узла или масштабируемого набора создается подсистема балансировки нагрузки. Можно также настроить одну подсистему балансировки нагрузки для нескольких типов узлов.  Тип первичного узла имеет метку DNS *&lt; имя_кластера &gt; . &lt; Location &gt; . cloudapp.Azure.com*, другие типы узлов имеют метку DNS *&lt; имя_кластера &gt; - &lt; NodeType &gt; . &lt; Location &gt; . cloudapp.Azure.com*.

### <a name="storage-accounts"></a>Учетные записи хранения
Каждый тип узла кластера поддерживается [учетной записью хранения Azure](../storage/common/storage-introduction.md) и управляемыми дисками.

## <a name="cluster-security"></a>Безопасность кластера
Кластер Service Fabric — это ресурс, владельцем которого являетесь вы.  Вам следует защитить кластеры, чтобы к ним не смогли подключиться неавторизованные пользователи. Защита кластера особенно важна при выполнении на нем производственных рабочих нагрузок. 

### <a name="node-to-node-security"></a>безопасность обмена данными между узлами;
Безопасность между узлами обеспечивает защиту обмена данными между виртуальными машинами и компьютерами в кластере. Такая защита гарантирует, что размещать приложения и службы в кластере смогут владельцы только тех компьютеров, которые прошли авторизацию для подключения к кластеру. Service Fabric использует сертификаты X.509 для защиты кластера и обеспечения функций безопасности приложений.  Сертификат кластера требуется для защиты трафика в кластере и выполнения аутентификации на сервере и на кластере.  Самозаверяющие сертификаты можно использовать в целях проверки кластера, однако для защиты рабочих кластеров рекомендуется использовать сертификат, подписанный доверенным центром сертификации.

Дополнительные сведения см. в разделе [Безопасность обмена данными между узлами](service-fabric-cluster-security.md#node-to-node-security).

### <a name="client-to-node-security"></a>безопасность обмена данными между клиентами и узлами;
При безопасном обмене данными между клиентами и узлами используется аутентификация клиентов, а также обеспечивается защищенное взаимодействие между клиентом и отдельными узлами в кластере. Этот тип защиты обеспечивает доступ к кластеру и приложениям, развернутым в нем, только для авторизованных пользователей. Клиенты однозначно определяются с помощью учетных данных безопасности сертификата X.509. Чтобы выполнить на кластере аутентификацию таких клиентов, как администратор или пользователь, можно использовать любое количество необязательных клиентских сертификатов.

В дополнение к клиентским сертификатам для аутентификации клиентов в кластере также можно настроить Azure Active Directory.

Дополнительные сведения см. в разделе [Безопасность обмена данными между клиентами и узлами](service-fabric-cluster-security.md#client-to-node-security).

### <a name="role-based-access-control"></a>управление доступом на основе ролей;
Управление доступом на основе ролей в Azure (Azure RBAC) позволяет назначать детализированные элементы управления доступом к ресурсам Azure.  Подпискам, группам ресурсов и ресурсам можно назначить разные правила доступа.  Правила RBAC Azure наследуются по иерархии ресурсов, если они не переопределены на более низком уровне.  Вы можете назначить любых пользователей или группы пользователей в AAD с помощью правил Azure RBAC, чтобы назначенные пользователи и группы могли изменять кластер.  Дополнительные сведения в статье [Что такое управление доступом на основе ролей (RBAC)?](../role-based-access-control/overview.md)

Service Fabric также поддерживает управление доступом, чтобы ограничить доступ к определенным операциям в кластере для разных групп пользователей. Это позволит обеспечить более надежную защиту кластера. Для клиентов, подключающихся к кластеру, поддерживаются два типа управления доступом: роль администратора и роль пользователя.  

Дополнительные сведения см. в статье [Service Fabric управление доступом на основе ролей](service-fabric-cluster-security.md#service-fabric-role-based-access-control).

### <a name="network-security-groups"></a>Группы безопасности сети 
Группы безопасности сети (NSG) управляют входящим и исходящим трафиком подсети, виртуальной машины или определенной сетевой карты.  По умолчанию при размещении нескольких виртуальных машин в одной виртуальной сети они могут взаимодействовать друг с другом через любой порт.  Если требуется ограничить обмен данными между компьютерами, с помощью групп безопасности сети можно сегментировать сеть или изолировать виртуальные машины друг от друга.  Если в кластере имеется несколько типов узлов, можно применить группы безопасности сети к подсетям, чтобы предотвратить взаимодействие компьютеров, принадлежащих к узлам разных типов.  

Дополнительные сведения о группах безопасности см. в [этой статье](../virtual-network/network-security-groups-overview.md).

## <a name="scaling"></a>Масштабирование

Требования приложения со временем изменяются. Вам может понадобиться увеличить ресурсы кластера, чтобы удовлетворить повышенную рабочую нагрузку на приложения и высокий трафик, или уменьшить ресурсы кластера при снижении спроса. После создания кластера Service Fabric можно масштабировать кластер горизонтально (изменение количества узлов) и вертикально (изменение ресурсов узлов). Кластер можно масштабировать в любое время, даже когда в нем выполняются рабочие нагрузки. Вместе с кластером автоматически масштабируются ваши приложения.

Дополнительные сведения см. в статье [Масштабирование кластеров Azure Service Fabric](service-fabric-cluster-scaling.md).

## <a name="upgrading"></a>Обновление
Кластер Service Fabric Azure представляет собой ресурс, который принадлежит вам, но частично управляется корпорацией Майкрософт. Корпорация Майкрософт отвечает за исправление базовой операционной системы и обновление среды выполнения Service Fabric в кластере. Вы можете настроить для кластера автоматическое обновление среды выполнения по мере выпуска новых версий корпорацией Майкрософт или же выбрать нужную версию в списке поддерживаемых. Кроме обновлений среды выполнения вы можете также обновить конфигурацию кластера, например сертификаты или порты приложения.

Дополнительные сведения см. в статье [Обновление кластера Azure Service Fabric](service-fabric-cluster-upgrade.md).

## <a name="supported-operating-systems"></a>Поддерживаемые операционные системы
Вы можете создавать кластеры на виртуальных машинах под управлением следующих операционных систем:

| Операционная система | Самая ранняя поддерживаемая версия Service Fabric | Последняя поддерживаемая версия Service Fabric |
| --- | --- | --- | 
| Windows Server 2019 | 6.4.654.9590 | Н/Д |
| Windows Server 2016 | Все версии | Н/Д |
| 20H2 Windows Server | 7.2.445.9590 | Н/Д |
| Windows Server 1809 | 6.4.654.9590 | 7.2.445.9590 |
| Windows Server 1803 | 6.4 | 7.2.445.9590 |
| Windows Server 1709 | 6.0 | 7.2.445.9590 |
| Windows Server 2012 | Все версии | Н/Д | 
| Linux Ubuntu 16.04 | 6.0 | Н/Д |
| Linux Ubuntu 18,04 | 7.1 | Н/Д |

Дополнительные сведения см. [в статье Поддерживаемые версии кластеров в Azure](./service-fabric-versions.md#supported-operating-systems) .

> [!NOTE]
> Если вы решили развернуть Service Fabric в Windows Server 1709, обратите внимание на следующее: 1) это не ветвь долгосрочного обслуживания, поэтому, возможно, в дальнейшем потребуется перемещение версий; 2) контейнеры, созданные в Windows Server 2016 не работают в Windows Server 1709 и наоборот (потребуется перестроить их для развертывания).
>


## <a name="next-steps"></a>Дальнейшие действия
Ознакомьтесь со статьями о [защите](service-fabric-cluster-security.md), [масштабировании](service-fabric-cluster-scaling.md) и [обновлении](service-fabric-cluster-upgrade.md) кластеров Azure.

Узнайте о [вариантах поддержки Service Fabric](service-fabric-support.md).

[Image]: media/service-fabric-azure-clusters-overview/Cluster.PNG