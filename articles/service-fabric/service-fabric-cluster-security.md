---
title: Обеспечение безопасности кластера Azure Service Fabric
description: Узнайте о сценариях защиты кластера Azure Service Fabric, а также различных технологиях их реализации.
ms.topic: conceptual
ms.date: 08/14/2018
ms.openlocfilehash: 6f7bb785184938fe5c1e20e3c915b0112c7723ee
ms.sourcegitcommit: 910a1a38711966cb171050db245fc3b22abc8c5f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "96573074"
---
# <a name="service-fabric-cluster-security-scenarios"></a>Сценарии защиты кластера Service Fabric

Кластер Azure Service Fabric — это ресурс, владельцем которого вы являетесь. Вам следует защитить кластеры, чтобы к ним не смогли подключиться неавторизованные пользователи. Защита кластера особенно важна при выполнении на нем производственных рабочих нагрузок. Можно создать незащищенный кластер, но если кластер предоставляет конечные точки управления для общедоступного Интернета, анонимные пользователи могут подключаться к нему. Незащищенные кластеры нельзя использовать для выполнения производственных задач. 

В этой статье содержится обзор сценариев безопасности для кластеров Azure и изолированных кластеров, а также приведены различные технологии их реализации:

* безопасность обмена данными между узлами;
* безопасность обмена данными между клиентами и узлами;
* Service Fabric управления доступом на основе ролей

## <a name="node-to-node-security"></a>безопасность обмена данными между узлами;

Безопасность обмена данными между узлами обеспечивает безопасное взаимодействие между виртуальными машинами или компьютерами в кластере. Такая защита гарантирует, что размещать приложения и службы в кластере смогут владельцы только тех компьютеров, которые прошли авторизацию для подключения к кластеру.

![Схема обмена данными между узлами][Node-to-Node]

Кластеры, работающие в Azure, и автономные кластеры, работающие под управлением Windows, могут использовать [безопасность на основе сертификатов](/previous-versions/msp-n-p/ff649801(v=pandp.10)) или [безопасность Windows](/previous-versions/msp-n-p/ff649396(v=pandp.10)) для компьютеров Windows Server.

### <a name="node-to-node-certificate-security"></a>Безопасность обмена данными между узлами на основе сертификатов

Service Fabric использует сертификаты сервера X.509, которые указываются как часть конфигурации типа узла при создании кластера. Краткий обзор этих сертификатов и способа их получения или создания приведен в конце этой статьи.

При создании кластера безопасность на основе сертификатов можно настроить с помощью портала Azure, шаблона Azure Resource Manager или автономного шаблона JSON. По умолчанию Service Fabric SDK — развертывание и установка сертификата с самого начала до истечения срока действия. Классическое поведение позволяло определять первичные и вторичные сертификаты, чтобы разрешить инициированные вручную смены, и не рекомендуется использовать новые функции. Первичные сертификаты, которые будут использоваться и имеют наибольший запас времени до окончания строка годности, должны отличаться от сертификатов клиента администрирования и клиентских сертификатов "только для чтения", установленных для [безопасности обмена данными между клиентами и узлами](#client-to-node-security).

Чтобы узнать, как в Azure в кластере настроить безопасность на основе сертификатов, ознакомьтесь со статьей [Создание кластера Service Fabric в Azure с помощью Azure Resource Manager](service-fabric-cluster-creation-via-arm.md).

Чтобы узнать, как в кластере настроить безопасность на основе сертификатов для изолированного кластера Windows Server, ознакомьтесь со статьей [Защита автономного кластера под управлением Windows с помощью сертификатов X.509](service-fabric-windows-cluster-x509-security.md).

### <a name="node-to-node-windows-security"></a>Безопасность обмена данными между узлами Windows

> [!NOTE]
> Проверка подлинности Windows основана на протоколе Kerberos. NTLM не поддерживается в качестве типа проверки подлинности.
>
> По возможности используйте проверку подлинности сертификата X. 509 для кластеров Service Fabric.

Чтобы узнать, как настроить защиту Windows для изолированного кластера Windows Server, ознакомьтесь со статьей [Защита изолированного кластера под управлением Windows с помощью системы безопасности Windows](service-fabric-windows-cluster-windows-security.md).

## <a name="client-to-node-security"></a>безопасность обмена данными между клиентами и узлами;

При безопасном обмене данными между клиентами и узлами используется аутентификация клиентов, а также обеспечивается защищенное взаимодействие между клиентом и отдельными узлами в кластере. Этот тип защиты обеспечивает доступ к кластеру и приложениям, развернутым в нем, только для авторизованных пользователей. Клиенты однозначно определяются с помощью своих учетных данных системы безопасности Windows или учетных данных сертификата безопасности.

![Схема обмена данными между узлом и клиентом][Client-to-Node]

Кластеры, работающие в Azure и автономных кластерах, работающих в Windows, могут использовать либо [безопасность сертификатов](/previous-versions/msp-n-p/ff649801(v=pandp.10)) , либо [Безопасность Windows](/previous-versions/msp-n-p/ff649396(v=pandp.10)), хотя при возможности рекомендуется использовать проверку подлинности по сертификату X. 509.

### <a name="client-to-node-certificate-security"></a>Безопасность обмена данными между клиентами и узлами на основе сертификатов

При создании кластера безопасность обмена данными между клиентами и узлами на основе сертификатов можно настроить с помощью портала Azure, шаблона Resource Manager или автономного шаблона JSON. Чтобы создать сертификат, необходимо указать сертификат клиента администратора или пользователя. Мы рекомендуем, чтобы эти сертификаты отличались от основного и дополнительного сертификатов, указанных для [защиты обмена данными между узлами](#node-to-node-security). Сертификаты кластера имеют те же права, что и сертификаты администратора клиента. Однако они должны использоваться только кластером, а не пользователями с правами администратора в качестве рекомендации по безопасности.

Клиенты, подключающиеся к кластеру с помощью сертификата администрирования, получают полный доступ к возможностям управления. Клиенты, подключающиеся к кластеру с помощью сертификата клиента только для чтения, получают доступ только для чтения к возможностям управления. Эти сертификаты используются для Service Fabric RBAC, описанного далее в этой статье.

Чтобы узнать, как в Azure в кластере настроить безопасность на основе сертификатов, ознакомьтесь со статьей [Создание кластера Service Fabric в Azure с помощью Azure Resource Manager](service-fabric-cluster-creation-via-arm.md).

Чтобы узнать, как в кластере настроить безопасность на основе сертификатов для изолированного кластера Windows Server, ознакомьтесь со статьей [Защита автономного кластера под управлением Windows с помощью сертификатов X.509](service-fabric-windows-cluster-x509-security.md).

### <a name="client-to-node-azure-active-directory-security-on-azure"></a>Безопасность обмена данными Azure Active Directory между клиентами и узлами в Azure

Azure AD позволяет организациям (известным как клиенты) управлять доступом пользователей к приложениям. Приложения можно разделить на две группы: те, в которых есть пользовательский веб-интерфейс входа в систему, и те, в которых вход выполняется с помощью собственного клиентского приложения. Если вы еще не создали клиент, обратитесь к статье [Как получить клиент Azure Active Directory][active-directory-howto-tenant].

Кластеры Service Fabric предлагают несколько точек входа для управления функциями кластеров, включая веб-интерфейс [Service Fabric Explorer][service-fabric-visualizing-your-cluster] и [Visual Studio][service-fabric-manage-application-in-visual-studio]. В итоге вы получаете два приложения Azure AD для управления доступом к кластеру: одно веб-приложение и одно собственное приложение.

Для кластеров, работающих в Azure, вы также можете обеспечить безопасность доступа к конечным точкам управления с помощью Azure Active Directory (Azure AD). Чтобы узнать, как создать необходимые артефакты Azure AD и как их заполнить при создании кластера, см. раздел [Настройки проверки подлинности Azure Active Directory](service-fabric-cluster-creation-setup-aad.md).

## <a name="security-recommendations"></a>Рекомендации по обеспечению безопасности

Для кластеров Service Fabric, развернутых в общедоступной сети, размещенной в Azure, для взаимной проверки подлинности между клиентом и узлом рекомендуется:

* использование Azure Active Directory для удостоверения клиента;
* Сертификат для удостоверения сервера и шифрование TLS связи по протоколу HTTP

Для кластеров Service Fabric, развернутых в общедоступной сети, размещенной в Azure, для безопасности обмена данными между узлами рекомендуется использовать сертификат кластера для проверки подлинности узлов.

Если у вас есть Windows Server 2012 R2 и Windows Active Directory, то для изолированных кластеров Windows Server мы рекомендуем использовать безопасность Windows с групповыми управляемыми учетными записями служб. В противном случае используйте безопасность Windows с учетными записями Windows.

## <a name="service-fabric-role-based-access-control"></a>Service Fabric управления доступом на основе ролей

Вы можете использовать контроль доступа, чтобы ограничить доступ к определенным операциям в кластере для разных групп пользователей. Это позволит обеспечить более надежную защиту кластера. Для клиентов, подключающихся к кластеру, поддерживаются два типа управления доступом: роль администратора и роль пользователя.

У пользователей, которым назначена роль администратора, есть полный доступ к возможностям управления, включая возможности чтения и записи. У пользователей, которым назначена роль пользователя, по умолчанию есть доступ только для чтения к возможностям управления (например, возможности запросов), а также возможность разрешения приложений и служб.

Задайте клиентские роли администратора и клиента во время создания кластера. Назначьте роли, предоставив отдельные удостоверения (например, с помощью сертификатов или Azure AD) для каждого типа роли. Дополнительные сведения о параметрах управления доступом по умолчанию и изменении параметров по умолчанию см. в разделе [Service Fabric управление доступом на основе ролей для Service Fabric клиентов](service-fabric-cluster-security-roles.md).

## <a name="x509-certificates-and-service-fabric"></a>Сертификаты X.509 и Service Fabric

Цифровые сертификаты X.509 обычно используются для проверки подлинности клиентов и серверов, а также для шифрования и цифровой подписи сообщений. Service Fabric использует сертификаты X.509 для защиты кластера и обеспечения функций безопасности приложений. Дополнительные сведения о цифровых сертификатах X.509 см. в статье [Работа с сертификатами](/dotnet/framework/wcf/feature-details/working-with-certificates). [Key Vault](../key-vault/general/overview.md) используется для управления сертификатами кластеров Service Fabric в Azure.

Необходимо учитывать следующие важные моменты.

* Чтобы создать сертификаты для кластеров, выполняющих производственные рабочие нагрузки, используйте правильно настроенную службу сертификации Windows Server или службу из утвержденного [центра сертификации (ЦС)](https://en.wikipedia.org/wiki/Certificate_authority).
* Никогда не используйте в рабочей среде какие-либо временные или тестовые сертификаты, созданные с помощью таких инструментов, как MakeCert.exe.
* Самозаверяющий сертификат вы можете использовать только в тестовом кластере. Не используйте его в рабочей среде.
* При создании отпечатка сертификата обязательно создайте отпечаток SHA1. SHA1 используется при настройке отпечатков сертификатов клиента и кластера.

### <a name="cluster-and-server-certificate-required"></a>Сертификат кластера и сервера (обязательно)

Эти сертификаты (один основной и при необходимости дополнительный) необходимы для защиты кластера и предотвращения несанкционированного доступа к нему. Эти сертификаты предоставляют аутентификацию в кластере и сервере.

Аутентификация в кластере позволяет аутентифицировать обмен данными между узлами для федерации кластера. Только узлы, которые могут подтвердить свою подлинность с помощью этого сертификата, могут присоединиться к кластеру. Аутентификация сервера позволяет аутентифицировать конечные точки управления кластером в клиенте управления, чтобы он "знал", что обращается к настоящему кластеру, а не к "незаконному посреднику". Этот сертификат также предоставляет протокол TLS для API управления HTTPS и для Service Fabric Explorer по протоколу HTTPS. Одна из начальных проверок при проверке подлинности узла — сопоставление значения общего имени в поле **Субъект**. В списке разрешенных общих имен должно быть это общее имя или одно из альтернативных имен субъекта сертификатов.

Сертификат должен отвечать приведенным ниже требованиям.

* Сертификат должен содержать закрытый ключ. Эти сертификаты обычно имеют расширения PFX или PEM.  
* Сертификат должен быть создан для обмена ключами, которые можно экспортировать в файл обмена личной информацией (PFX-файл).
* **Имя субъекта сертификата должно совпадать с доменным именем, которое используется для получения доступа к кластеру Service Fabric**. Это сопоставление необходимо для предоставления TLS для конечной точки управления HTTPS кластера и Service Fabric Explorer. Невозможно получить сертификат TLS/SSL из центра сертификации (ЦС) для домена *. cloudapp.azure.com. Необходимо получить имя личного домена для кластера. При запросе сертификата из ЦС имя субъекта сертификата должно совпадать с именем личного домена, используемого для кластера.

Необходимо учитывать также следующие факторы.

* Поле **Субъект** может содержать несколько значений, каждое из которых содержит сокращение в виде префикса, определяющее тип значения. Как правило, инициализация называется **CN** (для *общего имени*); Например, **CN = www \. contoso.com**.
* Поле **Субъект** может быть пустым.
* Если необязательное поле **Альтернативное имя субъекта** заполнено, его значение должно содержать общее имя сертификата и альтернативное имя субъекта. Они указываются в виде значений **DNS-имен** . Чтобы узнать о создании сертификатов с альтернативными именами субъектов, ознакомьтесь со статьей [Как добавить дополнительное имя субъекта сертификата безопасного LDAP](https://support.microsoft.com/kb/931351).
* Значение **поля назначения** сертификата должно содержать соответствующее значение, такое как проверка подлинности **сервера** или **Проверка подлинности клиента**.

### <a name="application-certificates-optional"></a>Сертификаты приложения (необязательно)

В кластере можно установить любое количество дополнительных сертификатов для обеспечения безопасности приложений. Перед созданием кластера рассмотрите сценарии безопасности приложений, которые требуют установки сертификатов на узлах, в том числе:

* шифрование и расшифровка значений конфигурации приложений;
* шифрование данных между узлами во время репликации.

Концепция создания безопасного кластер в Linux или Windows ничем не отличается.

### <a name="client-authentication-certificates-optional"></a>Сертификаты проверки подлинности клиента (необязательно)

Для клиентских операций со стороны пользователя или администратора может быть указано любое количество дополнительных сертификатов. Клиент может использовать эти сертификаты, если требуется взаимная проверка подлинности. Как правило, сертификаты клиентов не выдаются сторонними центрами сертификации. В свою очередь, личное хранилище текущего местоположения пользователя обычно содержит сертификаты клиентов, размещенные там корневым центром. Сертификат должен иметь значение **предполагаемой области применения****Аутентификация клиента**.  

По умолчанию сертификат кластера имеет права администратора. Эти дополнительные сертификаты клиента не нужно устанавливать в кластере, но они указаны как разрешенные в конфигурации кластера.  Сертификаты клиента должны быть установлены на клиентских компьютерах для подключения к кластеру и выполнения любых операций.

> [!NOTE]
> Для выполнения всех операций управления в кластере Service Fabric необходимы сертификаты серверов. Для управления нельзя использовать сертификаты клиента.

## <a name="next-steps"></a>Дальнейшие действия

* [Создание кластера Service Fabric в Azure с помощью Azure Resource Manager](service-fabric-cluster-creation-via-arm.md)
* [Создание кластера с помощью портала Azure](service-fabric-cluster-creation-via-portal.md)

<!--Image references-->
[Node-to-Node]: ./media/service-fabric-cluster-security/node-to-node.png
[Client-to-Node]: ./media/service-fabric-cluster-security/client-to-node.png

[active-directory-howto-tenant]:../active-directory/develop/quickstart-create-new-tenant.md
[service-fabric-visualizing-your-cluster]: service-fabric-visualizing-your-cluster.md
[service-fabric-manage-application-in-visual-studio]: service-fabric-manage-application-in-visual-studio.md
