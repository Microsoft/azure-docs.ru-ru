---
title: Перенастройка в Azure Service Fabric
description: Сведения о конфигурациях для реплик службы с отслеживанием состояния и процессе перенастройки Service Fabric использования для поддержания согласованности и доступности во время изменения.
author: appi101
ms.topic: conceptual
ms.date: 01/10/2018
ms.author: aprameyr
ms.openlocfilehash: bd46a7776495624affef77a44fcf68334750ba17
ms.sourcegitcommit: 867cb1b7a1f3a1f0b427282c648d411d0ca4f81f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "75610001"
---
# <a name="reconfiguration-in-azure-service-fabric"></a>Перенастройка в Azure Service Fabric
*Конфигурация* определяется как реплики и их роли для секции службы с отслеживанием состояния.

*Перенастройка* — это процесс перемещения одной конфигурации в другую конфигурацию. При этом изменяется набор реплик для секции службы с отслеживанием состояния. Старая конфигурация называется *предыдущей конфигурацией (ПК)*, а новая конфигурация называется *текущей конфигурацией (CC)*. Протокол перенастройки в Azure Service Fabric сохраняет согласованность и обеспечивает доступность во время любых изменений в наборе реплик.

Диспетчер отработки отказов инициирует перенастройку в ответ на различные события в системе. Например, при сбое первичной реплики инициируется перенастройка для повышения уровня активной вторичной реплики до первичной. Другой пример: в ответ на обновление приложения может потребоваться переместить первичную реплику на другой узел, чтобы обновить узел.

## <a name="reconfiguration-types"></a>Типы перенастройки
Перенастройку можно разделить на два типа:

- Перенастройка, при которой изменяется первичная реплика:
    - **Отработка** отказа — перенастройка в ответ на сбой работающей первичной реплики.
    - **переключение первичной реплики** представляет собой перенастройку, при которой Service Fabric нужно переместить работающую первичную реплику с одного узла на другой. Как правило, это происходит в ответ на балансировку нагрузки, обновление и т. п.

- Перенастройка, при которой первичная реплика не изменяется.

## <a name="reconfiguration-phases"></a>Этапы перенастройки
Перенастройка осуществляется в несколько этапов.

- **Этап 0**. Этот этап выполняется при перенастройке с переключением первичной реплики, при которой состояние текущей первичной реплики передается новой первичной реплике, после чего бывшая текущая первичная реплика становится активной вторичной репликой.

- **Этап 1**. Этот этап выполняется во время перенастройки с изменением первичной реплики. На этом этапе Service Fabric определяет, какая из текущих реплик является корректной первичной репликой. Данный этап не нужен при перенастройке с переключением первичной реплики, так как в этом случае новая первичная реплика уже выбрана. 

- **Этап 2**. на этом этапе Service Fabric гарантирует, что все данные доступны в большинстве реплик текущей конфигурации.

Существуют еще несколько этапов, которые предназначены только для внутреннего использования.

## <a name="stuck-reconfigurations"></a>Блокировка перенастройки
Перенастройка может быть *заблокирована* по ряду причин. Ниже перечислены некоторые из распространенных причин.

- **Немедленные реплики**. для некоторых этапов перенастройки требуется большая часть реплик в конфигурации.
- **Проблемы с сетью или связью**: для перенастройки требуется сетевое подключение между разными узлами.
- **Сбои API**: протокол перенастройки предписывает выполнение некоторых интерфейсов API реализациями службы. Например, если маркер отмены не учитывается в надежной службе, это приведет к блокировке перенастройки с переключением первичной реплики.

Используйте отчеты о работоспособности из системных компонентов, таких как System.FM, System.RA и System.RAP, чтобы диагностировать причину блокировки перенастройки. Эти отчеты описаны на [странице отчетов о работоспособности системы](service-fabric-understand-and-troubleshoot-with-system-health-reports.md).

## <a name="next-steps"></a>Дальнейшие действия
Дополнительные сведения о понятиях Service Fabric см. в следующих статьях:

- [Жизненный цикл Reliable Services (C#)](service-fabric-reliable-services-lifecycle.md)
- [Отчеты о работоспособности системы](service-fabric-understand-and-troubleshoot-with-system-health-reports.md)
- [Реплики и экземпляры](service-fabric-concepts-replica-lifecycle.md)
