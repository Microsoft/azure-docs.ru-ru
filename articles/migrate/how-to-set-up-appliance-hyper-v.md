---
title: Настройка устройства "миграция Azure" для Hyper-V
description: Узнайте, как настроить устройство миграции Azure для оценки и миграции серверов в Hyper-V.
author: vineetvikram
ms.author: vivikram
ms.manager: abhemraj
ms.topic: how-to
ms.date: 03/13/2021
ms.openlocfilehash: 8f0e7ec2566928897d2b84357b599506520e8d95
ms.sourcegitcommit: c94e282a08fcaa36c4e498771b6004f0bfe8fb70
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/26/2021
ms.locfileid: "105612030"
---
# <a name="set-up-an-appliance-for-servers-on-hyper-v"></a>Настройка устройства для серверов в Hyper-V

В этой статье описано, как настроить устройство миграции Azure для обнаружения и оценки серверов в Hyper-V с помощью средства " [Миграция Azure: обнаружение и оценка](migrate-services-overview.md#azure-migrate-discovery-and-assessment-tool) ".

[Устройство миграции Azure](migrate-appliance.md) — это упрощенное устройство, используемое службой "миграция Azure": обнаружение и оценка/миграция для обнаружения локальных серверов в Hyper-V и отправки метаданных сервера и данных о производительности в Azure.

Вы можете развернуть устройство с помощью нескольких методов:

- Настройка на сервере в Hyper-V с помощью скачанного виртуального жесткого диска. Этот метод описан в этой статье.
- Настройте на сервере в Hyper-V или физическом сервере с помощью скрипта установщика PowerShell. [Этот метод](deploy-appliance-script.md) следует использовать, если не удается настроить сервер с помощью виртуального жесткого диска или если вы находитесь в Azure для государственных организаций.

После создания устройства вы убедитесь, что оно может подключиться к службе "миграция Azure": обнаружение и оценка, настройка ее в первый раз и регистрация в проекте.

## <a name="appliance-deployment-vhd"></a>Развертывание устройства (VHD)

Чтобы настроить устройство с помощью шаблона виртуального жесткого диска, выполните следующие действия.

- Укажите имя устройства и создайте ключ проекта на портале.
- Скачайте сжатый виртуальный жесткий диск Hyper-V с портала Azure.
- Создайте устройство и убедитесь, что оно может подключиться к службе "миграция Azure": обнаружение и оценка.
- Настройте устройство в первый раз и зарегистрируйте его в проекте с помощью ключа проекта.

### <a name="generate-the-project-key"></a>Создание ключа проекта

1. В **целях миграции**  >  **Windows, Linux и серверы SQL Server**  >  **Миграция Azure: обнаружение и оценка**, выберите **Обнаружение**.
2. В разделе **Обнаружение серверов**  >  **выполняется виртуализация серверов?** выберите **Да, используя Hyper-V**.
3. В **1. Создайте ключ проекта**, укажите имя для устройства миграции Azure, которое будет настроено для обнаружения серверов в Hyper-V. Это имя должно содержать буквы и цифры (не более 14 символов).
1. Щелкните **Создать ключ**, чтобы начать создание необходимых ресурсов Azure. Не закрывайте страницу «Обнаружение серверов» во время создания ресурсов.
1. После успешного создания ресурсов Azure создается **ключ проекта** .
1. Скопируйте этот ключ, так как он понадобится вам для завершения регистрации модуля во время его настройки.

### <a name="download-the-vhd"></a>Скачивание VHD-файла

В разделе **2: Download Azure Migrate appliance** (2. Скачивание виртуального модуля службы "Миграция Azure") выберите VHD-файл и щелкните **Загрузка**.

   ![Параметры для обнаружения серверов](./media/tutorial-assess-hyper-v/servers-discover.png)


   ![Выделенный фрагмент области создания ключа](./media/tutorial-assess-hyper-v/generate-key-hyperv.png)

### <a name="verify-security"></a>Проверка безопасности

Прежде чем развертывать сжатый ZIP-файл, убедитесь, что он не поврежден.

1. На сервере, где скачан файл, откройте командное окно с правами администратора.
2. Выполните следующую команду, чтобы создать хэш VHD-файла.
    - ```C:\>CertUtil -HashFile <file_location> [Hashing Algorithm]```
    - Пример использования: ```C:\>Get-FileHash -Path ./AzureMigrateAppliance_v3.20.09.25.zip -Algorithm SHA256```

Проверьте Последнее значение хэша, сравнив результат приведенной выше команды со значением, описанным [здесь](https://docs.microsoft.com/azure/migrate/tutorial-discover-hyper-v#verify-security) .

## <a name="create-the-appliance"></a>Создание устройства

Импортируйте скачанный файл и создайте устройство.

1. Извлеките сжатый VHD-файл в папку на узле Hyper-V, где будет размещено устройство. Извлекаются три папки.
2. Откройте диспетчер Hyper-V. В меню **Actions** (Действия) щелкните команду **Import Virtual Machine** (Импорт виртуальной машины).

    ![Развертывание VHD](./media/how-to-set-up-appliance-hyper-v/deploy-vhd.png)

2. В мастере импорта виртуальных машин в разделе **Before you begin** (Перед началом работы) нажмите кнопку **Next** (Далее).
3. В поле **Locate Folder** (Определить папку) укажите папку, содержащую извлеченный VHD. Затем нажмите кнопку **Далее**.
1. В меню **Select Virtual Machine** (Выбор виртуальной машины) нажмите кнопку **Next** (Далее).
2. В меню **Choose Import Type** (Выбор типа импорта) щелкните **Copy the virtual machine (create a new unique ID)** (Копировать виртуальную машину (создать уникальный идентификатор)). Затем нажмите кнопку **Далее**.
3. В меню **Choose Destination** (Выбор назначения) оставьте параметр по умолчанию. Щелкните **Далее**.
4. В меню **Storage Folders** (Папки хранилища) оставьте значение по умолчанию. Щелкните **Далее**.
5. В поле **Выбор сети** укажите виртуальный коммутатор, который будет использоваться сервером. Ему требуется подключение к Интернету для отправки данных в Azure.
6. Просмотрите информацию на странице **Summary** (Сводка). Нажмите кнопку **Готово**.
7. В диспетчере Hyper-V в разделе **Virtual Machines** (Виртуальные машины) запустите виртуальную машину.

### <a name="verify-appliance-access-to-azure"></a>Проверка доступа устройства к Azure

Убедитесь, что устройство может подключиться к URL-адресам Azure для [общедоступного](migrate-appliance.md#public-cloud-urls) облака и облака для [государственных организаций](migrate-appliance.md#government-cloud-urls).

### <a name="configure-the-appliance"></a>Настройка устройства

Настройте устройство в первый раз.

> [!NOTE]
> Если вы настраиваете устройство с помощью [скрипта PowerShell](deploy-appliance-script.md), а не скачанного виртуального жесткого диска, первые два этапа этой процедуры выполнять не нужно.

1. В диспетчере Hyper-V > **виртуальные машины** щелкните правой кнопкой мыши сервер > **подключить**.
2. Укажите язык, часовой пояс и пароль для устройства.
3. Откройте браузер в любой системе, которая может подключаться к устройству, и откройте URL-адрес Web App устройства: **https://*или IP-адрес устройства*: 44368**.

   Кроме того, вы можете открыть приложение с рабочего стола устройства, щелкнув ярлык приложения.
1. Примите **условия лицензии** и прочитайте информацию от сторонних производителей.
1. В веб-приложении выберите **Настройка необходимых компонентов** и выполните приведенные ниже действия.
    - **Возможность подключения**: Приложение проверит наличие доступа к Интернету у сервера. Если на сервере используется прокси-сервер:
      - Щелкните **Setup Proxy (Настройка прокси-сервера** ) и укажите адрес прокси-сервера (в форме http://ProxyIPAddress или http://ProxyFQDN) прослушиваемом порте).
      - Укажите учетные данные, если для прокси-сервера требуется аутентификация.
      - Поддерживается только прокси-сервер HTTP.
      - Если вы добавили сведения о прокси-сервере или отключили его и (или) проверку подлинности, щелкните **Сохранить**, чтобы снова запустить проверку подключения.
    - **Синхронизация времени**: время проверяется. Для правильной работы обнаружения серверов время на устройстве должно быть синхронизировано со временем в Интернете.
    - **Установка обновлений**: служба "миграция Azure": обнаружение и оценка — проверяет, установлены ли на устройстве последние обновления. После завершения проверки вы можете щелкнуть пункт **View appliance services** (Просмотр служб модуля), чтобы просмотреть состояние и версии компонентов, используемых модулем.

### <a name="register-the-appliance-with-azure-migrate"></a>Регистрация устройства с помощью службы "Миграция Azure"

1. Вставьте **ключ проекта** , скопированный с портала. Если у вас нет ключа, перейдите в раздел " **Миграция Azure": обнаружение и оценка> обнаружение> управление существующими устройствами**, выберите имя устройства, которое вы указали во время создания ключа, и скопируйте соответствующий ключ.
1. Вам потребуется код устройства для аутентификации в Azure. Если щелкнуть **Вход**, откроется модальное окно с кодом устройства, как показано ниже.

    ![Модальное окно с кодом устройства](./media/tutorial-discover-vmware/device-code.png)

1. Щелкните **Копировать код и войти**, чтобы скопировать код устройства и открыть окно входа в Azure в новой вкладке браузера. Если этот параметр не отображается, убедитесь, что в браузере отключена блокировка всплывающих окон.
1. На новой вкладке вставьте код устройства и выполните вход с помощью имени пользователя и пароля Azure.
   
   Вход с помощью PIN-кода не поддерживается.
3. Если вы случайно закроете вкладку входа, не выполнив вход, вам потребуется обновить вкладку браузера в диспетчере конфигурации устройства, чтобы снова активировать кнопку "Вход".
1. После успешного входа вернитесь на предыдущую вкладку с помощью диспетчера конфигурации устройства.
4. Если учетная запись пользователя Azure, используемая для ведения журнала, имеет необходимые [разрешения](./tutorial-discover-hyper-v.md#prepare-an-azure-user-account) на ресурсы Azure, созданные во время создания ключа, будет инициирована регистрация модуля.
1. После регистрации модуля вы можете просмотреть сведения о регистрации, щелкнув **Просмотреть подробности**.

### <a name="delegate-credentials-for-smb-vhds"></a>Делегирование учетных данных для виртуальных жестких дисков SMB

Если вы запускаете виртуальные жесткие диски в SMB, необходимо включить делегирование учетных данных с устройства на узлы Hyper-V. Чтобы сделать это на устройстве, выполните следующее:

1. На устройстве выполните следующую команду. HyperVHost1/HyperVHost2 — это примеры имен узлов.

    ```
    Enable-WSManCredSSP -Role Client -DelegateComputer HyperVHost1.contoso.com, HyperVHost2.contoso.com, HyperVHost1, HyperVHost2 -Force
    ```

2. Кроме того, это можно сделать в редакторе локальных групповых политик на устройстве:
    - В разделе **Политика локального компьютера** > **Конфигурация компьютера** щелкните **Административные шаблоны** > **Система** > **Передача учетных данных**.
    - Дважды щелкните **Разрешить передачу новых учетных данных** и выберите **Включено**.
    - В разделе **Параметры** щелкните **Показать** и добавьте в список каждый узел Hyper-V, который требуется обнаружить, используя **wsman/** в качестве префикса.
    - В области **Передача учетных данных** дважды щелкните **Разрешить делегирование новых учетных данных с проверкой подлинности сервера "только NTLM"**. Еще раз добавьте в список каждый узел Hyper-V, который требуется обнаружить, используя **wsman/** в качестве префикса.

## <a name="start-continuous-discovery"></a>Запуск непрерывного обнаружения

Подключитесь с устройства к узлам или кластерам Hyper-V и запустите обнаружение.

1. На **шаге 1. Укажите учетные данные узла Hyper-V**, щелкните **Добавить учетные данные** , чтобы указать понятное имя для учетных данных, добавить **имя пользователя** и **пароль** для узла или кластера Hyper-V, которые устройство будет использовать для обнаружения серверов. Щелкните **Save**(Сохранить).
1. Если вы хотите добавить несколько учетных данных одновременно, щелкните **Добавить еще**, чтобы сохранить и добавить дополнительные учетные данные. Для обнаружения серверов в Hyper-V поддерживаются несколько учетных данных.
1. На **шаге 2 Provide Hyper-V host/cluster details** (Предоставление сведений об узле или кластере Hyper-V) щелкните **Add discovery source** (Добавить источник обнаружения), чтобы указать **IP-адрес или полное доменное имя** узла или кластера Hyper-V и понятное имя учетных данных для подключения к узлу или кластеру.
1. За один раз можно выбрать пункт **Add single item** (Добавить один элемент) или **Add multiple items** (Добавить несколько элементов). Здесь также есть параметр **Импорт CSV** для предоставления сведений об узле или кластере Hyper-V.

    ![Выбранные элементы для добавления источника обнаружения](./media/tutorial-assess-hyper-v/add-discovery-source-hyperv.png)

    - Если вы выберете пункт **Add single item** (Добавить один элемент), вам необходимо будет указать понятное имя для учетных данных и **IP-адрес или полное доменное имя** узла или кластера Hyper-V, а затем щелкнуть **Сохранить**.
    - Если выбрано **Добавление нескольких элементов** _(выбрано по умолчанию)_, можно добавить сразу несколько записей, указав IP-адрес узла или кластера **/полное доменное имя (или** ) в качестве имени учетных данных в текстовом поле. Проверьте * * добавленные записи и нажмите кнопку " **сохранить**".
    - Если вы выберете пункт **Импорт CSV**, вы сможете скачать CSV-файл шаблона и указать в нем **IP-адрес или полное доменное имя** узла или кластера Hyper-V и понятное имя для учетных данных. Затем импортируйте файл в виртуальный модуль, нажмите кнопку **Проверить** для проверки записей в файле и щелкните **Сохранить**.

1. При нажатии кнопки "Сохранить" виртуальный модуль попытается проверить подключение к добавленным узлам или кластерам Hyper-V и отобразит **состояние проверки** в таблице для каждого из них.
    - Вы можете просмотреть дополнительные сведения о проверенных узлах или кластерах, щелкнув их IP-адрес или полное доменное имя.
    - Если проверка узла завершилась неудачно, просмотрите ошибку, щелкнув пункт **Сбой проверки** в столбце "Состояние" таблицы. Устраните проблему и выполните проверку еще раз.
    - Чтобы удалить узлы или кластеры, щелкните **Удалить**.
    - Невозможно удалить конкретный узел из кластера. Вы можете удалить только весь кластер.
    - Вы можете добавить кластер, даже если возникли проблемы с конкретными узлами в кластере.
1. Можно повторно **проверить** подключение к узлам или кластерам в любое время перед началом обнаружения.
1. Нажмите кнопку **начать обнаружение**, чтобы отключить обнаружение серверов на успешно проверенных узлах и кластерах. После успешного запуска обнаружения вы можете проверить состояние обнаружения для каждого узла или кластера в таблице.

Запустится обнаружение. Чтобы метаданные обнаруженных серверов отобразились на портале Azure, потребуется около 2 минут на узел.

## <a name="verify-servers-in-the-portal"></a>Проверка серверов на портале

После завершения обнаружения вы можете проверить, отображаются ли серверы на портале Azure.

1. Откройте панель мониторинга службы "Миграция Azure".
2. На странице "миграция **Azure — Windows, Linux и SQL Servers**  >  **Azure: обнаружение и оценка** " щелкните значок, отображающий количество **обнаруженных серверов**.

## <a name="next-steps"></a>Дальнейшие действия

Испытайте [оценку Hyper-V](tutorial-assess-hyper-v.md) с помощью службы "миграция Azure": обнаружение и оценка.