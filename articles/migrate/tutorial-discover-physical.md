---
title: Обнаружение физических серверов с помощью средства "Обнаружение и оценка" службы "Миграция Azure"
description: Узнайте, как обнаружить локальные физические серверы с помощью средства "Обнаружение и оценка" службы "Миграция Azure".
author: vineetvikram
ms.author: vivikram
ms.manager: abhemraj
ms.topic: tutorial
ms.date: 03/11/2021
ms.custom: mvc
ms.openlocfilehash: 17740763777372a5eaed6941974c120860839279
ms.sourcegitcommit: 77d7639e83c6d8eb6c2ce805b6130ff9c73e5d29
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/05/2021
ms.locfileid: "106382715"
---
# <a name="tutorial-discover-physical-servers-with-azure-migrate-discovery-and-assessment"></a>Руководство. Обнаружение физических серверов с помощью средства "Обнаружение и оценка" службы "Миграция Azure"

В процессе переноса в Azure вы обнаружите серверы для оценки и миграции.

В этом руководстве показано, как обнаруживать локальные физические серверы с помощью средства "Обнаружение и оценка" службы "Миграция Azure", используя упрощенное устройство службы "Миграция Azure". Устройство развертывается как физический сервер для непрерывного обнаружения метаданных серверов и производительности.

В этом руководстве описано следующее:

> [!div class="checklist"]
> * настройка учетной записи Azure;
> * подготовка физических серверов к обнаружению;
> * Создайте проект.
> * Настройка устройства службы "Миграция Azure".
> * Запуск непрерывного обнаружения.

> [!NOTE]
> В учебниках показан самый быстрый способ выполнения сценария и используются параметры по умолчанию.  

Если у вас еще нет подписки Azure, [создайте бесплатную учетную запись Azure](https://azure.microsoft.com/pricing/free-trial/), прежде чем начинать работу.

## <a name="prerequisites"></a>Предварительные требования

Перед началом работы с этим учебником проверьте наличие необходимых компонентов.

**Требование** | **Сведения**
--- | ---
**Устройство** | Вам потребуется сервер, на котором можно запустить устройство службы "Миграция Azure". Этот сервер должен иметь следующие характеристики:<br/><br/> — Установлен Windows Server 2016.<br/> _(В настоящее время развертывание устройства поддерживается только в Windows Server 2016.)_<br/><br/> — 16 ГБ ОЗУ, 8 виртуальных ЦП, 80 ГБ дискового пространства.<br/><br/> — Статический или динамический IP-адрес, а также доступ к Интернету напрямую или через прокси-сервер.
**Серверы Windows** | Разрешите входящие подключения на порту WinRM 5985 (HTTP), чтобы устройство могло получать метаданные конфигурации и производительности.
**Серверы Linux** | Разрешите входящие подключения через порт 22 (TCP).

## <a name="prepare-an-azure-user-account"></a>Подготовка учетной записи пользователя Azure

Чтобы создать проект и зарегистрировать устройство службы "Миграция Azure", вам понадобится учетная запись с:
- разрешениями участника или владельца в подписке Azure;
- разрешениями на регистрацию приложений Azure Active Directory (Azure AD).

Если вы создали бесплатную учетную запись Azure, вы являетесь владельцем подписки. Если вы не являетесь владельцем подписки, назначьте разрешения совместно с владельцем следующим образом:

1. На портале Azure выполните поиск по фразе "подписки" и в разделе **Службы** выберите **Подписки**.

    ![Поле для поиска подписки Azure](./media/tutorial-discover-physical/search-subscription.png)

2. На странице **Подписки** выберите подписку, в которой хотите создать проект.
3. На странице подписок последовательно выберите **Управление доступом (IAM)**  > **Проверить доступ**.
4. В разделе **Проверка доступа** найдите соответствующую учетную запись пользователя.
5. В разделе **Добавление назначения роли** щелкните **Добавить**.

    ![Поиск учетной записи пользователя для проверки доступа и назначения роли](./media/tutorial-discover-physical/azure-account-access.png)

6. В разделе **Добавление назначения роли** выберите роль "Участник" или "Владелец", а затем — учетную запись (в нашем примере — azmigrateuser). Затем нажмите кнопку **Сохранить**.

    ![Открытие страницы "Добавить назначение ролей" для назначения роли учетной записи](./media/tutorial-discover-physical/assign-role.png)

1. Чтобы зарегистрировать устройство, учетной записи Azure необходимы **разрешения на регистрацию приложений AAD**.
1. На портале Azure перейдите в раздел **Azure Active Directory** > **Пользователи** > **Параметры пользователей**.
1. В разделе **Параметры пользователя** проверьте, смогут ли пользователи Azure AD регистрировать приложения (по умолчанию задано значение **Да**).

    ![Проверка того, могут ли пользователи регистрировать приложения Active Directory в разделе "Параметры пользователя"](./media/tutorial-discover-physical/register-apps.png)

9. Если для параметра "Регистрация приложений" задано значение "Нет", попросите администратора арендатора или глобального администратора назначить необходимое разрешение. Кроме того, администратор арендатора или глобальный администратор могут назначить учетной записи роль **Разработчик приложений**, позволяющую регистрировать приложения AAD. [Подробнее](../active-directory/fundamentals/active-directory-users-assign-role-azure-portal.md).

## <a name="prepare-physical-servers"></a>Подготовка физических серверов

Настройте учетную запись, которую устройство может использовать для доступа к физическим серверам.

- При работе с **серверами Windows** используйте учетную запись домена для присоединенных к домену серверов, а для компьютеров, которые не присоединены к домену, — локальную учетную запись. Учетная запись пользователя должна быть добавлена в следующие группы: "Пользователи удаленного управления", "Пользователи Монитора производительности" и "Пользователи журналов производительности".
    > [!Note]
    > Для Windows Server 2008 и 2008 R2 убедитесь, что на серверах установлен WMF 3.0 и что локальная учетная запись или учетная запись домена, используемая для доступа к серверам, добавлена в следующие группы: "Пользователи системного монитора", "Пользователи журнала производительности" и WinRMRemoteWMIUsers.

- Для **серверов Linux** вам потребуются права суперпользователя на серверах Linux, которые вы хотите обнаружить. Кроме того, можно задать некорневую учетную запись с необходимыми возможностями с помощью следующих команд:

**Command** | **Назначение**
--- | --- |
setcap CAP_DAC_READ_SEARCH+eip /usr/sbin/fdisk <br></br> setcap CAP_DAC_READ_SEARCH+eip /sbin/fdisk _(если /usr/sbin/fdisk отсутствует)_ | Получение данных конфигурации дисков
setcap "cap_dac_override,cap_dac_read_search,cap_fowner,cap_fsetid,cap_setuid,<br>cap_setpcap,cap_net_bind_service,cap_net_admin,cap_sys_chroot,cap_sys_admin,<br>cap_sys_resource,cap_audit_control,cap_setfcap=+eip" /sbin/lvm | Получение данных о производительности дисков
setcap CAP_DAC_READ_SEARCH+eip /usr/sbin/dmidecode | Получение серийного номера BIOS
chmod a+r /sys/class/dmi/id/product_uuid | Получение GUID BIOS


## <a name="set-up-a-project"></a>Настройка проекта

Настройте новый проект.

1. На портал Azure выберите **Все службы** и найдите службу **Миграция Azure**.
2. В разделе **Службы** выберите **Миграция Azure**.
3. В разделе **Обзор** выберите **Создать проект**.
5. В разделе **Создать проект** выберите подписку Azure и группу ресурсов. Если у вас еще нет группы ресурсов, создайте ее.
6. В разделе **Сведения о проекте** укажите имя проекта и регион для создания проекта. Просмотрите список поддерживаемых регионов для [общедоступного](migrate-support-matrix.md#supported-geographies-public-cloud) облака и облака для [государственных организаций](migrate-support-matrix.md#supported-geographies-azure-government).

   ![Поля для имени и региона проекта](./media/tutorial-discover-physical/new-project.png)

7. Нажмите кнопку **создания**.
8. Подождите несколько минут, пока завершится развертывание проекта. **Средство "Обнаружение и оценка" службы "Миграция Azure"** по умолчанию добавляется в каждый новый проект.

![Страница с изображением средства оценки серверов, добавленного по умолчанию](./media/tutorial-discover-physical/added-tool.png)

> [!NOTE]
> Если вы уже создали проект, вы можете использовать один и тот же проект для регистрации дополнительных устройств, чтобы обнаружить и оценить большее количество серверов. [См. дополнительные сведения](create-manage-projects.md#find-a-project).

## <a name="set-up-the-appliance"></a>Настройка устройства

Устройство службы "Миграция Azure" выполняет обнаружение серверов и отправляет метаданные об их конфигурации и производительности в службу "Миграция Azure". Чтобы настроить устройство, выполните скрипт PowerShell, который можно скачать из проекта.

Чтобы настроить устройство, сделайте следующее.

1. Укажите имя устройства и создайте ключ проекта на портале.
2. Скачайте ZIP-файл со скриптом установщика службы "Миграция Azure" с портала Azure.
3. Извлеките содержимое ZIP-файла. Откройте консоль PowerShell с правами администратора.
4. Выполните скрипт PowerShell, чтобы запустить веб-приложение устройства.
5. Выполните первоначальную настройку устройства и зарегистрируйте его в проекте с помощью ключа проекта.

### <a name="1-generate-the-project-key"></a>1. Создание ключа проекта

1. Откройте раздел **Цели миграции** > **Серверы** > **Azure Migrate: Discovery and assessment** (Миграция Azure: обнаружение и оценка), затем выберите **Обнаружение**.
2. В разделе **Discover servers** > **Are your servers virtualized?** (Обнаружение серверов > Сервера виртуализированы?) выберите **Physical or other (AWS, GCP, Xen, etc.)** (Физический или другой, например AWS, GCP и Xen).
3. В разделе **1:Generate project key** (1. Создание ключа проекта) укажите имя устройства службы "Миграция Azure", которое вы настроите для обнаружения виртуальных или физических серверов. Это имя должно содержать буквы и цифры (не более 14 символов).
1. Щелкните **Создать ключ**, чтобы начать создание необходимых ресурсов Azure. Не закрывайте страницу "Обнаружение серверов" во время создания ресурсов.
1. После успешного создания ресурсов Azure будет создан **ключ проекта**.
1. Скопируйте этот ключ, так как он понадобится вам для завершения регистрации модуля во время его настройки.

### <a name="2-download-the-installer-script"></a>2. Скачивание скрипта установщика

В разделе **2: Скачайте модуль "Миграция Azure"** щелкните действие **Скачать**.

### <a name="verify-security"></a>Проверка безопасности

Прежде чем развертывать сжатый ZIP-файл, убедитесь, что он не поврежден.

1. На сервере, где скачан файл, откройте командное окно с правами администратора.
2. Выполните следующую команду, чтобы создать хэш ZIP-файла.
    - ```C:\>CertUtil -HashFile <file_location> [Hashing Algorithm]```
    - Пример использования для общедоступного облака: ```C:\>CertUtil -HashFile C:\Users\administrator\Desktop\AzureMigrateInstaller-Server-Public.zip SHA256 ```.
    - Пример использования для облака для государственных организаций: ```  C:\>CertUtil -HashFile C:\Users\administrator\Desktop\AzureMigrateInstaller-Server-USGov.zip SHA256 ```.
3.  Проверьте последние версии и хэш-значения устройств:
    - Для общедоступного облака:

        **Сценарий** | **Скачать** _ | _ *Значение хэша**
        --- | --- | ---
        Физический сервер (85,8 МБ) | [Последняя версия](https://go.microsoft.com/fwlink/?linkid=2140334) | ce5e6f0507936def8020eb7b3109173dad60fc51dd39c3bd23099bc9baaabe29

    - Для Azure для государственных организаций:

        **Сценарий** | **Скачать** _ | _ *Значение хэша**
        --- | --- | ---
        Физический сервер (85,8 МБ) | [Последняя версия](https://go.microsoft.com/fwlink/?linkid=2140338) | ae132ebc574caf231bf41886891040ffa7abbe150c8b50436818b69e58622276
 

### <a name="3-run-the-azure-migrate-installer-script"></a>3. Запуск скрипта установщика службы "Миграция Azure"
Скрипт установщика выполняет следующие операции.

- Устанавливает агенты и веб-приложения для обнаружения и оценки физических серверов.
- Устанавливает роли Windows, включая службу активации Windows, IIS и интегрированную среду разработку PowerShell.
- Скачивает и устанавливает доступный для записи модуль IIS. [Подробнее](https://www.microsoft.com/download/details.aspx?id=7435).
- Обновляет раздел реестра (HKLM), используя постоянные значения параметров для службы "Миграция Azure".
- Создает следующие файлы по указанному пути.
    - **Файлы конфигурации**: %Programdata%\Microsoft Azure\Config
    - **Файлы журнала**: %Programdata%\Microsoft Azure\Logs

Выполните скрипт следующим образом:

1. Извлеките ZIP-файл в папку на сервере, на котором будет размещено устройство.  Следите за тем, чтобы не выполнить этот скрипт на сервере, где уже существует устройство службы "Миграция Azure".
2. Запустите PowerShell на указанном сервере с повышенными правами (права администратора).
3. Измените каталог PowerShell на папку, в которую было извлечено содержимое скачанного ZIP-файла.
4. Запустите скрипт с именем **AzureMigrateInstaller.ps1**, выполнив следующую команду:

    - Для общедоступного облака: 
    
        ``` PS C:\Users\administrator\Desktop\AzureMigrateInstaller-Server-Public> .\AzureMigrateInstaller.ps1 ```
    - Для Azure для государственных организаций: 
    
        ``` PS C:\Users\Administrators\Desktop\AzureMigrateInstaller-Server-USGov>.\AzureMigrateInstaller.ps1 ```

    После успешного завершения скрипт запустит веб-приложение устройства.

Журналы скриптов для устранения неполадок см. здесь: C:\ProgramData\Microsoft Azure\Logs\AzureMigrateScenarioInstaller_<em>Timestamp</em>.log.

### <a name="verify-appliance-access-to-azure"></a>Проверка доступа устройства к Azure

Убедитесь, что устройство может подключиться к URL-адресам Azure для [общедоступного](migrate-appliance.md#public-cloud-urls) облака и облака для [государственных организаций](migrate-appliance.md#government-cloud-urls).

### <a name="4-configure-the-appliance"></a>4. Настройка устройства

Настройте устройство в первый раз.

1. Откройте браузер на любом сервере, который может подключиться к устройству, и перейдите по URL-адресу веб-приложения устройства: **https://*имя или IP-адрес устройства*:44368**.

   Кроме того, вы можете открыть приложение с рабочего стола, щелкнув ярлык приложения.
2. Примите **условия лицензии** и прочитайте информацию от сторонних производителей.
1. В веб-приложении выберите **Настройка необходимых компонентов** и выполните приведенные ниже действия.
    - **Возможность подключения**: Приложение проверит наличие доступа к Интернету у сервера. Если на сервере используется прокси-сервер:
        - Щелкните **Настройка прокси-сервера** и укажите адрес прокси-сервера (в формате http://ProxyIPAddress или http://ProxyFQDN) ) и порт прослушивания.
        - Укажите учетные данные, если для прокси-сервера требуется аутентификация.
        - Поддерживается только прокси-сервер HTTP.
        - Если вы добавили сведения о прокси-сервере или отключили его и (или) проверку подлинности, щелкните **Сохранить**, чтобы снова запустить проверку подключения.
    - **Синхронизация времени**: время проверяется. Для правильной работы обнаружения серверов время на устройстве должно быть синхронизировано со временем в Интернете.
    - **Установка обновлений**: средство "Обнаружение и оценка" службы "Миграция Azure" проверяет, установлены ли на устройстве последние обновления. После завершения проверки вы можете щелкнуть пункт **View appliance services** (Просмотр служб модуля), чтобы просмотреть состояние и версии компонентов, используемых модулем.

### <a name="register-the-appliance-with-azure-migrate"></a>Регистрация устройства с помощью службы "Миграция Azure"

1. Вставьте **ключ проекта**, ранее скопированный на портале. Если у вас нет ключа, последовательно выберите **Azure Migrate: Discovery and assessment > Discover > Manage existing appliances** (Миграция Azure: обнаружение и оценка > Обнаружение > Управление существующими устройствами), выберите имя устройства, указанное вами во время создания ключа, и скопируйте соответствующий ключ.
1. Вам потребуется код устройства для аутентификации в Azure. Если щелкнуть **Вход**, откроется модальное окно с кодом устройства, как показано ниже.

    ![Модальное окно с кодом устройства](./media/tutorial-discover-vmware/device-code.png)

1. Щелкните **Копировать код и войти**, чтобы скопировать код устройства и открыть окно входа в Azure в новой вкладке браузера. Если этот параметр не отображается, убедитесь, что в браузере отключена блокировка всплывающих окон.
1. На новой вкладке вставьте код устройства и выполните вход, используя имя пользователя и пароль Azure.
   
   Вход с помощью PIN-кода не поддерживается.
3. Если вы случайно закроете вкладку входа, не выполнив вход, вам потребуется обновить вкладку браузера в диспетчере конфигурации устройства, чтобы снова активировать кнопку "Вход".
1. После успешного входа вернитесь на предыдущую вкладку с помощью диспетчера конфигурации устройства.
4. Если учетная запись пользователя Azure, используемая для ведения журнала, имеет необходимые [разрешения]() на ресурсы Azure, созданные во время создания ключа, будет инициирована регистрация модуля.
1. После регистрации модуля вы можете просмотреть сведения о регистрации, щелкнув **Просмотреть подробности**.


## <a name="start-continuous-discovery"></a>Запуск непрерывного обнаружения

Далее подключитесь с устройства к физическим серверам, которые требуется обнаружить, и запустите процесс обнаружения.

1. В разделе **Шаг 1. Укажите учетные данные для обнаружения физических или виртуальных серверов Windows и Linux**, щелкнув **Добавить учетные данные**.
1. Для сервера Windows выберите тип источника **Windows Server** (Сервер Windows), укажите понятное имя для учетных данных, добавьте имя пользователя и пароль. Щелкните **Save**(Сохранить).
1. Если для сервера Linux вы используете проверку подлинности на основе пароля, выберите тип источника **Linux Server (Password-based)** (Сервер Linux на основе пароля), укажите понятное имя для учетных данных, добавьте имя пользователя и пароль. Щелкните **Save**(Сохранить).
1. Если для сервера Linux вы используете проверку подлинности на основе ключа SSH, выберите тип источника **Linux Server (SSH key-based)** (Сервер Linux (на основе ключа SSH)), укажите понятное имя для учетных данных, добавьте имя пользователя, найдите и выберите файл закрытого ключа SSH. Щелкните **Save**(Сохранить).

    - Служба "Миграция Azure" поддерживает закрытый ключ SSH, созданный командой ssh-keygen с использованием алгоритмов RSA, DSA, ECDSA и ed25519.
    - Сейчас служба "Миграция Azure" не поддерживает ключ SSH на основе парольной фразы. Используйте ключ SSH без парольной фразы.
    - Сейчас служба "Миграция Azure" не поддерживает файл закрытого ключа SSH, созданный с помощью PuTTY.
    - Миграция Azure поддерживает формат OpenSSH для файла закрытого ключа SSH, как показано ниже:
    
    ![Поддерживаемый формат закрытого ключа SSH](./media/tutorial-discover-physical/key-format.png)

1. Если вы хотите добавить несколько учетных данных одновременно, щелкните **Добавить еще**, чтобы сохранить и добавить дополнительные учетные данные. Для обнаружения физических серверов можно ввести несколько учетных данных.
1. В разделе **Шаг 2. Указание сведений о физическом или виртуальном сервере** щелкните **Добавить источник обнаружения**, чтобы указать значение **IP-адрес или полное доменное имя** сервера и понятное имя учетных данных для подключения к серверу.
1. За один раз можно выбрать пункт **Add single item** (Добавить один элемент) или **Add multiple items** (Добавить несколько элементов). Здесь также есть параметр **Импорт CSV** для предоставления сведений о сервере.


    - Если вы выберете пункт **Add single item** (Добавить один элемент), вы сможете выбрать тип операционной системы, указать понятное имя для учетных данных и ввести **IP-адрес или полное доменное имя** для нужного сервера, а затем щелкнуть **Сохранить**.
    - Если вы выберете пункт **Add multiple items** (Добавить несколько элементов), вы сможете добавить несколько записей за один раз, указав в текстовом поле **IP-адрес или полное доменное имя** сервера с понятным именем для учетных данных. Проверьте добавленные записи и щелкните **Save** (Сохранить).
    - Если вы выберете пункт **Импорт CSV** _(он выбран по умолчанию)_ , вы сможете скачать CSV-файл шаблона и указать в нем **IP-адрес или полное доменное имя сервера** и понятное имя для учетных данных. Затем импортируйте файл в виртуальный модуль, нажмите кнопку **Проверить** для проверки записей в файле и щелкните **Сохранить**.

1. При нажатии кнопки "Сохранить" модуль попытается проверить подключение к добавленным серверам и отобразит **состояние проверки** в таблице для каждого из них.
    - Если проверка сервера завершилась неудачно, просмотрите ошибку, щелкнув пункт **Проверка не пройдена** в столбце "Состояние" таблицы. Устраните проблему и выполните проверку еще раз.
    - Чтобы удалить сервер, щелкните **Удалить**.
1. Вы можете **повторно проверить** подключение к серверам в любое время, пока не начнете обнаружение.
1. Щелкните **Начать обнаружение**, чтобы запустить обнаружение успешно проверенных серверов. После успешного запуска обнаружения вы можете проверить состояние обнаружения для каждого сервера в таблице.


Запустится обнаружение. Чтобы метаданные обнаруженного сервера отобразились на портале Azure, потребуется около 2 минут на каждый сервер.

## <a name="verify-servers-in-the-portal"></a>Проверка серверов на портале

После завершения обнаружения вы можете проверить, отображаются ли серверы на портале Azure.

1. Откройте панель мониторинга службы "Миграция Azure".
2. На странице **Azure Migrate — Servers** > **Azure Migrate: Discovery and assessment** (Миграция Azure — серверы > Миграция Azure: обнаружение и оценка) щелкните значок, отображающий количество **обнаруженных серверов**.
## <a name="next-steps"></a>Дальнейшие действия

- [Оцените готовность физических серверов](tutorial-assess-physical.md) к переносу на виртуальные машины Azure.
- [Просмотрите данные](migrate-appliance.md#collected-data---physical), собранные устройством во время обнаружения.