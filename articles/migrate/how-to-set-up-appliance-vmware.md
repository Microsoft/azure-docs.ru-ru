---
title: Настройка устройства "миграция Azure" для VMware
description: Узнайте, как настроить устройство "миграция Azure" для оценки и миграции виртуальных машин VMware.
author: vikram1988
ms.author: vibansa
ms.manager: abhemraj
ms.topic: how-to
ms.date: 04/16/2020
ms.openlocfilehash: bac82b2939e5b6a674c75be2cd330dd0fa4b8487
ms.sourcegitcommit: 867cb1b7a1f3a1f0b427282c648d411d0ca4f81f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/20/2021
ms.locfileid: "102035806"
---
# <a name="set-up-an-appliance-for-vmware-vms"></a>Настройка устройства для виртуальных машин VMware

В этой статье описывается настройка устройства "миграция Azure" для оценки с помощью средства " [Миграция](migrate-services-overview.md#azure-migrate-server-assessment-tool) Azure", а также для миграции без агента с использованием средства [миграции Azure "миграция сервера](migrate-services-overview.md#azure-migrate-server-migration-tool) ".

[Устройство миграции Azure](migrate-appliance.md) — это упрощенное устройство, используемое службой "миграция Azure": Оценка серверов и миграция серверов для обнаружения серверов, работающих в vCenter Server, отправки конфигурации сервера и метаданных производительности в Azure, а также для репликации серверов с помощью миграции без агента.

Вы можете развернуть устройство с помощью нескольких методов:

- Создайте сервер на vCenter Server с помощью скачанного шаблона OVA. Этот метод описан в этой статье.
- Настройте устройство на существующем сервере с помощью скрипта установщика PowerShell. [Этот метод](deploy-appliance-script.md) следует использовать, если вы не можете использовать шаблон OVA или если вы находитесь в Azure для государственных организаций.

После создания устройства вы убедитесь, что оно может подключиться к службе "миграция Azure": Оценка сервера, регистрация в проекте службы "миграция Azure" и Настройка устройства для запуска обнаружения.

## <a name="deploy-with-ova"></a>Развертывание с помощью OVA

Чтобы настроить устройство с помощью шаблона OVA, сделайте следующее:
1. Укажите имя устройства и создайте ключ проекта службы"Миграция Azure" на портале.
1. Скачайте файл шаблона OVA и импортируйте его в vCenter Server. Убедитесь в защищенности OVA.
1. Создайте виртуальную машину устройства из файла OVA и убедитесь, что она может подключиться к службе "миграция Azure".
1. Настройте устройство в первый раз и зарегистрируйте его в проекте с помощью ключа проекта "миграция Azure".

### <a name="1-generate-the-azure-migrate-project-key"></a>1. Создание ключа проекта службы "Миграция Azure"

1. Последовательно выберите разделы **Цели миграции** > **Серверы** > **Azure Migrate: оценка серверов** и щелкните **Обнаружить**.
2. В разделе **Обнаружение компьютеров** > **Ваши компьютеры виртуализированы?** щелкните **Да, с использованием VMware vSphere Hypervisor**.
3. В **разделе 1. Создание ключа проекта для службы "миграция Azure**" укажите имя для устройства "миграция Azure", которое будет настроено для обнаружения серверов в среде VMware. Имя должно состоять из букв и цифр длиной не более 14 символов.
1. Щелкните **Создать ключ**, чтобы начать создание необходимых ресурсов Azure. Не закрывайте страницу обнаружения во время создания ресурсов.
1. После успешного создания ресурсов Azure будет создан **ключ проекта службы "Миграция Azure"** .
1. Скопируйте этот ключ, так как он понадобится вам для завершения регистрации модуля во время его настройки.

### <a name="2-download-the-ova-template"></a>2. Скачивание шаблона OVA

В разделе **2: Download Azure Migrate appliance** (2. Скачивание виртуального модуля службы "Миграция Azure") выберите OVA-файл и щелкните **Загрузка**.

### <a name="verify-security"></a>Проверка безопасности

Прежде чем развертывать OVA-файл, убедитесь, что он не поврежден.

1. На сервере, где был скачан файл, откройте окно командной строки администратора.
2. Выполните следующую команду, чтобы создать хэш OVA-файла.
  
   ```C:\>CertUtil -HashFile <file_location> [Hashing Algorithm]```
   
   Пример использования: ```C:\>CertUtil -HashFile C:\Users\Administrator\Desktop\MicrosoftAzureMigration.ova SHA256```

3. Проверьте последние версии и хэш-значения устройств:

    - Для общедоступного облака Azure:
    
        **Алгоритм** | **Загрузить** | **SHA256**
        --- | --- | ---
        VMware (11,9 ГБ) | [Последняя версия](https://go.microsoft.com/fwlink/?linkid=2140333) | e9c9a1fe4f3ebae81008328e8f3a7933d78ff835ecd871d1b17f367621ce3c74


### <a name="3-create-the-appliance-server"></a>3. Создание сервера устройства

Импорт скачанного файла и создание сервера в среде VMware

1. В консоли клиента vSphere щелкните **File** (Файл)  > **Deploy OVF Template** (Развернуть шаблон OVF).
2. В мастере развертывания шаблона OVF выберите **Source** (Источник) и укажите расположение OVA-файла.
3. В поле **имя** и **Расположение** укажите понятное имя сервера. Выберите объект инвентаризации, в котором будет размещен сервер.
5. В **узле или кластере** укажите узел или кластер, на котором будет выполняться сервер.
6. В поле **хранилище** укажите место хранения для сервера.
7. В поле **Disk Format** (Формат диска) укажите тип и размер диска.
8. В поле **Сетевое сопоставление** укажите сеть, к которой будет подключаться сервер. Для отправки метаданных в службу "миграция Azure" сети требуется подключение к Интернету.
9. Просмотрите и подтвердите параметры, а затем нажмите кнопку **Finish** (Готово).


### <a name="verify-appliance-access-to-azure"></a>Проверка доступа устройства к Azure

Убедитесь, что сервер устройства может подключаться к URL-адресам Azure для [общедоступных](migrate-appliance.md#public-cloud-urls) и [государственных](migrate-appliance.md#government-cloud-urls) облаков.


### <a name="4-configure-the-appliance"></a>4. Настройка устройства

Настройте устройство в первый раз.

> [!NOTE]
> Если вы настраиваете устройство с помощью [**сценария PowerShell**](deploy-appliance-script.md) вместо скачанного OVA, первые два шага в этой процедуре не важны.

1. В консоли клиента vSphere щелкните правой кнопкой мыши сервер и выберите **открыть консоль**.
2. Укажите язык, часовой пояс и пароль для устройства.
3. Откройте браузер на любом компьютере, который может подключиться к серверу устройства, и откройте URL-адрес диспетчера конфигурации устройства: `https://appliance name or IP address: 44368` .

   Кроме того, диспетчер конфигурации можно открыть с рабочего стола сервера приложений, выбрав ярлык для диспетчера конфигурации.
1. Примите **условия лицензии** и прочитайте информацию от сторонних производителей.
1. В Configuration Manager > **настроить необходимые компоненты**, выполните следующие действия.
   - **Подключение**. устройство проверяет, есть ли у сервера доступ к Интернету. Если на сервере используется прокси-сервер:
     - Щелкните **настроить прокси-сервер** , чтобы указать адрес прокси-сервера в форме `http://ProxyIPAddress` или `http://ProxyFQDN` порте прослушивания.
     - Укажите учетные данные, если для прокси-сервера требуется аутентификация.
     - Поддерживается только прокси-сервер HTTP.
     - Если вы добавили сведения о прокси-сервере или отключили его и (или) проверку подлинности, щелкните **Сохранить**, чтобы снова запустить проверку подключения.
   - **Синхронизация времени**: Время на устройстве должно быть синхронизировано со временем в Интернете, чтобы обнаружение виртуальных машин работало правильно.
   - **Установка обновлений**: Устройство обеспечивает установку последних обновлений. После завершения проверки можно щелкнуть **Просмотр служб устройства** , чтобы просмотреть состояние и версии служб, работающих на сервере устройства.
   - **Установка VDDK**. Устройство проверяет, установлен ли пакет VMware vSphere Virtual Disk Development Kit (VDDK). Если он не установлен, скачайте VDDK 6.7 из VMware и извлеките скачанное содержимое ZIP-файла в указанное расположение в виртуальном модуле, как указано в **инструкциях по установке**.

     Миграция сервера в Azure миграция использует ВДДК для репликации серверов во время миграции в Azure. 
1. При необходимости вы можете **повторить проверку предварительных требований** в любой момент во время настройки модуля, чтобы проверить, соответствует ли виртуальный модуль всем предварительным требованиям.

    :::image type="content" source="./media/tutorial-discover-vmware/appliance-prerequisites.png" alt-text="Панель 1 в диспетчере конфигурации устройства":::


## <a name="register-the-appliance-with-azure-migrate"></a>Регистрация устройства с помощью службы "Миграция Azure"

1. Вставьте **ключ проекта службы "Миграция Azure"** , скопированный с портала. Если у вас нет ключа, последовательно выберите **Server Assessment > Discover > Manage existing appliances** (Оценка сервера > Обнаружение > Управление имеющимися модулями), выберите имя модуля, указанное вами во время создания ключа, и скопируйте соответствующий ключ.
1. Вам потребуется код устройства для аутентификации в Azure. Если щелкнуть **Вход**, откроется модальное окно с кодом устройства, как показано ниже.

    :::image type="content" source="./media/tutorial-discover-vmware/device-code.png" alt-text="Модальное окно с кодом устройства":::

1. Щелкните **Копировать код и войти**, чтобы скопировать код устройства и открыть окно входа в Azure в новой вкладке браузера. Если этот параметр не отображается, убедитесь, что в браузере отключена блокировка всплывающих окон.
1. В новой вкладке вставьте код устройства выполните вход, используя имя пользователя и пароль Azure.
   
   Вход с помощью PIN-кода не поддерживается.
3. Если вы случайно закроете вкладку входа, не выполнив вход, вам потребуется обновить вкладку браузера в диспетчере конфигурации устройства, чтобы снова активировать кнопку "Вход".
1. После успешного входа вернитесь на предыдущую вкладку с помощью диспетчера конфигурации устройства.
1. Если учетная запись пользователя Azure, используемая для ведения журнала, имеет необходимые разрешения на ресурсы Azure, созданные во время создания ключа, будет инициирована регистрация модуля.
1. После регистрации модуля вы можете просмотреть сведения о регистрации, щелкнув **Просмотреть подробности**.

    :::image type="content" source="./media/tutorial-discover-vmware/appliance-registration.png" alt-text="Панель 2 в диспетчере конфигурации устройства":::

## <a name="start-continuous-discovery"></a>Запуск непрерывного обнаружения

### <a name="provide-vcenter-server-details"></a>Укажите сведения о vCenter Server

Устройство должно подключаться к vCenter Server для обнаружения конфигурации и данных производительности серверов.

1. На **шаге 1. Укажите учетные данные vCenter Server**, щелкните **Добавить учетные данные** , чтобы указать понятное имя учетных данных, добавить **имя пользователя** и **пароль** для учетной записи vCenter Server, которую устройство будет использовать для обнаружения серверов, работающих на vCenter Server.
    - Необходимо настроить учетную запись с необходимыми разрешениями, как описано в этой статье выше.
    - Чтобы включить в область обнаружения только определенные объекты VMware (центры обработки данных vCenter Server, кластеры, папку кластеров, узлы, папку узлов или отдельные виртуальные машины), ознакомьтесь с [этой статьей](set-discovery-scope.md), в которой приведены инструкции по применению ограничений для используемой службой "Миграция Azure" учетной записи.
1. На **шаге 2. укажите vCenter Server сведения**, щелкните **Добавить источник обнаружения** , чтобы выбрать понятное имя для учетных данных из раскрывающегося списка. Укажите **IP-адрес или полное доменное** название vCenter Server. Вы можете оставить для пункта **Порт** значение по умолчанию (443) или указать пользовательский порт, на котором vCenter Server ожидает передачу данных, и щелкнуть **Сохранить**.
1. При нажатии кнопки " **сохранить**" устройство попытается проверить подключение к vCenter Server с указанными учетными данными и отобразит **состояние проверки** в таблице в соответствии с vCenter Serverным IP-адресом или полным доменным именем.
1. Вы можете **повторно проверить** подключение к vCenter Server в любое время перед началом обнаружения.

    :::image type="content" source="./media/tutorial-discover-vmware/appliance-manage-sources.png" alt-text="Сведения о vCenter Server см. на панели 3 в диспетчере конфигурации устройства":::

### <a name="provide-server-credentials"></a>Укажите учетные данные сервера

На **шаге 3. предоставление учетных данных сервера для выполнения инвентаризации программного обеспечения, анализ зависимостей без агента и обнаружение экземпляров и баз данных SQL Server.** вы можете указать несколько учетных данных сервера или, если вы не хотите использовать эти функции, можно пропустить шаг и продолжить обнаружение vCenter Server. Вы можете изменить назначение в любое время позже.

:::image type="content" source="./media/tutorial-discover-vmware/appliance-server-credentials-mapping.png" alt-text="Сведения о сервере для панели 3 в диспетчере конфигурации устройства":::

> [!Note]
> Обнаружение и оценка SQL Server экземпляров и баз данных, работающих в среде VMware, теперь находится на этапе предварительной версии. Чтобы опробовать эту функцию, воспользуйтесь [**этой ссылкой**](https://aka.ms/AzureMigrate/SQL) для создания проекта в регионе **Восточная Австралия**. Если у вас уже есть проект в регионе "Восточная Австралия" и вы хотите опробовать эту функцию, убедитесь, что вы выполнили [**эти предварительные требования**](how-to-discover-sql-existing-project.md) на портале.

Если вы хотите использовать эти функции, можно указать учетные данные сервера, выполнив следующие действия. Устройство будет пытаться автоматически сопоставлять учетные данные с серверами для выполнения функций обнаружения.

- Чтобы добавить учетные данные сервера, нажмите кнопку **Добавить учетные данные** . Откроется модальное окно, в котором можно выбрать **тип учетных данных** из раскрывающегося списка.
- Вы можете указать учетные данные для проверки подлинности домена/Windows (не домена)/Linux (не домена)/SQL Server. Дополнительные [сведения](add-server-credentials.md) о способах предоставления учетных данных и их обработке.
- Для каждого типа учетных данных необходимо указать понятное имя для учетных данных, добавить **имя пользователя** и **пароль** и нажать кнопку **сохранить**.
- При выборе учетных данных домена необходимо также указать полное доменное имя для домена. Полное доменное имя требуется для проверки подлинности учетных данных с Active Directory этого домена.
- Проверьте [необходимые разрешения](add-server-credentials.md#required-permissions) для учетной записи на обнаружение установленных приложений, анализ зависимостей без агента или обнаружение экземпляров SQL Server и баз данных.
- Если вы хотите добавить несколько учетных данных одновременно, щелкните **Добавить еще**, чтобы сохранить и добавить дополнительные учетные данные.
- При нажатии кнопки **сохранить** или **добавить дополнительные** устройство проверяет учетные данные домена на предмет подлинности Active Directory домена. Это делается во избежание блокировки учетных записей, когда устройство выполняет несколько итераций для соотнесения учетных данных с соответствующими серверами.
- **Состояние проверки** для всех учетных данных домена можно просмотреть в таблице учетных данных. Будут проверены только учетные данные домена.
- Если проверка завершается неудачно, можно щелкнуть состояние **неудачно** , чтобы увидеть обнаруженную ошибку, и выбрать команду повторно **проверить учетные данные** после устранения проблемы, чтобы снова проверить неудачные учетные данные домена.


### <a name="start-discovery"></a>Начать обнаружение

1. Нажмите кнопку **начать обнаружение**, чтобы запустить обнаружение vCenter Server. После успешной инициализации обнаружения можно проверить состояние обнаружения по vCenter Serverному IP-адресу или полному доменному имени в таблице sources.
1. Если вы указали учетные данные сервера, Инвентаризация программного обеспечения (Обнаружение установленных приложений) будет автоматически инициирована после завершения обнаружения vCenter Server. Инвентаризация программного обеспечения выполняется каждые 12 часов.
1. [Инвентаризация программного обеспечения](how-to-discover-applications.md) определяет экземпляры SQL Server, выполняемые на серверах, и использует сведения. устройство пытается подключиться к экземплярам через проверку подлинности Windows или SQL Server учетные данные для проверки подлинности, указанные на устройстве, и собирать данные в SQL Server базах данных и их свойствах. Обнаружение SQL выполняется каждые 24 часа.
1. Во время инвентаризации программного обеспечения добавленные учетные данные сервера будут передаваться по серверам и проверяться на предмет анализа зависимостей без агента. Вы можете включить анализ зависимостей без агента для серверов с портала. Для включения анализа зависимостей без агента можно выбрать только серверы, на которых прошла проверка.

Обнаружение выполняется следующим образом:
- Для отображения инвентаризации серверов на портале требуется около 15 минут.
- Обнаружение установленных приложений может занять некоторое время. Длительность зависит от числа обнаруженных серверов. Для серверов 500 для отображения инвентаризации на портале службы "миграция Azure" требуется примерно один час.
- После завершения обнаружения серверов можно включить анализ зависимостей без агента на серверах с портала.
- SQL Server экземпляры и данные баз данных будут отображаться на портале в течение 24 часов с начала операции обнаружения.

## <a name="next-steps"></a>Следующие шаги

Ознакомьтесь с учебниками по [оценке VMware](./tutorial-assess-vmware-azure-vm.md) и [миграции без агента](tutorial-migrate-vmware.md).