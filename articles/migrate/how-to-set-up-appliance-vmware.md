---
title: Настройка устройства "миграция Azure" для VMware
description: Узнайте, как настроить устройство миграции Azure для оценки и миграции серверов в среде VMware.
author: vikram1988
ms.author: vibansa
ms.manager: abhemraj
ms.topic: how-to
ms.date: 04/16/2020
ms.openlocfilehash: c2ffa85ed6cb007dd766d4517a86783d21d4913e
ms.sourcegitcommit: bed20f85722deec33050e0d8881e465f94c79ac2
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/25/2021
ms.locfileid: "105110514"
---
# <a name="set-up-an-appliance-for-servers-in-vmware-environment"></a>Настройка устройства для серверов в среде VMware

В этой статье описано, как настроить устройство для миграции Azure для оценки с помощью средства " [Миграция Azure: обнаружение и оценка](migrate-services-overview.md#azure-migrate-discovery-and-assessment-tool) ", а также для миграции без агента с использованием средства [миграции Azure: сервер](migrate-services-overview.md#azure-migrate-server-migration-tool) .

[Устройство миграции Azure](migrate-appliance.md) — это упрощенное устройство, используемое службой "миграция Azure": обнаружение и оценка, а также миграция серверов для обнаружения серверов, работающих в vCenter Server, отправки конфигурации сервера и метаданных производительности в Azure, а также для репликации серверов с помощью миграции без агента.

Вы можете развернуть устройство с помощью нескольких методов:

- Создайте сервер на vCenter Server с помощью скачанного шаблона OVA. Этот метод описан в этой статье.
- Настройте устройство на существующем сервере с помощью скрипта установщика PowerShell. [Этот метод](deploy-appliance-script.md) следует использовать, если вы не можете использовать шаблон OVA или если вы находитесь в Azure для государственных организаций.

После создания устройства вы убедитесь, что оно может подключиться к службе "миграция Azure": обнаружение и оценка, регистрация в проекте и Настройка устройства для запуска обнаружения.

## <a name="deploy-with-ova"></a>Развертывание с помощью OVA

Чтобы настроить устройство с помощью шаблона OVA, сделайте следующее:

1. Укажите имя устройства и создайте ключ проекта на портале.
1. Скачайте файл шаблона OVA и импортируйте его в vCenter Server. Убедитесь в защищенности OVA.
1. Создайте виртуальную машину устройства из OVA-файла и убедитесь, что оно может подключиться к службе "Миграция Azure".
1. Настройте устройство в первый раз и зарегистрируйте его в проекте с помощью ключа проекта.

### <a name="1-generate-the-project-key"></a>1. Создание ключа проекта

1. В списке **цели миграции**  >  **серверы**  >  **Миграция Azure: обнаружение и оценка** выберите **Обнаружение**.
2. В разделе **Обнаружение серверов**  >  **выполняется виртуализация серверов?** выберите **Да с VMware vSphere гипервизор**.
3. В **1. Создайте ключ проекта**, укажите имя для устройства миграции Azure, которое будет настроено для обнаружения серверов в среде VMware. Это имя должно содержать буквы и цифры (не более 14 символов).
1. Щелкните **Создать ключ**, чтобы начать создание необходимых ресурсов Azure. Не закрывайте страницу Discover во время создания ресурсов.
1. После успешного создания ресурсов Azure создается ключ проекта * *.
1. Скопируйте этот ключ, так как он понадобится вам для завершения регистрации модуля во время его настройки.

### <a name="2-download-the-ova-template"></a>2. Скачивание шаблона OVA

В разделе **2: Download Azure Migrate appliance** (2. Скачивание виртуального модуля службы "Миграция Azure") выберите OVA-файл и щелкните **Загрузка**.

### <a name="verify-security"></a>Проверка безопасности

Прежде чем развертывать OVA-файл, убедитесь, что он не поврежден.

1. На сервере, где скачан файл, откройте командное окно с правами администратора.
2. Выполните следующую команду, чтобы создать хэш OVA-файла.
  
   ```C:\>CertUtil -HashFile <file_location> [Hashing Algorithm]```
   
   Пример использования: ```C:\>CertUtil -HashFile C:\Users\Administrator\Desktop\MicrosoftAzureMigration.ova SHA256```

3. Проверьте последние версии и хэш-значения устройств:

    - Для общедоступного облака Azure:
    
        **Алгоритм** | **Загрузить** | **SHA256**
        --- | --- | ---
        VMware (11,9 ГБ) | [Последняя версия](https://go.microsoft.com/fwlink/?linkid=2140333) | e9c9a1fe4f3ebae81008328e8f3a7933d78ff835ecd871d1b17f367621ce3c74


### <a name="3-create-the-appliance-server"></a>3. Создание сервера устройства

Импорт скачанного файла и создание сервера в среде VMware

1. В консоли клиента vSphere щелкните **File** (Файл)  > **Deploy OVF Template** (Развернуть шаблон OVF).
2. В мастере развертывания шаблона OVF выберите **Source** (Источник) и укажите расположение OVA-файла.
3. В полях **Name** (Имя) и **Location** (Расположение) укажите понятное имя для сервера. Выберите объект инвентаризации, в котором будет размещен этот сервер.
5. В поле **Host/Cluster** (Узел или кластер) укажите узел или кластер, в котором будет работать сервер.
6. В поле **Storage** (Хранилище) укажите место хранения данных сервера.
7. В поле **Disk Format** (Формат диска) укажите тип и размер диска.
8. В поле **Network Mapping** (Сетевое сопоставление) укажите сеть, к которой будет подключен сервер. Этой сети требуется подключение к Интернету для отправки метаданных в службу "Миграция Azure".
9. Просмотрите и подтвердите параметры, а затем нажмите кнопку **Finish** (Готово).


### <a name="verify-appliance-access-to-azure"></a>Проверка доступа устройства к Azure

Убедитесь, что сервер устройства может подключаться к URL-адресам Azure для [общедоступных](migrate-appliance.md#public-cloud-urls) и [государственных](migrate-appliance.md#government-cloud-urls) облаков.


### <a name="4-configure-the-appliance"></a>4. Настройка устройства

Настройте устройство в первый раз.

> [!NOTE]
> Если вы настраиваете устройство с помощью [**скрипта PowerShell**](deploy-appliance-script.md), а не загруженного шаблона OVA, первые два этапа этой процедуры выполнять не нужно.

1. В консоли клиента vSphere щелкните правой кнопкой мыши сервер и выберите **Open Console** (Открыть консоль).
2. Укажите язык, часовой пояс и пароль для устройства.
3. Откройте браузер на любом сервере, который может подключиться к серверу устройства, и откройте URL-адрес диспетчера конфигурации устройства: `https://appliance name or IP address: 44368` .

   Кроме того, диспетчер конфигурации можно открыть с рабочего стола сервера устройства, выбрав его ярлык.
1. Примите **условия лицензии** и прочитайте информацию от сторонних производителей.
1. В диспетчере конфигурации выберите **Set up prerequisites** (Настройка необходимых компонентов) и выполните следующее.
   - **Возможность подключения**. Устройство проверит наличие доступа к Интернету у сервера. Если на сервере используется прокси-сервер:
     - Щелкните **Setup Proxy (настроить прокси-сервер** ), чтобы указать адрес прокси-сервера в форме `http://ProxyIPAddress` или `http://ProxyFQDN` порте прослушивания.
     - Укажите учетные данные, если для прокси-сервера требуется аутентификация.
     - Поддерживается только прокси-сервер HTTP.
     - Если вы добавили сведения о прокси-сервере или отключили его и (или) проверку подлинности, щелкните **Сохранить**, чтобы снова запустить проверку подключения.
   - **Синхронизация времени**: Время на устройстве должно быть синхронизировано со временем в Интернете, чтобы обнаружение виртуальных машин работало правильно.
   - **Установка обновлений**: Устройство обеспечивает установку последних обновлений. После завершения проверки вы можете щелкнуть пункт **View appliance services** (Просмотр служб модуля), чтобы просмотреть состояние и версии служб, используемых на сервере устройства.
   - **Установка VDDK**. Устройство проверяет, установлен ли пакет VMware vSphere Virtual Disk Development Kit (VDDK). Если он не установлен, скачайте VDDK 6.7 из VMware и извлеките скачанное содержимое ZIP-файла в указанное расположение в виртуальном модуле, как указано в **инструкциях по установке**.

     Средство миграции серверов службы "Миграция Azure" использует VDDK для репликации серверов во время миграции на Azure. 
1. При необходимости вы можете **повторить проверку предварительных требований** в любой момент во время настройки модуля, чтобы проверить, соответствует ли виртуальный модуль всем предварительным требованиям.

    :::image type="content" source="./media/tutorial-discover-vmware/appliance-prerequisites.png" alt-text="Панель 1 в диспетчере конфигурации устройства":::


## <a name="register-the-appliance-with-azure-migrate"></a>Регистрация устройства с помощью службы "Миграция Azure"

1. Вставьте **ключ проекта** , скопированный с портала. Если у вас нет ключа, перейдите к разделу **Обнаружение и оценка> обнаружение> управление существующими устройствами**, выберите имя устройства, которое вы указали во время создания ключа, и скопируйте соответствующий ключ.
1. Вам потребуется код устройства для аутентификации в Azure. Если щелкнуть **Вход**, откроется модальное окно с кодом устройства, как показано ниже.

    :::image type="content" source="./media/tutorial-discover-vmware/device-code.png" alt-text="Модальное окно с кодом устройства":::

1. Щелкните **Копировать код и войти**, чтобы скопировать код устройства и открыть окно входа в Azure в новой вкладке браузера. Если этот параметр не отображается, убедитесь, что в браузере отключена блокировка всплывающих окон.
1. На новой вкладке вставьте код устройства и выполните вход с помощью имени пользователя и пароля Azure.
   
   Вход с помощью PIN-кода не поддерживается.
3. Если вы случайно закроете вкладку входа, не выполнив вход, вам потребуется обновить вкладку браузера в диспетчере конфигурации устройства, чтобы снова активировать кнопку "Вход".
1. После успешного входа вернитесь на предыдущую вкладку с помощью диспетчера конфигурации устройства.
1. Если учетная запись пользователя Azure, используемая для ведения журнала, имеет необходимые разрешения на ресурсы Azure, созданные во время создания ключа, будет инициирована регистрация модуля.
1. После регистрации модуля вы можете просмотреть сведения о регистрации, щелкнув **Просмотреть подробности**.

    :::image type="content" source="./media/tutorial-discover-vmware/appliance-registration.png" alt-text="Панель 2 в диспетчере конфигурации устройства":::

## <a name="start-continuous-discovery"></a>Запуск непрерывного обнаружения

### <a name="provide-vcenter-server-details"></a>Предоставление сведений о vCenter Server

Устройство должно подключиться к vCenter Server для обнаружения конфигурации и данных о производительности серверов.

1. В разделе **Step 1: Provide vCenter Server credentials** (Шаг 1. Предоставление учетных данных vCenter Server) щелкните **Добавить учетные данные**, чтобы указать понятное имя для учетных данных, добавьте значения для пунктов **Имя пользователя** и **Пароль** для учетной записи vCenter Server, которую виртуальный модуль будет использовать для обнаружения серверов в vCenter Server.
    - Вам потребуется учетная запись с необходимыми разрешениями, настроенная, как описано выше в этой статье.
    - Если необходимо выполнить обнаружение для определенных объектов VMware (vCenter Server центров обработки данных, кластеров, папки кластеров, узлов, папки узлов или отдельных серверов), ознакомьтесь с инструкциями в [этой статье](set-discovery-scope.md) , чтобы ограничить учетную запись, используемую службой "миграция Azure".
1. В разделе **Step 2: Provide vCenter Server details** (Шаг 2. Предоставление сведений о vCenter Server) щелкните **Add discovery source** (Добавить источник обнаружения), чтобы выбрать из раскрывающегося списка понятное имя учетных данных, и укажите **IP-адрес или полное доменное имя** vCenter Server. Вы можете оставить для пункта **Порт** значение по умолчанию (443) или указать пользовательский порт, на котором vCenter Server ожидает передачу данных, и щелкнуть **Сохранить**.
1. При нажатии кнопки **Сохранить** устройство попытается проверить подключение к vCenter Server с указанными учетными данными и отобразит **состояние проверки** в таблице для каждого IP-адреса или полного доменного имени vCenter Server.
1. Можно повторно **проверить** подключение к vCenter Server в любое время перед началом обнаружения.

    :::image type="content" source="./media/tutorial-discover-vmware/appliance-manage-sources.png" alt-text="Сведения о vCenter Server для панели в диспетчере конфигурации устройства":::

### <a name="provide-server-credentials"></a>Ввод учетных данных сервера

В разделе **Step 3: Provide server credentials to perform software inventory, agentless dependency analysis and discovery of SQL Server instances and databases** (Шаг 3. Предоставление учетных данных сервера для выполнения инвентаризации программного обеспечения, анализ зависимостей без агента и обнаружение экземпляров и баз данных SQL Server) можно указать несколько учетных данных сервера. Если вы не хотите использовать эти функции, можно пропустить данный шаг и продолжить обнаружение vCenter Server. Вы можете изменить свое назначение в любое время позже.

:::image type="content" source="./media/tutorial-discover-vmware/appliance-server-credentials-mapping.png" alt-text="Панель 3 в диспетчере конфигурации устройства для ввода сведений о сервере":::


Если вы хотите использовать эти функции, можно указать учетные данные сервера, выполнив следующие действия. Устройство будет пытаться автоматически сопоставлять учетные данные с серверами для выполнения функций обнаружения.

- Чтобы добавить учетные данные сервера, нажмите кнопку **Добавить учетные данные** . Откроется модальное окно, в котором можно выбрать **тип учетных данных** из раскрывающегося списка.
- Вы можете указать учетные данные для проверки подлинности в домене, в Windows (без домена) или Linux (без домена) и (или) на сервере SQL Server. [Узнайте больше](add-server-credentials.md) о том, как указать учетные данные и как мы их обрабатываем.
- Для каждого типа учетных данных необходимо указать понятное имя учетных данных, добавить **имя пользователя** и **пароль** и нажать кнопку **Сохранить**.
- При выборе учетных данных домена необходимо также указать полное доменное имя для домена. Полное доменное имя требуется для проверки подлинности учетных данных с Active Directory этого домена.
- Проверьте [необходимые разрешения](add-server-credentials.md#required-permissions) для учетной записи для обнаружения установленных приложений, анализа зависимостей без агента или обнаружения экземпляров и баз данных SQL Server.
- Если вы хотите добавить несколько учетных данных одновременно, щелкните **Добавить еще**, чтобы сохранить и добавить дополнительные учетные данные.
- При нажатии кнопки **Сохранить** или **Добавить еще** устройство проверяет учетные данные домена на предмет подлинности Active Directory домена. Это делается во избежание блокировки учетных записей, когда устройство выполняет несколько итераций для соотнесения учетных данных с соответствующими серверами.
- **Состояние проверки** для всех учетных данных домена можно просмотреть в таблице учетных данных. Будут проверены только учетные данные домена.
- Если проверка завершается неудачно, можно щелкнуть состояние **Сбой**, чтобы просмотреть обнаруженную ошибку, и выбрать команду **Revalidate credentials** (Проверить учетные данные повторно) после устранения проблемы, чтобы снова проверить учетные данные домена, которые привели к сбою.
    :::image type="content" source="./media/tutorial-discover-vmware/add-server-credentials-multiple.png" alt-text="Панель 3 в диспетчере конфигурации устройства для предоставления нескольких учетных данных":::

### <a name="start-discovery"></a>Начать обнаружение

1. Щелкните **Начать обнаружение**, чтобы запустить обнаружение vCenter Server. После успешного запуска обнаружения вы можете проверить состояние обнаружения для IP-адреса или полного доменного имени vCenter Server в таблице источников.
1. Если вы указали учетные данные сервера, инвентаризация программного обеспечения (обнаружение установленных приложений) будет инициирована автоматически после завершения обнаружения vCenter Server. Инвентаризация программного обеспечения выполняется каждые 12 часов.
1. [Инвентаризация программного обеспечения](how-to-discover-applications.md) позволяет определить экземпляры SQL Server, выполняемые на серверах и использующие сведения. Устройство пытается подключиться к экземплярам, используя указанные на нем учетные данные Windows или SQL Server для проверки подлинности, и собрать данные о базах данных SQL Server и их свойствах. Обнаружение SQL выполняется каждые 24 часа.
1. Во время инвентаризации программного обеспечения добавленные учетные данные сервера будут передаваться по серверам и проверяться на предмет анализа зависимостей без агента. Вы можете включить анализ зависимостей без агента для серверов с портала. Для включения анализа зависимостей без агента можно выбрать только серверы, на которых успешно выполнена проверка.

Обнаружение выполняется следующим образом:

- Чтобы метаданные инвентаризации обнаруженных серверов отобразились на портале, потребуется около 15 минут.
- Обнаружение установленных приложений может занять какое-то время, которое зависит от числа обнаруженных серверов. Для отображения данных инвентаризации при обнаружении 500 серверов на портале службы "Миграция Azure" потребуется примерно один час.
- После завершения обнаружения серверов вы можете включить на портале анализ зависимостей без агента на серверах.
- Данные экземпляров SQL Server и баз данных будут отображаться на портале в течение 24 часов с начала операции обнаружения.

## <a name="next-steps"></a>Дальнейшие действия

Ознакомьтесь с учебниками по [оценке VMware](./tutorial-assess-vmware-azure-vm.md) и [миграции без агента](tutorial-migrate-vmware.md).
