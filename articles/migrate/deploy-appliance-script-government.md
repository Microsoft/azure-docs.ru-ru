---
title: Настройка устройства "миграция Azure" в Azure для государственных организаций
description: Узнайте, как настроить устройство для миграции Azure в Azure для государственных организаций.
author: vikram1988
ms.author: vibansa
ms.manager: abhemraj
ms.topic: how-to
ms.date: 03/13/2021
ms.openlocfilehash: c4ca8d8ac24ac174158957e44b5eabe4a89a5340
ms.sourcegitcommit: 2c1b93301174fccea00798df08e08872f53f669c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/22/2021
ms.locfileid: "104775210"
---
# <a name="set-up-an-appliance-in-azure-government"></a>Настройка устройства в Azure для государственных организаций 

Выполните инструкции из этой статьи, чтобы развернуть [устройство миграции Azure](./migrate-appliance-architecture.md) для серверов в среде VMware, серверах на Hyper-V и физических серверах в облаке Azure для государственных организаций. Запустите сценарий для создания устройства и убедитесь, что он может подключиться к Azure. Если вы хотите настроить устройство в общедоступном облаке, выполните инструкции из [этой статьи](deploy-appliance-script.md).


> [!NOTE]
> Возможность развертывания устройства с помощью шаблона (для серверов в среде VMware и в среде Hyper-V) не поддерживается в Azure для государственных организаций.


## <a name="prerequisites"></a>Предварительные требования

Этот сценарий настраивает устройство миграции Azure на существующем физическом сервере или на виртуальном сервере.

- Сервер, который будет работать как устройство, должен работать под Windows Server 2016 с 32 ГБ памяти, 8 виртуальных ЦП, около 80 ГБ дискового накопителя и внешним виртуальным коммутатором. Для этого требуется статический или динамический IP-адрес, а также доступ к Интернету.
- Перед развертыванием устройства ознакомьтесь с подробными сведениями о требованиях к устройству для [серверов в VMware](migrate-appliance.md#appliance---vmware), [на Hyper-V](migrate-appliance.md#appliance---hyper-v)и [физических серверах](migrate-appliance.md#appliance---physical).
- Не запускайте сценарий на существующем устройстве миграции Azure.

## <a name="set-up-the-appliance-for-vmware"></a>Настройка устройства для VMware

Чтобы настроить устройство для VMware, скачайте сжатый ZIP-файл из портал Azure и извлеките его содержимое. Запустите сценарий PowerShell, чтобы запустить веб-приложение устройства. Настройте устройство и настройте его в первый раз. Затем вы регистрируете устройство в проекте.

### <a name="download-the-script"></a>Скачивание скрипта

1. В **целях миграции**  >  **Windows, Linux и серверы SQL Server**  >  **Миграция Azure: обнаружение и оценка**, нажмите кнопку **обнаружить**.
2. В разделе **Обнаружение сервера**  >  **были виртуализированы серверы?** выберите **Да с VMware vSphere гипервизор**.
3. Нажмите кнопку **скачать**, чтобы скачать сжатый ZIP-файл.

### <a name="verify-file-security"></a>Проверка безопасности файлов

Прежде чем развертывать сжатый ZIP-файл, убедитесь, что он не поврежден.

1. На сервере, где скачан файл, откройте командное окно с правами администратора.
2. Выполните следующую команду, чтобы создать хэш ZIP-файла.
    - ```C:\>CertUtil -HashFile <file_location> [Hashing Algorithm]```
    - Пример: ```C:\>CertUtil -HashFile C:\Users\administrator\Desktop\AzureMigrateInstaller-VMWare-USGov.zip SHA256```

3. Проверьте последнюю версию и хэш-значение устройства:

    **Алгоритм** | **Загрузить** | **SHA256**
    --- | --- | ---
    VMware (85,8 МБ) | [Последняя версия](https://go.microsoft.com/fwlink/?linkid=2140337) | 2daaa2a59302bf911e8ef195f8add7d7c8352de77a9af0b860e2a627979085ca


### <a name="run-the-script"></a>Выполнение скрипта

Вот что делает сценарий:

- Устанавливает агенты и веб-приложение.
- Устанавливает роли Windows, включая службу активации Windows, IIS и интегрированную среду сценариев PowerShell.
- Скачивает и устанавливает перезаписываемый модуль IIS. [Подробнее](https://www.microsoft.com/download/details.aspx?id=7435).
- Обновляет раздел реестра (HKLM) с постоянными параметрами для службы "миграция Azure".
- Создает файлы журналов и конфигурации следующим образом:
    - **Файлы конфигурации**:%програмдата%\микрософт азуре\конфиг
    - **Файлы журналов**:%програмдата%\микрософт азуре\логс

Выполните следующее, чтобы запустить этот сценарий.

1. Извлеките ZIP-файл в папку на сервере, на котором будет размещено устройство. Убедитесь, что сценарий не выполняется на сервере с существующим устройством миграции Azure.
2. Запустите PowerShell на сервере с привилегиями администратора (с повышенными правами).
3. Измените каталог PowerShell на папку, содержащую содержимое, извлеченное из скачанного ZIP-файла.
4. Выполните **AzureMigrateInstaller.ps1** скрипта следующим образом:
    
    ``` PS C:\Users\Administrators\Desktop\AzureMigrateInstaller-VMWare-USGov>.\AzureMigrateInstaller.ps1 ```
1. После успешного выполнения скрипта запускается веб-приложение устройства, которое позволяет настроить устройство. При возникновении проблем просмотрите журналы скриптов в файла c:\ProgramData\Microsoft Азуре\логс\ AzureMigrateScenarioInstaller_<em>timestamp</em>. log.

### <a name="verify-access"></a>Проверка доступа

Убедитесь, что устройство может подключаться к URL-адресам Azure для [государственных облаков](migrate-appliance.md#government-cloud-urls).


## <a name="set-up-the-appliance-for-hyper-v"></a>Настройка устройства для Hyper-V

Чтобы настроить устройство для Hyper-V, скачайте сжатый ZIP-файл из портал Azure и извлеките его содержимое. Запустите сценарий PowerShell, чтобы запустить веб-приложение устройства. Настройте устройство и настройте его в первый раз. Затем вы регистрируете устройство в проекте.

### <a name="download-the-script"></a>Скачивание скрипта

1.  В **целях миграции**  >  **Windows, Linux и серверы SQL Server**  >  **Миграция Azure: обнаружение и оценка**, нажмите кнопку **обнаружить**.
2.  В разделе **Обнаружение серверов**  >  **выполняется виртуализация серверов?** выберите **Да, используя Hyper-V**.
3.  Нажмите кнопку **скачать**, чтобы скачать сжатый ZIP-файл. 


### <a name="verify-file-security"></a>Проверка безопасности файлов

Прежде чем развертывать сжатый ZIP-файл, убедитесь, что он не поврежден.

1. На сервере, где скачан файл, откройте командное окно с правами администратора.
2. Выполните следующую команду, чтобы создать хэш ZIP-файла.
    - ```C:\>CertUtil -HashFile <file_location> [Hashing Algorithm]```
    - Пример: ```C:\>CertUtil -HashFile C:\Users\administrator\Desktop\AzureMigrateInstaller-HyperV-USGov.zip SHA256```

3. Проверьте последнюю версию и хэш-значение устройства:

    **Сценарий** | **Загрузить** | **SHA256**
    --- | --- | ---
    Hyper-V (85,8 МБ) | [Последняя версия](https://go.microsoft.com/fwlink/?linkid=2140424) |  db5311de3d1d4a1167183a94e8347456db9c5749c7332ff2eb4b777798765e48

          

### <a name="run-the-script"></a>Выполнение скрипта

Вот что делает сценарий:

- Устанавливает агенты и веб-приложение.
- Устанавливает роли Windows, включая службу активации Windows, IIS и интегрированную среду сценариев PowerShell.
- Скачивает и устанавливает перезаписываемый модуль IIS. [Подробнее](https://www.microsoft.com/download/details.aspx?id=7435).
- Обновляет раздел реестра (HKLM) с постоянными параметрами для службы "миграция Azure".
- Создает файлы журналов и конфигурации следующим образом:
    - **Файлы конфигурации**:%програмдата%\микрософт азуре\конфиг
    - **Файлы журналов**:%програмдата%\микрософт азуре\логс

Выполните следующее, чтобы запустить этот сценарий.

1. Извлеките ZIP-файл в папку на сервере, на котором будет размещено устройство. Убедитесь, что сценарий не выполняется на сервере, на котором запущено существующее устройство Azure Migrate.
2. Запустите PowerShell на сервере с привилегиями администратора (с повышенными правами).
3. Измените каталог PowerShell на папку, содержащую содержимое, извлеченное из скачанного ZIP-файла.
4. Выполните **AzureMigrateInstaller.ps1** скрипта следующим образом: 

    ``` PS C:\Users\Administrators\Desktop\AzureMigrateInstaller-HyperV-USGov>.\AzureMigrateInstaller.ps1 ``` 
1. После успешного выполнения скрипта запускается веб-приложение устройства, которое позволяет настроить устройство. При возникновении проблем просмотрите журналы скриптов в файла c:\ProgramData\Microsoft Азуре\логс\ AzureMigrateScenarioInstaller_<em>timestamp</em>. log.

### <a name="verify-access"></a>Проверка доступа

Убедитесь, что устройство может подключаться к URL-адресам Azure для [государственных облаков](migrate-appliance.md#government-cloud-urls).


## <a name="set-up-the-appliance-for-physical-servers"></a>Настройка устройства для физических серверов

Чтобы настроить устройство для VMware, скачайте сжатый ZIP-файл из портал Azure и извлеките его содержимое. Запустите сценарий PowerShell, чтобы запустить веб-приложение устройства. Настройте устройство и настройте его в первый раз. Затем вы регистрируете устройство в проекте.

### <a name="download-the-script"></a>Скачивание скрипта

1. В **целях миграции**  >  **Windows, Linux и серверы SQL Server**  >  **Миграция Azure: обнаружение и оценка**, нажмите кнопку **обнаружить**.
2. В разделе **Обнаружение серверов**  >  **виртуализованных** серверов выберите вариант **не виртуализировано или другое**.
3. Нажмите кнопку **скачать**, чтобы скачать сжатый ZIP-файл.

### <a name="verify-file-security"></a>Проверка безопасности файлов

Прежде чем развертывать сжатый ZIP-файл, убедитесь, что он не поврежден.

1. На серверах, где был скачан файл, откройте окно командной строки администратора.
2. Выполните следующую команду, чтобы создать хэш ZIP-файла.
    - ```C:\>CertUtil -HashFile <file_location> [Hashing Algorithm]```
    - Пример: ```C:\>CertUtil -HashFile C:\Users\administrator\Desktop\AzureMigrateInstaller-Server-USGov.zip SHA256```

3. Проверьте последнюю версию и хэш-значение устройства:

    **Сценарий** | **Скачать** _ | _ *Значение хэша**
    --- | --- | ---
    Физическое (85 МБ) | [Последняя версия](https://go.microsoft.com/fwlink/?linkid=2140338) | cfed44bb52c9ab3024a628dc7a5d0df8c624f156ec1ecc3507116bae330b257f
          

### <a name="run-the-script"></a>Выполнение скрипта

Вот что делает сценарий:

- Устанавливает агенты и веб-приложение.
- Устанавливает роли Windows, включая службу активации Windows, IIS и интегрированную среду сценариев PowerShell.
- Скачивает и устанавливает перезаписываемый модуль IIS. [Подробнее](https://www.microsoft.com/download/details.aspx?id=7435).
- Обновляет раздел реестра (HKLM) с постоянными параметрами для службы "миграция Azure".
- Создает файлы журналов и конфигурации следующим образом:
    - **Файлы конфигурации**:%програмдата%\микрософт азуре\конфиг
    - **Файлы журналов**:%програмдата%\микрософт азуре\логс

Выполните следующее, чтобы запустить этот сценарий.

1. Извлеките ZIP-файл в папку на сервере, на котором будет размещено устройство. Убедитесь, что сценарий не выполняется на сервере, на котором запущено существующее устройство Azure Migrate.
2. Запустите PowerShell на сервере с привилегиями администратора (с повышенными правами).
3. Измените каталог PowerShell на папку, содержащую содержимое, извлеченное из скачанного ZIP-файла.
4. Выполните **AzureMigrateInstaller.ps1** скрипта следующим образом:

    ``` PS C:\Users\Administrators\Desktop\AzureMigrateInstaller-Server-USGov>.\AzureMigrateInstaller.ps1 ```
1. После успешного выполнения скрипта запускается веб-приложение устройства, которое позволяет настроить устройство. При возникновении проблем просмотрите журналы скриптов в файла c:\ProgramData\Microsoft Азуре\логс\ AzureMigrateScenarioInstaller_<em>timestamp</em>. log.

### <a name="verify-access"></a>Проверка доступа

Убедитесь, что устройство может подключаться к URL-адресам Azure для [государственных облаков](migrate-appliance.md#government-cloud-urls).

## <a name="next-steps"></a>Дальнейшие действия

После развертывания устройства его необходимо настроить в первый раз и зарегистрировать в проекте.

- Настройте устройство для [VMware](how-to-set-up-appliance-vmware.md#4-configure-the-appliance).
- Настройте устройство для [Hyper-V](how-to-set-up-appliance-hyper-v.md#configure-the-appliance).
- Настройте устройство для [физических серверов](how-to-set-up-appliance-physical.md).
