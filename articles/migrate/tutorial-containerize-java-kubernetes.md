---
title: Контейнеризация приложений Azure на Java. Контейнеризация и миграция приложений Java в Azure Kubernetes
description: Руководство по контейнеризации и миграции веб-приложений Java в Службу Azure Kubernetes.
services: ''
author: rahugup
manager: bsiva
ms.topic: tutorial
ms.date: 3/2/2021
ms.author: rahugup
ms.openlocfilehash: 2c1a0ee78e866a12105eca77653b1063943d06db
ms.sourcegitcommit: 32e0fedb80b5a5ed0d2336cea18c3ec3b5015ca1
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/30/2021
ms.locfileid: "105561072"
---
# <a name="java-web-app-containerization-and-migration-to-azure-kubernetes-service"></a>Контейнеризация веб-приложений Java и их перенос в Службу Azure Kubernetes

В этой статье рассказывается, как создать контейнеры на основе веб-приложений Java (запущенных в Apache Tomcat) и перенести их в [Службу Azure Kubernetes (AKS)](https://azure.microsoft.com/services/kubernetes-service/) с помощью инструмента контейнеризации приложений службы "Миграция Azure". Процесс контейнеризации приложений не требует доступа к базе кода и легко применяется к любым существующим приложениям. Этот инструмент анализирует состояние выполнения приложений на сервере для определения компонентов этих приложений и позволяет упаковать их в образ контейнера. Готовый контейнер приложения можно развернуть в Службе Azure Kubernetes (AKS).

В настоящее время инструмент контейнеризации приложений службы "Миграция Azure" поддерживает следующие возможности:

- Создание контейнеров приложений ASP.NET и их развертывание в виде контейнеров Windows в службе AKS. [Дополнительные сведения](./tutorial-containerize-aspnet-kubernetes.md)
- Создание контейнеров веб-приложений Java в Apache Tomcat (на серверах Linux) и их развертывание в виде контейнеров Linux в службе AKS.


Инструмент контейнеризации приложений службы "Миграция Azure" помогает выполнять следующие действия:

- **Обнаружение приложений.** Этот инструмент подключается к удаленным серверам приложений, на которых выполняется ваше приложение Java (запущенное в Apache Tomcat), и обнаруживает компоненты этого приложения. Инструмент создает Dockerfile, на основе которого можно создать образ контейнера для приложения.
- **Сборка образа контейнера.** Вы можете проверить и дополнительно настроить Dockerfile в соответствии с требованиями к приложению и применить его для сборки образа контейнера этого приложения. Образ контейнера приложения передается в указанный вами Реестр контейнеров Azure.
- **Развертывание в Службе Azure Kubernetes.** Инструмент создает YAML-файлы с определениями ресурсов Kubernetes, необходимые для развертывания контейнерных приложений в кластере Службы Azure Kubernetes. Вы можете настроить эти YAML-файлы и использовать их для развертывания приложения в AKS.

> [!NOTE]
> Инструмент контейнеризации приложений службы "Миграция Azure" помогает обнаруживать приложения определенных типов (ASP.NET и веб-приложения Java в Apache Tomcat) и их компоненты на сервере приложений. Чтобы обнаружить серверы и составить список приложений, ролей и функций, выполняемых на локальных компьютерах, используйте возможность обнаружения и оценки службы "Миграция Azure". [Дополнительные сведения](./tutorial-discover-vmware.md)

Не все приложения получат преимущества от прямого переноса в контейнеры без значительных изменений архитектуры, но даже без специальной доработки перенос существующих приложений в контейнеры может предоставить следующие преимущества:

- **Улучшенное использование архитектуры.** В контейнерной среде несколько приложений могут использовать одни и те же ресурсы и размещаться на одной инфраструктуре. Это способствует консолидации инфраструктуры и улучшению ее использования.
- **Упрощенное управление.** Размещая приложения в службе AKS или на аналогичной современной платформе с управляемой инфраструктурой, вы сможете упростить методы управления приложениями, сохраняя полный контроль над инфраструктурой. Вы сможете полностью или частично отказаться от тех процессов обслуживания инфраструктуры и управления ею, которые вы бы раньше выполняли для собственной инфраструктуры.
- **Переносимость приложений.** Благодаря расширенному внедрению и стандартизации форматов спецификаций и платформ оркестрации для контейнеров вы сможете избавиться от проблем с переносимостью приложений.
- **Применение современных методов управления на основе DevOps.** Вам будет проще внедрить и стандартизировать современные методы управления и обеспечения безопасности благодаря переходу к модели "инфраструктура как код" и DevOps.


В этом руководстве вы узнаете, как:

> [!div class="checklist"]
> * Настройка учетной записи Azure.
> * Установка инструмента контейнеризации приложений службы "Миграция Azure".
> * Обнаружение веб-приложения Java.
> * Создание образа контейнера.
> * Развертывание контейнерного приложения в AKS.

> [!NOTE]
> В руководствах показан простейший путь развертывания сценария, использование которого позволяет быстро настроить проверку концепции. В руководствах по возможности используются параметры по умолчанию и показаны не все возможные параметры и пути.

## <a name="prerequisites"></a>Предварительные требования

Для работы с этим руководством вам потребуется:

**Требование** | **Сведения**
--- | ---
**Выбор компьютера для установки инструмента** | Компьютер с Windows для установки и запуска инструмента контейнеризации приложений службы "Миграция Azure". Можно использовать компьютер с серверной (Windows Server 2016 или более поздней версии) или клиентской (Windows 10) операционной системой, то есть этот инструмент можно запустить даже на обычном компьютере. <br/><br/> Компьютер с Windows, на котором будет выполняться это средство, должен быть подключен по сети к серверам или виртуальным машинам, где размещены веб-приложения Java, для которых создаются контейнеры.<br/><br/> Убедитесь, что на компьютере с Windows, на котором будет выполняться инструмент контейнеризации приложений службы "Миграция Azure", доступно не менее 6 ГБ свободного пространства для хранения артефактов приложений. <br/><br/> Этот компьютер с Windows должен иметь доступ к Интернету (напрямую или через прокси-сервер).
**Серверы приложений** | Включите подключения по протоколу Secure Shell (SSH) через порт 22 на серверах, на которых выполняются приложения Java, подлежащие контейнеризации. <br/>
**Веб-приложение Java** | В настоящее время этот инструмент поддерживает: <br/><br/> Приложения, работающие в среде Tomcat 8 или более поздней версии.<br/> Серверы приложений на Ubuntu Linux версий 16.04, 18.04 и 20.04, Debian версий 7 и 8, CentOS версий 6 и 7, Red Hat Enterprise Linux версий 5, 6 и 7. <br/> Приложения, использующие Java 7 или более поздней версии.  <br/><br/> В настоящее время инструмент не поддерживает: <br/><br/> Серверы приложений, на которых выполняется несколько экземпляров Tomcat. <br/>  


## <a name="prepare-an-azure-user-account"></a>Подготовка учетной записи пользователя Azure

Если у вас еще нет подписки Azure, [создайте бесплатную учетную запись](https://azure.microsoft.com/pricing/free-trial/), прежде чем начинать работу.

После настройки подписки вам потребуется учетная запись пользователя Azure, у которой есть:
- разрешения владельца для подписки Azure;
- разрешения на регистрацию приложений Azure Active Directory.

Если вы создали бесплатную учетную запись Azure, вы являетесь владельцем подписки. Если вы не являетесь владельцем подписки, назначьте разрешения совместно с владельцем следующим образом:

1. На портале Azure выполните поиск по фразе "подписки" и в разделе **Службы** выберите **Подписки**.

    ![Поле для поиска подписки Azure.](./media/tutorial-discover-vmware/search-subscription.png)

2. На странице **Подписки** выберите подписку, в которой нужно создать проект службы "Миграция Azure".
3. На странице подписок последовательно выберите **Управление доступом (IAM)**  > **Проверить доступ**.
4. В разделе **Проверка доступа** найдите соответствующую учетную запись пользователя.
5. В разделе **Добавление назначения роли** щелкните **Добавить**.

    ![Выполните поиск учетной записи пользователя для проверки доступа и назначения роли.](./media/tutorial-discover-vmware/azure-account-access.png)

6. В разделе **Добавление назначения роли** выберите роль "Владелец", а затем — учетную запись (в нашем примере это azmigrateuser). Затем нажмите кнопку **Сохранить**.

    ![Откройте страницу "Добавление назначения роли", чтобы назначить роль учетной записи.](./media/tutorial-discover-vmware/assign-role.png)

7. Учетная запись Azure должна также иметь **разрешения на регистрацию приложений Azure Active Directory**.
8.  На портале Azure перейдите в раздел **Azure Active Directory** > **Пользователи** > **Параметры пользователей**.
9.  В разделе **Параметры пользователя** проверьте, смогут ли пользователи Azure AD регистрировать приложения (по умолчанию задано значение **Да**).

      ![Убедитесь, что пользователи могут регистрировать приложения Active Directory, в разделе "Параметры пользователя".](./media/tutorial-discover-vmware/register-apps.png)

10.  Если для параметра "Регистрация приложений" задано значение "Нет", попросите администратора арендатора или глобального администратора назначить необходимое разрешение. Кроме того, администратор арендатора или глобальный администратор могут назначить учетной записи роль **Разработчик приложений**, позволяющую регистрировать приложения Azure Active Directory. [Подробнее.](../active-directory/fundamentals/active-directory-users-assign-role-azure-portal.md)

## <a name="download-and-install-azure-migrate-app-containerization-tool"></a>Скачивание и установка инструмента контейнеризации приложений службы "Миграция Azure"

1. [Скачайте](https://go.microsoft.com/fwlink/?linkid=2134571) на компьютер с Windows установщик инструмента контейнеризации приложений службы "Миграция Azure".
2. Запустите PowerShell в режиме администратора и перейдите в сеансе PowerShell к папке, содержащей установщик.
3. Выполните сценарий установки с помощью такой команды:

   ```powershell
   .\AppContainerizationInstaller.ps1
   ```

## <a name="launch-the-app-containerization-tool"></a>Запуск инструмента контейнеризации приложений

1. Откройте браузер на любом компьютере, который может подключиться к компьютеру с Windows, на котором запущен инструмент контейнеризации приложений, и откройте URL-адрес этого инструмента: **https://*имя или IP-адрес компьютера*:44368**.

   Вы можете также открыть приложение на рабочем столе, щелкнув его ярлык.

2. Если появится предупреждение о том, что подключение не является частным, щелкните "Дополнительно" и подтвердите переход на этот веб-сайт. Такое предупреждение появляется в том случае, если веб-интерфейс использует самозаверяющий сертификат TLS/SSL.
3. На экране входа введите учетную запись администратора на локальном компьютере и выполните вход.
4. В качестве типа приложения, которое требуется контейнеризовать, выберите **Java web apps on Tomcat** (Веб-приложения Java в Tomcat).

    ![Загрузка по умолчанию для инструмента контейнеризации приложений.](./media/tutorial-containerize-apps-aks/tool-home.png)


### <a name="complete-tool-pre-requisites"></a>Заполнение требуемых данных для инструмента
1. Примите **условия лицензии** и прочитайте информацию от сторонних производителей.
6. В веб-приложении инструмента выберите **Set up prerequisites** (Настройка необходимых компонентов) и выполните следующее.
   - **Connectivity** (Подключение). Инструмент убедится, что у компьютера с Windows есть доступ к Интернету. Если компьютер использует прокси-сервер, выполните следующее.
     - Щелкните **Set up proxy** (Настроить прокси-сервер), чтобы указать IP-адрес или полное доменное имя прокси-сервера и порт прослушивания.
     - Укажите учетные данные, если для прокси-сервера требуется аутентификация.
     - Поддерживается только прокси-сервер HTTP.
     - Если вы уже добавили сведения о прокси-сервере либо отключили его и (или) аутентификацию, щелкните **Save** (Сохранить), чтобы снова запустить проверку подключения.
   - **Install updates** (Установить обновления). Инструмент автоматически проверит наличие обновлений и установит их. Вы также можете вручную установить последнюю версию инструмента, которая доступна [здесь](https://go.microsoft.com/fwlink/?linkid=2134571).
   - **Enable Secure Shell (SSH)** (Включить Secure Shell (SSH)). Инструмент сообщит, включен ли протокол Secure Shell (SSH) на серверах приложений, на которых работают веб-приложения Java, выбранные для контейнеризации.


## <a name="login-to-azure"></a>Вход в Azure

Щелкните **Войти**, чтобы войти в свою учетную запись Azure.

1. Для аутентификации в Azure вам потребуется код устройства. Когда вы щелкнете "Вход", откроется модальное окно с кодом устройства.
2. Щелкните **Копировать код и войти**, чтобы скопировать код устройства и открыть окно входа в Azure в новой вкладке браузера. Если этот параметр не отображается, убедитесь, что в браузере отключена блокировка всплывающих окон.

    ![Модальное окно с кодом устройства.](./media/tutorial-containerize-apps-aks/login-modal.png)

3. На новой вкладке вставьте код устройства и завершите процесс входа, используя учетные данные учетной записи Azure. Когда процесс входа завершится, можно закрыть вкладку браузера и вернуться к веб-интерфейсу инструмента контейнеризации приложений.
4. Выберите **арендатор Azure AD**, который вы хотите использовать.
5. Укажите **подписку Azure**, которую нужно использовать.

## <a name="discover-java-web-applications"></a>Обнаружение веб-приложений Java

Вспомогательный инструмент контейнеризации приложений удаленно подключится к серверам приложений с использованием предоставленных учетных данных и попытается обнаружить приложения Java (запущенные в Apache Tomcat), размещенные на этих серверах приложений.

1. Укажите **IP-адрес или полное доменное имя и учетные данные** для сервера, на котором работает веб-приложение Java и к которому вы намерены удаленно подключиться для обнаружения приложений.
    - Необходимо указать учетные данные для учетной записи корня (Linux) на сервере приложений.
    - Для доменных учетных записей (с правами администратора на сервере приложений) добавьте к имени пользователя имя домена в формате *<домен\имя_пользователя>* .
    - Обнаружение приложений можно запустить не более чем для пяти серверов за раз.

2. Нажмите кнопку **Validate** (Проверить), чтобы убедиться, что сервер приложений доступен с того компьютера, на котором запущен инструмент, и что предоставлены допустимые учетные данные. После успешной проверки в столбце состояния отобразится состояние **Mapped** (Сопоставлено).  

    ![Снимок экрана: IP-адрес и учетные данные сервера.](./media/tutorial-containerize-apps-aks/discovery-credentials.png)

3. Щелкните **Continue** (Продолжить), чтобы запустить обнаружение приложений на выбранных серверах приложений.

4. После успешного завершения обнаружения приложений вы сможете выбрать список приложений для контейнеризации.

    ![Снимок экрана: обнаруженное веб-приложение Java.](./media/tutorial-containerize-apps-aks/discovered-app.png)


4. Установите флажки для тех приложений, которые нужно контейнеризовать.
5. **Specify container name** (Укажите имя контейнера). Введите имя целевого контейнера для каждого выбранного приложения. Имя контейнера должно иметь формат <*имя:тег*>, где тег используется для образа контейнера. Например, можно указать имя приложения *appname:v1*.   

### <a name="parameterize-application-configurations"></a>Параметризация конфигураций приложений
Параметризация конфигурации позволяет сделать ее доступной в качестве параметра во время развертывания. Это означает, что вы сможете указать значение параметра при развертывании приложения, а не жестко запрограммировать в образе контейнера. Например, этот вариант очень удобен для таких параметров, как строки подключения к базе данных.
1. Щелкните **app configurations** (Конфигурации приложений), чтобы просмотреть обнаруженные конфигурации.
2. Установите флажки для тех обнаруженных конфигураций приложений, которые вы хотите параметризовать.
3. Завершив выбор конфигураций для параметризации, щелкните **Apply** (Применить).

   ![Снимок экрана: параметризация конфигураций приложения ASP.NET.](./media/tutorial-containerize-apps-aks/discovered-app-configs.png)

### <a name="externalize-file-system-dependencies"></a>Настройка внешних зависимостей файловой системы

 Вы можете добавить другие папки, которые использует приложение. Укажите, нужно ли включить их в образ контейнера или сделать внешними с использованием постоянных томов в общей папке Azure. Использование постоянных томов отлично подходит для приложений с отслеживанием состояния, которые хранят сведения о состоянии вне контейнера или используют другое статическое содержимое, хранящееся в файловой системе. [Дополнительные сведения](../aks/concepts-storage.md)

1. Щелкните **Edit** (Изменить) в разделе "App Folders" (Папки приложений), чтобы просмотреть обнаруженные папки приложений. Обнаруженные папки приложений определяются как обязательные для приложения артефакты и будут скопированы в образ контейнера.

2. Щелкните **Add folders** (Добавить папки) и укажите пути к добавляемым папкам.
3. Чтобы добавить несколько папок в один том, разделите значения их путей запятыми (`,`).
4. Выберите вариант хранилища **Persistent Volume** (Постоянный том), если вам нужно хранить эти папки на постоянном томе за пределами контейнера.
5. Завершив просмотр папок приложения, щелкните **Save** (Сохранить).
   ![Снимок экрана: выбор томов хранилища для приложения.](./media/tutorial-containerize-apps-aks/discovered-app-volumes.png)

6. Щелкните **Continue** (Продолжить), чтобы перейти к этапу сборки образа контейнера.


## <a name="build-container-image"></a>Создание образа контейнера


1. **Выберите реестр контейнеров Azure.** Из раскрывающегося списка выберите [Реестр контейнеров Azure](../container-registry/index.yml), который нужно использовать для сборки и хранения образов контейнеров приложений. Вы можете выбрать уже существующий Реестр контейнеров Azure или создать новый прямо сейчас, выбрав параметр "Create new registry" (Создать реестр).

    ![Снимок экрана: выбор Реестра контейнеров Azure.](./media/tutorial-containerize-apps-aks/build-java-app.png)


2. **Проверьте Dockerfile.** В начале этапа сборки для каждого выбранного приложения создается Dockerfile, который используется для сборки образов контейнеров. Щелкните **Review** (Проверить) для просмотра Dockerfile. На этапе проверки вы можете внести в Dockerfile любые требуемые изменения и сохранить их до начала сборки.

3. **Активируйте процесс сборки.** Выберите приложения, для которых нужно создать образы, и щелкните **Build** (Выполнить сборку). Это действие запустит сборку образа контейнера для каждого приложения. Инструмент постоянно отслеживает состояние сборки и позволяет перейти к следующему шагу только после успешного завершения сборки.

4. **Следите за состоянием сборки.** Вы можете самостоятельно проверить ход этапов сборки, щелкнув ссылку **Build in Progress** (Выполняемая сборка) в столбце состояния. Эта ссылка становится активной через пару минут после начала процесса сборки.  

5. Когда сборка завершится, щелкните **Continue** (Продолжить), чтобы указать параметры развертывания.

    ![Снимок экрана: завершение сборки образа контейнера приложения.](./media/tutorial-containerize-apps-aks/build-java-app-completed.png)

## <a name="deploy-the-containerized-app-on-aks"></a>Развертывание контейнерного приложения в AKS

Следующим этапом после сборки образа является развертывание приложения в виде контейнера в [Службе Azure Kubernetes (AKS)](https://azure.microsoft.com/services/kubernetes-service/).

1. **Выберите кластер Службы Azure Kubernetes.** Укажите кластер AKS, в котором нужно развернуть это приложение.

     - Выбранный кластер AKS должен содержать пул узлов Linux.
     - В этом кластере необходимо настроить извлечение образов из Реестра контейнеров Azure, который вы ранее выбрали для хранения образов.
         - Чтобы подключить кластер AKS к Реестру контейнеров Azure, выполните приведенную ниже команду в интерфейсе командной строки Azure.
           ``` Azure CLI
           az aks update -n <cluster-name> -g <cluster-resource-group> --attach-acr <acr-name>
           ```  
     - Если у вас еще нет кластера AKS или вы намерены создать кластер AKS специально для развертывания конкретного приложения, кластер можно создать непосредственно в интерфейсе инструмента, щелкнув **Create new AKS cluster** (Создать кластер AKS).      
          - Созданный с помощью инструмента кластер AKS будет содержать пул узлов Linux. Также для этого кластера будет настроено извлечение образов из ранее созданного Реестра контейнеров Azure, если вы выбрали такой вариант.
     - Завершив выбор кластера AKS, щелкните **Continue** (Продолжить).

2. **Укажите общую папку Azure.** Если вы ранее добавили дополнительные папки и выбрали хранение данных на постоянном томе, здесь нужно выбрать общую папку Azure, которую инструмент контейнеризации приложений службы "Миграция Azure" будет использовать в процессе развертывания. В этой общей папке Azure инструмент создаст каталоги для копирования всех папок приложений, для которых было выбрано хранение на постоянном томе. Когда развертывание приложения завершится, инструмент очистит общую папку Azure, то есть удалит все созданные ранее каталоги.

     - Если у вас еще нет общей папки Azure или вы намерены использовать новую общую папку Azure, ее можно создать непосредственно в интерфейсе инструмента, щелкнув **Create new Storage Account and file share** (Создать учетную запись хранения и общую папку).  

3. **Конфигурация развертывания приложения.** После завершения всех описанных выше шагов вам нужно лишь указать конфигурацию развертывания для приложения. Щелкните **Configure** (Настроить), чтобы изменить развертывание для приложения. На этапе настройки вы можете изменить следующие параметры:
     - **Prefix string** (Строка префикса): эта строка будет использоваться как префикс имени для всех ресурсов, которые создаются для контейнерного приложения в кластере AKS.
     - **Replica Sets** (Наборы реплик): укажите количество экземпляров (pod) приложения, которые должны выполняться внутри контейнеров.
     - **Load balancer type** (Тип подсистемы балансировки нагрузки): выберите параметр *External* (Внешняя), если контейнерное приложение должно быть доступно из публичных сетей.
     - **Application Configuration** (Конфигурация приложения): для всех параметризованных конфигураций приложения здесь нужно указать конкретные значения для текущего развертывания.
     - **Storage** (Хранилище): для всех папок приложения, для которых настроено хранение в постоянном томе, нужно указать, будут ли все экземпляры приложения использовать один том или следует инициализировать отдельный том для каждого экземпляра в контейнере. По умолчанию все папки приложений на постоянных томах настраиваются как совместно используемые.
     - Щелкните **Apply** (Применить), чтобы сохранить конфигурацию развертывания.
     - Щелкните **Continue** (Продолжить), чтобы развернуть приложение.

    ![Снимок экрана: конфигурация развертывания приложения.](./media/tutorial-containerize-apps-aks/deploy-java-app-config.png)

4. **Разверните приложение.** Как только вы сохраните конфигурацию развертывания для приложения, инструмент создаст для этого приложения YAML-файл для развертывания в Kubernetes.
     - Щелкните **Edit** (Редактировать), чтобы проверить и изменить YAML-файл для развертывания в Kubernetes.
     - Выберите приложение для развертывания.
     - Щелкните **Deploy** (Развернуть), чтобы начать развертывание выбранных приложений.

         ![Снимок экрана: конфигурация развертывания приложения.](./media/tutorial-containerize-apps-aks/deploy-java-app-deploy.png)

     - Когда развертывание приложения завершится, щелкнув столбец *Deployment status* (Состояние развертывания), вы сможете проверить развернутые для этого приложения ресурсы.

## <a name="download-generated-artifacts"></a>Скачивание созданных артефактов

Все артефакты, которые используются для сборки и развертывания приложения в AKS, включая Dockerfile и YAML-файлы спецификации Kubernetes, сохраняются на том компьютере, где был запущен инструмент. Эти артефакты находятся в папке *C:\ProgramData\Microsoft Azure Migrate App Containerization*.

Для каждого сервера приложений создается отдельная папка. Вы можете просмотреть и скачать все промежуточные артефакты, которые использовались в процессе контейнеризации, открыв эту папку. Папка, соответствующая конкретному серверу приложений, будет очищаться при каждом запуске инструмента для этого сервера.

## <a name="troubleshoot-issues"></a>Устранение неполадок

Для устранения неполадок, которые могут возникнуть при работе с этим инструментом, изучите файлы журнала на компьютере с Windows, на котором выполняется инструмент контейнеризации приложений. Файлы журнала инструмента расположены в папке *C:\ProgramData\Microsoft Azure Migrate App Containerization\Logs*.

## <a name="next-steps"></a>Дальнейшие действия

- Создание контейнеров приложений ASP.NET и их развертывание в виде контейнеров Windows в службе AKS. [Дополнительные сведения](./tutorial-containerize-aspnet-kubernetes.md)