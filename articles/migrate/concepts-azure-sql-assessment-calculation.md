---
title: Оценка Azure SQL в средстве "миграция и оценка" в Azure
description: Сведения об оценках Azure SQL в средстве "миграция и оценка" в Azure
author: rashi-ms
ms.author: rajosh
ms.topic: conceptual
ms.date: 02/07/2021
ms.openlocfilehash: d1ea328575cf07a22ce39549c34d5cd21e916427
ms.sourcegitcommit: f3ec73fb5f8de72fe483995bd4bbad9b74a9cc9f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/04/2021
ms.locfileid: "102054991"
---
# <a name="assessment-overview-migrate-to-azure-sql"></a>Обзор оценки (миграция в SQL Azure)

В этой статье представлен обзор оценок для миграции локальных экземпляров SQL Server из среды VMware в базы данных SQL Azure или управляемые экземпляры с помощью [средства Azure Migrate: обнаружение и оценка](https://docs.microsoft.com/azure/migrate/migrate-services-overview#azure-migrate-server-assessment-tool).

> [!Note]
> Обнаружение и оценка SQL Server экземпляров и баз данных, работающих в среде VMware, теперь находится на этапе предварительной версии. Чтобы испытать эту функцию, используйте [**эту ссылку**](https://aka.ms/AzureMigrate/SQL) для создания проекта в **Восточная Австралияном** регионе. Если у вас уже есть проект в Восточная Австралия и вы хотите испытать эту функцию, убедитесь, что вы выполнили эти [**Предварительные требования**](how-to-discover-sql-existing-project.md) на портале.

## <a name="whats-an-assessment"></a>Что такое оценка?
Оценка с помощью средства обнаружения и оценки представляет собой моментальный снимок данных на момент времени и измеряет готовность и оценивает воздействие миграции локальных серверов на Azure.

## <a name="types-of-assessments"></a>Типы оценок

Существует три типа оценок, которые можно создать с помощью средства "миграция Azure: обнаружение и оценка".

**Тип оценки** | **Сведения**
--- | --- 
**Azure** | Оценки для переноса локальных серверов на виртуальные машины Azure. Вы можете оценивать локальные серверы в среде [VMware](how-to-set-up-appliance-vmware.md) и [Hyper-V](how-to-set-up-appliance-hyper-v.md) , а также [физические серверы](how-to-set-up-appliance-physical.md) для миграции на виртуальные машины Azure с помощью этого типа оценки.
**Azure SQL;** | Оценки для переноса локальных серверов SQL Server из среды VMware в базу данных SQL Azure или Azure SQL Управляемый экземпляр.
**Решение Azure VMware (AVS)** | Оценки для переноса локальных серверов в [Решение Azure VMware (AVS)](../azure-vmware/introduction.md). С помощью этого типа оценки вы можете оценить возможность миграции в Решение Azure VMware (AVS) для локальных [виртуальных машин VMware](how-to-set-up-appliance-vmware.md). [Дополнительные сведения](concepts-azure-vmware-solution-assessment-calculation.md)

Оценка Azure SQL предоставляет одно условие изменения размера:

**Критерии определения размера** | **Сведения** | **Data**
--- | --- | ---
**На основе производительности** | Оценки, которые предоставляют рекомендации на основе собранных данных о производительности | Конфигурация Azure SQL основана на данных производительности экземпляров и баз данных SQL, включая использование ЦП, использование памяти, число операций ввода-вывода в секунду (файлы данных и журналов), пропускную способность и задержку операций ввода/вывода.

## <a name="how-do-i-assess-my-on-premises-sql-servers"></a>Разделы справки оценивать локальные серверы SQL Server?

Вы можете оценивать локальные SQL Server экземпляры с помощью данных о конфигурации и использовании, собираемых упрощенным устройством миграции Azure. Устройство обнаруживает локальные экземпляры и базы данных SQL Server и отправляет данные конфигурации и производительности в службу "миграция Azure". [Подробнее](how-to-set-up-appliance-vmware.md)

## <a name="how-do-i-assess-with-the-appliance"></a>Разделы справки оценить с помощью устройства?
Если вы развертываете устройство миграции Azure для обнаружения локальных серверов, выполните следующие действия.
1.  Настройте Azure и локальную среду для работы с миграцией Azure.
2.  Для проведения первой оценки создайте проект службы "миграция Azure" и добавьте к нему средство "миграция Azure: обнаружение и оценка".
3.  Разверните упрощенное устройство миграции Azure. Устройство постоянно обнаруживает локальные серверы и отправляет данные конфигурации и производительности в службу "миграция Azure". Разверните устройство как виртуальную машину или физический сервер. Вам не нужно ничего устанавливать на серверах, которые вы хотите оценить.

После того как устройство начнет обнаружение, можно собрать серверы, которые нужно оценить в группу, и выполнить оценку группы с типом оценки **Azure SQL**.

Следуйте указаниям в нашем руководстве по оценке [экземпляров SQL Server](tutorial-assess-sql.md) , чтобы выполнить эти действия.

## <a name="how-does-the-appliance-calculate-performance-data-for-sql-instances-and-databases"></a>Как устройство вычисляет данные производительности для экземпляров и баз данных SQL?

Устройство собирает данные производительности для параметров вычислений, выполнив следующие действия.
1. Устройство собирает образец точки в режиме реального времени. Для серверов SQL Server точка выборки собирается каждые 30 секунд.
2. Устройство объединяет образцы точек данных, собираемых каждые 30 секунд, в течение 10 минут. Чтобы создать точку данных, устройство выбирает пиковые значения из всех выборок. Он отправляет максимальное значение и дисперсию для каждого счетчика в Azure.
3. В службе "миграция Azure" хранятся все 10-минутные точки данных за прошлый месяц.
4. При создании оценки служба "миграция Azure" определяет соответствующую точку данных для использования в оптимизации дается задание. Идентификация основана на значениях процентиля для журнала производительности и использования процентилей.
    - Например, если журнал производительности составляет одну неделю, а заданный процентиль — 95 процентиль процентиль, то оценка сортирует 10-минутные точки выборки за последнюю неделю. Он сортирует их в возрастающем порядке и выбирает значение 95 процентиль процентиль для оптимизации дается задание.
    - Значение 95 процентиль процентиль гарантирует игнорирование любых выбросов, которые могут быть добавлены, если вы выбрали 99-м процентиль.
    - Если вы хотите выбрать пиковое использование для периода и не хотите пропускать выбросы, выберите 99-м процентиль для использования процентилей.
5. Это значение умножается на эффективный фактор, чтобы получить эффективные данные об использовании производительности для метрик, собираемых устройством:
    - Загрузка ЦП (%)
    - Использование памяти (%)
    - Чтение операций ввода-вывода/с записью ввода-вывода (файлы данных и журналов)
    - Чтение МБ/с и запись в МБ/с (пропускная способность)
    - Задержка операций ввода-вывода

## <a name="what-properties-are-used-to-create-and-customize-an-azure-sql-assessment"></a>Какие свойства используются для создания и настройки оценки Azure SQL?

Вот именно, включаемые в свойства оценки SQL Azure:

**Свойство** | **Сведения**
--- | ---
**Целевое расположение** | Регион Azure, в который требуется выполнить миграцию. Конфигурация и рекомендации по затратам SQL Azure основаны на указанном расположении.
**Целевой тип развертывания** | Целевой тип развертывания, на который необходимо выполнить оценку: выберите **рекомендуется**, если вы хотите, чтобы служба миграции Azure оценила готовность серверов SQL Server для миграции в Azure SQL MI и базу данных SQL Azure и рекомендовала наиболее подходящий вариант целевого развертывания, целевой уровень, конфигурацию SQL Azure и ежемесячные оценки. Выберите **базу данных SQL Azure**, если вы хотите оценить серверы SQL Server для миграции на только базы данных SQL Azure и просматривать целевой уровень, конфигурацию базы данных SQL Azure и ежемесячные оценки. Выберите **Azure SQL MI**, если вы хотите оценить серверы SQL Server для миграции на только базы данных SQL Azure и просматривать целевой уровень, конфигурацию Azure SQL MI и ежемесячные оценки.
**Зарезервированная емкость** | Указывает зарезервированную емкость таким образом, чтобы оценки затрат в оценке проводились в расчете. Если выбран параметр зарезервированная емкость, нельзя указать "скидка (%)".
**Критерии определения размера** | Это свойство используется для правильного изменения размера конфигурации SQL Azure. По умолчанию используется **производительность** , что означает, что оценка будет составлять SQL Server экземпляры и метрики производительности баз данных, чтобы рекомендовать оптимальный размер управляемый экземпляр SQL Azure и (или) рекомендации по конфигурации или уровню базы данных SQL Azure.
**Журнал производительности** | Журнал производительности указывает продолжительность, используемую при оценке данных производительности.
**Использование процентиля** | Использование процентиля указывает значение процентиля образца производительности, используемого для оптимизации дается задание.
**Фактор комфорта** | Буфер, используемый во время оценки. Они учетируют такие проблемы, как сезонное использование, короткий журнал производительности и, вероятнее всего, увеличение использования в будущем. Например, 10-ядерный экземпляр с использованием 20% обычно приводит к подвум основным экземплярам. В случае с незначительным фактором 2,0 в результате будет сопоставлено четыре основных экземпляра.
**Программа предложения и лицензирования** | [Предложение Azure](https://azure.microsoft.com/support/legal/offer-details/) , в котором вы зарегистрированы. В настоящее время вы можете выбрать только разработку и тестирование с оплатой по мере использования и с оплатой по мере использования. Обратите внимание, что вы можете получить дополнительную скидку, применив зарезервированную емкость и Преимущество гибридного использования Azure поверх предложения с оплатой по мере использования.
**Уровень служб** | Наиболее подходящий вариант уровня службы для удовлетворения бизнес-потребностей при миграции в базу данных SQL Azure и (или) Управляемый экземпляр Azure SQL: выберите **рекомендуется** , если требуется, чтобы служба "миграция Azure" рекомендовала наиболее подходящий уровень служб для серверов. Это может быть общей целью или критически важным для бизнеса. Выберите **общего назначения** , если требуется настроить конфигурацию SQL Azure для рабочих нагрузок, ориентированных на бюджет. Дополнительные [сведения](https://docs.microsoft.com/azure/azure-sql/database/service-tier-general-purpose) Выберите **критически важный для бизнеса** , если требуется настроить конфигурацию SQL Azure для рабочих нагрузок с низкой задержкой с высокой устойчивостью к сбоям и быстрой отработке отказа. [Подробнее](https://docs.microsoft.com/azure/azure-sql/database/service-tier-business-critical)
**Денежный формат** | Валюта выставления счетов для вашей учетной записи.
**Скидка (%)** | Все скидки, относящиеся к подписке, полученные на основе предложения Azure. Значение по умолчанию — 0 %.
**Преимущество гибридного использования Azure** | Указывает, имеется ли у вас SQL Server лицензия. Если у вас есть и они включены в активную программу Software Assurance SQL Server подписок, вы можете применить их для Преимущество гибридного использования Azure при переносе лицензий в Azure.

[Ознакомьтесь с рекомендациями](best-practices-assessment.md) по созданию оценки с помощью службы "миграция Azure".

## <a name="calculate-readiness"></a>Вычислить готовность

> [!NOTE]
> Оценка включает только базы данных, которые находятся в оперативном состоянии. Если база данных находится в любом другом состоянии, то при оценке не учитываются готовность, размер и вычисление затрат для таких баз данных. Если вы хотите оценить такие базы данных, измените состояние базы данных и повторите вычисление оценки в некоторый момент времени.

### <a name="azure-sql-readiness"></a>Готовность к работе с SQL Azure

Готовность Azure SQL к экземплярам и базам данных SQL основана на проверке совместимости функций с базой данных SQL Azure и Управляемый экземпляр Azure SQL:
- В ходе оценки Azure SQL рассматриваются функции SQL Server экземпляра, которые в настоящее время используются исходными SQL Server рабочими нагрузками (задания агента SQL, связанные серверы и т. д.), а также схемы пользовательских баз данных (таблицы, представления, триггеры, хранимые процедуры и т. д.) для обнаружения проблем совместимости.
- Если проблем совместимости не обнаружено, готовность помечается как **готовый** для целевого типа развертывания (база данных SQL Azure или azure SQL управляемый экземпляр).
- Если имеются некритические проблемы совместимости, например неработоспособные или неподдерживаемые функции, которые не блокируют миграцию на конкретный тип развертывания, то готовность помечается как **готовая** (значок с гиперссылками и синими сведениями) с подробными сведениями о **предупреждениях** и рекомендациями по исправлению.
- При наличии проблем совместимости, которые могут препятствовать миграции на конкретный целевой тип развертывания, готовность помечается как **не готовая к работе** с подробными сведениями о **проблемах** и рекомендуемым руководством по исправлению.
    - Если в экземпляре SQL есть даже одна база данных, которая не готова для конкретного целевого типа развертывания, экземпляр помечается как **не готовый** для этого типа развертывания.
- Если обнаружение по-прежнему выполняется или возникли проблемы с обнаружением экземпляра или базы данных SQL, то готовность помечается как **неизвестная** , так как оценка не может вычислить готовность для этого экземпляра SQL.

### <a name="recommended-deployment-type"></a>Рекомендуемый тип развертывания

Если выбрать целевой тип развертывания, как **рекомендуется** в свойствах оценки Azure SQL, служба "миграция Azure" рекомендует тип развертывания SQL Azure, совместимый с экземпляром SQL. Переход на рекомендуемый корпорацией Майкрософт целевой объект сокращает общие усилия по миграции. 

#### <a name="recommended-deployment-type-based-on-azure-sql-readiness"></a>Рекомендуемый тип развертывания на основе готовности к работе с SQL Azure

 **Готовность базы данных SQL Azure** | **Готовность к работе с SQL Azure MI** | **Рекомендуемый тип развертывания** | **Оценивается конфигурация и стоимость Azure SQL?**
 --- | --- | --- | --- |
 Ready | Ready | База данных SQL Azure или SQL Azure MI | Да
 Ready | Не готово или неизвестно | БД SQL Azure | Да
 Не готово или неизвестно | Ready | SQL Azure MI | Да
 Не готов | Не готов | Потенциально готово к виртуальной машине Azure | Нет
 Не готово или неизвестно | Не готово или неизвестно | Неизвестно | Нет

> [!NOTE]
> Если рекомендуемый тип развертывания выбран как **рекомендуемый** в свойствах оценки и если исходная SQL Server подходит для отдельной базы данных SQL azure и управляемый экземпляр SQL Azure, оценка рекомендует конкретный вариант, который оптимизирует затраты и соответствует границам размера и производительности.

#### <a name="potentially-ready-for-azure-vm"></a>Потенциально готово к виртуальной машине Azure

Если экземпляр SQL не готов к работе с базой данных SQL Azure и Управляемый экземпляр SQL Azure, рекомендуемый тип развертывания помечен как *потенциально готовый для виртуальной машины Azure*.
- Рекомендуется создать оценку в службе "миграция Azure" с типом оценки "виртуальная машина Azure", чтобы определить, готов ли сервер, на котором выполняется экземпляр, к переходу на виртуальную машину Azure. Обратите внимание на следующее.
    - Оценки виртуальных машин Azure в службе "миграция Azure" в настоящее время не учитывают и не просматривают конкретные метрики производительности для запуска экземпляров и баз данных SQL на виртуальной машине Azure. 
    - При выполнении оценки виртуальной машины Azure на сервере рекомендованные размер и стоимость зависят от всех экземпляров, запущенных на сервере, и могут быть перенесены на виртуальную машину Azure с помощью средства миграции сервера. Перед миграцией [Ознакомьтесь с рекомендациями по производительности](https://docs.microsoft.com/azure/azure-sql/virtual-machines/windows/performance-guidelines-best-practices) SQL Server на виртуальных машинах Azure.


## <a name="calculate-sizing"></a>Вычисление размера

### <a name="azure-sql-configuration"></a>Конфигурация SQL Azure

После того как оценка определит готовность и рекомендуемый тип развертывания SQL Azure, она вычисляет конкретный уровень служб и конфигурацию SQL Azure (размер SKU), которые могут соответствовать или превышать производительность локального экземпляра SQL:
1. Во время процесса обнаружения служба "миграция Azure" собирает сведения о конфигурации и производительности экземпляра SQL, включая:
    - Виртуальных ядер (выделено) и загрузка ЦП (%)
        - Загрузка ЦП для экземпляра SQL — это процент выделенного ЦП, который использует экземпляр на сервере SQL Server
        - Загрузка ЦП для базы данных — это процент выделенного ЦП, который использует база данных экземпляра SQL
    - Память (выделенная) и использование памяти (%)
    - Чтение операций ввода-вывода/с записью ввода-вывода (файлы данных и журналов)
        - Чтение операций ввода-вывода/с записью/с на уровне экземпляра SQL вычисляется путем добавления операций чтения и записи ввода-вывода для всех баз данных, обнаруженных в этом экземпляре.
    - Чтение МБ/с и запись в МБ/с (пропускная способность)
    - Задержка операций ввода-вывода
    - Общий размер базы данных и организации файловых организаций
        - Размер базы данных вычисляется путем добавления всех файлов данных и журналов.
1. Оценка объединяет все данные конфигурации и производительности и пытается найти оптимальное соответствие для различных уровней и конфигураций служб SQL Azure, а также выбрать конфигурацию, которая может соответствовать или превышать требования к производительности экземпляра SQL, оптимизируя затраты.

### <a name="confidence-ratings"></a>Оценки достоверности 
Каждая оценка Azure SQL связана с оценкой достоверности. Оценка находится в диапазоне от одной (самой низкой) до пяти звезд. Оценка достоверности помогает оценить надежность рекомендаций, предоставляемых службой Azure Migrate.
- Оценка достоверности назначается оценке. Оценка основана на доступности точек данных, необходимых для расчета оценки.
- Для изменения размера на основе производительности Оценка собирает данные о производительности всех экземпляров и баз данных SQL, включая:
    - Загрузка ЦП (%)
    - Использование памяти (%)
    - Чтение операций ввода-вывода/с записью ввода-вывода (файлы данных и журналов)
    - Чтение МБ/с и запись в МБ/с (пропускная способность)
    - Задержка операций ввода-вывода
    
Если любое из этих номеров использования недоступно, рекомендации по размеру могут быть ненадежными.
В этой таблице показаны оценки достоверности, которые зависят от процента доступных точек данных:

**Доступность точки данных** | **Оценка достоверности**
--- | ---
0–20 % | 1 звезда
21–40 % | 2 звезды
41–60 % | 3 звезды
61–80 % | 4 звезды
81–100 % | 5 звезд

#### <a name="low-confidence-ratings"></a>Низкая оценка достоверности
Ниже приведены несколько причин, по которым оценка может иметь низкую степень достоверности.
- Вы не проделали Профилирование среды в течение времени, в течение которого вы создаете оценку. Например, если вы создаете оценку с длительностью производительности в один день, необходимо подождать по крайней мере день после начала обнаружения всех точек данных для сбора.
- Оценка не может выполнить накопление данных о производительности для некоторых или всех серверов в периоде оценки. Для оценки высокой достоверности убедитесь, что:
    - Серверы включены на время оценки
    - Исходящие подключения к портам 443 разрешены
    - Если состояние подключения "миграция Azure" агента SQL в Azure "миграция" — "подключено", проверьте последний пульс. 
    - Если состояние подключения службы "миграция Azure" для всех экземпляров SQL — "подключено" в колонке обнаруженный экземпляр SQL Server

    Пересчитайте оценку, чтобы отразить последние изменения оценки достоверности.
- Некоторые базы данных или экземпляры были созданы в течение времени, в течение которого была рассчитана оценка. Например, предположим, что вы создали оценку для журнала производительности за прошлый месяц, но некоторые базы данных или экземпляры были созданы только в неделю назад. В этом случае данные о производительности для новых серверов будут недоступны для всей продолжительности, а Оценка достоверности будет низкой.

> [!NOTE]
> Так как оценки Azure SQL — это оценки на основе производительности, если оценка достоверности для какой-либо оценки менее чем на пять звезд, рекомендуется подождать по крайней мере один день, чтобы устройство было пропрофилировать среду, а затем повторно вычислить оценку. В противном случае размер на основе производительности может быть ненадежным.

## <a name="calculate-monthly-costs"></a>Вычисление месячных затрат
После того как рекомендации по изменению размера завершены, оценка Azure SQL вычислит затраты на вычисления и хранение для рекомендуемых конфигураций SQL Azure с помощью внутреннего API ценообразования. Он вычисляет затраты на вычисления и хранение во всех экземплярах для вычисления общей месячной стоимости вычислений. 
### <a name="compute-cost"></a>Стоимость вычислений
- Для вычисления затрат на вычисления для конфигурации Azure SQL оценка учитывает следующие свойства:
    - Преимущество гибридного использования Azure для лицензий SQL
    - Зарезервированная емкость
    - Целевое расположение Azure
    - Валюта
    - Программа предложения и лицензирования
    - Скидка (%)

### <a name="storage-cost"></a>Стоимость хранения
- Оценка затрат на хранение включает только файлы данных, а не файлы журнала. 
- Для вычисления затрат на хранение для конфигурации SQL Azure оценка учитывает следующие свойства:
    - Целевое расположение Azure
    - Валюта
    - Программа предложения и лицензирования
    - Скидка (%)
- Стоимость хранилища резервных копий не включена в оценку.
- **База данных SQL Azure**
    - В расчет затрат добавляется минимальная стоимость хранилища 5 ГБ, и для хранилища добавляется дополнительная стоимость хранилища за 1 ГБ. [Подробнее](https://azure.microsoft.com/pricing/details/sql-database/single/)
- **Управляемый экземпляр SQL Azure**
    - Для хранения данных за первый 32 ГБ/экземпляр/месяц не взимается дополнительная плата, а для хранилища добавляется Увеличенная стоимость хранилища (до 32 ГБ). [Подробнее](https://azure.microsoft.com/pricing/details/azure-sql/sql-managed-instance/single/)
        
## <a name="next-steps"></a>Дальнейшие действия
- [Просмотрите](best-practices-assessment.md) рекомендации для создания оценок. 
- Узнайте, как выполнить [оценку Azure SQL](how-to-create-azure-sql-assessment.md).
