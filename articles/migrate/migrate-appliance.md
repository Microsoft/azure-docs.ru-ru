---
title: Устройство службы "Миграция Azure"
description: Содержит сводку по поддержке устройства "миграция Azure".
author: vikram1988
ms.author: vibansa
ms.manager: abhemraj
ms.topic: conceptual
ms.date: 05/04/2020
ms.openlocfilehash: 08cd0e9d33dd88b9bdc418f3d1bbd382b2d80632
ms.sourcegitcommit: 867cb1b7a1f3a1f0b427282c648d411d0ca4f81f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/20/2021
ms.locfileid: "102038770"
---
# <a name="azure-migrate-appliance"></a>Устройство службы "Миграция Azure"

В этой статье перечислены необходимые условия и требования к поддержке устройства Миграции Azure.

## <a name="deployment-scenarios"></a>Сценарии развертывания

Устройство Миграции Azure используется в приведенных ниже сценариях.

**Сценарий** | **Инструмент** | **Используется для**
--- | --- | ---
**Обнаружение и оценка серверов, работающих в среде VMware** | Миграция Azure: оценка серверов | Обнаружение серверов, работающих в среде VMware<br/><br/> Выполняет обнаружение установленных приложений, анализ зависимостей без агента и обнаружение экземпляров и баз данных SQL Server.<br/><br/> Получение метаданных конфигурации сервера и производительности для оценки.
**Миграция серверов, работающих в среде VMware без агента** | Миграция Azure: миграция серверов | Обнаружение серверов, работающих в среде VMware. <br/><br/> Репликация серверов без установки агентов.
**Обнаружение и оценка серверов, работающих в среде Hyper-V** | Миграция Azure: оценка серверов | Обнаружение серверов, работающих в среде Hyper-V.<br/><br/> Получение метаданных конфигурации сервера и производительности для оценки.
**Обнаружение и оценка физических или виртуализованных серверов в локальной среде** |  Миграция Azure: оценка серверов |  Обнаружение физических или виртуализованных серверов в локальной среде.<br/><br/> Получение метаданных конфигурации сервера и производительности для оценки.

## <a name="deployment-methods"></a>Методы развертывания

Устройство можно развернуть с помощью нескольких методов.

- Устройство можно развернуть с помощью шаблона для серверов, работающих в среде VMware или Hyper-V ([шаблон OVA для VMware](how-to-set-up-appliance-vmware.md) или [VHD для Hyper-v](how-to-set-up-appliance-hyper-v.md)).
- Если вы не хотите использовать шаблон, можно развернуть устройство для среды VMware или Hyper-V с помощью [скрипта установщика PowerShell](deploy-appliance-script.md).
- В Azure для государственных организаций необходимо развернуть устройство с помощью скрипта установщика PowerShell. Инструкции по развертыванию см. [здесь](deploy-appliance-script-government.md).
- Для физических или виртуализованных серверов в локальной среде или любом другом облаке устройство всегда развертывается с помощью скрипта установщика PowerShell. Инструкции по развертыванию см. [здесь](how-to-set-up-appliance-physical.md).
- Ссылки для скачивания доступны в таблицах ниже.


## <a name="appliance---vmware"></a>Устройство для VMware

В следующей таблице перечислены требования к устройству Миграции Azure для использования в VMware.

> [!Note]
> Обнаружение и оценка SQL Server экземпляров и баз данных, работающих в среде VMware, теперь находится на этапе предварительной версии. Чтобы опробовать эту функцию, воспользуйтесь [**этой ссылкой**](https://aka.ms/AzureMigrate/SQL) для создания проекта в регионе **Восточная Австралия**. Если у вас уже есть проект в регионе "Восточная Австралия" и вы хотите опробовать эту функцию, убедитесь, что вы выполнили [**эти предварительные требования**](how-to-discover-sql-existing-project.md) на портале.

**Требование** | **VMware** 
--- | ---
**Разрешения** | Для локального или удаленного доступа к диспетчеру конфигурации устройств требуется локальная учетная запись пользователя или домен с правами администратора на сервере устройства.
**Службы устройств** | Устройство имеет следующие службы:<br/><br/> - **Диспетчер конфигурации устройств**: это веб-приложение, которое можно настроить с помощью сведений об источнике, чтобы начать обнаружение и оценку серверов.<br/> - **Агент обнаружения VMware**. агент собирает метаданные конфигурации сервера, которые можно использовать для создания локальных оценок.<br/>- **Агент оценки VMware**. агент собирает метаданные производительности сервера, которые можно использовать для создания оценок на основе производительности.<br/>- **Служба автоматического обновления**. служба хранит все агенты, выполняющиеся на устройстве, в актуальном состоянии. Он автоматически выполняется каждые 24 часа.<br/>- **Агент DRA**: управляет репликацией сервера и координирует взаимодействие между реплицированными серверами и Azure. Используется только при репликации серверов в Azure с помощью миграции без агента.<br/>- **Шлюз**. Отправляет реплицированные данные в Azure. Используется только при репликации серверов в Azure с помощью миграции без агента.<br/>- **Агент обнаружения и оценки SQL**: отправляет метаданные конфигурации и производительности SQL Server экземпляров и баз данных в Azure.
**Ограничения проекта** |  Устройство может быть зарегистрировано только в одном проекте.<br/> Один проект может иметь несколько зарегистрированных устройств.
**Ограничения обнаружения** | Устройство может обнаруживать до 10 000 серверов, работающих на vCenter Server.<br/> Устройство может подключаться к одному серверу vCenter Server.
**Поддерживаемое развертывание** | Выполните развертывание в качестве нового сервера, работающего на vCenter Server с помощью шаблона OVA.<br/><br/> Выполните развертывание на существующем сервере под Windows Server 2016 с помощью скрипта установщика PowerShell.
**Шаблон OVA** | Скачать из проекта или [отсюда](https://go.microsoft.com/fwlink/?linkid=2140333)<br/><br/> Размер скачивания составляет 11,9 ГБ.<br/><br/> Скачанный шаблон устройства поставляется с лицензией для ознакомительной версии Windows Server 2016, которая действительна в течение 180 дней.<br/>Если период оценки близок к истечению срока действия, рекомендуется скачать и развернуть новое устройство с помощью шаблона OVA или активировать лицензию операционной системы сервера устройств.
**Проверка OVA** | [Проверьте](tutorial-discover-vmware.md#verify-security) шаблон OVA, скачанный из проекта, проверив хэш-значения.
**Сценарий PowerShell** | Сведения о том, как развернуть устройство с помощью сценария установщика PowerShell, см. в этой [статье](./deploy-appliance-script.md#set-up-the-appliance-for-vmware) .<br/><br/> 
**Требования к оборудованию и сети** |  Устройство должно работать на сервере с Windows Server 2016, 32-ГБ ОЗУ, 8 виртуальных ЦП, около 80 ГБ дискового накопителя и внешним виртуальным коммутатором.<br/> Устройству требуется доступ к Интернету либо напрямую, либо через прокси-сервер.<br/><br/> Если вы развертываете устройство с помощью шаблона OVA, вам потребуется достаточно ресурсов на vCenter Server, чтобы создать сервер, соответствующий требованиям к оборудованию.<br/><br/> При запуске устройства на существующем сервере убедитесь, что он работает под управлением Windows Server 2016 и соответствует требованиям к оборудованию.<br/>_(В настоящее время развертывание устройства поддерживается только в Windows Server 2016.)_
**Требования к VMware** | Если устройство развертывается как сервер на vCenter Server, его необходимо развернуть на vCenter Server под управлением 5,5, 6,0, 6,5 или 6,7, а также на узле ESXi, работающем под управлением версии 5,5 или более поздней.<br/><br/> 
**Пакет VDDK (миграция без агента)** | Чтобы использовать устройство для миграции серверов без агента, на сервере устройства должен быть установлен VMware vSphere ВДДК.

## <a name="appliance---hyper-v"></a>Устройство для Hyper-V

**Требование** | **Hyper-V** 
--- | ---
**Разрешения** | Для локального или удаленного доступа к диспетчеру конфигурации устройств требуется локальная учетная запись пользователя или домен с правами администратора на сервере устройства.
**Службы устройств** | Устройство имеет следующие службы:<br/><br/> - **Диспетчер конфигурации устройств**: это веб-приложение, которое можно настроить с помощью сведений об источнике, чтобы начать обнаружение и оценку серверов.<br/> - **Агент обнаружения**. агент собирает метаданные конфигурации сервера, которые можно использовать для создания локальных оценок.<br/>- **Агент оценки**. агент собирает метаданные производительности сервера, которые можно использовать для создания оценок на основе производительности.<br/>- **Служба автоматического обновления**. служба хранит все агенты, выполняющиеся на устройстве, в актуальном состоянии. Он автоматически выполняется каждые 24 часа.
**Ограничения проекта** |  Устройство может быть зарегистрировано только в одном проекте.<br/> Один проект может иметь несколько зарегистрированных устройств.
**Ограничения обнаружения** | Устройство может обнаруживать до 5000 серверов, работающих в среде Hyper-V.<br/> Устройство может подключаться к 300 узлам Hyper-V.
**Поддерживаемое развертывание** | Выполните развертывание в качестве сервера, работающего на узле Hyper-V, с помощью шаблона виртуального жесткого диска.<br/><br/> Выполните развертывание на существующем сервере под Windows Server 2016 с помощью скрипта установщика PowerShell.
**Шаблон VHD** | ZIP-файл, содержащий виртуальный жесткий диск. Скачайте из проекта или [отсюда](https://go.microsoft.com/fwlink/?linkid=2140422).<br/><br/> Размер скачивания составляет 8,91 ГБ.<br/><br/> Скачанный шаблон устройства поставляется с лицензией для ознакомительной версии Windows Server 2016, которая действительна в течение 180 дней.<br/> Если период оценки близок к истечению срока действия, рекомендуется скачать и развернуть новое устройство или активировать лицензию операционной системы сервера устройства.
**Проверка VHD** | [Проверьте](tutorial-discover-hyper-v.md#verify-security) , скачан ли шаблон виртуального жесткого диска из проекта, проверив хэш-значения.
**Сценарий PowerShell** | Сведения о том, как развернуть устройство с помощью сценария установщика PowerShell, см. в этой [статье](./deploy-appliance-script.md#set-up-the-appliance-for-hyper-v) .<br/>
**Требования к оборудованию и сети**  |  Устройство должно работать на сервере с Windows Server 2016, 16 ГБ ОЗУ, 8 виртуальных ЦП, около 80 ГБ дискового накопителя и внешним виртуальным коммутатором.<br/> Устройству требуется статический или динамический IP-адрес, а также доступ к Интернету напрямую или через прокси-сервер.<br/><br/> При запуске устройства в качестве сервера, работающего на узле Hyper-V, для создания сервера, удовлетворяющего требованиям к оборудованию, необходимо наличие достаточного количества ресурсов на узле.<br/><br/> При запуске устройства на существующем сервере убедитесь, что он работает под управлением Windows Server 2016 и соответствует требованиям к оборудованию.<br/>_(В настоящее время развертывание устройства поддерживается только в Windows Server 2016.)_
**Требования для Hyper-V** | При развертывании устройства с помощью шаблона VHD устройство, предоставляемое службой "миграция Azure", является виртуальной машиной Hyper-V версии 5,0.<br/><br/> Узел Hyper-V должен работать под управлением Windows Server 2012 R2 или более поздней версии.

## <a name="appliance---physical"></a>Устройство для физического компьютера

**Требование** | **Физический компьютер** 
--- | ---
**Разрешения** | Для локального или удаленного доступа к диспетчеру конфигурации устройств требуется локальная учетная запись пользователя или домен с правами администратора на сервере устройства.
**Службы устройств** | Устройство имеет следующие службы:<br/><br/> - **Диспетчер конфигурации устройств**: это веб-приложение, которое можно настроить с помощью сведений об источнике, чтобы начать обнаружение и оценку серверов.<br/> - **Агент обнаружения**. агент собирает метаданные конфигурации сервера, которые можно использовать для создания локальных оценок.<br/>- **Агент оценки**. агент собирает метаданные производительности сервера, которые можно использовать для создания оценок на основе производительности.<br/>- **Служба автоматического обновления**. служба хранит все агенты, выполняющиеся на устройстве, в актуальном состоянии. Он автоматически выполняется каждые 24 часа.
**Ограничения проекта** |  Устройство может быть зарегистрировано только в одном проекте.<br/> Один проект может иметь несколько зарегистрированных устройств.<br/> 
**Ограничения обнаружения** | Устройство может обнаруживать до 1000 физических серверов.
**Поддерживаемое развертывание** | Выполните развертывание на существующем сервере под Windows Server 2016 с помощью скрипта установщика PowerShell.
**Сценарий PowerShell** | Скачайте скрипт (AzureMigrateInstaller.ps1) в ZIP-файл из проекта или [отсюда](https://go.microsoft.com/fwlink/?linkid=2140334). [Подробнее](tutorial-discover-physical.md).<br/><br/> Размер загрузки составляет 85,8 МБ.
**Проверка сценария** | [Убедитесь](tutorial-discover-physical.md#verify-security) , что скрипт установщика PowerShell скачан из проекта, проверив хэш-значения.
**Требования к оборудованию и сети** |  Устройство должно работать на сервере с Windows Server 2016, 16 ГБ ОЗУ, 8 виртуальных ЦП, около 80 ГБ дискового накопителя.<br/> Устройству требуется статический или динамический IP-адрес, а также доступ к Интернету напрямую или через прокси-сервер.<br/><br/> При запуске устройства на существующем сервере убедитесь, что он работает под управлением Windows Server 2016 и соответствует требованиям к оборудованию.<br/>_(В настоящее время развертывание устройства поддерживается только в Windows Server 2016.)_


## <a name="url-access"></a>доступ по URL-адресу

Устройству Миграции Azure требуется подключение к Интернету.

- При развертывании устройства Миграция Azure выполняет проверку подключения к необходимым URL-адресам.
- Необходимо разрешить доступ ко всем URL-адресам в списке. Если вы выполняете только оценку, вы можете пропустить URL-адреса, помеченные как обязательные для миграции без агента VMware.
-  Если вы используете прокси-сервер на основе URL-адресов для подключения к Интернету, убедитесь, что он разрешает все записи CNAME, полученные при поиске URL-адресов.

### <a name="public-cloud-urls"></a>URL-адреса общедоступных облаков

**URL-адрес** | **Сведения**  
--- | --- |
*.portal.azure.com  | Перейдите на портал Azure.
*.windows.net <br/> *.msftauth.net <br/> *.msauth.net <br/> *.microsoft.com <br/> *.live.com <br/> *. office.com | Войдите в свою подписку Azure.
*.microsoftonline.com <br/> *.microsoftonline-p.com | Создание приложений Azure Active Directory (AD) для взаимодействия устройства с Миграцией Azure.
management.azure.com | Создайте приложения Azure AD для взаимодействия устройства с миграцией Azure.
*.services.visualstudio.com | Отправка журналов устройств, используемых для внутреннего мониторинга.
*.vault.azure.net | Управление секретами в Azure Key Vault.<br/> Примечание. Убедитесь, что серверы, которые должны реплицироваться, имеют доступ к этому.
aka.ms/* | Разрешить доступ к несвязанным ссылкам; используется для загрузки и установки последних обновлений для служб устройств.
download.microsoft.com/download | Разрешить загрузку из центра загрузки Майкрософт.
*.servicebus.windows.net | Взаимодействие между устройством и службой "Миграция Azure".
*.discoverysrv.windowsazure.com <br/> *.migration.windowsazure.com | Подключение к URL-адресам службы "Миграция Azure".
*.hypervrecoverymanager.windowsazure.com | **Используется для миграции без агента VMware**.<br/><br/> Подключение к URL-адресам службы "Миграция Azure".
*.blob.core.windows.net |  **Используется для миграции без агента VMware**.<br/><br/>Передача данных в хранилище для миграции.

### <a name="government-cloud-urls"></a>URL-адреса облака Azure для государственных организаций

**URL-адрес** | **Сведения**  
--- | --- |
*.portal.azure.us  | Перейдите на портал Azure.
graph.windows.net | Войдите в свою подписку Azure.
login.microsoftonline.us  | Создание приложений Azure Active Directory (AD) для взаимодействия устройства с Миграцией Azure.
management.usgovcloudapi.net | Создание приложений Azure AD для взаимодействия устройства с службой "Миграция Azure".
*.services.visualstudio.com | Отправка журналов устройств, используемых для внутреннего мониторинга.
*.vault.usgovcloudapi.net | Управление секретами в Azure Key Vault.
aka.ms/* | Разрешить доступ к несвязанным ссылкам; используется для загрузки и установки последних обновлений для служб устройств.
download.microsoft.com/download | Разрешить загрузку из центра загрузки Майкрософт.
*.servicebus.usgovcloudapi.net  | Взаимодействие между устройством и службой "Миграция Azure".
*.discoverysrv.windowsazure.us <br/> *.migration.windowsazure.us | Подключение к URL-адресам службы "Миграция Azure".
*.hypervrecoverymanager.windowsazure.us | **Используется для миграции без агента VMware**.<br/><br/> Подключение к URL-адресам службы "Миграция Azure".
*.blob.core.usgovcloudapi.net  |  **Используется для миграции без агента VMware**.<br/><br/>Передача данных в хранилище для миграции.
*.applicationinsights.us | Отправка журналов устройств, используемых для внутреннего мониторинга.


## <a name="collected-data---vmware"></a>Собираемые данные VMware

Устройство собирает метаданные конфигурации, метаданные производительности и данные о зависимостях сервера (если используется [анализ зависимостей](concepts-dependency-visualization.md) без агента).

### <a name="metadata"></a>Метаданные

Метаданные, обнаруженные устройством "миграция Azure", позволяют определить готовность серверов к миграции в Azure, масштабировать серверы, планы затрат и анализировать зависимости приложений. Корпорация Майкрософт не использует эти данные для аудита соответствия требованиям лицензий.

Ниже приведен полный список метаданных сервера, которые устройство собирает и отправляет в Azure.

**Данные** | **Счетчик**
--- | --- 
**Сведения о сервере** | 
Идентификатор сервера | vm.Config.InstanceUuid 
Имя сервера | vm.Config.Name
Идентификатор vCenter Server | VMwareClient.Instance.Uuid
Описание виртуальной машины | vm.Summary.Config.Annotation
Имя продукта лицензии | vm.Client.ServiceContent.About.LicenseProductName
Тип операционной системы | vm.SummaryConfig.GuestFullName
Тип загрузки | vm.Config.Firmware
Число ядер | vm.Config.Hardware.NumCPU
Память (МБ) | vm.Config.Hardware.MemoryMB
Количество дисков | vm.Config.Hardware.Device.ToList().FindAll(x => is VirtualDisk).count
Список размеров диска | vm.Config.Hardware.Device.ToList().FindAll(x => is VirtualDisk)
Список сетевых адаптеров | vm.Config.Hardware.Device.ToList().FindAll(x => is VirtualEthernet).count
загрузка ЦП; | cpu.usage.average
Использование памяти |mem.usage.average
**Сведения о дисках** | 
Значение ключа диска | disk.Key
Номер Diskunit | disk.UnitNumber
Значение ключа контроллера диска | disk.ControllerKey.Value
Подготовленных гигабайт | virtualDisk.DeviceInfo.Summary
Имя диска | Значение, созданное на основе disk.UnitNumber, disk.Key и disk.ControllerKey.Value
Число операций чтения за секунду. | virtualDisk.numberReadAveraged.average
Число операций записи за секунду. | virtualDisk.numberWriteAveraged.average
Пропускная способность чтения (МБ/с) | virtualDisk.read.average
Пропускная способность записи (МБ/с) | virtualDisk.write.average
**Сведения о сетевых картах** | 
Имя сетевого адаптера | nic.Key
MAC-адрес. | ((VirtualEthernetCard)nic).MacAddress
IPv4-адреса | vm.Guest.Net
IPv6-адреса | vm.Guest.Net
Пропускная способность чтения (МБ/с) | net.received.average
Пропускная способность записи (МБ/с) | net.transmitted.average
**Сведения о пути инвентаризации** | 
Имя | container.GetType().Name
Тип дочернего объекта | container.ChildType
Справочные сведения | container.MoRef
Сведения о родительском объекте | Container.Parent
Сведения о папках для виртуальной машины | ((Folder)container).ChildEntity.Type
Сведения о центре обработки данных для виртуальной машины | ((Datacenter)container).VmFolder
Сведения о центре обработки данных для папки узла | ((Datacenter)container).HostFolder
Сведения о кластере для узла | ((ClusterComputeResource)container).Host
Сведения об узле для виртуальной машины | ((HostSystem)container).VM

### <a name="performance-data"></a>Данные о производительности


Ниже приведены данные производительности виртуальных машин VMware, которые устройство собирает и отправляет в Azure.

**Data** | **Счетчик** | **Влияние на оценку**
--- | --- | ---
загрузка ЦП; | cpu.usage.average | Рекомендуемые размер и стоимость виртуальной машины.
Использование памяти | mem.usage.average | Рекомендуемые размер и стоимость виртуальной машины.
Пропускная способность чтения с дисков (МБ/с) | virtualDisk.read.average | Вычисляет размер диска, затраты на хранение и размер виртуальной машины.
Пропускная способность записи на диски (МБ/с) | virtualDisk.write.average | Вычисляет размер диска, затраты на хранение и размер виртуальной машины.
Число операций чтения с диска в секунду | virtualDisk.numberReadAveraged.average | Вычисляет размер диска, затраты на хранение и размер виртуальной машины.
Число операций записи на диск в секунду | virtualDisk.numberWriteAveraged.average  | Вычисляет размер диска, затраты на хранение и размер виртуальной машины.
Пропускная способность чтения из сетевой карты (МБ/с) | net.received.average | Вычисление размера виртуальной машины.
Пропускная способность записи в сетевую карту (МБ/с) | net.transmitted.average  |Вычисление размера виртуальной машины.


### <a name="installed-applications-data"></a>Данные установленных приложений

Устройство собирает данные об установленных приложениях, ролях и компонентах на серверах.

#### <a name="windows-server-application-data"></a>Данные приложений Windows Server

Ниже приведены данные о приложениях, собираемых устройством из каждого Windows Server, обнаруженного в среде VMware.

**Данные** | **Расположение реестра** | **Ключ**
--- | --- | ---
Имя приложения  | HKLM: \ Софтваре\микрософт\виндовс\куррентверсион\унинсталл\* <br/> HKLM: \ Software\Wow6432Node\Microsoft\Windows\CurrentVersion\Uninstall\*  | DisplayName
Версия  | HKLM: \ Софтваре\микрософт\виндовс\куррентверсион\унинсталл\*  <br/> HKLM: \ Software\Wow6432Node\Microsoft\Windows\CurrentVersion\Uninstall\*  | дисплайверсион 
Поставщик  | HKLM: \ Софтваре\микрософт\виндовс\куррентверсион\унинсталл\*  <br/> HKLM: \ Software\Wow6432Node\Microsoft\Windows\CurrentVersion\Uninstall\*  | Издатель

#### <a name="windows-server-features-data"></a>Данные о компонентах Windows Server

Ниже приведены данные о функциях, собираемых устройством с каждого Windows Server, обнаруженного в среде VMware.

**Данные**  | **Командлет PowerShell** | **Свойство**
--- | --- | ---
Имя  | Get-WindowsFeature  | Имя
Тип функции | Get-WindowsFeature  | Объект featuretype
Parent  | Get-WindowsFeature  | Parent

#### <a name="sql-server-metadata"></a>Метаданные SQL Server

Ниже приведено SQL Server данных, собираемых устройством из каждого Windows Server, обнаруженного в среде VMware.

**Данные**  | **Расположение реестра**  | **Ключ**
--- | --- | ---
Имя  | HKLM: \ SOFTWARE\Microsoft\Microsoft SQL сохраняет имена экземпляров  | инсталлединстанце
Выпуск  | HKLM: \ SOFTWARE\Microsoft\Microsoft SQL Server \\ \<InstanceName> \setup  | Выпуск 
Пакет обновления  | HKLM: \ SOFTWARE\Microsoft\Microsoft SQL Server \\ \<InstanceName> \setup  | SP
Версия  | HKLM: \ SOFTWARE\Microsoft\Microsoft SQL Server \\ \<InstanceName> \setup  | Версия 

#### <a name="windows-server-operating-system-data"></a>Данные операционной системы Windows Server

Ниже приведены данные операционной системы, собираемые устройством из каждого Windows Server, обнаруженного в среде VMware.

**Data**  | **Класс WMI**  | **Свойство класса WMI**
--- | --- | ---
Имя  | Win32_operatingsystem  | Заголовок
Версия  | Win32_operatingsystem  | Версия
Архитектура  | Win32_operatingsystem  | OSArchitecture

#### <a name="linux-server-application-data"></a>Данные серверного приложения Linux

Ниже приведены данные о приложениях, собираемых устройством с каждого сервера Linux, обнаруженного в среде VMware. В зависимости от операционной системы сервера выполняется одна или несколько команд.

**Данные**  | **Команды**
--- | --- 
Имя | RPM, dpkg — запрос, привязка
Версия | RPM, dpkg — запрос, привязка
Поставщик | RPM, dpkg — запрос, привязка

#### <a name="linux-server-operating-system-data"></a>Данные операционной системы сервера Linux

Ниже приведены данные операционной системы, собираемые устройством с каждого сервера Linux, обнаруженного в среде VMware.

**Данные**  | **Команды**
--- | --- 
Имя <br/> version | Собраны из одного или нескольких следующих файлов:<br/> <br/>/etc/os-release  <br> /usr/lib/os-release  <br> /etc/enterprise-release  <br> /etc/redhat-release  <br> /etc/oracle-release  <br> /etc/SuSE-release  <br> /etc/lsb-release  <br> /etc/debian_version 
Архитектура | uname

### <a name="sql-server-instances-and-databases-data"></a>SQL Serverные экземпляры и данные баз данных

Устройство собирает данные в экземплярах SQL Server и базах данных.

> [!Note]
> Обнаружение и оценка SQL Server экземпляров и баз данных, работающих в среде VMware, теперь находится на этапе предварительной версии. Чтобы опробовать эту функцию, воспользуйтесь [**этой ссылкой**](https://aka.ms/AzureMigrate/SQL) для создания проекта в регионе **Восточная Австралия**. Если у вас уже есть проект в регионе "Восточная Австралия" и вы хотите опробовать эту функцию, убедитесь, что вы выполнили [**эти предварительные требования**](how-to-discover-sql-existing-project.md) на портале.

#### <a name="sql-database-metadata"></a>Метаданные базы данных SQL

**Метаданные базы данных** | **Свойства views/SQL Server**
--- | ---
Уникальный идентификатор базы данных | sys.databases
Идентификатор базы данных, определенный сервером | sys.databases
Имя базы данных. | sys.databases
Уровень совместимости базы данных | sys.databases
Имя параметров сортировки базы данных | sys.databases
Состояние базы данных | sys.databases
Размер базы данных (в МБ) | sys.master_files
Буква диска, содержащая файлы данных | SERVERPROPERTY и Софтваре\микрософт\мссклсервер\мссклсервер
Список файлов базы данных | sys. databases, sys.master_files
Компонент Service Broker включен или отсутствует | sys.databases
База данных включена для отслеживания измененных данных | sys.databases

#### <a name="sql-server-metadata"></a>Метаданные SQL Server

**Метаданные сервера** | **Представления/свойства SQL Server**
--- | ---
Имя сервера |SERVERPROPERTY 
Полное доменное имя. | Строка подключения, полученная из обнаружения установленных приложений
Идентификатор установки | sys.dm_server_registry
Версия сервера | SERVERPROPERTY
Выпуск сервера | SERVERPROPERTY
Платформа узла сервера (Windows или Linux) | SERVERPROPERTY
Уровень продукта сервера (RTM SP CTP) | SERVERPROPERTY 
Путь резервного копирования по умолчанию | SERVERPROPERTY
Путь по умолчанию к файлам данных | SERVERPROPERTY и Софтваре\микрософт\мссклсервер\мссклсервер
Путь по умолчанию к файлам журнала | SERVERPROPERTY и Софтваре\микрософт\мссклсервер\мссклсервер
Нет. ядер на сервере | sys.dm_os_schedulers, sys.dm_os_sys_info
Имя параметров сортировки сервера | SERVERPROPERTY
Нет. ядер на сервере с ВИДИМым состоянием "в сети" | sys.dm_os_schedulers
Уникальный идентификатор сервера | sys.dm_server_registry
Высокий уровень доступности | SERVERPROPERTY
Расширение буферного пула включено или нет | sys.dm_os_buffer_pool_extension_configuration
Настройка отказоустойчивого кластера | SERVERPROPERTY
Сервер, использующий только режим проверки подлинности Windows | SERVERPROPERTY 
Сервер устанавливает Polybase | SERVERPROPERTY 
Нет. логических процессоров в системе | sys.dm_server_registry, sys.dm_os_sys_info
Отношение числа логических или физических ядер, предоставляемых одним пакетом физического процессора | sys.dm_os_schedulers, sys.dm_os_sys_info
Количество физических ЦП в системе | sys.dm_os_schedulers, sys.dm_os_sys_info
Дата и время последнего запуска сервера | sys.dm_server_registry
Максимальное использование памяти сервера (в МБ) | sys.dm_os_process_memory
Общее число пользователей во всех базах данных | sys. databases, sys. Logins
Общий размер всех пользовательских баз данных | sys.databases
Размер временной базы данных | sys.master_files, sys.configуратионс, sys.dm_os_sys_info
Нет. имен входа | sys. Logins
Список связанных серверов | sys.servers
Список заданий агента | [msdb]. [dbo]. [sysjobs], [sys]. [syslogins], [msdb]. [dbo]. syscategories

### <a name="performance-metadata"></a>Метаданные производительности

**Производительность** | **Представления/свойства SQL Server** | **Влияние на оценку**
--- | --- | ---
SQL Server загрузка ЦП| sys.dm_os_ring_buffers| Рекомендуемый размер SKU (измерение ЦП)
Число логических ЦП SQL| sys.dm_os_sys_info| Рекомендуемый размер SKU (измерение ЦП)
Используемая физическая память SQL| sys.dm_os_process_memory| Не используется
Процент использования памяти SQL| sys.dm_os_process_memory | Не используется
Загрузка ЦП базы данных| sys.dm_exec_query_stats, sys.dm_exec_plan_attributes| Рекомендуемый размер SKU (измерение ЦП)
Используемая память базы данных (буферный пул)| sys.dm_os_buffer_descriptors| Рекомендуемый размер SKU (измерение памяти)
Файловый ввод-вывод для чтения и записи| sys.dm_io_virtual_file_stats, sys.master_files| Рекомендуемый размер SKU (измерение операций ввода-вывода)
Число операций чтения/записи в файле| sys.dm_io_virtual_file_stats, sys.master_files| Рекомендуемый размер SKU (измерение пропускной способности)
Чтение/запись в ожидании файла ввода-вывода (МС)| sys.dm_io_virtual_file_stats, sys.master_files| Рекомендуемый размер SKU (измерение задержки операций ввода-вывода)
Размер файла| sys.master_files| Рекомендуемый размер SKU (измерение хранилища)


### <a name="application-dependency-data"></a>Данные о зависимостях приложений

При анализе зависимостей без агента выполняется сбор данных о соединении и обработке.

#### <a name="windows-server-dependencies-data"></a>Данные зависимостей Windows Server

Ниже приведены данные подключения, собираемые устройством для каждого сервера Windows, включенные для анализа зависимостей без агента.

**Данные** | **Команды** 
--- | --- 
Локальный порт | netstat
Локальный IP-адрес | netstat
Удаленный порт | netstat
Удаленный IP-адрес | netstat
Состояние TCP-подключения. | netstat
ИД процесса | netstat
Число активных подключений. | netstat

Ниже приведены данные подключения, собираемые устройством для каждого сервера Windows, включенные для анализа зависимостей без агента.

**Data** | **Класс WMI** | **Свойство класса WMI**
--- | --- | ---
Имя процесса | Win32_Process | ExecutablePath
Аргументы процесса | Win32_Process | Командная строка
имя приложения; | Win32_Process | Параметр VersionInfo.ProductName свойства ExecutablePath

#### <a name="linux-server-dependencies-data"></a>Данные о зависимостях сервера Linux

Ниже приведены данные подключения, собираемые устройством для каждого сервера Linux, включенные для анализа зависимостей без агента.

**Данные** | **Команды** 
--- | ---
Локальный порт | netstat 
Локальный IP-адрес | netstat 
Удаленный порт | netstat 
Удаленный IP-адрес | netstat 
Состояние TCP-подключения. | netstat 
Число активных подключений. | netstat
ИД процесса  | netstat 
Имя процесса | ps
Аргументы процесса | ps
имя приложения; | dpkg или rpm


## <a name="collected-data---hyper-v"></a>Собираемые данные Hyper-V

Устройство собирает метаданные конфигурации и производительности с серверов, работающих в среде Hyper-V.

### <a name="metadata"></a>Метаданные
Метаданные, обнаруженные устройством "миграция Azure", помогут вам определить готовность серверов к миграции в Azure, их серверы и планы. Корпорация Майкрософт не использует эти данные для аудита соответствия требованиям лицензий.

Ниже приведен полный список метаданных сервера, которые устройство собирает и отправляет в Azure.

**Data** | **Класс WMI** | **Свойство класса WMI**
--- | --- | ---
**Сведения о сервере** | 
Серийный номер BIOS | Msvm_BIOSElement | BIOSSerialNumber
Тип виртуальной машины (1-го или 2-го поколения) | Msvm_VirtualSystemSettingData | VirtualSystemSubType
Отображаемое имя виртуальной машины | Msvm_VirtualSystemSettingData | ElementName
Версия виртуальной машины | Msvm_ProcessorSettingData | VirtualQuantity
Память (байт) | Msvm_MemorySettingData | VirtualQuantity
Максимальный объем памяти, доступный виртуальной машине | Msvm_MemorySettingData | Ограничение
Включение динамической памяти | Msvm_MemorySettingData | DynamicMemoryEnabled
Имя, версия и полное доменное имя операционной системы | Msvm_KvpExchangeComponent | Данные имени GuestIntrinsicExchangeItems
Состояния включения виртуальной машины | Msvm_ComputerSystem | EnabledState
**Сведения о дисках** | 
Идентификатор диска | Msvm_VirtualHardDiskSettingData | VirtualDiskId
Тип виртуального жесткого диска | Msvm_VirtualHardDiskSettingData | Тип
Размер виртуального жесткого диска | Msvm_VirtualHardDiskSettingData | MaxInternalSize
Родительский элемент виртуального жесткого диска | Msvm_VirtualHardDiskSettingData | ParentPath
**Сведения о сетевых картах** | 
IP-адреса (искусственные сетевые карты) | Msvm_GuestNetworkAdapterConfiguration | IPAddresses
Включение DHCP (искусственные сетевые карты) | Msvm_GuestNetworkAdapterConfiguration | DHCPEnabled
Идентификатор сетевой карты (искусственные сетевые карты) | Msvm_SyntheticEthernetPortSettingData | InstanceID
MAC-адрес сетевой карты (искусственные сетевые карты) | Msvm_SyntheticEthernetPortSettingData | Адрес
Идентификатор сетевой карты (традиционные сетевые карты) | Данные MsvmEmulatedEthernetPortSetting | InstanceID
Идентификатор MAC-адреса сетевой карты (традиционные сетевые карты) | Данные MsvmEmulatedEthernetPortSetting | Адрес

### <a name="performance-data"></a>Данные о производительности

Ниже приведены данные о производительности сервера, которые устройство собирает и отправляет в Azure.

**Класс счетчиков производительности** | **Счетчик** | **Влияние на оценку**
--- | --- | ---
Виртуальный процессор гипервизора Hyper-V | % времени выполнения гостя | Рекомендуемые размер и стоимость виртуальной машины.
Динамическая память виртуальной машины Hyper-V | Текущая нагрузка (%)<br/> Физическая память, доступная для гостя (МБ) | Рекомендуемые размер и стоимость виртуальной машины.
Виртуальное устройство хранения Hyper-V | Чтение (байт в секунду) | Вычисляет размер диска, затраты на хранение и размер виртуальной машины.
Виртуальное устройство хранения Hyper-V | Запись (байт в секунду) | Вычисляет размер диска, затраты на хранение и размер виртуальной машины.
Виртуальный сетевой адаптер Hyper-V | Получение (байт в секунду) | Вычисление размера виртуальной машины.
Виртуальный сетевой адаптер Hyper-V | Отправка (байт в секунду) | Вычисление размера виртуальной машины.

- Загрузка ЦП — это сумма всех нагрузок на всех виртуальных процессорах, подключенных к виртуальной машине.
- Использование памяти вычисляется по формуле: ((текущая загрузка) * (физическая память, доступная гостю))/100.
- Значения использования диска и сети собираются из перечисленных счетчиков производительности Hyper-V.


## <a name="collected-data---physical"></a>Собираемые данные физических компьютеров

Устройство собирает метаданные конфигурации и производительности из физических или виртуальных серверов, работающих локально.

### <a name="metadata"></a>Метаданные

Метаданные, обнаруженные устройством "миграция Azure", помогут вам определить готовность серверов к миграции в Azure, их серверы и планы. Корпорация Майкрософт не использует эти данные для аудита соответствия требованиям лицензий.

### <a name="windows-server-metadata"></a>Метаданные Windows Server

Ниже приведен полный список метаданных серверов Windows Server, которые устройство собирает и отправляет в Azure.

**Data** | **Класс WMI** | **Свойство класса WMI**
--- | --- | ---
Полное доменное имя. | Win32_ComputerSystem | Domain, Name, PartOfDomain
Число процессорных ядер | Win32_Processor | NumberOfCores
Выделенная память | Win32_ComputerSystem | TotalPhysicalMemory
Серийный номер BIOS | Win32_ComputerSystemProduct | IdentifyingNumber
Глобальный уникальный идентификатор BIOS | Win32_ComputerSystemProduct | UUID
Тип загрузки | Win32_DiskPartition | Проверьте наличие раздела типа **GPT:System** для EFI или BIOS.
Имя ОС | Win32_OperatingSystem | Caption
Версия ОС |Win32_OperatingSystem | Версия
Архитектура ОС | Win32_OperatingSystem | OSArchitecture
Число дисков | Win32_DiskDrive | Model, Size, DeviceID, MediaType, Name.
Размер диска | Win32_DiskDrive | Размер
Список сетевых карт | Win32_NetworkAdapterConfiguration | Description, Index.
IP-адрес сетевой карты | Win32_NetworkAdapterConfiguration | IPAddress
MAC-адрес сетевой карты | Win32_NetworkAdapterConfiguration | MACAddress

### <a name="linux-server-metadata"></a>Метаданные сервера Linux

Ниже приведен полный список метаданных серверов Linux, которые устройство собирает и отправляет в Azure.

**Данные** | **Команды** 
--- | --- 
Полное доменное имя. | cat /proc/sys/kernel/hostname, hostname -f
Число процессорных ядер |  /proc/cpuinfo \| awk '/^processor/{print $3}' \| wc -l
Выделенная память | cat /proc/meminfo \| grep MemTotal \| awk '{printf "%.0f", $2/1024}'
Серийный номер BIOS | lshw \| grep "serial:" \| head -n1 \| awk '{print $2}' <br/> /usr/sbin/dmidecode -t 1 \| grep 'Serial' \| awk '{ $1="" ; $2=""; print}'
Глобальный уникальный идентификатор BIOS | cat /sys/class/dmi/id/product_uuid
Тип загрузки | [ -d /sys/firmware/efi ] && echo EFI \|\| echo BIOS
Имя и версия ОС | Мы получаем доступ к этим файлам для определения версии и имени ОС:<br/><br/> /etc/os-release<br/> /usr/lib/os-release <br/> /etc/enterprise-release <br/> /etc/redhat-release<br/> /etc/oracle-release<br/>  /etc/SuSE-release<br/>  /etc/lsb-release  <br/> /etc/debian_version
Архитектура ОС | Uname -m
Число дисков | fdisk -l \| egrep 'Disk.*bytes' \| awk '{print $2}' \| cut -f1 -d ':'
Загрузочный диск | df /boot \| sed -n 2p \| awk '{print $1}'
Размер диска | fdisk -l \| egrep 'Disk.*bytes' \| egrep $disk: \| awk '{print $5}'
Список сетевых карт | ip -o -4 addr show \| awk '{print $2}'
IP-адрес сетевой карты | ip addr show $nic \| grep inet \| awk '{print $2}' \| cut -f1 -d "/" 
MAC-адрес сетевой карты | ip addr show $nic \| grep ether  \| awk '{print $2}'

### <a name="windows-performance-data"></a>Данные производительности Windows

Ниже приведены данные производительности серверов Windows Server, которые устройство собирает и отправляет в Azure.

**Data** | **Класс WMI** | **Свойство класса WMI**
--- | --- | ---
Загрузка ЦП. | Win32_PerfFormattedData_PerfOS_Processor | PercentIdleTime
Использование памяти | Win32_PerfFormattedData_PerfOS_Memory | AvailableMBytes
Число сетевых карт | Win32_PerfFormattedData_Tcpip_NetworkInterface | Получение числа сетевых устройств.
Полученные данные на сетевую карту | Win32_PerfFormattedData_Tcpip_NetworkInterface  | BytesReceivedPerSec
Переданные данные на сетевую карту | BWin32_PerfFormattedData_Tcpip_NetworkInterface | BytesSentPersec
Число дисков | BWin32_PerfFormattedData_PerfDisk_PhysicalDisk | Количество дисков.
Сведения о диске | Win32_PerfFormattedData_PerfDisk_PhysicalDisk | DiskWritesPerSec, DiskWriteBytesPerSec, DiskReadsPerSec, DiskReadBytesPerSec.

### <a name="linux-performance-data"></a>Данные производительности Linux

Ниже приведены данные производительности серверов Linux, которые устройство собирает и отправляет в Azure.

**Data** | **Команды** 
--- | --- 
Загрузка ЦП. | cat /proc/stat/| grep 'cpu' /proc/stat
Использование памяти | free \| grep Mem \| awk '{print $3/$2 * 100.0}'
Число сетевых карт | lshw -class network \| grep eth[0-60] \| wc -l
Полученные данные на сетевую карту | cat /sys/class/net/eth$nic/statistics/rx_bytes
Переданные данные на сетевую карту | cat /sys/class/net/eth$nic/statistics/tx_bytes
Число дисков | fdisk -l \| egrep 'Disk.*bytes' \| awk '{print $2}' \| cut -f1 -d ':'
Сведения о диске | cat /proc/diskstats


## <a name="appliance-upgrades"></a>Обновление устройства

Устройство обновляется, так как службы миграции Azure, работающие на устройстве, обновляются. Это происходит автоматически, так как на устройстве по умолчанию включено автоматическое обновление. Вы можете изменить этот параметр по умолчанию, чтобы обновить службы устройства вручную.

### <a name="turn-off-auto-update"></a>Отключение автоматического обновления

1. На сервере, на котором работает устройство, откройте редактор реестра.
2. Перейдите в раздел **HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\AzureAppliance**.
3. Чтобы отключить автоматическое обновление, создайте раздел реестра **AutoUpdate** со значением типа DWORD, равным 0.

    ![Настройка раздела реестра](./media/migrate-appliance/registry-key.png)


### <a name="turn-on-auto-update"></a>Включение автоматического обновления

Включить автоматическое обновление можно одним из следующих способов.

- Можно удалить раздел реестра AutoUpdate из HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\AzureAppliance.
- Чтобы включить автоматическое обновление, щелкните **просмотреть службы устройства** из последних проверок обновлений на панели **Настройка необходимых компонентов** .

Чтобы удалить раздел реестра, выполните следующие действия.

1. На компьютере, на котором работает устройство, откройте редактор реестра.
2. Перейдите в раздел **HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\AzureAppliance**.
3. Удалите раздел реестра **AutoUpdate**, который был создан ранее, чтобы отключить автоматическое обновление.

Чтобы включить автоматическое обновление в диспетчере конфигурации устройства после завершения обнаружения, выполните следующие действия.

1. В диспетчере конфигурации устройства перейдите к разделу **Настройка панели предварительных требований** .
2. В последней проверке обновлений щелкните **просмотреть службы устройств** и щелкните ссылку, чтобы включить автоматическое обновление.

    ![Включение автоматического обновления](./media/migrate-appliance/autoupdate-off.png)

### <a name="check-the-appliance-services-version"></a>Проверка версии служб устройства

Проверить версию служб устройства можно одним из следующих способов.

- В диспетчере конфигурации устройства перейдите к разделу **Настройка панели предварительных требований** .
- Это можно сделать на компьютере устройства, выбрав **Панель управления** > **Программы и компоненты**.

Чтобы проверить Диспетчер конфигурации устройства, выполните следующие действия.

1. В диспетчере конфигурации устройства перейдите к разделу **Настройка панели предварительных требований** .
2. В последней проверке обновлений щелкните **Просмотр служб устройства**.

    ![Проверка версии](./media/migrate-appliance/versions.png)

Проверка с помощью панели управления.

1. На устройстве щелкните **Пуск** > **Панель управления** > **Программы и компоненты**.
2. Проверьте версии служб устройства в списке.

    ![Проверка версии на панели управления](./media/migrate-appliance/programs-features.png)

### <a name="manually-update-an-older-version"></a>Обновление устаревшей версии вручную

Если вы используете более раннюю версию для любой из служб, необходимо удалить службу и вручную обновить ее до последней версии.

1. Чтобы проверить наличие последних версий службы устройства, [скачайте](https://aka.ms/latestapplianceservices) файл LatestComponents.json.
2.    После скачивания откройте файл LatestComponents.json в Блокноте.
3. Найдите в файле последнюю версию службы и ссылку для ее скачивания. Пример:

    "Name": "ASRMigrationWebApp", "DownloadLink": "https://download.microsoft.com/download/f/3/4/f34b2eb9-cc8d-4978-9ffb-17321ad9b7ed/MicrosoftAzureApplianceConfigurationManager.msi", "Version": "6.0.211.2", "Md5Hash": "e00a742acc35e78a64a6a81e75469b84"

4.    Скачайте последнюю версию устаревшей службы, используя ссылку в файле.
5. После скачивания выполните приведенную ниже команду в окне командной строки администратора, чтобы проверить целостность скачанного MSI-файла.

    ``` C:\>Get-FileHash -Path <file_location> -Algorithm [Hashing Algorithm] ```. Например:  C:\>CertUtil -HashFile C:\Users\public\downloads\MicrosoftAzureApplianceConfigurationManager.MSI MD5

5. Убедитесь, что выходные данные команды соответствуют записи значения хэша для службы в файле (например, значению хэша MD5 выше).
6. Теперь запустите MSI-файл, чтобы установить службу. Установка будет выполнена автоматически, и окно установщика закроется после завершения.
7. После завершения установки проверьте версию службы, выбрав **Панель управления** > **Программы и компоненты**. Служба должна быть обновлена до последней версии, указанной в JSON-файле.



## <a name="next-steps"></a>Дальнейшие действия

- [Узнайте](how-to-set-up-appliance-vmware.md), как настроить устройство для VMware.
- [Узнайте](how-to-set-up-appliance-hyper-v.md), как настроить устройство для Hyper-V.
- [Узнайте](how-to-set-up-appliance-physical.md), как настроить устройство для физических серверов.

