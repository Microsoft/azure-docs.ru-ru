---
title: Устройство репликации в службе "Миграция Azure"
description: Узнайте об устройстве миграции Azure для репликации VMWare на основе агентов.
author: anvar-ms
ms.author: anvar
ms.manager: bsiva
ms.topic: conceptual
ms.date: 01/30/2020
ms.openlocfilehash: ec277bcc3e361561f54e72c54526d65487c113b4
ms.sourcegitcommit: 867cb1b7a1f3a1f0b427282c648d411d0ca4f81f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "96754102"
---
# <a name="replication-appliance"></a>Устройство репликации

В этой статье описывается устройство репликации, используемое службой ["миграция Azure": средство миграции сервера](migrate-services-overview.md#azure-migrate-server-migration-tool) при переносе виртуальных машин VMware, физических компьютеров и виртуальных машин частного или общедоступного облака в Azure с помощью миграции на основе агентов. 


## <a name="overview"></a>Обзор

Устройство репликации развертывается при настройке миграции на основе агента виртуальных машин VMware или физических серверов. Она развертывается как отдельная локальная машина как виртуальная машина VMware или физический сервер. Он выполняется:

- **Устройство репликации**. устройство репликации координирует обмен данными и управляет репликацией данных для локальных виртуальных машин VMware и физических серверов, реплицируемых в Azure.
- **Сервер обработки**. сервер обработки, установленный по умолчанию на устройстве репликации, и выполняет следующие действия.
    - **Шлюз репликации**. он выступает в качестве шлюза репликации. Он получает данные репликации с компьютеров, включенных для репликации. Он оптимизирует данные репликации с помощью кэширования, сжатия и шифрования и отправляет их в Azure.
    - **Установщик агента**: выполняет принудительную установку службы Mobility Service. Эта служба должна быть установлена и запущена на каждом локальном компьютере, который требуется реплицировать для миграции.

## <a name="appliance-deployment"></a>Развертывание устройства

**Область использования** | **Сведения**
--- |  ---
**Миграция на основе агента виртуальной машины VMware** | Вы скачиваете шаблон OVA из центра миграции Azure и импортируете его в vCenter Server для создания виртуальной машины устройства.
**Миграция на основе агента физического компьютера** | Если у вас нет инфраструктуры VMware или вы не можете создать виртуальную машину VMware с помощью шаблона OVA, вы можете скачать установщик программного обеспечения из центра миграции Azure и запустить его для настройки компьютера устройства.

> [!NOTE]
> При развертывании в Azure для государственных организаций используйте файл установки для развертывания устройства репликации.

## <a name="appliance-requirements"></a>Требования к устройству

При настройке устройства репликации с помощью шаблона OVA, предоставленного в центре миграции Azure, устройство работает под управлением Windows Server 2016 и соответствует требованиям поддержки. Если вручную настроить устройство репликации на физическом сервере, убедитесь, что оно соответствует требованиям.

**Компонент** | **Требование**
--- | ---
 | **Устройство виртуальной машины VMware**
PowerCLI | [PowerCLI версии 6,0](https://my.vmware.com/web/vmware/details?productId=491&downloadGroup=PCLI600R1) следует устанавливать, если устройство репликации работает на виртуальной машине VMware.
Тип сетевой карты | VMXNET3 (если устройство является виртуальной машиной VMware)
 | **Параметры оборудования**
Ядра ЦП | 8
ОЗУ | 16 Гб
Количество дисков | Три: диск ОС, диск кэша сервера обработки и диск хранения.
Свободное место на диске (кэш) | 600 ГБ
Свободное место на диске (диск хранения) | 600 ГБ
**Параметры программного обеспечения** |
Операционная система | Windows Server 2016 или Windows Server 2012 R2.
Лицензия | Устройство поставляется с лицензией на ознакомительную версию Windows Server 2016, которая действительна в течение 180 дней.<br/><br/> Если ознакомительный период завершается, рекомендуется скачать и развернуть новое устройство или активировать лицензию операционной системы на виртуальной машине устройства.
Язык операционной системы | Английский (en-us)
TLS | Необходимо включить TLS 1,2.
.NET Framework | На компьютере должен быть установлен платформа .NET Framework 4,6 или более поздней версии (с включенной стойким шифрованием).
MySQL | На устройстве должна быть установлена MySQL.<br/> Должен быть установлен компонент MySQL. Можно установить вручную или Site Recovery может установить его во время развертывания устройства.
Другие приложения | Не запускайте другие приложения на устройстве репликации.
Роли Windows Server | Не включайте эти роли: <br> — доменные службы Active Directory; <br>— службы IIS; <br> — Hyper-V.
Групповые политики | Не включать эти групповые политики: <br> — запрет на использование командной строки; <br> — запрет на использование инструментов редактирования реестра; <br> — логика доверия для вложенных файлов; <br> — включение выполнения скриптов. <br> [Подробнее](/previous-versions/windows/it-pro/windows-7/gg176671(v=ws.10))
IIS | — Должен отсутствовать предварительно созданный веб-сайт по умолчанию. <br> — Должен отсутствовать предварительно созданный веб-сайт или приложение, ожидающее передачи данных на порте 443. <br>— включите [анонимную аутентификацию](/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/cc731244(v=ws.10)); <br> — включите параметр [FastCGI](/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/cc753077(v=ws.10));
**Параметры сети** |
Тип IP-адреса | Статические
Порты | 443 (оркестрация канала управления)<br>9443 (передача данных)
Тип сетевой карты | VMXNET3

## <a name="mysql-installation"></a>Установка MySQL 

На компьютере с устройством репликации необходимо установить MySQL. Его можно установить с помощью одного из этих методов.

**Метод** | **Сведения**
--- | ---
Скачать и установить вручную | Скачайте приложение MySQL & поместите его в папку К:\темп\асрсетуп, а затем установите вручную.<br/> При настройке устройства MySQL будет отображаться как уже установленный.
Без загрузки в сети | Поместите приложение MySQL Installer в папку К:\темп\асрсетуп. При установке устройства и нажатии кнопки Загрузить и установить MySQL программа установки будет использовать добавленный установщик.
Скачать и установить в службе "миграция Azure" | При установке устройства и появлении запроса на выбор MySQL выберите **скачать и установить**.

## <a name="url-access"></a>доступ по URL-адресу

Устройству репликации требуется доступ к этим URL-адресам в общедоступном облаке Azure.

**URL-адрес** | **Сведения**
--- | ---
\*.backup.windowsazure.com | Используется для передачи и координации реплицированных данных
\*.store.core.windows.net | Используется для передачи и координации реплицированных данных
\*.blob.core.windows.net | Используется для получения доступа к учетной записи хранения, в которой хранятся реплицируемые данные
\*.hypervrecoverymanager.windowsazure.com | Используется для операций управления репликацией и координации
https:\//management.azure.com | Используется для операций управления репликацией и координации
*.services.visualstudio.com | Используется в целях телеметрии (дополнительный параметр)
time.windows.com | Используются для проверки синхронизации системного и глобального времени.
https:\//login.microsoftonline.com <br/> https:\//secure.aadcdn.microsoftonline-p.com <br/> https:\//login.live.com <br/> https:\//graph.windows.net <br/> https:\//login.windows.net <br/> https:\//www.live.com <br/> https:\//www.microsoft.com  | Программе установки устройства требуется доступ к этим URL-адресам. Они используются для управления доступом и удостоверениями с помощью Azure Active Directory.
https:\//dev.mysql.com/get/Downloads/MySQLInstaller/mysql-installer-community-5.7.20.0.msi | Для завершения скачивания MySQL. В нескольких регионах скачивание может быть перенаправлено на URL-адрес CDN. При необходимости убедитесь, что URL-адрес CDN также разрешен.


## <a name="azure-government-url-access"></a>Доступ по URL-адресам Azure для государственных организаций

Устройству репликации требуется доступ к этим URL-адресам в Azure для государственных организаций.

**URL-адрес** | **Сведения**
--- | ---
\*.backup.windowsazure.us | Используется для передачи и координации реплицированных данных
\*.store.core.windows.net | Используется для передачи и координации реплицированных данных
\*.blob.core.windows.net | Используется для получения доступа к учетной записи хранения, в которой хранятся реплицируемые данные
\*.hypervrecoverymanager.windowsazure.us | Используется для операций управления репликацией и координации
https:\//management.usgovcloudapi.net | Используется для операций управления репликацией и координации
*.services.visualstudio.com | Используется в целях телеметрии (дополнительный параметр)
time.nist.gov | Используются для проверки синхронизации системного и глобального времени.
https:\//login.microsoftonline.com <br/> https:\//secure.aadcdn.microsoftonline-p.com <br/> https:\//login.live.com <br/> https:\//graph.windows.net <br/> https:\//login.windows.net <br/> https:\//www.live.com <br/> https:\//www.microsoft.com  | Программе установки устройства с OVA требуется доступ к этим URL-адресам. Они используются для управления доступом и управления удостоверениями с помощью Azure Active Directory.
https:\//dev.mysql.com/get/Downloads/MySQLInstaller/mysql-installer-community-5.7.20.0.msi | Для завершения скачивания MySQL. В нескольких регионах скачивание может быть перенаправлено на URL-адрес CDN. При необходимости убедитесь, что URL-адрес CDN также разрешен.

## <a name="port-access"></a>Доступ к портам

**Устройство** | **Соединение**
--- | ---
Виртуальные машины | Служба Mobility Service, работающая на виртуальных машинах, обменивается данными с локальным устройством репликации (сервером конфигурации) через порт HTTPS 443 Inbound для управления репликацией.<br/><br/> Виртуальные машины отправляют данные репликации на сервер обработки (запущенный на компьютере сервера конфигурации) через HTTPS-порт 9443 для входящих подключений. Этот порт можно изменить.
Устройство репликации | Устройство репликации управляет репликацией с помощью Azure через порт HTTPS 443 Outbound.
Сервер обработки | Сервер обработки получает данные репликации, оптимизирует и шифрует их и отправляет в службу хранилища Azure по исходящему порту 443.<br/> По умолчанию сервер обработки запускается на устройстве репликации.


## <a name="replication-process"></a>Процесс репликации

1. При включении репликации для виртуальной машины начинается начальная репликация в службу хранилища Azure с помощью указанной политики репликации. 
2. Трафик реплицируется в общедоступные конечные точки службы хранилища Azure через Интернет. Репликация трафика через VPN типа "сеть — сеть" с локального сайта в Azure не поддерживается.
3. После завершения начальной репликации начинается разностная репликация. Записанные изменения для компьютера регистрируются в журнале.
4. Обмен данными происходит следующим образом.
    - Виртуальные машины обмениваются данными с устройством репликации через порт HTTPS 443 Inbound для управления репликацией.
    - Устройство репликации управляет репликацией с помощью Azure через порт HTTPS 443 Outbound.
    - Виртуальные машины отправляют данные репликации на сервер обработки (работающий на устройстве репликации) через порт HTTPS 9443 inbound. Этот порт можно изменить.
    - Сервер обработки получает данные репликации, оптимизирует и шифрует их и отправляет в службу хранилища Azure по исходящему порту 443.
5. Сначала журналы данных репликации помещаются в учетную запись хранения кэша в Azure. Эти журналы обрабатываются, и данные хранятся на управляемом диске Azure.

![На схеме показана архитектура процесса репликации.](./media/migrate-replication-appliance/architecture.png)

## <a name="appliance-upgrades"></a>Обновление устройства

Устройство обновляется вручную из центра миграции Azure. Рекомендуется всегда запускать последнюю версию.

1. В Azure миграция > серверы > службе "миграция Azure": Оценка серверов, серверы инфраструктуры, щелкните **серверы конфигурации**.
2. На **серверах конфигурации** в **версии агента** появляется ссылка, если доступна новая версия устройства репликации. 
3. Скачайте установщик на компьютер с устройством репликации и установите обновление. Установщик определяет текущую версию, выполняемую на устройстве.
 
## <a name="next-steps"></a>Дальнейшие действия

- [Узнайте, как](tutorial-migrate-vmware-agent.md#set-up-the-replication-appliance) настроить устройство репликации для миграции виртуальных машин VMware на основе агентов.
- [Узнайте, как](tutorial-migrate-physical-virtual-machines.md#set-up-the-replication-appliance) настроить устройство репликации для физических серверов.
