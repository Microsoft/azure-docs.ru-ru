---
title: Настройка устройства "миграция Azure" для физических серверов
description: Узнайте, как настроить устройство "миграция Azure" для обнаружения и оценки физических серверов.
author: vineetvikram
ms.author: vivikram
ms.manager: abhemraj
ms.topic: how-to
ms.date: 03/13/2021
ms.openlocfilehash: 9052cbd3dc728b50b62c33f3a11a5e36a7504f29
ms.sourcegitcommit: 2c1b93301174fccea00798df08e08872f53f669c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/22/2021
ms.locfileid: "104771572"
---
# <a name="set-up-an-appliance-for-physical-servers"></a>Настройка устройства для физических серверов

В этой статье описывается, как настроить устройство службы "миграция Azure", если вы оцениваете физические серверы с помощью средства "миграция Azure": обнаружение и оценка.

Устройство миграции Azure — это упрощенное устройство, используемое службой "миграция Azure": обнаружение и оценка для выполнения следующих задач:

- Обнаружение локальных серверов.
- Отправка метаданных и данных о производительности обнаруженных серверов в службу "миграция Azure": обнаружение и оценка.

[Дополнительные сведения](migrate-appliance.md) об устройстве службы "Миграция Azure".


## <a name="appliance-deployment-steps"></a>Этапы развертывания устройства

Чтобы настроить устройство, сделайте следующее.

- Укажите имя устройства и создайте ключ проекта на портале.
- Скачайте ZIP-файл со скриптом установщика службы "Миграция Azure" с портала Azure.
- Извлеките содержимое ZIP-файла. Откройте консоль PowerShell с правами администратора.
- Выполните скрипт PowerShell, чтобы запустить веб-приложение устройства.
- Настройте устройство в первый раз и зарегистрируйте его в проекте с помощью ключа проекта.

### <a name="generate-the-project-key"></a>Создание ключа проекта

1. В **целях миграции**  >  **Windows, Linux и серверы SQL Server**  >  **Миграция Azure: обнаружение и оценка**, выберите **Обнаружение**.
2. В разделе **Обнаружение серверов**  >  **виртуализованные серверы** выберите пункт **физическое или другое (AWS, обеспечить, Xen и т. д.)**.
3. В **1. Создайте ключ проекта**, укажите имя для устройства миграции Azure, которое будет настроено для обнаружения физических или виртуальных серверов. Это имя должно содержать буквы и цифры (не более 14 символов).
1. Щелкните **Создать ключ**, чтобы начать создание необходимых ресурсов Azure. Не закрывайте страницу «Обнаружение серверов» во время создания ресурсов.
1. После успешного создания ресурсов Azure создается **ключ проекта** .
1. Скопируйте этот ключ, так как он понадобится вам для завершения регистрации модуля во время его настройки.

### <a name="download-the-installer-script"></a>Скачивание скрипта установщика

В разделе **2: Скачайте модуль "Миграция Azure"** щелкните действие **Скачать**.

   ![Выделенные фрагменты области "Обнаружение компьютеров"](./media/tutorial-assess-physical/servers-discover.png)


   ![Выделенный фрагмент области создания ключа](./media/tutorial-assess-physical/generate-key-physical.png)

### <a name="verify-security"></a>Проверка безопасности

Прежде чем развертывать сжатый ZIP-файл, убедитесь, что он не поврежден.

1. На серверах, где был скачан файл, откройте окно командной строки администратора.
2. Выполните следующую команду, чтобы создать хэш ZIP-файла.
    - ```C:\>CertUtil -HashFile <file_location> [Hashing Algorithm]```
    - Пример использования для общедоступного облака: ```C:\>CertUtil -HashFile C:\Users\administrator\Desktop\AzureMigrateInstaller-Server-Public.zip SHA256 ```.
    - Пример использования для облака для государственных организаций: ```  C:\>CertUtil -HashFile C:\Users\administrator\Desktop\AzureMigrateInstaller-Server-USGov.zip MD5 ```.
3.  Проверьте последнюю версию устройства и параметры [хэш-значений](tutorial-discover-physical.md#verify-security) .
 

## <a name="run-the-azure-migrate-installer-script"></a>Запуск скрипта установщика службы "Миграция Azure"
Скрипт установщика выполняет следующие операции.

- Устанавливает агенты и веб-приложения для обнаружения и оценки физических серверов.
- Устанавливает роли Windows, включая службу активации Windows, IIS и интегрированную среду разработку PowerShell.
- Скачивает и устанавливает доступный для записи модуль IIS. [Подробнее](https://www.microsoft.com/download/details.aspx?id=7435).
- Обновляет раздел реестра (HKLM), используя постоянные значения параметров для службы "Миграция Azure".
- Создает следующие файлы по указанному пути.
    - **Файлы конфигурации**: %Programdata%\Microsoft Azure\Config
    - **Файлы журнала**: %Programdata%\Microsoft Azure\Logs

Выполните скрипт следующим образом:

1. Извлеките ZIP-файл в папку на сервере, на котором будет размещено устройство.  Убедитесь, что сценарий не выполняется на сервере с существующим устройством миграции Azure.
2. Запустите PowerShell на указанном сервере с повышенными правами (права администратора).
3. Измените каталог PowerShell на папку, в которую было извлечено содержимое скачанного ZIP-файла.
4. Запустите скрипт с именем **AzureMigrateInstaller.ps1**, выполнив следующую команду:

    - Для общедоступного облака: 
    
        ``` PS C:\Users\administrator\Desktop\AzureMigrateInstaller-Server-Public> .\AzureMigrateInstaller.ps1 ```
    - Для Azure для государственных организаций: 
    
        ``` PS C:\Users\Administrators\Desktop\AzureMigrateInstaller-Server-USGov>.\AzureMigrateInstaller.ps1 ```

    После успешного завершения скрипт запустит веб-приложение устройства.

Журналы скриптов для устранения неполадок см. здесь: C:\ProgramData\Microsoft Azure\Logs\AzureMigrateScenarioInstaller_<em>Timestamp</em>.log.



### <a name="verify-appliance-access-to-azure"></a>Проверка доступа устройства к Azure

Убедитесь, что устройство может подключиться к URL-адресам Azure для [общедоступного](migrate-appliance.md#public-cloud-urls) облака и облака для [государственных организаций](migrate-appliance.md#government-cloud-urls).

### <a name="configure-the-appliance"></a>Настройка устройства

Настройте устройство в первый раз.

1. Откройте браузер на любом компьютере, который может подключиться к устройству, и откройте URL-адрес веб-приложения устройства: **https://*имя или IP-адрес устройства*: 44368**.

   Кроме того, вы можете открыть приложение с рабочего стола, щелкнув ярлык приложения.
2. Примите **условия лицензии** и прочитайте информацию от сторонних производителей.
1. В веб-приложении выберите **Настройка необходимых компонентов** и выполните приведенные ниже действия.
    - **Возможность подключения**: Приложение проверит наличие доступа к Интернету у сервера. Если на сервере используется прокси-сервер:
        - Щелкните **Setup Proxy (Настройка прокси-сервера** ) и укажите адрес прокси-сервера (в форме http://ProxyIPAddress или http://ProxyFQDN) прослушиваемом порте).
        - Укажите учетные данные, если для прокси-сервера требуется аутентификация.
        - Поддерживается только прокси-сервер HTTP.
        - Если вы добавили сведения о прокси-сервере или отключили его и (или) проверку подлинности, щелкните **Сохранить**, чтобы снова запустить проверку подключения.
    - **Синхронизация времени**: время проверяется. Для правильной работы обнаружения серверов время на устройстве должно быть синхронизировано со временем в Интернете.
    - **Установка обновлений**: служба "миграция Azure": обнаружение и оценка — проверяет, установлены ли на устройстве последние обновления. После завершения проверки вы можете щелкнуть пункт **View appliance services** (Просмотр служб модуля), чтобы просмотреть состояние и версии компонентов, используемых модулем.

### <a name="register-the-appliance-with-azure-migrate"></a>Регистрация устройства с помощью службы "Миграция Azure"

1. Вставьте **ключ проекта** , скопированный с портала. Если у вас нет ключа, перейдите в раздел " **Миграция Azure": обнаружение и оценка> обнаружение> управление существующими устройствами**, выберите имя устройства, которое вы указали во время создания ключа, и скопируйте соответствующий ключ.
1. Вам потребуется код устройства для аутентификации в Azure. Если щелкнуть **Вход**, откроется модальное окно с кодом устройства, как показано ниже.

    ![Модальное окно с кодом устройства](./media/tutorial-discover-vmware/device-code.png)

1. Щелкните **Копировать код и войти**, чтобы скопировать код устройства и открыть окно входа в Azure в новой вкладке браузера. Если этот параметр не отображается, убедитесь, что в браузере отключена блокировка всплывающих окон.
1. На новой вкладке вставьте код устройства и выполните вход с помощью имени пользователя и пароля Azure.
   
   Вход с помощью PIN-кода не поддерживается.
3. Если вы случайно закроете вкладку входа, не выполнив вход, вам потребуется обновить вкладку браузера в диспетчере конфигурации устройства, чтобы снова активировать кнопку "Вход".
1. После успешного входа вернитесь на предыдущую вкладку с помощью диспетчера конфигурации устройства.
4. Если учетная запись пользователя Azure, используемая для ведения журнала, имеет необходимые [разрешения](./tutorial-discover-physical.md) на ресурсы Azure, созданные во время создания ключа, будет инициирована регистрация модуля.
1. После регистрации модуля вы можете просмотреть сведения о регистрации, щелкнув **Просмотреть подробности**.


## <a name="start-continuous-discovery"></a>Запуск непрерывного обнаружения

Далее подключитесь с устройства к физическим серверам, которые требуется обнаружить, и запустите процесс обнаружения.

1. В разделе **Шаг 1. Укажите учетные данные для обнаружения физических или виртуальных серверов Windows и Linux**, щелкнув **Добавить учетные данные**.
1. Для Windows Server выберите тип источника в качестве **Windows Server**, укажите понятное имя для учетных данных, добавьте имя пользователя и пароль. Щелкните **Save**(Сохранить).
1. Если вы используете проверку подлинности на основе пароля для сервера Linux, выберите тип источника в качестве **сервера Linux (на основе пароля)**, укажите понятное имя учетных данных, добавьте имя пользователя и пароль. Щелкните **Save**(Сохранить).
1. При использовании проверки подлинности на основе ключей SSH для сервера Linux можно выбрать тип источника как **сервер Linux (на основе ключа SSH)**, указать понятное имя для учетных данных, добавить имя пользователя, просмотреть и выбрать файл закрытого ключа SSH. Щелкните **Save**(Сохранить).

    - Служба "миграция Azure" поддерживает закрытый ключ SSH, созданный командой SSH-Keygen, с помощью алгоритмов RSA, DSA, ECDSA и ed25519.
    - Сейчас служба "миграция Azure" не поддерживает ключ SSH на основе парольной фразы. Используйте ключ SSH без парольной фразы.
    - Сейчас служба "Миграция Azure" не поддерживает файл закрытого ключа SSH, созданный с помощью PuTTY.
    - Миграция Azure поддерживает формат OpenSSH для файла закрытого ключа SSH, как показано ниже:
    
    ![Поддерживаемый формат закрытого ключа SSH](./media/tutorial-discover-physical/key-format.png)
1. Если вы хотите добавить несколько учетных данных одновременно, щелкните **Добавить еще**, чтобы сохранить и добавить дополнительные учетные данные. Для обнаружения физических серверов можно ввести несколько учетных данных.
1. В разделе **Шаг 2. Указание сведений о физическом или виртуальном сервере** щелкните **Добавить источник обнаружения**, чтобы указать значение **IP-адрес или полное доменное имя** сервера и понятное имя учетных данных для подключения к серверу.
1. За один раз можно выбрать пункт **Add single item** (Добавить один элемент) или **Add multiple items** (Добавить несколько элементов). Здесь также есть параметр **Импорт CSV** для предоставления сведений о сервере.

    ![Выбранные элементы для добавления источника обнаружения](./media/tutorial-assess-physical/add-discovery-source-physical.png)

    - Если вы выберете пункт **Add single item** (Добавить один элемент), вы сможете выбрать тип операционной системы, указать понятное имя для учетных данных и ввести **IP-адрес или полное доменное имя** для нужного сервера, а затем щелкнуть **Сохранить**.
    - При выборе параметра **Добавить несколько элементов** можно добавить сразу несколько записей, указав **IP-адрес или полное доменное** имя сервера с понятным именем для учетных данных в текстовом поле. Проверьте * * добавленные записи и нажмите кнопку " **сохранить**".
    - Если вы выберете пункт **Импорт CSV** _(он выбран по умолчанию)_ , вы сможете скачать CSV-файл шаблона и указать в нем **IP-адрес или полное доменное имя сервера** и понятное имя для учетных данных. Затем импортируйте файл в виртуальный модуль, нажмите кнопку **Проверить** для проверки записей в файле и щелкните **Сохранить**.

1. При нажатии кнопки "Сохранить" модуль попытается проверить подключение к добавленным серверам и отобразит **состояние проверки** в таблице для каждого из них.
    - Если проверка сервера завершилась неудачно, просмотрите ошибку, щелкнув пункт **Проверка не пройдена** в столбце "Состояние" таблицы. Устраните проблему и выполните проверку еще раз.
    - Чтобы удалить сервер, щелкните **Удалить**.
1. Можно повторно **проверить** подключение к серверам в любое время перед началом обнаружения.
1. Щелкните **Начать обнаружение**, чтобы запустить обнаружение успешно проверенных серверов. После успешного запуска обнаружения вы можете проверить состояние обнаружения для каждого сервера в таблице.


Запустится обнаружение. Чтобы метаданные обнаруженного сервера отобразились на портале Azure, потребуется около 2 минут на каждый сервер.

## <a name="verify-servers-in-the-portal"></a>Проверка серверов на портале

После завершения обнаружения вы можете проверить, отображаются ли серверы на портале Azure.

1. Откройте панель мониторинга службы "Миграция Azure".
2. На странице "миграция **Azure — Windows, Linux и SQL Servers**  >  **Azure: обнаружение и оценка** " щелкните значок, отображающий количество **обнаруженных серверов**.


## <a name="next-steps"></a>Дальнейшие действия

Испытайте [оценку физических серверов](tutorial-assess-physical.md) с помощью службы "миграция Azure": обнаружение и оценка.