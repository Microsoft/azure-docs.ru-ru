---
title: Автоматизация миграции машин миграции в службе "миграция Azure"
description: Описание использования сценариев для переноса большого количества компьютеров в службе "миграция Azure"
author: anvar-ms
ms.author: anvar
ms.manager: bsiva
ms.topic: how-to
ms.date: 04/01/2019
ms.openlocfilehash: 01196b23ce5bf9ce842da89d0773a77e6a1d5107
ms.sourcegitcommit: 772eb9c6684dd4864e0ba507945a83e48b8c16f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "96754238"
---
# <a name="scale-migration-of-vms"></a>Масштабирование миграции виртуальных машин 

Эта статья поможет вам понять, как использовать скрипты для переноса большого количества виртуальных машин (ВМ). Чтобы масштабировать миграцию, используйте [Azure Site Recovery](../site-recovery/site-recovery-overview.md). 

Site Recovery сценарии доступны для скачивания в репозитории [примеров Azure PowerShell](https://github.com/Azure/azure-docs-powershell-samples/tree/master/azure-migrate/migrate-at-scale-with-site-recovery) на сайте GitHub. Сценарии можно использовать для переноса виртуальных машин VMware, AWS, обеспечить и физических серверов на управляемые диски в Azure. С их помощью также можно перенести виртуальные машины Hyper-V, если вы переносите виртуальные машины как физические серверы. Скрипты, использующие Azure Site Recovery PowerShell, описаны [здесь](../site-recovery/vmware-azure-disaster-recovery-powershell.md).

## <a name="current-limitations"></a>Текущие ограничения
- Поддержка указания статического IP-адреса только для основной сетевой карты целевой виртуальной машины.
- Сценарии не принимают входные данные, связанные с Преимуществом гибридного использования Azure. Вам необходимо вручную обновлять свойства реплицированной виртуальной машины на портале.

## <a name="how-does-it-work"></a>Как это работает?

### <a name="prerequisites"></a>Предварительные условия
Перед началом работы необходимо сделать следующее:
- Убедитесь, что хранилище Site Recovery создано в подписке Azure.
- Убедитесь, что в исходной среде установлен сервер конфигурации и сервер обработки и хранилище может обнаружить эту среду.
- Убедитесь, что политика репликации создана и связана с сервером конфигурации.
- Убедитесь, что учетная запись администратора виртуальной машины добавлена на сервер конфигурации (который будет использоваться для репликации локальных виртуальных машин).
- Убедитесь, что целевые артефакты в Azure созданы
    - целевая группа ресурсов;
    - Целевая учетная запись хранения (и ее группа ресурсов) — создайте учетную запись хранения класса Premium, если планируется переход на управляемые диски уровня "Премиум".
    - Учетная запись хранения кэша (и ее группа ресурсов). Создайте стандартную учетную запись хранения в том же регионе, что и хранилище.
    - целевая виртуальная сеть для отработки отказа (и ее группа ресурсов);
    - целевая подсеть;
    - целевая виртуальная сеть для тестовой отработки отказа (и ее группа ресурсов);
    - группа доступности (при необходимости);
    - целевая группа безопасности сети и ее группа ресурсов.
- Убедитесь, что вы определились со свойствами целевой виртуальной машины:
    - имя целевой виртуальной машины;
    - размер целевой виртуальной машины в Azure (можно определить с помощью оценки службы "Миграция Azure");
    - частный IP-адрес основной сетевой карты на виртуальной машине.
- Скачайте сценарии из репозитория [примеров для Azure PowerShell](https://github.com/Azure/azure-docs-powershell-samples/tree/master/azure-migrate/migrate-at-scale-with-site-recovery) на GitHub.

### <a name="csv-input-file"></a>Входной CSV-файл
После выполнения всех необходимых условий необходимо создать CSV-файл, который содержит данные для каждого исходного компьютера, который требуется перенести. Входной CSV-файл должен содержать строку заголовка со сведениями о входных данных и строку с подробными сведениями для каждого компьютера, который необходимо перенести. Все сценарии предназначены для работы с одним и тем же CSV-файлом. Пример шаблона CSV-файла доступен в папке сценариев для справки.

### <a name="script-execution"></a>Выполнение сценария
После подготовки CSV-файла можно выполнить следующие действия для переноса локальных виртуальных машин:

**Номер шага** | **Имя сценария** | **Описание**
--- | --- | ---
1 | asr_startmigration.ps1 | Включение репликации для всех виртуальных машин, перечисленных в CSV-файле. Сценарий генерирует выходные данные в формате CSV со сведениями о задании для каждой виртуальной машины.
2 | asr_replicationstatus.ps1 | Проверка состояния репликации. Сценарий создает CSV-файл с состоянием для каждой виртуальной машины.
3 | asr_updateproperties.ps1 | Когда виртуальные машины будут реплицированы и защищены, используйте этот сценарий для обновления целевых свойств виртуальной машины (свойства вычисления и сети).
4 | asr_propertiescheck.ps1 | Проверка того, правильно ли обновлены свойства.
5 | asr_testmigration.ps1 |  Запуск тестовой отработки отказа виртуальных машин, перечисленных в CSV-файле. Сценарий создает выходные данные в формате CSV со сведениями о задании для каждой виртуальной машины.
6 | asr_cleanuptestmigration.ps1 | После того как вы вручную проверите виртуальные машины после тестовой отработки отказа, можно использовать этот сценарий для очистки виртуальных машин, использованных для тестовой отработкой отказа.
7 | asr_migration.ps1 | Запуск внеплановой отработки отказа для виртуальных машин, перечисленных в CSV-файле. Сценарий создает выходные данные в формате CSV со сведениями о задании для каждой виртуальной машины. Скрипт не завершает работу локальных виртуальных машин перед запуском отработки отказа. для обеспечения согласованности приложений рекомендуется вручную завершить работу виртуальных машин перед выполнением скрипта.
8 | asr_completemigration.ps1 | Выполнение операции фиксации на виртуальных машинах и удаление сущностей Azure Site Recovery
9 | asr_postmigration.ps1 | Если вы планируете назначить группы безопасности сети для сетевых карт после отработки отказа, для этого можно использовать этот сценарий. Он назначает NSG любому сетевому адаптеру на целевой виртуальной машине.

## <a name="how-to-migrate-to-managed-disks"></a>Как перейти на управляемые диски?
По умолчанию этот сценарий переносит виртуальные машины на управляемые диски в Azure. Если указанная целевая учетная запись хранения является учетной записью хранилища класса Premium, то после миграции создаются управляемые диски уровня "Премиум". Учетная запись хранения кэша по-прежнему может быть стандартной учетной записью. Если целевая учетная запись хранения является учетной записью хранения уровня "Стандартный", то после миграции создаются стандартные диски. 

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения о переносе серверов в Azure с помощью Azure Site Recovery см. [здесь](../site-recovery/migrate-tutorial-on-premises-azure.md).
