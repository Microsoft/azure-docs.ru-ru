---
title: Миграция виртуальных машин VMware с помощью средства "Миграция сервера" службы "Миграция Azure" без агента
description: Узнайте, как выполнить миграцию виртуальных машин VMware с помощью службы "Миграция Azure" без агента.
author: anvar-ms
ms.author: anvar
ms.manager: bsiva
ms.topic: tutorial
ms.date: 06/09/2020
ms.custom: mvc
ms.openlocfilehash: a858bcc0e6f6364a1eb5c37d555f5f1e7064b650
ms.sourcegitcommit: aaa65bd769eb2e234e42cfb07d7d459a2cc273ab
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/27/2021
ms.locfileid: "98879466"
---
# <a name="migrate-vmware-vms-to-azure-agentless"></a>Миграция виртуальных машин VMware в Azure (без агента)

В этой статье показано, как выполнить миграцию без агента для переноса локальных виртуальных машин VMware в Azure с помощью [средства переноса сервера службы "Миграция Azure"](migrate-services-overview.md#azure-migrate-server-migration-tool). Кроме того, вы можете использовать для виртуальных машин VMware миграцию на основе агента. [Сравните](server-migrate-overview.md#compare-migration-methods) эти методы.

Это руководство является третьим в серии, посвященной оценке виртуальных машин VMware и их переносу в Azure. 

> [!NOTE]
> В руководствах показан простейший путь развертывания сценария, использование которого позволяет быстро настроить проверку концепции. В руководствах по возможности используются параметры по умолчанию и показаны не все возможные параметры и пути. 


В этом руководстве описано следующее:

> [!div class="checklist"]
> * Добавление средства переноса сервера службы "Миграция Azure".
> * Обнаружение виртуальных машин, которые требуется перенести.
> * Запуск репликации виртуальных машин.
> * Выполнение тестовой миграции, позволяющей убедиться в правильной работе всех компонентов.
> * Выполнение полной миграции виртуальной машины.

Если у вас еще нет подписки Azure, [создайте бесплатную учетную запись](https://azure.microsoft.com/pricing/free-trial/), прежде чем начинать работу.

## <a name="prerequisites"></a>Предварительные требования

Для работы с этим руководством вам потребуется:

1. [Выполните задачи из первого руководства](./tutorial-discover-vmware.md), чтобы подготовить Azure и VMware к миграции.
2. Мы рекомендуем изучить и второе руководство, чтобы [оценить виртуальные машины VMware](./tutorial-assess-vmware-azure-vm.md) перед переносом в Azure. Но это не обязательно. 
3. Перейдите к созданному проекту или [создайте новый проект](./create-manage-projects.md).
4. Проверьте разрешения своей учетной записи. Учетная запись Azure должна иметь разрешения на создание виртуальной машины и на запись на управляемый диск Azure.

## <a name="set-up-the-azure-migrate-appliance"></a>Настройка устройства службы "Миграция Azure"

Средство переноса сервера службы "Миграция Azure" запускает небольшое устройство виртуальной машины VMware, которое используется для обнаружения, оценки виртуальных машин VMware и их переноса без агента. Если вы выполнили инструкции из [руководства по оценке](./tutorial-assess-vmware-azure-vm.md), устройство у вас уже есть. Если это не так, настройте его прямо сейчас одним из следующих методов:

- **Шаблон OVA**. [Настройка](how-to-set-up-appliance-vmware.md) на виртуальной машине VMware с помощью скачанного шаблона OVA.
- **Script**: [Настройте](deploy-appliance-script.md) на виртуальной машине VMware или физическом компьютере с помощью скрипта установщика PowerShell. Этот метод следует использовать, если не удается настроить виртуальную машину с помощью шаблона OVA или если вы используете Azure для государственных организаций.

После создания модуля убедитесь, что он может подключиться к средству оценки серверов службы "Миграция Azure", выполните его первоначальную настройку и зарегистрируйте в проекте службы "Миграция Azure".

## <a name="replicate-vms"></a>Репликация виртуальных машин

Завершив настройку устройства и обнаружение виртуальных машин VMware, можете запускать их репликацию в Azure. 

- Одновременно можно выполнять до 300 репликаций.
- На портале вы можете выбрать одновременно до 10 виртуальных машин для миграции. Чтобы перенести больше виртуальных машин, добавляйте их пакетами по 10 штук.

Включите репликацию следующим образом:

1. В проекте службы "Миграция Azure" щелкните **Серверы** и в разделе **Azure Migrate: Server Migration** (Миграция Azure: миграция сервера) выберите **Репликация**.

    ![Репликация виртуальных машин](./media/tutorial-migrate-vmware/select-replicate.png)

2. В разделе **Реплицировать** выберите **Параметры исходного кода** > **Ваши компьютеры виртуализированы?** и **Yes, with VMware vSphere Hypervisor** (Да, с помощью гипервизора VMware vSphere).
3. В разделе **Локальное устройство** выберите имя устройства Миграции Azure, которое вы настроили, и нажмите кнопку **ОК**. 

    ![Параметры источника](./media/tutorial-migrate-vmware/source-settings.png)

4. В разделе **Виртуальные машины** выберите виртуальные машины, которые необходимо реплицировать. Чтобы применить размеры виртуальных машин и типы дисков, полученные по итогам оценки (если она выполнялась), выберите в поле **Импортировать параметры миграции из средства оценки Миграции Azure?** вариант ответа **Да**, а затем выберите группу виртуальных машин и имя оценки. Если параметры оценки не используются, выберите вариант **Нет**.
   
    ![Выбор оценки](./media/tutorial-migrate-vmware/select-assessment.png)

5. В поле **Виртуальные машины** выберите виртуальные машины, которые требуется перенести. Выберите **Next: Целевые параметры**.

    ![Выбор виртуальных машин](./media/tutorial-migrate-vmware/select-vms.png)

6. В разделе **Целевые параметры** выберите подписку и целевой регион. Укажите группу ресурсов, в которой виртуальные машины Azure будут располагаться после миграции.
7. В разделе **Виртуальная сеть** выберите виртуальную сеть или подсеть Azure, к которой подключаются виртуальные машины Azure после миграции.
8. В области **Параметры доступности** выберите следующие параметры.
    -  "Зона доступности", чтобы закрепить перенесенный компьютер в определенной зоне доступности в регионе. Используйте этот параметр для распределения серверов, образующих уровень приложения с несколькими узлами, по зонам доступности. Если вы выберете этот параметр, нужно будет указать зону доступности, чтобы использовать ее для каждого из выбранных компьютеров на вкладке "Вычисление". Этот параметр доступен только в том случае, если в целевом регионе, выбранном для миграции, поддерживаются зоны доступности.
    -  "Группа доступности", чтобы поместить перенесенную виртуальную машину в группу доступности. Чтобы использовать этот параметр, выбранная целевая группа ресурсов должна содержать одну или несколько групп доступности.
    - Параметр "Избыточность инфраструктуры не требуется", если вам не нужна ни одна из этих конфигураций доступности для перенесенных виртуальных машин.
9. В разделе **Disk encryption type** (Тип шифрования диска) выберите один из следующих вариантов:
    - шифрование неактивных данных с помощью ключа, управляемого платформой;
    - шифрование неактивных данных с помощью ключа, управляемого клиентом.

   > [!NOTE]
   > Чтобы реплицировать виртуальные машины с помощью CMK, вам потребуется [создать набор шифрования дисков](../virtual-machines/disks-enable-customer-managed-keys-portal.md#set-up-your-disk-encryption-set) в целевой группе ресурсов. Объект набора шифрования дисков сопоставляет управляемые диски с Key Vault, где содержится CMK для использования в SSE.
  
10. Для параметра **Преимущество гибридного использования Azure**

    - выберите вариант **Нет**, если вы не хотите применять Преимущество гибридного использования Azure. Затем нажмите кнопку **Далее**.
    - Выберите вариант **Да**, если у вас есть компьютеры с Windows Server, на которые распространяются активные подписки Software Assurance или Windows Server, и вы хотите применить это преимущество к компьютерам, которые вы переносите. Затем нажмите кнопку **Далее**.

    ![Целевые параметры](./media/tutorial-migrate-vmware/target-settings.png)

11. В разделе **Вычисление** проверьте имя виртуальной машины, ее размер, тип диска ОС и конфигурацию доступности (если она выбрана на предыдущем шаге). Виртуальные машины должны соответствовать [требованиям Azure](migrate-support-matrix-vmware-migration.md#azure-vm-requirements).

    - **Размер виртуальной машины**. Если вы используете рекомендации по оценке, в раскрывающемся списке размеров виртуальных машин отобразится рекомендуемый размер. В противном случае Миграция Azure выбирает размер в зависимости от ближайшего совпадения в подписке Azure. В качестве альтернативы выберите размер вручную в разделе **Размер виртуальной машины Azure**. 
    - **Диск ОС**: Укажите загрузочный диск ОС для виртуальной машины. Диск ОС — это диск с загрузчиком операционной системы и установщиком. 
    - **Зона доступности.** Укажите зону доступности, которую необходимо использовать.
    - **Группа доступности**. Укажите группу доступности, которую необходимо использовать.

    > [!NOTE]
    > Если для наборов виртуальных машин нужно выбрать другой вариант доступности, перейдите к шагу 1 и повторите действия, задав другие параметры доступности после запуска репликации для одного набора виртуальных машин.


 ![Параметры вычисления виртуальной машины](./media/tutorial-migrate-vmware/compute-settings.png)

12. В разделе **Диски** укажите, следует ли реплицировать диски виртуальных машин в Azure, и выберите тип диска (SSD или HDD (цен. категория "Стандартный") или управляемые диски (цен. категория "Премиум")) в Azure. Затем нажмите кнопку **Далее**.
   
    ![Снимок экрана, на котором показана вкладка "Диски" диалогового окна "Репликация".](./media/tutorial-migrate-vmware/disks.png)

13. В разделе **Review and start replication** (Просмотр и запуск репликации) просмотрите параметры и нажмите кнопку **Реплицировать**, чтобы начать первоначальную репликацию серверов.

> [!NOTE]
> Вы можете изменить параметры репликации в любое время до начала репликации в разделе **Управление** > **Репликация компьютеров**. После начала репликации изменить параметры нельзя.

### <a name="provisioning-for-the-first-time"></a>Подготовка выполняется впервые

Если это первая виртуальная машина, которую вы реплицируете в проекте, средство переноса сервера автоматически подготавливает эти ресурсы в той же группе ресурсов, где расположен проект.

- **Служебная шина** Средство переноса сервера использует служебную шину для отправки на устройство сообщений оркестрации репликации.
- **Учетная запись хранения шлюза**. Миграция сервера использует учетную запись шлюза для хранения информации о состоянии реплицируемых виртуальных машин.
- **Учетная запись хранения журналов**. Устройство Миграции Azure загружает журналы репликации для виртуальных машин в учетную запись хранения журналов. Миграция Azure применяет сведения о репликации к управляемым дискам реплики.
- **Хранилище ключей**. Устройство Миграции Azure использует хранилище ключей для управления строками подключения для служебной шины и ключами доступа для учетных записей хранения, используемых при репликации.

## <a name="track-and-monitor"></a>Отслеживание и мониторинг

1. Состояние задания можно отслеживать в уведомлениях портала.
2. Отслеживайте состояние репликации, щелкнув элемент **Репликация серверов** в разделе **Azure Migrate: Server Migration** (Миграция Azure: миграция сервера).

     ![Мониторинг репликации](./media/tutorial-migrate-vmware/replicating-servers.png)

Репликация выполняется следующим образом:
- После успешного завершения задания "Запуск репликации" компьютеры начинают первоначальную репликацию в Azure.
- Во время начальной репликации создается снимок виртуальной машины. Дисковые данные из моментального снимка реплицируются в управляемые диски реплики в Azure.
- После завершения начальной репликации начинается разностная репликация. Добавочные изменения локальных дисков периодически реплицируются на диски реплики в Azure.

## <a name="run-a-test-migration"></a>Выполнение тестовой миграции


Когда начинается разностная репликация, вы можете запустить тестовую миграцию для виртуальных машин перед выполнением полной миграции в Azure. Мы настоятельно рекомендуем сделать это хотя бы один раз для каждой машины перед ее миграцией.

- Запуск тестовой миграции позволяет проверить, что миграция будет работать должным образом, не затрагивая локальные машины, которые остаются работоспособными и продолжают репликацию. 
- Тестовая миграция моделирует миграцию путем создания виртуальной машины Azure с использованием реплицированных данных (обычно выполняется миграция в нерабочую виртуальную сеть в вашей подписке Azure).
- Вы можете использовать реплицированную тестовую виртуальную машину Azure для проверки миграции, выполнения тестирования приложений и решения любых проблем перед полной миграцией.

Выполните тестовую миграцию следующим образом:


1. Последовательно выберите разделы **Цели миграции** > **Серверы** > **Azure Migrate: Server Migration** (Миграция Azure: миграция сервера) щелкните **Тестовая миграция серверов выполнена**.

     ![Тестовая миграция серверов](./media/tutorial-migrate-vmware/test-migrated-servers.png)

2. Щелкните правой кнопкой мыши виртуальную машину, чтобы выполнить тест, и выберите **Тестовая миграция**.

    ![Тестовая миграция](./media/tutorial-migrate-vmware/test-migrate.png)

3. В разделе **Тестовая миграция** выберите виртуальную сеть Azure, в которой будет находиться виртуальная машина Azure после миграции. Мы рекомендуем использовать нерабочую виртуальную сеть.
4. Запустится задание **Тестовая миграция**. Отслеживайте задание и уведомления на портале.
5. После завершения миграции просмотрите перенастроенную виртуальную машину Azure в разделе **Виртуальные машины** на портале Azure. Имя машины содержит суффикс **-Test**.
6. После завершения теста щелкните правой кнопкой мыши виртуальную машину Azure в разделе **Репликация компьютеров** и выберите **Очистка тестовой миграции**.

    ![Очистка миграции](./media/tutorial-migrate-vmware/clean-up.png)


## <a name="migrate-vms"></a>Перенос виртуальных машин

Убедившись, что тестовая миграция работает должным образом, вы можете выполнить миграцию локальных компьютеров.

1. В проекте "Миграция Azure" щелкните **Серверы** > **Azure Migrate: Server Migration** (Миграция Azure: миграция сервера) и выберите **Репликация серверов**.

    ![Репликация серверов](./media/tutorial-migrate-vmware/replicate-servers.png)

2. В области **Репликация компьютеров** щелкните правой кнопкой мыши виртуальную машину и выберите **Миграция**.
3. В разделе **Миграция** > **Shut down virtual machines and perform a planned migration with no data loss** (Завершить работу виртуальных машин и выполнить запланированную миграцию без потери данных?) выберите вариант **Да** > **ОК**.
    - По умолчанию Миграция Azure выключает локальную виртуальную машину и запускает репликацию по требованию для синхронизации любых изменений виртуальной машины, которые произошли с момента последней репликации. Это гарантирует отсутствие потери данных.
    - Если вы не хотите выключать виртуальную машину, выберите вариант **Нет**.
4. Запустится задание миграции виртуальной машины. Отслеживайте задание в уведомлениях Azure.
5. После завершения работы вы можете просматривать виртуальную машину и управлять ею на странице **Виртуальные машины**.

## <a name="complete-the-migration"></a>Выполнение миграции

1. После завершения миграции щелкните правой кнопкой мыши виртуальную машину и выберите **Stop Replication** (Остановка репликации). Это останавливает репликацию для локального компьютера и очищает информацию о состоянии репликации виртуальной машины.
2. Установите агент [Linux](../virtual-machines/extensions/agent-linux.md) виртуальных машин Azure на перенесенных компьютерах, если на них используется ОС Linux. Агент виртуальных машин автоматически устанавливается для виртуальных машин Windows во время миграции.
3. Выполните любые действия по настройке после миграции приложения, такие как обновление строк подключения к базе данных и конфигурация веб-сервера.
4. Выполните приемочное тестирование конечного приложения и миграции на перенесенном приложении, работающем в Azure.
5. Остановите трафик для перенесенного экземпляра виртуальной машины Azure.
6. Удалите локальные виртуальные машины из списка локальных виртуальных машин.
7. Удалите локальные виртуальные машины из локальных заданий резервного копирования.
8. Обновите внутренние документы и отразите в них новое расположение и IP-адреса виртуальных машин Azure. 

## <a name="post-migration-best-practices"></a>Рекомендации, выполняемые после миграции

- Для повышения устойчивости:
    - Обеспечьте безопасность данных путем резервного копирования виртуальных машин Azure с помощью службы Azure Backup. [Подробнее](../backup/quick-backup-vm-portal.md).
    - Обеспечьте непрерывную работу и постоянную доступность рабочих нагрузок за счет репликации виртуальных машин Azure в дополнительный регион с помощью Site Recovery. [Подробнее](../site-recovery/azure-to-azure-tutorial-enable-replication.md).
- Для повышения уровня безопасности:
    - Заблокируйте и ограничьте доступ входящего трафика с помощью [JIT-администрирования](../security-center/security-center-just-in-time.md) центра безопасности Azure.
    - Ограничьте сетевой трафик конечными точками с помощью [групп безопасности сети](../virtual-network/network-security-groups-overview.md).
    - Разверните [шифрование дисков Azure](../security/fundamentals/azure-disk-encryption-vms-vmss.md), чтобы обеспечить безопасность дисков и защитить данные от кражи и несанкционированного доступа.
    - Ознакомьтесь с дополнительными сведениями о [защите ресурсов IaaS](https://azure.microsoft.com/services/virtual-machines/secure-well-managed-iaas/) и посетите [центр безопасности Azure](https://azure.microsoft.com/services/security-center/).
- Для мониторинга и управления:
-  Рассмотрите возможность развертывания [службы "Управление затратами Azure"](../cost-management-billing/cloudyn/overview.md) для мониторинга использования ресурсов и затрат.


## <a name="next-steps"></a>Дальнейшие действия

Проанализируйте процесс [миграции в облако](/azure/architecture/cloud-adoption/getting-started/migrate) в Azure Cloud Adoption Framework.