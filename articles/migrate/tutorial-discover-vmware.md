---
title: Обнаружение серверов, работающих в среде VMware, с помощью средства оценки сервера службы "Миграция Azure"
description: Узнайте, как обнаружить локальные виртуальные машины VMware с помощью средства оценки сервера службы "Миграция Azure".
author: vikram1988
ms.author: vibansa
ms.manager: abhemraj
ms.topic: tutorial
ms.date: 9/14/2020
ms.custom: mvc
ms.openlocfilehash: 4d2b0fbb377beacdb75a1a5552855936bee2b205
ms.sourcegitcommit: f3ec73fb5f8de72fe483995bd4bbad9b74a9cc9f
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/04/2021
ms.locfileid: "102041317"
---
# <a name="tutorial-discover-servers-running-in-vmware-environment-with-azure-migrate-server-assessment"></a>Учебник по обнаружению серверов, работающих в среде VMware, с помощью средства оценки сервера службы "Миграция Azure"

В процессе переноса в Azure вы обнаружите локальные данные инвентаризации и рабочие нагрузки.

В этом учебнике показано, как обнаружить серверы, работающие в среде VMware, с помощью средства оценки сервера службы "Миграция Azure", используя упрощенное устройство этой службы. Устройство развертывается как сервер, работающий в vCenter Server, для непрерывного обнаружения серверов и метаданных их производительности, приложений, работающих на серверах, серверных зависимостей, а также экземпляров и баз данных SQL Server.

В этом руководстве описано следующее:

> [!div class="checklist"]
> * Настройка учетной записи Azure.
> * Подготовка среды VMware к обнаружению.
> * Создайте проект службы "Миграция Azure".
> * Настройка устройства службы "Миграция Azure".
> * Запуск непрерывного обнаружения.

> [!NOTE]
> В учебниках показан самый быстрый способ выполнения сценария и используются параметры по умолчанию, где это возможно.  

Если у вас еще нет подписки Azure, [создайте бесплатную учетную запись](https://azure.microsoft.com/pricing/free-trial/), прежде чем начинать работу.


## <a name="prerequisites"></a>Предварительные требования

Перед началом работы с этим учебником проверьте наличие необходимых компонентов.


**Требование** | **Сведения**
--- | ---
**vCenter Server или узел ESXi** | Вам потребуется сервер vCenter Server версии 5.5, 6.0, 6.5 или 6.7.<br/><br/> Серверы следует разместить на узле ESXi версии 5.5 или более поздней.<br/><br/> Разрешите входящие подключения через TCP-порт 443 в vCenter Server, чтобы с помощью модуля собирать данные о конфигурации и производительности.<br/><br/> По умолчанию устройство подключается к vCenter Server через порт 443. Если vCenter Server ожидает передачи данных через другой порт, вы сможете изменить порт при указании сведений о vCenter Server в диспетчере конфигурации устройства.<br/><br/> Убедитесь, что на узлах ESXi для TCP-порта 443 разрешен входящий доступ, который необходим для обнаружения установленных приложений и анализа зависимостей без агента на серверах.
**Устройство** | Чтобы выделить сервер для устройства службы "Миграция Azure", серверу vCenter Server понадобятся такие ресурсы:<br/><br/> — 32 ГБ ОЗУ, 8 виртуальных ЦП, 80 ГБ дискового пространства.<br/><br/> — Внешний виртуальный коммутатор и доступ к Интернету для сервера устройства (напрямую или через прокси-сервер).
**Серверы** | Поддерживаются все версии ОС Windows и Linux для обнаружения метаданных конфигурации и производительности. <br/><br/> Для обнаружения приложений на серверах поддерживаются все версии ОС Windows и Linux. [Здесь](migrate-support-matrix-vmware.md#dependency-analysis-requirements-agentless) можно узнать о версиях ОС, поддерживаемых для анализа зависимостей без агента.<br/><br/> Чтобы выполнить обнаружение установленных приложений и анализ зависимостей без агента, на серверах должны быть установлены и запущены средства VMware (более поздних версий, чем 10.2.0). Для серверов Windows требуется PowerShell версии 2.0 или более поздней.<br/><br/> Сведения о поддерживаемых версиях и выпусках SQL Server, поддерживаемых версиях ОС Windows и механизмах проверки подлинности для обнаружения экземпляров и баз данных SQL Server см. [здесь](migrate-support-matrix-vmware.md#requirements-for-discovery-of-sql-server-instances-and-databases).

> [!Note]
> Возможности обнаружения и оценки экземпляров и баз данных SQL Server, работающих в среде VMware, сейчас предоставляются в предварительной версии. Чтобы опробовать эту функцию, воспользуйтесь [**этой ссылкой**](https://aka.ms/AzureMigrate/SQL) для создания проекта в регионе **Восточная Австралия**. Если у вас уже есть проект в регионе "Восточная Австралия" и вы хотите опробовать эту функцию, убедитесь, что вы выполнили [**эти предварительные требования**](how-to-discover-sql-existing-project.md) на портале.

## <a name="prepare-an-azure-user-account"></a>Подготовка учетной записи пользователя Azure

Чтобы создать проект службы "Миграция Azure" и зарегистрировать устройство Миграции Azure, вам понадобится учетная запись с:
- разрешениями участника или владельца в подписке Azure;
- разрешениями на регистрацию приложений Azure Active Directory (AAD);
- разрешениями владельца или участника, а также разрешениями администратора доступа пользователей в подписке Azure для создания Key Vault, используемого во время миграции сервера без агента.

Если вы создали бесплатную учетную запись Azure, вы являетесь владельцем подписки. Если вы не являетесь владельцем подписки, назначьте разрешения совместно с владельцем следующим образом:

1. На портале Azure выполните поиск по фразе "подписки" и в разделе **Службы** выберите **Подписки**.

    :::image type="content" source="./media/tutorial-discover-vmware/search-subscription.png" alt-text="Поле для поиска подписки Azure":::


2. На странице **Подписки** выберите подписку, в которой нужно создать проект службы "Миграция Azure".
3. На странице подписок последовательно выберите **Управление доступом (IAM)**  > **Проверить доступ**.
4. В разделе **Проверка доступа** найдите соответствующую учетную запись пользователя.
5. В разделе **Добавление назначения роли** щелкните **Добавить**.
:::image type="content" source="./media/tutorial-discover-vmware/azure-account-access.png" alt-text="Поиск учетной записи пользователя для проверки доступа и назначения роли":::
    
6. В разделе **Добавление назначения роли** выберите роль "Участник" или "Владелец", а затем — учетную запись (в нашем примере — azmigrateuser). Затем нажмите кнопку **Сохранить**.

    :::image type="content" source="./media/tutorial-discover-vmware/assign-role.png" alt-text="Открытие страницы &quot;Добавить назначение ролей&quot; для назначения роли учетной записи":::

1. Чтобы зарегистрировать устройство, учетной записи Azure необходимы **разрешения на регистрацию приложений AAD**.
1. На портале Azure перейдите в раздел **Azure Active Directory** > **Пользователи** > **Параметры пользователей**.
1. В разделе **Параметры пользователя** проверьте, смогут ли пользователи Azure AD регистрировать приложения (по умолчанию задано значение **Да**).

    :::image type="content" source="./media/tutorial-discover-vmware/register-apps.png" alt-text="Проверка того, могут ли пользователи регистрировать приложения Active Directory в разделе &quot;Параметры пользователя&quot;":::

9. Если для параметра "Регистрация приложений" задано значение "Нет", попросите администратора арендатора или глобального администратора назначить необходимое разрешение. Кроме того, администратор арендатора или глобальный администратор могут назначить учетной записи роль **Разработчик приложений**, позволяющую регистрировать приложения AAD. [Подробнее](../active-directory/fundamentals/active-directory-users-assign-role-azure-portal.md).

## <a name="prepare-vmware"></a>Подготовка VMware

На сервере vCenter Server убедитесь, что у вашей учетной записи есть разрешения на создание виртуальной машины с использованием файла OVA. Это необходимо при развертывании устройства Миграции Azure в качестве виртуальной машины VMware с использованием файла OVA.

Для обнаружения и оценки серверов, работающих в среде VMware, службе "Миграция Azure" требуется учетная запись vCenter Server с доступом только для чтения. Если также требуется обнаружение установленных приложений и анализ зависимостей без агента, для учетной записи необходимо включить права в разделе **Virtual Machines > Guest Operations** (Виртуальные машины > Гостевые операции).

### <a name="create-an-account-to-access-vcenter"></a>Создание учетной записи для доступа к vCenter

Настройте учетную запись в веб-клиенте vSphere следующим образом:

1. Используя учетную запись с правами администратора, перейдите в веб-клиент vSphere и выберите **Администрирование**.
2. В разделе **Доступ** выберите **SSO Users and Groups** (Единый вход для пользователей и групп).
3. В разделе **Пользователи** добавьте нового пользователя.
4. В разделе **Новый пользователь** введите сведения об учетной записи. Нажмите кнопку **ОК**.
5. В разделе **Глобальные разрешения** выберите учетную запись пользователя и назначьте для нее роль **Только для чтения**. Нажмите кнопку **ОК**.
6.  Если также требуется обнаружение установленных приложений и анализ зависимостей без агента, перейдите к пункту **Roles** (Роли), выберите **Read-only** (Только для чтения) и в разделе **Privileges** (Привилегии) выберите **Guest Operations** (Гостевые операции). Вы можете распространить разрешения на все объекты в vCenter Server, установив флажок Propagate to children (Распространить на дочерние объекты).

    :::image type="content" source="./media/tutorial-discover-vmware/guest-operations.png" alt-text="Установка флажка, чтобы разрешить гостевые операции для роли &quot;Только для чтения&quot;":::


> [!NOTE]
> Можно ограничить обнаружение конкретными центрами обработки данных vCenter Server, кластерами, папкой кластеров, узлами, папкой узлов или отдельными серверами, указав учетную запись vCenter Server. [**См. дополнительные сведения**](set-discovery-scope.md) о том, как ограничить область действия учетной записи пользователя vCenter Server.


### <a name="create-an-account-to-access-servers"></a>Создание учетной записи для доступа к серверам

Для обнаружения установленных приложений, анализа зависимостей без агента и обнаружения экземпляров и баз данных SQL Server требуется учетная запись пользователя с необходимыми правами на серверах. Учетную запись пользователя можно указать в диспетчере конфигурации устройства. Устройство не устанавливает никакие агенты на серверах.

1. Для серверов Windows создайте учетную запись (локальную или доменную) с разрешениями администратора на них. Для обнаружения экземпляров и баз данных SQL Server необходимо, чтобы учетная запись Windows или SQL Server была членом роли сервера sysadmin. [См. дополнительные сведения](https://docs.microsoft.com/sql/relational-databases/security/authentication-access/server-level-roles) о назначении требуемой роли учетной записи пользователя.
2. Для серверов Linux создайте учетную запись с разрешениями уровня привилегированного пользователя. Или же вы можете создать учетную запись с такими разрешениями для файлов /bin/netstat и /bin/ls: CAP_DAC_READ_SEARCH и CAP_SYS_PTRACE.

> [!NOTE]
> Теперь можно добавить несколько учетных данных сервера в диспетчер конфигурации для обнаружения установленных приложений, анализа зависимостей без агента и обнаружения экземпляров и баз данных SQL Server. Вы можете добавить несколько наборов учетных данных для проверки подлинности в домене, в Windows (без домена) или Linux (без домена) и (или) на сервере SQL Server. [**Подробнее**](add-server-credentials.md)

## <a name="set-up-a-project"></a>Настройка проекта

Настройте новый проект службы "Миграция Azure".

1. На портал Azure выберите **Все службы** и найдите службу **Миграция Azure**.
2. В разделе **Службы** выберите **Миграция Azure**.
3. В разделе **Обзор** выберите **Создать проект**.
5. В разделе **Создать проект** выберите подписку Azure и группу ресурсов. Если у вас еще нет группы ресурсов, создайте ее.
6. В разделе **Сведения о проекте** укажите имя проекта и регион для создания проекта. Просмотрите список поддерживаемых регионов для [общедоступного](migrate-support-matrix.md#supported-geographies-public-cloud) облака и облака для [государственных организаций](migrate-support-matrix.md#supported-geographies-azure-government).

    :::image type="content" source="./media/tutorial-discover-vmware/new-project.png" alt-text="Поля для имени и региона проекта":::

7. Нажмите кнопку **создания**.
8. Развертывание проекта службы "Миграция Azure" может занять несколько минут. **Инструмент оценки сервера службы "Миграция Azure"** добавляется по умолчанию в новый проект.

> [!NOTE]
> Если вы уже создали проект, вы можете использовать его же для регистрации дополнительных устройств, чтобы обнаружить и оценить больше серверов.[**Дополнительные сведения**](create-manage-projects.md#find-a-project)

## <a name="set-up-the-appliance"></a>Настройка устройства

Миграция Azure Средство "Оценка сервера" использует упрощенное устройство Миграции Azure. Устройство выполняет обнаружение серверов и отправляет метаданные об их конфигурации и производительности в службу "Миграция Azure". Устройство можно настроить путем развертывания шаблона OVA, который можно скачать из проекта.

> [!NOTE]
> Если по какой-либо причине вы не можете настроить устройство с помощью шаблона, настройте его с помощью скрипта PowerShell на существующем сервере Windows Server 2016. [**См. дополнительные сведения**](deploy-appliance-script.md#set-up-the-appliance-for-vmware).

### <a name="deploy-with-ova"></a>Развертывание с помощью OVA

Чтобы настроить устройство с помощью шаблона OVA, сделайте следующее:
1. Укажите имя устройства и создайте ключ проекта службы"Миграция Azure" на портале.
1. Скачайте файл шаблона OVA и импортируйте его в vCenter Server. Убедитесь в защищенности OVA.
1. Создайте виртуальную машину устройства из OVA-файла и убедитесь, что оно может подключиться к службе "Миграция Azure".
1. Настройте устройство в первый раз и зарегистрируйте его в проекте с помощью ключа проекта службы "Миграция Azure".

### <a name="1-generate-the-azure-migrate-project-key"></a>1. Создание ключа проекта службы "Миграция Azure"

1. Последовательно выберите разделы **Цели миграции** > **Серверы** > **Azure Migrate: оценка серверов** и щелкните **Обнаружить**.
2. В разделе **Обнаружение компьютеров** > **Ваши компьютеры виртуализированы?** щелкните **Да, с использованием VMware vSphere Hypervisor**.
3. В разделе **1. Создание ключа проекта Миграции Azure** укажите имя модуля службы "Миграция Azure", которое вы настроите для обнаружения серверов в среде VMware. Это имя должно состоять из букв и цифр (не более 14 символов).
1. Щелкните **Создать ключ**, чтобы начать создание необходимых ресурсов Azure. Не закрывайте страницу "Обнаружение" во время создания ресурсов.
1. После успешного создания ресурсов Azure будет создан **ключ проекта службы "Миграция Azure"** .
1. Скопируйте этот ключ, так как он понадобится вам для завершения регистрации модуля во время его настройки.

### <a name="2-download-the-ova-template"></a>2. Скачивание шаблона OVA

В разделе **2: Download Azure Migrate appliance** (2. Скачивание виртуального модуля службы "Миграция Azure") выберите OVA-файл и щелкните **Загрузка**.

### <a name="verify-security"></a>Проверка безопасности

Прежде чем развертывать OVA-файл, убедитесь, что он не поврежден.

1. На сервере, где скачан файл, откройте командное окно с правами администратора.
2. Выполните следующую команду, чтобы создать хэш OVA-файла.
  
   ```C:\>CertUtil -HashFile <file_location> [Hashing Algorithm]```
   
   Пример использования: ```C:\>CertUtil -HashFile C:\Users\Administrator\Desktop\MicrosoftAzureMigration.ova SHA256```

3. Проверьте последние версии и хэш-значения устройств:

    - Для общедоступного облака Azure:
    
        **Алгоритм** | **Загрузить** | **SHA256**
        --- | --- | ---
        VMware (11,9 ГБ) | [Последняя версия](https://go.microsoft.com/fwlink/?linkid=2140333) | e9c9a1fe4f3ebae81008328e8f3a7933d78ff835ecd871d1b17f367621ce3c74

    - Для Azure для государственных организаций:
    
        **Алгоритм** | **Загрузить** | **SHA256**
        --- | --- | ---
        VMware (85,8 МБ) | [Последняя версия](https://go.microsoft.com/fwlink/?linkid=2140337) | 2daaa2a59302bf911e8ef195f8add7d7c8352de77a9af0b860e2a627979085ca

### <a name="3-create-the-appliance-server"></a>3. Создание сервера устройства

Импорт скачанного файла и создание сервера в среде VMware

1. В консоли клиента vSphere щелкните **File** (Файл)  > **Deploy OVF Template** (Развернуть шаблон OVF).
2. В мастере развертывания шаблона OVF выберите **Source** (Источник) и укажите расположение OVA-файла.
3. В полях **Name** (Имя) и **Location** (Расположение) укажите понятное имя для сервера. Выберите объект инвентаризации, в котором будет размещен этот сервер.
5. В поле **Host/Cluster** (Узел или кластер) укажите узел или кластер, в котором будет работать сервер.
6. В поле **Storage** (Хранилище) укажите место хранения данных сервера.
7. В поле **Disk Format** (Формат диска) укажите тип и размер диска.
8. В поле **Network Mapping** (Сетевое сопоставление) укажите сеть, к которой будет подключен сервер. Этой сети требуется подключение к Интернету для отправки метаданных в службу "Миграция Azure".
9. Просмотрите и подтвердите параметры, а затем нажмите кнопку **Finish** (Готово).


### <a name="verify-appliance-access-to-azure"></a>Проверка доступа устройства к Azure

Убедитесь, что сервер устройства может подключиться к URL-адресам Azure для [общедоступного](migrate-appliance.md#public-cloud-urls) облака и облака для [государственных организаций](migrate-appliance.md#government-cloud-urls).


### <a name="4-configure-the-appliance"></a>4. Настройка устройства

Настройте устройство в первый раз.

> [!NOTE]
> Если вы настраиваете устройство с помощью [**скрипта PowerShell**](deploy-appliance-script.md), а не загруженного шаблона OVA, первые два этапа этой процедуры выполнять не нужно.

1. В консоли клиента vSphere щелкните правой кнопкой мыши сервер и выберите **Open Console** (Открыть консоль).
2. Укажите язык, часовой пояс и пароль для устройства.
3. Откройте браузер на любом компьютере, который может подключиться к серверу устройства, и откройте URL-адрес диспетчера конфигурации устройства: `https://appliance name or IP address: 44368`.

   Кроме того, диспетчер конфигурации можно открыть с рабочего стола сервера устройства, выбрав его ярлык.
1. Примите **условия лицензии** и прочитайте информацию от сторонних производителей.
1. В диспетчере конфигурации выберите **Set up prerequisites** (Настройка необходимых компонентов) и выполните следующее.
   - **Возможность подключения**. Устройство проверит наличие доступа к Интернету у сервера. Если на сервере используется прокси-сервер:
     - Щелкните **Настройка прокси-сервера**, чтобы указать адрес прокси-сервера `http://ProxyIPAddress` или `http://ProxyFQDN` и порт прослушивания.
     - Укажите учетные данные, если для прокси-сервера требуется аутентификация.
     - Поддерживается только прокси-сервер HTTP.
     - Если вы добавили сведения о прокси-сервере или отключили его и (или) проверку подлинности, щелкните **Сохранить**, чтобы снова запустить проверку подключения.
   - **Синхронизация времени**: Время на устройстве должно быть синхронизировано со временем в Интернете, чтобы обнаружение виртуальных машин работало правильно.
   - **Установка обновлений**: Устройство обеспечивает установку последних обновлений. После завершения проверки вы можете щелкнуть пункт **View appliance services** (Просмотр служб модуля), чтобы просмотреть состояние и версии служб, используемых на сервере устройства.
   - **Установка VDDK**. Устройство проверяет, установлен ли пакет VMware vSphere Virtual Disk Development Kit (VDDK). Если он не установлен, скачайте VDDK 6.7 из VMware и извлеките скачанное содержимое ZIP-файла в указанное расположение в виртуальном модуле, как указано в **инструкциях по установке**.

     Средство миграции серверов службы "Миграция Azure" использует VDDK для репликации серверов во время миграции на Azure. 
1. При необходимости вы можете **повторить проверку предварительных требований** в любой момент во время настройки модуля, чтобы проверить, соответствует ли виртуальный модуль всем предварительным требованиям.

    :::image type="content" source="./media/tutorial-discover-vmware/appliance-prerequisites.png" alt-text="Панель 1 в диспетчере конфигурации устройства":::


### <a name="register-the-appliance-with-azure-migrate"></a>Регистрация устройства с помощью службы "Миграция Azure"

1. Вставьте **ключ проекта службы "Миграция Azure"** , скопированный с портала. Если у вас нет ключа, последовательно выберите **Server Assessment > Discover > Manage existing appliances** (Оценка сервера > Обнаружение > Управление имеющимися модулями), выберите имя модуля, указанное вами во время создания ключа, и скопируйте соответствующий ключ.
1. Вам потребуется код устройства для аутентификации в Azure. Если щелкнуть **Вход**, откроется модальное окно с кодом устройства, как показано ниже.

    :::image type="content" source="./media/tutorial-discover-vmware/device-code.png" alt-text="Модальное окно с кодом устройства":::

1. Щелкните **Копировать код и войти**, чтобы скопировать код устройства и открыть окно входа в Azure в новой вкладке браузера. Если этот параметр не отображается, убедитесь, что в браузере отключена блокировка всплывающих окон.
1. В новой вкладке вставьте код устройства выполните вход, используя имя пользователя и пароль Azure.
   
   Вход с помощью PIN-кода не поддерживается.
3. Если вы случайно закроете вкладку входа, не выполнив вход, вам потребуется обновить вкладку браузера в диспетчере конфигурации устройства, чтобы снова активировать кнопку "Вход".
1. После успешного входа вернитесь на предыдущую вкладку с помощью диспетчера конфигурации устройства.
1. Если учетная запись пользователя Azure, используемая для ведения журнала, имеет необходимые разрешения на ресурсы Azure, созданные во время создания ключа, будет инициирована регистрация модуля.
1. После регистрации модуля вы можете просмотреть сведения о регистрации, щелкнув **Просмотреть подробности**.

    :::image type="content" source="./media/tutorial-discover-vmware/appliance-registration.png" alt-text="Панель 2 в диспетчере конфигурации устройства":::

## <a name="start-continuous-discovery"></a>Запуск непрерывного обнаружения

### <a name="provide-vcenter-server-details"></a>Предоставление сведений о vCenter Server

Устройство должно подключиться к vCenter Server для обнаружения конфигурации и данных о производительности серверов.

1. В разделе **Step 1: Provide vCenter Server credentials** (Шаг 1. Предоставление учетных данных vCenter Server) щелкните **Добавить учетные данные**, чтобы указать понятное имя для учетных данных, добавьте значения для пунктов **Имя пользователя** и **Пароль** для учетной записи vCenter Server, которую виртуальный модуль будет использовать для обнаружения серверов в vCenter Server.
    - Вам потребуется учетная запись с необходимыми разрешениями, настроенная, как описано выше в этой статье.
    - Чтобы включить в область обнаружения только определенные объекты VMware (центры обработки данных vCenter Server, кластеры, папку кластеров, узлы, папку узлов или отдельные виртуальные машины), ознакомьтесь с [этой статьей](set-discovery-scope.md), в которой приведены инструкции по применению ограничений для используемой службой "Миграция Azure" учетной записи.
1. В разделе **Step 2: Provide vCenter Server details** (Шаг 2. Предоставление сведений о vCenter Server) щелкните **Add discovery source** (Добавить источник обнаружения), чтобы выбрать из раскрывающегося списка понятное имя учетных данных, и укажите **IP-адрес или полное доменное имя** vCenter Server. Вы можете оставить для пункта **Порт** значение по умолчанию (443) или указать пользовательский порт, на котором vCenter Server ожидает передачу данных, и щелкнуть **Сохранить**.
1. При нажатии кнопки **Сохранить** устройство попытается проверить подключение к vCenter Server с указанными учетными данными и отобразит **состояние проверки** в таблице для каждого IP-адреса или полного доменного имени vCenter Server.
1. Вы можете **повторно проверить** подключение к vCenter Server в любое время перед началом обнаружения.

    :::image type="content" source="./media/tutorial-discover-vmware/appliance-manage-sources.png" alt-text="Панель 3 в диспетчере конфигурации устройства для ввода сведений о vCenter Server":::

### <a name="provide-server-credentials"></a>Ввод учетных данных сервера

В разделе **Step 3: Provide server credentials to perform software inventory, agentless dependency analysis and discovery of SQL Server instances and databases** (Шаг 3. Предоставление учетных данных сервера для выполнения инвентаризации программного обеспечения, анализ зависимостей без агента и обнаружение экземпляров и баз данных SQL Server) можно указать несколько учетных данных сервера. Если вы не хотите использовать эти функции, можно пропустить данный шаг и продолжить обнаружение vCenter Server. Вы можете изменить свое намерение в любое время.

:::image type="content" source="./media/tutorial-discover-vmware/appliance-server-credentials-mapping.png" alt-text="Панель 3 в диспетчере конфигурации устройства для ввода сведений о сервере":::

> [!Note]
> Возможности обнаружения и оценки экземпляров и баз данных SQL Server, работающих в среде VMware, сейчас предоставляются в предварительной версии. Чтобы опробовать эту функцию, воспользуйтесь [**этой ссылкой**](https://aka.ms/AzureMigrate/SQL) для создания проекта в регионе **Восточная Австралия**. Если у вас уже есть проект в регионе "Восточная Австралия" и вы хотите опробовать эту функцию, убедитесь, что вы выполнили [**эти предварительные требования**](how-to-discover-sql-existing-project.md) на портале.

Если вы хотите использовать эти функции, можно указать учетные данные сервера, выполнив следующие действия. Устройство попытается автоматически сопоставить учетные данные с серверами для выполнения функций обнаружения.

- Чтобы добавить учетные данные сервера, нажмите кнопку **Добавить учетные данные**. Откроется модальное окно, в котором из раскрывающегося списка можно выбрать **тип учетных данных**.
- Вы можете указать учетные данные для проверки подлинности в домене, в Windows (без домена) или Linux (без домена) и (или) на сервере SQL Server. [Узнайте больше](add-server-credentials.md) о том, как указать учетные данные и как мы их обрабатываем.
- Для каждого типа учетных данных необходимо указать понятное имя учетных данных, добавить **имя пользователя** и **пароль** и нажать кнопку **Сохранить**.
- При выборе учетных данных домена необходимо также указать полное доменное имя для домена. Полное доменное имя требуется для проверки подлинности учетных данных в службе Active Directory этого домена.
- Проверьте [необходимые разрешения](add-server-credentials.md#required-permissions) для учетной записи для обнаружения установленных приложений, анализа зависимостей без агента или обнаружения экземпляров и баз данных SQL Server.
- Если вы хотите добавить несколько учетных данных одновременно, щелкните **Добавить еще**, чтобы сохранить и добавить дополнительные учетные данные.
- При нажатии кнопки **Сохранить** или **Добавить еще** устройство проверяет учетные данные домена на предмет подлинности Active Directory домена. Это делается во избежание блокировки учетных записей, когда устройство выполняет несколько итераций для соотнесения учетных данных с соответствующими серверами.
- **Состояние проверки** для всех учетных данных домена можно просмотреть в таблице учетных данных. Будут проверены только учетные данные домена.
- Если проверка завершается неудачно, можно щелкнуть состояние **Сбой**, чтобы просмотреть обнаруженную ошибку, и выбрать команду **Revalidate credentials** (Проверить учетные данные повторно) после устранения проблемы, чтобы снова проверить учетные данные домена, которые привели к сбою.


### <a name="start-discovery"></a>Начать обнаружение

1. Щелкните **Начать обнаружение**, чтобы запустить обнаружение vCenter Server. После успешного запуска обнаружения вы можете проверить состояние обнаружения для IP-адреса или полного доменного имени vCenter Server в таблице источников.
1. Если вы указали учетные данные сервера, инвентаризация программного обеспечения (обнаружение установленных приложений) будет инициирована автоматически после завершения обнаружения vCenter Server. Инвентаризация программного обеспечения выполняется каждые 12 часов.
1. [Инвентаризация программного обеспечения](how-to-discover-applications.md) позволяет определить экземпляры SQL Server, выполняемые на серверах и использующие сведения. Устройство пытается подключиться к экземплярам, используя указанные на нем учетные данные Windows или SQL Server для проверки подлинности, и собрать данные о базах данных SQL Server и их свойствах. Обнаружение SQL выполняется каждые 24 часа.
1. Во время инвентаризации программного обеспечения добавленные учетные данные сервера будут поочередно передаваться по серверам и проверяться путем анализа зависимостей без агента. Вы можете включить анализ зависимостей без агента для серверов с портала. Для включения анализа зависимостей без агента можно выбрать только серверы, на которых успешно выполнена проверка.

> [!Note]
>Служба "Миграция Azure" шифрует обмен данными между экземплярами устройства службы "Миграция Azure" и исходными экземплярами SQL Server (для свойства "Шифровать соединение" установлено значение TRUE). Если соединения зашифрованы с помощью [**TrustServerCertificate**](https://docs.microsoft.com/dotnet/api/system.data.sqlclient.sqlconnectionstringbuilder.trustservercertificate) (установлено значение TRUE), то транспортный уровень будет использовать протокол SSL для шифрования канала и не пойдет по цепочке сертификатов для проверки доверия. Для сервера устройства необходимо настроить [**доверие корневому центру сертификата**](https://docs.microsoft.com/sql/database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine).<br/>
Если сертификат не был предоставлен на сервере при запуске, SQL Server создает самозаверяющий сертификат, который используется для шифрования пакетов входа. [**См. дополнительные сведения**](https://docs.microsoft.com/sql/database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine).

Обнаружение выполняется следующим образом:
- Чтобы метаданные инвентаризации обнаруженных серверов отобразились на портале, потребуется около 15 минут.
- Обнаружение установленных приложений может занять какое-то время, которое зависит от числа обнаруженных серверов. Для отображения данных инвентаризации при обнаружении 500 серверов на портале службы "Миграция Azure" потребуется примерно один час.
- После завершения обнаружения серверов вы можете включить на портале анализ зависимостей без агента на серверах.
- Данные экземпляров SQL Server и баз данных будут отображаться на портале в течение 24 часов с начала операции обнаружения.

## <a name="next-steps"></a>Дальнейшие действия

- [Оцените готовность серверов](./tutorial-assess-vmware-azure-vm.md) к переносу на виртуальные машины Azure.
- [Оцените готовность серверов SQL Server](./tutorial-assess-sql.md) к переносу в Azure SQL.
- [Просмотрите данные](migrate-appliance.md#collected-data---vmware), собранные устройством во время обнаружения.