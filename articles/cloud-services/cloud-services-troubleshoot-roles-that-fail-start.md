---
title: Устранение неполадок, если роли не запускаются | Документация Майкрософт
description: Здесь описаны самые распространенные причины, по которым роль облачной службы может не запуститься. Приведены также решения этих проблем.
ms.topic: article
ms.service: cloud-services
ms.date: 10/14/2020
ms.author: tagore
author: tanmaygore
ms.reviewer: mimckitt
ms.custom: ''
ms.openlocfilehash: 2453fa2d9b4e78b60d4922e09347799266a84cff
ms.sourcegitcommit: 910a1a38711966cb171050db245fc3b22abc8c5f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "98743225"
---
# <a name="troubleshoot-azure-cloud-service-classic-roles-that-fail-to-start"></a>Устранение неполадок с ролями облачной службы Azure (классической), которые не удается запустить

> [!IMPORTANT]
> [Облачные службы Azure (Расширенная поддержка)](../cloud-services-extended-support/overview.md) — это новая модель развертывания на основе Azure Resource Manager для продукта облачных служб Azure.После этого изменения облачные службы Azure, работающие в модели развертывания на основе Service Manager Azure, были переименованы как облачные службы (классические), и все новые развертывания должны использовать [облачные службы (Расширенная поддержка)](../cloud-services-extended-support/overview.md).

Ниже приведены некоторые распространенные проблемы и решения на случай, если роли облачной службы Azure не запускаются.

[!INCLUDE [support-disclaimer](../../includes/support-disclaimer.md)]

## <a name="missing-dlls-or-dependencies"></a>Отсутствующие DLL-библиотеки и зависимости
Если роли не отвечают или циклически переключаются между состояниями **Инициализация**, **Занято** и **Остановка**, это может быть вызвано отсутствием сборок или библиотек DLL.

Симптомы отсутствия сборок и библиотек DLL могут быть такими:

* Экземпляр роли циклически переключается между состояниями **Инициализация**, **Занято** и **Остановка**.
* экземпляр роли перешел в состояние **Готово** , но при переходе к веб-приложению страница не отображается.

Эти проблемы можно решить несколькими способами.

## <a name="diagnose-missing-dll-issues-in-a-web-role"></a>Диагностика неполадок в связи с отсутствующими библиотеками DLL в веб-роли
Когда вы переходите на веб-сайт, развернутый в веб-роли, в браузере отображается похожее сообщение об ошибке сервера, которое может указывать на то, что библиотека DLL отсутствует:

![Ошибка сервера в приложении «/».](./media/cloud-services-troubleshoot-roles-that-fail-start/ic503388.png)

## <a name="diagnose-issues-by-turning-off-custom-errors"></a>Диагностика проблем с помощью отключения режима настраиваемых ошибок
Для полного отображения ошибки настройте файл web.config для веб-роли, чтобы отключить режим настраиваемых ошибок, и повторно разверните службу.

Чтобы просмотреть ошибки полностью без использования удаленного рабочего стола, выполните следующие действия.

1. Откройте решение в Microsoft Visual Studio.
2. В **обозревателе решений** найдите файл web.config и откройте его.
3. В файле web.config найдите раздел system.web и добавьте следующую строку:

    ```xml
    <customErrors mode="Off" />
    ```
4. Сохраните файл.
5. Перепакуйте и повторно разверните службу.

Когда служба будет повторно развернута, ниже отобразится сообщение об ошибке, содержащее имя отсутствующей сборки или библиотеки DLL.

## <a name="diagnose-issues-by-viewing-the-error-remotely"></a>Диагностика проблем с помощью удаленного изучения ошибок
Чтобы получить удаленный доступ к роли и просмотреть информацию об ошибках полностью, вы можете использовать удаленный рабочий стол. Чтобы просмотреть ошибки с помощью удаленного рабочего стола, сделайте следующее:

1. Убедитесь, что установлен пакет SDK для Azure версии 1.3 или более поздней.
2. Во время развертывания решения с помощью Visual Studio включите подключения к удаленному рабочему столу. Дополнительные сведения см. в статье [Enable Remote Desktop Connection for a Role in Azure Cloud Services using Visual Studio](cloud-services-role-enable-remote-desktop-visual-studio.md) (Включение подключения к удаленному рабочему столу для роли в облачных службах Azure с помощью Visual Studio).
3. Когда для экземпляра отобразится состояние **Готово**, установите удаленное подключение к экземпляру на портале Microsoft Azure. Дополнительные сведения об использовании удаленного рабочего стола с облачными службами см. в статье об [удаленном подключении к экземплярам ролей](cloud-services-role-enable-remote-desktop-new-portal.md#remote-into-role-instances).
5. Войдите в виртуальную машину, используя учетные данные, указанные во время настройки удаленного рабочего стола.
6. Откройте окно командной строки.
7. Введите `IPconfig`.
8. Запомните IPV4-адрес.
9. Откройте обозреватель Internet Explorer.
10. Введите адрес и имя веб-приложения. Например, `http://<IPV4 Address>/default.aspx`.

Если перейти на веб-сайт, отобразятся более точные сообщения об ошибках.

* Ошибка сервера в приложении «/».
* Описание: произошло необработанное исключение во время выполнения текущего веб-запроса. Чтобы получить дополнительную информацию об ошибке и ее источнике в коде, изучите трассировку стека.
* Сведения об исключении: System.IO.FIleNotFoundException: не удалось загрузить файл, сборку Microsoft.WindowsAzure.StorageClient, Version=1.1.0.0, Culture=neutral, PublicKeyToken=31bf856ad364e35 или какую-то их зависимость. Системе не удается найти указанный файл.

Пример:

![Явная ошибка сервера в приложении «/».](./media/cloud-services-troubleshoot-roles-that-fail-start/ic503389.png)

## <a name="diagnose-issues-by-using-the-compute-emulator"></a>Диагностика неполадок с помощью эмулятора вычислений
Можно использовать эмулятор вычислений Microsoft Azure для диагностики и устранения проблем с отсутствующими зависимостями и web.config ошибками.

Чтобы улучшить результаты использования этого метода диагностики, следует использовать компьютер или виртуальную машину, на которой выполнена чистая установка Windows. Чтобы лучше имитировать среду Azure, следует использовать 64-разрядную версию Windows Server 2008 R2.

1. Установите изолированную версию пакета [SDK Azure](https://azure.microsoft.com/downloads/).
2. На компьютере разработки создайте проект облачной службы.
3. В проводнике перейдите к папке bin\debug проекта облачной службы.
4. Скопируйте папку CSX и CSCFG-файл на компьютер, который вы используете для устранения проблем.
5. На чистой машине откройте окно командной строки пакета SDK для Azure и введите `csrun.exe /devstore:start`.
6. В командной строке введите `run csrun <path to .csx folder> <path to .cscfg file> /launchBrowser`.
7. Когда роль запускается, в браузере Internet Explorer отображается подробная информация об ошибке. Для более подробной диагностики вы можете использовать также стандартные средства устранения неполадок Windows.

## <a name="diagnose-issues-by-using-intellitrace"></a>Диагностика неполадок с помощью IntelliTrace
Для рабочих ролей и веб-ролей, которые используют платформу .NET Framework 4, можно использовать функцию [EnterpriseIntelliTrace](/visualstudio/debugger/intellitrace), доступную в Microsoft Visual Studio Enterprise.

Чтобы развернуть службу с активной функцией IntelliTrace, выполните следующие действия.

1. Убедитесь, что установлен пакет SDK для Azure версии 1.3 или более поздней.
2. Разверните решение с помощью Visual Studio. Во время развертывания установите флажок **Включить IntelliTrace для ролей .NET 4** .
3. После запуска экземпляра откройте **обозреватель серверов**.
4. Разверните узел **Azure\\Облачные службы** и найдите развертывание.
5. Разверните развертывание и найдите в нем экземпляры роли. Щелкните правой кнопкой мыши один из экземпляров.
6. Выберите пункт **Просмотреть журналы IntelliTrace**. Откроется окно **Сводка IntelliTrace**.
7. Найдите в сводке раздел исключений. При наличии исключений он будет называться **Данные исключения**.
8. Разверните **Данные исключения** и найдите ошибки **System.IO.FileNotFoundException**, подобные следующей:

![Данные исключения, отсутствующий файл или сборка](./media/cloud-services-troubleshoot-roles-that-fail-start/ic503390.png)

## <a name="address-missing-dlls-and-assemblies"></a>Устранение ошибок из-за отсутствующих библиотек DLL и сборок
Чтобы устранить ошибки отсутствующих библиотек DLL и сборок, выполните следующие действия.

1. Откройте решение в Visual Studio.
2. В **обозревателе решений** откройте папку **Ссылки**.
3. Щелкните сборку, указанную в сообщении об ошибке.
4. На панели **Свойства** найдите свойство **Copy Local** и задайте для него значение **True**.
5. Повторно разверните облачную службу.

Убедившись, что все ошибки исправлены, вы можете развернуть службу, не устанавливая флажок **Включить IntelliTrace для ролей .NET 4** .

## <a name="next-steps"></a>Дальнейшие действия
Просмотрите дополнительные [статьи об устранении неполадок](../index.yml?product=cloud-services&tag=top-support-issue) в облачных службах.

Чтобы узнать, как устранять неполадки ролей облачной службы с помощью диагностических данных компьютеров Azure PaaS, см. [серию статей в блоге Кевина Уильямсона](/archive/blogs/kwill/windows-azure-paas-compute-diagnostics-data).
