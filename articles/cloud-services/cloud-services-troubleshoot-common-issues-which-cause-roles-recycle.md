---
title: Распространенные причины перезапуска ролей в облачной службе (классическая модель) | Документация Майкрософт
description: Внезапный перезапуск роли облачной службы может привести к длительному простою. Ниже приведены некоторые распространенные проблемы, вызывающие перезапуск ролей. Эти сведения могут помочь сократить время простоя.
ms.topic: article
ms.service: cloud-services
ms.date: 10/14/2020
ms.author: tagore
author: tanmaygore
ms.reviewer: mimckitt
ms.custom: ''
ms.openlocfilehash: 9610b32207f8367b9415c0881e49b54e24c49ad7
ms.sourcegitcommit: 6272bc01d8bdb833d43c56375bab1841a9c380a5
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/23/2021
ms.locfileid: "98741168"
---
# <a name="common-issues-that-cause-azure-cloud-service-classic-roles-to-recycle"></a>Распространенные проблемы, приводящие к перезапуску ролей облачной службы Azure (классическая модель)

> [!IMPORTANT]
> [Облачные службы Azure (Расширенная поддержка)](../cloud-services-extended-support/overview.md) — это новая модель развертывания на основе Azure Resource Manager для продукта облачных служб Azure.После этого изменения облачные службы Azure, работающие в модели развертывания на основе Service Manager Azure, были переименованы как облачные службы (классические), и все новые развертывания должны использовать [облачные службы (Расширенная поддержка)](../cloud-services-extended-support/overview.md).

В этой статье рассматриваются некоторые распространенные причины проблем с развертыванием, а также советы по их устранению. На наличие проблем с приложением указывает то, что экземпляр роли не запускается или циклически переключается между состояниями "Инициализация", "Занято" и "Остановлено".

[!INCLUDE [support-disclaimer](../../includes/support-disclaimer.md)]

## <a name="missing-runtime-dependencies"></a>Отсутствующие зависимости среды выполнения
Если роль в приложении использует какую-либо сборку, которая не является частью управляемой библиотеки Azure или платформы .NET Framework, необходимо явно включить эту сборку в пакет приложения. Имейте в виду, что другие платформы Майкрософт недоступны в Azure по умолчанию. Если ваша роль использует такую платформу, необходимо добавить эти сборки в пакет приложения.

Перед сборкой и упаковкой приложения проверьте следующее.

* При работе в Visual Studio убедитесь, что свойство **Копировать локально** имеет значение **True** для каждой упоминаемой в проекте сборки, которая не является частью пакета SDK для Azure или платформы .NET Framework.
* Убедитесь, что файл web.config не ссылается на любые неиспользуемые сборки в элементе compilation.
* Параметр **Действие при сборке** для каждого CSHTML-файла имеет значение **Содержимое**. Это обеспечивает правильное отображение файлов в пакете, а также позволяет указать в этом пакете другие файлы, на которые есть ссылки.

## <a name="assembly-targets-wrong-platform"></a>Сборка нацелена на неверную платформу.
Azure является 64-разрядной средой. Таким образом, сборки .NET, скомпилированные для 32-разрядной среды, не будут работать в Azure.

## <a name="role-throws-unhandled-exceptions-while-initializing-or-stopping"></a>Роль вызывает необработанные исключения во время инициализации или остановки.
Любые исключения, выдаваемые методами класса [RoleEntryPoint], к которым относятся [OnStart], [OnStop], и [Run], являются необработанными. В случае возникновения необработанного исключения в одном из этих методов роль будет перезапущена. Если роль постоянно перезапускается, возможно, она вызывает необработанное исключение при каждой попытке запуска.

## <a name="role-returns-from-run-method"></a>Роль возвращается из метода Run.
Метод [Run] должен работать постоянно. Если ваш код переопределяет метод [Run] , он должен постоянно находиться в режиме ожидания. В случае возврата метода [Run] роль перезапускается.

## <a name="incorrect-diagnosticsconnectionstring-setting"></a>Неверный параметр DiagnosticsConnectionString
Если приложение использует систему диагностики Azure, то в CSCFG-файле необходимо указать параметр конфигурации `DiagnosticsConnectionString` . Этот параметр должен указывать HTTPS-подключение к вашей учетной записи хранения в Azure.

Чтобы убедиться в правильности параметра `DiagnosticsConnectionString` перед развертыванием пакета приложения в Azure, проверьте следующее.  

* Параметр `DiagnosticsConnectionString` указывает на действительную учетную запись хранения в Azure.  
  По умолчанию этот параметр указывает на эмулированную учетную запись хранения, поэтому необходимо явным образом изменить его перед развертыванием пакета приложения. Если этого не сделать, то при попытке экземпляра роли запустить монитор диагностики возникает исключение. Это может вызвать бесконечный перезапуск экземпляра роли.
* Строку подключения следует указывать в определенном [формате](../storage/common/storage-configure-connection-string.md). (Протокол должен быть указан как HTTPS.) Замените *MyAccountName* именем вашей учетной записи хранения, а *MyAccountKey* — ключом доступа:    

```console
DefaultEndpointsProtocol=https;AccountName=MyAccountName;AccountKey=MyAccountKey
```

  Если вы разрабатываете приложение с помощью инструментов Azure для Microsoft Visual Studio, чтобы задать это значение, можно использовать страницы свойств.

## <a name="exported-certificate-does-not-include-private-key"></a>Экспортированный сертификат не содержит закрытый ключ.
Чтобы запустить веб-роль с помощью TLS, необходимо убедиться, что экспортированный сертификат управления включает закрытый ключ. При использовании *диспетчера сертификатов Windows* для экспорта сертификата обязательно выберите **Да** в качестве значения параметра **Экспорт закрытого ключа**. Сертификат следует экспортировать в формате PFX, так как в настоящее время поддерживается только он.

## <a name="next-steps"></a>Следующие шаги
Просмотрите дополнительные [статьи об устранении неполадок](../index.yml?product=cloud-services&tag=top-support-issue) в облачных службах.

Дополнительные сценарии перезапуска ролей см. в [серии статей в блоге Кевина Уильямсона](/archive/blogs/kwill/windows-azure-paas-compute-diagnostics-data).

[RoleEntryPoint]: /previous-versions/azure/reference/ee758619(v=azure.100)
[OnStart]: /previous-versions/azure/reference/ee772851(v=azure.100)
[OnStop]: /previous-versions/azure/reference/ee772844(v=azure.100)
[Выполнить]: /previous-versions/azure/reference/ee772746(v=azure.100)