---
title: Устранение неполадок ФабриЦинтерналсервереррор или Сервицеаллокатионфаилуре при развертывании облачной службы (классической) в Azure | Документация Майкрософт
description: В этой статье показано, как разрешить исключение ФабриЦинтерналсервереррор или Сервицеаллокатионфаилуре при развертывании облачной службы (классической) в Azure.
services: cloud-services
author: mibufo
ms.author: v-mibufo
ms.service: cloud-services
ms.topic: troubleshooting
ms.date: 02/22/2021
ms.openlocfilehash: 0a4111f569b751ace80a2a886ed2ce7e4968ce16
ms.sourcegitcommit: c27a20b278f2ac758447418ea4c8c61e27927d6a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/03/2021
ms.locfileid: "101746756"
---
# <a name="troubleshoot-fabricinternalservererror-or-serviceallocationfailure-when-deploying-a-cloud-service-classic-to-azure"></a>Устранение неполадок ФабриЦинтерналсервереррор или Сервицеаллокатионфаилуре при развертывании облачной службы (классической) в Azure

В этой статье вы узнаете об устранении ошибок выделения, когда контроллер структуры не может выделить ресурсы при развертывании облачной службы Azure (классическая модель).

При развертывании экземпляров в облачной службе или добавлении новых экземпляров веб-узлов или рабочих ролей Microsoft Azure выделяет вычислительные ресурсы.

Иногда при выполнении этих операций могут возникать ошибки даже до достижения лимита подписки Azure.

> [!TIP]
> Эта информация также может быть полезна при планировании развертывания служб.

## <a name="symptom"></a>Симптом

В портал Azure перейдите к облачной службе (классическая) и в боковой панели выберите *Журнал операций (классическая модель)* , чтобы просмотреть журналы.

![На рисунке показана колонка журнал операций (классическая).](./media/cloud-services-troubleshoot-fabric-internal-server-error/cloud-services-troubleshoot-allocation-logs.png)

При проверке журналов облачной службы (классическая модель) вы увидите следующее исключение:

|Исключение  |Сообщение об ошибке  |
|---------|---------|
фабриЦинтерналсервереррор     |Сбой операции с кодом ошибки "Интерналеррор" и errorMessage "сервер обнаружил внутреннюю ошибку. Повторите запрос. ".|
|сервицеаллокатионфаилуре     |Сбой операции с кодом ошибки "Интерналеррор" и errorMessage "сервер обнаружил внутреннюю ошибку. Повторите запрос. ".|

## <a name="cause"></a>Причина

*ФабриЦинтерналсервереррор* и *сервицеаллокатионфаилуре* — это исключения, которые могут возникать, когда контроллеру структуры не удается выделить экземпляры в кластере. Основная причина зависит от того, **закреплена** или **не закреплена** облачная служба.

- [**Не закреплено:** Сбои при первом развертывании новой облачной службы](#not-pinned-to-a-cluster)
- [**Закреплено:** Сбои из существующих облачных служб](#pinned-to-a-cluster)

> [!NOTE]
> При развертывании первого экземпляра в облачной службе (в промежуточной или рабочей среде) Эта облачная служба закрепляется в кластере.
>
> Со временем ресурсы в этом пуле ресурсов могут быть полностью использованы. Если облачная служба выполняет запрос на выделение дополнительных ресурсов, если в закрепленном пуле ресурсов нет достаточного количества ресурсов, запрос приведет к [сбою выделения](cloud-services-allocation-failures.md).

## <a name="solution"></a>Решение

Следуйте указаниям по ошибкам выделения в следующих сценариях.

### <a name="not-pinned-to-a-cluster"></a>Не закреплено в кластере

При первом развертывании облачной службы (классической) кластер еще не выбран, поэтому облачная служба не *закреплена*. Возможно, в Azure произошел сбой развертывания по следующим причинам:

- Вы выбрали определенный размер, который недоступен в регионе.
- Сочетание размеров, необходимых для разных ролей, недоступно в регионе.

При возникновении ошибки выделения в этом сценарии рекомендуется проверить доступные размеры в регионе и изменить указанный ранее размер.

1. Размеры, доступные в регионе, можно узнать на странице " [облачная служба" (классическая модель) продуктов](https://azure.microsoft.com/global-infrastructure/services/?products=cloud-services) .

    > [!NOTE]
    > На странице *продукты* не отображается доступная емкость. Для любого нового выделения Azure должна иметь возможность выбрать оптимальный кластер в вашем регионе на этот момент времени.

1. Обновите файл определения службы для облачной службы (классическая модель), чтобы указать другой [Размер продукта](cloud-services-sizes-specs.md#configure-sizes-for-cloud-services) в вашем регионе.

### <a name="pinned-to-a-cluster"></a>Закреплено в кластере

Существующие облачные службы *закреплены* в кластере. Все дальнейшие развертывания облачной службы (классическая модель) будут выполняться в том же кластере.

При возникновении ошибки выделения памяти в этом сценарии рекомендуется выполнить повторное развертывание в новой облачной службе (классической) (и обновить *запись CNAME*).

> [!TIP]
> Это решение, как правило, является самым удачным, поскольку позволяет платформе выбрать все кластеры в соответствующем регионе.

> [!NOTE]
> В этом случае время простоя должно быть нулевым.

1. Разверните рабочую нагрузку в новой облачной службе (классическая модель).
    - Дополнительные инструкции см. в разделе [Создание и развертывание (классическая) руководства по облачным службам](cloud-services-how-to-create-deploy-portal.md) .

    > [!WARNING]
    > Если вы не хотите терять IP-адрес, связанный с этим слотом развертывания, можно использовать [решение 3 — сохранить IP-адрес](cloud-services-allocation-failures.md#solutions).

1. Обновите запись *CNAME* или *A* , чтобы она указывала на трафик в новую облачную службу (классическая модель).
    - Дополнительные инструкции см. в разделе [Настройка пользовательского доменного имени для облачной службы Azure (классическая модель)](cloud-services-custom-domain-name-portal.md#understand-cname-and-a-records) .

1. После перехода на старый сайт нулевого трафика можно удалить старую облачную службу (классическая).
    - Дополнительные инструкции см. в разделе [Удаление развертываний и в классическом виде облачной службы (классическая модель)](cloud-services-how-to-manage-portal.md#delete-deployments-and-a-cloud-service) .
    - Чтобы просмотреть сетевой трафик в облачной службе (классическая модель), см. статью [Общие сведения о мониторинге облачной службы (классическая модель)](cloud-services-how-to-monitor.md).

См. раздел [Устранение неполадок выделения облачной службы (классическая модель) | Документация Майкрософт](cloud-services-allocation-failures.md#common-issues) для дальнейших действий по исправлению.

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения об ошибках при выделении и фундаментальной информации:

> [!div class="nextstepaction"]
> [Сбои при выделении — облачная служба (классическая)](cloud-services-allocation-failures.md)

Если проблема с Azure не устранена в этой статье, посетите форумы Azure в [MSDN и Stack overflow](https://azure.microsoft.com/support/forums/). Описание своей проблемы можно опубликовать на этих форумах или [в Twitter (@AzureSupport)](https://twitter.com/AzureSupport). Также можно отправить запрос в службу поддержки Azure. Чтобы отправить такой запрос, на странице [поддержки Azure](https://azure.microsoft.com/support/options/) щелкните *Получить поддержку*.
