---
title: Хранение и просмотр диагностических данных в службе хранилища Azure
description: Узнайте, как организовать сбор данных диагностики Azure в учетной записи хранения Azure, чтобы их можно было просматривать с помощью одного из нескольких доступных средств.
services: azure-monitor
author: bwren
ms.service: azure-monitor
ms.topic: conceptual
ms.date: 08/01/2016
ms.author: bwren
ms.subservice: diagnostic-extension
ms.openlocfilehash: 4962d5f048cf41eca50a77a0dedad3cef48ac1f0
ms.sourcegitcommit: 910a1a38711966cb171050db245fc3b22abc8c5f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "98740080"
---
# <a name="store-and-view-diagnostic-data-in-azure-storage"></a>Хранение и просмотр диагностических данных в службе хранилища Azure

> [!IMPORTANT]
> [Облачные службы Azure (Расширенная поддержка)](../cloud-services-extended-support/overview.md) — это новая модель развертывания на основе Azure Resource Manager для продукта облачных служб Azure.После этого изменения облачные службы Azure, работающие в модели развертывания на основе Service Manager Azure, были переименованы как облачные службы (классические), и все новые развертывания должны использовать [облачные службы (Расширенная поддержка)](../cloud-services-extended-support/overview.md).

Диагностические данные хранятся без возможности восстановления, если они не переносятся в эмулятор хранения Microsoft Azure или в службу хранилища Azure. Поместив данные в хранилище, вы можете просматривать их с помощью одного из нескольких доступных средств.

## <a name="specify-a-storage-account"></a>Определение учетной записи хранения
Укажите учетную запись хранения, которая будет использоваться, в файле ServiceConfiguration.cscfg. Сведения об учетной записи определяются в виде строки подключения в параметре конфигурации. В следующем примере приведена строка подключения по умолчанию, созданная для нового проекта облачной службы в Visual Studio.

```
    <ConfigurationSettings>
       <Setting name="Microsoft.WindowsAzure.Plugins.Diagnostics.ConnectionString" value="UseDevelopmentStorage=true" />
    </ConfigurationSettings>
```

Эту строку подключения можно изменить, чтобы указать сведения об учетной записи для учетной записи хранения Azure.

В зависимости от типа собираемых диагностических данных система диагностики Azure использует службу BLOB-объектов или службу таблиц. В следующей таблице приведены сохраняемые источники данных и их формат.

| Источник данных | Формат хранения |
| --- | --- |
| Журналы Azure |Таблица |
| Журналы IIS 7.0 |BLOB-объект |
| Журналы инфраструктуры системы диагностики Azure |Таблица |
| Журналы трассировки невыполненных запросов |BLOB-объект |
| Журналы событий Windows |Таблица |
| Счетчики производительности |Таблица |
| Аварийные дампы |BLOB-объект |
| Пользовательские журналы ошибок |BLOB-объект |

## <a name="transfer-diagnostic-data"></a>Передача диагностических данных
При использовании пакета SDK 2.5 и более поздних версий запрос на передачу диагностических данных можно создавать с помощью файла конфигурации. Диагностические данные могут передаваться через запланированные промежутки времени, заданные в конфигурации.

При использовании пакета SDK 2.4 и предыдущих версий запрос на передачу диагностических данных можно выполнить с помощью файла конфигурации или программным образом. Программный подход позволяет передавать данные по требованию.

> [!IMPORTANT]
> При передаче диагностических данных в учетную запись хранения Azure с вас взимается плата за используемые этими данными ресурсы хранилища.
> 
> 

## <a name="store-diagnostic-data"></a>Хранение диагностических данных
Данные журнала хранятся в хранилище BLOB-объектов или в табличном хранилище со следующими именами.

**Таблицы**

* **WadLogsTable** : включенные в код журналы с данными прослушивателя трассировки.
* **WADDiagnosticInfrastructureLogsTable** : сведения об изменениях конфигурации и монитора диагностики.
* **WADDirectoriesTable** : сведения о каталогах, которые отслеживает монитор диагностики.  Сюда входят журналы IIS, журналы неудачно завершенных запросов IIS и пользовательские папки.  Расположение файла журнала BLOB-объекта указано в поле Container, а имя большого двоичного объекта — в поле RelativePath.  В поле AbsolutePath указано расположение и имя файла на виртуальной машине Azure.
* **WADPerformanceCountersTable** : данные счетчиков производительности.
* **WADWindowsEventLogsTable** : журналы событий Windows.

**BLOB-объекты**

* **wad-control-container** : содержит XML-файлы конфигурации, управляющие диагностикой Azure (только для пакета SDK 2.4 и предыдущих версий).
* **wad-iis-failedreqlogfiles** — содержит сведения от журналов ошибочных запросов IIS.
* **wad-iis-logfiles** — содержит сведения о журналах IIS.
* **custom** : пользовательский контейнер на основе каталогов конфигурации, которые отслеживаются монитором диагностики.  Имя этого контейнера BLOB-объектов указывается в элементе WADDirectoriesTable.

## <a name="tools-to-view-diagnostic-data"></a>Средства для просмотра диагностических данных
Данные после их передачи в хранилище можно просмотреть с помощью нескольких средств. Пример:

* Обозреватель сервера в Visual Studio. Если установлены инструменты Azure для Microsoft Visual Studio, можно использовать узел хранилища Azure в обозревателе сервера для просмотра больших двоичных объектов, доступных только для чтения, и табличных данных из учетных записей хранения Azure. Вы можете отображать данные из своей локальной учетной записи эмулятора хранения, а также из учетных записей хранения, созданных для Azure. Дополнительные сведения см. в статье [Обзор ресурсов хранилища с помощью обозревателя сервера и управление ими](/visualstudio/azure/vs-azure-tools-storage-resources-server-explorer-browse-manage).
* [Обозреватель службы хранилища Microsoft Azure](../vs-azure-tools-storage-manage-with-storage-explorer.md) — это автономное приложение, которое упрощает работу с данными из службы хранилища Azure на платформе Windows, OSX и Linux.
* [Azure Management Studio](https://www.cerebrata.com/products/azure-management-studio/introduction) содержит диспетчер диагностики Azure, который позволяет просматривать и скачивать данные диагностики, которые собирают выполняемые в Azure приложения, а также управлять этими данными.

## <a name="next-steps"></a>Дальнейшие действия
[Трассировка потока в приложении облачных служб с помощью системы диагностики Azure](../cloud-services/cloud-services-dotnet-diagnostics-trace-flow.md)


