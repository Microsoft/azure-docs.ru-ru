---
title: Структура и синтаксис шаблона
description: Описывает структуру и свойства шаблонов Azure Resource Manager (шаблоны ARM) с помощью декларативного синтаксиса JSON.
ms.topic: conceptual
ms.date: 03/03/2021
ms.openlocfilehash: da64eb8abeaf45f58933dfbddaf954cad8e66f4a
ms.sourcegitcommit: 867cb1b7a1f3a1f0b427282c648d411d0ca4f81f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/20/2021
ms.locfileid: "102120422"
---
# <a name="understand-the-structure-and-syntax-of-arm-templates"></a>Описание структуры и синтаксиса шаблонов ARM

В этой статье описывается структура шаблона Azure Resource Manager (шаблон ARM). Статья содержит информацию о разных разделах шаблона и свойствах, которые доступны в этих разделах.

Эта статья предназначена для пользователей, знакомых с шаблонами ARM. Он предоставляет подробные сведения о структуре шаблона. Пошаговые инструкции по созданию шаблона см. в статье [Учебник. Создание и развертывание первого шаблона ARM](template-tutorial-create-first-template.md). Чтобы узнать больше о шаблонах Resource Manager из модулей Microsoft Learn, см. статью [Развертывание ресурсов и управление ими в Azure с помощью шаблонов Resoure Manager](/learn/paths/deploy-manage-resource-manager-templates/).

## <a name="template-format"></a>Формат шаблона

Шаблон с самой простой структурой содержит следующие элементы:

```json
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "",
  "apiProfile": "",
  "parameters": {  },
  "variables": {  },
  "functions": [  ],
  "resources": [  ],
  "outputs": {  }
}
```

| Имя элемента | Обязательно | Описание |
|:--- |:--- |:--- |
| $schema |Да |Расположение файла схемы нотация объектов JavaScript (JSON), описывающего версию языка шаблона. Номер используемой вами версии зависит от области развертывания и вашего редактора JSON.<br><br>Если вы используете [Visual Studio Code с расширением Azure Resource Manager Tools](quickstart-create-templates-use-visual-studio-code.md), используйте последнюю версию для развертывания группы ресурсов:<br>`https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#`<br><br>Другие редакторы (включая Visual Studio), возможно, не смогут обработать эту схему. Для этих редакторов используйте:<br>`https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#`<br><br>Для развертываний подписки используйте:<br>`https://schema.management.azure.com/schemas/2018-05-01/subscriptionDeploymentTemplate.json#`<br><br>Для развертываний группы управления используйте:<br>`https://schema.management.azure.com/schemas/2019-08-01/managementGroupDeploymentTemplate.json#`<br><br>Для развертываний клиента используйте:<br>`https://schema.management.azure.com/schemas/2019-08-01/tenantDeploymentTemplate.json#` |
| contentVersion |Да |Версия шаблона (например, 1.0.0.0). Для этого элемента можно предоставить любое значение. Это значение позволяет задокументировать важные изменения в шаблоне. При развертывании ресурсов с помощью шаблона это значение позволяет убедиться в том, что используется нужный шаблон. |
| апипрофиле |Нет | Версия API, которая служит коллекцией версий API для типов ресурсов. Используйте это значение, чтобы не указывать версии API для каждого ресурса в шаблоне. Если указана версия профиля API и не указана версия API для типа ресурса, диспетчер ресурсов использует версию API для этого типа ресурсов, который определен в профиле.<br><br>Свойство профиля API особенно полезно при развертывании шаблона в различных средах, таких как Azure Stack и глобальные Azure. Используйте версию профиля API, чтобы убедиться, что шаблон автоматически использует версии, поддерживаемые в обеих средах. Список текущих версий профиля API и версий API ресурсов, определенных в профиле, см. в разделе [профиль API](https://github.com/Azure/azure-rest-api-specs/tree/master/profile).<br><br>Дополнительные сведения см. в статье [Tracking Versions using API Profiles](templates-cloud-consistency.md#track-versions-using-api-profiles). |
| [parameters](#parameters) |Нет |Значения, которые предоставляются при выполнении развертывания для настройки развертывания ресурсов. |
| [variables](#variables) |Нет |Значения, используемые в виде фрагментов JSON в шаблоне для упрощения выражений на языке шаблона. |
| [функции](#functions) |Нет |Определяемые пользователем функции, доступные в шаблоне. |
| [источников](#resources) |Да |Типы ресурсов, которые развертываются или обновляются в группе ресурсов или подписке. |
| [outputs](#outputs) |Нет |Значения, возвращаемые после развертывания. |

Каждый элемент содержит свойства, которые можно задать. В этой статье подробнее описаны разделы шаблона.

## <a name="parameters"></a>Параметры

В `parameters` разделе шаблона укажите, какие значения можно ввести при развертывании ресурсов. В шаблоне может быть не более 256 параметров. Количество параметров можно уменьшить с помощью объектов, содержащих несколько свойств.

Доступные свойства для параметра

```json
"parameters": {
  "<parameter-name>" : {
    "type" : "<type-of-parameter-value>",
    "defaultValue": "<default-value-of-parameter>",
    "allowedValues": [ "<array-of-allowed-values>" ],
    "minValue": <minimum-value-for-int>,
    "maxValue": <maximum-value-for-int>,
    "minLength": <minimum-length-for-string-or-array>,
    "maxLength": <maximum-length-for-string-or-array-parameters>,
    "metadata": {
      "description": "<description-of-the parameter>"
    }
  }
}
```

| Имя элемента | Обязательно | Описание |
|:--- |:--- |:--- |
| имя параметра |Да |Имя параметра. Должно быть допустимым идентификатором JavaScript. |
| тип |Да |Тип значения параметра. Допустимые типы и значения: **string**, **securestring**, **int**, **bool**, **object**, **secureObject** и **array**. См. раздел [типы данных в шаблонах ARM](data-types.md). |
| defaultValue |Нет |Значение параметра, используемое по умолчанию, если пользователь не задал иное значение. |
| allowedValues |Нет |Массив допустимых значений параметра, по которому сверяются правильные значения. |
| minValue |Нет |Минимальное значение для параметров типа int. Это включающее значение. |
| maxValue |Нет |Максимальное значение для параметров типа int. Это включающее значение. |
| minLength |Нет |Минимальная длина (включительно) параметров типа string, secure string и array. |
| maxLength |Нет |Максимальная длина (включительно) параметров типа string, secure string и array. |
| description; |Нет |Описание параметра, отображаемого для пользователей на портале. Дополнительные сведения см. в разделе [комментариев в шаблонах](#comments). |

Примеры использования параметров см. [в разделе Параметры в шаблонах ARM](template-parameters.md).

## <a name="variables"></a>Переменные

В `variables` разделе вы можете создавать значения, которые можно использовать в шаблоне. Переменные определять не обязательно, однако они часто упрощают шаблон, снижая число сложных выражений. Формат каждой переменной соответствует одному из [типов данных](data-types.md).

В следующем примере показаны доступные параметры для определения переменной.

```json
"variables": {
  "<variable-name>": "<variable-value>",
  "<variable-name>": {
    <variable-complex-type-value>
  },
  "<variable-object-name>": {
    "copy": [
      {
        "name": "<name-of-array-property>",
        "count": <number-of-iterations>,
        "input": <object-or-value-to-repeat>
      }
    ]
  },
  "copy": [
    {
      "name": "<variable-array-name>",
      "count": <number-of-iterations>,
      "input": <object-or-value-to-repeat>
    }
  ]
}
```

Сведения об использовании `copy` для создания нескольких значений для переменной см. в разделе [Переменная iteration](copy-variables.md).

Примеры использования переменных см. [в разделе переменные в шаблоне ARM](template-variables.md).

## <a name="functions"></a>Функции

В шаблоне можно создать свои собственные функции. Эти функции доступны для использования в шаблоне. Как правило, вы определяете сложные выражения, которые не должны повторяться на протяжении всего шаблона. Создаются определяемые пользователем функции на основе выражений и [функции](template-functions.md), которые поддерживаются в шаблонах.

При определении пользовательской функции есть несколько ограничений:

* Функция не может обращаться к переменным.
* Функция может использовать только параметры, определенные в самой функции. При использовании [функции Parameters](template-functions-deployment.md#parameters) в определяемой пользователем функции вы можете использовать только параметры этой функции.
* Функция не может вызывать другие функции, определяемые пользователем.
* Для функции нельзя использовать [ссылочную функцию](template-functions-resource.md#reference).
* Для параметров этой функции нельзя задавать значения по умолчанию.

```json
"functions": [
  {
    "namespace": "<namespace-for-functions>",
    "members": {
      "<function-name>": {
        "parameters": [
          {
            "name": "<parameter-name>",
            "type": "<type-of-parameter-value>"
          }
        ],
        "output": {
          "type": "<type-of-output-value>",
          "value": "<function-return-value>"
        }
      }
    }
  }
],
```

| Имя элемента | Обязательно | Описание |
|:--- |:--- |:--- |
| namespace |Да |Пространство имен для пользовательских функций. Используйте, чтобы избежать конфликтов имен с функциями шаблонов. |
| имя функции |Да |Имя пользовательской функции. При вызове функции объедините имя функции с пространством имен. Например, чтобы вызвать функцию с именем `uniqueName` в пространстве имен contoso, используйте `"[contoso.uniqueName()]"` . |
| имя параметра |Нет |Имя параметра, который будет использоваться в пользовательской функции. |
| параметр-значение |Нет |Тип значения параметра. Допустимые типы и значения: **string**, **securestring**, **int**, **bool**, **object**, **secureObject** и **array**. |
| Тип выходных данных |Да |Тип выходного значения. Выходные значения поддерживают те же типы, что и входные параметры функции. |
| Выходное значение |Да |Выражение языка шаблона, которое вычисляется и возвращается из функции. |

Примеры использования пользовательских функций см. [в разделе определяемые пользователем функции в шаблоне ARM](template-user-defined-functions.md).

## <a name="resources"></a>Ресурсы

В `resources` разделе определяются развернутые или обновленные ресурсы.

Ресурсы определяются с помощью следующей структуры:

```json
"resources": [
  {
      "condition": "<true-to-deploy-this-resource>",
      "type": "<resource-provider-namespace/resource-type-name>",
      "apiVersion": "<api-version-of-resource>",
      "name": "<name-of-the-resource>",
      "comments": "<your-reference-notes>",
      "location": "<location-of-resource>",
      "dependsOn": [
          "<array-of-related-resource-names>"
      ],
      "tags": {
          "<tag-name1>": "<tag-value1>",
          "<tag-name2>": "<tag-value2>"
      },
      "sku": {
          "name": "<sku-name>",
          "tier": "<sku-tier>",
          "size": "<sku-size>",
          "family": "<sku-family>",
          "capacity": <sku-capacity>
      },
      "kind": "<type-of-resource>",
      "copy": {
          "name": "<name-of-copy-loop>",
          "count": <number-of-iterations>,
          "mode": "<serial-or-parallel>",
          "batchSize": <number-to-deploy-serially>
      },
      "plan": {
          "name": "<plan-name>",
          "promotionCode": "<plan-promotion-code>",
          "publisher": "<plan-publisher>",
          "product": "<plan-product>",
          "version": "<plan-version>"
      },
      "properties": {
          "<settings-for-the-resource>",
          "copy": [
              {
                  "name": ,
                  "count": ,
                  "input": {}
              }
          ]
      },
      "resources": [
          "<array-of-child-resources>"
      ]
  }
]
```

| Имя элемента | Обязательно | Описание |
|:--- |:--- |:--- |
| condition | Нет | Логическое значение, указывающее, будет ли подготавливаться ресурс во время этого развертывания. Если установлено значение `true`, при развертывании создается ресурс. Если установлено значение `false`, при развертывании ресурс не создается. См. [условие](conditional-resource-deployment.md). |
| тип |Да |Тип ресурса. Это значение представляет собой сочетание пространства имен поставщика ресурсов и типа ресурса (например, `Microsoft.Storage/storageAccounts` ). Чтобы определить доступные значения, см. раздел [Справочник по шаблону](/azure/templates/). Для дочернего ресурса формат типа зависит от того, является ли он вложенным в родительский ресурс или определен за пределами родительского ресурса. См. о [настройке имени и типа дочернего ресурса](child-resource-name-type.md). |
| версия_API |Да |Версия REST API, которая будет использована для создания ресурса. При создании нового шаблона задайте для этого параметра последнюю версию развертываемого ресурса. Если шаблон работает по мере необходимости, используйте ту же версию API. Продолжая использовать ту же версию API, вы уменьшаете риск того, что новая версия API изменит принципы работы шаблона. Обновите версию API, только если вы хотите использовать новую функцию, представленную в более поздней версии. Чтобы определить доступные значения, см. раздел [Справочник по шаблону](/azure/templates/). |
| name |Да |Имя ресурса. Имя должно соответствовать ограничениям компонентов URI, определенным в RFC3986. Службы Azure, предоставляющие имя ресурса внешним сторонам, проверяют имя, чтобы убедиться, что это не попытка подмены другого удостоверения. Для дочернего ресурса формат имени зависит от того, является ли он вложенным в родительский ресурс или определен за пределами родительского ресурса. См. о [настройке имени и типа дочернего ресурса](child-resource-name-type.md). |
| comments |Нет |Заметки по ресурсам в шаблоне. Дополнительные сведения см. в разделе [комментариев в шаблонах](template-syntax.md#comments). |
| location |Различается |Поддерживаемые географические расположения указанного ресурса. Вы можете выбрать любое из доступных расположений. Но обычно имеет смысл выбрать расположение, которое находится недалеко от пользователей. Кроме того, целесообразно разместить взаимодействующие ресурсы в одном регионе. Большинству типов ресурсов нужно расположение, но некоторым типам (например, назначению роли) оно не требуется. См. раздел [Задание расположения ресурса](resource-location.md). |
| Свойство dependsOn |Нет |Ресурсы, которые должны быть развернуты перед развертыванием этого ресурса. Resource Manager оценивает зависимости между ресурсами и развертывает эти ресурсы в правильном порядке. Если ресурсы не зависят друг от друга, они развертываются параллельно. Значение может представлять собой разделенный запятыми список имен ресурсов или уникальных идентификаторов ресурсов. Выводится только список ресурсов, развертываемых в этом шаблоне. Ресурсы, которые не определены в этом шаблоне, уже должны существовать. Избегайте добавления ненужных зависимостей, так как это может замедлить развертывание и привести к созданию циклических зависимостей. Рекомендации по настройке зависимостей см. [в разделе Определение порядка развертывания ресурсов в шаблонах ARM](define-resource-dependency.md). |
| tags |Нет |Теги, связанные с ресурсом. Примените теги, чтобы логически организовать ресурсы в подписке. |
| sku | нет | В некоторых ресурсах допускается использовать значения, определяющие номер SKU для развертывания. Например, можно указать тип избыточности для учетной записи хранения. |
| kind | Нет | В некоторых ресурсах допускается использовать значение, которое определяет тип развертываемого ресурса. Например, можно указать в качестве типа создаваемой базы данных Cosmos DB. |
| copy |Нет |Количество создаваемых ресурсов (если нужно несколько экземпляров). Параллельный режим используется по умолчанию. Используйте последовательный режим, если вы не хотите развертывать все ресурсы одновременно. Дополнительные сведения см. в статье [Создание нескольких экземпляров ресурсов в Azure Resource Manager](copy-resources.md). |
| План | Нет | В некоторых ресурсах допускается использовать значения, определяющие номер плана для развертывания. Например, можно указать образ Marketplace для виртуальной машины. |
| properties |Нет |Параметры конфигурации ресурса. Значения свойств совпадают со значениями, указываемыми в тексте запроса для операции REST API (метод PUT) для создания ресурса. Кроме того, можно указать массив copy для создания нескольких экземпляров свойства. Чтобы определить доступные значения, см. раздел [Справочник по шаблону](/azure/templates/). |
| ресурсов |нет |Дочерние ресурсы, которые зависят от определяемого ресурса. Следует указать только те типы ресурсов, которые разрешены в схеме родительского ресурса. Зависимость от родительского ресурса не подразумевается. Ее необходимо определить явным образом. См. о [настройке имени и типа дочернего ресурса](child-resource-name-type.md). |

## <a name="outputs"></a>Выходные данные

В `outputs` разделе указываются значения, возвращаемые из развертывания. Как правило, значения возвращаются из ресурсов, которые были развернуты.

В следующем примере показана структура определения выходных данных:

```json
"outputs": {
  "<output-name>": {
    "condition": "<boolean-value-whether-to-output-value>",
    "type": "<type-of-output-value>",
    "value": "<output-value-expression>",
    "copy": {
      "count": <number-of-iterations>,
      "input": <values-for-the-variable>
    }
  }
}
```

| Имя элемента | Обязательно | Описание |
|:--- |:--- |:--- |
| Имя выходных данных |Да |Имя выходного значения. Должно быть допустимым идентификатором JavaScript. |
| condition |Нет | Логическое значение, которое указывает, возвращается ли выходное значение. Если установлено значение `true`, то при развертывании значение является частью выходных данных. Если установлено значение `false`, при развертывании выходное значение не создается. Когда не задано, по умолчанию используется значение `true`. |
| тип |Да |Тип выходного значения. Выходные значения поддерживает те же типы, что и входные параметры шаблона. Если для типа выходных данных указано значение **SecureString** , оно не отображается в журнале развертывания и не может быть извлечено из другого шаблона. Чтобы использовать значение секрета в нескольких шаблонах, сохраните секрет в Key Vault и сослаться на секрет в файле параметров. Дополнительные сведения см. в статье [Использование Azure Key Vault для передачи защищенного значения параметра во время развертывания](key-vault-parameter.md). |
| value |Нет |Выражение на языке шаблона, которое вычисляется и возвращается в качестве выходного значения. Укажите либо **значение** , либо **копирование**. |
| copy |Нет | Используется для возвращения более одного значения для выходных данных. Укажите **значение** или **скопируйте**. Дополнительные сведения см. [в разделе итерация выходных данных в шаблонах ARM](copy-outputs.md). |

Примеры использования выходных данных см. [в разделе выходные данные в шаблоне ARM](template-outputs.md).

<a id="comments"></a>

## <a name="comments-and-metadata"></a>Комментарии и метаданные

Есть несколько вариантов добавления комментариев и метаданных к шаблону.

### <a name="comments"></a>Комментарии

Для встроенных комментариев можно использовать либо, `//` `/* ... */` но этот синтаксис не работает со всеми инструментами. Если вы добавляете этот стиль комментариев, убедитесь, что используемые инструменты поддерживают встроенные комментарии JSON.

> [!NOTE]
> Чтобы развернуть шаблоны с комментариями с помощью Azure CLI с версией 2.3.0 или более ранней, необходимо использовать `--handle-extended-json-format` параметр.

```json
{
  "type": "Microsoft.Compute/virtualMachines",
  "apiVersion": "2018-10-01",
  "name": "[variables('vmName')]", // to customize name, change it in variables
  "location": "[parameters('location')]", //defaults to resource group location
  "dependsOn": [ /* storage account and network interface must be deployed first */
    "[resourceId('Microsoft.Storage/storageAccounts/', variables('storageAccountName'))]",
    "[resourceId('Microsoft.Network/networkInterfaces/', variables('nicName'))]"
  ],
```

В Visual Studio Code [расширение средств Azure Resource Manager](quickstart-create-templates-use-visual-studio-code.md) может автоматически ОБНАРУЖИТЬ шаблон ARM и изменить языковой режим. Если вы видите **Azure Resource Manager шаблон** в правом нижнем углу Visual Studio Code, можно использовать встроенные комментарии. В таком случае встроенные комментарии больше не будут помечены как недопустимые.

![Visual Studio Code режим шаблона Azure Resource Manager](./media/template-syntax/resource-manager-template-editor-mode.png)

### <a name="metadata"></a>Метаданные

Вы можете добавить объект `metadata` практически в любом месте шаблона. Resource Manager игнорирует объект, но ваш редактор JSON может предупредить вас, что свойство недопустимо. Определите необходимые свойства в объекте.

```json
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "metadata": {
    "comments": "This template was developed for demonstration purposes.",
    "author": "Example Name"
  },
```

Для `parameters` добавьте `metadata` объект со `description` свойством.

```json
"parameters": {
  "adminUsername": {
    "type": "string",
    "metadata": {
      "description": "User name for the Virtual Machine."
    }
  },
```

При развертывании шаблона через портал текст, который вы указываете в описании, автоматически используется в качестве подсказки для этого параметра.

![Отображается подсказка для параметра](./media/template-syntax/show-parameter-tip.png)

Для `resources` добавьте `comments` элемент или `metadata` объект. В следующем примере показаны как `comments` элемент, так и `metadata` объект.

```json
"resources": [
  {
    "type": "Microsoft.Storage/storageAccounts",
    "apiVersion": "2018-07-01",
    "name": "[concat('storage', uniqueString(resourceGroup().id))]",
    "comments": "Storage account used to store VM disks",
    "location": "[parameters('location')]",
    "metadata": {
      "comments": "These tags are needed for policy compliance."
    },
    "tags": {
      "Dept": "[parameters('deptName')]",
      "Environment": "[parameters('environment')]"
    },
    "sku": {
      "name": "Standard_LRS"
    },
    "kind": "Storage",
    "properties": {}
  }
]
```

Для `outputs` добавьте `metadata` объект в выходное значение.

```json
"outputs": {
  "hostname": {
    "type": "string",
    "value": "[reference(variables('publicIPAddressName')).dnsSettings.fqdn]",
    "metadata": {
      "comments": "Return the fully qualified domain name"
    }
  },
```

Нельзя добавить `metadata` объект в определяемые пользователем функции.

## <a name="multi-line-strings"></a>Многострочные строки

Строку можно разбить на несколько строк. Например, см `location` . свойство и одно из комментариев в следующем примере JSON.

```json
{
  "type": "Microsoft.Compute/virtualMachines",
  "apiVersion": "2018-10-01",
  "name": "[variables('vmName')]", // to customize name, change it in variables
  "location": "[
    parameters('location')
    ]", //defaults to resource group location
  /*
    storage account and network interface
    must be deployed first
  */
  "dependsOn": [
    "[resourceId('Microsoft.Storage/storageAccounts/', variables('storageAccountName'))]",
    "[resourceId('Microsoft.Network/networkInterfaces/', variables('nicName'))]"
  ],
```

> [!NOTE]
> Чтобы развернуть шаблоны с многострочными строками с помощью Azure CLI с версией 2.3.0 или более ранней, необходимо использовать `--handle-extended-json-format` параметр.

## <a name="next-steps"></a>Дальнейшие действия

* Полные шаблоны для различных типов решений доступны на странице [Шаблоны быстрого запуска Azure](https://azure.microsoft.com/documentation/templates/).
* Дополнительные сведения о функциях, которые можно использовать в шаблоне, см. в разделе [функции шаблонов ARM](template-functions.md).
* Сведения о том, как объединить несколько шаблонов во время развертывания, см. в статье [Использование связанных и вложенных шаблонов при развертывании ресурсов Azure](linked-templates.md).
* Рекомендации по созданию шаблонов см. в статье рекомендации по использованию [шаблонов ARM](template-best-practices.md).
* Ответы на распространенные вопросы см. в разделе [часто задаваемые вопросы о шаблонах ARM](frequently-asked-questions.md).
