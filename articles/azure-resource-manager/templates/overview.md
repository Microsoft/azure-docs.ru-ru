---
title: Обзор шаблонов
description: Описание преимуществ использования шаблонов Azure Resource Manager (шаблоны ARM) для развертывания ресурсов.
ms.topic: conceptual
ms.date: 03/03/2021
ms.openlocfilehash: 7f850d06066a6892db9f17ae86a6bba9496bad58
ms.sourcegitcommit: f3ec73fb5f8de72fe483995bd4bbad9b74a9cc9f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/04/2021
ms.locfileid: "102046386"
---
# <a name="what-are-arm-templates"></a>Что такое шаблоны ARM?

При переходе в облако многие группы приняли гибкие методы разработки. Эти команды быстро проходят итерацию. Они должны постоянно развертывать свои решения в облаке и знать, что их инфраструктура находится в надежном состоянии. После того как инфраструктура стала частью итеративного процесса, подразделение между операциями и разработкой исчезло. Группам необходимо управлять инфраструктурой и кодом приложения с помощью единого процесса.

Чтобы удовлетворить эти сложности, можно автоматизировать развертывания и использовать методику инфраструктуры в качестве кода. В коде определяется инфраструктура, которую необходимо развернуть. Код инфраструктуры станет частью вашего проекта. Как и в случае с кодом приложения, код инфраструктуры сохраняется в исходном репозитории и версии. Любой участник команды может запустить код и развернуть аналогичные среды.

Чтобы реализовать инфраструктуру как код для решений Azure, используйте шаблоны Azure Resource Manager (шаблоны ARM). Шаблон — это файл нотация объектов JavaScript (JSON), который определяет инфраструктуру и конфигурацию проекта. Шаблон использует декларативный синтаксис, который позволяет указать объект, который вы собираетесь развернуть. При этом, для развертывания объекта, не нужно писать последовательность команд. В шаблоне укажите ресурсы для развертывания и свойства этих ресурсов.

Мы предоставили новый язык для разработки шаблонов ARM. Язык называется Бицеп и сейчас находится на этапе предварительной версии. Шаблоны бицеп и JSON обладают такими же возможностями. Можно преобразовать шаблон между двумя языками. Бицеп предоставляет синтаксис, который проще использовать для создания шаблонов. Дополнительные сведения см. в разделе [что такое бицеп (Предварительная версия)?](bicep-overview.md).

## <a name="why-choose-arm-templates"></a>Зачем выбирать шаблоны ARM?

Если вы пытаетесь принять решение об использовании шаблонов ARM и одной из других инфраструктур в качестве служб кода, рассмотрите следующие преимущества использования шаблонов:

* **Декларативный синтаксис**. шаблоны ARM позволяют декларативно создавать и развертывать всю инфраструктуру Azure. Например, можно развернуть не только виртуальные машины, но и сетевую инфраструктуру, системы хранения и другие ресурсы, которые вам могут потребоваться.

* **Повторяемые результаты**: многократное развертывание инфраструктуры на протяжении всего жизненного цикла разработки и уверенность в том, что ресурсы развертываются единообразно. Шаблоны — идемпотентными. Это означает, что один и тот же шаблон можно развернуть несколько раз и получить те же типы ресурсов в одном и том же состоянии. Можно разработать один шаблон, представляющий нужное состояние, а не разрабатывать множество отдельных шаблонов для представления обновлений.

* **Оркестрации**. вам не нужно беспокоиться о сложности операций упорядочивания. Диспетчер ресурсов управляет развертыванием взаимозависимых ресурсов, чтобы они были созданы в правильном порядке. По возможности диспетчер ресурсов развертывать ресурсы параллельно, чтобы развертывания закончится быстрее, чем последовательное развертывание. Шаблон развертывается с помощью одной команды, а не с помощью нескольких императивных команд.

   ![Сравнение Шаблоны развертывания](./media/overview/template-processing.png)

* **Модульные файлы**. шаблоны можно разбить на более мелкие, многократно используемые компоненты и связать их вместе во время развертывания. Можно также вложить один шаблон в другие шаблоны.

* **Создание любого ресурса Azure**. Вы можете сразу же использовать новые службы и функции Azure в шаблонах. Как только поставщик ресурсов познакомится с новыми ресурсами, вы можете развернуть эти ресурсы с помощью шаблонов. Перед использованием новых служб не нужно ждать обновления средств или модулей.

* **Расширяемость**. с помощью [скриптов развертывания](deployment-script-template.md)можно добавить скрипты PowerShell или Bash в шаблоны. Скрипты развертывания расширяют возможности настройки ресурсов во время развертывания. Скрипт может быть добавлен в шаблон или сохранен во внешнем источнике и указан в шаблоне. Сценарии развертывания дают возможность завершить настройку сквозной среды в одном шаблоне ARM.

* **Тестирование**. Вы можете убедиться, что шаблон соответствует рекомендуемым рекомендациям, проверив его с помощью набора средств шаблонов ARM (ARM-ТТК). Этот набор тестов является сценарием PowerShell, который можно скачать с сайта [GitHub](https://github.com/Azure/arm-ttk). Набор средств позволяет упростить разработку опыта с помощью языка шаблона.

* **Предварительный просмотр изменений**. перед развертыванием шаблона можно использовать [операцию "что если](template-deploy-what-if.md) ", чтобы получить предварительную версию изменений. В разделе что если вы видите, какие ресурсы будут созданы, обновлены или удалены, а также какие свойства ресурсов будут изменены. Операция "что если" проверяет текущее состояние среды и устраняет необходимость в управлении состоянием.

* **Встроенная проверка**: шаблон развертывается только после прохождения проверки. Диспетчер ресурсов проверяет шаблон перед началом развертывания, чтобы убедиться, что развертывание будет выполняться. Скорее всего, развертывание будет остановлено в состоянии "половина завершено".

* **Отслеживание развертываний**. в портал Azure можно просмотреть историю развертывания и получить сведения о развертывании шаблона. Можно увидеть развернутый шаблон, значения параметров, переданные в, и все выходные значения. Другие инфраструктуры, так как службы кода, не прописываются на портале.

   ![Журнал развертывания](./media/overview/deployment-history.png)

* **Политика как код**. [Политика Azure](../../governance/policy/overview.md) — это политика, которая является платформой кода для автоматизации управления. Если вы используете политики Azure, при развертывании с помощью шаблонов исправление политики выполняется на несоответствующих ресурсах.

* Схемы **развертывания**. Вы можете воспользоваться преимуществами [схем](../../governance/blueprints/overview.md) , предоставляемых корпорацией Майкрософт, для удовлетворения нормативных требований и стандартов соответствия требованиям. Эти схемы содержат предварительно созданные шаблоны для различных архитектур.

* **Интеграция CI/CD**. шаблоны можно интегрировать в средства непрерывной интеграции и непрерывного развертывания (CI/CD), которые могут автоматизировать конвейеры выпуска для быстрого и надежного обновления приложений и инфраструктуры. С помощью задачи "шаблоны Azure DevOps и диспетчер ресурсов" можно использовать Azure Pipelines для непрерывной сборки и развертывания проектов шаблонов ARM. Дополнительные сведения см. в статье [проект VS с конвейерами](add-template-to-azure-pipelines.md) и [учебник. Непрерывная интеграция шаблонов Azure Resource Manager с Azure pipelines](./deployment-tutorial-pipeline.md).

* **Экспортируемый код**. можно получить шаблон для существующей группы ресурсов, экспортировав текущее состояние группы ресурсов или просмотрев шаблон, используемый для конкретного развертывания. Чтобы лучше понять синтаксис шаблона, изучите [экспортированный шаблон](export-template-portal.md).

* **Средства разработки**. шаблоны можно создавать с помощью [Visual Studio Code](quickstart-create-templates-use-visual-studio-code.md) и расширения "средство шаблонов". Вы получаете IntelliSense, выделение синтаксиса, встроенную справку и многие другие языковые функции. Кроме Visual Studio Code также можно использовать [Visual Studio](create-visual-studio-deployment-project.md).

## <a name="template-file"></a>Файл шаблона

В шаблоне можно создавать [выражения шаблонов](template-expressions.md) , расширяющие возможности JSON. В этих выражениях используются [функции](template-functions.md) , предоставляемые диспетчер ресурсов.

Шаблон содержит следующие разделы:

* [Параметры](template-parameters.md) — укажите значения во время развертывания, которые позволяют использовать один и тот же шаблон в различных средах.

* [Переменные](template-variables.md) — определяют значения, которые повторно используются в шаблонах. Они могут быть построены на основе значений параметров.

* [Определяемые пользователем функции](template-user-defined-functions.md) — создание настраиваемых функций, упрощающих шаблон.

* [Ресурсы](resource-declaration.md) — укажите ресурсы для развертывания.

* [Выходные данные](template-outputs.md) — возвращаемые значения из развернутых ресурсов.

## <a name="template-deployment-process"></a>Процесс Шаблоны развертывания

При развертывании шаблона диспетчер ресурсов преобразует его в REST API операции. Например, Resource Manager получает шаблон со следующим определением ресурса:

```json
"resources": [
  {
    "type": "Microsoft.Storage/storageAccounts",
    "apiVersion": "2019-04-01",
    "name": "mystorageaccount",
    "location": "westus",
    "sku": {
      "name": "Standard_LRS"
    },
    "kind": "StorageV2",
    "properties": {}
  }
]
```

В таком случае Resource Manager преобразует определение в операцию REST API, которая отправляется поставщику ресурсов Microsoft.Storage:

```HTTP
PUT
https://management.azure.com/subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/Microsoft.Storage/storageAccounts/mystorageaccount?api-version=2019-04-01
REQUEST BODY
{
  "location": "westus",
  "sku": {
    "name": "Standard_LRS"
  },
  "kind": "StorageV2",
  "properties": {}
}
```

Обратите внимание, что **apiVersion** , заданный в шаблоне для ресурса, используется в качестве версии API для операции RESTful. Вы можете многократно развернуть шаблон и убедиться, что он будет продолжать работать. Используя ту же версию API, вам не нужно беспокоиться о критических изменениях, которые могут быть представлены в более поздних версиях.

## <a name="template-design"></a>Разработка шаблона

Вы выбираете определение шаблонов и групп ресурсов по своему усмотрению в зависимости от того, как нужно управлять решением. Например, трехуровневое приложение можно развернуть из одного шаблона в одной группе ресурсов.

![трехуровневый шаблон](./media/overview/3-tier-template.png)

Но определять всю инфраструктуру в одном шаблоне не нужно. Во многих случаях целесообразно разделять требования к развертыванию между несколькими наборами шаблонов, предназначенными для определенных задач. Эти шаблоны можно многократно использовать для различных решений. Чтобы развернуть конкретное решение, создайте основной шаблон, который связывает все необходимые шаблоны. Ниже показано, как развернуть трехуровневое решение из родительского шаблона, в который входят три вложенных шаблона.

![вложенный шаблон](./media/overview/nested-tiers-template.png)

Если в вашем случае у уровней отдельные жизненные циклы, эти уровни можно развернуть в отдельные группы ресурсов. Обратите внимание, что ресурсы по-прежнему могут быть связаны с ресурсами в других группах.

![шаблон уровня](./media/overview/tier-templates.png)

Дополнительные сведения см. в статье [Использование связанных шаблонов в Azure Resource Manager](linked-templates.md).

## <a name="share-templates"></a>Общий доступ к шаблонам

После создания шаблона может потребоваться предоставить его другим пользователям в Организации. [Спецификации шаблонов](template-specs.md) позволяют хранить шаблон в качестве типа ресурса. Управление доступом на основе ролей используется для управления доступом к спецификации шаблона. Пользователи с доступом на чтение спецификации шаблона могут развернуть его, но не изменять шаблон.

Такой подход означает, что вы можете безопасно обмениваться шаблонами, которые соответствуют стандартам вашей организации.

## <a name="next-steps"></a>Дальнейшие действия

* Пошаговые инструкции по созданию шаблона см. в статье [Учебник. Создание и развертывание первого шаблона ARM](template-tutorial-create-first-template.md).
* Чтобы узнать больше о шаблонах Resource Manager из модулей Microsoft Learn, см. статью [Развертывание ресурсов и управление ими в Azure с помощью шаблонов Resoure Manager](/learn/paths/deploy-manage-resource-manager-templates/).
* Сведения о свойствах в файлах шаблонов см. в разделе сведения о [структуре и синтаксисе шаблонов ARM](template-syntax.md).
* Дополнительные сведения об экспорте шаблонов см. [в разделе Краткое руководство. Создание и развертывание шаблонов ARM с помощью портал Azure](quickstart-create-templates-use-the-portal.md).
* Ответы на распространенные вопросы см. в разделе [часто задаваемые вопросы о шаблонах ARM](frequently-asked-questions.md).
