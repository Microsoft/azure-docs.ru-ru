---
title: Режимы развертывания
description: В этой статье описывается, как с помощью Azure Resource Manager задать полный или пошаговый режим развертывания.
ms.topic: conceptual
ms.date: 07/22/2020
ms.openlocfilehash: 45eee255cec06925095ed0696c669b5c205f8b56
ms.sourcegitcommit: a4533b9d3d4cd6bb6faf92dd91c2c3e1f98ab86a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/22/2020
ms.locfileid: "97724414"
---
# <a name="azure-resource-manager-deployment-modes"></a>Режимы развертывания в Azure Resource Manager

При развертывании имеющихся ресурсов можно указать, что развертывание является добавочным или полным обновлением. Различие между этими двумя режимами заключается в том, как диспетчер ресурсов обрабатывает существующие ресурсы в группе ресурсов, которые не находятся в шаблоне.

Для обоих режимов Resource Manager пытается создать все ресурсы, указанные в шаблоне. Если ресурс уже существует в группе ресурсов и его параметры не изменились, для этого ресурса не выполняются операции. Если значения свойств ресурса были изменены, они обновятся в ресурсе. При попытке обновить расположение или тип имеющегося ресурса развертывание завершится ошибкой. Вместо этого вы можете развернуть новый ресурс нужного вам типа с необходимым расположением.

По умолчанию используется пошаговый режим.

## <a name="complete-mode"></a>Полный режим

При использовании полного режима Resource Manager **удаляет** ресурсы, которые существуют в группе ресурсов, но не указаны в шаблоне.

> [!NOTE]
> Всегда используйте [операцию "что если](template-deploy-what-if.md) " перед развертыванием шаблона в полном режиме. Что если показывает, какие ресурсы будут созданы, удалены или изменены. Используйте действие что если, чтобы избежать непреднамеренного удаления ресурсов.

Если шаблон содержит ресурс, который не развернут, так как [условие](conditional-resource-deployment.md) принимает значение false, результат зависит от того, какая версия REST API используется для развертывания шаблона. Если вы используете более раннюю версию, чем 2019-05-10, ресурс **не удаляется**. В 2019-05-10 или более поздней версии ресурс **удаляется**. Последние версии Azure PowerShell и Azure CLI удаляют ресурс.

Будьте внимательны при использовании полного режима с [циклами копирования](copy-resources.md). Все ресурсы, не указанные в шаблоне после разрешения цикла копирования, удаляются.

Если развернуть в [шаблоне несколько групп ресурсов](./deploy-to-resource-group.md), то ресурсы в группе ресурсов, указанной в операции развертывания, могут быть удалены. Ресурсы во вторичных группах ресурсов не удаляются.

Существуют некоторые отличия в том, как типы ресурсов обрабатывают Удаление завершенного режима. Родительские ресурсы автоматически удаляются, если находятся не на шаблоне, который развертывается в полном режиме. Некоторые дочерние ресурсы не удаляются автоматически, если находятся вне шаблона. Однако эти дочерние ресурсы удаляются, если родительский ресурс удаляется.

Например, если группа ресурсов содержит зону DNS ( `Microsoft.Network/dnsZones` тип ресурса) и запись CNAME ( `Microsoft.Network/dnsZones/CNAME` тип ресурса), то зона DNS является родительским ресурсом для записи CNAME. Если вы используете полный режим во время развертывания и не включаете в вашем шаблоне зону DNS, то и зона DNS, и запись CNAME удаляться. Если вы включили зону DNS в шаблон, но не включили запись CNAME, CNAME не будет удалена.

Дополнительные сведения об удалении разных типов ресурсов см. в статье [Deletion of Azure resources for complete mode deployments](complete-mode-deletion.md) (Удаление ресурсов Azure для развертываний в полном режиме).

Если группа ресурсов [заблокирована](../management/lock-resources.md), то полный режим не удаляет ресурсы.

> [!NOTE]
> Только шаблоны корневого уровня поддерживают режим полного развертывания. Для [связанных или вложенных шаблонов](linked-templates.md) необходимо использовать добавочный режим.
>
> [Развертывания уровня подписки](deploy-to-subscription.md) не поддерживают полный режим.
>
> В настоящее время портал не поддерживает полный режим.
>

## <a name="incremental-mode"></a>Пошаговый режим

В пошаговом режиме Resource Manager **оставляет без изменения** ресурсы, которые существуют в группе ресурсов, но не указаны в шаблоне. Ресурсы в шаблоне **добавляются** в группу ресурсов.

> [!NOTE]
> При повторном развертывании существующего ресурса в добавочном режиме повторно применяются все свойства. **Свойства не добавляются постепенно**. Распространенным неверным пониманием является то, что свойства, не указанные в шаблоне, остаются неизменными. Если не указать определенные свойства, диспетчер ресурсов интерпретирует развертывание как перезаписывающее эти значения. Свойства, которые не включены в шаблон, сбрасываются в значения по умолчанию. Укажите все значения, отличные от значений по умолчанию для ресурса, а не только тех, которые вы обновляете. Определение ресурса в шаблоне всегда содержит окончательное состояние ресурса. Оно не может представлять частичное обновление для существующего ресурса.
>
> В редких случаях свойства, указываемые для ресурса, фактически реализуются как дочерний ресурс. Например, при предоставлении значений конфигурации сайта для веб-приложения эти значения реализуются в типе дочернего ресурса `Microsoft.Web/sites/config` . Если повторно развернуть веб-приложение и указать пустой объект для значений конфигурации сайта, дочерний ресурс не будет обновлен. Однако при предоставлении новых значений конфигурации сайта обновляется тип дочернего ресурса.

## <a name="example-result"></a>Пример результата

Чтобы понять различие между инкрементным и полным режимом, рассмотрим следующий сценарий.

**Группа ресурсов** содержит:

* ресурс А;
* ресурс Б;
* ресурс В;

**Шаблон** содержит:

* ресурс А;
* ресурс Б;
* ресурс Г.

При развертывании в **пошаговом** режиме группа ресурсов содержит:

* ресурс А;
* ресурс Б;
* ресурс В;
* ресурс Г.

При развертывании в **полном** режиме ресурс В будет удален. Группа ресурсов содержит:

* ресурс А;
* ресурс Б;
* ресурс Г.

## <a name="set-deployment-mode"></a>Установка режима развертывания

Чтобы установить режим развертывания при развертывании с помощью PowerShell, используйте параметр `Mode`.

```azurepowershell-interactive
New-AzResourceGroupDeployment `
  -Mode Complete `
  -Name ExampleDeployment `
  -ResourceGroupName ExampleResourceGroup `
  -TemplateFile c:\MyTemplates\storage.json
```

Чтобы установить режим развертывания при развертывании с помощью Azure CLI, используйте параметр `mode`.

```azurecli-interactive
az deployment group create \
  --name ExampleDeployment \
  --mode Complete \
  --resource-group ExampleGroup \
  --template-file storage.json \
  --parameters storageAccountType=Standard_GRS
```

В примере ниже показан связанный шаблон с добавочным режимом развертывания:

```json
"resources": [
  {
    "type": "Microsoft.Resources/deployments",
    "apiVersion": "2017-05-10",
    "name": "linkedTemplate",
    "properties": {
      "mode": "Incremental",
          <nested-template-or-external-template>
    }
  }
]
```

## <a name="next-steps"></a>Дальнейшие действия

* Дополнительные сведения о создании шаблонов диспетчер ресурсов см. [в разделе Общие сведения о структуре и синтаксисе шаблонов ARM](template-syntax.md).
* Дополнительные сведения о развертывании ресурсов см. в статье [развертывание ресурсов с помощью шаблонов ARM и Azure PowerShell](deploy-powershell.md).
* Чтобы просмотреть операции для поставщика ресурсов, ознакомьтесь с [Azure REST API](/rest/api/).
