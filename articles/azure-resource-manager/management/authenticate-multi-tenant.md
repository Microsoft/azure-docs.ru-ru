---
title: Аутентификация в клиентах
description: В этой статье описывается, как Azure Resource Manager обрабатывает запросы на аутентификацию в разных клиентах.
ms.topic: conceptual
ms.date: 10/11/2019
ms.openlocfilehash: 7a13ba6f6cbfc10c52484c45e4011da7a0d8ee4c
ms.sourcegitcommit: 867cb1b7a1f3a1f0b427282c648d411d0ca4f81f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "75478829"
---
# <a name="authenticate-requests-across-tenants"></a>Запросы на аутентификацию в разных клиентах

При создании мультитенантного приложения может потребоваться обработка запросов на аутентификацию для ресурсов, которые находятся в разных клиентах. Распространенным является сценарий, когда виртуальная машина на одном клиенте должна присоединиться к виртуальной сети на другом клиенте. Azure Resource Manager предоставляет значение заголовка для хранения вспомогательных токенов, которые будут использоваться для аутентификации запросов в различных клиентах.

## <a name="header-values-for-authentication"></a>Значения заголовков для аутентификации

Запрос содержит следующие значения заголовков аутентификации.

| Имя заголовка | Описание | Пример значения |
| ----------- | ----------- | ------------ |
| Авторизация | Основной токен | Bearer &lt;основной_токен&gt; |
| x-ms-authorization-auxiliary | Вспомогательные токены | A Bearer &lt; On-токен1 &gt; , енкриптедбеарер &lt; токен2 &gt; , Bearer "вспомогательный- &lt; token3"&gt; |

Дополнительный заголовок может содержать до трех вспомогательных токенов. 

В коде мультитенантного приложения получите токены аутентификации для других клиентов и сохраните их в дополнительных заголовках. Все токены должны быть от одного пользователя или одного приложения. Пользователь или приложение должно быть приглашено к другим клиентам в качестве гостя.

## <a name="processing-the-request"></a>Обработка запроса

Когда приложение отправляет запрос к Resource Manager, запрос выполняется под идентификатором из основного токена. Основной токен должен быть допустимым и действующим. Он должен поступать от клиента, который может управлять подпиской.

Если запрос ссылается на ресурс из другого клиента, Resource Manager проверяет вспомогательные токены, чтобы определить, может ли запрос быть обработан. Все вспомогательные токены в заголовке должны быть допустимыми и действующими. Если срок действия токена истек, Resource Manager возвращает код отклика 401. Ответ включает идентификатор клиента и идентификатор арендатора токена, который недопустим. Если дополнительный заголовок содержит допустимый для клиента токен, запрос между клиентами обрабатывается.

## <a name="next-steps"></a>Дальнейшие действия

* Дополнительные сведения о запросах проверки подлинности см. в разделе [потоки проверки подлинности и сценарии приложений](../../active-directory/develop/authentication-flows-app-scenarios.md).
* Дополнительные сведения о токенах см. в статье [Маркеры доступа в Azure Active Directory](../../active-directory/develop/access-tokens.md).
