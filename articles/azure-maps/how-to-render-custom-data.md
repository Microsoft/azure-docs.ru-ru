---
title: Отображение пользовательских данных на растровой карте | Карты Microsoft Azure
description: Узнайте, как добавлять в растровую карту защелки, метки и геометрические фигуры. См. раздел Использование службы статических изображений в Azure Maps для этой цели.
author: anastasia-ms
ms.author: v-stharr
ms.date: 12/07/2020
ms.topic: how-to
ms.service: azure-maps
services: azure-maps
manager: timlt
ms.custom: mvc
ms.openlocfilehash: 5c70835c11bafb3fd06645ba51099b33d1eb6149
ms.sourcegitcommit: 772eb9c6684dd4864e0ba507945a83e48b8c16f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "96906086"
---
# <a name="render-custom-data-on-a-raster-map"></a>Отображение пользовательских данных на растровой карте

В этой статье объясняется, как использовать [статическую службу изображений](/rest/api/maps/render/getmapimage)с функциональной структурой изображения, чтобы разрешить наложенные слои поверх растровой гиперкарты. Композиция изображений включает возможность вернуть растровую плитку с дополнительными данными, такими как пользовательские защелки, метки и геометрические объекты.

Для отрисовки пользовательских защелкаок, меток и наложения геометрических объектов можно использовать приложение POST. [Интерфейсы API служб Azure Maps данных](/rest/api/maps/data) можно использовать для хранения и визуализации наложений.

> [!Tip]
> Часто гораздо более экономично использовать Azure Maps веб-пакет SDK, чтобы отобразить простую карту на веб-странице, чем использовать статическую службу изображений. Веб-пакет SDK использует плитки карт и, если пользователь не променяет и не масштабирует карту, он часто создает только часть транзакции на каждую нагрузку на карту. Обратите внимание, что Azure Maps веб-пакет SDK имеет параметры для отключения панорамирования и масштабирования. Кроме того, Azure Maps веб-пакет SDK предоставляет более широкий набор параметров визуализации данных, чем веб-служба, выполняющая статическую карту.  

## <a name="prerequisites"></a>Предварительные требования

### <a name="create-an-azure-maps-account"></a>создание учетной записи службы Azure Maps

Чтобы выполнить процедуры, описанные в этой статье, сначала необходимо создать учетную запись Azure Maps и получить ключ учетной записи Maps. Следуйте инструкциям в разделе [Создание учетной записи](quick-demo-map-app.md#create-an-azure-maps-account) для создания подписки на учетную запись Azure Maps и выполните действия, описанные в разделе [Получение первичного ключа](quick-demo-map-app.md#get-the-primary-key-for-your-account) , чтобы получить первичный ключ для вашей учетной записи. Дополнительные сведения о проверке подлинности в Azure Maps см. в [этой статье](./how-to-manage-authentication.md).


## <a name="render-pushpins-with-labels-and-a-custom-image"></a>Отрисовка канцелярских кнопок с метками и пользовательским изображением

> [!Note]
> Для процедуры, описанной в этом разделе, требуется учетная запись Azure Maps в ценовой категории S0 или S1.

Уровень учетной записи Azure Maps S0 поддерживает только один экземпляр `pins` параметра. Он позволяет визуализировать до пяти приэлементов, указанных в запросе URL-адреса, с пользовательским изображением.

Чтобы отобразить защелки с метками и пользовательским изображением, выполните следующие действия.

1. Создайте коллекцию для хранения запросов. В приложении POST выберите **создать**. В окне **Create New** (Создание) выберите **Collection** (Коллекция). Присвойте имя коллекции и нажмите кнопку **Создать**. 

2. Чтобы создать запрос, нажмите кнопку **Создать** еще раз. В окне **Create New** (Создание) выберите **Request** (Запрос). Введите **имя запроса** для канцелярских кнопок. Выберите коллекцию, созданную на предыдущем шаге, в качестве расположения для сохранения запроса. Затем нажмите кнопку **Сохранить**.
    
    ![Создание запроса в POST](./media/how-to-render-custom-data/postman-new.png)

3. Выберите метод получения HTTP на вкладке Построитель и введите следующий URL-адрес для создания запроса GET.

    ```HTTP
    https://atlas.microsoft.com/map/static/png?subscription-key={subscription-key}&api-version=1.0&layer=basic&style=main&zoom=12&center=-73.98,%2040.77&pins=custom%7Cla15+50%7Cls12%7Clc003b61%7C%7C%27CentralPark%27-73.9657974+40.781971%7C%7Chttps%3A%2F%2Fraw.githubusercontent.com%2FAzure-Samples%2FAzureMapsCodeSamples%2Fmaster%2FAzureMapsCodeSamples%2FCommon%2Fimages%2Ficons%2Fylw-pushpin.png
    ```
    Вот итоговый образ:

    ![Пользовательская кнопка с меткой](./media/how-to-render-custom-data/render-pins.png)


## <a name="get-data-from-azure-maps-data-storage"></a>Получение данных из хранилища данных Azure Maps

> [!Note]
> Для процедуры, описанной в этом разделе, требуется учетная запись Azure Maps в ценовой категории S1.

Вы также можете получить сведения о пути и ПИН-коде с помощью [API передачи данных](/rest/api/maps/data/uploadpreview). Выполните следующие действия, чтобы отправить данные пути и кнопок.

1. В приложении POST откройте новую вкладку в коллекции, созданной в предыдущем разделе. Выберите метод POST HTTP на вкладке Построитель и введите следующий URL-адрес, чтобы выполнить запрос POST:

    ```HTTP
    https://atlas.microsoft.com/mapData/upload?subscription-key={subscription-key}&api-version=1.0&dataFormat=geojson
    ```

2. На вкладке **params (параметры** ) введите следующие пары "ключ-значение", которые используются для URL-адреса запроса POST. Замените `subscription-key` значение ключом подписки Azure Maps.
    
    ![Параметры "ключ — значение" в POST](./media/how-to-render-custom-data/postman-key-vals.png)

3. На вкладке **текст** выберите формат необработанных входных данных и выберите JSON в качестве входного формата из раскрывающегося списка. Укажите этот JSON в качестве данных для отправки:
    
    ```JSON
    {
      "type": "FeatureCollection",
      "features": [
        {
          "type": "Feature",
          "properties": {},
          "geometry": {
            "type": "Polygon",
            "coordinates": [
              [
                [
                  -73.98235,
                  40.76799
                ],
                [
                  -73.95785,
                  40.80044
                ],
                [
                  -73.94928,
                  40.7968
                ],
                [
                  -73.97317,
                  40.76437
                ],
                [
                  -73.98235,
                  40.76799
                ]
              ]
            ]
          }
        },
        {
          "type": "Feature",
          "properties": {},
          "geometry": {
            "type": "LineString",
            "coordinates": [
              [
                -73.97624731063843,
                40.76560773817073
              ],
              [
                -73.97914409637451,
                40.766826609362575
              ],
              [
                -73.98513078689575,
                40.7585866048861
              ]
            ]
          }
        }
      ]
    }
    ```

4. Выберите **Отправить** и проверьте заголовок ответа. Если запрос выполнен успешно, заголовок Location будет содержать URI для проверки текущего состояния запроса на отправку. URI состояния будет иметь следующий формат.  

   ```HTTP
   https://atlas.microsoft.com/mapData/{uploadStatusId}/status?api-version=1.0
   ```

5. Скопируйте URI состояния и добавьте к нему параметр Subscription-Key со значением ключа подписки учетной записи Azure Maps. Используйте тот же ключ подписки учетной записи, который использовался для передачи данных. Формат URI состояния должен выглядеть следующим образом:

   ```HTTP
   https://atlas.microsoft.com/mapData/{uploadStatusId}/status?api-version=1.0&subscription-key={Subscription-key}
   ```

6. Чтобы получить udId, откройте новую вкладку в приложении POST. На вкладке Построитель выберите метод получения HTTP. Выполните запрос GET по URI состояния. Если передача данных прошла успешно, вы получите udId в тексте ответа. Скопируйте udId.

   ```JSON
   {
      "udid" : "{udId}"
   }
   ```

7. Используйте `udId` значение, полученное от API передачи данных, для отрисовки функций на карте. Для этого откройте новую вкладку в коллекции, созданной в предыдущем разделе. На вкладке Построитель выберите метод получения HTTP, замените {Subscription-Key} и {udId} вашими значениями и введите этот URL-адрес, чтобы выполнить запрос GET:

    ```HTTP
    https://atlas.microsoft.com/map/static/png?subscription-key={subscription-key}&api-version=1.0&layer=basic&style=main&zoom=12&center=-73.96682739257812%2C40.78119135317995&pins=default|la-35+50|ls12|lc003C62|co9B2F15||'Times Square'-73.98516297340393 40.758781646381024|'Central Park'-73.96682739257812 40.78119135317995&path=lc0000FF|fc0000FF|lw3|la0.80|fa0.30||udid-{udId}
    ```

    Вот изображение ответа:

    ![Получение данных из хранилища данных Azure Maps](./media/how-to-render-custom-data/uploaded-path.png)

## <a name="render-a-polygon-with-color-and-opacity"></a>Отображение многоугольника с цветом и непрозрачностью

> [!Note]
> Для процедуры, описанной в этом разделе, требуется учетная запись Azure Maps в ценовой категории S1.


Вы можете изменить внешний вид многоугольника с помощью модификаторов стиля с [параметром пути](/rest/api/maps/render/getmapimage#uri-parameters).

1. В приложении POST откройте новую вкладку в созданной ранее коллекции. Выберите метод GET HTTP на вкладке Построитель и введите следующий URL-адрес, чтобы настроить запрос GET для отображения многоугольника с цветом и непрозрачностью:
    
    ```HTTP
    https://atlas.microsoft.com/map/static/png?api-version=1.0&style=main&layer=basic&sku=S1&zoom=14&height=500&Width=500&center=-74.040701, 40.698666&path=lc0000FF|fc0000FF|lw3|la0.80|fa0.50||-74.03995513916016 40.70090237454063|-74.04082417488098 40.70028420372218|-74.04113531112671 40.70049568385827|-74.04298067092896 40.69899904076542|-74.04271245002747 40.69879568992435|-74.04367804527283 40.6980961582905|-74.04364585876465 40.698055487620714|-74.04368877410889 40.698022951066996|-74.04168248176573 40.696444909137|-74.03901100158691 40.69837271818651|-74.03824925422668 40.69837271818651|-74.03809905052185 40.69903971085914|-74.03771281242369 40.699340668780984|-74.03940796852112 40.70058515602143|-74.03948307037354 40.70052821920425|-74.03995513916016 40.70090237454063
    &subscription-key={subscription-key}
    ```

    Вот изображение ответа:

    ![Прорисовка непрозрачного многоугольника](./media/how-to-render-custom-data/opaque-polygon.png)


## <a name="render-a-circle-and-pushpins-with-custom-labels"></a>Отрисовка окружности и канцелярских кнопок с пользовательскими метками

> [!Note]
> Для процедуры, описанной в этом разделе, требуется учетная запись Azure Maps в ценовой категории S1.


Внешний вид ПИН-кодов можно изменить, добавив модификаторы стиля. Например, чтобы сделать защелки и их метки крупными или меньшими, используйте `sc` Модификатор "масштабный стиль". Этот модификатор принимает значение больше нуля. Значение 1 — это стандартный масштаб. Значения, превышающие 1, будут увеличивать кнопки, а меньше 1 будут их уменьшать. Дополнительные сведения об модификаторах стилей см. в разделе [параметры пути к службе статических изображений](/rest/api/maps/render/getmapimage#uri-parameters).


Выполните следующие действия, чтобы отобразить круг и канцелярские кнопки с пользовательскими метками:

1. В приложении POST откройте новую вкладку в созданной ранее коллекции. На вкладке Построитель выберите метод GET HTTP и введите этот URL-адрес, чтобы выполнить запрос GET:

    ```HTTP
    https://atlas.microsoft.com/map/static/png?api-version=1.0&style=main&layer=basic&zoom=14&height=700&Width=700&center=-122.13230609893799,47.64599069048016&path=lcFF0000|lw2|la0.60|ra1000||-122.13230609893799 47.64599069048016&pins=default|la15+50|al0.66|lc003C62|co002D62||'Microsoft Corporate Headquarters'-122.14131832122801  47.64690503939462|'Microsoft Visitor Center'-122.136828 47.642224|'Microsoft Conference Center'-122.12552547454833 47.642940335653996|'Microsoft The Commons'-122.13687658309935  47.64452336193245&subscription-key={subscription-key}
    ```

    Вот изображение ответа:

    ![Отрисовка круга с пользовательскими защелками](./media/how-to-render-custom-data/circle-custom-pins.png)

2. Чтобы изменить цвет канцелярских кнопок с последнего шага, измените модификатор стиля "Co". Взгляните `pins=default|la15+50|al0.66|lc003C62|co002D62|` , текущий цвет будет указан как #002D62 в CSS. Предположим, что вы хотите изменить его на #41d42a. Запишите новое значение цвета после описателя "Co" следующим образом: `pins=default|la15+50|al0.66|lc003C62|co41D42A|` . Создать запрос GET:

    ```HTTP
    https://atlas.microsoft.com/map/static/png?api-version=1.0&style=main&layer=basic&zoom=14&height=700&Width=700&center=-122.13230609893799,47.64599069048016&path=lcFF0000|lw2|la0.60|ra1000||-122.13230609893799 47.64599069048016&pins=default|la15+50|al0.66|lc003C62|co41D42A||'Microsoft Corporate Headquarters'-122.14131832122801  47.64690503939462|'Microsoft Visitor Center'-122.136828 47.642224|'Microsoft Conference Center'-122.12552547454833 47.642940335653996|'Microsoft The Commons'-122.13687658309935  47.64452336193245&subscription-key={subscription-key}
    ```

    Вот изображение ответа после изменения цветов ПИН-кодов:

    ![Отрисовка окружности с помощью обновленных канцелярских кнопок](./media/how-to-render-custom-data/circle-updated-pins.png)

Аналогичным образом можно изменять, добавлять и удалять другие модификаторы стиля.

## <a name="next-steps"></a>Дальнейшие действия


* Ознакомьтесь с документацией по [API получения изображения карты в службе Azure Maps](/rest/api/maps/render/getmapimage).
* Дополнительные сведения о службе Azure Maps Data Service (Предварительная версия) см. в [документации по службе](/rest/api/maps/data).