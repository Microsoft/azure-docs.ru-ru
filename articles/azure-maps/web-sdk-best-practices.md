---
title: Рекомендации по Azure Maps веб-пакета SDK | Карты Microsoft Azure
description: Советы & рекомендации по оптимизации использования Azure Maps веб-пакета SDK.
author: rbrundritt
ms.author: richbrun
ms.date: 3/22/2021
ms.topic: conceptual
ms.service: azure-maps
services: azure-maps
manager: cpendle
ms.openlocfilehash: ba351053c876c31d945ec7e4127a5caebd6a71ce
ms.sourcegitcommit: 42e4f986ccd4090581a059969b74c461b70bcac0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/23/2021
ms.locfileid: "104878350"
---
# <a name="azure-maps-web-sdk-best-practices"></a>Рекомендации по Azure Maps веб-пакета SDK

В этом документе рассматриваются рекомендации по использованию веб-пакета SDK для Azure Maps, однако многие рекомендации и оптимизации, описанные в этой статье, можно применять ко всем остальным пакетам SDK Azure Maps.

Веб-пакет SDK Azure Maps предоставляет мощный холст для визуализации больших наборов пространственных данных различными способами. В некоторых случаях существует несколько способов отображения данных одним и тем же способом, но в зависимости от размера набора данных и требуемой функциональности один метод может работать лучше, чем другие. В этой статье описываются рекомендации и рекомендации по повышению производительности и обеспечению беспрепятственного взаимодействия с пользователем.

Как правило, если требуется повысить производительность схемы, ищите способы уменьшения числа слоев и источников и сложность используемых наборов данных и стилей подготовки к просмотру.

## <a name="security-basics"></a>Основы безопасности

Самой важной частью приложения является его безопасность. Если ваше приложение не защищено хакером, может насмарку любое приложение, независимо от того, насколько хорошо работает взаимодействие с пользователем. Ниже приведены некоторые советы по обеспечению безопасности приложения Azure Maps. При использовании Azure обязательно ознакомьтесь с доступными средствами обеспечения безопасности. [Общие сведения о безопасности Azure](https://docs.microsoft.com/azure/security/fundamentals/overview)см. в этом документе.

> [!IMPORTANT]
> Azure Maps предоставляет два метода проверки подлинности.
> * Проверка подлинности на основе ключей подписки
> * Azure Active Directory проверки подлинности используют Azure Active Directory во всех рабочих приложениях.
> Проверка подлинности на основе ключей подписки проста, и большинство платформ сопоставления используют в качестве простого способа для измерения использования платформы в целях выставления счетов. Однако это не защищенная форма проверки подлинности, и ее следует использовать только локально при разработке приложений. Некоторые платформы предоставляют возможность ограничить IP-адреса и (или) источник ссылки HTTP в запросах, однако эту информацию можно легко подменить. Если вы используете ключи подписки, обязательно [поворачивайте их регулярно](how-to-manage-authentication.md#manage-and-rotate-shared-keys).
> Azure Active Directory — это корпоративная служба идентификации, которая обладает большим набором функций и параметров безопасности для всех сценариев приложений. Корпорация Майкрософт рекомендует всем рабочим приложениям, использующим Azure Maps, использовать Azure Active Directory для проверки подлинности.
> Дополнительные сведения об [управлении проверкой подлинности в Azure Maps](how-to-manage-authentication.md) в этом документе.

### <a name="secure-your-private-data"></a>Защита личных данных

Когда данные добавляются в пакеты SDK для интерактивной схемы Azure Maps, они подготавливаются к просмотру локально на устройстве конечного пользователя и никогда не отправляются по какой-либо причине обратно в Интернет.

Если приложение загружает данные, которые не должны быть общедоступными, убедитесь, что данные хранятся в безопасном месте, доступ к ним осуществляется безопасным образом, и что само приложение заблокировано и доступно только для нужных пользователей. Если какие – либо из этих действий пропускаются, неавторизованный пользователь может получить доступ к этим данным. Azure Active Directory может помочь при блокировке.

Ознакомьтесь с руководством по [добавлению проверки подлинности в веб-приложение, работающее в службе приложений Azure](https://docs.microsoft.com/azure/app-service/scenario-secure-app-authentication-app-service) .

### <a name="use-the-latest-versions-of-azure-maps"></a>Используйте последние версии Azure Maps

Azure Maps пакеты SDK проходят регулярное тестирование безопасности вместе с любыми внешними библиотеками зависимостей, которые могут использоваться пакетами SDK. Все известные проблемы безопасности исправляются своевременно и выпускаются в рабочей среде. Если приложение указывает на последнюю основную версию размещенной версии веб-пакета SDK для Azure Maps, она автоматически получит все обновления дополнительных версий, которые будут включать исправления, связанные с безопасностью.

При самостоятельном размещении веб-пакета SDK для Azure Maps с помощью модуля NPM обязательно используйте символ каретки (^) в сочетании с номером версии пакета Azure Maps NPM в `package.json` файле, чтобы он всегда указывал на последнюю дополнительную версию.

```json
"dependencies": {
  "azure-maps-control": "^2.0.30"
}
```

## <a name="optimize-initial-map-load"></a>Оптимизация начальной загрузки карт

При загрузке веб-страницы одно из первых вещей — начать отрисовку как можно скорее, чтобы пользователь не выпустил звездочку на пустом экране.

### <a name="watch-the-maps-ready-event"></a>Просмотр события готовности карт

Аналогичным образом, когда схема первоначально загружается часто, необходимо как можно быстрее загрузить данные, чтобы пользователь не просматривает пустую карту. Поскольку эта схема загружает ресурсы асинхронно, необходимо подождать, пока схема будет готова к взаимодействию с, прежде чем пытаться визуализировать на ней собственные данные. Существует два события, которые можно ожидать, `load` события и `ready` события. Событие Load будет срабатывать после того, как на карте полностью загружено исходное представление карты и все плитки карты загрузились. Событие ready будет срабатывать, когда минимальный объем ресурсов, необходимых для взаимодействия с картой, необходим. Событие ready часто может вызываться в течение половины времени события загрузки, что позволяет быстрее начать загрузку данных на карту.

### <a name="lazy-load-the-azure-maps-web-sdk"></a>Отложенная загрузка веб-пакета SDK Azure Maps

Если сопоставление не требуется сразу, загружает веб-пакет SDK Azure Maps, пока он не понадобится. Это приведет к задержке загрузки файлов JavaScript и CSS, используемых Azure Maps веб-пакетом SDK, пока не потребуется. Типичный сценарий, когда это происходит, заключается в том, что схема загружается на вкладке или на всплывающей панели, которая не отображается при загрузке страницы.
В следующем примере кода показано, как отложить загрузку Azure Maps веб-пакета SDK до нажатия кнопки.

<br/>

<iframe height="500" style="width: 100%;" scrolling="no" title="Отложенная загрузка схемы" src="https://codepen.io/azuremaps/embed/vYEeyOv?height=500&theme-id=default&default-tab=js,result" frameborder="no" allowtransparency="true" allowfullscreen="true">
См. раздел <a href='https://codepen.io/azuremaps/pen/vYEeyOv'>Отложенная загрузка Map</a> с помощью Azure Maps ( <a href='https://codepen.io/azuremaps'>@azuremaps</a> ) на <a href='https://codepen.io'>CodePen</a>.
</iframe>

### <a name="add-a-placeholder-for-the-map"></a>Добавление заполнителя для схемы

Если для загрузки на карту требуется некоторое время из-за ограничений сети или других приоритетов в приложении, рекомендуется добавить небольшое фоновое изображение на карту в `div` качестве заполнителя для этой схемы. Это приведет к заполнению void на карте `div` при загрузке.

### <a name="set-initial-map-style-and-camera-options-on-initialization"></a>Задать параметры начального стиля и камеры на карте при инициализации

Часто приложениям требуется загрузить карту в определенное расположение или стиль. Иногда разработчики будут ожидать загрузки (или ожидания `ready` события), а затем использовать `setCemer` `setStyle` функции или на карте. Это часто занимает больше времени, чтобы получить необходимое начальное представление карт, так как многие ресурсы загружаются по умолчанию до загрузки ресурсов, необходимых для нужного представления Map. Лучшим подходом является передача нужной камеры карты и параметров стиля в карту при ее инициализации.

## <a name="optimize-data-sources"></a>Оптимизация источников данных

Веб-пакет SDK имеет два источника данных:

* **Источник** `DataSource` географического формата, известный как класс, управляет данными необработанного расположения в формате "геоjson" локально. Подходит для небольших и средних наборов данных (в направлении сотен тысяч функций).
* **Источник плитки вектора**: известен `VectorTileSource` классу, загружает данные, отформатированные как векторные плитки для текущего представления карты, на основе системы разбиения на карты. Идеально подходит для больших и огромных наборов данных (миллионы или миллиарды функций).

### <a name="use-tile-based-solutions-for-large-datasets"></a>Использование решений на основе плиток для больших наборов данных

При работе с большими наборами данных, содержащими миллионы функций, для достижения оптимальной производительности рекомендуется предоставлять доступ к данным с помощью серверного решения, например векторной или растровой службы мозаичного изображения.  
Векторные плитки оптимизированы для загрузки только тех данных, которые находятся в представлении, с геометрией, обрезанными в области фокуса плитки и обобщенными в соответствии с разрешением карты для уровня масштабирования плитки.

[Платформа Azure Maps Creator](creator-indoor-maps.md) предоставляет возможность извлечения данных в формате векторной плитки. Другие форматы данных могут использовать такие средства, как [типпеканое](https://github.com/mapbox/tippecanoe) , или один из списков «многие [ресурсы» на этой странице](https://github.com/mapbox/awesome-vector-tiles).

Кроме того, можно создать пользовательскую службу, которая отображает наборы данных как плитки растровых изображений на стороне сервера и загружает данные с помощью класса Тилелайер в пакете SDK для Map. Это обеспечивает исключительную производительность, так как на карте требуется только загрузка нескольких десятков образов и управление ими. Однако существуют некоторые ограничения на использование растровых плиток, так как необработанные данные недоступны локально. Дополнительная служба часто требуется для работы любого типа взаимодействия, например, для определения того, на какую фигуру щелкнул пользователь. Кроме того, размер файла растровой плитки часто больше, чем свернутая векторная плитка, содержащая обобщенные геометрические объекты и оптимизированные геомасштабные геометрии.

Дополнительные сведения об источниках данных см. в документе [Создание источника данных](create-data-source-web-sdk.md) .

### <a name="combine-multiple-datasets-into-a-single-vector-tile-source"></a>Объединение нескольких наборов данных в одном источнике векторной плитки

Чем меньше источников данных, которыми должна управлять эта схема, тем быстрее она может обработать все отображаемые функции. В частности, когда дело доходит до мозаичных источников, объединение двух источников мозаичных плиток приводит к сокращению числа HTTP-запросов для получения плиток, а общий объем данных будет немного меньше, так как имеется только один заголовок файла.

Объединение нескольких наборов данных в одном источнике векторной плитки можно достичь с помощью такого средства, как [типпеканое](https://github.com/mapbox/tippecanoe). Наборы данных можно объединить в одну коллекцию компонентов или разделить на отдельные слои внутри плитки вектора, известной как исходные слои. При соединении источника векторной плитки с уровнем подготовки к просмотру необходимо указать исходный слой, содержащий данные, которые должны быть отображены в слое.

### <a name="reduce-the-number-of-canvas-refreshes-due-to-data-updates"></a>Уменьшение количества обновлений холста из-за обновления данных

Существует несколько способов `DataSource` добавления или обновления данных в классе. Ниже приведены различные методы и некоторые рекомендации для обеспечения хорошей производительности.

* Функция источников данных `add` может использоваться для добавления одного или нескольких компонентов в источник данных. При каждом вызове этой функции будет запущено обновление холста на карте. При добавлении множества функций объедините их в массив или коллекцию функций и передавайте их в эту функцию один раз, а не в цикл по набору данных и вызывая эту функцию для каждой функции.
* Функцию источников данных `setShapes` можно использовать для перезаписи всех фигур в источнике данных. Внутри он объединяет источники данных `clear` и `add` функции и выполняет одно обновление на одном холсте карт, а не два, что значительно ускоряется. Обязательно используйте этот параметр, если требуется обновить все данные в источнике данных.
* Функция источников данных `importDataFromUrl` может использоваться для загрузки геофайлового файла JSON через URL-адрес в источник данных. После загрузки данные передаются в функцию источников данных `add` . Если файл геоjson размещается в другом домене, убедитесь, что другой домен поддерживает запросы между доменами (CORs). Если не удается скопировать данные в локальный файл в домене или создать прокси-службу с включенной CORs. Если файл имеет большой размер, попробуйте преобразовать его в источник векторной плитки.
* Если функции упаковываются вместе с `Shape` классом, `addProperty` `setCoordinates` функции, и этой `setProperties` фигуры будут активировать обновление в источнике данных и обновление холста карт. Все компоненты, возвращаемые источниками данных `getShapes` и `getShapeById` функциями, автоматически упаковываются вместе с `Shape` классом. Если необходимо обновить несколько фигур, их можно быстрее преобразовать в формат JSON с помощью функции "источники данных" `toJson` , изменить геообъект JSON, а затем передать эти данные в функцию источников данных `setShapes` .

### <a name="avoid-calling-the-data-sources-clear-function-unnecessarily"></a>Предотвращение вызова источников данных очистка функции без необходимости

Вызов функции Clear `DataSource` класса приводит к обновлению холста на карте. Если `clear` функция вызывается несколько раз в строке, то задержка может произойти, когда она ожидает выполнения каждого обновления.

Распространенным сценарием, в котором часто встречаются приложения, является то, что приложение очищает источник данных, скачивает новые данные, снова очищает источник данных и добавляет новые данные в источник данных. В зависимости от желаемого взаимодействия с пользователем рекомендуется использовать следующие варианты.

* Очистите данные перед загрузкой новых данных, а затем передайте новые данные в источники данных `add` или `setShapes` функцию. Если это единственный набор данных на карте, то при скачивании новых данных эта схема будет пустой.
* Скачайте новые данные, а затем передайте их в функцию источников данных `setShapes` . Все данные на карте будут заменены.

### <a name="remove-unused-features-and-properties"></a>Удаление неиспользуемых компонентов и свойств

Если набор данных содержит функции, которые не будут использоваться в приложении, удалите их. Аналогичным образом удалите все свойства ненужных компонентов. Это дает ряд преимуществ.

* Сокращает объем данных, которые необходимо загрузить.
* Сокращает количество функций, которые необходимо прокручивать при подготовке данных к просмотру.
* Иногда может помочь упростить или удалить управляемые данными выражения и фильтры, что означает меньше обработки, необходимой во время визуализации.

Если у компонентов много свойств или содержимого, гораздо более производительнее ограничить то, что добавляется к источнику данных, а именно те, которые необходимы для подготовки к просмотру, и наличие отдельного метода или службы для получения дополнительного свойства или содержимого при необходимости. Например, если имеется простая схема отображения расположений на карте при щелчке на части подробного содержимого, отображается. Если вы хотите использовать стили, основанные на данных, для настройки отрисовки расположений на карте, загружайте только те свойства, которые необходимы в источнике данных. Если требуется отобразить подробное содержимое, используйте идентификатор компонента для получения дополнительного содержимого отдельно. Если содержимое хранится на стороне сервера, можно использовать службу для асинхронного извлечения, что существенно сокращает объем данных, которые необходимо загрузить при первоначальной загрузке схемы.

Кроме того, уменьшение количества значащих цифр в координатных компонентах может значительно снизить размер данных. Не очень часто координаты содержат 12 или более десятичных разрядов; Тем не менее шесть десятичных разрядов имеют точность около 0,1, что часто более точнее, чем координата, представляемая координаты (при работе с небольшим объемом данных, такими как макеты размещения, рекомендуется шесть десятичных разрядов). Наличие более шести десятичных разрядов, скорее всего, не повлияет на способ подготовки данных к просмотру и требует от пользователя загрузки дополнительных данных без дополнительного преимущества.

Ниже приведен список [полезных средств для работы с данными геоjson](https://github.com/tmcw/awesome-geojson).

### <a name="use-a-separate-data-source-for-rapidly-changing-data"></a>Использовать отдельный источник данных для быстро меняющихся данных

Иногда требуется быстро обновлять данные на карте для таких вещей, как отображение динамических обновлений потоковых данных или анимация функций. При обновлении источника данных подсистема визуализации выполняет циклический перебор и визуализацию всех компонентов в источнике данных. Отделение статических данных от быстро меняющихся данных к различным источникам данных может значительно сократить число функций, повторно отображаемых при каждом обновлении источника данных, и повысить общую производительность.

При использовании векторных плиток с динамическими данными простой способ поддержки обновлений заключается в использовании `expires` заголовка ответа. По умолчанию любой источник или растровый слой мозаики будет автоматически перезагружать плитки после `expires` даты. На карте поток трафика и плитки инцидента используют эту функцию, чтобы обеспечить актуальность данных трафика в режиме реального времени на карте. Эту функцию можно отключить, задав для параметра службы "карты" значение `refreshExpiredTiles` `false` .

### <a name="adjust-the-buffer-and-tolerance-options-in-geojson-data-sources"></a>Настройка параметров buffer и допуска в источниках данных геоjson

`DataSource`Класс преобразует данные необработанного расположения в векторные плитки локально для отрисовки в режиме реального времени. Эти плитки локального вектора обрезает необработанные данные в границах области мозаики с помощью бита буфера, чтобы обеспечить гладкую отрисовку плиток. Чем меньше значение `buffer` параметра, тем меньше перекрывающихся данных хранится на плитках локального вектора, а более высокая производительность, тем не менее, тем больше изменяется количество артефактов отрисовки. Попробуйте настроить этот параметр, чтобы получить правильный набор производительности с минимальными артефактами отрисовки.

`DataSource`Класс также имеет `tolerance` параметр, который используется с алгоритмом упрощения Douglas-Peucker при уменьшении разрешения геометрических объектов для целей визуализации. Увеличение этого значения допуска сокращает разрешение геометрических объектов и, в свою очередь, повышает производительность. Настройте этот параметр, чтобы получить правильную комбинацию геометрического разрешения и производительности для набора данных.

### <a name="set-the-max-zoom-option-of-geojson-data-sources"></a>Задание параметра максимального масштаба для источников данных геоjson

`DataSource`Класс преобразует данные необработанного расположения в векторные плитки локально для отрисовки в режиме реального времени. По умолчанию это будет сделано до уровня масштабирования 18, после чего при приближении к масштабу будет показан выборка данных из плиток, созданных для уровня масштабирования 18. Это хорошо подходит для большинства наборов данных, требующих высокого разрешения при уменьшении масштаба на этих уровнях. Однако при работе с наборами данных, которые, скорее всего, будут просматриваться при увеличении масштаба, например при просмотре многоугольников штата или провинция, установка `minZoom` для источника данных меньшего значения, например, `12` уменьшит количество вычислений, локальное создание плиток и память, используемую источником данных, и увеличьте производительность.

### <a name="minimize-geojson-response"></a>Уменьшение отклика геоjson

При загрузке данных геотабличной структуры с сервера либо с помощью службы, либо путем загрузки неструктурированного файла убедитесь, что эти данные были сведены для удаления ненужных пробелов, размер загружаемых файлов которого превышает необходимый.

### <a name="access-raw-geojson-using-a-url"></a>Доступ к необработанному геоjson с помощью URL-адреса

Можно хранить геообъекты геообъектов JSON, встроенные в JavaScript, однако при этом будет использоваться большой объем памяти, так как его копии будут храниться в переменной, созданной для этого объекта, и в экземпляре источника данных, который управляет им в отдельной рабочей веб-роли. Предоставьте геообъект JSON приложению с помощью URL-адреса, а источник данных загрузит одну копию данных непосредственно в рабочий веб-процесс источников данных.  

## <a name="optimize-rendering-layers"></a>Оптимизация слоев подготовки к просмотру

Служба "карты Azure" предоставляет несколько различных уровней для отрисовки данных на карте. Существует множество оптимизаций, которые можно использовать для адаптации этих уровней к вашему сценарию, что повышает производительность и общее взаимодействие с пользователем.

### <a name="create-layers-once-and-reuse-them"></a>Создание слоев и их повторное использование

Azure Maps веб-пакет SDK принимает решение о том, что данные являются управляемыми данными. Данные передаются в источники данных, которые затем подключаются к слоям подготовки к просмотру. Если необходимо изменить данные на карте, обновите данные в источнике данных или измените параметры стиля на слое. Это часто происходит гораздо быстрее, чем удаление и повторное создание слоев при каждом изменении.

### <a name="consider-bubble-layer-over-symbol-layer"></a>Рассмотрите пузырьковый слой над слоем символов

Пузырьковый слой отображает точки как круги на карте и может легко иметь свой радиус и цвет, используя выражение, управляемое данными. Так как окружность является простой фигурой для рисования WebGL, механизм визуализации сможет визуализировать их гораздо быстрее, чем слой символов, который должен загружать и визуализировать изображение. Разница в производительности этих двух уровней отрисовки заметна при отрисовке десятков тысяч точек.

### <a name="use-html-markers-and-popups-sparingly"></a>Использование HTML-маркеров и всплывающих окон с осторожностью

В отличие от большинства слоев в Azure Maps веб-элементе управления, использующих WebGL для подготовки к просмотру, HTML-маркеры и всплывающие окна используют традиционные элементы DOM для отрисовки. Таким образом, чем больше HTML-маркеров и всплывающих окон добавила страница, тем больше элементов DOM есть. После добавления нескольких сотен HTML-маркеров или всплывающих окон производительность может снизиться. Для больших наборов данных рассмотрите возможность кластеризации данных или использования слоя символов или пузырьков. Для всплывающих окон распространенной стратегией является создание одного всплывающего окна и его повторное использование путем обновления его содержимого и расположения, как показано в следующем примере:

<br/>

<iframe height='500' scrolling='no' title='Повторное использование всплывающего окна с несколькими закреплениями' src='//codepen.io/azuremaps/embed/rQbjvK/?height=500&theme-id=0&default-tab=js,result&embed-version=2&editable=true' frameborder='no' loading="lazy" allowtransparency='true' allowfullscreen='true' style='width: 100%;'>Просмотрите фрагмент кода для <a href='https://codepen.io/azuremaps/pen/rQbjvK/'>повторного использования всплывающего окна с несколькими закреплениями</a> службы Azure Maps (<a href='https://codepen.io/azuremaps'>@azuremaps</a>) на сайте <a href='https://codepen.io'>CodePen</a>.
</iframe>

С другой стороны, если на карте имеется только несколько точек, предпочтительнее использовать маркеры HTML. Кроме того, при необходимости можно легко перетаскивать маркеры HTML.

### <a name="combine-layers"></a>Объединение слоев

Схема может визуализировать сотни слоев, однако чем больше уровней, тем больше времени занимает визуализацию сцены. Одной из стратегий уменьшения количества слоев является объединение слоев с одинаковыми стилями или их применение к стилям, [управляемым данными](data-driven-style-expressions-web-sdk.md).

Например, рассмотрим набор данных, где все функции имеют `isHealthy` свойство, которое может иметь значение `true` или `false` . При создании пузырькового слоя, обрабатывающего различные цветовые пузырьки на основе этого свойства, существует несколько способов сделать это, как указано ниже, от крайне производительного до наиболее производительного.

* Разделите данные на два источника данных на основе `isHealthy` значения и прикрепите пузырьковый слой с жестко заданным параметром цвета к каждому источнику данных.
* Помещайте все данные в один источник данных и создавайте два пузырьковых слоя с жестко заданным параметром цвета и фильтром, основанным на `isHealthy` свойстве. 
* Поместив все данные в один источник данных, создайте один пузырьковый слой с `case` выражением стиля для параметра Color на основе `isHealthy` Свойства. Вот пример кода, демонстрирующий это.

```javascript
var layer = new atlas.layer.BubbleLayer(source, null, {
    color: [
        'case',

        //Get the 'isHealthy' property from the feature.
        ['get', 'isHealthy'],

        //If true, make the color 'green'. 
        'green',

        //If false, make the color red.
        'red'
    ]
});
```

### <a name="create-smooth-symbol-layer-animations"></a>Создание плавных анимаций на уровне символов

По умолчанию на уровнях символов обнаружение столкновений включено. Это обнаружение столкновений нацелено на то, что не перекрываются два символа. Параметры значок и текст на уровне символов имеют два параметра:

* `allowOverlap` — Указывает, будет ли символ видимым, если он конфликтует с другими символами.
* `ignorePlacement` — Указывает, могут ли другие символы конфликтовать с символом.

Оба этих параметра по `false` умолчанию имеют значение. При анимации символа вычисления обнаружения столкновений будут выполняться в каждом кадре анимации, что может замедлить анимацию и сделать ее менее гибкой. Чтобы сгладить анимацию, задайте для этих параметров значение `true` .

В следующем примере кода представлен простой способ анимации слоя символов.

<br/>

<iframe height="500" style="width: 100%;" scrolling="no" title="Анимация на уровне символов" src="https://codepen.io/azuremaps/embed/oNgGzRd?height=500&theme-id=default&default-tab=js,result" frameborder="no" allowtransparency="true" allowfullscreen="true">
См. <a href='https://codepen.io/azuremaps/pen/oNgGzRd'>анимацию на уровне символов</a> пера Azure Maps ( <a href='https://codepen.io/azuremaps'>@azuremaps</a> ) на <a href='https://codepen.io'>CodePen</a>.
</iframe>

### <a name="specify-zoom-level-range"></a>Укажите диапазон уровня масштаба

Если данные удовлетворяют одному из следующих критериев, необходимо указать минимальный и максимальный масштаб слоя, чтобы обработчик визуализации мог пропустить его, если он находится за пределами диапазона масштаба.

* Если данные поступают из источника векторной плитки, часто исходные слои для разных типов данных доступны только через диапазон уровней масштабирования.
* Если используется мозаичный слой, у которого нет плиток для всех уровней масштабирования от 0 до 24 и требуется только отрисовка на уровнях, имеющих плитки, и не пытаться заполнять недостающие плитки плитками из других уровней масштаба.
* Если требуется, чтобы слой отображался только на определенных уровнях масштаба.
Все слои имеют `minZoom` параметр и, `maxZoom` где слой будет отображаться, если между этими уровнями масштабирования на основе этой логики ` maxZoom > zoom >= minZoom` .

**Пример**

```javascript
//Only render this layer between zoom levels 1 and 9. 
var layer = new atlas.layer.BubbleLayer(dataSource, null, {
    minZoom: 1,
    maxZoom: 10
});
```

### <a name="specify-tile-layer-bounds-and-source-zoom-range"></a>Указание границ мозаичного слоя и диапазона масштабирования источника

По умолчанию мозаичные слои загружают плитки по всему миру. Однако если у службы плиток есть только плитки для определенной области, то на карте будет предпринята попытка загрузить плитки вне этой области. В этом случае будет создан запрос для каждой плитки и ожидание ответа, который может блокировать другие запросы, выполняемые картой, и, таким же, замедляет отрисовку других слоев. Указание границ мозаичного слоя приведет к тому, что на карте будут запрошены только плитки, находящиеся внутри этого ограничивающего прямоугольника. Кроме того, если мозаичный слой доступен только между определенными уровнями масштабирования, укажите для него минимальный и максимальный масштаб источника по той же причине.

**Пример**

```javascript
var tileLayer = new atlas.layer.TileLayer({
    tileUrl: 'myTileServer/{z}/{y}/{x}.png',
    bounds: [-101.065, 14.01, -80.538, 35.176],
    minSourceZoom: 1,
    maxSourceZoom: 10
});
```

### <a name="use-a-blank-map-style-when-base-map-not-visible"></a>Использовать пустой стиль отображения при невидимой базовой карте

Если слой накладывается на карту, которая полностью охватывает базовую карту, можно установить для стиля схемы значение `blank` или `blank_accessible` , чтобы базовая схема не отображалась. Распространенный сценарий для этого заключается в том, что при переверстке полной плитки земного шара нет прозрачности или прозрачной области выше базовой карты.

### <a name="smoothly-animate-image-or-tile-layers"></a>Плавная анимация изображения или мозаичных слоев

Значение, если требуется выполнить анимацию с помощью ряда изображений или мозаичных слоев на карте. Часто бывает быстрее создавать слой для каждого изображения или мозаичного слоя, а также изменять уровень прозрачности, чем обновлять источник одного слоя в каждом кадре анимации. Скрытие слоя путем установки непрозрачности в ноль и отображение нового слоя, устанавливая его непрозрачность в значение больше нуля, выполняется гораздо быстрее, чем обновление источника в слое. Кроме того, можно переключать видимость слоев, но не забудьте установить длительность исчезновения слоя в ноль, иначе она будет анимировать слой при его отображении, что приведет к эффекту мерцания, так как предыдущий слой будет скрыт, прежде чем новый слой станет видимым.

### <a name="tweak-symbol-layer-collision-detection-logic"></a>Оптимизация логики обнаружения конфликтов на уровне символов

Слой символов имеет два параметра, которые существуют для значков и текста с именем `allowOverlap` и `ignorePlacement` . Эти два параметра указывают, может ли значок или текст символа перекрываться или быть перекрыто. Если задано значение `false` , то уровень символов будет выполнять вычисления при подготовке каждой точки к просмотру, чтобы увидеть, конфликтует ли он с любым другим уже визуализированным символом в слое, и если это так, не будет отображать конфликтующий символ. Это хорошо, если вы уменьшите помехи на карте и уменьшите количество отображаемых объектов. Если задать для этих параметров значение `false` , эта логика обнаружения конфликтов будет пропущена, а все символы будут отображены на карте. Настройте этот параметр, чтобы получить оптимальное сочетание производительности и взаимодействия с пользователем.

### <a name="cluster-large-point-data-sets"></a>Наборы данных больших точек кластера

При работе с большими наборами точек данных может оказаться, что при подготовке к просмотру на определенных уровнях масштабирования многие из точек перекрываются и являются частично видимыми, если вообще. Кластеризация — это процесс группирования точек, которые близки друг к другу и представляют их как единую кластеризованную точку. По мере того, как пользователь масштабирует карту в, кластеры будут разбиваться на отдельные точки. Это может значительно снизить объем данных, которые необходимо визуализировать, сделать карту менее перегруженной и повысить производительность. `DataSource`Класс имеет параметры для локальной кластеризации данных. Кроме того, многие инструменты, создающие векторные плитки, также имеют параметры кластеризации.

Кроме того, увеличьте размер RADIUS-сервера кластера, чтобы повысить производительность. Чем больше радиус кластера, тем меньше кластеризованных точек нужно отследить и визуализировать.
Дополнительные сведения см. в [документе данных точки кластеризации](clustering-point-data-web-sdk.md)

### <a name="use-weighted-clustered-heat-maps"></a>Использовать взвешенные кластерные тепловые карты

Слой тепловой карт может легко визуализировать десятки тысяч точек данных. Для больших наборов данных рассмотрите возможность включения кластеризации в источнике данных и использование небольшого RADIUS-сервера кластера и использование свойства Clusters в `point_count` качестве веса для карт высоты. Если размер радиуса кластера составляет всего несколько пикселей, то в отображенной тепловой карте будет отображаться небольшое визуальное различие. Использование большего радиуса кластера повысит производительность, но может снизить разрешение отображаемой тепловой карт.

```javascript
var layer = new atlas.layer.HeatMapLayer(source, null, {
   weight: ['get', 'point_count']
});
```

Дополнительные сведения см. в статье [кластеризация и тепловые карты в этом документе](clustering-point-data-web-sdk.md #clustering-and-the-heat-maps-layer) .

### <a name="keep-image-resources-small"></a>Обеспечение малого изображения ресурсов

Изображения можно добавить в спрайт изображений карт для отрисовки значков на уровне символов или узоров на слое многоугольников. Не изменяйте эти изображения, чтобы свести к минимальному объему загружаемых данных и объему пространства, занимаемого ими в спрайте изображений карт. При использовании слоя символов, который масштабирует значок с помощью `size` параметра, используйте изображение, имеющее максимальный размер, который план должен отображать на карте, но не больше. Это обеспечит визуализацию значка с высоким разрешением, одновременно минимизируя используемые им ресурсы. Кроме того, SVG можно также использовать в качестве формата файла меньшего размера для простых изображений значков.

## <a name="optimize-expressions"></a>Оптимизация выражений

Выражения в стиле, основанные [на данных](data-driven-style-expressions-web-sdk.md) , обеспечивают большую гибкость и мощь при фильтрации и форматировании данных на карте. Существует множество способов оптимизации выражений. Вот несколько советов.

### <a name="reduce-the-complexity-of-filters"></a>Уменьшение сложности фильтров

Фильтрует цикл по всем данным в источнике данных и проверяет, соответствует ли каждый фильтр логике в фильтре. Если фильтры становятся сложными, это может вызвать проблемы с производительностью. Ниже приведены некоторые возможные стратегии для устранения этой причины.

* При использовании векторных плиток Разбейте данные на различные исходные слои.
* При использовании `DataSource` класса разбейте эти данные на отдельные источники данных. Попробуйте сбалансировать количество источников данных с учетом сложности фильтра. Слишком большое количество источников данных может вызвать проблемы с производительностью, поэтому может потребоваться провести тестирование, чтобы узнать, что лучше подходит для вашего сценария.
* При использовании сложного фильтра на уровне рассмотрите возможность использования нескольких слоев с выражениями стилей для уменьшения сложности фильтра. Старайтесь не создавать множество слоев с жестко закодированными стилями, если выражения стиля могут быть использованы в качестве большого количества слоев, также могут вызвать проблемы с производительностью.

### <a name="make-sure-expressions-dont-produce-errors"></a>Убедитесь, что выражения не создают ошибок

Выражения часто используются для создания кода для выполнения вычислений или логических операций во время визуализации. Точно так же, как код в остальной части приложения, следует убедиться, что вычисления и логические смысл, а также не подвержены ошибкам. Ошибки в выражениях приведут к проблемам при вычислении выражения, что может привести к снижению производительности и проблемам с визуализацией.

Одной из распространенных ошибок, учитывать в, является наличие выражения, основанного на свойстве компонента, которое может не существовать во всех компонентах. Например, в следующем коде используется выражение для установки свойства Color пузырькового слоя в `myColor` свойство функции.

```javascript
var layer = new atlas.layer.BubbleLayer(source, null, {
    color: ['get', 'myColor']
});
```

Приведенный выше код будет работать нормально, если все компоненты в источнике данных имеют `myColor` свойство, а значение этого свойства является цветом. Это может не быть проблемой, если у вас есть полный контроль над данными в источнике данных и известно, что некоторые функции будут иметь допустимый цвет в `myColor` свойстве. С другой стороны, чтобы сделать этот код надежным от ошибок, `case` можно использовать выражение с `has` выражением для проверки наличия у функции `myColor` Свойства. Если это так, `to-color` выражение типа можно использовать для преобразования значения этого свойства в цвет. Если цвет является недопустимым, можно использовать резервный цвет. В следующем примере кода показано, как это сделать, и устанавливает зеленый цвет резервного цвета.

```javascript
var layer = new atlas.layer.BubbleLayer(source, null, {
    color: [
        'case',

        //Check to see if the feature has a 'myColor' property.
        ['has', 'myColor'],

        //If true, try validating that 'myColor' value is a color, or fallback to 'green'. 
        ['to-color', ['get', 'myColor'], 'green'],

        //If false, return a fallback value.
        'green'
    ]
});
```

### <a name="order-boolean-expressions-from-most-specific-to-least-specific"></a>Упорядочить логические выражения от наиболее конкретных до наименее конкретных

При использовании логических выражений, содержащих несколько условных тестов, следует упорядочить условные тесты от наиболее конкретных до наименее конкретных. Таким образом, первое условие должно уменьшить объем данных, которые необходимо протестировать для второго условия, тем самым уменьшая общее количество условных тестов, которые необходимо выполнить.

### <a name="simplify-expressions"></a>Упростите выражения

Выражения могут быть мощными и иногда сложными. Чем проще выражение, тем быстрее он будет оцениваться. Например, если требуется простое сравнение, лучше использовать выражение соответствия, например `['==', ['get', 'category'], 'restaurant']` `['match', ['get', 'category'], 'restaurant', true, false]` . В этом случае, если проверяемое свойство является логическим значением, `get` выражение было бы еще проще `['get','isRestaurant']` .

## <a name="web-sdk-troubleshooting"></a>Устранение неполадок веб-пакета SDK

Ниже приведены некоторые советы по отладке некоторых распространенных проблем, возникающих при разработке с помощью веб-пакета SDK для Azure Maps.

**Почему отображение карт не отображается при загрузке веб-элемента управления?**

Выполните следующие действия.

* Убедитесь, что на карту добавлены добавленные параметры проверки подлинности. Если эта схема не добавлена, она будет загружена с пустым холстом, так как она не сможет получить доступ к данным базовой схемы без проверки подлинности, а ошибки 401 будут отображаться на вкладке Сеть средств разработчика в браузере.
* Убедитесь, что у вас есть подключение к Интернету.
* Проверьте консоль на наличие ошибок средств разработчика в браузере. Некоторые ошибки могут привести к тому, что отображение не будет отображено. Выполните отладку приложения.
* Убедитесь, что вы используете [поддерживаемый браузер](supported-browsers.md).

**Все мои данные отображаются на другой стороне мира, что происходит?**
Координаты, также называемые положениями, в пакетах SDK для Azure Maps соответствует стандартному формату геопространственной отрасли `[longitude, latitude]` . Этот же формат также определяет, как координаты определяются в схеме геоjson. Основные данные, используемые в пакетах SDK для Azure Maps. Если данные отображаются на противоположной стороне мира, скорее всего, это связано с тем, что значения долготы и широты меняются в соответствии со сведениями о координатах и положении.

**Почему маркеры HTML появляются в неправильном месте в веб-элементе управления?**

Проверьте следующее:

* Если для маркера используется пользовательское содержимое, убедитесь, что `anchor` `pixelOffset` Параметры и заданы правильно. По умолчанию нижний центр содержимого выравнивается по положению на карте.
* Убедитесь, что файл CSS для Azure Maps загружен.
* Проверьте элемент DOM маркера HTML, чтобы узнать, присоединен ли какой-либо из приложений CSS к маркеру и что влияет на его расположение.

**Почему значки или текст на слое символов отображаются в неправильном месте?**
Убедитесь, что `anchor` Параметры и `offset` правильно настроены для согласования с частью изображения или текстом, которые должны быть согласованы с координатами на карте.
Если символ отображается только при повернутой карте, проверьте `rotationAlignment` параметр. По умолчанию символы будут повернуты с помощью окна просмотра Maps, чтобы они отображались в вертикальном порядке для пользователя. Однако в зависимости от сценария может быть желательно заблокировать символ на ориентации на карту. Задайте для этого `rotationAlignment` параметра значение `’map’` .
Если символ находится только в том случае, когда превышена или наклонена схема, проверьте `pitchAlignment` параметр. По умолчанию символы будут оставаться в вертикальном расположении с окном просмотра Maps по мере того, как карта будет прокручена или наклонена. Однако в зависимости от вашего сценария может быть желательно заблокировать символ на тон, установленный на карте. Задайте для этого `pitchAlignment` параметра значение `’map’` .

**Почему на карте не отображаются никакие данные?**

Проверьте следующее:

* Проверьте наличие ошибок в консоли в средствах разработчика браузера.
* Убедитесь, что источник данных создан и добавлен на карту и что источник данных подключен к слою подготовки к просмотру, который также был добавлен на карту.
* Добавьте в код точки останова и пошаговое выполнение, чтобы убедиться, что данные добавляются в источник данных, а к карте добавляются источник данных и слои, не происходящие с ошибками.
* Попробуйте удалить управляемые данными выражения из слоя подготовки отчетов. Возможно, у одного из них есть ошибка, которая привела к возникновению проблемы.

**Можно ли использовать веб-пакет SDK Azure Maps в изолированном IFRAME?**

Да. Обратите внимание, что [Safari содержит ошибку](https://bugs.webkit.org/show_bug.cgi?id=170075) , которая предотвращает запуск веб-рабочих процессов в песочницах, что является требованием для Azure Maps веб-пакета SDK. Решением является добавление `"allow-same-origin"` тега к свойству песочницы IFRAME.

## <a name="get-support"></a>Получение поддержки

Ниже приведены различные способы получения поддержки для Azure Maps в зависимости от конкретной проблемы.

**Разделы справки сообщить о проблемах с данными или о проблемах с адресом?**

Azure Maps содержит средство обратной связи с данными, в котором можно сообщить о проблемах с данными и отслеживанить их. [https://feedback.azuremaps.com/](https://feedback.azuremaps.com/) Каждая отправленная ошибка создает уникальный URL-адрес, который можно использовать для отслеживания хода проблемы с данными. Время, затрачиваемое на решение проблемы с данными, зависит от типа проблемы и того, насколько легко проверить правильность изменения. После исправления служба Render Service увидит обновление в еженедельном обновлении, а другие службы, такие как геокодирование и маршрутизация, увидят обновление в ежемесячном обновлении. Подробные инструкции о том, как сообщить о проблемах с данными, приведены в этом [документе](how-to-use-feedback-tool.md).

**Разделы справки сообщить об ошибке в службе или API?**

https://azure.com/support

**Где получить техническую справку по Azure Maps?**

Если он связан с Azure Maps визуального элемента в Power BI: https://powerbi.microsoft.com/support/ для всех остальных служб Azure Maps: https://azure.com/support или форумов разработчика: https://docs.microsoft.com/answers/topics/azure-maps.html

**Разделы справки сделать запрос на функцию?**

Сделайте запрос на функцию на нашем веб-сайте пользователя: https://feedback.azure.com/forums/909172-azure-maps

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные советы по улучшению взаимодействия с пользователем в приложении см. в следующих статьях.

> [!div class="nextstepaction"]
> [Сделайте приложение доступным](map-accessibility.md)

Узнайте больше о терминологии, используемой Azure Maps и геопространственной отрасли.

> [!div class="nextstepaction"]
> [Глоссарий Azure Maps](glossary.md)
