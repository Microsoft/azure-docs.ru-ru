---
title: Руководство по переносу веб-служб из Карт Bing | Microsoft Azure Maps
description: В руководстве показано, как перенести веб-службы из Карт Bing в Microsoft Azure Maps.
author: rbrundritt
ms.author: richbrun
ms.date: 12/07/2020
ms.topic: tutorial
ms.service: azure-maps
services: azure-maps
manager: cpendle
ms.custom: ''
ms.openlocfilehash: 6024aae68183fbe02125ef4207e9fbce8abd6a2b
ms.sourcegitcommit: 66b0caafd915544f1c658c131eaf4695daba74c8
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/18/2020
ms.locfileid: "97679080"
---
# <a name="tutorial-migrate-web-service-from-bing-maps"></a>Руководство по Перенос веб-службы из Карт Bing

Службы Azure и Карты Bing предоставляют доступ к пространственным API через веб-службы REST. Интерфейсы API для этих платформ выполняют аналогичные функции, но используют разные соглашения об именовании и объекты ответов. В этом учебнике рассматривается следующее.

> * прямое и обратное геокодирование;
> * Поиск точек интереса
> * Вычисление маршрутов и направлений
> * Получение изображения карты
> * Вычисление матрицы расстояний
> * получение сведений о часовом поясе.

В приведенной ниже таблице приведены API службы Azure Maps, которые выполняют функции, аналогичные перечисленным API службы "Карты Bing".

| Интерфейсы API службы "Карты Bing"                 | API-интерфейсы службы Azure Maps      |
|---------------------------------------|-----------------------------|
| Автозаполнение                           | [Поиск](/rest/api/maps/search)     |
| Маршруты (в том числе для грузовика)          | [Направления маршрутов](/rest/api/maps/route/getroutedirections)                          |
| Матрица расстояний                       | [Матрица маршрута](/rest/api/maps/route/postroutematrixpreview)                          |
| Снимки — статическая карта                  | [Прорисовка](/rest/api/maps/render/getmapimage)                                   |
| Вычисление изохрон                            | [Диапазон маршрута](/rest/api/maps/route/getrouterange)                                    |
| Локальная аналитика                        | [Поиск](/rest/api/maps/search) + [диапазон маршрута](/rest/api/maps/route/getrouterange)    |
| Локальный поиск                          | [Поиск](/rest/api/maps/search)     |
| Распознавание расположения (точки интереса)           | [Поиск](/rest/api/maps/search)     |
| Расположения (геокодирование и обратное геокодирование) | [Поиск](/rest/api/maps/search)                                               |
| Привязка к дороге                          | [Запрос направлений маршрута](/rest/api/maps/route/postroutedirections)                         |
| Службы пространственных данных (SDS)           | [Поиск](/rest/api/maps/search) + [маршрута](/rest/api/maps/route) и другие службы Azure |
| Часовой пояс                             | [Часовой пояс](/rest/api/maps/timezone)  |
| Дорожные происшествия                     | [Сведения о дорожных происшествиях](/rest/api/maps/traffic/gettrafficincidentdetail)                     |
| Elevation                             | [Высота (предварительная версия)](/rest/api/maps/elevation)

Приведенные ниже API службы в настоящее время недоступны в Azure Maps:

-   Оптимизированные планы маршрутов — запланировано. API маршрутов Azure Maps поддерживает оптимизацию маршрута коммивояжера для одного автомобиля.
-   Метаданные снимков — в основном используются для получения URL-адресов фрагментов в Картах Bing. В Azure Maps имеется изолированная служба для прямого доступа к фрагментам карт.

В Azure Maps доступно несколько дополнительных веб-служб REST, которые могут представлять интерес:

-   [Создатель Azure Maps (предварительная версия)](./creator-indoor-maps.md) — создание настраиваемого частного цифрового двойника зданий и пространств.
-   [Пространственные операции](/rest/api/maps/spatial) — разгрузка сложных пространственных вычислений и операций, таких как геозонирование, в службу.
-   [Фрагменты карт](/rest/api/maps/render/getmaptile) — доступ к фрагментам дорог и снимков из Azure Maps в виде растровых и векторных фрагментов.
-   [Пакетная маршрутизация](/rest/api/maps/route/postroutedirectionsbatchpreview) — позволяет выполнять до 1000 запросов маршрута в одном пакете за период времени. Маршруты вычисляются параллельно на сервере для ускорения обработки.
-   [Дорожное](/rest/api/maps/traffic) движение — доступ к данным дорожного движения в реальном времени в виде растровых и векторных фрагментов.
-   [API геолокации (предварительная версия)](/rest/api/maps/geolocation/getiptolocationpreview) — получение расположения IP-адреса.
-   [Службы погоды](/rest/api/maps/weather) — доступ к данным о текущей и прогнозируемой погоде в реальном времени.

Обязательно ознакомьтесь со следующими рекомендациями:

-   [Рекомендации по использованию службы поиска Azure Maps](./how-to-use-best-practices-for-search.md)
-   [Рекомендации по построению маршрутов](./how-to-use-best-practices-for-routing.md)

## <a name="prerequisites"></a>Предварительные требования

1. Войдите на [портал Azure](https://portal.azure.com). Если у вас еще нет подписки Azure, [создайте бесплатную учетную запись](https://azure.microsoft.com/free/), прежде чем начинать работу.
2. [Создайте учетную запись службы Azure Maps](quick-demo-map-app.md#create-an-azure-maps-account)
3. [Получите первичный ключ подписки](quick-demo-map-app.md#get-the-primary-key-for-your-account), который иногда называется первичным ключом или ключом подписки. Дополнительные сведения о проверке подлинности в Azure Maps см. в [этой статье](how-to-manage-authentication.md).

## <a name="geocoding-addresses"></a>Геокодирование адресов

Геокодирование — это процесс преобразования адреса (например, `"1 Microsoft way, Redmond, WA"`) в координаты (например, долгота: −122,1298, широта: 47,64005). Координаты затем часто используются, чтобы разместить вешку на карте или центрировать карту.

Служба Azure Maps предоставляет несколько методов геокодирования адресов:

-   [Геокодирование адресов в свободной форме.](/rest/api/maps/search/getsearchaddress) Позволяет указать отдельную строку адреса (например, `"1 Microsoft way, Redmond, WA"`) и немедленно обработать запрос. Мы рекомендуем использовать эту службу, если нужно быстро выполнить геокодирование отдельных адресов.
-   [Структурированное геокодирование адресов.](/rest/api/maps/search/getsearchaddressstructured)  Позволяет указать части одного адреса, например название улицы, город, страну, почтовый индекс, и немедленно обработать запрос. Мы рекомендуем использовать эту службу, если необходимо быстро выполнить геокодирование отдельных адресов, а данные адреса уже проанализированы и разделены на отдельные части.
-   [Пакетное геокодирование адресов.](/rest/api/maps/search/postsearchaddressbatchpreview)  Позволяет создать запрос, содержащий до 10 000 адресов, и обработать их за определенный период времени. Все адреса будут параллельно геокодированы на сервере. После завершения можно скачать полный результирующий набор. Мы рекомендуем использовать эту службу, чтобы выполнить геокодирование больших наборов данных.
-   [Поиск нечетких соответствий.](/rest/api/maps/search/getsearchfuzzy)  Этот API-интерфейс сочетает выполнение геокодирования адреса с поиском точки интереса. Он принимает строку в свободной форме, которая может быть адресом, местом, ориентиром, точкой интереса или категорией точки интереса, и немедленно обрабатывает запрос. Мы рекомендуем использовать этот API-интерфейс для приложений, в которых пользователь может искать адреса или точки интереса в одном текстовом поле.
-   [Поиск пакетных нечетких соответствий.](/rest/api/maps/search/postsearchfuzzybatchpreview)  Позволяет создать запрос, содержащий до 10 000 адресов, мест, ориентиров или точек интереса, и обработать их за определенный период времени. Все данные будут параллельно обработаны на сервере. После завершения можно скачать полный результирующий набор.

Приведенные ниже таблицы содержит параметры API Карт Bing и сопоставимые параметры API в Azure Maps для геокодирования структурированных адресов и адресов в свободной форме.

**Расположение по адресу (структурированный адрес)**

| Параметр API Карт Bing              | Сопоставимый параметр API Azure Maps                 |
|--------------------------------------|-----------------------------------------------------|
| `addressLine`                      | `streetNumber`, `streetName` или `crossStreet` |
| `adminDistrict`                    | `countrySubdivision`                              |
| `countryRegion`                    | `country` и `countryCode`                     |
| `locality`                         | `municipality` или `municipalitySubdivision`     |
| `postalCode`                       | `postalCode`                                      |
| `maxResults` (`maxRes`)          | `limit`                                           |
| `includeNeighborhood` (`inclnb`) | Недоступно — всегда возвращается службой Azure Maps, если доступно.   |
| `include` (`incl`)               | Недоступно — Azure Maps всегда возвращает код страны в формате ISO2. |
| `key`                              | `subscription-key` — ознакомьтесь также с документацией по [аутентификации в Azure Maps](./azure-maps-authentication.md). |
| `culture` (`c`)                  | `language` — ознакомьтесь с документацией о [поддерживаемых языках](./supported-languages.md). |
| `userRegion` (`ur`)              | `view` — ознакомьтесь с документацией о [поддерживаемых представлениях](./supported-languages.md#azure-maps-supported-views). |

Azure Maps также поддерживает:

* `countrySecondarySubdivision` — округ, районы;
* `countryTertiarySubdivision` — области с именами, окрестности, кантоны, коммуны;
* `ofs` — вывод страниц с результатами в сочетании с параметром `maxResults`.

**Расположение по запросу (строка адреса в свободной форме)**

| Параметр API Карт Bing              | Сопоставимый параметр API Azure Maps      |
|--------------------------------------|------------------------------------------|
| `query`                            | `query`                                |
| `maxResults` (`maxRes`)          | `limit`                                |
| `includeNeighborhood` (`inclnb`) | Недоступно — всегда возвращается службой Azure Maps, если доступно.  |
| `include` (`incl`)               | Недоступно — Azure Maps всегда возвращает код страны в формате ISO2.  |
| `key`                              | `subscription-key` — ознакомьтесь также с документацией по [аутентификации в Azure Maps](./azure-maps-authentication.md). |
| `culture` (`c`)                  | `language` — ознакомьтесь с документацией о [поддерживаемых языках](./supported-languages.md).  |
| `userRegion` (`ur`)              | `view` — ознакомьтесь с документацией о [поддерживаемых представлениях](./supported-languages.md#azure-maps-supported-views). |

Azure Maps также поддерживает:

* `typeahead` — указывает, будет ли запрос интерпретирован как неполные входные данные, а поиск — выполнен в режиме прогнозирования (автозаполнение или автозавершение).
* `countrySet` — разделенный запятыми список кодов стран в формате ISO2, в которых необходимо выполнить поиск.
* `lat`/`lon`, `topLeft`/`btmRight`, `radius` — задает расположение пользователя и область, чтобы результаты лучше соответствовали его окружению.
* `ofs` — вывод страниц с результатами в сочетании с параметром `maxResults`.

Пример использования службы поиска описан [здесь](./how-to-search-for-address.md). Обязательно просмотрите [рекомендации по поиску](./how-to-use-best-practices-for-search.md).

## <a name="reverse-geocode-a-coordinate-find-a-location-by-point"></a>Обратное геокодирование координат (поиск расположения по точке)

Обратное геокодирование — это процесс преобразования географических координат (например, долгота: −122,1298, широта: 47,64005) в приблизительный адрес (например, `"1 Microsoft way, Redmond, WA"`).

Azure Maps предоставляет несколько методов обратного геокодирования:

-   [Обратное геокодирование адресов.](/rest/api/maps/search/getsearchaddressreverse) Позволяет указать отдельную географическую координату, чтобы получить ее приблизительный адрес, и немедленно обработать запрос.
-   [Обратное геокодирование перекрестков.](/rest/api/maps/search/getsearchaddressreversecrossstreet) Позволяет указать отдельную географическую координату, чтобы получить информацию о ближайших перекрестках (например, 1-й и основной), и немедленно обработать запрос.
-   [Обратное пакетное геокодирование адресов.](/rest/api/maps/search/postsearchaddressreversebatchpreview)  Позволяет создать запрос, содержащий до 10 000 координат, и обработать его за определенный период времени. Все данные будут параллельно обработаны на сервере. После завершения можно скачать полный результирующий набор.

Приведенная ниже таблица содержит параметры API Карт Bing и сопоставимые параметры API в Azure Maps.

| Параметр API Карт Bing              | Сопоставимый параметр API Azure Maps       |
|--------------------------------------|-------------------------------------------|
| `point`                              | `query`                                   |
| `includeEntityTypes`                 | `entityType` — см. таблицу сравнения типов сущностей ниже.    |
| `includeNeighborhood` (`inclnb`)     | Недоступно — всегда возвращается службой Azure Maps, если доступно.         |
| `include` (`incl`)                   | Недоступно — Azure Maps всегда возвращает код страны в формате ISO2.    |
| `key`                                | `subscription-key` — ознакомьтесь также с документацией по [аутентификации в Azure Maps](./azure-maps-authentication.md). |
| `culture` (`c`)                      | `language` — ознакомьтесь с документацией о [поддерживаемых языках](./supported-languages.md).   |
| `userRegion` (`ur`)                  | `view` — ознакомьтесь с документацией о [поддерживаемых представлениях](./supported-languages.md#azure-maps-supported-views). |

Обязательно просмотрите [рекомендации по поиску](./how-to-use-best-practices-for-search.md).

API обратного геокодирования службы Azure Maps имеет некоторые дополнительные функции, недоступные в Картах Bing, которые можно использовать для выполнения интеграции при миграции приложения:

* функция для получения сведений об ограничении скорости;
* функция для получения сведений о дороге: является ли она дорогой местного значения, магистральной, с ограниченным движением, на открытых работах и т. д.;
* функция для определения стороны улицы заданных координат.

**Таблица сравнения типов сущностей**

Следующая таблица содержит перекрестные ссылки на значения типа сущности Карт Bing и эквивалентные имена свойств в Azure Maps.

| Тип сущности Карт Bing | Сопоставимый тип сущности Azure Maps               | Описание                                |
|-----------------------|-------------------------------------------------|--------------------------------------------|
| `Address`             |                                                 | *Адрес*                                  |
| `Neighborhood`        | `Neighbourhood`                                 | *Окружение*.                             |
| `PopulatedPlace`      | `Municipality` или `MunicipalitySubdivision`     | *Город*, *город или пригород* либо *мегаполис*.     |
| `Postcode1`           | `PostalCodeArea`                                | *Почтовый код* или *почтовый индекс*.                |
| `AdminDivision1`      | `CountrySubdivision`                            | *Область* или *край*.                      |
| `AdminDivision2`      | `CountrySecondarySubdivison`                    | *Округ* или *районы*.                    |
| `CountryRegion`       | `Country`                                       | *Название страны*                             |
|                       | `CountryTertiarySubdivision`                    | *Окрестности*, *кантоны*, *коммуны*.          |

## <a name="get-location-suggestions-autosuggest"></a>Получение предлагаемых расположений (автозаполнение)

Некоторые из API поиска Azure Maps поддерживают режим прогнозирования, который можно использовать для автозаполнения. API [поиска нечетких соответствий](/rest/api/maps/search/getsearchfuzzy) Azure Maps больше всего похож на API автозаполнения Карт Bing. Приведенные ниже API также поддерживают режим прогнозирования (добавьте `&typeahead=true` в запрос):

-   [Геокодирование адресов в свободной форме.](/rest/api/maps/search/getsearchaddress) Позволяет указать отдельную строку адреса (например, `"1 Microsoft way, Redmond, WA"`) и немедленно обработать запрос. Мы рекомендуем использовать эту службу, если нужно быстро выполнить геокодирование отдельных адресов.
-   [Поиск нечетких соответствий.](/rest/api/maps/search/getsearchfuzzy)  Этот API-интерфейс сочетает выполнение геокодирования адреса с поиском точки интереса. Он принимает строку в свободной форме, которая может быть адресом, местом, ориентиром, точкой интереса или категорией точки интереса, и немедленно обрабатывает запрос. Мы рекомендуем использовать этот API-интерфейс для приложений, в которых пользователь может искать адреса или точки интереса в одном текстовом поле.
-   [Поиск точек интереса.](/rest/api/maps/search/getsearchpoi)  Позволяет выполнить поиск интересов по названию. Например, `"starbucks"`.
-   [Поиск точек интереса по категориям.](/rest/api/maps/search/getsearchpoicategory)  Позволяет выполнить поиск интересов по категориям. Например, "ресторан".

## <a name="calculate-routes-and-directions"></a>Вычисление маршрутов и направлений

С помощью Azure Maps можно вычислить маршруты и направления. Azure Maps обладает большинством аналогичных функций, что и служба маршрутизации Карт Bing, например:

* функция вычисления времени прибытия и отправления;
* функция вычисления маршрутов дорожного движения в реальном времени на основе прогнозирования;
* различные режимы передвижения: на автомобиле, пешком, на грузовике;
* оптимизация порядка пунктов маршрута (задача коммивояжера).

> [!NOTE]
> Azure Maps требует, чтобы все пункты маршрута были в виде координат. Сначала необходимо выполнить геокодирование адресов.

Служба маршрутизации Azure Maps предоставляет следующие API для вычисления маршрутов:

-   [Вычисление маршрута.](/rest/api/maps/route/getroutedirections)  Позволяет вычислить маршрут и немедленно обработать запрос. Этот API поддерживает запросы GET и POST. Мы рекомендуем применять запросы POST при указании большого количества ориентиров или использовании большого количества вариантов маршрута. Это гарантирует, что запрос URL-адреса не будет слишком длинным и не приведет к проблемам.
-   [Пакетные запросы маршрутов.](/rest/api/maps/route/postroutedirectionsbatchpreview)  Позволяет создать запрос, содержащий до 1000 запросов маршрута, и обработать их за определенный период времени. Все данные будут параллельно обработаны на сервере. После завершения можно скачать полный результирующий набор.
-   [Службы "Мобильность" (предварительная версия).](/rest/api/maps/mobility) Позволяют вычислить маршруты и направления, используя информацию об общедоступном транспорте.

Приведенная ниже таблица содержит параметры API Карт Bing и сопоставимые параметры API в Azure Maps.

| Параметр API Карт Bing                                    | Сопоставимый параметр API Azure Maps               |
|------------------------------------------------------------|---------------------------------------------------|
| `avoid`                                                    | `avoid`                                           |
| `dateTime` (`dt`)                                          | `departAt` или `arriveAt`                          |
| `distanceBeforeFirstTurn` (`dbft`)                         | Недоступно                                               |
| `distanceUnit` (`du`)                                      | Н/Д — Azure Maps использует только систему метрик.     |
| `heading` (`hd`)                                           | `vehicleHeading`                                  |
| `maxSolutions` (`maxSolns`)                                | `maxAlternatives`, `alternativeType`, `minDeviationDistance` и `minDeviationTime`  |
| `optimize` (`optwz`)                                       | `routeType` и `traffic`                         |
| `optimizeWaypoints` (`optWp`)                              | `computeBestOrder`                                |
| `routeAttributes` (`ra`)                                   | `instructionsType`                                |
| `routePathOutput` (`rpo`)                                  | `routeRepresentation`                             |
| `timeType` (`tt`)                                          | `departAt` или `arriveAt`                          |
| `tolerances` (`tl`)                                        | Недоступно                                               |
| `travelMode`                                               | `travelMode`                                      |
| `waypoint.n` (`wp.n`) или `viaWaypoint.n` (`vwp.n`)         | `query` — координаты в формате `lat0,lon0:lat1,lon1….`.   |
| `key`                                                      | `subscription-key` — ознакомьтесь также с документацией по [аутентификации в Azure Maps](./azure-maps-authentication.md). |
| `culture` (`c`)                                            | `language` — ознакомьтесь с документацией о [поддерживаемых языках](./supported-languages.md). |
| `userRegion` (`ur`)                                        | `view` — ознакомьтесь с документацией о [поддерживаемых представлениях](./supported-languages.md#azure-maps-supported-views). |

API маршрутизации Azure Maps также поддерживает маршрутизацию грузоперевозок в рамках одного API. Приведенная ниже таблица содержит параметры маршрутизации грузоперевозок Карт Bing и сопоставимые параметры API в Azure Maps.

| Параметр API Карт Bing                  | Сопоставимый параметр API Azure Maps        |
|------------------------------------------|--------------------------------------------|
| `dimensionUnit` (`dims`)                 | Недоступно — поддерживаются только размерности в метрах. |
| `weightUnit` (`wu`)                      | Недоступно — поддерживается только масса в килограммах. |
| `vehicleHeight` (`height`)               | `vehicleHeight`                            |
| `vehicleWidth` (`width`)                 | `vehicleWidth`                             |
| `vehicleLength` (`vl`)                   | `vehicleLength`                            |
| `vehicleWeight` (`weight`)               | `vehicleWeight`                            |
| `vehicleAxles` (`axles`)                 | `vehicleAxelWeight`                        |
| `vehicleTrailers` (`vt`)                 | **Н/Д**                                    |
| `vehicleSemi` (`semi`)                   | `vehicleCommercial`                        |
| `vehicleMaxGradient` (`vmg`)             | **Н/Д**                                    |
| `vehicleMinTurnRadius` (`vmtr`)          | **Н/Д**                                    |
| `vehicleAvoidCrossWind` (`vacw`)         | **Н/Д**                                    |
| `vehicleAvoidGroundingRisk` (`vagr`)     | **Н/Д**                                    |
| `vehicleHazardousMaterials` (`vhm`)      | `vehicleLoadType`                          |
| `vehicleHazardousPermits` (`vhp`)        | `vehicleLoadType`                          |

> [!TIP]
> По умолчанию API построения маршрута Azure Maps возвращает только сводку (расстояние и время) и координаты путей маршрута. Параметр `instructionsType` позволяет получить пошаговые инструкции, а параметр `routeRepresentation` — отфильтровать сводку и пути маршрута.

Кроме того, обязательно ознакомьтесь с документацией по [лучшим методикам построения маршрутов](./how-to-use-best-practices-for-routing.md).

API построения маршрута службы Azure Maps содержит множество дополнительных функций, недоступных в Картах Bing, которые можно использовать для выполнения интеграции при миграции приложения:

* Поддержка типа маршрута: самый короткий, самый быстрый, прогулочный и маршрут для экономии топлива.
* Поддержка дополнительных способов передвижения: на велосипеде, автобусе, мотоцикле, такси, грузовике и фургоне.
* Поддержка 150 ориентиров.
* Вычисление нескольких значений времени поездки в одном запросе: с учетом исторического, текущего дорожного движения и без учета дорожного движения.
* Возможность избежать дополнительных типов дорог: транзитных, грунтовых дорог и дорог, по которым вы уже путешествовали.
* Построение маршрута на основе характеристик мотора. Вычисляйте маршруты для автомобилей с двигателями внутреннего сгорания или электрических автомобилей на основе данных об их оставшемся топливе и заряде, а также характеристик мотора.
* Возможность указать максимальную скорость автомобиля.

## <a name="snap-coordinates-to-road"></a>Привязка координат к дороге

Существует несколько способов привязать координаты к дорогам в Azure Maps.

* Используйте API направлений маршрута, чтобы привязать координаты к логическому маршруту по дорожной сети.
* Используйте веб-пакет SDK для Azure Maps, чтобы привязать отдельные координаты к ближайшей дороге на векторных фрагментах.
* Используйте непосредственно векторные фрагменты Azure Maps для привязки отдельных координат.

**Использование API направлений маршрута для привязки координат**

Azure Maps позволяет привязать координаты к дорогам с помощью API [направлений маршрута](/rest/api/maps/route/postroutedirections). Эту службу можно использовать для воссоздания логического маршрута по набору координат. Она является аналогом API привязки к дороге в Картах Bing.

Существуют два разных способа использования API направлений маршрута для привязки координат к дорогам.

* Если имеется не более 150 координат, их можно передать как пункты маршрута в API получения направлений маршрута. При таком подходе можно получить два разных типа привязанных данных. Указания по маршруту будут содержать отдельные привязанные пункты, тогда как путь маршрута будет содержать интерполированный набор координат, которые заполнят полный путь между координатами.
* Если имеется более 150 координат, можно использовать API запроса направлений маршрута. Начальные и конечные координаты должны быть переданы в параметр запроса, но все координаты могут быть переданы в параметр `supportingPoints` в тексте POST-запроса и преобразованы геометрическую коллекцию точек в формате GeoJSON. Единственными привязанными данными, доступными при этом подходе, будет путь маршрута, который представляет собой интерполированный набор координат, которые заполняют полный путь между координатами. [Ниже приведен пример](https://azuremapscodesamples.azurewebsites.net/?sample=Snap%20points%20to%20logical%20route%20path) данного подхода с помощью модуля служб из веб-пакета SDK для Azure Maps.

Приведенная ниже таблица содержит параметры API Карт Bing и сопоставимые параметры API в Azure Maps.

| Параметр API Карт Bing    | Сопоставимый параметр API Azure Maps                                 |
|----------------------------|---------------------------------------------------------------------|
| `points`                   | `supportingPoints` — передайте эти точки в текст POST-запроса.  |
| `interpolate`              | Недоступно                                                                 |
| `includeSpeedLimit`        | Недоступно                                                                 |
| `includeTruckSpeedLimit`   | Недоступно                                                                 |
| `speedUnit`                | Недоступно                                                                 |
| `travelMode`               | `travelMode`                                                        |
| `key`                      | `subscription-key` — ознакомьтесь также с документацией по [аутентификации в Azure Maps](./azure-maps-authentication.md). |
| `culture` (`c`)            | `language` — ознакомьтесь с документацией о [поддерживаемых языках](./supported-languages.md).   |
| `userRegion` (`ur`)        | `view` — ознакомьтесь с документацией о [поддерживаемых представлениях](./supported-languages.md#azure-maps-supported-views).   |

API маршрутизации Azure Maps также поддерживает параметр маршрутизации грузоперевозок в пределах одного API, чтобы обеспечить вычисление логических путей. Приведенная ниже таблица содержит параметры маршрутизации грузоперевозок Карт Bing и сопоставимые параметры API в Azure Maps.

| Параметр API Карт Bing                 | Сопоставимый параметр API Azure Maps        |
|-----------------------------------------|--------------------------------------------|
| `dimensionUnit` (`dims`)                | Недоступно — поддерживаются только размерности в метрах. |
| `weightUnit` (`wu`)                     | Недоступно — поддерживается только масса в килограммах. |
| `vehicleHeight` (`height`)              | `vehicleHeight`                            |
| `vehicleWidth` (`width`)                | `vehicleWidth`                             |
| `vehicleLength` (`vl`)                  | `vehicleLength`                            |
| `vehicleWeight` (`weight`)              | `vehicleWeight`                            |
| `vehicleAxles` (`axles`)                | `vehicleAxelWeight`                        |
| `vehicleTrailers` (`vt`)                | **Н/Д**                                    |
| `vehicleSemi` (`semi`)                  | `vehicleCommercial`                        |
| `vehicleMaxGradient` (`vmg`)            | **Н/Д**                                    |
| `vehicleMinTurnRadius` (`vmtr`)         | **Н/Д**                                    |
| `vehicleAvoidCrossWind` (`vacw`)        | **Н/Д**                                    |
| `vehicleAvoidGroundingRisk` (`vagr`)    | **Н/Д**                                    |
| `vehicleHazardousMaterials` (`vhm`)     | `vehicleLoadType`                          |
| `vehicleHazardousPermits` (`vhp`)       | `vehicleLoadType`                          |

Так как этот подход использует API направлений маршрута, полный набор параметров в этой службе можно использовать для настройки логики привязки координат к дорогам. Например, указание времени отбытия приведет к тому, что будут учитываться данные о движении за прошлые периоды.

API направлений маршрута Azure Maps в настоящее время не возвращает данные об ограничении скорости, однако их можно получить с помощью API обратного геокодирования Azure Maps.

**Использование веб-пакета SDK для привязки координат**

Веб-пакет SDK для Azure Maps использует векторные фрагменты для отображения карт. Эти векторные фрагменты содержат необработанные геометрические данные дорог и могут использоваться, чтобы вычислить ближайшую дорогу от координат для простой привязки отдельных координат. Это удобно, если нужно, чтобы координаты отображались поверх дорог, и вы уже используете веб-пакет SDK для Azure Maps для визуализации данных.

Однако этот подход обеспечивает привязку только к сегментам дорог, загруженным в представлении карты. При уменьшении масштаба до уровня страны данные о дорогах могут отсутствовать, поэтому привязка будет невозможна. Однако при таком уровне масштаба один пиксель может представлять область из нескольких городских кварталов, поэтому привязка не нужна. Чтобы решить эту задачу, можно применять логику привязки каждый раз, когда карта прекращает перемещаться. [Вот пример кода](https://azuremapscodesamples.azurewebsites.net/index.html?sample=Basic%20snap%20to%20road%20logic), демонстрирующий это.

**Использование векторных фрагментов Azure Maps напрямую для привязки координат**

Векторные фрагменты Azure Maps содержат необработанные геометрические данные дорог, которые могут использоваться, чтобы вычислять ближайшую от координат точку на дороге для простой привязки отдельных координат. При уровне масштаба 15 в секторах отображаются все сегменты дороги, поэтому фрагменты будут извлекаться при этом масштабе. Затем можно использовать [вычисление квадродерева пирамиды фрагментов](./zoom-levels-and-tile-grid.md), чтобы определить, какие фрагменты нужны, и преобразовать их в геометрические фигуры. С помощью библиотеки пространственных вычислений, например [turf js](http://turfjs.org/) или [NetTopologySuite](https://github.com/NetTopologySuite/NetTopologySuite), можно вычислять ближайшие сегменты линии.

## <a name="retrieve-a-map-image-static-map"></a>Получение изображения карты (статическая карта)

Azure Maps предоставляет API для отрисовки статических изображений карт с наложением данных. API [отрисовки изображений карты](/rest/api/maps/render/getmapimagerytile) Azure можно сравнить с API статических карт в Картах Bing.

> [!NOTE]
> Azure Maps требуются координаты центра, всех вешек и расположений в формате `longitude,latitude`, тогда как Карты Bing используют формат `latitude,longitude`.</p>
<p>Сначала необходимо выполнить геокодирование адресов.

Приведенная ниже таблица содержит параметры API Карт Bing и сопоставимые параметры API в Azure Maps.

| Параметр API Карт Bing  | Сопоставимый параметр API Azure Maps            |
|--------------------------|------------------------------------------------|
| `centerPoint`            | `center`                                       |
| `format`                 | `format` — этот параметр указывается как часть URL адреса. Сейчас поддерживается только формат PNG.  |
| `heading`                | Недоступно — уличный вид не поддерживается.                |
| `imagerySet`             | `layer` и `style`. Ознакомьтесь с документацией о [поддерживаемых стилях карт](./supported-map-styles.md).   |
| `mapArea` (`ma`)         | `bbox`                                         |
| `mapLayer` (`ml`)        | Недоступно                                            |
| `mapSize` (`ms`)         | `width` и `height` могут иметь размер до 8192 x 8192. |
| `declutterPins` (`dcl`)  | Недоступно                                            |
| `dpi`                    | Недоступно                                            |
| `drawCurve`              | `path`                                         |
| `mapMetadata`            | Недоступно                                            |
| `pitch`                  | Недоступно — уличный вид не поддерживается.                |
| `pushpin` (`pp`)         | `pins`                                         |
| `zoomLevel`              | `zoom`                                         |
| `query`                  | Недоступно — нужно использовать центр или ограничивающий прямоугольник.     |
| `highlightEntity` (`he`) | Недоступно                                            |
| `style`                  | Недоступно                                            |
| Параметры маршрута         | Недоступно                                            |
| `key`                    | `subscription-key` — ознакомьтесь также с документацией по [аутентификации в Azure Maps](./azure-maps-authentication.md). |
| `culture` (`c`)          | `language` — ознакомьтесь с документацией о [поддерживаемых языках](./supported-languages.md).   |
| `userRegion` (`ur`)      | `view` — ознакомьтесь с документацией о [поддерживаемых представлениях](./supported-languages.md#azure-maps-supported-views). |

> [!NOTE]
> Azure Maps использует мозаичную систему с фрагментами, которые вдвое больше фрагментов карты в Картах Bing. Таким образом, значение уровня масштаба в Azure Maps будет на один уровень больше по сравнению с Картами Bing. Уменьшите масштаб в перемещаемых запросах на один уровень, чтобы компенсировать разницу.

Дополнительные сведения см. в статье [Отображение пользовательских данных на растровой карте](./how-to-render-custom-data.md).

Кроме возможности создания статического изображения карты, служба отрисовки Azure Maps предоставляет возможность прямого доступа к фрагментам карты в растровом (PNG) и векторном форматах:

-   [Фрагмент карты](/rest/api/maps/render/getmaptile) — извлечение растровых (PNG) и векторных фрагментов для базовых карт (дорог, территориальных границ и дальних зон).
-   [Фрагмент снимков карты](/rest/api/maps/render/getmapimagerytile) — извлечение фрагментов аэро- и спутниковых снимков.

### <a name="pushpin-url-parameter-format-comparison"></a>Сравнение формата параметров URL-адреса вешки

**До: Карты Bing**

В Картах Bing вешки можно добавить на статическое изображение карты с помощью параметра `pushpin` в URL-адресе. Параметр `pushpin` принимает расположение в формате `latitude,longitude`, стиль значка и текстовую подпись (до трех знаков), как показано ниже:

> `&pushpin=latitude,longitude;iconStyle;label`

Чтобы использовать дополнительные вешки, можно добавить в URL-адрес еще параметры `pushpin` с разными значениями. Для значка вешки можно выбрать один из стандартных стилей, доступных в API Карт Bing.

Например, в Картах Bing можно добавить на карту красную вешку с подписью "AB" в точке с координатами (долгота: −110, широта: 45) с использованием следующего параметра URL-адреса:

> `&pushpin=45,-110;7;AB`

![Вешка на статической карте Карт Bing](media/migrate-bing-maps-web-service/bing-maps-static-map-pin.jpg)

**После: Azure Maps**

В Azure Maps вешки можно также добавить на статическое изображение карты, указав параметр `pins` в URL-адресе. Вешки в Azure Maps определяются с помощью стиля значка и списка расположений, в которых он используется. Эти данные передаются в параметр `pins`, который можно указать несколько раз, чтобы использовать вешки с разными стилями.

> `&pins=iconType|pinStyles||pinLocation1|pinLocation2|...`

Чтобы использовать дополнительные стили, можно добавить в URL-адрес параметр `pins` с другими стилем и набором расположений.

Однако для расположений вешек в Azure Maps необходимо указывать координаты в формате `longitude latitude`, а в Картах Bing — в формате `latitude,longitude`. Обратите также внимание на то, что в Azure Maps значения долготы и широты разделены **запятыми, а не пробелами**.

Значение `iconType` указывает тип создаваемой геометки и может иметь следующие значения:

* `default` — стандартный значок метки.
* `none` — значок не отображается, будут отображаться только метки.
* `custom` — указывает используемый пользовательский значок. URL-адрес, указывающий на изображение значка, можно добавить в конец параметра `pins` после сведений о расположении геометки.
* `{udid}` — уникальный идентификатор данных значка, хранящегося на платформе хранилища данных Azure Maps.

Стили геометок в Azure Maps добавляются в формате `optionNameValue` с несколькими стилями, разделенными вертикальной линией (`|`), например `iconType|optionName1Value1|optionName2Value2`. Обратите внимание, что название и значение параметра не разделены двоеточием. Чтобы задать стили вешек в Azure Maps, можно использовать следующие параметры стилей:

* `al` — задает уровень непрозрачности (альфа-версия) вешки. Может иметь значение от 0 до 1.
* `an` — задает привязку геометки. Значения X и Y пикселей указываются в формате `x y`.
* `co` — цвет геометки. Должен быть 24-разрядный шестнадцатеричный цвет: от `000000` до `FFFFFF`.
* `la` — указывает привязку метки. Значения X и Y пикселей указываются в формате `x y`.
* `lc` — цвет метки. Должен быть 24-разрядный шестнадцатеричный цвет: от `000000` до `FFFFFF`.
* `ls` — размер метки в пикселях. Может иметь значение больше 0.
* `ro` — значение в градусах для поворота значка. Может иметь значение от −360 до 360.
* `sc` — значение масштаба значка геометки. Может иметь значение больше 0.

Вместо одного значения подписи, которое применяется ко всем вешкам в списке расположений, значения подписи указываются для каждого расположения вешки. Значение метки может быть строкой из нескольких символов и быть заключенным в одинарные кавычки. Это гарантирует, что оно не будет ошибочно использоваться в качестве значения стиля или расположения.

Например, в Azure Maps добавить красный (`FF0000`) стандартный значок с меткой "Space Needle", расположенный ниже (15 50) значка, в точке с координатами (долгота: −122,349300, широта: 47,620180) можно с помощью следующего параметра URL-адреса:

> `&pins=default|coFF0000|la15 50||'Space Needle'-122.349300 47.620180`

![Вешка на статической карте Azure Maps](media/migrate-bing-maps-web-service/azure-maps-static-map-pin.jpg)

В следующем примере добавляются три геометки со значениями меток 1, 2 и 3:

> `&pins=default||'1'-122 45|'2'-119.5 43.2|'3'-121.67 47.12`

![Несколько вешек на статической карте Azure Maps](media/migrate-bing-maps-web-service/azure-maps-static-map-multiple-pins.jpg)

### <a name="draw-curve-url-parameter-format-comparison"></a>Сравнение формата параметров URL-адреса кривой

**До: Карты Bing**

В Картах Bing линии и многоугольники можно добавить на статическое изображение карты, указав параметр `drawCurve` в URL-адресе. Параметр `drawCurve` принимает тип фигуры, тип стиля и список расположений для отрисовки на карте, как показано ниже.

> `&drawCurve=shapeType,styleType,location1,location2...`

Чтобы использовать дополнительные стили, можно добавить в URL-адрес параметр `drawCurve` с другими стилем и набором расположений.

Расположения в Картах Bing указываются в формате `latitude1,longitude1_latitude2,longitude2_…`. Расположения также можно кодировать.

В Картах Bing используются следующие фигуры: линии, многоугольники, круги и кривые. Типы стилей включают в себя цвет линии, толщину линии, цвет контура, цвет заливки, толщину контура и круговой радиус.

Например, в Картах Bing синюю линию с 50 % прозрачностью и толщиной в 4 пикселя можно добавить на карту между координатами долготы и широты (−110, 45 и −100, 50) с помощью следующего параметра URL-адреса:

`&drawCurve=l,FF000088,4;45,-110_50,-100`

![Линия на статической карте Карт Bing](media/migrate-bing-maps-web-service/bing-maps-static-map-line.jpg)

**После: Azure Maps**

В Azure Maps линии и прямоугольники можно также добавить на статическое изображение карты, указав параметр *path* в URL-адресе. Как и в случае с Картами Bing, в этом параметре можно указать стиль и список расположений. Параметр *path* можно указать несколько раз для отображения нескольких кругов, линий и многоугольников с различными стилями.

> `&path=pathStyles||pathLocation1|pathLocation2|...`

Однако для расположений путей в Azure Maps необходимо указывать координаты в формате `longitude latitude`, а в Картах Bing — в формате `latitude,longitude`. Обратите также внимание на то, что в Azure Maps значения долготы и широты **разделены запятыми, а не пробелами**. В настоящее время служба Azure Maps не поддерживает закодированные пути. Большие наборы данных можно загрузить в качестве заливки GeoJSON в API хранилища данных Azure Maps, как описано [здесь](./how-to-render-custom-data.md#get-data-from-azure-maps-data-storage).

Стили путей в Azure Maps добавляются в формате `optionNameValue` с несколькими стилями, разделенными вертикальной линией (`|`), например `optionName1Value1|optionName2Value2`. Обратите внимание, что название и значение параметра не разделены двоеточием. Чтобы задать стили путей в Azure Maps, можно использовать следующие параметры стилей:

* `fa` — прозрачность цвета заливки (альфа-версия), используемая при отрисовке многоугольников. Может иметь значение от 0 до 1.
* `fc` — цвет заливки, используемый для отрисовки области многоугольника.
* `la` — прозрачность цвета линии (альфа-версия), используемая при отрисовке линий и контуров многоугольников. Может иметь значение от 0 до 1.
* `lc` — цвет линии, используемый при отрисовке линий и контуров многоугольников.
* `lw` — ширина линии в пикселях.
* `ra` — указывает радиус круга в метрах.

Например, в Azure Maps синюю линию с 50 % прозрачностью и толщиной в 4 пикселя можно добавить на карту между координатами долготы и широты (−110, 45 и −100, 50) с помощью следующего параметра URL-адреса:

> `&path=lc0000FF|la.5|lw4||-110 45|-100 50`

![Линия на статической карте Azure Maps](media/migrate-bing-maps-web-service/azure-maps-static-map-line.jpg)

## <a name="calculate-a-distance-matrix"></a>Вычисление матрицы расстояний

Azure Maps предоставляет API для вычисления времени и расстояния поездки между несколькими расположениями в виде матрицы расстояний. API матрицы расстояний Azure Maps можно сравнить с API матрицы расстояний в Картах Bing.

-   [Матрица маршрута.](/rest/api/maps/route/postroutematrixpreview)  Асинхронно вычисляет время и расстояния поездки для набора исходных мест и мест назначения. Поддерживается до 700 ячеек на запрос (количество исходных мест, умноженное на количество мест назначения). Учитывая это ограничение, примерами возможных матричных измерений могут быть такие: `700x1`, `50x10`, `10x10`, `28x25`, `10x70`.

> [!NOTE]
> Запрос к API матрицы расстояний можно выполнить только с использованием запроса POST, содержащего в своем тексте сведения об исходном месте и месте назначения.</p>
<p>Кроме того, для Azure Maps необходимо предоставить координаты всех исходных мест и мест назначения. Сначала необходимо выполнить геокодирование адресов.

Приведенная ниже таблица содержит параметры API Карт Bing и сопоставимые параметры API в Azure Maps.

| Параметр API Карт Bing | Сопоставимый параметр API Azure Maps                         |
|-------------------------|-------------------------------------------------------------|
| `origins`               | `origins` — указывается в тексте запроса POST в формате GeoJSON.    |
| `destinations`          | `destination` — указывается в тексте запроса POST в формате GeoJSON. |
| `endTime`               | `arriveAt`                                                  |
| `startTime`             | `departAt`                                                  |
| `travelMode`            | `travelMode`                                                |
| `resolution`            | Недоступно                                                         |
| `distanceUnit`          | Недоступно — все расстояния указываются в метрах.                              |
| `timeUnit`              | Недоступно — все время указывается в секундах.                                 |
| `key`                   | `subscription-key` — ознакомьтесь также с документацией по [аутентификации в Azure Maps](./azure-maps-authentication.md). |
| `culture` (`c`)         | `language` — ознакомьтесь с документацией о [поддерживаемых языках](./supported-languages.md).  |
| `userRegion` (`ur`)     | `view` — ознакомьтесь с документацией о [поддерживаемых представлениях](./supported-languages.md#azure-maps-supported-views).     |

> [!TIP]
> Все дополнительные параметры построения маршрутов, доступные в API построения маршрутов Azure Maps (построение маршрутов для грузовика, характеристики мотора, области, которые следует избегать…), поддерживаются в API матрицы расстояний Azure Maps.

## <a name="calculate-an-isochrone"></a>Вычисление изохроны

Azure Maps предоставляет API для вычисления изохроны — многоугольника, охватывающего область, которую можно проехать (пройти) в любом направлении от точки отсчета с учетом заданного времени, количества топлива или транспортных расходов. API диапазона маршрута в Azure Maps можно сравнить с API изохрон в Картах Bing.

-   Диапазон [маршрута](/rest/api/maps/route/getrouterange)**: можно вычислить многоугольник, охватывающий область, которую можно проехать (пройти) в любом направлении от точки отсчета с учетом заданного времени, расстояния, имеющегося топлива или допустимых транспортных расходов.

> [!NOTE]
> В Azure Maps требуется, чтобы точкой отсчета в запросе были координаты. Сначала необходимо выполнить геокодирование адресов.</p>
<p>Кроме того, Карты Bing могут вычислять изохроны на основе времени или расстояния, тогда как Azure Maps могут это делать на основе времени, расстояния, количества топлива или транспортных расходов.

Приведенная ниже таблица содержит параметры API Карт Bing и сопоставимые параметры API в Azure Maps.

| Параметр API Карт Bing      | Сопоставимый параметр API Azure Maps            |
|------------------------------|------------------------------------------------|
| `waypoint` (`wp`)            | `query`                                        |
| `dateTime` (`dt`)            | `departAt`                                     |
| `maxTime`                    | `timeBudgetInSec`                              |
| `timeUnit` (`tu`)            | Недоступно — все время указывается в секундах.                    |
| `travelMode` (`mode`)        | `travelMode`                                   |
| `maxDistance` (`maxDis`)     | `distanceBudgetInMeters`                       |
| `distanceUnit` (`du`)        | Недоступно — все расстояния указываются в метрах.                 |
| `optimize` (`optmz`)         | `routeType`                                    |
| `key`                        | `subscription-key` — ознакомьтесь также с документацией по [аутентификации в Azure Maps](./azure-maps-authentication.md). |
| `culture` (`c`)              | `language` — ознакомьтесь с документацией о [поддерживаемых языках](./supported-languages.md).  |
| `userRegion` (`ur`)          | `view` — ознакомьтесь с документацией о [поддерживаемых представлениях](./supported-languages.md#azure-maps-supported-views). |

> [!TIP]
> Все дополнительные параметры построения маршрутов, доступные в API построения маршрутов Azure Maps (построение маршрутов для грузоперевозок, характеристики мотора, области, которые следует избегать…), поддерживаются в API изохрон Azure Maps.

## <a name="search-for-points-of-interest"></a>Поиск точек интереса

Данные о точках интереса можно искать в Картах Bing с помощью следующих API:

-   **Местный поиск.** Поиск ближайших точек интереса (радиальный поиск) по имени или типу сущности (категории). Интерфейсы API [поиска точек интереса](/rest/api/maps/search/getsearchpoi) и [поиска точек интереса по категориям](/rest/api/maps/search/getsearchpoicategory) в Azure Maps очень похожи на этот API.
-   **Распознавание расположения.** Позволяет выполнить поиск точек интереса, которые находятся на определенном расстоянии от расположения. Больше всего на этот API похож API [поиска поблизости](/rest/api/maps/search/getsearchnearby) в Azure Maps.
-   **Местная аналитика.** Поиск точек интереса, которые находятся в пределах заданного максимального времени поездки или расстояния от определенных координат. Эту функцию можно реализовать в Azure Maps, сначала выполнив вычисление изохроны, а затем передав ее в API [поиска по геометрическим данным](/rest/api/maps/search/postsearchinsidegeometry).

Azure Maps предоставляет несколько API поиска для точек интереса:

-   [Поиск точек интереса.](/rest/api/maps/search/getsearchpoi)  Позволяет выполнить поиск интересов по названию. Например, `"starbucks"`.
-   [Поиск точек интереса по категориям.](/rest/api/maps/search/getsearchpoicategory)  Позволяет выполнить поиск интересов по категориям. Например, "ресторан".
-   [Поиск поблизости.](/rest/api/maps/search/getsearchnearby)  Позволяет выполнить поиск точек интереса, которые находятся на определенном расстоянии от расположения.
-   [Поиск нечетких соответствий.](/rest/api/maps/search/getsearchfuzzy)  Этот API-интерфейс сочетает выполнение геокодирования адреса с поиском точки интереса. Он принимает строку в свободной форме, которая может быть адресом, местом, ориентиром, точкой интереса или категорией точки интереса, и немедленно обрабатывает запрос. Мы рекомендуем использовать этот API-интерфейс для приложений, в которых пользователь может искать адреса или точки интереса в одном текстовом поле.
-   [Поиск по геометрическим данным.](/rest/api/maps/search/postsearchinsidegeometry) Позволяет выполнить поиск точек интереса, которые находятся в пределах заданных геометрических данных (многоугольника).
-   [Поиск вдоль маршрута.](/rest/api/maps/search/postsearchalongroute)  Позволяет выполнить поиск точек интересов, которые находятся вдоль заданного маршрута.
-   [Поиск пакетных нечетких соответствий.](/rest/api/maps/search/postsearchfuzzybatchpreview)  Позволяет создать запрос, содержащий до 10 000 адресов, мест, ориентиров или точек интереса, и обработать их за определенный период времени. Все данные будут параллельно обработаны на сервере. После завершения можно скачать полный результирующий набор.

Обязательно просмотрите [рекомендации по поиску](./how-to-use-best-practices-for-search.md).

## <a name="get-traffic-incidents"></a>Получение данных о дорожных происшествиях

Azure Maps предоставляет несколько API для получения данных о дорожном движении. Доступны два типа данных:

* **Данные о движении** — метрики дорожного движения по секциям дорог. Они часто используется для цветового кодирования дорог. Эти данные обновляются каждые 2 минуты.
* **Данных о происшествиях** — данные о ремонтах, закрытых проездах, авариях и других происшествиях, которые могут повлиять на дорожное движение. Эти данные обновляются каждую минуту.

Карты Bing предоставляют данные о дорожном движении и происшествиях в интерактивных элементах управления картой, а также предоставляют данные о происшествиях в качестве службы.

Данные о дорожном движении также интегрированы в интерактивные элементы управления картой Azure Maps. Azure Maps также предоставляет следующие API-служб дорожного движения:

-   [Сегменты дорожного движения.](/rest/api/maps/traffic/gettrafficflowsegment) Предоставляет сведения о скорости и времени поездки для фрагмента дороги, ближайшего к заданным координатам.
-   [Фрагменты дорожного движения.](/rest/api/maps/traffic/gettrafficflowtile) Предоставляет растровые и векторные фрагменты, содержащие данные о дорожном движении. Их можно использовать с элементами управления Azure Maps или сторонними элементами управления картой, такими как Leaflet. Векторные фрагменты можно также использовать для расширенного анализа данных.
-   [Сведения о дорожных происшествиях.](/rest/api/maps/traffic/gettrafficincidentdetail) Предоставляет сведения о дорожных происшествиях в пределах ограничивающего прямоугольника с учетом масштаба и модели дорожного движения.
-   [Фрагменты с дорожными происшествиями.](/rest/api/maps/traffic/gettrafficincidenttile) Предоставляет растровые и векторные фрагменты, содержащие данные о дорожных происшествиях.
-   [Окно просмотра дорожных происшествий.](/rest/api/maps/traffic/gettrafficincidentviewport) Извлекает в окно просмотра юридические и технические сведения, описанные в запросе, например идентификатор модели дорожного движения.

Приведенная ниже таблица содержит параметры API дорожного движения Карт Bing и сопоставимые параметры API данных о дорожных происшествиях в Azure Maps.

| Параметр API Карт Bing  | Сопоставимый параметр API Azure Maps   |
|--------------------------|---------------------------------------|
| `mapArea`                | `boundingBox` и `boundingZoom`      |
| `includeLocationCodes`   | Недоступно                                   |
| `severity` (`s`)         | Недоступно — возвращаются все данные.               |
| `type` (`t`)             | Недоступно — возвращаются все данные.               |
| `key`                    | `subscription-key` — ознакомьтесь также с документацией по [аутентификации в Azure Maps](./azure-maps-authentication.md). |
| `culture` (`c`)          | `language` — ознакомьтесь с документацией о [поддерживаемых языках](./supported-languages.md). |
| `userRegion` (`ur`)      | `view` — ознакомьтесь с документацией о [поддерживаемых представлениях](./supported-languages.md#azure-maps-supported-views). |

## <a name="get-a-time-zone"></a>Получение часового пояса

Azure Maps предоставляет API для получения часового пояса, в котором расположена указанная координата. API часового пояса Azure Maps можно сравнить с API часового пояса в Картах Bing:

-   [Часовой пояс по координатам.](/rest/api/maps/timezone/gettimezonebycoordinates) Укажите координаты и получите сведения о часовом поясе, в котором они находятся.

Приведенная ниже таблица содержит параметры API Карт Bing и сопоставимые параметры API в Azure Maps.

| Параметр API Карт Bing | Сопоставимый параметр API Azure Maps          |
|-------------------------|----------------------------------------------|
| `point`                 | `query`                                      |
| `query`                 | Недоступно — расположения должны быть предварительно геокодированы.      |
| `dateTime`              | `timeStamp`                                  |
| `includeDstRules`       | Недоступно — всегда добавляется в ответ Azure Maps. |
| `key`                   | `subscription-key` — ознакомьтесь также с документацией по [аутентификации в Azure Maps](./azure-maps-authentication.md). |
| `culture` (`c`)         | `language` — ознакомьтесь с документацией о [поддерживаемых языках](./supported-languages.md).  |
| `userRegion` (`ur`)     | `view` — ознакомьтесь с документацией о [поддерживаемых представлениях](./supported-languages.md#azure-maps-supported-views).  |

Кроме того, платформа Azure Maps также предоставляет ряд дополнительных API часового пояса, позволяющих выполнять преобразования названий и идентификаторов часовых поясов:

-   [Часовой пояс по идентификатору.](/rest/api/maps/timezone/gettimezonebyid)  Возвращает сведения о текущем, прошлом и будущем часовом поясе для указанного идентификатора часового пояса IANA.
-   [Перечисление часовых поясов IANA.](/rest/api/maps/timezone/gettimezoneenumiana)  Возвращает полный список идентификаторов часовых поясов IANA. Обновления службы IANA отражаются в системе в течение одного дня. 
-   [Перечисление часовых поясов Windows.](/rest/api/maps/timezone/gettimezoneenumwindows)  Возвращает полный список идентификаторов часовых поясов Windows.
-   [Часовой пояс версии IANA.](/rest/api/maps/timezone/gettimezoneianaversion)  Возвращает текущий номер версии IANA, используемый Azure Maps. 
-   [Часовой пояс IANA для Windows.](/rest/api/maps/timezone/gettimezonewindowstoiana)  Возвращает соответствующий идентификатор IANA с учетом допустимого идентификатора часового пояса Windows. Для одного идентификатора Windows может быть возвращено несколько идентификаторов IANA.

## <a name="spatial-data-services-sds"></a>Службы пространственных данных (SDS)

Службы пространственных данных в Картах Bing предоставляют три ключевые функциональные возможности:

* Пакетное геокодирование — обработка большого пакета геокодов адресов одним запросом.
* Получение данных об административных границах — получение пересекаемой границы для указанного типа сущности по координатам.
* Размещение и запрос пространственных бизнес-данных — передача простой двухмерной таблицы данных и доступ к ней с помощью нескольких простых пространственных запросов.

### <a name="batch-geocode-data"></a>Пакетные данные геокодов

Пакетное геокодирование происходит так: большое количество адресов или мест передается в одном запросе к службе, где выполняется их одновременное геокодирование, а затем результаты возвращаются одним ответом.

Карты Bing позволяют передавать до 200 000 адресов в одном пакетном запросе на геокодирование. Этот запрос передается в очередь и обычно обрабатывается в течение некоторого времени, от нескольких минут до нескольких часов, в зависимости от размера набора данных и нагрузки на службу. Каждый адрес в запросе порождает транзакцию.

В Azure Maps имеется служба пакетного геокодирования, однако она позволяет передавать до 10 000 адресов в одном запросе, на обработку которого уходит нескольких секунд, в зависимости от размера набора данных и нагрузки на службу. Каждый адрес в запросе порождает транзакцию. В Azure Maps служба пакетного геокодирования доступна только на уровне S1.

Другой вариант геокодирования большого числа адресов с помощью Azure Maps — выполнять параллельные запросы к стандартным API поиска. Эти службы принимают только один адрес в запросе, но могут использоваться на уровне S0, который также накладывает ограничения бесплатного использования. Уровень S0 позволяет отправлять к платформе Azure Maps до 50 запросов в секунду из одной учетной записи. Поэтому, если вы не хотите превышать этот лимит обработки, можно выполнять геокодирование до 180 000 адресов в час. Для уровня S1 не указано ограничение на количество запросов в секунду, отправляемых из учетной записи, поэтому в этой ценовой категории можно быстрее обрабатывать гораздо больше данных. Однако использование службы пакетного геокодирования позволит сократить общий объем передаваемых данных и значительно уменьшить сетевой трафик.

-   [Геокодирование адресов в свободной форме.](/rest/api/maps/search/getsearchaddress) Позволяет указать отдельную строку адреса (например, `"1 Microsoft way, Redmond, WA"`) и немедленно обработать запрос. Мы рекомендуем использовать эту службу, если нужно быстро выполнить геокодирование отдельных адресов.
-   [Структурированное геокодирование адресов.](/rest/api/maps/search/getsearchaddressstructured)  Позволяет указать части одного адреса, например название улицы, город, страну, почтовый индекс, и немедленно обработать запрос. Мы рекомендуем использовать эту службу, если необходимо быстро выполнить геокодирование отдельных адресов, а данные адреса уже проанализированы и разделены на отдельные части.
-   [Пакетное геокодирование адресов.](/rest/api/maps/search/postsearchaddressbatchpreview)  Позволяет создать запрос, содержащий до 10 000 адресов, и обработать их за определенный период времени. Все адреса будут параллельно геокодированы на сервере. После завершения можно скачать полный результирующий набор. Мы рекомендуем использовать эту службу, чтобы выполнить геокодирование больших наборов данных.
-   [Поиск нечетких соответствий.](/rest/api/maps/search/getsearchfuzzy)  Этот API-интерфейс сочетает выполнение геокодирования адреса с поиском точки интереса. Он принимает строку в свободной форме, которая может быть адресом, местом, ориентиром, точкой интереса или категорией точки интереса, и немедленно обрабатывает запрос. Мы рекомендуем использовать этот API-интерфейс для приложений, в которых пользователь может искать адреса или точки интереса в одном текстовом поле.
-   [Поиск пакетных нечетких соответствий.](/rest/api/maps/search/postsearchfuzzybatchpreview)  Позволяет создать запрос, содержащий до 10 000 адресов, мест, ориентиров или точек интереса, и обработать их за определенный период времени. Все данные будут параллельно обработаны на сервере. После завершения можно скачать полный результирующий набор.

### <a name="get-administrative-boundary-data"></a>Получение данных об административных границах

В картах Bing административные границы стран, штатов, округов, городов и почтовых индексов предоставляются через API геоданных. Этот API принимает либо координаты, либо запрос для геокодирования. Если передан запрос, то выполняется его геокодирование и используются координаты из первого результата. Этот API принимает координаты и извлекает границу указанного типа сущности, пересекающую эти координаты. Обратите внимание на то, что этот API не обязательно возвращает границу для переданного запроса. Если передается запрос для `"Seattle, WA"`, но значение типа сущности равно области Country, то будет возвращена граница для США.

Azure Maps также предоставляет доступ к административным границам (страны, штаты, округи, города и почтовые индексы). Чтобы получить данные о границе, необходимо запросить один из API поиска для требуемой границы (т. е. `Seattle, WA`). Если результат поиска связан с границей, то в ответе с результатом будет указан идентификатор геометрического объекта. API поиска многоугольников можно использовать для получения точных границ по одному или нескольким геометрическим идентификаторам. Это немного отличается от Карт Bing, так как Azure Maps возвращает границу для искомых данных, тогда как Карты Bing возвращают границу для указанного типа сущности по указанным координатам. Кроме того, данные о границах, возвращаемые Azure Maps, указываются в формате GeoJSON.

Подведем итоги:

1.  Передайте запрос для границы, которую требуется получить, в один из следующих API поиска:
    -   [Геокодирование адресов в свободной форме.](/rest/api/maps/search/getsearchaddress)
    -   [Геокодирование структурированных адресов.](/rest/api/maps/search/getsearchaddressstructured)
    -   [Пакетное геокодирование адресов.](/rest/api/maps/search/postsearchaddressbatchpreview)
    -   [Поиск нечетких соответствий](/rest/api/maps/search/getsearchfuzzy)
    -   [Пакетный поиск нечетких соответствий.](/rest/api/maps/search/postsearchfuzzybatchpreview)
2.  Если у требуемых результатов есть идентификаторы геометрических объектов, передайте их в [API поиска многоугольников](/rest/api/maps/search/getsearchpolygon).

### <a name="host-and-query-spatial-business-data"></a>Размещение и запрос пространственных бизнес-данных

Службы пространственных данных в Картах Bing предоставляют простое решение для хранения пространственных данных, в котором можно разместить бизнес-данные и предоставить их в качестве пространственной службы REST. Эта служба поддерживает четыре основных запроса: поиск по свойству, поиск поблизости, поиск в ограничивающем прямоугольнике и поиск на 1 миле (1,6 км) маршрута. Многие компании, использующие эту службу, часто уже хранят свои бизнес-данные в базе данных и загружают небольшие наборы этих данных в данную службу, чтобы обеспечить работу таких приложений, как указатели магазинов. Так как аутентификация на основе ключей обеспечивает базовую защиту, рекомендуется использовать эту службу только с общедоступными данными.

Большинство бизнес-данных о расположении исходит из базы данных. Поэтому рекомендуется использовать существующие решения на основе службы хранилища Azure, такие как SQL Azure или Azure PostgreSQL (с подключаемым модулем PostGIS). Оба эти решения для хранения поддерживают пространственные данные и предоставляют широкий набор возможностей пространственных запросов. После переноса данных в подходящее решение для хранения их можно интегрировать в приложение, создав пользовательскую веб-службу или воспользовавшись такой платформой, как ASP.NET или Entity Framework. Такой подход предоставляет больше возможностей для работы с запросами, а также значительно повышает возможности системы безопасности.

Azure Cosmos DB также предоставляет ограниченный набор возможностей для работы с пространственными данными, которые, в зависимости от сценария, могут оказаться достаточными.

Ниже приведены полезные ресурсы по размещению и запросу пространственных данных в Azure.

-   [Общие сведения о типах пространственных данных SQL Azure](/sql/relational-databases/spatial/spatial-data-types-overview)
-   [Пространственные SQL Azure — запрос ближайшего соседа](/sql/relational-databases/spatial/query-spatial-data-for-nearest-neighbor)
-   [Общие сведения о геопространственных возможностях Azure Cosmos DB](../cosmos-db/sql-query-geospatial-intro.md)

## <a name="client-libraries"></a>Клиентские библиотеки

Azure Maps предоставляет клиентские библиотеки для следующих языков:

-   JavaScript, TypeScript, Node.js — [документация](./how-to-use-services-module.md) \| [пакет NPM](https://www.npmjs.com/package/azure-maps-rest).

Клиентские библиотеки с открытым кодом для других языков:

* .NET Standard 2.0 — [проект GitHub](https://github.com/perfahlen/AzureMapsRestServices) \| [пакет NuGet](https://www.nuget.org/packages/AzureMapsRestToolkit/).

## <a name="clean-up-resources"></a>Очистка ресурсов

Нет ресурсов для очистки.

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения о службах REST Azure Maps.

> [!div class="nextstepaction"]
> [Рекомендации по использованию службы поиска Azure Maps](how-to-use-best-practices-for-search.md)
