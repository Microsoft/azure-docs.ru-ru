---
title: Создавайте расширенные графики работы и повторения
description: Сведения о создании расширенных расписаний и повторении заданий в планировщике Azure.
services: scheduler
ms.service: scheduler
author: derek1ee
ms.author: deli
ms.reviewer: klam, estfan
ms.suite: infrastructure-services
ms.topic: article
ms.date: 11/14/2018
ms.openlocfilehash: 5a74240e3f116121c0aaddd11c186e6e674ea26a
ms.sourcegitcommit: f28ebb95ae9aaaff3f87d8388a09b41e0b3445b5
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/29/2021
ms.locfileid: "92368185"
---
# <a name="build-advanced-schedules-and-recurrences-for-jobs-in-azure-scheduler"></a>Сборка расширенных расписаний и повторений заданий в планировщике Azure

> [!IMPORTANT]
> Поддержка планировщика Azure [прекращается](../logic-apps/logic-apps-overview.md). Вместо него будет использоваться [Azure Logic Apps](../scheduler/migrate-from-scheduler-to-logic-apps.md#retire-date). Чтобы продолжить работу с настроенными в планировщике задачами, [перейдите на Azure Logic Apps](../scheduler/migrate-from-scheduler-to-logic-apps.md) как можно скорее. 
>
> Планировщик больше не доступен на портале Azure, но [REST API](/rest/api/scheduler) и [командлеты PowerShell Планировщика Azure](scheduler-powershell-reference.md) можно использовать и дальше для управления заданиями и коллекциями заданий.

В рамках задания [планировщика Azure](../scheduler/scheduler-intro.md) расписание является основным элементом, определяющим время и способ выполнения задания в планировщике. С помощью планировщика можно настроить для задания несколько одноразовых и повторяющихся расписаний. Одноразовые расписания запускаются один раз в указанное время и, по сути, являются повторяющимися расписаниями, которые выполняются только один раз. Повторяющиеся расписания выполняются с заданной частотой. Благодаря этой гибкости планировщик можно использовать для разнообразных бизнес-сценариев, например:

* **Регулярная очистка данных.** Создайте ежедневное задание удаления всех твитов старше трех месяцев.

* **Архивация данных.** Создайте ежемесячное задание отправки журнала счетов в службу архивации.

* **Запрос внешних данных.** Создайте задание, которое выполняется каждые 15 минут и запрашивает новый отчет о погоде от NOAA.

* **Обработка изображений.** Создайте задание на определенный день недели, которое выполняется в часы с наименьшей загрузкой и использует облачные вычисления для сжатия изображений, отправленных в течение дня.

В этой статье описываются примеры заданий, которые можно создать с помощью планировщика и [REST API планировщика Azure](/rest/api/scheduler) и которые содержат определение JSON для каждого расписания. 

## <a name="supported-scenarios"></a>Поддерживаемые сценарии

В следующих примерах показан диапазон сценариев, поддерживаемых планировщиком Azure, и способы создания расписаний для различных моделей поведения, например:

* Однократное выполнение в определенный день и в конкретное время.
* Выполнение и повтор определенное количество раз.
* Незамедлительное выполнение и повтор.
* Выполнение и повтор через каждые *n* минут, часов, дней, недель или месяцев, начиная с определенного времени.
* Выполнение и повтор на еженедельной или ежемесячной основе, но только в указанные дни недели или месяца.
* Выполнение и повтор несколько раз за указанный период. Например, в последнюю пятницу и понедельник каждого месяца или каждый день в 05:15 и 17:15.

Далее в этой статье эти сценарии описаны более подробно.

<a name="create-scedule"></a>

## <a name="create-schedule-with-rest-api"></a>Создание расписания с помощью REST API

Чтобы создать простое расписание с помощью [REST API планировщика Azure](/rest/api/scheduler), выполните следующие действия:

1. Зарегистрируйте свою подписку Azure в поставщике ресурсов, используя [операцию регистрации в REST API Resource Manager](/rest/api/resources/providers). Имя поставщика службы планировщика Azure — **Microsoft.Scheduler**. 

1. Создайте коллекцию заданий с помощью [операции создания или обновления коллекций заданий](/rest/api/scheduler/jobcollections) в REST API планировщика. 

1. Создайте задание с помощью [операции создания или обновления заданий](/rest/api/scheduler/jobs/createorupdate). 

## <a name="job-schema-elements"></a>Элементы схемы задания

Эта таблица содержит общий обзор основных элементов JSON, которые можно использовать при настройке повторений и расписаний заданий. 

| Элемент | Обязательно | Описание | 
|---------|----------|-------------|
| **startTime** | Нет | Значение строки DateTime в [формате ISO 8601](https://en.wikipedia.org/wiki/ISO_8601), указывающее время первого запуска задания в простом расписании. <p>В сложных расписаниях задание не запускается раньше, чем **startTime**. | 
| **recurrence** | Нет | Правила повторения для выполнения задания. Объект **recurrence** поддерживает следующие элементы: **frequency**, **interval**, **schedule**, **count** и **endTime**. <p>Если использовать элемент **recurrence**, необходимо также использовать элемент **frequency**, тогда как другие элементы **recurrence** являются необязательными. |
| **frequency** | Да, при использовании элемента **recurrence**. | Единица времени между вхождениями. Поддерживаются такие значения: Minute, Hour, Day, Week, Month и Year. | 
| **interval** | Нет | Положительное целое число, определяющее количество единиц времени между каждым повторением на основании значения **frequency**. <p>Например, если **interval** равен 10, а в качестве значения элемента **frequency** выбрано Week, задание выполняется повторно через каждые 10 недель. <p>Ниже приведены максимальные интервалы для каждой частоты: <p>— 18 месяцев; <br>— 78 недель; <br>— 548 дней; <br>— для часов и минут диапазон — 1 <= <*интервал*> < = 1000. | 
| **schedule** | Нет | Определяет изменения повторения в зависимости от указанных меток минут, часов, дней недели и месяца. | 
| **count** | Нет | Целое положительное число, которое указывает, сколько раз это задание будет запускаться до того, как оно завершится. <p>Например, если для ежедневного задания свойство **count** имеет значение 7, а дата начала — понедельник, выполнение задания завершается в воскресенье. Если начальная дата задания уже прошла, за время первого выполнения принимается время создания. <p>Если параметр **endTime** или **count** не указан, задание выполняется бесконечно. Невозможно одновременно использовать значения **count** и **endTime** в одном задании. Применяется правило, по которому задание завершается раньше. | 
| **endTime** | Нет | Строковое значение даты или даты и времени в [формате ISO 8601](https://en.wikipedia.org/wiki/ISO_8601), указывающее время прекращения выполнения задания. Значение строки **endTime** не может быть в прошлом. <p>Если параметр **endTime** или **count** не указан, задание выполняется бесконечно. Невозможно одновременно использовать значения **count** и **endTime** в одном задании. Применяется правило, по которому задание завершается раньше. |
|||| 

Например, эта схема JSON описывает основное расписание и повторение задания: 

```json
"properties": {
   "startTime": "2012-08-04T00:00Z", 
   "recurrence": {
      "frequency": "Week",
      "interval": 1,
      "schedule": {
         "weekDays": ["Monday", "Wednesday", "Friday"],
         "hours": [10, 22]                      
      },
      "count": 10,       
      "endTime": "2012-11-04"
   },
},
``` 

*Значения даты и даты и времени*

* Даты в заданиях планировщика содержат только дату и соответствуют [спецификации ISO-8601](https://en.wikipedia.org/wiki/ISO_8601).

* Значения даты и времени в заданиях планировщика содержат и дату, и время. Они соответствуют [спецификации ISO 8601](https://en.wikipedia.org/wiki/ISO_8601), и предполагается, что они принимают значение UTC, если смещение от UTC не указано. 

Дополнительные сведения см. в статье [Основные понятия, терминология и сущности планировщика Azure](../scheduler/scheduler-concepts-terms.md).

<a name="start-time"></a>

## <a name="details-starttime"></a>Сведения о startTime

В указанной ниже таблице описано, каким образом параметр **startTime** управляет выполнением заданий.

| startTime | Количество повторов | Повторение без расписания | Повторение с расписанием |
|-----------|---------------|-------------------------|--------------------------|
| **Время начала не указано** | Задание выполняется один раз сразу после запуска. | Задание выполняется один раз сразу после запуска. Последующие выполнения производятся с учетом времени предыдущего выполнения. | Задание выполняется один раз сразу после запуска. Последующие выполнения производятся по расписанию повторов. | 
| **Время начала в прошлом** | Задание выполняется один раз сразу после запуска. | Время выполнения задания рассчитывается как время первого выполнения после времени начала. <p>Последующие выполнения производятся с учетом времени предыдущего выполнения. <p>См. пример после этой таблицы. | Выполнять задание следует *не раньше* указанного времени начала. Первое выполнение производится по расписанию, которое отсчитывается от времени начала. <p>Последующие выполнения производятся по расписанию повторов. | 
| **Время начала в будущем или в настоящем** | Задание выполняется один раз в указанное время начала. | Задание выполняется один раз в указанное время начала. <p>Последующие выполнения производятся с учетом времени предыдущего выполнения. | Выполнять задание следует *не раньше* указанного времени начала. Первое выполнение производится по расписанию, которое отсчитывается от времени начала. <p>Последующие выполнения производятся по расписанию повторов. |
||||| 

Предположим, что в этом примере установлены следующие условия: время начала установлено в прошлом, указан параметр recurrence и отсутствует параметр schedule.

```json
"properties": {
   "startTime": "2015-04-07T14:00Z", 
   "recurrence": {
      "frequency": "Day",
      "interval": 2
   }
}
```

* Текущая дата и время — 8 апреля 2015 года, 13:00.

* Дата и время начала — 7 апреля 2015 года, 14:00. Это значение предшествует текущей дате и времени.

* Для параметра recurrence установлено повторение каждые два дня.

1. В этих условиях первое выполнение происходит 9 апреля 2015 года в 14:00. 

   Планировщик вычисляет случаи выполнения на основе времени начала, отклоняет все экземпляры в прошлом и использует следующий экземпляр в будущем. 
   В этом случае **startTime** — это 7 апреля 2015 года в 14:09, поэтому в следующий раз задание будет выполнено через два дня, 9 апреля 2015 года в 14:00.

   Первое выполнение останется неизменным даже при таких значениях **startTime**: 05.04.2015 в 14:00 или 01.04.2015 в 14:00. Все последующие выполнения после первого вычисляются по расписанию (свойство schedule). 
   
1. Затем выполнения будут производиться в таком порядке: 
   
   1. 11.04.2015 в 14:00;
   1. 13.04.2015 в 14:00; 
   1. 15.04.2015 в 14:00;
   1. и т. д.

1. И, наконец, если у задания есть расписание, а часы и минуты в нем не указаны, по умолчанию в качестве значений используются часы и минуты первого выполнения данного задания соответственно.

<a name="schedule"></a>

## <a name="details-schedule"></a>Сведения о параметре schedule

С помощью параметра **schedule** можно *ограничить* число выполнений задания. Например, если, согласно параметру schedule, задание с ежемесячной **частотой** должно выполняться только на 31-й день месяца, оно будет выполняться только в те месяцы, в которых есть 31-е число.

Кроме того, с помощью параметра **schedule** можно *увеличить* число выполнений задания. Например, если, согласно параметру schedule, задание с ежемесячной **частотой** должно выполняться в 1 и 2 день месяца, оно будет выполняться первого и второго числа каждого месяца, а не один раз в месяц.

Если для параметра schedule задано несколько элементов, они применяются в порядке от большего к меньшему: номер недели, число месяца, день недели, час и минута.

В следующей таблице элементы параметра schedule описаны подробно.

| Имя JSON | Описание | Допустимые значения |
|:--- |:--- |:--- |
| **minutes** |Минуты часа, в которые выполняется задание. |Массив целых чисел. |
| **hours** |Часы дня, в которые выполняется задание. |Массив целых чисел. |
| **weekDays** |Дни недели, в которые выполняется задание. Указываются только при выборе еженедельной частоты. |Массив любого из следующих значений (максимальный размер массива — 7):<br />— monday;<br />— tuesday;<br />— wednesday;<br />— thursday;<br />— friday;<br />— saturday;<br />— sunday.<br /><br />Без учета регистра. |
| **monthlyOccurrences** |Определяет, в какие числа месяца выполняется задание. Указываются только при выборе ежемесячной частоты. |Массив объектов **monthlyOccurrences**:<br /> `{ "day": day, "occurrence": occurrence}`<br /><br /> **day** — это день недели, в который выполняется задание. Например, *{Sunday}* означает каждое воскресенье месяца. Обязательный.<br /><br />**occurrence** — это появление указанного дня в течение месяца. Например, *{Sunday, -1}* означает последнее воскресенье месяца. Необязательный элемент. |
| **monthDays** |День месяца, в который выполняется задание. Указываются только при выборе ежемесячной частоты. |Массив следующих значений:<br />— любое значение <= -1 и >= -31;<br />— любое значение >= 1 и <= 31.|

## <a name="examples-recurrence-schedules"></a>Примеры: расписания повторений

В указанных ниже примерах показаны различные расписания повторений с применением объекта schedule и его подэлементов.

Предполагается, что в этих расписаниях параметр **interval** имеет значение 1\.. Кроме того, в примерах предполагается использование правильных значений параметра **frequency**, соответствующих значениям параметра **schedule**. Например, использовать ежедневную **частоту** и параметр **monthDays** в одном **расписании** нельзя. Эти ограничения описаны ранее в этой статье.

| Пример | Описание |
|:--- |:--- |
| `{"hours":[5]}` |Задание выполняется каждый день в 05:00.<br /><br />Планировщик соотносит каждое значение параметра hours с каждым значением параметра minutes и создает список всех моментов, когда выполняется задание. |
| `{"minutes":[15], "hours":[5]}` |Выполняется каждый день в 05:15. |
| `{"minutes":[15], "hours":[5,17]}` |Выполняется каждый день в 05:15 и 16:15. |
| `{"minutes":[15,45], "hours":[5,17]}` |Выполняется каждый день в 05:15, 05:45, 16:15 и 16:45. |
| `{"minutes":[0,15,30,45]}` |Выполнение каждые 15 минут. |
| `{hours":[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23]}` |Выполнение каждый час.<br /><br />Это задание выполняется каждый час. Если указано значение параметра **startTime**, оно определяет минуты выполнения задания. Если значение **startTime** не указано, управление минутами осуществляется в соответствии с временем создания. Например, если задание было запущено или создано (в зависимости от того, какой параметр применяется) в 12:25, задание выполняется в 00:25, 01:25, 02:25, ..., 23:25.<br /><br />Это расписание работает так же, как если бы параметр **frequency** имел значение hour, параметр **interval** — значение 1, а параметр **schedule** был не задан. Отличие в том, что вы можете использовать это расписание для создания заданий с другими значениями параметров **frequency** и **interval**. Например, если параметр **frequency** имеет значение month, расписание выполняется раз в месяц, а не каждый день (если параметр **frequency** имеет значение day). |
| `{minutes:[0]}` |Задание выполняется с наступлением каждого часа.<br /><br />Это задание также выполняется каждый час, но ровно в момент его наступления (в 00:00, 01:00, 02:00 и т. д.). Оно эквивалентно заданию, в котором параметр **frequency** имеет значение hour, значение параметра **startTime** указано с нулевыми минутами, а **schedule** не задано (параметр frequency имеет значение day). Однако, если значение **frequency** равно week или month, расписание выполняется только один раз в неделю или один раз в месяц соответственно. |
| `{"minutes":[15]}` |Задание выполняется через 15 минут после наступления каждого часа.<br /><br />Задание выполняется каждый час, начиная с 00:15, 01:15, 02:15 и т. д. и заканчивая 23:15. |
| `{"hours":[17], "weekDays":["saturday"]}` |Задание выполняется в 17:00 каждую субботу. |
| `{hours":[17], "weekDays":["monday", "wednesday", "friday"]}` |Задание выполняется в 17:00 в каждые понедельник, среду и пятницу. |
| `{"minutes":[15,45], "hours":[17], "weekDays":["monday", "wednesday", "friday"]}` |Задание выполняется в 17:15 и 17:45 в каждые понедельник, среду и пятницу. |
| `{"hours":[5,17], "weekDays":["monday", "wednesday", "friday"]}` |Задание выполняется в 05:00 и 17:00 в каждые понедельник, среду и пятницу. |
| `{"minutes":[15,45], "hours":[5,17], "weekDays":["monday", "wednesday", "friday"]}` |Задание выполняется в 05:15, 05:45, 17:15 и 17:45 в каждые понедельник, среду и пятницу. |
| `{"minutes":[0,15,30,45], "weekDays":["monday", "tuesday", "wednesday", "thursday", "friday"]}` |Задание выполняется каждые 15 минут в каждый рабочий день. |
| `{"minutes":[0,15,30,45], "hours": [9, 10, 11, 12, 13, 14, 15, 16] "weekDays":["monday", "tuesday", "wednesday", "thursday", "friday"]}` |Задание выполняется каждые 15 минут в период с 09:00 до 16:45 в каждый рабочий день. |
| `{"weekDays":["sunday"]}` |Задание выполняется по воскресеньям в указанное время начала. |
| `{"weekDays":["tuesday", "thursday"]}` |Задание выполняется по вторникам и четвергам в указанное время начала. |
| `{"minutes":[0], "hours":[6], "monthDays":[28]}` |Задание выполняется в 6 утра 28-го дня каждого месяца (при условии, что значение **frequency** — "month"). |
| `{"minutes":[0], "hours":[6], "monthDays":[-1]}` |Задание выполняется в 6:00 в последний день месяца.<br /><br />Если вы хотите, чтобы задание выполнялось в последний день месяца, используйте -1 вместо значения 28, 29, 30 или 31. |
| `{"minutes":[0], "hours":[6], "monthDays":[1,-1]}` |Задание выполняется в 6:00 в первый и последний день каждого месяца. |
| `{monthDays":[1,-1]}` |Задание выполняется в первый и последний день каждого месяца в указанное время начала. |
| `{monthDays":[1,14]}` |Задание выполняется в первый и 14-й день каждого месяца в указанное время начала. |
| `{monthDays":[2]}` |Задание выполняется во второй день месяца в указанное время начала. |
| `{"minutes":[0], "hours":[5], "monthlyOccurrences":[{"day":"friday", "occurrence":1}]}` |Задание выполняется в первую пятницу каждого месяца в 05:00. |
| `{"monthlyOccurrences":[{"day":"friday", "occurrence":1}]}` |Задание выполняется в первую пятницу каждого месяца в указанное время начала. |
| `{"monthlyOccurrences":[{"day":"friday", "occurrence":-3}]}` |Задание выполняется в третью пятницу с конца каждого месяца в указанное время начала. |
| `{"minutes":[15], "hours":[5], "monthlyOccurrences":[{"day":"friday", "occurrence":1},{"day":"friday", "occurrence":-1}]}` |Задание выполняется в первую и последнюю пятницу каждого месяца в 05:15. |
| `{"monthlyOccurrences":[{"day":"friday", "occurrence":1},{"day":"friday", "occurrence":-1}]}` |Задание выполняется первую и последнюю пятницу каждого месяца в указанное время начала. |
| `{"monthlyOccurrences":[{"day":"friday", "occurrence":5}]}` |Задание выполняется в пятую пятницу каждого месяца в указанное время начала.<br /><br />Оно не выполняется, если пятой пятницы в месяце нет. Если вы хотите, чтобы задание выполнялось в последнюю пятницу месяца, используйте вместо значения 5 значение -1. |
| `{"minutes":[0,15,30,45], "monthlyOccurrences":[{"day":"friday", "occurrence":-1}]}` |Задание выполняется каждые 15 минут в последнюю пятницу месяца. |
| `{"minutes":[15,45], "hours":[5,17], "monthlyOccurrences":[{"day":"wednesday", "occurrence":3}]}` |Задание выполняется в 05:15, 05:45, 17:15, 17:45 в третью среду каждого месяца. |

## <a name="next-steps"></a>Дальнейшие действия

* [Основные понятия, терминология и иерархия сущностей планировщика Azure](scheduler-concepts-terms.md)
* [Справочник по API REST планировщика Azure](/rest/api/scheduler)
* [Справочник по командлетам PowerShell планировщика Azure](scheduler-powershell-reference.md)
* [Ограничения, значения по умолчанию и коды ошибок планировщика Azure](scheduler-limits-defaults-errors.md)