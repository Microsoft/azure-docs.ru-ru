---
title: Резервное копирование данных в Azure с помощью Commvault
titleSuffix: Azure Storage
description: Общие сведения о факторах, которые следует учитывать, и действиях по использованию Azure в качестве целевого объекта хранилища и расположения восстановления для Commvault завершения резервного копирования и восстановления.
author: karauten
ms.author: karauten
ms.date: 03/15/2021
ms.topic: conceptual
ms.service: storage
ms.subservice: partner
ms.openlocfilehash: ce321574ce2878f51864f55bf5618df2c96d1068
ms.sourcegitcommit: 772eb9c6684dd4864e0ba507945a83e48b8c16f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "104589894"
---
# <a name="backup-to-azure-with-commvault"></a>Резервное копирование в Azure с помощью Commvault

Эта статья поможет вам интегрировать инфраструктуру Commvault с хранилищем BLOB-объектов Azure. Сюда входят предварительные требования, рекомендации, реализация и руководство по эксплуатации. В этой статье рассматривается использование Azure в качестве автономного целевого объекта резервного копирования и сайта восстановления в случае аварии, что предотвращает нормальную работу на основном сайте.

> [!NOTE]
> Commvault предлагает меньшее целевое решение времени восстановления (RTO), Commvault динамическую синхронизацию. Это решение позволяет использовать резервную виртуальную машину, которая помогает быстро восстановиться в случае аварии в рабочей среде Azure. Эти возможности выходят за рамки данного документа.

## <a name="reference-architecture"></a>Эталонная архитектура

На следующей схеме представлена Эталонная архитектура для развертывания из локальной среды в Azure и в среде Azure.

![Commvault на эталонную архитектуру Azure](../media/commvault-diagram.png)

Существующее развертывание Commvault можно легко интегрировать с Azure, добавив учетную запись хранения Azure или несколько учетных записей в качестве целевого объекта облачного хранилища. Commvault также позволяет восстанавливать резервные копии из локальной среды в Azure, предоставляя сайт восстановления по запросу в Azure.

## <a name="commvault-interoperability-matrix"></a>Матрица взаимодействия Commvault

| Рабочая нагрузка | GPv2 и хранилище BLOB-объектов | Поддержка замечательных уровней | Поддержка уровня архива | Поддержка семейства Data Box |
|-----------------------|--------------------|--------------------|-------------------------|-------------------------|
| Локальные виртуальные машины и данные | v 11,5 | v 11,5 | v 11.10 | v 11.10 |
| Виртуальные машины Azure | v 11,5 | v 11,5 | v 11,5 | Н/Д |
| Большой двоичный объект Azure | v 11.6 | v 11.6 | v 11.6 | Н/Д |
| Файлы Azure | v 11.6 | v 11.6 | v 11.6 | Н/Д |

## <a name="before-you-begin"></a>Перед началом

Небольшое предварительное планирование поможет вам использовать Azure как автономный целевой объект резервного копирования и сайт восстановления.

### <a name="get-started-with-azure"></a>Начало работы с Azure

Корпорация Майкрософт предлагает платформу для работы с Azure. [Инфраструктура внедрения в облако](/azure/architecture/cloud-adoption/) (КАФ) — это подробный подход к корпоративному преобразованию и исчерпывающему руководству по планированию внедрения в облако. КАФ содержит пошаговое [руководств по установке Azure](/azure/cloud-adoption-framework/ready/azure-setup-guide/) , которые помогут вам быстро и безопасно приступить к работе. Интерактивную версию можно найти в [портал Azure](https://portal.azure.com/?feature.quickstart=true#blade/Microsoft_Azure_Resources/QuickstartCenterBlade). Вы найдете примеры архитектур, конкретные рекомендации по развертыванию приложений и бесплатные учебные материалы, которые помогут вам в обеспечении пути к Azure.

### <a name="consider-the-network-between-your-location-and-azure"></a>Рассмотрим сеть между расположением и Azure

При использовании облачных ресурсов для запуска рабочей среды, тестирования и разработки, а также в качестве целевого объекта резервного копирования и сайта восстановления важно понимать требования к пропускной способности при начальном заполнении резервных копий и текущему повседневному переносу.

Azure Data Box предоставляет способ передачи базового плана начального резервного копирования в Azure без дополнительной пропускной способности. Это полезно, если предполагается, что запланированная переоценка займет больше времени, чем можно дождаться. Средство оценки Передача данных можно использовать при создании учетной записи хранения, чтобы оценить время, необходимое для перемещения начальной резервной копии.

![Отображение средства оценки передачи данных в службе хранилища Azure на портале.](../media/az-storage-transfer.png)

Помните, что вам потребуется достаточный объем сети для поддержки ежедневной передачи данных в обязательном окне передачи (окно резервного копирования) без влияния на рабочие приложения. В этом разделе описаны средства и методы, доступные для оценки потребностей сети.

#### <a name="determine-how-much-bandwidth-youll-need"></a>Определение необходимого объема пропускной способности

Чтобы определить требуемый объем пропускной способности, используйте следующие ресурсы:

- Отчеты из программного обеспечения для резервного копирования.
- Commvault предоставляет стандартные отчеты для определения [частоты изменений](https://documentation.commvault.com/commvault/v11_sp19/article?p=39699.htm) и [общего размера резервного набора данных](https://documentation.commvault.com/commvault/v11_sp19/article?p=39621.htm) для начальной передачи базовых показателей в Azure.
- Резервное копирование программно-независимых средств оценки и создания отчетов, например:
  - [митренд](https://mitrend.com/)
  - [аптаре](https://www.veritas.com/insights/aptare-it-analytics)
  - [датавосс](https://www.datavoss.com/)

#### <a name="determine-unutilized-internet-bandwidth"></a>Определение неиспользованной пропускной способности Интернета

Важно иметь представление о том, как часто неиспользуемая пропускная способность (или *запас* ресурсов) доступна для ежедневного использования. Это поможет вам оценить, можно ли отвечать на следующие задачи:

- начальное время загрузки, если вы не используете Azure Data Box для автономного заполнения
- выполнение ежедневного резервного копирования на основе частоты изменений, определенной ранее, и окна резервного копирования

Используйте следующие методы, чтобы указать, насколько пропускная способность будет свободна для использования резервных копий в Azure.

- Если вы уже являетесь клиентом Azure ExpressRoute, просмотрите сведения [об использовании канала](../../../../../expressroute/expressroute-monitoring-metrics-alerts.md#circuits-metrics) в портал Azure.
- Обратитесь к поставщику услуг Интернета. Они должны иметь возможность совместно использовать отчеты, отображающие текущие ежедневные и ежемесячные показатели использования.
- Существует несколько средств, которые могут измерять использование за счет мониторинга сетевого трафика на уровне маршрутизатора или коммутатора. Сюда входит следующее.
  - [Пакет анализатора пропускной способности соларвиндс](https://www.solarwinds.com/network-bandwidth-analyzer-pack?CMP=ORG-BLG-DNS)
  - [Паесслер ПРТГ](https://www.paessler.com/bandwidth_monitoring)
  - [Помощник по сети Cisco](https://www.cisco.com/c/en/us/products/cloud-systems-management/network-assistant/index.html)
  - [Вхатсуп Gold](https://www.whatsupgold.com/network-traffic-monitoring)

### <a name="choose-the-right-storage-options"></a>Выберите правильные параметры хранилища

При использовании Azure в качестве целевого объекта резервного копирования вы будете использовать [хранилище BLOB-объектов Azure](../../../../blobs/storage-blobs-introduction.md). Хранилище BLOB-объектов — это решение Майкрософт для хранения объектов. Хранилище BLOB-объектов оптимизировано для хранения огромных объемов неструктурированных данных, которые не соответствуют ни одной модели данных или определению. Кроме того, служба хранилища Azure является устойчивой, высокодоступной, безопасной и масштабируемой. Вы можете выбрать подходящее хранилище для рабочей нагрузки, чтобы обеспечить [уровень устойчивости](../../../../common/storage-redundancy.md) в соответствии с вашими внутренними соглашениями об уровне обслуживания. Хранилище BLOB-объектов — это служба оплаты за использование. Плата выставляются [ежемесячно](../../../../blobs/storage-blob-storage-tiers.md#pricing-and-billing) по объему хранящихся данных, доступу к этим данным и, в случае с уровнями "холодное" и "архивный", минимально необходимым сроком хранения. Параметры устойчивости и уровней, применимые к резервным данным, приведены в следующих таблицах.

**Варианты устойчивости хранилища BLOB-объектов:**

|  |Локально избыточное  |Избыточность между зонами  |Геоизбыточное хранилище  |Геоизбыточная зона  |
|---------|---------|---------|---------|---------|
|**Действующие числа копий**     | 3         | 3         | 6         | 6 |
|**число зон доступности**     | 1         | 3         | 2         | 4 |
|**число регионов**     | 1         | 1         | 2         | 2 |
|**Переход на другой ресурс вручную в дополнительный регион**     | Н/Д         | Н/Д         | Да         | Да |

**Уровни хранилища BLOB-объектов:**

|  | Горячий уровень   |Изящный уровень   | Архивный уровень доступа |
| ----------- | ----------- | -----------  | -----------  |
| **Доступность** | 99,9 %         | 99 %         | Автономная миграция      |
| **Плата за использование** | Более высокие затраты на хранение, снижение уровня доступа и затраты на транзакции | Ниже стоимость хранения, выше расходы на доступ и транзакции | Ниже стоимость хранения, очень высокие расходы на доступ и транзакции |
| **Требуется минимальное хранение данных**| Н/Д | 30 дней | 180 дней |
| **Задержка (время до первого байта)** | Миллисекунды | Миллисекунды | Часы |

#### <a name="sample-backup-to-azure-cost-model"></a>Пример резервного копирования в модель стоимости Azure

Оплата за использование может быть непростой для клиентов, не знакомых с облаком. Хотя вы платите только за используемую емкость, вы также платите за транзакции (чтение и запись) и исходящий трафик [для данных](https://azure.microsoft.com/pricing/details/bandwidth/) , считанных в локальную среду, когда используется [неограниченный локальный тариф Azure Express Route или план данных с прямым маршрутом](https://azure.microsoft.com/pricing/details/expressroute/) , где включены данные из Azure. Вы можете использовать [Калькулятор цен Azure](https://azure.microsoft.com/pricing/calculator/) , чтобы выполнить анализ "что если". Вы можете основываться на ценах на список цен или на основе [зарезервированных ресурсов службы хранилища Azure](../../../../../cost-management-billing/reservations/save-compute-costs-reservations.md), которые могут доставлять до 38% экономии. Ниже приведен пример использования ценовой категории для моделирования ежемесячных затрат на резервное копирование в Azure. Это лишь пример. *Ваши цены могут отличаться в зависимости от действий, которые не регистрируются здесь.*

|Коэффициент стоимости  |Ежемесячные затраты  |
|---------|---------|
|100 ТБ данных резервного копирования в очень удобном хранилище     |$1556,48         |
|2 ТБ новых данных, записанных в день x 30 дней     |$39 в транзакциях          |
|Ежемесячная оценочная сумма     |$1595,48         |
|---------|---------|
|Восстановление из 5 ТБ в локальную сеть через общедоступный Интернет   | $491,26         |

> [!NOTE]
> Эта оценка была создана в калькуляторе цен Azure с использованием Восточной цены с оплатой по мере использования и основана на Commvault по умолчанию размером 32 МБ, что приводит к формированию 65 536 запросов (записи транзакций) в день. Этот пример может быть неприменим к вашим требованиям.

## <a name="implementation-guidance"></a>Рекомендации по реализации

В этом разделе содержится краткое руководство по добавлению службы хранилища Azure в локальное развертывание Commvault. Подробные рекомендации и рекомендации по планированию см. в [руководстве по архитектуре Commvault в общедоступном облаке для Microsoft Azure](https://documentation.commvault.com/commvault/v11/others/pdf/public-cloud-architecture-guide-for-microsoft-azure11-19.pdf).

1. Откройте портал Azure и выполните поиск **учетных записей хранения**. Можно также щелкнуть значок **учетные записи хранения** по умолчанию.

    ![Показывает добавление учетных записей хранения в портал Azure.](../media/azure-portal.png)
  
    ![Показывает, где вы ввели хранилище в поле поиска портал Azure.](../media/locate-storage-account.png)

2. Щелкните **создать** , чтобы добавить учетную запись. Выберите или создайте группу ресурсов, укажите уникальное имя, выберите регион, выберите **Стандартная** производительность, всегда оставляйте тип учетной записи в **хранилище v2**, выберите уровень репликации, соответствующий соглашениям об уровне обслуживания, и уровень по умолчанию, который будет использоваться по для резервного копирования. Учетная запись хранения Azure делает неактивные, интересные и архивные уровни, доступные в рамках одной учетной записи, а политики Commvault позволяют использовать несколько уровней для эффективного управления жизненным циклом данных.

    ![Отображение параметров учетной записи хранения на портале](../media/account-create-1.png)

3. Примите параметры сети по умолчанию и переходите к **защите данных**. Здесь можно включить обратимое удаление, которое позволяет восстанавливать случайно удаленный файл резервной копии в течение определенного срока хранения и обеспечивает защиту от случайного или вредоносного удаления.

    ![Отображает параметры защиты данных на портале.](../media/account-create-2.png)

4. Далее мы рекомендуем использовать параметры по умолчанию на **дополнительном** экране для резервного копирования в сценарии использования Azure.

    ![Отображает вкладку Дополнительные параметры на портале.](../media/account-create-3.png)

5. Добавьте теги для Организации при использовании тегов и создании учетной записи.

6. Прежде чем добавлять учетную запись в среду Commvault, необходимо выполнить два быстрых действия. Перейдите к учетной записи, созданной в портал Azure, и выберите **контейнеры** в меню **Служба BLOB-объектов** . Добавьте контейнер и выберите понятное имя. Затем перейдите к элементу " **ключи доступа** " в разделе " **Параметры** " и скопируйте **имя учетной записи хранения** и один из двух ключей доступа. В следующих шагах потребуется имя контейнера, имя учетной записи и ключ доступа.

    ![Показывает создание контейнера на портале.](../media/container.png)

    ![Показывает параметры ключа доступа на портале.](../media/access-key.png)

7. (*Необязательно*) В развертывание можно добавить дополнительные уровни безопасности.

    1. Настройте доступ на основе ролей, чтобы ограничить пользователей, которые могут вносить изменения в учетную запись хранения. Дополнительные сведения см. [в разделе Встроенные роли для операций управления](../../../../common/authorization-resource-provider.md#built-in-roles-for-management-operations).
    1. Ограничьте доступ к учетной записи на определенные сегменты сети с помощью [параметров брандмауэра хранилища](../../../../common/storage-network-security.md) , чтобы предотвратить попытки доступа за пределами корпоративной сети.

        ![Отображает параметры брандмауэра хранилища на портале.](../media/storage-firewall.png)

    1. Установите [блокировку удаления](../../../../../azure-resource-manager/management/lock-resources.md) для учетной записи, чтобы предотвратить случайное удаление учетной записи хранения.

        ![Показывает настройку блокировки удаления на портале.](../media/resource-lock.png)

    1. Настройте дополнительные рекомендации по [обеспечению безопасности](../../../../../storage/blobs/security-recommendations.md).

1. В центре команд Commvault перейдите к разделу **Управление**  ->  **безопасностью**  ->  **Диспетчер учетных данных**. Выберите **облачную учетную запись**, **тип поставщика** **Служба хранилища Microsoft Azure**, выберите **Медиаажент**, который будет передавать данные в Azure и обратно, добавьте имя учетной записи хранения и ключ доступа.

    ![Показывает добавление учетных данных в центре команд Commvault.](../media/commvault-credential.png)

9. Затем перейдите к **хранилищу**  ->  **Cloud** в центре команд Commvault. Выберите **Добавить**. Введите понятное имя для учетной записи хранения, а затем выберите **Служба хранилища Microsoft Azure** из списка **тип** . Выберите сервер агента мультимедиа, который будет использоваться для передачи резервных копий в службу хранилища Azure. Добавьте созданный контейнер, выберите уровень хранилища для использования в учетной записи хранения Azure и выберите учетные данные, созданные на шаге #8. Наконец, выберите, следует ли передавать недублированные резервные копии или нет, а также расположение базы данных дедупликации.

     ![Снимок экрана: Добавление пользовательского интерфейса Commvault в облако. В раскрывающемся меню Архив выбрано * * Архив * *.](../media/commvault-add-storage.png)

10. Наконец, добавьте новый ресурс службы хранилища Azure в существующий или новый план в центре команд Commvault, используя **Управление**  ->  **планами** в качестве места назначения резервного копирования.

    ![Снимок экрана пользовательского интерфейса центра команд Commvault. В левой области навигации в разделе * * Управление * *, * * планы * * выбрано.](../media/commvault-plan.png)

11. *(Необязательно)* Если вы планируете использовать Azure в качестве сайта для восстановления или Commvault для переноса серверов и приложений в Azure, рекомендуется развернуть прокси-сервер VSA в Azure. Подробные инструкции можно найти [здесь](https://documentation.commvault.com/commvault/v11/article?p=106208.htm).

## <a name="operational-guidance"></a>Операционное руководство

### <a name="azure-alerts-and-performance-monitoring"></a>Оповещения и мониторинг производительности Azure

Рекомендуется отслеживать как ресурсы Azure, так и возможность Commvault использовать их, как и в случае с любым целевым объектом хранилища, которые вы используете для хранения резервных копий. Сочетание средств мониторинга центра команд Azure Monitor и Commvault поможет обеспечить работоспособность вашей среды.

#### <a name="azure-portal"></a>Портал Azure

Azure предоставляет надежное решение для мониторинга в виде [Azure Monitor](../../../../../azure-monitor/essentials/monitor-azure-resource.md). Вы можете [настроить Azure Monitor](../../../../blobs/monitor-blob-storage.md) для мониторинга емкости хранилища Azure, транзакций, доступности, проверки подлинности и многого другого. Полную ссылку на метрики, собранные здесь, можно найти [здесь](../../../../blobs/monitor-blob-storage-reference.md). Ниже приведены несколько полезных метрик, которые необходимо отBlobCapacity, чтобы убедиться, что вы следите за максимальным [предельным значением емкости учетной записи хранения](../../../../common/scalability-targets-standard-account.md), входящим и исходящим, чтобы отвести данные, записываемые в учетную запись хранения Azure и считанные из нее, а также SuccessE2ELatency — для учета времени обмена запросами в службу хранилища Azure и из нее, а также в медиаажент.

Вы также можете [создавать оповещения журнала](../../../../../service-health/alerts-activity-log-service-notifications-portal.md) для трассировки работоспособности службы хранилища Azure и просматривать [панель мониторинга состояния Azure](https://status.azure.com/status) в любое время.

#### <a name="commvault-command-center"></a>Центр команд Commvault

- [Создание оповещения для пулов облачных хранилищ](https://documentation.commvault.com/commvault/v11/article?p=100514_3.htm)
- Сведения о том, где можно просмотреть отчеты о производительности, о завершении заданий и базовом устранении неполадок, см. в разделе [панели мониторинга](https://documentation.commvault.com/commvault/v11/article?p=95306_1.htm).

### <a name="how-to-open-support-cases"></a>Как открыть варианты поддержки

Если вам нужна помощь по резервному копированию в решение Azure, вы должны открыть обращение как с Commvault, так и с Azure. Это помогает организациям службы поддержки совместно работать, если это необходимо.

#### <a name="to-open-a-case-with-commvault"></a>Открытие обращения с Commvault

На [сайте поддержки Commvault](https://www.commvault.com/support)Войдите в систему и откройте обращение.

Сведения о доступных параметрах контракта на поддержку см. в разделе [варианты поддержки Commvault](https://ma.commvault.com/support) .

Вы также можете вызвать в, чтобы открыть обращение, или обратиться в службу поддержки Commvault по электронной почте:

- Бесплатный звонок: + 1 877-780-3077
- [Номера поддержки по всему миру](https://ma.commvault.com/Support/TelephoneSupport)
- [Поддержка электронной почты Commvault](mailto:support@commvault.com)

#### <a name="to-open-a-case-with-azure"></a>Открытие обращения с Azure

В [портал Azure](https://portal.azure.com) искать **поддержку** на панели поиска вверху. Выберите **Справка и поддержка**  ->  **новый запрос в службу поддержки**.

> [!NOTE]
> Когда вы открываете обращение, будьте в том, что вам нужна помощь с хранилищем Azure или сетью Azure. Не указывайте Azure Backup. Azure Backup — это имя службы Azure, и ваш случай будет маршрутизироваться неправильно.

### <a name="links-to-relevant-commvault-documentation"></a>Ссылки на соответствующую документацию по Commvault

Дополнительные сведения см. в следующей документации Commvault:

- [Пользовательское руководством по Commvault](https://documentation.commvault.com/commvault/v11/article?p=37684_1.htm)
- [Commvault по архитектуре Azure](https://www.commvault.com/resources/public-cloud-architecture-guide-for-microsoft-azure-v11-sp16)

### <a name="marketplace-offerings"></a>Предложения Marketplace

Commvault упростила развертывание своего решения в Azure для защиты виртуальных машин Azure и многих других служб Azure. Дополнительные сведения см. в следующих ресурсах.

- [Развертывание Commvault с помощью Azure Marketplace](https://azuremarketplace.microsoft.com/marketplace/apps/commvault.commvault?tab=Overview)
- [Commvault для Azure в режиме таблицы](https://www.commvault.com/resources/microsoft-azure-cloud-platform-datasheet)
- [Список поддерживаемых функций и служб Azure Commvault](https://documentation.commvault.com/commvault/v11/article?p=109795_1.htm)
- [Как использовать Commvault для защиты SAP HANA в Azure](https://azure.microsoft.com/resources/protecting-sap-hana-in-azure/)

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения о специализированных сценариях использования см. в этих дополнительных ресурсах Commvault.

- [Использование Commvault для переноса серверов и приложений в Azure](https://www.commvault.com/resources/demonstration-vmware-to-azure-migrations-with-commvault)
- [Защита SAP в Azure с помощью Commvault](https://www.youtube.com/watch?v=4ZGGE53mGVI)
- [Защита Office 365 с помощью Commvault](https://www.youtube.com/watch?v=dl3nvAacxZU)