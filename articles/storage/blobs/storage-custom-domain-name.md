---
title: Сопоставьте личный домен с конечной точкой хранилища BLOB-объектов Azure
titleSuffix: Azure Storage
description: Сопоставьте личный домен с хранилищем больших двоичных объектов или веб-конечной точкой в учетной записи хранения Azure.
author: normesta
ms.service: storage
ms.topic: how-to
ms.date: 02/12/2021
ms.author: normesta
ms.reviewer: dineshm
ms.subservice: blobs
ms.openlocfilehash: 52fc7b9c1229421fd46b8110857a0a7a8a4f916a
ms.sourcegitcommit: e972837797dbad9dbaa01df93abd745cb357cde1
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/14/2021
ms.locfileid: "100520431"
---
# <a name="map-a-custom-domain-to-an-azure-blob-storage-endpoint"></a>Сопоставьте личный домен с конечной точкой хранилища BLOB-объектов Azure

Вы можете сопоставлять личный домен с конечной точкой службы BLOB-объектов или с конечной точкой для [статического сайта](storage-blob-static-website.md) . 

> [!NOTE] 
> Это сопоставление работает только для поддоменов (например `www.contoso.com` ,). Если вы хотите, чтобы конечная точка веб-узла была доступна в корневом домене (например `contoso.com` ,), необходимо использовать Azure CDN. Инструкции см. в разделе о [сопоставлении пользовательского домена с включенным протоколом HTTPS](#enable-https) этой статьи. Так как вы собираетесь в этот раздел этой статьи, чтобы включить корневой домен личного домена, шаг в этом разделе для включения HTTPS является необязательным. 

<a id="enable-http"></a>

## <a name="map-a-custom-domain-with-only-http-enabled"></a>Сопоставьте личный домен только с включенным протоколом HTTP

Этот подход проще, но разрешает только доступ по протоколу HTTP. Если для учетной записи хранения настроено [требование безопасной передачи](../common/storage-require-secure-transfer.md) по протоколу HTTPS, необходимо включить доступ по протоколу HTTPS для личного домена. 

Сведения о включении доступа по протоколу HTTPS см. в разделе " [сопоставьте пользовательский домен с включенным протоколом HTTPS](#enable-https) " этой статьи. 

<a id="map-a-domain"></a>

### <a name="map-a-custom-domain"></a>Сопоставьте личный домен

> [!IMPORTANT]
> Пользовательский домен будет временно недоступен пользователям, пока вы завершите настройку. Если ваш домен в настоящее время поддерживает приложение с соглашением об уровне обслуживания (SLA), которое требует нулевого времени простоя, выполните действия, описанные в разделе [сопоставление личного домена с нулевым временем простоя](#zero-down-time) этой статьи, чтобы убедиться, что пользователи могут получить доступ к вашему домену во время сопоставления DNS.

Если вы не хотите, чтобы домен был временно недоступен для пользователей, выполните следующие действия.

: heavy_check_mark: шаг 1. Получение имени узла для конечной точки хранилища.

: heavy_check_mark: шаг 2. Создайте запись канонического имени (CNAME) с помощью поставщика домена.

: heavy_check_mark: шаг 3. Зарегистрируйте личный домен в Azure. 

: heavy_check_mark: шаг 4. Протестируйте личный домен.

<a id="endpoint"></a>

#### <a name="step-1-get-the-host-name-of-your-storage-endpoint"></a>Шаг 1. Получение имени узла для конечной точки хранилища 

Имя узла — это URL-адрес конечной точки хранилища без идентификатора протокола и замыкающей косой черты. 

1. Войдите в свою учетную запись хранения на [портале Azure](https://portal.azure.com).

2. В области меню в разделе **Параметры** выберите пункт **свойства**.  

3. Скопируйте значение **основной конечной точки службы больших двоичных объектов** или **основной конечной точки веб-сайта** в текстовый файл. 
  
   > [!NOTE]
   > Конечная точка хранилища Data Lake не поддерживается (например, `https://mystorageaccount.dfs.core.windows.net/` ).

4. Удалите идентификатор протокола (например, `HTTPS` ) и замыкающую косую черту из этой строки. В следующей таблице содержатся примеры.

   | Тип конечной точки |  endpoint | имя узла |
   |------------|-----------------|-------------------|
   |Служба BLOB-объектов  | `https://mystorageaccount.blob.core.windows.net/` | `mystorageaccount.blob.core.windows.net` |
   |Статический веб-сайт  | `https://mystorageaccount.z5.web.core.windows.net/` | `mystorageaccount.z5.web.core.windows.net` |
  
   Установите это значение в дальнейшем.

<a id="create-cname-record"></a>

#### <a name="step-2-create-a-canonical-name-cname-record-with-your-domain-provider"></a>Шаг 2. Создание записи канонического имени (CNAME) с помощью поставщика домена

Создайте запись CNAME, которая будет указывать на имя узла. Запись CNAME — это тип записи службы доменных имен (DNS), которая сопоставляет исходное доменное имя с именем конечного домена.

1. Войдите на веб-сайт регистратора домена, а затем перейдите на страницу для управления параметром DNS.

   Эту страницу можно найти в разделе **Доменное имя**, **DNS** или **Name Server Management** (Управление сервером доменных имен).

2. Найдите раздел для управления записями CNAME. 

   Возможно, потребуется перейти на страницу дополнительных параметров и найти пункты **CNAME**, **Псевдоним** или **Поддомены**.

3. Создайте запись CNAME. В рамках этой записи укажите следующие элементы: 

   - Псевдоним поддомена, например `www` или `photos` . Поддомен является обязательным, корневые домены не поддерживаются. 
      
   - Имя узла, полученное в разделе [Получение имени узла конечной точки хранилища](#endpoint) выше в этой статье. 

<a id="register"></a>

#### <a name="step-3-register-your-custom-domain-with-azure"></a>Шаг 3. Регистрация пользовательского домена в Azure

##### <a name="portal"></a>[Портал](#tab/azure-portal)

1. Войдите в свою учетную запись хранения на [портале Azure](https://portal.azure.com).

2. В области меню в разделе **Служба BLOB-объектов** выберите **Личный домен**.

   > [!NOTE]
   > Этот параметр не отображается в учетных записях, для которых включена функция иерархического пространства имен. Для этих учетных записей используйте PowerShell или Azure CLI для выполнения этого шага.

   ![Параметр пользовательского домена](./media/storage-custom-domain-name/custom-domain-button.png "личный домен")

   Откроется область **Личный домен**.

3. В текстовом поле **доменное имя** введите имя пользовательского домена, включая поддомен.  
   
   Например, если доменом является *contoso.com* , а псевдонимом поддоменом является *www*, введите `www.contoso.com` . Если ваш поддомен — *фотографии*, введите `photos.contoso.com` .

4. Чтобы зарегистрировать личный домен, нажмите кнопку **сохранить** .

   После того как запись CNAME передается через серверы доменных имен (DNS), а пользователи имеют соответствующие разрешения, они могут просматривать данные большого двоичного объекта с помощью пользовательского домена.

##### <a name="powershell"></a>[PowerShell](#tab/azure-powershell)

Выполните следующую команду PowerShell

```powershell
Set-AzStorageAccount -ResourceGroupName <resource-group-name> -Name <storage-account-name> -CustomDomainName <custom-domain-name> -UseSubDomain $false
```

- Замените `<resource-group-name>` заполнитель именем группы ресурсов.

- Замените `<storage-account-name>` заполнитель именем учетной записи хранения.

- Замените `<custom-domain-name>` заполнитель именем пользовательского домена, включая поддомен.

  Например, если доменом является *contoso.com* , а псевдонимом поддоменом является *www*, введите `www.contoso.com` . Если ваш поддомен — *фотографии*, введите `photos.contoso.com` .

После того как запись CNAME передается через серверы доменных имен (DNS), а пользователи имеют соответствующие разрешения, они могут просматривать данные большого двоичного объекта с помощью пользовательского домена.

##### <a name="azure-cli"></a>[Azure CLI](#tab/azure-cli);

Выполните следующую команду PowerShell

```azurecli
az storage account update \
   --resource-group <resource-group-name> \ 
   --name <storage-account-name> \
   --custom-domain <custom-domain-name> \
   --use-subdomain false
  ```

- Замените `<resource-group-name>` заполнитель именем группы ресурсов.

- Замените `<storage-account-name>` заполнитель именем учетной записи хранения.

- Замените `<custom-domain-name>` заполнитель именем пользовательского домена, включая поддомен.

  Например, если доменом является *contoso.com* , а псевдонимом поддоменом является *www*, введите `www.contoso.com` . Если ваш поддомен — *фотографии*, введите `photos.contoso.com` .

После того как запись CNAME передается через серверы доменных имен (DNS), а пользователи имеют соответствующие разрешения, они могут просматривать данные большого двоичного объекта с помощью пользовательского домена.

---

#### <a name="step-4-test-your-custom-domain"></a>Шаг 4. Тестирование пользовательского домена

Чтобы подтвердить, что личный домен сопоставлен с конечной точкой службы BLOB-объектов, создайте большой двоичный объект в общедоступном контейнере учетной записи хранения. Затем, чтобы получить доступ к этому большому двоичному объекту, используйте в веб-браузере URI следующего формата: `http://<subdomain.customdomain>/<mycontainer>/<myblob>`

Например, для доступа к веб-форме в `myforms` контейнере в пользовательском дочернем домене *Photos.contoso.com* можно использовать следующий URI: `http://photos.contoso.com/myforms/applicationform.htm`

<a id="zero-down-time"></a>

### <a name="map-a-custom-domain-with-zero-downtime"></a>Сопоставьте личный домен с нулевым временем простоя

> [!NOTE]
> Если вы не хотите, чтобы домен был временно недоступен для пользователей, рассмотрите возможность использования действий, описанных в разделе " [сопоставьте пользовательский домен](#map-a-domain) " этой статьи. Это более простой подход с меньшим количеством шагов.  

Если ваш домен в настоящее время поддерживает приложение с соглашением об уровне обслуживания (SLA), которое требует нулевого простоя, выполните следующие действия, чтобы убедиться, что пользователи могут получить доступ к вашему домену во время сопоставления DNS. 

: heavy_check_mark: шаг 1. Получение имени узла для конечной точки хранилища.

: heavy_check_mark: шаг 2. Создайте запись промежуточного канонического имени (CNAME) с поставщиком домена.

: heavy_check_mark: шаг 3. Предварительная регистрация пользовательского домена в Azure.

: heavy_check_mark: шаг 4. Создайте запись CNAME с помощью поставщика домена.

: heavy_check_mark: шаг 5. Тестирование пользовательского домена.

<a id="endpoint-2"></a>

#### <a name="step-1-get-the-host-name-of-your-storage-endpoint"></a>Шаг 1. Получение имени узла для конечной точки хранилища 

Имя узла — это URL-адрес конечной точки хранилища без идентификатора протокола и замыкающей косой черты. 

1. Войдите в свою учетную запись хранения на [портале Azure](https://portal.azure.com).

2. В области меню в разделе **Параметры** выберите пункт **свойства**.  

3. Скопируйте значение **основной конечной точки службы больших двоичных объектов** или **основной конечной точки веб-сайта** в текстовый файл. 

   > [!NOTE]
   > Конечная точка хранилища Data Lake не поддерживается (например, `https://mystorageaccount.dfs.core.windows.net/` ).

4. Удалите идентификатор протокола (например, `HTTPS` ) и замыкающую косую черту из этой строки. В следующей таблице содержатся примеры.

   | Тип конечной точки |  endpoint | имя узла |
   |------------|-----------------|-------------------|
   |Служба BLOB-объектов  | `https://mystorageaccount.blob.core.windows.net/` | `mystorageaccount.blob.core.windows.net` |
   |Статический веб-сайт  | `https://mystorageaccount.z5.web.core.windows.net/` | `mystorageaccount.z5.web.core.windows.net` |
  
   Установите это значение в дальнейшем.

#### <a name="step-2-create-an-intermediary-canonical-name-cname-record-with-your-domain-provider"></a>Шаг 2. Создайте запись промежуточного канонического имени (CNAME) с помощью поставщика домена.

Создайте временную запись CNAME, чтобы она указывала на имя узла. Запись CNAME — это тип записи DNS, позволяющий сопоставить имена исходного и конечного доменов.

1. Войдите на веб-сайт регистратора домена, а затем перейдите на страницу для управления параметром DNS.

   Эту страницу можно найти в разделе **Доменное имя**, **DNS** или **Name Server Management** (Управление сервером доменных имен).

2. Найдите раздел для управления записями CNAME. 

   Возможно, потребуется перейти на страницу дополнительных параметров и найти пункты **CNAME**, **Псевдоним** или **Поддомены**.

3. Создайте запись CNAME. В рамках этой записи укажите следующие элементы: 

   - Псевдоним поддомена, например `www` или `photos` . Поддомен является обязательным, корневые домены не поддерживаются.

     Добавьте `asverify` поддомен в псевдоним. Пример: `asverify.www` или `asverify.photos`.
       
   - Имя узла, полученное в разделе [Получение имени узла конечной точки хранилища](#endpoint) выше в этой статье. 

     Добавьте поддомен `asverify` в имя узла. Например: `asverify.mystorageaccount.blob.core.windows.net`.

#### <a name="step-3-pre-register-your-custom-domain-with-azure"></a>Шаг 3. Предварительная регистрация пользовательского домена в Azure

При предварительной регистрации личного домена в Azure вы разрешаете Azure распознавать личный домен без изменения записи DNS для этого домена. Таким образом, при изменении записи DNS для домена она будет сопоставлена с конечной точкой большого двоичного объекта без простоев.

##### <a name="portal"></a>[Портал](#tab/azure-portal)

1. Войдите в свою учетную запись хранения на [портале Azure](https://portal.azure.com).

2. В области меню в разделе **Служба BLOB-объектов** выберите **Личный домен**.

   > [!NOTE]
   > Этот параметр не отображается в учетных записях, для которых включена функция иерархического пространства имен. Для этих учетных записей используйте PowerShell или Azure CLI для выполнения этого шага.

   ![Параметр пользовательского домена](./media/storage-custom-domain-name/custom-domain-button.png "личный домен")

   Откроется область **Личный домен**.

3. В текстовом поле **доменное имя** введите имя пользовательского домена, включая поддомен.  
   
   Например, если доменом является *contoso.com* , а псевдонимом поддоменом является *www*, введите `www.contoso.com` . Если ваш поддомен — *фотографии*, введите `photos.contoso.com` .

4. Установите флажок **Использовать непрямую проверку CNAME**.

5. Чтобы зарегистрировать личный домен, нажмите кнопку **сохранить** .
  
   Если регистрация прошла успешно, появится уведомление портала о том, что учетная запись хранения успешно обновлена. Ваш личный домен проверен Azure, но трафик в ваш домен еще не направляется в вашу учетную запись хранения, пока вы не создадите запись CNAME у поставщика домена. Это будет сделано в следующем разделе.

##### <a name="powershell"></a>[PowerShell](#tab/azure-powershell)

Выполните следующую команду PowerShell

```powershell
Set-AzStorageAccount -ResourceGroupName <resource-group-name> -Name <storage-account-name> -CustomDomainName <custom-domain-name> -UseSubDomain $true
```

- Замените `<resource-group-name>` заполнитель именем группы ресурсов.

- Замените `<storage-account-name>` заполнитель именем учетной записи хранения.

- Замените `<custom-domain-name>` заполнитель именем пользовательского домена, включая поддомен.

  Например, если доменом является *contoso.com* , а псевдонимом поддоменом является *www*, введите `www.contoso.com` . Если ваш поддомен — *фотографии*, введите `photos.contoso.com` .

Трафик к вашему домену еще не направляется в вашу учетную запись хранения, пока вы не создадите запись CNAME у поставщика домена. Это будет сделано в следующем разделе.

##### <a name="azure-cli"></a>[Azure CLI](#tab/azure-cli);

Выполните следующую команду PowerShell

```azurecli
az storage account update \
   --resource-group <resource-group-name> \ 
   --name <storage-account-name> \
   --custom-domain <custom-domain-name> \
   --use-subdomain true
  ```

- Замените `<resource-group-name>` заполнитель именем группы ресурсов.

- Замените `<storage-account-name>` заполнитель именем учетной записи хранения.

- Замените `<custom-domain-name>` заполнитель именем пользовательского домена, включая поддомен.

  Например, если доменом является *contoso.com* , а псевдонимом поддоменом является *www*, введите `www.contoso.com` . Если ваш поддомен — *фотографии*, введите `photos.contoso.com` .

Трафик к вашему домену еще не направляется в вашу учетную запись хранения, пока вы не создадите запись CNAME у поставщика домена. Это будет сделано в следующем разделе.

---

#### <a name="step-4-create-a-cname-record-with-your-domain-provider"></a>Шаг 4. Создание записи CNAME с помощью поставщика домена

Создайте временную запись CNAME, чтобы она указывала на имя узла.

1. Войдите на веб-сайт регистратора домена, а затем перейдите на страницу для управления параметром DNS.

   Эту страницу можно найти в разделе **Доменное имя**, **DNS** или **Name Server Management** (Управление сервером доменных имен).

2. Найдите раздел для управления записями CNAME. 

   Возможно, потребуется перейти на страницу дополнительных параметров и найти пункты **CNAME**, **Псевдоним** или **Поддомены**.

3. Создайте запись CNAME. В рамках этой записи укажите следующие элементы: 

   - Псевдоним поддомена, например `www` или `photos` . Поддомен является обязательным, корневые домены не поддерживаются.
      
   - Имя узла, полученное в разделе [Получение имени узла конечной точки хранилища](#endpoint-2) выше в этой статье. 

#### <a name="step-5-test-your-custom-domain"></a>Шаг 5. Тестирование пользовательского домена

Чтобы подтвердить, что личный домен сопоставлен с конечной точкой службы BLOB-объектов, создайте большой двоичный объект в общедоступном контейнере учетной записи хранения. Затем, чтобы получить доступ к этому большому двоичному объекту, используйте в веб-браузере URI следующего формата: `http://<subdomain.customdomain>/<mycontainer>/<myblob>`

Например, для доступа к веб-форме в `myforms` контейнере в пользовательском дочернем домене *Photos.contoso.com* можно использовать следующий URI: `http://photos.contoso.com/myforms/applicationform.htm`

### <a name="remove-a-custom-domain-mapping"></a>Удаление сопоставления пользовательского домена

Чтобы удалить сопоставление пользовательского домена, отмените регистрацию пользовательского домена. Используйте одну из следующих процедур.

#### <a name="portal"></a>[Портал](#tab/azure-portal)

1. Войдите в свою учетную запись хранения на [портале Azure](https://portal.azure.com).

2. В области меню в разделе **Служба BLOB-объектов** выберите **Личный домен**.  
   Откроется область **Личный домен**.

3. Очистите содержимое текстового поля, в котором указано имя вашего личного домена.

4. Нажмите кнопку **Сохранить**.

После успешного удаления личного домена появится уведомление портала о том, что ваша учетная запись хранения успешно обновлена.

#### <a name="powershell"></a>[PowerShell](#tab/azure-powershell)

[!INCLUDE [updated-for-az](../../../includes/updated-for-az.md)]

Воспользуйтесь командлетом PowerShell [Set-AzStorageAccount](/powershell/module/az.storage/set-azstorageaccount) и укажите пустую строку (`""`) для значения аргумента `-CustomDomainName`, чтобы отменить регистрацию личного домена.

* Формат команды:

  ```powershell
  Set-AzStorageAccount `
      -ResourceGroupName "<resource-group-name>" `
      -AccountName "<storage-account-name>" `
      -CustomDomainName ""
  ```

* Пример команды:

  ```powershell
  Set-AzStorageAccount `
      -ResourceGroupName "myresourcegroup" `
      -AccountName "mystorageaccount" `
      -CustomDomainName ""
  ```

#### <a name="azure-cli"></a>[Azure CLI](#tab/azure-cli);

Воспользуйтесь командой интерфейса командной строки [az storage account update](/cli/azure/storage/account) и укажите пустую строку (`""`) в качестве значения аргумента `--custom-domain`, чтобы отменить регистрацию личного домена.

* Формат команды:

  ```azurecli
  az storage account update \
      --name <storage-account-name> \
      --resource-group <resource-group-name> \
      --custom-domain ""
  ```

* Пример команды:

  ```azurecli
  az storage account update \
      --name mystorageaccount \
      --resource-group myresourcegroup \
      --custom-domain ""
  ```
---

<a id="enable-https"></a>

## <a name="map-a-custom-domain-with-https-enabled"></a>Сопоставьте личный домен с включенным протоколом HTTPS

Этот подход требует больше шагов, но обеспечивает доступ по протоколу HTTPS. 

Если пользователям не требуется доступ к Вашему большому двоичному объекту или веб-контенту по протоколу HTTPS, см. раздел [Map a личного домена with только HTTP Enabled](#enable-http) этой статьи. 

1. Включите [Azure CDN](../../cdn/cdn-overview.md) для большого двоичного объекта или веб-конечной точки. 

   Сведения о конечной точке хранилища BLOB-объектов см. в статье [Интеграция учетной записи хранения Azure с Azure CDN](../../cdn/cdn-create-a-storage-account-with-cdn.md). 

   Сведения о статической конечной точке веб-сайта см. в статье [интеграция статического веб-сайта с Azure CDN](static-website-content-delivery-network.md).

2. [Сопоставление содержимого Azure CDN с личным доменом](../../cdn/cdn-map-content-to-custom-domain.md).

3. [Включите протокол HTTPS в Azure CDN пользовательском домене](../../cdn/cdn-custom-ssl.md).

   > [!NOTE] 
   > При обновлении статического веб-сайта не забудьте очистить кэшированное содержимое на пограничных серверах CDN, выполнив очистку конечной точки CDN. Дополнительные сведения см. в статье [Очистка конечной точки сети CDN Azure](../../cdn/cdn-purge-endpoint.md).

4. Используемых Ознакомьтесь со следующими рекомендациями.

   * [Токены подписанного URL-доступа (SAS) с Azure CDN](../../cdn/cdn-storage-custom-domain-https.md#shared-access-signatures).

   * [Перенаправление HTTP-to-HTTPS с Azure CDN](../../cdn/cdn-storage-custom-domain-https.md#http-to-https-redirection).

   * [Цены и выставление счетов при использовании хранилища BLOB-объектов с Azure CDN](../../cdn/cdn-storage-custom-domain-https.md#http-to-https-redirection).

## <a name="next-steps"></a>Дальнейшие шаги

* [Дополнительные сведения о размещении статических веб-сайтов в хранилище больших двоичных объектов Azure](storage-blob-static-website.md)