---
title: Мониторинг и устранение неполадок приложения облачного хранилища в Azure | Документация Майкрософт
description: Мониторинг и устранение неполадок облачного приложения с помощью инструментов диагностики, метрик и оповещений.
author: normesta
ms.service: storage
ms.subservice: blobs
ms.topic: tutorial
ms.date: 07/20/2018
ms.author: normesta
ms.reviewer: fryu
ms.openlocfilehash: 6c1d9b813db15900521968865c1036d53ad53f41
ms.sourcegitcommit: 867cb1b7a1f3a1f0b427282c648d411d0ca4f81f
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "95544791"
---
# <a name="monitor-and-troubleshoot-a-cloud-storage-application"></a>Мониторинг и устранение неполадок приложения облачного хранилища

Это руководство является четвертой и последней частью цикла. В этом руководстве показано, как выполнять мониторинг и устранение неполадок приложения облачного хранилища.

В четвертой части цикла вы узнаете, как выполнять такие задачи:

> [!div class="checklist"]
> * Включение ведения журнала и метрик
> * включение оповещений для ошибок авторизации;
> * выполнение тестирования трафика с помощью неверных маркеров SAS;
> * скачивание и анализ журналов.

[Azure Storage Analytics](../common/storage-analytics.md) ведет журнал и предоставляет данные метрик для учетной записи хранения. По этим данным можно определить состояние работоспособности учетной записи хранения. Для сбора данных из службы "Аналитика Службы хранилища Azure" можно настроить ведение журналов, метрики и оповещения. Этот процесс предполагает включение ведения журнала, настройку метрик и включение предупреждений.

Ведение журнала и метрик для учетных записей хранения можно включить на вкладке **Диагностика** на портале Azure. Ведение журналов хранилища позволяет записывать сведения об успешных и неудачных запросах в вашей учетной записи хранения. Из этих журналов можно получить подробные сведения об операциях чтения, записи удаления в таблицах Azure, очередях и больших двоичных объектах. Они также позволяют выявить причины невыполнения запросов, таких как превышение времени ожидания, ошибки регулирования и авторизации.

## <a name="log-in-to-the-azure-portal"></a>Войдите на портал Azure.

Войдите на [портал Azure](https://portal.azure.com)

## <a name="turn-on-logging-and-metrics"></a>Включение ведения журнала и метрик

В меню слева щелкните **Группы ресурсов**, а затем — **myResourceGroup** и выберите свою учетную запись хранения в списке ресурсов.

В разделе **Параметры диагностики (классические)** установите для параметра **Состояние** значение **Вкл.** Убедитесь, что все параметры в разделе **Свойства большого двоичного объекта** включены.

Затем нажмите кнопку **Сохранить**.

![Снимок экрана, на котором выделен раздел с параметрами конфигурации для включения ведения журнала и выбора метрик.](media/storage-monitor-troubleshoot-storage-application/enable-diagnostics.png)

## <a name="enable-alerts"></a>Включение оповещений

Оповещения предоставляют возможность отправить сообщение электронной почты администраторам или активировать веб-перехватчик, если метрика превысила пороговое значение. В этом примере включается оповещение для метрики `SASClientOtherError`.

### <a name="navigate-to-the-storage-account-in-the-azure-portal"></a>Переход к учетной записи хранения на портале Azure

В разделе **Мониторинг** выберите **Оповещения (классические)** .

Выберите **Добавить оповещение метрики (классическое)** и заполните форму **Добавление правила**, указав необходимые сведения. В раскрывающемся списке **Метрика** выберите `SASClientOtherError`. Чтобы оповещение срабатывало после первой ошибки, в раскрывающемся списке **Условие** выберите **Больше или равно**.

![Область диагностики](media/storage-monitor-troubleshoot-storage-application/add-alert-rule.png)

## <a name="simulate-an-error"></a>Имитация ошибки

Для имитации действительного оповещения можно попытаться запросить несуществующий большой двоичный объект из учетной записи хранения. Для следующей команды требуется имя контейнера хранилища. В этом примере можно указать имя существующего контейнера или создать новое.

Замените заполнители реальными значениями (убедитесь, что для `<INCORRECT_BLOB_NAME>` задано уникальное значение) и выполните команду.

```azurecli-interactive
sasToken=$(az storage blob generate-sas \
    --account-name <STORAGE_ACCOUNT_NAME> \
    --account-key <STORAGE_ACCOUNT_KEY> \
    --container-name <CONTAINER_NAME> \
    --name <INCORRECT_BLOB_NAME> \
    --permissions r \
    --expiry `date --date="next day" +%Y-%m-%d`)

curl https://<STORAGE_ACCOUNT_NAME>.blob.core.windows.net/<CONTAINER_NAME>/<INCORRECT_BLOB_NAME>?$sasToken
```

На следующем изображении представлен пример предупреждения, основанного на имитированном сбое из предыдущего примера.

 ![Пример оповещения](media/storage-monitor-troubleshoot-storage-application/email-alert.png)

## <a name="download-and-view-logs"></a>Скачивание и просмотр журналов

Журналы хранилища хранят данные в наборе больших двоичных объектов в контейнере BLOB-объектов **$logs** в учетной записи хранения. Этот контейнер не отображается в списке всех контейнеров больших двоичных объектов в учетной записи, но его содержимое можно просмотреть, если обратиться к нему напрямую.

В этом сценарии [Microsoft Message Analyzer](/message-analyzer/microsoft-message-analyzer-operating-guide) используется для взаимодействия с учетной записью хранения Azure.

### <a name="download-microsoft-message-analyzer"></a>Скачивание Microsoft Message Analyzer

Скачайте [Microsoft Message Analyzer](/message-analyzer/installing-and-upgrading-message-analyzer) и установите приложение.

Запустите приложение и выберите **Файл** > **Открыть** > **From Other File Sources** (Из других источников файлов).

В диалоговом окне **File Selector** (Селектор файлов) выберите **+ Add Azure Connection** (+Добавить подключение Azure). Введите **имя учетной записи хранения** и **ключ учетной записи**, а затем нажмите кнопку **ОК**.

![Microsoft Message Analyzer. Диалоговое окно добавления соединения службы хранилища Azure.](media/storage-monitor-troubleshoot-storage-application/figure3.png)

После подключения разверните контейнеры в хранилище в представлении в виде дерева, чтобы просмотреть большие двоичные объекты журналов. Выберите последний журнал и нажмите кнопку **ОК**.

![Снимок экрана, на котором показано средство Microsoft Message Analyzer и выделен выбранный файл журнала.](media/storage-monitor-troubleshoot-storage-application/figure4.png)

В диалоговом окне **Новый сеанс** щелкните **Запуск** для просмотра журналов.

Открыв журнал, можно просмотреть события хранилища. Как видно на следующем изображении, в учетной записи хранения была активирована ошибка `SASClientOtherError`. Дополнительные сведения о ведении журнала хранилища см. в [этой статье](../common/storage-analytics.md).

![Microsoft Message Analyzer. Просмотр событий.](media/storage-monitor-troubleshoot-storage-application/figure5.png)

[Обозреватель службы хранилища](https://azure.microsoft.com/features/storage-explorer/) — это еще один инструмент, который можно использовать для взаимодействия с учетными записями хранения, в том числе с контейнером **$logs** и журналами, которые в нем содержатся.

## <a name="next-steps"></a>Дальнейшие действия

В четвертой и последней части цикла вы узнали, как выполнять мониторинг и устранять неполадки учетной записи хранения, а также как выполнять следующие задачи:

> [!div class="checklist"]
> * Включение ведения журнала и метрик
> * включение оповещений для ошибок авторизации;
> * выполнение тестирования трафика с помощью неверных маркеров SAS;
> * скачивание и анализ журналов.

Перейдите по ссылке, чтобы просмотреть готовые хранилища.

> [!div class="nextstepaction"]
> [Примеры Azure CLI для хранилища BLOB-объектов](storage-samples-blobs-cli.md)