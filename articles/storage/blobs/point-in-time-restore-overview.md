---
title: Восстановление до точки во времени для блочных BLOB-объектов
titleSuffix: Azure Storage
description: Восстановление на момент времени для блочных BLOB-объектов обеспечивает защиту от случайного удаления или повреждения, позволяя восстановить предыдущее состояние учетной записи хранения в определенный момент времени.
services: storage
author: tamram
ms.service: storage
ms.topic: conceptual
ms.date: 03/03/2021
ms.author: tamram
ms.subservice: blobs
ms.custom: devx-track-azurepowershell
ms.openlocfilehash: da869091fb1f7bf31a29ba1bc6db8c1c42254dc4
ms.sourcegitcommit: d135e9a267fe26fbb5be98d2b5fd4327d355fe97
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/10/2021
ms.locfileid: "102618089"
---
# <a name="point-in-time-restore-for-block-blobs"></a>Восстановление до точки во времени для блочных BLOB-объектов

Восстановление до точки во времени обеспечивает защиту от случайного удаления или повреждения, позволяя восстановить данные блочного BLOB-объекта в более раннее состояние. Восстановление до точки во времени полезно в сценариях, когда пользователь или приложение случайно удаляет данные или когда ошибка приложения приводит к повреждению данных. Восстановление до точки во времени позволяет выполнять сценарии тестирования, требующие возврата набора данных в известное состояние перед выполнением дальнейших тестов.

Восстановление до точки во времени поддерживается для учетных записей хранения общего назначения версии 2 только на стандартном уровне производительности. Восстановление данных на уровне "горячий" и "холодного" уровня доступа можно выполнить с помощью восстановления до точки во времени.

Сведения о том, как включить восстановление на момент времени для учетной записи хранения, см. в разделе [выполнение восстановления на момент времени для данных блочного BLOB-объекта](point-in-time-restore-manage.md).

## <a name="how-point-in-time-restore-works"></a>Как работает восстановление до точки во времени

Чтобы включить восстановление на момент времени, создайте политику управления для учетной записи хранения и укажите срок хранения. В течение срока хранения можно восстановить блочные BLOB-объекты из текущего состояния в состояние, наступающее на предыдущую точку во времени.

Чтобы запустить восстановление на момент времени, вызовите операцию [восстановить диапазоны BLOB-объектов](/rest/api/storagerp/storageaccounts/restoreblobranges) и укажите точку восстановления в формате UTC. Можно указать лексикографическом диапазоны имен контейнера и BLOB-объектов для восстановления или опустить диапазон для восстановления всех контейнеров в учетной записи хранения. Для каждой операции восстановления поддерживается до 10 диапазонов лексикографическом.

Служба хранилища Azure анализирует все изменения, внесенные в указанные большие двоичные объекты между запрошенной точкой восстановления, заданными в формате UTC, и в настоящее время. Операция восстановления является атомарной, поэтому она либо полностью успешно восстанавливает все изменения, либо завершается сбоем. Если есть большие двоичные объекты, которые невозможно восстановить, операция завершается ошибкой, а операции чтения и записи затронутых контейнеров возобновляются.

На следующей диаграмме показано, как работает восстановление до точки во времени. Один или несколько контейнеров или диапазонов BLOB-объектов восстановлены до состояния *n* дней назад, где *n* меньше или равно сроку хранения, определенному для восстановления на момент времени. Результатом будет отмена операций записи и удаления, произошедших в течение срока хранения.

:::image type="content" source="media/point-in-time-restore-overview/point-in-time-restore-diagram.png" alt-text="Диаграмма, показывающая, как на момент времени восстанавливается состояние контейнеров в предыдущем состоянии":::

Одновременно может выполняться только одна операция восстановления в учетной записи хранения. Операция восстановления не может быть отменена, когда она выполняется, но для отмены первой операции можно выполнить вторую операцию восстановления.

Операция **восстановления диапазонов BLOB-объектов** возвращает идентификатор восстановления, который однозначно идентифицирует операцию. Чтобы проверить состояние восстановления на момент времени, вызовите операцию **Получение состояния восстановления** с ИД восстановления, возвращенным из операции **восстановления диапазонов BLOB-объектов** .

> [!IMPORTANT]
> При выполнении операции восстановления служба хранилища Azure блокирует операции с большими двоичными объектами в восстанавливаемых диапазонах на протяжении операции. Операции чтения, записи и удаления блокируются в основном расположении. По этой причине такие операции, как вывод контейнеров в портал Azure, могут выполняться не так, как ожидалось, во время операции восстановления.
>
> Операции чтения из дополнительного расположения могут продолжаться во время операции восстановления, если учетная запись хранения является геореплицированной.

> [!CAUTION]
> Восстановление до точки во времени поддерживает восстановление операций, выполняемых только с блочными BLOB-объектами. Операции, выполняемые в контейнерах, не могут быть восстановлены. Например, если удалить контейнер из учетной записи хранения, вызвав операцию [удаления контейнера](/rest/api/storageservices/delete-container) , то этот контейнер нельзя будет восстановить с помощью операции восстановления на момент времени. Вместо удаления всего контейнера Удалите отдельные большие двоичные объекты, если их потребуется восстановить позже.

### <a name="prerequisites-for-point-in-time-restore"></a>Предварительные требования для восстановления до точки во времени

Для восстановления до точки во времени необходимо включить следующие функции службы хранилища Azure, прежде чем можно будет включить восстановление на момент времени.

- [Обратимое удаление](./soft-delete-blob-overview.md)
- [Канал изменений](storage-blob-change-feed.md)
- [Управление версиями BLOB-объектов](versioning-overview.md)

### <a name="retention-period-for-point-in-time-restore"></a>Срок хранения для восстановления до точки во времени

При включении восстановления на определенный момент времени для учетной записи хранения указывается срок хранения. Блочные BLOB-объекты в учетной записи хранения можно восстановить в течение срока хранения.

Срок хранения начинается через несколько минут после включения восстановления на момент времени. Помните, что вы не можете восстановить большие двоичные объекты в состоянии до начала срока хранения. Например, если вы включили восстановление на момент времени в 1 мая с периодом удержания в 30 дней, то в течение 15 мая можно восстановить до максимального значения, равного большему сроку, установленному в течение не более 15 дней. 1 июня вы можете восстановить данные от 1 до 30 дней.

Срок хранения для восстановления до точки во времени должен быть не менее одного дня, чем срок хранения, указанный для обратимого удаления. Например, если срок хранения обратимого удаления равен 7 дням, срок хранения восстановления на определенный момент времени может составлять от 1 до 6 дней.

> [!IMPORTANT]
> Время, необходимое для восстановления набора данных, зависит от количества операций записи и удаления, выполненных в течение периода восстановления. Например, учетная запись с 1 000 000 объектами с 3 000 объектов, добавленных в день и 1 000 объектов в день, будет требовать примерно два часа для восстановления до точки на 30 дней в прошлом. Срок хранения и восстановление более 90 дней в прошлом не рекомендуются для учетной записи с такой частотой изменений.

### <a name="permissions-for-point-in-time-restore"></a>Разрешения на восстановление до точки во времени

Чтобы инициировать операцию восстановления, клиент должен иметь разрешения на запись для всех контейнеров в учетной записи хранения. Чтобы предоставить разрешения на авторизацию операции восстановления с помощью Azure Active Directory (Azure AD), назначьте роль **участника учетной записи хранения** участнику безопасности на уровне учетной записи хранения, группы ресурсов или подписки.

## <a name="limitations-and-known-issues"></a>Ограничения и известные проблемы

Восстановление на момент времени для блочных BLOB-объектов имеет следующие ограничения и известные проблемы.

- Только блочные BLOB-объекты в стандартной учетной записи хранения общего назначения версии 2 можно восстановить в рамках операции восстановления на момент времени. Добавление больших двоичных объектов, страничных BLOB-объектов и блочных больших двоичных объектов Premium не восстанавливается. 
- Если контейнер был удален в течение срока хранения, этот контейнер не будет восстановлен с операцией восстановления на момент времени. При попытке восстановить диапазон больших двоичных объектов, содержащих большие двоичные объекты в удаленном контейнере, операция восстановления на момент времени завершится ошибкой. Дополнительные сведения о защите контейнеров от удаления см. в статье [обратимое удаление для контейнеров (Предварительная версия)](soft-delete-container-overview.md).
- Если большой двоичный объект перемещается между горячим и замечательным уровнем в период между текущим и точкой восстановления, большой двоичный объект восстанавливается до предыдущего уровня. Восстановление блочных BLOB-объектов на уровне архива не поддерживается. Например, если большой двоичный объект на горячем уровне хранилища был перемещен на архивный уровень два дня назад, а операция восстановления выполняет восстановление до точки три дня назад, большой двоичный объект не восстанавливается на горячий уровень. Чтобы восстановить архивный BLOB-объект, сначала переместите его из уровня архива. Дополнительные сведения см. в статье восстановление [данных большого двоичного объекта из уровня архива](storage-blob-rehydration.md).
- Блок, который был передан через [URL-адрес](/rest/api/storageservices/put-block-from-url), но не [зафиксирован через](/rest/api/storageservices/put-block) [List Block](/rest/api/storageservices/put-block-list), не является частью большого двоичного объекта и поэтому не восстанавливается в ходе операции восстановления.
- Невозможно восстановить большой двоичный объект с активной арендой. Если большой двоичный объект с активной арендой включен в диапазон больших двоичных объектов для восстановления, операция восстановления не будет выполнена атомарно. Прервать все активные аренды перед началом операции восстановления.
- Моментальные снимки не создаются и не удаляются в ходе операции восстановления. В предыдущее состояние восстанавливается только базовый большой двоичный объект.
- Восстановление Azure Data Lake Storage 2-го поколения плоских и иерархических пространств имен не поддерживается.

> [!IMPORTANT]
> При восстановлении блочных BLOB-объектов до версии, предшествующей 22 сентября 2020, действуют ограничения на предварительный просмотр для восстановления на момент времени. Корпорация Майкрософт рекомендует выбрать точку восстановления, которая равна или позже 22 сентября 2020, чтобы воспользоваться преимуществами общедоступной функции восстановления на момент времени.

## <a name="pricing-and-billing"></a>Цены и выставление счетов

Выставление счетов за восстановление до точки во времени зависит от объема данных, обработанных для выполнения операции восстановления. Объем обработанных данных зависит от количества изменений, произошедших между точкой восстановления и текущим моментом. Например, при относительно постоянной скорости изменения блокировки данных большого двоичного объекта в учетной записи хранения операция восстановления, которая возвращается в течение 1 дня, будет стоить 1/10-й день восстановления, который возвращается в течение 10 дней.

Чтобы оценить стоимость операции восстановления, проверьте журнал веб-канала изменений, чтобы оценить объем данных, измененных в течение периода восстановления. Например, если срок хранения для веб-канала изменений составляет 30 дней, а размер веб-канала изменений составляет 10 МБ, то восстановление до точки на 10 дней раньше будет стоить примерно в одну треть цены, указанной для учетной записи LRS в этом регионе. Восстановление до точки до 27 дней будет стоить примерно девять десятых долей указанной цены.

Дополнительные сведения о ценах на восстановление до точки во времени см. в разделе [цены на блочные BLOB](https://azure.microsoft.com/pricing/details/storage/blobs/)-объекты.

## <a name="next-steps"></a>Дальнейшие действия

- [Выполнение восстановления на момент времени в данных блочного BLOB-объекта](point-in-time-restore-manage.md)
- [Поддержка веб-канала изменений в хранилище BLOB-объектов Azure](storage-blob-change-feed.md)
- [Включение обратимого удаления для больших двоичных объектов](./soft-delete-blob-enable.md)
- [Включение управления версиями BLOB-объектов и работа с ним](versioning-enable.md)
