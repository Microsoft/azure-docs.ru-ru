---
title: Общие сведения о репликации объектов
titleSuffix: Azure Storage
description: Репликация объектов Асинхронно копирует блочные BLOB-объекты между исходной и целевой учетными записями хранения. Используйте репликацию объектов, чтобы снизить задержку запросов на чтение, повысить эффективность вычислений, оптимизировать распределение данных и сократить затраты.
services: storage
author: tamram
ms.service: storage
ms.topic: conceptual
ms.date: 01/13/2021
ms.author: tamram
ms.subservice: blobs
ms.custom: devx-track-azurepowershell
ms.openlocfilehash: e7fa6b1ee7c92f82c3e15335991f5a240c7acc52
ms.sourcegitcommit: 3c3ec8cd21f2b0671bcd2230fc22e4b4adb11ce7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/25/2021
ms.locfileid: "98762885"
---
# <a name="object-replication-for-block-blobs"></a>Репликация объектов для блочных BLOB-объектов

Репликация объектов Асинхронно копирует блочные BLOB-объекты между исходной и целевой учетными записями хранения. Ниже перечислены некоторые сценарии, поддерживаемые репликацией объектов.

- **Минимизация задержки.** Репликация объектов может сократить задержку запросов на чтение, позволяя клиентам использовать данные из региона, наиболее близкого к их физическому расположению.
- **Повышение эффективности вычислений для рабочих нагрузок.** При репликации объектов рабочие нагрузки вычислений могут обрабатывать одни и те же наборы блочных BLOB-объектов в разных регионах.
- **Оптимизация распределения данных.** Вы можете обрабатывать или анализировать данные в одном месте, а затем просто реплицировать полученные результаты в дополнительные регионы.
- **Оптимизация затрат.** После репликации данных можно уменьшить затраты, переместив их на уровень архива с помощью политик управления жизненным циклом.

На следующей схеме показано, как репликация объектов реплицирует блочные BLOB-объекты из исходной учетной записи хранения в одном регионе в конечные учетные записи в двух разных регионах.

:::image type="content" source="media/object-replication-overview/object-replication-diagram.svg" alt-text="Диаграмма, показывающая, как работает репликация объектов":::

Сведения о настройке репликации объектов см. в разделе [Настройка репликации объектов](object-replication-configure.md).

[!INCLUDE [storage-data-lake-gen2-support](../../../includes/storage-data-lake-gen2-support.md)]

## <a name="prerequisites-for-object-replication"></a>Необходимые условия для репликации объектов

Для репликации объектов необходимо также включить следующие функции службы хранилища Azure:

- [Веб-канал изменений](storage-blob-change-feed.md): должен быть включен в исходной учетной записи. Сведения о включении веб-канала изменений см. в разделе [Включение и отключение веб-канала изменений](storage-blob-change-feed.md#enable-and-disable-the-change-feed).
- [Управление версиями BLOB-объектов](versioning-overview.md): необходимо включить как в исходной, так и в конечной учетной записи. Сведения о том, как включить управление версиями, см. в разделе [Включение управления версиями BLOB-объектов и управление ими](versioning-enable.md).

Включение канала изменений и управления версиями BLOB-объектов может повлечь за собой дополнительные затраты. Дополнительные сведения см. на странице [цен на службу хранилища Azure](https://azure.microsoft.com/pricing/details/storage/).

## <a name="how-object-replication-works"></a>Как работает репликация объектов

Репликация объектов Асинхронно копирует блочные BLOB-объекты в контейнере в соответствии с настроенными правилами. Содержимое большого двоичного объекта, все версии, связанные с этим BLOB-объектом, а также метаданные и свойства большого двоичного объекта копируются из исходного контейнера в целевой контейнер.

> [!IMPORTANT]
> Так как данные блочного BLOB-объекта реплицируются асинхронно, исходная и целевая учетные записи не синхронизируются немедленно. В настоящее время нет соглашения об уровне обслуживания относительно того, сколько времени должна занимать репликация данных в целевую учетную запись. Вы можете проверить состояние репликации в исходном двоичном объекте, чтобы определить, завершена ли репликация. Дополнительные сведения см. [в статье Проверка состояния репликации большого двоичного объекта](object-replication-configure.md#check-the-replication-status-of-a-blob).

### <a name="blob-versioning"></a>Управление версиями BLOB-объектов

Для репликации объектов требуется, чтобы Управление версиями BLOB-объектов было включено как в исходной, так и в конечной учетной записи. При изменении реплицированного большого двоичного объекта в исходной учетной записи в исходной учетной записи создается новая версия большого двоичного объекта, отражающая предыдущее состояние большого двоичного объекта перед изменением. Текущая версия (или базовый BLOB-объект) в исходной учетной записи отражает самые последние обновления. Обновленная Текущая версия и Новая Предыдущая версия реплицируются в целевую учетную запись. Дополнительные сведения о том, как операции записи влияют на версии BLOB-объектов, см. [в разделе Управление версиями при операциях записи](versioning-overview.md#versioning-on-write-operations).

При удалении большого двоичного объекта в исходной учетной записи текущая версия большого двоичного объекта записывается в предыдущей версии, а затем удаляется. Все предыдущие версии большого двоичного объекта сохраняются даже после удаления текущей версии. Это состояние реплицируется в целевую учетную запись. Дополнительные сведения о влиянии операций удаления на версии BLOB-объектов см. [в разделе Управление версиями при операциях удаления](versioning-overview.md#versioning-on-delete-operations).

### <a name="snapshots"></a>Моментальные снимки

Репликация объектов не поддерживает моментальные снимки больших двоичных объектов. Все моментальные снимки BLOB-объекта в исходной учетной записи не реплицируются в целевую учетную запись.

### <a name="blob-tiering"></a>Распределение по уровням BLOB-объектов

Репликация объектов поддерживается, если исходная и Целевая учетные записи находятся на горячий или холодном уровне. Исходная и Целевая учетные записи могут находиться на разных уровнях. Однако репликация объектов завершится ошибкой, если большой двоичный объект в исходной или целевой учетной записи был перемещен на уровень архива. Дополнительные сведения о уровнях больших двоичных объектов см. в статье [уровни доступа для хранилища BLOB-объектов Azure — "горячий", "крутой" и "Архив](storage-blob-storage-tiers.md)".

### <a name="immutable-blobs"></a>Неизменяемые большие двоичные объекты

Репликация объектов не поддерживает неизменяемые большие двоичные объекты. Если исходный или конечный контейнер имеет политику хранения на основе времени или юридическая информация, репликация объекта завершится сбоем. Дополнительные сведения о неизменяемых больших двоичных объектах см. [в статье хранение критически важных бизнес-данных с помощью неизменяемого хранилища](storage-blob-immutable-storage.md).

## <a name="object-replication-policies-and-rules"></a>Политики и правила репликации объектов

При настройке репликации объектов создается политика репликации, указывающая исходную учетную запись хранения и целевую учетную запись. Политика репликации включает одно или несколько правил, задающих исходный и целевой контейнеры, и указывает, какие блочные BLOB-объекты в исходном контейнере будут реплицированы.

После настройки репликации объектов служба хранилища Azure периодически проверяет канал изменений для исходной учетной записи и асинхронно реплицирует все операции записи или удаления в целевую учетную запись. Задержка репликации зависит от размера реплицируемого блочного BLOB-объекта.

### <a name="replication-policies"></a>Политики репликации

При настройке репликации объектов создается политика репликации как для исходной учетной записи, так и для целевой учетной записи, с помощью поставщика ресурсов службы хранилища Azure. Политика репликации определяется по ее идентификатору политики. Чтобы репликация была выполнена, политика на исходной и целевой учетных записях должна иметь одинаковый идентификатор политики.

Учетная запись хранения может выступать в качестве исходной учетной записи для двух целевых учетных записей. Исходная и Целевая учетные записи могут находиться в одном регионе или в разных регионах. Они также могут находиться в разных подписках и в разных клиентах Azure Active Directory (Azure AD). Для каждой пары исходная учетная запись или конечная учетная запись может быть создана только одна политика репликации.

### <a name="replication-rules"></a>Правила репликации

Правила репликации указывают, как служба хранилища Azure будет реплицировать BLOB-объекты из исходного контейнера в целевой. Для каждой политики репликации можно указать до 10 правил репликации. Каждое правило репликации определяет один источник и целевой контейнер, и каждый источник и целевой контейнер можно использовать только в одном правиле.

При создании правила репликации по умолчанию копируются только новые блочные BLOB-объекты, которые впоследствии добавляются в исходный контейнер. Можно указать, что будут скопированы новые и существующие блочные BLOB-объекты, или можно определить пользовательскую область копирования, которая копирует блочные BLOB-объекты, созданные за указанное время.

Можно также указать один или несколько фильтров в рамках правила репликации, чтобы фильтровать блочные BLOB-объекты по префиксу. При указании префикса только большие двоичные объекты, соответствующие этому префиксу в исходном контейнере, будут скопированы в целевой контейнер.

Оба контейнера, исходный и целевой, должны существовать, прежде чем их можно будет указать в правиле. После создания политики репликации операции записи в целевой контейнер не допускаются. Любые попытки записи в целевой контейнер завершатся ошибкой с кодом 409 (конфликт). Для записи в целевой контейнер, для которого настроено правило репликации, необходимо либо удалить правило, настроенное для этого контейнера, либо удалить политику репликации. Операции чтения и удаления в целевом контейнере разрешены, если политика репликации активна.

Вы можете вызвать операцию [Задание уровня большого двоичного объекта](/rest/api/storageservices/set-blob-tier) для большого двоичного объекта в целевом контейнере, чтобы переместить его на уровень архива. Дополнительные сведения о уровне архива см. в статье [хранилище BLOB-объектов Azure: горячий, холодный и архивный уровни доступа](storage-blob-storage-tiers.md#archive-access-tier).

## <a name="replication-status"></a>Состояние репликации

Вы можете проверить состояние репликации для большого двоичного объекта в исходной учетной записи. Дополнительные сведения см. [в статье Проверка состояния репликации большого двоичного объекта](object-replication-configure.md#check-the-replication-status-of-a-blob).

Если состояние репликации для большого двоичного объекта в исходной учетной записи указывает на сбой, проверьте следующие возможные причины.

- Убедитесь, что в конечной учетной записи настроена политика репликации объектов.
- Убедитесь, что целевой контейнер по-прежнему существует.
- Если исходный большой двоичный объект был зашифрован с помощью предоставленного клиентом ключа в рамках операции записи, репликация объекта завершится ошибкой. Дополнительные сведения о ключах, предоставляемых клиентом, см. в разделе [Указание ключа шифрования для запроса к хранилищу BLOB-объектов](encryption-customer-provided-keys.md).

## <a name="billing"></a>Выставление счетов

Репликация объектов требует дополнительных затрат на чтение и запись транзакций с исходными и целевыми учетными записями, а также за исходящий трафик для репликации данных из исходной учетной записи в целевую учетную запись и расходов на чтение канала изменений обработки.

## <a name="next-steps"></a>Дальнейшие действия

- [Настройка репликации объектов](object-replication-configure.md)
- [Поддержка веб-канала изменений в хранилище BLOB-объектов Azure](storage-blob-change-feed.md)
- [Включение управления версиями BLOB-объектов и работа с ним](versioning-enable.md)
