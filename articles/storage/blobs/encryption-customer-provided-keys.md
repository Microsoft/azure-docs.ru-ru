---
title: Укажите ключ шифрования для запроса к хранилищу BLOB-объектов
titleSuffix: Azure Storage
description: Клиенты, выполняющие запросы к хранилищу BLOB-объектов Azure, имеют возможность предоставлять ключ шифрования для каждого запроса. Включение ключа шифрования в запрос обеспечивает детальный контроль над параметрами шифрования для операций с хранилищем BLOB-объектов.
services: storage
author: tamram
ms.service: storage
ms.date: 12/14/2020
ms.topic: conceptual
ms.author: tamram
ms.reviewer: ozgun
ms.subservice: common
ms.openlocfilehash: fcc5c02c4a37e205622470260d3c620ad76d07d8
ms.sourcegitcommit: b6267bc931ef1a4bd33d67ba76895e14b9d0c661
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/19/2020
ms.locfileid: "97694707"
---
# <a name="provide-an-encryption-key-on-a-request-to-blob-storage"></a>Укажите ключ шифрования для запроса к хранилищу BLOB-объектов

Клиенты, выполняющие запросы к хранилищу больших двоичных объектов Azure, имеют возможность предоставить ключ шифрования AES-256 для каждого запроса. Включение ключа шифрования в запрос обеспечивает детальный контроль над параметрами шифрования для операций с хранилищем BLOB-объектов. Предоставляемые клиентом ключи могут храниться в Azure Key Vault или в другом хранилище ключей.

[!INCLUDE [storage-data-lake-gen2-support](../../../includes/storage-data-lake-gen2-support.md)]

## <a name="encrypting-read-and-write-operations"></a>Шифрование операций чтения и записи

Когда клиентское приложение предоставляет ключ шифрования для запроса, служба хранилища Azure прозрачно выполняет шифрование и расшифровку при чтении и записи данных больших двоичных объектов. Служба хранилища Azure записывает хэш SHA-256 ключа шифрования вместе с содержимым большого двоичного объекта. Хэш используется для проверки того, что все последующие операции с BLOB-объектом используют один и тот же ключ шифрования.

Служба хранилища Azure не хранит ключ шифрования, который клиент отправляет вместе с запросом, и не управляет им. Ключ безопасно удаляется сразу по завершении процесса шифрования или расшифровки.

Когда клиент создает или обновляет большой двоичный объект с помощью предоставленного клиентом ключа в запросе, последующие запросы на чтение и запись для этого большого двоичного объекта также должны предоставлять ключ. Если ключ не предоставлен по запросу для большого двоичного объекта, который уже зашифрован с помощью предоставленного клиентом ключа, запрос завершается ошибкой с кодом 409 (конфликт).

Если клиентское приложение отправляет ключ шифрования в запросе, а учетная запись хранения также шифруется с помощью ключа, управляемого Майкрософт, или ключа, управляемого клиентом, служба хранилища Azure использует ключ, указанный в запросе на шифрование и расшифровку.

Чтобы отправить ключ шифрования в рамках запроса, клиент должен установить безопасное подключение к службе хранилища Azure с помощью протокола HTTPS.

Каждый моментальный снимок BLOB-объекта может иметь свой собственный ключ шифрования.

## <a name="request-headers-for-specifying-customer-provided-keys"></a>Заголовки запроса для указания предоставленных клиентом ключей

Для вызовов RESTFUL клиенты могут использовать следующие заголовки для безопасной передачи сведений о ключе шифрования в запрос в хранилище BLOB-объектов:

|Заголовок запроса | Описание |
|---------------|-------------|
|`x-ms-encryption-key` |Требуется для запросов Write и Read. Значение ключа шифрования AES-256 в кодировке Base64. |
|`x-ms-encryption-key-sha256`| Требуется для запросов Write и Read. Значение SHA256 ключа шифрования в кодировке Base64. |
|`x-ms-encryption-algorithm` | Требуется для запросов записи, необязательных для запросов чтения. Задает алгоритм, используемый при шифровании данных с помощью заданного ключа.  Значение этого заголовка должно быть `AES256` . |

Указание ключей шифрования для запроса является необязательным. Однако если указать один из указанных выше заголовков для операции записи, необходимо указать все эти заголовки.

## <a name="blob-storage-operations-supporting-customer-provided-keys"></a>Операции хранилища BLOB-объектов, поддерживающие предоставленные клиентом ключи

Следующие операции хранилища BLOB-объектов поддерживают отправку предоставленных клиентом ключей шифрования для запроса:

- [Put BLOB (Вставка BLOB-объекта)](/rest/api/storageservices/put-blob)
- [Put Block List (Вставка списка блокировки)](/rest/api/storageservices/put-block-list)
- [Put Block (Вставка блокировки)](/rest/api/storageservices/put-block)
- [Разместить блок по URL-адресу](/rest/api/storageservices/put-block-from-url)
- [Put Page](/rest/api/storageservices/put-page)
- [Put Page from URL](/rest/api/storageservices/put-page-from-url) (размещение страницы по URL-адресу);
- [Append Block](/rest/api/storageservices/append-block)
- [Set BLOB Properties (Задание свойств службы BLOB-объекта)](/rest/api/storageservices/set-blob-properties)
- [Set BLOB Metadata (Задание метаданных BLOB-объекта)](/rest/api/storageservices/set-blob-metadata)
- [Get BLOB (Получение BLOB-объекта)](/rest/api/storageservices/get-blob)
- [Получение свойств большого двоичного объекта](/rest/api/storageservices/get-blob-properties)
- [Get BLOB Metadata (Получение метаданных BLOB-объекта)](/rest/api/storageservices/get-blob-metadata)
- [Создание моментального снимка большого двоичного объекта](/rest/api/storageservices/snapshot-blob)

## <a name="rotate-customer-provided-keys"></a>Поворачивайте ключи, предоставленные клиентом

Для смены ключа шифрования, который использовался для шифрования большого двоичного объекта, скачайте большой двоичный объект, а затем повторно загрузите его с новым ключом шифрования.

> [!IMPORTANT]
> Портал Azure нельзя использовать для чтения или записи в контейнер или большой двоичный объект, зашифрованный с помощью ключа, указанного в запросе.
>
> Обязательно Защитите ключ шифрования, предоставленный в запросе к хранилищу BLOB-объектов, в безопасном хранилище ключей, например Azure Key Vault. Если выполнить операцию записи для контейнера или большого двоичного объекта без ключа шифрования, операция завершится ошибкой, а доступ к объекту будет потерян.

## <a name="next-steps"></a>Дальнейшие действия

- [Указание предоставленного клиентом ключа для запроса к хранилищу BLOB-объектов с помощью .NET](storage-blob-customer-provided-key.md)
- [Шифрование службы хранилища Azure для неактивных данных](../common/storage-service-encryption.md)
