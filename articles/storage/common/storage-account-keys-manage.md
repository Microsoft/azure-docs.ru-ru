---
title: Управление ключами доступа к учетной записи
titleSuffix: Azure Storage
description: Узнайте, как просматривать ключи доступа к учетной записи хранения, управлять ими и вращать их.
services: storage
author: tamram
ms.service: storage
ms.topic: how-to
ms.date: 04/24/2020
ms.author: tamram
ms.custom: devx-track-azurecli, devx-track-azurepowershell
ms.openlocfilehash: e5ea94fea00771b64634d6c28a7879fabb195f09
ms.sourcegitcommit: 772eb9c6684dd4864e0ba507945a83e48b8c16f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "89069665"
---
# <a name="manage-storage-account-access-keys"></a>Управление ключами доступа к учетной записи хранения

При создании учетной записи хранения платформа Azure создает два 512-разрядных ключа доступа к учетной записи хранения. Эти ключи можно использовать для авторизации доступа к данным в учетной записи хранения с помощью авторизации общего ключа.

Корпорация Майкрософт рекомендует использовать Azure Key Vault для управления ключами доступа и регулярного вращения и повторного создания ключей. Использование Azure Key Vault упрощает процесс смены ключей без прерывания работы приложений. Вы также можете вручную повернуть ключи.

[!INCLUDE [storage-account-key-note-include](../../../includes/storage-account-key-note-include.md)]

## <a name="view-account-access-keys"></a>Просмотр ключей доступа к учетной записи

Вы можете просматривать и копировать ключи доступа к учетной записи с помощью портал Azure, PowerShell или Azure CLI. Портал Azure также предоставляет строку подключения для вашей учетной записи хранения, которую можно скопировать.

# <a name="portal"></a>[Портал](#tab/azure-portal)

Чтобы просмотреть и скопировать ключи доступа к учетной записи хранения или строку подключения из портал Azure:

1. Перейдите к своей учетной записи хранения в [портал Azure](https://portal.azure.com).
1. В разделе **Параметры** выберите **Ключи доступа**. Появятся ключи доступа к учетной записи и полная строка подключения для каждого ключа.
1. Укажите значение **ключа** в разделе **Key1** и нажмите кнопку " **Копировать** ", чтобы скопировать ключ учетной записи.
1. Кроме того, можно скопировать всю строку подключения. Найдите значение **Строка подключения** в разделе **key1** и нажмите кнопку **Скопировать**, чтобы скопировать строку подключения.

    :::image type="content" source="media/storage-account-keys-manage/portal-connection-string.png" alt-text="Снимок экрана, показывающий, как просмотреть ключи доступа в портал Azure":::

# <a name="powershell"></a>[PowerShell](#tab/azure-powershell)

Чтобы получить ключи доступа к учетной записи с помощью PowerShell, вызовите команду [Get-азсторажеаккаунткэй](/powershell/module/az.Storage/Get-azStorageAccountKey) .

В следующем примере извлекается первый ключ. Чтобы получить второй ключ, используйте `Value[1]` вместо `Value[0]` . Не забудьте заменить значения заполнителей в квадратных скобках собственными значениями.

```powershell
$storageAccountKey = `
    (Get-AzStorageAccountKey `
    -ResourceGroupName <resource-group> `
    -Name <storage-account>).Value[0]
```

# <a name="azure-cli"></a>[Azure CLI](#tab/azure-cli)

Чтобы получить список ключей доступа к учетной записи с помощью Azure CLI, вызовите команду [AZ Storage Account Keys List](/cli/azure/storage/account/keys#az-storage-account-keys-list) , как показано в следующем примере. Не забудьте заменить значения заполнителей в квадратных скобках собственными значениями. 

```azurecli-interactive
az storage account keys list \
  --resource-group <resource-group> \
  --account-name <storage-account>
```

---

Для доступа к службе хранилища Azure можно использовать любой из двух ключей, но в общем случае рекомендуется использовать первый ключ и резервировать использование второго ключа при вращении ключей.

Для просмотра или чтения ключей доступа учетной записи пользователь должен быть администратором службы, или ему должна быть назначена роль Azure, включающая в себя **Microsoft. Storage/storageAccounts/listkeys/Action**. Некоторые встроенные роли Azure, включающие это действие, являются ролями роли службы " **владелец**", " **участник**" и " **оператор ключа учетной записи хранения** ". Дополнительные сведения о роли администратора службы см. в разделе [роли администратора классической подписки, роли Azure и роли Azure AD](../../role-based-access-control/rbac-and-directory-admin-roles.md). Подробные сведения о встроенных ролях для службы хранилища Azure см. в разделе " **хранилище** " [встроенных ролей Azure для Azure RBAC](../../role-based-access-control/built-in-roles.md#storage).

## <a name="use-azure-key-vault-to-manage-your-access-keys"></a>Использование Azure Key Vault для управления ключами доступа

Корпорация Майкрософт рекомендует использовать Azure Key Vault для управления ключами доступа и их смены. Приложение может безопасно получать доступ к ключам в Key Vault, что позволяет избежать их хранения в коде приложения. Дополнительные сведения об использовании Key Vault для управления ключами см. в следующих статьях:

- [Управление ключами учетной записи хранения с помощью Azure Key Vault и PowerShell](../../key-vault/secrets/overview-storage-keys-powershell.md)
- [Управление ключами учетной записи хранения с помощью Azure Key Vault и Azure CLI](../../key-vault/secrets/overview-storage-keys.md)

## <a name="manually-rotate-access-keys"></a>Поворот ключей доступа вручную

Корпорация Майкрософт рекомендует периодически менять ключи доступа, чтобы обеспечить безопасность вашей учетной записи хранения. По возможности используйте Azure Key Vault для управления ключами доступа. Если вы не используете Key Vault, необходимо будет вручную поворачивать ключи.

Таким образом, чтобы можно было осуществлять смену ключей, назначаются два ключа доступа. Наличие двух ключей гарантирует, что ваше приложение будет поддерживать доступ к службе хранилища Azure в течение всего процесса.

> [!WARNING]
> Повторное создание ключей доступа может влиять на работу ваших приложений или служб Azure, которые зависят от ключа учетной записи хранения. Все клиенты, использующие ключ учетной записи для доступа к учетной записи хранения, должны быть обновлены, чтобы использовать новый ключ, включая службы мультимедиа, облачные, классические и мобильные приложения, а также приложения для графического пользовательского интерфейса для службы хранилища Azure, такие как [Обозреватель службы хранилища Azure](https://azure.microsoft.com/features/storage-explorer/).

# <a name="portal"></a>[Портал](#tab/azure-portal)

Для смены ключей доступа к учетной записи хранения в портал Azure:

1. Обновите строки подключения в коде приложения, чтобы они ссылались на вторичный ключ доступа для учетной записи хранения.
1. Перейдите к своей учетной записи хранения в [портал Azure](https://portal.azure.com).
1. В разделе **Параметры** выберите **Ключи доступа**.
1. Чтобы повторно создать первичный ключ доступа для учетной записи хранения, нажмите кнопку **повторно создать** рядом с первичным ключом доступа.
1. Обновите строки подключения в коде, чтобы они ссылались на новый основной ключ доступа.
1. Повторите процедуру, чтобы повторно создать вторичный ключ доступа.

# <a name="powershell"></a>[PowerShell](#tab/azure-powershell)

Для смены ключей доступа к учетной записи хранения с помощью PowerShell:

1. Обновите строки подключения в коде приложения, чтобы они ссылались на вторичный ключ доступа для учетной записи хранения.
1. Вызовите команду [New-азсторажеаккаунткэй](/powershell/module/az.storage/new-azstorageaccountkey) , чтобы повторно создать первичный ключ доступа, как показано в следующем примере:

    ```powershell
    New-AzStorageAccountKey -ResourceGroupName <resource-group> `
      -Name <storage-account> `
      -KeyName key1
    ```

1. Обновите строки подключения в коде, чтобы они ссылались на новый основной ключ доступа.
1. Повторите процедуру, чтобы повторно создать вторичный ключ доступа. Чтобы повторно создать вторичный ключ, используйте `key2` в качестве имени ключа, а не `key1` .

# <a name="azure-cli"></a>[Azure CLI](#tab/azure-cli)

Для смены ключей доступа к учетной записи хранения с помощью Azure CLI:

1. Обновите строки подключения в коде приложения, чтобы они ссылались на вторичный ключ доступа для учетной записи хранения.
1. Для повторного создания первичного ключа доступа, как показано в следующем примере, вызовите команду [AZ Storage Account ключи продлить](/cli/azure/storage/account/keys#az-storage-account-keys-renew) .

    ```azurecli-interactive
    az storage account keys renew \
      --resource-group <resource-group> \
      --account-name <storage-account>
      --key primary
    ```

1. Обновите строки подключения в коде, чтобы они ссылались на новый основной ключ доступа.
1. Повторите процедуру, чтобы повторно создать вторичный ключ доступа. Чтобы повторно создать вторичный ключ, используйте `key2` в качестве имени ключа, а не `key1` .

---

> [!NOTE]
> Во всех приложениях рекомендуется использовать одновременно только один из ключей. Если в одних приложениях используется ключ 1, а в других — ключ 2, вы не сможете произвести смену ключей без того, чтобы некоторые приложения утратили доступ.

Для смены ключей доступа учетной записи пользователь должен быть администратором службы или должен быть назначен роль Azure, включающая в себя **Microsoft. Storage/storageAccounts/реженератекэй/Action**. Некоторые встроенные роли Azure, включающие это действие, являются ролями роли службы " **владелец**", " **участник**" и " **оператор ключа учетной записи хранения** ". Дополнительные сведения о роли администратора службы см. в разделе [роли администратора классической подписки, роли Azure и роли Azure AD](../../role-based-access-control/rbac-and-directory-admin-roles.md). Подробные сведения о встроенных ролях Azure для службы хранилища Azure см. в разделе " **хранилище** " [встроенных ролей Azure для Azure RBAC](../../role-based-access-control/built-in-roles.md#storage).

## <a name="next-steps"></a>Дальнейшие действия

- [Общие сведения об учетной записи хранения](storage-account-overview.md)
- [создать учетную запись хранения;](storage-account-create.md)
