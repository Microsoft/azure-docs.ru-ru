---
title: Принудительная минимальная требуемая версия протокола TLS для входящих запросов
titleSuffix: Azure Storage
description: Настройте учетную запись хранения, чтобы требовать минимальную версию протокола TLS для клиентов, выполняющих запросы к службе хранилища Azure.
services: storage
author: tamram
ms.service: storage
ms.topic: how-to
ms.date: 12/11/2020
ms.author: tamram
ms.reviewer: fryu
ms.subservice: common
ms.openlocfilehash: 257cd8dce2a080203f116a6f0d5b7c7ebd6d13f8
ms.sourcegitcommit: 772eb9c6684dd4864e0ba507945a83e48b8c16f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "104593182"
---
# <a name="enforce-a-minimum-required-version-of-transport-layer-security-tls-for-requests-to-a-storage-account"></a>Принудительная минимальная требуемая версия протокола TLS для запросов к учетной записи хранения

Связь между клиентским приложением и учетной записью хранения Azure шифруется с помощью протокола TLS. TLS — это стандартный протокол шифрования, обеспечивающий конфиденциальность и целостность данных между клиентами и службами через Интернет. Дополнительные сведения о протоколе TLS см. в статье [безопасность транспортного уровня](https://en.wikipedia.org/wiki/Transport_Layer_Security).

Сейчас служба хранилища Azure поддерживает три версии протокола TLS: 1,0, 1,1 и 1,2. Служба хранилища Azure использует TLS 1,2 на общедоступных конечных точках HTTPS, но TLS 1,0 и TLS 1,1 по-прежнему поддерживаются для обеспечения обратной совместимости.

По умолчанию учетные записи хранения Azure позволяют клиентам отправлять и получать данные с использованием самой старой версии TLS, TLS 1,0 и более поздних версий. Чтобы обеспечить более строгие меры безопасности, можно настроить учетную запись хранения так, чтобы клиенты отправляли и получали данные с помощью более новой версии TLS. Если для учетной записи хранения требуется минимальная версия TLS, все запросы, созданные с использованием более старой версии, завершатся ошибкой.

В этой статье описывается, как использовать платформу ПЕРЕТАСКИВАНИя (обнаружение-исправление — аудит-управление) для непрерывного управления защищенным протоколом TLS для учетных записей хранения.

Сведения о том, как указать определенную версию TLS при отправке запроса из клиентского приложения, см. [в разделе Настройка безопасности транспортного уровня (TLS) для клиентского приложения](transport-layer-security-configure-client-version.md).

## <a name="detect-the-tls-version-used-by-client-applications"></a>Определение версии TLS, используемой клиентскими приложениями

При применении минимальной версии TLS для учетной записи хранения вы рискуете отклонять запросы от клиентов, отправляющих данные с помощью более старой версии TLS. Чтобы понять, как Настройка минимальной версии TLS может повлиять на клиентские приложения, корпорация Майкрософт рекомендует включить ведение журнала для учетной записи хранения Azure и проанализировать журналы через интервал времени, чтобы определить, какие версии клиентских приложений TLS используются.

Чтобы зарегистрировать запросы к учетной записи хранения Azure и определить версию TLS, используемую клиентом, можно использовать ведение журнала службы хранилища Azure в Azure Monitor (Предварительная версия). Дополнительные сведения см. в статье [мониторинг службы хранилища Azure](../blobs/monitor-blob-storage.md).

Ведение журнала службы хранилища Azure в Azure Monitor поддерживает использование запросов журналов для анализа данных журнала. Для запроса журналов можно использовать рабочую область Azure Log Analytics. Дополнительные сведения о запросах журналов см. в разделе [учебник. Начало работы с log Analytics запросами](../../azure-monitor/logs/log-analytics-tutorial.md).

Чтобы записывать данные службы хранилища Azure с Azure Monitor и анализировать их с помощью Log Analytics Azure, необходимо сначала создать параметр диагностики, который указывает, какие типы запросов и какие услуги хранилища будут записывать данные. Журналы службы хранилища Azure в Azure Monitor предоставляются в общедоступной предварительной версии. Они также доступны для предварительного тестирования во всех регионах общедоступного облака. Эта предварительная версия включает журналы для больших двоичных объектов (включая Azure Data Lake Storage 2-го поколения), файлов, очередей и таблиц. Чтобы создать параметр диагностики в портал Azure, выполните следующие действия.

1. Создайте новую рабочую область Log Analytics в подписке, которая содержит вашу учетную запись хранения Azure. После настройки ведения журнала для учетной записи хранения журналы будут доступны в рабочей области Log Analytics. Дополнительные сведения см. в статье [Create a Log Analytics workspace in the Azure portal](../../azure-monitor/logs/quick-create-workspace.md) (Создание рабочей области Log Analytics на портале Azure).
1. Войдите в свою учетную запись хранения на портале Azure.
1. В разделе Мониторинг выберите **параметры диагностики (Предварительная версия)**.
1. Выберите службу хранилища Azure, для которой требуется регистрировать запросы. Например, выберите **BLOB-объект** для записи запросов в хранилище BLOB-объектов.
1. Выберите **Добавить параметр диагностики**.
1. Укажите имя для параметра диагностики.
1. В разделе **сведения о категории** раздела **Журнал** выберите типы запросов для записи. Запросы на чтение, запись и удаление можно записывать в журнал. Например, при выборе **сторажереад** и **сторажеврите** будут регистрироваться запросы на чтение и запись к выбранной службе.
1. В разделе **сведения о назначении** выберите **Отправить log Analytics**. Выберите подписку и созданную ранее рабочую область Log Analytics, как показано на следующем рисунке.

    :::image type="content" source="media/transport-layer-security-configure-minimum-version/create-diagnostic-setting-logs.png" alt-text="Снимок экрана, показывающий, как создать параметр диагностики для запросов ведения журнала":::

После создания параметра диагностики запросы к учетной записи хранения затем регистрируются в соответствии с этим параметром. Дополнительные сведения см. в статье [Создание параметров диагностики для сбора журналов ресурсов и метрик в Azure](../../azure-monitor/essentials/diagnostic-settings.md).

Ссылки на поля, доступные в журналах службы хранилища Azure в Azure Monitor, см. в разделе [журналы ресурсов (Предварительная версия)](../blobs/monitor-blob-storage-reference.md#resource-logs-preview).

### <a name="query-logged-requests-by-tls-version"></a>Запросы, регистрируемые в журнале по версии TLS

Журналы службы хранилища Azure в Azure Monitor включают версию TLS, используемую для отправки запроса в учетную запись хранения. Используйте свойство **тлсверсион** , чтобы проверить версию TLS зарегистрированного запроса.

Чтобы определить, сколько запросов было выполнено в хранилище BLOB-объектов с разными версиями TLS за последние семь дней, откройте рабочую область Log Analytics. Затем вставьте следующий запрос в новый запрос к журналу и запустите его. Не забудьте заменить значения заполнителей в квадратных скобках собственными значениями:

```kusto
StorageBlobLogs
| where TimeGenerated > ago(7d) and AccountName == "<account-name>"
| summarize count() by TlsVersion
```

В результатах отображается количество запросов, выполненных с каждой версией TLS:

:::image type="content" source="media/transport-layer-security-configure-minimum-version/log-analytics-query-version.png" alt-text="Снимок экрана, показывающий результаты запроса log Analytics для возврата версии TLS":::

### <a name="query-logged-requests-by-caller-ip-address-and-user-agent-header"></a>Запрос зарегистрированных запросов по IP-адресу звонящего и заголовку агента пользователя

Журналы службы хранилища Azure в Azure Monitor также включают IP-адрес вызывающей стороны и заголовок агента пользователя, которые помогут оценить, какие клиентские приложения обращаются к учетной записи хранения. Вы можете проанализировать эти значения, чтобы решить, следует ли обновить клиентские приложения для использования более новой версии протокола TLS или можно ли не выполнять запрос клиента, если он не отправляется с минимальной версией TLS.

Чтобы определить, какие клиенты внесли запросы с версией TLS старше, чем TLS 1,2 за последние семь дней, вставьте следующий запрос в новый запрос к журналу и запустите его. Не забудьте заменить значения заполнителей в квадратных скобках собственными значениями:

```kusto
StorageBlobLogs
| where TimeGenerated > ago(7d) and AccountName == "<account-name>" and TlsVersion != "TLS 1.2"
| project TlsVersion, CallerIpAddress, UserAgentHeader
```

## <a name="remediate-security-risks-with-a-minimum-version-of-tls"></a>Устранение угроз безопасности с помощью минимальной версии TLS

Если вы уверены, что трафик от клиентов, использующих более старые версии TLS, является минимальным, или что можно не допустить запросов, созданных с помощью более старой версии протокола TLS, вы можете приступить к принудительному применению минимальной версии TLS в учетной записи хранения. Требовать, чтобы клиенты использовали минимальную версию протокола TLS для выполнения запросов к учетной записи хранения, является частью стратегии для снижения угроз безопасности для данных.

> [!IMPORTANT]
> Если вы используете службу, которая подключается к службе хранилища Azure, убедитесь, что эта служба использует соответствующую версию протокола TLS для отправки запросов в службу хранилища Azure до того, как будет задана требуемая минимальная версия для учетной записи хранения.

### <a name="configure-the-minimum-tls-version-for-a-storage-account"></a>Настройка минимальной версии TLS для учетной записи хранения

Чтобы настроить минимальную версию TLS для учетной записи хранения, задайте версию **минимумтлсверсион** для учетной записи. Это свойство доступно для всех учетных записей хранения, созданных с помощью модели развертывания Azure Resource Manager. Дополнительные сведения о модели развертывания Azure Resource Manager см. в разделе [Общие сведения об учетной записи хранения](storage-account-overview.md).

Свойство **минимумтлсверсион** не задано по умолчанию и не возвращает значение, пока оно не будет явно задано.  Если значение свойства равно **null**, учетная запись хранения разрешит запросы, отправленные с помощью TLS версии 1,0 или более поздней.

# <a name="portal"></a>[Портал](#tab/portal)

При создании учетной записи хранения с портал Azure по умолчанию для минимальной версии TLS устанавливается значение 1,2.

Чтобы настроить минимальную версию TLS для существующей учетной записи хранения с портал Azure, выполните следующие действия.

1. Войдите в свою учетную запись хранения на портале Azure.
1. Выберите параметр **конфигурации** .
1. В разделе **Минимальная версия TLS** используйте раскрывающийся список, чтобы выбрать минимальную версию TLS, необходимую для доступа к данным в этой учетной записи хранения, как показано на следующем рисунке.

    :::image type="content" source="media/transport-layer-security-configure-minimum-version/configure-minimum-version-portal.png" alt-text="Снимок экрана, показывающий, как настроить минимальную версию TLS в портал Azure":::

# <a name="powershell"></a>[PowerShell](#tab/powershell)

Чтобы настроить минимальную версию TLS для учетной записи хранения с помощью PowerShell, установите [Azure PowerShell версии 4.4.0](https://www.powershellgallery.com/packages/Az/4.4.0) или более поздней. Затем настройте свойство **минимумтлсверсион** для новой или существующей учетной записи хранения. Допустимые значения для **минимумтлсверсион** : `TLS1_0` , `TLS1_1` и `TLS1_2` .

В следующем примере создается учетная запись хранения и задается **МИНИМУМТЛСВЕРСИОН** TLS 1,1, затем обновляется учетная запись и задается **минимумтлсверсион** в TLS 1,2. В этом примере также извлекается значение свойства в каждом случае. Не забудьте заменить значения заполнителей в квадратных скобках собственными значениями:

```powershell
$rgName = "<resource-group>"
$accountName = "<storage-account>"
$location = "<location>"

# Create a storage account with MinimumTlsVersion set to TLS 1.1.
New-AzStorageAccount -ResourceGroupName $rgName `
    -AccountName $accountName `
    -Location $location `
    -SkuName Standard_GRS `
    -MinimumTlsVersion TLS1_1

# Read the MinimumTlsVersion property.
(Get-AzStorageAccount -ResourceGroupName $rgName -Name $accountName).MinimumTlsVersion

# Update the MinimumTlsVersion version for the storage account to TLS 1.2.
Set-AzStorageAccount -ResourceGroupName $rgName `
    -AccountName $accountName `
    -MinimumTlsVersion TLS1_2

# Read the MinimumTlsVersion property.
(Get-AzStorageAccount -ResourceGroupName $rgName -Name $accountName).MinimumTlsVersion
```

# <a name="azure-cli"></a>[Azure CLI](#tab/azure-cli)

Чтобы настроить минимальную версию TLS для учетной записи хранения с Azure CLI, установите Azure CLI версии 2.9.0 или более поздней. Дополнительные сведения см. в статье [Установка Azure CLI](/cli/azure/install-azure-cli). Затем настройте свойство **минимумтлсверсион** для новой или существующей учетной записи хранения. Допустимые значения для **минимумтлсверсион** : `TLS1_0` , `TLS1_1` и `TLS1_2` .

В следующем примере создается учетная запись хранения и задается **МИНИМУМТЛСВЕРСИОН** TLS 1,1. Затем он обновляет учетную запись и устанавливает для свойства **минимумтлсверсион** значение TLS 1,2. В этом примере также извлекается значение свойства в каждом случае. Не забудьте заменить значения заполнителей в квадратных скобках собственными значениями:

```azurecli-interactive
az storage account create \
    --name <storage-account> \
    --resource-group <resource-group> \
    --kind StorageV2 \
    --location <location> \
    --min-tls-version TLS1_1

az storage account show \
    --name <storage-account> \
    --resource-group <resource-group> \
    --query minimumTlsVersion \
    --output tsv

az storage account update \
    --name <storage-account> \
    --resource-group <resource-group> \
    --min-tls-version TLS1_2

az storage account show \
    --name <storage-account> \
    --resource-group <resource-group> \
    --query minimumTlsVersion \
    --output tsv
```

# <a name="template"></a>[Шаблон](#tab/template)

Чтобы настроить минимальную версию TLS для учетной записи хранения с помощью шаблона, создайте шаблон со свойством **минимумтлсверсион** , для которого задано значение `TLS1_0` , `TLS1_1` или `TLS1_2` . Следующие шаги описывают создание шаблона в портал Azure.

1. В портал Azure выберите **создать ресурс**.
1. В **поле Поиск в Marketplace** введите **шаблон развертывание** и нажмите клавишу **Ввод**.
1. Выберите **шаблоны развертывания (развернуть с помощью пользовательских шаблонов) (Предварительная версия)**, нажмите кнопку **создать**, а затем выберите **построить собственный шаблон в редакторе**.
1. В редакторе шаблонов вставьте следующий код JSON, чтобы создать новую учетную запись и задать для минимальной версии TLS значение TLS 1,2. Не забудьте заменить заполнители в угловых скобках собственными значениями.

    ```json
    {
        "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
        "contentVersion": "1.0.0.0",
        "parameters": {},
        "variables": {
            "storageAccountName": "[concat(uniqueString(subscription().subscriptionId), 'tls')]"
        },
        "resources": [
            {
            "name": "[variables('storageAccountName')]",
            "type": "Microsoft.Storage/storageAccounts",
            "apiVersion": "2019-06-01",
            "location": "<location>",
            "properties": {
                "minimumTlsVersion": "TLS1_2"
            },
            "dependsOn": [],
            "sku": {
              "name": "Standard_GRS"
            },
            "kind": "StorageV2",
            "tags": {}
            }
        ]
    }
    ```

1. при сохранении шаблона;
1. Укажите параметр группы ресурсов, а затем нажмите кнопку " **Проверка и создание** ", чтобы развернуть шаблон и создать учетную запись хранения с настроенным свойством **минимумтлсверсион** .

---

> [!NOTE]
> После обновления минимальной версии TLS для учетной записи хранения может потребоваться до 30 секунд, прежде чем изменение будет полностью распространено.

Для настройки минимальной версии TLS требуется поставщик ресурсов службы хранилища Azure версии 2019-04-01 или более поздней. Дополнительные сведения см. в статье [REST API поставщика ресурсов службы хранилища Azure](/rest/api/storagerp/).

### <a name="check-the-minimum-required-tls-version-for-multiple-accounts"></a>Проверка минимальной требуемой версии TLS для нескольких учетных записей

Чтобы проверить минимальную необходимую версию протокола TLS в наборе учетных записей хранения с оптимальной производительностью, можно использовать обозреватель графа ресурсов Azure в портал Azure. Дополнительные сведения об использовании обозревателя графа ресурсов см. в статье [Краткое руководство. выполнение первого запроса Graph в Azure с помощью обозревателя Graph](../../governance/resource-graph/first-query-portal.md).

Выполнение следующего запроса в обозревателе графа ресурсов возвращает список учетных записей хранения и отображает минимальную версию TLS для каждой учетной записи:

```kusto
resources
| where type =~ 'Microsoft.Storage/storageAccounts'
| extend minimumTlsVersion = parse_json(properties).minimumTlsVersion
| project subscriptionId, resourceGroup, name, minimumTlsVersion
```

### <a name="test-the-minimum-tls-version-from-a-client"></a>Проверка минимальной версии TLS от клиента

Чтобы проверить, что минимальная необходимая версия TLS для учетной записи хранения запрещает вызовы, созданные с использованием более старой версии, можно настроить клиент на использование более старой версии протокола TLS. Дополнительные сведения о настройке клиента для использования определенной версии протокола TLS см. в статье [Настройка безопасности транспортного уровня (TLS) для клиентского приложения](transport-layer-security-configure-client-version.md).

Когда клиент обращается к учетной записи хранения с использованием версии TLS, которая не соответствует минимальной версии TLS, настроенной для учетной записи, служба хранилища Azure возвращает код ошибки 400 (неверный запрос) и сообщение, указывающее, что используемая версия TLS не разрешена для выполнения запросов к этой учетной записи хранения.

## <a name="use-azure-policy-to-audit-for-compliance"></a>Использование политики Azure для аудита соответствия

При наличии большого количества учетных записей хранения может потребоваться выполнить аудит, чтобы убедиться, что для всех учетных записей настроена минимальная версия TLS, необходимая вашей организации. Чтобы выполнить аудит набора учетных записей хранения для их соответствия, используйте политику Azure. Политика Azure — это служба, которую можно использовать для создания, назначения и управления политиками, которые применяют правила к ресурсам Azure. Политика Azure помогает защитить эти ресурсы в соответствии с корпоративными стандартами и соглашениями об уровне обслуживания. Дополнительные сведения см. в статье [Что такое служба "Политика Azure"?](../../governance/policy/overview.md).

### <a name="create-a-policy-with-an-audit-effect"></a>Создание политики с помощью действия аудита

Политика Azure поддерживает эффекты, которые определяют, что происходит при оценке правила политики для ресурса. В результате аудита создается предупреждение, если ресурс не соответствует требованиям, но не останавливает запрос. Дополнительные сведения о влиянии см. в статье об [эффектах политики Azure](../../governance/policy/concepts/effects.md).

Чтобы создать политику с результатом аудита для минимальной версии TLS с портал Azure, выполните следующие действия.

1. В портал Azure перейдите к службе "политика Azure".
1. В разделе " **Разработка** " выберите **определения**.
1. Выберите **Добавить определение политики** , чтобы создать новое определение политики.
1. В поле **Расположение определения** нажмите кнопку **Дополнительно** , чтобы указать, где находится ресурс политики аудита.
1. Укажите имя политики. При необходимости можно указать описание и категорию.
1. В разделе **правило политики** добавьте следующее определение политики в раздел **класс policyrule** .

    ```json
    {
      "policyRule": {
        "if": {
          "allOf": [
            {
              "field": "type",
              "equals": "Microsoft.Storage/storageAccounts"
            },
            {
              "not": {
                "field": "Microsoft.Storage/storageAccounts/minimumTlsVersion",
                "equals": "TLS1_2"
              }
            }
          ]
        },
        "then": {
          "effect": "audit"
        }
      }
    }
    ```

1. Сохраните политику.

### <a name="assign-the-policy"></a>Назначение политики

Затем назначьте политику для ресурса. Область политики соответствует этому ресурсу и всем его ресурсам под ним. Дополнительные сведения о назначении политики см. в разделе [Структура назначения политики Azure](../../governance/policy/concepts/assignment-structure.md).

Чтобы назначить политику с портал Azure, выполните следующие действия.

1. В портал Azure перейдите к службе "политика Azure".
1. В разделе " **Разработка** " выберите **назначения**.
1. Выберите **назначить политику** , чтобы создать новое назначение политики.
1. В поле **область** выберите область назначения политики.
1. В поле **Определение политики** нажмите кнопку **Дополнительно** , а затем выберите политику, определенную в предыдущем разделе, из списка.
1. Укажите имя для назначения политики. Описание является необязательным.
1. Оставьте *включенным* **принудительное применение политики** . Этот параметр не влияет на политику аудита.
1. Выберите **проверить и создать** , чтобы создать назначение.

### <a name="view-compliance-report"></a>Просмотр отчета о соответствии

После назначения политики можно просмотреть отчет о соответствии. Отчет о соответствии для политики аудита содержит сведения о том, какие учетные записи хранения не соответствуют политике. Дополнительные сведения см. в статье [Получение данных о соответствии политики](../../governance/policy/how-to/get-compliance-data.md).

После создания назначения политики может потребоваться несколько минут, чтобы отчет о соответствии стал доступным.

Чтобы просмотреть отчет о соответствии в портал Azure, выполните следующие действия.

1. В портал Azure перейдите к службе "политика Azure".
1. Выберите **соответствие**.
1. Отфильтруйте результаты для имени назначения политики, созданного на предыдущем шаге. Отчет показывает, сколько ресурсов не соответствует политике.
1. Вы можете детализировать отчет для получения дополнительных сведений, включая список учетных записей хранения, которые не соответствуют требованиям.

    :::image type="content" source="media/transport-layer-security-configure-minimum-version/compliance-report-policy-portal.png" alt-text="Снимок экрана с отчетом о соответствии для политики аудита для минимальной версии TLS":::

## <a name="use-azure-policy-to-enforce-the-minimum-tls-version"></a>Использование политики Azure для применения минимальной версии TLS

Политика Azure поддерживает управление облаком, гарантируя, что ресурсы Azure соответствуют требованиям и стандартам. Чтобы применить минимальные требования к версии TLS для учетных записей хранения в Организации, можно создать политику, запрещающую создание новой учетной записи хранения, которая устанавливает минимальные требования к TLS для более старой версии TLS, чем определено политикой. Эта политика также предотвратит все изменения конфигурации существующей учетной записи, если параметр минимальной версии TLS для этой учетной записи не соответствует политике.

Политика принудительного применения использует отклонение, чтобы предотвратить запрос, создающий или изменяющий учетную запись хранения, чтобы минимальная версия TLS больше не соответствовала стандартам вашей организации. Дополнительные сведения о влиянии см. в статье об [эффектах политики Azure](../../governance/policy/concepts/effects.md).

Чтобы создать политику с результатом запрета для минимальной версии TLS, которая меньше, чем TLS 1,2, выполните те же действия, которые описаны в разделе [Использование политики Azure для аудита соответствия](#use-azure-policy-to-audit-for-compliance), но предоставьте следующий код JSON в раздел **класс policyrule** определения политики:

```json
{
  "policyRule": {
    "if": {
      "allOf": [
        {
          "field": "type",
          "equals": "Microsoft.Storage/storageAccounts"
        },
        {
          "not": {
            "field": "Microsoft.Storage/storageAccounts/minimumTlsVersion",
            "equals": "TLS1_2"
          }
        }
      ]
    },
    "then": {
      "effect": "deny"
    }
  }
}
```

После создания политики с действием Deny и назначения ее области пользователь не сможет создать учетную запись хранения с минимальной версией TLS, которая старше 1,2. Кроме того, пользователь не может вносить какие-либо изменения в конфигурацию существующей учетной записи хранения, которая в настоящее время требует минимальной версии TLS, которая старше 1,2. Попытка сделать это приведет к ошибке. Для продолжения создания или настройки учетной записи необходимо задать для минимальной версии TLS для учетной записи хранения значение 1,2.

На следующем рисунке показана ошибка, возникающая при попытке создать учетную запись хранения с минимальной версией TLS, установленной на TLS 1,0 (значение по умолчанию для новой учетной записи), если для политики с применением Deny требуется, чтобы минимальная версия TLS была настроена на TLS 1,2.

:::image type="content" source="media/transport-layer-security-configure-minimum-version/deny-policy-error.png" alt-text="Снимок экрана, показывающий ошибку, возникающую при создании учетной записи хранения с нарушением политики":::

## <a name="permissions-necessary-to-require-a-minimum-version-of-tls"></a>Разрешения, необходимые для требования минимальной версии TLS

Чтобы задать свойство **минимумтлсверсион** для учетной записи хранения, пользователь должен иметь разрешения на создание учетных записей хранения и управление ими. Роли управления доступом на основе ролей Azure (Azure RBAC), предоставляющие эти разрешения, включают в себя **Microsoft. Storage, storageAccounts/Write** или **Microsoft. Storage/ \* storageAccounts/** Action. Это действие включает следующие встроенные роли:

- Роль [владельца](../../role-based-access-control/built-in-roles.md#owner) Azure Resource Manager
- Роль [участника](../../role-based-access-control/built-in-roles.md#contributor) Azure Resource Manager
- Роль [участника учетной записи хранения](../../role-based-access-control/built-in-roles.md#storage-account-contributor)

Эти роли не обеспечивают доступ к данным в учетной записи хранения с помощью Azure Active Directory (Azure AD). Однако они включают в себя **Microsoft. Storage/storageAccounts/listkeys/Action**, которые предоставляют доступ к ключам доступа к учетной записи. С помощью этого разрешения пользователь может использовать ключи доступа к учетной записи для доступа ко всем данным в учетной записи хранения.

Назначение ролей должно быть ограничено уровнем учетной записи хранения или выше, чтобы разрешить пользователю требовать минимальную версию TLS для учетной записи хранения. Дополнительные сведения об области действия роли см. в статье [сведения о области действия для Azure RBAC](../../role-based-access-control/scope-overview.md).

Не забудьте ограничить назначение этих ролей только теми, кому требуется возможность создания учетной записи хранения или обновления ее свойств. Используйте принцип минимальных привилегий, чтобы убедиться, что пользователи имеют минимальные разрешения, необходимые для выполнения своих задач. Дополнительные сведения об управлении доступом с помощью Azure RBAC см. в статье рекомендации [по использованию Azure RBAC](../../role-based-access-control/best-practices.md).

> [!NOTE]
> Администратор службы роли администратора классической подписки и Co-Administrator включает в себя эквивалент роли [владельца](../../role-based-access-control/built-in-roles.md#owner) Azure Resource Manager. Роль **владелец** включает все действия, поэтому пользователь с одной из этих административных ролей может также создавать учетные записи хранения и управлять ими. Дополнительные сведения см. в статье [Роли классического администратора подписки, роли Azure и роли администратора Azure AD](../../role-based-access-control/rbac-and-directory-admin-roles.md#classic-subscription-administrator-roles).

## <a name="network-considerations"></a>Рекомендации по сети

Когда клиент отправляет запрос в учетную запись хранения, он сначала устанавливает соединение с общедоступной конечной точкой учетной записи хранения перед обработкой любых запросов. Параметр минимальной версии TLS проверяется после установки соединения. Если в запросе используется более ранняя версия TLS, чем задано параметром, соединение будет продолжаться успешно, но запрос в конечном итоге завершится ошибкой. Дополнительные сведения о общедоступных конечных точках для службы хранилища Azure см. в разделе [синтаксис URI ресурсов](/rest/api/storageservices/naming-and-referencing-containers--blobs--and-metadata#resource-uri-syntax).

## <a name="next-steps"></a>Дальнейшие действия

- [Настройка протокола TLS для клиентского приложения](transport-layer-security-configure-client-version.md)
- [Рекомендации по обеспечению безопасности для хранилища BLOB-объектов](../blobs/security-recommendations.md)
