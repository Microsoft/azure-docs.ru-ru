---
title: Избыточность данных
titleSuffix: Azure Storage
description: Сведения о избыточности данных в службе хранилища Azure. Данные в учетной записи хранения Microsoft Azure реплицируются для обеспечения устойчивости и высокого уровня доступности.
services: storage
author: tamram
ms.service: storage
ms.topic: conceptual
ms.date: 01/08/2021
ms.author: tamram
ms.subservice: common
ms.openlocfilehash: cd4b0b53cdc818cc942382021c1dff97b22f1243
ms.sourcegitcommit: 8dd8d2caeb38236f79fe5bfc6909cb1a8b609f4a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "98051621"
---
# <a name="azure-storage-redundancy"></a>Избыточность хранилища Azure

В службе хранилища Azure всегда хранится несколько копий данных для защиты от запланированных и незапланированных событий, включая временные сбои оборудования, сети или энергоснабжения, масштабные стихийные бедствия и т. д. Избыточность гарантирует, что ваша учетная запись хранения будет соответствовать целям доступности и устойчивости даже в случае сбоев.

При принятии решения о том, какой вариант избыточности лучше всего подходит для вашего сценария, рассмотрите компромиссы между более низкими затратами и высокой доступностью. Чтобы выбрать подходящий вариант обеспечения избыточности, ответьте на следующие вопросы.  

- Каким образом данные реплицируются в основном регионе?
- Реплицируются ли ваши данные во второй регион, географически отдаленный к основному региону, для защиты от региональных аварий
- Требуется ли приложению доступ на чтение для реплицированных данных в дополнительном регионе, если основной регион по какой-либо причине становится недоступен?

## <a name="redundancy-in-the-primary-region"></a>Избыточность в основном регионе

Данные в учетной записи хранения Azure всегда реплицируются в основном регионе три раза. Служба хранилища Azure предлагает два варианта репликации данных в основном регионе.

- **Локально избыточное хранилище (LRS)** синхронно копирует данные три раза в пределах одного физического расположения в основном регионе. Хранилище LRS является наименее дорогостоящим вариантом репликации, но его не рекомендуется использовать для приложений, требующих высокой доступности.
- **Хранилище, избыточное между зонами (ZRS)** , синхронно копирует данные в трех Зонах доступности Azure в основном регионе. Для приложений, которым требуется высокий уровень доступности, корпорация Майкрософт рекомендует использовать ZRS в основном регионе, а также репликацию в дополнительный регион.

### <a name="locally-redundant-storage"></a>Локально избыточное хранилище

Локально избыточное хранилище (LRS) реплицирует данные три раза в пределах одного физического расположения в основном регионе. LRS обеспечивает устойчивость объектов как минимум на уровне 99,999999999 % (11 девяток) в течение заданного года.

LRS стоит меньше всего и обеспечивает самый низкий уровень избыточности по сравнению с другими вариантами репликации. LRS защищает ваши данные от сбоев в стойках сервера и на дисках. Однако в случае аварии в центре обработки данных, например пожара или наводнения, все реплики учетной записи хранения, использующие LRS, могут быть утрачены или оказаться непригодными для восстановления. Чтобы уменьшить этот риск, корпорация Майкрософт рекомендует использовать [хранилище, избыточное между зонами](#zone-redundant-storage) (ZRS), [геоизбыточное хранилище](#geo-redundant-storage) (GRS) или [хранилище, геоизбыточное между зонами](#geo-zone-redundant-storage) (GZRS).

Запрос на запись в учетную запись хранения, использующую LRS, выполняется синхронно. Операция записи считается успешно выполненной только после записи данных во все три реплики.

LRS хорошо подходит для следующих сценариев:

- Если в вашем приложении хранятся данные, которые можно легко воссоздать в случае их потери, можно выбрать LRS.
- LRS можно выбрать, если ваше приложение реплицирует данные только в одной стране или регионе из-за нормативных требований. В некоторых случаях парные регионы, в которых данные реплицируются в географически удаленные расположения, могут находиться в другой стране или регионе. Дополнительные сведения о парных регионах см. на странице [Регионы Azure](https://azure.microsoft.com/regions/).

### <a name="zone-redundant-storage"></a>Хранилище, избыточное между зонами

Хранилище, избыточное между зонами (ZRS), синхронно реплицирует данные службы хранилища Azure в трех Зонах доступности Azure в основном регионе. Каждая зона доступности — это отдельное физическое расположение с независимым питанием, охлаждением и сетью. ZRS обеспечивает устойчивость объектов данных службы хранилища Azure как минимум на уровне 99,9999999999 % (12 девяток) в течение определенного года.

С ZRS ваши данные будут по-прежнему доступны для чтения и записи, даже если зона становится недоступной. Если зона недоступна, Azure выполняет обновления сети, например перенаправление DNS. Такие обновления могут повлиять на приложение, если вы получаете доступ к своим данным до завершения обновлений. При разработке приложений для ZRS следуйте рекомендациям по обработке временных сбоев, в том числе по реализации политик повтора с экспоненциальной задержкой.

Запрос на запись в учетную запись хранения, использующую ZRS, выполняется синхронно. Операция записи считается успешно выполненной только после записи данных во все реплики во всех трех зонах доступности.

Корпорация Майкрософт рекомендует использовать ZRS в основном регионе для сценариев, требующих согласованности, устойчивости и высокой доступности. Мы также советуем использовать ZRS, если хотите ограничить приложение для репликации данных только в стране или регионе из-за требований к управлению данными.

ZRS обеспечивает отличную производительность, низкую задержку и устойчивость данных, если они становятся временно недоступными. Однако само по себе хранилище ZRS не может защитить данные от региональной аварии, при которой полностью выходит из строя несколько зон. Чтобы защититься от региональных аварий, корпорация Майкрософт рекомендует использовать [хранилище, геоизбыточное между зонами](#geo-zone-redundant-storage) (GZRS), которое использует ZRS в основном регионе, а также георепликацию данных в дополнительный регион.

В следующей таблице показано, какие типы учетных записей хранения поддерживают ZRS в тех или иных регионах.

| Тип учетной записи хранения | Поддерживаемые регионы | Поддерживаемые службы |
|--|--|--|
| Общего назначения версии 2<sup>1</sup> | Юго-восточная Азия<br /> Восточная Австралия<br /> Северная Европа<br />  Западная Европа<br /> Центральная Франция<br /> Восточная Япония<br /> Северная часть ЮАР;<br /> южная часть Соединенного Королевства<br /> Центральная часть США<br /> Восточная часть США<br /> Восточная часть США 2<br /> Западная часть США 2 | Blob-блоки<br /> Страничные BLOB-объекты<sup>2</sup><br /> Общие папки (стандартные)<br /> Таблицы<br /> Очереди<br /> |
| BlockBlobStorage<sup>1</sup> | Юго-восточная Азия<br /> Восточная Австралия<br /> Северная Европа<br /> Западная Европа<br /> Восточная Япония<br /> Восточная часть США <br /> Восточная часть США 2 <br /> Западная часть США 2| Только блочные BLOB-объекты класса Premium |
| FileStorage | Юго-восточная Азия<br /> Восточная Австралия<br /> Северная Европа<br /> Западная Европа<br /> Восточная Япония<br /> Восточная часть США <br /> Восточная часть США 2 <br /> Западная часть США 2 | Только общие файловые ресурсы Premium |

<sup>1</sup> Уровень архива для учетных записей ZRS в настоящее время не поддерживается.<br />
<sup>2</sup> Для учетных записей хранения, содержащих управляемые диски Azure для виртуальных машин, всегда используется LRS. Для неуправляемых дисков Azure также следует использовать LRS. Для них можно создать учетную запись хранения, использующую GRS, но это не рекомендуется из-за потенциальных проблем с согласованностью при асинхронной георепликации. Ни управляемые, ни неуправляемые диски не поддерживают ZRS или GZRS. Дополнительные сведения см. на странице [цен на управляемые диски Azure](https://azure.microsoft.com/pricing/details/managed-disks/).

Сведения о том, какие регионы поддерживают ZRS, см. в статье о [Зонах доступности Azure](../../availability-zones/az-overview.md) в разделе, посвященном **поддержке служб по регионам**.

## <a name="redundancy-in-a-secondary-region"></a>Избыточность в дополнительном регионе

Для приложений, которым требуется высокий уровень доступности, можно также скопировать данные из учетной записи хранения в дополнительный регион, который находится в сотнях километров от основного. Если данные в учетной записи хранения копируются в дополнительный регион, они будут устойчивы даже в случае отключения электричества во всем регионе или аварии, в результате которой основной регион восстановить невозможно.

При создании учетной записи хранения вы выбираете первичный регион для учетной записи. Парный дополнительный регион определяется на основе основного региона, его невозможно изменить. Дополнительные сведения о регионах, поддерживаемых Azure, см. на странице [Регионы Azure](https://azure.microsoft.com/global-infrastructure/regions/).

Служба хранилища Azure предлагает два варианта копирования данных в дополнительный регион.

- **Геоизбыточное хранилище (GRS)** синхронно копирует данные три раза в пределах одного физического расположения в основном регионе, используя LRS. Затем данные копируются асинхронно в одно физическое расположение в дополнительном регионе.
- **Хранилище, геоизбыточное между зонами (GZRS),** синхронно копирует данные в трех Зонах доступности Azure в основном регионе, используя ZRS. Затем данные копируются асинхронно в одно физическое расположение в дополнительном регионе.

Основное различие между GRS и GZRS заключается в способе репликации данных в основном регионе. В дополнительном регионе данные всегда реплицируются синхронно три раза с помощью LRS. LRS в дополнительном регионе защищает данные от сбоев оборудования.

При использовании GRS или ГЗРС данные в дополнительном регионе недоступны для чтения или записи, если в дополнительный регион не выполняется отработка отказа. Чтобы получить доступ на чтение к дополнительному региону, настройте учетную запись хранения для использования геоизбыточного хранилища с доступом на чтение (RA-GRS) или хранилища, избыточного в пределах геозоны с доступом на чтение (RA-ГЗРС). Дополнительные сведения см. в разделе [Доступ на чтение для данных в дополнительном регионе](#read-access-to-data-in-the-secondary-region).

Если основной регион становится недоступным, можно выбрать отработку отказа в дополнительном регионе. После завершения отработки отказа дополнительный регион станет основным и вы снова сможете считывать и записывать данные. Дополнительные сведения об аварийном восстановлении и отработке отказа в дополнительном регионе см. в разделе [Аварийное восстановление и отработка отказа учетной записи хранения](storage-disaster-recovery-guidance.md).

> [!IMPORTANT]
> Так как данные реплицируются в дополнительный регион асинхронно, сбой в основном регионе может привести к утере данных, если этот регион восстановить невозможно. Интервал между последними операциями записи в основном регионе и последней записью в дополнительный регион называется целевой точкой восстановления (RPO). RPO указывает момент времени, до которого данные могут быть восстановлены. Обычно RPO в службе хранилища Azure не превышает 15 минут, хотя на данный момент нет какого-либо Соглашения об уровне обслуживания, регулирующего интервалы репликации данных в дополнительный регион.

### <a name="geo-redundant-storage"></a>Геоизбыточное хранилище

Геоизбыточное хранилище (GRS) синхронно копирует данные три раза в пределах одного физического расположения в основном регионе, используя LRS. Затем данные копируются асинхронно в одно расположение в дополнительном регионе, который находится в сотнях километров от основного. GRS обеспечивает устойчивость объектов данных службы хранилища Azure как минимум на уровне 99,99999999999999 % (16 девяток) в течение определенного года.

Операция записи сначала фиксируется в основное расположение и реплицируется с использованием LRS. Затем обновление реплицируется асинхронно в дополнительный регион. При записи данных в дополнительное расположение они также реплицируются в этом расположении с использованием LRS.

### <a name="geo-zone-redundant-storage"></a>Хранилище, избыточное между зонами

Хранилище, геоизбыточное между зонами (GZRS), сочетает в себе высокий уровень доступности за счет избыточности зон доступности и защиту от региональных сбоев за счет георепликации. Данные в учетной записи хранения GZRS копируются в три [зоны доступности Azure](../../availability-zones/az-overview.md) в основном регионе, а также реплицируются в дополнительный географический регион для защиты от региональных аварий. Корпорация Майкрософт рекомендует использовать GZRS для приложений, которым необходима максимальная согласованность, устойчивость и доступность, а также отличная производительность и устойчивость для аварийного восстановления.

С помощью учетной записи хранения GZRS можно продолжить чтение и запись данных, если зона доступности становится недоступной или непригодной для восстановления. Кроме того, данные будут устойчивы в случае сбоя во всем регионе или аварии, в результате которой основной регион восстановить невозможно. GZRS обеспечивает устойчивость объектов как минимум на уровне 99,99999999999999 % (16 девяток) в течение определенного года.

GZRS и RA-GZRS поддерживают только учетные записи хранения общего назначения версии 2. Дополнительные сведения о типах учетных записей хранения см. в статье [Общие сведения об учетной записи хранения](storage-account-overview.md). GZRS и RA-GZRS поддерживают блочные и страничные BLOB-объекты (за исключением виртуальных жестких дисков), файлы, таблицы и очереди.

GZRS и RA-GZRS поддерживаются в следующих регионах:

- Юго-восточная Азия
- Северная Европа
- Западная Европа
- Восточная Япония
- южная часть Соединенного Королевства
- Центральная часть США
- Восточная часть США
- Восточная часть США 2
- Западная часть США 2

Сведения о ценах см. в соответствующих разделах для [больших двоичных объектов](https://azure.microsoft.com/pricing/details/storage/blobs), [файлов](https://azure.microsoft.com/pricing/details/storage/files/), [очередей](https://azure.microsoft.com/pricing/details/storage/queues/) и [таблиц](https://azure.microsoft.com/pricing/details/storage/tables/).

## <a name="read-access-to-data-in-the-secondary-region"></a>Доступ на чтение для данных в дополнительном регионе

Геоизбыточное хранилище (с GRS или GZRS) реплицирует данные в другое физическое расположение в дополнительном регионе для защиты от региональных сбоев. Однако эти данные доступны для чтения только в том случае, если клиент или корпорация Майкрософт инициирует отработку отказа из основного региона в дополнительный. При включении доступа для чтения к дополнительному региону данные доступны для чтения в любое время, в том числе в ситуации, когда основной регион становится недоступным. Чтобы получить доступ на чтение в дополнительном регионе, включите геоизбыточное хранилище с доступом на чтение (RA-GRS) или хранилище, геоизбыточное между зонами, с доступом на чтение (RA-GZRS).

> [!NOTE]
> Служба файлов Azure не поддерживает геоизбыточное хранилище с доступом на чтение (RA-GRS) и хранилище, избыточное в геозону с доступом на чтение (RA-ГЗРС).

### <a name="design-your-applications-for-read-access-to-the-secondary"></a>Разработка приложений для доступа на чтение в дополнительном регионе

Если ваша учетная запись хранения настроена для доступа на чтение в дополнительном регионе, вы можете разрабатывать приложения таким образом, чтобы в них можно было легко переключаться на чтение данных из дополнительного региона в случае недоступности основного по той или иной причине. 

Дополнительный регион доступен для чтения после включения RA-GRS или RA-ГЗРС, поэтому можно протестировать приложение заранее, чтобы убедиться, что оно будет правильно прочитано из базы данных-получателя в случае сбоя. Дополнительные сведения о проектировании приложений для обеспечения высокой доступности см. в разделе [Разработка высокодоступных приложений с геоизбыточностью](geo-redundant-design.md).

Если доступ на чтение к вторичной реплике включен, приложение можно считать из вторичной конечной точки, а также из основной конечной точки. В случае дополнительной конечной точки к имени учетной записи добавляется суффикс *–secondary*. Например, если основная конечная точка для хранилища BLOB-объектов — `myaccount.blob.core.windows.net`, то дополнительной конечной точкой будет `myaccount-secondary.blob.core.windows.net`. Ключи доступа для учетной записи хранения одинаковые как для основной, так и для дополнительной конечных точек.

### <a name="check-the-last-sync-time-property"></a>Проверка свойства "Время последней синхронизации"

Так как данные реплицируются в дополнительный регион асинхронно, в дополнительном регионе часто не хватает новейших данных из основного региона. Если в основном регионе происходит сбой, скорее всего, в дополнительный регион будут реплицированы не все операции записи из основного региона.

Чтобы определить, какие операции записи были реплицированы в дополнительный регион, приложение может проверить свойство **Время последней синхронизации** для учетной записи хранения. Все операции записи, выполненные в основном регионе до последней синхронизации, были успешно реплицированы в дополнительный регион. Это означает, что созданные с их помощью данные доступны для чтения в дополнительном регионе. Любые операции записи, выполненные в основном регионе после последней синхронизации, могут оказаться не реплицированными в дополнительный регион. Это означает, что созданные с их помощью данные могут быть недоступны для операций чтения.

Значение свойства **Время последней синхронизации** можно запросить с помощью Azure PowerShell, Azure CLI или одной из клиентских библиотек службы хранилища Azure. Свойство **Время последней синхронизации** содержит значение даты и времени по Гринвичу (в формате GMT). Дополнительные сведения см. в разделе [Проверка свойства "Время последней синхронизации" для учетной записи хранения](last-sync-time-get.md).

## <a name="summary-of-redundancy-options"></a>Сводка по вариантам обеспечения избыточности

В таблицах в следующих разделах приведена сводка по вариантам обеспечения избыточности, доступным для службы хранилища Azure.

### <a name="durability-and-availability-parameters"></a>Параметры устойчивости и доступности

В следующей таблице описаны основные параметры для каждого варианта обеспечения избыточности.

| Параметр | LRS | ZRS | GRS или RA-GRS | GZRS или RA-GZRS |
|:-|:-|:-|:-|:-|
| Процент устойчивости объектов за заданный год | не менее 99,999999999 % (11 девяток) | не менее 99,9999999999 % (12 девяток) | не менее 99,99999999999999 % (16 девяток) | не менее 99,99999999999999 % (16 девяток) |
| Доступность для запросов на чтение | По крайней мере 99,9 % (99 % для холодного уровня доступа) | По крайней мере 99,9 % (99 % для холодного уровня доступа) | По крайней мере 99,9 % (99 % для холодного уровня доступа) для GRS<br /><br />По крайней мере 99,99 % (99,9 % для холодного уровня доступа) для RA-GRS | По крайней мере 99,9 % (99 % для холодного уровня доступа) для GZRS<br /><br />По крайней мере 99,99 % (99,9 % для холодного уровня доступа) для RA-GZRS |
| Доступность для запросов на запись | По крайней мере 99,9 % (99 % для холодного уровня доступа) | По крайней мере 99,9 % (99 % для холодного уровня доступа) | По крайней мере 99,9 % (99 % для холодного уровня доступа) | По крайней мере 99,9 % (99 % для холодного уровня доступа) |

### <a name="durability-and-availability-by-outage-scenario"></a>Устойчивость и доступность для отдельных сценариев сбоя

В следующей таблице указано, являются ли данные устойчивыми и доступными в определенных сценариях в зависимости от типа избыточности, который применяется для учетной записи хранения.

| Сценарий сбоя | LRS | ZRS | GRS или RA-GRS | GZRS или RA-GZRS |
|:-|:-|:-|:-|:-|
| Узел в центре обработки данных становится недоступным | Да | Да | Да | Да |
| Весь центр обработки данных (зональный или не зональный) становится недоступным | нет | Да | Да<sup>1</sup> | Да |
| Происходит сбой на уровне всего основного региона | нет | нет | Да<sup>1</sup> | Да<sup>1</sup> |
| В случае недоступности основного региона можно воспользоваться доступом на чтение в дополнительном регионе | нет | нет | Да (с RA-GRS) | Да (с RA-GZRS) |

<sup>1</sup> Для восстановления доступности записанных данных в случае недоступности основного региона необходима отработка отказа учетной записи. Дополнительные сведения см. в статье [Аварийное восстановление и отработка отказа учетной записи хранения](storage-disaster-recovery-guidance.md).

### <a name="supported-storage-account-types"></a>Поддерживаемые типы учетных записей хранения

В следующей таблице показано, какие варианты обеспечения избыточности поддерживаются каждым типом учетной записи хранения. Дополнительные сведения о типах учетных записей хранения см. в статье [Общие сведения об учетной записи хранения](storage-account-overview.md).

| LRS | ZRS | GRS или RA-GRS | GZRS или RA-GZRS |
|:-|:-|:-|:-|
| Общего назначения версии 2<br /> Общего назначения версии 1<br /> Хранилище блочных BLOB-объектов<br /> Хранилище BLOB-объектов<br /> Хранилище файлов | Общего назначения версии 2<br /> Хранилище блочных BLOB-объектов<br /> Хранилище файлов | Общего назначения версии 2<br /> Общего назначения версии 1<br /> Хранилище BLOB-объектов | Общего назначения версии 2 |

Все данные всех учетных записей хранения копируются соответствующим образом в зависимости от варианта обеспечения избыточности учетной записи хранения. Копируются объекты, включая блочные, добавочные и страничные BLOB-объекты, очереди, таблицы и файлы. Копируются данные на всех уровнях, включая уровень архива. Дополнительные сведения об уровнях для BLOB-объектов см. в статье [Хранилище BLOB-объектов Azure: горячий, холодный и архивный уровни](../blobs/storage-blob-storage-tiers.md).

Сведения о каждом варианте обеспечения избыточности данных приведены в [обзоре цен на службу хранилища Azure](https://azure.microsoft.com/pricing/details/storage/).

> [!NOTE]
> Сейчас Хранилище дисков Azure категории "Премиум" поддерживает только локально избыточное хранилище (LRS). Учетные записи хранения блочных BLOB-объектов поддерживают локально избыточное хранилище (LRS) и (в определенных регионах) хранилище, избыточное между зонами (ZRS).

## <a name="data-integrity"></a>Целостность данных

Служба хранилища Azure регулярно проверяет целостность хранимых данных с помощью циклических проверок избыточности (CRC). Если обнаружено повреждение данных, они будут восстановлены с использованием избыточных данных. Служба хранилища Azure также вычисляет контрольные суммы во всему сетевому трафику для обнаружения повреждений в пакетах данных при сохранении или извлечении.

## <a name="see-also"></a>См. также раздел

- [Проверка свойства "Время последней синхронизации" для учетной записи хранения](last-sync-time-get.md)
- [Изменение параметров избыточности для учетной записи хранения](redundancy-migration.md)
- [Разработка высокодоступных приложений с геоизбыточностью](geo-redundant-design.md)
- [Аварийное восстановление и отработка отказа учетной записи хранения](storage-disaster-recovery-guidance.md)
