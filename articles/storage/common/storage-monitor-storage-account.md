---
title: Как отслеживать учетную запись хранения Azure на портале Azure | Документация Майкрософт
description: Узнайте, как отслеживать учетную запись хранения в Azure с помощью портал Azure и Аналитика Службы хранилища Azure.
author: normesta
ms.service: storage
ms.topic: conceptual
ms.date: 01/09/2020
ms.author: normesta
ms.reviewer: fryu
ms.subservice: common
ms.custom: monitoring
ms.openlocfilehash: e5495b466bf9b16319b788ec32c7b3a03100f505
ms.sourcegitcommit: d59abc5bfad604909a107d05c5dc1b9a193214a8
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/14/2021
ms.locfileid: "98218148"
---
# <a name="monitor-a-storage-account-in-the-azure-portal"></a>Мониторинг учетной записи хранения на портале Azure

[Аналитика службы хранилища Azure](storage-analytics.md) предоставляет метрики для всех служб хранилища и журналы для больших двоичных объектов, очередей и таблиц. С помощью [портала Azure](https://portal.azure.com) можно настроить метрики и журналы, записываемые для вашей учетной записи, а также настроить диаграммы, которые обеспечивают визуальное представление данных этих метрик. 

Рекомендуем ознакомиться со статьей [Мониторинг службы хранилища с помощью Azure Monitor для хранилища](../../azure-monitor/insights/storage-insights-overview.md). Это функция Azure Monitor, которая обеспечивает комплексный мониторинг ваших учетных записей службы хранилища Azure, создавая единое представление данных о производительности, ресурсах и доступности ваших служб хранилища Azure. Для этого вам не требуется ничего включать или настраивать. Кроме того, вы можете мгновенно просматривать эти метрики в предварительно определенных интерактивных диаграммах и прочих доступных визуализациях.

> [!NOTE]
> За изучение данных мониторинга на портале Azure взимается плата. Дополнительные сведения см. в [этой статье](storage-analytics.md).
>
> Сейчас служба "Файлы Azure" поддерживает метрики решения "Аналитика службы хранилища", но не поддерживает ведение журналов.
>
> Учетные записи хранилища блочных BLOB-объектов с производительностью уровня "Премиум" не поддерживают метрики аналитики хранилища, но поддерживают ведение журналов. Вы также можете включить ведение журналов программно через REST API или клиентскую библиотеку. Если вы хотите просмотреть метрики с учетными записями хранилища BLOB-объектов с производительностью уровня "Премиум", мы рекомендуем использовать [метрики службы хранилища Azure в Azure Monitor](../blobs/monitor-blob-storage.md).
>
> Дополнительные указания о функциях аналитики хранилища и других инструментах идентификации, диагностики и устранения неполадок, связанных со службой хранилища Azure, см. в статье [Мониторинг, диагностика и устранение неполадок службы хранилища Microsoft Azure](storage-monitoring-diagnosing-troubleshooting.md).
>

<a id="modify-retention-policy"></a>

## <a name="configure-monitoring-for-a-storage-account"></a>Настройка мониторинга учетной записи хранения

1. На [портале Azure](https://portal.azure.com) выберите **Учетные записи хранения**, а затем щелкните имя учетной записи хранения, чтобы открыть ее панель мониторинга.
1. В колонке меню в разделе **Мониторинг** щелкните **Диагностика**.

    ![Снимок экрана, посвященный параметру "параметры диагностики" (классический) в разделе "мониторинг (классический)".](./media/storage-monitor-storage-account/storage-enable-metrics-00.png)

1. Выберите **тип** данных метрик для каждой **службы**, которую нужно отслеживать, и **политику хранения** для данных. Можно также отключить мониторинг, задав для параметра **Состояние** значение **Откл**.

    ![Параметры мониторинга](./media/storage-monitor-storage-account/storage-enable-metrics-01.png)

   Чтобы задать политику хранения данных, переместите ползунок **Хранение (дни)** или введите число дней хранения данных в диапазоне от 1 до 365. Значение по умолчанию для новых учетных записей хранения составляет семь дней. Если политику хранения задавать не нужно, введите ноль. Если политика хранения отсутствует, удаление данных мониторинга выполняется вручную.

   > [!WARNING]
   > За удаление данных метрик вручную взимается плата. Устаревшие данные аналитики (срок которых превышает значение, установленное политикой хранения) удаляются системой бесплатно. Рекомендуется устанавливать политику хранения в зависимости от того, как долго нужно хранить данные аналитики хранилища для вашей учетной записи. Дополнительные сведения см. в разделе [Выставление счетов за метрики хранилища](storage-analytics-metrics.md#billing-on-storage-metrics).
   >

1. Закончив настройку мониторинга, нажмите кнопку **Сохранить**.

На диаграммах в колонке учетной записи хранения отображается набор метрик по умолчанию, как и в отдельных колонках служб (BLOB-объектов, очередей, таблиц и файлов). После включения метрик для службы может пройти до часа, прежде чем их данные отобразятся на диаграммах. Вы можете выбрать **Изменить** на любой диаграмме метрики, чтобы настроить метрики, отображаемые на диаграмме.

Можно отключить сбор метрик и ведение журнала, задав для параметра **Состояние** значение **Откл**.

> [!NOTE]
> Служба хранилища Azure использует [хранилище таблиц](storage-introduction.md#table-storage) для хранения метрик вашей учетной записи хранения и хранит метрики в таблицах, расположенных в вашей учетной записи. Дополнительные сведения см. в разделе [Как хранятся метрики](storage-analytics-metrics.md#how-metrics-are-stored).
>

## <a name="customize-metrics-charts"></a>Настройка диаграмм метрик

Чтобы выбрать метрики хранилища для отображения на диаграмме метрик, выполните следующие действия.

1. Сначала отобразите диаграмму метрики службы хранилища на портале Azure. Диаграммы можно найти в **колонке учетной записи хранения** и в колонке **Метрики** для отдельных служб (BLOB-объектов, очередей, таблиц, файлов).

   В этом примере используется приведенная ниже диаграмма, которая отображается в **колонке учетной записи хранения**.

   ![Выбор диаграммы на портале Azure](./media/storage-monitor-storage-account/stg-customize-chart-00.png)

1. Щелкните любое место диаграммы, чтобы изменить ее.

1. Выберите **диапазон времени** метрик для отображения на диаграмме и **службу** (больших двоичных объектов, очередей, таблиц, файлов), метрики которой нужно отобразить. Выбраны отображение метрики службы BLOB-объектов за прошлую неделю.

   ![Выбор диапазона времени и службы в колонке "Правка диаграммы"](./media/storage-monitor-storage-account/storage-edit-metric-time-range.png)

1. Выберите отдельные **метрики**, которые нужно отобразить на диаграмме, затем нажмите кнопку **ОК**.

   ![Выбор отдельных метрик в колонке "Правка диаграммы"](./media/storage-monitor-storage-account/storage-edit-metric-selections.png)

Настройки диаграммы не влияют на сбор, статистическую обработку и хранение данных мониторинга в учетной записи хранения.

### <a name="metrics-availability-in-charts"></a>Доступность метрики на диаграммах

Список доступных метрик меняется в зависимости от того, какая служба выбрана из раскрывающегося списка и какой тип единиц использует изменяемая диаграмма. Например, процентные метрики, такие как *PercentNetworkError* и *PercentThrottlingError*, можно выбрать только в том случае, если требуется изменить диаграмму, показывающую единицы в процентах.

![Ошибка запроса к процентной диаграмме на портале Azure](./media/storage-monitor-storage-account/stg-customize-chart-04.png)

### <a name="metrics-resolution"></a>Разрешение метрик

Метрики, выбранные в колонке **Диагностика**, определяют разрешение метрик, доступных для вашей учетной записи.

* **Сводный** мониторинг позволяет собирать такие метрики, как метрики исходящего и входящего трафика, доступности, задержки и процента успешных операций. Эти метрики вычисляются для служб BLOB-объектов, очередей, таблиц и файлов.
* Мониторинг **каждого API** обеспечивает более точное разрешение, помимо статистических метрик уровня службы предоставляя метрики отдельных операций хранилища.

## <a name="configure-metrics-alerts"></a>Настройка оповещений метрик

Можно создать оповещения, чтобы получать уведомления о достижении пороговых значений для метрик ресурсов хранилища.

1. Чтобы открыть **колонку правил генерации оповещений**, прокрутите **колонку меню** вниз до раздела **Мониторинг** и выберите **Оповещения (классические)** .
2. Выберите **Добавить оповещение метрики (классическое)** , чтобы открыть колонку **Добавление правила оповещения**.
3. Укажите **имя** и **описание** для нового правила генерации оповещений.
4. Выберите **метрику**, для которой нужно добавить оповещение, и укажите **условие** и **пороговое значение** оповещения. Тип единицы порогового значения меняется в зависимости от выбранной метрики. Например, "количество" — тип единицы измерения для *ContainerCount*, тогда как единицей измерения для метрики *PercentNetworkError* является процент.
5. Выберите **период**. Если метрика достигает порогового значения или превышает его в течение периода, активируется оповещение.
6. (Необязательно.) Настройте уведомления с использованием **электронного адреса** и **webhook**. Дополнительные сведения об объектах webhook см. в разделе [Настройка объектов webhook для оповещений на основе метрик Azure](../../azure-monitor/platform/alerts-webhooks.md). Если не настроить уведомления с помощью электронной почты или webhook, то они будут отображаться только на портале Azure.

![Колонка "Добавление правила оповещения" на портале Azure](./media/storage-monitor-storage-account/add-alert-rule.png)

## <a name="add-metrics-charts-to-the-portal-dashboard"></a>Добавление диаграмм метрик на панель мониторинга портала

Диаграммы метрик службы хранилища Azure для любых учетных записей хранения можно добавить на панель мониторинга портала.

1. Откройте панель мониторинга на [портале Azure](https://portal.azure.com) и щелкните **Изменить панель мониторинга**.
1. В колонке **Коллекция плиток** выберите **Найти плитки по** > **Тип**.
1. Выберите **Тип** > **Учетные записи хранения**.
1. В колонке **ресурсы** выберите учетную запись, метрики которой вы хотите добавить на панель мониторинга.
1. Выберите **Категории** > **Мониторинг**.
1. Перетащите на панель мониторинга элемент диаграммы для метрики, которую нужно отобразить. Повторите это для всех метрик, которые требуется отобразить на панели мониторинга. На следующем рисунке в качестве примера выбрана диаграмма "Большие двоичные объекты — всего запросов", но на панель мониторинга можно добавить любую диаграмму.

   ![Коллекция элементов на портале Azure](./media/storage-monitor-storage-account/storage-customize-dashboard.png)
1. Завершив добавление диаграммы, выберите **Настройка выполнена** в верхней части панели мониторинга.

После добавления диаграмм на панель мониторинга их можно настроить, как описано в разделе "Настройка диаграмм метрик".

## <a name="configure-logging"></a>Настройка журнала

Можно указать службе хранилища Azure сохранять журналы диагностики для запросов на чтение, запись и удаление, отправляемых к службам BLOB-объектов, таблиц и очередей. Заданная политика хранения данных также применяется к этим журналам.

> [!NOTE]
> Сейчас служба "Файлы Azure" поддерживает метрики решения "Аналитика службы хранилища", но не поддерживает ведение журналов.
>

1. На [портале Azure](https://portal.azure.com) выберите **Учетные записи хранения**, а затем щелкните имя учетной записи хранения, чтобы открыть ее колонку.
1. Выберите **Параметры диагностики (классические)** в разделе **Мониторинг (классический)** в колонке меню.

    ![Пункт меню "Диагностика" в разделе "Мониторинг" на портале Azure](./media/storage-monitor-storage-account/storage-enable-metrics-00.png)

1. Убедитесь, что параметр **Состояние** имеет значение **Вкл.** , и выберите **службы**, для которых нужно включить ведение журнала.

    ![Настройка ведения журнала на портале Azure](./media/storage-monitor-storage-account/enable-diagnostics.png)
1. Выберите команду **Сохранить**.

Журналы диагностики сохраняются в контейнере BLOB-объектов с именем *$logs* в вашей учетной записи хранения. Данные журнала можно просмотреть с помощью обозревателя хранилищ, например [Обозреватель службы хранилища Microsoft Azure](https://storageexplorer.com), или программно с помощью клиентской библиотеки хранилища или PowerShell.

Дополнительные сведения о доступе к контейнеру $logs см. в статье [Ведение журнала аналитики службы хранилища Azure](storage-analytics-logging.md).

## <a name="next-steps"></a>Дальнейшие действия

* Дополнительные сведения о [метриках, ведении журнала и выставлении счетов](storage-analytics.md) для аналитики службы хранилища.