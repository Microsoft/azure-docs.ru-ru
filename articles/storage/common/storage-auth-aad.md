---
title: Авторизация доступа к BLOB-объектам и очередям с помощью Active Directory
titleSuffix: Azure Storage
description: Авторизуйте доступ к BLOB-объектам и очередям Azure с помощью Azure Active Directory (Azure AD). Назначение ролей Azure для прав доступа. Доступ к данным с помощью учетной записи Azure AD.
services: storage
author: tamram
ms.service: storage
ms.topic: conceptual
ms.date: 07/16/2020
ms.author: tamram
ms.reviewer: ozgun
ms.subservice: common
ms.openlocfilehash: 9d03496634c5d30d30b23a76b5b47b1e810af288
ms.sourcegitcommit: 867cb1b7a1f3a1f0b427282c648d411d0ca4f81f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "94635404"
---
# <a name="authorize-access-to-blobs-and-queues-using-azure-active-directory"></a>Авторизация доступа к BLOB-объектам и очередям с помощью Azure Active Directory

Служба хранилища Azure поддерживает использование Azure Active Directory (Azure AD) для авторизации запросов к хранилищу BLOB-объектов и очередей. С помощью Azure AD можно использовать управление доступом на основе ролей Azure (Azure RBAC) для предоставления разрешений субъекту безопасности, который может быть пользователем, группой или субъектом-службой приложения. Проверка подлинности субъекта безопасности в Azure AD возвращает маркер OAuth 2,0. Затем маркер можно использовать для авторизации запроса к хранилищу BLOB-объектов или очередей.

Авторизация запросов к службе хранилища Azure с помощью Azure AD обеспечивает более высокую безопасность и простоту использования общих ключей. Корпорация Майкрософт рекомендует использовать авторизацию Azure AD с приложениями BLOB-объектов и очереди, если это возможно, чтобы максимально сокращать потенциальные уязвимости, характерные для общего ключа.

Авторизация Azure AD доступна для всех учетных записей общего назначения и хранилища BLOB-объектов во всех общедоступных регионах и национальных облаках. Авторизация Azure AD поддерживается только учетными записями хранения, созданными с помощью модели развертывания Azure Resource Manager.

Кроме того, хранилище BLOB-объектов поддерживает создание подписей общего доступа (SAS), подписанных с помощью учетных данных Azure AD. Дополнительные сведения см. в разделе [предоставление ограниченного доступа к данным с помощью подписанных](storage-sas-overview.md)URL.

Служба файлов Azure поддерживает авторизацию в AD (Предварительная версия) или Azure AD DS (GA) по протоколу SMB только для виртуальных машин, присоединенных к домену. Сведения об использовании Active Directory (Предварительная версия) или Azure AD DS (GA) по протоколу SMB для службы файлов Azure см. в статье [Поддержка проверки подлинности на основе удостоверений в службе файлов Azure для доступа по протоколу SMB](../files/storage-files-active-directory-overview.md).

Авторизация с помощью Azure AD не поддерживается для табличного хранилища Azure. Используйте общий ключ для авторизации запросов к хранилищу таблиц.

## <a name="overview-of-azure-ad-for-blobs-and-queues"></a>Общие сведения об Azure AD для больших двоичных объектов и очередей

Когда участник безопасности (пользователь, группа или приложение) пытается получить доступ к ресурсу большого двоичного объекта или очереди, запрос должен быть разрешен, если только он не является BLOB-объектом, доступным для анонимного доступа. В Azure AD доступ к ресурсу выполняется в два этапа. Во-первых, удостоверение субъекта безопасности проходит проверку подлинности и возвращается маркер OAuth 2,0. Затем маркер передается как часть запроса в большой двоичный объект или служба очередей и используется службой для авторизации доступа к указанному ресурсу.

Этап проверки подлинности требует, чтобы приложение запрашивало маркер доступа OAuth 2,0 во время выполнения. Если приложение выполняется из сущности Azure, такой как виртуальная машина Azure, масштабируемый набор виртуальных машин или приложение функций Azure, оно может использовать [управляемое удостоверение](../../active-directory/managed-identities-azure-resources/overview.md) для доступа к большим двоичным объектам или очередям. Сведения о том, как авторизовать запросы, выполняемые управляемым удостоверением, в BLOB-объект или служба очередей Azure, см. в разделе [авторизация доступа к BLOB-объектам и очередям с Azure Active Directory и управляемыми удостоверениями для ресурсов Azure](storage-auth-aad-msi.md).

Для шага авторизации требуется, чтобы одна или несколько ролей Azure были назначены субъекту безопасности. Служба хранилища Azure предоставляет роли Azure, охватывающие общие наборы разрешений для данных BLOB-объектов и очередей. Роли, назначенные субъекту безопасности, определяют разрешения, которые будут иметь субъекта. Дополнительные сведения о назначении ролей Azure для службы хранилища Azure см. в статье [Управление правами доступа к данным хранилища с помощью Azure RBAC](./storage-auth-aad-rbac-portal.md).

Собственные приложения и веб-приложения, которые делают запросы к большому двоичному объекту Azure или служба очередей могут также авторизовать доступ с помощью Azure AD. Сведения о том, как запросить маркер доступа и использовать его для авторизации запросов на данные BLOB-объектов или очередей, см. в статье [авторизация доступа к службе хранилища Azure с помощью Azure AD из приложения службы хранилища Azure](storage-auth-aad-app.md).

## <a name="assign-azure-roles-for-access-rights"></a>Назначение ролей Azure для прав доступа

Azure Active Directory (Azure AD) разрешает права доступа к защищенным ресурсам через [Управление доступом на основе ролей Azure (Azure RBAC)](../../role-based-access-control/overview.md). Служба хранилища Azure определяет набор встроенных ролей Azure, охватывающих общие наборы разрешений, используемых для доступа к данным BLOB-объектов и очередей. Можно также определить пользовательские роли для доступа к данным большого двоичного объекта и очереди.

Когда роль Azure назначается субъекту безопасности Azure AD, Azure предоставляет доступ к этим ресурсам для этого субъекта безопасности. Доступ может ограничиваться уровнем подписки, группой ресурсов, учетной записью хранения или отдельным контейнером или очередью. Субъект безопасности Azure AD может быть пользователем, группой, субъектом-службой приложения или [управляемым удостоверением для ресурсов Azure](../../active-directory/managed-identities-azure-resources/overview.md).

### <a name="azure-built-in-roles-for-blobs-and-queues"></a>Встроенные роли Azure для больших двоичных объектов и очередей

[!INCLUDE [storage-auth-rbac-roles-include](../../../includes/storage-auth-rbac-roles-include.md)]

Сведения о назначении встроенной роли Azure субъекту безопасности см. в одной из следующих статей:

- [Назначение роли Azure для доступа к большим двоичным объектам и данным очереди с помощью портала Azure](storage-auth-aad-rbac-portal.md)
- [Используйте Azure CLI, чтобы назначить роль Azure для доступа к данным BLOB-объектов и очередей.](storage-auth-aad-rbac-cli.md)
- [Использование модуля Azure PowerShell для назначения роли Azure доступа к данным BLOB-объектов и очередей](storage-auth-aad-rbac-powershell.md)

Дополнительные сведения о том, как встроенные роли определяются для службы хранилища Azure, см. в статье, посвященной [обзору определений ролей](../../role-based-access-control/role-definitions.md#management-and-data-operations). Дополнительные сведения о создании пользовательских ролей Azure см. в статье [пользовательские роли Azure](../../role-based-access-control/custom-roles.md).

### <a name="access-permissions-for-data-operations"></a>Разрешения на доступ к операциям с данными

Дополнительные сведения о разрешениях, необходимых для вызова конкретных операций большого двоичного объекта или служба очередей, см. в разделе [разрешения на вызов операций с данными большого двоичного объекта и очереди](/rest/api/storageservices/authorize-with-azure-active-directory#permissions-for-calling-blob-and-queue-data-operations).

## <a name="resource-scope"></a>Область ресурса

[!INCLUDE [storage-auth-resource-scope-include](../../../includes/storage-auth-resource-scope-include.md)]

## <a name="access-data-with-an-azure-ad-account"></a>Доступ к данным с помощью учетной записи Azure AD

Доступ к данным большого двоичного объекта или очереди через портал Azure, PowerShell или Azure CLI можно авторизовать либо с помощью учетной записи пользователя Azure AD, либо с помощью ключей доступа к учетной записи (авторизация общего ключа).

### <a name="data-access-from-the-azure-portal"></a>Доступ к данным из портал Azure

Портал Azure может использовать учетную запись Azure AD или ключи доступа к учетной записи для доступа к данным BLOB-объектов и очередей в учетной записи хранения Azure. Схема авторизации, используемая портал Azure, зависит от назначенных вам ролей Azure.

При попытке доступа к данным большого двоичного объекта или очереди портал Azure сначала проверяет, назначена ли роль Azure с помощью **Microsoft. Storage/storageAccounts/listkeys/Action**. Если вы назначили роль с этим действием, портал Azure использует ключ учетной записи для доступа к данным большого двоичного объекта и очереди через авторизацию с общим ключом. Если вы не назначили роль с этим действием, портал Azure пытается получить доступ к данным с помощью учетной записи Azure AD.

Чтобы получить доступ к данным BLOB-объектов или очередей из портал Azure с помощью учетной записи Azure AD, необходимы разрешения на доступ к данным BLOB-объектов и очередей, а также необходимы разрешения для перемещения по ресурсам учетной записи хранения в портал Azure. Встроенные роли, предоставляемые службой хранилища Azure, обеспечивают доступ к ресурсам BLOB-объектов и очередей, однако они не предоставляют разрешения для ресурсов учетной записи хранилища. По этой причине для доступа к порталу также требуется назначение роли Azure Resource Manager (например, роли [Читатель](../../role-based-access-control/built-in-roles.md#reader)), ограниченной до уровня учетной записи хранилища или выше. Роль **читателя** предоставляет наиболее ограниченные разрешения, но также приемлема другая роль Azure Resource Manager, которая предоставляет доступ к ресурсам управления учетной записью хранения. Дополнительные сведения о назначении пользователям разрешений на доступ к данным в портал Azure с помощью учетной записи Azure AD см. в статье [использование портал Azure для назначения роли Azure доступа к данным BLOB-объектов и очередей](storage-auth-aad-rbac-portal.md).

Портал Azure указывает, какая схема авторизации используется при переходе к контейнеру или очереди. Дополнительные сведения о доступе к данным на портале см. в разделе [Выбор способа авторизации доступа к данным BLOB-объектов в портал Azure](../blobs/authorize-data-operations-portal.md) и [Выбор способа авторизации доступа к данным очереди в портал Azure](../queues/authorize-data-operations-portal.md).

### <a name="data-access-from-powershell-or-azure-cli"></a>Доступ к данным из PowerShell или Azure CLI

Azure CLI и PowerShell поддерживают вход с использованием учетных данных Azure AD. После входа в систему сеанс выполняется под этими учетными данными. Дополнительные сведения см. в статье [запуск Azure CLI или команд PowerShell с учетными данными Azure AD для доступа к данным BLOB-объектов или очередей](../blobs/authorize-data-operations-powershell.md).

## <a name="next-steps"></a>Дальнейшие действия

- [Авторизация доступа к BLOB-объектам и очередям с Azure Active Directory и управляемыми удостоверениями для ресурсов Azure](storage-auth-aad-msi.md)
- [Авторизация с помощью Azure Active Directory из приложения для доступа к BLOB-объектам и очередям](storage-auth-aad-app.md)
- [Поддержка службы хранилища Azure для управления доступом на основе Azure Active Directory обычно доступна](https://azure.microsoft.com/blog/azure-storage-support-for-azure-ad-based-access-control-now-generally-available/)