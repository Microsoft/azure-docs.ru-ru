---
title: Метрики Аналитики Службы хранилища Azure (классические)
description: Узнайте, как использовать метрики Аналитики Службы хранилища в службе хранилища Azure. Сведения о метриках транзакций и емкости, способах хранения метрик, включении метрик и многом другим.
author: normesta
ms.service: storage
ms.topic: conceptual
ms.date: 01/29/2021
ms.author: normesta
ms.reviewer: fryu
ms.subservice: common
ms.custom: monitoring, devx-track-csharp
ms.openlocfilehash: d900ffa4481ba2b6deb21a8325f3f8def8084f84
ms.sourcegitcommit: c27a20b278f2ac758447418ea4c8c61e27927d6a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/03/2021
ms.locfileid: "101714737"
---
# <a name="azure-storage-analytics-metrics-classic"></a>Метрики Аналитики Службы хранилища Azure (классические)

С **31 августа 2023** аналитика службы хранилища метрики, также называемые *классическими метриками* , будут прекращены. Дополнительные сведения см. в [официальном объявлении](https://azure.microsoft.com/updates/azure-storage-classic-metrics-will-be-retired-on-31-august-2023/). Если вы используете классические метрики, обязательно перейдите на использование метрик в Azure Monitor до этой даты. Эта статья поможет вам выполнить переход. 

Служба хранилища Azure использует Аналитику Службы хранилища для хранения метрик, включающих в себя сводную статистику по транзакциям и данные о емкости запросов к службе хранилища. Транзакции описываются на уровне операций API и на уровне службы хранилища. Емкость сообщается на уровне службы хранилища. Данные метрик можно использовать для:
- анализа использования службы хранилища;
- диагностики проблем с запросами к службе хранилища;
- повышения производительности приложений, использующих службу.

 Метрики аналитики хранилища включены по умолчанию для новых учетных записей хранения. Метрики можно настроить в [портал Azure](https://portal.azure.com/), с помощью PowerShell или с помощью Azure CLI. Пошаговые инструкции см. в статье [Включение и управление аналитическими метриками службы хранилища Azure (классическая модель)](./manage-storage-analytics-logs.md). Аналитику хранилища также можно включить программно через REST API или клиентскую библиотеку. Используйте операции Set Service Properties, чтобы включить Аналитику Службы хранилища для каждой службы.  

> [!NOTE]
> Метрики Аналитики Службы хранилища доступны для хранилища BLOB-объектов Azure, хранилища очередей Azure, хранилища таблиц Azure и Файлов Azure.
> Метрики Аналитики Службы хранилища теперь являются классическими метриками. Рекомендуется использовать [метрики хранилища в Azure Monitor](../blobs/monitor-blob-storage.md) вместо метрик Аналитики Службы хранилища.

## <a name="transaction-metrics"></a>Метрики транзакций  
 Надежный набор данных записывается раз в час или раз в минуту для каждой службы хранилища и запрошенных операций API, включая входящие и исходящие данные, информацию о доступности, ошибки и процент категоризованных запросов. Полный список сведений о транзакциях см. в разделе [Схема таблицы для метрик аналитики хранилища](/rest/api/storageservices/storage-analytics-metrics-table-schema).  

 Данные транзакций записываются на уровне службы и уровне операций API. На уровне службы статистика, суммирующая все запрошенные операции API, записывается в сущность таблицы каждый час, даже если запросов к службе не было. На уровне операции API статистика записывается в сущность, только если в течение этого часа были запрошены операции.  

 Например, если вы выполняете операцию **GetBlob** в службе BLOB-объектов, метрики Аналитики Службы хранилища будут регистрировать запрос и включать его в объединенные данные по службе BLOB-объектов и по операции **GetBlob**. Если за текущий час операций **GetBlob** не будет запрошено, сущность в *$MetricsTransactionsBlob* для этой операции записана не будет.  

 Метрики транзакций записываются как для запросов пользователей, так и для запросов, сделанных самой Аналитикой Службы хранилища. Например, записываются запросы аналитики хранилища для записи сущностей журналов и таблиц.

## <a name="capacity-metrics"></a>Метрики емкости  

> [!NOTE]
>  В настоящее время метрики емкости доступны только для службы BLOB-объектов.

 Данные о емкости записываются ежедневно для службы BLOB-объектов учетной записи хранения, при этом записываются две сущности таблицы. Одна сущность содержит статистику пользовательских данных, а другая — статистику для контейнера больших двоичных объектов `$logs` , используемого аналитикой хранилища. Таблица *$MetricsCapacityBlob* включает в себя следующую статистику.  

- **Capacity**. Объем хранилища, используемый службой BLOB-объектов учетной записи хранения, в байтах.  
- **ContainerCount**. Количество контейнеров BLOB-объектов в службе BLOB-объектов учетной записи хранения.  
- **ObjectCount**. Количество зафиксированных и незафиксированных блочных или страничных BLOB-объектов в службе BLOB-объектов учетной записи хранения.  

  Дополнительную информацию о метриках емкости см. в разделе [Схема таблицы для метрик аналитики хранилища](/rest/api/storageservices/storage-analytics-metrics-table-schema).  

## <a name="how-metrics-are-stored"></a>Как хранятся метрики  

 Все данные метрик для каждой из служб хранения хранятся в таблицах, зарезервированных для этой службы: одна таблица для данных о транзакциях, вторая для данных о минутных транзакциях и третья - для данных о производительности. Информация о транзакциях и минутных транзакциях включает в себя данные запросов и ответов. Информация о емкости содержит данные об использовании хранилища. Часовые метрики, минутные метрики и емкость для службы BLOB-объектов учетной записи хранения можно получить в таблицах, имена которых приведены в следующей таблице.  

|Уровень метрик|Имена таблиц|Поддержка в версиях|  
|-------------------|-----------------|----------------------------|  
|Часовые метрики, основное расположение|-   $MetricsTransactionsBlob<br />-   $MetricsTransactionsTable<br />-   $MetricsTransactionsQueue|Только версии, выпущенные до 15 августа 2013 года. Таблицы с этими именами по-прежнему поддерживаются, но рекомендуется перейти на использование таблиц, приведенных ниже.|  
|Часовые метрики, основное расположение|-   $MetricsHourPrimaryTransactionsBlob<br />-   $MetricsHourPrimaryTransactionsTable<br />-   $MetricsHourPrimaryTransactionsQueue<br />-   $MetricsHourPrimaryTransactionsFile|все версии Поддержка метрик файловых служб доступна только в версии от 5 апреля 2015 года и более поздних версиях.|  
|Минутные метрики, основное расположение|-   $MetricsMinutePrimaryTransactionsBlob<br />-   $MetricsMinutePrimaryTransactionsTable<br />-   $MetricsMinutePrimaryTransactionsQueue<br />-   $MetricsMinutePrimaryTransactionsFile|все версии Поддержка метрик файловых служб доступна только в версии от 5 апреля 2015 года и более поздних версиях.|  
|Часовые метрики, вторичное расположение|-   $MetricsHourSecondaryTransactionsBlob<br />-   $MetricsHourSecondaryTransactionsTable<br />-   $MetricsHourSecondaryTransactionsQueue|все версии Должна быть включена геоизбыточная репликация с доступом для чтения.|  
|Минутные метрики, вторичное расположение|-   $MetricsMinuteSecondaryTransactionsBlob<br />-   $MetricsMinuteSecondaryTransactionsTable<br />-   $MetricsMinuteSecondaryTransactionsQueue|все версии Должна быть включена геоизбыточная репликация с доступом для чтения.|  
|Емкость (только для службы BLOB-объектов)|$MetricsCapacityBlob|все версии|  

 Эти таблицы автоматически создаются при включении Аналитики Службы хранилища для конечной точки службы хранилища. Доступ к ним осуществляется через пространство имен учетной записи хранения, например: `https://<accountname>.table.core.windows.net/Tables("$MetricsTransactionsBlob")`. Таблицы метрик не отображаются операцией вывода списка, обращаться к ним необходимо непосредственно по имени таблицы.

## <a name="metrics-alerts"></a>Оповещения метрик
Рассмотрите возможность настройки оповещений на [портале Azure](https://portal.azure.com), чтобы автоматически получать уведомления о всех важных изменениях в поведении служб хранилища. Пошаговые инструкции см. в разделе [Создание оповещений о метриках](./manage-storage-analytics-logs.md).

Если скачивание этих метрик в формате с разделителями происходит с помощью инструмента обозревателя хранилища, то для анализа данных можно использовать Microsoft Excel. Список доступных инструментов Обозревателя службы хранилища см. в разделе [Клиентские инструменты службы хранилища Azure](./storage-explorers.md).

> [!IMPORTANT]
> Возможна задержка между событием службы хранилища и записью данных соответствующей часовой или минутной метрики. В случае минутных метрик данные за несколько минут могут записываться одновременно. Эта проблема может привести к объединению транзакций за предшествующие минуты с транзакциями за текущую минуту. В этом случае у службы оповещений могут быть данные не всех доступных метрик за заданный интервал оповещения, что может привести к неожиданному срабатыванию оповещений.
>

## <a name="billing-on-storage-metrics"></a>Выставление счетов за метрики хранилища
За запросы записи на создание сущностей таблиц для метрик взимается плата в соответствии со стандартными тарифами, применимыми ко всем операциям службы хранилища Azure.  

К запросам на чтение и удаление данных метрик, отправляемым клиентом, также применяются стандартные тарифы. Если вы настроили политику хранения данных, то за удаление старых данных метрик службой хранилища Azure плата не взимается. Однако при удалении данных аналитики с учетной записи будет взиматься плата за операции удаления.  

Также оплачивается емкость, используемая таблицами метрик. Используйте приведенные ниже сведения, чтобы оценить емкость для хранения данных метрик.  

-   Если каждый час служба использует каждый API в каждой службе, то ежечасно в таблицах транзакций метрик сохраняется примерно 148 КБ данных, если включена сводка уровня службы и уровня API.  
-   Если каждый час служба использует каждый API в каждой службе, то ежечасно в таблицах транзакций метрик сохраняется примерно 12 КБ данных, если включена только сводка уровня службы.  
-   В таблицу емкости для больших двоичных объектов каждый день добавляются две строки, если вы предварительно дали согласие на это для журналов. В этом сценарии подразумевается, что каждый день размер данной таблицы увеличивается примерно на 300 байт.

## <a name="next-steps"></a>Дальнейшие действия
* [Мониторинг учетной записи хранения](https://www.windowsazure.com/manage/services/storage/how-to-monitor-a-storage-account/)   
* [Схема таблицы метрик аналитики хранилища](/rest/api/storageservices/storage-analytics-metrics-table-schema)   
* [Операции с протоколированием и сообщения о состоянии аналитик хранилища](/rest/api/storageservices/storage-analytics-logged-operations-and-status-messages)   
* [Ведение журнала Аналитики Службы хранилища](storage-analytics-logging.md)
