---
title: Сведения о выставлении счетов в службе файлов Azure | Документация Майкрософт
description: Узнайте, как интерпретировать подготовленные и оплачиваемые по мере использования модели выставления счетов для файловых ресурсов Azure.
author: roygara
ms.service: storage
ms.topic: how-to
ms.date: 12/1/2020
ms.author: rogarana
ms.subservice: files
ms.openlocfilehash: 880ec90ce1cf0efffce0cfd6800bdbaed23f8dd0
ms.sourcegitcommit: beacda0b2b4b3a415b16ac2f58ddfb03dd1a04cf
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/31/2020
ms.locfileid: "97831471"
---
# <a name="understanding-azure-files-billing"></a>Общие сведения о выставлении счетов в службе файлов Azure
Служба файлов Azure предоставляет две различные модели выставления счетов: подготовленные и оплата по мере использования. Подготовленная модель доступна только для файловых ресурсов уровня "Премиум", которые представляют собой файловые ресурсы, развернутые в учетной записи хранения **филестораже** . Модель с оплатой по мере использования доступна только для стандартных файловых ресурсов, которые представляют собой файловые ресурсы, развернутые в учетной записи хранения **общего назначения версии 2 (GPv2)** . В этой статье объясняется, как работают обе модели, чтобы вы могли лучше понять ежемесячный счет за службы файлов Azure.

Текущие цены на службу файлов Azure можно найти на [странице цен на службу файлов Azure](https://azure.microsoft.com/pricing/details/storage/files/).

## <a name="provisioned-billing"></a>Подготовленная оплата
Служба файлов Azure использует подготовленную модель для файловых ресурсов уровня "Премиум". В подготовленной бизнес-модели вы заранее указываете службе файлов Azure, каковы требования к хранилищу, а не выставляются счета в зависимости от того, что вы используете. Это аналогично приобретению оборудования в локальной среде. в этом случае при подготовке файлового ресурса Azure с определенным объемом хранилища вы платите за это хранилище независимо от того, используете его или нет, точно так же, как если бы вы не платите за использование места на физическом носителе. В отличие от приобретения физических носителей в локальной среде, подготовленные общие файловые ресурсы можно динамически масштабировать в зависимости от характеристик производительности хранилища и ввода-вывода.

При подготовке файлового ресурса уровня "Премиум" вы указываете, сколько ГБ требуется рабочей нагрузки. Каждый гиб, который вы подготавливаете, предоставляет дополнительные операции ввода-вывода и пропускную способность для фиксированного соотношения. В дополнение к базовым операциям ввода-вывода, для которых гарантируется гарантия, каждый файловый ресурс уровня "Премиум" поддерживает более высокую производительность. Ниже приведены формулы для операций ввода-вывода и пропускной способности.

- Базовые операции ввода-вывода — 400 + 1 * подготовленные гиб. (Максимум 100 000 операций ввода-вывода в секунду).
- Предел числа пакетов = MAX (4000, 3 * базовые операции ввода-вывода).
- Скорость исходящего трафика = 60 MiB/s + 0,06 * подготовлена гиб.
- Скорость входящих данных = 40 MiB/s + 0,04 * подготовлена гиб.

Подготовленный размер файлового ресурса можно увеличить в любое время, но его можно уменьшить только через 24 часа с момента последнего увеличения. По истечении 24 часов без увеличения квоты общий ресурс можно уменьшить столько раз, сколько вы хотите, пока вы не увеличите его снова. Изменения масштаба операций ввода-вывода и пропускной способности вступят в силу в течение нескольких минут после изменения подготовленного размера.

Можно уменьшить размер подготовленного общего ресурса под используемой гиб. В этом случае данные не будут потеряны, но по-прежнему будет взиматься плата за используемый размер, а также производительность (базовые операции ввода-вывода, пропускная способность и число операций в секунду) подготовленной общей папки, а не используемый размер.

В следующей таблице приведено несколько примеров этих формул для подготовленных размеров общих ресурсов.

|Емкость (гиб) | Базовые показатели операций ввода-вывода в секунду | Ускоренные операции ввода-вывода | Исходящий трафик (MiB/s) | Входящий трафик (MiB/с) |
|---------|---------|---------|---------|---------|
|100         | 500     | До 4000     | 66   | 44   |
|500         | 900     | До 4000  | 90   | 60   |
|1024       | 1 424   | До 4000   | 122   | 81   |
|5,120       | 5 520   | До 15 360  | 368   | 245   |
|10 240      | 10 640  | До 30 720  | 675   | 450   |
|33 792      | 34 192  | До 100 000 | 2 088 | 1 392   |
|51 200      | 51 600  | До 100 000 | 3132 | 2 088   |
|102 400     | 100 000 | До 100 000 | 6 204 | 4 136   |

Эффективная производительность файловых ресурсов зависит от ограничений сети компьютера, доступной пропускной способности сети, размера операций ввода-вывода, параллелизма и многих других факторов. Например, основываясь на внутреннем тестировании с 8 КИБ операций чтения и записи, одна виртуальная машина Windows без многоканального канала SMB, *стандартная F16s_v2*, подключенная к файловому ресурсу уровня "Премиум" через SMB, может достичь 20 000 операций ввода-вывода в секунду и 15 000 операций записи в секунду. Если размер ввода-вывода для чтения и записи 512 MiB, то одна и та же виртуальная машина может 1,1 достичь исходящего трафика гиб/s и 370 MiB/s с пропускной способностью. Один и тот же клиент может достичь \~ 3 раза производительности, если многоканальный протокол SMB включен в общих ресурсах Premium. Чтобы обеспечить максимальную производительность, [включите многоканальный протокол SMB](storage-files-enable-smb-multichannel.md) и Распределите нагрузку между несколькими виртуальными машинами. Некоторые распространенные проблемы с производительностью и способы их устранения см. в [руководстве по устранению неполадок](storage-troubleshooting-files-performance.md) и [производительности в многоканальном SMB](storage-files-smb-multichannel-performance.md) .

### <a name="bursting"></a>Bursting
Если вашей рабочей нагрузке требуется повышенная производительность для удовлетворения пикового спроса, ваша общая папка может использовать пакетные кредиты для того, чтобы вычислить общую сумму операций ввода-вывода в базовый план, чтобы предоставить общий доступ к общей производительности. Общие файловые ресурсы уровня "Премиум" могут выполнять операции ввода-вывода до 4 000 или до трех факторов, в зависимости от того, какое значение больше. Пакетная работа автоматизирована и работает на основе кредитной системы. Пакетная работа работает с наибольшими усилиями, а ограничение количества пакетов не является гарантией, что файловые ресурсы могут *занимать ограничение в* течение 60 минут.

Кредиты накапливаются в сегменте нагрузки, когда трафик для общей папки находится ниже базовых показателей операций ввода-вывода. Например, в общей папке 100 гиб есть 500 базовых операций ввода-вывода. Если фактический трафик в общей папке был 100 операций ввода-вывода в секунду в течение определенного интервала, то неиспользуемые операции ввода-вывода 400 кредитуются в сегмент нагрузки. Аналогично, Тиб общий ресурс в режиме простоя, начисляется в 1 424 операций ввода-вывода в секунду. Эти кредиты будут использоваться позже, когда операции будут превысить базовые числа операций ввода-вывода.

Каждый раз, когда общий ресурс превышает базовую частоту операций ввода-вывода и имеет кредиты в сегменте нагрузки, он будет разбиваться на максимально допустимую пиковую нагрузку. Общие ресурсы могут продолжать занимать до тех пор, пока остаток остатка не превышает 60 минут, а в зависимости от количества начисленных кредитов. Каждый ввод-вывод, превышающий базовые операции ввода-вывода, потребляет один кредит, а после того, как все кредиты потребляются, Общая папка вернется к базовому количеству операций

Общие кредиты имеют три состояния:

- Начисление, если общая папка использует меньше базовых операций ввода-вывода.
- Отклонить, если общая папка использует больше базовых операций ввода-вывода в секунду и в режиме ускорения.
- Константа. Если общий файловый ресурс использует только базовые операции ввода-вывода, то не начисляется или не используется ни один кредит.

Новые общие файловые ресурсы начинаются с полного количества кредитов в его сегменте нагрузки. Разбивка на пакеты не будет начисляться, если в течение операций ввода-вывода в секунду с помощью сервера выполняется регулирование общей нагрузки.

## <a name="pay-as-you-go-billing"></a>Выставление счетов с оплатой по мере использования
Служба "файлы Azure" использует бизнес-модель с оплатой по мере использования для стандартных файловых ресурсов. В бизнес-модели с оплатой по мере использования сумма, которую вы оплачиваете, определяется тем, сколько вы фактически используете, а не на основе подготовленной суммы. На высоком уровне вы оплачиваете затраты на объем данных, хранящихся на диске, а затем дополнительный набор транзакций, основанный на использовании этих данных. Модель с оплатой по мере использования может быть экономичной, так как вам не нужно чрезмерно подготавливать учетные данные для будущих требований к росту или производительности или отменять подготовку, если Рабочая нагрузка зависит от времени. С другой стороны, модель с оплатой по мере использования также может быть трудно спланировать как часть процесса бюджетирования, так как модель выставления счетов с оплатой по мере использования управляется потреблением конечных пользователей.

### <a name="differences-in-standard-tiers"></a>Различия в стандартных уровнях
При создании стандартного файлового ресурса можно выбрать один из уровней: оптимизированные, горячий и холодное транзакции. Все три уровня хранятся на одном и том же оборудовании стандартного хранилища. Основное различие между этими тремя уровнями заключается в ценах на хранение неактивных данных (чем холоднее уровень, тем ниже цена) и ценах на транзакции (чем холоднее уровень, тем выше цена). Это означает следующее:

- Цена на общие папки, оптимизированные для транзакций, как можно понять из названия, оптимизирована для рабочих нагрузок с большим числом транзакций. Цена на хранение неактивных данных в таких папках выше всего, а цена на транзакции — ниже всего.
- Горячие общие папки предназначены для активных рабочих нагрузок, которые не предполагают большое число транзакций. По сравнению с предыдущим уровнем цена на хранение неактивных данных немного ниже, а цена на транзакции — немного выше. Рассматривайте его как среднюю заземление между оптимизированными и многоуровневыми уровнями транзакций.
- Здорово оптимизирует стоимость рабочих нагрузок, которые не имеют большой активности, предлагая самую низкую стоимость хранения данных, но самые высокие цены на транзакции.

Если вы помещаете нечасто запрашиваемую рабочую нагрузку на уровень, оптимизированный для обработки транзакций, вы будете платить почти не несколько раз в месяц, в течение которого вы проставите транзакции с вашей общей папкой, но вы будете платить большую сумму за затраты на хранение данных. Если вы намерены переместить эту же общую папку на замечательный уровень, вы все равно будете платить почти все затраты, просто потому, что вы очень редко выполняете транзакции для этой рабочей нагрузки, но у этого уровня есть намного более дешевая цена за хранение данных. Выбор соответствующего уровня для варианта использования позволяет значительно снизить затраты. Выбор соответствующего уровня для варианта использования позволяет значительно снизить затраты.

Аналогично, если вы помещаете высокодоступную рабочую нагрузку на замечательный уровень, вы будете платить гораздо больше по затратам на транзакции, но это будет меньше для затрат на хранение данных. Это может привести к ситуации, когда увеличение затрат по ценам на транзакции повышает сумму экономии от снижения стоимости хранения данных, что дает вам больше денег на выгоду, чем при оптимизации транзакций. Можно использовать некоторые уровни использования, в то время как горячий уровень будет наиболее экономичным, а уровень холодного уровня будет более затратным, чем оптимизированный для транзакции.

Самый экономичный уровень для вашей стандартной общей папки зависит от особенностей вашей рабочей нагрузки и уровня активности. На практике лучшим способом выбора наиболее экономичного уровня является рассмотрение фактического потребления ресурсов общей папки (хранимых данных, транзакций записи и т. д.).

### <a name="what-are-transactions"></a>Что такое транзакции?
Транзакции — это операции или запросы к файлам Azure для отправки, скачивания или иным образом манипулировать содержимым файлового ресурса. Каждое действие, выполняемое в общей папке, преобразуется в одну или несколько транзакций, а также на стандартные общие ресурсы, использующие модель выставления счетов с оплатой по мере использования, которая преобразуется в затраты на транзакции.

Существует пять основных категорий транзакций: запись, перечисление, чтение, другие и удаление. Все операции, выполняемые через REST API или SMB, делятся на одну из следующих 4 категорий следующим образом:

| Operation type (Тип операции) | Запись транзакций | Список транзакций | Чтение транзакций | Другие транзакции | Удалить транзакции |
|-|-|-|-|-|-|
| Операции управления | <ul><li>`CreateShare`</li><li>`SetFileServiceProperties`</li><li>`SetShareMetadata`</li><li>`SetShareProperties`</li></ul> | <ul><li>`ListShares`</li></ul> | <ul><li>`GetFileServiceProperties`</li><li>`GetShareAcl`</li><li>`GetShareMetadata`</li><li>`GetShareProperties`</li><li>`GetShareStats`</li></ul> | | <ul><li>`DeleteShare`</li></ul> |
| Операции с данными | <ul><li>`CopyFile`</li><li>`Create`</li><li>`CreateDirectory`</li><li>`CreateFile`</li><li>`PutRange`</li><li>`PutRangeFromURL`</li><li>`SetDirectoryMetadata`</li><li>`SetFileMetadata`</li><li>`SetFileProperties`</li><li>`SetInfo`</li><li>`SetShareACL`</li><li>`Write`</li><li>`PutFilePermission`</li></ul> | <ul><li>`ListFileRanges`</li><li>`ListFiles`</li><li>`ListHandles`</li></ul>  | <ul><li>`FilePreflightRequest`</li><li>`GetDirectoryMetadata`</li><li>`GetDirectoryProperties`</li><li>`GetFile`</li><li>`GetFileCopyInformation`</li><li>`GetFileMetadata`</li><li>`GetFileProperties`</li><li>`QueryDirectory`</li><li>`QueryInfo`</li><li>`Read`</li><li>`GetFilePermission`</li></ul> | <ul><li>`AbortCopyFile`</li><li>`Cancel`</li><li>`ChangeNotify`</li><li>`Close`</li><li>`Echo`</li><li>`Ioctl`</li><li>`Lock`</li><li>`Logoff`</li><li>`Negotiate`</li><li>`OplockBreak`</li><li>`SessionSetup`</li><li>`TreeConnect`</li><li>`TreeDisconnect`</li><li>`CloseHandles`</li><li>`AcquireFileLease`</li><li>`BreakFileLease`</li><li>`ChangeFileLease`</li><li>`ReleaseFileLease`</li></ul> | <ul><li>`ClearRange`</li><li>`DeleteDirectory`</li></li>`DeleteFile`</li></ul> |

> [!Note]  
> NFS 4,1 доступна только для файловых ресурсов уровня "Премиум", которые используют подготовленную модель выставления счетов. транзакции не влияют на выставление счетов для общих файловых ресурсов уровня "Премиум".

## <a name="see-also"></a>См. также раздел
- [Страница цен на службы файлов Azure](https://azure.microsoft.com/pricing/details/storage/files/).
- [Планирование развертывания файлов Azure](./storage-files-planning.md) и [Планирование развертывания Синхронизация файлов Azure](./storage-sync-files-planning.md).
- [Создайте общую папку](./storage-how-to-create-file-share.md) и [разверните синхронизация файлов Azure](./storage-sync-files-deployment-guide.md).