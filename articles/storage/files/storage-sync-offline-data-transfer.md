---
title: Перенос данных в Синхронизация файлов Azure с помощью Azure Data Box
description: Перенос данных в автономный режим, совместимый с Синхронизация файлов Azure. Избегайте конфликтов файлов и сохраняйте списки ACL файлов и папок и метки времени после включения синхронизации.
author: roygara
ms.service: storage
ms.topic: how-to
ms.date: 02/12/2019
ms.author: rogarana
ms.subservice: files
ms.openlocfilehash: 94abb33d39765a19306a013576d43fb2602d1c37
ms.sourcegitcommit: 910a1a38711966cb171050db245fc3b22abc8c5f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "96017633"
---
# <a name="migrate-bulk-data-to-azure-file-sync-with-azure-databox"></a>Перенос пакетов данных в Синхронизацию файлов Azure с использованием Azure DataBox
Можно выполнить миграцию данных большого объема в Синхронизация файлов Azure двумя способами:

* **Отправьте файлы с помощью синхронизация файлов Azure.** Это самый простой метод. Переместите файлы локально в Windows Server 2012 R2 или более поздней версии и установите агент Синхронизация файлов Azure. После настройки синхронизации файлы будут отправлены с сервера. (В настоящее время наши клиенты испытывают среднюю скорость передачи, равное 1 Тиб примерно каждые два дня.) Чтобы сервер не использовал слишком большую часть пропускной способности для вашего центра обработки данных, может потребоваться настроить [Расписание регулирования полосы пропускания](storage-sync-files-server-registration.md#ensuring-azure-file-sync-is-a-good-neighbor-in-your-datacenter).
* **Перенесите файлы в автономный режим.** Если у вас недостаточно пропускной способности, вы не сможете отправлять файлы в Azure в разумное время. Задача — начальная синхронизация всего набора файлов. Чтобы преодолеть эту проблему, используйте средства автономной миграции, такие как [семейство Azure Data Box](https://azure.microsoft.com/services/storage/databox). 

В этой статье объясняется, как выполнить миграцию файлов в автономном режиме способом, совместимым с Синхронизация файлов Azure. Следуйте этим инструкциям, чтобы избежать конфликтов файлов и сохранить списки управления доступом к файлам и папкам (ACL) и метки времени после включения синхронизации.

## <a name="migration-tools"></a>Средства миграцииСредства миграции
Процесс, описанный в этой статье, работает не только для Data Box но и для других средств автономной миграции. Она также работает с такими инструментами, как AzCopy, Robocopy или партнерские средства и службы, работающие прямо через Интернет. Тем не менее, чтобы решить проблему начальной отправки, выполните действия, описанные в этой статье, чтобы использовать эти средства так, как они совместимы с Синхронизация файлов Azure.

В некоторых случаях перед внедрением Синхронизация файлов Azure необходимо перейти с одного сервера Windows на другой сервер Windows. [Служба миграции хранилища](/windows-server/storage/storage-migration-service/overview) (SMS) может помочь в этом. Требуется ли переход на версию серверной ОС, поддерживаемую Синхронизация файлов Azure (Windows Server 2012 R2 и выше), или просто необходимо выполнить миграцию, так как вы покупаете новую систему для Синхронизация файлов Azure, у SMS есть множество функций и преимуществ, которые помогут обеспечить бесперебойную миграцию.

## <a name="benefits-of-using-a-tool-to-transfer-data-offline"></a>Преимущества использования средства для перевода данных в автономный режим
Ниже приведены основные преимущества использования средства переноса, например Data Box для автономной миграции.

- Вам не нужно загружать все файлы по сети. Для больших пространств имен это средство может сэкономить значительную пропускную способность сети и время.
- При использовании Синхронизация файлов Azure независимо от того, какой инструмент передачи вы используете (Data Box, служба импорта и экспорта Azure и т. д.), Ваш динамический сервер передает только те файлы, которые изменяются после перемещения данных в Azure.
- Синхронизация файлов Azure синхронизирует списки управления доступом к файлам и папкам, даже если средство автономной миграции не выполняет передачу списков ACL.
- Data Box и Синхронизация файлов Azure не нуждаются в простоях. При использовании Data Box для передачи данных в Azure вы эффективно используете пропускную способность сети и сохраняете точность файла. Вы также сохраняете пространство имен в актуальном состоянии, отгружая только файлы, которые изменяются после перемещения данных в Azure.

## <a name="prerequisites-for-the-offline-data-transfer"></a>Предварительные требования для автономной пересылки данных
Не следует включать синхронизацию на сервере, который необходимо перенести, перед завершением автономной переноса данных. Перед началом необходимо учесть следующие моменты:

- Если вы планируете использовать Data Box для выполнения групповой миграции, ознакомьтесь с [предварительными требованиями к развертыванию для Data Box](../../databox/data-box-deploy-ordered.md#prerequisites).
- Планирование окончательной топологии Синхронизация файлов Azure. [Планирование развертывания Синхронизация файлов Azure](storage-sync-files-planning.md)
- Выберите учетные записи хранения Azure, в которых будут храниться общие папки, с которыми нужно выполнить синхронизацию. Убедитесь, что массовое перемещение выполняется во временные общие папки промежуточного хранения в одной и той же учетной записи хранения. Массовое перемещение может быть включено только с использованием конечной общей папки и общей папки промежуточного хранения, которые находятся в одной учетной записи хранения.
- Массовое перемещение возможно только при создании новых связей синхронизации с расположением на сервере. Нельзя включить массовое перемещение с существующими связями синхронизации.


## <a name="process-for-offline-data-transfer"></a>Процесс для автономной пересылки данных
Вот как можно настроить Синхронизация файлов Azure способом, совместимым с инструментами для выполнения групповой миграции, такими как Azure Data Box:

![Диаграмма, показывающая, как настроить Синхронизация файлов Azure](media/storage-sync-files-offline-data-transfer/data-box-integration-1-600.png)

| Шаг | Подробный сведения |
|---|---------------------------------------------------------------------------------------|
| ![Шаг 1](media/storage-sync-files-offline-data-transfer/bullet_1.png) | [Заказ Data Box](../../databox/data-box-deploy-ordered.md). Семейство Data Box предлагает [несколько продуктов](https://azure.microsoft.com/services/storage/databox/data) в соответствии с вашими потребностями. Когда вы получаете Data Box, следуйте указаниям [по копированию данных](../../databox/data-box-deploy-copy-data.md#copy-data-to-data-box) по этому пути в формате UNC на Data Box: *\\<девицеипаддрес \> \<StorageAccountName_AzFile\> \<ShareName\>*. *ShareName* — это имя промежуточного ресурса. Отправьте Data Box обратно в Azure. |
| ![Шаг 2](media/storage-sync-files-offline-data-transfer/bullet_2.png) | Дождитесь отображения файлов в общих файловых ресурсах Azure, выбранных в качестве временных промежуточных общих ресурсов. *Не включайте синхронизацию с этими общими папками.* |
| ![Шаг 3](media/storage-sync-files-offline-data-transfer/bullet_3.png) | <ul><li>Создайте новую пустую общую папку для каждой общей папки, которую Data Box создать. Этот новый общий ресурс должен находиться в той же учетной записи хранения, что и Data Box общий ресурс. [Создание общей папки в службе файлов Azure](storage-how-to-create-file-share.md).</li><li>[Создайте группу синхронизации](storage-sync-files-deployment-guide.md#create-a-sync-group-and-a-cloud-endpoint) в службе синхронизации хранилища. Ссылка на пустой общий ресурс в качестве облачной конечной точки. Повторите этот шаг для каждой общей папки Data Box. [Настройка синхронизация файлов Azure](storage-sync-files-deployment-guide.md).</li></ul> |
| ![Шаг 4](media/storage-sync-files-offline-data-transfer/bullet_4.png) | [Добавьте каталог своего активного сервера в качестве конечной точки сервера](storage-sync-files-deployment-guide.md#create-a-server-endpoint). В этом процессе укажите, что вы переместили файлы в Azure и ссылаетесь на промежуточные общие папки. При необходимости можно включить или отключить распределение по уровням облака. При создании конечной точки сервера на активном сервере используйте ссылку на промежуточный ресурс. В колонке **Добавление конечной точки сервера** в разделе **автономный передача данных** выберите **включено**, а затем выберите промежуточный ресурс, который должен находиться в той же учетной записи хранения, что и облачная конечная точка. Здесь список доступных общих папок фильтруется по учетной записи хранения и общим папкам, которые еще не синхронизированы. На снимке экрана ниже приведена таблица, в которой показано, как ссылаться на общую папку Датабокс во время создания конечной точки сервера в портал Azure. |
| ![Шаг 5](media/storage-sync-files-offline-data-transfer/bullet_5.png) | После добавления конечной точки сервера на предыдущем шаге данные запускаются автоматически из правильного источника. В разделе [Синхронизация общего ресурса](#syncing-the-share) объясняется, когда данные поступают из общего ресурса датабокс или с сервера Windows Server. |
| |

![Снимок экрана портал Azure пользовательского интерфейса, в котором показано, как включить автономную пересылку данных при создании новой конечной точки сервера](media/storage-sync-files-offline-data-transfer/data-box-integration-2-600.png)

## <a name="syncing-the-share"></a>Синхронизация общих папок
После создания конечной точки сервера Синхронизация начнется. Процесс синхронизации определяет, существует ли также каждый файл на сервере в промежуточной папке, где Data Box их хранения. Если файл там существует, процесс синхронизации копирует файл из промежуточного ресурса, а не отправляет его с сервера. Если файл не существует в промежуточной папке или если на локальном сервере доступна более новая версия, процесс синхронизации отправляет файл с локального сервера.

При синхронизации общего ресурса синхронизация будет объединять все отсутствующие атрибуты файлов, разрешения или метки времени из вариантов файлов на локальном сервере, объединяя их с аналогами файлов из общей папки Датабокс. Это гарантирует, что каждый файл и папка поступают в общую папку Azure с учетом допустимого качества файла.

> [!IMPORTANT]
> Режим групповой миграции можно включить только при создании конечной точки сервера. После установки конечной точки сервера вы не сможете интегрировать данные с массовым переносом из уже синхронизированного сервера в пространство имен.

## <a name="acls-and-timestamps-on-files-and-folders"></a>Списки управления доступом и метки времени для файлов и папок
Синхронизация файлов Azure гарантирует, что списки ACL для файлов и папок синхронизируются с действующего сервера, даже если ранее использовалось средство для выполнения неполного переноса списков ACL. По этой причине промежуточный общий ресурс не должен содержать списки управления доступом для файлов и папок. При включении функции автономной миграции данных при создании новой конечной точки сервера все таблицы управления доступом к файлам синхронизируются на сервере. Вновь созданные и измененные метки времени также синхронизируются.

## <a name="shape-of-the-namespace"></a>Схема пространства имен
При включении синхронизации содержимое сервера определяет форму пространства имен. Если файлы удаляются с локального сервера после завершения Data Boxного моментального снимка и миграции, эти файлы не перемещаются в активное синхронизированное пространство имен. Они остаются в промежуточной папке, но не копируются. Это необходимо, так как синхронизация сохраняет пространство имен в соответствии с активным сервером. *Моментальный снимок* Data Box является просто промежуточным назначением для эффективного копирования файлов. Он не является центром для формы пространства имен Live.

## <a name="cleaning-up-after-bulk-migration"></a>Очистка после выполнения групповой миграции 
По мере того как сервер завершает первоначальную синхронизацию пространства имен, Data Box файлы с неполным переносом используют промежуточный файловый ресурс. В колонке **свойства конечной точки сервера** в портал Azure в разделе **автономный передача данных** состояние **меняется на** **завершено**. 

![Снимок экрана: колонка свойств конечной точки сервера, в которой находятся элементы управления состоянием и отключения для автономной пересылки данных](media/storage-sync-files-offline-data-transfer/data-box-integration-3-444.png)

Теперь можно очистить промежуточный общий ресурс, чтобы сэкономить на затратах:

1. В колонке **свойства конечной точки сервера** по **завершении** состояния выберите **Отключить автономную пересылку данных**.
2. Рекомендуется удалить промежуточный общий ресурс, чтобы снизить затраты. Промежуточный общий ресурс, вероятно, не содержит списки ACL для файлов и папок, поэтому он вряд ли будет полезен. Для целей резервного копирования создайте реальный [моментальный снимок синхронизированного файлового ресурса Azure](storage-snapshots-files.md). Azure Backup можно [настроить на создание моментальных снимков]( ../../backup/backup-afs.md) по расписанию.

Отключите режим автономной пересылки данных, только если состояние **завершено** или если требуется отменить из-за недействительной настройки. Если отключить режим во время развертывания, файлы будут загружаться с сервера, даже если промежуточный общий ресурс по-прежнему доступен.

> [!IMPORTANT]
> После отключения режима автономной пересылки данных вы не сможете включить его снова, даже если промежуточный общий ресурс по-прежнему доступен.

## <a name="azure-file-sync-and-pre-seeded-files-in-the-cloud"></a>Синхронизация файлов Azure и предварительно заполненные файлы в облаке

Если у вас есть заполненные файлы в общей папке Azure другими способами, чем Датабокс, например с помощью AzCopy, Robocopy из облачной резервной копии или любого другого метода, то все равно следует выполнить [автономный передача данных процесс](#process-for-offline-data-transfer) , описанный в этой статье. В качестве метода перемещения файлов в облако необходимо проигнорировать Датабокс. Тем не менее, важно убедиться, что вы по-прежнему Следите за процессом заполнения файлов в *промежуточный файловый ресурс* , а не в окончательной, синхронизация файлов Azure подключенной общей папке.

> [!WARNING]
> **Выполните процесс заполнения файлов в промежуточном общем ресурсе, а не в окончательной** синхронизация файлов Azure подключенной общей папке. В противном случае могут возникать конфликты файлов (обе версии файлов будут сохранены), а также файлы, удаленные на активном сервере, если они по-прежнему существуют в старом, заполненном наборе файлов. Кроме того, изменения в папках будут объединены друг с другом, что затрудняет разделение пространства имен после такой ошибки.

## <a name="next-steps"></a>Дальнейшие действия
- [Планирование развертывания службы синхронизации файлов Azure](storage-sync-files-planning.md)
- [Развертывание Синхронизации файлов Azure](storage-sync-files-deployment-guide.md)