---
title: Общие сведения о Синхронизация файлов Azure уровне облака | Документация Майкрософт
description: Общие сведения о распределении по уровням облака — необязательная Синхронизация файлов Azureная функция. Часто запрашиваемые файлы кэшируются локально на сервере; другие уровни распределены по файлам Azure.
author: roygara
ms.service: storage
ms.topic: conceptual
ms.date: 1/4/2021
ms.author: rogarana
ms.subservice: files
ms.openlocfilehash: 9ca8df21e0221d364f75eaeb26f0b2961d7e0b08
ms.sourcegitcommit: dda0d51d3d0e34d07faf231033d744ca4f2bbf4a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/05/2021
ms.locfileid: "102204471"
---
# <a name="cloud-tiering-overview"></a>Обзор уровней облака
Распределение по уровням облака, дополнительная функция Синхронизация файлов Azure, сокращает объем локального хранилища, необходимого для хранения данных на локальном файловом сервере.

Если этот компонент включен, он хранит на локальном сервере только часто используемые (горячие) файлы. Редко используемые (интересные) файлы разбиваются на пространство имен (структура файлов и папок) и содержимое файла. Пространство имен хранится локально и содержимое файла, хранящегося в файловом ресурсе Azure в облаке. 

Когда пользователь открывает многоуровневый файл, Синхронизация файлов Azure без проблем отзывает данные файлов из файлового ресурса в Azure.

## <a name="how-cloud-tiering-works"></a>Как работает распределение по уровням облака

### <a name="cloud-tiering-policies"></a>Политики распределения по уровням облака
При включении распределения по уровням облака существует две политики, которые можно настроить для информирования Синхронизация файлов Azure о том, когда следует выполнять многоуровневые файлы: **политика свободного места тома** и **Политика дат**. 

#### <a name="volume-free-space-policy"></a>Политика свободного места в томе
**Политика "свободное место на томе** " указывает синхронизация файлов Azure уровня файлов в облако, когда на локальном диске записывается определенный объем пространства. 

Например, если емкость локального диска составляет 200 ГБ и требуется не менее 40 ГБ дискового пространства, чтобы всегда оставаться свободными, следует задать для политики свободного места тома значение 20%. Объем свободного места на томе применяется на уровне тома, а не на уровне отдельных каталогов или конечных точек сервера. 

Сведения о том, как политика свободного места в томе влияет на файлы, первоначально загружаемые при добавлении новой конечной точки сервера (см. раздел [политики синхронизации, влияющие на распределение по уровням облака](#sync-policies-that-affect-cloud-tiering)).

#### <a name="date-policy"></a>Политика дат
При использовании **политики дат** файлы с файлами будут распределены по уровням в облако, если к ним не обращались (т. е. чтение или запись) в течение x дней. Например, если вы заметили, что файлы с более чем 15 днями без доступа обычно являются архивными файлами, следует задать для политики даты значение 15 дней. 

Дополнительные примеры совместной работы политики "Дата и свободное место на томе" см. в статье [выбор синхронизация файлов Azure политик уровня облака](storage-sync-choose-cloud-tiering-policies.md).

### <a name="windows-server-data-deduplication"></a>Дедупликация данных Windows Server
Дедупликация данных поддерживается на томах с включенным распределением по уровням облака, начиная с Windows Server 2016. Дополнительные сведения см. в разделе [Планирование развертывания Синхронизация файлов Azure](https://docs.microsoft.com/azure/storage/files/storage-sync-files-planning#data-deduplication).

### <a name="cloud-tiering-heatmap"></a>Тепловой карты по уровням облака
Синхронизация файлов Azure отслеживает доступ к файлам (операции чтения и записи) с течением времени и, в зависимости от частоты и последнего доступа, назначает тепловую оценку каждому файлу. Эти показатели используются для создания "тепловой карты" пространства имен на каждой конечной точке сервера. Этот тепловой карты представляет собой список всех синхронизированных файлов в расположении с включенным распределением по уровням облака, упорядоченным по показателям тепла. Часто используемые файлы, которые недавно открывались, считаются горячими, а файлы, которые были практически затронуты и к которым не обращались в течение некоторого времени, считаются очень замечательными. 

Чтобы определить относительное расположение отдельного файла в тепловой карты, система использует максимальное количество отметок времени в следующем порядке: MAX (время последнего доступа, время последнего изменения, время создания). 

Как правило, время последнего доступа проявляется и доступно. Однако при создании конечной точки сервера с включенным распределением по уровням облака прошло недостаточно времени для отслеживания доступа к файлам. Если время последнего доступа отсутствует, вместо этого используется время последнего изменения для вычисления относительного положения в тепловой карты.  

Политика дат работает аналогичным образом. Без времени последнего доступа политика дат будет действовать на время последнего изменения. Если он недоступен, он будет возвращаться к времени создания файла. Со временем система будет наблюдать за большим количеством запросов на доступ к файлам и автоматически начать использовать время последнего доступа с помощью самостоятельного отслеживания.

> [!Note]
> Распределение по уровням облака не зависит от функции NTFS для отслеживания времени последнего доступа. Эта функция NTFS отключена по умолчанию, и из-за соображений производительности не рекомендуется включать эту функцию вручную. Распределение по уровням облака отслеживает время последнего доступа отдельно.

### <a name="sync-policies-that-affect-cloud-tiering"></a>Политики синхронизации, влияющие на распределение по уровням облака

В Синхронизация файлов Azure Agent версии 11 есть две дополнительные политики Синхронизация файлов Azure, которые можно настроить, которые влияют на распределение по уровням облака: **начальная загрузка** и **упреждающий отзыв**.

#### <a name="initial-download"></a>Начальная загрузка

Когда сервер подключается к файловому ресурсу Azure с файлами в нем, теперь можно решить, каким способом сервер будет первоначально скачивать данные общей папки. Если распределение по уровням облака включено, у вас есть два варианта. 

![Снимок экрана первоначального скачивания при включенном уровне облака](media/storage-sync-cloud-tiering-overview/cloud-tiering-overview-3.png)  

Первый вариант — сначала отозвать пространство имен, а затем отозвать содержимое файла по метке времени последнего изменения, пока не достигнет емкости локального диска. Если на диске достаточно места и известно, что файлы, которые были изменены последними, должны быть кэшированы локально, этот параметр является идеальным. Файлы, которые не могут быть сохранены локально из-за нехватки места на диске, будут распределены по уровням.        

Второй вариант — изначально отозвать только пространство имен и отозвать содержимое файла только при доступе к нему. Этот вариант лучше использовать, если требуется максимально сокращать емкость, используемую на локальном диске, и пользователи должны решить, какие файлы следует кэшировать локально. Все файлы будут запускаться как многоуровневые файлы с этим параметром.

![Снимок экрана первоначального скачивания, если распределение по уровням облака отключено](media/storage-sync-cloud-tiering-overview/cloud-tiering-overview-4.png)

Если распределение по уровням облака отключено, у вас есть третий вариант, который позволяет не только объединить многоуровневые файлы. В этом случае файлы будут отображаться только на сервере после полной загрузки. Если у вас есть приложения, для которых требуется наличие полных файлов и они не могут допускать многоуровневые файлы в своем пространстве имен, это идеальный вариант.      

#### <a name="proactive-recalling"></a>Упреждающий отзыв

При создании или изменении файла можно заранее отозвать файл на серверы, которые вы указали. Это делает новый или измененный файл доступным для использования на каждом указанном сервере. 

Например, глобально распределенная компания имеет филиалы в США и Индии. В утром (США) информационные работники создают новую папку и новые файлы для нового проекта, а также работают со всеми днями. Синхронизация файлов Azure будет синхронизировать папки и файлы в общую папку Azure (облачная конечная точка). Информационные работники в Индии продолжат работу над проектом в своем часовом поясе. Когда они поступают утром, локальный сервер Синхронизация файлов Azure с поддержкой в Индии должен иметь доступ к этим новым файлам локально, чтобы группа Индии могла эффективно работать с локальным кэшем. Включение этого режима предотвращает медленный доступ к файлам из-за отзыва по требованию и позволяет серверу заранее отозвать файлы сразу после их изменения или создания в общей папке Azure.

Если файлы, отозванные на сервере, на самом деле не требуются локально, ненужный отзыв может увеличить трафик и расходы. Таким образом, только если известно, что предварительное заполнение кэша сервера последними изменениями из облака повлияет на пользователей или приложения, использующие файлы на этом сервере. 

Включение упреждающего повторного вызова также может привести к увеличению использования пропускной способности на сервере и может привести к агрессивному распределению другого относительно нового содержимого на локальном сервере из-за увеличения числа отозванных файлов. В свою очередь, это может привести к более безопасным вызовам, если файлы, для которых выполняется Многоуровневое распределение, считаются активными серверами. 

:::image type="content" source="media/storage-sync-files-deployment-guide/proactive-download.png" alt-text="Изображение, показывающее поведение скачивания файлового ресурса Azure для конечной точки сервера, которое в настоящий момент действует, и кнопку для открытия меню, позволяющее изменить его.":::

Дополнительные сведения о упреждающим отзыве см. в разделе [Deploy синхронизация файлов Azure](storage-sync-files-deployment-guide.md#proactively-recall-new-and-changed-files-from-an-azure-file-share).

## <a name="tiered-vs-locally-cached-file-behavior"></a>Поведение многоуровневого и локального кэшированного файла

Распределение по уровням облака — это разделение между пространством имен (иерархия файлов и папок, а также свойств файла) и содержимым файла. 

#### <a name="tiered-file"></a>Многоуровневый файл

Для многоуровневых файлов Размер на диске равен нулю, так как само содержимое файла не хранится локально. Если файл имеет многоуровневый уровень, Синхронизация файлов Azure фильтр файловой системы (StorageSync.sys) локально заменяет файл указателем (точкой повторного анализа). Точка повторного анализа представляет URL-адрес файла в общем файловом ресурсе Azure. Распределенный по уровням файл имеет автономный атрибут и набор атрибутов FILE_ATTRIBUTE_RECALL_ON_DATA_ACCESS в NTFS, чтобы сторонние приложения могли идентифицировать такие файлы.   

![Снимок экрана свойств файла, если он имеет уровень "только многоуровневый — пространство имен".](media/storage-sync-cloud-tiering-overview/cloud-tiering-overview-2.png)    

#### <a name="locally-cached-file"></a>Локально кэшированный файл

С другой стороны, для файла, хранящегося на локальном файловом сервере, размер на диске примерно равен логическому размеру файла, так как весь файл (атрибуты файлов + содержимое файла) хранится локально.     

![Снимок экрана свойств файла, если он не является многоуровневый — пространство имен и содержимое файла.](media/storage-sync-cloud-tiering-overview/cloud-tiering-overview-1.png) 

Файл также может быть перемещен частично (или частично отозван), что означает, что на диске размещается часть файла. Это может произойти при частичном чтении файлов такими приложениями, как проигрыватели мультимедиа или служебными программами zip, которые поддерживают потоковый доступ к файлам. Синхронизация файлов Azure Smart и отзывает только запрошенную информацию из подключенного файлового ресурса Azure.

> [!NOTE]
> Размер представляет логический размер файла. Размер на диске представляет собой физический размер файлового потока, хранящегося на диске.

## <a name="next-steps"></a>Дальнейшие действия
* [Выбор Синхронизация файлов Azure политик распределения по уровням облака](storage-sync-choose-cloud-tiering-policies.md)
* [Планирование развертывания службы синхронизации файлов Azure (предварительная версия)](storage-sync-files-planning.md)

