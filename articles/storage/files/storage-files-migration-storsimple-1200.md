---
title: Миграция с устройства Storsimple 1200 в службу "Синхронизация файлов Azure"
description: Узнайте, как перенести виртуальное устройство серии StorSimple 1200 в Синхронизация файлов Azure.
author: fauhse
ms.service: storage
ms.topic: how-to
ms.date: 03/09/2020
ms.author: fauhse
ms.subservice: files
ms.openlocfilehash: 8562d63bf227fff665c70674c7fe66922bce9992
ms.sourcegitcommit: 910a1a38711966cb171050db245fc3b22abc8c5f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "98882286"
---
# <a name="storsimple-1200-migration-to-azure-file-sync"></a>Миграция с устройства Storsimple 1200 в службу "Синхронизация файлов Azure"

Серия StorSimple 1200 — это виртуальное устройство, которое выполняется в локальном центре обработки данных. Данные из этого устройства можно перенести в среду Синхронизация файлов Azure. Синхронизация файлов Azure является стратегически долгосрочной службой Azure по умолчанию, в которую можно перенести устройства StorSimple.

Серия StorSimple 1200 пойдет в [конец срока службы](https://support.microsoft.com/en-us/lifecycle/search?alpha=StorSimple%201200%20Series) в декабре 2022.  Важно начать планирование миграции как можно скорее. Эта статья содержит необходимые фундаментальные знания и миграции для успешной миграции на Синхронизация файлов Azure. 

## <a name="azure-file-sync"></a>Синхронизация файлов Azure

> [!IMPORTANT]
> Корпорация Майкрософт стремится помочь клиентам в их миграции. Email AzureFilesMigration@microsoft . com для настраиваемого плана миграции, а также помощь во время миграции.

Синхронизация файлов Azure — это облачная служба Майкрософт, основанная на двух основных компонентах:

* Синхронизация файлов и распределение по уровням облака.
* Общие файловые ресурсы как собственные хранилища в Azure, к которым можно получить доступ по нескольким протоколам, таким как SMB и File RESTFUL. Общая папка Azure сравнима с общей папкой на сервере Windows Server, которую можно подключить как сетевой диск. Он поддерживает важные аспекты качества файла, такие как атрибуты, разрешения и метки времени. В отличие от StorSimple для интерпретации файлов и папок, хранящихся в облаке, не требуется никаких приложений и служб. Идеальный и наиболее гибкий подход к хранению данных файлового сервера общего назначения, а также данных приложений в облаке.

В этой статье рассматриваются этапы миграции. Если перед миграцией вы хотите узнать больше о Синхронизация файлов Azure, мы рекомендуем использовать следующие статьи:

* [Общие сведения о Синхронизация файлов Azure](./storage-sync-files-planning.md "Обзор")
* [Рекомендации по развертыванию Синхронизация файлов Azure](storage-sync-files-deployment-guide.md)

## <a name="migration-goals"></a>Цели миграции

Цель заключается в том, чтобы гарантировать целостность производственных данных, а также обеспечить доступность. Последний требует, чтобы время простоя не превышало минимального, так что оно может поместиться в или только немного больше, чем обычные периоды обслуживания.

## <a name="storsimple-1200-migration-path-to-azure-file-sync"></a>Путь перехода StorSimple 1200 к Синхронизация файлов Azure

Для запуска агента Синхронизация файлов Azure требуется локальный сервер Windows Server. Windows Server может быть как минимум сервером 2012 R2, но в идеале это Windows Server 2019.

Существует множество альтернативных путей перехода, и они могут создать слишком длинную статью, чтобы задокументировать все эти данные и продемонстрировать, почему в этой статье мы рекомендуем использовать для этого маршрута риск или недостатки.

:::image type="content" source="media/storage-files-migration-storsimple-shared/storsimple-1200-migration-overview.png" alt-text="Обзор маршрута миграции ниже в этой статье.":::

На предыдущем рисунке показаны действия, которые соответствуют разделам этой статьи.

### <a name="step-1-provision-your-on-premises-windows-server-and-storage"></a>Шаг 1. Предоставление локального сервера и хранилища Windows

1. Создайте Windows Server 2019 — как минимум 2012 R2 — как виртуальную машину или физический сервер. Также поддерживается кластер с отработкой отказа Windows Server.
2. Подготавливаете или добавляйте непосредственно подключенное хранилище (DAS по сравнению с NAS, которое не поддерживается). Размер хранилища Windows Server должен быть больше или равен размеру доступной емкости виртуального устройства StorSimple 1200.

### <a name="step-2-configure-your-windows-server-storage"></a>Шаг 2. Настройка хранилища Windows Server

На этом шаге структура хранилища StorSimple (тома и общие папки) сопоставляется с структурой хранилища Windows Server.
Если вы планируете вносить изменения в структуру хранилища, то есть число томов, сопоставление папок данных с томами или структура вложенной папки выше или ниже текущей общей папки SMB/NFS, теперь пришло время принять эти изменения.
Изменение структуры файлов и папок после настройки Синхронизация файлов Azure является громоздким и следует избегать.
В этой статье предполагается, что вы сопоставляется 1:1, поэтому при выполнении действий, описанных в этой статье, необходимо принять во внимание изменения сопоставления.

* Никакие рабочие данные не должны заканчиваться на системном томе Windows Server. Распределение по уровням облака не поддерживается на системных томах. Однако эта функция необходима для миграции, а также для непрерывных операций в качестве замены StorSimple.
* Подготавливает такое же количество томов на сервере Windows Server, как и на виртуальном устройстве StorSimple 1200.
* Настройте необходимые роли, компоненты и параметры Windows Server. Мы рекомендуем отказаться от обновлений Windows Server, чтобы операционная система оставалась в безопасности и актуальна. Аналогичным образом мы рекомендуем отказаться от Центр обновления Майкрософт для обновления приложений Майкрософт, включая агент Синхронизация файлов Azure.
* Не настраивайте никакие папки и общие папки перед чтением следующих шагов.

### <a name="step-3-deploy-the-first-azure-file-sync-cloud-resource"></a>Шаг 3. развертывание первого Синхронизация файлов Azure облачного ресурса

[!INCLUDE [storage-files-migration-deploy-afs-sss](../../../includes/storage-files-migration-deploy-azure-file-sync-storage-sync-service.md)]

### <a name="step-4-match-your-local-volume-and-folder-structure-to-azure-file-sync-and-azure-file-share-resources"></a>Шаг 4. сопоставление локального тома и структуры папок с Синхронизация файлов Azure и ресурсами файлового ресурса Azure

[!INCLUDE [storage-files-migration-namespace-mapping](../../../includes/storage-files-migration-namespace-mapping.md)]

### <a name="step-5-provision-azure-file-shares"></a>Шаг 5. предоставление файловых ресурсов Azure

[!INCLUDE [storage-files-migration-provision-azfs](../../../includes/storage-files-migration-provision-azure-file-share.md)]

### <a name="step-6-configure-windows-server-target-folders"></a>Шаг 6. Настройка целевых папок Windows Server

На предыдущих шагах вы рассматривали все аспекты, которые будут определять компоненты топологий синхронизации. Теперь пора подготовить сервер к приему файлов для отправки.

Создайте **все** папки, которые будут синхронизироваться с их собственной общей папкой Azure.
Важно следовать описанной выше структуре папок. Если, например, вы решили синхронизировать несколько локальных общих ресурсов SMB в одном общем файловом ресурсе Azure, их необходимо поместить в общую корневую папку тома. Создайте эту целевую корневую папку на томе.

Число подготовленных файловых ресурсов Azure должно совпадать с количеством папок, созданных на этом шаге, и количеством томов, которые будут синхронизироваться на корневом уровне.

### <a name="step-7-deploy-the-azure-file-sync-agent"></a>Шаг 7. Развертывание агента Синхронизация файлов Azure

[!INCLUDE [storage-files-migration-deploy-afs-agent](../../../includes/storage-files-migration-deploy-azure-file-sync-agent.md)]

### <a name="step-8-configure-sync"></a>Шаг 8. Настройка синхронизации

[!INCLUDE [storage-files-migration-configure-sync](../../../includes/storage-files-migration-configure-sync.md)]

> [!WARNING]
> **Не забудьте включить распределение по уровням облака.** Это необходимо, если на локальном сервере недостаточно места для хранения общего размера данных в облачном хранилище StorSimple. Задайте политику распределения, временно предназначенную для миграции, на 99% свободного места на томе.

Повторите шаги создания группы синхронизации и добавления соответствующей серверной папки в качестве конечной точки сервера для всех общих файловых ресурсов Azure и расположений серверов, которые необходимо настроить для синхронизации.

### <a name="step-9-copy-your-files"></a>Шаг 9. копирование файлов

Базовый подход к миграции — это Robocopy от виртуального устройства StorSimple до Windows Server, а также Синхронизация файлов Azure к общим файловым ресурсам Azure.

Запустите первую локальную копию в целевой папке Windows Server:

* Найдите первое расположение на виртуальном устройстве StorSimple.
* Найдите соответствующую папку на сервере Windows, на которой уже настроен Синхронизация файлов Azure.
* Запуск копирования с помощью средства Robocopy

Следующая команда Robocopy отправит файлы из хранилища StorSimple Azure в локальную службу StorSimple и переместит их в целевую папку Windows Server. Windows Server будет синхронизировать его с общими файловыми ресурсами Azure. По мере заполнения локального тома Windows Server распределение по уровням облака будет запущено в, а файлы уровня, которые были успешно синхронизированы. Распределение по уровням облака создаст достаточно места для продолжения копирования с виртуального устройства StorSimple. Распределение по уровням в облаке выполняется один раз в час, чтобы увидеть, что синхронизировано, и освободить место на диске, чтобы получить доступ к свободному объему тома 99%.

```console
Robocopy /MT:32 /UNILOG:<file name> /TEE /B /MIR /COPYALL /DCOPY:DAT <SourcePath> <Dest.Path>
```

Фон:

:::row:::
   :::column span="1":::
      /MT
   :::column-end:::
   :::column span="1":::
      Позволяет использовать средство Robocopy для работы с многопоточными потоками. Значение по умолчанию — 8, максимальное — 128.
   :::column-end:::
:::row-end:::
:::row:::
   :::column span="1":::
      /УНИЛОГ:<file name>
   :::column-end:::
   :::column span="1":::
      Выводит состояние в файл журнала как Юникод (перезаписывает существующий журнал).
   :::column-end:::
:::row-end:::
:::row:::
   :::column span="1":::
      /ти
   :::column-end:::
   :::column span="1":::
      Вывод в окно консоли. Используется в сочетании с выходными данными в файл журнала.
   :::column-end:::
:::row-end:::
:::row:::
   :::column span="1":::
      /B
   :::column-end:::
   :::column span="1":::
      Запускает Robocopy в том же режиме, что и приложение резервного копирования. Это позволяет Robocopy перемещать файлы, к которым у текущего пользователя нет разрешений.
   :::column-end:::
:::row-end:::
:::row:::
   :::column span="1":::
      /мир
   :::column-end:::
   :::column span="1":::
      Позволяет выполнять эту команду Robocopy несколько раз, последовательно применяя к одному и тому же целевому объекту или назначению. Он определяет, что было скопировано ранее, и опускает его. Будут обработаны только изменения, добавления и *удаления*, произошедшие с момента последнего запуска. Если команда не выполнялась ранее, ничего не пропускается. Это отличный вариант для исходных расположений, которые по-прежнему используются и изменяются.
   :::column-end:::
:::row-end:::
:::row:::
   :::column span="1":::
      /COPY: копифлаг [s]
   :::column-end:::
   :::column span="1":::
      достоверность копии файла (по умолчанию —/COPY: DAT), флаги копирования: D = данные, A = атрибуты, T = метки времени, S = безопасность = NTFS ACL, O = сведения о владельце, U = сведения аудита
   :::column-end:::
:::row-end:::
:::row:::
   :::column span="1":::
      /копялл
   :::column-end:::
   :::column span="1":::
      Копировать все сведения о файле (эквивалентно/COPY: ДАТСАУ)
   :::column-end:::
:::row-end:::
:::row:::
   :::column span="1":::
      /ДКОПИ: копифлаг [s]
   :::column-end:::
   :::column span="1":::
      точность для копии каталогов (по умолчанию/ДКОПИ: DA), флаги копирования: D = данные, A = Attributes, T = метки времени
   :::column-end:::
:::row-end:::

При первом запуске команды Robocopy пользователи и приложения по-прежнему получают доступ к файлам и папкам StorSimple и потенциально могут изменить их. Возможно, средство Robocopy обработало каталог, переходит к следующему, а затем пользователь в исходном расположении (StorSimple) добавляет, изменяет или удаляет файл, который сейчас не будет обрабатываться в текущем запуске средства Robocopy. Это нормально.

Первый запуск заключается в том, чтобы переместить данные из резервной копии в локальную среду, в Windows Server и в облако с помощью Синхронизация файлов Azure. Это может занять длительное время, в зависимости от следующих действий.

* пропускная способность загрузки
* скорость отзыва облачной службы StorSimple
* пропускная способность передачи
* количество элементов (файлов и папок), которые должны обрабатываться любой из служб

После завершения начального запуска выполните команду еще раз.

Второй раз он будет выполняться быстрее, так как ему нужно только передать изменения, произошедшие с момента последнего запуска. Эти изменения, скорее всего, уже являются локальными для StorSimple, так как они являются последними. Это еще более сокращает время, поскольку уменьшается потребность в отзыве из облака. Во время этого второго запуска все еще могут накапливаться новые изменения.

Повторите эту процедуру, пока не будет удовлетворено, что время, необходимое для выполнения, является приемлемым временем простоя.

Если вы считаете допустимое время простоя и готовы перевести расположение StorSimple в автономный режим, сделайте это сейчас: например, удалите общую папку SMB, чтобы никто не мог получить доступ к папке, или выполнить другие действия, не позволяющие изменить содержимое этой папки в StorSimple.

Выполнить один последний цикл Robocopy. Это позволит выбрать любые изменения, которые могли быть пропущены.
Время выполнения последнего шага зависит от скорости сканирования Robocopy. Вы можете оценить время (которое равно времени простоя), измеряя длительность предыдущего запуска.

Создайте общую папку в папке Windows Server и, возможно, настройте развертывание DFS-N, чтобы она указывала на нее. Не забудьте установить те же разрешения на уровне общего ресурса, что и в общем ресурсе SMB StorSimple.

Вы завершили миграцию общей папки или группы общих папок в общий корень или том. (В зависимости от того, что было сопоставлено и решило переходить в одну и ту же общую папку Azure.)

Можно попытаться выполнить несколько из этих копий параллельно. Рекомендуется обрабатывать по одной общей папке Azure за раз.

> [!WARNING]
> После перемещения всех данных из StorSimple в Windows Server и завершения миграции: Вернитесь ко ***всем***  группам синхронизации в портал Azure и измените значение процента свободного места на уровне облака на более подходящее для использования кэша, скажем, 20%. 

Политика свободного места тома уровня облака действует на уровне тома с потенциальной синхронизацией нескольких конечных точек сервера. Если вы забыли скорректировать свободное пространство даже на одной конечной точке сервера, то Sync продолжит применять наиболее ограниченное правило и попытается сохранить 99% свободного места на диске, что делает локальный кэш не так, как вы можете ожидать. Если это не ваша цель, чтобы иметь только пространство имен для тома, содержащего редко используемые архивные данные.

## <a name="troubleshoot"></a>Диагностика

Наиболее вероятной причиной проблемы, с которой можно столкнуться, является то, что команда Robocopy завершается с ошибкой *"том Full"* на стороне Windows Server. В этом случае скорость загрузки скорее всего лучше, чем скорость передачи. Распределение по уровням в облаке действует один раз в час, чтобы эвакуировать содержимое с локального диска Windows Server, синхронизированного.

Разрешите выполнение синхронизации и распределение по уровням облака, освободите место на диске. Это можно заметить в проводнике на Windows Server.

При наличии достаточной емкости Windows Server повторное выполнение команды устранит проблему. При возникновении этой ситуации ничего не происходит, и вы можете легко продвигаться вперед. Неудобство выполнения команды является единственным следствием.

Кроме того, можно выполнить другие Синхронизация файлов Azure проблемы.
Как маловероятно, если это возможно, ознакомьтесь с **руководством по ссылке синхронизация файлов Azure устранения неполадок**.

## <a name="relevant-links"></a>Соответствующие ссылки

Содержимое миграции:

* [Руководства по миграции в серии StorSimple 8000](storage-files-migration-storsimple-8000.md)

Синхронизация файлов Azure содержимое:

* [Общие сведения о AFS](./storage-sync-files-planning.md)
* [Рекомендации по развертыванию AFS](./storage-how-to-create-file-share.md)
* [Устранение неполадок с AFS](storage-sync-files-troubleshoot.md)