---
title: Синхронизация файлов Azure политик распределения по уровням облака | Документация Майкрософт
description: Сведения о том, как политики "Дата и свободное место на томе" работают совместно в различных сценариях.
author: roygara
ms.service: storage
ms.topic: conceptual
ms.date: 1/4/2021
ms.author: rogarana
ms.subservice: files
ms.openlocfilehash: 3020737e91e1fe5c4af3e23a147fa0ea16037d3b
ms.sourcegitcommit: dda0d51d3d0e34d07faf231033d744ca4f2bbf4a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/05/2021
ms.locfileid: "102204435"
---
# <a name="cloud-tiering-policies"></a>Политики распределения по уровням облака

Распределение по уровням облака имеет две политики, которые определяют, какие файлы распределены по уровням в облаке: **политика свободного места в томе** и **Политика дат**.

**Политика свободного места тома** гарантирует, что указанный процент локального тома, на котором расположена конечная точка сервера, всегда остается свободным. 

На уровне **политики даты** последний раз осуществлялся доступ к файлам x дн. назад или более поздней версии. Политика свободного места тома всегда будет иметь приоритет. Если на томе недостаточно свободного места для хранения файлов, как описано в политике дат, Синхронизация файлов Azure переопределит политику дат и продолжит распределять файлы холодное до тех пор, пока не будет выполнено свободное пространство тома.

## <a name="how-both-policies-work-together"></a>Как работают обе политики совместно

Мы будем использовать пример, чтобы продемонстрировать, как работают эти политики. Допустим, вы настроили Синхронизация файлов Azure на локальном томе 500 ГБ, а распределение по уровням облака никогда не включалось. Это файлы в общей папке:

|Имя файла |Время последнего доступа  |Размер файла  |Хранится в |
|----------|------------------|-----------|----------|
|Файл 1    | 2 дня назад  | 10 ГБ | Сервер и файловый ресурс Azure
|Файл 2    | 10 дн. назад | 30 ГБ | Сервер и файловый ресурс Azure
|Файл 3    | 1 год назад | 200 ГБ | Сервер и файловый ресурс Azure
|Файл 4    | 1 год, 2 дня назад | 130 ГБ | Сервер и файловый ресурс Azure
|Файл 5    | 2 года, 1 день назад | 140 ГБ | Сервер и файловый ресурс Azure

**Изменение 1:** Вы включили распределение по уровням облака, установите политику свободного места тома 20% и сохранили политику дат отключена. С такой конфигурацией распределение по уровням облака гарантирует, что 20% (в данном случае 100 ГБ) пространства останется свободным и доступным на локальном компьютере. В результате общая емкость локального кэша составляет 400 ГБ. В 400 ГБ будут храниться самые последние и часто используемые файлы на локальном томе.

В этой конфигурации в локальном кэше будут храниться только файлы с 1 по 4, а для файла 5 будет использоваться многоуровневый уровень. Это всего 370 ГБ из 400 ГБ, которые можно использовать. Файл 5 имеет размер 140 ГБ и превышает ограничение в 400 ГБ, если оно было локально кэшировано. 

**Изменить 2:** Предположим, что пользователь обращается к файлу 5. Это делает файл 5 последним доступным файлом в общей папке. В результате файл 5 будет храниться в локальном кэше, что соответствует ограничению 400 ГБ, а файл 4 будет многоуровневый. В следующей таблице показано, где хранятся файлы, с этими обновлениями:

|Имя файла |Время последнего доступа  |Размер файла  |Хранится в |
|----------|------------------|-----------|----------|
|Файл 5    | 2 ч назад | 140 ГБ | Сервер и файловый ресурс Azure
|Файл 1    | 2 дня назад  | 10 ГБ | Сервер и файловый ресурс Azure
|Файл 2    | 10 дн. назад | 30 ГБ | Сервер и файловый ресурс Azure
|Файл 3    | 1 год назад | 200 ГБ | Сервер и файловый ресурс Azure
|Файл 4    | 1 год, 2 дня назад | 130 ГБ | Файловый ресурс Azure, многоуровневый локальный уровень

**Изменение 3:** Предположим, что вы обновили политики, чтобы политика распределения по датам была 60 дней, а политика свободного места на томе — 70%. Теперь в локальном кэше можно хранить до 150 ГБ. Хотя доступ к файлу 2 осуществлялся менее 60 дней назад, политика "свободное место тома" переопределит политику дат, а файл 2 будет многоуровневый, чтобы поддерживать локальное свободное пространство 70.

**Изменение 4:** Если изменить политику свободного места тома на 20%, а затем использовать `Invoke-StorageSyncFileRecall` для отзыва всех файлов, которые помещаются на локальном диске, при соблюдении политик распределения по уровням облака, таблица будет выглядеть следующим образом:

|Имя файла |Время последнего доступа  |Размер файла  |Хранится в |
|----------|------------------|-----------|----------|
|Файл 5    | 1 час назад  | 140 ГБ | Сервер и файловый ресурс Azure
|Файл 1    | 2 дня назад  | 10 ГБ | Сервер и файловый ресурс Azure
|Файл 2    | 10 дн. назад | 30 ГБ | Сервер и файловый ресурс Azure
|Файл 3    | 1 год назад | 200 ГБ | Файловый ресурс Azure, многоуровневый локальный уровень
|Файл 4    | 1 год, 2 дня назад | 130 ГБ | Файловый ресурс Azure, многоуровневый локальный уровень

В этом случае файлы 1, 2 и 5 будут локально кэшироваться, а файлы 3 и 4 будут распределены по уровням. Так как политика дат составляет 60 дней, то файлы 3 и 4 распределяются по уровням, хотя политика свободного места на томе позволяет локально создать до 400 ГБ памяти.

> [!NOTE] 
> Файлы не вызываются автоматически, когда клиенты меняют политику свободного места тома на меньшее значение (например, от 20% до 10%). или измените политику дат на большее значение (например, с 20 дней до 50 дней).

## <a name="multiple-server-endpoints-on-a-local-volume"></a>Несколько конечных точек сервера на локальном томе

Распределение по уровням облака можно включить для нескольких конечных точек сервера на одном локальном томе. Для этой конфигурации необходимо задать для свободного места тома одинаковое значение для всех конечных точек сервера на том же томе. Если для нескольких конечных точек сервера в одном томе заданы разные политики свободного места на томе, то приоритет будет иметь самый крупный процент свободного места. Это называется **действующей политикой свободного места на томе**. Например, если у вас есть три конечных точки сервера на одном локальном томе, один из которых имеет значение 15%, другой — 20%, а третий — 30%, то все они будут начинать распределять файлы холодное, если на них менее 30% свободного места.

## <a name="next-steps"></a>Дальнейшие действия
* [Мониторинг распределения по уровням облака](storage-sync-monitor-cloud-tiering.md)
