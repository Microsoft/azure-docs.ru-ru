---
title: Выбор Синхронизация файлов Azure политик распределения по уровням облака | Документация Майкрософт
description: Сведения о том, что следует учитывать при выборе Синхронизация файлов Azure политик распределения по уровням облака.
author: roygara
ms.service: storage
ms.topic: conceptual
ms.date: 1/24/2021
ms.author: rogarana
ms.subservice: files
ms.openlocfilehash: 2ed1b8162c49ccc26cb98dd02897a9c40f809d14
ms.sourcegitcommit: dda0d51d3d0e34d07faf231033d744ca4f2bbf4a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/05/2021
ms.locfileid: "102204476"
---
# <a name="choose-cloud-tiering-policies"></a>Выбор политик распределения по уровням облака

В этой статье приводятся рекомендации для пользователей, которые выбирают и направляют свои политики по уровням облака. Прежде чем приступить к ознакомлению с этой статьей, убедитесь, что вы понимаете, как работает распределение по уровням облака. Основные сведения об уровне облака см. в статье Синхронизация файлов Azure распределение по [уровням облака](storage-sync-cloud-tiering-overview.md). Подробное описание политик распределения по уровням облака см. в разделе [Синхронизация файлов Azure политики распределения по уровням облака](storage-sync-cloud-tiering-policy.md).

## <a name="limitations"></a>Ограничения
- Распределение по уровням облака не поддерживается на системном томе Windows.

- Вы по-прежнему можете включить распределение по уровням облака, если у вас есть квота FSRM уровня тома. После того как квота FSRM задана, для API запросов свободного места, которые вызываются автоматически, отображается свободное пространство тома согласно параметру квоты. 

### <a name="minimum-file-size-for-a-file-to-tier"></a>Минимальный размер файла для уровня файла

Для агентов версии 9 и более поздних минимальный размер файла на уровне зависит от размера кластера файловой системы. Минимальный размер файла, пригодный для распределения по уровням облака, вычисляется вдвое в размере кластера и не менее 8 КБ. В следующей таблице приведены минимальные размеры файлов, которые могут быть распределены по уровням в зависимости от размера кластера томов.

|Размер кластера томов (в байтах) |Файлы такого размера или увеличения могут быть многоуровневой.  |
|----------------------------|---------|
|4 КБ или меньше (4096)      | 8 КБ    |
|8 КБ (8192)                 | 16 КБ   |
|16 КБ (16384)               | 32 КБ   |
|32 КБ (32768)               | 64 КБ   |
|64 КБ (65536)    | 128 КБ  |

Размеры кластера до 64 КБ в настоящее время поддерживаются, но для больших размеров не работает распределение по уровням облака.

Все файловые системы, используемые Windows, упорядочивают жесткий диск на основе размера кластера (также известного как размер единицы размещения). Размер кластера представляет минимальный объем дискового пространства, который можно использовать для хранения файла. Если размеры файлов не изменяются даже в том случае, если размер кластера не крат размеру, необходимо использовать дополнительное пространство для хранения файла до следующего кратного размера кластера.

Синхронизация файлов Azure поддерживается на томах NTFS с Windows Server 2012 R2 и более поздних версий. В следующей таблице описаны размеры кластера по умолчанию при создании нового тома NTFS с Windows Server 2019.

|Размер тома    |Windows Server 2019             |
|---------------|--------------------------------|
|7 МБ — 16 ТБ   | 4 КБ                |
|16TB — 32 ТБ   | 8 КБ                |
|32TB — 64 ТБ   | 16 КБ               |
|64TB — 128 ТБ  | 32 КБ               |
|128TB — 256 ТБ | 64 КБ (предыдущий максимальный размер) |
|256 ТБ — 512 ТБ| 128 КБ              |
|512 ТБ — 1 ПБ  | 256 KB              |
|1 ПБ – 2 PB    | 512 КБ              |
|2 ТБ – 4 ПБ    | 1024 КБ             |
|4 ТБ — 8 ТБ    | 2048 КБ (максимальный размер)  |
|> 8 ТБ         | Не поддерживается       |

При создании тома можно вручную отформатировать том с другим размером кластера. Если ваш том имеет более раннюю версию Windows, размеры кластера по умолчанию также могут отличаться. [Эта статья содержит дополнительные сведения о размерах кластера по умолчанию.](https://support.microsoft.com/help/140365/default-cluster-size-for-ntfs-fat-and-exfat) Даже если вы выбираете размер кластера меньше 4 КБ, ограничение в 8 КБ в качестве наименьшего размера файла, который может быть многоуровневый, по-прежнему применяется. (Даже если технический размер кластера 2 КБ будет равняться менее 8 Кбайт.)

Причина абсолютного минимума сохраняется в том способе, в котором NTFS хранит очень мелкие файлы размером от 1 КБ до 4 КБ. В зависимости от других параметров тома возможно, что небольшие файлы не хранятся в кластере на диске. Возможно, более эффективно хранить такие файлы непосредственно в главной таблице файлов или в записи MFT. Точка повторного анализа уровня облака всегда хранится на диске и занимает ровно один кластер. Распределение таких мелких файлов может привести к отсутствию экономии места. В экстремальных случаях может быть даже больше пространства с включенным распределением по уровням облака. Для защиты от этого минимальный размер файла, который будет распределяться по уровням облака, составляет 8 КБ на 4 КБ или меньшем размере кластера. 

## <a name="selecting-your-initial-policies"></a>Выбор начальных политик

Как правило, при включении уровня облака в конечной точке сервера необходимо создать один локальный виртуальный диск для каждой конечной точки сервера. Изоляция конечной точки сервера упрощает понимание того, как работает распределение по уровням облака и соответствующим образом корректирует политики. Однако Синхронизация файлов Azure работает даже при наличии нескольких конечных точек сервера на одном диске. Дополнительные сведения см. в разделе " [несколько конечных точек сервера в локальном томе](storage-sync-cloud-tiering-policy.md#multiple-server-endpoints-on-a-local-volume) ". Также рекомендуется, чтобы при первом включении распределения по уровням в облаке политика дат была отключена, а политика свободного места тома составляет около 10% на 20%. Для большинства томов файлового сервера обычно лучшим вариантом является 20% свободного места на томе.

Для простоты и четкого понимания того, как будут распределяться элементы, мы рекомендуем настроить политику свободного места на томе, чтобы не отключать политику дат, если это не требуется. Мы рекомендуем использовать этот способ, так как большинство клиентов найдут ценные сведения для заполнения локального кэша максимально возможным количеством активных файлов и уровнем остальной части в облако. Однако политика дат может оказаться полезной, если вы хотите заранее освободить место на локальном диске и вы уверены, что файлы в этой конечной точке сервера доступны после того, как количество дней, указанных в политике дат, не нужно хранить локально. При установке политики даты освобождается ценная емкость локального диска для других конечных точек на том же томе, чтобы кэшировать больше файлов.

После настройки политик следует отслеживать исходящие и настраивать обе политики соответствующим образом. В Azure Monitor можно просмотреть **Размер отзыва** и **Размер отзыва облачного уровня по** уровням облака. Сведения о мониторинге исходящего трафика см. в разделе мониторинг распределения по [уровням облака](storage-sync-monitor-cloud-tiering.md).

## <a name="adjusting-your-policies"></a>Настройка политик

Если объем файлов, которые постоянно вызываются из Azure, больше, чем требуется, у вас может быть более горячий файл, чем место для сохранения на локальном томе сервера. Увеличьте размер локального тома, если это возможно, и (или) уменьшите процент политики свободного места на томе с малым шагом. Чрезмерное уменьшение объема свободного места в томе может также негативно сказаться. Для более высоких обновлений в наборе данных требуется больше свободного пространства — для новых файлов и для отзыва «холодных» файлов. Распределение по уровням начинается с задержки до одного часа, а затем требует времени обработки, поэтому следует всегда иметь достаточно свободного места на томе.

Хранение большего количества локальных данных означает снижение затрат на исходящий трафик, так как меньшее число файлов будет отозвано из Azure, но для этого потребуется больший объем локального хранилища, за который приходится собственная стоимость. 

При настройке политики свободного места на томе объем данных, которые должны оставаться локальными, определяется следующими факторами: пропускная способность, шаблон доступа к набору данных и бюджет. При использовании подключения с низкой пропускной способностью может потребоваться больше локальных данных, чтобы обеспечить минимальную задержку для пользователей. В противном случае можно учитывать частоту изменения данных в рамках определенного периода. Например, если известно, что 10% изменений набора данных объемом 1 ТБ или активно используется каждый месяц, вам может потребоваться использовать 100 ГБ локально, чтобы не выполнять повторное обращение к файлам. Если размер тома составляет 2 ТБ, то необходимо будет иметь значение 5% (или 100 ГБ) локально, что означает, что оставшееся 95% — это свободное место в томе. Однако следует добавить буфер для периодов более высоких обновлений, иными словами, начиная с объема свободного места в процентах, а затем изменяя его, если это потребуется позже.

## <a name="standard-operating-procedures"></a>Стандартные операционные процедуры

- При первой миграции на службы файлов Azure через Синхронизация файлов Azure распределение по уровням облака зависит от начальной передачи
- Распределение по уровням в облаке проверяет соответствие политик свободного места и доступности тома каждые 60 минут.
- Использование параметра/ЛФСМ в Robocopy при миграции файлов позволит синхронизировать файлы и распределять по уровням облака, чтобы освободить место во время начальной передачи. 
- Если выполняется распределение по уровням до формирования тепловой карты, файлы будут распределены по времени последнего изменения.

## <a name="next-steps"></a>Дальнейшие действия
* [Планирование развертывания службы синхронизации файлов Azure (предварительная версия)](storage-sync-files-planning.md)
