---
title: Руководство. Расширение файловых серверов Windows с использованием службы "Синхронизация файлов Azure" | Документация Майкрософт
description: Узнайте, как расширить файловые серверы Windows с помощью службы "Синхронизация файлов Azure" от начала до конца.
author: roygara
ms.service: storage
ms.topic: tutorial
ms.date: 10/23/2018
ms.author: rogarana
ms.subservice: files
ms.openlocfilehash: 1d2a0d79a5cdd53f8376c088fc986c20908575eb
ms.sourcegitcommit: f28ebb95ae9aaaff3f87d8388a09b41e0b3445b5
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/29/2021
ms.locfileid: "91329468"
---
# <a name="tutorial-extend-windows-file-servers-with-azure-file-sync"></a>Руководство по Расширение файловых серверов Windows с использованием службы "Синхронизация файлов Azure"

В этой статье показаны основные шаги, необходимые для повышения емкости хранилища сервера Windows с использованием службы "Синхронизация файлов Azure". Хотя в этом руководстве используется виртуальная машина Azure для экземпляра Windows Server, этот процесс обычно выполняется на локальных серверах. Вы можете найти инструкции по развертыванию службы "Синхронизация файлов Azure" в собственной среде в статье [Развертывание Синхронизации файлов Azure](storage-sync-files-deployment-guide.md).

> [!div class="checklist"]
> * Развертывание службы синхронизации хранилища
> * Подготовка сервера Windows к работе со службой синхронизации файлов Azure
> * Установка агента службы синхронизации файлов Azure
> * Регистрация Windows Server в службе синхронизации хранилища.
> * Создание группы синхронизации и конечной точки облака
> * Создание конечной точки сервера

Если у вас еще нет подписки Azure, [создайте бесплатную учетную запись](https://azure.microsoft.com/free/?WT.mc_id=A261C142F), прежде чем начинать работу.

## <a name="sign-in-to-azure"></a>Вход в Azure

Войдите на [портал Azure](https://portal.azure.com).

## <a name="prepare-your-environment"></a>Подготовка среды

В этом руководстве перед развертыванием службы "Синхронизация файлов Azure" необходимо сделать следующее:

- Создать учетную запись хранения Azure и общую папку.
- Настроить виртуальную машину Windows Server 2016 Datacenter.
- Подготовить виртуальную машину Windows Server к работе со службой "Синхронизация файлов Azure".

### <a name="create-a-folder-and-txt-file"></a>Создание папки и TXT-файла

На локальном компьютере создайте папку с именем _FilesToSync_ и добавьте текстовый файл с именем _mytestdoc.txt_. Вы отправите этот файл в общую папку позже в рамках этого руководства.

### <a name="create-a-storage-account"></a>Создание учетной записи хранения

[!INCLUDE [storage-create-account-portal-include](../../../includes/storage-create-account-portal-include.md)]

### <a name="create-a-file-share"></a>Создание общей папки

После развертывания учетной записи хранения Azure создайте общую папку.

1. На портале Azure выберите **Перейти к ресурсу**.
1. Выберите **Файлы** из области учетной записи хранения.

    ![Выбор плитки "Файлы"](./media/storage-sync-files-extend-servers/click-files.png)

1. Выберите **+ Общая папка**.

    ![Нажмите кнопку добавления общей папки](./media/storage-sync-files-extend-servers/create-file-share-portal2.png)

1. Назовите новую общую папку _afsfileshare_. В поле **Квота** введите 1, а затем нажмите кнопку **Создать**. Размер квоты не может превышать 5 ТиБ, однако в рамках этого руководства достаточно 1 ГБ.

    ![Указание имени и квоты для нового общего файлового ресурса](./media/storage-sync-files-extend-servers/create-file-share-portal3.png)

1. Выберите новую общую папку. В расположении общей папки выберите **Отправить**.

    ![Отправка файла](./media/storage-sync-files-extend-servers/create-file-share-portal5.png)

1. Перейдите к папке _FilesToSync_, где вы создали TXT-файл, выберите _mytestdoc.txt_ и щелкните **Отправить**.

    ![Обзор общего файлового ресурса](./media/storage-sync-files-extend-servers/create-file-share-portal6.png)

На этом этапе вы создали учетную запись хранения и общую папку с одним файлом. Теперь разверните виртуальную машину Azure с Windows Server 2016 Datacenter, чтобы представить в этом руководстве локальный сервер.

### <a name="deploy-a-vm-and-attach-a-data-disk"></a>Развертывание виртуальной машины и подключение диска данных

1. Перейдите на портал Azure и разверните меню слева. Выберите **Создать ресурс** в верхнем левом углу окна.
1. В поле поиска над списком ресурсов **Azure Marketplace** найдите **Windows Server 2016 Datacenter**, а затем выберите его в результатах. Выберите **Создать**.
1. Перейдите на вкладку **Основы**. В разделе **Сведения о проекте** выберите группу ресурсов, созданную для этого руководства.

   ![Ввод основных сведений о виртуальной машине в колонке портала](./media/storage-sync-files-extend-servers/vm-resource-group-and-subscription.png)

1. В разделе **Сведения об экземпляре** введите имя виртуальной машины. Например, используйте _myVM_.
1. Не изменяйте значения по умолчанию для **региона**, **параметров доступности**, **образа** и **размера**.
1. В разделе **Учетная запись администратора** введите **имя пользователя** и **пароль** для виртуальной машины.
1. В разделе **Правила входящего порта** щелкните **Разрешить выбранные порты**, а затем выберите **RDP (3389)** и **HTTP** из раскрывающегося меню.

1. Перед созданием виртуальной машины необходимо создать диск данных.

   1. Выберите **Next:Disks** (Далее: диски).

      ![Добавление дисков данных](./media/storage-sync-files-extend-servers/vm-add-data-disk.png)

   1. В разделе **Диски** в списке **Disk options** (Параметры диска) оставьте значения по умолчанию.
   1. В разделе **Диски данных** выберите **Create and attach a new disk** (Создать и подключить новый диск).

   1. Используйте параметры по умолчанию, за исключением параметра **Размер диска (ГиБ)** . Измените его значение на **1 ГБ** для этого руководства.

      ![Сведения о диске данных](./media/storage-sync-files-extend-servers/vm-create-new-disk-details.png)

   1. Щелкните **ОК**.
1. Выберите **Review + create** (Просмотреть и создать).
1. Нажмите кнопку **создания**.

   Щелкните значок **Уведомления**, чтобы просмотреть **ход выполнения развертывания**. Создание виртуальной машины может занять несколько минут.

1. После развертывания виртуальной машины выберите **Перейти к ресурсу**.

   ![Переход к ресурсу](./media/storage-sync-files-extend-servers/vm-gotoresource.png)

На этом этапе вы создали виртуальную машину и подключили диск данных. Подключитесь к виртуальной машине.

### <a name="connect-to-your-vm"></a>Подключение к виртуальной машине

1. На портале Azure на странице свойств виртуальной машины выберите **Подключиться**.

   ![Подключение к виртуальной машине Azure с портала](./media/storage-sync-files-extend-servers/connect-vm.png)

1. На странице **Подключение к виртуальной машине** сохраните значения по умолчанию, чтобы использовать подключение по **IP-адресу** через порт 3389. Щелкните **Скачать RDP-файл**.

   ![Скачивание RDP-файла](./media/storage-sync-files-extend-servers/download-rdp.png)

1. Откройте скачанный RDP-файл и при появлении запроса щелкните **Подключиться**.
1. В окне **Безопасность Windows** выберите **Варианты выбора** и нажмите **Использовать другую учетную запись**. Введите имя пользователя в формате *localhost\имя_пользователя*, а затем введите созданный для этой виртуальной машины пароль и нажмите кнопку **ОК**.

   ![Дополнительные варианты](./media/storage-sync-files-extend-servers/local-host2.png)

1. При входе в систему может появиться предупреждение о сертификате. Выберите **Да** или **Продолжить**, чтобы создать подключение.

### <a name="prepare-the-windows-server"></a>Подготовка Windows Server

Для сервера Windows Server 2016 отключите конфигурацию усиленной безопасности Internet Explorer. Этот шаг необходим только при начальной регистрации на сервере. Конфигурацию можно включить повторно после регистрации сервера.

На виртуальной машине Windows Server 2016 Datacenter диспетчер сервера откроется автоматически.  Если диспетчер сервера не открывается по умолчанию, найдите его в меню "Пуск".

1. В **диспетчере сервера** выберите **Локальный сервер**.

   ![Элемент "Локальный сервер" в левой части пользовательского интерфейса диспетчера сервера](media/storage-sync-files-extend-servers/prepare-server-disable-ieesc-1.png)

1. Перейдите по ссылке **Конфигурация усиленной безопасности Internet Explorer** на панели **Свойства**.  

    ![Панель "Конфигурация усиленной безопасности Internet Explorer" в пользовательском интерфейсе диспетчера сервера](media/storage-sync-files-extend-servers/prepare-server-disable-ieesc-2.png)

1. В диалоговом окне **Конфигурация усиленной безопасности Internet Explorer** установите переключатель **Выкл.** в разделе **Администраторы** и **Пользователи**.

    ![Всплывающее окно "Конфигурация усиленной безопасности Internet Explorer" с установленным переключателем "Выкл."](media/storage-sync-files-extend-servers/prepare-server-disable-ieesc-3.png)

Теперь вы можете добавить диск данных к виртуальной машине.

### <a name="add-the-data-disk"></a>Добавление диска данных

1. На виртуальной машине **Windows Server 2016 Datacenter** выберите **Files and storage services** (Файловые службы и службы хранилища) > **Тома** > **Диски**.

    ![Диск данных](media/storage-sync-files-extend-servers/your-disk.png)

1. Щелкните правой кнопкой мыши диск размером 1 ГБ с именем **Msft Virtual Disk** и выберите **Новый том**.
1. Завершите работу мастера. Используйте параметры по умолчанию и запишите назначенную букву диска.
1. Нажмите кнопку **создания**.
1. Выберите **Закрыть**.

   На этом этапе вы ввели диск в интерактивный режим и создали том. Откройте проводник на виртуальной машине Windows Server, чтобы убедиться в наличии недавно добавленного диска данных.

1. На виртуальной машине в проводнике разверните узел **Этот компьютер** и откройте новый диск. В этом примере это диск F.
1. Щелкните службу правой кнопкой мыши и выберите **Создать** > **Папка**. Назовите папку _FilesToSync_.
1. Откройте папку **FilesToSync**.
1. Щелкните службу правой кнопкой мыши и выберите **Создать** > **Text Document** (Текстовый документ). Назовите текстовый файл _MyTestFile_.

    ![Добавление нового текстового файла](media/storage-sync-files-extend-servers/new-file.png)

1. Закройте **проводник** и **диспетчер сервера**.

### <a name="download-the-azure-powershell-module"></a>Скачивание модуля Azure PowerShell

Затем на виртуальной машине Windows Server 2016 Datacenter установите на сервер модуль Azure PowerShell.

1. На виртуальной машине откройте окно PowerShell с повышенными привилегиями.
1. Выполните следующую команду:

   ```powershell
   Install-Module -Name Az
   ```

   > [!NOTE]
   > Если установленная версия NuGet предшествует версии 2.8.5.201, вам будет предложено скачать и установить последнюю версию NuGet.

   По умолчанию коллекция PowerShell не используется как доверенный репозиторий для PowerShellGet. При первом использовании PSGallery отображается следующее сообщение:

   ```output
   Untrusted repository

   You are installing the modules from an untrusted repository. If you trust this repository, change its InstallationPolicy value by running the Set-PSRepository cmdlet.

   Are you sure you want to install the modules from 'PSGallery'?
   [Y] Yes  [A] Yes to All  [N] No  [L] No to All  [S] Suspend  [?] Help (default is "N"):
   ```

1. Ответьте **Да** или **Да для всех**, чтобы продолжить установку.

Модуль `Az` — это общий модуль для командлетов Azure PowerShell. Во время его установки скачиваются все доступные модули Azure Resource Manager и устанавливаются все соответствующие командлеты.

На этом этапе вы настроили среду для руководства. Теперь все готово к развертыванию службы синхронизации хранилища.

## <a name="deploy-the-service"></a>Развертывание службы

Чтобы развернуть службу "Синхронизация файлов Azure", сначала разместите ресурс **службы синхронизации хранилища** в группе ресурсов выбранной вами подписки. Служба синхронизации хранилища наследует разрешения доступа от подписки и группы ресурсов.

1. На портале Azure выберите **Создать ресурс** и найдите службу **Синхронизация файлов Azure**.
1. В результатах поиска выберите **Синхронизация файлов Azure**.
1. Выберите **Создать**, чтобы открыть вкладку **Развертывание службы синхронизации хранилища**.

   ![Развертывание службы синхронизации хранилища](media/storage-sync-files-extend-servers/afs-info.png)

   В открывшейся области введите следующие сведения:

   | Значение | Описание |
   | ----- | ----- |
   | **имя**; | Уникальное имя (в подписке) для службы синхронизации хранилища.<br><br>Используйте _afssyncservice02_ в этом руководстве. |
   | **Подписка** | Подписка Azure, используемая в этом руководстве. |
   | **Группа ресурсов** | Группа ресурсов, содержащая службу синхронизации хранилища.<br><br>Используйте _afsresgroup101918_ в этом руководстве. |
   | **Расположение** | Восточная часть США |

1. По завершении выберите **Создать**, чтобы развернуть **службу синхронизации хранилища**.
1. Выберите вкладку **Уведомления** и **Перейти к ресурсу**.

## <a name="install-the-agent"></a>Установка агента.

Агент службы синхронизации файлов Azure — это скачиваемый пакет, позволяющий синхронизировать Windows Server с общим файловым ресурсом Azure.

1. На виртуальной машине **Windows Server 2016 Datacenter** откройте **Internet Explorer**.
1. Перейдите к [Центру загрузки Майкрософт](https://go.microsoft.com/fwlink/?linkid=858257). Прокрутите вниз до раздела **Azure File Sync Agent** (Агент службы "Cинхронизация файлов Azure") и выберите **Скачать**.

   ![Скачивание агента синхронизации](media/storage-sync-files-extend-servers/sync-agent-download.png)

1. Установите флажок **StorageSyncAgent_V3_WS2016.EXE** и выберите **Далее**.

   ![Выбор агента](media/storage-sync-files-extend-servers/select-agent.png)

1. Выберите **Разрешить один раз** > **Выполнить** > **Открыть**.
1. Если вы еще не сделали этого, закройте окно PowerShell.
1. Примите значения по умолчанию в **мастере установки агента синхронизации хранилища**.
1. Выберите пункт **Установить**.
1. Нажмите кнопку **Готово**.

Вы развернули службу синхронизации Azure и установили агент на виртуальной машине Windows Server 2016 Datacenter. Теперь вам необходимо зарегистрировать виртуальную машину в службе синхронизации хранилища.

## <a name="register-windows-server"></a>Регистрация Windows Server

При регистрации Windows Server в службе синхронизации хранилища между сервером (или кластером) и службой синхронизации хранилища устанавливаются отношения доверия. Сервер может быть зарегистрирован только в одной службе синхронизации хранилища. Его можно синхронизировать с другими серверами и общими папками Azure, которые связаны с этой службой синхронизации хранилища.

После установки агента службы "Синхронизация файлов Azure" пользовательский интерфейс регистрации сервера запустится автоматически. Если нет, его можно открыть вручную из расположения файла: `C:\Program Files\Azure\StorageSyncAgent\ServerRegistration.exe.`

1. После открытия пользовательского интерфейса регистрации сервера выберите **ОК**.
1. Выберите **Вход**, чтобы приступить к работе.
1. Войдите, используя свои учетные данные Azure, и выберите **Вход**.
1. Введите следующие сведения:

   ![Снимок экрана пользовательского интерфейса регистрации сервера](media/storage-sync-files-extend-servers/signin.png)

   | Значение | Описание |
   | ----- | ----- |
   | **подписка Azure**; | Подписка, содержащая службу синхронизации хранилища в этом руководстве. |
   | **Группа ресурсов** | Группа ресурсов, содержащая службу синхронизации хранилища. Используйте _afsresgroup101918_ в этом руководстве. |
   | **Служба синхронизации хранилища** | Имя службы синхронизации хранилища. Используйте _afssyncservice02_ в этом руководстве. |

1. Для завершения процесса регистрации сервера выберите **Зарегистрировать**.
1. В рамках процесса регистрации будет запрошен дополнительный вход. Войдите и выберите **Далее**.
1. Щелкните **ОК**.

## <a name="create-a-sync-group"></a>Создание группы синхронизации

Группа синхронизации определяет топологию синхронизации для набора файлов. Группа синхронизации должна содержать одну облачную конечную точку, которая представляет собой общую папку Azure. Группа синхронизации также должна содержать одну или несколько конечных точек сервера. Конечная точка сервера представляет собой путь в зарегистрированном сервере. Чтобы создать группу синхронизации:

1. На [портале Azure](https://portal.azure.com/) выберите **+ Группа синхронизации** в службе синхронизации хранилища. Используйте *afssyncservice02* в этом руководстве.

   ![Создание группы синхронизации на портале Azure](media/storage-sync-files-extend-servers/add-sync-group.png)

1. Введите следующую информацию, чтобы создать группу синхронизации с облачной конечной точкой:

   | Значение | Описание |
   | ----- | ----- |
   | **Имя группы синхронизации** | Это имя должно быть уникальным в службе синхронизации хранилища. Вы можете выбрать любое подходящее имя. Используйте *afssyncgroup* в этом руководстве.|
   | **Подписка** | Подписка, в которой развернута служба синхронизации хранилища для этого руководства. |
   | **Учетная запись хранения** | Щелкните **Выберите учетную запись хранения**. В открывшейся области выберите учетную запись хранения, в которой находится общая папка Azure, которую вы создали. Используйте *afsstoracct101918* в этом руководстве. |
   | **Общая папка Azure** | Имя общей папки Azure, которую вы создали. Используйте *afsfileshare* в этом руководстве. |

1. Нажмите кнопку **создания**.

Если выбрать группу синхронизации, вы увидите, что теперь у вас есть одна **облачная конечная точка**.

## <a name="add-a-server-endpoint"></a>Добавление конечной точки сервера

Конечная точка сервера представляет собой конкретное расположение на зарегистрированном сервере. Например, папка на томе сервера. Чтобы добавить конечную точку сервера:

1. Выберите созданную группу синхронизации и щелкните **Добавление конечной точки сервера**.

   ![Добавление новой конечной точки сервера в области группы синхронизации](media/storage-sync-files-extend-servers/add-server-endpoint.png)

1. В открывшейся области **Добавление конечной точки сервера** введите следующие сведения, чтобы создать конечную точку сервера:

   | Значение | Описание |
   | ----- | ----- |
   | **Зарегистрированный сервер** | Имя сервера, который вы создали. Используйте *afsvm101918* в этом руководстве. |
   | **Путь** | Путь к диску на Windows Server, который вы создали. Используйте *f:\filestosync* в этом руководстве. |
   | **Уровни в облаке** | Оставьте отключенным для этого руководства. |
   | **Свободное место на томе** | Оставьте незаполненным для этого руководства. |

1. Нажмите кнопку **создания**.

Теперь ваши файлы будут синхронизироваться по всем общим файловым ресурсам Azure и Windows Server.

![Служба хранилища Azure успешно синхронизирована](media/storage-sync-files-extend-servers/files-synced-in-azurestorage.png)

## <a name="clean-up-resources"></a>Очистка ресурсов

Если вы хотите очистить ресурсы, созданные при работе с этим учебником, сначала удалите конечные точки из службы синхронизации хранилища. Затем отмените регистрацию сервера в службе синхронизации хранилища, удалите группы синхронизации и службу синхронизации.

[!INCLUDE [storage-files-clean-up-portal](../../../includes/storage-files-clean-up-portal.md)]

## <a name="next-steps"></a>Дальнейшие действия

В этом руководстве вы ознакомились с основными шагами, необходимыми для повышения емкости хранилища Windows Server с использованием службы "Синхронизация файлов Azure". Дополнительные сведения о планировании развертывания службы "Синхронизация файлов Azure" см. в статье:

> [!div class="nextstepaction"]
> [Планирование развертывания службы синхронизации файлов Azure](./storage-sync-files-planning.md)
