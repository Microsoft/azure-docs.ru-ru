---
title: Синхронизация файлов Azure перемещений ресурсов и изменений топологии
description: Узнайте, как перемещать ресурсы синхронизации между группами ресурсов, подписками и клиентами Azure Active Directory (AAD).
author: fauhse
ms.service: storage
ms.topic: how-to
ms.date: 3/10/2021
ms.author: fauhse
ms.subservice: files
ms.openlocfilehash: acd5f9263a74d3273dc65522e77d83c90a719311
ms.sourcegitcommit: 4bda786435578ec7d6d94c72ca8642ce47ac628a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/16/2021
ms.locfileid: "103555553"
---
# <a name="move-azure-file-sync-resources-to-a-different-resource-group-subscription-or-aad-tenant"></a>Перемещение ресурсов Синхронизация файлов Azure в другую группу ресурсов, подписку или клиент AAD

В этой статье описывается, как вносить изменения в клиентскую группу ресурсов, подписку или Azure Active Directory (AAD) для облачных ресурсов Синхронизация файлов Azure и учетных записей хранения Azure.

При планировании внесения изменений в Синхронизация файлов Azure облачные ресурсы важно учитывать ресурсы хранилища. Существуют следующие ресурсы:

**Ресурсы Синхронизация файлов Azure (в иерархическом порядке)**

* :::image type="icon" source="media/storage-sync-resource-move/storage-sync-resource-move-storage-sync-service.png" border="false"::: Служба синхронизации хранилища
  * :::image type="icon" source="media/storage-sync-resource-move/storage-sync-resource-move-registered-servers.png" border="false"::: Зарегистрированный сервер
  * :::image type="icon" source="media/storage-sync-resource-move/storage-sync-resource-move-sync-group.png" border="false"::: Группа синхронизации
    * :::image type="icon" source="media/storage-sync-resource-move/storage-sync-resource-move-cloud-endpoint.png" border="false"::: Облачная конечная точка
    * :::image type="icon" source="media/storage-sync-resource-move/storage-sync-resource-move-server-endpoint.png" border="false"::: Конечная точка сервера

В Синхронизация файлов Azure единственным ресурсом, который может перемещаться, является ресурс службы синхронизации хранилища. Все подресурсы привязаны к родительскому элементу и не могут перемещаться в другую службу синхронизации хранилища.

**Ресурсы службы хранилища Azure (в иерархическом порядке)**

* :::image type="icon" source="media/storage-sync-resource-move/storage-sync-resource-move-storage-account.png" border="false"::: Учетная запись хранения
    * :::image type="icon" source="media/storage-sync-resource-move/storage-sync-resource-move-file-share.png" border="false"::: Общая папка

В службе хранилища Azure единственным ресурсом, который может перемещаться, является учетная запись хранения. Файловый ресурс Azure, как и подресурс, не может перемещаться в другую учетную запись хранения.

## <a name="supported-combinations"></a>Поддерживаемые сочетания

При планировании перемещения ресурсов, учетной записи хранения и Синхронизация файлов Azure верхнего уровня ресурс, называемый *службой синхронизации хранилища*, должен учитываться вместе.

Служба синхронизации хранилища и учетные записи хранения, которые синхронизируют общие файловые ресурсы, рекомендуется всегда размещать в одной подписке. Поддерживаются следующие сочетания:

* Служба синхронизации хранилища и учетные записи хранения находятся в **разных группах ресурсов** (один клиент Azure).
* Служба синхронизации хранилища и учетные записи хранения находятся в **разных подписках** (один клиент Azure).

> [!IMPORTANT]
> С помощью различных сочетаний перемещений служба синхронизации хранилища и учетные записи хранения могут находиться в разных подписках, управляемых разными клиентами AAD. Синхронизация даже кажется работающей, но такая конфигурация не поддерживается. Синхронизация может быть прекращена в будущем без возможности возврата в рабочее состояние.

При планировании перемещения ресурсов существуют различные рекомендации по [перемещению в пределах одного клиента AAD](#move-within-the-same-azure-active-directory-tenant) и переходе между [разными клиентами AAD](#move-to-a-new-azure-active-directory-tenant). При перемещении клиентов AAD всегда следует перемещать синхронизацию и ресурсы хранилища вместе.

### <a name="move-within-the-same-azure-active-directory-tenant"></a>Переместить в пределах одного клиента Azure Active Directory

:::row:::
    :::column:::
        :::image type="content" source="media/storage-sync-resource-move/storage-sync-resource-move-small.png" alt-text="Изображение, показывающее портал Azure для ресурса службы синхронизации хранилища с развернутой командой Move. В нем отображаются параметры перемещения группы ресурсов и перемещения подписки." lightbox="media/storage-sync-resource-move/storage-sync-resource-move.png":::
    :::column-end:::
    :::column:::
        Удобный способ перемещения ресурса службы синхронизации хранилища — использование портал Azure. Перейдите к службе синхронизации хранилища, которую необходимо переместить, и выберите **переместить** с панели команд. Те же действия применяются для перемещения учетной записи хранения. Таким образом можно также переместить все ресурсы в группе ресурсов. Перемещение всей группы ресурсов рекомендуется, если у вас есть служба синхронизации хранилища и все учетные записи хранения, используемые в этой группе ресурсов.
    :::column-end:::
:::row-end:::

> [!WARNING]
> При перемещении ресурса учетной записи хранения синхронизация будет немедленно прервана. Для доступа к соответствующим учетным записям хранения в новой подписке необходимо вручную авторизовать синхронизацию. В разделе [Синхронизация файлов Azure авторизации доступа к хранилищу](#azure-file-sync-storage-access-authorization) будут представлены необходимые действия.

### <a name="move-to-a-new-azure-active-directory-tenant"></a>Переход к новому клиенту Azure Active Directory

Отдельные ресурсы, такие как служба синхронизации хранилища или учетные записи хранения, не могут перемещаться по отдельности в другой клиент AAD. Только подписки Azure могут перемещать клиенты AAD. Подумайте о структуре подписки в новом клиенте AAD. Для Синхронизация файлов Azure можно использовать выделенную подписку. 

1. Создайте подписку Azure (или определите существующую) в старом клиенте, который должен перемещаться.
1. [Выполните перемещение подписки в пределах того же клиента AAD](#move-within-the-same-azure-active-directory-tenant) службы синхронизации хранилища и всех связанных учетных записей хранения.
1. Синхронизация будет прервана. Завершите перемещение клиента немедленно или [восстановите возможность синхронизации для доступа к учетным записям хранения, которые были перемещены](#azure-file-sync-storage-access-authorization). Затем можно будет перейти к новому клиенту AAD позже.

Когда все связанные Синхронизация файлов Azure ресурсы секуестередся в собственную подписку, вы можете переместить всю подписку на целевой клиент AAD. С помощью этого [руководством](../../role-based-access-control/transfer-subscription.md) вы можете планировать и выполнять такие перемещения.

> [!WARNING]
> При переносе подписки из одного клиента в другой синхронизация будет немедленно прервана. Для доступа к соответствующим учетным записям хранения в новой подписке необходимо вручную авторизовать синхронизацию. В разделе [Синхронизация файлов Azure авторизации доступа к хранилищу](#azure-file-sync-storage-access-authorization) будут представлены необходимые действия.

:::row:::
    :::column:::
        :::image type="content" source="media/storage-sync-resource-move/storage-sync-resource-move-aad-tenant.png" alt-text="Рисунок, отображающий колонку &quot;портал Azure&quot;, &quot;Обзор подписки&quot;, выделит команду &quot;изменить каталог&quot; в центре, в верхней части страницы." lightbox="media/storage-sync-resource-move/storage-sync-resource-move-aad-tenant-expanded.png":::
    :::column-end:::
    :::column:::
        Вы готовы начать миграцию, если у вас есть план и необходимые разрешения:
        1. В портал Azure перейдите к своей подписке, колонке **Обзор** .
        1. Выберите **Изменить каталог**.
        1. Следуйте указаниям мастера, чтобы назначить новый клиент AAD.
    :::column-end:::
:::row-end:::

## <a name="azure-file-sync-storage-access-authorization"></a>Синхронизация файлов Azure авторизации доступа к хранилищу

Если учетные записи хранения перемещаются в новую подписку или перемещаются в рамках подписки на новый клиент Azure Active Directory (AAD), синхронизация будет прервана. Доступ на основе ролей (RBAC) используется для авторизации Синхронизация файлов Azure доступа к учетной записи хранения, и эти назначения ролей не переносятся вместе с ресурсами.

### <a name="azure-file-sync-service-principal"></a>Субъект-служба Синхронизация файлов Azure

:::row:::
    :::column:::
        :::image type="content" source="media/storage-sync-resource-move/storage-sync-resource-move-afs-rp-registered-small.png" alt-text="Изображение, показывающее портал Azure, Управление подписками, зарегистрированные поставщики ресурсов." lightbox="media/storage-sync-resource-move/storage-sync-resource-move-afs-rp-registered.png":::
    :::column-end:::
    :::column:::
        Субъект-служба Синхронизация файлов Azure должна существовать в клиенте AAD, прежде чем можно будет авторизовать доступ синхронизации к учетной записи хранения. </br></br> При создании подписки Azure сейчас поставщик ресурсов Синхронизация файлов Azure *Microsoft. StorageSync* автоматически регистрируется в вашей подписке. Регистрация поставщика ресурсов сделает субъект- *службу* для синхронизации доступным в Azure Active Directory клиенте, который управляет подпиской. Субъект-служба аналогичен учетной записи пользователя в AAD. Субъект-службу Синхронизация файлов Azure можно использовать для авторизации доступа к ресурсам с помощью управления доступом на основе ролей (RBAC). Доступ к единственной синхронизации ресурсов требуется только в том случае, если учетные записи хранения содержат общие файловые ресурсы, которые должны синхронизироваться. *Microsoft. StorageSync* должен быть назначен встроенному **средству чтения ролей и доступу к данным** в учетной записи хранения. </br></br> Это назначение выполняется автоматически с помощью контекста пользователя вошедшего в систему пользователя при добавлении общей папки в группу синхронизации или иными словами, при создании облачной конечной точки. Когда учетная запись хранения перемещается в новую подписку или клиент AAD, это назначение роли теряется и его [необходимо повторно установить вручную](#establish-sync-access-to-a-storage-account).
    :::column-end:::
:::row-end:::

> [!IMPORTANT]
> Если целевая подписка Azure не была создана недавно, убедитесь, что поставщик ресурсов *Microsoft. StorageSync* зарегистрирован в подписке. Если это не так, добавьте его вручную в ту же колонку портала.

### <a name="establish-sync-access-to-a-storage-account"></a>Установка доступа синхронизации к учетной записи хранения

[Субъект-служба Синхронизация файлов Azure](#azure-file-sync-service-principal) должна использоваться для авторизации доступа к учетной записи хранения через Управление доступом на основе РОЛЕЙ (RBAC). *Microsoft. StorageSync* должен быть назначен встроенному **средству чтения ролей и доступу к данным** в учетной записи хранения. 

Это назначение обычно выполняется автоматически с помощью контекста пользователя вошедшего в систему пользователя при добавлении общей папки в группу синхронизации или иными словами, при создании облачной конечной точки. Однако при перемещении учетной записи хранения в новую подписку или клиент AAD это назначение роли будет утрачено и его необходимо будет установить вручную.

:::row:::
    :::column:::
        :::image type="content" source="media/storage-sync-resource-move/storage-sync-resource-move-assign-rbac.png" alt-text="Изображение, в котором отображается субъект-служба Microsoft. StorageSync, назначенный модулю чтения и роли доступа к данным в учетной записи хранения.":::
    :::column-end:::
    :::column:::
        В портал Azure перейдите к учетной записи хранения, которую необходимо повторно авторизовать при доступе к синхронизации. <ol><li>Выберите **Управление доступом (IAM)** в оглавлении слева.</li><li>Перейдите на вкладку назначения ролей, чтобы отобразить список пользователей и приложений (субъектов-служб), имеющих доступ к вашей учетной записи хранения.</li><li>Выберите **Добавить**.</li><li>В **поле роль** выберите **читатель и доступ к данным**.</li><li>В **поле Выбор** введите *Microsoft. StorageSync*, выберите роль и нажмите кнопку **сохранить**.</li></ol>
    :::column-end:::
:::row-end:::

## <a name="move-to-a-different-azure-region"></a>Переместить в другой регион Azure

*Служба синхронизации хранилища* синхронизация файлов Azureных ресурсов и учетные записи хранения, содержащие синхронизированные файловые ресурсы, имеют регион Azure, в котором они развернуты. Этот регион определяется при создании ресурса. Регион хранения службы синхронизации хранилища и ресурсов учетной записи хранения должен совпадать. Эти регионы нельзя изменить по одному из типов ресурсов после их создания.

Назначение другого региона ресурсу отличается от [отработки отказа региона](#region-fail-over), который может поддерживаться в зависимости от настройки избыточности учетной записи хранения.

## <a name="region-fail-over"></a>Отработка отказа региона

Служба [хранилища Azure предлагает геоизбыточность](../common/storage-redundancy.md#geo-redundant-storage) для учетной записи хранения. Эти параметры избыточности могут представлять проблемы с учетными записями хранения, используемыми с Синхронизация файлов Azure. Основная причина заключается в том, что репликация между географически отдаленными регионами не выполняется Синхронизация файлов Azure, а с помощью технологии репликации хранилища, встроенной в подсистему хранения в Azure. Он не имеет представления о состоянии приложения, а Синхронизация файлов Azure — это приложение с файлами, которые синхронизируются с файловыми ресурсами Azure и из них в любой момент. Если вы хотите использовать любой из этих географических распределенными параметров избыточности хранилища, вы не сможете потерять все данные в крупномасштабной аварии. Однако необходимо [предусмотреть возможность потери данных](../common/storage-disaster-recovery-guidance.md#anticipate-data-loss).

> [!CAUTION]
> Отработка отказа никогда не является подходящим подстановкой для подготовки ресурсов в правильном регионе Azure. Если ресурсы находятся в "неверном" регионе, необходимо остановить синхронизацию и снова настроить синхронизацию для новых файловых ресурсов Azure, развернутых в нужном регионе.

Региональная отработка отказа может быть запущена корпорацией Майкрософт в случае катастрофического события, которое будет отображать центры обработки данных в регионе Azure недееспособным в течение продолжительного периода времени. Определение времени простоя, которое может поддерживать ваш бизнес, может быть меньше, чем время, подготовленное корпорацией Майкрософт, чтобы пройти перед началом региональной отработки отказа. В такой ситуации [клиенты могут инициировать отработку отказа](../common/storage-initiate-account-failover.md).

> [!IMPORTANT]
> В случае отработки отказа необходимо отправить запрос в службу поддержки для синхронизации затронутых служб синхронизации хранилища для повторной работы.

## <a name="see-also"></a>См. также раздел

- [Обзор руководств по миграции общей папки Azure и синхронизации](storage-files-migration-overview.md)
- [Устранение неполадок службы "Синхронизация файлов Azure"](storage-sync-files-troubleshoot.md)
- [Планирование развертывания службы синхронизации файлов Azure](storage-sync-files-planning.md)
