---
title: 'Взаимодействие в Azure: анализ плоскости данных'
description: В этой статье описывается анализ плоскости данных для тестовой конфигурации, с помощью которой можно выполнять анализ взаимодействия между ExpressRoute, VPN типа "сеть — сеть" и пирингом виртуальных сетей в Azure.
documentationcenter: na
services: networking
author: rambk
manager: tracsman
ms.service: virtual-network
ms.topic: article
ms.workload: infrastructure-services
ms.date: 10/18/2018
ms.author: rambala
ms.openlocfilehash: 4797fca5b4a756ca502147172e6f1590b9eacbe4
ms.sourcegitcommit: c7153bb48ce003a158e83a1174e1ee7e4b1a5461
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/15/2021
ms.locfileid: "98234177"
---
# <a name="interoperability-in-azure--data-plane-analysis"></a>Взаимодействие в Azure: анализ плоскости данных

В этой статье описывается анализ плоскости данных для [тестовой конфигурации][Setup]. Вы также можете просмотреть [параметры тестовой конфигурации][Configuration] и ее [анализ на уровне управления][Control-Analysis].

В анализе плоскости данных рассматривается путь пакетов, проходящих из одной локальной или виртуальной сети в другую сеть в рамках той же топологии. Путь данных между двумя локальными сетями не обязательно будет симметричным. Соответственно, в этой статье мы отдельно проанализируем путь переадресации из локальной сети в другую сеть, а также обратный путь.

## <a name="data-path-from-the-hub-vnet"></a>Путь данных из центральной виртуальной сети

### <a name="path-to-the-spoke-vnet"></a>Путь к периферийной виртуальной сети

Пиринг виртуальных сетей эмулирует функциональные возможности сетевого моста между двумя виртуальными сетями, для которых настроен этот пиринг. Ниже представлена трассировка маршрута пакетов из центральной виртуальной сети на виртуальную машину в периферийной виртуальной сети.

```console
C:\Users\rb>tracert 10.11.30.4

Tracing route to 10.11.30.4 over a maximum of 30 hops

  1     2 ms     1 ms     1 ms  10.11.30.4

Trace complete.
```

На приведенном ниже рисунке показано графическое представление связи между центральной виртуальной сетью и периферийной виртуальной сетью с точки зрения Наблюдателя за сетями Azure.


![1][1]

### <a name="path-to-the-branch-vnet"></a>Путь к виртуальной сети филиала

Ниже представлена трассировка маршрута пакетов из центральной виртуальной сети на виртуальную машину в виртуальной сети филиала.

```console
C:\Users\rb>tracert 10.11.30.68

Tracing route to 10.11.30.68 over a maximum of 30 hops

  1     1 ms     1 ms     1 ms  10.10.30.142
  2     *        *        *     Request timed out.
  3     2 ms     2 ms     2 ms  10.11.30.68

Trace complete.
```

В этом маршруте трассировки первым прыжком является VPN-шлюз Azure центральной виртуальной сети. Второй прыжок — VPN-шлюз виртуальной сети филиала. IP-адрес VPN-шлюза виртуальной сети филиала не объявляется в центральной виртуальной сети. Третий прыжок — виртуальная машина в виртуальной сети филиала.

На приведенном ниже рисунке показано графическое представление связи между виртуальной сетью филиала и центральной виртуальной сетью с точки зрения Наблюдателя за сетями.

![2][2]

На приведенном ниже рисунке показано представление сетки в Наблюдателе за сетями для одного подключения.

![3][3]

### <a name="path-to-on-premises-location-1"></a>Путь к локальному расположению 1

Ниже представлена трассировка маршрута пакетов из центральной виртуальной сети на виртуальную машину в локальном расположении 1.

```console
C:\Users\rb>tracert 10.2.30.10

Tracing route to 10.2.30.10 over a maximum of 30 hops

  1     2 ms     2 ms     2 ms  10.10.30.132
  2     *        *        *     Request timed out.
  3     *        *        *     Request timed out.
  4     2 ms     2 ms     2 ms  10.2.30.10

Trace complete.
```

В этом маршруте трассировки первый прыжок — это конечная точка туннеля шлюза Azure ExpressRoute от корпоративного пограничного маршрутизатора Майкрософт (MSEE). Вторым и третьим прыжками являются IP-адреса локальной сети для маршрутизатора периметра клиента (CE) и локального расположения 1. Эти IP-адреса не объявляются в центральной виртуальной сети. Четвертый прыжок — виртуальная машина в локальном расположении 1.


### <a name="path-to-on-premises-location-2"></a>Путь к локальному расположению 2

Ниже представлена трассировка маршрута пакетов из центральной виртуальной сети на виртуальную машину в локальном расположении 2.

```console
C:\Users\rb>tracert 10.1.31.10

Tracing route to 10.1.31.10 over a maximum of 30 hops

  1    76 ms    75 ms    75 ms  10.10.30.134
  2     *        *        *     Request timed out.
  3     *        *        *     Request timed out.
  4    75 ms    75 ms    75 ms  10.1.31.10

Trace complete.
```

В этом маршруте трассировки в качестве первого прыжка указана конечная точка туннеля от шлюза ExpressRoute до MSEE. Вторым и третьим прыжками являются IP-адреса локальной сети для маршрутизатора CE и локального расположения 2. Эти IP-адреса не объявляются в центральной виртуальной сети. Четвертый прыжок — виртуальная машина в локальном расположении 2.

### <a name="path-to-the-remote-vnet"></a>Путь к удаленной виртуальной сети

Ниже представлена трассировка маршрута пакетов из центральной виртуальной сети на виртуальную машину в удаленной виртуальной сети.

```console
C:\Users\rb>tracert 10.17.30.4

Tracing route to 10.17.30.4 over a maximum of 30 hops

  1     2 ms     2 ms     2 ms  10.10.30.132
  2     *        *        *     Request timed out.
  3    69 ms    68 ms    69 ms  10.17.30.4

Trace complete.
```

В этом маршруте трассировки в качестве первого прыжка указана конечная точка туннеля от шлюза ExpressRoute до MSEE. Вторым прыжком является IP-адрес шлюза удаленной виртуальной сети. Диапазон IP-адресов, в который входит адрес второго прыжка, не объявляется в центральной виртуальной сети. Третий прыжок — виртуальная машина в удаленной виртуальной сети.

## <a name="data-path-from-the-spoke-vnet"></a>Путь данных из периферийной виртуальной сети

Представление периферийной виртуальной сети будет таким же, как и для центральной виртуальной сети. Периферийная виртуальная сеть через пиринг виртуальных сетей использует подключение к удаленному шлюзу центральной виртуальной сети, как если бы он был напрямую подключен к периферийной виртуальной сети.

### <a name="path-to-the-hub-vnet"></a>Путь к центральной виртуальной сети

Ниже представлена трассировка маршрута пакетов из периферийной виртуальной сети на виртуальную машину в центральной виртуальной сети.

```console
C:\Users\rb>tracert 10.10.30.4

Tracing route to 10.10.30.4 over a maximum of 30 hops

  1    <1 ms    <1 ms    <1 ms  10.10.30.4

Trace complete.
```

### <a name="path-to-the-branch-vnet"></a>Путь к виртуальной сети филиала

Ниже представлена трассировка маршрута пакетов из периферийной виртуальной сети на виртуальную машину в виртуальной сети филиала.

```console
C:\Users\rb>tracert 10.11.30.68

Tracing route to 10.11.30.68 over a maximum of 30 hops

  1     1 ms    <1 ms    <1 ms  10.10.30.142
  2     *        *        *     Request timed out.
  3     3 ms     2 ms     2 ms  10.11.30.68

Trace complete.
```

В этом маршруте трассировки первым прыжком является VPN-шлюз центральной виртуальной сети. Второй прыжок — VPN-шлюз виртуальной сети филиала. IP-адрес VPN-шлюза виртуальной сети филиала не объявляется в центральной или периферийной виртуальной сети. Третий прыжок — виртуальная машина в виртуальной сети филиала.

### <a name="path-to-on-premises-location-1"></a>Путь к локальному расположению 1

Ниже представлена трассировка маршрута пакетов из периферийной виртуальной сети на виртуальную машину в локальном расположении 1.

```console
C:\Users\rb>tracert 10.2.30.10

Tracing route to 10.2.30.10 over a maximum of 30 hops

  1    24 ms     2 ms     3 ms  10.10.30.132
  2     *        *        *     Request timed out.
  3     *        *        *     Request timed out.
  4     3 ms     2 ms     2 ms  10.2.30.10

Trace complete.
```

В этом Traceroute первый прыжок является конечной точкой туннеля шлюза ExpressRoute виртуальной сети концентратора к MSEE. Вторым и третьим прыжками являются IP-адреса локальной сети для маршрутизатора CE и локального расположения 1. Эти IP-адреса не объявляются в центральной или периферийной виртуальной сети. Четвертый прыжок — виртуальная машина в локальном расположении 1.

### <a name="path-to-on-premises-location-2"></a>Путь к локальному расположению 2

Ниже представлена трассировка маршрута пакетов из периферийной виртуальной сети на виртуальную машину в локальном расположении 2.

```console
C:\Users\rb>tracert 10.1.31.10

Tracing route to 10.1.31.10 over a maximum of 30 hops

  1    76 ms    75 ms    76 ms  10.10.30.134
  2     *        *        *     Request timed out.
  3     *        *        *     Request timed out.
  4    75 ms    75 ms    75 ms  10.1.31.10

Trace complete.
```

В этом Traceroute первый прыжок является конечной точкой туннеля шлюза ExpressRoute виртуальной сети концентратора к MSEE. Вторым и третьим прыжками являются IP-адреса локальной сети для маршрутизатора CE и локального расположения 2. Эти IP-адреса не объявляются в центральной или периферийной виртуальных сетях. Четвертый прыжок — виртуальная машина в локальном расположении 2.

### <a name="path-to-the-remote-vnet"></a>Путь к удаленной виртуальной сети

Ниже представлена трассировка маршрута пакетов из периферийной виртуальной сети на виртуальную машину в удаленной виртуальной сети.

```console
C:\Users\rb>tracert 10.17.30.4

Tracing route to 10.17.30.4 over a maximum of 30 hops

  1     2 ms     1 ms     1 ms  10.10.30.133
  2     *        *        *     Request timed out.
  3    71 ms    70 ms    70 ms  10.17.30.4

Trace complete.
```

В этом Traceroute первый прыжок является конечной точкой туннеля шлюза ExpressRoute виртуальной сети концентратора к MSEE. Вторым прыжком является IP-адрес шлюза удаленной виртуальной сети. Диапазон IP-адресов, в который входит адрес второго прыжка, не объявляется в центральной или периферийной виртуальной сети. Третий прыжок — виртуальная машина в удаленной виртуальной сети.

## <a name="data-path-from-the-branch-vnet"></a>Путь данных из виртуальной сети филиала

### <a name="path-to-the-hub-vnet"></a>Путь к центральной виртуальной сети

Ниже представлена трассировка маршрута пакетов из виртуальной сети филиала на виртуальную машину в центральной виртуальной сети.

```console
C:\Windows\system32>tracert 10.10.30.4

Tracing route to 10.10.30.4 over a maximum of 30 hops

  1    <1 ms    <1 ms    <1 ms  10.11.30.100
  2     *        *        *     Request timed out.
  3     4 ms     3 ms     3 ms  10.10.30.4

Trace complete.
```

В этом маршруте трассировки первым прыжком является VPN-шлюз виртуальной сети филиала. Второй прыжок — VPN-шлюз центральной виртуальной сети. IP-адрес VPN-шлюза центральной виртуальной сети не объявляется в удаленной виртуальной сети. Третий прыжок — виртуальная машина в центральной виртуальной сети.

### <a name="path-to-the-spoke-vnet"></a>Путь к периферийной виртуальной сети

Ниже представлена трассировка маршрута пакетов из виртуальной сети филиала на виртуальную машину в периферийной виртуальной сети.

```console
C:\Users\rb>tracert 10.11.30.4

Tracing route to 10.11.30.4 over a maximum of 30 hops

  1     1 ms    <1 ms     1 ms  10.11.30.100
  2     *        *        *     Request timed out.
  3     4 ms     3 ms     2 ms  10.11.30.4

Trace complete.
```

В этом маршруте трассировки первым прыжком является VPN-шлюз виртуальной сети филиала. Второй прыжок — VPN-шлюз центральной виртуальной сети. IP-адрес VPN-шлюза центральной виртуальной сети не объявляется в удаленной виртуальной сети. Третий прыжок — виртуальная машина в периферийной виртуальной сети.

### <a name="path-to-on-premises-location-1"></a>Путь к локальному расположению 1

Ниже представлена трассировка маршрута пакетов из виртуальной сети филиала на виртуальную машину в локальном расположении 1.

```console
C:\Users\rb>tracert 10.2.30.10

Tracing route to 10.2.30.10 over a maximum of 30 hops

  1     1 ms    <1 ms    <1 ms  10.11.30.100
  2     *        *        *     Request timed out.
  3     3 ms     2 ms     2 ms  10.2.30.125
  4     *        *        *     Request timed out.
  5     3 ms     3 ms     3 ms  10.2.30.10

Trace complete.
```

В этом маршруте трассировки первым прыжком является VPN-шлюз виртуальной сети филиала. Второй прыжок — VPN-шлюз центральной виртуальной сети. IP-адрес VPN-шлюза центральной виртуальной сети не объявляется в удаленной виртуальной сети. Третий прыжок — точка завершения туннеля VPN на основном маршрутизаторе CE. Четвертый прыжок — это внутренний IP-адрес локального расположения 1. Этот IP-адрес локальной сети не объявляется за пределами маршрутизатора CE. Пятый прыжок — это целевая виртуальная машина в локальном расположении 1.

### <a name="path-to-on-premises-location-2-and-the-remote-vnet"></a>Путь к локальному расположению 2 и удаленной виртуальной сети

Как уже говорилось в анализе плоскости управления, виртуальная сеть филиала в этой сетевой конфигурации не имеет доступа к локальному расположению 2 или к удаленной виртуальной сети. Результаты следующей команды проверки связи подтверждают это: 

```console
C:\Users\rb>ping 10.1.31.10

Pinging 10.1.31.10 with 32 bytes of data:

Request timed out.
...
Request timed out.

Ping statistics for 10.1.31.10:
    Packets: Sent = 4, Received = 0, Lost = 4 (100% loss),

C:\Users\rb>ping 10.17.30.4

Pinging 10.17.30.4 with 32 bytes of data:

Request timed out.
...
Request timed out.

Ping statistics for 10.17.30.4:
    Packets: Sent = 4, Received = 0, Lost = 4 (100% loss),
```

## <a name="data-path-from-on-premises-location-1"></a>Путь данных из локального расположения 1

### <a name="path-to-the-hub-vnet"></a>Путь к центральной виртуальной сети

Ниже представлена трассировка маршрута пакетов из локального расположения 1 на виртуальную машину в центральной виртуальной сети.

```console
C:\Users\rb>tracert 10.10.30.4

Tracing route to 10.10.30.4 over a maximum of 30 hops

  1    <1 ms    <1 ms    <1 ms  10.2.30.3
  2    <1 ms    <1 ms    <1 ms  192.168.30.0
  3    <1 ms    <1 ms    <1 ms  192.168.30.18
  4     *        *        *     Request timed out.
  5     2 ms     2 ms     2 ms  10.10.30.4

Trace complete.
```

В этом маршруте трассировки первые два прыжка являются частью локальной сети. Третий прыжок — основной интерфейс MSEE, подключенный к маршрутизатору CE. Четвертый прыжок — шлюз ExpressRoute в центральной виртуальной сети. Диапазон IP-адресов шлюза ExpressRoute центральной виртуальной сети не объявляется в локальной сети. Пятый прыжок — целевая виртуальная машина.

Наблюдатель за сетями предоставляет только представление, ориентированное на Azure. В локальной среде используется Монитор производительности сети Azure. Монитор производительности сети предоставляет агенты, которые можно устанавливать на серверах в сетях за пределами Azure в целях анализа пути данных.

На следующем рисунке показано представление топологии для подключения виртуальной машины из локального расположения 1 к виртуальной машине в центральной сети через ExpressRoute.

![4][4]

Как говорилось ранее, в тестовой конфигурации VPN-подключение типа "сеть — сеть" используется в качестве резервного, а основным служит подключение ExpressRoute между локальным расположением 1 и центральной виртуальной сетью. Чтобы протестировать путь к данным резервного копирования, давайте выберем сбой связи ExpressRoute между основным маршрутизатором в локальной среде и соответствующим MSEE. Чтобы вызвать сбой соединения ExpressRoute, завершите работу интерфейса CE, подключенного к MSEE:

```console
C:\Users\rb>tracert 10.10.30.4

Tracing route to 10.10.30.4 over a maximum of 30 hops

  1    <1 ms    <1 ms    <1 ms  10.2.30.3
  2    <1 ms    <1 ms    <1 ms  192.168.30.0
  3     3 ms     2 ms     3 ms  10.10.30.4

Trace complete.
```

На приведенной ниже рисунке показано представление топологии для подключения виртуальной машины из локального расположения 1 к виртуальной машине в центральной сети через VPN-подключение типа "сеть — сеть" при неработающем подключении ExpressRoute.

![5][5]

### <a name="path-to-the-spoke-vnet"></a>Путь к периферийной виртуальной сети

Ниже представлена трассировка маршрута пакетов из локального расположения 1 на виртуальную машину в периферийной виртуальной сети.

Теперь мы снова включим основное подключение ExpressRoute, чтобы выполнить анализ пути данных к периферийной виртуальной сети.

```console
C:\Users\rb>tracert 10.11.30.4

Tracing route to 10.11.30.4 over a maximum of 30 hops

  1    <1 ms    <1 ms    <1 ms  10.2.30.3
  2    <1 ms    <1 ms    <1 ms  192.168.30.0
  3    <1 ms    <1 ms    <1 ms  192.168.30.18
  4     *        *        *     Request timed out.
  5     3 ms     2 ms     2 ms  10.11.30.4

Trace complete.
```

Для остальной части анализа пути данных будет включено основное подключение ExpressRoute в локальном расположении 1.

### <a name="path-to-the-branch-vnet"></a>Путь к виртуальной сети филиала

Ниже представлена трассировка маршрута пакетов из локального расположения 1 на виртуальную машину в виртуальной сети филиала.

```console
C:\Users\rb>tracert 10.11.30.68

Tracing route to 10.11.30.68 over a maximum of 30 hops

  1    <1 ms    <1 ms    <1 ms  10.2.30.3
  2    <1 ms    <1 ms    <1 ms  192.168.30.0
  3     3 ms     2 ms     2 ms  10.11.30.68

Trace complete.
```

### <a name="path-to-on-premises-location-2"></a>Путь к локальному расположению 2

Как уже говорилось ранее в [анализе плоскости управления][Control-Analysis], локальное расположение 1 в этой сетевой конфигурации не имеет доступа к локальному расположению 2. Результаты следующей команды проверки связи подтверждают это: 

```console
C:\Users\rb>ping 10.1.31.10

Pinging 10.1.31.10 with 32 bytes of data:

Request timed out.
...
Request timed out.

Ping statistics for 10.1.31.10:
    Packets: Sent = 4, Received = 0, Lost = 4 (100% loss),
```

### <a name="path-to-the-remote-vnet"></a>Путь к удаленной виртуальной сети

Ниже представлена трассировка маршрута пакетов из локального расположения 1 на виртуальную машину в удаленной виртуальной сети.

```console
C:\Users\rb>tracert 10.17.30.4

Tracing route to 10.17.30.4 over a maximum of 30 hops

  1    <1 ms    <1 ms    <1 ms  10.2.30.3
  2     2 ms     5 ms     7 ms  192.168.30.0
  3    <1 ms    <1 ms    <1 ms  192.168.30.18
  4     *        *        *     Request timed out.
  5    69 ms    70 ms    69 ms  10.17.30.4

Trace complete.
```

## <a name="data-path-from-on-premises-location-2"></a>Путь данных из локального расположения 2

### <a name="path-to-the-hub-vnet"></a>Путь к центральной виртуальной сети

Ниже представлена трассировка маршрута пакетов из локального расположения 2 на виртуальную машину в центральной виртуальной сети.

```console
C:\Windows\system32>tracert 10.10.30.4

Tracing route to 10.10.30.4 over a maximum of 30 hops

  1    <1 ms    <1 ms    <1 ms  10.1.31.3
  2    <1 ms    <1 ms    <1 ms  192.168.31.4
  3    <1 ms    <1 ms    <1 ms  192.168.31.22
  4     *        *        *     Request timed out.
  5    75 ms    74 ms    74 ms  10.10.30.4

Trace complete.
```

### <a name="path-to-the-spoke-vnet"></a>Путь к периферийной виртуальной сети

Ниже представлена трассировка маршрута пакетов из локального расположения 2 на виртуальную машину в периферийной виртуальной сети.

```console
C:\Windows\system32>tracert 10.11.30.4

Tracing route to 10.11.30.4 over a maximum of 30 hops
  1    <1 ms    <1 ms     1 ms  10.1.31.3
  2    <1 ms    <1 ms    <1 ms  192.168.31.0
  3    <1 ms    <1 ms    <1 ms  192.168.31.18
  4     *        *        *     Request timed out.
  5    75 ms    74 ms    74 ms  10.11.30.4

Trace complete.
```

### <a name="path-to-the-branch-vnet-on-premises-location-1-and-the-remote-vnet"></a>Путь к виртуальной сети филиала, локальному расположению 1 и удаленной виртуальной сети

Как уже говорилось в [анализе плоскости управления][Control-Analysis], локальное расположение 1 в этой сетевой конфигурации не имеет доступа к виртуальной сети филиала, локальному расположению 1 и удаленной виртуальной сети. 

## <a name="data-path-from-the-remote-vnet"></a>Путь данных из удаленной виртуальной сети

### <a name="path-to-the-hub-vnet"></a>Путь к центральной виртуальной сети

Ниже представлена трассировка маршрута пакетов из удаленной виртуальной сети на виртуальную машину в центральной виртуальной сети.

```console
C:\Users\rb>tracert 10.10.30.4

Tracing route to 10.10.30.4 over a maximum of 30 hops

  1    65 ms    65 ms    65 ms  10.17.30.36
  2     *        *        *     Request timed out.
  3    69 ms    68 ms    68 ms  10.10.30.4

Trace complete.
```

### <a name="path-to-the-spoke-vnet"></a>Путь к периферийной виртуальной сети

Ниже представлена трассировка маршрута пакетов из удаленной виртуальной сети на виртуальную машину в периферийной виртуальной сети.

```console
C:\Users\rb>tracert 10.11.30.4

Tracing route to 10.11.30.4 over a maximum of 30 hops

  1    67 ms    67 ms    67 ms  10.17.30.36
  2     *        *        *     Request timed out.
  3    71 ms    69 ms    69 ms  10.11.30.4

Trace complete.
```

### <a name="path-to-the-branch-vnet-and-on-premises-location-2"></a>Путь к виртуальной сети филиала и локальному расположению 2

Как уже говорилось в [анализе плоскости управления][Control-Analysis], удаленная виртуальная сеть в этой сетевой конфигурации не имеет доступа к виртуальной сети филиала или локальному расположению 2. 

### <a name="path-to-on-premises-location-1"></a>Путь к локальному расположению 1

Ниже представлена трассировка маршрута пакетов из удаленной виртуальной сети на виртуальную машину в локальном расположении 1.

```console
C:\Users\rb>tracert 10.2.30.10

Tracing route to 10.2.30.10 over a maximum of 30 hops

  1    67 ms    67 ms    67 ms  10.17.30.36
  2     *        *        *     Request timed out.
  3     *        *        *     Request timed out.
  4    69 ms    69 ms    69 ms  10.2.30.10

Trace complete.
```

## <a name="expressroute-and-site-to-site-vpn-connectivity-in-tandem"></a>Параллельное использование подключений ExpressRoute и VPN типа "сеть — сеть"

###  <a name="site-to-site-vpn-over-expressroute"></a>VPN типа "сеть — сеть" через ExpressRoute

VPN типа "сеть — сеть" можно настроить с использованием пиринга Microsoft ExpressRoute, чтобы организовать закрытый обмен данными между локальной сетью и виртуальными сетями Azure. Такая конфигурация гарантирует конфиденциальность, подлинность и целостность при обмене данными. Обмен данными также защищается от повторов. Дополнительные сведения о настройке VPN IPSec типа "сеть — сеть" в туннельном режиме с использованием пиринга Microsoft ExpressRoute см. [в этой статье][S2S-Over-ExR]. 

Основным ограничением настройки VPN типа "сеть — сеть" с использованием пиринга Майкрософт является пропускная способность. Пропускная способность туннеля IPsec ограничена емкостью VPN-шлюза. Пропускная способность VPN-шлюза всегда ниже пропускной способности ExpressRoute. В такой ситуации можно оптимизировать использование пропускной способности ExpressRoute, используя туннель IPSec для трафика, требующего высокого уровня безопасности, и частный пиринг для всего остального трафика.

### <a name="site-to-site-vpn-as-a-secure-failover-path-for-expressroute"></a>VPN типа "сеть — сеть" в качестве защищенного пути отработки отказа для ExpressRoute

ExpressRoute предоставляется в виде пары каналов, что обеспечивает избыточность и высокий уровень доступности. Вы можете настроить географически избыточное подключение ExpressRoute в разных регионах Azure. Как и в нашей тестовой конфигурации, вы можете создать путь отработки отказа для подключения ExpressRoute в пределах определенного региона Azure с помощью VPN типа "сеть — сеть". Если одни и те же префиксы объявляются через ExpressRoute и VPN типа "сеть — сеть", Azure отдает предпочтение ExpressRoute. Чтобы избежать асимметричной маршрутизации между ExpressRoute и VPN типа "сеть — сеть", в локальной сети следует также настроить конфигурацию ExpressRoute, прежде чем использовать VPN типа "сеть — сеть".

Дополнительные сведения о настройке параллельных подключений ExpressRoute и VPN типа "сеть — сеть" см. в [этой статье][ExR-S2S-CoEx].

## <a name="extend-back-end-connectivity-to-spoke-vnets-and-branch-locations"></a>Предоставление периферийным виртуальным сетям и расположениям филиалов доступа к подключениям серверной части

### <a name="spoke-vnet-connectivity-by-using-vnet-peering"></a>Подключение к периферийной виртуальной сети с использованием пиринга

Звездообразная архитектура виртуальных сетей нашла широкое применение. Центральная виртуальная сеть в Azure выполняет роль центральной точки для подключения между периферийными виртуальными сетями и локальной сетью. Периферийными называются виртуальные сети, которые устанавливают пиринг с центральной сетью и применяются для изоляции рабочих нагрузок. Трафик передается между локальным центром обработки данных и центральной сетью через подключение ExpressRoute и (или) VPN. Дополнительные сведения об этой архитектуре см. в статье [Реализация звездообразной топологии сети в Azure][Hub-n-Spoke].

Пиринг виртуальных сетей в пределах региона позволяет периферийным виртуальным сетям использовать шлюзы центральной виртуальной сети (шлюз VPN или ExpressRoute) для подключения к удаленным сетям.

### <a name="branch-vnet-connectivity-by-using-site-to-site-vpn"></a>Подключение к виртуальной сети филиала с помощью VPN типа "сеть — сеть"

Через центральную виртуальную сеть можно подключить друг к другу виртуальные сети филиалов из разных регионов и локальные сети. Обычно в Azure решением для этой конфигурации является VPN типа "сеть — сеть". Альтернативой может быть использование в центральной сети виртуального сетевого модуля (NVA) для маршрутизации.

Дополнительные сведения см. в статьях [Сведения о VPN-шлюзе][VPN] и [Развертывание высокодоступных виртуальных сетевых модулей][Deploy-NVA].


## <a name="next-steps"></a>Дальнейшие действия

В статье [Вопросы и ответы по ExpressRoute][ExR-FAQ] представлены следующие сведения:
-   количество каналов ExpressRoute, которые можно подключить к шлюзу ExpressRoute;
-   количество шлюзов ExpressRoute, которые можно подключить к каналу ExpressRoute;
-   дополнительные ограничения масштаба для ExpressRoute.


<!--Image References-->
[1]: ./media/backend-interoperability/HubVM-SpkVM.jpg "Наблюдение за сетями Просмотр подключения из виртуальной сети концентратора к периферийной виртуальной сети"
[2]: ./media/backend-interoperability/HubVM-BranchVM.jpg "Наблюдение за сетями Просмотр подключения из виртуальной сети концентратора к виртуальной сети филиала"
[3]: ./media/backend-interoperability/HubVM-BranchVM-Grid.jpg "Представление сетки "наблюдатель за сетями" для подключения из виртуальной сети концентратора к виртуальной сети филиала"
[4]: ./media/backend-interoperability/Loc1-HubVM.jpg "Монитор производительности сети Просмотр подключения виртуальной машины "расположение 1" к виртуальной сети концентратора через ExpressRoute 1"
[5]: ./media/backend-interoperability/Loc1-HubVM-S2S.jpg "Монитор производительности сети Просмотр подключения виртуальной машины "расположение 1" к виртуальной сети концентратора через VPN-подключение типа "сеть — сеть""

<!--Link References-->
[Setup]: ./connectivty-interoperability-preface.md
[Configuration]: ./connectivty-interoperability-configuration.md
[ExpressRoute]: ../expressroute/expressroute-introduction.md
[VPN]: ../vpn-gateway/vpn-gateway-about-vpngateways.md
[VNet]: ../virtual-network/tutorial-connect-virtual-networks-portal.md
[Configuration]: ./connectivty-interoperability-configuration.md
[Control-Analysis]: ./connectivty-interoperability-control-plane.md
[ExR-FAQ]: ../expressroute/expressroute-faqs.md
[S2S-Over-ExR]: ../expressroute/site-to-site-vpn-over-microsoft-peering.md
[ExR-S2S-CoEx]: ../expressroute/expressroute-howto-coexist-resource-manager.md
[Hub-n-Spoke]: /azure/architecture/reference-architectures/hybrid-networking/hub-spoke
[Deploy-NVA]: /azure/architecture/reference-architectures/dmz/nva-ha
[VNet-Config]: ../virtual-network/virtual-network-manage-peering.md
[ExR-FAQ]: ../expressroute/expressroute-faqs.md