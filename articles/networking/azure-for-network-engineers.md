---
title: 'Azure ExpressRoute: для инженеров сети Azure'
description: На этой странице объясняются традиционные сетевые инженеры, как работают сети в Azure.
documentationcenter: na
services: networking
author: osamaz
manager: tracsman
ms.service: virtual-network
ms.topic: article
ms.workload: infrastructure-services
ms.date: 06/25/2020
ms.author: osamaz
ms.openlocfilehash: e13dc868512dba15c5b335c1774aaa540eef8157
ms.sourcegitcommit: aeba98c7b85ad435b631d40cbe1f9419727d5884
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/04/2021
ms.locfileid: "97861410"
---
# <a name="azure-for-network-engineers"></a>Azure для сетевых инженеров
Как обычный сетевой инженер, вы разработали с физическими ресурсами, такими как маршрутизаторы, коммутаторы, кабели, брандмауэры для создания инфраструктуры. На логическом уровне вы настроили виртуальную локальную сеть (VLAN) с протоколом STP, протоколы маршрутизации (RIP, OSPF, BGP). Вы управляете сетью с помощью средств управления и интерфейса командной строки. Сети в облаке отличаются от сетевых конечных точек, и использование протоколов маршрутизации является минимальным. Для настройки ресурсов и управления ими в Azure вы будете работать с Azure Resource Manager API, Azure CLI и PowerShell. Вы начнете свое сетевое взаимодействие в облаке, понимая основные клиенты сетей Azure. 
## <a name="virtual-network"></a>Виртуальная сеть
При проектировании сети снизу вверх необходимо собрать некоторые основные сведения. Эти сведения могут быть числом узлов, сетевых устройств, количеством подсетей, маршрутизацией между подсетями, доменами изоляции, такими как VLAN. Эти сведения помогают в определении размера сети и устройств безопасности, а также при создании архитектуры для поддержки приложений и служб.

При планировании развертывания приложений и служб в Azure вы начнете с создания логической границы в Azure, которая называется виртуальной сетью. Эта виртуальная сеть связана с границей физической сети. Так как это виртуальная сеть, вам не требуется физическое приспособление, но необходимо планировать логические сущности, такие как IP-адреса, IP-подсети, маршрутизацию и политики.

При создании виртуальной сети в Azure ее предварительно настраивается с диапазоном IP-адресов (10.0.0.0/16). Этот диапазон не фиксирован, вы можете определить собственный диапазон IP-адресов. Можно определить диапазоны адресов IPv4 и IPv6. Диапазоны IP-адресов, определенные для виртуальной сети, не объявляются в Интернете. Вы можете создать несколько подсетей из диапазона IP-адресов. Эти подсети будут использоваться для назначения IP-адресов интерфейсам виртуальной сети (vNIC). Первые четыре IP-адреса из каждой подсети зарезервированы и не могут использоваться для выделения IP-адресов. В общедоступном облаке нет концепции виртуальных ЛС. Тем не менее можно создать изоляцию в виртуальной сети на основе определенных подсетей.

Можно создать одну крупную подсеть, охватывающую все адресное пространство виртуальной сети, или создать несколько подсетей. Однако при использовании шлюза виртуальной сети Azure необходимо создать подсеть с именем "подсеть шлюза". Azure будет использовать эту подсеть для назначения IP-адресов шлюзам виртуальной сети. 

## <a name="ip-allocation"></a>Выделение IP-адресов

При назначении IP-адреса узлу вы фактически назначаете IP-адрес сетевому адаптеру. Сетевой карте в Azure можно назначить два типа IP-адресов:

- Общедоступные IP-адреса — используются для обмена входящим и исходящим трафиком (без преобразования сетевых адресов (NAT)) с Интернетом и другими ресурсами Azure, не подключенными к виртуальной сети. Для сетевого интерфейса общедоступные IP-адреса назначать необязательно. Общедоступные IP-адреса относятся к пространству IP-адресов Майкрософт.
- Частные IP-адреса — используются для обмена данными между виртуальной сетью, локальной сетью и Интернетом (с NAT). Пространство IP-адресов, которое вы определили в виртуальной сети, считается частным, даже если вы настроили пространство общедоступного IP-адреса. Корпорация Майкрософт не объявляет это пространство для Интернета. Виртуальная машина должна иметь по крайней мере один частный IP-адрес.

Как и физические узлы или устройства, существует два способа выделения IP-адреса для ресурса — динамический или статический. В Azure метод распределения по умолчанию является динамическим, где IP-адрес выделяется при создании виртуальной машины или при запуске остановленной ВИРТУАЛЬНОЙ машины. Если остановить или удалить виртуальную машину, IP-адрес освобождается. Чтобы IP-адрес виртуальной машины не изменялся, вы можете явным образом задать статический способ выделения. В рамках этого способа IP-адрес назначается немедленно, а освобождается только тогда, когда вы удаляете виртуальную машину или задаете динамический способ выделения. 

Частные IP-адреса выделяются из подсетей, определенных в виртуальной сети. Для виртуальной машины выбирается подсеть для выделения IP-адресов. Если виртуальная машина содержит несколько сетевых карт, для каждой сетевой карты можно выбрать отдельную подсеть.

## <a name="routing"></a>Маршрутизация
При создании виртуальной сети Azure создает таблицу маршрутизации для вашей сети. Эта таблица маршрутизации содержит следующие типы маршрутов.
- системные маршруты.
- Маршруты по умолчанию подсети
- Маршруты из других виртуальных сетей
- маршруты BGP;
- Маршруты конечной точки службы
- Определяемые пользователем маршруты (UDR)

При создании виртуальной сети в первый раз без определения подсетей Azure создает записи маршрутизации в таблице маршрутизации. Эти маршруты называются системными маршрутами. Системные маршруты определены в этом расположении. Эти маршруты изменить нельзя. Однако можно переопределить системные маршруты, настроив определяемые пользователем маршруты.

При создании одной или нескольких подсетей в виртуальной сети Azure создает записи по умолчанию в таблице маршрутизации, чтобы обеспечить взаимодействие между этими подсетями в виртуальной сети. Эти маршруты можно изменить с помощью статических маршрутов, которые являются определяемыми пользователем маршрутами (UDR) в Azure.

При создании пиринга между двумя виртуальными сетями добавляется маршрут для каждого диапазона адресов в адресном пространстве каждой из этих виртуальных сетей.

Если локальный сетевой шлюз обменивается маршрутами протокола пограничного шлюза (BGP) со шлюзом виртуальной сети Azure, маршрут добавляется для каждого маршрута, распространяемого из локального сетевого шлюза. Эти маршруты отображаются в таблице маршрутизации как маршруты BGP.

Когда вы включаете конечные точки службы, Azure добавляет в таблицу маршрутов общедоступные IP-адреса для определенных служб. Конечные точки службы включены для отдельных подсетей в виртуальной сети. При включении конечной точки службы маршрут добавляется только в таблицу маршрутов для подсети, которая принадлежит этой службе. При изменении адресов Azure автоматически управляет ими в таблице маршрутов.

Определяемые пользователем маршруты называются также пользовательскими маршрутами. Вы создаете UDR в Azure для переопределения системных маршрутов Azure по умолчанию или для добавления дополнительных маршрутов в таблицу маршрутов подсети. В Azure вы создадите таблицу маршрутов, а затем свяжете таблицу маршрутов с подсетями виртуальной сети.

При наличии конкурирующих записей в таблице маршрутизации Azure выбирает следующий прыжок на основе наиболее длинного префикса, похожего на традиционные маршрутизаторы. Однако при наличии нескольких записей следующего прыжка с одинаковым префиксом адреса Azure выбирает маршруты в следующем порядке.
1. Определяемые пользователем маршруты (UDR)
1. маршруты BGP;
1. системные маршруты.

## <a name="security"></a>Безопасность

Вы можете фильтровать сетевой трафик между ресурсами в виртуальной сети с помощью групп безопасности сети. Вы также можете использовать сетевые виртуальные устройства (NVA), такие как брандмауэр Azure или брандмауэры от других поставщиков. Кроме того, можно контролировать, как Azure маршрутизирует трафик из подсетей. Вы также можете ограничить количество сотрудников организации, которые могут работать с ресурсами в виртуальных сетях.

Группа безопасности сети содержит перечень правил списка управления доступом (ACL), которые разрешают или запрещают сетевой трафик к подсетям и сетевым интерфейсам (или и к тому, и к другому). Группы безопасности сети можно связать с подсетями или отдельными сетевыми интерфейсами, подключенными к подсети. Если группа безопасности сети связана с подсетью, правила списка управления доступом применяются ко всем виртуальным машинам в этой подсети. Кроме того, трафик к отдельным сетевым интерфейсам можно ограничить, связав группу безопасности сети непосредственно с нужным сетевым интерфейсом.

Группы безопасности сети содержат два набора правил: для входящего и исходящего трафика. Приоритет для правила должен быть уникальным в пределах каждого набора. Каждое правило имеет свойства протокола, диапазоны исходных портов и портов назначения, префиксы адресов, направление трафика, приоритет и тип доступа. Все группы NSG содержат набор правил по умолчанию. Эти правила нельзя удалить, но у них самый низкий приоритет, поэтому их можно переопределить, создав другие правила.

## <a name="verification"></a>Проверка
### <a name="routes-in-virtual-network"></a>Маршруты в виртуальной сети
Созданные вами маршруты, маршруты по умолчанию Azure и все маршруты, распространяемые из локальной сети через VPN-шлюз Azure (если виртуальная сеть подключена к локальной сети) через протокол BGP, являются действующими маршрутами для всех сетевых интерфейсов в подсети. Эти эффективные маршруты можно просмотреть, перейдя по адресу NIC с помощью портала, PowerShell или интерфейса командной строки.
### <a name="network-security-groups"></a>группы сетевой безопасности;
Действующие правила безопасности, применяемые к сетевому интерфейсу, представляют собой комбинацию правил безопасности в группе NSG, присоединенной к сетевому интерфейсу и подсети, в которой он находится. Вы можете просмотреть все действующие правила безопасности из группы безопасности сети, которые применяются к сетевым интерфейсам виртуальной машины, перейдя по сетевой карте с помощью портала, PowerShell или интерфейса командной строки.

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения о [виртуальной сети][VNet].

Сведения о [маршрутизации виртуальных сетей][vnet-routing].

Сведения о [группах безопасности сети][network-security].

<!--Link References-->
[VNet]: https://docs.microsoft.com/azure/virtual-network/tutorial-connect-virtual-networks-portal
[vnet-routing]: https://docs.microsoft.com/azure/virtual-network/virtual-networks-udr-overview
[network-security]: https://docs.microsoft.com/azure/virtual-network/security-overview

