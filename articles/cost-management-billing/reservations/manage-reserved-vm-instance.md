---
title: Управление Azure Reserved Virtual Machine Instances
description: Узнайте, как можно управлять резервированиями Azure. Просмотрите инструкции по изменению области, разделению и оптимизации использования резервирования.
ms.service: cost-management-billing
ms.subservice: reservations
author: bandersmsft
ms.reviewer: yashesvi
ms.topic: how-to
ms.date: 02/09/2021
ms.author: banders
ms.openlocfilehash: 717cf5acb63ee04852ccbb9aae2f7aed2b3c179a
ms.sourcegitcommit: d4734bc680ea221ea80fdea67859d6d32241aefc
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/14/2021
ms.locfileid: "100392278"
---
# <a name="manage-reservations-for-azure-resources"></a>Управление резервированиями для ресурсов Azure

После приобретения резервирования Azure вам может понадобиться применить его к другой подписке, изменить управляющего или область резервирования. Вы также можете разделить резервирование на два, чтобы применить некоторые купленные экземпляры к другой подписке.

Если вы приобрели зарезервированные экземпляры виртуальных машин Azure, можно изменить параметр оптимизации для резервирования. Скидка на резервирование может применяться к виртуальным машинам в одной и той же серии. Кроме того, можно зарезервировать ресурсы центра обработки данных для определенного размера виртуальной машины. Следует попытаться оптимизировать резервирования, чтобы полностью использовать их.

*Разрешение, необходимое для управления резервированием, отличается от разрешения подписки.*

[!INCLUDE [updated-for-az](../../../includes/updated-for-az.md)]

## <a name="reservation-order-and-reservation"></a>Заказ на резервирование и резервирование

При покупке резервирования создаются два объекта: **заказ на резервирование** и **резервирование**.

В момент покупки в заказе на резервирование содержится одно резервирование. При разделении, объединении, частичном возмещении или обмене создаются резервирования в **заказе на резервирование**.

Чтобы просмотреть заказ на резервирование, перейдите в раздел **Резервирования**, выберите резервирование, а затем щелкните **Идентификатор заказа на резервирование**.

![Пример сведений о заказе на резервирование с идентификатором заказа на резервирование ](./media/manage-reserved-vm-instance/reservation-order-details.png)

Резервирование наследует разрешения из заказа на резервирование. Для обмена или возмещения резервирования пользователь должен быть добавлен в заказ на резервирование.

## <a name="change-the-reservation-scope"></a>Изменение области резервирования

 Скидка на резервирование применяется к виртуальным машинам, базам данных SQL, Azure Cosmos DB или другим ресурсам, которые соответствуют вашему резервированию и попадают в его область. Контекст выставления счетов зависит с подписки, использованной для покупки резервирования.

Вот как можно обновить область резервирования.

1. Войдите на [портал Azure](https://portal.azure.com).
2. Выберите **Все службы** > **Резервирование**.
3. Выберите резервирование.
4. Выберите **Параметры** > **Конфигурация**.
5. Изменение область.

Если общую область изменить на отдельную, то можно будет выбрать только подписку, владельцем которой вы являетесь. Можно выбрать только подписки в том же контексте выставления счетов, что и резервирование.

Область применяется только к отдельным подпискам с оплатой по мере использования (подписка MS-AZR-0003P или MS-AZR-0023P), подпискам Enterprise MS-AZR-0017P или MS-AZR-0148P, или подпискам CSP.

## <a name="who-can-manage-a-reservation-by-default"></a>Пользователи, которые по умолчанию могут управлять резервированием

По умолчанию просматривать резервирования и управлять ими могут следующие пользователи:

- В заказ на резервирование добавляется покупатель резервирования и администратор учетной записи в подписке для выставления счетов, которая использовалась для покупки резервирования.
- Администраторы выставления счетов по Соглашению Enterprise и Клиентскому соглашению Майкрософт.

Разрешить другим пользователям управлять резервированиями можно двумя способами.

- Делегировать управление доступом к определенному заказу на резервирование. Для этого:
    1. Войдите на [портал Azure](https://portal.azure.com).
    1. Выберите **Все службы** > **Резервирование**, чтобы отобразить список доступных вам резервирований.
    1. Выберите резервирование, доступ к которому требуется делегировать другим пользователям.
    1. В области "Подробности о резервировании" выберите заказ на резервирование.
    1. Выберите **Управление доступом (IAM)** .
    1. Выберите **Добавить назначение ролей** > **Роль** > **Владелец**. Если вы хотите предоставить ограниченный доступ, выберите другую роль.
    1. Укажите адрес электронной почты пользователя, для которого хотите добавить роль "Владелец".
    1. Выберите пользователя, а затем щелкните **Сохранить**.

- Добавьте пользователя в качестве администратора выставления счетов по Соглашению Enterprise или Клиентскому соглашению Майкрософт:
    - Для варианта с Соглашением Enterprise назначьте пользователям роль _Администратор предприятия_, чтобы они могли просматривать заказы на резервирование, относящиеся к Соглашению Enterprise, и управлять ими. Пользователи с ролью _Администратор предприятия (только чтение)_ могут только просматривать резервирования. Администраторы отделов и владельцы учетных записей смогут просматривать резервирования, _только если_ им явно разрешить это с помощью управления доступом (IAM). Дополнительные сведения см. в статье [Управление ролями в Azure Enterprise](../manage/understand-ea-roles.md).

        _Администраторы предприятия могут становиться владельцами заказа на резервирование и добавлять в него других пользователей с помощью управления доступом (IAM)._
    - В случае с Клиентским соглашением Майкрософт пользователи с ролью владельца или участника профиля выставления счетов могут управлять всеми покупками резервирований, выполненными с помощью профиля выставления счетов. Читатели профиля выставления счетов и менеджеры счетов могут просматривать все резервирования, оплаченные с помощью профиля выставления счетов. Но эти пользователи не могут вносить изменения в резервирования.
    Дополнительные сведения см. в разделе [Роли и задачи профиля выставления счетов](../manage/understand-mca-roles.md#billing-profile-roles-and-tasks).

### <a name="how-billing-administrators-view-or-manage-reservations"></a>Просмотр резервирований и управление ими администраторами выставления счетов

1. В разделе **Управление затратами + выставление счетов** слева выберите **Транзакции резервирования**.
2. Если у вас есть необходимые разрешения на выставление счетов, вы можете просматривать резервирования и управлять ими. Если резервирования не отображаются, убедитесь, что вы вошли с помощью того арендатора Azure AD, в котором были созданы резервирования.

## <a name="split-a-single-reservation-into-two-reservations"></a>Разделение отдельного резервирования на два резервирования

 После приобретения нескольких экземпляров ресурсов в резервировании может потребоваться назначить экземпляры в резервировании разным подпискам. По умолчанию все экземпляры имеют одну область. Это одна подписка, группа ресурсов или общая область. Допустим, вы приобрели резервирование для 10 экземпляров виртуальных машин и указали в качестве области подписку A. Теперь вы хотите оставить семь экземпляров виртуальных машин в подписке A, а три перенести в подписку Б. Это можно сделать, разделив резервирование. После этого исходный идентификатор резервирования отменяется и создаются два новых резервирования. Разделение не влияет на заказ на резервирование — новая транзакция резервирования не выполняется, а новые резервирования имеют ту же дату окончания, что и первоначальное.

 Можно разделить резервирование на два резервирования с помощью PowerShell, интерфейса командной строки или API.

### <a name="split-a-reservation-by-using-powershell"></a>Разделение резервирования с помощью PowerShell

1. Получите идентификатор резервирования, выполнив следующую команду.

    ```powershell
    # Get the reservation orders you have access to
    Get-AzReservationOrder
    ```

2. Получите сведения о резервировании.

    ```powershell
    Get-AzReservation -ReservationOrderId a08160d4-ce6b-4295-bf52-b90a5d4c96a0 -ReservationId b8be062a-fb0a-46c1-808a-5a844714965a
    ```

3. Разделите резервирование на две части и распределите экземпляры.

    ```powershell
    # Split the reservation. The sum of the reservations, the quantity, must equal the total number of instances in the reservation that you're splitting.
    Split-AzReservation -ReservationOrderId a08160d4-ce6b-4295-bf52-b90a5d4c96a0 -ReservationId b8be062a-fb0a-46c1-808a-5a844714965a -Quantity 3,2
    ```
4. Чтобы изменить область, выполните следующую команду.

    ```powershell
    Update-AzReservation -ReservationOrderId a08160d4-ce6b-4295-bf52-b90a5d4c96a0 -ReservationId 5257501b-d3e8-449d-a1ab-4879b1863aca -AppliedScopeType Single -AppliedScope /subscriptions/15bb3be0-76d5-491c-8078-61fe3468d414
    ```

## <a name="cancel-exchange-or-refund-reservations"></a>Отмена, обмен резервирования, возмещение средств за резервирование

Вы можете отменить и обменять резервирования, а также вернуть вложенные в резервирование средства, но при этом применяются определенные ограничения. Дополнительные сведения см. в статье [Self-service exchanges and refunds for Azure Reservations](exchange-and-refund-azure-reservations.md) (Самостоятельное выполнение обмена и возмещения средств для резервирований Azure).

## <a name="change-optimize-setting-for-reserved-vm-instances"></a>Изменение параметра оптимизации для зарезервированных экземпляров виртуальной машины

 После приобретения зарезервированного экземпляра виртуальной машины выберите гибкость размеров для экземпляров или приоритет емкости. Гибкость размеров для экземпляров применяет скидку на резервирование для других виртуальных машин в той же [группе размеров виртуальных машин](../../virtual-machines/reserved-vm-instance-size-flexibility.md). Приоритет емкости определяет емкость центра обработки данных, необходимую для ваших развертываний. Этот параметр обеспечивает дополнительную уверенность в возможности запуска экземпляров виртуальных машин, когда они понадобятся.

Для общей области резервирования по умолчанию обеспечивается гибкость размера экземпляра. Емкость центра обработки данных не является приоритетной для развертываний виртуальной машины.

Вы можете оптимизировать резервирование, где указана одна область, по приоритету производительности вместо гибкости размера экземпляра виртуальной машины.

Чтобы обновить параметр оптимизации для резервирований:

1. Войдите на [портал Azure](https://portal.azure.com).
2. Выберите **Все службы** > **Резервирования**.
3. Выберите резервирование.
4. Выберите **Параметры** > **Конфигурация**.
  ![Пример, в котором показан элемент конфигурации](./media/manage-reserved-vm-instance/add-product03.png)
5. Измените параметр **Оптимизировать для**.
  ![Пример, в котором показан параметр "Оптимизировать для"](./media/manage-reserved-vm-instance/instance-size-flexibility-option.png)

## <a name="optimize-reservation-use"></a>Оптимизация использования резервирования

Экономия при резервировании Azure гарантируется только при длительном использовании ресурсов. При покупке резервирования вы платите за то, что ресурс по сути можно использовать на 100 % в течение одного или трех лет. Попробуйте максимально эффективно использовать резервирование, чтобы воспользоваться всеми преимуществами и сэкономить. В следующих разделах объясняется, как отслеживать резервирование и оптимизировать его использование.

### <a name="view-reservation-use-in-the-azure-portal"></a>Просмотр использования резервирования на портале Azure

Портал Azure — одно из мест, где можно ознакомиться с данными об использовании резервирования.

1. Войдите на [портал Azure](https://portal.azure.com/).
2. Выберите **Все службы** > [**Резервирования**](https://portal.azure.com/#blade/Microsoft_Azure_Reservations/ReservationsBrowseBlade) и обратите внимание на параметр резервирования **Utilization (%)** (Использование (%)).  
  ![Изображение, показывающее список резервирований](./media/manage-reserved-vm-instance/reservation-list.png)
3. Выберите резервирование.
4. Изучите тенденцию использования резервирования с течением времени.
  ![Иллюстрация с данными об использовании резервирования](./media/manage-reserved-vm-instance/reservation-utilization-trend.png)

### <a name="view-reservation-use-with-api"></a>Просмотр сведений об использовании резервирования с помощью API

Если вы являетесь клиентом EA, можно программным способом просмотреть сведения об использовании резервирования в вашей организации. Вы получаете неиспользуемое резервирование, просматривая данные об использовании. При проверке расходов на резервирование следует помнить, что данные делятся на фактическую и амортизированную стоимость. Фактическая стоимость предоставляет данные для сверки с месячным счетом. Эти данные включают стоимость приобретенных резервирований и сведения об использовании резервирований. Амортизированная стоимость аналогична фактической, за исключением того, что действительная цена за использование резервирования распределяется пропорционально. Неиспользованные часы резервирования отображаются в данных амортизированной стоимости. Дополнительные сведения о данных об использовании для клиентов EA см. в статье [Get Enterprise Agreement reservation costs and usage](understand-reserved-instance-usage-ea.md) (Получение сведений о затратах на резервирование и его использовании для Соглашения Enterprise).

Для других подписок используйте API [сводок резервирования (списки по заказам на резервирование и резервированиям)](/rest/api/consumption/reservationssummaries/listbyreservationorderandreservation).

### <a name="optimize-your-reservation"></a>Оптимизация резервирования

Если обнаружится, что резервирования в вашей организации используются неэффективно:

- Убедитесь, что виртуальные машины, создаваемые в вашей организации, соответствует размеру виртуальной машины, указанному для резервирования.
- Убедитесь, что включена гибкость размера экземпляра. Дополнительные сведения см. в разделе [Изменение области для резервирования](#change-optimize-setting-for-reserved-vm-instances).
- Измените область резервирования на _общую_, чтобы она применялась шире. Дополнительные сведения см. в разделе [Изменение области для резервирования](#change-the-reservation-scope).
- Рассмотрите возможность обмена неиспользуемого объема ресурсов. Дополнительные сведения см. в разделе [Отмена и обмен](#cancel-exchange-or-refund-reservations).


## <a name="need-help-contact-us"></a>Требуется помощь? Свяжитесь с нами.

Если у вас есть вопросы или вам нужна помощь, [создайте запрос в службу поддержки](https://go.microsoft.com/fwlink/?linkid=2083458).

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения о резервировании в Azure см. по следующим ссылкам:

- [Сведения о резервированиях для Azure](save-compute-costs-reservations.md)

Приобретение плана обслуживания:
- [Предоплата виртуальных машин с помощью Azure Reserved Virtual Machine Instances](../../virtual-machines/prepay-reserved-vm-instances.md)
- [Предоплата вычислительных ресурсов Базы данных SQL Azure с получением резервной мощности](../../azure-sql/database/reserved-capacity-overview.md)
- [Предоплата ресурсов Azure Cosmos DB с зарезервированной емкостью Azure Cosmos DB](../../cosmos-db/cosmos-db-reserved-capacity.md)

Приобретение плана программного обеспечения:
- [Предварительная оплата планов программного обеспечения Red Hat в резервированиях Azure](../../virtual-machines/linux/prepay-suse-software-charges.md)
- [Предварительная оплата программного обеспечения SUSE в резервированиях Azure](../../virtual-machines/linux/prepay-suse-software-charges.md)

Общие сведения о скидках и использовании:
- [Сведения о применении скидки к зарезервированному экземпляру виртуальной машины Azure](../manage/understand-vm-reservation-charges.md)
- [Understand how the Red Hat Linux Enterprise software reservation plan discount is applied for Azure](understand-rhel-reservation-charges.md) (Сведения о применении скидки на план резервирования программного обеспечения Red Hat Linux Enterprise применяется к Azure)
- [Сведения о применении скидки на программное обеспечение SUSE Linux Enterprise](understand-suse-reservation-charges.md)
- [Сведения о применении скидки на другие резервирования](understand-reservation-charges.md)
- [Общие сведения об использовании резервирования Azure для подписки с оплатой по мере использования](understand-reserved-instance-usage.md)
- [Общие сведения об использовании зарезервированных экземпляров Azure с Соглашением о регистрации Enterprise](understand-reserved-instance-usage-ea.md)
- [Затраты на программное обеспечение Windows, которые не включены в стоимость зарезервированных экземпляров Azure](reserved-instance-windows-software-costs.md)
