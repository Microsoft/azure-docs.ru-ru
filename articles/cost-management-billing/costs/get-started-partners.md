---
title: Начало работы со службой "Управление затратами Azure" для партнеров
description: В этой статье содержатся сведения об использовании функции "Управление затратами Azure" партнерами, а также обеспечении ими доступа к Управлению затратами для клиентов.
author: bandersmsft
ms.author: banders
ms.date: 01/27/2021
ms.topic: conceptual
ms.service: cost-management-billing
ms.subservice: cost-management
ms.reviewer: aparnag
ms.custom: secdec18
ms.openlocfilehash: 40c683d98a13bf4810ec4575af3fba5ae64961f0
ms.sourcegitcommit: 2f9f306fa5224595fa5f8ec6af498a0df4de08a8
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/28/2021
ms.locfileid: "98946986"
---
# <a name="get-started-with-azure-cost-management-for-partners"></a>Начало работы со службой "Управление затратами Azure" для партнеров

Служба "Управление затратами Azure" изначально доступна для прямых партнеров, которые подключили своих клиентов к Клиентскому соглашению Майкрософт и [приобрели план Azure](/partner-center/purchase-azure-plan). В этой статье объясняется использование партнерами функций [Управление затратами Azure](../index.yml) для просмотра затрат на подписки в плане Azure. Здесь также содержатся сведения о том, как партнеры предоставляют своим клиентам доступ к службе "Управление затратами" для просмотра затрат, вычисленных по розничным тарифам.

Для прямых партнеров и непрямых поставщиков глобальный администратор и агенты администрирования могут получить доступ к службе "Управление затратами" в арендаторе партнера и управлять расходами согласно выставленных цен.

Торговые посредники и клиенты могут получить доступ к Управлению затратами в арендаторе клиента и просматривать затраты на потребление для подписок, в которых затраты рассчитываются и отображаются в розничных тарифах. При этом у таких торговых посредников и клиентов должен быть доступ RBAC Azure к подписке в арендаторе клиента, чтобы они могли просматривать сведения о затратах. Поставщику следует включить политику видимости затрат для арендатора клиента.

Клиенты могут использовать функции Управления затратами при их включении партнером CSP.

Партнеры CSP используют Управление затратами для:

- Изучения стоимости выставленных счетов и сопоставления расходов с клиентами, подписками, группами ресурсов и службами.
- Получения интуитивно понятного представления о затратах Azure в [анализе затрат](quick-acm-cost-analysis.md), имея возможности для анализа затрат по клиентам, подпискам, группам ресурсов, ресурсам, измерениям, службам и многим другим измерениям.
- Просмотра затрат на ресурсы, которые были применены в Анализе затрат по Партнерских баллах (PEC).
- Настройки уведомлений и автоматизации с использованием программных [бюджетов](tutorial-acm-create-budgets.md) и уведомлений при превышении расходов над бюджетами.
- Включения политики Azure Resource Manager, которая обеспечивает доступ клиентов к данным Управления затратами. Клиенты могут просматривать данные о затратах на потребление для своих подписок с помощью [ставок с оплатой по мере использования](https://azure.microsoft.com/pricing/calculator/).
- Экспортирования данных о затратах и использовании в большой двоичный объект хранилища с подпиской с оплатой по мере использования.

Ниже приведен пример, показывающий затраты для всех клиентов.

[![Пример, в котором показаны затраты для всех клиентов](./media/get-started-partners/customer-costs1.png)](./media/get-started-partners/customer-costs1.png#lightbox)

Ниже приведен пример, показывающий затраты для одного клиента.

[![Пример, в котором показаны затраты для одного клиента](./media/get-started-partners/customer-costs2.png)](./media/get-started-partners/customer-costs2.png#lightbox)

Все функциональные возможности, доступные в службе "Управление затратами Azure", также доступны с помощью REST API. Используйте API, чтобы автоматизировать задачи управления затратами.

## <a name="prerequisites"></a>Предварительные требования

Как партнер, служба "Управление затратами Azure" изначально доступна только для подписок из плана Azure.

Чтобы включить службу "Управление затратами Azure" для портала Azure, необходимо подтвердить согласие клиента по Клиентскому соглашению Майкрософт (от имени клиента) и перевести клиента на план Azure. В службе "Управление затратами Azure" доступны только затраты на подписки, перенесенные в план Azure.

Службе "Управление затратами Azure" нужен доступ на чтение для учетной записи выставления счетов или подписки.

Дополнительные сведения о включении и назначении доступа к службе "Управление затратами Azure" для учетной записи выставления счетов см. в статье [Назначение пользователям ролей и разрешений](/partner-center/permissions-overview). Управление затратами для учетной записи выставления счетов можно осуществлять с помощью ролей **Глобальный администратор** **Агент по администрированию** .

Чтобы получить доступ к службе "Управление затратами Azure" на уровне подписки, любой пользователь с доступом RBAC Azure к этой подписке может просмотреть сведения о расходах по розничным ставкам (с оплатой по мере использования). Но для этого следует включить [политику видимости затрат для арендатора клиента](#enable-the-policy-to-view-azure-usage-charges). Полный список поддерживаемых типов учетных записей см. в статье [Understand Cost Management data](understand-cost-mgt-data.md) (Интерпретация данных службы "Управление затратами").

При передаче существующих соглашений по выставлению счетов новому партнеру возможности для управления затратами будут доступны только для текущего взаимоотношения выставления счетов с партнером. Исторические затраты перед передачей новому партнеру не переносятся в новую учетную запись выставления счетов. Но журнал затрат сохраняется в исходной связанной учетной записи выставления счетов.

## <a name="how-cost-management-uses-scopes"></a>Как используются области в Управлении затратами

Области — это места, где вы управляете данными выставления счетов, пользуетесь ролями, относящимися к платежам, рассматриваете счета и проводите общее управление учетными записями. Роли для выставления счетов и учетных записей управляются отдельно из областей для управления ресурсами, где используется RBAC Azure. Чтобы четко различать намерения отдельных областей (включая различия в управлении доступом) они называются "областями выставления счетов" и "областями RBAC Azure" соответственно.

Сведения об областях выставления счетов и областях RBAC Azure, а также о том, как области применяются для управления затратами, см. в статье [Общие сведения об областях и работа с ними](understand-work-scopes.md).

## <a name="manage-costs-with-partner-tenant-billing-scopes"></a>Управление затратами с помощью областей выставления счетов клиентов-партнеров

После подключения клиентов к Клиентскому соглашению Майкрософт в вашем клиенте будут доступны следующие _области выставления счетов_. Используйте области для управления затратами в службе "Управление затратами".

### <a name="billing-account-scope"></a>Область учетной записи выставления счетов

Область учетной записи выставления счетов можно использовать для просмотра затрат на предварительный налог по всем клиентам и профилям выставления счетов. Затраты на счета отображаются только для продуктов, основанных на потреблении клиентов в Клиентском соглашении Майкрософт. Тем не менее, затраты по счетам отображаются для приобретенных продуктов для покупателей, как в Клиентском соглашении Майкрософт, так и в предложении CSP. В настоящее время в качестве стандартной валюты для просмотра затрат в области используется доллар США. Заданные для области бюджеты также вычисляются в долларах США.

Независимо от того, в каких валютах оплачиваются счета, партнеры используют область Учетной записи выставления счетов для составления бюджетов и управления затратами в долларах США для своих клиентов, подписок, ресурсов и групп ресурсов.

В представлении анализа затрат партнеры также фильтруют затраты в определенной валюте выставления счетов по клиентам. Выберите список **Фактические затраты** для просмотра затрат в поддерживаемых валютах выставления счетов.

![Пример, показывающий выбор "Фактическая стоимость" для валют](./media/get-started-partners/actual-cost-selector.png)

Используйте [представление амортизированных затрат](quick-acm-cost-analysis.md#customize-cost-views) в областях выставления счетов, чтобы просматривать зарезервированные экземпляры в рамках срока резервирования.

### <a name="billing-profile-scope"></a>Область профиля выставления счетов

Используйте область профиля выставления счетов для просмотра затрат без учета налогов в валюте оплаты всех клиентов для всех продуктов и подписок, входящих в счет. Вы можете отфильтровать затраты в профиле выставления счетов для определенного счета, используя фильтр **InvoiceID**. Фильтр показывает затраты на использование и приобретение продуктов для определенного счета. Вы также можете отфильтровать затраты для конкретного клиента в счете, чтобы увидеть затраты без учета налога.

После подключения клиентов к Клиентскому соглашению Майкрософт вы получите счет, который будет содержать все платежи для всех продуктов (потребление, покупки и права) для этих клиентов в соответствии с Клиентским соглашением Майкрософт. При выставлении счетов в той же валюте, эти счета также будут включать расходы за право и приобретенные продукты, такие как SaaS, Azure Marketplace, и резервирования для клиентов, которые все еще используют классическое предложение CSP в рамках плана Azure.

Для согласования расходов по счету клиента область профиля выставления счетов позволяет просматривать все расходы, которые начисляются для клиентов. Как и в счете, область отображает затраты для каждого клиента в новом Клиентском соглашении Майкрософт. Эта область также показывает каждые расходы за продукты для обслуживания клиентов, которые по-прежнему используют текущее предложение CSP.

Профиль выставления счетов и области учетной записи выставления счетов являются единственными областями, применение которых позволяет просмотреть расходы на права и продукты, основанные на покупках, такие как Azure Marketplace и покупки по резервированию.

Профили выставления счетов определяют подписки, которые включены в счет. Профили выставления счетов являются функциональным аналогом регистрации через соглашение Enterprise. Профиль выставления счетов — это область, в которой генерируются счета.

В настоящее время валюта для выставления счета является валютой по умолчанию при просмотре расходов в области профиля выставления счетов. Бюджеты, заданные в области профиля выставления счетов, относятся к валюте выставления счетов.

Партнеры могут использовать область для сверки со счетами. Кроме того, они используют область для задания бюджетов в валюте выставления счетов для следующих элементов:

- Конкретный отфильтрованный счет
- Customer
- Подписка
- Группа ресурсов
- Ресурс
- Служба Azure
- средство измерения.
- ResellerMPNID

### <a name="customer-scope"></a>Область клиента

Партнеры используют область для управления затратами, связанными с клиентами, подключенными к Клиентскому соглашению Майкрософт. Область позволяет партнерам просматривать затраты без учета налогов для конкретного клиента в валюте выставления счетов. Вы можете также отфильтровать затраты без учета налогов для конкретной подписки, группы ресурсов или ресурса.

В область клиента не входят клиенты, которые относятся к текущему предложению CSP. Область включает только клиентов, у которых есть Клиентское соглашение Майкрософт. Затраты на обслуживание, а не использование Azure, для текущих клиентов с предложением CSP доступны в учетной записи выставления счетов и в областях профиля выставления счетов при применении фильтра клиента. Заданные в этой области бюджеты относятся к валюте выставления счетов.

## <a name="partner-access-to-billing-scopes-in-cost-management"></a>Доступ партнеров к областям выставления счетов в Управлении затратами

Только пользователи с ролями **Глобальный администратор** и **Агент по администрированию** могут просматривать затраты в учетных записях и профилях выставления счетов (и управлять ими), а также затраты клиентов прямо в арендаторе Azure партнера. Дополнительные сведения о ролях центров партнеров см. в статье [Назначение пользователям ролей и разрешений](/partner-center/permissions-overview).

## <a name="enable-cost-management-for-customer-tenant-subscriptions"></a>Включение управления затратами для подписок арендатора клиента

Партнеры могут разрешить доступ к Управлению затратами после подключения клиентов к Клиентскому соглашению Майкрософт. Затем партнеры могут включить политику, позволяющую клиентам просматривать свои затраты на потребляемые службы Azure, вычисленные по розничным тарифам с оплатой по мере использования. Затраты в валюте выставления счетов клиента отображаются в соответствии с потреблением в областях подписки RBAC Azure и групп ресурсов.

При включении партнером политики видимости затрат, любой пользователь с доступом к подписке с помощью Azure Resource Manager сможет управлять затратами и анализировать их в соответствии со ставками с оплатой по мере использования. По сути, просматривать расходы могут торговые посредники и клиенты, имеющие соответствующий доступ RBAC Azure к подпискам Azure.

Независимо от политики глобальные администраторы и агенты администрирования поставщика могут просматривать затраты на подписку, если у них есть доступ к подписке и группе ресурсов.

### <a name="enable-the-policy-to-view-azure-usage-charges"></a>Включение политики для просмотра расходов на использование Azure

Для просмотра и обновления политики необходимо быть участником группы **агентов администрирования**. Чтобы включить политику, позволяющую клиентам просматривать расходы на использование Azure, используйте приведенные ниже инструкции.

Войдите в *арендатор партнера* на портале Azure и выберите **Управление затратами + выставление счетов**. Выберите соответствующую область выставления счетов в области "Область выставления счетов", а затем выберите **Клиенты**. Список клиентов связан с учетной записью выставления счетов. *Если вы по ошибке вошли в арендатор клиента, список **Клиенты** не отобразится.*

В списке клиентов выберите клиента, для которого требуется разрешить просмотр затрат.

[![Выбор клиентов в службе "Управление затратами"](./media/get-started-partners/customer-list.png)](./media/get-started-partners/customer-list.png#lightbox)

Выберите **Политики** в разделе **Параметры**.

Текущая политика видимости затрат отображается для расходов на **Использование Azure**, связанных с подписками для выбранного клиента.
![Политика, позволяющая клиентам просматривать оплату с оплатой по мере использования](./media/get-started-partners/cost-management-billing-policies.png)

Если для политики задано значение **Нет**, служба "Управление затратами Azure" будет недоступна для пользователей подписки, связанных с клиентом. По умолчанию политика видимости затрат отключена для всех пользователей подписки, если она не включена партнером.

Если для политики затрат задано значение **Да**, пользователи подписки, связанные с арендатором клиента, могут просматривать расходы за ставкой для оплаты по мере использования.

Если политика видимости затрат включена, все службы, имеющие использование подписок, будут показывать затраты при ставках с оплатой по мере использования. Использование на резервирования отображается с нулевыми расходами за фактические и амортизированные затраты. Покупки и права не связаны с определенной подпиской. Поэтому покупки не отображаются в области подписки. Глобальный администратор или агент по администрированию прямого партнера или непрямого поставщика может также использовать [API обновления данных клиента](/rest/api/billing/2019-10-01-preview/policies/updatecustomer), чтобы для каждого клиента настроить политику отображения затрат в большом масштабе.

### <a name="view-subscription-costs-in-the-customer-tenant"></a>Просмотр затрат на подписку в арендаторе клиента

Чтобы просмотреть затраты на подписку, откройте **Управление затратами и выставление счетов** в арендаторе Azure клиента. Выберите **Анализ затрат** для соответствующей подписки и начните просмотр затрат. Вы можете просматривать затраты на потребление для каждой подписки отдельно в арендаторе клиента.

[![Просмотр анализа затрат в качестве пользователя](./media/get-started-partners/subscription-costs.png)](./media/get-started-partners/subscription-costs.png#lightbox)

Анализ затрат, бюджеты и оповещения доступны для областей подписок и групп ресурсов RBAC Azure по ставкам, основанным на оплате по мере использования.

Представления для амортизированных и фактических расходов для зарезервированных экземпляров в области RBAC Azure всегда содержат нулевые суммы. Стоимость приобретения таких прав, как права на резервирование экземпляров и сборы Marketplace, отображается только в областях выставления счетов в клиенте партнера, где были совершены покупки.

Розничные тарифы, применяемые для вычисления затрат, показанных в представлении, соответствуют ценам, показанным в калькуляторе цен Azure для всех клиентов. Показанные затраты не включают скидки или кредиты, которые могут быть у партнера в качестве партнерских баллов, скидок на основе категорий и глобальных скидок на службы.

 

## <a name="analyze-costs-in-cost-analysis"></a>Анализ затрат в функции анализа затрат

Партнеры, имеющие доступ к областям выставления счетов в арендаторах партнеров, могут изучать и анализировать расходы по счетам в рамках анализа затрат по клиентам для конкретного клиента или по счету. В представлении [Анализ затрат](quick-acm-cost-analysis.md) можно также [сохранять представления](quick-acm-cost-analysis.md#saving-and-sharing-customized-views) и экспортировать данные в [файлы CSV и PNG](quick-acm-cost-analysis.md#download-usage-data).

Пользователи RBAC Azure с доступом к подписке в арендаторе клиента, могут также анализировать розничные расходы на подписку в арендаторе клиента, сохранять представления, а также экспортировать данные в формате файлов CSV и PNG.

Для анализа затрат по нескольким полям в анализе затрат можно использовать фильтр и группировку по функциям. Поля, относящееся к партнерам, показаны в следующем разделе.

## <a name="data-fields"></a>Поля данных

Следующие поля данных находятся в файлах сведений об использовании и API Управления затратами. Там, где это возможно, отображаются сведения об аналоге в Центре партнеров. Для анализа затрат по нескольким полям, в следующих полях, выделенных полужирным начертанием, в анализе затрат можно использовать фильтр и группировку по функциям. Поля с полужирным начертанием применяются только к Клиентским соглашениям Майкрософт, поддерживаемых партнерами.

| **Имя поля** | **Описание** | **Аналог в Центре партнеров** |
| --- | --- | --- |
| invoiceId | Идентификатор счета, отображаемый для счета определенной транзакции. | Номер счета, на котором показана транзакция. |
| previousInvoiceID | Ссылка на исходный счет, если он является возвратом денежных средств (стоимость продукта). Заполняется только при условии возврата денежных средств. | Недоступно |
| billingAccountName | Имя учетной записи выставления счетов, представляющей партнера. Начисляет все расходы для клиентов, которые присоединились к Клиентскому соглашению Майкрософт, и для клиентов CSP, которые сделали покупки на обслуживание для программ, таких как SaaS, Azure Marketplace и резервирований. | Недоступно |
| billingAccountID | Идентификатор для учетной записи выставления счетов, представляющей партнера. | Корневой идентификатор коммерческого партнера MCAPI. Используется в запросе, но не включен в ответ.|
| billingProfileID | Идентификатор для профиля выставления счетов, который группирует расходы по счетам в одной валюте выставления счетов для пользователей, которые присоединились к Клиентскому соглашению Майкрософт, и для клиентов CSP, которые сделали покупки на право доступа к программам, таким как SaaS, Azure Marketplace и резервированиям. | Идентификатор группы выставления счетов партнера MCAPI. Используется в запросе, но не включен в ответ. |
| billingProfileName | Имя профиля выставления счетов, который группирует расходы по счетам в одной валюте для клиентов, которые присоединились к Клиентскому соглашению Майкрософт, и для клиентов CSP, которые сделали покупки на право доступа к программам, таким как SaaS, Azure Marketplace и резервированиям. | Недоступно |
| invoiceSectionName | Имя проекта, который оплачивается в счете. Неприменимо для Клиентских соглашений Майкрософт, подключенных партнерами. | Недоступно |
| invoiceSectionID | Идентификатор проекта, который оплачивается в счете. Неприменимо для Клиентских соглашений Майкрософт, подключенных партнерами. | Недоступно |
| **CustomerTenantID** | Идентификатор арендатора Azure Active Directory подписки клиента. | Идентификатор организации клиента — TenantID клиента Azure Active Directory. |
| **CustomerName** | Имя арендатора Azure Active Directory для подписки клиента. | Название организации клиента, как показано в Центре партнеров. Важно для сверки счета со сведениями вашей системы. |
| **CustomerTenantDomainName** | Доменное имя для арендатора Azure Active Directory подписки клиента. | Домен арендатора клиента Azure Active Directory. |
| **PartnerTenantID** | Идентификатор для арендатора Azure Active Directory партнера. | Идентификатор арендатора Azure Active Directory партнера, называемый "Идентификатором арендатора" или "Идентификатором партнера" в формате GUID. |
| **PartnerName** | Имя для арендатора партнера Azure Active Directory. | Имя партнера. |
| **ResellerMPNID** | ИД MPN для торгового посредника, связанное с подпиской. | ИД MPN для торгового посредника на запись для подписки. Недоступно для текущего действия. |
| costCenter | Место возникновения затрат, связанное с подпиской. | Недоступно |
| billingPeriodStartDate | Дата начала периода выставления счетов, как показано в счете. | Недоступно |
| billingPeriodEndDate | Дата окончания периода выставления счетов, как показано в счете. | Недоступно |
| servicePeriodStartDate | Дата начала периода оценки, когда за использование службы начислялась плата. Цены на службы Azure определяются в период оценки. | ChargeStartDate в Центре партнеров.  Дата начала периода выставления счетов, за исключением случаев представления дат ранее неоплаченного скрытого использования данных из предыдущего цикла выставления счетов. Этим временем всегда является начало дня — 0:00. |
| servicePeriodEndDate | Дата окончания периода, когда за использование службы начислялась плата. Цены на службы Azure определяются на основании периода оценки. | Недоступно |
| Дата | Для данных о потреблении Azure показывает дату использования как номинальную. Для зарезервированного экземпляра представляет дату покупки. Для регулярных и разовых платежей, например для Marketplace и поддержки, отображается дата покупки. | Недоступно |
| productID | Идентификатор продукта, за который были начислены расходы при потреблении или покупке. Это объединенный ключ productID и SKuID, как показано в Центре партнеров. | Идентификатор продукта. |
| product | Имя продукта, за который были начислены расходы при потреблении или покупке, как показано в счете. | Имя продукта в каталоге. |
| serviceFamily | Показывает семейство служб для приобретенного или оплаченного продукта. Например, службу хранилища Azure или Вычислительную среду ML. | Недоступно |
| productOrderID | Идентификатор актива или названия плана Azure, к которому принадлежит подписка. Например, план Azure. | CommerceSubscriptionID |
| productOrderName | Имя плана Azure, к которому принадлежит подписка. Например, план Azure. | Недоступно|
| consumedService | Потребленная служба (устаревшая классификация), используемая в устаревшей версии сведений об использовании по EA. | Служба, отображаемая в Центре партнеров. Например, Microsoft.Storage, Microsoft.Compute, и microsoft.operationalinsights. |
| Значение meterID | Отслеживаемый идентификатор для измеряемого потребления. | Идентификатор используемого счетчика. |
| meterName | Определяет имя счетчика измеряемого потребления. | Имя счетчика потребления. |
| meterCategory | Указывает службу верхнего уровня, которая использовалась. | Служба верхнего уровня, которая использовалась. |
| meterSubCategory | Определяет тип или подкатегорию службы Azure, которая может влиять на тариф. | Тип службы Azure, которая может влиять на тариф.|
| meterRegion | В этом столбце указывается расположение центра обработки данных для определенных служб. От этого расположения может зависеть стоимость некоторых услуг. | В тех случаях, когда это уместно и доступно для служб в данном столбце указывается региональное расположение центра обработки данных. |
| Идентификатор подписки | Уникальный идентификатор подписки Azure, созданный корпорацией Майкрософт. | EntitlementID |
| subscriptionName | Имя подписки Azure. | Недоступно |
| Термин | Отображает срок действия предложения. Например, зарезервированные экземпляры показывают 12 месяцев годичного срока. Для одноразовых или регулярных покупок срок отображает один месяц для SaaS, Azure Marketplace и поддержки. Неприменимо к использованию Azure. | Недоступно |
| publisherType (firstParty, thirdPartyReseller, thirdPartyAgency) | Тип издателя, который идентифицирует его как первую сторону, стороннего торгового посредника или стороннее агентство. | Недоступно |
| partNumber | Шифр компонента неиспользованного зарезервированного экземпляра и служб Azure Marketplace. | Недоступно |
| publisherName | Имя издателя службы, включая корпорацию Майкрософт или сторонних издателей. | Имя издателя продукта.|
| reservationId | Идентификатор для покупки зарезервированного экземпляра. | Недоступно |
| reservationName | Имя зарезервированного экземпляра. | Недоступно |
| reservationOrderId | OrderID зарезервированного экземпляра. | Недоступно |
| frequency | Частота оплаты за зарезервированный экземпляр. | Недоступно |
| resourceGroup | Имя группы ресурсов Azure, используемой для управления ресурсами жизненного цикла. | Имя группы ресурсов. |
| instanceID (или) ResourceID | Идентификатор экземпляра ресурса. | Отображается как ResourceURI, который включает в себя все свойства ресурса. |
| resourceLocation | Имя расположения ресурса. | Расположение ресурса. |
| Расположение | Стандартизированное расположение ресурса. | Недоступно |
| effectivePrice | Эффективная цена за единицу службы в валюте ценообразования. Уникальна для продукта, группы услуг, единицы измерения и предложения. Используется с ценами в прайс-листе для учетной записи выставления счетов. При многоуровневом ценообразовании или включенном объеме, оно показывает смешанную цену потребления. | Цена за единицу после корректировки. |
| Количество | Измеренное количество купленного или потребленного. Количество единиц измерения, использованных за период выставления счетов. | Число единиц. Во время сверки убедитесь, что это число соответствует сведениям в вашей системе выставления счетов. |
| unitOfMeasure | Указывает единицу тарификации службы. Например, гигабайты и часы. | Указывает единицу тарификации службы. Например, гигабайты, часы и 10 000 с. |
| pricingCurrency | Валюта, определяющая цену единицы. | Валюта в прайс-листе.|
| billingCurrency | Валюта, определяющая фактурную стоимость. | Валюта, определенная как валюта для выставления счетов. |
| ChargeType | Определяет тип расходов, которые представляют собой затраты в службе "Управление затратами Azure", такие как расходы на покупку и возврат денежных средств. | Тип оплаты или коррекции. Недоступно для текущего действия. |
| costinBillingCurrency | ExtendedCost или смешанная стоимость до налогообложения в валюте, указанной в счете. | Недоступно |
| costinPricingCurrency | ExtendedCost смешанная стоимость до налогообложения в валюте ценообразования для сопоставления с ценами. | Недоступно |
| **costinUSD** | ExtendedCost или смешанная стоимость до налогообложения в долларах США. | Недоступно |
| **paygCostInBillingCurrency** | Показывает затраты, если цены указаны в розничных ценах. Показывает цены по принципу "с оплатой по мере использования" в валюте выставления счетов. Доступно только для областей RBAC Azure. | Недоступно |
| **paygCostInUSD** | Показывает затраты, если цены указаны в розничных ценах. Показывает цены с оплатой по мере использования в долларах США. Доступно только для областей RBAC Azure. | Недоступно |
| exchangeRate | Валютный курс, используемый для преобразования валюты ценообразования в валюту выставления счетов. | В Центре партнеров имеет название PCToBCExchangeRate. Валюта ценообразования по отношению к курсу обмена валюты выставления счетов.|
| exchangeRateDate | Дата валютного курса, используемая для преобразования валюты ценообразования в валюту выставления счетов. | В Центре партнером называется PCToBCExchangeRateDat. Валюта ценообразования по отношению к дате курса обмена валюты выставления счетов.|
| isAzureCreditEligible | Указывает, можно ли выполнить оплату деньгами на счете в Azure. | Недоступно |
| serviceInfo1 | Устаревшее поле, в которое записываются необязательные дополнительные метаданные о службе. | Метаданные внутренней службы Azure. |
| serviceInfo2 | Устаревшее поле, в которое записываются необязательные дополнительные метаданные о службе. | Сведения о службе. Например, тип образа для виртуальной машины и имя поставщика услуг Интернета для ExpressRoute.|
| additionalInfo | Метаданные определенных служб. Например, тип образа для виртуальной машины. | Любые дополнительные сведения, не указанные в других столбцах. Метаданные определенных служб. Например, тип образа для виртуальной машины.|
| tags | Тег, присваиваемый средству измерения. Используйте теги, чтобы группировать записи для выставления счетов. Например, вы можете использовать теги для распределения затрат по отделу, который использует данное средство измерения. | Добавленные клиентом теги.|
| **partnerEarnedCreditRate** | Процент скидки применяется при наличии партнерских баллов (PEC) на основе доступа по ссылке администратора партнера. | Ставка партнерских баллов (PEC). Например, 0 % или 15 %. |
| **partnerEarnedCreditApplied** | Указывает, были ли применены партнерские баллы. | Недоступно |

## <a name="view-partner-earned-credit-pec-resource-costs"></a>Просмотр цен на ресурсы Партнерских баллов (PEC)

В службе "Управление затратами Azure" партнеры могут использовать анализ затрат для просмотра затрат, за которые получено преимущества от PEC.

Войдите в арендатор партнера на портале Azure и выберите **Cost Management + Billing** (Управление затратами и выставление счетов). В **Управление затратами** выберите **Анализ затрат**.

В представлении "Анализ затрат" показаны затраты на учетную запись выставления счетов партнера. Выберите **Область**, необходимую партнеру, конкретному клиенту или профилю выставления счетов для сверки счетов.

В кольцевой диаграмме выберите выпадающий список, а затем **PartnerEarnedCreditApplied**, чтобы увидеть подробные сведения о расходах PEC.

![Пример, показывающий, как просмотреть партнерские баллы](./media/get-started-partners/cost-analysis-pec1.png)

Если для свойства **PartnerEarnedCreditApplied** уставлено значение _True_, связанная стоимость имеет преимущество доступа администратора для партнерских баллов.

Если для свойства **PartnerEarnedCreditApplied** установлено значение _False_, то связанная стоимость не соответствует необходимым требованиям для получения кредита. Или купленная служба не имеет прав на партнерские баллы.

Данные об использовании службы, как правило, отображаются в службе "Управление затратами" в течение 8–24 часов. Дополнительные сведения см. в статье [Обновление и сохранение данных о затратах и потреблении](understand-cost-mgt-data.md#cost-and-usage-data-updates-and-retention). Кредиты PEC появляются в течение 48 часов с момента доступа в Управление затратами Azure.


Группировать и фильтровать можно также используя свойство **PartnerEarnedCreditApplied** с параметрами **Группировать по**. Используйте параметры для изучения затрат, которые имеют и не имеют PEC.

![Группирование или фильтрация по партнерским баллам](./media/get-started-partners/cost-analysis-pec2.png)

## <a name="export-cost-data-to-azure-storage"></a>Экспорт данных о затратах в службу хранилища Azure

Партнеры, имеющие доступ к областям выставления счетов в арендаторе партнера, могут экспортировать свои данные о затратах и использовании в большой двоичный объект службы хранилища Azure. Большой двоичный объект должен быть на подписке в арендаторе партнера, который не является [подпиской на общую службу](/partner-center/shared-services) или подпиской клиента. Чтобы включить экспорт данных о затратах, мы рекомендуем установить в арендаторе партнера независимую подписку с оплатой по мере использования для размещения экспортированных данных о затратах. Учетная запись хранения для экспорта создается в большом двоичном объекте службы хранилища Azure, размещенном в подписке с оплатой по мере использования. В зависимости от области, в которой партнер создает экспорт, соответствующие данные автоматически экспортируются в учетную запись хранения на периодической основе.

Кроме того, пользователи с доступом RBAC Azure к подписке могут экспортировать данные о затратах в большой двоичный объект службы хранилища Azure в любой подписке арендатора клиента.

### <a name="create-an-export-in-a-partner-tenant-or-customer-tenant"></a>Создание экспорта в арендаторе партнера или клиента

Войдите в арендатор партнера или клиента на портале Azure и выберите **Cost Management + Billing** (Управление затратами и выставление счетов). Выберите соответствующую область, например, учетную запись выставления счетов в рамках Соглашения с партнерами Майкрософт, а затем выберите **Анализ затрат**. После загрузки страницы выберите **Экспорт**. Выберите **Просмотреть все операции экспорта** в "Запланировать экспорт".

![Выбор "Экспорт" и "Просмотреть все операции экспорта"](./media/get-started-partners/export01.png)

Затем выберите **Добавить**, введите имя и выберите тип экспорта. Выберите вкладку **Служба хранилища** и введите необходимые сведения.

![Добавление нового экспорта и выбор вкладки "Служба хранилища"](./media/get-started-partners/export02.png)

При создании экспорта в арендаторе партнера, выберите для арендатора партнера подписку с оплатой по мере использования. Создайте учетную запись хранения Azure, используя эту подписку.

Для пользователей RBAC Azure в арендаторе клиента выберите подписку в арендаторе клиента. Создайте учетную запись хранения Azure, используя подписку.

Просмотрите содержимое и выберите **Создать**, чтобы запланировать экспорт.

В списке экспорта выберите имя учетной записи хранения, чтобы проверить данные. На странице учетной записи хранения щелкните **Контейнеры** и выберите контейнер. Перейдите в соответствующую папку и выберите CSV-файл. Выберите **Загрузить**, чтобы получить CSV-файл, и откройте его. Экспортируемые данные о затратах аналогичные данным из сведений об использовании портала Azure.

![Пример экспортированных данных](./media/get-started-partners/example-export-data.png)

## <a name="cost-management-rest-apis"></a>REST API Управления затратами

Для общих задач партнеры и клиенты могут использовать API Управления затратами, описанные в следующих разделах.

### <a name="azure-cost-management-apis---direct-and-indirect-providers"></a>API службы "Управление затратами Azure" — прямые и непрямые поставщики услуг

Партнеры, имеющие доступ к областям выставления счетов в арендаторах партнера, могут использовать следующие API для просмотра счетов.

Партнер может вызвать API в области подписки вне зависимости от политики затрат, если у этих API есть доступ к подписке. Другие пользователи, имеющие доступ к подписке, например, клиент или торговый посредник, могут вызывать API только после того, как партнер включит политику расходов для арендатора клиента.


#### <a name="to-get-a-list-of-billing-accounts"></a>Чтобы получить учетные записи выставления счетов

```
GET https://management.azure.com/providers/Microsoft.Billing/billingAccounts?api-version=2019-10-01-preview
```

#### <a name="to-get-a-list-of-customers"></a>Чтобы получить список клиентов

```
GET https://management.azure.com/providers/Microsoft.Billing/billingAccounts/{billingAccountName}/customers?api-version=2019-10-01-preview
```

#### <a name="to-get-a-list-of-subscriptions"></a>Чтобы получить список подписок

```
GET https://management.azure.com/providers/Microsoft.Billing/billingAccounts/{billingAccountName}/billingSubscriptions?api-version=2019-10-01-preview
```

#### <a name="to-get-a-list-of-invoices-for-a-period-of-time"></a>Чтобы получить список счетов для периода

```
GET https://management.azure.com/providers/Microsoft.Billing/billingAccounts/{billingAccountName}/invoices?api-version=2019-10-01-preview&periodStartDate={periodStartDate}&periodEndDate={periodEndDate}
```

Вызов API возвращает массив счетов, который имеет элементы, похожие на следующий код JSON.

```
    {
      "id": "/providers/Microsoft.Billing/billingAccounts/{billingAccountID}/billingProfiles/{BillingProfileID}/invoices/{InvoiceID}",
      "name": "{InvoiceID}",
      "properties": {
        "amountDue": {
          "currency": "USD",
          "value": x.xx
        },
        ...
    }
```

Используйте предыдущее возвращаемое значение поля идентификатора и замените его в следующем примере в качестве области для запроса сведений об использовании.

```
GET https://management.azure.com/{id}/providers/Microsoft.Consumption/UsageDetails?api-version=2019-10-01
```

В примере возвращаются записи об использовании, связанные с конкретным счетом.


#### <a name="to-get-the-policy-for-customers-to-view-costs"></a>Чтобы получить политику для пользователей для просмотра затрат

```
GET https://management.azure.com/providers/Microsoft.Billing/billingAccounts/{billingAccountName}/customers/{customerID}/policies/default?api-version=2019-10-01-preview
```

#### <a name="to-set-the-policy-for-customers-to-view-costs"></a>Чтобы установить политику для пользователей для просмотра затрат

```
PUT https://management.azure.com/providers/Microsoft.Billing/billingAccounts/{billingAccountName}/customers/{customerID}/policies/default?api-version=2019-10-01-preview
```

#### <a name="to-get-azure-service-usage-for-a-billing-account"></a>Чтобы получить сведения об использовании службы Azure для ученой записи выставления счетов

```
GET https://management.azure.com/providers/Microsoft.Billing/BillingAccounts/{billingAccountName}/providers/Microsoft.Consumption/usageDetails?api-version=2019-10-01
```

#### <a name="to-download-a-customers-azure-service-usage"></a>Чтобы скачать сведения об использовании службы Azure клиентом

Следующий вызов "get" является асинхронной операцией.

```
GET https://management.azure.com/Microsoft.Billing/billingAccounts/{billingAccountName}/customers/{customerID}/providers/Microsoft.Consumption/usageDetails/download?api-version=2019-10-01 -verbose
```

Для проверки состояния операции обратитесь к URI `Location`, возвращенному в ответе. Если состояние — *Завершено*, свойство `downloadUrl` содержит ссылку, по которой можно загрузить сгенерированный отчет.


#### <a name="to-get-or-download-the-price-sheet-for-consumed-azure-services"></a>Чтобы получить или скачать прайс-лист на потребленные службы Azure

Сначала используйте следующую публикацию.

```
POST https://management.azure.com/providers/Microsoft.Billing/BillingAccounts/{billingAccountName}/billingProfiles/{billingProfileID}/pricesheet/default/download?api-version=2019-10-01-preview&format=csv" -verbose
```

Затем вызовите значение свойства асинхронной операции. Пример:

```
GET https://management.azure.com/providers/Microsoft.Billing/billingAccounts/{billingAccountName}/billingProfiles/{billingProfileID}/pricesheetDownloadOperations/{operation}?sessiontoken=0:11186&api-version=2019-10-01-preview
```
Предыдущий звонок "get" возвращает ссылку на скачивание, содержащую прайс-лист.


#### <a name="to-get-aggregated-costs"></a>Чтобы получить агрегированные затраты

```
POST https://management.azure.com/providers/microsoft.billing/billingAccounts/{billingAccountName}/providers/microsoft.costmanagement/query?api-version=2019-10-01
```

#### <a name="create-a-budget-for-a-partner"></a>Создание бюджета для партнера

```
PUT https://management.azure.com/providers/Microsoft.Billing/billingAccounts/{billingAccountName}/providers/Microsoft.CostManagement/budgets/partnerworkshopbudget?api-version=2019-10-01
```

#### <a name="create-a-budget-for-a-customer"></a>Создание бюджета для клиента

```
PUT https://management.azure.com/providers/Microsoft.Billing/billingAccounts/{billingAccountName}/customers/{customerID}/providers/Microsoft.Consumption/budgets/{budgetName}?api-version=2019-10-01
```

#### <a name="delete-a-budget"></a>Удаление бюджета

```
DELETE
https://management.azure.com/providers/Microsoft.Billing/billingAccounts/{billingAccountId}/providers/Microsoft.CostManagement/budgets/{budgetName}?api-version=2019-10-01
```


## <a name="next-steps"></a>Дальнейшие действия
- [Краткое руководство. Изучение и анализ затрат с помощью функции анализа затрат](quick-acm-cost-analysis.md) в Управлении затратами
- [Tutorial: Create and manage Azure budgets](tutorial-acm-create-budgets.md) in Cost Management (Краткое руководство. Создание бюджетов Azure и управление ими в Управлении затратами)
