---
title: Анализ затрат на Azure с помощью приложения Power BI
description: В этой статье объясняется, как установить и использовать приложение Power BI Azure Cost Management.
author: bandersmsft
ms.author: banders
ms.date: 1/29/2021
ms.topic: how-to
ms.service: cost-management-billing
ms.subservice: cost-management
ms.reviewer: benshy
ms.openlocfilehash: d3439f5a86c445898d95191a32496b5f0c86be0b
ms.sourcegitcommit: dd24c3f35e286c5b7f6c3467a256ff85343826ad
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/29/2021
ms.locfileid: "99070163"
---
# <a name="analyze-cost-with-the-azure-cost-management-power-bi-app-for-enterprise-agreements-ea"></a>Анализ затрат с помощью приложения Power BI Azure Cost Management для Соглашений Enterprise (EA)

В этой статье объясняется, как установить и использовать приложение Power BI Azure Cost Management. Это приложение помогает анализировать затраты на Azure в Power BI и управлять ими. Вы можете использовать это приложение для мониторинга затрат и тенденций использования, а также для поиска возможностей оптимизации затрат для снижения расходов.

В настоящее время приложение Power BI Azure Cost Management доступно только клиентам с [Соглашением Enterprise](https://azure.microsoft.com/pricing/enterprise-agreement/).

Приложение ограничивает возможности настройки. Если вы хотите изменить и расширить фильтры по умолчанию, представления и визуализации в соответствии со своими потребностями, используйте [соединитель Управления затратами Azure в Power BI Desktop](/power-bi/connect-data/desktop-connect-azure-cost-management). С помощью соединителя Управления затратами Azure можно присоединить дополнительные данные из других источников, чтобы создать настраиваемые отчеты для получения комплексных представлений об общих расходах бизнеса. Соединитель также поддерживает Клиентские соглашения Майкрософт.

> [!NOTE]
> Приложения-шаблоны Power BI не поддерживают скачивание PBIX-файла.

## <a name="prerequisites"></a>Предварительные требования

- Для установки и использования приложения требуется [Лицензия Power BI Pro](/power-bi/service-self-service-signup-for-power-bi).
- Для подключения к данным необходима учетная запись [администратора предприятия](../manage/understand-ea-roles.md). Поддерживается роль "Администратор предприятия (только чтение)".

## <a name="installation-steps"></a>Шаги установки

Чтобы установить приложение, сделайте следующее.

1. Откройте [приложение Power BI Azure Cost Management](https://aka.ms/costmgmt/ACMApp).
2. На странице приложения Power BI выберите **Получить**.
3. Выберите **Продолжить**, чтобы принять условия использования и политику конфиденциальности.
4. В окне **Установить это приложение Power BI** выберите **Установить**.
5. При необходимости создайте рабочую область и выберите **Продолжить**.
6. После завершения установки появится уведомление о том, что новое приложение готово.
7. Выберите **Перейти к приложению**.
8. В окне **Начало работы с новым приложением** в разделе **Подключите свои данные** выберите **Подключить**.  
  ![Начало работы с новым приложением: подключение](./media/analyze-cost-data-azure-cost-management-power-bi-template-app/connect-data2.png)
9. В появившемся диалоговом окне введите номер регистрации EA в поле **BillingProfileIdOrEnrollmentNumber**. Укажите число месяцев для получения данных. Оставьте значение по умолчанию **Номер регистрации** в поле **Область**, а затем выберите **Далее**.  
  ![Ввод сведений о регистрации EA](./media/analyze-cost-data-azure-cost-management-power-bi-template-app/ea-number.png)  
10. Следующее диалоговое окно подключается к Azure и получает данные, необходимые для получения рекомендаций по зарезервированным экземплярам. *Оставьте значения по умолчанию* и выберите **Войти**.  
  ![Снимок экрана: диалоговое окно подключения к приложению "Управление затратами Azure" со значениями по умолчанию.](./media/analyze-cost-data-azure-cost-management-power-bi-template-app/autofit.png)  
11. На завершающем шаге установщик подключается к системе регистрации EA и требует учетную запись [администратора Enterprise](../manage/understand-ea-roles.md). Выберите **Войти**, чтобы пройти аутентификацию с помощью регистрации EA. На этом шаге также запускается действие обновления данных в Power BI.  
  ![Подключение к системе регистрации EA](./media/analyze-cost-data-azure-cost-management-power-bi-template-app/ea-auth.png)  
    > [!NOTE]
    > Процесс обновления данных может занять некоторое время. Его продолжительность зависит от указанного числа месяцев и объема данных, которые необходимо синхронизировать.
12. Чтобы проверить состояние обновления данных, выберите вкладку **Наборы данных** в рабочей области. Найдите метку времени "Обновлено". Если обновление еще не завершено, вы увидите индикатор, означающий, что обновление выполняется.  
  ![Обновление данных](./media/analyze-cost-data-azure-cost-management-power-bi-template-app/data-refresh2.png)

После завершения обновления данных выберите приложение Azure Cost Management, чтобы просмотреть предварительно созданные отчеты.

## <a name="reports-available-with-the-app"></a>Отчеты, доступные в приложении

В приложении доступны следующие отчеты.

**Getting Started** содержит полезные ссылки на документацию и ссылки для отправки отзывов.

**Account overview** содержит ежемесячную информационную сводку, в том числе:

- расходы за счет кредитов;
- покупки;
- расходы на Azure Marketplace;
- превышения и суммарные расходы.

**Отчет об использовании по подпискам и группам ресурсов** содержит представление и диаграммы затрат за период времени, отображающие затраты на подписку и группу ресурсов.

**Отчет об использовании по службам** содержит представление использования за период времени на основе категории MeterCategory. Вы можете отслеживать данные об использовании и перейти к любой аномалии, чтобы изучить резкое повышение или сокращение использования.

**Отчет по 5 основным факторам использования** содержит сводку по затратам, отфильтрованную по 5 основным значениям MeterCategory и соответствующим значениям MeterName.

**Отчет об использовании Windows Server и Преимущества гибридного использования** отображает число виртуальных машин с включенным Преимуществом гибридного использования Azure. Он также содержит число ядер или виртуальных ЦП, используемых виртуальными машинами.

![Полный отчет о Преимуществе гибридного использования Azure](./media/analyze-cost-data-azure-cost-management-power-bi-template-app/ahb-report-full.png)

В этом отчете также представлены виртуальные машины Windows с **включенным** Преимуществом гибридного использования, имеющие _менее_ 8 виртуальных ЦП. В нем также показаны виртуальные машины с 8 _или более_ виртуальными ЦП, на которых Преимущество гибридного использования **не включено**. Эти сведения помогут вам полностью использовать Преимущество гибридного использования. Используйте его для самых дорогих виртуальных машин, чтобы обеспечить максимальную экономию.

![Виртуальные машины с менее 8 виртуальных ЦП и с включенным Преимуществом гибридного использования Azure; виртуальные машины с более 8 виртуальных ЦП и не включенным Преимуществом гибридного использования](./media/analyze-cost-data-azure-cost-management-power-bi-template-app/ahb-report.png)

**Отчет о выгоде резервирования экземпляров** поможет понять, где и в какой степени применяется преимущество зарезервированного экземпляра (RI) для каждого региона, подписки, группы ресурсов или ресурса. В этом отчете для отображения представления используются данные по погашению.

Вы можете применить фильтр по значению _chargetype_, чтобы просмотреть данные о недостаточной загрузке зарезервированного экземпляра.

Дополнительные сведения о данных по погашению см. в статье [Получение сведений о затратах на резервирование и использовании по Соглашениям Enterprise](../reservations/understand-reserved-instance-usage-ea.md).

**Отчет об экономии от резервирования экземпляров** содержит экономию, полученную благодаря резервированию уровня подписки, группы ресурсов и ресурса. В нем отображается следующее:

- расходы с резервированием;
- оценка стоимости по запросу без резервирования;
- сокращение затрат за счет резервирования.

 В отчете из общей суммы сэкономленных средств вычитаются все избыточные затраты на резервирование. Без резервирования избыточные затраты не возникли бы.

В качестве исходных данных можно использовать данные по погашению.

<a name="shared-recommendation"></a>
**Отчет о доле зарезервированных виртуальных машин (общая рекомендация)** разбит на данные об использовании виртуальных машин по запросу и зарезервированных виртуальных машин за выбранный период. Он содержит рекомендации по покупке зарезервированных виртуальных машин на уровне общих ресурсов.

Чтобы использовать отчет, выберите фильтр детализации.

![Отчет о доле зарезервированных виртуальных машин: выбор параметра детализации](./media/analyze-cost-data-azure-cost-management-power-bi-template-app/ri-drill-down2.png)

Выберите регион для анализа. Затем выберите группу гибкости размера экземпляра и т. д.

Для каждого уровня детализации к отчету применяются следующие фильтры.

- Данные справа формирует фильтр, показывающий, какой объем использования был оплачен с использованием ставки по запросу, а какой — посредством резервирования.
- Также фильтруются рекомендации.

В таблице рекомендаций приводятся рекомендации по приобретению резервирований на основе используемых размеров виртуальных машин.

Значения _Normalized Size_ (Нормализованный размер) и _Recommended Quantity Normalized_ (Рекомендуемое количество нормализованных) позволяют привести покупку в соответствие с наименьшим размером для группы гибкости размера экземпляра. Эта информация полезна, если планируется приобрести только одно резервирование для всех размеров в группе гибкости размера экземпляра.

![Рекомендации по резервированию экземпляров](./media/analyze-cost-data-azure-cost-management-power-bi-template-app/ri-recomendations.png)

**Отчет о доле зарезервированных виртуальных машин (общая рекомендация)** разбит на данные об использовании виртуальных машин по запросу и зарезервированных виртуальных машин за выбранный период времени. Он содержит рекомендации по покупке зарезервированных виртуальных машин на уровне подписки.

Дополнительные сведения см. в разделе об использовании [отчета о доле зарезервированных виртуальных машин](#shared-recommendation).

**Отчет о покупке зарезервированных экземпляров** содержит приобретенные зарезервированные экземпляры за указанный период.

**Отчет о ценах** содержит подробный список цен, относящихся к учетной записи выставления счетов или регистрации EA.

## <a name="troubleshoot-problems"></a>Устранение неполадок

Если у вас возникли проблемы с приложением Power BI, возможно, вам помогут следующие сведения по устранению неполадок.

### <a name="error-processing-the-data-in-the-dataset"></a>Ошибка обработки данных в наборе данных

Может появиться такое сообщение об ошибке:

```
There was an error when processing the data in the dataset.
Data source error: {"error":{"code":"ModelRefresh_ShortMessage_ProcessingError","pbi.error":{"code":"ModelRefresh_ShortMessage_ProcessingError","parameters":{},"details":[{"code":"Message","detail":{"type":1,"value":"We cannot convert the value \"Required Field: 'Enr...\" to type List."}}],"exceptionCulprit":1}}} Table: <TableName>.
```

Вместо `<TableName>` отображается имя таблицы.

#### <a name="cause"></a>Причина

При подключении к Управлению затратами было изменено значение **области** по умолчанию `Enrollment Number`.

#### <a name="solution"></a>Решение

Повторно подключитесь к Управлению затратами и задайте для **области** значение `Enrollment Number`. Не указывайте номер регистрации своей организации. Вместо него введите `Enrollment Number` точно так же, как показано на следующем изображении:

![Ввод сведений о регистрации EA](./media/analyze-cost-data-azure-cost-management-power-bi-template-app/ea-number.png)  

### <a name="budgetamount-error"></a>Ошибка BudgetAmount

Может появиться такое сообщение об ошибке:

```
Something went wrong
There was an error when processing the data in the dataset.
Please try again later or contact support. If you contact support, please provide these details.
Data source error: The 'budgetAmount' column does not exist in the rowset. Table: Budgets.
```

#### <a name="cause"></a>Причина

Эта ошибка происходит из-за проблем с базовыми метаданными. Она связана с отсутствием бюджета в разделе **Управление затратами > Бюджет** на портале Azure. На данный момент ее исправления развертывается в Power BI Desktop и службе Power BI. 

#### <a name="solution"></a>Решение

- Пока эта ошибка не будет исправлена, проблему можно обойти, добавив тестовый бюджет на портале Azure на уровне учетной записи выставления счетов или соглашения о регистрации EA. Тестовый бюджет разблокирует подключение к Power BI. Дополнительные сведения о создании бюджета см. в [руководстве по созданию бюджетов Azure и управление ими](tutorial-acm-create-budgets.md).


### <a name="invalid-credentials-for-azureblob-error"></a>Недопустимые учетные данные для ошибки AzureBlob

Может появиться такое сообщение об ошибке:

```
Failed to update data source credentials: The credentials provided for the AzureBlobs source are invalid.
```

#### <a name="cause"></a>Причина

Эта ошибка происходит при изменении метода проверки подлинности для подключения к большому двоичному объекту AutoFitComboMeter.

#### <a name="solution"></a>Решение

1. Подключитесь к данным.
1. Введите соглашение о регистрации EA и количество месяцев, оставьте значение по умолчанию **Анонимный** для метода проверки подлинности и **Нет** для параметра "Уровень конфиденциальности".  
  ![Снимок экрана: диалоговое окно подключения к приложению "Управление затратами Azure" с введенными значениями "Анонимный" и "Нет".](./media/analyze-cost-data-azure-cost-management-power-bi-template-app/autofit-troubleshoot.png)  
1. На следующей странице задайте **OAuth2** для метода проверки подлинности и **Нет** для параметра "Уровень конфиденциальности". Затем войдите в систему, чтобы пройти проверку подлинности путем регистрации. На этом шаге также запускается обновление данных Power BI.


## <a name="data-reference"></a>Описание данных

Ниже приведена сводка по данным, доступным в приложении. Также добавлены ссылки на интерфейсы API, которые предоставляют подробные сведения о полях данных и их значениях.

| **Ссылка на таблицу** | **Описание** |
| --- | --- |
| **AutoFitComboMeter** | Данные, содержащиеся в приложении для нормализации рекомендаций и данных об использовании зарезервированных экземпляров до наименьшего размера в группе семейства экземпляров. |
| [**Сводная информация о балансе**](/rest/api/billing/enterprise/billing-enterprise-api-balance-summary#response) | Сводка по балансу для Соглашений Enterprise. |
| [**Бюджеты**](/rest/api/consumption/budgets/get#definitions) | Сведения о бюджете для просмотра фактических затрат или данных об использовании по сравнению с существующими целями бюджета. |
| [**Прейскуранты**](/rest/api/billing/enterprise/billing-enterprise-api-pricesheet#see-also) | Применимые ставки за единицы измерения для указанного профиля выставления счетов или регистрации EA. |
| [**Расходы на зарезервированные экземпляры**](/rest/api/billing/enterprise/billing-enterprise-api-reserved-instance-charges#response) | Расходы, связанные с зарезервированными экземплярами, за последние 24 месяца. |
| [**Рекомендации по резервированию экземпляров (общие)**](/rest/api/billing/enterprise/billing-enterprise-api-reserved-instance-recommendation#response) | Рекомендации по приобретению зарезервированных экземпляров на основе тенденций использования всех подписок за последние 7 дней. |
| [**Рекомендации по резервированию экземпляров (отдельные)**](/rest/api/billing/enterprise/billing-enterprise-api-reserved-instance-recommendation#response-1) | Рекомендации по приобретению зарезервированных экземпляров на основе тенденций использования отдельной подписки за последние 7. |
| [**Данные об использовании зарезервированных экземпляров**](/rest/api/billing/enterprise/billing-enterprise-api-reserved-instance-usage#response) | Сведения об использовании имеющихся зарезервированных экземпляров за последний месяц. |
| [**Сводка по использованию зарезервированных экземпляров**](/rest/api/consumption/reservationssummaries/list) | Данные о ежедневном использовании резервирования Azure в процентах. |
| [**Сведения об использовании**](/rest/api/billing/enterprise/billing-enterprise-api-usage-detail#usage-details-field-definitions) | Разбивка потребленного количества и предполагаемой платы для указанного профиля выставления счетов в регистрации EA. |
| [**Сведения о погашении**](/rest/api/billing/enterprise/billing-enterprise-api-usage-detail#usage-details-field-definitions) | Разбивка потребленного количества и предполагаемых сумм погашения для указанного профиля выставления счетов в регистрации EA. |

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения о настройке данных, обновлении, публикации отчетов и дополнительной настройке отчетов представлены в следующих статьях:

- [Настройка запланированного обновления](/power-bi/refresh-scheduled-refresh)
- [Предоставление общего доступа коллегам и другим пользователям к панелям мониторинга и отчетам Power BI](/power-bi/service-share-dashboards)
- [Как подписать себя и других пользователей на отчеты и панели мониторинга в службе Power BI](/power-bi/service-report-subscribe)
- [Скачивание отчета из служба Power BI в Power BI Desktop](/power-bi/service-export-to-pbix)
- [Сохранение отчета в службе Power BI и Power BI Desktop](/power-bi/service-report-save)
- [Создание отчета в службе Power BI путем импорта набора данных](/power-bi/service-report-create-new)