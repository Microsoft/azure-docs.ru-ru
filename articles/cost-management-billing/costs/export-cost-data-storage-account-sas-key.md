---
title: Экспорт данных о затратах с помощью ключа SAS учетной записи службы хранилища Azure
description: Эта статья поможет нашим партнерам создать ключ SAS и настроить экспорт в службе "Управление затратами".
author: bandersmsft
ms.author: banders
ms.date: 03/08/2021
ms.topic: how-to
ms.service: cost-management-billing
ms.subservice: cost-management
ms.reviewer: adwise
ms.openlocfilehash: 16302a6bcc3bf41432500d2fdaa4ec27c28dd5b3
ms.sourcegitcommit: 15d27661c1c03bf84d3974a675c7bd11a0e086e6
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/09/2021
ms.locfileid: "102509637"
---
# <a name="export-cost-data-with-an-azure-storage-account-sas-key"></a>Экспорт данных о затратах с помощью ключа SAS учетной записи службы хранилища Azure

Приведенные ниже сведения предназначены только для партнеров корпорации Майкрософт.

Часто у партнеров нет собственных подписок Azure в арендаторе, связанном с Соглашением с партнером Майкрософт. Партнеры, которые имеют план Соглашения с партнером Майкрософт и являются глобальными администраторами своей учетной записи выставления счетов, могут экспортировать и копировать данные о затратах в учетную запись хранения, размещенную в другом арендаторе, с помощью ключа службы общего доступа (SAS). Иными словами, учетная запись хранения с ключом SAS позволяет партнеру использовать для получения экспортированной информации учетную запись хранения, которая не входит в его партнерское соглашение. Эта статья поможет нашим партнерам создать ключ SAS и настроить экспорт в службе "Управление затратами".

## <a name="requirements"></a>Требования

- Вы должны быть партнером, иметь Соглашение с партнером Майкрософт и клиентов с планом Azure.
- Вы должны иметь права глобального администратора для учетной записи выставления счетов партнерской организации.
- Вам нужен доступ к настройкам учетной записи хранения, которая находится в другом арендаторе партнерской организации. Вы самостоятельно отвечаете за обеспечение необходимых разрешений и доступа к данным при экспорте данных в учетную запись хранения.

## <a name="configure-azure-storage-with-a-sas-key"></a>Настройка службы хранилища Azure с помощью ключа SAS

Получите маркер SAS для учетной записи хранения или создайте его с помощью портала Azure. Чтобы создать такой маркер на портале Azure, выполните следующие действия. Дополнительные сведения о ключах SAS см. в статье [Предоставление ограниченного доступа к данным с помощью подписанных URL-адресов (SAS).](../../storage/common/storage-sas-overview.md)

1. Перейдите на портале Azure к учетной записи хранения.
    - Если у этой учетной записи есть доступ к нескольким арендаторам, выберите нужный каталог, чтобы получить доступ к учетной записи хранения. Выберите учетную запись в правом верхнем углу портала Azure, а затем щелкните **Переключить каталоги**.
    - Возможно, для доступа к учетной записи хранения придется выполнить вход на портал Azure с учетной записью соответствующего арендатора.
1. В меню слева щелкните **Подписанный URL-адрес**.  
    :::image type="content" source="./media/export-cost-data-storage-account-sas-key/storage-shared-access-signature.png" alt-text="Снимок экрана: настроенный подписанный URL-адрес для хранилища Azure." lightbox="./media/export-cost-data-storage-account-sas-key/storage-shared-access-signature.png" :::
1. Настройте для маркера такие же параметры, как на рисунке выше.
    1. Выберите значение **BLOB-объект** для параметра _Допустимые службы_.
    1. В разделе _Разрешенные типы ресурсов_ выберите **Служба**, **Контейнер** и **Объект**.
    1. В разделе _Предоставленные разрешения_ выберите **Чтение**, **Запись**, **Удаление**, **Список**, **Добавление** и **Создание**.
    1. Выберите режим и даты для срока действия. Не забывайте регулярно обновлять маркер SAS для экспорта, пока не истек срок его действия. Чем больший период времени вы укажете для срока действия, тем реже вам придется обновлять маркер SAS для нормальной работы экспорта.
1. Выберите **Только HTTPS** для параметра _Разрешенные протоколы_.
1. Выберите **Базовый** для параметра _Preferred routing tier_ (Предпочитаемый уровень маршрутизации).
1. Выберите **key1** для параметра _Ключ для подписи_. Если сменится или обновится ключ, который вы использовали для подписывания маркера SAS, вам придется создать новый маркер SAS для экспорта.
1. Выберите действие **Создать SAS и строку подключения**.
    Отображаемое здесь значение **Маркер SAS** потребуется вам для настройки экспорта.

## <a name="create-a-new-export-with-a-sas-token"></a>Создание нового экспорта с маркером SAS

Перейдите в раздел **Экспорты** в области учетной записи выставления счетов и создайте новый экспорт, выполнив следующие действия.

1. Нажмите кнопку **создания**.
1. Настройте все параметры, как для обычного экспорта. Вы можете настроить для экспорта существующий каталог или контейнер, а также задать новый каталог или контейнер, и тогда они будут автоматически созданы при операции экспорта.
1. При настройке хранилища установите флажок **Использовать маркер SAS**.  
    :::image type="content" source="./media/export-cost-data-storage-account-sas-key/new-export.png" alt-text="Снимок экрана: настройка нового экспорта и интерфейс для выбора маркера SAS." lightbox="./media/export-cost-data-storage-account-sas-key/new-export.png" :::
1. Введите имя учетной записи хранения и вставьте маркер SAS.
1. Укажите существующий контейнер или каталог или укажите, что нужно создать новые.
1. Нажмите кнопку **создания**.

Экспорт на основе маркера SAS работает только до тех пор, пока этот маркер остается действительным. Назначьте новый маркер, пока не истек срок действия прежнего, иначе экспорт перестанет работать. Поскольку этот маркер предоставляет доступ к учетной записи хранения, его следует защищать так же строго, как любые конфиденциальные сведения. Вы самостоятельно отвечаете за обеспечение необходимых разрешений и доступа к данным при экспорте данных в учетную запись хранения.

## <a name="troubleshoot-exports-using-sas-tokens"></a>Устранение неполадок экспорта при использовании маркеров SAS

Ниже перечислены типичные проблемы, которые могут возникнуть при настройке или использовании экспорта на основе маркеров SAS.

- На портале Azure отсутствует возможность применить ключ SAS.
  - Убедитесь, что вы являетесь партнером и имеете Соглашение с партнером Майкрософт, а также права глобального администратора для учетной записи выставления счетов. Только такие пользователи могут выполнять экспорт с использованием ключа SAS.

- При попытке настроить экспорт вы видите такое сообщение об ошибке:

    **Please ensure the SAS token is valid for blob service, is valid for container and object resource types, and has permissions: add create read write delete. (Storage service error code: AuthorizationResourceTypeMismatch)** (Убедитесь, что маркер SAS действителен для службы BLOB-объектов, является допустимым для типов ресурсов контейнера и объекта и имеет разрешения "добавление, создание, чтение, запись и удаление". Код ошибки службы хранилища: AuthorizationResourceTypeMismatch)

    - Убедитесь, что вы правильно настраиваете и создаете ключ SAS в службе хранилища Azure.

- После создания экспорта вы не видите полный ключ SAS.
  - Отсутствие доступа к ключу является ожидаемым поведением. После завершения настройки экспорта SAS этот ключ скрывается по соображениям безопасности.

- Вы не можете получить доступ к учетной записи хранения из того арендатора, где настроен экспорт.
  - Это ожидаемое поведение. Если учетная запись хранения находится в другом арендаторе, для доступа к этой учетной записи хранения следует сначала перейти к соответствующему арендатору на портале Azure.

- Не удается выполнить экспорт из-за ошибки, связанной с маркером SAS.
  - Экспорт будет работать только до тех пор, пока маркер SAS остается действительным. Создайте новый ключ и повторите экспорт.

## <a name="next-steps"></a>Дальнейшие действия

- Дополнительные сведения об экспорте данных службы "Управление затратами" см. в [руководстве по созданию и экспорту данных](tutorial-export-acm-data.md).
- Дополнительные сведения об экспорте больших объемов данных о потреблении см. в статье [Извлечение больших наборов данных с помощью экспорта](ingest-azure-usage-at-scale.md).
