---
title: Получение данных о потреблении с помощью API-интерфейсов выставления счетов
description: Сведения об интерфейсах API использования и RateCard для выставления счетов Azure, которые применяются для получения ценных сведений о потреблении ресурсов Azure и соответствующих тенденциях.
author: tonguyen
ms.reviewer: mumami
tags: billing
ms.service: cost-management-billing
ms.subservice: common
ms.topic: reference
ms.date: 02/12/2020
ms.author: banders
ms.custom: seodec18
ms.openlocfilehash: 15e8a31c7ca3b87a8bf92a520bcf07de1e063efd
ms.sourcegitcommit: fc401c220eaa40f6b3c8344db84b801aa9ff7185
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/20/2021
ms.locfileid: "98599148"
---
# <a name="use-azure-billing-apis-to-programmatically-get-insight-into-your-azure-usage"></a>Использование API выставления счетов Azure для программного получения ценных сведений об использовании Azure
Используйте API выставления счетов Azure для извлечения данных об использовании и ресурсах в предпочитаемые средства анализа данных. API использования ресурсов и RateCard в Azure позволяют точно прогнозировать расходы и управлять ими. Интерфейсы API реализованы в виде поставщика ресурсов и относятся к семейству API, предоставляемых Azure Resource Manager.  

## <a name="azure-invoice-download-api-preview"></a>API для скачивания счетов Azure (предварительная версия)
Один раз [предоставив согласие](manage-billing-access.md#opt-in), вы можете скачивать счета с помощью предварительной версии [API счетов](/rest/api/billing). Доступны следующие функции:

* **Управление доступом на основе ролей Azure (Azure RBAC)** . Настройте политики доступа на [портале Azure](https://portal.azure.com) или с помощью [командлетов Azure PowerShell](/powershell/azure/), чтобы указать, какие пользователи или приложения могут получить доступ к данным об использовании в рамках подписки. Вызывающие объекты должны использовать стандартные маркеры Azure Active Directory для проверки подлинности. Добавьте вызывающий объект в роль читателя счетов, читателя, владельца или участника, чтобы получить доступ к данным об использовании для конкретной подписки Azure.
* **Фильтрация дат** — используйте параметр `$filter` для получения всех счетов в обратном хронологическом порядке по дате окончания расчетного периода.

> [!NOTE]
> Эта функция находится на первом этапе предварительной версии, поэтому для нее может не обеспечиваться обратная совместимость. Сейчас она недоступна для определенных предложений подписки (не поддерживаются EA, CSP, AIO), а также в Azure для Германии.

## <a name="azure-resource-usage-api-preview"></a>API использования ресурсов Azure (предварительная версия)
Применяйте [API использования ресурсов](/previous-versions/azure/reference/mt219003(v=azure.100)) Azure для получения оценочных данных об уровне потребления Azure. API включает в себя следующие функции:

* **Управление доступом на основе ролей Azure (Azure RBAC)** . Настройте политики доступа на [портале Azure](https://portal.azure.com) или с помощью [командлетов Azure PowerShell](/powershell/azure/), чтобы указать, какие пользователи или приложения могут получить доступ к данным об использовании в рамках подписки. Вызывающие объекты должны использовать стандартные маркеры Azure Active Directory для проверки подлинности. Добавьте вызывающий объект в роль читателя счетов, читателя, владельца или участника, чтобы получить доступ к данным об использовании для конкретной подписки Azure.
* **Hourly or Daily Aggregations** (Агрегирование по часам или по дням) — вызывающие объекты могут указать, требуется ли получать данные об использовании Azure сегментами за каждый час или за каждый день. По умолчанию используется получение сегментов за каждый день.
* **Instance metadata (includes resource tags)** (Метаданные экземпляров, включая теги ресурсов). Сведения уровня экземпляра, например полный URI-код ресурса (/subscriptions/{идентификатор подписки}/..), информация о группе ресурсов и теги ресурсов. Эти метаданные помогут вам детерминированно и программно распределять использование по тегам для таких вариантов использования, как перекрестное выставление счетов.
* **Resource metadata** (Метаданные ресурсов). Сведения о ресурсах, такие как имя индикатора, категория индикатора, подкатегория индикатора, единица измерения и регион, позволяющие клиентам получить более полное представление о потребленных ресурсах. Мы также работаем над согласованием терминологии метаданных для портала Azure, файлов сведений об использовании Azure, файлов сведений о выставлении счетов по EA и других общедоступных механизмов, чтобы разрешить вам соотносить данные из разных областей.
* **Использование для разных видов предложений.** Данные об использовании доступны для таких видов предложений, как оплата по мере использования, MSDN, предоплата Azure (прежнее название — денежное обязательство), кредит для предоплаты Azure и EA, кроме [CSP](/partner-center).

## <a name="azure-resource-ratecard-api-preview"></a>API RateCard по ресурсам Azure (предварительная версия)
Используйте [API RateCard по ресурсам Azure](/previous-versions/azure/reference/mt219005(v=azure.100)) для получения списка доступных ресурсов Azure, а также примерной стоимости каждого из них. API включает в себя следующие функции:

* **Управление доступом на основе ролей Azure (Azure RBAC)** . Настройте политики доступа на [портале Azure](https://portal.azure.com) или с помощью [командлетов Azure PowerShell](/powershell/azure/), чтобы указать, какие пользователи или приложения могут получить доступ к данным RateCard. Вызывающие объекты должны использовать стандартные маркеры Azure Active Directory для проверки подлинности. Добавьте вызывающий объект в роль читателя, владельца или участника, чтобы получить доступ к данным об использовании для конкретной подписки Azure.
* **Поддержка оплаты по мере использования, MSDN, предоплаты Azure, кредита для предоплаты Azure, (EA и [CSP](/partner-center) не поддерживается).** Этот API предоставляет сведения о тарифах Azure на уровне предложений.  Вызывающий объект этого API должен передать сведения о предложении, чтобы получить информацию о ресурсах и тарифы. Так как в рамках EA действуют специальные тарифы для каждой регистрации, в настоящее время мы не можем предоставить сведения о тарифах для EA.

## <a name="scenarios"></a>Сценарии
Ниже приведено несколько сценариев, которые становятся возможными благодаря сочетанию API использования и RateCard.

* **Azure spend during the month** (Затраты на Azure в течение месяца). Используйте сочетание API использования и RateCard, чтобы получить более ценные сведения о затратах на облако в течение месяца. Вы можете анализировать данные оценки использования и затрат сегментами за каждый час или за каждый день.
* **Set up alerts** (Настройка оповещений). API использования и RateCard можно использовать для получения оценочных показателей потребления облака и издержек, а также настройки оповещений на основе ресурсов или денежных средств.
* **Predict bill** (Прогнозирование счета). Получите оценочные показатели потребления и издержек для облака и примените алгоритмы машинного обучения, чтобы спрогнозировать сумму счета в конце цикла выставления счетов.
* **Pre-consumption cost analysis** (Анализ затрат до потребления). Используйте API RateCard, чтобы спрогнозировать размер счета для ожидаемого использования в случае переноса рабочих нагрузок в Azure. При наличии имеющихся рабочих нагрузок в других облаках и частных облаках можно также сопоставить использование с тарифами Azure, чтобы точнее определить расходы Azure. Эта оценка предоставляет позволяет получить сводку по предложению, а также результаты сравнения и противопоставления разных типов предложений, выходящих за рамки оплаты по мере использования, таких как предоплата Azure и кредит для предоплаты Azure. API также позволяют оценить разницу в затратах по регионам, в результате чего становится возможен анализ "что если", необходимый для принятия решений о развертывании.
* **What-if analysis** -

  * Вы можете определить, выгоднее ли выполнять рабочие нагрузки в другом регионе или с другой конфигурацией ресурсов Azure. Стоимость ресурсов Azure может отличаться в зависимости от используемого региона Azure.
  * Вы также можете определить, предоставляет ли другое предложение Azure более выгодный тариф на ресурс Azure.


## <a name="next-steps"></a>Дальнейшие действия
* Вы можете ознакомиться с примерами кода в GitHub:
  * [Пример кода API счетов](https://go.microsoft.com/fwlink/?linkid=845124)

  * [Пример кода API использования](https://github.com/Azure-Samples/billing-dotnet-usage-api)

  * [Пример кода API RateCard](https://github.com/Azure-Samples/billing-dotnet-ratecard-api)

* Дополнительные сведения о Azure Resource Manager см. в статье [Обзор Azure Resource Manager](../../azure-resource-manager/management/overview.md).