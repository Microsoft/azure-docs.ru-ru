---
title: Перезапись URL-адреса и строки запроса с помощью шлюза приложений Azure — портал Azure
description: Узнайте, как использовать портал Azure, чтобы настроить шлюз приложений Azure для перезаписи URL-адреса и строки запроса
services: application-gateway
author: surajmb
ms.service: application-gateway
ms.topic: how-to
ms.date: 7/16/2020
ms.author: surmb
ms.openlocfilehash: ec58c6f97efdbcb91071bcea98bbbc614833246d
ms.sourcegitcommit: 772eb9c6684dd4864e0ba507945a83e48b8c16f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "92215779"
---
# <a name="rewrite-url-with-azure-application-gateway---azure-portal-preview"></a>Перезапись URL-адреса с помощью шлюза приложений Azure — портал Azure (Предварительная версия)

В этой статье описывается, как использовать портал Azure для настройки экземпляра [SKU шлюза приложений версии 2](application-gateway-autoscaling-zone-redundant.md) для перезаписи URL-адреса.

>[!NOTE]
> Функция переопределения URL-адресов доступна в предварительной версии и доступна только для Standard_v2 и WAF_v2 SKU шлюза приложений. Не рекомендуется использовать в рабочей среде. Дополнительные сведения о предварительных версиях см. в [статье условия использования](https://azure.microsoft.com/support/legal/preview-supplemental-terms/).

Если у вас еще нет подписки Azure, [создайте бесплатную учетную запись](https://azure.microsoft.com/free/?WT.mc_id=A261C142F), прежде чем начинать работу.

## <a name="before-you-begin"></a>Перед началом

Для выполнения действий, описанных в этой статье, необходимо иметь экземпляр SKU шлюза приложений версии 2. Перезапись URL-адреса не поддерживается в номере SKU v1. Если у вас нет номера SKU v2, создайте экземпляр [шлюза приложений версии 2 (SKU](tutorial-autoscale-ps.md) ) перед началом.

## <a name="sign-in-to-azure"></a>Вход в Azure

Войдите на [портал Azure](https://portal.azure.com/) с помощью своей учетной записи Azure.

## <a name="configure-url-rewrite"></a>Настройка переопределения URL-адресов

В приведенном ниже примере каждый раз, когда URL-адрес запроса содержит */артикле*, выполняется перезапись URL-пути и строки запроса URL-адреса.

`contoso.com/article/123/fabrikam` -> `contoso.com/article.aspx?id=123&title=fabrikam`

1. Выберите **все ресурсы**, а затем выберите свой шлюз приложений.

2. Выберите **Перезапись** в левой области.

3. Выберите **набор перезаписи**:

    :::image type="content" source="./media/rewrite-url-portal/rewrite-url-portal-1.png" alt-text="Добавить набор перезаписи":::

4. Укажите имя для набора перезаписи и свяжите его с правилом маршрутизации:

    а. Введите имя набора перезаписи в поле **имя** .
    
    b. Выберите одно или несколько правил, перечисленных в списке **связанные правила маршрутизации** . Используется для связывания конфигурации перезаписи с прослушивателем источника с помощью правила маршрутизации. Можно выбрать только те правила маршрутизации, которые не связаны с другими наборами перезаписи. Правила, которые уже связаны с другими наборами перезаписи, неактивны.
    
    c. Выберите **Далее**.
    
    :::image type="content" source="./media/rewrite-url-portal/rewrite-url-portal-2.png" alt-text="Связать с правилом":::

5. Создайте правило перезаписи:

    а. Выберите **Добавить правило перезаписи**.
    
    :::image type="content" source="./media/rewrite-url-portal/rewrite-url-portal-3.png" alt-text="Снимок экрана, посвященный добавлению правила перезаписи.":::
    
    b. Введите имя для правила перезаписи в поле **имя правила перезаписи** . Введите число в поле **последовательность правил** .

6. В этом примере мы будем перезаписывать URL-адрес и строку запроса URL-адреса, только если путь содержит */артикле*. Для этого добавьте условие, определяющее, содержит ли URL-путь */артикле* .

    а. Выберите **Добавить условие** , а затем выберите поле, содержащее инструкции **If** , чтобы развернуть его.
    
    b. Так как в этом примере мы хотим проверить шаблон */артикле* в URL-пути, в списке **тип проверяемой переменной** выберите **Серверная переменная**.
    
    c. В списке **Переменная сервера** выберите uri_path
    
    d. В разделе **с учетом регистра** выберите **нет**.
    
    д) В списке **оператор** выберите **равно (=)**.
    
    е) Введите шаблон регулярного выражения. В этом примере мы будем использовать шаблон `.*article/(.*)/(.*)`
    
      () используется для записи подстроки для последующего использования в составлении выражения для перезаписи пути URL-адреса. Дополнительные сведения см. [здесь](rewrite-http-headers-url.md#capturing).

    ж. Щелкните **ОК**.

    :::image type="content" source="./media/rewrite-url-portal/rewrite-url-portal-4.png" alt-text="Condition":::

 

7. Добавление действия для перезаписи URL-адреса и пути URL-адреса

   а. В списке **тип перезаписи** выберите **URL-адрес**.

   b. В списке **тип действия** выберите **задать**.

   c. В разделе **компоненты** выберите **URL-путь и строку запроса URL-адреса** .

   d. В поле **URL-путь** введите новое значение пути. В этом примере мы будем использовать **/артикле.аспкс** 

   д) В поле **строка запроса URL** введите новое значение строки запроса URL-адреса. В этом примере мы будем использовать **ID = {var_uri_path_1} &Title = {var_uri_path_2}**
    
    `{var_uri_path_1}` и `{var_uri_path_1}` используются для выборки подстрок, захваченных при вычислении условия в этом выражении `.*article/(.*)/(.*)`
    
   е) Щелкните **ОК**.

    :::image type="content" source="./media/rewrite-url-portal/rewrite-url-portal-5.png" alt-text="Действие":::

8. Нажмите кнопку **создать** , чтобы создать набор перезаписи.

9. Убедитесь, что новый набор перезаписи отображается в списке наборов перезаписи

    :::image type="content" source="./media/rewrite-url-portal/rewrite-url-portal-6.png" alt-text="Добавить правило перезаписи":::

## <a name="verify-url-rewrite-through-access-logs"></a>Проверка перезаписи URL-адресов с помощью журналов доступа

Обратите внимание на следующие поля в журналах доступа, чтобы проверить, не произошло ли перезапись URL-адреса в соответствии с вашими ожиданиями.

* **оригиналрекуестуривисаргс**: это поле содержит исходный URL-адрес запроса
* **RequestUri**: это поле содержит URL-адрес после операции перезаписи в шлюзе приложений

Дополнительные сведения обо всех полях в журналах доступа см. [здесь](application-gateway-diagnostics.md#for-application-gateway-and-waf-v2-sku).

##  <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения о настройке перезаписи для некоторых распространенных вариантов использования см. в разделе [распространенные сценарии перезаписи](rewrite-http-headers.md).
