---
title: Создание пользовательской пробы с помощью портала
titleSuffix: Azure Application Gateway
description: Узнайте, как создать пользовательскую пробу для шлюза приложений с помощью портала.
services: application-gateway
author: vhorne
ms.service: application-gateway
ms.topic: how-to
ms.date: 07/09/2020
ms.author: victorh
ms.openlocfilehash: 5d2760415e4f4ef3b181f2fb69802659fec3ef66
ms.sourcegitcommit: 910a1a38711966cb171050db245fc3b22abc8c5f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "95975961"
---
# <a name="create-a-custom-probe-for-application-gateway-by-using-the-portal"></a>Создание пользовательской пробы для шлюза приложений с помощью портала

> [!div class="op_single_selector"]
> * [Портал Azure](application-gateway-create-probe-portal.md)
> * [PowerShell и диспетчер ресурсов Azure](application-gateway-create-probe-ps.md)
> * [Классическая оболочка Azure](application-gateway-create-probe-classic-ps.md)

В этой статье вы добавите настраиваемую проверку работоспособности в существующий шлюз приложений с помощью портал Azure. С помощью проб работоспособности шлюз приложений Azure отслеживает работоспособность ресурсов в пуле серверной части.

## <a name="before-you-begin"></a>Перед началом

Если у вас нет шлюза приложений, ознакомьтесь с [этой статьей](./quick-create-portal.md), чтобы создать его.

## <a name="create-probe-for-application-gateway-v2-sku"></a>Создание пробы SKU для шлюза приложений версии 2

На портале пробы настраиваются в два этапа. Первым шагом является ввод значений, необходимых для конфигурации зонда. На втором шаге выполняется проверка работоспособности серверной части с помощью этой конфигурации проверки и сохранение пробы. 

### <a name="enter-probe-properties"></a><a name="createprobe"></a>Введите свойства зонда

1. Войдите на [портал Azure](https://portal.azure.com). Если у вас еще нет учетной записи, вы можете зарегистрироваться для получения [бесплатной пробной версии на один месяц](https://azure.microsoft.com/free) .

2. На портале Azure в области "Избранное" щелкните "Все ресурсы". Выберите шлюз приложений в колонке "Все ресурсы". Если выбранная подписка имеет несколько ресурсов, в поле "Фильтровать по имени..." введите partners.contoso.net, чтобы быстро получить доступ к необходимому шлюзу приложений.

3. Выберите **зонды работоспособности** и нажмите кнопку **Добавить** , чтобы добавить новую проверку работоспособности.

   ![Добавить новую проверку][4]

4. На странице **Добавление проверки работоспособности** заполните необходимые сведения для пробы и после завершения нажмите кнопку **ОК**.

   |**Параметр** | **Значение** | **Сведения**|
   |---|---|---|
   |**имя**;|customProbe|Это понятное имя, присвоенное зонду, доступному на портале.|
   |**Протокол**|HTTP или HTTPS | Протокол, используемый пробой работоспособности. |
   |**Узел**|Например, contoso.com|Это значение представляет собой имя виртуального узла (отличается от имени узла виртуальной машины), выполняющегося на сервере приложений. Проба отправляется в \<protocol\> :// \<host name\> :\<port\>/\<urlPath\>|
   |**Выбор имени узла из серверных параметров HTTP**|"Да" или "Нет".|Задает заголовок *узла* в зонде в качестве имени узла из параметров HTTP, с которыми связан этот зонд. Требуется специально в случае с многоклиентским интерфейсом, например службой приложений Azure. [Дополнительные сведения](./configuration-http-settings.md#pick-host-name-from-back-end-address)|
   |**Выбрать порт из серверных параметров HTTP**| "Да" или "Нет".|Задает порт *для* проверки работоспособности порта в ПАРАМЕТРах HTTP, с которыми связан этот зонд. Если вы выберете "нет", можно ввести настраиваемый порт назначения для использования |
   |**порт**.| 1-65535 | Пользовательский порт, используемый для проб работоспособности | 
   |**Путь**|/или любой допустимый путь|Остальная часть полного URL-адреса пользовательской пробы. Путь должен начинаться с /. Для пути по умолчанию http: \/ /contoso.com просто используйте "/". |
   |**Интервал (с)**|30|Интервал между выполнением проб работоспособности. Не рекомендуется задавать значение менее 30 секунд.|
   |**Время ожидания (с)**|30|Количество времени, в течение которого проба проверяется до истечения времени ожидания. Если в течение этого времени ожидания не получен допустимый ответ, проба помечается как сбойный. Интервал времени ожидания должен быть достаточно большим для выполнения HTTP-вызова, чтобы обеспечить доступность страницы с данными о работоспособности внутреннего сервера. Обратите внимание, что значение времени ожидания не должно превышать значение "Interval", используемое в этом параметре проверки, или значение "запрос Timeout" в параметре HTTP, который будет связан с этой проверкой.|
   |**Пороговое значение сбоя**|3|Количество последовательных неудачных попыток, которые будут считаться неработоспособными. Пороговое значение можно задать равным 1 или более.|
   |**Использовать условия проверки совпадения**|"Да" или "Нет".|По умолчанию ответ HTTP(S) с кодом состояния 200–399 указывает на работоспособность. Вы можете изменить допустимый диапазон кода ответа серверной части или текст ответа внутреннего сервера. [Дополнительные сведения](./application-gateway-probe-overview.md#probe-matching)|
   |**Параметры HTTP**|выбор из раскрывающегося списка|Проверка будет связана с выбранными параметрами HTTP и, следовательно, будет отслеживать работоспособность этого внутреннего пула, связанного с выбранным параметром HTTP. Он будет использовать один и тот же порт для запроса пробы, который используется в выбранном параметре HTTP. Можно выбрать только те параметры HTTP, которые не связаны с другими пользовательскими зондами. <br>Обратите внимание, что для связи доступны только те параметры HTTP, которые имеют тот же протокол, что и протокол, выбранный в этой конфигурации проверки, и имеют то же состояние, что и *имя узла для выбора из параметра HTTP-параметр серверной части* .|
   
   > [!IMPORTANT]
   > Проба будет отслеживать работоспособность серверной части только в том случае, если она связана с одним или несколькими параметрами HTTP. Он будет отслеживать серверные ресурсы этих внутренних пулов, связанные с параметрами HTTP, с которыми связана эта проверка. Запрос на пробу будет отправлен как \<protocol\> :// \<hostName\> : \<port\> / \<urlPath\> .

### <a name="test-backend-health-with-the-probe"></a>Проверка работоспособности серверной части с помощью пробы

После ввода свойств зонда можно проверить работоспособность серверных ресурсов, чтобы убедиться, что конфигурация зонда верна и что серверные ресурсы работают должным образом.

1. Выберите **тест** и запишите результат пробы. Шлюз приложений проверяет работоспособность всех внутренних ресурсов в серверных пулах, связанных с параметрами HTTP, используемыми для этой проверки. 

   ![Проверка работоспособности серверной части][5]

2. При наличии неработоспособных ресурсов серверной части проверьте столбец **сведений** , чтобы понять причину неработоспособного состояния ресурса. Если ресурс был помечен как неработоспособный из-за неверной конфигурации зонда, выберите ссылку **вернуться к зонду** и измените конфигурацию пробы. В противном случае, если ресурс был помечен как неработоспособный из-за проблемы с серверной частью, устраните проблемы с внутренним ресурсом, а затем снова протестируйте серверную часть, выбрав ссылку **вернуться к зонду** и выбрав **тест**.

   > [!NOTE]
   > Вы можете сохранить пробу даже с неработоспособными внутренними ресурсами, но это не рекомендуется сделать. Это связано с тем, что шлюз приложений не будет пересылать запросы внутренним серверам из внутреннего пула, которые определены как неработоспособные для пробы. Если в серверном пуле нет работоспособных ресурсов, вы не сможете получить доступ к приложению и получится ошибка HTTP 502.

   ![Просмотреть результат проверки][6]

3. Нажмите кнопку **Добавить** , чтобы сохранить зонд. 

## <a name="create-probe-for-application-gateway-v1-sku"></a>Создание пробы SKU для шлюза приложений версии v1

На портале пробы настраиваются в два этапа. Сначала нужно создать пробу. Затем следует добавить ее в параметры протокола HTTP серверной части приложения шлюза.

### <a name="create-the-probe"></a><a name="createprobe"></a>Создание пробы

1. Войдите на [портал Azure](https://portal.azure.com). Если у вас еще нет учетной записи, вы можете зарегистрироваться для получения [бесплатной пробной версии на один месяц](https://azure.microsoft.com/free) .

2. На портале Azure в области Избранное выберите **Все ресурсы**. Выберите шлюз приложений на странице **все ресурсы** . Если выбранная подписка имеет несколько ресурсов, в поле "Фильтровать по имени..." введите partners.contoso.net, чтобы быстро получить доступ к необходимому шлюзу приложений.

3. Выберите **зонды** и нажмите кнопку **Добавить** , чтобы добавить пробу.

   ![Колонка добавления пробы с заполненной информацией][1]

4. В колонке **Добавление проверки работоспособности** заполните необходимые сведения для пробы и по завершении нажмите кнопку **ОК**.

   |**Параметр** | **Значение** | **Сведения**|
   |---|---|---|
   |**имя**;|customProbe|Это понятное имя, присвоенное зонду, доступному на портале.|
   |**Протокол**|HTTP или HTTPS | Протокол, используемый пробой работоспособности. |
   |**Узел**|Например, contoso.com|Это значение представляет собой имя виртуального узла (отличается от имени узла виртуальной машины), выполняющегося на сервере приложений. Проба отправляется в (протокол)://(имя узла):(порта из хттпсеттинг)/Урлпас.  Это применимо, если для шлюза приложений настроено несколько сайтов. Если шлюз приложений настроен для одного сайта, введите "127.0.0.1".|
   |**Выбор имени узла из серверных параметров HTTP**|"Да" или "Нет".|Устанавливает заголовок *узла* в зонде на имя узла серверного ресурса во внутреннем пуле, связанном с ПАРАМЕТРом HTTP, с которым связана эта проверка. Требуется специально в случае с многоклиентским интерфейсом, например службой приложений Azure. [Дополнительные сведения](./configuration-http-settings.md#pick-host-name-from-back-end-address)|
   |**Путь**|/или любой допустимый путь|Остальная часть полного URL-адреса пользовательской пробы. Путь должен начинаться с /. Для пути по умолчанию http: \/ /contoso.com просто используйте "/". |
   |**Интервал (с)**|30|Интервал между выполнением проб работоспособности. Не рекомендуется задавать значение менее 30 секунд.|
   |**Время ожидания (с)**|30|Количество времени, в течение которого проба проверяется до истечения времени ожидания. Если в течение этого времени ожидания не получен допустимый ответ, проба помечается как сбойный. Интервал времени ожидания должен быть достаточно большим для выполнения HTTP-вызова, чтобы обеспечить доступность страницы с данными о работоспособности внутреннего сервера. Обратите внимание, что значение времени ожидания не должно превышать значение "Interval", используемое в этом параметре проверки, или значение "запрос Timeout" в параметре HTTP, который будет связан с этой проверкой.|
   |**Пороговое значение сбоя**|3|Количество последовательных неудачных попыток, которые будут считаться неработоспособными. Пороговое значение можно задать равным 1 или более.|
   |**Использовать условия проверки совпадения**|"Да" или "Нет".|По умолчанию ответ HTTP(S) с кодом состояния 200–399 указывает на работоспособность. Вы можете изменить допустимый диапазон кода ответа серверной части или текст ответа внутреннего сервера. [Дополнительные сведения](./application-gateway-probe-overview.md#probe-matching)|

   > [!IMPORTANT]
   > Имя узла не является именем сервера. Это имя виртуального узла, который выполняется на сервере приложений. Проба отправляется в \<protocol\> :// \<hostName\> :\<port from http settings\>/\<urlPath\>

### <a name="add-probe-to-the-gateway"></a>Добавление пробы в шлюз

После создания пробы пора добавить ее в шлюз. Настройки пробы задаются в параметрах протокола HTTP серверной части приложения шлюза.

1. Щелкните **Настройки HTTP** для шлюза приложения и откройте колонку конфигурации, выбрав текущие параметры HTTP серверной части в окне.

   ![Окно параметров HTTPS][2]

2. На странице Параметры **appGatewayBackEndHttpSettings** установите флажок **использовать настраиваемую проверку** и выберите зонд, созданный в разделе [Создание пробы](#createprobe) в раскрывающемся списке **Пользовательский зонд** .
   По завершении нажмите кнопку **Сохранить**, и параметры будут применены.

## <a name="next-steps"></a>Дальнейшие действия

Просмотр работоспособности серверных ресурсов в соответствии с проверкой с помощью [представления работоспособности серверной части](./application-gateway-diagnostics.md#back-end-health).

[1]: ./media/application-gateway-create-probe-portal/figure1.png
[2]: ./media/application-gateway-create-probe-portal/figure2.png
[4]: ./media/application-gateway-create-probe-portal/figure4.png
[5]: ./media/application-gateway-create-probe-portal/figure5.png
[6]: ./media/application-gateway-create-probe-portal/figure6.png
