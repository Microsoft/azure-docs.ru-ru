---
title: Настройка сквозного шифрования TLS с помощью портала
titleSuffix: Azure Application Gateway
description: Узнайте, как использовать портал Azure для создания шлюза приложений с комплексным шифрованием TLS.
services: application-gateway
author: vhorne
ms.service: application-gateway
ms.topic: how-to
ms.date: 11/14/2019
ms.author: absha
ms.custom: mvc
ms.openlocfilehash: 6e2d1828acefacb03cc2f42193b8cd8897578b6f
ms.sourcegitcommit: 867cb1b7a1f3a1f0b427282c648d411d0ca4f81f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "93397507"
---
# <a name="configure-end-to-end-tls-by-using-application-gateway-with-the-portal"></a>Настройка сквозного подключения TLS для Шлюза приложений с помощью портала

В этой статье описывается, как использовать портал Azure для настройки сквозного шифрования TLS, ранее известного как шифрование SSL (SSL), с помощью SKU шлюза приложений Azure версии v1.

> [!NOTE]
> SKU шлюза приложений версии 2 требует доверенных корневых сертификатов для включения сквозной конфигурации.

Если у вас еще нет подписки Azure, [создайте бесплатную учетную запись](https://azure.microsoft.com/free/?WT.mc_id=A261C142F), прежде чем начинать работу.

## <a name="before-you-begin"></a>Перед началом

Чтобы настроить сквозной протокол TLS с помощью шлюза приложений, требуется сертификат для шлюза. Для внутренних серверов также требуются сертификаты. Сертификат шлюза используется для получения симметричного ключа в соответствии со спецификацией протокола TLS. Затем симметричный ключ используется для шифрования и расшифровки трафика, отправляемого на шлюз. 

Для сквозного шифрования TLS в шлюзе приложений должны быть разрешены правильные серверы. Чтобы разрешить этот доступ, передайте в шлюз приложений открытый сертификат внутренних серверов, известный также как сертификаты проверки подлинности (v1) или доверенные корневые сертификаты (v2). Добавление сертификата гарантирует, что шлюз приложений будет обмениваться данными только с известными экземплярами серверной части. Эта конфигурация обеспечивает более надежную защиту сквозной связи.

Дополнительные сведения см. в статье [Общие сведения о завершении работы TLS и сквозном TLS с помощью шлюза приложений](./ssl-overview.md).

## <a name="create-a-new-application-gateway-with-end-to-end-tls"></a>Создание нового шлюза приложений с комплексным TLS-интерфейсом

Чтобы создать шлюз приложений с сквозным шифрованием TLS, необходимо сначала включить завершение TLS при создании нового шлюза приложений. Это действие включает шифрование TLS для обмена данными между клиентом и шлюзом приложений. Затем необходимо будет указать для списка надежных получателей список сертификатов для внутренних серверов в параметрах HTTP. Эта конфигурация включает TLS-шифрование для обмена данными между шлюзом приложений и внутренними серверами. Это позволяет выполнять сквозное шифрование TLS.

### <a name="enable-tls-termination-while-creating-a-new-application-gateway"></a>Включить завершение TLS при создании нового шлюза приложений

Дополнительные сведения см. в разделе [Включение завершения TLS при создании нового шлюза приложений](./create-ssl-portal.md).

### <a name="add-authenticationroot-certificates-of-back-end-servers"></a>Добавление проверки подлинности и корневых сертификатов внутренних серверов

1. Выберите **Все ресурсы**, а затем — **myAppGateway**.

2. Выберите **Параметры HTTP** в меню слева. Azure автоматически создал параметр HTTP по умолчанию **appGatewayBackendHttpSettings** при создании шлюза приложений. 

3. Выберите **appGatewayBackendHttpSettings**.

4. В разделе **протокол** выберите **HTTPS**. Появится панель для **внутренних сертификатов проверки подлинности или доверенных корневых сертификатов** .

5. Выберите **Создать**.

6. В поле **имя** введите подходящее имя.

7. Выберите файл сертификата в поле **отправка сертификата CER** .

   Для шлюзов приложений Standard и WAF (v1) необходимо передать открытый ключ сертификата серверного сервера в формате CER.

   ![Добавление сертификата](./media/end-to-end-ssl-portal/addcert.png)

   Для Standard_v2 и WAF_v2 шлюзов приложений необходимо передать корневой сертификат серверного сертификата в формате CER. Если серверный сертификат выдается хорошо известным центром сертификации (ЦС), можно установить флажок использовать общедоступный **сертификат ЦС** , а затем не нужно отправлять сертификат.

   ![Добавить доверенный корневой сертификат](./media/end-to-end-ssl-portal/trustedrootcert-portal.png)

   ![Корневой сертификат](./media/end-to-end-ssl-portal/trustedrootcert.png)

8. Щелкните **Сохранить**.

## <a name="enable-end-to-end-tls-for-an-existing-application-gateway"></a>Включение сквозного протокола TLS для существующего шлюза приложений

Чтобы настроить существующий шлюз приложений с комплексным шифрованием TLS, необходимо сначала включить завершение TLS в прослушивателе. Это действие включает шифрование TLS для обмена данными между клиентом и шлюзом приложений. Затем поставьте эти сертификаты для серверов серверной части в параметрах HTTP в списке Надежные получатели. Эта конфигурация включает TLS-шифрование для обмена данными между шлюзом приложений и внутренними серверами. Это позволяет выполнять сквозное шифрование TLS.

Для включения завершения TLS необходимо использовать прослушиватель с протоколом HTTPS и сертификат. Можно либо использовать существующий прослушиватель, который соответствует этим условиям, либо создать новый прослушиватель. Если выбран первый вариант, можно проигнорировать следующий раздел "Включение завершения TLS в существующем шлюзе приложений" и перейти непосредственно к разделу "Добавление проверки подлинности или доверенных корневых сертификатов для внутренних серверов".

При выборе второго варианта примените действия, описанные в следующей процедуре.
### <a name="enable-tls-termination-in-an-existing-application-gateway"></a>Включение завершения TLS в существующем шлюзе приложений

1. Выберите **Все ресурсы**, а затем — **myAppGateway**.

2. Выберите пункт **прослушиватели** в меню слева.

3. Выберите **простой** или **многосайтовый** прослушиватель в зависимости от ваших требований.

4. В разделе **протокол** выберите **HTTPS**. Появится панель для **сертификата** .

5. Отправьте PFX-сертификат, который планируется использовать для завершения TLS между клиентом и шлюзом приложений.

   > [!NOTE]
   > В целях тестирования можно использовать самозаверяющий сертификат. Однако это не рекомендуется для рабочих нагрузок, так как они сложнее в управлении и не полностью защищены. Дополнительные сведения см. [в разделе Создание самозаверяющего сертификата](./create-ssl-portal.md#create-a-self-signed-certificate).

6. Добавьте другие обязательные параметры для **прослушивателя** в зависимости от требований.

7. Нажмите кнопку **ОК**, чтобы сохранить введенные данные.

### <a name="add-authenticationtrusted-root-certificates-of-back-end-servers"></a>Добавление проверки подлинности и доверенных корневых сертификатов внутренних серверов

1. Выберите **Все ресурсы**, а затем — **myAppGateway**.

2. Выберите **Параметры HTTP** в меню слева. Можно либо разместить сертификаты в существующем параметре HTTP серверной части в списке Надежные получатели, либо создать новый параметр HTTP. (На следующем шаге сертификат для параметра HTTP по умолчанию **appGatewayBackendHttpSettings** добавляется в список Надежные получатели.)

3. Выберите **appGatewayBackendHttpSettings**.

4. В разделе **протокол** выберите **HTTPS**. Появится панель для **внутренних сертификатов проверки подлинности или доверенных корневых сертификатов** . 

5. Выберите **Создать**.

6. В поле **имя** введите подходящее имя.

7. Выберите файл сертификата в поле **отправка сертификата CER** .

   Для шлюзов приложений Standard и WAF (v1) необходимо передать открытый ключ сертификата серверного сервера в формате CER.

   ![Добавление сертификата](./media/end-to-end-ssl-portal/addcert.png)

   Для Standard_v2 и WAF_v2 шлюзов приложений необходимо передать корневой сертификат серверного сертификата в формате CER. Если серверный сертификат выдается широко известным центром сертификации, можно установить флажок использовать общедоступный **сертификат ЦС** , а затем не нужно отправлять сертификат.

   ![Добавить доверенный корневой сертификат](./media/end-to-end-ssl-portal/trustedrootcert-portal.png)

8. Щелкните **Сохранить**.

## <a name="next-steps"></a>Дальнейшие действия

> [!div class="nextstepaction"]
> [Руководство по управлению веб-трафиком с помощью шлюза приложений и Azure CLI](./tutorial-manage-web-traffic-cli.md)