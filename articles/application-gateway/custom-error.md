---
title: Создание пользовательских страниц ошибок с помощью службы "Шлюз приложений Azure"
description: В этой статье показано, как создавать пользовательские страницы ошибок с помощью службы "Шлюз приложений". На пользовательской странице ошибок вы можете использовать собственные символику и макет.
services: application-gateway
author: vhorne
ms.service: application-gateway
ms.topic: how-to
ms.date: 11/16/2019
ms.author: victorh
ms.openlocfilehash: 355caeb54f09797ae719f21401ceebb7d53d745a
ms.sourcegitcommit: 867cb1b7a1f3a1f0b427282c648d411d0ca4f81f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "99592726"
---
# <a name="create-application-gateway-custom-error-pages"></a>Создание пользовательских страниц ошибок с помощью службы "Шлюз приложений"

Шлюз приложений позволяет создавать пользовательские страницы ошибок вместо отображения страниц ошибок по умолчанию. На пользовательской странице ошибок вы можете использовать собственные символику и макет.

Например, вы можете определить собственную страницу обслуживания, которая будет отображаться, если ваше веб-приложение недоступно. Вы также можете создать страницу несанкционированного доступа, отображаемую, если вредоносный запрос отправляется в веб-приложение.

Пользовательские страницы ошибок поддерживаются в двух следующих сценариях:

- **Страница обслуживания**. Эта пользовательская страница ошибки отправляется вместо страницы "502 — недопустимый шлюз". Она также отображается в случае, когда служба "Шлюз приложений" не имеет серверной части, в которую можно перенаправлять трафик. Например, при запланированном обслуживании или когда непредвиденная проблема влияет на доступ к серверному пулу.
- **Страница несанкционированного доступа**. Эта пользовательская страница ошибки отправляется вместо страницы "403 — несанкционированный доступ". Она также отображается в случае, если брандмауэр веб-приложения Шлюза приложений обнаруживает вредоносный трафик и блокирует его.

Если источником ошибки являются внутренние серверы, тогда она передается вызывающей стороне без изменений. Пользовательская страница ошибки не отображается. Шлюз приложений может отобразить пользовательскую страницу ошибки, когда запрос не может достичь серверной части.

Пользовательские страницы ошибок можно определять на глобальном уровне и на уровне прослушивателя:

- **Глобальный уровень**. Страница с ошибкой применяется к трафику для всех веб-приложений, развернутых в этом шлюзе приложений.
- **Уровень прослушивателя**. Страница с ошибкой применяется к трафику, полученному на этом прослушивателе.
- **Оба**. Пользовательская страница ошибки, определенная на уровне прослушивателя, переопределяет ту, которая была задана на глобальном уровне.

Чтобы создать пользовательскую страницу ошибки, требуется:

- код состояния ответа HTTP;
- расположение соответствующей страницы ошибки; 
- общедоступный большой двоичный объект хранилища Azure для расположения;
- тип расширения HTM или HTML. 

Размер страницы ошибки должен быть меньше 1 МБ. Если со страницей ошибки связаны изображения, они должны быть либо общедоступными абсолютными URL-адресами, либо встроенными на пользовательской странице ошибки в кодировке base64. В настоящее время относительные ссылки с изображениями в том же расположении больших двоичных объектов не поддерживаются. 

Когда вы укажите страницу ошибки, шлюз приложений загрузит ее из расположения большого двоичного объекта и сохранит в локальный кэш шлюза приложений. Затем страница ошибки будет напрямую обрабатываться шлюзом приложений. Чтобы изменить существующую пользовательскую страницу ошибки, необходимо указать другое расположение большого двоичного объекта в конфигурации шлюза приложений. Шлюз приложений не выполняет периодические проверки расположения большого двоичного объекта для получения новых версий.

## <a name="portal-configuration"></a>Настройка на портале

1. Перейдите к службе "Шлюз приложений" на портале и выберите шлюз приложений.

    ![На снимке экрана показана страница обзора для шлюза приложений.](media/custom-error/ag-overview.png)
2. Выберите **Прослушиватели** и перейдите к определенному прослушивателю, в котором нужно указать страницу ошибки.

    ![Прослушиватели службы "Шлюз приложений"](media/custom-error/ag-listener.png)
3. Настройте пользовательскую страницу ошибки для ошибки 403 WAF или страницу обслуживания 502 на уровне прослушивателя.

    > [!NOTE]
    > Создание пользовательских страниц ошибок на глобальном уровне на портале Azure в настоящее время не поддерживается.

4. Укажите URL-адрес общедоступного большого двоичного объекта для кода состояния данной ошибки и щелкните **Сохранить**. В службе "Шлюз приложений" теперь настроена пользовательская страница ошибки.

   ![Коды ошибок службы "Шлюз приложений"](media/custom-error/ag-error-codes.png)

## <a name="azure-powershell-configuration"></a>Конфигурация Azure PowerShell

Вы можете использовать Azure PowerShell для настройки страницы ошибки. Например, глобальная настраиваемая страница ошибки:

```powershell
$appgw   = Get-AzApplicationGateway -Name <app-gateway-name> -ResourceGroupName <resource-group-name>

$updatedgateway = Add-AzApplicationGatewayCustomError -ApplicationGateway $appgw -StatusCode HttpStatus502 -CustomErrorPageUrl "http://<website-url>"
```

Или страница ошибки уровня прослушивателя:

```powershell
$appgw   = Get-AzApplicationGateway -Name <app-gateway-name> -ResourceGroupName <resource-group-name>

$listener01 = Get-AzApplicationGatewayHttpListener -Name <listener-name> -ApplicationGateway $appgw

$updatedlistener = Add-AzApplicationGatewayHttpListenerCustomError -HttpListener $listener01 -StatusCode HttpStatus502 -CustomErrorPageUrl "http://<website-url>"
```

Дополнительные сведения см. в статьях о командлетах [Add-AzApplicationGatewayCustomError](/powershell/module/az.network/add-azapplicationgatewaycustomerror) и [Add-AzApplicationGatewayHttpListenerCustomError](/powershell/module/az.network/add-azapplicationgatewayhttplistenercustomerror).

## <a name="next-steps"></a>Дальнейшие действия

Сведения о диагностике службы "Шлюз приложений" см. в статье [Работоспособность серверной части, журналы диагностики и метрики для шлюза приложений](application-gateway-diagnostics.md).
