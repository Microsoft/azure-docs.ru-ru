---
title: Сертификаты, необходимые для поддержки внутренних серверов
titleSuffix: Azure Application Gateway
description: В этой статье приведены примеры того, как можно преобразовать сертификат TLS/SSL в сертификат проверки подлинности и доверенный корневой сертификат, необходимые для разрешения внутренних экземпляров в шлюзе приложений Azure.
services: application-gateway
author: vhorne
ms.service: application-gateway
ms.topic: how-to
ms.date: 06/17/2020
ms.author: absha
ms.openlocfilehash: 874e554063f64ddefce99a223678d64b2e0774c3
ms.sourcegitcommit: 867cb1b7a1f3a1f0b427282c648d411d0ca4f81f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "93397728"
---
# <a name="create-certificates-to-allow-the-backend-with-azure-application-gateway"></a>Создание сертификатов, разрешающих внутренние серверы шлюза приложений Azure

Для сквозного TLS для шлюза приложений необходимо, чтобы экземпляры серверной части были разрешены путем отправки сертификатов проверки подлинности или доверенного корневого сертификата. Для номера SKU v1 требуются сертификаты проверки подлинности, но для доверенных корневых сертификатов версии 2 требуется разрешить сертификаты.

Вы узнаете, как выполнять следующие задачи:


- Экспорт сертификата проверки подлинности из серверного сертификата (для номера SKU v1)
- Экспорт доверенного корневого сертификата из серверного сертификата (для SKU v2)

## <a name="prerequisites"></a>Предварительные условия

Для создания сертификатов проверки подлинности или доверенных корневых сертификатов, необходимых для разрешения внутренних экземпляров с помощью шлюза приложений, необходим существующий серверный сертификат. Серверный сертификат может быть таким же, как и сертификат TLS/SSL или другой для повышения безопасности. Шлюз приложений не предоставляет ни одного механизма для создания или приобретения сертификата TLS/SSL. В целях тестирования можно создать самозаверяющий сертификат, но не следует использовать его для рабочих нагрузок. 

## <a name="export-authentication-certificate-for-v1-sku"></a>Экспорт сертификата проверки подлинности (для номера SKU v1)

Сертификат проверки подлинности необходим для разрешения внутренних экземпляров в SKU шлюза приложений версии v1. Сертификат проверки подлинности — это открытый ключ сертификатов внутреннего сервера в формате X. 509 с кодировкой Base-64 (. CER). В этом примере вы используете сертификат TLS/SSL для серверного сертификата и экспортируете его открытый ключ для использования в качестве сертификации проверки подлинности. Кроме того, в этом примере для экспорта необходимых сертификатов используется диспетчер сертификатов Windows. Можно использовать любой удобный инструмент.

Из сертификата TLS/SSL экспортируйте CER-файл открытого ключа (не закрытый ключ). Следующие шаги помогут вам экспортировать CER-файл в формате X. 509 с кодировкой base64 64 (. CER) для вашего сертификата:

1. Чтобы получить из сертификата CER-файл, откройте раздел **Управление сертификатами пользователей**. Выберите сертификат (обычно в поле Certificates-Current User\Personal\Certificates) и щелкните его правой кнопкой мыши. Щелкните **Все задачи** > **Экспорт**. Откроется **мастера экспорта сертификатов**. Если не удается найти сертификат в разделе <текущий_пользователь>\Personal\Certificates, возможно, вы случайно открыли "Certificates — Local Computer"вместо "Certificates— <текущий_пользователь>". Если вы хотите открыть диспетчер сертификатов в области текущего пользователя с помощью PowerShell, выполните команду *certmgr* в окне консоли.

   ![На снимке экрана показан Диспетчер сертификатов с выбранными сертификатами и контекстное меню со всеми задачами, а затем Экспорт выбранных.](./media/certificates-for-backend-authentication/export.png)

2. В окне мастера нажмите **Далее**.

   ![Экспорт сертификата](./media/certificates-for-backend-authentication/exportwizard.png)

3. Выберите **Нет, не экспортировать закрытый ключ** и снова нажмите кнопку **Далее**.

   ![Выбор параметра "Нет, не экспортировать закрытый ключ"](./media/certificates-for-backend-authentication/notprivatekey.png)

4. На странице **Формат экспортируемого файла** выберите **Файлы X.509 (.CER) в кодировке Base-64** и нажмите кнопку **Далее**.

   ![Выбор параметра "Файлы X.509 (.CER) в кодировке Base-64"](./media/certificates-for-backend-authentication/base64.png)

5. На странице **Имя экспортируемого файла** нажмите кнопку **Обзор**, чтобы перейти в расположение для экспорта сертификата. В поле **Имя файла** введите имя для файла сертификата. Затем щелкните **Далее**.

   ![На снимке экрана показан мастер экспорта сертификатов, в котором указывается файл для экспорта.](./media/certificates-for-backend-authentication/browse.png)

6. Нажмите кнопку **Готово**, чтобы выполнить экспорт сертификата.

   ![На снимке экрана показан мастер экспорта сертификатов после завершения экспорта файла.](./media/certificates-for-backend-authentication/finish.png)

7. Сертификат успешно экспортирован.

   ![На снимке экрана показан мастер экспорта сертификатов с сообщением об успешном выполнении.](./media/certificates-for-backend-authentication/success.png)

   Экспортированный сертификат выглядит примерно так:

   ![На снимке экрана показан символ сертификата.](./media/certificates-for-backend-authentication/exported.png)

8. Если открыть экспортированный сертификат в Блокноте, результат будет приблизительно таким, как в приведенном ниже примере. В разделе Blue содержатся сведения, которые передаются в шлюз приложений. Если открыть сертификат в блокноте и он не похож на этот, обычно это означает, что вы не экспортируете его с помощью кодировки X. 509, основанной на Base-64. CER). Кроме того, при использовании другого текстового редактора следует учитывать, что в некоторых редакторах может выполняться непреднамеренное форматирование в фоновом режиме. Это может вызвать проблемы при передаче текста из этого сертификата в Azure.

   ![Открытие в Блокноте](./media/certificates-for-backend-authentication/format.png)

## <a name="export-trusted-root-certificate-for-v2-sku"></a>Экспортировать доверенный корневой сертификат (для SKU v2)

Доверенный корневой сертификат необходим для разрешения внутренних экземпляров в SKU шлюза приложений версии 2. Корневой сертификат является Base-64 в кодировке X. 509 (. CER) отформатируйте корневой сертификат из сертификатов внутреннего сервера. В этом примере мы будем использовать сертификат TLS/SSL для серверного сертификата, экспортировать его открытый ключ, а затем экспортировать корневой сертификат доверенного ЦС из открытого ключа в формате Base64, чтобы получить доверенный корневой сертификат. Промежуточные сертификаты должны быть объединены с сертификатом сервера и установлены на внутреннем сервере.

Следующие шаги помогут вам экспортировать CER файл для сертификата:

1. Выполните шаги 1-8, упомянутые в предыдущем разделе [Экспорт сертификата проверки подлинности (для номера SKU v1)](#export-authentication-certificate-for-v1-sku) , чтобы экспортировать открытый ключ из серверного сертификата.

2. После экспорта открытого ключа откройте его.

   ![Открыть сертификат авторизации](./media/certificates-for-backend-authentication/openAuthcert.png)

   ![о сертификате](./media/certificates-for-backend-authentication/general.png)

3. Перейдите в представление путь сертификации, чтобы просмотреть центр сертификации.

   ![сведения о сертификате](./media/certificates-for-backend-authentication/certdetails.png)

4. Выберите корневой сертификат и щелкните " **Просмотреть сертификат**".

   ![путь к сертификату](./media/certificates-for-backend-authentication/rootcert.png)

   Вы должны увидеть сведения о корневом сертификате.

   ![сведения о сертификате](./media/certificates-for-backend-authentication/rootcertdetails.png)

5. Перейдите в представление **сведений** и нажмите кнопку **Копировать в файл...**

   ![Копировать корневой сертификат](./media/certificates-for-backend-authentication/rootcertcopytofile.png)

6. На этом этапе вы извлекли сведения о корневом сертификате из серверного сертификата. Вы увидите **Мастер экспорта сертификатов**. Теперь выполните шаги 2-9, упомянутые в разделе **Экспорт сертификата проверки подлинности из серверного сертификата (для номера SKU v1)** выше, чтобы экспортировать доверенный корневой сертификат в Base-64 с кодировкой X. 509 (. CER).

## <a name="next-steps"></a>Дальнейшие действия

Теперь у вас есть сертификат проверки подлинности или доверенный корневой сертификат в Base-64 с кодировкой X. 509 (. CER). Вы можете добавить его в шлюз приложений, чтобы обеспечить сквозное шифрование TLS внутренних серверов. См. раздел [Настройка сквозного TLS с помощью шлюза приложений с использованием PowerShell](./application-gateway-end-to-end-ssl-powershell.md).