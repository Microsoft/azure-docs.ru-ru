---
title: Конфигурация параметров HTTP шлюза приложений Azure
description: В этой статье описывается, как настроить параметры HTTP для шлюза приложений Azure.
services: application-gateway
author: vhorne
ms.service: application-gateway
ms.topic: conceptual
ms.date: 09/09/2020
ms.author: surmb
ms.openlocfilehash: c0c939a6a8323dfdfafddb46ccdb7d7ef3dd2f2c
ms.sourcegitcommit: 772eb9c6684dd4864e0ba507945a83e48b8c16f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "89653023"
---
# <a name="application-gateway-http-settings-configuration"></a>Конфигурация параметров HTTP для шлюза приложений

Шлюз приложений направляет трафик на серверы внутренних серверов с помощью указанной здесь конфигурации. После создания параметра HTTP необходимо связать его с одним или несколькими правилами маршрутизации запросов.

## <a name="cookie-based-affinity"></a>Сходство на основе файлов cookie,

Шлюз приложений Azure использует управляемые шлюзом файлы cookie для обслуживания пользовательских сеансов. Когда пользователь отправляет первый запрос в шлюз приложений, он устанавливает в ответе файл cookie сходства с хэш-значением, содержащим сведения о сеансе, чтобы последующие запросы, включающие файл cookie с сходством, направляются на тот же внутренний сервер для поддержания закрепления. 

Эта функция полезна, если необходимо сохранить сеанс пользователя на том же сервере и сохранить состояние сеанса локально на сервере для сеанса пользователя. Если приложение не может управлять сходством на основе файлов cookie, эту функцию использовать нельзя. Чтобы использовать его, убедитесь, что клиенты поддерживают файлы cookie.

[Обновление V80](https://chromiumdash.appspot.com/schedule) [браузера Chromium](https://www.chromium.org/Home) было предписано, где файлы cookie HTTP без атрибута [SameSite](https://tools.ietf.org/id/draft-ietf-httpbis-rfc6265bis-03.html#rfc.section.5.3.7) должны рассматриваться как SameSite = нестрогие. В случае запросов CORS (совместное использование ресурсов независимо от источника), если файл cookie должен быть отправлен в контексте стороннего разработчика, он должен использовать *SameSite = None; Безопасные* атрибуты и должны отправляться только по протоколу HTTPS. В противном случае в сценарии HTTP браузер не отправляет файлы cookie в контексте стороннего разработчика. Целью этого обновления из Chrome является повышение безопасности и предотвращение атак с подделкой межсайтовых запросов (CSRF). 

Для поддержки этого изменения, начиная с 17 2020 февраля, в дополнение к существующему *аппликатионгатевайаффинити* файлу cookie в шлюзе приложений (все типы SKU) будет добавлен другой файл cookie с именем *аппликатионгатевайаффинитикорс* . К файлу cookie *аппликатионгатевайаффинитикорс* добавлены еще два атрибута (*"SameSite = None; Безопасность "*), чтобы закрепленный сеанс поддерживался даже для запросов между источниками.

Обратите внимание, что имя файла cookie сходства по умолчанию — *аппликатионгатевайаффинити* , и его можно изменить. Если вы используете имя файла cookie для пользовательского сходства, в качестве суффикса CORS добавляется дополнительный файл cookie. Например, *кустомкукиенамекорс*.

> [!NOTE]
> Если атрибут *SameSite = None* установлен, он обязательно должен содержать флаг *Secure* , и его необходимо отправлять по протоколу HTTPS.  Если для CORS требуется сходство сеансов, необходимо перенести рабочую нагрузку в HTTPS. Ознакомьтесь с разгрузкой TLS и документацией по TLS для шлюза приложений. [Обзор](ssl-overview.md), [Настройка шлюза приложений с завершением tls с помощью портал Azure](create-ssl-portal.md), [Настройка сквозного протокола TLS с помощью шлюза приложений с порталом](end-to-end-ssl-portal.md).

## <a name="connection-draining"></a>фильтрация подключений;

Сток подключений помогает аккуратно удалить членов пула серверной части во время плановых обновлений службы. Вы можете применить этот параметр ко всем элементам пула серверной части, включив сток подключений для параметра HTTP. Это гарантирует, что все отменяющие регистрацию экземпляров серверного пула продолжают поддерживать существующие подключения и обслуживать запросы в течение настраиваемого времени ожидания и не получают новые запросы или соединения. Единственным исключением из этого являются запросы, связанные для отмены регистрации экземпляров из-за сходства сеанса, управляемого шлюзом, и будут по-прежнему перенаправлены в экземпляры отмены регистрации. Сток подключений применяется к внутренним экземплярам, которые явным образом удаляются из серверного пула.

## <a name="protocol"></a>Протокол

Шлюз приложений поддерживает протоколы HTTP и HTTPS для маршрутизации запросов к внутренним серверам. При выборе HTTP трафик к внутренним серверам не шифруется. Если обмен данными без шифрования неприемлем, выберите HTTPS.

Этот параметр в сочетании с протоколом HTTPS в прослушивателе поддерживает [сквозной протокол TLS](ssl-overview.md). Это позволяет безопасно передавать конфиденциальные данные, зашифрованные в серверной части. На каждом внутреннем сервере в пуле серверной части, для которого включен сквозной протокол TLS, необходимо настроить сертификат, чтобы обеспечить безопасную связь.

## <a name="port"></a>Порт

Этот параметр указывает порт, на котором серверные серверы прослушивают трафик от шлюза приложений. Можно настроить порты в диапазоне от 1 до 65535.

## <a name="request-timeout"></a>Время ожидания запроса

Этот параметр определяет время в секундах, в течение которого шлюз приложений ожидает получения ответа от сервера внутренней стороны.

## <a name="override-back-end-path"></a>Переопределить путь к серверной части

Этот параметр позволяет настроить необязательный пользовательский путь перенаправления, который будет использоваться при пересылке запроса в серверную части. Любая часть входящего пути, соответствующая пользовательскому пути в поле " **Переопределение серверного пути** ", копируется в перенаправленный путь. В следующей таблице показано, как работает эта функция.

- Когда параметр HTTP прикрепляется к базовому правилу маршрутизации запросов:

  | Исходный запрос  | Переопределить путь к серверной части | Запрос перенаправлен на серверную части |
  | ----------------- | --------------------- | ---------------------------- |
  | /Home            | /override.            | /оверриде/хоме/              |
  | /хоме/секондхоме/ | /override.            | /оверриде/хоме/секондхоме/   |

- Когда параметр HTTP прикрепляется к правилу маршрутизации запросов на основе пути:

  | Исходный запрос           | Правило для пути       | Переопределить путь к серверной части | Запрос перенаправлен на серверную части |
  | -------------------------- | --------------- | --------------------- | ---------------------------- |
  | /пасруле/хоме/            | pathrule      | /override.            | /оверриде/хоме/              |
  | /пасруле/хоме/секондхоме/ | pathrule      | /override.            | /оверриде/хоме/секондхоме/   |
  | /Home                     | pathrule      | /override.            | /оверриде/хоме/              |
  | /хоме/секондхоме/          | pathrule      | /override.            | /оверриде/хоме/секондхоме/   |
  | /пасруле/хоме/            | /пасруле/Хоме * | /override.            | /override.                   |
  | /пасруле/хоме/секондхоме/ | /пасруле/Хоме * | /override.            | /оверриде/секондхоме/        |
  | pathrule                 | pathrule      | /override.            | /override.                   |

## <a name="use-for-app-service"></a>Использование для службы приложений

Это ярлык только для пользовательского интерфейса, который выбирает два обязательных параметра для серверной части службы приложений Azure. Он позволяет **выбрать имя узла на внутреннем адресе** и создает новую пользовательскую проверку, если у вас ее еще нет. (Дополнительные сведения см. в разделе [Выбор имени узла из параметра адрес внутренней](#pick-host-name-from-back-end-address)части этой статьи.) Будет создана новая проба, и заголовок зонда выбирается из адреса элемента серверной части.

## <a name="use-custom-probe"></a>Использовать пользовательскую проверку

Этот параметр связывает [пользовательскую проверку](application-gateway-probe-overview.md#custom-health-probe) с параметром HTTP. Вы можете связать только одну пользовательскую пробу с параметром HTTP. Если пользовательская пробная версия не связана явным образом, для наблюдения за работоспособностью серверной части используется [проба по умолчанию](application-gateway-probe-overview.md#default-health-probe-settings) . Рекомендуется создать пользовательскую проверку, чтобы лучше управлять мониторингом работоспособности Ваших серверных окончаний.

> [!NOTE]
> Пользовательская проба не отслеживает работоспособность пула серверной части, если соответствующий параметр HTTP явно не связан с прослушивателем.

## <a name="pick-host-name-from-back-end-address"></a>Выберите имя узла на внутреннем адресе

Эта возможность динамически устанавливает заголовок *узла* в запросе на имя узла серверного пула. Он использует IP-адрес или полное доменное имя.

Эта функция помогает, когда доменное имя серверной части отличается от DNS-имени шлюза приложений, а Серверная часть полагается на конкретный заголовок узла для разрешения в правильную конечную точку.

Например, в качестве серверной части используется несколько служб клиента. Служба приложений — это служба с несколькими клиентами, использующая общее пространство с одним IP-адресом. Таким образом, доступ к службе приложений возможен только через имена узлов, настроенные в параметрах личного домена.

По умолчанию имя пользовательского домена — *example.azurewebsites.NET*. Чтобы получить доступ к службе приложений с помощью шлюза приложений через имя узла, которое не было явно зарегистрировано в службе приложений или через полное доменное имя шлюза приложений, необходимо переопределить имя узла в исходном запросе на имя узла службы приложений. Для этого включите параметр " **выбрать имя узла из серверного адреса** ".

Для личного домена, существующее пользовательское DNS-имя которого сопоставляется со службой приложений, вам не нужно включать этот параметр.

> [!NOTE]
> Этот параметр не является обязательным для Среда службы приложений, который является выделенным развертыванием.

## <a name="host-name-override"></a>Переопределение имени узла

Эта возможность заменяет заголовок *узла* во входящем запросе шлюза приложений на указанное имя узла.

Например, если в параметре **имени узла** указано *www.contoso.com* , то исходный запрос * `https://appgw.eastus.cloudapp.azure.com/path1` меняется на *, `https://www.contoso.com/path1` когда запрос перенаправляется на сервер фонового сервера.

## <a name="next-steps"></a>Дальнейшие действия

- [Дополнительные сведения о пуле серверной части](configuration-overview.md#back-end-pool)