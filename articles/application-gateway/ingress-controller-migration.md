---
title: Как выполнить миграцию из входящего контроллера шлюза приложений Azure Helm в надстройку АГИК
description: В этой статье приведены инструкции по миграции из АГИК, развернутых с помощью Helm, в АГИК, развернутые в качестве надстройки AKS.
services: application-gateway
author: caya
ms.service: application-gateway
ms.topic: article
ms.date: 03/02/2021
ms.author: caya
ms.openlocfilehash: 4b5cb9abe53cdb29cbc1b4c9711fb8efcf0348d6
ms.sourcegitcommit: c27a20b278f2ac758447418ea4c8c61e27927d6a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/03/2021
ms.locfileid: "101746306"
---
# <a name="migrate-from-agic-helm-to-agic-add-on"></a>Миграция из АГИК Helm в надстройку АГИК 

Если вы уже развернули АГИК через Helm, но хотите перейти на АГИК, развернутую как надстройка AKS, выполните следующие действия, которые помогут выполнить процесс миграции. 

## <a name="prerequisites"></a>Предварительные требования 
Перед началом процесса миграции необходимо проверить несколько моментов. 
  - Вы используете любые функции с АГИК Helm, которые [в настоящее время не поддерживаются надстройкой агик](ingress-controller-overview.md#difference-between-helm-deployment-and-aks-add-on)?
  - Используете ли вы несколько развертываний АГИК Helm на кластере AKS? 
  - Вы используете несколько развертываний АГИК Helm для одного шлюза приложений? 

Если вы ответили да на любой из указанных выше вопросов, надстройка АГИК не будет поддерживать ваш вариант использования, поэтому лучше будет продолжать использовать АГИК Helm. В противном случае продолжите процесс миграции в нерабочее время. 

## <a name="find-the-application-gateway-resource-id-that-agic-helm-is-currently-targeting"></a>Найти идентификатор ресурса шлюза приложений, для которого в настоящее время предназначен АГИК Helm 
Перейдите к шлюзу приложений, на котором нацелено развертывание АГИК Helm. Скопируйте и сохраните идентификатор ресурса этого шлюза приложений. Идентификатор ресурса потребуется на более позднем этапе. Идентификатор ресурса можно найти на портале, на вкладке свойства шлюза приложений или с помощью Azure CLI. В следующем примере идентификатор ресурса шлюза приложений сохраняется в *аппгвид* для шлюза с именем *мяппликатионгатевай* в группе ресурсов *myResourceGroup*.

```azurecli-interactive
appgwId=$(az network application-gateway show -n myApplicationGateway -g myResourceGroup -o tsv --query "id") 
```

## <a name="delete-agic-helm-from-your-aks-cluster"></a>Удаление АГИК Helm из кластера AKS
С помощью Azure CLI удалите развертывание АГИК Helm из кластера. Перед включением надстройки АГИК AKS необходимо сначала удалить развертывание АГИК Helm. Обратите внимание, что любые изменения, произошедшие в кластере AKS между моментом удаления развертывания АГИК Helm и временем включения надстройки АГИК, не будут отражены в шлюзе приложений, поэтому этот процесс миграции следует выполнять за пределами рабочего времени, чтобы снизить влияние. Шлюз приложений будет по прежнему иметь последнюю конфигурацию, примененную АГИК, поэтому существующие правила маршрутизации не будут затронуты. 

## <a name="enable-agic-add-on-using-your-existing-application-gateway"></a>Включение надстройки АГИК с помощью имеющегося шлюза приложений 
Теперь надстройку АГИК в кластере AKS можно включить для существующего шлюза приложений с помощью Azure CLI или портала. Выполните следующую команду Azure CLI, чтобы включить надстройку АГИК в кластере AKS. Пример включает надстройку в кластере с именем *myCluster* в группе ресурсов с именем *MYRESOURCEGROUP*, используя идентификатор ресурса шлюза приложений *аппгвид* , сохраненный выше на предыдущем шаге. 


```azurecli-interactive
az aks enable-addons -n myCluster -g myResourceGroup -a ingress-appgw --appgw-id $appgwId
```

Кроме того, можно переходить к кластеру AKS на портале с помощью этой [ссылки](https://portal.azure.com/?feature.aksagic=true) и включить надстройку агик на вкладке "Сетевые подключения" кластера. Выберите имеющийся шлюз приложений из раскрывающегося меню при выборе шлюза приложений, на котором должна быть нацелена надстройка. 

![Портал входящего контроллера для шлюза приложений](./media/tutorial-ingress-controller-add-on-existing/portal_ingress_controller_addon.png)

## <a name="next-steps"></a>Next Steps
- [**Устранение неполадок контроллера входящего трафика шлюза приложений**](ingress-controller-troubleshoot.md): руководство по устранению неполадок для агик 
- [**Заметка контроллера входящих данных шлюза приложений**](ingress-controller-annotations.md): список заметок в агик 