---
title: Автоматическое масштабирование и Шлюз приложений, избыточный между зонами, версии 2
description: В этой статье рассматриваются SKU Standard_v2 и WAF_v2 для приложений Azure, включая компоненты автоматического масштабирования и компоненты, избыточные между зонами.
services: application-gateway
author: vhorne
ms.service: application-gateway
ms.topic: conceptual
ms.date: 06/06/2020
ms.author: victorh
ms.custom: fasttrack-edit, references_regions
ms.openlocfilehash: fad6e27c4ee7e8c10237cb3face5cfab9329b2ed
ms.sourcegitcommit: 31cfd3782a448068c0ff1105abe06035ee7b672a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/10/2021
ms.locfileid: "98059727"
---
# <a name="autoscaling-and-zone-redundant-application-gateway-v2"></a>Автоматическое масштабирование и Шлюз приложений, избыточный между зонами, версии 2 

Шлюз приложений доступен по номеру SKU Standard_v2. Брандмауэр веб-приложения (WAF) доступен по номеру SKU WAF_v2. SKU версии 2 обеспечивает повышение производительности и добавляет поддержку для важных новых функций, таких как автоматическое масштабирование, избыточность между зонами и поддержка статических виртуальных IP-адресов. Новый SKU Standard и WAF версии 2 продолжает поддерживать существующие функции за несколькими исключениями, перечисленными в разделе [сравнения](#differences-from-v1-sku).

Новый SKU версии 2 включает следующие усовершенствования.

- **Автоматическое масштабирование**. развертывания шлюза приложений или WAF в SKU автомасштабирования могут масштабироваться или в зависимости от изменения шаблонов нагрузки на трафик. Кроме того, автоматическое масштабирование позволяет не выбирать размер развертывания или количество экземпляров во время подготовки. Этот SKU дает действительно большую гибкость. В SKU Standard_v2 и WAF_v2 Шлюз приложений может работать как с фиксированной емкостью (отключенным автоматическим масштабированием), так и с включенным автоматическим масштабированием. Режим фиксированной емкости подходит для сценариев с постоянной, предсказуемой рабочей нагрузкой. Режим автоматического масштабирования целесообразно использовать в тех приложениях, где трафик сильно меняется.
- **Избыточность в пределах зоны**. Развертывание Шлюза приложений или WAF теперь может охватывать несколько зон доступности. Это снимает необходимость в подготовке отдельных экземпляров Шлюза приложений в каждой зоне с помощью диспетчера трафика. Можно выбрать одну или несколько зон, где развертываются экземпляры Шлюза приложений, и обеспечить большую устойчивость зон к сбоям. Внутренний пул приложений можно аналогичным образом распределить по зонам доступности.

  Избыточность между зонами доступна только там, где доступны Зоны Azure. В других регионах поддерживаются все остальные функции. Дополнительные сведения см. в статье [Регионы и Зоны доступности в Azure](../availability-zones/az-overview.md).
- **Статический виртуальный IP-адрес**. SKU Шлюза приложений версии 2 теперь поддерживает исключительно статический тип виртуального IP-адреса. Это гарантирует, что виртуальный IP-адрес, связанный со Шлюзом приложений, не изменится в течение жизненного цикла развертывания даже после перезапуска.  В версии 1 нет статического виртуального IP-адреса, поэтому для маршрутизации доменных имен в службы приложений через Шлюз приложений необходимо использовать URL-адрес Шлюза приложений, а не IP-адрес.
- **Перезапись заголовков**. Шлюз приложений позволяет добавлять, удалять и обновлять заголовки HTTP-запросов и ответов с SKU версии 2. Дополнительные сведения см. в статье [Перезапись HTTP-заголовков с помощью Шлюза приложений](rewrite-http-headers.md).
- **Интеграция с Key Vault**. Шлюз приложений версии 2 теперь поддерживает интеграцию с Key Vault для сертификатов сервера, подключенных к прослушивателям с поддержкой HTTPS. Дополнительные сведения см. в статье о [завершении TLS-запросов с использованием сертификатов из Key Vault](key-vault-certs.md).
- **Контроллер входящего трафика Службы Azure Kubernetes**. Контроллер входящего трафика Шлюза приложений версии 2 позволяет использовать трафик со Шлюза приложений в качестве входящего трафика для кластера Службы Azure Kubernetes (AKS). Дополнительные сведения о контроллере входящего трафика Шлюза приложений см. в [этой статье](ingress-controller-overview.md).
- **Повышение производительности**. SKU версии 2 обеспечивает в 5-кратный прирост производительности разгрузки TLS по сравнению со SKU Standard и WAF.
- **Более быстрое развертывание и обновление**. SKU версии 2 обеспечивает более быстрое развертывание и обновление по сравнению со SKU Standard и WAF. Сюда также входят изменения конфигурации WAF.

![Схема зоны автоматического масштабирования.](./media/application-gateway-autoscaling-zone-redundant/application-gateway-autoscaling-zone-redundant.png)

## <a name="supported-regions"></a>Поддерживаемые регионы

SKU Standard_v2 и WAF_v2 доступен в следующих регионах: центрально-северная часть США, центрально-южная часть США, западная часть США, западная часть США 2, восточная часть США, восточная часть США 2, центральная часть США, Северная Европа, Западная Европа, Юго-Восточная Азия, Центральная Франция, западная часть Соединенного Королевства, Восточная Япония, Западная Япония, Восточная Австралия, Юго-Восточная Австралия, Южная Бразилия, Центральная Канада, Восточная Канада, Восточная Азия, Республика Корея (центральный регион), Республика Корея (южный регион), южная часть Соединенного Королевства, Центральная Индия, Западная Индия, Южная Индия.

## <a name="pricing"></a>Цены

В SKU версии 2 модель ценообразования определяется потреблением и больше не привязывается к количеству или размерам экземпляров. Цена SKU версии 2 состоит из двух компонентов:

- **Фиксированная цена**. Это почасовая (полная или частичная) цена для подготовки к работе шлюза Standard_v2 или WAF_v2. Обратите внимание, что нулевое минимальное количество дополнительных экземпляров по-прежнему гарантирует высокую доступность службы, которая всегда входит в фиксированную цену.
- **Цена за единицы емкости**. Это стоимость на основе потребления, которая начисляется в дополнение к фиксированным затратам. Плата за единицы емкости также вычисляется за каждый час (полностью или частично). Есть три измерения для единицы емкости: единица вычислений, постоянные подключения и пропускная способность. Единица вычислений — это показатель потребленной емкости процессора. Факторы, влияющие на этот показатель: число TLS-подключений в секунду, вычисление перезаписи URL-адресов и обработка правил WAF. Постоянные подключения — это показатель установленных TCP-подключений к Шлюзу приложений в заданном платежном периоде. Пропускная способность — это среднее значение Мбит/с, обработанное системой в заданном платежном периоде.  Выставление счетов выполняется на уровне единиц емкости за все, что превышает количество зарезервированных экземпляров.

Каждая единица емкости состоит не чаще: 1 единица вычислений, 2500 постоянных подключений и пропускная способность 2,22 Мбит/с.

Дополнительные сведения см. в разделе [Общие сведения о ценах](understanding-pricing.md).

## <a name="scaling-application-gateway-and-waf-v2"></a>Масштабирование Шлюза приложений и WAF версии 2

Шлюз приложений и WAF можно настроить для масштабирования в двух режимах.

- **Автомасштабирование**. С включенным автомасштабированием SCU Шлюза приложений и WAF версии 2 масштабируются в сторону увеличения или уменьшения в зависимости от требований к трафику приложений. Этот режим обеспечивает большую гибкость в отношении приложений и исключает необходимость угадывания размера шлюза приложений или числа экземпляров. Этот режим также позволяет экономить затраты, так как не требует работы шлюза с пиковой подготовленной емкостью для предполагаемой максимальной интенсивности трафика. Необходимо указать минимальное и необязательное максимальное число экземпляров. Минимальная емкость гарантирует, что Шлюз приложений и WAF версии 2 не будут использовать меньше указанного минимального числа экземпляров даже при отсутствии трафика. Каждый экземпляр примерно эквивалентен 10 дополнительным зарезервированным единицам емкости. Ноль означает отсутствие зарезервированной емкости и предполагает полностью автоматическое масштабирование. При необходимости можно также указать максимальное число экземпляров, которое гарантирует, что Шлюз приложений не выйдет за пределы указанного числа экземпляров. Плата будет взиматься только за объем трафика, обработанного шлюзом. Число экземпляров может находиться в диапазоне от 0 до 125. Если максимальное число экземпляров не указано, по умолчанию используется значение 20.
- **Вручную**. Чтобы отказаться от автоматического масштабирования шлюза, можно выбрать ручной режим. В этом режиме, если объем трафика превысит возможности Шлюза приложений или WAF, может произойти потеря трафика. В ручном режиме указание количества экземпляров является обязательным. Число экземпляров может находиться в диапазоне от 1 до 125.

## <a name="autoscaling-and-high-availability"></a>Автомасштабирование и высокая доступность

Шлюзы приложений Azure всегда развертываются с высоким уровнем доступности. Служба формируется из нескольких экземпляров, создаваемых как настроенные (если автоматическое масштабирование выключено) или требуемые для загрузки приложений (если автоматическое масштабирование включено). Обратите внимание, что с точки зрения пользователя вы необязательно можете видеть отдельные экземпляры, а только службу Шлюза приложений в целом. Если в определенном экземпляре возникает проблема и он перестает работать, Шлюз приложений Azure прозрачно создает новый экземпляр.

Обратите внимание, что даже если вы настроите автомасштабирование с нулевым минимальным количеством экземпляров, служба будет по-прежнему поддерживать высокую доступность, которая всегда входит в фиксированную цену.

Однако создание нового экземпляра может занять некоторое время (около шести или семи минут). Поэтому, если не хотите столкнуться с простоем, можете настроить минимальное число экземпляров равным 2 (в идеале — с поддержкой зоны доступности). Таким образом в нормальных условиях у вас будет по крайней мере два экземпляра в Шлюзе приложений Azure, поэтому если с одним из них возникнет проблема, другой будет пытаться справиться с трафиком, пока будет создаваться новый экземпляр. Обратите внимание, что экземпляр Шлюза приложений Azure может поддерживать около 10 единиц емкости, поэтому в зависимости от объема трафика может потребоваться настроить для параметра минимального количества экземпляров при автомасштабировании значение, превышающее 2.

## <a name="feature-comparison-between-v1-sku-and-v2-sku"></a>Сравнение функций SKU версий 1 и 2

В следующей таблице перечислены функции, доступные в каждом SKU.

| Функция                                           | SKU версии 1   | SKU версии 2   |
| ------------------------------------------------- | -------- | -------- |
| Автомасштабирование                                       |          | &#x2713; |
| Избыточность в пределах зоны                                   |          | &#x2713; |
| Статический виртуальный IP-адрес                                        |          | &#x2713; |
| Контроллер входящего трафика Службы Azure Kubernetes |          | &#x2713; |
| Интеграция с хранилищем ключей Azure                       |          | &#x2713; |
| Перезапись заголовков HTTP(S)                           |          | &#x2713; |
| Маршрутизация на основе URL-адреса                                 | &#x2713; | &#x2713; |
| Размещение нескольких сайтов                             | &#x2713; | &#x2713; |
| Перенаправление трафика                               | &#x2713; | &#x2713; |
| Брандмауэр веб-приложения (WAF)                    | &#x2713; | &#x2713; |
| Настраиваемые правила WAF                                  |          | &#x2713; |
| Завершение запросов TLS/SSL            | &#x2713; | &#x2713; |
| Сквозное шифрование TLS                         | &#x2713; | &#x2713; |
| Сходство сеансов                                  | &#x2713; | &#x2713; |
| Пользовательские страницы ошибок                                | &#x2713; | &#x2713; |
| Поддержка WebSocket                                 | &#x2713; | &#x2713; |
| Поддержка HTTP/2                                    | &#x2713; | &#x2713; |
| фильтрация подключений;                               | &#x2713; | &#x2713; |

> [!NOTE]
> Функция автомасштабирования SKU версии 2 теперь поддерживает [стандартные проверки работоспособности](application-gateway-probe-overview.md#default-health-probe) для автоматического отслеживания работоспособности всех ресурсов в серверном пуле и выявления неработоспособных серверных элементов. Стандартная проверка работоспособности автоматически настраивается для серверных систем, для которых отсутствует пользовательская конфигурация проверки. Дополнительные сведения см. в статье о [проверках работоспособности на шлюзе приложений](application-gateway-probe-overview.md).

## <a name="differences-from-v1-sku"></a>Отличия от SKU версии 1

В этом разделе описываются функции и ограничения SKU версии 2, отличные от SKU версии 1.

|Отличие|Сведения|
|--|--|
|Сертификат аутентификации|Не поддерживается.<br>Дополнительные сведения см. в статье [Обзор сквозного шифрования SSL с помощью Шлюза приложений](ssl-overview.md#end-to-end-tls-with-the-v2-sku).|
|Смешанное использование Standard_v2 и Шлюза приложений (цен. категория "Стандартный") в той же подсети|Не поддерживается|
|Маршрут, определяемый пользователем в подсети Шлюза приложений|Поддерживается (конкретные сценарии). Предварительная версия.<br> Дополнительные сведения см. в статье [Обзор настройки Шлюза приложений](configuration-infrastructure.md#supported-user-defined-routes).|
|NSG для диапазона портов входящего трафика| – 65200 до 65535 для SKU Standard_v2.<br>– 65503 до 65534 для SKU (цен. категория "Стандартный").<br>Дополнительные сведения см. в разделе [Часто задаваемые вопросы](application-gateway-faq.yml#are-network-security-groups-supported-on-the-application-gateway-subnet).|
|Журналы производительности в системе диагностики Azure|Не поддерживается.<br>Следует использовать метрики Azure.|
|Выставление счетов|Начало выставления счетов запланировано на 1 июля 2019 г.|
|Режим FIPS|В настоящее время не поддерживаются.|
|Только режим ILB|В настоящее время это не поддерживается. Комбинация общедоступного режима и режима ILB не поддерживается.|
|Интеграция с Наблюдателем за сетями|Не поддерживается.|
|Интеграция с Центра безопасности Azure|Пока недоступно.

## <a name="migrate-from-v1-to-v2"></a>Миграция из версии 1 в версию 2

В коллекции PowerShell доступен скрипт Azure PowerShell доступен, который поможет выполнить миграцию из Шлюза приложений или WAF версии 1 в SKU версии 2 с поддержкой автомасштабирования. Этот скрипт поможет скопировать конфигурацию со шлюза версии 1. За миграцию трафика по-прежнему отвечаете вы. Дополнительные сведения см. в статье [Миграция Шлюза приложений Azure с версии 1 на версию 2](migrate-v1-v2.md).

## <a name="next-steps"></a>Дальнейшие действия

- [Краткое руководство. Направление веб-трафика с помощью Шлюза приложений Azure на портале Azure](quick-create-portal.md).
- [Создание автоматически масштабируемого, избыточного в пределах зоны шлюза приложений с зарезервированным виртуальным IP-адресом с помощью Azure PowerShell](tutorial-autoscale-ps.md)
- Дополнительные сведения о [шлюзе приложений](overview.md).
- Дополнительные сведения о [брандмауэре Azure](../firewall/overview.md).
