---
title: Конфигурация прослушивателя шлюза приложений Azure
description: В этой статье описывается, как настроить прослушиватели шлюза приложений Azure.
services: application-gateway
author: vhorne
ms.service: application-gateway
ms.topic: conceptual
ms.date: 09/09/2020
ms.author: surmb
ms.openlocfilehash: 15f68e8cbca65e7b970944f7ca5ef1952140cc6b
ms.sourcegitcommit: 867cb1b7a1f3a1f0b427282c648d411d0ca4f81f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "93397649"
---
# <a name="application-gateway-listener-configuration"></a>Конфигурация прослушивателя шлюза приложений

[!INCLUDE [updated-for-az](../../includes/updated-for-az.md)]

Прослушиватель — это логическая сущность, которая проверяет входящие запросы на подключение с помощью порта, протокола, узла и IP-адреса. При настройке прослушивателя необходимо ввести значения, соответствующие соответствующим значениям в входящем запросе на шлюзе.

При создании шлюза приложений с помощью портал Azure также создается прослушиватель по умолчанию, который выбирает протокол и порт для прослушивателя. Можно выбрать, следует ли включить поддержку HTTP2 для прослушивателя. После создания шлюза приложений можно изменить параметры этого прослушивателя по умолчанию (*appGatewayHttpListener*) или создать новые прослушиватели.

## <a name="listener-type"></a>Тип прослушивателя

При создании нового прослушивателя выбирается режим " [ *базовый* " и " *многосайтовый*](./application-gateway-components.md#types-of-listeners)".

- Если требуется, чтобы все запросы (для любого домена) были приняты и переданы в серверные пулы, выберите базовый. Узнайте, [как создать шлюз приложений с базовым прослушивателем](./quick-create-portal.md).

- Если требуется перенаправить запросы к различным внутренним пулам на основе заголовка *узла* или имен узлов, выберите прослушиватель нескольких сайтов, где необходимо также указать имя узла, которое соответствует входящему запросу. Это связано с тем, что шлюз приложений использует заголовки узлов HTTP 1,1 для размещения нескольких веб-сайтов на одном и том же общедоступном IP-адресе и порте. Дополнительные сведения см. в разделе [Размещение нескольких сайтов с помощью шлюза приложений](multiple-site-overview.md).

### <a name="order-of-processing-listeners"></a>Порядок обработки прослушивателей

Для номера SKU v1 запросы сопоставляются в соответствии с порядком правил и типом прослушивателя. Если правило с базовым прослушивателем сначала поступает в порядке, оно обрабатывается первым и принимает любой запрос на это сочетание порта и IP-адреса. Чтобы избежать этого, сначала настройте правила с многосайтовыми прослушивателями и отправьте правило с базовым прослушивателем в последнюю из списка.

Для SKU версии 2 многосайтовые прослушиватели обрабатываются перед основными прослушивателями.

## <a name="front-end-ip-address"></a>Интерфейсный IP-адрес

Выберите IP-адрес внешнего интерфейса, который планируется связать с этим прослушивателем. Прослушиватель будет прослушивать входящие запросы на этом IP-адресе.

## <a name="front-end-port"></a>Интерфейсный порт

Выберите интерфейсный порт. Выберите существующий порт или создайте новый. Выберите любое значение из [разрешенного диапазона портов](./application-gateway-components.md#ports). Можно использовать не только хорошо известные порты, например 80 и 443, но и любой допустимый настраиваемый порт. Порт можно использовать для общедоступных прослушивателей или частных прослушивателей.

## <a name="protocol"></a>Протокол

Выберите HTTP или HTTPS:

- При выборе протокола HTTP трафик между клиентом и шлюзом приложений не шифруется.

- Выберите HTTPS, если вы хотите использовать [Завершение TLS](features.md#secure-sockets-layer-ssltls-termination) или [сквозное шифрование TLS](./ssl-overview.md). Трафик между клиентом и шлюзом приложений шифруется. И подключение TLS завершается на шлюзе приложений. Если требуется сквозное шифрование TLS, необходимо выбрать протокол HTTPS и настроить **серверный параметр HTTP** . Это гарантирует, что трафик будет повторно зашифрован при передаче из шлюза приложений в серверную.


Чтобы настроить завершение TLS и сквозное шифрование TLS, необходимо добавить сертификат в прослушиватель, чтобы шлюз приложений выдать симметричный ключ. Это определяется спецификацией протокола TLS. Симметричный ключ используется для шифрования и расшифровки трафика, отправляемого в шлюз. Сертификат шлюза должен быть в формате файла обмена личной информацией (PFX). Этот формат позволяет экспортировать закрытый ключ, используемый шлюзом для шифрования и расшифровки трафика.

## <a name="supported-certificates"></a>Поддерживаемые сертификаты

См. [Обзор завершения работы TLS и сквозной TLS с помощью шлюза приложений](ssl-overview.md#certificates-supported-for-tls-termination) .

## <a name="additional-protocol-support"></a>Поддержка дополнительных протоколов

### <a name="http2-support"></a>Поддержка HTTP2

Поддержка протокола HTTP/2 доступна для клиентов, подключающихся только к прослушивателям шлюза приложений. Взаимодействие с пулами внутренних серверов осуществляется по протоколу HTTP/1.1. Поддержка HTTP/2 отключена по умолчанию. В следующем Azure PowerShell фрагменте кода показано, как включить это:

```azurepowershell
$gw = Get-AzApplicationGateway -Name test -ResourceGroupName hm

$gw.EnableHttp2 = $true

Set-AzApplicationGateway -ApplicationGateway $gw
```

### <a name="websocket-support"></a>Поддержка WebSocket

Поддержка WebSocket включена по умолчанию. Настраиваемый пользователем параметр для включения или отключения не предусмотрен. WebSocket можно использовать с прослушивателями HTTP и HTTPS.

## <a name="custom-error-pages"></a>Пользовательские страницы ошибок

Пользовательскую ошибку можно определить на глобальном уровне или на уровне прослушивателя. Но создание настраиваемых страниц ошибок глобального уровня из портал Azure в настоящее время не поддерживается. Можно настроить настраиваемую страницу ошибки для ошибки брандмауэра веб-приложения 403 или страницы обслуживания 502 на уровне прослушивателя. Необходимо также указать общедоступный URL-адрес большого двоичного объекта для данного кода состояния ошибки. Дополнительные сведения см. в статье [Create Application Gateway custom error pages](./custom-error.md) (Создание пользовательских страниц ошибок с помощью Шлюза приложений).

![Коды ошибок службы "Шлюз приложений"](/azure/application-gateway/media/custom-error/ag-error-codes.png)

Сведения о настройке глобальной настраиваемой страницы ошибки см. в разделе [Azure PowerShell Configuration](./custom-error.md#azure-powershell-configuration).

## <a name="tls-policy"></a>Политика TLS

Вы можете централизовать управление сертификатами TLS/SSL и снизить затраты на расшифровку шифрования для внутренней фермы серверов. Централизованная обработка TLS также позволяет указать централизованную политику TLS, которая подходит для требований безопасности. Можно выбрать *стандартную*, *предопределенную* или *настраиваемую* политику TLS.

Политика TLS настраивается для управления версиями протокола TLS. Вы можете настроить шлюз приложений для использования минимальной версии протокола для подтверждений TLS из TLS 1.0, TLS 1.1 и TLS 1.2. По умолчанию SSL 2,0 и 3,0 отключены и не могут быть настроены. Дополнительные сведения см. в статье [Общие сведения о политике TLS для шлюза приложений](./application-gateway-ssl-policy-overview.md).

После создания прослушивателя связывается с правилом маршрутизации запросов. Это правило определяет, как запросы, получаемые в прослушивателе, направляются в серверную систему.

## <a name="next-steps"></a>Дальнейшие действия

- [Сведения о правилах маршрутизации запросов](configuration-request-routing-rules.md).