---
title: Часто задаваемые вопросы о Шлюзе приложений Azure
description: Ответы на часто задаваемые вопросы о Шлюзе приложений Azure.
services: application-gateway
author: vhorne
ms.service: application-gateway
ms.topic: article
ms.date: 05/26/2020
ms.author: victorh
ms.custom: references_regions
ms.openlocfilehash: d46c1d8efb5234d47c80ca4256c2f56d56ccf805
ms.sourcegitcommit: 31cfd3782a448068c0ff1105abe06035ee7b672a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/10/2021
ms.locfileid: "98060725"
---
# <a name="frequently-asked-questions-about-application-gateway"></a>Часто задаваемые вопросы о Шлюзе приложений

[!INCLUDE [updated-for-az](../../includes/updated-for-az.md)]

Ниже приведены часто задаваемые вопросы о Шлюзе приложений Azure.

## <a name="general"></a>Общие сведения

### <a name="what-is-application-gateway"></a>Что такое шлюз приложений?

Шлюз приложений Azure предоставляет контроллер доставки приложений (ADC) в виде службы. Он предлагает различные возможности подсистемы балансировки нагрузки уровня 7 для вашего приложения. Это высокодоступная и масштабируемая служба, полностью управляемая Azure.

### <a name="what-features-does-application-gateway-support"></a>Какие функции поддерживает Шлюз приложений?

Шлюз приложений поддерживает автоматическое масштабирование, разгрузку TLS и прямой режим связи TLS, брандмауэр веб-приложения (WAF), сопоставление сеансов на основе файлов cookie, маршрутизацию на основе URL-пути, размещение нескольких сайтов и другие функции. Полный список поддерживаемых функций см. в статье [Что такое Шлюз приложений Azure?](./overview.md)

### <a name="how-do-application-gateway-and-azure-load-balancer-differ"></a>Чем Шлюз приложений отличается от Azure Load Balancer?

Шлюз приложений — это подсистема балансировки нагрузки уровня 7. Это означает, что он работает только с веб-трафиком (HTTP, HTTPS, WebSocket и HTTP/2). Он поддерживает такие функции, как завершение TLS-подключений, сопоставление сеансов на основе файлов cookie и циклический перебор для распределения нагрузки трафика. Load Balancer распределяет нагрузку трафика на уровне 4 (TCP или UDP).

### <a name="what-protocols-does-application-gateway-support"></a>Какие протоколы поддерживает Шлюз приложений?

Шлюз приложений поддерживает протоколы HTTP, HTTPS, HTTP/2 и WebSocket.

### <a name="how-does-application-gateway-support-http2"></a>Как Шлюз приложений поддерживает протокол HTTP/2?

См. раздел [Поддержка HTTP/2](./configuration-listeners.md#http2-support).

### <a name="what-resources-are-supported-as-part-of-a-backend-pool"></a>Какие ресурсы поддерживаются в составе серверного пула?

См. раздел [Поддерживаемые серверные ресурсы](./application-gateway-components.md#backend-pools).

### <a name="in-what-regions-is-application-gateway-available"></a>В каких регионах доступен Шлюз приложений?

Шлюз приложений v1 (Standard и WAF) доступен во всех регионах глобального Azure. Он также доступен в [Azure для Китая (21Vianet)](https://www.azure.cn/) и [Azure для государственных организаций](https://azure.microsoft.com/overview/clouds/government/).

Сведения о доступности шлюза приложений версии 2 (Standard_v2 и WAF_v2) см. в разделе [Поддерживаемые регионы для шлюза приложений версии 2](./application-gateway-autoscaling-zone-redundant.md#supported-regions) .

### <a name="is-this-deployment-dedicated-for-my-subscription-or-is-it-shared-across-customers"></a>Это специальное развертывание для подписки или общее для всех клиентов?

Шлюз приложений — это специальное развертывание в вашей виртуальной сети.

### <a name="does-application-gateway-support-http-to-https-redirection"></a>Поддерживает ли Шлюз приложений перенаправление с HTTP на HTTPS?

Перенаправление поддерживается. См. статью [Общие сведения о перенаправлении для Шлюза приложений](./redirect-overview.md).

### <a name="in-what-order-are-listeners-processed"></a>В каком порядке обрабатываются прослушиватели?

См. раздел [Порядок обработки прослушивателей](./configuration-listeners.md#order-of-processing-listeners).

### <a name="where-do-i-find-the-application-gateway-ip-and-dns"></a>Где найти IP-адрес и DNS-имя Шлюза приложений?

Если вы используете общедоступный IP-адрес в качестве конечной точки, вы найдете сведения о нем и DNS на ресурсе этого общедоступного IP-адреса. Его также можно найти на портале на странице обзора Шлюза приложений. Если вы используете внутренние IP-адреса, информацию можно найти на странице обзора.

В качестве номера SKU версии 2 откройте ресурс общедоступного IP-адреса и выберите **Конфигурация**. Для настройки DNS-имени доступно поле **Метка DNS-имени (дополнительно)** .

### <a name="what-are-the-settings-for-keep-alive-timeout-and-tcp-idle-timeout"></a>Каковы параметры времени ожидания проверки активности и времени ожидания простоя TCP?

*Время ожидания проверки активности* определяет, как долго Шлюз приложений будет ожидать отправки клиентом другого HTTP-запроса на постоянное подключение, прежде чем использовать его повторно или закрыть. *Время ожидания простоя TCP* определяет время, в течение которого TCP-подключение остается открытым в случае отсутствия активности. 

*Время ожидания проверки активности* в номере SKU Шлюза приложений версии 1 составляет 120 секунд, а в номере SKU версии 2 — 75 секунд. *Время ожидания простоя TCP* для интерфейсного виртуального IP-адреса (VIP) обоих номеров SKU Шлюза приложений (версий 1 и 2) по умолчанию составляет 4 минуты. Можно настроить значение времени ожидания простоя TCP для шлюзов приложений v1 и v2 в пределах от 4 минут до 30 минут. Для шлюзов приложений версии v1 и v2 необходимо перейти на общедоступный IP-адрес шлюза приложений и изменить время ожидания простоя TCP в колонке "Конфигурация" общедоступного IP-адреса на портале. Вы можете задать значение времени ожидания простоя TCP общедоступного IP-адреса с помощью PowerShell, выполнив следующие команды: 

```azurepowershell-interactive
$publicIP = Get-AzPublicIpAddress -Name MyPublicIP -ResourceGroupName MyResourceGroup
$publicIP.IdleTimeoutInMinutes = "15"
Set-AzPublicIpAddress -PublicIpAddress $publicIP
```

### <a name="does-the-ip-or-dns-name-change-over-the-lifetime-of-the-application-gateway"></a>Меняются ли IP-адрес и DNS-имя в течение времени существования шлюза приложений?

Если вы останавливаете и запускаете шлюз приложений при использовании номера SKU Шлюза приложений версии 1, виртуальный IP-адрес может измениться. Однако DNS-имя, связанное со шлюзом приложений, не меняется никогда. Поскольку оно остается неизменным, мы рекомендуем использовать псевдоним CNAME и настроить его для DNS-адреса шлюза приложений. Для номера SKU Шлюза приложений версии 2 можно задать статический IP-адрес, чтобы IP-адрес и DNS-имя не менялись в течение времени существования шлюза приложений. 

### <a name="does-application-gateway-support-static-ip"></a>Поддерживает ли Шлюз приложений статические IP-адреса?

Да, номер SKU Шлюза приложений версии 2 поддерживает статические общедоступные IP-адреса. Номер SKU версии 1 поддерживает статические внутренние IP-адреса.

### <a name="does-application-gateway-support-multiple-public-ips-on-the-gateway"></a>Поддерживает ли Шлюз приложений несколько общедоступных IP-адресов в шлюзе?

Шлюз приложений поддерживает только один общедоступный IP-адрес.

### <a name="how-large-should-i-make-my-subnet-for-application-gateway"></a>Каким должен быть размер подсети Шлюза приложений?

См. [рекомендации по выбору размера подсети Шлюза приложений](./configuration-infrastructure.md#size-of-the-subnet).

### <a name="can-i-deploy-more-than-one-application-gateway-resource-to-a-single-subnet"></a>Можно ли развернуть более одного ресурса шлюза приложений в одной подсети?

Да. Помимо нескольких экземпляров конкретного развертывания Шлюза приложений вы можете подготовить другой уникальный ресурс Шлюза приложений в существующей подсети, которая уже содержит другой ресурс Шлюза приложений.

Одна подсеть не поддерживает оба номера SKU Шлюза приложений версий 2 и 1.

### <a name="does-application-gateway-v2-support-user-defined-routes-udr"></a>Поддерживает ли Шлюз приложений версии 2 определяемые пользователем маршруты (UDR)?

Да, но только в определенных сценариях. Дополнительные сведения см. в статье [Конфигурация инфраструктуры шлюза приложений](configuration-infrastructure.md#supported-user-defined-routes).

### <a name="does-application-gateway-support-x-forwarded-for-headers"></a>Поддерживает ли Шлюз приложений заголовки X-Forwarded-For?

Да. См. раздел [Изменения в запросе](./how-application-gateway-works.md#modifications-to-the-request).

### <a name="how-long-does-it-take-to-deploy-an-application-gateway-will-my-application-gateway-work-while-its-being-updated"></a>Сколько времени требуется для развертывания шлюза приложений? Работает ли шлюз приложений во время обновления?

Подготовка новых развертываний номера SKU Шлюза приложений версии 1 может занять до 20 минут. Изменения в размере или числе экземпляров не нарушают работу шлюза приложений, он остается активным во время обновления.

В большинстве развертываний с номером SKU версии 2 подготовка к работе занимает около 6 минут. Однако для некоторых типов развертывания может потребоваться больше времени. Например, развертывание в нескольких Зонах доступности с несколькими экземплярами может занять более 6 минут. 

### <a name="can-i-use-exchange-server-as-a-backend-with-application-gateway"></a>Можно ли использовать сервер Exchange Server в качестве серверного Шлюза приложений?

Нет. Шлюз приложений не поддерживает такие протоколы электронной почты, как SMTP, IMAP и POP3.

### <a name="is-there-guidance-available-to-migrate-from-the-v1-sku-to-the-v2-sku"></a>Имеются ли рекомендации по переходу с номера SKU версии 1 на номер SKU версии 2?

Да. Дополнительные сведения см. в статье [Миграция Шлюза приложений Azure и брандмауэра веб-приложения с версии 1 на версию 2](migrate-v1-v2.md).

### <a name="will-the-application-gateway-v1-sku-continue-to-be-supported"></a>Будет ли поддерживаться номер SKU Шлюза приложений версии 1?

Да. Номер SKU Шлюза приложений версии 1 будет поддерживаться и в дальнейшем. Однако настоятельно рекомендуется перейти на версию 2, чтобы воспользоваться преимуществами обновлений компонентов в этом номере SKU. Дополнительные сведения см. в статье [Автоматическое масштабирование и Шлюз приложений, избыточный между зонами, версии 2](application-gateway-autoscaling-zone-redundant.md).

### <a name="does-application-gateway-v2-support-proxying-requests-with-ntlm-authentication"></a>Поддерживает ли Шлюз приложений версии 2 запросы прокси с проверкой подлинности NTLM?

Нет. Шлюз приложений версии 2 не поддерживает запросы прокси с проверкой подлинности NTLM.

### <a name="does-application-gateway-affinity-cookie-support-samesite-attribute"></a>Поддерживает ли атрибут SameSite файл cookie сходства Шлюза приложений?
Да, в [обновлении браузера Chromium](https://www.chromium.org/Home) [версии 80](https://chromiumdash.appspot.com/schedule) внедрено предписание считать, что для файлов cookie HTTP без атрибута SameSite значение SameSite=Lax. Это означает, что браузер не будет отправлять файл cookie сходства Шлюза приложений в контексте решений сторонних разработчиков. 

В этом сценарии Шлюз приложений внедряет в дополнение к существующему файлу cookie *ApplicationGatewayAffinity* другой идентичный файл cookie с именем *ApplicationGatewayAffinityCORS*.  Эти файлы cookie похожи, но к файлу cookie *ApplicationGatewayAffinityCORS* добавлены еще два атрибута: *SameSite=None; Secure*. Эти атрибуты поддерживают закрепленные сеансы даже для междоменных запросов. Дополнительные сведения см. в разделе [Сходство на основе файлов cookie](configuration-http-settings.md#cookie-based-affinity).

## <a name="performance"></a>Производительность

### <a name="how-does-application-gateway-support-high-availability-and-scalability"></a>Каким образом Шлюз приложений поддерживает высокий уровень доступности и масштабируемость?

Если развернуто два или больше экземпляров, номер SKU Шлюза приложений версии 1 поддерживает сценарии с высоким уровнем доступности. Azure распределяет эти экземпляры по доменам сбоя и обновления, чтобы избежать одновременного сбоя всех экземпляров. Номер SKU версии 1 поддерживает масштабируемость путем добавления нескольких экземпляров одного шлюза для распределения нагрузки.

Номер SKU версии 2 автоматически гарантирует, что новые экземпляры распределяются между доменами сбоя и доменами обновления. Если вы выбрали избыточность между зонами, последние экземпляры также распределяются по зонам доступности, что обеспечивает устойчивость зон к сбоям.

### <a name="how-do-i-achieve-a-dr-scenario-across-datacenters-by-using-application-gateway"></a>Как реализовать сценарий аварийного восстановления в центрах обработки данных с помощью Шлюза приложений?

Используйте Диспетчер трафика для распределения трафика между несколькими шлюзами приложений в разных центрах обработки данных.

### <a name="does-application-gateway-support-autoscaling"></a>Поддерживает ли Шлюз приложений автомасштабирование?

Да, номер SKU Шлюза приложений версии 2 поддерживает автоматическое масштабирование. Дополнительные сведения см. в статье [Автоматическое масштабирование и Шлюз приложений, избыточный между зонами](application-gateway-autoscaling-zone-redundant.md).

### <a name="does-manual-or-automatic-scale-up-or-scale-down-cause-downtime"></a>Вызывает ли простой автоматическое вертикальное увеличение или уменьшение масштаба?

Нет. Экземпляры распределяются через домены обновления и домены сбоя.

### <a name="does-application-gateway-support-connection-draining"></a>Поддерживает ли Шлюз приложений фильтрацию подключений?

Да. Вы можете настроить фильтрацию подключений, чтобы изменить участников во внутреннем пуле без прерывания. Дополнительные сведения см. в разделе [Фильтрация подключений](features.md#connection-draining) для Шлюза приложений.

### <a name="can-i-change-instance-size-from-medium-to-large-without-disruption"></a>Можно ли изменить размер экземпляра со среднего на большой без прерывания?

Да.

## <a name="configuration"></a>Конфигурация

### <a name="is-application-gateway-always-deployed-in-a-virtual-network"></a>Всегда ли Шлюз приложений развертывается в виртуальной сети?

Да. Шлюз приложений всегда развертывается в подсети виртуальной сети. Эта подсеть может содержать только шлюзы приложений. Дополнительные сведения см. в [требованиях к виртуальной сети и подсети](./configuration-infrastructure.md#virtual-network-and-dedicated-subnet).

### <a name="can-application-gateway-communicate-with-instances-outside-of-its-virtual-network-or-outside-of-its-subscription"></a>Может ли Шлюз приложений взаимодействовать с экземплярами за пределами виртуальной сети своей подписки?

При наличии IP-подключения Шлюз приложений может взаимодействовать с экземплярами за пределами виртуальной сети, к которой он относится. Шлюз приложений также может взаимодействовать с экземплярами вне подписки, к которой он принадлежит. Если вы планируете использовать внутренние IP-адреса в качестве участников серверного пула, используйте [пиринг между виртуальными сетями](../virtual-network/virtual-network-peering-overview.md) или [VPN-шлюз Azure](../vpn-gateway/vpn-gateway-about-vpngateways.md).

### <a name="can-i-deploy-anything-else-in-the-application-gateway-subnet"></a>Можно ли развернуть еще что-нибудь в подсети шлюза приложений?

Нет. Однако вы можете развернуть другие шлюзы приложений в подсети.

### <a name="are-network-security-groups-supported-on-the-application-gateway-subnet"></a>Поддерживаются ли группы безопасности сети в подсети шлюза приложений?

См. раздел [Группы безопасности сети в подсети Шлюза приложений](./configuration-infrastructure.md#network-security-groups).

### <a name="does-the-application-gateway-subnet-support-user-defined-routes"></a>Поддерживает ли подсеть шлюза приложений определяемые пользователем маршруты?

См. раздел [Определяемые пользователем маршруты, поддерживаемые в подсети Шлюза приложений](./configuration-infrastructure.md#supported-user-defined-routes).

### <a name="are-service-endpoint-policies-supported-in-the-application-gateway-subnet"></a>Поддерживаются ли политики конечной точки службы в подсети шлюза приложений?

Нет. [Политики конечных точек службы](../virtual-network/virtual-network-service-endpoint-policies-overview.md) для учетных записей хранения не поддерживаются в подсети шлюза приложений, и их настройка приведет к блокировке трафика инфраструктуры Azure.

### <a name="what-are-the-limits-on-application-gateway-can-i-increase-these-limits"></a>Какие у шлюза приложений ограничения? Можно ли увеличить предельные значения?

См. раздел [Ограничения Шлюза приложений](../azure-resource-manager/management/azure-subscription-service-limits.md#application-gateway-limits).

### <a name="can-i-simultaneously-use-application-gateway-for-both-external-and-internal-traffic"></a>Можно ли использовать Шлюз приложений одновременно для внешнего и внутреннего трафика?

Да. Служба "Шлюз приложений" поддерживает один внутренний и один внешний IP-адрес для каждого шлюза приложений.

### <a name="does-application-gateway-support-virtual-network-peering"></a>Поддерживает ли Шлюз приложений пиринг между виртуальными сетями?

Да. Пиринг между виртуальными сетями обеспечивает балансировку нагрузки трафика в других виртуальных сетях.

### <a name="can-i-talk-to-on-premises-servers-when-theyre-connected-by-expressroute-or-vpn-tunnels"></a>Можно ли взаимодействовать с локальными серверами, если они подключены через туннели ExpressRoute или VPN?

Да, при условии, что разрешен трафик.

### <a name="can-one-backend-pool-serve-many-applications-on-different-ports"></a>Может ли один серверный пул обслуживать несколько приложений, используя разные порты?

Архитектура микрослужб поддерживается. Для проверки различных портов потребуется настроить несколько параметров HTTP.

### <a name="do-custom-probes-support-wildcards-or-regex-on-response-data"></a>Поддерживают ли пользовательские зонды подстановочные знаки или регулярные выражения в данных ответа?

Нет. 

### <a name="how-are-routing-rules-processed-in-application-gateway"></a>Как обрабатываются правила маршрутизации в Шлюзе приложений?

См. раздел [Порядок правил обработки](./configuration-request-routing-rules.md#order-of-processing-rules).

### <a name="for-custom-probes-what-does-the-host-field-signify"></a>Что означает поле Host для пользовательских зондов?

В поле Host указывается имя для отправки зонда при настройке поддержки нескольких сайтов в Шлюзе приложений. В противном случае используйте 127.0.0.1. Это значение отличается от имени компьютера виртуальной машины. Его формат: \<protocol\> :// \<host\> : \<port\> \<path\> .

### <a name="can-i-allow-application-gateway-access-to-only-a-few-source-ip-addresses"></a>Можно ли разрешить Шлюзу приложений доступ только к некоторым исходным IP-адресам?

Да. См. раздел [Ограничение доступа для определенных исходных IP-адресов](./configuration-infrastructure.md#allow-access-to-a-few-source-ips).

### <a name="can-i-use-the-same-port-for-both-public-facing-and-private-facing-listeners"></a>Можно ли использовать один и тот же порт для прослушивателей общедоступных и частных сетей?

Нет.

### <a name="does-application-gateway-support-ipv6"></a>Поддерживает ли Шлюз приложений протокол IPv6?

В настоящее время Шлюз приложений версии 2 не поддерживает IPv6. Он может работать в виртуальной сети с двумя стеками, используя только протокол IPv4, но в подсети шлюза должен использоваться только протокол IPv4. Шлюз приложений версии 1 не поддерживает виртуальные сети с двумя стеками. 

### <a name="how-do-i-use-application-gateway-v2-with-only-private-frontend-ip-address"></a>Как использовать Шлюз приложений версии 2 только с частным интерфейсным IP-адресом?

В настоящее время Шлюз приложений версии 2 не поддерживает режим только частного IP-адреса. Он поддерживает следующие сочетания:
* частный и общедоступный IP-адреса;
* только общедоступный IP-адрес.

Но если вы хотите использовать Шлюз приложений версии 2 только с частным IP-адресом, можно выполнить описанный ниже процесс.
1. Создайте Шлюз приложений с общедоступным и частным интерфейсным IP-адресами.
2. Не создавайте прослушиватели для общедоступного интерфейсного IP-адреса. Шлюз приложений не будет ожидать передачи трафика по общедоступному IP-адресу, если для него не созданы прослушиватели.
3. Создайте и подключите [группу безопасности сети](../virtual-network/network-security-groups-overview.md) для подсети Шлюза приложений, задав следующие настройки в порядке приоритета.
    
    а. Разрешите трафик, указав в качестве источника тег службы **GatewayManager**, в качестве назначения — **Любой**, а в качестве порта назначения — **65200-65535**. Такой диапазон портов требуется для обмена данными в рамках инфраструктуры Azure. Эти порты защищены (заблокированы) службой проверки подлинности сертификата. Внешние сущности, включая администраторов пользователей Шлюза, не могут инициировать изменения на этих конечных точках без соответствующих сертификатов.
    
    b. Разрешите трафик, указав в качестве источника тег службы **AzureLoadBalancer**, а в качестве назначения и порта назначения — **Любой**.
    
    c. Запретите весь входящий трафик, указав в качестве запрещенного источника тег службы **Internet**, а в качестве назначения и порта назначения — **Любой**. В правилах для входящих подключений установите для этого правила *минимальный приоритет*.
    
    d. Сохраните правила по умолчанию, например правило, разрешающее входящий трафик из виртуальной сети, чтобы не блокировался доступ к частному IP-адресу.
    
    д) Исходящее подключение к Интернету не может быть заблокировано. В противном случае возникнут проблемы с ведением журнала, метриками и т. п.

Ниже приведен пример конфигурации NSG для доступа только к частным IP-адресам. ![Конфигурация группы безопасности сети Шлюза приложений версии 2 для доступа только к частным IP-адресам](./media/application-gateway-faq/appgw-privip-nsg.png)

## <a name="configuration---tls"></a>Конфигурация — TLS

### <a name="what-certificates-does-application-gateway-support"></a>Какие сертификаты поддерживает Шлюз приложений?

Шлюз приложений поддерживает самозаверяющие сертификаты, сертификаты центров сертификации, сертификаты расширенной проверки (EV), сертификаты в нескольких доменах (SAN) и сертификаты с подстановочными знаками.

### <a name="what-cipher-suites-does-application-gateway-support"></a>Какие комплекты шифров поддерживает Шлюз приложений?

Шлюз приложений поддерживает перечисленные ниже комплекты шифров. 

- TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384
- TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256
- TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384
- TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256
- TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA
- TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA
- TLS_DHE_RSA_WITH_AES_256_GCM_SHA384
- TLS_DHE_RSA_WITH_AES_128_GCM_SHA256
- TLS_DHE_RSA_WITH_AES_256_CBC_SHA
- TLS_DHE_RSA_WITH_AES_128_CBC_SHA
- TLS_RSA_WITH_AES_256_GCM_SHA384
- TLS_RSA_WITH_AES_128_GCM_SHA256
- TLS_RSA_WITH_AES_256_CBC_SHA256
- TLS_RSA_WITH_AES_128_CBC_SHA256
- TLS_RSA_WITH_AES_256_CBC_SHA
- TLS_RSA_WITH_AES_128_CBC_SHA
- TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384
- TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256
- TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA384
- TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA256
- TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA
- TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA
- TLS_DHE_DSS_WITH_AES_256_CBC_SHA256
- TLS_DHE_DSS_WITH_AES_128_CBC_SHA256
- TLS_DHE_DSS_WITH_AES_256_CBC_SHA
- TLS_DHE_DSS_WITH_AES_128_CBC_SHA
- TLS_RSA_WITH_3DES_EDE_CBC_SHA
- TLS_DHE_DSS_WITH_3DES_EDE_CBC_SHA

Дополнительные сведения о настройке параметров TLS см. в статье [Настройка версий политики TLS и комплектов шифров на Шлюзе приложений](application-gateway-configure-ssl-policy-powershell.md).

### <a name="does-application-gateway-support-reencryption-of-traffic-to-the-backend"></a>Поддерживает ли Шлюз приложений повторное шифрование трафика, передаваемого на внутренний сервер?

Да. Шлюз поддерживает разгрузку TLS и сквозное шифрование TLS, которые обеспечивают повторное шифрование трафика, передаваемого на внутренний сервер.

### <a name="can-i-configure-tls-policy-to-control-tls-protocol-versions"></a>Можно ли настроить политику TLS для управления версиями протокола TLS?

Да. Вы можете настроить Шлюз приложений, чтобы запретить версии TLS 1.0, TLS 1.1 и TLS 1.2. По умолчанию протоколы SSL версий 2.0 и 3.0 уже отключены, и их настройки нельзя изменить.

### <a name="can-i-configure-cipher-suites-and-policy-order"></a>Можно ли настроить комплекты шифров и порядок политик?

Да. В Шлюзе приложений можно [настроить комплекты шифров](application-gateway-ssl-policy-overview.md). Для определения пользовательской политики включите хотя бы один из следующих комплектов шифров. 

* TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256 
* TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256
* TLS_DHE_RSA_WITH_AES_128_GCM_SHA256
* TLS_RSA_WITH_AES_128_GCM_SHA256
* TLS_RSA_WITH_AES_256_CBC_SHA256
* TLS_RSA_WITH_AES_128_CBC_SHA256

Шлюз приложений использует SHA256 для управления серверной частью.

### <a name="how-many-tlsssl-certificates-does-application-gateway-support"></a>Сколько сертификатов TLS/SSL поддерживает Шлюз приложений?

Шлюз приложений поддерживает до 100 сертификатов TLS/SSL.

### <a name="how-many-authentication-certificates-for-backend-reencryption-does-application-gateway-support"></a>Сколько сертификатов проверки подлинности поддерживает Шлюз приложений для повторного шифрования на внутреннем сервере?

Шлюз приложений поддерживает до 100 сертификатов проверки подлинности.

### <a name="does-application-gateway-natively-integrate-with-azure-key-vault"></a>Предусмотрена ли в Шлюзе приложений встроенная интеграция с Azure Key Vault?

Да, номер SKU Шлюза приложений версии 2 поддерживает Key Vault. Дополнительные сведения см. в статье о [завершении TLS-подключений с использованием сертификатов из Key Vault](key-vault-certs.md).

### <a name="how-do-i-configure-https-listeners-for-com-and-net-sites"></a>Как настроить прослушиватели HTTPS для сайтов в доменах .com и .net? 

Для маршрутизации в нескольких доменах (на основе узла) можно создать многосайтовые прослушиватели, настроить прослушиватели, использующие протокол HTTPS, и связать прослушиватели с правилами маршрутизации. Дополнительные сведения см. в статье [Размещение нескольких сайтов с помощью Шлюза приложений](./multiple-site-overview.md).

### <a name="can-i-use-special-characters-in-my-pfx-file-password"></a>Можно ли использовать специальные символы в пароле PFX-файла?

Нет, в пароле PFX-файла следует использовать только буквы и цифры.

### <a name="my-ev-certificate-is-issued-by-digicert-and-my-intermediate-certificate-has-been-revoked-how-do-i-renew-my-certificate-on-application-gateway"></a>Сертификат EV выдан DigiCert, а промежуточный сертификат был отозван. Разделы справки продлить сертификат на шлюзе приложений?

В недавно опубликованных отчетах члены обозревателя центра сертификации получают сведения о нескольких сертификатах, выданных поставщиками центров сертификации, которые используются нашими клиентами, корпорацией Майкрософт и техническим сообществом, которое не соответствует отраслевым стандартам для общедоступных центров сертификации.Отчеты, касающиеся несоответствующих ЦС, можно найти здесь:  

* [Ошибка 1649951](https://bugzilla.mozilla.org/show_bug.cgi?id=1649951)
* [Ошибка 1650910](https://bugzilla.mozilla.org/show_bug.cgi?id=1650910)

Согласно требованиям отрасли поставщики ЦС начали отменять несоответствующие центры сертификации и выдавать соответствующие им ЦС, которые требуют повторной выдачи сертификатов клиентами.Корпорация Майкрософт тесно взаимодействует с этими поставщиками, чтобы максимально сократить потенциальные последствия использования служб Azure, **но сертификаты или сертификаты, используемые в сценариях "присвоить собственный сертификат" (BYOC), по-прежнему подвергаются неожиданному отзыву**.

Чтобы проверить, были ли сертификаты, используемые приложением, были отозваны, [DigiCert объявление](https://knowledge.digicert.com/alerts/DigiCert-ICA-Replacement) и [средство регистрации отзыва сертификатов](https://misissued.com/#revoked). Если сертификаты были отозваны или будут отозваны, вам потребуется запросить новые сертификаты от поставщика ЦС, используемого в ваших приложениях. Чтобы предотвратить прерывание доступности приложения из-за неожиданного отзыва сертификатов или обновления отозванного сертификата, обратитесь к нашим сообщениям об обновлениях Azure, чтобы получить ссылки на исправления различных служб Azure, которые поддерживают BYOC: https://azure.microsoft.com/updates/certificateauthorityrevocation/

Сведения о конкретных шлюзах приложений см. ниже.

Если вы используете сертификат, выданный одним из отозванных ИКАС, доступность приложения может быть прервана, и в зависимости от приложения может появиться множество сообщений об ошибках, включая, помимо прочего, следующие: 

1.  Недопустимый сертификат или отозванный сертификат
2.  Время ожидания подключения истекло
3.  HTTP 502

Чтобы избежать перерыва в работе приложения из-за этой проблемы или повторного выпуска центра сертификации, который был отозван, необходимо выполнить следующие действия. 

1.  Обратитесь к поставщику сертификатов, чтобы повторно выдать сертификаты.
2.  После повторного выпуска обновите сертификаты на шлюзе приложений Azure или WAF с полной [цепочкой доверия](/windows/win32/seccrypto/certificate-chains) (конечный, промежуточный, корневой сертификат). В зависимости от того, где вы используете сертификат, на прослушивателе или в параметрах HTTP шлюза приложений выполните следующие действия, чтобы обновить сертификаты и просмотреть ссылки на документацию, упоминаемые для получения дополнительных сведений.
3.  Обновите серверы серверных приложений, чтобы использовать повторно выданный сертификат. В зависимости от используемого внутреннего сервера действия по обновлению сертификата могут отличаться. Обратитесь к документации поставщика.

Чтобы обновить сертификат в прослушивателе, выполните следующие действия.

1.  В [портал Azure](https://portal.azure.com/)Откройте ресурс шлюза приложений.
2.  Откройте параметры прослушивателя, связанные с сертификатом.
3.  Щелкните "продлить или изменить выбранный сертификат".
4.  Отправьте новый сертификат PFX с паролем и нажмите кнопку Сохранить.
5.  Доступ к веб-сайту и проверка правильности работы сайта для получения дополнительных сведений см. документацию [здесь](./renew-certificates.md).

Если вы ссылаетесь на сертификаты из Azure KeyVault в прослушивателе шлюза приложений, рекомендуем выполнить следующие действия для быстрого изменения:

1.  В [портал Azure](https://portal.azure.com/)перейдите к параметрам Azure KeyVault, которые были связаны с шлюзом приложений.
2.  Добавьте или импортируйте повторно выданный сертификат в хранилище. Дополнительные сведения см. [в документации.](../key-vault/certificates/quick-create-portal.md)
3.  После импорта сертификата перейдите к параметрам прослушивателя шлюза приложений и в разделе "выберите сертификат из Key Vault" щелкните раскрывающийся список "сертификат" и выберите недавно добавленный сертификат.
4.  Щелкните Save (сохранить), чтобы получить дополнительные сведения о прерывании TLS в шлюзе приложений с Key Vault сертификатами. см. документацию [здесь](./key-vault-certs.md).


Чтобы обновить сертификат в параметрах HTTP:

Если вы используете номер SKU v1 службы шлюза приложений или WAF, необходимо передать новый сертификат как внутренний сертификат проверки подлинности.
1.  В [портал Azure](https://portal.azure.com/)Откройте ресурс шлюза приложений.
2.  Откройте параметры HTTP, связанные с сертификатом.
3.  Щелкните "добавить сертификат" и отправьте повторно выданный сертификат и нажмите кнопку "Сохранить".
4.  Старый сертификат можно удалить позже, нажав кнопку... Нажмите кнопку Параметры рядом со старым сертификатом и выберите Удалить и щелкните Сохранить.
Дополнительные сведения см. в документации [здесь](./end-to-end-ssl-portal.md#add-authenticationtrusted-root-certificates-of-back-end-servers).

Если вы используете SKU v2 для шлюза приложений или службы WAF, вам не нужно загружать новый сертификат в параметрах HTTP, так как SKU v2 использует "Доверенные корневые сертификаты", и никаких действий не требуется.

## <a name="configuration---ingress-controller-for-aks"></a>Конфигурация — контроллера входящего трафика для AKS

### <a name="what-is-an-ingress-controller"></a>Что такое контроллер входящего трафика?

Служба Kubernetes позволяет создавать ресурсы `deployment` и `service` для внутреннего представления группы модулей pod в кластере. Для внешнего представления той же службы определяется ресурс [`Ingress`](https://kubernetes.io/docs/concepts/services-networking/ingress/), который обеспечивает балансировку нагрузки, завершение TLS-подключений и виртуальное размещение на основе имени.
Для работы с этим ресурсом `Ingress` требуется контроллер входящего трафика, который ожидает передачи данных о любых изменениях в ресурсах `Ingress` и настраивает политики подсистемы балансировки нагрузки.

Контроллер входящего трафика шлюза приложений (АГИК) позволяет использовать [шлюз приложений Azure](https://azure.microsoft.com/services/application-gateway/) в качестве входящего трафика для [службы Kubernetes Azure](https://azure.microsoft.com/services/kubernetes-service/) , также известной как кластер AKS.

### <a name="can-a-single-ingress-controller-instance-manage-multiple-application-gateways"></a>Может ли один экземпляр контроллера входящего трафика управлять несколькими Шлюзами приложений?

В настоящее время один экземпляр контроллера входящего трафика может быть связан только с одним Шлюзом приложений.

### <a name="why-is-my-aks-cluster-with-kubenet-not-working-with-agic"></a>Почему мой кластер AKS с кубенет не работает с АГИК?

АГИК пытается автоматически связать ресурс таблицы маршрутов с подсетью шлюза приложений, но может не выполнить это из-за отсутствия разрешений в АГИК. Если АГИК не удалось связать таблицу маршрутов с подсетью шлюза приложений, в журналах АГИК будет обнаружена ошибка. в этом случае необходимо вручную связать таблицу маршрутов, созданную кластером AKS, с подсетью шлюза приложений. Дополнительные сведения см. в разделе [Поддерживаемые определяемые пользователем маршруты](configuration-infrastructure.md#supported-user-defined-routes).

### <a name="can-i-connect-my-aks-cluster-and-application-gateway-in-separate-virtual-networks"></a>Можно ли подключить кластер AKS и шлюз приложений в отдельных виртуальных сетях? 

Да, при условии, что виртуальные сети равноправны и не имеют перекрывающихся адресных пространств. Если вы используете AKS с кубенет, убедитесь, что таблица маршрутов, созданная AKS, связана с подсетью шлюза приложений. 

### <a name="what-features-are-not-supported-on-the-agic-add-on"></a>Какие функции не поддерживаются в надстройке АГИК? 

Различия между АГИК, развернутыми с помощью Helm и развернутыми в качестве надстройки AKS, см. [здесь](ingress-controller-overview.md#difference-between-helm-deployment-and-aks-add-on)

### <a name="when-should-i-use-the-add-on-versus-the-helm-deployment"></a>Когда следует использовать надстройку и развертывание Helm? 

Ознакомьтесь с различиями между АГИК, развернутыми через Helm, и развернутым в качестве надстройки AKS [здесь](ingress-controller-overview.md#difference-between-helm-deployment-and-aks-add-on), особенно в таблицах, в которых документированы ПОДДЕРЖИВАЕМЫЕ сценарии агик, развернутые с помощью Helm, а не надстройки AKS. Как правило, развертывание с помощью Helm позволит вам протестировать бета-функции и кандидаты выпуска до официального выпуска. 

### <a name="can-i-control-which-version-of-agic-will-be-deployed-with-the-add-on"></a>Можно ли контролировать, какая версия АГИК будет развернута с надстройкой?

Нет, АГИК надстройка — это управляемая служба, которая означает, что корпорация Майкрософт будет автоматически обновлять надстройку до последней стабильной версии. 

## <a name="diagnostics-and-logging"></a>Диагностика и ведение журнала

### <a name="what-types-of-logs-does-application-gateway-provide"></a>Какие типы журналов предоставляет Шлюз приложений?

Шлюз приложений предоставляет три журнала. 

* **ApplicationGatewayAccessLog**. В журнале доступа содержится каждый запрос, переданный во внешний интерфейс шлюза приложений. Здесь указаны такие данные, как IP-адрес вызывающего объекта, запрашиваемый URL-адрес, задержка ответа, код возврата, а также входящие и исходящие байты. Журнал содержит одну запись для каждого шлюза приложений.
* **ApplicationGatewayPerformanceLog**. В журнале производительности записываются сведения о производительности каждого шлюза приложений. Здесь указываются сведения о пропускной способности в байтах, общем числе обслуженных запросов, количестве неудачных запросов, а также числе работоспособных и неработоспособных внутренних экземпляров.
* **ApplicationGatewayFirewallLog**. Для шлюзов приложений, настроенных с использованием WAF, журнал брандмауэра содержит запросы, которые записываются в него в режиме обнаружения или предотвращения.

Данные для всех журналов собираются каждые 60 секунд. Дополнительные сведения см. в статье о [работоспособности, журналах диагностики внутренних серверов и метриках для Шлюза приложений](application-gateway-diagnostics.md).

### <a name="how-do-i-know-if-my-backend-pool-members-are-healthy"></a>Как узнать, работоспособны ли участники серверного пула?

Проверьте работоспособность с помощью командлета PowerShell `Get-AzApplicationGatewayBackendHealth` или портала. Дополнительные сведения см. в разделе [Журналы диагностики](application-gateway-diagnostics.md).

### <a name="whats-the-retention-policy-for-the-diagnostic-logs"></a>Что такое политика хранения журналов диагностики?

Данные журналов диагностики передаются в учетную запись хранения клиента. Клиенты могут настроить политику хранения в соответствии со своими предпочтениями. Журналы диагностики также можно отправить в концентратор событий или журналы Azure Monitor. Дополнительные сведения см. в разделе [Журналы диагностики](application-gateway-diagnostics.md).

### <a name="how-do-i-get-audit-logs-for-application-gateway"></a>Как получить журналы аудита для Шлюза приложений?

Чтобы перейти к такому журналу, на портале в колонке меню шлюза приложений щелкните **Журнал действий**. 

### <a name="can-i-set-alerts-with-application-gateway"></a>Можно ли настроить оповещения для Шлюза приложений?

Да. В Шлюзе приложений оповещения настраиваются на основе метрик. Дополнительные сведения см. в статьях [Метрики для Шлюза приложений](./application-gateway-metrics.md) и [Получение уведомлений об оповещениях](../azure-monitor/platform/alerts-overview.md).

### <a name="how-do-i-analyze-traffic-statistics-for-application-gateway"></a>Как анализировать статистику трафика для Шлюза приложений?

Просматривать и анализировать журналы доступа можно несколькими способами. Можно воспользоваться журналами Azure Monitor, Excel, Power BI и т. п.

Можно также использовать шаблон Resource Manager, который устанавливает и запускает популярный анализатор журналов [GoAccess](https://goaccess.io/) для журналов доступа Шлюза приложений. GoAccess предоставляет ценную статистику трафика HTTP, такую как уникальные посетители, запрошенные файлы, узлы, операционные системы, браузеры, коды состояния HTTP и многое другое. Дополнительные сведения см. на GitHub в [файле сведений в папке шаблона Resource Manager](https://aka.ms/appgwgoaccessreadme).

### <a name="what-could-cause-backend-health-to-return-an-unknown-status"></a>Что может быть причиной возврата неизвестного состояния работоспособности внутреннего сервера?

Как правило, состояние отображается как неизвестное, когда доступ к внутреннему серверу блокируется группой безопасности сети (NSG), настраиваемой службой DNS или определяемой пользователем маршрутизацией (UDR) в подсети шлюза приложений. Дополнительные сведения см. в статье о [работоспособности, журналах ведения диагностики внутренних серверов и метриках для Шлюза приложений](application-gateway-diagnostics.md).

### <a name="are-nsg-flow-logs-supported-on-nsgs-associated-to-application-gateway-v2-subnet"></a>Поддерживаются ли журналы потоков NSG в группы безопасности сети, связанном с подсетью шлюза приложений версии 2?

Из-за текущих ограничений платформы при наличии NSG в подсети шлюза приложений версии 2 (Standard_v2, WAF_v2) и при включении журналов потоков NSG вы увидите недетерминированное поведение, и в настоящее время этот сценарий не поддерживается.

### <a name="does-application-gateway-store-customer-data"></a>Хранятся ли данные клиента в шлюзе приложений?

Нет, шлюз приложений не хранит данные клиента.

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения см. в статье [Что такое Шлюз приложений Azure?](overview.md).
