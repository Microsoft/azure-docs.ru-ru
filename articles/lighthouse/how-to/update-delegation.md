---
title: Обновление делегирования
description: Узнайте, как обновить делегирование для клиента, ранее подключенного к Azure Лигхсаусе.
ms.date: 02/16/2021
ms.topic: how-to
ms.openlocfilehash: f0ed5222cdbac3d0e4d193941c2a6f233d15938c
ms.sourcegitcommit: de98cb7b98eaab1b92aa6a378436d9d513494404
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/17/2021
ms.locfileid: "100555772"
---
# <a name="update-a-delegation"></a>Обновление делегирования

После подключения подписки (или группы ресурсов) к Azure Лигхсаусе может потребоваться внести изменения. Например, клиент может принять участие в дополнительных задачах управления, для которых требуется другая встроенная роль Azure. также может потребоваться изменить клиент, которому делегирована подписка клиента.

> [!TIP]
> Хотя в этом разделе мы будем называть поставщиков услуг и клиентов, [предприятия, управляющие несколькими клиентами](../concepts/enterprise.md) , могут использовать один и тот же процесс для настройки Azure лигхсаусе и консолидации их возможностей управления.

При подключении [клиента с помощью шаблонов Azure Resource Manager (шаблоны ARM)](onboard-customer.md)для этого клиента должно быть выполнено новое развертывание. В зависимости от того, что вы изменяете, вам может потребоваться обновить исходное предложение или удалить исходное предложение и создать новое.

- **Если вы изменяете только авторизацию**: вы можете обновить делегирование, изменив только раздел " **разрешения** " шаблона ARM.
- **Если вы изменяете управляющий клиент**: необходимо создать новый шаблон ARM, используя с **мспоффернаме** , отличным от вашего предыдущего предложения.

## <a name="update-your-arm-template"></a>Обновление шаблона ARM

Чтобы обновить делегирование, необходимо развернуть шаблон ARM, который включает изменения, которые вы хотите внести.

Если вы обновляете только авторизацию (например, добавляете новую группу пользователей с ролью, которую вы не включили ранее, или изменяете роль для существующего пользователя), вы можете использовать тот же **мспоффернаме** , что и в [шаблоне ARM](onboard-customer.md#create-an-azure-resource-manager-template) , который использовался для предыдущего делегирования. Вы можете использовать предыдущий шаблон в качестве отправной точки. Затем внесите необходимые изменения, например заменить одну встроенную роль Azure на другую или добавив совершенно новую авторизацию в шаблон.

При изменении **мспоффернаме** будет считаться новым, отдельным предложением. Это необходимо, если вы изменяете управляющий клиент.

Нет необходимости изменять **мспоффернаме** , если управление клиентом остается прежним. В большинстве случаев для одного клиента и управления клиентом рекомендуется использовать только один **мспоффернаме** . Если вы решили изменить его, убедитесь, что предыдущее делегирование клиента удалено перед развертыванием нового.

## <a name="remove-the-previous-delegation"></a>Удалить предыдущее делегирование

Перед выполнением нового развертывания может потребоваться [Удалить доступ к предыдущему делегированию](remove-delegation.md). Это гарантирует, что все предыдущие разрешения будут удалены, что позволит начать чистый доступ к тем пользователям, группам и ролям, которые должны применяться в дальнейшем.

> [!IMPORTANT]
> Если вы используете новый **мспоффернаме** и сохраняете любые из тех же значений **principalId** , необходимо удалить доступ к предыдущему делегированию перед развертыванием нового предложения. Если не удалить предложение первыми, пользователи, которым ранее было предоставлено разрешение, могут полностью потерять доступ из-за конфликтующих назначений.

Если вы изменяете управляющий клиент, вы можете оставить предыдущее предложение на месте, если хотите, чтобы оба клиента продолжали получать доступ. Если требуется, чтобы только новый управляющий клиент имел доступ, необходимо удалить предыдущее предложение. Это можно сделать до или после подключения нового предложения.

Если вы обновляете предложение для корректировки только авторизации и сохраняете тот же **мспоффернаме**, вам не нужно удалять предыдущее делегирование. Новое развертывание заменит предыдущее делегирование, и будут применены только разрешения из последнего шаблона.

:::image type="content" source="../media/update-delegation.jpg" alt-text="Схема, показывающая, когда следует изменить Мспоффернаме и удалить предыдущее делегирование.":::

Удаление доступа к делегированию может осуществляться любым пользователем в управляющем клиенте, которому была предоставлена [роль "назначение регистрации управляемых служб" Удаление роли](../../role-based-access-control/built-in-roles.md#managed-services-registration-assignment-delete-role) в исходном делегировании. Если ни один пользователь в вашем управляющем клиенте не имеет этой роли, можно попросить клиента [Удалить доступ к предложению в портал Azure](view-manage-service-providers.md#add-or-remove-service-provider-offers).

> [!TIP]
> Если вы удалили предыдущее делегирование, следуя приведенным выше инструкциям, и все еще не можете развернуть новый шаблон ARM, может потребоваться [полностью удалить определение регистрации](/powershell/module/az.managedservices/remove-azmanagedservicesdefinition). Это может сделать любой пользователь с ролью, имеющей `Microsoft.Authorization/roleAssignments/write` разрешение, например [владелец](../../role-based-access-control/built-in-roles.md#owner), в клиенте клиента.  

## <a name="deploy-the-arm-template"></a>Развертывание шаблона ARM

Клиент может [развернуть обновленный шаблон](onboard-customer.md#deploy-the-azure-resource-manager-templates) так же, как и ранее: в портал Azure, с помощью PowerShell или с помощью Azure CLI.

После завершения развертывания [Убедитесь, что оно прошло успешно](onboard-customer.md#confirm-successful-onboarding). Обновленные разрешения вступят в действие в отношении подписки или групп ресурсов, делегированных клиентом.

## <a name="updating-managed-service-offers"></a>Обновление предложений управляемых служб

Если вы намерены подключить клиента через управляемую службу, опубликованную в Azure Marketplace, и хотите обновить разрешения, вы можете обновить делегирование, [опубликовав новую версию предложения](../../marketplace/partner-center-portal/update-existing-offer.md) с учетом [авторизации](../../marketplace/plan-managed-service-offer.md) , которые вы хотите использовать в плане для этого клиента. После этого клиент сможет выполнить обновление до последней версии в портал Azure.

Если вы хотите изменить управляющий клиент, вам потребуется [создать и опубликовать новое предложение управляемой службы](../../marketplace/plan-managed-service-offer.md) , которое будет принято клиентом.

> [!TIP]
> Как упоминалось ранее, не рекомендуется использовать несколько различных предложений между одним и тем же клиентом и управлением клиентом. Если вы публикуете новое предложение для того же клиента, использующего тот же управляющий клиент, убедитесь, что предыдущее предложение удаляется, прежде чем клиент примет новое предложение.

## <a name="next-steps"></a>Дальнейшие действия

- [Просматривайте клиентов и управляйте ими](view-manage-customers.md), перейдя в раздел **Мои клиенты** на портале Azure.
- Узнайте, как [удалить доступ к делегированию](remove-delegation.md), подключенному ранее.
