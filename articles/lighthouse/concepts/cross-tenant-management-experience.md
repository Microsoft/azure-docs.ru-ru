---
title: Интерфейсы управления для различных клиентов
description: Делегированное управление ресурсами Azure предоставляет интерфейсы управления для различных клиентов.
ms.date: 02/08/2021
ms.topic: conceptual
ms.openlocfilehash: b76723c9ea94581561f5bdb04ea1fd8335da77b7
ms.sourcegitcommit: 706e7d3eaa27f242312d3d8e3ff072d2ae685956
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/09/2021
ms.locfileid: "99981091"
---
# <a name="cross-tenant-management-experiences"></a>Интерфейсы управления для различных клиентов

Как поставщик услуг вы можете использовать [Azure лигхсаусе](../overview.md) для управления ресурсами для нескольких клиентов с помощью собственного клиента Azure Active Directory (Azure AD). Многие задачи и службы могут выполняться в управляемых клиентах с помощью [делегированного управления ресурсами Azure](../concepts/azure-delegated-resource-management.md).

> [!TIP]
> Делегированное управление ресурсами Azure также можно использовать [на предприятии, имеющем несколько собственных арендаторов Azure AD](enterprise.md), чтобы упростить их администрирование.

## <a name="understanding-tenants-and-delegation"></a>Общие сведения о клиентах и делегировании

Клиент Azure AD — это представление Организации. Это выделенный экземпляр Azure AD, который организация получает при создании связи с корпорацией Майкрософт, подписавшись на Azure, Microsoft 365 или другие службы. Каждый клиент Azure AD отделен от остальных клиентов Azure AD и имеет собственный идентификатор клиента (GUID). Дополнительные сведения см. в статье [Что такое Azure Active Directory](../../active-directory/fundamentals/active-directory-whatis.md).

Как правило, чтобы управлять ресурсами Azure для клиента, поставщики услуг должны будут входить на портал Azure, используя учетную запись, связанную с клиентом этого пользователя. При этом необходимо будет, чтобы администратор в клиенте пользователя создавал учетные записи пользователей и управлял ими для поставщика услуг.

С помощью Azure Лигхсаусе процесс адаптации указывает пользователей в клиенте поставщика услуг, которые смогут работать с делегированными подписками и группами ресурсов в клиенте клиента. Эти пользователи могут затем войти на портал Azure, используя собственные учетные данные. На портале Azure они могут управлять ресурсами, принадлежащими всем клиентам, к которым у них есть доступ. Это можно сделать, посетив страницу [Мои клиенты](../how-to/view-manage-customers.md) на портале Azure или работая напрямую в контексте подписки этого клиента на портале Azure или через API.

Azure Лигхсаусе обеспечивает большую гибкость в управлении ресурсами для нескольких клиентов без необходимости входить в разные учетные записи в разных клиентах. Например, у поставщика услуг может быть два клиента с разными обязанностями и уровнями доступа. С помощью Azure Лигхсаусе полномочные пользователи могут войти в клиент поставщика услуг для доступа к этим ресурсам.

![Схема, показывающая ресурсы клиентов, управляемые через одного клиента поставщика услуг.](../media/azure-delegated-resource-management-service-provider-tenant.jpg)

## <a name="apis-and-management-tool-support"></a>Поддержка интерфейсов API и средств управления

Вы можете выполнять задачи управления делегированными ресурсами непосредственно на портале или с помощью интерфейсов API и средств управления (таких как Azure CLI и Azure PowerShell). Все существующие API можно использовать для работы с делегированными ресурсами, если их функциональные возможности поддерживаются для распределенного управления арендаторами и у пользователя есть соответствующие разрешения.

Командлет Azure PowerShell [Get-азсубскриптион](/powershell/module/Az.Accounts/Get-AzSubscription) показывает `HomeTenantId` `ManagedByTenantIds` атрибуты и для каждой подписки, позволяя определить, относится ли возвращенная Подписка к управляемому клиенту или к вашему управляющему клиенту.

Аналогичным образом Azure CLI команды, например [AZ Account List](/cli/azure/account#az-account-list) , `homeTenantId` отображают `managedByTenants` атрибуты и. Если вы не видите эти значения при использовании Azure CLI, попробуйте очистить кэш, выполнив `az account clear`, а затем — `az login --identity`.

В REST API Azure команды [Subscriptions-Get](/rest/api/resources/subscriptions/get) и [Subscription-List](/rest/api/resources/subscriptions/list) включают в себя `ManagedByTenant` .

> [!NOTE]
> Помимо сведений о клиенте, связанных с Azure Лигхсаусе, клиенты, представленные этими API, также могут отражать клиентов-партнеров для Azure Databricks или управляемых приложений Azure.

Мы также предоставляем интерфейсы API, которые относятся к выполнению задач Лигхсаусе Azure. Дополнительные сведения см. в разделе **Справочные материалы**.

## <a name="enhanced-services-and-scenarios"></a>Расширенные службы и сценарии

Большинство задач и служб могут выполняться для делегированных ресурсов в управляемых арендаторах. Ниже приведены некоторые ключевые сценарии, в которых управление между клиентами может быть особенно эффективным.

Служба " [дуга Azure](../../azure-arc/index.yml)":

- Управление гибридными серверами в масштабе. [серверы с поддержкой Arc Azure](../../azure-arc/servers/overview.md):
  - [Управление компьютерами под управлением Windows Server или Linux за пределами Azure, подключенными](../../azure-arc/servers/onboard-portal.md) к делегированным подпискам и (или) группам ресурсов в Azure
  - Управление подключенными компьютерами с помощью конструкций Azure, таких как Политика Azure и добавление тегов.
  - Убедитесь, что один и тот же набор политик применяется в гибридных средах клиентов.
  - Использование центра безопасности Azure для мониторинга соответствия между гибридными средами клиентов
- Управляйте гибридными кластерами Kubernetes в масштабе. в [Azure Arc включена Kubernetes (Предварительная версия)](../../azure-arc/kubernetes/overview.md):
  - [Управление кластерами Kubernetes, подключенными](../../azure-arc/kubernetes/connect-cluster.md) к делегированным подпискам и (или) группам ресурсов в Azure
  - [Использование гитопс](../../azure-arc/kubernetes/use-gitops-connected-cluster.md) для подключенных кластеров
  - Принудительное применение политик в подключенных кластерах

[Служба автоматизации Azure](../../automation/index.yml).

- Использование учетных записей службы автоматизации для доступа к делегированным ресурсам и работы с ними

[Azure Backup.](../../backup/index.yml)

- Резервное копирование и восстановление данных клиентов [из локальных рабочих нагрузок, виртуальных машин Azure, файловых ресурсов Azure и др](../..//backup/backup-overview.md#what-can-i-back-up) .
- Используйте [Обозреватель резервного копирования](../../backup/monitor-azure-backup-with-backup-explorer.md) для просмотра оперативных сведений об элементах резервного копирования (включая ресурсы Azure, еще не настроенные для резервного копирования) и сведений о мониторинге (задания и оповещения) для делегированных подписок. В настоящее время Обозреватель резервного копирования доступен только для данных виртуальных машин Azure.
- Используйте [Отчеты о резервном копировании](../../backup/configure-reports.md) для делегированных подписок, чтобы отслеживать хронологические тенденции, анализировать потребление хранилища резервных копий и выполнять аудит резервного копирования и восстановления.

[Проекты Azure](../../governance/blueprints/index.yml):

- Использование схем Azure для управления развертыванием шаблонов ресурсов и других артефактов (требуется [дополнительный доступ](https://www.wesleyhaakman.org/preparing-azure-lighthouse-customer-subscriptions-for-azure-blueprints/) для подготовки подписки клиента)

[Управление затратами Azure + выставление счетов](../../cost-management-billing/index.yml):

- С помощью управляющего клиента партнеры CSP могут просматривать, контролировать и анализировать предварительные затраты на использование (не включая покупки) для клиентов, находящихся в плане Azure. Стоимость будет основываться на тарифах розничной торговли и управлении доступом на основе ролей Azure (Azure RBAC), которую должен иметь партнер для подписки клиента.

[Azure Key Vault](../../key-vault/general/index.yml):

- Создание хранилищ ключей в клиентских клиентах
- Использование управляемого удостоверения для создания хранилищ ключей в клиентских клиентах

[Служба Azure Kubernetes (AKS)](../../aks/index.yml):

- Управление размещенными средами Kubernetes, а также развертывание контейнерных приложений и управление ими в клиентах пользователей.
- Развертывание кластеров и управление ими в клиентских клиентах
-   Использование Azure Monitor для контейнеров для наблюдения за производительностью в клиентах клиентов

Служба " [Миграция Azure](../../migrate/index.yml)":

- Создание проектов миграции в клиенте клиента и перенос виртуальных машин

[Azure Monitor](../../azure-monitor/index.yml).

- Просмотр предупреждений для делегированных подписок с возможностью просмотра и обновления оповещений во всех подписках
- Просмотр сведений журнала действий для делегированных подписок.
- [Log Analytics](../../azure-monitor/platform/service-providers.md): запрос данных из удаленных рабочих областей в нескольких клиентах (Обратите внимание, что учетные записи службы автоматизации, используемые для доступа к данным из рабочих областей в клиентских клиентах, должны создаваться в одном клиенте).
- [Создание, просмотр и Управление оповещениями журнала действий](../../azure-monitor/platform/alerts-activity-log.md) в клиентах клиентов
- Создание оповещений в клиентах клиентов, которые инициируют автоматизацию, например модули Runbook службы автоматизации Azure или функции Azure, в управляющем клиенте через веб-перехватчики
- Создание [параметров диагностики](../..//azure-monitor/platform/diagnostic-settings.md) в клиентах клиентов для отправки журналов ресурсов в рабочие области в управляющем клиенте
- Для рабочих нагрузок SAP [Отслеживайте метрики решений SAP с помощью агрегированного представления по клиентам](https://techcommunity.microsoft.com/t5/running-sap-applications-on-the/using-azure-lighthouse-and-azure-monitor-for-sap-solutions-to/ba-p/1537293) .

[Сеть Azure](../../networking/networking-overview.md).

- Развертывание и управление [виртуальной сетью Azure](../../virtual-network/index.yml) и картами виртуальных сетевых интерфейсов (vNIC) в управляемых клиентах
- Развертывание и настройка [Брандмауэра Azure](../../firewall/overview.md) для защиты ресурсов виртуальной сети клиентов.
- Управление службами подключения, такими как [Виртуальные глобальные сети](../../virtual-wan/virtual-wan-about.md), [ExpressRoute](../../expressroute/expressroute-introduction.md)и [VPN-шлюзы](../../vpn-gateway/vpn-gateway-about-vpngateways.md) .
- Использование Azure Lighthouse для поддержки ключевых сценариев для [программы MSP для Сети Azure](../../networking/networking-partners-msp.md).

[Политика Azure](../../governance/policy/index.yml).

- Создание и изменение определений политик в делегированных подписках
- Назначение определяемых пользователем определений политик в делегированных подписках
- Клиенты видят политики, созданные поставщиком услуг, наряду с политиками, которые они создали сами.
- Может [исправлять deployIfNotExists или изменять назначения в управляемом клиенте](../how-to/deploy-policy-remediation.md)

[Azure Resource Graph](../../governance/resource-graph/index.yml).

- Теперь включает идентификатор клиента в возвращенных результатах запроса, позволяя определить, принадлежит ли подписка к управляемому клиенту.

[Центр безопасности Azure](../../security-center/index.yml).

- Видимость различных клиентов
  - Мониторинг соответствия политикам безопасности и обеспечение безопасности всех ресурсов клиентов.
  - Непрерывное отслеживание соответствия нормативным требованиям между несколькими клиентами в одном представлении
  - Мониторинг, рассмотрение и определение приоритетных практических рекомендаций по безопасности с вычислением оценки безопасности.
- Управление состоянием безопасности для различных клиентов.
  - Управление политиками безопасности.
  - Выполнение действий с ресурсами, которые не соответствуют практическим рекомендациям по безопасности.
  - Сбор и хранение данных, связанных с безопасностью.
- Обнаружение угроз для различных клиентов и защита от них.
  - Обнаружение угроз в ресурсах клиентов.
  - Применение дополнительных элементов управления защитой от угроз, таких как JIT-доступ к виртуальной машине.
  - Повышение уровня защиты конфигурации группы безопасности сети с помощью адаптивной защиты сети.
  - Обеспечение работы только тех приложений и процессов на серверах, которые должны использоваться с адаптивными элементами управления приложениями.
  - Мониторинг изменений важных файлов и записей реестра с помощью мониторинга целостности файлов (FIM).
- Обратите внимание, что вся подписка должна быть делегирована управляющему клиенту. Сценарии центра безопасности Azure не поддерживаются с делегированными группами ресурсов.

[Azure Sentinel](../../sentinel/multiple-tenants-service-providers.md).

- Управление ресурсами Azure Sentinel в [арендаторах клиента](../../sentinel/multiple-tenants-service-providers.md).
- [Мониторинг атак и Просмотр оповещений безопасности в нескольких клиентах](https://techcommunity.microsoft.com/t5/azure-sentinel/using-azure-lighthouse-and-azure-sentinel-to-monitor-across/ba-p/1043899)
- [Просмотр инцидентов](../../sentinel/multiple-workspace-view.md) в нескольких рабочих областях Azure Sentinel, распределенных по клиентам

[Работоспособность служб Azure](../../service-health/index.yml).

- Мониторинг работоспособности ресурсов клиента с помощью службы "Работоспособность ресурсов Azure".
- Отслеживание работоспособности служб Azure, которые используют клиенты.

[Azure Site Recovery.](../../site-recovery/index.yml)

- Управление параметрами аварийного восстановления для виртуальных машин Azure в клиентах клиентов (Обратите внимание, что нельзя использовать `RunAs` учетные записи для копирования РАСШИРЕНИЙ ВМ).

[Виртуальные машины Azure](../../virtual-machines/index.yml).

- Использование расширений виртуальной машины для создания задач по настройке и автоматизации после развертывания на виртуальных машинах Azure
- Использование диагностики загрузки для устранения неполадок виртуальных машин Azure
- Доступ к виртуальным машинам с помощью последовательной консоли
- Интегрируйте виртуальные машины с Azure Key Vault для паролей, секретов или криптографических ключей для шифрования дисков с помощью [управляемого удостоверения в политике](https://github.com/Azure/Azure-Lighthouse-samples/tree/master/templates/create-keyvault-secret), гарантируя, что секреты хранятся в Key Vault в управляемых клиентах.
- Обратите внимание, что вы не можете использовать Azure Active Directory для удаленного входа на виртуальные машины.

Запросы в службу поддержки.

- [Откройте запросы в службу поддержки из **раздела Справка и поддержка**](../../azure-portal/supportability/how-to-create-azure-support-request.md#getting-started) в портал Azure для делегированных ресурсов (выбор плана поддержки, доступного для делегированной области).
- Использование [API квоты Azure](/rest/api/reserved-vm-instances/quotaapi) для просмотра квот службы Azure для делегированных ресурсов клиента и управления ими.

## <a name="current-limitations"></a>Текущие ограничения

Во всех сценариях необходимо учитывать следующие текущие ограничения.

- Запросы, обрабатываемые Azure Resource Manager, можно выполнять с помощью Azure Лигхсаусе. URI операций для этих запросов начинаются с `https://management.azure.com`. Однако запросы, обрабатываемые экземпляром типа ресурса (например, Key Vault секреты доступа или доступа к данным хранилища), не поддерживаются в Azure Лигхсаусе. URI операций для этих запросов обычно начинаются с адреса, уникального для вашего экземпляра, например `https://myaccount.blob.core.windows.net` или `https://mykeyvault.vault.azure.net/`. Последние также обычно являются операциями с данными, а не операциями управления.
- Назначения ролей должны использовать [встроенные роли Azure](../../role-based-access-control/built-in-roles.md). В настоящее время все встроенные роли поддерживаются с помощью делегированных управления ресурсами Azure, за исключением владельца или любых встроенных ролей с [`DataActions`](../../role-based-access-control/role-definitions.md#dataactions) разрешениями. Роль "Администратор доступа пользователей" поддерживается только для [назначения ролей управляемым удостоверениям](../how-to/deploy-policy-remediation.md#create-a-user-who-can-assign-roles-to-a-managed-identity-in-the-customer-tenant).  Пользовательские роли и [роли классического администратора подписки](../../role-based-access-control/classic-administrators.md) не поддерживаются.
- Хотя вы можете подключить подписки, использующие Azure Databricks, в настоящее время пользователи в управляющем арендаторе не смогут запускать рабочие области Azure Databricks в делегированной подписке.
- Хотя вы можете подключить подписки и группы ресурсов, имеющие блокировки ресурсов, эти блокировки не будут препятствовать выполнению действий пользователями в управляющем клиенте. [Запрет назначений](../../role-based-access-control/deny-assignments.md), защищающий управляемые системой ресурсы, такие как созданные управляемыми приложениями Azure или Azure Blueprints (назначенные системой запреты назначений), не позволяет пользователям в управляющем арендаторе работать с этими ресурсами. Однако в настоящее время пользователи в арендаторе клиента не могут создавать собственные запреты назначений (назначаемые пользователем запреты назначений).
- Делегирование подписок в [национальной облаке](../../active-directory/develop/authentication-national-cloud.md) и общедоступном облаке Azure или в двух отдельных национальных облаках не поддерживается.

## <a name="next-steps"></a>Дальнейшие действия

- Подключение клиентов к Azure Лигхсаусе с [помощью шаблонов Azure Resource Manager](../how-to/onboard-customer.md) или [публикации частных или общедоступных управляемых служб в Azure Marketplace](../how-to/publish-managed-services-offers.md).
- [Просматривайте клиентов и управляйте ими](../how-to/view-manage-customers.md), перейдя в раздел **Мои клиенты** на портале Azure.
