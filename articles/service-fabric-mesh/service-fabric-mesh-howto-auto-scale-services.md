---
title: Автоматическое масштабирование приложения, работающего в сети Azure Service Fabric
description: Сведения о настройке политики автомасштабирования для служб приложения Сетки Service Fabric.
author: georgewallace
ms.topic: conceptual
ms.date: 12/07/2018
ms.author: gwallace
ms.custom: mvc, devcenter
ms.openlocfilehash: a707e3601bb24b2d5c2aa9402edff4a2e8803033
ms.sourcegitcommit: 867cb1b7a1f3a1f0b427282c648d411d0ca4f81f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "99625910"
---
# <a name="create-autoscale-policies-for-a-service-fabric-mesh-application"></a>Создание политик автомасштабирования для приложения Сетки Service Fabric

> [!IMPORTANT]
> Поддержка предварительной версии Сетки Azure Service Fabric была прекращена. Новые развертывания больше не будут разрешены через API Сетки Service Fabric. Поддержка существующих развертываний будет продолжена до 28 апреля 2021 г. включительно.
> 
> Дополнительные сведения см. в статье [Прекращение поддержки предварительной версии Сетки Azure Service Fabric](https://azure.microsoft.com/updates/azure-service-fabric-mesh-preview-retirement/).

Одним из основных преимуществ развертывания приложений в Сетке Service Fabric является возможность легко масштабировать службы. Это можно использовать для обработки изменяющихся объемов нагрузки в службах или для повышения уровня доступности. Вы можете вручную выполнять масштабирование своих служб или же настроить автомасштабирование.

[Автомасштабирование](service-fabric-mesh-scalability.md#autoscaling-service-instances) позволяет динамически масштабировать количество экземпляров службы (горизонтальное масштабирование). Автомасштабирование обеспечивает большую эластичность и позволяет подготовить к работе или удалить экземпляры служб на основе данных об использовании ЦП или памяти.

## <a name="options-for-creating-an-auto-scaling-policy-trigger-and-mechanism"></a>Варианты создания политики, триггера и механизма автомасштабирования
Политика автомасштабирования определяется для каждой службы, которую необходимо масштабировать. Это происходит либо в файле ресурсов службы YAML, либо в шаблоне развертывания JSON. Каждая политика масштабирования состоит из двух частей: триггера и механизма масштабирования.

Триггер определяет, когда необходимо вызывать политику автомасштабирования.  Укажите тип триггера (среднее время загрузки) и метрику для мониторинга (ЦП или память).  Верхнее и нижнее пороговое значение загрузки указаны в процентах. Интервал масштабирования определяет, как часто (в секундах) проверяется указанная метрика использования (например, среднее время загрузки ЦП) во всех развернутых в настоящий момент экземплярах службы.  Механизм запускается, когда отслеживаемая метрика опускается ниже нижнего порогового значения или превышает верхнее пороговое значение.  

Механизм масштабирования определяет, как выполнять операцию масштабирования при активации политики.  Укажите тип механизма (добавление или удаление реплики), минимальное и максимальное количество реплик (в виде целых чисел).  Масштабирование никогда не будет выполняться для реплик службы, количество которых ниже минимального или выше максимального значения.  Кроме того, укажите шаг приращения масштаба в виде целого числа, представляющее собой количество реплик, которые будут добавлены или удалены в ходе выполнения операции масштабирования.  

## <a name="define-an-auto-scaling-policy-in-a-json-template"></a>Определение политики автомасштабирования в шаблоне JSON

В следующем примере показана политика автомасштабирования в шаблоне развертывания JSON.  Политика автомасштабирования объявляется в свойстве службы для масштабирования.  В этом примере определяется триггер среднего времени загрузки ЦП.  Механизм сработает, если значение среднего времени загрузки ЦП всех развернутых экземпляров опустится ниже 0,2 (20 %) или превысит 0,8 (80 %).  Загрузка ЦП проверяется каждые 60 секунд.  Механизм масштабирования определяется для добавления или удаления экземпляров при активации политики.  Экземпляры службы будут добавлены или удалены с шагом в один экземпляр.  Минимальное количество экземпляров, равное одному, и максимальное количество, равное 40, также определены.

```json
{
"apiVersion": "2018-09-01-preview",
"name": "WorkerApp",
"type": "Microsoft.ServiceFabricMesh/applications",
"location": "[parameters('location')]",
"dependsOn": [
"Microsoft.ServiceFabricMesh/networks/worker-app-network"
],
"properties": {
"services": [   
    { ... },       
    {
    "name": "WorkerService",
    "properties": {
        "description": "Worker Service",
        "osType": "linux",
        "codePackages": [
        {  ...              }
        ],
        "replicaCount": 1,
        "autoScalingPolicies": [
        {
            "name": "AutoScaleWorkerRule",
            "trigger": {
                "kind": "AverageLoad",
                "metric": {
                    "kind": "Resource",
                    "name": "cpu"
                },
                "lowerLoadThreshold": "0.2",
                "upperLoadThreshold": "0.8",
                "scaleIntervalInSeconds": "60"
            },
            "mechanism": {
                "kind": "AddRemoveReplica",
                "minCount": "1",
                "maxCount": "40",
                "scaleIncrement": "1"
            }
        }
        ],        
        ...
    }
    }
]
}
}
```

## <a name="define-an-autoscale-policy-in-a-serviceyaml-resource-file"></a>Определение политики автомасштабирования в файле ресурсов service.yaml
В следующем примере показана политика автомасштабирования в файле ресурса службы (YAML).  Политика автомасштабирования объявляется как свойство службы, которую необходимо масштабировать.  В этом примере определяется триггер среднего времени загрузки ЦП.  Механизм сработает, если значение среднего времени загрузки ЦП всех развернутых экземпляров опустится ниже 0,2 (20 %) или превысит 0,8 (80 %).  Загрузка ЦП проверяется каждые 60 секунд.  Механизм масштабирования определяется для добавления или удаления экземпляров при активации политики.  Экземпляры службы будут добавлены или удалены с шагом в один экземпляр.  Минимальное количество экземпляров, равное одному, и максимальное количество, равное 40, также определены.

```yaml
## Service definition ##
application:
  schemaVersion: 1.0.0-preview2
  name: WorkerApp
  properties:
    services:
      - name: WorkerService
        properties:
          description: WorkerService description.
          osType: Linux
          codePackages:
            ...
          replicaCount: 1
          autoScalingPolicies:
            - name: AutoScaleWorkerRule
              trigger:
                kind: AverageLoad
                metric:
                  kind: Resource
                  name: cpu
                lowerLoadThreshold: 0.2
                upperLoadThreshold: 0.8
                scaleIntervalInSeconds: 60
              mechanism:
                kind: AddRemoveReplica
                minCount: 1
                maxCount: 40
                scaleIncrement: 1
          ...
```

## <a name="next-steps"></a>Дальнейшие действия
Подробнее о [ручном масштабировании службы](service-fabric-mesh-tutorial-template-scale-services.md)
