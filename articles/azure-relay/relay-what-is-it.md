---
title: Что такое Azure Relay? | Документы Майкрософт
description: В этой статье представлен обзор службы Azure Relay, позволяющей разрабатывать облачные приложения, использующие локальные службы, которые работают в корпоративной сети, без необходимости открывать подключения брандмауэра или вносить значительные изменения в инфраструктуру сети.
ms.topic: conceptual
ms.date: 06/23/2020
ms.openlocfilehash: fbf1b2134a4c2dce7a3e6a62668d0852dc08c18a
ms.sourcegitcommit: 19ffdad48bc4caca8f93c3b067d1cf29234fef47
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/06/2021
ms.locfileid: "97955388"
---
# <a name="what-is-azure-relay"></a>Что такое Azure Relay?
Служба Azure Relay позволяет безопасно предоставлять службы, выполняющиеся в корпоративной сети в общедоступном облаке. Для этого вам не нужно открывать порт брандмауэра или вносить значительные изменения в инфраструктуру корпоративной сети. 

Служба ретрансляции поддерживает следующие сценарии между локальными службами и приложениями, работающими в облаке или в другой локальной среде. 

- Традиционная односторонняя связь, связь на основе запроса и ответа и связь в одноранговых сетях. 
- Распространение событий по сети Интернет для поддержки сценариев публикации/подписки. 
- Двунаправленная и небуферизованная связь через границы сети

Служба Azure Relay отличается от технологий интеграции сетевого уровня (например, VPN). Эту службу можно использовать для одной конечной точки приложения на одном компьютере. Влияние технологии VPN гораздо сильнее, ведь она основана на изменении сетевой среды. 

## <a name="basic-flow"></a>Базовый поток действий
Ниже приведены основные шаги передачи данных путем ретрансляции по шаблону.

1. Локальная служба подключается к службе ретрансляции через исходящий порт. 
2. Эта служба создает сокет для двунаправленного обмена данными с привязкой к конкретному адресу. 
3. После этого клиент может обмениваться данными с локальной службой, отправляя трафик в службу ретрансляции, которая перенаправит его по нужному адресу. 
4. Затем служба ретрансляции *ретранслирует* данные в локальную службу через созданный двунаправленный сокет, выделенный клиенту. Клиенту не нужно настраивать прямое подключение к локальной службе. Ему не нужно знать расположение службы. При работе в локальной службе не нужно открывать в брандмауэре какие-либо входящие порты.


## <a name="features"></a>Компоненты 
Ретранслятор Azure предоставляет две функции:

- [Гибридные подключения](#hybrid-connections) — использует открытые стандартные веб-сокеты, позволяющие использовать сценарии с несколькими платформами.
- Ретрансляторы WCF — используется Windows Communication Foundation (WCF), чтобы обеспечить возможность удаленного вызова процедур (RPC). Ретранслятор WCF — это устаревшее предложение для ретрансляции, которое многие клиенты уже используют в своих моделях программирования WCF.

## <a name="hybrid-connections"></a>Гибридные подключения

Функция службы Azure Relay, называемая "Гибридные подключения", представляет собой безопасный открытый протокол возможностей ретрансляции, существовавших ранее. Его можно использовать на любой платформе и на любом языке. Функция Azure Relay "Гибридные подключения" основана на протоколах HTTP и WebSocket. Она позволяет отправлять запросы и получать ответы через веб-сокеты или по протоколу HTTP(S). Эта функция совместима с API WebSocket в распространенных веб-браузерах. 

Дополнительные сведения о протоколе гибридного подключения см. в [этой статье](relay-hybrid-connections-protocol.md). Функцию "Гибридные подключения" можно использовать в любой библиотеке веб-сокетов на любом языке и в любой среде выполнения.

> [!NOTE]
> Функция "Гибридные подключения" службы Azure Relay заменяет старую функцию гибридных подключений служб BizTalk. В службах BizTalk эта функция создана на основе Ретранслятора WCF служебной шины Azure. Возможности функции "Гибридные подключения" в службе Azure Relay дополняют функции имеющегося Ретранслятора WCF. Обе возможности этих двух служб (Ретранслятор WCF и функция "Гибридные подключения") параллельно доступны в службе Azure Relay. Они совместно используют общий шлюз, но реализуются по-разному.

## <a name="wcf-relay"></a>Ретранслятор WCF
Ретрансляторы WCF подходят для полной платформы .NET Framework и WCF. Подключение между локальной службой и службой ретранслятора создается с помощью набора привязок WCF для ретранслятора. Привязки для ретрансляции сопоставляются с новыми элементами привязки транспорта, предназначенными для создания компонентов канала WCF, которые интегрируются со служебной шиной в облаке. Дополнительные сведения см. в статье [Как использовать ретрансляторы WCF на основе ретранслятора Azure с помощью .NET](service-bus-relay-tutorial.md).

## <a name="hybrid-connections-vs-wcf-relay"></a>гибридные подключения и Ретранслятор WCF
Функция "Гибридные подключения" и Ретранслятор WCF обеспечивают безопасное подключение к ресурсам, имеющимся в корпоративной сети. При выборе одной из этих технологий необходимо учитывать следующие потребности:

|  | Ретранслятор WCF | Гибридные подключения |
| --- |:---:|:---:|
| **WCF** |x | |
| **.NET Core** | |x |
| **.NET Framework** |x |x |
| **JavaScript/Node.js** | |x |
| **Открытый протокол на основе стандартов** | |x |
| **Модели программирования RPC** | |x |

## <a name="architecture-processing-of-incoming-relay-requests"></a>Архитектура: обработка входящих запросов на ретрансляцию
На следующей схеме показано, как входящие запросы ретрансляции обрабатываются в службе Azure Relay:

![Обработка входящих запросов ретранслятора WCF](./media/relay-what-is-it/ic690645.png)

1. Прослушивающий клиент отправляет запрос на прослушивание в службу Azure Relay. Подсистема балансировки нагрузки Azure направляет запрос на один из узлов шлюза. 
2. Служба Azure Relay создает ретрансляцию в хранилище шлюза. 
3. Отправляющий клиент отправляет запрос на подключение к службе прослушивания. 
4. Шлюз, получающий запрос, ищет ретрансляцию в хранилище шлюза. 
5. Шлюз перенаправляет запрос подключения на необходимый шлюз, упомянутый в хранилище шлюза. 
6. Этот шлюз отправляет запрос прослушивающему клиенту на создание временного канала к узлу шлюза, наиболее близкого к отправляющему клиенту. 
7. Прослушивающий клиент создает временный канал к шлюзу, наиболее близкому к отправляющему клиенту. Теперь, когда между клиентами установлено подключение через шлюз, клиенты могут обмениваться сообщениями. 
8. Шлюз перенаправляет все сообщения от ожидающего клиента клиенту, отправляющему его. 
9. Шлюз перенаправляет все сообщения от отправляющего клиента к прослушивающему клиенту.  

## <a name="next-steps"></a>Дальнейшие действия
* [Начало работы с WebSockets .NET](relay-hybrid-connections-dotnet-get-started.md)
* [Начало работы с HTTP-запросами .NET](relay-hybrid-connections-http-requests-dotnet-get-started.md)
* [Начало работы с соединениями WebSocket узлов](relay-hybrid-connections-node-get-started.md)
* [Начало работы с HTTP-запросами Node](relay-hybrid-connections-http-requests-node-get-started.md)
* [Вопросы и ответы по ретранслятору](relay-faq.md)

