---
title: Часто задаваемые вопросы о ретрансляторе Azure | Документация Майкрософт
description: В этой статье содержатся ответы на некоторые часто задаваемые вопросы о службе Azure Relay.
ms.topic: article
ms.date: 06/23/2020
ms.openlocfilehash: 77d3122942289654c0f651f9f648307123b23546
ms.sourcegitcommit: 431bf5709b433bb12ab1f2e591f1f61f6d87f66c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/12/2021
ms.locfileid: "98131854"
---
# <a name="azure-relay-faqs"></a>Часто задаваемые вопросы о ретрансляторе Azure

В этой статье содержатся ответы на некоторые часто задаваемые вопросы о [ретрансляторе Azure](https://azure.microsoft.com/services/service-bus/). Общие сведения о расценках и поддержке Azure см. на странице [часто задаваемых вопросов о поддержке Azure](https://azure.microsoft.com/support/faq/).


[!INCLUDE [updated-for-az](../../includes/updated-for-az.md)]

## <a name="general-questions"></a>Общие вопросы
### <a name="what-is-azure-relay"></a>Что такое Azure Relay?
[Служба ретранслятора Azure](relay-what-is-it.md) упрощает работу с гибридными приложениями, позволяя безопаснее предоставлять в общедоступном облаке службы, используемые в корпоративной сети предприятия. Вам не нужно открывать подключения брандмауэра или вносить значительные изменения в инфраструктуру корпоративной сети.

### <a name="what-is-a-relay-namespace"></a>Что такое пространство имен ретранслятора?
[Пространство имен](relay-create-namespace-portal.md) — это контейнер, который можно использовать для адресации ресурсов ретранслятора в вашем приложении. Чтобы использовать ретранслятор, необходимо создать пространство имен. Это один из первых шагов для начала работы.

### <a name="what-happened-to-service-bus-relay-service"></a>Что случилось со службой ретранслятора служебной шины?
Ранее Именованная служба ретранслятора служебной шины теперь называется [Azure Relay](service-bus-relay-tutorial.md). Вы можете использовать эту службу как обычно. Функция гибридных подключений представляет собой обновленную версию службы, перенесенной из служб BizTalk Azure. Ретранслятор WCF и гибридные подключения будут и дальше поддерживаться.

## <a name="pricing"></a>Цены
В этом разделе содержатся ответы на некоторые часто задаваемые вопросы о ценах на использование ретранслятора. Общие сведения о расценках Azure см. на странице [часто задаваемых вопросов о поддержке Azure](https://azure.microsoft.com/support/faq/). Дополнительные сведения о ценах на использование ретранслятора см. на странице [цен на служебную шину][Pricing overview].

### <a name="how-do-you-charge-for-hybrid-connections-and-wcf-relay"></a>Как выставляется цена за гибридные подключения и ретранслятор WCF?
Подробные сведения см. в таблице [гибридных подключений и ретрансляторов WCF][Pricing overview] на странице с ценами на служебную шину. Помимо платы, указанной на этой странице, также взимается плата за связанные операции передачи данных, исходящих из центра данных, в котором подготавливается ваше приложение.

### <a name="how-am-i-billed-for-hybrid-connections"></a>Как рассчитывается стоимость использования гибридных подключений?
Ниже приведены три примера сценария выставления счетов за гибридные подключения.

*   Сценарий 1.
    *   У вас есть один прослушиватель, например диспетчер гибридных подключений, который постоянно работает в течение месяца.
    *   В течение месяца вы передаете через это подключение 3 ГБ данных. 
    *   В этом случае общая стоимость составит 5 долл. США.
*   Сценарий 2.
    *   У вас есть один прослушиватель, например диспетчер гибридных подключений, который постоянно работает в течение месяца.
    *   В течение месяца вы передаете через это подключение 10 ГБ данных.
    *   В этом случае общая стоимость составит 7,50 долл. США. Это 5 долл. США за подключение и первые 5 ГБ + 2,50 долл. США за дополнительные 5 ГБ данных.
*   Сценарий 3.
    *   У вас есть два экземпляра диспетчера гибридных подключений, А и Б, которые постоянно работают в течение месяца.
    *   В течение месяца вы передаете через подключение А 3 ГБ данных,
    *   а через подключение Б — 6 ГБ данных.
    *   В этом случае общая стоимость составит 10,50 долл. США. Это 5 долл. США за подключение А + 5 долл. США за подключение Б + 0,50 долл. США (за шестой гигабайт через подключение Б).


### <a name="how-are-hours-calculated-for-relay"></a>Как вычисляются часы ретрансляции?

Ретранслятор WCF доступен только в пространствах имен уровня "Стандартный". В остальном расценки и [квоты подключения](../service-bus-messaging/service-bus-quotas.md) для ретрансляторов остались неизменными. Это означает, что тарификация для них будет по-прежнему выполняться на основе количества сообщений (а не операций) и часов ретрансляции. Дополнительные сведения см. в таблице ["гибридные подключения и ретрансляторы WCF"](https://azure.microsoft.com/pricing/details/service-bus/) на странице сведений о ценах.

### <a name="what-if-i-have-more-than-one-listener-connected-to-a-specific-relay"></a>Что делать, если к конкретному ретранслятору подключено несколько прослушивателей?
В некоторых случаях к одному ретранслятору могут подключаться несколько прослушивателей. Ретранслятор считается открытым, если к нему подключен хотя бы один прослушиватель. Добавление прослушивателей к открытому ретранслятору приведет к появлению дополнительных часов ретрансляции. Количество отправителей ретрансляции (клиентов, вызывающих или отправляющих сообщения ретрансляторам), подключенных к ретранслятору, не влияет на подсчет часов ретрансляции.

### <a name="how-is-the-messages-meter-calculated-for-wcf-relays"></a>Как вычисляется количество сообщений ретрансляторам WCF?
(**Это относится только к ретрансляторам WCF. Сообщения не являются затратами на гибридные подключения.**)

В целом количество оплачиваемых сообщений для ретрансляторов вычисляется так же, как и для сущностей, использующих брокер (очередей, разделов и подписок), как описано ранее. Тем не менее существует несколько важных отличий.

Отправка сообщения в Azure Relay обрабатывается как «полное через» для отправки прослушивателю ретрансляции, который получает сообщение. Он не обрабатывается как операция отправки в Azure Relay, за которым следует доставка прослушивателю ретрансляции. При вызове службы типа "запрос — ответ" (размером до 64 КБ) на уровне прослушивателя ретрансляции будут зафиксированы следующие сообщения: одно оплачиваемое сообщение для запроса и одно оплачиваемое сообщение для ответа (при условии, что размер ответа также не превышает 64 КБ). Это отличается от механизма использования очереди в качестве посредника между клиентом и службой. При использовании очереди в качестве посредника между клиентом и службой в рамках одного и того же алгоритма "запрос — ответ" предусмотрена отправка запроса в очередь с последующим изъятием из очереди и доставкой в службы, отправкой ответа в другую очередь, а также изъятием из очереди и доставкой клиенту. Если размер вызова не превышает 64 КБ, использование схемы с посредником в виде очереди приводит к выставлению счета за 4 оплачиваемых сообщения. При этом плата за количество сообщений в два раза выше, чем при реализации аналогичной схемы с использованием ретранслятора. Конечно, использование такой схемы связано с определенными преимуществами, включая надежность и выравнивание нагрузки. Эти преимущества могут оправдать дополнительные расходы.

Ретрансляторы, открытые с помощью привязки WCF **netTCPRelay**, обрабатывают сообщения не по отдельности, а как поток данных, передаваемых через систему. Сведения о формировании отдельных сообщений, отправленных и полученных с помощью этой привязки, доступны только отправителю и прослушивателю. Для ретрансляторов, использующих привязку **netTCPRelay** , все данные обрабатываются как поток для вычисления оплачиваемых сообщений. В этом случае служебная шина вычисляет общий объем данных, отправленных или полученных в ходе отдельной ретрансляции с 5-минутными интервалами. Затем общий объем данных будет поделен на блоки по 64 КБ, чтобы определить количество оплачиваемых сообщений ретранслятору, обработанных за заданный период времени.

## <a name="quotas"></a>Квоты
| Имя квоты | Область |  Примечания | Значение |
| --- | --- | --- | --- |
| Параллельные прослушиватели ретранслятора |Сущность |Запросы на дополнительные соединения отклоняются, а вызывающий код получает исключение. |25 |
| Параллельные подключения ретрансляции для всех конечных точек ретрансляции в пространстве имен службы |Пространство имен |- |5 000 |
| Конечные точки ретрансляции на одно пространство имен службы |Пространство имен |- |10 000 |
| Размер сообщения для ретрансляций [NetOnewayRelayBinding](/dotnet/api/microsoft.servicebus.netonewayrelaybinding) и [NetEventRelayBinding](/dotnet/api/microsoft.servicebus.neteventrelaybinding) |Пространство имен |Входящие сообщения, размер которых превышает эти значения, отклоняются, а в вызывающем коде возникает исключение. |64 КБ |
| Размер сообщения для ретрансляций [HttpRelayTransportBindingElement](/dotnet/api/microsoft.servicebus.httprelaytransportbindingelement) и [NetTcpRelayBinding](/dotnet/api/microsoft.servicebus.nettcprelaybinding) |Пространство имен |Нет ограничений на размер сообщения. |Неограниченно |

### <a name="does-relay-have-any-usage-quotas"></a>Есть ли у ретранслятора квоты использования?
По умолчанию для любой облачной службы Майкрософт устанавливается квота совокупного месячного использования в рамках всех подписок клиента. Мы понимаем, что в некоторых случаях вам может потребоваться больше, чем разрешено этими ограничениями. Вы можете в любой момент обратиться в службу поддержки клиентов и договориться об изменении квот в соответствии с вашими потребностями. Для служебной шины установлены следующие квоты общего использования:

* 5 миллиардов сообщений;
* 2 миллиона часов ретрансляции.

Мы оставляем за собой право отключить учетную запись в случае превышения месячных квот использования. Но перед выполнением каких-либо действий мы отправляем уведомления по электронной почте, а также предпринимаем несколько попыток связаться с клиентом. Клиентам, превысившим свои квоты, будут выставлены соответствующие счета.

### <a name="naming-restrictions"></a>Ограничения для имен
Имя пространства имен ретранслятора должно содержать от 6 до 50 знаков.

## <a name="subscription-and-namespace-management"></a>Управление подпиской и пространством имен
### <a name="how-do-i-migrate-a-namespace-to-another-azure-subscription"></a>Как перенести пространство имен в другую подписку Azure?

Чтобы переместить пространство имен из одной подписки Azure в другую, можно воспользоваться [порталом Azure](https://portal.azure.com) или выполнить команды PowerShell. При перемещении пространство имен должно быть активно. Пользователь, выполняющий команды, должен обладать правами администратора как в исходной, так и в целевой подписках.

#### <a name="azure-portal"></a>Портал Azure

Сведения об использовании портала Azure для переноса пространства имен ретранслятора Azure из одной подписки в другую см. в разделе [С помощью портала](../azure-resource-manager/management/move-resource-group-and-subscription.md#use-the-portal). 

#### <a name="powershell"></a>PowerShell

Чтобы переместить пространство имен из одной подписки Azure в другую с помощью PowerShell, выполните указанную ниже последовательность команд. Для выполнения этой операции пространство имен уже должно быть активным, а пользователь, выполняющий команды PowerShell, должен обладать правами администратора в исходной и целевой подписках.

```azurepowershell-interactive
# Create a new resource group in the target subscription.
Select-AzSubscription -SubscriptionId 'ffffffff-ffff-ffff-ffff-ffffffffffff'
New-AzResourceGroup -Name 'targetRG' -Location 'East US'

# Move the namespace from the source subscription to the target subscription.
Select-AzSubscription -SubscriptionId 'aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa'
$res = Find-AzResource -ResourceNameContains mynamespace -ResourceType 'Microsoft.ServiceBus/namespaces'
Move-AzResource -DestinationResourceGroupName 'targetRG' -DestinationSubscriptionId 'ffffffff-ffff-ffff-ffff-ffffffffffff' -ResourceId $res.ResourceId
```

## <a name="troubleshooting"></a>Устранение неполадок
### <a name="what-are-some-of-the-exceptions-generated-by-azure-relay-apis-and-suggested-actions-you-can-take"></a>Какие исключения создаются API ретранслятора Azure? Какие действия можно предпринять?
Описание распространенных исключений и сведения о действиях, которые можно предпринять, см. в статье [Исключения ретранслятора][Relay exceptions].

### <a name="what-is-a-shared-access-signature-and-which-languages-can-i-use-to-generate-a-signature"></a>Что такое подписанный URL-адрес? На каких языках можно создавать подписи?
Подписанные URL-адреса (SAS) представляют собой механизм аутентификации на базе алгоритма безопасного хэширования SHA-256 или URI. Сведения о создании собственных подписей в Node.js, PHP, Python, Java, C и C# см. в статье [Проверка подлинности служебной шины с помощью подписанных][Shared Access Signatures]URL.

### <a name="is-it-possible-to-allow-only-some-relay-endpoints"></a>Можно ли разрешить только некоторые конечные точки ретранслятора?
Да. Клиент ретрансляции устанавливает подключения к службе ретрансляции Azure, используя полные доменные имена. Клиенты могут добавить запись для `*.servicebus.windows.net` на брандмауэрах, поддерживающих список одобрения DNS.

## <a name="next-steps"></a>Дальнейшие действия
* [Создание пространства имен](relay-create-namespace-portal.md)
* [Начало работы с .NET](relay-hybrid-connections-dotnet-get-started.md)
* [Приступая к работе с Node](relay-hybrid-connections-node-get-started.md)

[Pricing overview]: https://azure.microsoft.com/pricing/details/service-bus/
[Relay exceptions]: relay-exceptions.md
[Shared Access Signatures]: ../service-bus-messaging/service-bus-sas.md
