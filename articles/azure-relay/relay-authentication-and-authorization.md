---
title: Проверка подлинности и авторизация в ретрансляторе Azure | Документация Майкрософт
description: В этой статье представлен обзор проверки подлинности подписанного URL-адресом (SAS) в службе Azure Relay.
ms.topic: article
ms.date: 06/23/2020
ms.openlocfilehash: 4b0a5c7a092155a006419eedd170a63abed42bb3
ms.sourcegitcommit: 772eb9c6684dd4864e0ba507945a83e48b8c16f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "87033383"
---
# <a name="azure-relay-authentication-and-authorization"></a>Проверка подлинности и авторизация в ретрансляторе Azure

Приложения могут проходить проверку подлинности в ретрансляторе Azure с помощью подписанного URL-адреса (SAS). Аутентификация с помощью SAS позволяет проверить подлинность приложений в службе ретранслятора Azure с помощью ключа доступа, настроенного в пространстве имен ретранслятора. Затем этот ключ можно использовать для создания маркера подписанного URL-адреса, который клиенты могут использовать при проверке подлинности в службе ретранслятора.

## <a name="shared-access-signature-authentication"></a>Проверка подлинности с помощью подписанного URL-адреса

[Проверка подлинности с помощью SAS](../service-bus-messaging/service-bus-sas.md) позволяет предоставлять пользователю доступ к ресурсам ретранслятора Azure с определенными правами. Проверка подлинности SAS предусматривает настройку соответствующих прав на ресурс для криптографического ключа. Затем клиенты могут получить доступ к этому ресурсу. Для этого им нужно предоставить маркер SAS, который состоит из универсального кода ресурса (URI) данного ресурса, а также указать срок действия, подписанный с использованием настроенного ключа.

Ключи для SAS можно настроить в пространстве имен ретранслятора. В отличие от обмена сообщениями в служебной шине, при [гибридных подключениях в ретрансляторе](relay-hybrid-connections-protocol.md) поддерживаются неавторизованные и анонимные отправители. Вы можете включить анонимный доступ для сущности при ее создании, как показано на следующем снимке экрана с портала:

![В диалоговом окне "создание гибридного подключения" имеется текстовое поле "имя", а флажок "требуется проверка подлинности клиента" установлен.][0]

Чтобы использовать SAS, в пространстве имен ретранслятора можно настроить объект [SharedAccessAuthorizationRule](/dotnet/api/microsoft.servicebus.messaging.sharedaccessauthorizationrule), который состоит из следующих элементов:

* *KeyName*, который определяет правило.
* *PrimaryKey* — это криптографический ключ, используемый для подписи и проверки токенов SAS.
* *SecondaryKey* — это криптографический ключ, используемый для подписи и проверки токенов SAS.
* *Rights* представляют коллекцию предоставленных прав на прослушивание, отправку или управление.

Правила авторизации, настроенные на уровне пространства имен, могут предоставлять доступ ко всем подключениям ретранслятора в пространстве имен для клиентов с маркерами, подписанными с использованием соответствующего ключа. В пространстве имен ретранслятора можно настроить до 12 таких правил авторизации. По умолчанию правило [SharedAccessAuthorizationRule](/dotnet/api/microsoft.servicebus.messaging.sharedaccessauthorizationrule) со всеми правами настраивается для каждого пространства имен в ходе первоначальной подготовки.

Чтобы получить доступ к сущности, клиенту требуется маркер SAS, созданный с помощью определенного правила [SharedAccessAuthorizationRule](/dotnet/api/microsoft.servicebus.messaging.sharedaccessauthorizationrule). Маркер SAS создается с помощью хэш-функции HMAC-SHA256 строки ресурса, состоящей из URI ресурса, к которому запрашивается доступ, и срока действия с криптографическим ключом, связанным с правилом авторизации.

Поддержка проверки подлинности SAS для ретранслятора Azure включена в пакет Azure SDK для .NET 2.0 и более поздних версий. SAS включает в себя поддержку правила [SharedAccessAuthorizationRule](/dotnet/api/microsoft.servicebus.messaging.sharedaccessauthorizationrule). Все интерфейсы API, которые принимают строку подключения в качестве параметра, поддерживают строки подключения SAS.

## <a name="next-steps"></a>Дальнейшие действия

- Дополнительные сведения о SAS см. в статье [Аутентификация служебной шины с помощью подписанных URL-адресов](../service-bus-messaging/service-bus-sas.md).
- Подробные сведения о функции гибридных подключений см. в руководстве [Протокол гибридных подключений ретранслятора Azure](relay-hybrid-connections-protocol.md).
- Соответствующую информацию о проверке подлинности и авторизации с помощью обмена сообщениями в служебной шине см. в [этой статье](../service-bus-messaging/service-bus-authentication-and-authorization.md). 

[0]: ./media/relay-authentication-and-authorization/hcanon.png