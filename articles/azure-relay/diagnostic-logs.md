---
title: Журналы диагностики для гибридные подключения
description: В этой статье содержится обзор всех журналов активности и диагностики, доступных для Azure Relay.
ms.topic: how-to
ms.date: 06/23/2020
ms.openlocfilehash: 9b459750ad1445da89a8e89a10a35b878bfb64e1
ms.sourcegitcommit: e559daa1f7115d703bfa1b87da1cf267bf6ae9e8
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/17/2021
ms.locfileid: "100590869"
---
# <a name="enable-diagnostics-logs-for-azure-relay-hybrid-connections"></a>Включение журналов диагностики для Azure Relay гибридные подключения
Когда вы начинаете использовать Azure Relay гибридные подключения, вам может потребоваться отслеживать, как и когда прослушиватели и отправители открываются и закрываются, а также как создаются гибридные подключения и отправляются сообщения. В этой статье представлен обзор журналов активности и диагностики, предоставляемых службой Azure Relay. 

Для Azure Relay можно просмотреть журналы двух типов:

- [Журналы действий](../azure-monitor/essentials/platform-logs-overview.md). Эти журналы содержат сведения об операциях, выполняемых с пространством имен в портал Azure или с помощью шаблона Azure Resource Manager. Эти журналы всегда включены. Например: "Создание или обновление пространства имен", "Создание или обновление гибридного подключения". 
- [Журналы диагностики](../azure-monitor/essentials/platform-logs-overview.md). Вы можете настроить журналы диагностики для более подробного представления о всех возможностях и действиях, выполняемых в пространстве имен, с помощью API или пакета SDK для языка.

## <a name="view-activity-logs"></a>Просмотр журналов действий
Чтобы просмотреть журналы действий для пространства имен Azure Relay, перейдите на страницу **Журнал действий** в портал Azure.

![Журнал действий Azure Relay](./media/diagnostic-logs/activity-log.png)

## <a name="enable-diagnostic-logs"></a>Включение журналов диагностики

> [!NOTE]
> Журналы диагностики доступны только для гибридные подключения, а не для ретранслятора Windows Communication Foundation (WCF).

Чтобы включить журналы диагностики, выполните следующие действия.

1. В [портал Azure](https://portal.azure.com)перейдите к пространству имен Azure Relay, а затем в разделе **мониторинг** выберите  **параметры диагностики**.
1. На странице **параметры диагностики** выберите **Добавить параметр диагностики**.  

   ![Ссылка "добавить параметр диагностики"](./media/diagnostic-logs/add-diagnostic-setting.png)

1. Настройте параметры диагностики, выполнив следующие действия.
    1. В поле **имя** введите имя для параметров диагностики.  
    2. Выберите **хибридконнектионсевент** для типа журнала. 
    3. Выберите одно из следующих трех **назначений** для журналов диагностики:  
        1. Если вы выбрали **архивацию в учетную запись хранения**, настройте учетную запись хранения, в которой будут храниться журналы диагностики.  
        2. Если вы выбрали **поток в концентраторе событий**, настройте концентратор событий, в который необходимо выполнить потоковую передачу журналов диагностики.
        3. Если вы выбрали **отправить log Analytics**, укажите, какой экземпляр log Analytics будет отправляться диагностика.  

        ![Примеры параметров диагностики](./media/diagnostic-logs/sample-diagnostic-settings.png)
1. На панели инструментов нажмите **Сохранить**, чтобы сохранить параметры.

Новые параметры вступят в силу примерно через 10 минут. Журналы отображаются в настроенном целевом объекте архивации в области **журналы диагностики** . Дополнительные сведения о настройке параметров диагностики см. в [обзоре журналов системы диагностики Azure](../azure-monitor/essentials/platform-logs-overview.md).


## <a name="schema-for-hybrid-connections-events"></a>Схема событий гибридных подключений
Строки JSON журнала событий гибридных подключений включают элементы, перечисленные в следующей таблице.

| Имя | Описание |
| ------- | ------- |
| ResourceId | Идентификатор ресурса Azure Resource Manager |
| ActivityId | Внутренний идентификатор, используемый для идентификации указанной операции. Также может называться "TrackingId" |
| Конечная точка | Адрес ресурса ретранслятора |
| OperationName | Тип регистрируемой операции гибридные подключения |
| EventTimeString | Метка времени в формате UTC для записи журнала |
| Сообщение | Подробное сообщение о событии |
| Категория | Категория события. В настоящее время существует только `HybridConnectionsEvents` . 


## <a name="sample-hybrid-connections-event"></a>Пример события гибридных подключений
Ниже приведен пример события гибридных подключений в формате JSON. 

```json
{
    "resourceId": "/SUBSCRIPTIONS/0000000000-0000-0000-0000-0000000000000/RESOURCEGROUPS/MyResourceGroup/PROVIDERS/MICROSOFT.RELAY/NAMESPACES/MyRelayNamespace",
    "ActivityId": "7006a0db-27eb-445c-939b-ce86133014cc",
    "endpoint": "sb://myrelaynamespace.servicebus.windows.net/myhybridconnection/7006a0db-27eb-445c-939b-ce86133014cc_G5",
    "operationName": "Microsoft.Relay/HybridConnections/NewSenderRegistering",
    "EventTimeString": "2020-04-27T20:27:57.3842810Z",
    "message": "A new sender is registering.",
    "category": "HybridConnectionsEvent"
}
```

## <a name="events-and-operations-captured-in-diagnostic-logs"></a>События и операции, захваченные в журналах диагностики

| Операция | Описание | 
| --------- | ----------- | 
| AuthorizationFailed | Ошибка авторизации.|
| инвалидсастокен | Недопустимый маркер SAS. | 
| листенеракцептингконнектион | Прослушиватель принимает подключение. |
| листенеракцептингконнектионтимеаут | Время ожидания прослушивателя, принимающего подключение, истекло. |
| листенеракцептингхттпрекуестфаилед | Сбой HTTP-запроса, принимающего прослушиватель, в связи с исключением. |
| листенеракцептингрекуесттимеаут | Истекло время ожидания для запроса, принимающего прослушиватель. |  
| листенерклосингфромекспиредтокен | Прослушиватель закрывается из-за истечения срока действия маркера безопасности. | 
| листенеррежектедконнектион | Прослушиватель отклонил подключение. |
| листенерретурнингхттпреспонсе | Прослушиватель возвращает ответ HTTP. |  
| листенерретурнингхттпреспонсефаилед | Прослушиватель возвращает ответ HTTP с кодом ошибки. | 
 листенерсенсттпреспонсе | Служба ретрансляции получила HTTP-ответ от прослушивателя. | 
| листенерунрегистеред | Регистрация прослушивателя отменяется. | 
| листенерунреспонсиве | Прослушиватель не отвечает при возврате ответа. | 
| мессажесендингтолистенер | Сообщение отправляется прослушивателю. |
| мессажесенттолистенер | Сообщение отправляется прослушивателю. | 
| невлистенеррегистеред | Зарегистрирован новый прослушиватель. |
| невсендеррегистеринг | Идет регистрация нового отправителя. | 
| процессингрекуестфаилед | Не удалось обработать операцию гибридного подключения. | 
| сендерконнектионклосед | Соединение отправителя закрыто. |
| сендерлистенерконнектионестаблишед | Отправитель и прослушиватель установили соединение успешно. |
| сендерсенсттпрекуест | Отправитель отправил HTTP-запрос. | 


## <a name="next-steps"></a>Дальнейшие шаги

Дополнительные сведения о Azure Relay см. в следующих статьях:

* [Введение в Azure Relay](relay-what-is-it.md)
* [Приступая к работе с гибридными подключениями к ретранслятору](relay-hybrid-connections-dotnet-get-started.md)
