---
title: Azure Data Lake Storage 1-го поколения — Настройка производительности
description: Узнайте, как использовать всю доступную пропускную способность в Azure Data Lake Storage 1-го поколения важно, чтобы добиться максимальной производительности, одновременно выполняя столько операций чтения и записи, сколько возможно.
author: twooley
ms.service: data-lake-store
ms.topic: conceptual
ms.date: 06/30/2017
ms.author: twooley
ms.openlocfilehash: c7f16dd9ea450185893164e10928c7022d6ab5a6
ms.sourcegitcommit: a4533b9d3d4cd6bb6faf92dd91c2c3e1f98ab86a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/22/2020
ms.locfileid: "97724686"
---
# <a name="tune-azure-data-lake-storage-gen1-for-performance"></a>Настройка Azure Data Lake Storage 1-го поколения для повышения производительности

Data Lake Storage 1-го поколения поддерживает высокую пропускную способность для аналитики с интенсивным использованием операций ввода-вывода и перемещения данных. В Data Lake Storage 1-го поколения важно использовать всю доступную пропускную способность (объем данных, которые можно читать или записывать в секунду), чтобы обеспечить высокую производительность. Для этого нужно выполнить как можно больше операций чтения и записи параллельно.

![Производительность Data Lake Storage 1-го поколения](./media/data-lake-store-performance-tuning-guidance/throughput.png)

Data Lake Storage 1-го поколения можно масштабировать, чтобы предоставить необходимую пропускную способность для всех сценариев аналитики. По умолчанию учетная запись Data Lake Storage 1-го поколения автоматически предоставляет достаточную пропускную способность для выполнения различных сценариев использования. В случаях, когда клиенты достигают лимита по умолчанию, учетную запись Data Lake Storage 1-го поколения можно настроить для предоставления большей пропускной способности, связавшись с поддержкой Майкрософт.

## <a name="data-ingestion"></a>Прием данных

При приеме данных из исходной системы в Data Lake Storage 1-го поколения важно учитывать, что исходное оборудование, исходное сетевое оборудование и сетевое подключение к Data Lake Storage 1-го поколения могут быть узким местом.

![Схема, показывающая, что исходное оборудование, исходное сетевое оборудование и сетевое подключение к Data Lake Storage 1-го поколения могут быть узким местом.](./media/data-lake-store-performance-tuning-guidance/bottleneck.png)

Важно убедиться, что эти факторы не затрагивают перемещение данных.

### <a name="source-hardware"></a>Исходное оборудование

Независимо от того, используете ли вы локальные компьютеры или виртуальные машины в Azure, следует тщательно выбирать соответствующее оборудование. В качестве исходного дискового оборудования следует использовать SSD, а не жесткие диски, поэтому выбирайте дисковое оборудование с быстро работающими шпинделями. В качестве исходного сетевого оборудования используйте самые быстрые сетевые адаптеры. В Azure мы рекомендуем использовать виртуальные машины Azure D14 с соответствующим мощным дисковым и сетевым оборудованием.

### <a name="network-connectivity-to-data-lake-storage-gen1"></a>Сетевое подключение к Data Lake Storage 1-го поколения

Сетевое подключение между исходными данными и Data Lake Storage 1-го поколения иногда может быть узким местом. Если исходные данные находятся в локальной среде, рекомендуется использовать выделенный канал с [Azure ExpressRoute](https://azure.microsoft.com/services/expressroute/). Если исходные данные находятся в Azure, вы сможете обеспечить лучшую производительность, если разместить данные в том же регионе Azure, что и учетная запись Data Lake Storage 1-го поколения.

### <a name="configure-data-ingestion-tools-for-maximum-parallelization"></a>Настройка средств приема данных для обеспечения максимальной параллелизации

После того как решено устранить узкие места в оборудовании и сетевом подключении, можно приступать к настройке средств приема. В следующей таблице перечислены ключевые параметры нескольких популярных средств приема и предоставлены подробные статьи по настройке производительности для них. Дополнительные сведения о выборе подходящего средства для вашего сценария см. в [этой статье](./data-lake-store-data-scenarios.md).

| Инструмент          | Настройки | Дополнительные сведения                                                                 |
|--------------------|------------------------------------------------------|------------------------------|
| PowerShell       | PerFileThreadCount, ConcurrentFileCount | [Ссылка](./data-lake-store-get-started-powershell.md) |
| AdlCopy    | Единицы измерения Azure Data Lake Analytics | [Ссылка](./data-lake-store-copy-data-azure-storage-blob.md#performance-considerations-for-using-adlcopy)         |
| DistCp            | -m (mapper) | [Ссылка](./data-lake-store-copy-data-wasb-distcp.md#performance-considerations-while-using-distcp)                             |
| Фабрика данных Azure| parallelCopies | [Ссылка](../data-factory/copy-activity-performance.md)                          |
| Sqoop           | fs.azure.block.size, -m (mapper) | [Ссылка](/archive/blogs/shanyu/performance-tuning-for-hdinsight-storm-and-microsoft-azure-eventhubs)        |

## <a name="structure-your-data-set"></a>Структура набора данных

Если данные хранятся в Data Lake Storage 1-го поколения, размер файла, число файлов и структура папок влияют на производительность. В следующем разделе описаны рекомендации в этих областях.

### <a name="file-size"></a>Размер файла

Как правило, у модулей аналитики, таких как HDInsight и Azure Data Lake Analytics, нагрузка зависит от количества файлов. Если вы храните данные в большом количестве небольших файлов, это может отрицательно сказаться на производительности.

Упорядочивайте свои данные в файлы большого размера для лучшей производительности. Как правило, упорядочите наборы данных в файлах размером 256 МБ или больше. В некоторых случаях, например относительно изображений и двоичных данных, их параллельная обработка невозможна. В таких случаях рекомендуется размещать отдельные файлы в 2 ГБ.

Иногда конвейеры данных имеют ограниченный контроль над необработанными данными, которые содержат большое количество небольших файлов. Рекомендуется использовать процесс подготовки, который создает файлы большего размера для дочерних приложений.

### <a name="organize-time-series-data-in-folders"></a>Организация данных временных рядов в папках

Для рабочих нагрузок Hive и ADLA удаление секций данных временных рядов может помочь некоторым запросам считывать только подмножество данных, что повышает производительность.

Эти конвейеры, которые принимают данные временных рядов, часто размещают файлы с структурированным именем для файлов и папок. Ниже приведен типичный пример для данных, структурированных по дате: *\датасет\ииии\мм\дд\ datafile_YYYY_MM_DD. tsv*.

Обратите внимание, что данные времени и даты отображаются и как папки, и в имени файла.

Для даты и времени ниже приведен общий шаблон: *\датасет\ииии\мм\дд\хх\мм\ datafile_YYYY_MM_DD_HH_mm. tsv*.

Выбор, который вы делаете с помощью упорядочения папки и файлов, должен быть оптимизирован для больших размеров файлов и разумного количества файлов в каждой папке.

## <a name="optimize-io-intensive-jobs-on-hadoop-and-spark-workloads-on-hdinsight"></a>Оптимизация заданий с большим объемом операций ввода-вывода в рабочих нагрузках Hadoop и Spark в HDInsight

Задания можно отнести к одной из трех категорий:

* **Интенсивно использующие ЦП.** Эти задания имеют долгое время вычисления с минимальным временем ввода-вывода. Примеры включают машинное обучение и задания обработки естественных языков.
* **Интенсивное выполнение памяти.** Эти задания используют большой объем памяти. Примеры включают PageRank и задания аналитики в реальном времени.
* **С большим количеством операций ввода-вывода.** Эти задания большую часть своего времени выполняют операции ввода-вывода. Распространенным примером является задание копирования, которое выполняет только операции чтения и записи. К другим примерам относятся задания подготовки данных, считывающие многочисленные данные, выполняющие преобразование данных, а затем записывающие данные обратно в хранилище.

Следующее руководство применяется только к заданиям с большим объемом операций ввода-вывода.

### <a name="general-considerations-for-an-hdinsight-cluster"></a>Общие рекомендации, связанные с кластером HDInsight

* **Поддерживаемые версии HDInsight.** Для повышения производительности используйте последний выпуск HDInsight.
* **Регионах.** Разместите учетную запись Data Lake Storage 1-го поколения в том же регионе, что и кластер HDInsight.

Кластер HDInsight An состоит из двух головных узлов и нескольких рабочих узлов. Каждый рабочий узел предоставляет определенное количество ядер и памяти, которые определяют тип виртуальной машины. При выполнении задания YARN выступает в качестве согласователя ресурсов, который выделяет доступную память и ядра для создания контейнеров. Каждый контейнер выполняет задачи, которые необходимы для выполнения задания. Контейнеры выполняются параллельно для быстрой обработки задачи. Таким образом производительность повышается за счет выполнения максимально возможного количества контейнеров параллельно.

В пределах кластера HDInsight имеется три уровня, которые можно настроить, чтобы увеличить число контейнеров и использовать всю доступную пропускную способность.

* **Физический уровень**
* **Слой YARN**
* **Уровень рабочей нагрузки**

### <a name="physical-layer"></a>Физический уровень

**Запустите кластер с большим количеством узлов и/или на виртуальной машине большего размера.** Больший кластер позволит вам выполнять дополнительные контейнеры YARN, как это показано на рисунке ниже.

![Схема, на которой показано использование большего числа контейнеров YARN.](./media/data-lake-store-performance-tuning-guidance/VM.png)

**Используйте виртуальные машины с большей пропускной способностью сети.** Пропускная способность сети может быть узким местом, если она меньше, чем пропускная способность Data Lake Storage 1-го поколения. У различных виртуальных машин будет разная пропускная способность сети. Выберите тип виртуальной машины с самой большой пропускной способностью сети.

### <a name="yarn-layer"></a>Слой YARN

**Используйте контейнеры YARN меньшего размера.** Уменьшите размер каждого контейнера YARN, чтобы создать больше контейнеров с тем же объемом ресурсов.

![Схема, на которой показано использование меньших контейнеров YARN.](./media/data-lake-store-performance-tuning-guidance/small-containers.png)

В зависимости от рабочей нагрузки минимальный необходимый размер контейнера YARN будет иметься всегда. Если выбрать слишком маленький контейнер, у заданий будут возникать проблемы из-за нехватки памяти. Обычно контейнеры YARN не должны быть меньше 1 ГБ. Обычно вы видите 3 ГБ YARN контейнеров. Для некоторых рабочих нагрузок могут потребоваться контейнеры YARN большего размера.

**Увеличьте количество ядер на контейнер YARN.** Увеличьте количество ядер, выделенных для каждого контейнера, чтобы увеличить число параллельных задач, которые выполняются в каждом контейнере. Это работает для таких приложений, как Spark, выполняющих несколько задач на контейнер. Для таких приложений, как Hive, выполняющих один поток в каждом контейнере, лучше иметь больше контейнеров, чем больше ядер на контейнер.

### <a name="workload-layer"></a>Уровень рабочей нагрузки

**Используйте все доступные контейнеры.** Задайте число задач равное или больше, чем количество доступных контейнеров, чтобы использовались все ресурсы.

![Схема, на которой показано использование всех доступных контейнеров.](./media/data-lake-store-performance-tuning-guidance/use-containers.png)

**Незавершенные задачи ресурсоемки.** Если у каждой задачи есть большой объем данных для обработки, неудачное выполнение задачи приводит к дорогостоящей повторной попытке. Поэтому лучше создать больше задач, каждый из которых обрабатывает небольшой объем данных.

Помимо общих рекомендаций, приведенных выше, каждое приложение имеет различные параметры, которые можно настроить для каждого конкретного приложения. В следующей таблице перечислены некоторые параметры и ссылки для начала работы с настройкой производительности для каждого приложения.

| Рабочая нагрузка               | Параметры для настройки задач                                                         |
|--------------------|-------------------------------------------------------------------------------------|
| [Spark в HDInsight](data-lake-store-performance-tuning-spark.md)  | <ul><li>Num-executors</li><li>Executor-memory</li><li>Executor-cores</li></ul> |
| [Hive в HDInsight](data-lake-store-performance-tuning-hive.md)    | <ul><li>hive.tez.container.size</li></ul>         |
| [MapReduce в HDInsight](data-lake-store-performance-tuning-mapreduce.md)            | <ul><li>Mapreduce.map.memory</li><li>Mapreduce.job.maps</li><li>Mapreduce.reduce.memory</li><li>Mapreduce.job.reduces</li></ul> |
| [Storm в HDInsight](data-lake-store-performance-tuning-storm.md)| <ul><li>Количество рабочих процессов</li><li>Количество экземпляров исполнителей воронки</li><li>Количество экземпляров исполнителей сита </li><li>Количество задач воронки</li><li>Количество задач сита</li></ul>|

## <a name="see-also"></a>См. также раздел

* [Общие сведения об Azure Data Lake Storage Gen1](data-lake-store-overview.md)
* [Начало работы с аналитикой озера данных Azure](../data-lake-analytics/data-lake-analytics-get-started-portal.md)