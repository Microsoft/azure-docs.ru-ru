---
title: Обзор контроля доступа в Data Lake Storage 1-го поколения | Документация Майкрософт
description: Сведения об основах модели управления доступом Azure Data Lake Storage 1-го поколения, которая наследуется от HDFS.
services: data-lake-store
documentationcenter: ''
author: twooley
manager: mtillman
editor: cgronlun
ms.assetid: d16f8c09-c954-40d3-afab-c86ffa8c353d
ms.service: data-lake-store
ms.devlang: na
ms.topic: conceptual
ms.date: 03/26/2018
ms.author: twooley
ms.openlocfilehash: aa0da5721c577957b101ac8a2d9346c0536f0a88
ms.sourcegitcommit: ba676927b1a8acd7c30708144e201f63ce89021d
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/07/2021
ms.locfileid: "102424144"
---
# <a name="access-control-in-azure-data-lake-storage-gen1"></a>Контроль доступа в Azure Data Lake Storage 1-го поколения

В хранилище Azure Data Lake Storage 1-го поколения реализована модель контроля доступа на базе HDFS, которая, в свою очередь, основана на модели контроля доступа POSIX. В этой статье приведены общие сведения о модели контроля доступа в Data Lake Storage 1-го поколения. 

## <a name="access-control-lists-on-files-and-folders"></a>Списки управления доступом для файлов и папок

Существует два типа списков управления доступом (ACL): **ACL для доступа** и **ACL по умолчанию**.

* **ACL для доступа.** Эти списки позволяют управлять доступом к объекту. Списки ACL для доступа позволяют управлять доступом как к файлам, так и к папкам.

* **ACL по умолчанию.** "Шаблон" списков управления доступом, связанных с папкой, определяющей списки ACL для доступа любого дочернего элемента, созданного в этой папке. Файлы не имеют ACL по умолчанию.


Списки ACL для доступа и ACL по умолчанию имеют одинаковую структуру.

> [!NOTE]
> Изменение ACL по умолчанию в родительском объекте не оказывает влияния на ACL для доступа или ACL по умолчанию для уже существующих дочерних элементов.
>
>

## <a name="permissions"></a>Разрешения

Разрешения для объекта файловой системы делятся на **разрешения на чтение**, **разрешения на запись** и **разрешения на выполнение**. Разрешения применяются к файлам и папкам, как показано в таблице ниже:

|            |    Файл     |   Папка |
|------------|-------------|----------|
| **Разрешение на чтение (R)** | Чтение содержимого файла | Для вывода содержимого папки требуется разрешение **Read** и **EXECUTE** .|
| **Разрешение на запись (W)** | Запись или добавление данных в файл | Для создания дочерних элементов в папке требуются **разрешения на запись** и **выполнение**. |
| **Разрешение на выполнение (X)** | Не имеет значения в контексте Data Lake Storage 1-го поколения | Требуется для просмотра дочерних элементов папки. |

### <a name="short-forms-for-permissions"></a>Сокращения для разрешений

**RWX** означает разрешения на **чтение, запись и выполнение**. Существует еще более краткая форма — цифровая, согласно которой **чтение = 4**, **запись = 2**, **выполнение = 1**, а их сумма выражает предоставленные разрешения. Ниже приводятся некоторые примеры.

| Цифровая форма | Краткая форма |      Что это означает     |
|--------------|------------|------------------------|
| 7            | `RWX`        | чтение, запись и выполнение |
| 5            | `R-X`        | Чтение + выполнение         |
| 4            | `R--`        | Чтение                   |
| 0            | `---`        | Нет разрешений         |


### <a name="permissions-do-not-inherit"></a>Разрешения не наследуются

В модели на основе POSIX, используемой в Data Lake Storage 1-го поколения, разрешения для элемента хранятся в самом элементе. Другими словами, разрешения на доступ к элементу не могут быть унаследованы от родительских элементов.

## <a name="common-scenarios-related-to-permissions"></a>Типовые сценарии в зависимости от разрешений

Ниже показано несколько типовых сценариев для наглядного представления того, какие разрешения требуются для выполнения отдельных операций в учетной записи Data Lake Storage 1-го поколения.

| Операция | Объект              |    /      | Seattle/   | Portland/   | Data.txt       |
|-----------|---------------------|-----------|------------|-------------|----------------|
| Чтение      | Data.txt            |   `--X`   |   `--X`    |  `--X`      | `R--`          |
| Добавление к | Data.txt            |   `--X`   |   `--X`    |  `--X`      | `-W-`          |
| DELETE    | Data.txt            |   `--X`   |   `--X`    |  `-WX`      | `---`          |
| Создание    | Data.txt            |   `--X`   |   `--X`    |  `-WX`      | `---`          |
| Список      | /                   |   `R-X`   |   `---`    |  `---`      | `---`          |
| Список      | /Seattle/           |   `--X`   |   `R-X`    |  `---`      | `---`          |
| Список      | /Seattle/Portland/  |   `--X`   |   `--X`    |  `R-X`      | `---`          |


> [!NOTE]
> Для удаления файла разрешения на запись не требуются, если выполняются два предыдущих условия.
>
>


## <a name="users-and-identities"></a>Пользователи и удостоверения

Каждый файл или папка имеет отдельные разрешения для следующих удостоверений:

* Владелец
* группа владельцев;
* именованные пользователи;
* именованные группы;
* все остальные пользователи.

Удостоверения пользователей и групп являются удостоверениями Azure Active Directory (AAD). Если не указано иное, "пользователь" в контексте Data Lake Storage 1-го поколения может означать либо пользователя Azure AD, либо группу безопасности Azure AD.

### <a name="the-super-user"></a>Суперпользователь

Суперпользователь обладает самыми широкими правами среди всех пользователей учетной записи Data Lake Store 1-го поколения. Суперпользователь:

* обладает разрешениями RWX для **всех** файлов и папок;
* может изменять разрешения для любых файлов или папок;
* может изменять владельца или группу владельцев любого файла или папки.

Всем пользователям с ролью **Владелец** учетной записи Data Lake Storage 1-го поколения автоматически присваивается статус суперпользователя.

### <a name="the-owning-user"></a>Владелец

Пользователь, создавший элемент, автоматически становится владельцем элемента. Владелец может:

* изменять разрешения файла, владельцем которого он является;
* изменять группу владельцев файла, владельцем которого он является, если владелец файла одновременно является участником целевой группы.

> [!NOTE]
> Владелец *не может* изменить владельца другого файла или папки. Изменить владельца файла или папки может только суперпользователь.
>
>

### <a name="the-owning-group"></a>группа владельцев;

**Фон**

В списках управления доступом POSIX каждый пользователь связан с "основной группой". Например, пользователь Алиса принадлежит к группе finance. Пользователь Aлиса может принадлежать к нескольким группам, но одна из них всегда назначается как основная. В интерфейсе POSIX, когда пользователь Aлиса создает файл, группа владельцев этого файла задается для основной группы этого пользователя, которой в данном случае является группа finance. В противном случае разрешения группы владельцев будут аналогичны разрешениям, назначенным другим пользователям или группам.

Поскольку в Data Lake Storage 1-го поколения пользователи не связаны с "основной группой", группа владельцев назначается следующим образом.

**Назначение группы владельцев для нового файла или папки**

* **Вариант 1.** Корневая папка "/". Эта папка создается при создании учетной записи Data Lake Storage 1-го поколения. В этом случае группе владельцев задан GUID, состоящий из нулей.  Это значение не разрешает доступ.  Это заполнитель на время, пока не будет назначена группа.
* **Вариант 2** (во всех остальных случаях). При создании элемента группа владельцев копируется из родительской папки.

**Изменение группы владельцев**

Группа владельцев может быть изменена:
* одним из суперпользователей;
* владельцем, если он является участником целевой группы.

> [!NOTE]
> Группа владельцев *не может* изменить списки ACL для файла или папки.
>
> В случае корневой папки (**вариант 1** выше), для учетных записей, созданных до сентября 2018 г. включительно, группа владельцев назначалась для пользователя, создавшего учетную запись.  Одна учетная запись не позволяет предоставлять разрешения через группу владельцев, поэтому этот параметр по умолчанию не предоставляет разрешений. Разрешение можно назначить допустимой группе пользователей.


## <a name="access-check-algorithm"></a>Алгоритм проверки доступа

В следующем псевдокоде показан алгоритм проверки доступа к учетным записям Data Lake Storage 1-го поколения.

```
def access_check( user, desired_perms, path ) : 
  # access_check returns true if user has the desired permissions on the path, false otherwise
  # user is the identity that wants to perform an operation on path
  # desired_perms is a simple integer with values from 0 to 7 ( R=4, W=2, X=1). User desires these permissions
  # path is the file or folder
  # Note: the "sticky bit" is not illustrated in this algorithm
  
# Handle super users.
  if (is_superuser(user)) :
    return True

  # Handle the owning user. Note that mask IS NOT used.
  entry = get_acl_entry( path, OWNER )
  if (user == entry.identity)
      return ( (desired_perms & entry.permissions) == desired_perms )

  # Handle the named users. Note that mask IS used.
  entries = get_acl_entries( path, NAMED_USER )
  for entry in entries:
      if (user == entry.identity ) :
          mask = get_mask( path )
          return ( (desired_perms & entry.permmissions & mask) == desired_perms)

  # Handle named groups and owning group
  member_count = 0
  perms = 0
  entries = get_acl_entries( path, NAMED_GROUP | OWNING_GROUP )
  for entry in entries:
    if (user_is_member_of_group(user, entry.identity)) :
      member_count += 1
      perms | =  entry.permissions
  if (member_count>0) :
    return ((desired_perms & perms & mask ) == desired_perms)
 
  # Handle other
  perms = get_perms_for_other(path)
  mask = get_mask( path )
  return ( (desired_perms & perms & mask ) == desired_perms)
```

### <a name="the-mask"></a>Маска

Как показано в разделе "Алгоритм проверки доступа", маска ограничивает доступ для **именованных пользователей**, **группы владельцев** и **именованных групп**.  

> [!NOTE]
> В новой учетной записи Data Lake Storage 1-го поколения маске для списка ACL для доступа для корневой папки (/) по умолчанию присваивается значение RWX.
>
>

### <a name="the-sticky-bit"></a>Бит фиксации

Бит фиксации является расширенной функцией файловой системы POSIX. В контексте Data Lake Storage 1-го поколения потребность в использовании бита фиксации маловероятна. Таким образом, если в папке включен бит фиксации, дочерний элемент может удалить или переименовать только владелец дочернего элемента.

Бит фиксации не отображается на портале Azure.

## <a name="default-permissions-on-new-files-and-folders"></a>Разрешения по умолчанию для новых файлов и папок

При создании нового файла или подпапки в существующей папке список ACL по умолчанию для родительской папки определяет:

- список ACL для доступа и список ACL по умолчанию для дочерней папки;
- список ACL для доступа для дочернего файла (файлы не имеют списка ACL по умолчанию).

### <a name="umask"></a>umask

Когда создается файл или папка, значение umask используется для изменения того, как списки ACL по умолчанию устанавливаются для дочернего элемента. umask — это 9-битное значение для родительских папок, которое содержит значение RWX для **владельца "пользователь**", " **Группа-владелец**" и **другое**.

Umask для Azure Data Lake Storage 1-го поколения является константой, установленной в значение 007. Это значение преобразуется в

| Компонент umask     | Цифровая форма | Краткая форма | Значение |
|---------------------|--------------|------------|---------|
| umask.owning_user   |    0         |   `---`      | Для владельца стандартный список ACL родительского элемента копируется в список ACL доступа дочернего элемента. | 
| umask.owning_group  |    0         |   `---`      | Для группы владельцев стандартный список ACL родительского элемента копируется в список ACL доступа дочернего элемента. | 
| umask.other         |    7         |   `RWX`      | Для других все разрешения в ACL доступа дочернего элемента удаляются |

Значение umask, используемое Azure Data Lake Storage 1-го поколения, фактически означает, что значение для других никогда не передается по умолчанию в новые дочерние элементы независимо от того, что указывает ACL по умолчанию. 

Следующий псевдокод показывает, как применяется umask при создании списков ACL для дочернего элемента.

```
def set_default_acls_for_new_child(parent, child):
    child.acls = []
    for entry in parent.acls :
        new_entry = None
        if (entry.type == OWNING_USER) :
            new_entry = entry.clone(perms = entry.perms & (~umask.owning_user))
        elif (entry.type == OWNING_GROUP) :
            new_entry = entry.clone(perms = entry.perms & (~umask.owning_group))
        elif (entry.type == OTHER) :
            new_entry = entry.clone(perms = entry.perms & (~umask.other))
        else :
            new_entry = entry.clone(perms = entry.perms )
        child_acls.add( new_entry )
```

## <a name="common-questions-about-acls-in-data-lake-storage-gen1"></a>Общие вопросы о списках ACL в хранилище Data Lake Storage 1-го поколения

### <a name="do-i-have-to-enable-support-for-acls"></a>Нужно ли мне активировать поддержку ACL?

Нет. Контроль доступа к учетной записи Data Lake Storage 1-го поколения с помощью ACL всегда включен.

### <a name="which-permissions-are-required-to-recursively-delete-a-folder-and-its-contents"></a>Какие разрешения требуются для рекурсивного удаления папки и ее содержимого?

* Для доступа к родительской папке требуются разрешения на **запись и выполнение**.
* Чтобы удалить папку и все ее подпапки, требуются разрешения на **чтение, запись и выполнение**.

> [!NOTE]
> Для удаления файлов в папках не требуются разрешения на запись. Кроме того **, нельзя удалить** корневую папку "/".
>
>

### <a name="who-is-the-owner-of-a-file-or-folder"></a>Кто назначается владельцем файла или папки?

Создатель файла или папки становится их владельцем.

### <a name="which-group-is-set-as-the-owning-group-of-a-file-or-folder-at-creation"></a>Как назначается группа владельцев файла или папки при их создании?

Группа владельцев копируется из родительской папки, в которой создан файл или папка.

### <a name="i-am-the-owning-user-of-a-file-but-i-dont-have-the-rwx-permissions-i-need-what-do-i-do"></a>Я являюсь владельцем файла, но у меня нет необходимых разрешений RWX. Что делать?

Владелец может изменить разрешения на доступ к файлу на любое из требуемых RWX-разрешений.

### <a name="when-i-look-at-acls-in-the-azure-portal-i-see-user-names-but-through-apis-i-see-guids-why-is-that"></a>При просмотре списков ACL на портале Azure я вижу имена пользователей, а при просмотре в интерфейсе API — идентификаторы GUID. Почему так происходит?

Записи в списках ACL хранятся в качестве идентификаторов GUID, соответствующих пользователям в AAD. Интерфейсы API возвращают идентификаторы GUID без изменений. Портал Azure пытается упростить использование списков ACL, по возможности преобразовывая идентификаторы GUID в понятные имена.

### <a name="why-do-i-sometimes-see-guids-in-the-acls-when-im-using-the-azure-portal"></a>Почему при просмотре на портале Azure для списков ACL иногда отображаются идентификаторы GUID?

GUID отображается, если пользователь не существует в AAD. Как правило, это происходит, если пользователь уволился или его учетная запись удалена из AAD. Кроме того, убедитесь, что вы используете правильный идентификатор для настройки списков управления доступом (подробности см. ниже).

### <a name="when-using-service-principal-what-id-should-i-use-to-set-acls"></a>Какой идентификатор использовать для задания списков управления доступом при использовании субъекта-службы?

На портале Azure перейдите в раздел **Azure Active Directory-> корпоративные приложения** и выберите свое приложение. На вкладке **Обзор** должен отображаться идентификатор объекта, который следует использовать при добавлении списков ACL для доступа к данным (а не идентификатору приложения).

### <a name="does-data-lake-storage-gen1-support-inheritance-of-acls"></a>Поддерживает ли Data Lake Storage 1-го поколения наследование списков ACL?

Нет, но с помощью списков ACL по умолчанию можно задать соответствующие списки для дочерних файлов и папок, создаваемых в родительской папке.

### <a name="what-are-the-limits-for-acl-entries-on-files-and-folders"></a>Каковы ограничения для записей ACL для файлов и папок?

для каждого файла и каталога можно задать списки управления доступом 32. Списки ACL для доступа и по умолчанию имеют собственный предел записей ACL 32. Используйте группы безопасности для назначений ACL, если это возможно. С помощью групп вероятность превышения максимального количества записей ACL для каждого файла или каталога меньше.

### <a name="where-can-i-learn-more-about-posix-access-control-model"></a>Где можно получить дополнительную информацию о модели контроля доступа POSIX?

* [POSIX Access Control Lists on Linux](https://www.linux.com/news/posix-acls-linux) (Списки управления доступом POSIX для Linux)
* [HDFS Permission Guide](https://hadoop.apache.org/docs/current/hadoop-project-dist/hadoop-hdfs/HdfsPermissionsGuide.html) (Руководство по разрешениям в HDFS)
* [POSIX FAQ (POSIX: вопросы и ответы)](https://www.opengroup.org/austin/papers/posix_faq.html)
* [POSIX 1003.1 2008](https://standards.ieee.org/findstds/standard/1003.1-2008.html)
* [POSIX 1003.1 2013](https://pubs.opengroup.org/onlinepubs/9699919799.2013edition/)
* [POSIX 1003.1 2016](https://pubs.opengroup.org/onlinepubs/9699919799.2016edition/)
* [POSIX ACL on Ubuntu](https://help.ubuntu.com/community/FilePermissionsACLs) (POSIX ACL для Ubuntu)
* [ACL с использованием списков управления доступом в Linux](https://bencane.com/2012/05/27/acl-using-access-control-lists-on-linux/)

## <a name="see-also"></a>См. также раздел

* [Общие сведения об Azure Data Lake Storage Gen1](data-lake-store-overview.md)
