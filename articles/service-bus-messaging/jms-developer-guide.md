---
title: Руководством разработчика JMS 2,0 для служебной шины Azure
description: Как использовать API-интерфейс службы сообщений Java (JMS) 2,0 для взаимодействия с служебной шиной Azure
ms.topic: article
ms.date: 01/17/2021
ms.openlocfilehash: 6c535b12906b6d9385029896dc5d0caf85d3399a
ms.sourcegitcommit: 227b9a1c120cd01f7a39479f20f883e75d86f062
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/18/2021
ms.locfileid: "100654579"
---
# <a name="azure-service-bus-jms-20-developer-guide"></a>Руководством разработчика JMS 2,0 для служебной шины Azure

Это краткое описание содержит подробные сведения, которые помогут вам выполнить успешную связь с служебной шиной Azure с помощью API-интерфейса JMS 2,0.

Если вы не знакомы с служебной шиной Azure в качестве разработчика Java, ознакомьтесь с приведенными ниже статьями.

| Начало работы | Основные понятия |
|----------------|-------|
| <ul> <li> [Что такое служебная шина Azure](service-bus-messaging-overview.md) </li> <li> [Очереди, разделы и подписки](service-bus-queues-topics-subscriptions.md) </li> </ul> | <ul> <li> [Служебная шина Azure — уровень Premium](service-bus-premium-messaging.md) </li> </ul> |

## <a name="java-message-service-jms-programming-model"></a>Модель программирования службы сообщений Java (JMS)

Модель программирования API службы сообщений Java показана ниже. 

> [!NOTE]
>
>**Уровень Premium служебной шины Azure** поддерживает JMS 1,1 и JMS 2,0.
> <br> <br>
> **Служебная шина Azure —** уровень "Стандартный" поддерживает ограниченную функциональность JMS 1,1. Дополнительные сведения см. в этой [документации](service-bus-java-how-to-use-jms-api-amqp.md).
>

# <a name="jms-20-programming-model"></a>[Модель программирования JMS 2,0](#tab/JMS-20)

:::image type="content" source="./media/jms-developer-guide/java-message-service-20-programming-model.png"alt-text="Схема, демонстрирующая модель программирования JMS 2,0."border="false":::

# <a name="jms-11-programming-model"></a>[Модель программирования JMS 1,1](#tab/JMS-11)

:::image type="content" source="./media/jms-developer-guide/java-message-service-11-programming-model.png"alt-text="Схема, демонстрирующая модель программирования JMS 1,1."border="false":::

---

## <a name="jms---building-blocks"></a>Строительные блоки JMS

Для взаимодействия с приложением JMS доступны следующие стандартные блоки.

> [!NOTE]
> Приведенное ниже руководство было адаптировано в [учебнике Oracle Java EE 6 для службы сообщений Java (JMS)](https://docs.oracle.com/javaee/6/tutorial/doc/bnceh.html) .
>
> Этот учебник рекомендуется использовать для лучшего понимания службы сообщений Java (JMS).
>

### <a name="connection-factory"></a>Фабрика подключений
Объект фабрики соединений используется клиентом для подключения к поставщику JMS. Фабрика подключений включает набор параметров конфигурации соединения, определяемых администратором.

Каждая фабрика подключений является экземпляром `ConnectionFactory` `QueueConnectionFactory` или `TopicConnectionFactory` интерфейсом.

Для упрощения подключения к служебной шине Azure эти интерфейсы реализуются с `ServiceBusJmsConnectionFactory` помощью `ServiceBusJmsQueueConnectionFactory` и `ServiceBusJmsTopicConnectionFactory` соответственно. Для создания экземпляра фабрики соединений можно использовать следующие параметры. 
   * Строка подключения — строка подключения для пространства имен уровня Premium служебной шины Azure.
   * Контейнер свойств Сервицебусжмсконнектионфакторисеттингс, содержащий
      * Коннектионидлетимеаутмс — время ожидания простаивающих подключений в миллисекундах.
      * Трацефрамес — логический флаг, позволяющий собирать кадры трассировки AMQP для отладки.
      * *другие параметры конфигурации*

Фабрику можно создать, как показано ниже. Строка подключения является обязательным параметром, но дополнительные свойства являются необязательными.

```java
ConnectionFactory factory = new ServiceBusJmsConnectionFactory(SERVICE_BUS_CONNECTION_STRING, null);
```

> [!IMPORTANT]
> Приложения Java, использующие API JMS 2,0, должны подключаться к служебной шине Azure, используя только строку подключения. В настоящее время проверка подлинности для клиентов JMS поддерживается только при использовании строки подключения.
>
> Резервная проверка подлинности Azure Active Directory (AAD) в настоящее время не поддерживается.
>

### <a name="jms-destination"></a>Назначение JMS

Назначение — это объект, который используется клиентом для указания целевого объекта создаваемых сообщений и источника сообщений, которые он использует.

Назначения сопоставляются с сущностями в служебной шине Azure. очереди (в сценариях "точка — точка") и разделы (в сценариях публикации).

### <a name="connections"></a>Соединения

Соединение инкапсулирует виртуальное подключение к поставщику JMS. С помощью служебной шины Azure это означает подключение между приложением и служебной шиной Azure через AMQP.

Подключение создается из фабрики подключений, как показано ниже.

```java
Connection connection = factory.createConnection();
```

### <a name="sessions"></a>Сеансы

Сеанс — это однопотоковый контекст для создания и использования сообщений. Его можно использовать для создания сообщений, поставщиков сообщений и потребителей, но он также предоставляет транзакционный контекст, позволяющий группировать операции отправки и получения в атомарную единицу работы.

Сеанс можно создать из объекта соединения, как показано ниже.

```java
Session session = connection.createSession(false, Session.CLIENT_ACKNOWLEDGE);
```

#### <a name="session-modes"></a>Режимы сеанса

Сеанс можно создать с помощью любого из следующих режимов.

| Режимы сеанса | Поведение |
| ----------------- | -------- |
|**Session.AUTO_ACKNOWLEDGE** | Сеанс автоматически подтверждает поступление клиента сообщения либо при успешном возвращении сеанса из вызова Receive, либо при вызове прослушивателя сообщений для обработки сообщения.|
|**Session.CLIENT_ACKNOWLEDGE** |Клиент подтверждает потребленное сообщение, вызывая метод подтверждения сообщения.|
|**Session.DUPS_OK_ACKNOWLEDGE**|Этот режим подтверждения дает сеансу команду на отложенное подтверждение доставки сообщений.| 
|**Session.SESSION_TRANSACTED**|Это значение может быть передано в качестве аргумента в метод createSession (int sessionMode) в объекте Connection, чтобы указать, что сеанс должен использовать локальную транзакцию.| 

Если режим сеанса не указан, по умолчанию выбирается **Session.AUTO_ACKNOWLEDGE** .

### <a name="jmscontext"></a>жмсконтекст

> [!NOTE]
> Жмсконтекст определяется как часть спецификации JMS 2,0.
>

Жмсконтекст объединяет функциональные возможности, предоставляемые соединением и объектом Session. Его можно создать из объекта фабрики подключений.

```java
JMSContext context = connectionFactory.createContext();
```

#### <a name="jmscontext-modes"></a>Режимы Жмсконтекст

Как и объект **Session** , жмсконтекст можно создать с теми же режимами подтверждения, которые упоминались в [режимах сеанса](#session-modes).

```java
JMSContext context = connectionFactory.createContext(JMSContext.AUTO_ACKNOWLEDGE);
```

Если режим не указан, по умолчанию выбирается **JMSContext.AUTO_ACKNOWLEDGE** .

### <a name="jms-message-producers"></a>Производители сообщений JMS

Производитель сообщений — это объект, который создается с помощью Жмсконтекст или сеанса и используется для отправки сообщений в назначение.

Его можно создать как изолированный объект, как показано ниже. 

```java
JMSProducer producer = context.createProducer();
```

или создается во время выполнения, когда требуется отправить сообщение.

```java
context.createProducer().send(destination, message);
```

### <a name="jms-message-consumers"></a>Потребители сообщений JMS

Потребитель сообщений — это объект, созданный Жмсконтекст или сеансом и используемый для получения сообщений, отправленных в назначение. Его можно создать, как показано ниже.

```java
JMSConsumer consumer = context.createConsumer(dest);
```

#### <a name="synchronous-receives-via-receive-method"></a>Синхронное получение с помощью метода Receive ()

Потребитель сообщений предоставляет синхронный способ получения сообщений от назначения с помощью `receive()` метода.

Если аргументы и время ожидания не заданы или задано время ожидания "0", потребитель блокируется в течение неограниченного времени, пока не будет получено сообщение, или если соединение разорвано (в зависимости от того, что раньше).

```java
Message m = consumer.receive();
Message m = consumer.receive(0);
```

При указании ненулевого положительного аргумента потребитель блокируется до истечения срока действия этого таймера.

```java
Message m = consumer.receive(1000); // time out after one second.
```

#### <a name="asynchronous-receives-with-jms-message-listeners"></a>Асинхронное получение с помощью прослушивателей сообщений JMS

Прослушиватель сообщений — это объект, который используется для асинхронной обработки сообщений в назначении. Он реализует `MessageListener` интерфейс, который содержит `onMessage` метод, в котором должна находиться конкретная бизнес-логика.

Объект прослушивателя сообщений должен быть создан и зарегистрирован для конкретного потребителя сообщений с помощью `setMessageListener` метода.

```java
Listener myListener = new Listener();
consumer.setMessageListener(myListener);
```

### <a name="consuming-from-topics"></a>Использование из разделов

[Потребители сообщений JMS](#jms-message-consumers) создаются для [назначения](#jms-destination) , которое может быть очередью или темой.

Потребители в очередях — это просто объекты на стороне клиента, которые находятся в контексте сеанса (и подключения) между клиентским приложением и служебной шиной Azure.

Однако потребители в темах имеют 2 части — 
   * **Объект на стороне клиента** , который находится в контексте сеанса (или жмсконтекст), и
   * **Подписка** , которая является сущностью в служебной шине Azure.

Подписки описаны [здесь](java-message-service-20-entities.md#java-message-service-jms-subscriptions) и могут быть одним из следующих. 
   * Общие устойчивые подписки
   * Общие неустойчивые подписки
   * Несовместное использование устойчивых подписок
   * Неустойчивые подписки без общих ресурсов

### <a name="jms-queue-browsers"></a>Браузеры очереди JMS

API JMS предоставляет `QueueBrowser` объект, позволяющий приложению просматривать сообщения в очереди и отображать значения заголовков для каждого сообщения.

Обозреватель очереди можно создать с помощью Жмсконтекст, как показано ниже.

```java
QueueBrowser browser = context.createBrowser(queue);
```

> [!NOTE]
> API JMS не предоставляет API для просмотра раздела.
>
> Это связано с тем, что сам раздел не хранит сообщения. Как только сообщение будет отправлено в раздел, оно перенаправляется в соответствующие подписки.
>

### <a name="jms-message-selectors"></a>Селекторы сообщений JMS

Селекторы сообщений могут использоваться принимающими приложениями для фильтрации получаемых сообщений. При использовании селекторов сообщений принимающее приложение отгружает работу фильтрации сообщений в поставщик JMS (в нашем примере это служебная шина Azure), а не несет саму ответственность.

При создании любого из перечисленных ниже потребителей можно использовать селекторы. 
   * Общая устойчивая подписка
   * Необщая устойчивая подписка
   * Общая неустойчивая подписка
   * Неустойчивая подписка, которая не является общей
   * Браузер очереди


## <a name="summary"></a>Сводка

Это руководство разработчика демонстрирует, как клиентские приложения Java, использующие службу сообщений Java (JMS), могут подключаться к служебной шине Azure.

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения о служебной шине Azure и сведения о сущностях службы сообщений Java (JMS) см. по ссылкам ниже. 
* [Служебная шина — очереди, разделы и подписки](service-bus-queues-topics-subscriptions.md)
* [Служебная шина — сущности службы сообщений Java](service-bus-queues-topics-subscriptions.md#java-message-service-jms-20-entities)
* [Поддержка AMQP 1.0 в служебной шине](service-bus-amqp-overview.md)
* [Инструкции для разработчиков служебной шины AMQP 1,0](service-bus-amqp-dotnet.md)
* [Начало работы с очередями служебной шины](service-bus-dotnet-get-started-with-queues.md)
* [API службы сообщений Java (внешний документ Oracle)](https://docs.oracle.com/javaee/7/api/javax/jms/package-summary.html)
* [Узнайте, как выполнить миграцию с Активемк на служебную шину.](migrate-jms-activemq-to-servicebus.md)
