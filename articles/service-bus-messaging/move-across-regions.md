---
title: Перемещение пространства имен служебной шины в другой регион | Документация Майкрософт
description: В этой статье показано, как переместить пространство имен служебной шины Azure из текущего региона в другой.
ms.topic: how-to
ms.date: 06/23/2020
ms.custom: subject-moving-resources
ms.openlocfilehash: 573ea96437cf6cb76854ffa417fd3ad3fb86138b
ms.sourcegitcommit: 772eb9c6684dd4864e0ba507945a83e48b8c16f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "88861068"
---
# <a name="move-an-azure-service-bus-namespace-to-another-region"></a>Перемещение пространства имен служебной шины Azure в другой регион
Существуют различные сценарии, в которых необходимо переместить существующее пространство имен служебной шины из одного региона в другой. Например, может потребоваться создать пространство имен с той же конфигурацией для тестирования. Кроме того, в рамках [планирования аварийного восстановления](service-bus-geo-dr.md)может потребоваться создать дополнительное пространство имен в другом регионе.

Ниже приведены основные действия.

1. Экспорт пространства имен служебной шины в текущем регионе в шаблон Azure Resource Manager. 
1. Обновление расположения ресурсов в шаблоне. Кроме того, удалите фильтр подписки по умолчанию из шаблона, так как вы не можете создать правило по умолчанию, так как оно создается автоматически. 
1. Используйте шаблон для развертывания пространства имен служебной шины в целевом регионе. 
1. Проверьте развертывание, чтобы убедиться, что в целевом регионе созданы все пространства имен, очереди, разделы и подписки для разделов. 
1. Завершите перемещение, удалив пространство имен из исходного региона после обработки всех сообщений. 

## <a name="prerequisites"></a>Предварительные требования
Убедитесь, что служебная шина и функции Azure, используемые вашей учетной записью, поддерживаются в целевом регионе.
 
## <a name="prepare"></a>Подготовка
Чтобы приступить к работе, экспортируйте шаблон диспетчер ресурсов. Этот шаблон содержит параметры, описывающие пространство имен служебной шины.

1. Войдите на [портал Azure](https://portal.azure.com).
2. Выберите **все ресурсы** , а затем выберите пространство имен служебной шины.
3. Выберите **Параметры**>  >  **Экспорт шаблона**.
4. На странице **Экспорт шаблона** нажмите кнопку **загрузить** .

    :::image type="content" source="./media/move-across-regions/download-template.png" alt-text="Загрузить шаблон диспетчер ресурсов":::
5. Выберите ZIP-файл, скачанный с портала, и распакуйте его в выбранную папку. Этот ZIP-файл содержит шаблоны и JSON-файлы параметров. 
1. Откройте файл template.jsв извлеченной папке. 
1. Найдите `location` и замените значение свойства на новое имя для региона или расположения. Чтобы получить коды расположения, см. раздел [расположения Azure](https://azure.microsoft.com/global-infrastructure/locations/). Код для региона — это имя региона без пробелов, например, `West US` равно `westus` .
1. Удаление определений ресурсов типа: `Microsoft.ServiceBus/namespaces/topics/subscriptions/rules` . Не забудьте удалить символ запятой ( `,` ), предшествующий этому разделу, чтобы сохранять допустимый формат JSON.  

    > [!NOTE]
    > Нельзя создать правило по умолчанию для подписки с помощью шаблона диспетчер ресурсов. Правило по умолчанию создается автоматически при создании подписки в целевом регионе. 

## <a name="move"></a>Переместить
Разверните шаблон, чтобы создать пространство имен служебной шины в целевом регионе. 

1. На портале Azure выберите **Создать ресурс**.
2. В **поле Поиск в Marketplace** введите **шаблон развертывания** для искомого текста, выберите **шаблоны развертывания (развернуть с помощью пользовательских шаблонов)** и нажмите клавишу **Ввод**.

    :::image type="content" source="./media/move-across-regions/new-template-deployment.png" alt-text="Развертывание нового шаблона":::    
1. На странице **шаблоны развертывания** выберите **создать**.

    :::image type="content" source="./media/move-across-regions/template-deployment-create-button.png" alt-text="Новое развертывание шаблона — кнопка &quot;создать&quot;":::        
1. На странице **Настраиваемое развертывание** выберите **создать собственный шаблон в редакторе**.

    :::image type="content" source="./media/move-across-regions/build-template-link.png" alt-text="Создание собственного шаблона в ссылке редактора":::            
1. На странице **изменение шаблона** на панели инструментов выберите пункт **загрузить файл** , а затем следуйте инструкциям по загрузке **template.jsдля** файла, скачанного в предыдущем разделе.

    :::image type="content" source="./media/move-across-regions/select-template.png" alt-text="Выбор шаблона":::                
1. Нажмите кнопку **сохранить** , чтобы сохранить шаблон. 

    :::image type="content" source="./media/move-across-regions/save-template.png" alt-text="Сохранение шаблона":::                    
1. На странице **Настраиваемое развертывание** выполните следующие действия. 
    1. Выберите **подписку** Azure. 
    2. Выберите существующую **группу ресурсов** или создайте новую. 
    3. Выберите целевое **Расположение** или регион. Если выбрана существующая группа ресурсов, этот параметр доступен только для чтения. 
    4. Введите новое **имя для пространства имен**.
    1. Выберите **Review + create** (Просмотреть и создать). 

        :::image type="content" source="./media/move-across-regions/deploy-template.png" alt-text="Развертывание шаблона диспетчер ресурсов":::
    1. На странице **Просмотр и создание** выберите **создать** в нижней части страницы. 
    
## <a name="verify"></a>Проверка
1. После успешного развертывания выберите **Переход к группе ресурсов**.

    :::image type="content" source="./media/move-across-regions/resource-group-navigation-link.png" alt-text="Ссылка &quot;переход к группе ресурсов&quot;":::    
1. На странице **Группа ресурсов** выберите пространство имен служебной шины. 

    :::image type="content" source="./media/move-across-regions/select-namespace.png" alt-text="Выбор пространства имен служебной шины":::    
1. На странице **пространство имен служебной шины** убедитесь, что в исходном регионе отображаются очереди, разделы и подписки. 
    1. В нижней части правой панели появятся **очереди** в пространстве имен.         
    
        :::image type="content" source="./media/move-across-regions/queue-namespace.png" alt-text="Очереди в пространстве имен":::
    2. Перейдите на вкладку **разделы** , чтобы просмотреть разделы в пространстве имен.
    
        :::image type="content" source="./media/move-across-regions/topics-namespace.png" alt-text="Разделы в пространстве имен":::
    3. Выберите раздел для проверки создания подписок. 

        :::image type="content" source="./media/move-across-regions/topic-subscriptions.png" alt-text="Подписки на разделы":::      
    
    

## <a name="discard-or-clean-up"></a>Отмена или очистка
Если после развертывания вы хотите начать заново, можно удалить **целевое пространство имен служебной шины** и повторить действия, описанные в разделах [Подготовка](#prepare) и [Перемещение](#move) этой статьи.

Чтобы зафиксировать изменения и завершить перемещение пространства имен служебной шины, удалите **исходное пространство имен служебной шины**. Перед удалением пространства имен убедитесь, что обработаны все сообщения. 

Чтобы удалить пространство имен служебной шины (источник или цель) с помощью портал Azure:

1. В окне поиска в верхней части портал Azure введите **служебная шина** и выберите **служебная шина** из результатов поиска. В списке отображаются пространства имен служебной шины.
2. Выберите целевое пространство имен для удаления и щелкните **Удалить** на панели инструментов. 

    ![Кнопка "удалить пространство имен"](./media/move-across-regions/delete-namespace-button.png)
3. На странице **удаление ресурсов** проверьте выбранные ресурсы и подтвердите удаление, введя **Да**, а затем выберите **Удалить**. 

    Другой вариант — удалить группу ресурсов с пространством имен служебной шины. На странице **Группа ресурсов** выберите **Удалить группу ресурсов** на панели инструментов, а затем подтвердите удаление. 

## <a name="next-steps"></a>Дальнейшие действия

В этом руководстве вы переместили пространство имен служебной шины Azure из одного региона в другой и очистили исходные ресурсы.  Дополнительные сведения о перемещении ресурсов между регионами и аварийном восстановлении в Azure см. по следующей ссылке:

- [Перемещение ресурсов в новую группу ресурсов или подписку](../azure-resource-manager/management/move-resource-group-and-subscription.md)
