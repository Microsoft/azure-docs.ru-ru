---
title: Служебная шина Azure — срок действия сообщения
description: В этой статье объясняется срок действия сообщений служебной шины Azure и время их жизни. После такого крайнего срока сообщение больше не будет доставлено.
ms.topic: conceptual
ms.date: 02/17/2021
ms.openlocfilehash: 74df8909633c2fa048c23c559ffdd315a8616e11
ms.sourcegitcommit: f3ec73fb5f8de72fe483995bd4bbad9b74a9cc9f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/04/2021
ms.locfileid: "102042833"
---
# <a name="message-expiration-time-to-live"></a>Срок действия сообщения (срок жизни)
Полезные данные в сообщении либо команда или запрос, которые сообщение передает получателю, почти всегда имеют срок действия, который тем или иным образом определяется на уровне приложения. По прошествии данного крайнего срока содержимое уже не доставляется или не выполняется запрошенная операция.

Для среды разработки и тестовой среды, в которых очереди и разделы часто используются в контексте частичного запуска приложений или частей приложений, желательно также выполнять автоматическую сборку мусора для удаления потерянных тестовых сообщений, чтобы следующий тест можно было выполнить "с чистого листа".

Срок действия любого отдельного сообщения можно контролировать, установив системное свойство " **срок жизни** ", которое указывает относительную длительность. Срок действия истекает мгновенно, когда сообщение помещается в очередь в сущности. В это время свойство **срок действия истечения времени в формате UTC** принимает значение срока жизни в **очереди в формате UTC**  +  . Параметр срока жизни сообщения через посредника не применяется, если клиенты не ожидают активного прослушивания.

После **истечения срока действия в формате UTC** сообщения становятся недоступными для извлечения. Срок действия не влияет на сообщения, которые в настоящий момент заблокированы для доставки. Эти сообщения по-прежнему обрабатываются обычным образом. Если срок действия блокировки истекает или сообщение отбрасывается, его срок действия вступает в силу немедленно.

Во время блокировки сообщения приложение может посчитать, что его срок действия истек. Будет ли приложение обрабатывать это сообщение или отбросит его, определяется разработчиком.

Крайне низкое значение срока жизни в миллисекундах или секундах может привести к истечению срока действия сообщений до того, как они будут получены приложениями получателя. Рассмотрите наивысший срок жизни, который подходит для вашего приложения.

## <a name="entity-level-expiration"></a>Срок действия уровня сущности
Все сообщения, отправляемые в очередь или раздел, подчиняются сроку действия по умолчанию, заданному на уровне сущности. Его также можно задать на портале во время создания и корректировки позже. Истечение срока действия по умолчанию используется для всех сообщений, отправляемых в сущность, если срок жизни не задан явно. Срок действия по умолчанию также действует в качестве значения срока жизни. Сообщения с более длительным сроком действия, чем значение по умолчанию, автоматически корректируются до значения срока жизни сообщения по умолчанию до постановки в очередь.

> [!NOTE]
> Значение срока жизни по умолчанию для сообщения с посредником — это максимальное возможное значение для однорангового 64-разрядного целого числа, если не указано иное.
>
> Для сущностей обмена сообщениями (очередей и разделов) время истечения срока действия по умолчанию также является максимальным значением для однозначного 64-разрядного целого числа для уровней "Стандартный" и "Премиум" служебной шины. Для уровня " **базовый** " значение по умолчанию (также максимальный) истекает **14 дней**.

Просроченные сообщения при необходимости можно переместить в [очередь недоставленных](service-bus-dead-letter-queues.md)сообщений. Этот параметр можно настроить программно или с помощью портал Azure. Если этот параметр оставить отключенным, то просроченные сообщения будут удаляться. Сообщения с истекшим сроком действия, перемещенные в очередь недоставленных сообщений, могут отличаться от других недоставленных писем путем оценки свойства [причины недоставленной](service-bus-dead-letter-queues.md#moving-messages-to-the-dlq) почты, которое брокер хранит в разделе Свойства пользователя. 

В упомянутом выше случае, в котором сообщение защищено от истечения срока действия благодаря блокировке, если для сущности установлен соответствующий флаг, то это сообщение автоматически перемещается в очередь недоставленных сообщений после того, как блокировка будет снята или истечет срок ее действия. Однако он не перемещается, если сообщение успешно сопоставлено, что предполагает, что приложение успешно обработало его, несмотря на номинальный срок действия.

Сочетание срока жизни и автоматической (и транзакционной) неактивности по сроку действия является ценным средством для обеспечения уверенности в том, что при достижении крайнего срока для обработки запрашивается задание, заданное для обработчика или группа обработчиков с крайним сроком.

Для примера рассмотрим веб-сайт, который должен надежно выполнять задания в серверной части с ограниченными возможностями масштабирования и который иногда подвержен скачкам трафика или должен быть независимым от доступности этой серверной части. В обычном случае обработчик на стороне сервера, предназначенный для отправленных данных пользователя, передает информацию в очередь и затем получает ответ, подтверждающий успешную обработку транзакций в очереди ответов. Если возникает всплеск трафика, и внутренний обработчик не может обработать элементы невыполненной работы вовремя, задания с истекшим сроком действия возвращаются в очередь недоставленных сообщений. Текущий пользователь может быть оповещен о том, что запрошенная операция займет немного больше времени, чем обычно, и что затем запрос можно будет поместить в другую очередь для обработки. В итоге результат обработки отправляется пользователю по электронной почте. 


## <a name="temporary-entities"></a>Временные сущности

Очереди, разделы и подписки служебной шины можно создавать как временные сущности, которые автоматически удаляются, если они не использовались в течение указанного периода времени.
 
Автоматическая очистка полезна в сценариях разработки и тестирования, в которых сущности создаются динамически и не очищаются после использования, из-за некоторого перерыва в тестировании или отладке. Ее также удобно использовать, когда приложение создает динамические сущности, такие как очередь ответов, для получения ответов процессом веб-сервера или в другим объектом с относительно небольшим временем существования. После того, как экземпляр объекта исчезает, надежно очищать эти сущности сложно.

Эта функция включается с помощью свойства **Автоматическое удаление при простое** в пространстве имен. Для этого свойства задается значение времени, в течение которого сущность должна быть неактивной (не использоваться) и по истечении которого она автоматически удаляется. Минимальное значение свойства — 5.
 
## <a name="idleness"></a>Неактивность

Ниже описаны условия, которые определяют неактивность сущностей (очередей, разделов и подписок).

- Очереди
    - Нет отправок.  
    - Нет получений.  
    - Нет обновлений очереди.  
    - Нет запланированных сообщений.  
    - Нет просмотров или обзоров. 
- Разделы  
    - Нет отправок.  
    - Нет обновлений раздела.  
    - Нет запланированных сообщений. 
- Подписки
    - Нет получений.  
    - Нет обновлений подписки.  
    - В подписке нет новых добавленных правил.  
    - Нет просмотров или обзоров.  
 

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения об обмене сообщениями через служебную шину см. в следующих статьях:

* [Очереди, разделы и подписки служебной шины](service-bus-queues-topics-subscriptions.md)
* [Начало работы с очередями служебной шины](service-bus-dotnet-get-started-with-queues.md)
* [Как использовать разделы и подписки служебной шины](service-bus-dotnet-how-to-use-topics-subscriptions.md)
