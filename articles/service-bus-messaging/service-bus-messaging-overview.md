---
title: Основные сведения об обмене сообщениями через служебную шину Azure | Документация Майкрософт
description: В этой статье представлены общие сведения о Служебной шине Azure, полностью управляемом интеграционном брокере сообщений корпоративного типа.
ms.topic: overview
ms.date: 11/20/2020
ms.openlocfilehash: 7453e8dd300ad754fb58489f059670af209314ab
ms.sourcegitcommit: aaa65bd769eb2e234e42cfb07d7d459a2cc273ab
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/27/2021
ms.locfileid: "98881607"
---
# <a name="what-is-azure-service-bus"></a>Что такое служебная шина Azure?
Служебная шина Microsoft Azure — это полностью управляемый брокер сообщений корпоративного типа с поддержкой очередей сообщений и разделов публикации и подписки. Служебная шина используется для разделения приложений и служб, что предоставляет следующие преимущества:

- распределение нагрузки между конкурирующими рабочими ролями;
- безопасная маршрутизация для передачи данных и команд управления через границы служб и приложений;
- координация транзакционных работ, которые требуют высокий надежности. 

## <a name="overview"></a>Обзор
Данные передаются между приложениями и (или) службами с помощью *сообщений*. Сообщением называется контейнер с данными, дополненный метаданными. В нем могут содержаться любые данные, включая структурированные данные, закодированные в любом из распространенных форматов (например, JSON, XML, Apache Avro, обычный текст).

Вот несколько распространенных сценариев для обмена сообщениями:

* *Обмен сообщениями*. Передача бизнес-данных, например данных о продажах, заказах и перемещении запасов, а также журналов.
* *Разделение задач между приложениями*. Повышение надежности и масштабируемости приложений и служб. Производители и потребители не обязаны одновременно быть доступны или подключены к Интернету. [Балансировка нагрузки](/azure/architecture/patterns/queue-based-load-leveling) избавляет от перегрузки служб при всплесках трафика. 
* *Балансировка нагрузки.* Несколько [конкурирующих потребителей](/azure/architecture/patterns/competing-consumers) могут одновременно считывать из очереди сообщения, которые безопасно и эксклюзивно закрепляются за конкретными потребителями. 
* *Разделы и подписки*. Включите поддержку отношений *один ко многим* между [издателями и подписчиками](/azure/architecture/patterns/publisher-subscriber), чтобы подписчики могли выбирать определенные сообщения из потока опубликованных сообщений.
* *Транзакции*. Вы можете выполнять несколько операций в рамках одной атомарной транзакции. Например, в области транзакции можно выполнить следующие операции:  

    1. Получение сообщения из одной очереди.
    2. Публикация результатов обработки в одну или несколько очередей.
    3. Перемещение входного сообщения из исходной очереди. 
    
    Результаты обработки становятся доступными для следующих потребителей только при условии успешного выполнения каждой из операций, включая успешное согласование входного сообщения, что гарантирует однократную обработку. Такая модель транзакций служит надежной основой для реализации шаблона [компенсирующих транзакций](/azure/architecture/patterns/compensating-transaction) в общем контексте решения. 
* *Сеансы обмена сообщениями*. Реализуют крупномасштабную координацию рабочих процессов и мультиплексированных передач, при которых требуется строгое упорядочение сообщений или обработка сообщений с отсрочкой.

Если вы уже работали с другими брокерами сообщений, такими как Apache ActiveMQ, основные понятия Служебной шины будут вам знакомы. Так как Служебная шина предоставляется по модели PaaS (платформа как услуга), она позволяет не беспокоиться о приведенных ниже действиях. которые выполняет платформа Azure: 

- размещение журналов и управление дисковым пространством;
- управление резервными копиями;
- установка исправлений для операционных систем или продуктов;
- обработка аппаратных сбоев; 
- отработка отказа на резервный компьютер;

## <a name="compliance-with-standards-and-protocols"></a>обеспечение соответствия стандартам и протоколам.

Основным протоколом передачи данных для Служебной шины является [AMQP (расширенный протокол управления очередью сообщений) версии 1.0](service-bus-amqp-overview.md), реализованный по открытому стандарту ISO/IEC. Он позволяет клиентам создавать приложения, работающие со Служебной шиной и локальными брокерами, например ActiveMQ или RabbitMQ. [Руководство по протоколу AMQP](service-bus-amqp-protocol-guide.md) содержит подробные сведения на случай, если вам нужна такая абстракция.

[Служебная шина уровня "Премиум"](service-bus-premium-messaging.md) полностью совместима с [API службы сообщений Java (JMS) 2.0](how-to-use-java-message-service-20.md) для Java/Jakarta EE. И наконец, Служебная шина уровня "Стандартный" поддерживает подмножество JMS 1.1, предназначенное для работы с очередями. JMS представляет собой популярную абстракцию для брокеров сообщений, которая интегрируется со множеством приложений и платформ, включая популярную платформу Spring. Чтобы перейти на использование Служебной шины Azure с других брокеров, достаточно просто воссоздать топологию очередей и разделов, а затем изменить зависимости и конфигурацию на стороне поставщика клиента. Пример вы найдете в [руководстве по миграции на ActiveMQ](migrate-jms-activemq-to-servicebus.md).

## <a name="concepts-and-terminology"></a>Основные понятия и терминология 
В этом разделе рассматриваются основные понятия и термины Служебной шины.

### <a name="namespaces"></a>Пространства имен
Контейнер для всех компонентов обмена сообщениями. В одном пространстве имен могут содержаться несколько очередей и разделов. Часто пространства имен выполняют роль контейнеров приложений. 

Пространство имен близко к тому, что в терминологии других брокеров именуется "сервером", но эти понятия не полностью эквивалентны. Пространство имен Служебной шины предоставляет вам долю емкости большого кластера, который состоит из десятков активных виртуальных машин. При необходимости оно может охватывать три [зоны доступности Azure](../availability-zones/az-overview.md). Благодаря этому вы получаете все преимущества доступности и надежности, предоставляемые использованием брокера сообщений в огромном масштабе. При этом вам также можно не беспокоиться о базовых сложностях. Служебная шина реализует бессерверный обмен сообщениями.

### <a name="queues"></a>Очереди
Сообщений отправляются и получаются через *очереди*. Очереди позволяют хранить сообщения, пока принимающее приложение сможет получить и обработать их.

![Очередь](./media/service-bus-messaging-overview/about-service-bus-queue.png)

Сообщения в очередях упорядочиваются и получают метку времени поступления. Принятое брокером сообщение всегда надежно сохраняется в хранилище с тройной избыточностью, распределенном между зонами доступности (если для пространства имен включена эта возможность). Служебная шина не сохраняет в памяти или временном хранилище сообщения, о приеме которых клиенту уже отправлено подтверждение.

Сообщения доставляются в режиме *запроса* (после получения запроса). В отличие от модели с опросом занятости, которая реализована в некоторых других облачных очередях, операция извлечения здесь может существовать долго, вплоть до появления доступного сообщения. 

### <a name="topics"></a>Разделы

Вы также можете использовать *разделы* для отправки и получения сообщений. Очереди часто используются для взаимодействия в режиме "точка — точка", но разделы позволяют реализовать сценарии публикации и подписки.

![Раздел](./media/service-bus-messaging-overview/about-service-bus-topic.png)

Разделы могут включать несколько независимых подписок, которые присоединяются к разделу, а в остальном для получателя полностью идентичны обычным очередям. Подписка на раздел может получать копию любого сообщения, отправленного в этот раздел. Подписки — это именованные сущности. По умолчанию подписки являются устойчивыми, но для них можно настроить истечение срока действия с автоматическим удалением. Служебная шина уровня "Премиум" также позволяет использовать API JMS для создания временных подписок, которые существуют только в течение одного подключения.

Вы можете определить правила для подписки. Правило подписки содержит *фильтр* для определения условия, по которому сообщение копируется в соответствующую подписку, и необязательное *действие*, которое может изменять метаданные сообщения. Дополнительные сведения см. в статье [Фильтры и действия разделов](topic-filters.md). Эта возможность удобна в следующих случаях:

- вы не хотите, чтобы подписка получала все сообщения, отправленные в раздел;
- вы хотите внедрять дополнительные метаданные в сообщения, проходящие через подписку.

## <a name="advanced-features"></a>Дополнительные функции

Служебная шина поддерживает дополнительные возможности для более сложных схем обмена сообщениями. В следующих разделах описаны некоторые из этих функций.

### <a name="message-sessions"></a>Сеансы обмена сообщениями

Чтобы реализовать надежный механизм FIFO в служебной шине, используйте сеансы. Сеансы сообщений обеспечивают эксклюзивную и упорядоченную обработку неограниченных последовательностей связанных сообщений. Чтобы поддерживать обработку сеансов в системах с высоким уровнем доступности и большим масштабом, функция сеансов позволяет сохранять состояние сеанса. Благодаря этому можно безопасно перемещать сеансы между обработчиками. Дополнительные сведения см. в статье [Сеансы сообщений и обработка в порядке очереди (FIFO)](message-sessions.md).

### <a name="autoforwarding"></a>Автоматическая переадресация

Функция автоматической переадресации привязывает очередь или подписку к другой очереди или разделу в пределах одного пространства имен. При использовании этой возможности Служебная шина автоматически перемещает сообщения из очереди или подписки в целевую очередь или раздел. Все такие перемещения выполняются транзакционно. Дополнительные сведения см. в статье [Объединение в цепочки сущностей служебной шины с помощью автоматической переадресации](service-bus-auto-forwarding.md).

### <a name="dead-letter-queue"></a>Очередь недоставленных сообщений

Каждая очередь Служебной шины и подписка раздела имеет связанную очередь недоставленных сообщений (DLQ). Очередь недоставленных сообщений содержит сообщения, удовлетворяющие следующим критериям: 

- их не удалось успешно доставить какому-либо получателю;
- для них истекло время ожидания;
- они явным образом отклонены принимающим приложением. 

Сообщения в очереди недоставленных сообщений помечаются с указанием причины размещения в ней. Очередь недоставленных сообщений имеет специальную конечную точку, а во всем остальном работает как обычная очередь. Любое приложение или средство может просматривать очередь недоставленных сообщений и выводить из нее сообщения. Также из нее можно настроить автоматическую пересылку сообщений. Дополнительные сведения см. в статье [Обзор очередей недоставленных сообщений служебной шины](service-bus-dead-letter-queues.md).

### <a name="scheduled-delivery"></a>Доставка по расписанию

Вы можете отправлять в очередь или раздел сообщения с отложенной обработкой, устанавливая для них время доступности для использования. Также запланированные сообщения можно отменить. Дополнительные сведения см. в разделе [Запланированные сообщения](message-sequencing.md#scheduled-messages).

### <a name="message-deferral"></a>Откладывание сообщений

Клиент очереди или подписки может отложить извлечение полученного сообщения. Например, если сообщение отправлено с нарушением очередности, а клиент перед его получением хочет дождаться другого сообщения. Отложенные сообщения остаются в очереди или подписке, пока не будут явным образом извлечены из нее по назначенному службой порядковому номеру. Дополнительные сведения см. в статье [Откладывание сообщений](message-deferral.md).

### <a name="batching"></a>Пакетная обработка

Пакетная обработка на стороне клиента позволяет клиенту очереди или раздела накапливать наборы сообщений и передавать их все сразу. Эта возможность часто применяется для снижения нагрузки на сеть или увеличения пропускной способности. Дополнительные сведения см. в разделе [Пакетная обработка на стороне клиента](service-bus-performance-improvements.md#client-side-batching).

### <a name="transactions"></a>Transactions

Транзакция объединяет две или несколько операций в *область выполнения*. Служебная шина позволяет группировать операции из нескольких сущностей обмена сообщениями в области одной транзакции. К таким сущностям сообщений может относиться очередь, тема или подписка. Дополнительные сведения см. в статье [Обзор обработки транзакций в служебной шине](service-bus-transactions.md).

### <a name="autodelete-on-idle"></a>Автоматическое удаление при простое

Автоматическое удаление при простое позволяет настроить интервал бездействия, по истечении которого подписка на очередь или раздел автоматически удаляется. Минимальная длительность составляет 5 минут. Дополнительные сведения см. в описании свойства [QueueDescription.AutoDeleteOnIdle](/dotnet/api/microsoft.servicebus.messaging.queuedescription.autodeleteonidle).

### <a name="duplicate-detection"></a>Обнаружение дубликатов
Функция обнаружения дубликатов позволяет отправителю отправлять одно и то же сообщение несколько раз, при этом брокер будет удалять потенциальные дубликаты. Обнаружение дубликатов выполняется путем отслеживания свойства `message-id` в сообщениях. Это значит, что приложению придется следить за тем, чтобы при повторной отправке сообщения это свойство сохраняло свое значение, например вычисляя его на основе некоторого контекста в конкретном приложении. Дополнительные сведения см. в разделе [Синхронизация удостоверений и устойчивость обнаружения](duplicate-detection.md).

### <a name="geo-disaster-recovery"></a>Геоизбыточное аварийное восстановление

При аварии целого региона Azure аварийное восстановление позволяет продолжить обработку данных, переключив ее на другой регион или центр обработки данных. Эта возможность обеспечивает доступность структурной зеркальной копии пространства имен в дополнительном регионе и позволяет удостоверению пространства имен переключиться на дополнительное пространство имен. Уже отправленные сообщения сохраняются в прежнем основном пространстве имен и могут быть восстановлены,когда будет устранена проблема с доступностью. Дополнительные сведения см. в разделе [Географическое аварийное восстановление в служебной шине Azure](service-bus-geo-dr.md).

### <a name="security"></a>безопасность

Служебная шина поддерживает стандартные протоколы [AMQP 1.0](service-bus-amqp-overview.md) и [HTTP/REST](/rest/api/servicebus/) и используемые в них средства безопасности, включая TLS. Клиентам можно предоставлять права доступа с помощью [подписанного URL-адреса](service-bus-sas.md) или безопасности на основе ролей [Azure Active Directory](service-bus-authentication-and-authorization.md). 

Для защиты от нежелательного трафика Служебная шина предоставляет такие [функции безопасности](network-security.md), как IP-брандмауэр и интеграция с виртуальными сетями. 

## <a name="client-libraries"></a>Клиентские библиотеки

Полностью поддерживаемые клиентские библиотеки Служебной шины включены в пакет Azure SDK.

- [Служебная шина Azure для .NET](/dotnet/api/overview/azure/service-bus?preserve-view=true)
- [Библиотеки Служебной шины Azure для Java](/java/api/overview/azure/servicebus?preserve-view=true)
- [Поставщик Служебной шины Azure для Java JMS 2.0](how-to-use-java-message-service-20.md)
- [Модули Служебной шины Azure для JavaScript и TypeScript](/javascript/api/overview/azure/service-bus?preserve-view=true)
- [Библиотеки Служебной шины для Python](/python/api/overview/azure/servicebus?preserve-view=true)

Основным протоколом Служебной шины Azure является [AMQP 1.0](service-bus-amqp-overview.md), с которым можно работать из любого совместимого клиента. Некоторые клиенты AMQP с открытым кодом включают примеры, явным образом демонстрирующие взаимодействие со Служебной шиной. Ознакомьтесь с [руководством по протоколу AMQP 1.0](service-bus-amqp-protocol-guide.md), чтобы освоить прямое использование функций Служебной шины через клиенты AMQP 1.0.

[!INCLUDE [messaging-oss-amqp-stacks.md](../../includes/messaging-oss-amqp-stacks.md)]

## <a name="integration"></a>Интеграция

Служебная шина полностью интегрируется со многими службами Microsoft и Azure, например со следующими:

* [Сетка событий](https://azure.microsoft.com/services/event-grid/)
* [Logic Apps](https://azure.microsoft.com/services/logic-apps/)
* [Функции Azure](https://azure.microsoft.com/services/functions/)
* [Power Platform](https://powerplatform.microsoft.com/)
* [Dynamics 365](https://dynamics.microsoft.com)
* [Azure Stream Analytics](https://azure.microsoft.com/services/stream-analytics/)

## <a name="next-steps"></a>Дальнейшие действия

Сведения о начале работы с обменом сообщениями через служебную шину см. в следующих статьях:

* Сравнение служб обмена сообщениями Azure см. [здесь](../event-grid/compare-messaging-services.md?toc=%2fazure%2fservice-bus-messaging%2ftoc.json&bc=%2fazure%2fservice-bus-messaging%2fbreadcrumb%2ftoc.json).
* Кроме того, вы можете изучить краткие руководства для [.NET](service-bus-dotnet-get-started-with-queues.md), [Java](service-bus-java-how-to-use-queues.md) или [JMS](service-bus-java-how-to-use-jms-api-amqp.md).
* Сведения об управлении ресурсами служебной шины см. [здесь](https://github.com/paolosalvatori/ServiceBusExplorer/releases).
* Сведения о служебной шине Azure категории "Стандартный" и "Премиум" и цены на нее см. на [этой странице](https://azure.microsoft.com/pricing/details/service-bus/).
* Дополнительные сведения о производительности и задержках на уровне "Премиум" см. в [этой записи блога](https://techcommunity.microsoft.com/t5/Service-Bus-blog/Premium-Messaging-How-fast-is-it/ba-p/370722).