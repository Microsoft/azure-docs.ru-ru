---
title: Сетевая безопасность для служебной шины Azure
description: В этой статье описываются такие функции безопасности сети, как теги служб, правила брандмауэра IP-адресов, конечные точки служб и частные конечные точки.
ms.topic: conceptual
ms.date: 06/23/2020
ms.openlocfilehash: db0dd89d1f902699c27b724609505ba681757454
ms.sourcegitcommit: 910a1a38711966cb171050db245fc3b22abc8c5f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "92310466"
---
# <a name="network-security-for-azure-service-bus"></a>Сетевая безопасность для служебной шины Azure 
В этой статье описывается, как использовать следующие функции безопасности в служебной шине Azure. 

- Теги служб
- Правила брандмауэра IP-адресов
- Конечные точки сетевой службы
- Частные конечные точки


## <a name="service-tags"></a>Теги служб
Тег службы представляет группу префиксов IP-адресов из определенной службы Azure. Корпорация Майкрософт управляет префиксами адресов, входящих в тег службы, и автоматически обновляет этот тег при изменении адресов, сводя к минимуму сложность частых обновлений правил сетевой безопасности. Дополнительные сведения о тегах служб см. в статье [Общие сведения о тегах служб](../virtual-network/service-tags-overview.md).

Теги службы можно использовать для определения элементов управления доступом к сети для [групп безопасности сети](../virtual-network/network-security-groups-overview.md#security-rules) или [брандмауэра Azure](../firewall/service-tags.md). Теги служб можно использовать вместо определенных IP-адресов при создании правил безопасности. Указав имя тега службы (например, **servicebus**) в соответствующем поле *источника* или *назначения* правила, можно разрешить или запретить трафик для соответствующей службы.

| Тег службы | Назначение | Может ли использовать входящий или исходящий трафик? | Может быть региональным? | Можно ли использовать с Брандмауэром Azure? |
| --- | -------- |:---:|:---:|:---:|:---:|:---:|:---:|:---:|
| **Служебная шина** | Трафик служебной шины Azure, использующий уровень служб "Премиум". | Исходящие | Да | Да |


> [!NOTE]
> Теги службы можно использовать только для пространств имен уровня " **премиум** ". Если используется **стандартное** пространство имен, используйте IP-адрес, отображаемый при выполнении следующей команды: `nslookup <host name for the namespace>` . Например, `nslookup contosons.servicebus.windows.net`. 

## <a name="ip-firewall"></a>Брандмауэр IP-адресов 
По умолчанию пространства имен Служебной шины доступны из Интернета при условии, что запрос поступает с действительной аутентификацией и авторизацией. С помощью IP-брандмауэра такой доступ можно дополнительно ограничить набором или диапазоном IPv4-адресов, введя их в нотации [CIDR](https://en.wikipedia.org/wiki/Classless_Inter-Domain_Routing).

Эта возможность полезна в сценариях, в которых Служебная шина Azure должна быть доступна только с определенных хорошо известных сайтов. Правила брандмауэра позволяют настроить правила приема трафика, поступающего с определенных IPv4-адресов. Например, при использовании служебной шины с [Express Route] [Экспресс-Route] можно создать **правило брандмауэра** , разрешающее трафик только от локальных IP-адресов инфраструктуры или адресов корпоративного шлюза NAT. 

Правила брандмауэра для IP-адресов применяются на уровне пространства имен Служебной шины. Поэтому они действуют для всех клиентских подключений по любым поддерживаемым протоколам. Любые попытки подключения с IP-адресов, которые не соответствуют правилу разрешенных IP-адресов для пространства имен Служебной шины, отклоняются. В ответе клиенту правило фильтрации IP-адресов не упоминается. Правила фильтрации IP-адресов применяются по порядку, поэтому первое правило, которое соответствует IP-адресу, определяет действие (принять или отклонить).

Дополнительные сведения см. [в разделе Настройка брандмауэра IP для пространства имен служебной шины](service-bus-ip-filtering.md) .

## <a name="network-service-endpoints"></a>Конечные точки сетевой службы
Интеграция служебной шины с [конечными точками службы виртуальной сети](service-bus-service-endpoints.md) обеспечивает безопасный доступ к возможностям обмена сообщениями из рабочих нагрузок, таких как виртуальные машины, привязанные к виртуальным сетям, с использованием пути сетевого трафика, защищенного на обоих концах.

Если настроена привязка по крайней мере к одной конечной точке службы подсети виртуальной сети, пространство имен соответствующей Служебной шины принимает трафик только из авторизованных виртуальных сетей. С точки зрения виртуальной сети привязка пространства имен Служебной шины к конечной точке службы настраивает изолированный сетевой туннель от подсети виртуальной сети к службе обмена сообщениями.

Результатом является частная и изолированная взаимосвязь между рабочими нагрузками, связанными с подсетью, и соответствующим пространством имен Служебной шины, несмотря на то что наблюдаемый сетевой адрес конечной точки службы обмена сообщениями находится в общедоступном диапазоне IP-адресов.

> [!IMPORTANT]
> Виртуальные сети поддерживаются только в пространствах имен службы "Служебная шина" [ценовой категории "Премиум"](service-bus-premium-messaging.md).
> 
> При использовании конечных точек службы виртуальной сети с служебной шиной не следует включать эти конечные точки в приложениях, которые используют пространства имен Standard и Premium уровня "Премиум". Так как уровень Standard не поддерживает виртуальных сетей. Конечная точка ограничена только пространствами имен уровня "Премиум".

### <a name="advanced-security-scenarios-enabled-by-vnet-integration"></a>Расширенные сценарии обеспечения безопасности, доступные при интеграции с виртуальной сетью 

Решения, требующие жесткой и раздельной защиты, где подсети виртуальной сети обеспечивают сегментирование между разделенными службами, обычно все же нуждаются в путях взаимодействия между службами, находящимися в этих секциях.

Любой прямой IP-маршрут между секциями, включая передачу трафика HTTPS через TCP/IP, несет риск использования уязвимостей на сетевом уровне. Службы обмена сообщениями обеспечивают полностью изолированные пути взаимодействия, где сообщения даже записываются на диск при передаче между сторонами. Рабочие нагрузки в двух разных виртуальных сетях, которые связаны с одним и тем же экземпляром Служебной шины, могут эффективно и надежно связываться с использованием сообщений, в то время как целостность границ изолированной сети сохраняется.
 
Это означает, что ваши конфиденциальные облачные решения, влияющие на безопасность, не только получают доступ к ведущим в отрасли надежным, масштабируемым и асинхронным службам обмена сообщениями Azure, но теперь могут использовать обмен сообщениями, чтобы создавать пути передачи данных между защищенными секциями решений. По своей сути такие пути обеспечивают больше безопасности, чем при любом режиме одноранговой связи, включая HTTPS и другие протоколы сокетов TLS.

### <a name="bind-service-bus-to-virtual-networks"></a>Привязка служебной шины к виртуальным сетям

*Правила виртуальной сети* — это функция безопасности брандмауэра, которая позволяет контролировать, принимает ли сервер Служебной шины Azure соединения из определенной подсети виртуальной сети.

Привязка пространства имен Служебной шины к виртуальной сети состоит из двух этапов. Сначала необходимо создать **конечную точку службы виртуальной** сети в подсети виртуальной сети и включить ее для **Microsoft. servicebus** , как описано в [обзоре конечной точки службы](service-bus-service-endpoints.md). Добавив конечную точку службы, вы привязываете к ней пространство имен Служебной шины с помощью **правила виртуальной сети**.

Правило виртуальной сети — это связь пространства имен Служебной шины с подсетью виртуальной сети. Пока правило существует, всем рабочим нагрузкам, привязанным к подсети, предоставляется доступ к пространству имен Служебной шины. Служебная шина никогда не устанавливает исходящие подключения и не нуждается в доступе, и поэтому это правило не предоставляет ей доступ к вашей подсети.

Дополнительные сведения см. [в статье Настройка конечных точек службы виртуальной сети для пространства имен служебной шины](service-bus-service-endpoints.md) .

## <a name="private-endpoints"></a>Частные конечные точки

Приватный канал Azure обеспечивает доступ к службам Azure (например, к Служебной шине Azure, службе хранилища Azure и Azure Cosmos DB), а также размещенным в Azure службам клиентов или партнеров через **частную конечную точку** в виртуальной сети.

Частная конечная точка — это сетевой интерфейс, который защищенно и надежно подключается к службе через Приватный канал Azure. Частная конечная точка использует частный IP-адрес из виртуальной сети, по сути перемещая службу в виртуальную сеть. Весь трафик к службе может маршрутизироваться через частную конечную точку, поэтому шлюзы, устройства преобразования сетевых адресов (NAT), подключения ExpressRoute и VPN, а также общедоступные IP-адреса не требуются. Трафик между виртуальной сетью и службой проходит через магистральную сеть Майкрософт, что позволяет избежать рисков общедоступного Интернета. Вы можете подключиться к экземпляру ресурса Azure, обеспечивая наивысшую степень детализации в управлении доступом.

Дополнительные сведения см. в статье [Что такое Приватный канал Azure](../private-link/private-link-overview.md).

> [!NOTE]
> Эта функция поддерживается для Служебной шины Azure категории **Премиум**. Дополнительные сведения о категории "Премиум" см. в статье [Категории обмена сообщениями через служебную шину "Премиум" и "Стандартный"](service-bus-premium-messaging.md).


Дополнительные сведения см. [в разделе Настройка частных конечных точек для пространства имен служебной шины](private-link-service.md) .


## <a name="next-steps"></a>Дальнейшие действия
См. следующие статьи:

- [Настройка брандмауэра IP для пространства имен служебной шины](service-bus-ip-filtering.md)
- [Настройка конечных точек службы виртуальной сети для пространства имен служебной шины](service-bus-service-endpoints.md)
- [Настройка частных конечных точек для пространства имен служебной шины](private-link-service.md)