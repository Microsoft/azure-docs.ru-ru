---
title: Журналы диагностики служебной шины Azure | Документация Майкрософт
description: В этой статье представлен обзор всех журналов операционных и диагностических операций, доступных для служебной шины Azure.
ms.topic: article
ms.date: 06/23/2020
ms.openlocfilehash: f2672d61285025eadb8f742ca2518297107595ce
ms.sourcegitcommit: 910a1a38711966cb171050db245fc3b22abc8c5f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "100585261"
---
# <a name="enable-diagnostics-logs-for-service-bus"></a>Включение журналов диагностики для служебной шины

Когда вы начинаете использовать пространство имен служебной шины Azure, может потребоваться отслеживать, как и когда пространство имен создается, удаляется или к которому осуществляется доступ. В этой статье приводятся общие сведения обо всех доступных журналах операционной и диагностики.

В настоящее время служебная шина Azure поддерживает журналы действий и операционных журналов, которые фиксируют *операции управления* , выполняемые в пространстве имен служебной шины Azure. В частности, в эти журналы записывается тип операции, включая создание очереди, используемые ресурсы и состояние операции.

## <a name="operational-logs-schema"></a>Схема операционных журналов

Все журналы хранятся в формате нотация объектов JavaScript (JSON) в следующих двух расположениях:

- **AzureActivity**. отображает журналы операций и действий, выполняемых для пространства имен в портал Azure или с помощью развертываний шаблонов Azure Resource Manager.
- **AzureDiagnostics**. отображает журналы операций и действий, выполняемых в пространстве имен, с помощью API или клиентов управления на языке SDK.

Строки JSON журнала операций включают в себя элементы, перечисленные в следующей таблице:

| Имя | Описание |
| ------- | ------- |
| ActivityId | Внутренний идентификатор, используемый для идентификации указанного действия |
| EventName | Имя операции |
| ResourceId | Идентификатор ресурса Azure Resource Manager |
| SubscriptionId | Идентификатор подписки |
| EventTimeString | Время операции |
| EventProperties | Свойства операции |
| Состояние | Состояние операции |
| Caller | Вызывающий объект операции (портал Azure или клиент управления) |
| Категория | OperationalLogs |

Ниже приведен пример строки JSON операционного журнала.

```json
{
  "ActivityId": "6aa994ac-b56e-4292-8448-0767a5657cc7",
  "EventName": "Create Queue",
  "resourceId": "/SUBSCRIPTIONS/1A2109E3-9DA0-455B-B937-E35E36C1163C/RESOURCEGROUPS/DEFAULT-SERVICEBUS-CENTRALUS/PROVIDERS/MICROSOFT.SERVICEBUS/NAMESPACES/SHOEBOXEHNS-CY4001",
  "SubscriptionId": "1a2109e3-9da0-455b-b937-e35e36c1163c",
  "EventTimeString": "9/28/2016 8:40:06 PM +00:00",
  "EventProperties": "{\"SubscriptionId\":\"1a2109e3-9da0-455b-b937-e35e36c1163c\",\"Namespace\":\"shoeboxehns-cy4001\",\"Via\":\"https://shoeboxehns-cy4001.servicebus.windows.net/f8096791adb448579ee83d30e006a13e/?api-version=2016-07\",\"TrackingId\":\"5ee74c9e-72b5-4e98-97c4-08a62e56e221_G1\"}",
  "Status": "Succeeded",
  "Caller": "ServiceBus Client",
  "category": "OperationalLogs"
}
```

## <a name="events-and-operations-captured-in-operational-logs"></a>События и операции, захваченные в операционных журналах

Операционные журналы записывают все операции управления, которые выполняются в пространстве имен служебной шины Azure. Операции с данными не фиксируются из-за большого объема операций с данными, проводимых в служебной шине Azure.

> [!NOTE]
> Чтобы помочь вам лучше отслеживать операции с данными, рекомендуется использовать трассировку на стороне клиента.

Следующие операции управления фиксируются в операционных журналах: 

| Область | Операция|
|-------| -------- |
| Пространство имен | <ul> <li> Создание пространства имен</li> <li> Обновить пространство имен </li> <li> Удалить пространство имен </li> <li> Обновление политики SharedAccess пространства имен </li> </ul> | 
| Очередь | <ul> <li> Создать очередь</li> <li> Обновление очереди</li> <li> Удаление очереди. </li> <li> Удалить очередь удаления </li> </ul> | 
| Раздел | <ul> <li> Создание раздела </li> <li> Обновление раздела </li> <li> Удалить раздел </li> <li> Автоудаление раздела удаления </li> </ul> |
| Подписка | <ul> <li> Создавать подписку </li> <li> Обновлять подписку </li> <li> Удалять подписку </li> <li> Удалить подписку с автоудалением </li> </ul> |

> [!NOTE]
> В настоящее время операции *чтения* не регистрируются в операционных журналах.

## <a name="enable-operational-logs"></a>Включить Операционные журналы

Операционные журналы по умолчанию отключены. Чтобы включить журналы диагностики, выполните следующие действия.

1. В [портал Azure](https://portal.azure.com)перейдите к пространству имен служебной шины Azure, а затем в разделе **мониторинг** выберите  **параметры диагностики**.

   ![Ссылка "параметры диагностики"](./media/service-bus-diagnostic-logs/image1.png)

1. В области **параметры диагностики** выберите **Добавить параметр диагностики**.  

   ![Ссылка "добавить параметр диагностики"](./media/service-bus-diagnostic-logs/image2.png)

1. Настройте параметры диагностики, выполнив следующие действия.

   а. В поле **имя** введите имя для параметров диагностики.  

   b. Выберите одно из следующих трех назначений для журналов диагностики:  
   - При выборе **архива в учетной записи хранения** необходимо настроить учетную запись хранения, в которой будут храниться журналы диагностики.  
   - Если выбрать **поток в концентраторе событий**, необходимо настроить концентратор событий, в который нужно передать журналы диагностики.
   - При выборе **Send to log Analytics** необходимо указать, какой экземпляр log Analytics будет отправляться диагностика.  

   c. Установите флажок **OperationalLogs** .

    ![Панель "параметры диагностики"](./media/service-bus-diagnostic-logs/image3.png)

1. Щелкните **Сохранить**.

Новые параметры вступят в силу примерно через 10 минут. Журналы отображаются в настроенном целевом объекте архивации в области **журналы диагностики** .

Дополнительные сведения о настройке параметров диагностики см. в [обзоре журналов системы диагностики Azure](../azure-monitor/essentials/platform-logs-overview.md).

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения о служебной шине см. в следующих статьях:

* [Основные сведения о служебной шине](service-bus-messaging-overview.md)
* [Приступая к работе со служебной шиной](service-bus-dotnet-get-started-with-queues.md)