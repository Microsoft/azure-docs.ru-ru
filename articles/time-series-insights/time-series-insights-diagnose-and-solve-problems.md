---
title: Диагностика, устранение неполадок и устранение неполадок — служба "аналитика временных рядов Azure"
description: В этой статье описывается диагностика, устранение неполадок и решение распространенных проблем в среде службы "аналитика временных рядов Azure".
ms.service: time-series-insights
services: time-series-insights
author: deepakpalled
ms.author: dpalled
manager: diviso
ms.reviewer: v-mamcge
ms.workload: big-data
ms.topic: troubleshooting
ms.date: 09/29/2020
ms.custom: seodec18
ms.openlocfilehash: 15f2ff5aaa1d731c13125d0a3ab4ac32acb9276c
ms.sourcegitcommit: 867cb1b7a1f3a1f0b427282c648d411d0ca4f81f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "95023281"
---
# <a name="diagnose-and-solve-issues-in-your-azure-time-series-insights-gen1-environment"></a>Диагностика и устранение проблем в среде Gen1 "аналитика временных рядов Azure"

> [!CAUTION]
> Эта статья посвящена службе "Аналитика временных рядов Azure" 1-го поколения.

В этой статье описываются проблемы, которые могут возникнуть в среде службы "аналитика временных рядов Azure". В статье перечислены возможные причины проблем и способы их устранения.

## <a name="video"></a>Видео

### <a name="learn-about-common-azure-time-series-insights-challenges-and-mitigationsbr"></a>Узнайте о распространенных проблемах и решениях службы "аналитика временных рядов Azure"</br>

> [!VIDEO https://www.youtube.com/embed/7U0SwxAVSKw]

## <a name="problem-no-data-is-shown"></a>Проблема. данные не отображаются

Если в обозревателе службы " [аналитика временных рядов Azure](https://insights.timeseries.azure.com)" не отображаются данные, следует рассмотреть следующие распространенные причины.

### <a name="cause-a-event-source-data-isnt-in-json-format"></a>Причина: данные источника события не находятся в формате JSON

Среда службы "Аналитика временных рядов Azure" поддерживает только данные в формате JSON. Примеры JSON см. в разделе [Поддерживаемые формы JSON](./concepts-json-flattening-escaping-rules.md).

### <a name="cause-b-the-event-source-key-is-missing-a-required-permission"></a>Причина б. у ключа источника события отсутствует требуемое разрешение

* Для центра Интернета вещей в центре Интернета вещей Azure необходимо указать ключ, имеющий разрешения на подключение к службе. Выберите **iothubowner** или политику **службы** . Оба имеют разрешения на подключение к службе.

   [![Разрешение на подключение службы Центра Интернета вещей](media/diagnose-and-solve-problems/iothub-serviceconnect-permissions.png)](media/diagnose-and-solve-problems/iothub-serviceconnect-permissions.png#lightbox)

* Для концентратора событий в концентраторах событий Azure необходимо указать ключ, имеющий разрешения на прослушивание. Политики **чтения** и **управления** будут работать, так как они оба имеют разрешения на прослушивание.

   [![Разрешение на прослушивание для концентратора событий](media/diagnose-and-solve-problems/eventhub-listen-permissions.png)](media/diagnose-and-solve-problems/eventhub-listen-permissions.png#lightbox)

### <a name="cause-c-the-provided-consumer-group-isnt-exclusive-to-azure-time-series-insights"></a>Причина C. Указанная группа потребителей не является монопольной для службы "аналитика временных рядов Azure"

При регистрации Центра Интернета вещей или концентратора событий важно задать группу потребителей, которая будет использоваться для чтения данных. Эта группа потребителей *не может использоваться совместно*. В противном случае базовый центр Интернета вещей или концентратор событий автоматически отключит один из модулей чтения в случайном порядке. Укажите уникальную группу потребителей, из которой служба "аналитика временных рядов Azure" должна читать данные.

### <a name="cause-d-the-environment-has-just-been-provisioned"></a>Причина D: только что подготовлено окружение

Данные будут отображаться в обозревателе службы "аналитика временных рядов Azure" через несколько минут после создания среды и ее данных.

## <a name="problem-some-data-is-shown-but-data-is-missing"></a>Проблема. отображаются некоторые данные, но отсутствуют данные

Если данные появляются только частично и кажется, что данные задержкой, следует учесть эти возможные проблемы.

### <a name="cause-a-your-environment-is-being-throttled"></a>Причина: ваша среда регулируется

[Регулирование](time-series-insights-environment-mitigate-latency.md) является распространенной проблемой при подготовке сред после создания источника событий, который содержит данные. Центр Интернета вещей Azure и концентраторы событий Azure хранят данные до семи дней. Служба "аналитика временных рядов Azure" всегда начинается с самого раннего события в источнике событий («первым поступил», «первым вышел» или « *FIFO*»).

Например, если у вас есть 5 000 000 событий в источнике событий при подключении к среде "аналитика временных рядов Azure" S1, Azure Time Series Insights считывает приблизительно 1 000 000 событий в день. Может показаться, что служба "аналитика временных рядов Azure" испытывает пять дней задержки. Но что происходит в том, что среда регулируется.

Если у вас есть старые события в источнике событий, можно использовать один из двух способов, описанных ниже.

* Измените ограничения на хранение источника событий, чтобы удалить старые события, которые не нужно отображать в службе "аналитика временных рядов Azure".
* Подготовьте среду большего размера (с большим количеством единиц), чтобы увеличить пропускную способность старых событий. В предыдущем примере, если вы увеличиваете ту же среду S1 до пяти единиц в течение одного дня, среда должна находиться в течение дня. Если событие стабильного состояния составляет 1 000 000 или меньше событий в день, можно уменьшить емкость события в одну единицу после того, как служба "аналитика временных рядов Azure" будет перехватываться.

Принудительное ограничение регулирования основано на типе и емкости SKU среды. Все источники событий в среде совместно используют емкость. Если источник событий для центра Интернета вещей или концентратора событий отправляет данные сверх установленных ограничений, вы будете регулировать регулирование и задержку.

На следующем рисунке показана среда службы "аналитика временных рядов Azure" с номером SKU S1 и емкостью 3. Она может принимать 3 миллиона событий в день.

[![Емкость среды](media/diagnose-and-solve-problems/environment-sku-current-capacity.png)](media/diagnose-and-solve-problems/environment-sku-current-capacity.png#lightbox)

Представьте себе среду, принимающую сообщения из концентратора событий. Он имеет дневную частоту входящих сообщений о 67 000 сообщениях. Такая скорость соответствует примерно 46 сообщениям каждую минуту.

* Если каждое сообщение концентратора событий сведено к одному событию аналитики временных рядов Azure, регулирование не происходит.
* Если каждое сообщение концентратора событий сведено в 100 событий "аналитика временных рядов Azure", события 4 600 следует принимать каждую минуту.

Среда с номером SKU S1 и емкостью 3 может принимать только 2100 событий в минуту (1 миллион событий в день = 700 событий в минуту на 3 единицы = 2100 событий в минуту).

Чтобы получить общее представление о принципах работы логики обработки, см. раздел [поддерживаемые фигуры JSON](./concepts-json-flattening-escaping-rules.md).

#### <a name="recommended-resolutions-for-excessive-throttling"></a>Рекомендуемые действия по устранению проблемы чрезмерного регулирования

Чтобы устранить задержку, увеличьте емкость номера SKU среды. Дополнительные сведения см. [в статье масштабирование среды службы "аналитика временных рядов Azure](time-series-insights-how-to-scale-your-environment.md)".

### <a name="cause-b-initial-ingestion-of-historical-data-slows-ingress"></a>Причина б. при первом приеме исторических данных происходит медленный входящий трафик

При подключении существующего источника событий вполне вероятно, что центр Интернета вещей или концентратор событий уже содержит данные. Среда начинает извлекать данные, как только сообщения источника событий начинают сохраняться. Эта обработка по умолчанию не может быть переопределена. Вы можете включить регулирование. Регулирование может занять некоторое время, пока будет отслеживаться прием хронологических данных.

#### <a name="recommended-resolutions-for-large-initial-ingestion"></a>Рекомендуемые решения для большого начального объема принимаемых данных

Устранение задержки.

1. Увеличьте емкость номера SKU до максимально допустимого значения (в этом случае — 10). После увеличения емкости принимаемые данные начнут обрабатываться значительно быстрее. Плата будет оплачена за счет увеличения емкости. Чтобы визуализировать, насколько быстро выполняется перехват, можно просмотреть диаграмму доступности в обозревателе службы " [аналитика временных рядов Azure](https://insights.timeseries.azure.com)".

2. Устранив задержку, уменьшите емкость номера SKU до обычного уровня приема.

## <a name="problem-data-was-showing-previously-but-is-no-longer-showing"></a>Проблема. данные были показаны ранее, но больше не отображаются

Если служба "аналитика временных рядов Azure" больше не принимает данные, но события по-прежнему передаются в центр Интернета вещей или концентратор событий, рассмотрим эту потенциальную причину.

### <a name="cause-a-your-hub-access-key-was-regenerated-and-your-environment-needs-to-be-updated"></a>Причина: ключ доступа к концентратору был создан повторно, и необходимо обновить среду.

Эта проблема возникает, когда ключ, указанный при создании источника события, больше не является допустимым. Вы увидите данные телеметрии в концентраторе, но не получили входящие сообщения в службе "аналитика временных рядов Azure". Если нет уверенности в том, что ключ был создан повторно, можно выполнить поиск в журнале действий для "Создание или обновление правил авторизации пространства имен". В центре Интернета вещей выполните поиск по запросу "Создание или обновление ресурса IotHub".

Чтобы обновить среду службы "аналитика временных рядов Azure" с помощью нового ключа, откройте ресурс-концентратор в портал Azure и скопируйте новый ключ. Перейдите к ресурсу "аналитика временных рядов Azure" и выберите **источники событий**:

   [![Выбор источников событий](media/diagnose-and-solve-problems/update-hub-key-step-1.png)](media/diagnose-and-solve-problems/update-hub-key-step-1.png#lightbox)

Выберите источник или источники событий, из которых остановлен прием, вставьте новый ключ и нажмите кнопку **сохранить**:

   [![Вставить новый ключ](media/diagnose-and-solve-problems/update-hub-key-step-2.png)](media/diagnose-and-solve-problems/update-hub-key-step-2.png#lightbox)

## <a name="problem-the-event-sources-timestamp-property-name-setting-doesnt-work"></a>Проблема. параметр имени свойства метки времени источника событий не работает

Убедитесь, что значение свойства timestamp, которое берется из источника события в виде строки JSON, имеет формат _гггг-мм-ddTHH: mm: SS. FFFFFFFK_. Вот пример: **2008-04-12T12:53Z**.

Помните, что в имени свойства метки времени учитывается регистр.

Самый простой способ убедиться, что имя свойства метки времени захвачено и работает правильно, — использовать обозреватель службы "аналитика временных рядов Azure". В обозревателе службы "аналитика временных рядов Azure" на диаграмме выберите период времени после введения имени свойства метки времени. Щелкните выделенный фрагмент правой кнопкой мыши и выберите пункт **Просмотр событий**.

Заголовок первого столбца — это имя вашего свойства метки времени. Рядом с словом **timestamp** **($TS)** будет отображаться.

Следующие значения не будут отображаться:

* *(ABC)*: указывает, что служба "аналитика временных рядов Azure" считывает значения данных в виде строк.
* *Значок календаря*: указывает, что служба "аналитика временных рядов Azure" считывает значения данных в виде значений DateTime.
* *#*: Указывает, что служба "аналитика временных рядов Azure" считывает значения данных как целые числа.

## <a name="next-steps"></a>Дальнейшие действия

* Узнайте [, как устранить задержку в службе "аналитика временных рядов Azure](time-series-insights-environment-mitigate-latency.md)".

* Узнайте [, как масштабировать среду службы "аналитика временных рядов Azure](time-series-insights-how-to-scale-your-environment.md)".