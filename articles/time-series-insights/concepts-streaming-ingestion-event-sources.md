---
title: Источники событий приема потоковой передачи — Gen2 службы "аналитика временных рядов Azure" | Документация Майкрософт
description: Сведения о потоковой передаче данных в Gen2 службы "аналитика временных рядов Azure".
author: lyrana
ms.author: lyhughes
manager: deepakpalled
ms.workload: big-data
ms.service: time-series-insights
services: time-series-insights
ms.topic: conceptual
ms.date: 10/01/2020
ms.openlocfilehash: ee13b2fbe4abbaf9bddf4975f8e25d746dc78f5e
ms.sourcegitcommit: c7153bb48ce003a158e83a1174e1ee7e4b1a5461
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/15/2021
ms.locfileid: "98232188"
---
# <a name="azure-time-series-insights-gen2-event-sources"></a>Источники событий Gen2 для службы "аналитика временных рядов Azure"

 Среда Gen2 "аналитика временных рядов Azure" может иметь до двух потоковых источников событий. В качестве входных данных поддерживаются два типа ресурсов Azure:

- [Центр Интернета вещей Azure](../iot-hub/about-iot-hub.md)
- [Центры событий Azure](../event-hubs/event-hubs-about.md)

События должны отправляться в формате JSON в кодировке UTF-8.

## <a name="create-or-edit-event-sources"></a>Создание или изменение источников событий

Ресурсы источника событий могут находиться в той же подписке Azure, что и среда Gen2 для аналитики временных рядов Azure, или другую подписку. Для создания, изменения и удаления источников событий среды можно использовать [портал Azure](./tutorials-set-up-tsi-environment.md#create-an-azure-time-series-insights-gen2-environment), [Azure CLI](https://github.com/Azure/azure-cli-extensions/tree/master/src/timeseriesinsights), [шаблоны ARM](time-series-insights-manage-resources-using-azure-resource-manager-template.md)и [REST API](/rest/api/time-series-insights/management(gen1/gen2)/eventsources) .

При подключении источника событий среда Gen2 "аналитика временных рядов Azure" будет считывать все события, которые в настоящее время хранятся в вашем центре Интернета вещей или концентраторе событий, начиная с самого раннего события.

> [!IMPORTANT]
>
> - При присоединении источника событий к среде Gen2 "аналитика временных рядов Azure" может возникнуть высокая первоначальная задержка.
> - Задержка источника событий зависит от числа событий, находящихся в данный момент в Центре Интернета вещей или Центре событий.
> - Высокая задержка сократится после первого приема данных источника событий. Если уровень задержки не снижается, отправьте запрос в службу поддержки на портале Azure.

## <a name="streaming-ingestion-best-practices"></a>Рекомендации по приему потоковой передачи

- Всегда создавайте уникальную группу потребителей для среды Gen2 "аналитика временных рядов Azure", чтобы использовать данные из источника событий. Повторное использование групп потребителей может вызвать случайное отключение и привести к потере данных.

- Настройте среду Gen2 "аналитика временных рядов Azure", а также центр Интернета вещей и/или концентраторы событий в одном регионе Azure. Хотя источник событий можно настроить в отдельном регионе, этот сценарий не поддерживается, и мы не можем гарантировать высокий уровень доступности.

- Не выйдите за [пределы пропускной способности](./concepts-streaming-ingress-throughput-limits.md) вашей среды или ограничения на количество секций.

- Настройте [оповещение](./time-series-insights-environment-mitigate-latency.md#monitor-latency-and-throttling-with-alerts) о задержке, чтобы получать уведомления, если в среде возникают проблемы при обработке данных. Предлагаемые условия оповещения см. в разделе [рабочие нагрузки](./concepts-streaming-ingestion-event-sources.md#production-workloads) ниже. 

- Используйте потоковый прием только для последних данных и данных практически в реальном времени. Потоковая передача исторических данных не поддерживается.

- Сведения о том, как свойства будут экранированы, а данные JSON были [сведены и сохранены.](./concepts-json-flattening-escaping-rules.md)

- При предоставлении строк соединения с источниками событий следуйте принципу минимальных привилегий. Для концентраторов событий настройте политику общего доступа только с утверждением на *отправку* и для центра Интернета вещей используйте только разрешение на *Подключение к службе* .

## <a name="production-workloads"></a>Производственные рабочие нагрузки

В дополнение к рекомендациям, приведенным выше, мы рекомендуем реализовать следующие решения для критически важных рабочих нагрузок. 

- Увеличьте срок хранения данных центра Интернета вещей или концентратора событий до 7 дней.

- Создание предупреждений среды в портал Azure. Оповещения, основанные на [метриках](https://docs.microsoft.com/azure/time-series-insights/how-to-monitor-tsi-reference#metrics) платформы, позволяют проверять сквозное поведение конвейера. [Ниже](https://docs.microsoft.com/azure/time-series-insights/time-series-insights-environment-mitigate-latency#monitor-latency-and-throttling-with-alerts)приведены инструкции по созданию оповещений и управлению ими. Предлагаемые условия оповещения:

     - Ингрессрецеиведмессажестимелаг больше 5 минут
     - Ингрессрецеиведбитес 0
- Обеспечьте балансировку нагрузки приема между центром Интернета вещей или разделами концентратора событий.

### <a name="historical-data-ingestion"></a>Прием данных за прошедшие периоды

Использование конвейера потоковой передачи для импорта исторических данных в настоящее время не поддерживается в службе "аналитика временных рядов Azure" Gen2. Чтобы импортировать в среду данные за прошедшие периоды, следуйте приведенным ниже рекомендациям.

- Не выполняйте параллельную потоковую передачу динамических и исторических данных. Прием неупорядоченных данных приведет к снижению производительности запросов.
- Для достижения оптимальной производительности принимайте данные за прошлые периоды в хронологической последовательности.
- Не выходите за рамки приведенных ниже диапазонов скорости приема.
- Отключите теплое хранилище, если данные старше, чем срок хранения в теплом хранилище.

## <a name="event-source-timestamp"></a>Метка времени источника события

При настройке источника событий вам будет предложено указать свойство timestamp ID. Свойство timestamp используется для отслеживания событий с течением времени. это время, которое будет использоваться в качестве $event. $ts в [API-интерфейсах запросов](/rest/api/time-series-insights/dataaccessgen2/query/execute) и для отображения рядов в обозревателе службы "аналитика временных рядов Azure". Если свойство не предоставлено во время создания или если в событии отсутствует свойство timestamp, то в качестве значения по умолчанию будет использоваться центр Интернета вещей или зарегистрированное время для концентраторов событий. Значения свойств метки времени хранятся в формате UTC.

Как правило, пользователи могут настроить свойство метки времени и использовать время, когда датчик или тег создавали чтение, а не использовать стандартное время в очереди. Это особенно необходимо, когда устройства постоянно теряют связь, а пакет отложенных сообщений перенаправляется в Gen2 службы "аналитика временных рядов Azure".

Если пользовательская отметка времени находится внутри вложенного объекта JSON или массива, необходимо указать правильное имя свойства, следуя [соглашениям об именовании и экранировании](concepts-json-flattening-escaping-rules.md). Например, отметка времени источника события для полезных данных JSON, показанная [здесь](concepts-json-flattening-escaping-rules.md#example-a) , должна быть введена как `"values.time"` .

### <a name="time-zone-offsets"></a>Смещения часового пояса

Метки времени должны отправляться в формате ISO 8601 и храниться в формате UTC. Если указано смещение часового пояса, будет применено смещение, а затем время, сохраненное и возвращаемое в формате UTC. Если смещение неправильно отформатировано, оно будет пропущено. В ситуациях, когда в решении может не быть контекста исходного смещения, можно отправить данные о смещении в дополнительное отдельное свойство события, чтобы убедиться, что оно сохранено и что приложение может ссылаться в ответе на запрос.

Смещение часового пояса должно быть отформатировано как одно из следующих:

± ХХММЗ</br>
± ЧЧ: ММ</br>
± ЧЧ: ММЗ</br>

## <a name="next-steps"></a>Дальнейшие действия

- Ознакомьтесь с [правилами преобразования и экранирования JSON](./concepts-json-flattening-escaping-rules.md) , чтобы понять, как будут храниться события.

- Общие сведения об [ограничениях пропускной способности](./concepts-streaming-ingress-throughput-limits.md) среды