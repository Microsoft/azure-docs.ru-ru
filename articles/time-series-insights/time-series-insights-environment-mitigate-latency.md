---
title: Как отслеживать и уменьшать регулирование — аналитика временных рядов Azure | Документация Майкрософт
description: Узнайте, как отслеживать, диагностировать и устранять проблемы с производительностью, которые вызывают задержку и регулирование в службе "аналитика временных рядов Azure".
ms.service: time-series-insights
services: time-series-insights
author: deepakpalled
ms.author: dpalled
manager: diviso
ms.reviewer: v-mamcge, jasonh, kfile
ms.devlang: csharp
ms.workload: big-data
ms.topic: troubleshooting
ms.date: 09/29/2020
ms.custom: seodec18
ms.openlocfilehash: e89189b22b144d9e92ee8315bc6fd9aabe699eec
ms.sourcegitcommit: 772eb9c6684dd4864e0ba507945a83e48b8c16f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "91531655"
---
# <a name="monitor-and-mitigate-throttling-to-reduce-latency-in-azure-time-series-insights-gen1"></a>Мониторинг и устранение рисков для уменьшения задержки в Gen1 временных рядов Azure

> [!CAUTION]
> Эта статья посвящена службе "Аналитика временных рядов Azure" 1-го поколения.

Если объем входящих данных превышает пределы, установленные в конфигурации вашей среды, в службе "Аналитика временных рядов Azure" могут возникнуть задержки или регулирования.

Чтобы избежать задержки и регулирования, следует правильно настроить среду для того объема данных, который поступает для анализа.

Задержки и регулирования чаще всего возникают в следующих случаях.

- Добавьте источник событий, содержащий старые данные, которые могут превысить выделенную скорость приема (служба "аналитика временных рядов Azure" должна быть настроена).
- Если вы добавили в среду дополнительные источники событий, в результате чего увеличился объем получаемых событий и, возможно, превысил емкость вашей среды.
- Отправка больших объемов исторических событий в источник событий, что приводит к задержке (служба "аналитика временных рядов Azure" должна быть перехватываться).
- Если вы добавили новые сведения о телеметрии, что увеличило размер событий. Максимально допустимый размер пакета — 32 КБ; пакеты данных размером более 32 КБ усекаются.

## <a name="video"></a>Видео

### <a name="learn-about-azure-time-series-insights-data-ingress-behavior-and-how-to-plan-for-itbr"></a>Узнайте о поведении данных службы "аналитика временных рядов Azure" и о том, как спланировать их.</br>

> [!VIDEO https://www.youtube.com/embed/npeZLAd9lxo]

## <a name="monitor-latency-and-throttling-with-alerts"></a>Мониторинг задержки и регулирования с помощью оповещений

Оповещения могут помочь в диагностике и устранении проблем задержки, происходящих в вашей среде.

1. В портал Azure выберите среду службы "аналитика временных рядов Azure". Затем выберите **оповещения**.

   [![Добавление оповещения в среду службы "аналитика временных рядов Azure"](media/environment-mitigate-latency/mitigate-latency-add-alert.png)](media/environment-mitigate-latency/mitigate-latency-add-alert.png#lightbox)

1. Выберите **+ Новое правило генерации оповещений**. После этого отобразится панель **Создание правила** . Выберите **Добавить** в поле **условие**.

   [![Добавить Панель предупреждений](media/environment-mitigate-latency/mitigate-latency-add-pane.png)](media/environment-mitigate-latency/mitigate-latency-add-pane.png#lightbox)

1. Затем настройте точные условия для логики сигнала.

   [![Настройка логики сигналов](media/environment-mitigate-latency/configure-alert-rule.png)](media/environment-mitigate-latency/configure-alert-rule.png#lightbox)

   В нем можно настроить оповещения с помощью некоторых из следующих условий.

   |Метрика  |Описание  |
   |---------|---------|
   |**Ingress Received Bytes** (Получено байт входящих данных)     | Количество байтов необработанной информации, полученных от источников событий. Обычно в этот объем включается имя и значение свойства.  |  
   |**Ingress Received Invalid Messages** (Получено недопустимых сообщений во входящих данных)     | Число недопустимых сообщений, полученных от всех источников событий (Центров событий Azure и Центров Интернета вещей Azure).      |
   |**Ingress Received Messages** (Получено сообщений входящих данных)   | Количество сообщений, полученных от всех источников событий (Центров событий Azure и Центров Интернета вещей Azure).        |
   |**Ingress Stored Bytes** (Хранится байтов входящих данных)     | Общий размер сохраненных событий, доступных для запросов. В этот объем включаются только значения свойств.        |
   |**Ingress Stored Events** (Хранится сообщений входящих данных)     |   Общее количество сведенных и сохраненных событий, доступных для запросов.      |
   |**Ingress Received Message Time Lag** (Интервал задержки для полученных сообщений входящих данных)    |  Разница в секундах между временем, когда сообщение помещается в очередь источника событий, и временем, когда сообщение обрабатывается во входящих сообщениях.      |
   |**Ingress Received Message Count Lag** (Интервал между номерами полученных сообщений во входящих данных)    |  Разница между порядковым номером последнего сообщения в очереди событий источника секции и порядковым номером сообщения, обрабатываемого во входящих сообщениях.      |

   Нажмите кнопку **Готово**.

1. После настройки требуемой логики сигнала Просмотрите выбранное правило генерации оповещений визуально.

   [![Представление задержки и построение диаграмм](media/environment-mitigate-latency/mitigate-latency-view-and-charting.png)](media/environment-mitigate-latency/mitigate-latency-view-and-charting.png#lightbox)

## <a name="throttling-and-ingress-management"></a>Регулирование и управление входящими сообщениями

- Если вы регулируете регулирование, будет зарегистрировано значение *задержки во времени приема входящих сообщений* , информирующее о том, сколько секунд за пределами среды службы "аналитика временных рядов Azure" от фактического времени, когда сообщение поступает в источник события (за исключением времени индексирования Appx. 30–60 секунд).  

  Метрика *Ingress Recieved Message Count Lag* (Интервал между номерами полученных сообщений во входящих данных) также должна иметь значение, которое позволяет определить, на сколько сообщений вы отстали.  Самым простым способом устранить задержку является увеличение емкости среды до размера, который позволит сделать это.  

  Например, если среда S1 демонстрирует задержку сообщения 5 000 000, можно увеличить размер среды до шести единиц, чтобы избежать возникновения ошибок.  Чтобы устранить задержку еще быстрее, количество единиц можно увеличить еще. Увеличение периода — обычная практика при первоначальной настройке среды, особенно когда вы подключаете ее к источнику событий, в котором уже есть события или когда вы загружаете много исторических данных.

- Кроме того, вы можете установить оповещение, которое сработает, если значение параметра **Ingress Stored Events** (Хранится сообщений входящих данных) в течение 2 часов превышает некоторое пороговое значение, установленное чуть ниже общей емкости вашей среды.  Такое предупреждение позволит понять, что возможности среды постоянно используются полностью, что указывает на высокую вероятность задержки.

  Например, если вы подготовили три единицы S1 (с общим объемом 2100 входящих запросов в минуту), установите оповещение "**Ingress Stored Events** >= 1900 в течение 2 часов". Если среда регулярно достигает этого предела и активирует это оповещение, то скорее всего вы выделили недостаточно ресурсов.  

- Если вы считаете, что вы регулируете, вы можете сравнить **полученные сообщения** с сообщениями егрессед источника событий.  Если передача данных в концентратор событий превышает объем **полученных входящих сообщений**, то, скорее всего, служба "аналитика временных рядов Azure" будет регулироваться.

## <a name="improving-performance"></a>Повышение производительности

Если вы хотите уменьшить регулирование или устранить задержки, мы рекомендуем увеличить емкость вашей среды.

Чтобы избежать задержки и регулирования, следует правильно настроить среду для того объема данных, который поступает для анализа. Дополнительные сведения о добавлении емкости в среду см. в статье [масштабирование среды](time-series-insights-how-to-scale-your-environment.md).

## <a name="next-steps"></a>Дальнейшие действия

- Ознакомьтесь с [диагностикой и устранением проблем в среде службы "аналитика временных рядов Azure](time-series-insights-diagnose-and-solve-problems.md)".

- Узнайте [, как масштабировать среду службы "аналитика временных рядов Azure](time-series-insights-how-to-scale-your-environment.md)".
