---
title: Предстоящие изменения в правилах приема и анализа данных в службе "аналитика временных рядов Azure" Gen2 | Документация Майкрософт
description: Изменения правил приема
ms.service: time-series-insights
services: time-series-insights
author: lyrana
ms.author: lyhughes
manager: dpalled
ms.workload: big-data
ms.topic: conceptual
ms.date: 10/02/2020
ms.custom: lyhughes
ms.openlocfilehash: 56a1d5aab2f665f9c5bd8f6fa322f35e55483c7b
ms.sourcegitcommit: 910a1a38711966cb171050db245fc3b22abc8c5f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "95995239"
---
# <a name="upcoming-changes-to-json-flattening-and-escaping-rules-for-new-environments"></a>Предстоящие изменения в правилах плоской обработки и экранирования JSON для новых сред

> [!IMPORTANT]
> Эти изменения будут применены только к *вновь созданным* Microsoft Azure Gen2 временных рядов Insights. Изменения не применяются к средам Gen1.

Среда Gen2 "аналитика временных рядов Azure" динамически создает столбцы хранилища, следуя определенному набору соглашений об именовании. Когда событие принимается, служба "аналитика временных рядов" применяет набор правил к полезной нагрузке JSON и именам свойств. Изменения в том, как данные JSON сведены и сохранены, вступают в действие в новых средах Gen2 временных рядов Azure в июле 2020. Это изменение влияет на работу в следующих случаях:

* Полезные данные JSON содержат вложенные объекты.
* Полезные данные JSON содержат массивы.
* В имени свойства JSON можно использовать любой из следующих четырех специальных символов: `[` `\` `.``'`
* Одно или несколько свойств идентификатора временных рядов (TS) находятся внутри вложенного объекта.

Если создается новая среда и один или несколько из этих вариантов применяются к полезной нагрузке события, данные будут сведены и сохранены по-разному. В следующей таблице приведена сводка изменений.

| Текущее правило | Новое правило | Пример JSON | Предыдущее имя столбца | Имя нового столбца
|---|---| ---| ---|  ---|
| Вложенный JSON преобразуется в плоскую структуру с помощью символа подчеркивания. |Вложенный формат JSON преобразуется с использованием точки в качестве средства разграничения.  | ``{"series" : { "value" : 19.338 }}`` | `series_value_double` |`series.value_double` |
| Специальные символы не преобразуются в escape-последовательность. | Имена свойств JSON, включающие специальные символы `.` `[`   `\` и `'` экранированные с помощью `['` и `']` . В `['` и `']` существуют дополнительные escape с одиночными кавычками и символами обратной косой черты. Одинарная кавычка будет записана как `\'` , а обратная косая черта — как `\\` .  | ```"Foo's Law Value": "17.139999389648"``` | `Foo's Law Value_double` | `['Foo\'s Law Value']_double` |
| Массивы примитивов хранятся в виде строки. | Массивы типов-примитивов хранятся в динамическом типе.  | `"values": [154, 149, 147]` | `values_string`  | `values_dynamic` |
Массивы объектов всегда сведены, создавая несколько событий. | Если объекты в массиве не имеют свойств "идентификатор TS" или "метка времени", массив объектов хранится в целом как динамический тип. | `"values": [{"foo" : 140}, {"bar" : 149}]` | `values_foo_long | values_bar_long` | `values_dynamic` |

## <a name="recommended-changes-for-new-environments"></a>Рекомендуемые изменения для новых сред

### <a name="if-your-ts-id-andor-timestamp-property-is-nested-within-an-object"></a>Если идентификатор TS и свойство "timestamp" вложены в объект

Все новые развертывания должны соответствовать новым правилам приема. Например, если ИДЕНТИФИКАТОРом TS является `telemetry_tagId` , необходимо обновить все Azure Resource Manager шаблоны или скрипты автоматического развертывания, чтобы настроить в `telemetry.tagId` качестве идентификатора TS среды. Это изменение также требуется для меток времени источника события во вложенном JSON.

### <a name="if-your-payload-contains-nested-json-or-special-characters-and-you-automate-authoring-time-series-model-variable-expressions"></a>Если полезные данные содержат вложенные знаки JSON или специальные символы и автоматизируют создание выражений переменных [модели временных рядов](./concepts-model-overview.md)

Обновите код клиента, который выполняет [типесбатчпут](/rest/api/time-series-insights/dataaccessgen2/timeseriestypes/executebatch#typesbatchput) в соответствии с новыми правилами приема. Например, необходимо обновить предыдущее [выражение временного ряда](/rest/api/time-series-insights/reference-time-series-expression-syntax) `"value": {"tsx": "$event.series_value.Double"}` одним из следующих вариантов:

* `"value": {"tsx": "$event.series.value.Double"}`
* `"value": {"tsx": "$event['series']['value'].Double"}`

## <a name="next-steps"></a>Дальнейшие действия

* Сведения о [хранилище Gen2 и входных данных службы "аналитика временных рядов Azure](./concepts-ingestion-overview.md)".

* Узнайте, как выполнять запросы к данным с помощью [API запросов временных рядов](./concepts-query-overview.md).

* Дополнительные сведения о [новом синтаксисе выражений временных рядов](/rest/api/time-series-insights/reference-time-series-expression-syntax)см. в этой статье.