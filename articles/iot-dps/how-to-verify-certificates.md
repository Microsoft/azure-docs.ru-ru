---
title: Проверка сертификатов ЦС X. 509 с помощью службы подготовки устройств для центра Интернета вещей Azure
description: Как проверить свое владение сертификатами ЦС X. 509 с помощью службы подготовки устройств к добавлению в центр Интернета вещей Azure (DPS)
author: wesmc7777
ms.author: wesmc
ms.date: 02/26/2018
ms.topic: conceptual
ms.service: iot-dps
services: iot-dps
ms.openlocfilehash: 2020205357c68e007a1a375c4853e8c04afd2019
ms.sourcegitcommit: a055089dd6195fde2555b27a84ae052b668a18c7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/26/2021
ms.locfileid: "98789066"
---
# <a name="how-to-do-proof-of-possession-for-x509-ca-certificates-with-your-device-provisioning-service"></a>Как подтвердить владение сертификатами ЦС X.509 с помощью службы подготовки устройств

Проверенный сертификат центра сертификации (ЦС) X.509 — это сертификат ЦС, переданный в службу подготовки и зарегистрированный в ней, а также прошедший проверку принадлежности в службе. 

Подтверждение владения сертификатом предусматривает указанные ниже действия:
1. Получение уникального кода проверки, созданного службой подготовки для сертификата ЦС X.509. Это можно сделать на портале Azure.
2. Создание сертификата проверки X.509 с кодом проверки в качестве субъекта и подписывание сертификата с закрытым ключом, связанным с сертификатом ЦС X.509.
3. Передача подписанного сертификата проверки в службу. Служба проверяет сертификат проверки, используя открытую часть сертификата ЦС. Это подтверждает, что вы владеете закрытым ключом сертификата ЦС.

Проверенные сертификаты играют важную роль при использовании групп регистрации. Проверка владельца сертификата повышает уровень защиты. Она подтверждает, что отправитель сертификата является владельцем его закрытого ключа. Проверка не позволяет вредоносному субъекту, который сканирует ваш трафик, извлечь промежуточный сертификат и использовать его для создания группы регистрации в собственной службе подготовки, эффективно используя ваши устройства. Подтверждая права владельца корневого или промежуточного сертификата в цепочке сертификатов, вы подтверждаете, что имеете разрешения на создание конечных сертификатов для устройств, которые будут зарегистрированы как часть группы регистрации. Поэтому корневой или промежуточный сертификат, настроенный в группе регистрации, должен быть проверенным или относится к проверенному сертификату в цепочке сертификатов, которую предоставляет устройство при выполнении проверки подлинности в службе. Дополнительные сведения об аттестации сертификатов X. 509 см. в разделе [сертификаты x. 509](concepts-x509-attestation.md) и [Управление доступом устройств к службе подготовки с помощью сертификатов x. 509](concepts-x509-attestation.md#controlling-device-access-to-the-provisioning-service-with-x509-certificates).

## <a name="register-the-public-part-of-an-x509-certificate-and-get-a-verification-code"></a>Регистрация открытой части сертификата X.509 и получение кода проверки

Чтобы зарегистрировать сертификат ЦС в службе подготовки и получить код проверки, который можно использовать во время подтверждения владения, выполните следующие действия. 

1. На портале Azure перейдите к службе подготовки и откройте колонку **Сертификаты** в меню слева. 
2. Выберите **Добавить**, чтобы добавить новый сертификат.
3. Введите понятное отображаемое имя для сертификата. Перейдите к CER- или PEM-файлу, который соответствует открытой части сертификата X.509. Щелкните **Отправить**.
4. После получения уведомления об успешной отправке сертификата выберите **Сохранить**.

    ![Передача сертификата](./media/how-to-verify-certificates/add-new-cert.png)  

   Вы увидите свой сертификат в списке **обозревателя сертификатов**. Обратите внимание, что этот сертификат имеет **состояние***Не проверено*.

5. Щелкните сертификат, добавленный на предыдущем шаге.

6. В разделе **Сведения о сертификате** выберите **Создать код проверки**.

7. Служба подготовки создаст **код проверки**, который можно использовать для проверки владельца сертификата. Скопируйте код в буфер обмена. 

   ![Проверка сертификата](./media/how-to-verify-certificates/verify-cert.png)  

## <a name="digitally-sign-the-verification-code-to-create-a-verification-certificate"></a>Цифровая подпись кода проверки для создания сертификата проверки

Теперь необходимо подписать *код проверки* с помощью закрытого ключа, связанного с вашим сертификатом ЦС X.509, который создает подпись. Этот процесс называется [проверкой принадлежности](https://tools.ietf.org/html/rfc5280#section-3.1). В результате будет подписан сертификат проверки.

Корпорация Майкрософт предоставляет средства и примеры, которые помогут вам создать подписанный сертификат проверки. 

- **Пакет SDK для устройства C Azure IoT** предоставляет скрипты PowerShell (Windows) и Bash (Linux), которые помогут вам создать сертификаты ЦС и конечные сертификаты для разработки и выполнения проверки принадлежности с помощью кода проверки. Вы можете загрузить [файлы](https://github.com/Azure/azure-iot-sdk-c/tree/master/tools/CACertificates), связанные с вашей системой, в рабочую папку, затем следуйте инструкциям статьи [Managing CA Certificates Sample](https://github.com/Azure/azure-iot-sdk-c/blob/master/tools/CACertificates/CACertificateOverview.md) (Пример управления сертификатами ЦС), чтобы подтвердить владение сертификатами ЦС. 
- **Пакет SDK для устройства C# Azure IoT** содержит [пример проверки сертификата группы](https://github.com/Azure-Samples/azure-iot-samples-csharp/tree/master/provisioning/Samples/service/GroupCertificateVerificationSample), который можно использовать для подтверждения владения.
 
> [!IMPORTANT]
> Кроме выполнения проверки принадлежности, скрипты PowerShell и Bash, упомянутые выше, позволяют создать корневые, промежуточные и конечные сертификаты, которые можно использовать для проверки подлинности и подготовки устройств. Эти сертификаты следует использовать только для разработки. Их не следует использовать в рабочей среде. 

Скрипты PowerShell и Bash, описанные в документации, и пакеты SDK используют [OpenSSL](https://www.openssl.org/). Вы также можете использовать OpenSSL или другие сторонние средства для подтверждения владением. Пример использования инструментария, предоставляемого с пакетами SDK, см. в разделе [Создание цепочки сертификатов X. 509](tutorial-custom-hsm-enrollment-group-x509.md#create-an-x509-certificate-chain). 


## <a name="upload-the-signed-verification-certificate"></a>Передача подписанного сертификата проверки

1. Передайте итоговую подпись в качестве сертификата проверки в службу подготовки на портале. В разделе **Сведения о сертификате** на портале Azure щелкните значок _проводника_ рядом с полем **PEM-файл или CER-файл сертификата для проверки**, чтобы передать подписанный сертификат проверки из системы.

2. После успешной передачи сертификата выберите **Проверить**. В списке **обозревателя сертификатов****состояние** вашего сертификата изменится на **_Проверено_**. Если оно не обновляется автоматически, выберите **Обновить**.

   ![Проверка отправки сертификата](./media/how-to-verify-certificates/upload-cert-verification.png)  

## <a name="next-steps"></a>Дальнейшие действия

- Дополнительные сведения о создании группы регистрации на портале см. в статье [Как управлять регистрацией устройств с помощью портала Azure](how-to-manage-enrollments.md).
- Дополнительные сведения о создании группы регистрации с помощью пакетов SDK для служб см. в статье [Как управлять регистрациями устройств с помощью пакетов SDK службы подготовки устройств Azure](how-to-manage-enrollments-sdks.md).










