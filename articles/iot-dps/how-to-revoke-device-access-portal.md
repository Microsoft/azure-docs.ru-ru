---
title: Отменяется регистрация устройства в службе подготовки устройств для центра Интернета вещей Azure
description: Отмена регистрации устройства для предотвращения подготовки через службу подготовки устройств для центра Интернета вещей Azure (DPS)
author: wesmc7777
ms.author: wesmc
ms.date: 04/05/2018
ms.topic: conceptual
ms.service: iot-dps
services: iot-dps
manager: timlt
ms.openlocfilehash: c75fcd1fd20e41df5018fcaa07fe83051d7e5f1a
ms.sourcegitcommit: 44844a49afe8ed824a6812346f5bad8bc5455030
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/23/2020
ms.locfileid: "97740374"
---
# <a name="how-to-disenroll-a-device-from-azure-iot-hub-device-provisioning-service"></a>Практическое руководство по отзыву регистрации устройства из службы подготовки устройств к добавлению в Центр Интернета вещей Azure

Правильное управление учетными данными устройства крайне важно для таких крупных систем, как решения Интернета вещей. Для таких систем мы рекомендуем иметь четкий план отмены доступа к устройствам, когда их учетные данные, например маркера SAS или сертификат X.509, скомпрометированы. 

Регистрация в службе подготовки устройств позволяет [подготовить](about-iot-dps.md#provisioning-process)устройство. Подготовленное устройство было зарегистрировано в центре Интернета вещей. Оно может принимать состояние [двойника устройства](~/articles/iot-hub/iot-hub-devguide-device-twins.md) и начать передачу данных телеметрии. В этой статье описывается, как отозвать регистрацию устройства из экземпляра службы подготовки, чтобы предотвратить его повторную подготовку в будущем.

> [!NOTE] 
> Не забывайте учесть политики повтора, применяемые к устройствам, для которых вы отменяете доступ. Например, если для устройства применяется политика бесконечных повторов, оно будет постоянно выполнять попытки зарегистрироваться в службе подготовки. Из-за этого оно потребляет ресурсы службы и даже может снизить производительность.

## <a name="disallow-devices-by-using-an-individual-enrollment-entry"></a>Запретить устройства с помощью отдельной записи регистрации

Отдельные регистрации применяются к одному устройству и могут использовать сертификаты X. 509, ключи подтверждения TPM (в реальном или виртуальном доверенном платформенном модуле) или токены SAS в качестве механизма аттестации. Чтобы запретить устройству, имеющему отдельную регистрацию, можно либо отключить, либо удалить запись регистрации. 

Чтобы временно отключить устройство, отключите его запись регистрации: 

1. Войдите на портал Azure и выберите **Все ресурсы** в меню слева.
2. В списке ресурсов выберите службу подготовки, которая будет запрещена для устройства.
3. В службе подготовки выберите **Управление регистрациями**, а затем — вкладку **Отдельные регистрации**.
4. Выберите запись регистрации для устройства, которое вы хотите запретить. 

    ![Выбор индивидуальной регистрации](./media/how-to-revoke-device-access-portal/select-individual-enrollment.png)

5. Прокрутите страницу регистрации до конца и выберите **Отключить** в переключателе **Включить запись**, а затем **Сохранить**.  

   ![Отключение записи индивидуальной регистрации на портале](./media/how-to-revoke-device-access-portal/disable-individual-enrollment.png)

Чтобы навсегда запретить устройство, удалите запись регистрации:

1. Войдите на портал Azure и выберите **Все ресурсы** в меню слева.
2. В списке ресурсов выберите службу подготовки, которая будет запрещена для устройства.
3. В службе подготовки выберите **Управление регистрациями**, а затем — вкладку **Отдельные регистрации**.
4. Установите флажок рядом с записью регистрации для устройства, которое вы хотите запретить. 
5. Выберите **Удалить** в верхней части окна, а затем подтвердите удаление регистрации, выбрав ответ **Да**. 

   ![Удаление записи индивидуальной регистрации на портале](./media/how-to-revoke-device-access-portal/delete-individual-enrollment.png)


После завершения процедуры запись исчезнет из списка индивидуальных регистраций.  

## <a name="disallow-an-x509-intermediate-or-root-ca-certificate-by-using-an-enrollment-group"></a>Запретить промежуточный или корневой сертификат ЦС X. 509 с помощью группы регистрации

Сертификаты X.509 обычно организованы в цепочки доверия. В случае компрометации сертификата на любом этапе цепочки доверие будет нарушено. Сертификат должен быть запрещен, чтобы служба подготовки устройств не запускала устройства в цепочке, содержащей этот сертификат. Дополнительные сведения о сертификатах X.509 и их применении в службе подготовки вы найдете в статье [о сертификатах X.509](./concepts-x509-attestation.md#x509-certificates). 

Группа регистраций представляет собой групповую запись для устройств с общим механизмом аттестации сертификатов X.509, подписанных одним и тем же промежуточным или корневым ЦС. Запись группы регистраций настроена с сертификатом X.509, связанным с промежуточным или корневым ЦС. Запись также настраивается и может иметь любые параметры конфигурации, например состояния двойника и подключения к Центру Интернета вещей, которые применяются для всех устройств, в цепочке сертификатов которых есть указанный в записи сертификат. Чтобы запретить сертификат, можно либо отключить, либо удалить свою группу регистрации.

Чтобы временно запретить сертификат, отключите его группу регистрации: 

1. Войдите на портал Azure и выберите **Все ресурсы** в меню слева.
2. В списке ресурсов выберите службу подготовки, для которой необходимо запретить сертификат подписи.
3. В службе подготовки выберите **Управление регистрациями**, а затем — вкладку **Группы регистрации**.
4. Выберите группу регистрации, используя сертификат, который вы хотите запретить.
5. Выберите **Отключить** в переключателе **Включить запись**, а затем выберите **Сохранить**.  

   ![Отключение записи группы регистраций на портале](./media/how-to-revoke-device-access-portal/disable-enrollment-group.png)

    
Чтобы окончательно запретить сертификат, удалите его группу регистрации:

1. Войдите на портал Azure и выберите **Все ресурсы** в меню слева.
2. В списке ресурсов выберите службу подготовки, которая будет запрещена для устройства.
3. В службе подготовки выберите **Управление регистрациями**, а затем — вкладку **Группы регистрации**.
4. Установите флажок рядом с группой регистраций для сертификата, который вы хотите запретить. 
5. Выберите **Удалить** в верхней части окна, а затем подтвердите удаление группы регистраций, выбрав ответ **Да**. 

   ![Удаление записи группы регистраций на портале](./media/how-to-revoke-device-access-portal/delete-enrollment-group.png)

После завершения процедуры запись исчезнет из списка групп регистраций.  

> [!NOTE]
> Удаление группы регистраций для сертификата не помешает устройствам с этим сертификатом подключаться к службе, если существует другая, активная группа регистраций для корневого или промежуточного сертификата, расположенного выше в цепочке сертификатов устройств.

## <a name="disallow-specific-devices-in-an-enrollment-group"></a>Запретить определенные устройства в группе регистрации

Устройства, которые используют механизм аттестации X.509, выполняют аутентификацию на основе цепочки сертификатов устройства и закрытого ключа. Когда устройство подключается и выполняет аутентификацию с помощью службы подготовки устройств, служба сначала ищет отдельные регистрации, соответствующие учетным данным устройства. Служба выполняет поиск групп регистраций, чтобы определить, можно ли подготовить устройство. Если служба обнаружит отключенную отдельную регистрацию устройства, она не позволит устройству подключиться. Служба предотвращает подключение, даже если в цепочке сертификатов устройства есть включенная группа регистраций для промежуточного или корневого ЦС. 

Чтобы запретить отдельное устройство в группе регистрации, выполните следующие действия.

1. Войдите на портал Azure и выберите **Все ресурсы** в меню слева.
2. В списке ресурсов выберите службу подготовки, которая содержит группу регистрации для устройства, которое вы хотите запретить.
3. В службе подготовки выберите **Управление регистрациями**, а затем — вкладку **Отдельные регистрации**.
4. Выберите **Добавить индивидуальную регистрацию** в верхней части экрана. 
5. На странице **Добавление регистрации** выберите **X.509** в качестве **механизма** аттестации для устройства.

    Отправьте сертификат устройства и введите идентификатор устройства, который будет запрещен. В качестве сертификата используйте подписанный сертификат конечного субъекта, установленный на устройстве. Устройство использует подписанный сертификат конечного субъекта для проверки подлинности.

    ![Задание свойств устройства для запрещенного устройства](./media/how-to-revoke-device-access-portal/disable-individual-enrollment-in-enrollment-group-1.png)

6. Прокрутите страницу **Добавить регистрацию** до конца и выберите **Отключить** в переключателе **Включить запись**, а затем **Сохранить**. 

    [![Использовать отключенную запись отдельной регистрации для отключения устройства от групповой регистрации на портале](./media/how-to-revoke-device-access-portal/disable-individual-enrollment-in-enrollment-group.png)](./media/how-to-revoke-device-access-portal/disable-individual-enrollment-in-enrollment-group.png#lightbox)

После успешного создания регистрации отключенная регистрация устройства появится на вкладке **Индивидуальные регистрации**. 

## <a name="next-steps"></a>Дальнейшие действия

Отзыв регистрации также является частью полного процесса отзыва. Отзыв устройства включает как отзыв регистрации из службы подготовки, так и отмену регистрации в Центре Интернета вещей. Дополнительные сведения о полном процессе см. в статье [Как отменить подготовку устройств, зарегистрированных в службе подготовки](how-to-unprovision-devices.md).
