---
title: Служба подготовки устройств для центра Интернета вещей — роли и операции
description: В этой статье приводятся общие сведения о ролях и операциях, связанных с разработкой и решением IoT с помощью службы подготовки устройств Интернета вещей (DPS).
author: wesmc7777
ms.author: wesmc
ms.date: 09/14/2020
ms.topic: conceptual
ms.service: iot-dps
services: iot-dps
manager: eliotga
ms.openlocfilehash: 322d6b590863d8065454c0439c5d899107a6abe7
ms.sourcegitcommit: a055089dd6195fde2555b27a84ae052b668a18c7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/26/2021
ms.locfileid: "98784971"
---
# <a name="roles-and-operations"></a>Роли и операции

Этапы разработки решения IoT могут охватывать недели или месяцы, так как производственный реалии, например время производства, Доставка, таможенный процесс и т. д. Кроме того, они могут охватывать действия нескольких ролей, учитывая вовлеченность различных сущностей. В этом разделе более подробно рассматриваются различные роли и операции, связанные с каждым этапом, а затем демонстрируется последовательность на схеме последовательностей. 

Подготовка также помещает требования к производителю устройства, характерные для включения [механизма аттестации](concepts-service.md#attestation-mechanism). Производственные операции также могут происходить независимо от этапов автоматической подготовки, особенно в случаях, когда необходимо приобрести новые устройства после развертывания автоматической подготовки.

В оглавлении слева указан ряд кратких руководств, которые помогут понять действие автоматической подготовки на практике. Чтобы облегчить и упростить процесс обучения, используется программное обеспечение для имитации физического устройства, предназначенного для регистрации. В некоторых кратких руководствах требуется выполнять операции для нескольких ролей, включая операции для несуществующих ролей. Это связано с тем, что в этих руководствах используется имитация.

| Роль | Операция | Описание |
|------| --------- | ------------|
| Производитель | Кодирование идентификатора и URL-адреса регистрации | В зависимости от используемого механизма аттестации изготовитель отвечает за кодирование сведений об удостоверении устройства и URL-адреса службы подготовки устройств.<br><br>**Краткое руководство**. Так как устройство имитируется, роль изготовителя отсутствует. Ознакомьтесь с ролью разработчика, чтобы узнать, как получить эти сведения, которые используются в программировании примера приложения регистрации. |
| | Предоставление удостоверения устройства | Являясь источником сведений об удостоверении устройства, изготовитель отвечает за их передачу оператору (или назначенному агенту) или их непосредственную регистрацию в службе подготовки устройств посредством интерфейсов API.<br><br>**Краткое руководство**. Так как устройство имитируется, роль изготовителя отсутствует. Ознакомьтесь с ролью оператора, чтобы узнать, как получить удостоверение устройства, которое используется для регистрации имитированного устройства в вашем экземпляре службы подготовки устройств. |
| Оператор | Настройка автоматической подготовки | Эта операция соответствует первому этапу автоматической подготовки.<br><br>**Краткое руководство**. Вы выполняете роль оператора, настраивая экземпляры службы подготовки устройств и Центра Интернета вещей в своей подписке Azure. |
|  | Регистрация удостоверения устройства | Эта операция соответствует второму этапу автоматической подготовки.<br><br>**Краткое руководство**. Вы выполняете роль оператора, регистрируя имитированное устройство в своем экземпляре службы подготовки устройств. Удостоверение устройства определяется с помощью метода аттестации, имитируемого в кратком руководстве (доверенный платформенный модуль или X.509). Чтобы узнать больше об аттестации, ознакомьтесь с ролью разработчика. |
| Служба подготовки устройств,<br>Центр Интернета вещей | \<all operations\> | И для производственной реализации на физических устройствах, и для кратких руководств с использованием имитированных устройств эти роли выполняются посредством служб Интернета вещей, настраиваемых в вашей подписке Azure. Роли и операции выполняются одинаково, так как для подготовки физических и имитированных устройств используются одни и те же службы Интернета вещей. |
| Разработчик | Создание и развертывание программного обеспечения регистрации | Эта операция соответствует третьему этапу автоматической подготовки. Разработчик отвечает за создание и развертывание программного обеспечения регистрации на устройстве с помощью соответствующего пакета SDK.<br><br>**Краткое руководство**. Создаваемый пример приложения регистрации имитирует реальное устройство для выбранной платформы или языка, которое выполняется на вашей рабочей станции (а не развертывается на физическом устройстве). Приложение регистрации выполняет те же операции, что и приложение, развернутое на физическом устройстве. Вы задаете метод аттестации (доверенный платформенный модуль или сертификат X.509), а также URL-адрес регистрации и область идентификаторов для своего экземпляра службы подготовки устройств. Удостоверение устройства определяется логикой аттестации пакета SDK во время выполнения в зависимости от указанного метода. <ul><li>**Аттестация доверенного платформенного модуля**: на рабочей станции разработки выполняется [симулятор доверенного платформенного модуля](quick-create-simulated-device.md). После его запуска используется отдельное приложение для извлечения ключа подтверждения и идентификатора регистрации доверенного платформенного модуля для регистрации удостоверения устройства. Логика аттестации пакета SDK также использует симулятор во время регистрации для предоставления маркера подписанного URL-адреса, используемого для аутентификации и проверки регистрации.</li><li>**Аттестация X509**: для [создания сертификата](tutorial-custom-hsm-enrollment-group-x509.md#create-an-x509-certificate-chain) используется инструмент. После этого вы создаете файл сертификата, необходимый для регистрации. Логика аттестации пакета SDK также использует этот сертификат во время регистрации для аутентификации и проверки регистрации.</li></ul> |
| Устройство | Загрузка и регистрация | Эта операция соответствует третьему этапу автоматической подготовки. Ее выполняет программное обеспечение регистрации устройств, созданное разработчиком. Чтобы узнать больше, ознакомьтесь с ролью разработчика. При первой загрузке выполняется следующее. <ol><li>Приложение подключается к экземпляру службы подготовки устройств в соответствии с глобальным URL-адресом и областью идентификаторов службы, указанных во время разработки.</li><li>После подключения устройство проходит аутентификацию с помощью метода аттестации и удостоверения, указанного во время регистрации.</li><li>После аутентификации устройство регистрируется в экземпляре Центра Интернета вещей, указанном экземпляром службы подготовки устройств.</li><li>После успешной регистрации в приложение регистрации передается уникальный идентификатор устройства и конечная точка Центра Интернета вещей для взаимодействия с Центром Интернета вещей.</li><li> После этого устройство может извлечь свое начальное состояние [двойника устройства](~/articles/iot-hub/iot-hub-devguide-device-twins.md) для настройки и начать передачу данных телеметрии.</li></ol>**Краткое руководство**. Так как устройство имитируется, программное обеспечение регистрации выполняется на вашей рабочей станции разработки.|

На следующей схеме показаны роли и последовательность операций при автоматической подготовке устройства.
<br><br>
[![Последовательность автоматической подготовки для устройства](./media/concepts-auto-provisioning/sequence-auto-provision-device-vs.png)](./media/concepts-auto-provisioning/sequence-auto-provision-device-vs.png#lightbox) 

> [!NOTE]
> При необходимости изготовитель может также выполнить операцию "регистрации удостоверения устройства" с помощью интерфейсов API службы подготовки устройств (а не с помощью оператора). Подробное описание этой процедуры и многое другое можно найти в видео [Zero touch device registration with Azure IoT](https://youtu.be/cSbDRNg72cU?t=2460) (Автоматическая регистрация устройств в Azure IoT) (начиная с 41-й минуты).

## <a name="roles-and-azure-accounts"></a>Роли и учетные записи Azure

Сопоставление всех ролей с учетной записью Azure зависит от сценария (при этом может быть задействовано много сценариев). Изучите распространенные шаблоны, приведенные ниже, чтобы получить общее представление о том, как роли обычно сопоставляются с учетной записью Azure.

#### <a name="chip-manufacturer-provides-security-services"></a>Производитель микросхемы предоставляет службы безопасности

В этом сценарии производитель управляет безопасностью для клиентов первого уровня. Клиенты первого уровня предпочитают этот сценарий, так как при его использовании не нужно прилагать усилия к управлению безопасностью. 

Производитель представляет службу безопасности в аппаратных модулях безопасности (HSM). Обеспечение безопасности может предусматривать получение производителем ключей, сертификатов и т. д. от потенциальных клиентов, которые уже настроили экземпляры Службы подготовки устройств и группы регистрации. Производитель может также предоставлять эти сведения о безопасности клиентам.

В этом случае могут использоваться две учетные записи Azure:

- **#1 учетной записи**. скорее всего, к некоторой степени можно предоставить общий доступ для ролей оператора и разработчика. Эта сторона может приобрести микросхемы HSM у производителя. Эти микросхемы настроены для экземпляров DPS, связанных с учетной записью № 1. Путем регистрации в DPS эта сторона может сдавать в аренду устройства нескольким клиентам второго уровня, повторно настроив параметры регистрации устройства в DPS. Эта сторона также может иметь центры Интернета вещей, выделенные для взаимодействия конечных пользователей с системами для доступа к телеметрии устройств и т. д. В этом случае вторая учетная запись может не потребоваться.

- **Учетная запись #2**: конечные пользователи, уровень-два клиента могут иметь собственные центры Интернета вещей. Сторона, связанная с учетной записью № 1, только направляет арендованные устройства в правильный Центр этой учетной записи. Для этой конфигурации требуется установить все возможные связи между DPS и Центрами Интернета вещей во всех учетных записях Azure с помощью шаблонов Azure Resource Manager.

#### <a name="all-in-one-oem"></a>Универсальный поставщик вычислительной техники

Производитель может быть "универсальным поставщиком вычислительной техники". В этом случае требуется только одна учетная запись производителя. Производитель обрабатывает безопасность и подготовку от начала и до конца.

Производитель может предоставить облачное приложение покупателям устройства. Это приложение будет взаимодействовать с Центром Интернета вещей, выделенным производителем.

Системы торговых автоматов и автоматизированных кофеварок являются примером этого сценария.




## <a name="next-steps"></a>Дальнейшие действия

Может быть удобно добавить эту статью в закладки, чтобы использовать при работе с соответствующими краткими руководствами по автоматической подготовке. 

Начните с краткого руководства "Настройка автоматической подготовки", которое лучше всего подходит для вашего инструмента управления. В этом руководстве описывается этап "Настройка службы":

- [Настройка автоматической подготовки с помощью Azure CLI](quick-setup-auto-provision-cli.md)
- [Настройка автоматической подготовки с помощью портал Azure](quick-setup-auto-provision.md)
- [Настройка автоматической подготовки с помощью шаблона Resource Manager](quick-setup-auto-provision-rm.md)

Затем перейдите к краткому руководству по подготовке устройства, которое соответствует механизму аттестации устройств и пакету SDK или языку для службы подготовки устройств. В этом кратком руководстве описываются этапы "Регистрация устройства" и "Регистрация и настройка устройства": 

| Механизм аттестации устройств | Пакет SDK или язык для краткого руководства | 
| ------------------------------- | -------------------- |
| Симметричный ключ | [В](quick-create-simulated-device-symm-key.md)<br>[Java](quick-create-simulated-device-symmetric-key-java.md)<br>[Python](quick-create-device-symmetric-key-python.md) |
| Сертификат X.509 | [В](quick-create-simulated-device-x509.md)<br>[Java](quick-create-simulated-device-x509-java.md)<br>[C#](quick-create-simulated-device-x509-csharp.md)<br>[Node.js](quick-create-simulated-device-x509-node.md)<br>[Python](quick-create-simulated-device-x509-python.md) |
| Имитация доверенный платформенный модуль (TPM) (TPM) | [В](quick-create-simulated-device.md)<br>[Java](quick-create-simulated-device-tpm-java.md)<br>[C#](quick-create-simulated-device-tpm-csharp.md)<br>[Python](quick-create-simulated-device-tpm-python.md) |




