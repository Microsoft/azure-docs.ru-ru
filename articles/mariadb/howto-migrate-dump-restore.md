---
title: Миграция с помощью дампа и восстановления — база данных Azure для MariaDB
description: В этой статье описаны два распространенных способа резервного копирования и восстановления баз данных Azure для MariaDB с помощью таких средств, как mysqldump, MySQL Workbench и phpMyAdmin.
author: savjani
ms.author: pariks
ms.service: mariadb
ms.subservice: migration-guide
ms.topic: how-to
ms.date: 2/27/2020
ms.openlocfilehash: 35b1e84bdf74afd9577c7c98f023179dd769cd66
ms.sourcegitcommit: a9ce1da049c019c86063acf442bb13f5a0dde213
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/27/2021
ms.locfileid: "105628226"
---
# <a name="migrate-your-mariadb-database-to-an-azure-database-for-mariadb-by-using-dump-and-restore"></a>Перенос базы данных MariaDB в базу данных Azure для MariaDB с помощью функции дампа и восстановления

В этой статье описаны два распространенных способа резервного копирования и восстановления баз данных Azure для MariaDB.
- Выгрузка и восстановление с помощью программы командной строки (с помощью mysqldump) 
- Дамп и восстановление с помощью phpMyAdmin

## <a name="prerequisites"></a>Предварительные условия
Перед началом миграции базы данных выполните следующие действия.
- Создайте [сервер базы данных Azure для MariaDB — портал Azure](quickstart-create-mariadb-server-database-using-azure-portal.md).
- Установите служебную программу командной строки [mysqldump](https://mariadb.com/kb/en/library/mysqldump/) .
- Скачайте и установите [MySQL Workbench](https://dev.mysql.com/downloads/workbench/) или другое стороннее средство MySQL для выполнения команд dump и RESTORE.

## <a name="use-common-tools"></a>Использование распространенных инструментов
Используйте общие служебные программы и средства, такие как MySQL Workbench или mysqldump, для удаленного подключения и восстановления данных в базе данных Azure для MariaDB. Используйте эти средства на клиентском компьютере с подключением к Интернету для подключения к базе данных Azure для MariaDB. Используйте подключение с SSL-шифрованием в качестве оптимальной методики безопасности. Дополнительные сведения см. [в статье Настройка SSL-подключений в базе данных Azure для MariaDB](concepts-ssl-connection-security.md). Вам не нужно перемещать файлы дампа в любое специальное облачное расположение при переносе данных в базу данных Azure для MariaDB. 

## <a name="common-uses-for-dump-and-restore"></a>Распространенные варианты использования дампа и восстановления
Вы можете использовать служебные программы MySQL, такие как mysqldump и mysqlpump, для дампа и загрузки баз данных в сервер базы данных Azure для MariaDB в нескольких распространенных сценариях. 

- При переносе всей базы данных используйте дампы базы данных. Эта рекомендация используется при перемещении большого объема данных или при необходимости снижения перерывов в работе служб для активных сайтов или приложений. 
-  Убедитесь, что все таблицы в базе данных используют подсистему хранилища InnoDB при загрузке данных в базу данных Azure для MariaDB. База данных Azure для MariaDB поддерживает только подсистему хранилища InnoDB, а другие механизмы хранилища не поддерживаются. Если таблицы настроены с другими подсистемами хранилища, преобразуйте их в формат ядра InnoDB перед переносом в базу данных Azure для MariaDB.
   
   Например, если у вас есть приложение WordPress или веб-приложение, использующее таблицы MyISAM, сначала преобразуйте эти таблицы, переполнив их в формате InnoDB перед восстановлением в базе данных Azure для MariaDB. Используйте предложение, `ENGINE=InnoDB` чтобы задать подсистему для создания новой таблицы, а затем перед восстановлением перенесите данные в совместимую таблицу. 

   ```sql
   INSERT INTO innodb_table SELECT * FROM myisam_table ORDER BY primary_key_columns
   ```
- Чтобы избежать проблем совместимости при создании дампов баз данных, убедитесь, что используется та же версия MariaDB, что и в исходной и целевой системах. Например, если имеющийся сервер MariaDB имеет версию 10,2, необходимо выполнить миграцию в базу данных Azure для MariaDB, настроенную для запуска версии 10,2. `mysql_upgrade`Команда не работает на сервере базы данных Azure для MariaDB и не поддерживается. Если необходимо выполнить обновление для версий MariaDB, сначала выведите дамп или экспортируйте базу данных более ранней версии в более позднюю версию MariaDB в своей среде. После этого вы сможете выполнить `mysql_upgrade` миграцию в базу данных Azure для MariaDB.

## <a name="performance-considerations"></a>Вопросы производительности
Чтобы оптимизировать производительность при создании дампов больших баз данных, учитывайте следующие моменты.
-   Используйте `exclude-triggers` параметр в mysqldump. Исключите триггеры из файлов дампа, чтобы избежать срабатывания команд триггера во время восстановления данных. 
-   Используйте `single-transaction` параметр, чтобы задать для режима изоляции транзакций повторяемые операции чтения и отправки инструкции SQL на сервер перед сохранением данных. Создание дампа большого количества таблиц в одной транзакции приводит к потреблению дополнительного хранилища во время восстановления. `single-transaction`Параметр и `lock-tables` параметр являются взаимоисключающими. Это обусловлено тем, что таблицы БЛОКИРОВОК приводят к неявной фиксации всех ожидающих транзакций. Для формирования дампа больших таблиц используйте параметр `single-transaction` с параметром `quick`. 
-   Используйте многострочный синтаксис `extended-insert` с несколькими списками VALUE. Такой подход приводит к уменьшению размера файла дампа и ускоряет вставку при повторной загрузке файла.
-  Используйте `order-by-primary` параметр в mysqldump при создании дампа баз данных, чтобы данные были внесены в скрипт в порядке первичного ключа.
-   Используйте `disable-keys` параметр в mysqldump при дампе данных, чтобы отключить ограничения внешнего ключа перед нагрузкой. Отключение проверок внешнего ключа помогает повысить производительность. Включите ограничения и проверьте данные после загрузки, чтобы обеспечить целостность данных.
-   Используйте секционированные таблицы, когда это необходимо.
-   Загружайте данные в параллельном режиме. Избегайте слишком большого параллелизма, что может привести к превышению лимита ресурсов и мониторингу ресурсов с помощью метрик, доступных в портал Azure. 
-   Используйте `defer-table-indexes` параметр в mysqlpump при создании дампа баз данных, чтобы создание индекса происходило после загрузки данных таблицы.
-   Скопируйте файлы резервной копии в хранилище BLOB-объектов Azure и выполните восстановление отсюда. Этот подход должен быть намного быстрее, чем выполнение восстановления через Интернет.

## <a name="create-a-backup-file"></a>Создание резервного файла

Чтобы создать резервную копию существующей базы данных MariaDB на локальном сервере или в виртуальной машине, выполните следующую команду с помощью mysqldump: 

```bash
$ mysqldump --opt -u <uname> -p<pass> <dbname> > <backupfile.sql>
```

Необходимо указать следующие параметры:
- *\<uname>*: Имя пользователя базы данных 
- *\<pass>*— Пароль для базы данных (Обратите внимание, что между-p и паролем нет пробела) 
- *\<dbname>*: Имя базы данных. 
- *\<backupfile.sql>*: Имя файла для резервной копии базы данных. 
- *\<--opt>*: Параметр mysqldump 

Например, чтобы создать резервную копию базы данных с именем *TestDB* на сервере MariaDB с именем пользователя *TestUser* и без пароля в файле testdb_backup. SQL, используйте следующую команду. Команда создает резервную копию базы данных `testdb` в файле с именем `testdb_backup.sql`, который содержит все инструкции SQL, необходимые для повторного создания базы данных. 

```bash
$ mysqldump -u root -p testdb > testdb_backup.sql
```
Чтобы выбрать определенные таблицы для резервного копирования в базе данных, перечислите имена таблиц, разделяя их пробелами. Например, чтобы создать резервную копию только таблиц Table1 и Table2 из *TestDB*, выполните следующий пример: 

```bash
$ mysqldump -u root -p testdb table1 table2 > testdb_tables_backup.sql
```

Чтобы создать резервную копию нескольких баз данных одновременно, используйте параметр--Database и перечислите имена баз данных, разделяя их пробелами. 

```bash
$ mysqldump -u root -p --databases testdb1 testdb3 testdb5 > testdb135_backup.sql 
```

## <a name="create-a-database-on-the-target-server"></a>Создание базы данных на целевом сервере
Создайте пустую базу данных в целевой базе данных Azure для сервера MariaDB, куда необходимо перенести данные. Для этого используйте средство MySQL Workbench. База данных может иметь то же имя, что и база данных, которая содержит данные дампа. Вы также можете создать базу данных с другим именем.

Чтобы подключиться, выберите сведения о подключении в области **Обзор** базы данных Azure для MariaDB.

![Снимок экрана панели "Обзор" для сервера базы данных Azure для MariaDB в портал Azure.](./media/howto-migrate-dump-restore/1_server-overview-name-login.png)

В MySQL Workbench добавьте сведения о подключении.

![Снимок экрана: панель "подключения MySQL" в MySQL Workbench.](./media/howto-migrate-dump-restore/2_setup-new-connection.png)

## <a name="restore-your-mariadb-database"></a>Восстановление базы данных MariaDB
После создания целевой базы данных можно использовать команду MySQL или MySQL Workbench для восстановления данных в созданную базу данных из файла дампа.

```bash
mysql -h <hostname> -u <uname> -p<pass> <db_to_restore> < <backupfile.sql>
```

В этом примере данные восстанавливаются во вновь созданную базу данных на целевом сервере базы данных Azure для MariaDB.

```bash
$ mysql -h mydemoserver.mariadb.database.azure.com -u myadmin@mydemoserver -p testdb < testdb_backup.sql
```

## <a name="export-your-mariadb-database-by-using-phpmyadmin"></a>Экспорт базы данных MariaDB с помощью phpMyAdmin

Для экспорта можно использовать общий инструмент phpMyAdmin, который уже может быть установлен локально в вашей среде. Чтобы экспортировать базу данных MariaDB, выполните следующие действия.
1. Откройте phpMyAdmin.
1. В области слева выберите свою базу данных, а затем щелкните ссылку **Экспорт** . Появится страница для просмотра дампа базы данных.
1. В области **Экспорт** выберите ссылку **выбрать все** , чтобы выбрать таблицы в базе данных. 
1. В области **параметры SQL** выберите соответствующие параметры. 
1. Выберите параметр **Сохранить как файл** и соответствующий параметр сжатия, а затем нажмите кнопку **Go**. В командной строке сохраните файл локально.

## <a name="import-your-database-by-using-phpmyadmin"></a>Импорт базы данных с помощью phpMyAdmin

Процесс импорта аналогичен процессу экспорта. Выполните следующие действия.
1. Откройте phpMyAdmin. 
1. На странице Установка phpMyAdmin щелкните **Добавить** , чтобы добавить сервер базы данных Azure для MariaDB. 
1. Введите сведения о подключении и сведения для входа.
1. Создайте базу данных с соответствующим именем, а затем выберите ее в левой области. Чтобы перезаписать существующую базу данных, выберите ее имя, установите все флажки рядом с именами таблиц, **а затем выберите Удалить для удаления** существующих таблиц. 
1. Щелкните ссылку **SQL** , чтобы отобразить страницу, на которой можно ввести команды SQL или передать файл SQL. 
1. Нажмите кнопку **Обзор** , чтобы найти файл базы данных. 
1. Нажмите кнопку **Go (переход** ), чтобы экспортировать резервную копию, выполнить команды SQL и повторно создать базу данных.

## <a name="next-steps"></a>Дальнейшие шаги
- [Подключите приложения к базе данных Azure для MariaDB](./howto-connection-string.md).
