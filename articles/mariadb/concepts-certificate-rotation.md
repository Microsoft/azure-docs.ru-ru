---
title: Смена сертификатов для базы данных Azure для MariaDB
description: Узнайте о предстоящих изменениях изменений корневого сертификата, которые повлияют на базу данных Azure для MariaDB
author: mksuni
ms.author: sumuth
ms.service: mariadb
ms.topic: conceptual
ms.date: 01/18/2021
ms.openlocfilehash: ac7019abab1aefaee95c155e34fbc0cb551b4d94
ms.sourcegitcommit: fc23b4c625f0b26d14a5a6433e8b7b6fb42d868b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/17/2021
ms.locfileid: "98538419"
---
# <a name="understanding-the-changes-in-the-root-ca-change-for-azure-database-for-mariadb"></a>Основные сведения об изменениях в корневом центре сертификации для базы данных Azure для MariaDB

База данных Azure для MariaDB будет изменять корневой сертификат для клиентского приложения или драйвера, включенного с помощью SSL. Используйте для [подключения к серверу базы данных](concepts-connectivity-architecture.md). Срок действия корневого сертификата в настоящее время истекает 15 февраля 2021 (02/15/2021) в рамках стандартных рекомендаций по обслуживанию и обеспечению безопасности. В этой статье приводятся дополнительные сведения о предстоящих изменениях, ресурсах, которые будут затронуты, и действиях, которые необходимо выполнить, чтобы обеспечить поддержку подключения приложения к серверу базы данных.

>[!NOTE]
> Основываясь на отзывах клиентов, мы расширили нерекомендуемую поддержку корневого сертификата для нашего существующего корневого ЦС Baltimore из октября 26th, 2020 до 15 февраля 2021. Мы надеемся, что это расширение позволяет нашим пользователям достаточно времени для реализации изменений клиентов, если они затронуты.

> [!NOTE]
> Эта статья содержит ссылки на термин « _Ведомый_» термин, который корпорация Майкрософт больше не использует. Когда этот термин будет удален из программного обеспечения, мы удалим его из статьи.

## <a name="what-update-is-going-to-happen"></a>Какое обновление будет выполнено?

В некоторых случаях приложения используют локальный файл сертификата, созданный из файла сертификата доверенного центра сертификации (ЦС) для безопасного подключения. Сейчас клиенты могут использовать только предопределенный сертификат для подключения к серверу базы данных Azure для MariaDB, расположенному [здесь](https://www.digicert.com/CACerts/BaltimoreCyberTrustRoot.crt.pem). Однако в [браузере центра сертификации (ЦС) на форуме](https://cabforum.org/)   Недавно опубликованные отчеты о нескольких сертификатах, выданных поставщиками ЦС, не соответствуют требованиям.

Согласно требованиям отрасли поставщики ЦС начали отменять сертификаты ЦС для несоответствующих центров сертификации, требовать, чтобы серверы использовали сертификаты, выпущенные соответствующими центрами сертификации, и подписали сертификаты ЦС из соответствующих центров сертификации. Так как база данных Azure для MariaDB в настоящее время использует один из этих несоответствующих сертификатов, которые клиентские приложения используют для проверки своих SSL-подключений, необходимо убедиться, что выполнены соответствующие действия (описанные ниже), чтобы максимально уменьшить потенциальное воздействие на серверы MariaDB.

Новый сертификат будет использоваться начиная с 15 февраля 2021 (02/15/2021). При использовании проверки ЦС или полной проверки сертификата сервера при подключении из клиента MySQL (sslmode = Verify-CA или sslmode = Verify-Full) необходимо обновить конфигурацию приложения до 15 февраля 2021 (02/15/2021).

## <a name="how-do-i-know-if-my-database-is-going-to-be-affected"></a>Разделы справки понять, будет ли затронута моя база данных?

Все приложения, использующие SSL/TLS и проверяющие корневой сертификат, должны обновить корневой сертификат. Вы можете определить, проверяют ли ваши подключения корневой сертификат, просмотрев строку подключения.

- Если строка подключения включает `sslmode=verify-ca` или `sslmode=verify-identity` , необходимо обновить сертификат.
- Если строка подключения включает `sslmode=disable` , `sslmode=allow` , `sslmode=prefer` или `sslmode=require` , не требуется обновлять сертификаты.
- Если в строке подключения не указано sslmode, обновлять сертификаты не требуется.

Если вы используете клиент, который абстрагирует строку подключения, изучите документацию клиента, чтобы понять, будет ли он проверять сертификаты.
Чтобы ознакомиться с базой данных Azure для MariaDB sslmode, ознакомьтесь с [описанием режима SSL](concepts-ssl-connection-security.md#default-settings).

Чтобы избежать прерывания доступности приложения в результате неожиданного отзыва сертификатов или обновления сертификата, который был отозван, см. раздел [**"что нужно сделать для поддержания подключения"**](concepts-certificate-rotation.md#what-do-i-need-to-do-to-maintain-connectivity) .

## <a name="what-do-i-need-to-do-to-maintain-connectivity"></a>Что нужно сделать для поддержания подключения

Чтобы предотвратить прерывание доступности приложения из-за неожиданного отзыва сертификатов или для обновления сертификата, который был отозван, выполните следующие действия. Идея состоит в создании нового *PEM* -файла, который объединяет текущий сертификат и новый, а также во время проверки SSL-сертификата после допустимых значений. Ознакомьтесь с приведенными ниже шагами.

- Скачайте **BaltimoreCyberTrustRoot**  &  **DigiCertGlobalRootG2** CA по ссылкам ниже:

  - [https://www.digicert.com/CACerts/BaltimoreCyberTrustRoot.crt.pem](https://www.digicert.com/CACerts/BaltimoreCyberTrustRoot.crt.pem)
  - [https://cacerts.digicert.com/DigiCertGlobalRootG2.crt.pem](https://cacerts.digicert.com/DigiCertGlobalRootG2.crt.pem)

- Создайте объединенное хранилище сертификатов ЦС с сертификатами **BaltimoreCyberTrustRoot** и **DigiCertGlobalRootG2** .

  - Для пользователей Java (MariaDB Connector/J) выполните:

    ```console
    keytool -importcert -alias MariaDBServerCACert  -file D:\BaltimoreCyberTrustRoot.crt.pem  -keystore truststore -storepass password -noprompt
    ```

    ```console
    keytool -importcert -alias MariaDBServerCACert2  -file D:\DigiCertGlobalRootG2.crt.pem -keystore truststore -storepass password  -noprompt
    ```

    Затем замените исходный файл хранилища ключей новым созданным файлом.

    - System. setProperty ("жавакс. NET. SSL. trustStore", "path_to_truststore_file");
    - System. setProperty ("жавакс. NET. SSL. trustStorePassword", "пароль");

  - Для пользователей .NET (MariaDB Connector/NET, Мариадбконнектор) убедитесь, что в хранилище сертификатов Windows существуют и другие доверенные корневые центры сертификации ( **BaltimoreCyberTrustRoot** и **DigiCertGlobalRootG2** ). Если какие либо сертификаты не существуют, импортируйте недостающий сертификат.

    [![Сертификат .NET для базы данных Azure для MariaDB](media/overview/netconnecter-cert.png)](media/overview/netconnecter-cert.png#lightbox)

  - Для пользователей .NET в Linux, использующих SSL_CERT_DIR, убедитесь, что **BaltimoreCyberTrustRoot** и **DigiCertGlobalRootG2** существуют в каталоге, указанном SSL_CERT_DIR. Если какие либо сертификаты не существуют, создайте недостающий файл сертификата.

  - Для других пользователей (MariaDB Client/MariaDB Workbench/C/C++/го/Писон/Руби/ФП/нодежс/Перл/Свифт) можно выполнить слияние двух файлов сертификатов ЦС, таких как приведенный ниже формат.

   ```
   -----BEGIN CERTIFICATE-----
   (Root CA1: BaltimoreCyberTrustRoot.crt.pem)
   -----END CERTIFICATE-----
   -----BEGIN CERTIFICATE-----
   (Root CA2: DigiCertGlobalRootG2.crt.pem)
   -----END CERTIFICATE-----
   ```

- Замените исходный файл PEM корневого центра сертификации на объединенный файл корневого ЦС и перезапустите приложение или клиент.
- В будущем после развертывания нового сертификата на стороне сервера можно изменить PEM-файл CA на DigiCertGlobalRootG2. CRT. PEM.

## <a name="what-can-be-the-impact-of-not-updating-the-certificate"></a>Что может негативно сказаться на обновлении сертификата?

Если вы используете сертификат, выданный в базе данных Azure для MariaDB, как описано здесь, доступность вашего приложения может быть прервана, так как база данных не будет доступна. В зависимости от приложения могут появляться различные сообщения об ошибках, включая, но не ограниченные:

- Недопустимый сертификат или отозванный сертификат
- Время ожидания подключения истекло

> [!NOTE]
> Не удаляйте и не изменяйте **сертификат Baltimore** , пока не будет внесено изменение сертификата. После внесения изменений мы отправим подключение, после чего оно будет безопасно удалено для удаления сертификата Baltimore.

## <a name="frequently-asked-questions"></a>Часто задаваемые вопросы

### <a name="1-if-im-not-using-ssltls-do-i-still-need-to-update-the-root-ca"></a>1. Если я не использую SSL/TLS, мне все равно нужно обновить корневой ЦС?

Если вы не используете SSL/TLS, никаких действий не требуется.

### <a name="2-if-im-using-ssltls-do-i-need-to-restart-my-database-server-to-update-the-root-ca"></a>2. Если я использую SSL/TLS, нужно ли перезапустить сервер базы данных, чтобы обновить корневой ЦС?

Нет, не нужно перезагружать сервер базы данных, чтобы приступить к использованию нового сертификата. Обновление сертификата является изменением на стороне клиента, и для входящих клиентских подключений необходимо использовать новый сертификат, чтобы обеспечить возможность подключения к серверу базы данных.

### <a name="3-what-will-happen-if-i-dont-update-the-root-certificate-before-february-15-2021-02152021"></a>3. что произойдет, если не обновить корневой сертификат до 15 февраля 2021 (02/15/2021)?

Если вы не обновите корневой сертификат до 15 февраля 2021 (02/15/2021), ваши приложения, подключающиеся по протоколу SSL/TLS и выполняющие проверку корневого сертификата, не смогут взаимодействовать с сервером базы данных MariaDB, и приложение будет испытывать проблемы с подключением к серверу базы данных MariaDB.

### <a name="4-what-is-the-impact-if-using-app-service-with-azure-database-for-mariadb"></a>4. Каковы последствия использования службы приложений с базой данных Azure для MariaDB?

Для служб приложений Azure, подключающихся к базе данных Azure для MariaDB, существует два возможных сценария, в зависимости от того, как используется SSL с приложением.

- Этот новый сертификат добавлен в службу приложений на уровне платформы. Если вы используете SSL-сертификаты, включенные в приложение в платформе службы приложений, никаких действий не требуется.
- Если вы явно включаете путь к файлу SSL-сертификата в коде, вам потребуется скачать новый сертификат и обновить код для использования нового сертификата. Хорошим примером этого сценария является использование пользовательских контейнеров в службе приложений в качестве общих в [документации по службе приложений](../app-service/tutorial-multi-container-app.md#configure-database-variables-in-wordpress) .

### <a name="5-what-is-the-impact-if-using-azure-kubernetes-services-aks-with-azure-database-for-mariadb"></a>5. Каковы последствия использования Azure Kubernetes Services (AKS) с базой данных Azure для MariaDB?

Если вы пытаетесь подключиться к базе данных Azure для MariaDB с помощью служб Kubernetes Azure (AKS), это похоже на доступ из выделенной среды размещения клиентов. Инструкции см. [здесь](../aks/ingress-own-tls.md).

### <a name="6-what-is-the-impact-if-using-azure-data-factory-to-connect-to-azure-database-for-mariadb"></a>6. Каковы последствия использования фабрики данных Azure для подключения к базе данных Azure для MariaDB?

Для соединителя, использующего Azure Integration Runtime, соединитель использует сертификаты в хранилище сертификатов Windows в среде, размещенной в Azure. Эти сертификаты уже совместимы с вновь применяемыми сертификатами, поэтому никаких действий не требуется.

Для соединителя, использующего локально размещенный Integration Runtime, в который явно включен путь к файлу SSL-сертификата в строке подключения, необходимо скачать [новый сертификат](https://cacerts.digicert.com/DigiCertGlobalRootG2.crt.pem) и обновить строку подключения, чтобы она использовалась.

### <a name="7-do-i-need-to-plan-a-database-server-maintenance-downtime-for-this-change"></a>7. нужно ли мне запланировать время простоя обслуживания сервера базы данных для этого изменения?

Нет. Так как изменение на стороне клиента связано с тем, что для подключения к серверу базы данных не требуется простоя обслуживания сервера базы данных.

### <a name="8--what-if-i-cant-get-a-scheduled-downtime-for-this-change-before-february-15-2021-02152021"></a>8. что делать, если я не могу получить запланированное время простоя для этого изменения до 15 февраля 2021 (02/15/2021)?

Так как клиенты, используемые для подключения к серверу, должны обновить сведения о сертификате, как описано в разделе Исправление [здесь](./concepts-certificate-rotation.md#what-do-i-need-to-do-to-maintain-connectivity), в этом случае не требуется простоя сервера.

### <a name="9-if-i-create-a-new-server-after-february-15-2021-02152021-will-i-be-impacted"></a>9. Если я создаю новый сервер после 15 февраля 2021 (02/15/2021), будет ли это затронуто?

Для серверов, созданных после 15 февраля 2021 (02/15/2021), можно использовать только что выпущенный сертификат для подключения приложений по протоколу SSL.

### <a name="10-how-often-does-microsoft-update-their-certificates-or-what-is-the-expiry-policy"></a>10. как часто Корпорация Майкрософт обновляет свои сертификаты или какова политика срока действия?

Эти сертификаты, используемые базой данных Azure для MariaDB, предоставляются доверенными центрами сертификации (CA). Поэтому поддержка этих сертификатов в базе данных Azure для MariaDB связана с поддержкой этих сертификатов центром сертификации. Однако, как и в этом случае, в этих стандартных сертификатах могут воздержаться непредвиденные ошибки, которые должны быть исправлены самым ранним образом.

### <a name="11-if-im-using-read-replicas-do-i-need-to-perform-this-update-only-on-source-server-or-the-read-replicas"></a>11. Если я использую для чтения реплики, нужно ли выполнять это обновление только на исходном сервере или репликах чтения?

Так как это обновление является изменением на стороне клиента, если клиент использовался для считывания данных с сервера реплики, необходимо также применить изменения для этих клиентов.

### <a name="12-if-im-using-data-in-replication-do-i-need-to-perform-any-action"></a>12. Если я использую репликацию данных, нужно ли выполнять какие-либо действия?

- Если репликация данных выполняется из виртуальной машины (локальной или виртуальной машины Azure) в базу данных Azure для MySQL, необходимо проверить, используется ли SSL для создания реплики. Выполните команду **ОТОБРАЗИТЬ состояние Slave** и проверьте следующий параметр.

    ```azurecli-interactive
    Master_SSL_Allowed            : Yes
    Master_SSL_CA_File            : ~\azure_mysqlservice.pem
    Master_SSL_CA_Path            :
    Master_SSL_Cert               : ~\azure_mysqlclient_cert.pem
    Master_SSL_Cipher             :
    Master_SSL_Key                : ~\azure_mysqlclient_key.pem
    ```

Если вы используете [репликацию данных](concepts-data-in-replication.md) для подключения к базе данных Azure для MySQL, необходимо учитывать два фактора:

- Если репликация данных выполняется из виртуальной машины (локальной или виртуальной машины Azure) в базу данных Azure для MySQL, необходимо проверить, используется ли SSL для создания реплики. Выполните команду **ОТОБРАЗИТЬ состояние Slave** и проверьте следующий параметр. 

  ```azurecli-interactive
  Master_SSL_Allowed            : Yes
  Master_SSL_CA_File            : ~\azure_mysqlservice.pem
  Master_SSL_CA_Path            :
  Master_SSL_Cert               : ~\azure_mysqlclient_cert.pem
  Master_SSL_Cipher             :
  Master_SSL_Key                : ~\azure_mysqlclient_key.pem
  ```

  Если вы видите сертификат для CA_file, SSL_Cert и SSL_Key, необходимо будет обновить файл, добавив [новый сертификат](https://cacerts.digicert.com/DigiCertGlobalRootG2.crt.pem).

- Если репликация данных выполняется между двумя базами данных Azure для MySQL, необходимо сбросить реплику, выполнив команду **CALL MySQL.az_replication_change_master** и указав новый двойной корневой сертификат в качестве последнего параметра [master_ssl_ca](howto-data-in-replication.md#link-the-source-and-replica-servers-to-start-data-in-replication).

### <a name="13-do-we-have-server-side-query-to-verify-if-ssl-is-being-used"></a>13. у нас есть запрос на стороне сервера, чтобы проверить, используется ли протокол SSL?

Чтобы проверить, используется ли SSL-соединение для подключения к серверу, обратитесь к [проверке SSL](howto-configure-ssl.md#verify-the-ssl-connection).

### <a name="14-is-there-an-action-needed-if-i-already-have-the-digicertglobalrootg2-in-my-certificate-file"></a>14. требуется ли действие, если у меня уже есть DigiCertGlobalRootG2 в файле сертификата?

Нет. Если файл сертификата уже содержит **DigiCertGlobalRootG2**, никаких действий не требуется.

### <a name="15-what-if-i-have-further-questions"></a>15. что делать, если у меня возникнут дополнительные вопросы?

Если у вас есть вопросы, получите ответы от экспертов сообщества в [Microsoft Q&а](mailto:AzureDatabaseformariadb@service.microsoft.com). Если у вас есть план поддержки и вам нужна техническая помощь, [свяжитесь с нами](mailto:AzureDatabaseformariadb@service.microsoft.com).
